cscope 15 $HOME/Downloads/hplip-3.19.11               0002974999
	@Common.h

1 #iâdeà
_COMMON_H


2 
	#_COMMON_H


	)

4 
	~<io¡»am
>

5 
	~<¡ršg
>

6 
	~<¡ršg.h
>

7 
	~<f¡»am
>

8 
	~<uni¡d.h
>

9 
	~<s¡»am
>

10 
	~<veùÜ
>

11 
	~<m­
>

12 
	~<®gÜ™hm
>

13 
	~<s¡»am
>

15 
usšg
 
Çme¥aû
 
	g¡d
;

18 
	g·œ
 <
	t¡ršg
, sŒšg> 
	tSTRING_STRING_PAIR
;

20 
	gveùÜ
<
	tSTRING_STRING_PAIR
> 
	tPAIR_VECTOR
;

23 
_MODEL_DICT_
 
	tMODEL_DICT
;

26 
	gm­
< 
	t¡ršg
, 
	tMODEL_DICT
> 
	tMODEL_DICT_MAP
;

29 
	gveùÜ
 <
	t¡ršg
> 
	tSTRING_VECTOR
;

32 
	gm­
<
	t¡ršg
, sŒšg> 
	tSTRING_PAIR
;

59 
	s_MODEL_DICT_


61 
¡ršg
 
	ms_‹ch_şass
;

62 
¡ršg
 
	ms_sub_şass
;

63 
¡ršg
 
	ms_çmy_şass
;

64 
¡ršg
 
	ms_nÜm®_mod–_Çme
;

65 
	ms_¶ugš
;

66 
	ms_¶ugš_»asÚ
;

67 
STRING_VECTOR
 
	mmod–_v¬ŸÁs
;

	@Dat2drv.cpp

1 
	~"D©2drv.h
"

9 
	$In™DrvD©a
(
DRV_DATA
 &
drv_d©a
)

11 
drv_d©a
.
cu¼’t_·th
 = "";

12 
drv_d©a
.
d©_·th
 = "";

13 
drv_d©a
.
drv_dœ
 = "";

14 
drv_d©a
.
drv_š_‹m¶©e
 = "";

15 
drv_d©a
.
drv_š
 = "";

17 
	}
}

25 
MODEL_DICT_MAP
 
	$C»©eMod–Diù
(
DRV_DATA
 
drv_v®ue
)

27 
MODEL_DICT
 
mod–_diù_v®ues
;

28 
¡ršg
 
mod–_Çme
, 
lše
;

29 
MODEL_DICT_MAP
 
mod–_diù
;

30 
STRING_VECTOR
 
mod–_v¬ŸÁs
;

33 
f¡»am
 
fe_poš‹r
;

34 
fe_poš‹r
.
	`İ’
(
drv_v®ue
.
d©_·th
.
	`c_¡r
(), 
f¡»am
::
š
);

36 if(!
fe_poš‹r
)

38 
	`årštf
(
¡d”r
, "DAT2DRV : FAILED IN CreateModelDict(DRV_DATA drv_value) -> file_pointer = NULL\n");

39  
mod–_diù
;

42 (
	`g‘lše
(
fe_poš‹r
, 
lše
)))

44 if(
lše
[0] == '#')

46 if(
lše
[0] == '[')

48 
lše
.
	`assign
Öše, 1,†še.
	`Ëngth
() -2);

49 
mod–_Çme
 = 
lše
;

53 if((
lše
.
	`fšd
("mod–")è!ğ
¡d
::
¡ršg
::
Åos
)

56 
size_t
 
found
 = 
lše
.
	`fšd
("=");

57 if(
found
 !ğ
¡d
::
¡ršg
::
Åos
)

59 
lše
.
	`assign
Öše, 
found
 + 1,†še.
	`Ëngth
());

60 
mod–_diù_v®ues
.
mod–_v¬ŸÁs
.
	`push_back
(
lše
);

63 
	`årštf
(
¡d”r
, "DAT2DRV : FAILED IN CreateModelDict(DRV_DATA drv_value) -> = missing in models.dat\n");

66 if((
lše
.
	`fšd
("¶ugš-»asÚ")è!ğ
¡d
::
¡ršg
::
Åos
)

68 
¡ršg¡»am
 
	`fe_¡»am
(
lše
);

69 
¡ršg
 
v®ue
;

70 
couÁ
 = 0;

71 
	`g‘lše
(
fe_¡»am
, 
v®ue
, '='))

72 
couÁ
 ++;

73 if(
couÁ
 == 2)

74 
mod–_diù_v®ues
.
s_¶ugš_»asÚ
 = 
	`©oi
(
v®ue
.
	`c_¡r
());

78 if((
lše
.
	`fšd
("¶ugš")è!ğ
¡d
::
¡ršg
::
Åos
)

80 
¡ršg¡»am
 
	`fe_¡»am
(
lše
);

81 
¡ršg
 
v®ue
;

82 
couÁ
 = 0;

83 
	`g‘lše
(
fe_¡»am
, 
v®ue
, '='))

84 
couÁ
 ++;

85 if(
couÁ
 == 2)

86 
mod–_diù_v®ues
.
s_¶ugš
 = 
	`©oi
(
v®ue
.
	`c_¡r
());

90 if((
lše
.
	`fšd
("çmy-şass")è!ğ
¡d
::
¡ršg
::
Åos
)

92 
¡ršg¡»am
 
	`fe_¡»am
(
lše
);

93 
¡ršg
 
v®ue
;

94 
couÁ
 = 0;

95 
	`g‘lše
(
fe_¡»am
, 
v®ue
, '='))

96 
couÁ
 ++;

97 if(
couÁ
 == 2)

98 
mod–_diù_v®ues
.
s_çmy_şass
 = 
v®ue
;

102 if((
lše
.
	`fšd
("‹ch-şass")è!ğ
¡d
::
¡ršg
::
Åos
)

104 
¡ršg¡»am
 
	`fe_¡»am
(
lše
);

105 
¡ršg
 
v®ue
;

106 
couÁ
 = 0;

107 
	`g‘lše
(
fe_¡»am
, 
v®ue
, '='))

108 
couÁ
 ++;

109 if(
couÁ
 == 2)

110 
mod–_diù_v®ues
.
s_‹ch_şass
 = 
v®ue
;

114 if((
lše
.
	`fšd
("‹ch-subşass")è!ğ
¡d
::
¡ršg
::
Åos
)

116 
¡ršg¡»am
 
	`fe_¡»am
(
lše
);

117 
¡ršg
 
v®ue
;

118 
couÁ
 = 0;

119 
	`g‘lše
(
fe_¡»am
, 
v®ue
, '='))

120 
couÁ
 ++;

121 if(
couÁ
 == 2)

122 
mod–_diù_v®ues
.
s_sub_şass
 = 
v®ue
;

123 
mod–_diù_v®ues
.
s_nÜm®_mod–_Çme
 = "";

124 
mod–_diù
.
	`š£¹
(
¡d
::
	`make_·œ
(
mod–_Çme
, 
mod–_diù_v®ues
));

125 
mod–_diù_v®ues
.
mod–_v¬ŸÁs
.
	`ş—r
();

126 
mod–_diù_v®ues
.
s_‹ch_şass
 ="";

127 
mod–_diù_v®ues
.
s_sub_şass
 ="";

128 
mod–_diù_v®ues
.
s_çmy_şass
 ="";

129 
mod–_diù_v®ues
.
s_¶ugš
 = -1;

130 
mod–_diù_v®ues
.
s_¶ugš_»asÚ
 = -1;

134 if(
fe_poš‹r
)

135 
fe_poš‹r
.
	`şo£
();

136  
mod–_diù
;

138 
	}
}

146 
¡ršg
 
	$FixFeName
(
¡ršg
 
mod–_Çme
)

149 
size_t
 
šdex
 = 0;

150 
¡ršg
 
»p_¡ršg
 = "",

151 
‹mp_¡ršg
 = "";

152 
Ën
 = 0;

154 if((
šdex
 = 
mod–_Çme
.
	`fšd
("hp_")è!ğ
¡ršg
::
Åos
)

156 
mod–_Çme
.
	`»¶aû
(
šdex
, 3, "hp-");

157 
‹mp_¡ršg
 = 
mod–_Çme
;

159 if((
šdex
 = 
mod–_Çme
.
	`fšd
("­Şlo_")è!ğ
¡ršg
::
Åos
)

161 
mod–_Çme
.
	`»¶aû
(
šdex
, 7, "apollo-");

162 
‹mp_¡ršg
 = 
mod–_Çme
;

166 if((
šdex
 = 
mod–_Çme
.
	`fšd
("hp-")è=ğ
¡ršg
::
Åos
)

168 
‹mp_¡ršg
 = "hp-";

169 
‹mp_¡ršg
 +ğ
mod–_Çme
;

172 
couÁ
 = 0; couÁ < 
‹mp_¡ršg
.
	`Ëngth
(); count ++)

174 if(
‹mp_¡ršg
[
couÁ
] == '~')

176 
»p_¡ršg
 +ğ
‹mp_¡ršg
[
couÁ
];

177 
Ën
 ++;

179  
»p_¡ršg
;

180 
	}
}

188 
	$ShÜtMod–L’gth
(
¡ršg
 &
mod–_Çme
)

190 
size_t
 
šdex
 = 0;

192 
couÁ
 = 0; couÁ < 
MAX_SHORTENING_REPLACEMENTS
; count ++)

194 
šdex
 = 
mod–_Çme
.
	`fšd
(
SHORTENING_REPLACEMENTS
[
couÁ
]);

195 if(
šdex
 !ğ
¡ršg
::
Åos
)

196 
mod–_Çme
.
	`»¶aû
(
šdex
, 
SHORTENING_REPLACEMENTS
[
couÁ
].
	`Ëngth
(), 
SHORTENING_REPLACEMENTS_VALUE
[count]);

201 
	}
}

209 
¡ršg
 
	$S‘SubCÏss
(
STRING_VECTOR
 
sub_şass
)

211 
¡ršg
 
subşass
 = "";

212 
couÁ
 = 0; couÁ< 
sub_şass
.
	`size
(); count ++)

213 
subşass
 +ğ
sub_şass
[
couÁ
] + ',';

214 
subşass
.
	`assign
(subşass, 0, subşass.
	`Ëngth
() - 1);

215  
subşass
;

216 
	}
}

223 
DRV_DATA
 
	$S‘FeInfo
(
boŞ
 
bHpijs
)

226 
¡ršg
 
cu¼’t_·th
, 
d©_·th
, 
drv_dœ
, 
‹mp_dœ
 = "";

227 
DRV_DATA
 
drv_v®ue
;

228 
wÜkšg_dœ
[
MAX_DIRECTORY_SIZE
] = {0};

230 
cu¼’t_·th
 = 
	`g‘cwd
(
wÜkšg_dœ
, (working_dir));

232 
d©_·th
 = 
cu¼’t_·th
;

233 
drv_dœ
 = 
cu¼’t_·th
;

235 
drv_dœ
.
	`­³nd
("/prnt/drv");

236 
d©_·th
.
	`­³nd
("/data/models/models.dat");

238 
drv_v®ue
.
cu¼’t_·th
 = current_path;

239 
drv_v®ue
.
d©_·th
 = dat_path;

240 
drv_v®ue
.
drv_dœ
 = drv_dir;

241 
‹mp_dœ
 = 
drv_dœ
;

242 ià(
bHpijs
)

243 
drv_v®ue
.
drv_š_‹m¶©e
 = 
‹mp_dœ
.
	`­³nd
("/hpijs.drv.in.template");

245 
drv_v®ue
.
drv_š_‹m¶©e
 = 
‹mp_dœ
.
	`­³nd
("/hpcups.drv.in.template");

246 
‹mp_dœ
 = 
drv_dœ
;

247 ià(
bHpijs
)

248 
drv_v®ue
.
drv_š
 = 
‹mp_dœ
.
	`­³nd
("/hpijs.drv.in");

250 
drv_v®ue
.
drv_š
 = 
‹mp_dœ
.
	`­³nd
("/hpcups.drv.in");

251  
drv_v®ue
;

253 
	}
}

261 
	$TechCÏssExsi¡
(
¡ršg
 
‹ch_şass
)

263 
couÁ
 = 0; couÁ < 
MAX_TECH_CLASS
; count ++)

265 ià(
‹ch_şass
 =ğ
TECH_CLASSES
[
couÁ
])

270 
	}
}

278 
	$SubCÏssExsi¡
(
STRING_VECTOR
 
sub_şass
)

280 if(
sub_şass
.
	`size
() == 0)

281 
	`årštf
(
¡d”r
, "DAT2DRV : FAILED IN SubClassExsist(STRING_VECTOR sub_class) -> = NO SUB CLASS MATCH FOUND\n");

282 
Ën
 = 0 ;†’ < 
sub_şass
.
	`size
();†en ++)

284 
couÁ
 = 0; couÁ < 
MAX_SUB_CLASS
; count ++)

286 if(
TECH_SUBCLASSES
[
couÁ
] =ğ
sub_şass
.
	`©
(
Ën
))

290 
	`årštf
(
¡d”r
, "DAT2DRV : FAILED IN SubClassExsist(STRING_VECTOR sub_class) -> = NO SUB CLASS MATCH FOUND\n");

292 
	}
}

302 
STRING_VECTOR
 
	$C»©eTechCÏssM©ch
(
MODEL_DICT_MAP
 
mod–_diù
, 
STRING_VECTOR
 
sub_şass
, 
¡ršg
 
subşass
, sŒšg 
‹ch_şass
)

304 
šşude
 = 0, 
is_§me
 = 0;

305 
STRING_VECTOR
 
m©ches
;

306 
¡ršg
 
sub_şass_1
 = "", 
sub_şass_2
 = "";

308 
MODEL_DICT_MAP
::
™”©Ü
 
™
=
mod–_diù
.
	`begš
(); it!=mod–_diù.
	`’d
(); ++it)

310 if((
™
->
£cÚd
.
s_‹ch_şass
.
	`fšd
(",")è!ğ
¡d
::
¡ršg
::
Åos
)

312 
couÁ
 = 0; couÁ < 
‹ch_şass
.
	`Ëngth
(); count++)

314 if(
™
->
£cÚd
.
s_‹ch_şass
[
couÁ
] == ',')

316 
sub_şass_1
 +ğ
™
->
£cÚd
.
s_‹ch_şass
[
couÁ
];

318 
™
->
£cÚd
.
s_‹ch_şass
 = 
sub_şass_1
;

319 
sub_şass_1
 = "";

321 if((
™
->
£cÚd
.
s_‹ch_şass
 =ğ
‹ch_şass
è&& it->£cÚd.
s_sub_şass
.
	`Ëngth
(è=ğ
subşass
.length())

323 if((
sub_şass
.
	`size
()) < 2)

325 if(
™
->
£cÚd
.
s_sub_şass
 !ğ
subşass
)

327 
is_§me
 = 1;

331 
Ën
 = 0;†’ < 
sub_şass
.
	`size
();†en++)

333 
is_§me
 = 1;

334 if((
™
->
£cÚd
.
s_sub_şass
.
	`fšd
(
sub_şass
[
Ën
])è=ğ
¡d
::
¡ršg
::
Åos
)

336 
is_§me
 = 0;

341 if(
is_§me
 == 0)

343 if(
sub_şass
.
	`size
() < 2)

345 
šşude
 = 0;

346 
couÁ
 = 0; couÁ< 
MAX_SUB_CLASS
; count ++)

348 if(
sub_şass
[0] =ğ
TECH_SUBCLASSES
[
couÁ
]);

349 
šşude
 = 1;

354 
šşude
 = 0;

355 
Ën
 = 0;†’ < 
sub_şass
.
	`size
();†en ++)

357 
couÁ
 = 0; couÁ< 
MAX_SUB_CLASS
; count ++)

359 if(
sub_şass
[0] =ğ
TECH_SUBCLASSES
[
couÁ
])

360 
šşude
 = 1;

364 if(
šşude
)

365 
m©ches
.
	`push_back
(
™
->
fœ¡
);

367 
	`årštf
(
¡d”r
, "DAT2DRV : FAILED IN CreateMatch(MODEL_DICT_MAP model_dict, STRING_VECTOR sub_class, string subclass, stringech_class) -> NO MATCH FOUND\n");

370  
m©ches
;

371 
	}
}

379 
	$FamyCÏssExsi¡
(
¡ršg
 
çmy_şass
)

381 
couÁ
 = 0; couÁ < 
MAX_FAMILY_CLASS
; count ++)

383 ià(
çmy_şass
 =ğ
FAMILY_CLASSES
[
couÁ
])

386 
	`årštf
(
¡d”r
, "DAT2DRV : FAILED IN FamilyClassExsist(string family_class) -> NO FAMILY CLASS MATCH FOUND\n");

388 
	}
}

397 
	$CheckMod–NameExsi¡
(
¡ršg
 
mod–_Çme
, 
MODEL_DICT_MAP
 &
mod–_diù
)

399 
MODEL_DICT_MAP
 
mod–_šput_m­
;

400 
MODEL_DICT
 
mod–_diù_v®ues
;

401 
MODEL_DICT_MAP
::
™”©Ü
 
™
=
mod–_diù
.
	`begš
(); it!=mod–_diù.
	`’d
(); ++it)

403 if(
™
->
fœ¡
 =ğ
mod–_Çme
)

405 
mod–_diù_v®ues
 = 
™
->
£cÚd
;

406 
mod–_šput_m­
.
	`š£¹
(
¡d
::
	`make_·œ
(
mod–_Çme
, 
mod–_diù_v®ues
));

407 
mod–_diù
 = 
mod–_šput_m­
;

412 
	}
}

421 
STRING_VECTOR
 
	$C»©eFamyCÏssM©ch
(
MODEL_DICT_MAP
 
mod–_diù
, 
¡ršg
 
çmy_şass
)

423 
šşude
 = 0;

424 
STRING_VECTOR
 
m©ches
;

426 
MODEL_DICT_MAP
::
™”©Ü
 
™
=
mod–_diù
.
	`begš
(); it!=mod–_diù.
	`’d
(); ++it)

428 if((
™
->
£cÚd
.
s_çmy_şass
.
	`fšd
(
çmy_şass
)è=ğ
¡d
::
¡ršg
::
Åos
)

430 
šşude
 = 1;

431 if(
šşude
)

432 
m©ches
.
	`push_back
(
™
->
fœ¡
);

433 
šşude
 = 0;

435  
m©ches
;

436 
	}
}

448 
	$C»©eFamyCÏssDrv
(
DRV_DATA
 
drv_d©a
, 
MODEL_DICT_MAP
 
mod–_diù
, 
¡ršg
 
mod–_šput
, sŒšg 
mod–_šput_‹ch_şass
)

450 
¡ršg
 
çmy_şass
 = "",

451 
lše
 = "";

452 
STRING_VECTOR
 
m©ches
;

453 
STRING_VECTOR
 
sub_şass
;

455 
f¡»am
 
fe_š_poš‹r
, 
fe_out_poš‹r
;

457 
fe_š_poš‹r
.
	`İ’
(
drv_d©a
.
drv_š_‹m¶©e
.
	`c_¡r
(), 
f¡»am
::
š
);

458 if(!
fe_š_poš‹r
)

460 
	`årštf
(
¡d”r
, "DAT2DRV : FAILED IN main (int‡rgc, char **argv) -> UNABLE TO OPEN A FILE FOR READ\n");

464 
fe_out_poš‹r
.
	`İ’
(
drv_d©a
.
drv_š
.
	`c_¡r
(), 
f¡»am
::
out
);

465 if(!
fe_out_poš‹r
)

467 
	`årštf
(
¡d”r
, "DAT2DRV : FAILED IN main (int‡rgc, char **argv) -> UNABLE TO OPEN A FILE FOR READ\n");

471 (
	`g‘lše
(
fe_š_poš‹r
, 
lše
)))

473 
¡ršg
 
£¬ch_çmy_şass
;

474 
¡ršg¡»am
 
	`f
(
lše
);

475 
size_t
 
found
 = 
lše
.
	`fšd
("%");

476 
fe_out_poš‹r
 << 
lše
 + "\n";

477 if(
found
 !ğ
¡d
::
¡ršg
::
Åos
)

479 
found
 = 
lše
.
	`fšd
("//");

480 if(
found
 !ğ
¡d
::
¡ršg
::
Åos
)

482 
	`g‘lše
(
f
, 
£¬ch_çmy_şass
, '%'))

484 if(
£¬ch_çmy_şass
[0] == ' ' || search_family_class[0] == '>' || search_family_class[3] == '/')

487 
¡ršg¡»am
 
	`f1
(
£¬ch_çmy_şass
);

488 
Ën
 = 0;

489 
sub_şass
.
	`ş—r
();

490 
	`g‘lše
(
f1
, 
£¬ch_çmy_şass
, ':'))

492 if(
Ën
 == 0)

494 
çmy_şass
 = 
£¬ch_çmy_şass
;

495 
Ën
 ++;

498 
sub_şass
.
	`push_back
(
£¬ch_çmy_şass
);

501 
couÁ
 = 0 ; couÁ < 
MAX_FAMILY_CLASS
; count ++)

503 
found
 = 0;

504 if(
çmy_şass
 =ğ
FAMILY_CLASSES
[
couÁ
])

506 
found
 = 1;

510 if((
found
 =ğ0è|| (
	`FamyCÏssExsi¡
(
çmy_şass
)) != 1 )

513 
size_t
 
šdex
 = 0;

516 if(
mod–_šput
.
	`Ëngth
() > 0)

518 if(
mod–_šput_‹ch_şass
 !ğ
çmy_şass
)

522 
m©ches
 = 
	`C»©eFamyCÏssM©ch
(
mod–_diù
, 
çmy_şass
);

523 if(
m©ches
.
	`size
() > 0)

525 
¡ršg
 
mod–_Çme
 = 
çmy_şass
;

526 
¡ršg
 
ÜigÇl_mod–_Çme
 = 
mod–_Çme
;

528 
šd’t1
 = "";

529 
šd’t2
 = "";

530 
¡ršg
 
d©a
 = " ";

531 
v¬
ğ0; v¬ <
lše
.
	`Ëngth
(); var ++)

533 if(
lše
[
v¬
] == '/')

535 
šd’t1
 +ğ
d©a
;

537 
šd’t2
 = 
šd’t1
 + " ";

540 
fe_out_poš‹r
 << 
šd’t1
 + "{\n";

542 if(
mod–_Çme
.
	`Ëngth
() > 31)

543 
	`ShÜtMod–L’gth
(
mod–_Çme
);

545 ià(
mod–_Çme
.
	`Ëngth
() > 31)

547 
šdex
 = 
mod–_Çme
.
	`fšd
("series");

548 if(
šdex
 !ğ
¡ršg
::
Åos
)

550 
mod–_Çme
.
	`»¶aû
(
šdex
, 6, "Ser.");

551 
šdex
 = 
mod–_Çme
.
	`fšd
(" ");

552 if(
šdex
 !ğ
¡ršg
::
Åos
)

553 
mod–_Çme
.
	`»¶aû
(
šdex
, 2, " ");

557 ià(
mod–_Çme
.
	`Ëngth
() > 31)

559 
šdex
 = 
mod–_Çme
.
	`fšd
("ser.");

560 if(
šdex
 !ğ
¡ršg
::
Åos
)

562 
mod–_Çme
.
	`»¶aû
(
šdex
, 4, "");

563 
šdex
 = 
mod–_Çme
.
	`fšd
(" ");

564 if(
šdex
 !ğ
¡ršg
::
Åos
)

565 
mod–_Çme
.
	`»¶aû
(
šdex
, 2, " ");

568 ià(
mod–_Çme
.
	`Ëngth
() > 31)

569 
mod–_Çme
.
	`assign
(model_name, 0, 31);

571 
fe_out_poš‹r
 << 
šd’t2
 + "ModelName \"";

572 
fe_out_poš‹r
 << 
ÜigÇl_mod–_Çme
;

573 
fe_out_poš‹r
 << "\"\n";

574 
wr™e_d©a
 = "";

575 
wr™e_d©a
 +ğ
šd’t2
 + "A‰ribu‹ "+ "\"NickName\" \"\" \"" + 
ÜigÇl_mod–_Çme
 + ", " + "hpcups "+ "$Version\""+ "\n";

576 
fe_out_poš‹r
 << 
wr™e_d©a
;

592 
wr™e_d©a
 = "";

594 
wr™e_d©a
 +ğ
šd’t2
 + "A‰ribu‹ \"ShÜtNickName\" \"\" " + "\"" + 
mod–_Çme
 + "\"" + "\n";

595 
fe_out_poš‹r
 << 
wr™e_d©a
;

597 
¡ršg
 
çm_¡r
 = 
çmy_şass
;

598 
¡ršg
 
çm_¡r_2
 = 
çmy_şass
;

599 (
šdex
 = 
çm_¡r
.
	`fšd
("_")è!ğ
¡ršg
::
Åos
)

600 
çm_¡r
.
	`»¶aû
(
šdex
, 1, " ");

602 
	`ŒªsfÜm
(
çm_¡r_2
.
	`begš
(), fam_¡r_2.
	`’d
(), fam_¡r_2.begš(),::
tŞow”
);

603 
¡ršg
 
devid
 = "";

605 ià((
šdex
 = 
çm_¡r_2
.
	`fšd
("Ï£rj‘")è!ğ
¡ršg
::
Åos
 || (index = famil_str_2.find("designjet")) != string::npos)

606 
devid
 +ğ"MFG:HewË‰-Pack¬d;MDL:" + 
çm_¡r
 + ";DES:" + famil_str + ";" ;

608 
devid
 +ğ"MFG:HP;MDL:" + 
çm_¡r
 +";DES:" + famil_str +";";

610 
wr™e_d©a
 = "";

611 
wr™e_d©a
 +ğ
šd’t2
 + "A‰ribu‹ \"1284DeviûID\" \"\" \"" + 
devid
 + "\"\n";

612 
fe_out_poš‹r
 << 
wr™e_d©a
;

614 if(
çmy_şass
 !ğ
POST_SCRIPT
)

616 
wr™e_d©a
 = "";

617 
wr™e_d©a
 +ğ
šd’t2
+"PCFeNam\"" + 
	`FixFeName
(
çmy_şass
) +".ppd\"\n";

618 
fe_out_poš‹r
 << 
wr™e_d©a
;

621 ià(
çmy_şass
 =ğ
PDF
)

623 
wr™e_d©a
 = "";

624 
wr™e_d©a
 +ğ
šd’t2
+"PCFeNam\""+ 
	`FixFeName
(
çmy_şass
) + "-pdf.ppd\"\n";

625 
fe_out_poš‹r
 << 
wr™e_d©a
;

630 
wr™e_d©a
 = "";

631 
wr™e_d©a
 +=
šd’t2
+"PCFeNam\""+ 
	`FixFeName
(
çmy_şass
) + "-ps.ppd\"\n";

632 
fe_out_poš‹r
 << 
wr™e_d©a
;

634 
wr™e_d©a
 = "";

635 
wr™e_d©a
 +=
šd’t2
+"A‰ribu‹ \"Produù\" \"\" \"("+ 
çmy_şass
 + ")\"\n";

636 
fe_out_poš‹r
 << 
wr™e_d©a
;

638 
fe_out_poš‹r
 << 
šd’t1
 + "}\n";

643 
m©ches
.
	`ş—r
();

650 
fe_out_poš‹r
.
	`şo£
();

651 
fe_š_poš‹r
.
	`şo£
();

653 if(
m©ches
.
	`size
() >= 1) ;

654 
m©ches
.
	`ş—r
();

656 
	}
}

669 
	$C»©eTechCÏssDrv
(
DRV_DATA
 
drv_d©a
, 
MODEL_DICT_MAP
 
mod–_diù
, 
STRING_PAIR
 
‹ch_şass_mod–
, 
¡ršg
 
mod–_šput
, sŒšg 
mod–_šput_‹ch_şass
, sŒšg 
mod–_šput_sub_şass
, 
boŞ
 
bHpijs
)

672 
¡ršg
 
‹ch_şass
 = "",

673 
lše
 = "",

674 
subşass
 = "";

676 
STRING_VECTOR
 
sub_şass
, 
m©ches
;

677 
f¡»am
 
fe_š_poš‹r
, 
fe_out_poš‹r
;

679 
fe_š_poš‹r
.
	`İ’
(
drv_d©a
.
drv_š_‹m¶©e
.
	`c_¡r
(), 
f¡»am
::
š
);

680 if(!
fe_š_poš‹r
)

682 
cout
<< "DAT2DRV : FAILED IN maš (šˆ¬gc, ch¬ **¬gvè-> UNABLE TO OPEN A FILE FOR READ"<<
’dl
;

685 
fe_out_poš‹r
.
	`İ’
(
drv_d©a
.
drv_š
.
	`c_¡r
(), 
f¡»am
::
out
);

686 if(!
fe_out_poš‹r
)

688 
cout
<< "DAT2DRV : FAILED IN maš (šˆ¬gc, ch¬ **¬gvè-> UNABLE TO OPEN A FILE FOR READ"<<
’dl
;

691 (
	`g‘lše
(
fe_š_poš‹r
, 
lše
)))

693 
size_t
 
found
 = 
lše
.
	`fšd
("%");

694 
size_t
 
šdex
 = 0;

695 
¡ršg
 
£¬ch_‹ch_şass
;

696 
¡ršg¡»am
 
	`f
(
lše
);

697 
fe_out_poš‹r
 << 
lše
 + "\n";

698 if(
found
 !ğ
¡d
::
¡ršg
::
Åos
)

701 
found
 = 
lše
.
	`fšd
("//");

702 if(
found
 !ğ
¡d
::
¡ršg
::
Åos
)

704 
	`g‘lše
(
f
, 
£¬ch_‹ch_şass
, '%'))

706 if(
£¬ch_‹ch_şass
[0] == ' ' || search_tech_class[0] == '>' || search_tech_class[3] == '/')

708 
¡ršg¡»am
 
	`f1
(
£¬ch_‹ch_şass
);

709 
Ën
 = 0;

710 
sub_şass
.
	`ş—r
();

711 
	`g‘lše
(
f1
, 
£¬ch_‹ch_şass
, ':'))

713 if(
Ën
 == 0)

715 
‹ch_şass
 = 
£¬ch_‹ch_şass
;

716 
Ën
 ++;

719 
sub_şass
.
	`push_back
(
£¬ch_‹ch_şass
);

721 if((
	`TechCÏssExsi¡
(
‹ch_şass
)) != 1)

723 if((
	`SubCÏssExsi¡
(
sub_şass
)) != 1)

725 if(
sub_şass
.
	`size
() > 1)

726 
subşass
 = 
	`S‘SubCÏss
(
sub_şass
);

729 
subşass
 = 
sub_şass
[0];

731 if(
mod–_šput
.
	`Ëngth
() > 0)

733 if(
mod–_šput_‹ch_şass
 !ğ
‹ch_şass
)

735 
sub_şass
.
	`ş—r
();

736 
subşass
 = "";

739 if(
mod–_šput_sub_şass
 !ğ
subşass
)

741 
sub_şass
.
	`ş—r
();

745 
STRING_VECTOR
 
subşas£s
;

746 
¡ršg
 
sub_şas
 = "";

747 
Ën
 = 0;

748 
subşass
 = 
mod–_šput_sub_şass
;

749 (
found
 = 
mod–_šput_sub_şass
.
	`fšd
(",")è!ğ
¡ršg
::
Åos
)

751 
sub_şas
.
	`assign
(
mod–_šput_sub_şass
, 
Ën
, 
found
);

752 
Ën
 = 
found
;

753 
mod–_šput_sub_şass
.
	`assign
(mod–_šput_sub_şass, 
found
 + 1, mod–_šput_sub_şass.
	`Ëngth
());

754 
subşas£s
.
	`push_back
(
sub_şas
);

756 
subşas£s
.
	`push_back
(
mod–_šput_sub_şass
);

757 
sub_şass
.
	`ş—r
();

758 
sub_şass
 = 
subşas£s
;

759 
mod–_šput_sub_şass
 = 
subşass
 ;

760 if(
subşas£s
.
	`size
() < 1)

762 
subşas£s
.
	`ş—r
();

765 
m©ches
 = 
	`C»©eTechCÏssM©ch
(
mod–_diù
, 
sub_şass
, 
subşass
, 
‹ch_şass
);

766 if(
m©ches
.
	`size
() > 0)

768 
couÁ”
 = 0;

769 
¡ršg
 
mod–_Çme
 = "";

770 
¡ršg
 
ÜigÇl_mod–_Çme
 = "";

771 
šd’t1
 = "";

772 
šd’t2
 = "";

773 
¡ršg
 
d©a
 = " ";

774 
v¬
ğ0; v¬ <
lše
.
	`Ëngth
(); var ++)

776 if(
lše
[
v¬
] == '/')

778 
šd’t1
 +ğ
d©a
;

780 
šd’t2
 = 
šd’t1
 + " ";

781 
Ën
 = 0;†’ < 
m©ches
.
	`size
();†en ++)

783 
fe_out_poš‹r
 << 
šd’t1
 + "{\n";

784 
mod–_Çme
 = 
mod–_diù
.
	`©
(
m©ches
[
Ën
]).
s_nÜm®_mod–_Çme
;

785 if(
bHpijs
)

787 
mod–_Çme
.
	`­³nd
(" hpijs");

789 
ÜigÇl_mod–_Çme
 = 
mod–_Çme
;

790 if(
mod–_Çme
.
	`Ëngth
() > 31)

791 
	`ShÜtMod–L’gth
(
mod–_Çme
);

793 ià(
mod–_Çme
.
	`Ëngth
() > 31)

795 
šdex
 = 
mod–_Çme
.
	`fšd
("series");

796 if(
šdex
 !ğ
¡ršg
::
Åos
)

798 
mod–_Çme
.
	`»¶aû
(
šdex
, 6, "Ser.");

799 
šdex
 = 
mod–_Çme
.
	`fšd
(" ");

800 if(
šdex
 !ğ
¡ršg
::
Åos
)

801 
mod–_Çme
.
	`»¶aû
(
šdex
, 2, " ");

805 ià(
mod–_Çme
.
	`Ëngth
() > 31)

807 
šdex
 = 
mod–_Çme
.
	`fšd
("ser.");

808 if(
šdex
 !ğ
¡ršg
::
Åos
)

810 
mod–_Çme
.
	`»¶aû
(
šdex
, 4, "");

811 
šdex
 = 
mod–_Çme
.
	`fšd
(" ");

812 if(
šdex
 !ğ
¡ršg
::
Åos
)

813 
mod–_Çme
.
	`»¶aû
(
šdex
, 2, " ");

816 ià(
mod–_Çme
.
	`Ëngth
() > 31)

817 
mod–_Çme
.
	`assign
(
m©ches
[
Ën
], 0, 31);

819 
fe_out_poš‹r
 << 
šd’t2
 + "ModelName \"";

820 
fe_out_poš‹r
 << 
ÜigÇl_mod–_Çme
;

821 
fe_out_poš‹r
 << "\"\n";

822 
šdex
 = 
mod–_diù
.
	`©
(
m©ches
[
Ën
]).
s_‹ch_şass
.
	`fšd
(",");

824 if(
šdex
 !ğ
¡ršg
::
Åos
)

826 
wr™e_d©a
 = "";

827 if(!
bHpijs
)

828 
wr™e_d©a
 +ğ
šd’t2
+"A‰ribu‹ "+ "\"NickName\" \"\" \"" + 
ÜigÇl_mod–_Çme
 + " " + 
‹ch_şass_mod–
.
	`©
(
‹ch_şass
) + ", " + "hpcups "+ "$Version";

830 
wr™e_d©a
 +ğ
šd’t2
+"A‰ribu‹ "+ "\"NickName\" \"\" \"" + 
ÜigÇl_mod–_Çme
 + " " + 
‹ch_şass_mod–
.
	`©
(
‹ch_şass
) + ", " + "$Version";

831 
fe_out_poš‹r
 << 
wr™e_d©a
;

836 
wr™e_d©a
 = "";

837 if(!
bHpijs
)

838 
wr™e_d©a
 +=
šd’t2
+"A‰ribu‹ "+ "\"NickName\" \"\" \"" + 
ÜigÇl_mod–_Çme
 + ", " + "hpcups "+ "$Version";

840 
wr™e_d©a
 +=
šd’t2
+"A‰ribu‹ "+ "\"NickName\" \"\" \"" + 
ÜigÇl_mod–_Çme
 + ", " + "$Version";

841 
fe_out_poš‹r
 << 
wr™e_d©a
;

843 if(
mod–_diù
.
	`©
(
m©ches
[
Ën
]).
s_¶ugš
 == 1 || model_dict.at(matches[len]).s_plugin == 2)

845 if((
mod–_diù
.
	`©
(
m©ches
[
Ën
]).
s_¶ugš_»asÚ
 & 15) == 1

846 || (
mod–_diù
.
	`©
(
m©ches
[
Ën
]).
s_¶ugš_»asÚ
 & 15) == 2

847 || (
mod–_diù
.
	`©
(
m©ches
[
Ën
]).
s_¶ugš_»asÚ
 & 15) == 3

848 || (
mod–_diù
.
	`©
(
m©ches
[
Ën
]).
s_¶ugš_»asÚ
 & 15) == 4

849 || (
mod–_diù
.
	`©
(
m©ches
[
Ën
]).
s_¶ugš_»asÚ
 & 15) == 5

850 || (
mod–_diù
.
	`©
(
m©ches
[
Ën
]).
s_¶ugš_»asÚ
 & 15) == 6

851 || (
mod–_diù
.
	`©
(
m©ches
[
Ën
]).
s_¶ugš_»asÚ
 & 15) == 8

852 || (
mod–_diù
.
	`©
(
m©ches
[
Ën
]).
s_¶ugš_»asÚ
 & 15) == 9

853 || (
mod–_diù
.
	`©
(
m©ches
[
Ën
]).
s_¶ugš_»asÚ
 & 15) == 10

854 || (
mod–_diù
.
	`©
(
m©ches
[
Ën
]).
s_¶ugš_»asÚ
 & 15) == 12 )

855 
fe_out_poš‹r
 << ",„equires…roprietary…lugin";

857 
fe_out_poš‹r
 <<"\"\n";

858 
wr™e_d©a
 = "";

859 if(
bHpijs
)

860 
wr™e_d©a
 +ğ
šd’t2
 + "A‰ribu‹ \"ShÜtNickName\" \"\" " + "\"" + 
mod–_Çme
 + "\"" + "\n";

863 
¡ršg
 
wr™e_d©a1
= "";

864 
wr™e_d©a1
 = 
mod–_Çme
 + " hpijs";

865 if(
wr™e_d©a1
.
	`Ëngth
() > 31)

867 
	`ShÜtMod–L’gth
(
wr™e_d©a1
);

869 
wr™e_d©a
 +ğ
šd’t2
 + "A‰ribu‹ \"ShÜtNickName\" \"\" " + "\"" + 
wr™e_d©a1
 + "\"" + "\n";

871 
fe_out_poš‹r
 << 
wr™e_d©a
;

873 
¡ršg
 
µ
 = 
m©ches
[
Ën
];

874 
¡ršg
 
p
 = 
m©ches
[
Ën
];

875 (
šdex
 = 
µ
.
	`fšd
("_")è!ğ
¡ršg
::
Åos
)

876 
µ
.
	`»¶aû
(
šdex
, 1, " ");

878 
	`ŒªsfÜm
(
p
.
	`begš
(),….
	`’d
(),….begš(),::
tŞow”
);

879 
¡ršg
 
devid
 = "";

880 if((
šdex
 = 
p
.
	`fšd
("­Şlo")è!ğ
¡ršg
::
Åos
)

881 
devid
 +ğ"MFG:ApŞlo;MDL:" + 
µ
 +";DES:" +…p + ";";

883 ià((
šdex
 = 
p
.
	`fšd
("Ï£rj‘")è!ğ
¡ršg
::
Åos
 || (index =….find("designjet")) != string::npos)

884 
devid
 +ğ"MFG:HewË‰-Pack¬d;MDL:" + 
µ
 + ";DES:" +…p + ";" ;

886 
devid
 +ğ"MFG:HP;MDL:" + 
µ
 +";DES:" +…p +";";

888 
wr™e_d©a
 = "";

889 
wr™e_d©a
 +ğ
šd’t2
 + "A‰ribu‹ \"1284DeviûID\" \"\" \"" + 
devid
 + "\"\n";

890 
fe_out_poš‹r
 << 
wr™e_d©a
;

892 
šdex
 = 
mod–_diù
.
	`©
(
m©ches
[
Ën
]).
s_‹ch_şass
.
	`fšd
(",");

893 if(
šdex
 !ğ
¡ršg
::
Åos
)

895 
wr™e_d©a
 = "";

896 ià(!
bHpijs
){

897 
wr™e_d©a
 +=
šd’t2
+"PCFeNam\""+ 
	`FixFeName
(
m©ches
[
Ën
]è+ "-" + 
‹ch_şass_mod–
.
	`©
(
‹ch_şass
) + ".ppd\"\n";

900 
wr™e_d©a
 +=
šd’t2
+"PCFeNam\""+ 
	`FixFeName
(
m©ches
[
Ën
]è+ "-" + 
‹ch_şass_mod–
.
	`©
(
‹ch_şass
) + "-hpijs"+".ppd\"\n";

902 
fe_out_poš‹r
 << 
wr™e_d©a
;

904 if(
‹ch_şass
 !ğ
POST_SCRIPT
)

906 
wr™e_d©a
 = "";

907 ià(!
bHpijs
)

908 
wr™e_d©a
 +=
šd’t2
+"PCFeNam\""+ 
	`FixFeName
(
m©ches
[
Ën
]) +".ppd\"\n";

910 
wr™e_d©a
 +=
šd’t2
+"PCFeNam\""+ 
	`FixFeName
(
m©ches
[
Ën
]) + "-hpijs" + ".ppd\"\n";

911 
fe_out_poš‹r
 << 
wr™e_d©a
;

914 ià(
‹ch_şass
 =ğ
PDF
)

916 
wr™e_d©a
 = "";

917 ià(!
bHpijs
)

918 
wr™e_d©a
 +=
šd’t2
+"PCFeNam\""+ 
	`FixFeName
(
m©ches
[
Ën
]) + "-pdf.ppd\"\n";

920 
wr™e_d©a
 +=
šd’t2
+"PCFeNam\""+ 
	`FixFeName
(
m©ches
[
Ën
]) + "-hpijs" + "-pdf.ppd\"\n";

921 
fe_out_poš‹r
 << 
wr™e_d©a
;

925 
wr™e_d©a
 = "";

926 ià(!
bHpijs
)

927 
wr™e_d©a
 +=
šd’t2
+"PCFeNam\""+ 
	`FixFeName
(
m©ches
[
Ën
]) + "-ps.ppd\"\n";

929 
wr™e_d©a
 +=
šd’t2
+"PCFeNam\""+ 
	`FixFeName
(
m©ches
[
Ën
]) + "-hpijs" + "-ps.ppd\"\n";

930 
fe_out_poš‹r
 << 
wr™e_d©a
;

932 
couÁ
 = 0; couÁ < 
mod–_diù
.
	`©
(
m©ches
[
Ën
]).
mod–_v¬ŸÁs
.
	`size
(); count ++)

934 
wr™e_d©a
 = "";

935 
	`NÜamlizeModeV¬ŸÁlName
(
mod–_diù
.
	`©
(
m©ches
[
Ën
]).
mod–_v¬ŸÁs
[
couÁ
]);

936 
wr™e_d©a
 +=
šd’t2
+"A‰ribu‹ \"Produù\" \"\" \"("+ 
mod–_diù
.
	`©
(
m©ches
[
Ën
]).
mod–_v¬ŸÁs
[
couÁ
] + ")\"\n";

937 
fe_out_poš‹r
 << 
wr™e_d©a
;

939 
fe_out_poš‹r
 << 
šd’t1
 + "}\n";

946 
m©ches
.
	`ş—r
();

947 
sub_şass
.
	`ş—r
();

952 
fe_out_poš‹r
.
	`şo£
();

953 
fe_š_poš‹r
.
	`şo£
();

954 if(
sub_şass
.
	`size
() >= 1)

955 
sub_şass
.
	`ş—r
();

956 if(
m©ches
.
	`size
() >= 1) ;

957 
m©ches
.
	`ş—r
();

959 
	}
}

969 
	$maš
 (
¬gc
, **
¬gv
)

971 
çmy_ty³
 = 0,

972 
šşude
 = 0;

973 
DRV_DATA
 
drv_d©a
;

974 
DRV_DATA
 
drv_d©a_ijs
;

975 
¡ršg
 
mod–_šput
 = "",

976 
mod–_šput_‹ch_şass
 = "",

977 
mod–_šput_sub_şass
 = "";

979 
¡ršg
 
mod–_šput_ijs
 = "",

980 
mod–_šput_‹ch_şass_ijs
 = "",

981 
mod–_šput_sub_şass_ijs
 = "";

985 ià(
¬gc
 < 1 ||‡rgc > 3)

987 
cout
<< "d©2drv‚umb” oà¬gum’ˆ·s£d‡» inv®id" <<
’dl
;

992 
	`In™DrvD©a
(
drv_d©a
);

993 
	`In™DrvD©a
(
drv_d©a_ijs
);

996 
drv_d©a
 = 
	`S‘FeInfo
(0);

997 
drv_d©a_ijs
 = 
	`S‘FeInfo
(1);

1000 
MODEL_DICT_MAP
 
mod–_diù
 = 
	`C»©eMod–Diù
(
drv_d©a
);

1001 
MODEL_DICT_MAP
 
mod–_diù_ijs
 = 
	`C»©eMod–Diù
(
drv_d©a_ijs
);

1005 
	`NÜamlizeMod–Name
(
mod–_diù
);

1006 
	`NÜamlizeMod–Name
(
mod–_diù_ijs
);

1008 
couÁ
 = 0; couÁ < 
¬gc
; count ++)

1010 
size_t
 
pos™iÚ
 = 0;

1011 
¡ršg
 
¬gum’t
 = 
¬gv
[
couÁ
];

1014 if((
¬gum’t
.
	`fšd
("-f")è!ğ
¡d
::
¡ršg
::
Åos
)

1015 
çmy_ty³
 = 1;

1018 if((
¬gum’t
.
	`fšd
("--m=")è!ğ
¡d
::
¡ršg
::
Åos
)

1020 
¬gum’t
.
	`assign
×rgum’t, 4,‡rgum’t.
	`Ëngth
());

1022 if((
	`CheckMod–NameExsi¡
(
¬gum’t
, 
mod–_diù
)) != 1)

1024 
cout
<< "ERROR : d©2drv Inv®id Mod– NamPas£d"<<
’dl
;

1028 
MODEL_DICT_MAP
::
™”©Ü
 
™
=
mod–_diù
.
	`begš
();

1029 if(
çmy_ty³
 == 1)

1030 
mod–_šput_‹ch_şass
 = 
™
->
£cÚd
.
s_çmy_şass
;

1033 
mod–_šput_‹ch_şass
 = 
™
->
£cÚd
.
s_‹ch_şass
;

1034 
mod–_šput_sub_şass
 = 
™
->
£cÚd
.
s_sub_şass
;

1036 
mod–_šput
 = 
¬gum’t
;

1039 if((
¬gum’t
.
	`fšd
("-h")è!ğ
¡d
::
¡ršg
::
Åos
 || (argument.find("--help")) != std::string::npos)

1041 
cout
 <<"./d©drv [-f] [--m=mod–_Çme]"<< 
’dl
;

1042 
cout
 <<" -f : c»©çmy cÏs µd's"<< 
’dl
;

1043 
cout
 <<" --m=<mod–‚ame> : mod–‚amfÜhdeviû"<< 
’dl
;

1044 
cout
 <<"EXAMPLE :"<< 
’dl
;

1045 
cout
 <<" ./d©drv : c»©disü“ˆµd' fÜ‡Î deviûs"<< 
’dl
;

1046 
cout
 <<" ./d©drv --m=<mod–‚ame> : c»©disü“ˆµd fÜ s³cif›d mod–"<< 
’dl
;

1047 
cout
 <<" ./d©drv -f : c»©çmy ba£d…pd' fÜ‡Î deviûs"<< 
’dl
;

1048 
cout
 <<" ./d©drv -à--m=<mod–‚ame> : c»©çmy ba£d…pd fÜ s³cif›d mod–"<< 
’dl
;

1053 if(
çmy_ty³
 =ğ0 && 
mod–_šput
.
	`Ëngth
(è=ğ0 && 
¬gc
 != 1)

1055 
cout
<< "d©2drv‚umb” oà¬gum’ˆ·s£d‡» inv®id" <<
’dl
;

1060 if(
çmy_ty³
 == 0)

1063 
STRING_PAIR
 
‹ch_şass_mod–
 = 
	`TechCÏssPdls
();

1064 
	`C»©eTechCÏssDrv
(
drv_d©a
,

1065 
mod–_diù
,

1066 
‹ch_şass_mod–
,

1067 
mod–_šput
,

1068 
mod–_šput_‹ch_şass
,

1069 
mod–_šput_sub_şass
, 0);

1072 
STRING_PAIR
 
‹ch_şass_mod–_ijs
 = 
	`TechCÏssPdls
();

1073 
	`C»©eTechCÏssDrv
(
drv_d©a_ijs
,

1074 
mod–_diù_ijs
,

1075 
‹ch_şass_mod–_ijs
,

1076 
mod–_šput_ijs
,

1077 
mod–_šput_‹ch_şass_ijs
,

1078 
mod–_šput_sub_şass_ijs
, 1);

1081 
	`C»©eFamyCÏssDrv
(
drv_d©a
, 
mod–_diù
, 
mod–_šput
, 
mod–_šput_‹ch_şass
);

1083 
mod–_diù
.
	`ş—r
();

1085 
	}
}

	@Dat2drv.h

1 #iâdeà
DATDRV_H


2 
	#DATDRV_H


	)

4 
	~"NÜm®ize.h
"

6 
	#MAX_DRV_COUNT
 2

	)

7 
	#MAX_DIRECTORY_SIZE
 1024

	)

9 
	#COLOR
 "CŞÜ"

	)

10 
	#COLOR_LASERJET
 "cŞÜ†a£rj‘"

	)

11 
	#LASERJET
 "Ï£rj‘"

	)

12 
	#LASERJET_CAP
 "La£rJ‘"

	)

13 
	#PHOTOSMART
 "phÙosm¬t"

	)

14 
	#PHOTOSMART_CAP
 "PhÙosm¬t"

	)

15 
	#DESKJET
 "deskj‘"

	)

16 
	#DESKJET_CAP
 "Deskj‘"

	)

17 
	#COLOR_INKJET_PRINTER
 "cŞÜ inkj‘…rš‹r"

	)

18 
	#OFFICEJET
 "offiûj‘"

	)

19 
	#OFFICEJET_CA
 "Offiûj‘"

	)

20 
	#BUSINESS_INKJET
 "busšes škj‘"

	)

21 
	#DESIGNJET
 "designj‘"

	)

22 
	#PRINTER_SCANNER_COPIER
 "´š‹¸sÿÂ” cİ›r"

	)

23 
	#COLOR_LJ
 "cŞÜ†j"

	)

24 
	#PROFESSIONAL
 "´oãssiÚ®"

	)

25 
	#PROFESSIONAL_CAP
 "ProãssiÚ®"

	)

26 
	#INKJET
 "Inkj‘"

	)

27 
	#WIRELESS
 "Wœ–ess"

	)

28 
	#TANK
 "Tªk"

	)

31 
	#COLOR_REPLACEMENT
 "CL"

	)

32 
	#COLOR_LASERJET_REPLACEMENT
 "CJL"

	)

33 
	#LASERJET_REPLACEMENT
 "LJ"

	)

34 
	#LASERJET_CAP_REPLACEMENT
 "LJ"

	)

35 
	#PHOTOSMART_REPLACEMENT
 "PS"

	)

36 
	#PHOTOSMART_CAP_REPLACEMENT
 "PS"

	)

37 
	#DESKJET_REPLACEMENT
 "DJ"

	)

38 
	#DESKJET_CAP_REPLACEMENT
 "DJ"

	)

39 
	#COLOR_INKJET_PRINTER_REPLACEMENT
 ""

	)

40 
	#OFFICEJET_REPLACEMENT
 "OJ"

	)

41 
	#OFFICEJET_CAP_REPLACEMENT
 "OJ"

	)

42 
	#BUSINESS_INKJET_REPLACEMENT
 "BIJ"

	)

43 
	#DESIGNJET_REPLACEMENT
 "DESIGNJ"

	)

44 
	#PRINTER_SCANNER_COPIER_REPLACEMENT
 "PSC"

	)

45 
	#COLOR_LJ_REPLACEMENT
 "CLJ"

	)

46 
	#PROFESSIONAL_REPLACEMENT
 "Pro"

	)

47 
	#PROFESSIONAL_CAP_REPLACEMENT
 "Pro"

	)

48 
	#INKJET_REPLACEMENT
 "IJ"

	)

49 
	#WIRELESS_REPLACEMENT
 "WL"

	)

50 
	#TANK_REPLACEMENT
 "TK"

	)

52 
	#POST_SCRIPT
 "Po¡süt"

	)

53 
	#PDF
 "PDF"

	)

56 
	#MAX_SHORTENING_REPLACEMENTS
 20

	)

59 
¡ršg
 
FAMILY_CLASSES
[
MAX_FAMILY_CLASS
];

62 
¡ršg
 
TECH_CLASSES
[
MAX_TECH_CLASS
];

65 
¡ršg
 
TECH_SUBCLASSES
[
MAX_SUB_CLASS
];

68 
¡ršg
 
SHORTENING_REPLACEMENTS
[
MAX_SHORTENING_REPLACEMENTS
];

71 
¡ršg
 
SHORTENING_REPLACEMENTS_VALUE
[
MAX_SHORTENING_REPLACEMENTS
];

74 
¡ršg
 
TECH_CLASS_KEYS
[
MAX_TECH_CLASS_PDL
];

77 
¡ršg
 
TECH_CLASS_VALUES
[
MAX_TECH_CLASS_PDL
];

99 
	s_DRV_DATA_


101 
¡ršg
 
	mcu¼’t_·th
;

102 
¡ršg
 
	md©_·th
;

103 
¡ršg
 
	mdrv_dœ
;

104 
¡ršg
 
	mdrv_š_‹m¶©e
;

105 
¡ršg
 
	mdrv_š
;

107 }
	tDRV_DATA
;

110 
¡ršg
 
	gšd’t1
 = "";

111 
¡ršg
 
	gšd’t2
 = "";

113 
¡ršg
 
	gwr™e_d©a
 = "";

123 
In™DrvD©a
(
DRV_DATA
 &
drv_d©a
);

131 
MODEL_DICT_MAP
 
C»©eMod–Diù
(
DRV_DATA
 
drv_v®ue
);

138 
¡ršg
 
FixFeName
(¡ršg 
mod–_Çme
);

145 
ShÜtMod–L’gth
(
¡ršg
 &
mod–_Çme
);

152 
¡ršg
 
S‘SubCÏss
(
STRING_VECTOR
 
sub_şass
);

159 
DRV_DATA
 
S‘FeInfo
();

167 
TechCÏssExsi¡
(
¡ršg
 
‹ch_şass
);

175 
SubCÏssExsi¡
(
STRING_VECTOR
 
sub_şass
);

185 
STRING_VECTOR
 
C»©eTechCÏssM©ch
(
MODEL_DICT_MAP
 
mod–_diù
, STRING_VECTOR 
sub_şass
, 
¡ršg
 
subşass
, sŒšg 
‹ch_şass
);

193 
FamyCÏssExsi¡
(
¡ršg
 
çmy_şass
);

202 
CheckMod–NameExsi¡
(
¡ršg
 
mod–_Çme
, 
MODEL_DICT_MAP
 &
mod–_diù
);

211 
STRING_VECTOR
 
C»©eFamyCÏssM©ch
(
MODEL_DICT_MAP
 
mod–_diù
, 
¡ršg
 
çmy_şass
);

223 
C»©eFamyCÏssDrv
(
DRV_DATA
 
drv_d©a
, 
MODEL_DICT_MAP
 
mod–_diù
, 
¡ršg
 
mod–_šput
, sŒšg 
mod–_šput_‹ch_şass
, sŒšg 
mod–_šput_sub_şass
);

236 
C»©eTechCÏssDrv
(
DRV_DATA
 
drv_d©a
, 
MODEL_DICT_MAP
 
mod–_diù
, 
STRING_PAIR
 
‹ch_şass_mod–
, 
¡ršg
 
mod–_šput
, sŒšg 
mod–_šput_‹ch_şass
, sŒšg 
mod–_šput_sub_şass
, 
boŞ
 
bHpijs
);

	@FindPPD.cpp

1 
	~"FšdPPD.h
"

10 
	$C»©eMod–Diù
(
MODEL_DICT_MAP
 &
mod–_diù
)

12 
couÁ
 = 0;

13 
¡ršg
 
mod–_Çme
 = "",

14 
lše
 = "";

16 
çmy_µd
 = 0;

17 
f¡»am
 
fe_poš‹r
;

18 
fe_poš‹r
.
	`İ’
("/u¤/sh¬e/h¶/d©a/mod–s/mod–s.d©", 
f¡»am
::
š
);

20 if(!
fe_poš‹r
)

22 
	`årštf
(
¡d”r
, "DAT2DRV : FAILED IN CreateModelDict() -> file_pointer = NULL\n");

25 (
	`g‘lše
(
fe_poš‹r
, 
lše
)))

27 if(
lše
[0] == '#')

29 if(
lše
[0] == '[')

31 
lše
.
	`assign
Öše, 1,†še.
	`Ëngth
() -2);

32 
mod–_Çme
 = 
lše
;

36 if((
lše
.
	`fšd
("çmy-µd")è!ğ
¡d
::
¡ršg
::
Åos
)

38 
¡ršg¡»am
 
	`fe_¡»am
(
lše
);

39 
¡ršg
 
v®ue
;

41 
	`g‘lše
(
fe_¡»am
, 
v®ue
, '='))

42 
couÁ
 ++;

43 if(
couÁ
 == 2)

45 
mod–_diù
.
	`š£¹
(
¡d
::
	`make_·œ
(
mod–_Çme
, 
v®ue
));

46 
couÁ
 = 0;

47 
çmy_µd
 = 1;

52 if((
lše
.
	`fšd
("çmy-şass")è!ğ
¡d
::
¡ršg
::
Åos
)

54 
¡ršg¡»am
 
	`fe_¡»am
(
lše
);

55 
¡ršg
 
v®ue
;

57 
	`g‘lše
(
fe_¡»am
, 
v®ue
, '='))

58 
couÁ
 ++;

59 if(
couÁ
 == 2)

61 ià(
çmy_µd
 == 1)

62 
çmy_µd
 = 0;

64 
mod–_diù
.
	`š£¹
(
¡d
::
	`make_·œ
(
mod–_Çme
, 
v®ue
));

65 
couÁ
 = 0;

71 if(
fe_poš‹r
)

72 
fe_poš‹r
.
	`şo£
();

75 
	}
}

84 
	$CheckMod–NameExsi¡
(
¡ršg
 
mod–_Çme
, 
MODEL_DICT_MAP
 &
mod–_diù
)

87 
MODEL_DICT_MAP
::
™”©Ü
 
™
=
mod–_diù
.
	`begš
(); it!=mod–_diù.
	`’d
(); ++it)

89 if(
™
->
fœ¡
 =ğ
mod–_Çme
)

91 
cout
 << "CÏs PPD Nam: "<< 
™
->
£cÚd
<<
’dl
;

96 
	}
}

98 
	$maš
 (
¬gc
, **
¬gv
)

101 
MODEL_DICT_MAP
 
mod–_diù
;

102 
couÁ
 = 0;

104 
	`C»©eMod–Diù
(
mod–_diù
);

105 
couÁ
 = 0; couÁ < 
¬gc
; count ++)

107 
¡ršg
 
¬gum’t
 = 
¬gv
[
couÁ
];

109 if((
¬gum’t
.
	`fšd
("--m=")è!ğ
¡d
::
¡ršg
::
Åos
)

111 
¬gum’t
.
	`assign
×rgum’t, 4,‡rgum’t.
	`Ëngth
());

112 if((
	`CheckMod–NameExsi¡
(
¬gum’t
, 
mod–_diù
)) != 1)

114 
cout
<< "ERROR : hp-loÿ‹driv” Inv®id Mod– NamPas£d"<<
’dl
;

117 
mod–_diù
.
	`ş—r
();

120 if((
¬gum’t
.
	`fšd
("-h")è!ğ
¡d
::
¡ršg
::
Åos
 || (argument.find("--help")) != std::string::npos)

122 
cout
 <<"hp-loÿ‹driv” [--m=mod–_Çme]"<< 
’dl
;

123 
cout
 <<" --m=<mod–‚ame> : mod–‚amfÜhdeviû"<< 
’dl
;

124 
cout
 <<"EXAMPLE :"<< 
’dl
;

125 
cout
 <<" hp-loÿ‹driv” --m=<mod–‚ame> : Fšd cÏs µd oàthmod–‚am·s£d"<< 
’dl
;

126 
mod–_diù
.
	`ş—r
();

131 
cout
<< "ERROR : NØIÅuˆPas£d"<<
’dl
;

132 
mod–_diù
.
	`ş—r
();

134 
	}
}

	@FindPPD.h

1 #iâdeà
FIND_PPD_H


2 
	#FIND_PPD_H


	)

4 
	~<io¡»am
>

5 
	~<¡ršg
>

6 
	~<f¡»am
>

7 
	~<uni¡d.h
>

8 
	~<s¡»am
>

9 
	~<m­
>

11 
usšg
 
Çme¥aû
 
	g¡d
;

15 
	gm­
<
	t¡ršg
, sŒšg> 
	tMODEL_DICT_MAP
;

23 
C»©eMod–Diù
(
MODEL_DICT_MAP
 &
mod–_diù
);

	@Normalize.cpp

1 
	~"NÜm®ize.h
"

4 
¡ršg
 
	gFAMILY_CLASSES
[
MAX_FAMILY_CLASS
] = {"PCL3-Class3A","PCL3-Class3B","PCL3-Class3","PCLM_COLOR","PCLM_MONO","PCL4-Class1","LJ-Class1","LJ-Class2","LJ-Class3","LJ-Class4","LJ-Class4A","LJ-Class5","LJ-Class6","DJGenericVIP","DJ9xxVIP","DJ55xx","Stabler","StingrayOJ","Copperhead","CopperheadXLP","Copperhead12","CopperheadIPH","CopperheadIPH15","CopperheadIPH17","CLE","CLE17","PyramidRefresh17","Saipan","Saipan15B","Kapan","ViperPlusVIP","ViperMinusVIP","Corbett","Ampere","Python","Python10","Python11","Mimas","Mimas15","Mimas17","MimasTDR","PyramidRefresh15","P15_CISS","Pyramid","Pyramid15","PyramidPlus","Gemstone","SPDOfficejetProAsize","SPDOfficejetProBsize","OJ7000","OJProKx50","PSP100","PSP470"};

7 
¡ršg
 
	gTECH_CLASSES
[
MAX_TECH_CLASS
] = {

88 
¡ršg
 
	gTECH_SUBCLASSES
[
MAX_SUB_CLASS
] = {

122 
¡ršg
 
	gSHORTENING_REPLACEMENTS
[
MAX_SHORTENING_REPLACEMENTS
] = {

146 
¡ršg
 
	gSHORTENING_REPLACEMENTS_VALUE
[
MAX_SHORTENING_REPLACEMENTS
] = {

175 
PAIR_VECTOR
 
	$TechCÏssPdlKeySv®ues
()

178 
PAIR_VECTOR
 
TECH_CLASS_KEY_VALUE
;

180 
TECH_CLASS_KEY_VALUE
.
	`push_back
(
	`make_·œ
("Postscript", "ps"));

181 
TECH_CLASS_KEY_VALUE
.
	`push_back
(
	`make_·œ
("PDF", "pdf"));

182 
TECH_CLASS_KEY_VALUE
.
	`push_back
(
	`make_·œ
("DJGenericVIP", "pcl3"));

183 
TECH_CLASS_KEY_VALUE
.
	`push_back
(
	`make_·œ
("LJMono", "pcl3"));

184 
TECH_CLASS_KEY_VALUE
.
	`push_back
(
	`make_·œ
("LJColor", "pcl3"));

185 
TECH_CLASS_KEY_VALUE
.
	`push_back
(
	`make_·œ
("LJFastRaster", "pclxl"));

186 
TECH_CLASS_KEY_VALUE
.
	`push_back
(
	`make_·œ
("LJJetReady", "pclxl"));

187 
TECH_CLASS_KEY_VALUE
.
	`push_back
(
	`make_·œ
("DJ350", "pcl3"));

188 
TECH_CLASS_KEY_VALUE
.
	`push_back
(
	`make_·œ
("DJ540", "pcl3"));

189 
TECH_CLASS_KEY_VALUE
.
	`push_back
(
	`make_·œ
("DJ600", "pcl3"));

190 
TECH_CLASS_KEY_VALUE
.
	`push_back
(
	`make_·œ
("DJ6xx", "pcl3"));

191 
TECH_CLASS_KEY_VALUE
.
	`push_back
(
	`make_·œ
("DJ6xxPhoto", "pcl3"));

192 
TECH_CLASS_KEY_VALUE
.
	`push_back
(
	`make_·œ
("DJ630", "pcl3"));

193 
TECH_CLASS_KEY_VALUE
.
	`push_back
(
	`make_·œ
("DJ8xx", "pcl3"));

194 
TECH_CLASS_KEY_VALUE
.
	`push_back
(
	`make_·œ
("DJ8x5", "pcl3"));

195 
TECH_CLASS_KEY_VALUE
.
	`push_back
(
	`make_·œ
("DJ850", "pcl3"));

196 
TECH_CLASS_KEY_VALUE
.
	`push_back
(
	`make_·œ
("DJ890", "pcl3"));

197 
TECH_CLASS_KEY_VALUE
.
	`push_back
(
	`make_·œ
("DJ9xx", "pcl3"));

198 
TECH_CLASS_KEY_VALUE
.
	`push_back
(
	`make_·œ
("DJ9xxVIP", "pcl3"));

199 
TECH_CLASS_KEY_VALUE
.
	`push_back
(
	`make_·œ
("DJ3600", "lidil"));

200 
TECH_CLASS_KEY_VALUE
.
	`push_back
(
	`make_·œ
("DJ3320", "lidil"));

201 
TECH_CLASS_KEY_VALUE
.
	`push_back
(
	`make_·œ
("DJ4100", "lidil"));

202 
TECH_CLASS_KEY_VALUE
.
	`push_back
(
	`make_·œ
("AP2xxx", "pcl3"));

203 
TECH_CLASS_KEY_VALUE
.
	`push_back
(
	`make_·œ
("AP21xx", "pcl3"));

204 
TECH_CLASS_KEY_VALUE
.
	`push_back
(
	`make_·œ
("AP2560", "pcl3"));

205 
TECH_CLASS_KEY_VALUE
.
	`push_back
(
	`make_·œ
("PSP100", "pcl3"));

206 
TECH_CLASS_KEY_VALUE
.
	`push_back
(
	`make_·œ
("PSP470", "pcl3"));

207 
TECH_CLASS_KEY_VALUE
.
	`push_back
(
	`make_·œ
("LJZjsMono", "zjs"));

208 
TECH_CLASS_KEY_VALUE
.
	`push_back
(
	`make_·œ
("LJZjsColor", "zjs"));

209 
TECH_CLASS_KEY_VALUE
.
	`push_back
(
	`make_·œ
("LJm1005", "zxs"));

210 
TECH_CLASS_KEY_VALUE
.
	`push_back
(
	`make_·œ
("QuickConnect", "jpeg"));

211 
TECH_CLASS_KEY_VALUE
.
	`push_back
(
	`make_·œ
("DJ55xx", "pcl3"));

212 
TECH_CLASS_KEY_VALUE
.
	`push_back
(
	`make_·œ
("OJProKx50", "pcl3"));

213 
TECH_CLASS_KEY_VALUE
.
	`push_back
(
	`make_·œ
("LJP1XXX", "zxs"));

214 
TECH_CLASS_KEY_VALUE
.
	`push_back
(
	`make_·œ
("Stabler", "pcl3"));

215 
TECH_CLASS_KEY_VALUE
.
	`push_back
(
	`make_·œ
("ViperPlusVIP", "pcl3"));

216 
TECH_CLASS_KEY_VALUE
.
	`push_back
(
	`make_·œ
("ViperMinusVIP", "pcl3"));

217 
TECH_CLASS_KEY_VALUE
.
	`push_back
(
	`make_·œ
("ViperPlusTrim", "lidil"));

218 
TECH_CLASS_KEY_VALUE
.
	`push_back
(
	`make_·œ
("ViperMinusTrim", "lidil"));

219 
TECH_CLASS_KEY_VALUE
.
	`push_back
(
	`make_·œ
("Corbett", "pcl3"));

220 
TECH_CLASS_KEY_VALUE
.
	`push_back
(
	`make_·œ
("Python", "pcl3"));

221 
TECH_CLASS_KEY_VALUE
.
	`push_back
(
	`make_·œ
("OJ7000", "pcl3"));

222 
TECH_CLASS_KEY_VALUE
.
	`push_back
(
	`make_·œ
("Python10", "pcl3"));

223 
TECH_CLASS_KEY_VALUE
.
	`push_back
(
	`make_·œ
("Mimas", "pcl3"));

224 
TECH_CLASS_KEY_VALUE
.
	`push_back
(
	`make_·œ
("Mimas15", "pcl3"));

225 
TECH_CLASS_KEY_VALUE
.
	`push_back
(
	`make_·œ
("StingrayOJ", "pcl3"));

226 
TECH_CLASS_KEY_VALUE
.
	`push_back
(
	`make_·œ
("Pyramid15", "pcl3"));

227 
TECH_CLASS_KEY_VALUE
.
	`push_back
(
	`make_·œ
("Copperhead", "pcl3"));

228 
TECH_CLASS_KEY_VALUE
.
	`push_back
(
	`make_·œ
("CopperheadXLP", "pcl3"));

229 
TECH_CLASS_KEY_VALUE
.
	`push_back
(
	`make_·œ
("Copperhead12", "pcl3"));

230 
TECH_CLASS_KEY_VALUE
.
	`push_back
(
	`make_·œ
("CopperheadIPH", "pcl3"));

231 
TECH_CLASS_KEY_VALUE
.
	`push_back
(
	`make_·œ
("CopperheadIPH15", "pcl3"));

232 
TECH_CLASS_KEY_VALUE
.
	`push_back
(
	`make_·œ
("CopperheadIPH17", "pcl3"));

233 
TECH_CLASS_KEY_VALUE
.
	`push_back
(
	`make_·œ
("PyramidRefresh15", "pcl3"));

234 
TECH_CLASS_KEY_VALUE
.
	`push_back
(
	`make_·œ
("PyramidRefresh17", "pcl3"));

235 
TECH_CLASS_KEY_VALUE
.
	`push_back
(
	`make_·œ
("Ampere", "pcl3"));

236 
TECH_CLASS_KEY_VALUE
.
	`push_back
(
	`make_·œ
("Hbpl1", "hbpl1"));

237 
TECH_CLASS_KEY_VALUE
.
	`push_back
(
	`make_·œ
("Kapan", "pcl3"));

238 
TECH_CLASS_KEY_VALUE
.
	`push_back
(
	`make_·œ
("MimasTDR", "pcl3"));

239 
TECH_CLASS_KEY_VALUE
.
	`push_back
(
	`make_·œ
("Saipan15B", "pcl3"));

240 
TECH_CLASS_KEY_VALUE
.
	`push_back
(
	`make_·œ
("Gemstone", "pcl3"));

241 
TECH_CLASS_KEY_VALUE
.
	`push_back
(
	`make_·œ
("SPDOfficejetProAsize", "pcl3"));

242 
TECH_CLASS_KEY_VALUE
.
	`push_back
(
	`make_·œ
("CLE", "pcl3"));

243 
TECH_CLASS_KEY_VALUE
.
	`push_back
(
	`make_·œ
("SPDOfficejetProBsize", "pcl3"));

244 
TECH_CLASS_KEY_VALUE
.
	`push_back
(
	`make_·œ
("CLE17", "pcl3"));

245 
TECH_CLASS_KEY_VALUE
.
	`push_back
(
	`make_·œ
("Mimas17", "pcl3"));

246 
TECH_CLASS_KEY_VALUE
.
	`push_back
(
	`make_·œ
("P15_CISS", "pcl3"));

247  
TECH_CLASS_KEY_VALUE
;

248 
	}
}

257 
STRING_PAIR
 
	$TechCÏssPdls
()

259 
STRING_PAIR
 
mod–_‹ch_şass
;

260 
PAIR_VECTOR
 
TECH_CLASS_KEY_VALUE
 = 
	`TechCÏssPdlKeySv®ues
();

262 
couÁ
 = 0; couÁ < 
MAX_TECH_CLASS_PDL
; count ++)

263 
mod–_‹ch_şass
.
	`š£¹
(
¡d
::
	`make_·œ
(
TECH_CLASS_KEY_VALUE
[
couÁ
].
fœ¡
, TECH_CLASS_KEY_VALUE[couÁ].
£cÚd
));

264  
mod–_‹ch_şass
;

266 
	}
}

273 
¡ršg
 
	$R•ÏûSŒCh¬
(
¡ršg
 
mod–_Çme
, cÚ¡ sŒšg &
»¶aû
, 
v®ue
)

276 
size_t
 
pos
 = 
mod–_Çme
.
	`fšd_fœ¡_of
(
»¶aû
);

278 
pos
 !ğ
¡ršg
::
Åos
)

280 
mod–_Çme
[
pos
] = 
v®ue
;

281 
pos
 = 
mod–_Çme
.
	`fšd_fœ¡_of
(
»¶aû
,…os+1);

283  
mod–_Çme
;

284 
	}
}

291 
	$C­™®ize
(
¡ršg
 &
mod–_Çme
)

293 
boŞ
 
ÿp_check
 = 
Œue
;

295 
šdex
 = 0; index < 
mod–_Çme
.
	`Ëngth
(); index++)

297 ià(
	`i§Íha
(
mod–_Çme
.
	`©
(
šdex
))&& 
ÿp_check
 =ğ
Œue
)

299 
mod–_Çme
.
	`©
(
šdex
èğ
	`touµ”
(model_name.at(index));

300 
ÿp_check
 = 
çl£
;

302 ià(
	`isdig™
 (
mod–_Çme
.
	`©
(
šdex
)))

304 
ÿp_check
 = 
çl£
;

305 if(
	`isuµ”
(
mod–_Çme
.
	`©
(
šdex
-1))!=1)

307 
mod–_Çme
.
	`©
(
šdex
-1)=
	`tŞow”
(model_name.at(index-1));

309 ià(
	`isuµ”
(
mod–_Çme
.
	`©
(
šdex
-2))!=1)

311 
mod–_Çme
.
	`©
(
šdex
-2)=
	`tŞow”
(model_name.at(index-2));

314 ià(
	`is¥aû
 (
mod–_Çme
.
	`©
(
šdex
)))

315 
ÿp_check
 = 
Œue
;

316 if(
mod–_Çme
.
	`©
(
šdex
) == '~')

317 
mod–_Çme
.
	`©
(
šdex
)=' ';

321 if(
mod–_Çme
.
	`fšd
("Psc")!ğ
¡d
::
¡ršg
::
Åos
){

322 
size_t
 
pos
=
mod–_Çme
.
	`fšd
("Psc");

323 
mod–_Çme
.
	`»¶aû
(
pos
,3,"PSC");

325 if(
mod–_Çme
.
	`fšd
("Må")!ğ
¡d
::
¡ršg
::
Åos
){

326 
size_t
 
pos
=
mod–_Çme
.
	`fšd
("Mfp");

327 
mod–_Çme
.
	`»¶aû
(
pos
,3,"MFP");

329 if(
mod–_Çme
.
	`fšd
("La£rj‘")!ğ
¡d
::
¡ršg
::
Åos
){

330 
size_t
 
pos
=
mod–_Çme
.
	`fšd
("Laserjet");

331 
mod–_Çme
.
	`»¶aû
(
pos
,8,"LaserJet");

335 
	}
}

342 
	$NÜamlizeMod–Name
(
MODEL_DICT_MAP
 &
mod–_diù
 )

345 
MODEL_DICT_MAP
::
™”©Ü
 
™
ğ
mod–_diù
.
	`begš
(); it!=mod–_diù.
	`’d
(); ++it)

347 
¡ršg
 
mod–_Çme
=
™
->
fœ¡
;

348 ià(
mod–_Çme
.
	`fšd
("­Şlo")!ğ
¡d
::
¡ršg
::
Åos
)

350 
mod–_Çme
 = 
	`R•ÏûSŒCh¬
(model_name, "_ ",' ');

352 if(
mod–_Çme
.
	`fšd
("hp")!ğ
¡d
::
¡ršg
::
Åos
)

355 
mod–_Çme
 = 
	`R•ÏûSŒCh¬
(model_name, "_ ",' ');

356 
size_t
 
pos
 = 
mod–_Çme
.
	`fšd
("hp");

357 
mod–_Çme
.
	`»¶aû
(
pos
, 2, "HP");

361 
mod–_Çme
 = 
	`R•ÏûSŒCh¬
(model_name, "_ ",' ');

362 
mod–_Çme
.
	`š£¹
(0,"HP ");

364 
	`C­™®ize
(
mod–_Çme
);

365 
Ën
 = 0;

366 
Ën
 = 
mod–_Çme
.
	`Ëngth
();

367 ià(
mod–_Çme
[
Ën
-1] == ' ')

368 
mod–_Çme
.
	`assign
(mod–_Çme, 0, mod–_Çme.
	`Ëngth
()-1);

369 if(
mod–_Çme
[0] == 'H' && model_name[1] == 'p')

370 
mod–_Çme
[1] = 'P';

371 
™
->
£cÚd
.
s_nÜm®_mod–_Çme
 = 
mod–_Çme
;

373 
	}
}

376 
	$NÜamlizeModeV¬ŸÁlName
(
¡ršg
 &
mod–_Çme
){

378 ià(
mod–_Çme
.
	`fšd
("ApŞlo")!ğ
¡d
::
¡ršg
::
Åos
)

381 
šdex
=0; index < 
mod–_Çme
.
	`Ëngth
(); index++){

382 if(
	`i§Íha
(
mod–_Çme
.
	`©
(
šdex
))&& 
	`isuµ”
(model_name.at(index))){

383 
mod–_Çme
.
	`©
(
šdex
)=
	`tŞow”
( model_name.at(index));

387 
	`C­™®ize
(
mod–_Çme
);

388 if(
mod–_Çme
.
	`fšd
("Hp")!ğ
¡d
::
¡ršg
::
Åos
)

390 
size_t
 
pos
 = 
mod–_Çme
.
	`fšd
("Hp");

391 
mod–_Çme
.
	`»¶aû
(
pos
, 2, "HP");

393 
mod–_Çme
.
	`š£¹
(0,"HP ");

396 
	}
}

	@Normalize.h

1 #iâdeà
_NORMALIZE_H


2 
	#_NORMALIZE_H


	)

4 
	~"CommÚ.h
"

6 
	#MAX_TECH_CLASS_PDL
 67

	)

7 
	#MAX_TECH_CLASS
 76

	)

8 
	#MAX_FAMILY_CLASS
 53

	)

9 
	#MAX_SUB_CLASS
 30

	)

12 
	#COLOR
 "CŞÜ"

	)

13 
	#COLOR_LASERJET
 "cŞÜ†a£rj‘"

	)

14 
	#LASERJET
 "Ï£rj‘"

	)

15 
	#LASERJET_CAP
 "La£rJ‘"

	)

16 
	#PHOTOSMART
 "phÙosm¬t"

	)

17 
	#PHOTOSMART_CAP
 "PhÙosm¬t"

	)

18 
	#DESKJET
 "deskj‘"

	)

19 
	#DESKJET_CAP
 "Deskj‘"

	)

20 
	#COLOR_INKJET_PRINTER
 "cŞÜ inkj‘…rš‹r"

	)

21 
	#OFFICEJET
 "offiûj‘"

	)

22 
	#OFFICEJET_CA
 "Offiûj‘"

	)

23 
	#BUSINESS_INKJET
 "busšes škj‘"

	)

24 
	#DESIGNJET
 "designj‘"

	)

25 
	#PRINTER_SCANNER_COPIER
 "´š‹¸sÿÂ” cİ›r"

	)

26 
	#COLOR_LJ
 "cŞÜ†j"

	)

27 
	#PROFESSIONAL
 "´oãssiÚ®"

	)

28 
	#PROFESSIONAL_CAP
 "ProãssiÚ®"

	)

29 
	#INKJET
 "Inkj‘"

	)

30 
	#WIRELESS
 "Wœ–ess"

	)

31 
	#TANK
 "Tªk"

	)

33 
	#COLOR_REPLACEMENT
 "CL"

	)

34 
	#COLOR_LASERJET_REPLACEMENT
 "CJL"

	)

35 
	#LASERJET_REPLACEMENT
 "LJ"

	)

36 
	#LASERJET_CAP_REPLACEMENT
 "LJ"

	)

37 
	#PHOTOSMART_REPLACEMENT
 "PS"

	)

38 
	#PHOTOSMART_CAP_REPLACEMENT
 "PS"

	)

39 
	#DESKJET_REPLACEMENT
 "DJ"

	)

40 
	#DESKJET_CAP_REPLACEMENT
 "DJ"

	)

41 
	#COLOR_INKJET_PRINTER_REPLACEMENT
 ""

	)

42 
	#OFFICEJET_REPLACEMENT
 "OJ"

	)

43 
	#OFFICEJET_CAP_REPLACEMENT
 "OJ"

	)

44 
	#BUSINESS_INKJET_REPLACEMENT
 "BIJ"

	)

45 
	#DESIGNJET_REPLACEMENT
 "DESIGNJ"

	)

46 
	#PRINTER_SCANNER_COPIER_REPLACEMENT
 "PSC"

	)

47 
	#COLOR_LJ_REPLACEMENT
 "CLJ"

	)

48 
	#PROFESSIONAL_REPLACEMENT
 "Pro"

	)

49 
	#PROFESSIONAL_CAP_REPLACEMENT
 "Pro"

	)

50 
	#INKJET_REPLACEMENT
 "IJ"

	)

51 
	#WIRELESS_REPLACEMENT
 "WL"

	)

52 
	#TANK_REPLACEMENT
 "TK"

	)

54 
	#MAX_SHORTENING_REPLACEMENTS
 20

	)

60 
STRING_PAIR
 
TechCÏssPdls
();

67 
¡ršg
 
R•ÏûSŒCh¬
(¡ršg 
mod–_Çme
, cÚ¡ sŒšg &
»¶aû
, 
v®ue
);

74 
C­™®ize
(
¡ršg
 &
mod–_Çme
);

81 
NÜamlizeMod–Name
(
MODEL_DICT_MAP
 &
mod–_diù
 );

84 
NÜamlizeModeV¬ŸÁlName
(
¡ršg
 &
mod–_Çme
);

	@common/utils.c

1 
	~"uts.h
"

2 
	~"¡ršg.h
"

3 
	~<dlfú.h
>

4 
	~<sys/¡©.h
>

5 
	~<”ºo.h
>

6 
	~<¡dlib.h
>

8 
”ºo
;

10 
	$IsChromeOs
()

12 
fe_size
=0,
i
=0;

13 
»t_¡©
 = 0;

14 *
buf
;

15 *
±r
;

16 
os_Çme
[30]={0,};

19 
FILE
 *
åŒ
 = 
	`fİ’
("/etc/os-release","r");

20 if(
åŒ
 =ğ
NULL
)

21  
»t_¡©
;

22 
	`f£ek
(
åŒ
,0,
SEEK_END
);

23 
fe_size
 = 
	`á–l
(
åŒ
);

24 
	`f£ek
(
åŒ
,0,
SEEK_SET
);

26 
buf
 = (*)
	`m®loc
(
fe_size
);

27 
	`ä—d
(
buf
,
fe_size
,1,
åŒ
);

29 
±r
=
	`¡r¡r
(
buf
,"NAME");

30 if(
±r
 !ğ
NULL
)

32 
±r
 =…tr + 5;

33 *
±r
!='\n'&&*ptr!='\0')

35 
os_Çme
[
i
]=*
±r
;

36 
±r
++;
i
++;

38 if(
	`¡rÿ£¡r
(
os_Çme
,"chromos")!=
NULL
)

39 
»t_¡©
 = 1;

41 
»t_¡©
 = 0;

45 
	`fşo£
(
åŒ
);

46 
	`ä“
(
buf
);

48  
»t_¡©
;

51 
	}
}

53 
	$G‘Paœ
(*
buf
, 
buf_Ën
, *
key
, *
v®ue
, **

)

55 
i
=0, 
j
;

57 
key
[0] = 0;

58 
v®ue
[0] = 0;

60 ià(
buf
[
i
] == '#')

62 ; 
buf
[
i
] !ğ'\n' && i < 
buf_Ën
; i++);

63 ià(
buf
[
i
] == '\n')

64 
i
++;

67 
j
 = 0;

68 (
buf
[
i
] !ğ'='è&& (˜< 
buf_Ën
è&& (
j
 < 
UTILS_LINE_SIZE
))

69 
key
[
j
++] = 
buf
[
i
++];

70 
j
--; 
key
[j] == ' ' && j > 0; j--);

71 
key
[++
j
] = 0;

73 ià(
buf
[
i
] == '=')

74 
i
++; 
buf
[i] =ğ' ' && i < 
buf_Ën
; i++);

76 
j
 = 0;

77 (
buf
[
i
] !ğ'\n'è&& (˜< 
buf_Ën
è&& (
j
 < 
UTILS_LINE_SIZE
))

78 
v®ue
[
j
++] = 
buf
[
i
++];

79 
j
--; 
v®ue
[j] == ' ' && j > 0; j--);

80 
v®ue
[++
j
] = 0;

82 ià(
buf
[
i
] == '\n')

83 
i
++;

85 ià(

 !ğ
NULL
)

86 *

 = 
buf
 + 
i
;

88  
i
;

89 
	}
}

93 
UTILS_CONF_RESULT
 
	$g‘_cÚf
(cÚ¡ *
£ùiÚ
, cÚ¡ *
key
, *
v®ue
, 
v®ue_size
)

95  
	`g‘_key_v®ue
(
CONFDIR
 "/h¶.cÚf", 
£ùiÚ
, 
key
, 
v®ue
, 
v®ue_size
);

96 
	}
}

99 
UTILS_CONF_RESULT
 
	$g‘_key_v®ue
(cÚ¡ *
fe
, cÚ¡ *
£ùiÚ
, cÚ¡ *
key
, *
v®ue
, 
v®ue_size
)

101 
Ãw_key
[
UTILS_LINE_SIZE
];

102 
Ãw_v®ue
[
UTILS_LINE_SIZE
];

103 
rcbuf
[255];

104 
Ãw_£ùiÚ
[32];

105 *

;

106 
FILE
 *
šFe
;

107 
UTILS_CONF_RESULT
 
¡©
 = 
UTILS_CONF_DATFILE_ERROR
;

108 
i
,
j
;

110 if((
šFe
 = 
	`fİ’
(
fe
, "r")è=ğ
NULL
)

112 
	`BUG
("uÇbËØİ’ %s: %m\n", 
fe
);

113 
bugout
;

116 
Ãw_£ùiÚ
[0] = 0;

119 (
	`fg‘s
(
rcbuf
, Ôcbuf), 
šFe
è!ğ
NULL
))

121 ià(
rcbuf
[0] == '[')

123 
i
 = 
j
 = 0;

124 (
rcbuf
[
i
] !ğ']'è&& (
j
 < ((
Ãw_£ùiÚ
)-2)))

125 
Ãw_£ùiÚ
[
j
++] = 
rcbuf
[
i
++];

126 
Ãw_£ùiÚ
[
j
++] = 
rcbuf
[
i
++];

127 
Ãw_£ùiÚ
[
j
] = 0;

131 
	`G‘Paœ
(
rcbuf
, 
	`¡¾’
Ôcbuf), 
Ãw_key
, 
Ãw_v®ue
, &

);

133 ià((
	`¡rÿ£cmp
(
Ãw_£ùiÚ
, 
£ùiÚ
è=ğ0è&& (¡rÿ£cmp(
Ãw_key
, 
key
) == 0))

135 
	`¡ºıy
(
v®ue
, 
Ãw_v®ue
, 
v®ue_size
);

136 
¡©
 = 
UTILS_CONF_OK
;

141 ià(
¡©
 !ğ
UTILS_CONF_OK
)

142 
	`BUG
("uÇbËØfšd % % š %s\n", 
£ùiÚ
, 
key
, 
fe
);

144 
bugout
:

145 ià(
šFe
 !ğ
NULL
)

146 
	`fşo£
(
šFe
);

148  
¡©
;

149 
	}
}

152 
UTILS_PLUGIN_STATUS
 
	$v®id©e_¶ugš_v”siÚ
()

154 
h¶_v”siÚ
[128];

155 
¶ugš_v”siÚ
[128];

157 ià(
	`g‘_cÚf
("[h¶]", "v”siÚ", 
h¶_v”siÚ
, (h¶_v”siÚ)è!ğ
UTILS_CONF_OK
)

158  
UTILS_PLUGIN_STATUS_NOT_INSTALLED
;

160 ià(
	`g‘_key_v®ue
(
HPLIP_PLUGIN_STATE
,"[¶ugš]" , "v”siÚ", 
¶ugš_v”siÚ
, Õlugš_v”siÚ)è!ğ
UTILS_CONF_OK
 )

162 
	`BUG
("validate_plugin_version() Failedo get Plugin version from [%s]\n", "/var/lib/hp/hplip.state");

163  
UTILS_PLUGIN_STATUS_NOT_INSTALLED
;

167 ià(
	`¡rcmp
(
h¶_v”siÚ
, 
¶ugš_v”siÚ
) == 0)

169  
UTILS_PLUGIN_STATUS_OK
;

173 
	`BUG
("v®id©e_¶ugš_v”siÚ(èPlugš v”siÚ[%s] mism©ch w™h HPLIP v”siÚ[%s]\n",
¶ugš_v”siÚ
, 
h¶_v”siÚ
);

174  
UTILS_PLUGIN_STATUS_MISMATCH
;

176  
UTILS_PLUGIN_STATUS_NOT_INSTALLED
;

177 
	}
}

180 *
	$lßd_¶ugš_lib¿ry
 (
UTILS_PLUGIN_LIBRARY_TYPE
 
eLib¿ryTy³
, cÚ¡ *
szPlugšName
)

182 *
pHªdËr
 = 
NULL
;

183 
szHome
[256];

184 
szLib¿ryFe
[256];

185 
isChrome
 = 0;

187 
isChrome
 = 
	`IsChromeOs
();

189 ià(
szPlugšName
 =ğ
NULL
 || szPluginName[0] == '\0')

191 
	`BUG
("Invalid Library‚ame\n");

192  
pHªdËr
;

196 if(!
isChrome
){

197 ià(
	`g‘_cÚf
("[dœs]", "home", 
szHome
, (szHome)è!ğ
UTILS_CONF_OK
)

199 
	`BUG
("Failedo findhe home directory from hplip.conf file\n");

200  
pHªdËr
;

204 ià(
	`v®id©e_¶ugš_v”siÚ
(è!ğ
UTILS_PLUGIN_STATUS_OK
 )

206 
	`BUG
("Plugin version is‚ot matching \n");

207  
pHªdËr
;

211 if(
isChrome
)

212 
	`¢´štf
(
szHome
,(szHome),"/usr/libexec/cups");

214 ià(
eLib¿ryTy³
 =ğ
UTILS_PRINT_PLUGIN_LIBRARY
){

215 if(!
isChrome
)

216 
	`¢´štf
(
szLib¿ryFe
, (szLib¿ryFe), "%s/´Á/¶ugšs/%s", 
szHome
, 
szPlugšName
);

218 
	`¢´štf
(
szLib¿ryFe
, (szLib¿ryFe), "%s/f‹r/%s", 
szHome
, 
szPlugšName
);

220 ià(
eLib¿ryTy³
 =ğ
UTILS_SCAN_PLUGIN_LIBRARY
)

221 
	`¢´štf
(
szLib¿ryFe
, (szLib¿ryFe), "%s/sÿn/¶ugšs/%s", 
szHome
, 
szPlugšName
);

222 ià(
eLib¿ryTy³
 =ğ
UTILS_FAX_PLUGIN_LIBRARY
)

223 
	`¢´štf
(
szLib¿ryFe
, (szLib¿ryFe), "%s/çx/¶ugšs/%s", 
szHome
, 
szPlugšName
);

226 
	`BUG
("Inv®id Lib¿ry Ty³ =%d \n",
eLib¿ryTy³
);

227  
pHªdËr
;

230  
	`lßd_lib¿ry
 (
szLib¿ryFe
);

232 
	}
}

234 *
	$lßd_lib¿ry
 (cÚ¡ *
szLib¿ryFe
)

236 *
pHªdËr
 = 
NULL
;

238 ià(
szLib¿ryFe
 =ğ
NULL
 || szLibraryFile[0] == '\0')

240 
	`BUG
("Invalid Library‚ame\n");

241  
pHªdËr
;

244 ià((
pHªdËr
 = 
	`dlİ’
(
szLib¿ryFe
, 
RTLD_NOW
|
RTLD_GLOBAL
)è=ğ
NULL
)

245 
	`BUG
("uÇbËØlßd†ib¿ry %s: %s\n", 
szLib¿ryFe
, 
	`dË¼Ü
());

247  
pHªdËr
;

248 
	}
}

250 *
	$g‘_lib¿ry_symbŞ
(*
pLibHªdËr
, cÚ¡ *
szSymbŞ
)

252 *
pSymHªdËr
 = 
NULL
;

253 ià(
pLibHªdËr
 =ğ
NULL
)

255 
	`BUG
("Invalid Library hanlder\n");

256  
NULL
;

259 ià(
szSymbŞ
 =ğ
NULL
 || szSymbol[0] == '\0')

261 
	`BUG
("Invalid Library symbol\n");

262  
NULL
;

265 
pSymHªdËr
 = 
	`dlsym
(
pLibHªdËr
, 
szSymbŞ
);

266 ià(
pSymHªdËr
 =ğ
NULL
)

267 
	`BUG
("Cª'ˆfšd % symbŞ iÀLib¿ry:%s\n",
szSymbŞ
,
	`dË¼Ü
());

269  
pSymHªdËr
;

270 
	}
}

272 
	$uÆßd_lib¿ry
(*
pLibHªdËr
)

274 ià(
pLibHªdËr
)

275 
	`dlşo£
(
pLibHªdËr
);

277 
	`BUG
("Invalid Library hanlder…LibHandler = NULL.\n");

278 
	}
}

280 
	$ü—‹TempFe
(* 
szFeName
, 
FILE
** 
pFePŒ
)

282 
iFD
 = -1;

284 ià(
szFeName
 =ğ
NULL
 || szFeName[0] =ğ'\0' || 
pFePŒ
 == NULL)

286 
	`BUG
("Invalid Filename/…ointer\n");

290 ià(
	`¡r¡r
(
szFeName
,"XXXXXX"è=ğ
NULL
)

291 
	`¡rÿt
(
szFeName
,"_XXXXXX");

293 
iFD
 = 
	`mk¡emp
(
szFeName
);

294 if(-1 =ğ
iFD
)

296 
	`BUG
("FaedØü—‹h‹m°fName[%s]ƒ¼no[%d : %s]\n",
szFeName
,
”ºo
,
	`¡»¼Ü
(errno));

301 *
pFePŒ
 = 
	`fdİ’
(
iFD
,"w+");

304  
iFD
;

305 
	}
}

307 
	$g‘HPLogLev–
()

309 
FILE
 *
å
;

310 
¡r
[258];

311 *
p
;

312 
iLogLev–
 = 0;

314 
å
 = 
	`fİ’
 ("/etc/cups/cupsd.conf", "r");

315 ià(
å
 =ğ
NULL
)

317 !
	`ãof
 (
å
))

319 ià(!
	`fg‘s
 (
¡r
, 256, 
å
))

323 ià((
p
 = 
	`¡r¡r
 (
¡r
, "hpLogLevel")))

325 
p
 +ğ
	`¡¾’
 ("hpLogLevel") + 1;

326 
iLogLev–
 = 
	`©oi
 (
p
);

330 
	`fşo£
 (
å
);

331  
iLogLev–
;

332 
	}
}

	@common/utils.h

1 #iâdeà
_COMMON_UTILS_H


2 
	#_COMMON_UTILS_H


	)

4 
	~<¡dio.h
>

5 
	~<¡d¬g.h
>

6 
	~<sy¦og.h
>

9 
	#_STRINGIZE
(
x
è#x

	)

10 
	#STRINGIZE
(
x
è
	`_STRINGIZE
(x)

	)

12 
	#BUG
(
¬gs
...è
	`sy¦og
(
LOG_ERR
, 
__FILE__
 " " 
	`STRINGIZE
(
__LINE__
è": "‡rgs)

	)

13 
	#DBG
(
¬gs
...è
	`sy¦og
(
LOG_INFO
, 
__FILE__
 " " 
	`STRINGIZE
(
__LINE__
è": "‡rgs)

	)

15 
	#UTILS_LINE_SIZE
 256

	)

16 
	#UTILS_BUFFER_SIZE
 16384

	)

18 
	#MAX_FILE_PATH_LEN
 512

	)

20 
	#PRNT_PLUGIN_LJ
 "lj.so"

	)

21 
	#PRNT_PLUGIN_HBPL1
 "hb¶1.so"

	)

22 
	#SCAN_PLUGIN_MARVELL
 "bb_m¬v–l.so"

	)

23 
	#SCAN_PLUGIN_SOAP
 "bb_sßp.so"

	)

24 
	#SCAN_PLUGIN_SOAPHT
 "bb_sßpht.so"

	)

25 
	#SCAN_PLUGIN_ESCL
 "bb_esş.so"

	)

26 
	#SCAN_PLUGIN_ORBLITE
 "bb_Übl™e.so"

	)

28 
	#HPLIP_PLUGIN_STATE
 "/v¬/lib/hp/h¶.¡©e"

	)

29 
	#CUPS_TMP_DIR
 
	`g‘’v
("TMPDIR"è? : g‘’v("HOME"è?:"/tmp"

	)

31 
	eUTILS_CONF_RESULT


33 
	mUTILS_CONF_OK
 = 0,

34 
	mUTILS_CONF_FILE_NOT_FOUND
,

35 
	mUTILS_CONF_SECTION_NOT_FOUND
,

36 
	mUTILS_CONF_KEY_NOT_FOUND
,

37 
	mUTILS_CONF_DATFILE_ERROR
,

41 
	eUTILS_PLUGIN_STATUS


43 
	mUTILS_PLUGIN_STATUS_OK
 = 0,

44 
	mUTILS_PLUGIN_STATUS_MISMATCH
,

45 
	mUTILS_PLUGIN_STATUS_NOT_INSTALLED
,

48 
	eUTILS_PLUGIN_LIBRARY_TYPE


50 
	mUTILS_PRINT_PLUGIN_LIBRARY
 = 0,

51 
	mUTILS_SCAN_PLUGIN_LIBRARY
,

52 
	mUTILS_FAX_PLUGIN_LIBRARY
,

57 #ifdeà
__ılu¥lus


74 
UTILS_CONF_RESULT
 
g‘_cÚf
(cÚ¡ *
£ùiÚ
, cÚ¡ *
key
, *
v®ue
, 
v®ue_size
);

91 
UTILS_CONF_RESULT
 
g‘_key_v®ue
(cÚ¡ *
fe
, cÚ¡ *
£ùiÚ
, cÚ¡ *
key
, *
v®ue
, 
v®ue_size
);

102 
UTILS_PLUGIN_STATUS
 
v®id©e_¶ugš_v”siÚ
();

114 *
lßd_lib¿ry
 (cÚ¡ *
szLibName
);

125 *
lßd_¶ugš_lib¿ry
 (
UTILS_PLUGIN_LIBRARY_TYPE
 
eLib¿ryTy³
, cÚ¡ *
szPlugšName
);

136 *
g‘_lib¿ry_symbŞ
(*
pLibHªdËr
, cÚ¡ *
szSymbŞ
);

146 
uÆßd_lib¿ry
(*
pLibHªdËr
);

157 
ü—‹TempFe
(* 
szFeName
, 
FILE
** 
pFePŒ
);

158 
g‘HPLogLev–
();

159 
IsChromeOs
();

161 #ifdeà
__ılu¥lus


	@io/hpmud/dot4.c

26 
	~"hpmud.h
"

27 
	~"hpmudi.h
"

34 
	$DÙ4FÜw¬dR•ly
(
mud_chªÃl
 *
pc
, 
fd
, *
buf
, 
size
)

36 
mud_deviû
 *
pd
 = &
m¥
->
deviû
[
pc
->
dšdex
];

37 
Ën
=0;

39 ià((
Ën
 = (
pd
->
vf
.
wr™e
)(
fd
, 
buf
, 
size
, 
HPMUD_EXCEPTION_TIMEOUT
)) != size)

41 
	`BUG
("unableo Dot4ForwarReply: %m\n");

43  
Ën
;

44 
	}
}

47 
	$DÙ4ExecRev”£Cmd
(
mud_chªÃl
 *
pc
, 
fd
, *
buf
)

49 
mud_deviû
 *
pd
 = &
m¥
->
deviû
[
pc
->
dšdex
];

50 
mud_chªÃl
 *
out_of_bound_chªÃl
;

51 
DOT4Cmd
 *
pCmd
;

52 
DOT4R•ly
 *
pR•ly
;

53 
DOT4C»d™
 *
pC»d™
;

54 
DOT4C»d™R•ly
 *
pC»d™R•ly
;

55 
DOT4C»d™Reque¡
 *
pC»d™Req
;

56 
DOT4C»d™Reque¡R•ly
 *
pC»d™ReqR•ly
;

57 
DOT4E¼Ü
 *
pE¼Ü
;

58 
Ën
, 
size
;

59 
sock‘
;

60 
út
;

62 
pCmd
 = (
DOT4Cmd
 *)
buf
;

65 ià(!(
pCmd
->
h
.
psid
 =ğ0 &&…Cmd->h.
ssid
 == 0))

67 ià(
pCmd
->
h
.
psid
 =ğpCmd->h.
ssid
)

70 
out_of_bound_chªÃl
 = &
pd
->
chªÃl
[
pCmd
->
h
.
psid
];

72 ià(
out_of_bound_chªÃl
->

.
p2hüed™
 <= 0)

74 
	`BUG
("šv®id d©¨·ck‘ c»d™=%d\n", 
out_of_bound_chªÃl
->

.
p2hüed™
);

78 
size
 = 
	`Áohs
(
pCmd
->
h
.
Ëngth
è- (
DOT4H—d”
);

79 ià(
size
 > (
HPMUD_BUFFER_SIZE
 - 
out_of_bound_chªÃl
->
rút
))

81 
	`BUG
("šv®id d©¨·ck‘ size=%d\n", 
size
);

84 
	`memıy
(&
out_of_bound_chªÃl
->
rbuf
[out_of_bound_chªÃl->
rút
], 
buf
+(
MLCH—d”
), 
size
);

85 
out_of_bound_chªÃl
->
rút
 +ğ
size
;

86 ià(
pCmd
->
h
.
üed™
)

87 
out_of_bound_chªÃl
->

.
h2püed™
 +ğ
pCmd
->
h
.
üed™
;

88 
out_of_bound_chªÃl
->

.
p2hüed™
--;

92 
Ën
 = 
	`Áohs
(
pCmd
->
h
.
Ëngth
);

93 
	`BUG
("unsŞic™ed d©¨·ck‘:…sid=%x, ssid=%x,†’gth=%d, c»d™=%d, stus=%x\n", 
pCmd
->
h
.
psid
,

94 
pCmd
->
h
.
ssid
, 
Ën
,…Cmd->h.
üed™
,…Cmd->h.
cÚŒŞ
);

95 
	`DBG_DUMP
(
buf
, 
Ën
);

101 
pCmd
->
cmd
)

103 
DOT4_CREDIT
:

104 
pC»d™
 = (
DOT4C»d™
 *)
buf
;

105 
out_of_bound_chªÃl
 = &
pd
->
chªÃl
[
pC»d™
->
psock‘
];

106 
out_of_bound_chªÃl
->

.
h2püed™
 +ğ
	`Áohs
(
pC»d™
->
üed™
);

107 
pC»d™R•ly
 = (
DOT4C»d™R•ly
 *)
buf
;

108 
pC»d™R•ly
->
h
.
Ëngth
 = 
	`htÚs
((
DOT4C»d™R•ly
));

109 
pC»d™R•ly
->
h
.
üed™
 = 1;

110 
pC»d™R•ly
->
h
.
cÚŒŞ
 = 0;

111 
pC»d™R•ly
->
cmd
 |= 0x80;

112 
pC»d™R•ly
->
»suÉ
 = 0;

113 
pC»d™R•ly
->
psock‘
 = 
out_of_bound_chªÃl
->
sockid
;

114 
pC»d™R•ly
->
ssock‘
 = 
out_of_bound_chªÃl
->
sockid
;

115 
	`DÙ4FÜw¬dR•ly
(
pc
, 
fd
, (*)
pC»d™R•ly
, (
DOT4C»d™R•ly
));

117 
DOT4_CREDIT_REQUEST
:

118 
pC»d™Req
 = (
DOT4C»d™Reque¡
 *)
buf
;

119 ià(
út
++ < 5)

120 
	`BUG
("uÃx³ùed DOT4C»d™Reque¡: cmd=%x, hid=%x,…id=%x, maxüed™=%d\n", 
pC»d™Req
->
cmd
,

121 
pC»d™Req
->
psock‘
,…C»d™Req->
ssock‘
, 
	`Áohs
ÕC»d™Req->
maxüed™
));

122 
sock‘
 = 
pC»d™Req
->
ssock‘
;

123 
pC»d™ReqR•ly
 = (
DOT4C»d™Reque¡R•ly
 *)
buf
;

124 
pC»d™ReqR•ly
->
h
.
Ëngth
 = 
	`htÚs
((
DOT4C»d™Reque¡R•ly
));

125 
pC»d™ReqR•ly
->
h
.
üed™
 = 1;

126 
pC»d™ReqR•ly
->
h
.
cÚŒŞ
 = 0;

127 
pC»d™ReqR•ly
->
cmd
 |= 0x80;

128 
pC»d™ReqR•ly
->
»suÉ
 = 0;

129 
pC»d™ReqR•ly
->
psock‘
 = 
sock‘
;

130 
pC»d™ReqR•ly
->
ssock‘
 = 
sock‘
;

131 
pC»d™ReqR•ly
->
üed™
 = 0;

132 
	`DÙ4FÜw¬dR•ly
(
pc
, 
fd
, (*)
pC»d™ReqR•ly
, (
DOT4C»d™Reque¡R•ly
));

134 
DOT4_ERROR
:

135 
pE¼Ü
 = (
DOT4E¼Ü
 *)
buf
;

136 
	`BUG
("uÃx³ùed DOT4E¼Ü: cmd=%x,…sock‘=%d, ssock‘=%d,ƒ¼Ü=%x\n", 
pE¼Ü
->
cmd
,…E¼Ü->
psock‘
,…E¼Ü->
ssock‘
,…E¼Ü->
”rÜ
);

139 
pR•ly
 = (
DOT4R•ly
 *)
buf
;

140 
	`BUG
("uÃx³ùed commªd: cmd=%x,„esuÉ=%x\n", 
pR•ly
->
cmd
,…R•ly->
»suÉ
);

141 
pR•ly
->
h
.
Ëngth
 = 
	`htÚs
((
DOT4R•ly
));

142 
pR•ly
->
h
.
üed™
 = 1;

143 
pR•ly
->
h
.
cÚŒŞ
 = 0;

144 
pR•ly
->
cmd
 |= 0x80;

145 
pR•ly
->
»suÉ
 = 1;

146 
	`DÙ4FÜw¬dR•ly
(
pc
, 
fd
, (*)
pR•ly
, (
DOT4R•ly
));

150 
	}
}

153 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
	$DÙ4Rev”£Cmd
(
mud_chªÃl
 *
pc
, 
fd
)

155 
mud_deviû
 *
pd
 = &
m¥
->
deviû
[
pc
->
dšdex
];

156 
buf
[
HPMUD_BUFFER_SIZE
];

157 
¡©
=0, 
Ën
, 
size
;

158 
pkËn
;

159 *
pBuf
;

160 
DOT4R•ly
 *
pPk
;

162 
pPk
 = (
DOT4R•ly
 *)
buf
;

164 
pBuf
 = 
buf
;

167 
size
 = (
DOT4H—d”
);

168 
size
 > 0)

170 ià((
Ën
 = (
pd
->
vf
.
»ad
)(
fd
, 
pBuf
, 
size
, 
HPMUD_EXCEPTION_TIMEOUT
)) < 0)

172 
	`BUG
("unableo„ead Dot4ReverseCmd header: %m\n");

173 
¡©
 = 1;

174 
bugout
;

176 
size
-=
Ën
;

177 
pBuf
+=
Ën
;

181 ià((
pkËn
 = 
	`Áohs
(
pPk
->
h
.
Ëngth
)è> (
buf
))

183 
	`BUG
("šv®id DÙ4Rev”£Cmd…ack‘ size: size=%d\n", 
pkËn
);

184 
¡©
 = 1;

185 
bugout
;

189 
size
 = 
pkËn
 - (
DOT4H—d”
);

190 
size
 > 0)

192 ià((
Ën
 = (
pd
->
vf
.
»ad
)(
fd
, 
pBuf
, 
size
, 
HPMUD_EXCEPTION_TIMEOUT
)) < 0)

194 
	`BUG
("uÇbËØ»ad DÙ4Rev”£Cmd d©a: %mƒxp=%zd‡ù=%zd\n", 
pkËn
-(
DOT4H—d”
),…kËn-(DOT4H—d”)-
size
);

195 
¡©
 = 1;

196 
bugout
;

198 
size
-=
Ën
;

199 
pBuf
+=
Ën
;

202 
¡©
 = 
	`DÙ4ExecRev”£Cmd
(
pc
, 
fd
, 
buf
);

204 
bugout
:

205  
¡©
;

206 
	}
}

212 
	$DÙ4Rev”£R•ly
(
mud_chªÃl
 *
pc
, 
fd
, *
buf
, 
bufsize
)

214 
mud_deviû
 *
pd
 = &
m¥
->
deviû
[
pc
->
dšdex
];

215 
¡©
=0, 
Ën
, 
size
, 
pkËn
;

216 *
pBuf
;

217 
DOT4R•ly
 *
pPk
;

219 
pPk
 = (
DOT4R•ly
 *)
buf
;

223 
pBuf
 = 
buf
;

226 
size
 = (
DOT4H—d”
);

227 
size
 > 0)

229 ià((
Ën
 = (
pd
->
vf
.
»ad
)(
fd
, 
pBuf
, 
size
, 4000000)) < 0)

231 
	`BUG
("uÇbËØ»ad DÙ4Rev”£R•ly h—d”: %m by‹sR—d=%zd\n", (
DOT4H—d”
)-
size
);

232 
¡©
 = 2;

233 
bugout
;

235 
size
-=
Ën
;

236 
pBuf
+=
Ën
;

240 
pkËn
 = 
	`Áohs
(
pPk
->
h
.
Ëngth
);

241 ià(
pkËn
 <ğ0 ||…kËÀ> 
bufsize
)

243 
	`BUG
("šv®id DÙ4Rev”£R•ly…ack‘ size: size=%d, buf=%d\n", 
pkËn
, 
bufsize
);

244 
¡©
 = 1;

245 
bugout
;

249 
size
 = 
pkËn
 - (
DOT4H—d”
);

250 
size
 > 0)

252 ià((
Ën
 = (
pd
->
vf
.
»ad
)(
fd
, 
pBuf
, 
size
, 
HPMUD_EXCEPTION_TIMEOUT
)) < 0)

254 
	`BUG
("uÇbËØ»ad DÙ4Rev”£R•ly d©a: %mƒxp=%zd‡ù=%zd\n", 
pkËn
-(
DOT4H—d”
),…kËn-(DOT4H—d”)-
size
);

255 
¡©
 = 1;

256 
bugout
;

258 
size
-=
Ën
;

259 
pBuf
+=
Ën
;

263 ià(
pPk
->
cmd
 & 0x80)

266 
¡©
 = 
	`DÙ4ExecRev”£Cmd
(
pc
, 
fd
, 
buf
);

268 ià(
¡©
 != 0)

273 
bugout
:

274  
¡©
;

275 
	}
}

277 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
	$DÙ4In™
(
mud_chªÃl
 *
pc
, 
fd
)

279 
mud_deviû
 *
pd
 = &
m¥
->
deviû
[
pc
->
dšdex
];

280 
buf
[
HPMUD_BUFFER_SIZE
];

281 
¡©
=0, 
Ën
, 
n
, 
út
;

282 
DOT4In™
 *
pCmd
;

283 
DOT4In™R•ly
 *
pR•ly
;

285 
	`mem£t
(
buf
, 0, (
DOT4In™
));

286 
pCmd
 = (
DOT4In™
 *)
buf
;

287 
n
 = (
DOT4In™
);

288 
pCmd
->
h
.
Ëngth
 = 
	`htÚs
(
n
);

289 
pCmd
->
h
.
üed™
 = 1;

290 
pCmd
->
cmd
 = 
DOT4_INIT
;

291 
pCmd
->
»v
 = 0x20;

293 ià((
Ën
 = (
pd
->
vf
.
wr™e
)(
fd
, 
pCmd
, 
n
, 
HPMUD_EXCEPTION_TIMEOUT
)) !=‚)

295 
	`BUG
("unableo write DOT4Init: %m\n");

296 
¡©
 = 1;

297 
bugout
;

300 
út
=0;

303 
¡©
 = 
	`DÙ4Rev”£R•ly
(
pc
, 
fd
, 
buf
, (buf));

304 
pR•ly
 = (
DOT4In™R•ly
 *)
buf
;

306 ià((
¡©
 !ğ0è|| (
pR•ly
->
cmd
 !ğ(0x80 | 
DOT4_INIT
)è|| (pR•ly->
»suÉ
 != 0))

308 ià(
”ºo
 =ğ
EIO
 && 
út
<1)

311 
	`BUG
("invalid DOT4InitReply„etrying...\n");

312 
	`¦“p
(1);

313 
út
++;

316 ià(
¡©
 =ğ2 && 
út
<1)

319 
	`BUG
("invalid DOT4InitReply„etrying command...\n");

320 
	`mem£t
(
buf
, 0, (
DOT4In™
));

321 
n
 = (
DOT4In™
);

322 
pCmd
->
h
.
Ëngth
 = 
	`htÚs
(
n
);

323 
pCmd
->
h
.
üed™
 = 1;

324 
pCmd
->
cmd
 = 
DOT4_INIT
;

325 
pCmd
->
»v
 = 0x20;

326 (
pd
->
vf
.
wr™e
)(
fd
, 
pCmd
, 
n
, 
HPMUD_EXCEPTION_TIMEOUT
);

327 
út
++;

330 
	`BUG
("šv®id DOT4In™R•ly: cmd=%x,„esuÉ=%x\n,„evisiÚ=%x\n", 
pR•ly
->
cmd
,…R•ly->
»suÉ
,…R•ly->
»v
);

331 
¡©
 = 1;

332 
bugout
;

337 
bugout
:

338  
¡©
;

339 
	}
}

341 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
	$DÙ4Ex™
(
mud_chªÃl
 *
pc
, 
fd
)

343 
mud_deviû
 *
pd
 = &
m¥
->
deviû
[
pc
->
dšdex
];

344 
buf
[
HPMUD_BUFFER_SIZE
];

345 
¡©
=0, 
Ën
, 
n
;

346 
DOT4Ex™
 *
pCmd
;

347 
DOT4Ex™R•ly
 *
pR•ly
;

349 
	`mem£t
(
buf
, 0, (
DOT4Ex™
));

350 
pCmd
 = (
DOT4Ex™
 *)
buf
;

351 
n
 = (
DOT4Ex™
);

352 
pCmd
->
h
.
Ëngth
 = 
	`htÚs
(
n
);

353 
pCmd
->
h
.
üed™
 = 1;

354 
pCmd
->
cmd
 = 
DOT4_EXIT
;

356 ià((
Ën
 = (
pd
->
vf
.
wr™e
)(
fd
, 
pCmd
, 
n
, 
HPMUD_EXCEPTION_TIMEOUT
)) !=‚)

358 
	`BUG
("unableo write DOT4Exit: %m\n");

359 
¡©
 = 1;

360 
bugout
;

363 
¡©
 = 
	`DÙ4Rev”£R•ly
(
pc
, 
fd
, 
buf
, (buf));

364 
pR•ly
 = (
DOT4Ex™R•ly
 *)
buf
;

366 ià((
¡©
 !ğ0è|| (
pR•ly
->
cmd
 !ğ(0x80 | 
DOT4_EXIT
)è|| (pR•ly->
»suÉ
 != 0))

368 
	`BUG
("šv®id DOT4Ex™R•ly: cmd=%x,„esuÉ=%x\n", 
pR•ly
->
cmd
,…R•ly->
»suÉ
);

369 
¡©
 = 1;

370 
bugout
;

373 
bugout
:

374  
¡©
;

375 
	}
}

377 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
	$DÙ4G‘Sock‘
(
mud_chªÃl
 *
pc
, 
fd
)

379 
mud_deviû
 *
pd
 = &
m¥
->
deviû
[
pc
->
dšdex
];

380 
buf
[
HPMUD_BUFFER_SIZE
];

381 
¡©
=0, 
Ën
, 
n
;

382 
DOT4G‘Sock‘
 *
pCmd
;

383 
DOT4G‘Sock‘R•ly
 *
pR•ly
;

385 
	`mem£t
(
buf
, 0, (
DOT4G‘Sock‘
));

386 
pCmd
 = (
DOT4G‘Sock‘
 *)
buf
;

387 
n
 = (
DOT4G‘Sock‘
);

388 
Ën
 = 
	`¡¾’
(
pc
->
¢
);

389 
	`memıy
(
buf
+(
DOT4G‘Sock‘
), 
pc
->
¢
, 
Ën
);

390 
n
 +ğ
Ën
;

391 
pCmd
->
h
.
Ëngth
 = 
	`htÚs
(
n
);

392 
pCmd
->
h
.
üed™
 = 1;

393 
pCmd
->
cmd
 = 
DOT4_GET_SOCKET
;

395 ià((
Ën
 = (
pd
->
vf
.
wr™e
)(
fd
, 
pCmd
, 
n
, 
HPMUD_EXCEPTION_TIMEOUT
)) !=‚)

397 
	`BUG
("unableo write DOT4GetSocket: %m\n");

398 
¡©
 = 1;

399 
bugout
;

402 
¡©
 = 
	`DÙ4Rev”£R•ly
(
pc
, 
fd
, 
buf
, (buf));

403 
pR•ly
 = (
DOT4G‘Sock‘R•ly
 *)
buf
;

405 ià((
¡©
 !ğ0è|| (
pR•ly
->
cmd
 !ğ(0x80 | 
DOT4_GET_SOCKET
)è|| (pR•ly->
»suÉ
 != 0))

407 
	`BUG
("šv®id DOT4G‘Sock‘R•ly: cmd=%x,„esuÉ=%x\n", 
pR•ly
->
cmd
,…R•ly->
»suÉ
);

408 
¡©
 = 1;

409 
bugout
;

412 
pc
->
sockid
 = 
pR•ly
->
sock‘
;

414 ià(
pc
->
sockid
 !ğpc->
šdex
)

415 
	`BUG
("šv®id sockid m©ch sockid=%d index=%d\n", 
pc
->
sockid
,…c->
šdex
);

417 
bugout
:

418  
¡©
;

419 
	}
}

422 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
	$DÙ4FÜw¬dD©a
(
mud_chªÃl
 *
pc
, 
fd
, cÚ¡ *
buf
, 
size
, 
u£c_timeout
)

424 
mud_deviû
 *
pd
 = &
m¥
->
deviû
[
pc
->
dšdex
];

425 
¡©
=0, 
Ën
, 
n
;

426 
DOT4H—d”
 
h
;

428 
	`mem£t
(&
h
, 0, (h));

429 
n
 = (
DOT4H—d”
è+ 
size
;

430 
h
.
Ëngth
 = 
	`htÚs
(
n
);

431 
h
.
psid
 = 
pc
->
sockid
;

432 
h
.
ssid
 = 
pc
->
sockid
;

434 ià((
Ën
 = (
pd
->
vf
.
wr™e
)(
fd
, &
h
, (
DOT4H—d”
), 
u£c_timeout
)) != (DOT4Header))

436 
	`BUG
("unableo write Dot4ForwardData header: %m\n");

437 
¡©
 = 1;

438 
bugout
;

441 ià((
Ën
 = (
pd
->
vf
.
wr™e
)(
fd
, 
buf
, 
size
, 
u£c_timeout
)) != size)

443 
	`BUG
("unableo write Dot4ForwardData: %m\n");

444 
¡©
 = 1;

445 
bugout
;

448 
bugout
:

449  
¡©
;

450 
	}
}

453 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
	$DÙ4Rev”£D©a
(
mud_chªÃl
 *
pc
, 
fd
, *
buf
, 
Ëngth
, 
u£c_timeout
)

455 
mud_deviû
 *
pd
 = &
m¥
->
deviû
[
pc
->
dšdex
];

456 
mud_chªÃl
 *
out_of_bound_chªÃl
;

457 
Ën
, 
size
, 
tÙ®
;

458 
DOT4H—d”
 *
pPk
;

460 
pPk
 = (
DOT4H—d”
 *)
buf
;

464 
tÙ®
 = 0;

467 
size
 = (
DOT4H—d”
);

468 
size
 > 0)

471 ià(
tÙ®
 == 0)

472 
Ën
 = (
pd
->
vf
.
»ad
)(
fd
, 
buf
+
tÙ®
, 
size
, 
u£c_timeout
);

474 
Ën
 = (
pd
->
vf
.
»ad
)(
fd
, 
buf
+
tÙ®
, 
size
, 
HPMUD_EXCEPTION_TIMEOUT
);

476 ià(
Ën
 < 0)

479 ià(
u£c_timeout
 >ğ
HPMUD_EXCEPTION_TIMEOUT
 || 
tÙ®
 > 0)

480 
	`BUG
("uÇbËØ»ad DÙ4Rev”£D©¨h—d”: %m %s\n", 
pd
->
uri
);

481 
bugout
;

483 
size
-=
Ën
;

484 
tÙ®
+=
Ën
;

488 
size
 = 
	`Áohs
(
pPk
->
Ëngth
è- (
DOT4H—d”
);

490 ià(
size
 > 
Ëngth
)

492 
	`BUG
("šv®id DÙ4Rev”£D©¨size: size=%d, buf=%d\n", 
size
, 
Ëngth
);

493 
bugout
;

497 ià(
pPk
->
psid
 !ğ
pc
->
sockid
 &&…Pk->
ssid
 !=…c->sockid)

499 ià(
pPk
->
psid
 =ğ0 &&…Pk->
ssid
 == 0)

502 
size
 > 0)

504 ià((
Ën
 = (
pd
->
vf
.
»ad
)(
fd
, 
buf
+
tÙ®
, 
size
, 
HPMUD_EXCEPTION_TIMEOUT
)) < 0)

506 
	`BUG
("unableo„ead Dot4ReverseData command: %m\n");

507 
bugout
;

509 
size
-=
Ën
;

510 
tÙ®
=
Ën
;

512 
	`DÙ4ExecRev”£Cmd
(
pc
, 
fd
, 
buf
);

515 ià(
pPk
->
psid
 =ğpPk->
ssid
)

518 
out_of_bound_chªÃl
 = &
pd
->
chªÃl
[
pPk
->
psid
];

519 *
pBuf
;

521 ià(
out_of_bound_chªÃl
->

.
p2hüed™
 <= 0)

523 
	`BUG
("šv®id d©¨·ck‘ c»d™=%d\n", 
out_of_bound_chªÃl
->

.
p2hüed™
);

524 
bugout
;

527 ià(
size
 > (
HPMUD_BUFFER_SIZE
 - 
out_of_bound_chªÃl
->
rút
))

529 
	`BUG
("šv®id d©¨·ck‘ size=%d\n", 
size
);

530 
bugout
;

533 
tÙ®
 = 0;

534 
pBuf
 = &
out_of_bound_chªÃl
->
rbuf
[out_of_bound_chªÃl->
rút
];

535 
size
 > 0)

537 ià((
Ën
 = (
pd
->
vf
.
»ad
)(
fd
, 
pBuf
+
tÙ®
, 
size
, 
HPMUD_EXCEPTION_TIMEOUT
)) < 0)

539 
	`BUG
("unableo„ead MlcReverseData: %m\n");

540 
bugout
;

542 
size
-=
Ën
;

543 
tÙ®
+=
Ën
;

546 
out_of_bound_chªÃl
->
rút
 +ğ
tÙ®
;

547 ià(
pPk
->
üed™
)

548 
out_of_bound_chªÃl
->

.
h2püed™
 +ğ
pPk
->
üed™
;

549 
out_of_bound_chªÃl
->

.
p2hüed™
--;

554 
DOT4Cmd
 *
pCmd
 = (DOT4Cmd *)
buf
;

555 
	`BUG
("šv®id DÙ4Rev”£D©¨¡©e: uÃx³ùed…ack‘…sid=%x, ssid=%x, cmd=%x\n", 
pPk
->
psid
,…Pk->
ssid
, 
pCmd
->
cmd
);

556 
bugout
;

560 ià(
pPk
->
üed™
)

562 
pc
->

.
h2püed™
 +ğ
pPk
->
üed™
;

565 
tÙ®
 = 0;

568 
size
 > 0)

570 ià((
Ën
 = (
pd
->
vf
.
»ad
)(
fd
, 
buf
+
tÙ®
, 
size
, 
HPMUD_EXCEPTION_TIMEOUT
)) < 0)

572 
	`BUG
("unableo„ead Dot4ReverseData: %m\n");

573 
bugout
;

575 
size
-=
Ën
;

576 
tÙ®
+=
Ën
;

581 
bugout
:

582  
tÙ®
;

583 
	}
}

585 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
	$DÙ4O³nChªÃl
(
mud_chªÃl
 *
pc
, 
fd
)

587 
mud_deviû
 *
pd
 = &
m¥
->
deviû
[
pc
->
dšdex
];

588 
buf
[
HPMUD_BUFFER_SIZE
];

589 
¡©
=0, 
Ën
, 
n
;

590 
DOT4O³nChªÃl
 *
pCmd
;

591 
DOT4O³nChªÃlR•ly
 *
pR•ly
;

593 
	`mem£t
(
buf
, 0, (
DOT4O³nChªÃl
));

594 
pCmd
 = (
DOT4O³nChªÃl
 *)
buf
;

595 
n
 = (
DOT4O³nChªÃl
);

596 
pCmd
->
h
.
Ëngth
 = 
	`htÚs
(
n
);

597 
pCmd
->
h
.
üed™
 = 1;

598 
pCmd
->
cmd
 = 
DOT4_OPEN_CHANNEL
;

599 
pCmd
->
psock‘
 = 
pc
->
sockid
;

600 
pCmd
->
ssock‘
 = 
pc
->
sockid
;

601 
pCmd
->
maxp2s
 = 
	`htÚs
(
HPMUD_BUFFER_SIZE
);

602 
pCmd
->
maxs2p
 = 
	`htÚs
(
HPMUD_BUFFER_SIZE
);

603 
pCmd
->
maxüed™
 = 
	`htÚs
(0xffff);

605 ià((
Ën
 = (
pd
->
vf
.
wr™e
)(
fd
, 
pCmd
, 
n
, 
HPMUD_EXCEPTION_TIMEOUT
)) !=‚)

607 
	`BUG
("unableo write Dot4OpenChannel: %m\n");

608 
¡©
 = 1;

609 
bugout
;

612 
¡©
 = 
	`DÙ4Rev”£R•ly
(
pc
, 
fd
, 
buf
, (buf));

613 
pR•ly
 = (
DOT4O³nChªÃlR•ly
 *)
buf
;

615 ià((
¡©
 !ğ0è|| (
pR•ly
->
cmd
 !ğ(0x80 | 
DOT4_OPEN_CHANNEL
)è|| (pR•ly->
»suÉ
 != 0))

617 
	`BUG
("šv®id DÙ4O³nChªÃlR•ly: cmd=%x,„esuÉ=%x\n", 
pR•ly
->
cmd
,…R•ly->
»suÉ
);

618 
¡©
 = 1;

619 
bugout
;

622 
pc
->

.
h2psize
 = 
	`Áohs
(
pR•ly
->
maxp2s
);

623 
pc
->

.
p2hsize
 = 
	`Áohs
(
pR•ly
->
maxs2p
);

624 
pc
->

.
h2püed™
 = 
	`Áohs
(
pR•ly
->
üed™
);

626 
bugout
:

627  
¡©
;

628 
	}
}

630 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
	$DÙ4Clo£ChªÃl
(
mud_chªÃl
 *
pc
, 
fd
)

632 
mud_deviû
 *
pd
 = &
m¥
->
deviû
[
pc
->
dšdex
];

633 
buf
[
HPMUD_BUFFER_SIZE
];

634 
¡©
=0, 
Ën
, 
n
;

635 
DOT4Clo£ChªÃl
 *
pCmd
;

636 
DOT4Clo£ChªÃlR•ly
 *
pR•ly
;

638 
	`mem£t
(
buf
, 0, (
DOT4Clo£ChªÃl
));

639 
pCmd
 = (
DOT4Clo£ChªÃl
 *)
buf
;

640 
n
 = (
DOT4Clo£ChªÃl
);

641 
pCmd
->
h
.
Ëngth
 = 
	`htÚs
(
n
);

642 
pCmd
->
h
.
üed™
 = 1;

643 
pCmd
->
cmd
 = 
DOT4_CLOSE_CHANNEL
;

644 
pCmd
->
psock‘
 = 
pc
->
sockid
;

645 
pCmd
->
ssock‘
 = 
pc
->
sockid
;

647 ià((
Ën
 = (
pd
->
vf
.
wr™e
)(
fd
, 
pCmd
, 
n
, 
HPMUD_EXCEPTION_TIMEOUT
)) !=‚)

649 
	`BUG
("unableo write Dot4CloseChannel: %m\n");

650 
¡©
 = 1;

651 
bugout
;

654 
¡©
 = 
	`DÙ4Rev”£R•ly
(
pc
, 
fd
, 
buf
, (buf));

655 
pR•ly
 = (
DOT4Clo£ChªÃlR•ly
 *)
buf
;

657 ià((
¡©
 !ğ0è|| (
pR•ly
->
cmd
 !ğ(0x80 | 
DOT4_CLOSE_CHANNEL
)è|| (pR•ly->
»suÉ
 != 0))

659 
	`BUG
("šv®id DÙ4Clo£ChªÃlR•ly: cmd=%x,„esuÉ=%x\n", 
pR•ly
->
cmd
,…R•ly->
»suÉ
);

660 
¡©
 = 1;

661 
bugout
;

664 
bugout
:

665  
¡©
;

666 
	}
}

668 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
	$DÙ4C»d™
(
mud_chªÃl
 *
pc
, 
fd
, 
üed™
)

670 
mud_deviû
 *
pd
 = &
m¥
->
deviû
[
pc
->
dšdex
];

671 
buf
[
HPMUD_BUFFER_SIZE
];

672 
¡©
=0, 
Ën
, 
n
;

673 
DOT4C»d™
 *
pCmd
;

674 
DOT4C»d™R•ly
 *
pR•ly
;

676 
	`mem£t
(
buf
, 0, (
DOT4C»d™
));

677 
pCmd
 = (
DOT4C»d™
 *)
buf
;

678 
n
 = (
DOT4C»d™
);

679 
pCmd
->
h
.
Ëngth
 = 
	`htÚs
(
n
);

680 
pCmd
->
h
.
üed™
 = 1;

681 
pCmd
->
cmd
 = 
DOT4_CREDIT
;

682 
pCmd
->
psock‘
 = 
pc
->
sockid
;

683 
pCmd
->
ssock‘
 = 
pc
->
sockid
;

684 
pCmd
->
üed™
 = 
	`htÚs
(credit);

686 ià((
Ën
 = (
pd
->
vf
.
wr™e
)(
fd
, 
pCmd
, 
n
, 
HPMUD_EXCEPTION_TIMEOUT
)) !=‚)

688 
	`BUG
("unableo write Dot4Credit: %m\n");

689 
¡©
 = 1;

690 
bugout
;

693 
¡©
 = 
	`DÙ4Rev”£R•ly
(
pc
, 
fd
, 
buf
, (buf));

694 
pR•ly
 = (
DOT4C»d™R•ly
 *)
buf
;

696 ià((
¡©
 !ğ0è|| (
pR•ly
->
cmd
 !ğ(0x80 | 
DOT4_CREDIT
)è|| (pR•ly->
»suÉ
 != 0))

698 
	`BUG
("šv®id DÙ4C»d™R•ly: cmd=%x,„esuÉ=%x\n", 
pR•ly
->
cmd
,…R•ly->
»suÉ
);

699 
¡©
 = 1;

700 
bugout
;

703 
pc
->

.
p2hüed™
 +ğ
üed™
;

705 
bugout
:

706  
¡©
;

707 
	}
}

709 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
	$DÙ4C»d™Reque¡
(
mud_chªÃl
 *
pc
, 
fd
, 
üed™
)

711 
mud_deviû
 *
pd
 = &
m¥
->
deviû
[
pc
->
dšdex
];

712 
buf
[
HPMUD_BUFFER_SIZE
];

713 
¡©
=0, 
Ën
, 
n
;

714 
DOT4C»d™Reque¡
 *
pCmd
;

715 
DOT4C»d™Reque¡R•ly
 *
pR•ly
;

717 
	`mem£t
(
buf
, 0, (
DOT4C»d™Reque¡
));

718 
pCmd
 = (
DOT4C»d™Reque¡
 *)
buf
;

719 
n
 = (
DOT4C»d™Reque¡
);

720 
pCmd
->
h
.
Ëngth
 = 
	`htÚs
(
n
);

721 
pCmd
->
h
.
üed™
 = 1;

722 
pCmd
->
cmd
 = 
DOT4_CREDIT_REQUEST
;

723 
pCmd
->
psock‘
 = 
pc
->
sockid
;

724 
pCmd
->
ssock‘
 = 
pc
->
sockid
;

726 
pCmd
->
maxüed™
 = 
	`htÚs
(0xffff);

728 ià((
Ën
 = (
pd
->
vf
.
wr™e
)(
fd
, 
pCmd
, 
n
, 
HPMUD_EXCEPTION_TIMEOUT
)) !=‚)

730 
	`BUG
("unableo write Dot4CreditRequest: %m\n");

731 
¡©
 = 1;

732 
bugout
;

735 
¡©
 = 
	`DÙ4Rev”£R•ly
(
pc
, 
fd
, 
buf
, (buf));

736 
pR•ly
 = (
DOT4C»d™Reque¡R•ly
 *)
buf
;

738 ià((
¡©
 !ğ0è|| (
pR•ly
->
cmd
 !ğ(0x80 | 
DOT4_CREDIT_REQUEST
)è|| (pR•ly->
»suÉ
 != 0))

740 
	`BUG
("šv®id DÙ4C»d™Reque¡R•ly: cmd=%x,„esuÉ=%x\n", 
pR•ly
->
cmd
,…R•ly->
»suÉ
);

741 
¡©
 = 1;

742 
bugout
;

745 
pc
->

.
h2püed™
 +ğ
	`Áohs
(
pR•ly
->
üed™
);

747 
bugout
:

748  
¡©
;

749 
	}
}

	@io/hpmud/dot4.h

26 #iâdeà
_DOT4_H


27 
	#_DOT4_H


	)

28 
	~"mlc.h
"

30 
	eDOT4_COMMAND


32 
	mDOT4_INIT
 = 
MLC_INIT
,

33 
	mDOT4_OPEN_CHANNEL
 = 
MLC_OPEN_CHANNEL
,

34 
	mDOT4_CLOSE_CHANNEL
 = 
MLC_CLOSE_CHANNEL
,

35 
	mDOT4_CREDIT
 = 
MLC_CREDIT
,

36 
	mDOT4_CREDIT_REQUEST
 = 
MLC_CREDIT_REQUEST
,

37 
	mDOT4_GET_SOCKET
 = 0x9,

38 
	mDOT4_GET_SERVICE
 = 0xa,

39 
	mDOT4_EXIT
 = 
MLC_EXIT
,

40 
	mDOT4_ERROR
 = 
MLC_ERROR


50 
	mpsid
;

51 
	mssid
;

52 
	mËngth
;

53 
	müed™
;

54 
	mcÚŒŞ
;

55 } 
	t__©Œibu‹__
((
	t·cked
)è
	tDOT4H—d”
;

59 
DOT4H—d”
 
	mh
;

60 
	mcmd
;

61 
	m»v
;

62 } 
	t__©Œibu‹__
((
	t·cked
)è
	tDOT4In™
;

66 
DOT4H—d”
 
	mh
;

67 
	mcmd
;

68 
	m»suÉ
;

69 
	m»v
;

70 } 
	t__©Œibu‹__
((
	t·cked
)è
	tDOT4In™R•ly
;

74 
DOT4H—d”
 
	mh
;

75 
	mcmd
;

76 } 
	t__©Œibu‹__
((
	t·cked
)è
	tDOT4Ex™
;

80 
DOT4H—d”
 
	mh
;

81 
	mcmd
;

82 
	m»suÉ
;

83 } 
	t__©Œibu‹__
((
	t·cked
)è
	tDOT4Ex™R•ly
;

87 
DOT4H—d”
 
	mh
;

88 
	mcmd
;

89 
	mpsock‘
;

90 
	mssock‘
;

91 
	mmaxp2s
;

92 
	mmaxs2p
;

93 
	mmaxüed™
;

94 } 
	t__©Œibu‹__
((
	t·cked
)è
	tDOT4O³nChªÃl
;

98 
DOT4H—d”
 
	mh
;

99 
	mcmd
;

100 
	m»suÉ
;

101 
	mpsock‘
;

102 
	mssock‘
;

103 
	mmaxp2s
;

104 
	mmaxs2p
;

105 
	mmaxüed™
;

106 
	müed™
;

107 } 
	t__©Œibu‹__
((
	t·cked
)è
	tDOT4O³nChªÃlR•ly
;

111 
DOT4H—d”
 
	mh
;

112 
	mcmd
;

113 
	mpsock‘
;

114 
	mssock‘
;

115 } 
	t__©Œibu‹__
((
	t·cked
)è
	tDOT4Clo£ChªÃl
;

119 
DOT4H—d”
 
	mh
;

120 
	mcmd
;

121 
	m»suÉ
;

122 
	mpsock‘
;

123 
	mssock‘
;

124 } 
	t__©Œibu‹__
((
	t·cked
)è
	tDOT4Clo£ChªÃlR•ly
;

128 
DOT4H—d”
 
	mh
;

129 
	mcmd
;

130 
	m»suÉ
;

131 
	msock‘
;

132 } 
	t__©Œibu‹__
((
	t·cked
)è
	tDOT4G‘Sock‘R•ly
;

136 
DOT4H—d”
 
	mh
;

137 
	mcmd
;

138 
	mpsock‘
;

139 
	mssock‘
;

140 
	müed™
;

141 } 
	t__©Œibu‹__
((
	t·cked
)è
	tDOT4C»d™
;

145 
DOT4H—d”
 
	mh
;

146 
	mcmd
;

147 
	mpsock‘
;

148 
	mssock‘
;

149 
	mmaxüed™
;

150 } 
	t__©Œibu‹__
((
	t·cked
)è
	tDOT4C»d™Reque¡
;

154 
DOT4H—d”
 
	mh
;

155 
	mcmd
;

156 
	m»suÉ
;

157 
	mpsock‘
;

158 
	mssock‘
;

159 
	müed™
;

160 } 
	t__©Œibu‹__
((
	t·cked
)è
	tDOT4C»d™Reque¡R•ly
;

164 
DOT4H—d”
 
	mh
;

165 
	mcmd
;

166 
	mpsock‘
;

167 
	mssock‘
;

168 
	m”rÜ
;

169 } 
	t__©Œibu‹__
((
	t·cked
)è
	tDOT4E¼Ü
;

171 
DOT4Ex™R•ly
 
	tDOT4R•ly
;

172 
DOT4Ex™
 
	tDOT4Cmd
;

173 
DOT4Clo£ChªÃlR•ly
 
	tDOT4C»d™R•ly
;

174 
DOT4Ex™
 
	tDOT4G‘Sock‘
;

176 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
DÙ4Rev”£Cmd
(
_mud_chªÃl
 *
pc
, 
fd
);

177 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
DÙ4In™
(
_mud_chªÃl
 *
pc
, 
fd
);

178 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
DÙ4Ex™
(
_mud_chªÃl
 *
pc
, 
fd
);

179 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
DÙ4G‘Sock‘
(
_mud_chªÃl
 *
pc
, 
fd
);

180 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
DÙ4FÜw¬dD©a
(
_mud_chªÃl
 *
pc
, 
fd
, cÚ¡ *
buf
, 
size
, 
u£c_timeout
);

181 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
DÙ4Rev”£D©a
(
_mud_chªÃl
 *
pc
, 
fd
, *
buf
, 
Ëngth
, 
u£c_timeout
);

182 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
DÙ4O³nChªÃl
(
_mud_chªÃl
 *
pc
, 
fd
);

183 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
DÙ4Clo£ChªÃl
(
_mud_chªÃl
 *
pc
, 
fd
);

184 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
DÙ4C»d™
(
_mud_chªÃl
 *
pc
, 
fd
, 
üed™
);

185 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
DÙ4C»d™Reque¡
(
_mud_chªÃl
 *
pc
, 
fd
, 
üed™
);

	@io/hpmud/hpmud.c

28 
	~"hpmud.h
"

29 
	~"hpmudi.h
"

32 
mud_£ssiÚ
 
ms
 
__©Œibu‹__
 ((
visib™y
 ("hidden")));

33 
mud_£ssiÚ
 *
m¥
 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))èğ&
ms
;

38 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
	$sysdump
(cÚ¡ *
d©a
, 
size
)

44 *
p
 = (*)
d©a
;

45 
c
;

46 
n
;

47 
by‹¡r
[4] = {0};

48 
addr¡r
[10] = {0};

49 
hex¡r
[16*3 + 5] = {0};

50 
ch¬¡r
[16*1 + 5] = {0};

51 
n
=1;n<=
size
;n++) {

52 ià(
n
%16 == 1) {

54 
	`¢´štf
(
addr¡r
, ×ddr¡r), "%.4d", ()((
p
-(*)
d©a
) & 0xffff));

57 
c
 = *
p
;

58 ià(
	`i¥ršt
(
c
) == 0) {

59 
c
 = '.';

63 
	`¢´štf
(
by‹¡r
, (by‹¡r), "%02X ", *
p
);

64 
	`¡ºÿt
(
hex¡r
, 
by‹¡r
, (hex¡r)-
	`¡¾’
(hexstr)-1);

67 
	`¢´štf
(
by‹¡r
, (by‹¡r), "%c", 
c
);

68 
	`¡ºÿt
(
ch¬¡r
, 
by‹¡r
, (ch¬¡r)-
	`¡¾’
(charstr)-1);

70 if(
n
%16 == 0) {

72 
	`DBG_SZ
("[%4.4s] %-50.50  %s\n", 
addr¡r
, 
hex¡r
, 
ch¬¡r
);

73 
hex¡r
[0] = 0;

74 
ch¬¡r
[0] = 0;

76 
p
++;

79 ià(
	`¡¾’
(
hex¡r
) > 0) {

81 
	`DBG_SZ
("[%4.4s] %-50.50  %s\n", 
addr¡r
, 
hex¡r
, 
ch¬¡r
);

83 
	}
}

86 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
	$is_hp
(cÚ¡ *
id
)

88 *
pMf
;

89 ià(
id
 == 0 || id[0] == 0)

92 ià((
pMf
 = 
	`¡r¡r
(
id
, "MFG:")è!ğ
NULL
)

93 
pMf
+=4;

94 ià((
pMf
 = 
	`¡r¡r
(
id
, "MANUFACTURER:")è!ğ
NULL
)

95 
pMf
+=13;

99 ià((
	`¡ºÿ£cmp
(
pMf
, "HEWLETT-PACKARD", 15) == 0) ||

100 (
	`¡ºÿ£cmp
(
pMf
, "APOLLO", 6) == 0) || (strncasecmp(pMf, "HP", 2) == 0))

105 
	}
}

107 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
	$g’”®ize_mod–
(cÚ¡ *
sz
, *
buf
, 
bufSize
)

109 cÚ¡ *
pMd
=
sz
;

110 
i
, 
j
, 
dd
=0;

112 ià(
sz
 == 0 || sz[0] == 0)

116 
i
=0; 
pMd
[i] =ğ' ' && i < 
bufSize
; i++);

118 
j
=0; (
pMd
[
i
] !ğ0è&& (pMd[i] !ğ';'è&& (j < 
bufSize
); i++)

120 ià(
pMd
[
i
]==' ' ||…Md[i]=='/')

123 ià(!
dd
)

125 
buf
[
j
++] = '_';

126 
dd
=1;

131 
buf
[
j
++] = 
pMd
[
i
];

132 
dd
=0;

136 
j
--; 
buf
[j] == '_' && j > 0; j--);

138 
buf
[++
j
] = 0;

140  
j
;

141 
	}
}

143 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
	$g’”®ize_£rŸl
(cÚ¡ *
sz
, *
buf
, 
bufSize
)

145 cÚ¡ *
pMd
=
sz
;

146 
i
, 
j
;

148 ià(
sz
 == 0 || sz[0] == 0)

151 
i
=0; 
pMd
[i] =ğ' ' && i < 
bufSize
; i++);

153 
j
=0; (
pMd
[
i
] !ğ0è&& (˜< 
bufSize
); i++)

155 
buf
[
j
++] = 
pMd
[
i
];

158 
i
--; 
buf
[i] == ' ' && i > 0; i--);

160 
buf
[++
i
] = 0;

162  
i
;

163 
	}
}

166 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
	$g‘_uri_£rŸl
(cÚ¡ *
uri
, *
buf
, 
bufSize
)

168 *
p
;

169 
i
;

171 ià(
uri
 == 0 || uri[0] == 0)

174 
buf
[0] = 0;

176 ià((
p
 = 
	`¡rÿ£¡r
(
uri
, "£rŸl=")è!ğ
NULL
)

177 
p
+=7;

181 
i
=0; (
p
[i] !ğ0è&& (p[i] !ğ'+'è&& (˜< 
bufSize
); i++)

182 
buf
[
i
] = 
p
[i];

184 
buf
[
i
] = 0;

186  
i
;

187 
	}
}

189 
HPMUD_RESULT
 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
	$£rviû_to_chªÃl
(
mud_deviû
 *
pd
, cÚ¡ *
¢
, 
HPMUD_CHANNEL
 *
šdex
)

191 
HPMUD_RESULT
 
¡©
;

193 *
šdex
=-1;

196 ià(
	`¡ºÿ£cmp
(
¢
, "print", 5) == 0)

198 *
šdex
 = 
HPMUD_PRINT_CHANNEL
;

200 ià(
	`¡ºÿ£cmp
(
¢
, "hp-ews-ledm", 11) == 0)

202 *
šdex
 = 
HPMUD_EWS_LEDM_CHANNEL
;

204 ià(
	`¡ºÿ£cmp
(
¢
, "hp-ews", 6) == 0)

206 *
šdex
 = 
HPMUD_EWS_CHANNEL
;

208 ià(
	`¡ºÿ£cmp
(
¢
, "hp-soap-scan", 12) == 0)

210 *
šdex
 = 
HPMUD_SOAPSCAN_CHANNEL
;

212 ià(
	`¡ºÿ£cmp
(
¢
, "hp-soap-fax", 11) == 0)

214 *
šdex
 = 
HPMUD_SOAPFAX_CHANNEL
;

216 ià(
	`¡ºÿ£cmp
(
¢
, "hp-marvell-scan", 15) == 0)

218 *
šdex
 = 
HPMUD_MARVELL_SCAN_CHANNEL
;

220 ià(
	`¡ºÿ£cmp
(
¢
, "hp-marvell-fax", 14) == 0)

222 *
šdex
 = 
HPMUD_MARVELL_FAX_CHANNEL
;

224 ià(
	`¡ºÿ£cmp
(
¢
, "hp-ledm-scan", 12) == 0)

226 *
šdex
 = 
HPMUD_LEDM_SCAN_CHANNEL
;

228 ià(
	`¡ºÿ£cmp
(
¢
, "hp-marvell-ews", 11) == 0)

230 *
šdex
 = 
HPMUD_MARVELL_EWS_CHANNEL
;

232 ià(
	`¡ºÿ£cmp
(
¢
, "hp-ipp", 6) == 0)

234 ià(
	`¡ºÿ£cmp
(
¢
, "hp-ipp2", 7) == 0)

235 *
šdex
 = 
HPMUD_IPP_CHANNEL2
;

237 *
šdex
 = 
HPMUD_IPP_CHANNEL
;

239 ià(
	`¡ºÿ£cmp
(
¢
, "hp-escl-scan", 12) == 0)

241 *
šdex
 = 
HPMUD_ESCL_SCAN_CHANNEL
;

244 ià(
pd
->
io_mode
 =ğ
HPMUD_RAW_MODE
 ||…d->io_mod=ğ
HPMUD_UNI_MODE
)

246 
	`BUG
("šv®id chªÃl_İ’ s‹, cu¼’ˆio_modeôaw/un˜£rviû=% %s\n", 
¢
, 
pd
->
uri
);

247 
¡©
 = 
HPMUD_R_INVALID_STATE
;

248 
bugout
;

250 ià(
	`¡ºÿ£cmp
(
¢
, "hp-message", 10) == 0)

252 *
šdex
 = 
HPMUD_PML_CHANNEL
;

254 ià(
	`¡ºÿ£cmp
(
¢
, "hp-scan", 7) == 0)

256 *
šdex
 = 
HPMUD_SCAN_CHANNEL
;

258 ià(
	`¡ºÿ£cmp
(
¢
, "hp-fax-send", 11) == 0)

260 *
šdex
 = 
HPMUD_FAX_SEND_CHANNEL
;

262 ià(
	`¡ºÿ£cmp
(
¢
, "hp-card-access", 14) == 0)

264 *
šdex
 = 
HPMUD_MEMORY_CARD_CHANNEL
;

266 ià(
	`¡ºÿ£cmp
(
¢
, "hp-configuration-upload", 23) == 0)

268 *
šdex
 = 
HPMUD_CONFIG_UPLOAD_CHANNEL
;

270 ià(
	`¡ºÿ£cmp
(
¢
, "hp-configuration-download", 25) == 0)

272 *
šdex
 = 
HPMUD_CONFIG_DOWNLOAD_CHANNEL
;

274 ià(
	`¡ºÿ£cmp
(
¢
, "hp-devmgmt", 10) == 0)

276 *
šdex
 = 
HPMUD_DEVMGMT_CHANNEL
;

278 ià(
	`¡ºÿ£cmp
(
¢
, "hp-wificonfig", 13) == 0)

280 *
šdex
 = 
HPMUD_WIFI_CHANNEL
;

284 
	`BUG
("šv®id s”viû=% %s\n", 
¢
, 
pd
->
uri
);

285 
¡©
 = 
HPMUD_R_INVALID_SN
;

286 
bugout
;

289 
¡©
 = 
HPMUD_R_OK
;

291 
bugout
:

292  
¡©
;

293 
	}
}

296 
	$Ãw_deviû
(cÚ¡ *
uri
, 
HPMUD_IO_MODE
 
mode
, *
»suÉ
)

298 
šdex
=0;

299 
i
=1;

301 ià(
uri
 == 0 || uri[0] == 0)

304 
	`±h»ad_mu‹x_lock
(&
m¥
->
mu‹x
);

306 ià(
m¥
->
deviû
[
i
].
šdex
)

308 
	`BUG
("invalid device_open state\n");

309 *
»suÉ
 = 
HPMUD_R_INVALID_STATE
;

310 
bugout
;

313 
šdex
 = 
i
;

316 ià(
	`¡rÿ£¡r
(
uri
, ":/usb"è!ğ
NULL
)

318 
m¥
->
deviû
[
i
].
vf
 = 
musb_mud_deviû_vf
;

320 #ifdeà
HAVE_LIBNETSNMP


321 ià(
	`¡rÿ£¡r
(
uri
, ":/Ãt"è!ğ
NULL
)

323 
m¥
->
deviû
[
i
].
vf
 = 
jd_mud_deviû_vf
;

326 #ifdeà
HAVE_PPORT


327 ià(
	`¡rÿ£¡r
(
uri
, ":/·r"è!ğ
NULL
)

329 
m¥
->
deviû
[
i
].
vf
 = 
µ_mud_deviû_vf
;

334 
	`BUG
("šv®id ur˜%s\n", 
uri
);

335 *
»suÉ
 = 
HPMUD_R_INVALID_URI
;

336 
šdex
 = 0;

337 
bugout
;

339 *
»suÉ
 = 
HPMUD_R_OK
;

340 
m¥
->
deviû
[
i
].
io_mode
 = 
mode
;

341 
m¥
->
deviû
[
i
].
šdex
 = index;

342 
m¥
->
deviû
[
i
].
chªÃl_út
 = 0;

343 
m¥
->
deviû
[
i
].
İ’_fd
 = -1;

344 
	`¡rıy
(
m¥
->
deviû
[
i
].
uri
, uri);

346 
bugout
:

347 
	`±h»ad_mu‹x_uÆock
(&
m¥
->
mu‹x
);

349  
šdex
;

350 
	}
}

352 
	$d–_deviû
(
HPMUD_DEVICE
 
šdex
)

354 
	`±h»ad_mu‹x_lock
(&
m¥
->
mu‹x
);

356 
m¥
->
deviû
[
šdex
].index = 0;

358 
	`±h»ad_mu‹x_uÆock
(&
m¥
->
mu‹x
);

361 
	}
}

364 
	$deviû_ş—nup
(
mud_£ssiÚ
 *
ps
)

366 
i
, 
dd
=1;

368 ià(!
ps
)  0;

370 if(!
ps
->
deviû
[
dd
].
šdex
)

373 
	`BUG
("deviû_ş—nup: deviû uri=%s\n", 
ps
->
deviû
[
dd
].
uri
);

375 
i
=0; i<
HPMUD_CHANNEL_MAX
; i++)

377 ià(
ps
->
deviû
[
dd
].
chªÃl
[
i
].
ş›Á_út
)

379 
	`BUG
("deviû_ş—nup: clo£ chªÃÈ%d...\n", 
i
);

380 
	`hpmud_şo£_chªÃl
(
dd
, 
ps
->
deviû
[dd].
chªÃl
[
i
].
šdex
);

381 
	`BUG
("deviû_ş—nup: dÚşosšg chªÃÈ%d\n", 
i
);

385 
	`BUG
("deviû_ş—nup: clo£ deviû dd=%d...\n", 
dd
);

386 
	`hpmud_şo£_deviû
(
dd
);

387 
	`BUG
("deviû_ş—nup: dÚşosšg deviû dd=%d\n", 
dd
);

390 
	}
}

392 
__©Œibu‹__
 ((
cÚ¡ruùÜ
)è
	$mud_š™
()

394 
	`DBG
("[%d] hpmud_š™()\n", 
	`g‘pid
());

395 
	}
}

397 
__©Œibu‹__
 ((
de¡ruùÜ
)è
	$mud_ex™
()

399 
	`DBG
("[%d] hpmud_ex™()\n", 
	`g‘pid
());

400 
	`deviû_ş—nup
(
m¥
);

401 
	}
}

408 
	$hpmud_g‘_mod–
(cÚ¡ *
id
, *
buf
, 
buf_size
)

410 *
pMd
;

412 ià(
id
 == 0 || id[0] == 0)

415 
buf
[0] = 0;

417 ià((
pMd
 = 
	`¡r¡r
(
id
, "MDL:")è!ğ
NULL
)

418 
pMd
+=4;

419 ià((
pMd
 = 
	`¡r¡r
(
id
, "MODEL:")è!ğ
NULL
)

420 
pMd
+=6;

424  
	`g’”®ize_mod–
(
pMd
, 
buf
, 
buf_size
);

425 
	}
}

428 
	$hpmud_g‘_¿w_mod–
(*
id
, *
¿w
, 
¿wSize
)

430 *
pMd
;

431 
i
;

433 ià(
id
 == 0 || id[0] == 0)

436 
¿w
[0] = 0;

438 ià((
pMd
 = 
	`¡r¡r
(
id
, "MDL:")è!ğ
NULL
)

439 
pMd
+=4;

440 ià((
pMd
 = 
	`¡r¡r
(
id
, "MODEL:")è!ğ
NULL
)

441 
pMd
+=6;

445 
i
=0; (
pMd
[i] !ğ';'è&& (˜< 
¿wSize
); i++)

446 
¿w
[
i
] = 
pMd
[i];

447 
¿w
[
i
] = 0;

449  
i
;

450 
	}
}

453 
	$hpmud_g‘_uri_mod–
(cÚ¡ *
uri
, *
buf
, 
buf_size
)

455 *
p
;

456 
i
;

458 ià(
uri
 == 0 || uri[0] == 0)

461 
buf
[0] = 0;

463 ià((
p
 = 
	`¡r¡r
(
uri
, "/")è=ğ
NULL
)

465 ià((
p
 = 
	`¡r¡r
Õ+1, "/")è=ğ
NULL
)

467 
p
++;

469 
i
=0; (
p
[i] !ğ'?'è&& (˜< 
buf_size
); i++)

470 
buf
[
i
] = 
p
[i];

472 
buf
[
i
] = 0;

474  
i
;

475 
	}
}

478 
	$hpmud_g‘_uri_d©®šk
(cÚ¡ *
uri
, *
buf
, 
buf_size
)

480 *
p
;

481 
i
;

482 
zc
=0;

483 #ifdeà
HAVE_LIBNETSNMP


484 

[
HPMUD_LINE_SIZE
];

487 ià(
uri
 == 0 || uri[0] == 0)

490 
buf
[0] = 0;

492 ià((
p
 = 
	`¡rÿ£¡r
(
uri
, "deviû=")è!ğ
NULL
)

493 
p
+=7;

494 ià((
p
 = 
	`¡rÿ£¡r
(
uri
, "=")è!ğ
NULL
)

495 
p
+=3;

496 ià((
p
 = 
	`¡rÿ£¡r
(
uri
, "ho¡Çme=")è!ğ
NULL
)

497 
p
+=9;

498 ià((
p
 = 
	`¡rÿ£¡r
(
uri
, "zc=")è!ğ
NULL
)

500 
p
+=3;

501 
zc
=1;

506 ià(
zc
)

508 #ifdeà
HAVE_LIBNETSNMP


509 ià(
	`mdns_lookup
(
p
, 

è!ğ
MDNS_STATUS_OK
)

511 
i
=0; (

[i] !ğ0è&& (˜< 
buf_size
); i++)

512 
buf
[
i
] = 

[i];

518 
i
=0; (
p
[i] !ğ0è&& (p[i] !ğ'&'è&& (˜< 
buf_size
); i++)

519 
buf
[
i
] = 
p
[i];

522 
buf
[
i
] = 0;

524  
i
;

525 
	}
}

531 
HPMUD_RESULT
 
	$hpmud_İ’_deviû
(cÚ¡ *
uri
, 
HPMUD_IO_MODE
 
iomode
, 
HPMUD_DEVICE
 *
dd
)

533 
HPMUD_DEVICE
 
šdex
=0;

534 
HPMUD_RESULT
 
¡©
 = 
HPMUD_R_INVALID_URI
;

535 
»suÉ
;

537 
	`DBG
("[%d,%d,%d,%d,%d,%d] hpmud_deviû_İ’(èuri=% iomode=%d\n", 
	`g‘pid
(), 
	`g‘µid
(), 
	`g‘uid
(), 
	`g‘euid
(), 
	`g‘gid
(), 
	`g‘egid
(), 
uri
, 
iomode
);

539 ià((
šdex
 = 
	`Ãw_deviû
(
uri
, 
iomode
, &
»suÉ
)) == 0)

541 
¡©
 = 
»suÉ
;

542 
bugout
;

546 ià((
¡©
 = (
m¥
->
deviû
[
šdex
].
vf
.
İ’
)(&m¥->deviû[šdex])è!ğ
HPMUD_R_OK
)

548 (
m¥
->
deviû
[
šdex
].
vf
.
şo£
)(&msp->device[index]);

549 
	`d–_deviû
(
šdex
);

550 
bugout
;

554 *
dd
 = 
šdex
;

555 
¡©
 = 
HPMUD_R_OK
;

557 
bugout
:

558  
¡©
;

559 
	}
}

561 
HPMUD_RESULT
 
	$hpmud_şo£_deviû
(
HPMUD_DEVICE
 
dd
)

563 
HPMUD_RESULT
 
¡©
;

565 
	`DBG
("[%d] hpmud_deviû_şo£(èdd=%d\n", 
	`g‘pid
(), 
dd
);

567 ià(
dd
 <ğ0 || dd > 
HPMUD_DEVICE_MAX
 || 
m¥
->
deviû
[dd].
šdex
 != dd)

569 
	`BUG
("invalid device_close state\n");

570 
¡©
 = 
HPMUD_R_INVALID_STATE
;

574 
¡©
 = (
m¥
->
deviû
[
dd
].
vf
.
şo£
)(&msp->device[dd]);

575 
	`d–_deviû
(
dd
);

577  
¡©
;

578 
	}
}

580 
HPMUD_RESULT
 
	$hpmud_g‘_deviû_id
(
HPMUD_DEVICE
 
dd
, *
buf
, 
size
, *
by‹s_»ad
)

582 
HPMUD_RESULT
 
¡©
 = 
HPMUD_R_INVALID_STATE
;

584 
	`DBG
("[%d] hpmud_g‘_deviû_id(èdd=%d\n", 
	`g‘pid
(), 
dd
);

586 ià(
dd
 <ğ0 || dd > 
HPMUD_DEVICE_MAX
 || 
m¥
->
deviû
[dd].
šdex
 != dd)

588 
	`BUG
("invalid get_device_id state\n");

589 
bugout
;

592 
¡©
 = (
m¥
->
deviû
[
dd
].
vf
.
g‘_deviû_id
)(&m¥->deviû[dd], 
buf
, 
size
, 
by‹s_»ad
);

594 
bugout
:

595  
¡©
;

596 
	}
}

598 
HPMUD_RESULT
 
	$hpmud_g‘_deviû_¡©us
(
HPMUD_DEVICE
 
dd
, *
¡©us
)

600 
HPMUD_RESULT
 
¡©
 = 
HPMUD_R_INVALID_STATE
;

602 
	`DBG
("[%d] hpmud_g‘_deviû_¡©us(èdd=%d\n", 
	`g‘pid
(), 
dd
);

604 ià(
dd
 <ğ0 || dd > 
HPMUD_DEVICE_MAX
 || 
m¥
->
deviû
[dd].
šdex
 != dd)

606 
	`BUG
("invalid get_device_status state\n");

607 
bugout
;

610 
¡©
 = (
m¥
->
deviû
[
dd
].
vf
.
g‘_deviû_¡©us
)(&m¥->deviû[dd], 
¡©us
);

612 
bugout
:

613  
¡©
;

614 
	}
}

616 
HPMUD_RESULT
 
	$hpmud_´obe_deviûs
(
HPMUD_BUS_ID
 
bus
, *
buf
, 
buf_size
, *
út
, *
by‹s_»ad
)

618 
Ën
=0;

620 
	`DBG
("[%d] hpmud_´obe_deviûs(èbus=%d\n", 
	`g‘pid
(), 
bus
);

621 ià(
buf
 =ğ
NULL
 || 
buf_size
 <= 0)

622  
HPMUD_R_INVALID_LENGTH
;

624 
buf
[0] = 0;

625 *
út
 = 0;

627 ià(
bus
 =ğ
HPMUD_BUS_USB
)

629 
Ën
 = 
	`musb_´obe_deviûs
(
buf
, 
buf_size
, 
út
, 
HPMUD_AIO
);

631 #ifdeà
HAVE_PPORT


632 ià(
bus
 =ğ
HPMUD_BUS_PARALLEL
)

634 
Ën
 = 
	`µ_´obe_deviûs
(
buf
, 
buf_size
, 
út
);

637 ià(
bus
 =ğ
HPMUD_BUS_ALL
)

639 
Ën
 = 
	`musb_´obe_deviûs
(
buf
, 
buf_size
, 
út
, 
HPMUD_AIO
);

640 #ifdeà
HAVE_PPORT


641 
Ën
 +ğ
	`µ_´obe_deviûs
(
buf
+Ën, 
buf_size
-Ën, 
út
);

645 *
by‹s_»ad
 = 
Ën
;

647  
HPMUD_R_OK
;

648 
	}
}

650 
HPMUD_RESULT
 
	$hpmud_´obe_´š‹rs
(
HPMUD_BUS_ID
 
bus
, *
buf
, 
buf_size
, *
út
, *
by‹s_»ad
)

652 
Ën
=0;

654 
	`DBG
("[%d] hpmud_´obe_´š‹rs(èbus=%d\n", 
	`g‘pid
(), 
bus
);

656 ià(
buf
 =ğ
NULL
 || 
buf_size
 <= 0)

657  
HPMUD_R_INVALID_LENGTH
;

659 
buf
[0] = 0;

660 *
út
 = 0;

662 ià(
bus
 =ğ
HPMUD_BUS_ALL
)

664 
Ën
 = 
	`musb_´obe_deviûs
(
buf
, 
buf_size
, 
út
, 
HPMUD_PRINTER
);

665 #ifdeà
HAVE_PPORT


666 
Ën
 +ğ
	`µ_´obe_deviûs
(
buf
+Ën, 
buf_size
-Ën, 
út
);

670 *
by‹s_»ad
 = 
Ën
;

672  
HPMUD_R_OK
;

673 
	}
}

675 
HPMUD_RESULT
 
	$hpmud_İ’_chªÃl
(
HPMUD_DEVICE
 
dd
, cÚ¡ *
chªÃl_Çme
, 
HPMUD_CHANNEL
 *
cd
)

677 
HPMUD_RESULT
 
¡©
 = 
HPMUD_R_INVALID_STATE
;

679 
	`DBG
("[%d] hpmud_chªÃl_İ’(èdd=%d‚ame=%s\n", 
	`g‘pid
(), 
dd
, 
chªÃl_Çme
);

681 ià(
dd
 <ğ0 || dd > 
HPMUD_DEVICE_MAX
 || 
m¥
->
deviû
[dd].
šdex
 != dd)

683 
	`BUG
("invalid channel_open state\n");

684 
bugout
;

687 
¡©
 = (
m¥
->
deviû
[
dd
].
vf
.
chªÃl_İ’
)(&m¥->deviû[dd], 
chªÃl_Çme
, 
cd
);

689 
bugout
:

690  
¡©
;

691 
	}
}

693 
HPMUD_RESULT
 
	$hpmud_şo£_chªÃl
(
HPMUD_DEVICE
 
dd
, 
HPMUD_CHANNEL
 
cd
)

695 
HPMUD_RESULT
 
¡©
 = 
HPMUD_R_INVALID_STATE
;

697 
	`DBG
("[%d] hpmud_chªÃl_şo£(èdd=%d cd=%d\n", 
	`g‘pid
(), 
dd
, 
cd
);

699 ià(
dd
 <ğ0 || dd > 
HPMUD_DEVICE_MAX
 || 
m¥
->
deviû
[dd].
šdex
 != dd ||

700 
cd
 <=0 || cd > 
HPMUD_CHANNEL_MAX
 || 
m¥
->
deviû
[
dd
].
chªÃl
[cd].
ş›Á_út
 == 0)

702 
	`BUG
("invalid channel_close state\n");

703 
bugout
;

706 
¡©
 = (
m¥
->
deviû
[
dd
].
vf
.
chªÃl_şo£
)(&m¥->deviû[dd], &m¥->deviû[dd].
chªÃl
[
cd
]);

708 
bugout
:

709  
¡©
;

710 
	}
}

712 
HPMUD_RESULT
 
	$hpmud_wr™e_chªÃl
(
HPMUD_DEVICE
 
dd
, 
HPMUD_CHANNEL
 
cd
, cÚ¡ *
buf
, 
size
, 
£c_timeout
, *
by‹s_wrÙe
)

714 
HPMUD_RESULT
 
¡©
 = 
HPMUD_R_INVALID_STATE
;

716 
	`DBG
("[%d] hpmud_chªÃl_wr™e(èdd=%d cd=%d buf=%°size=%d seùime=%d\n", 
	`g‘pid
(), 
dd
, 
cd
, 
buf
, 
size
, 
£c_timeout
);

718 ià(
dd
 <ğ0 || dd > 
HPMUD_DEVICE_MAX
 || 
m¥
->
deviû
[dd].
šdex
 != dd ||

719 
cd
 <=0 || cd > 
HPMUD_CHANNEL_MAX
 || 
m¥
->
deviû
[
dd
].
chªÃl
[cd].
ş›Á_út
 == 0)

721 
	`BUG
("invalid channel_write state\n");

722 
bugout
;

725 
¡©
 = (
m¥
->
deviû
[
dd
].
vf
.
chªÃl_wr™e
)(&m¥->deviû[dd], &m¥->deviû[dd].
chªÃl
[
cd
], 
buf
, 
size
, 
£c_timeout
, 
by‹s_wrÙe
);

727 
bugout
:

728  
¡©
;

729 
	}
}

731 
HPMUD_RESULT
 
	$hpmud_»ad_chªÃl
(
HPMUD_DEVICE
 
dd
, 
HPMUD_CHANNEL
 
cd
, *
buf
, 
size
, 
£c_timeout
, *
by‹s_»ad
)

733 
HPMUD_RESULT
 
¡©
 = 
HPMUD_R_INVALID_STATE
;

734 
	`DBG
("[%d] hpmud_chªÃl_»ad(èdd=%d cd=%d buf=%°size=%d seùime=%d\n", 
	`g‘pid
(), 
dd
, 
cd
, 
buf
, 
size
, 
£c_timeout
);

736 ià(
dd
 <ğ0 || dd > 
HPMUD_DEVICE_MAX
 || 
m¥
->
deviû
[dd].
šdex
 != dd ||

737 
cd
 <=0 || cd > 
HPMUD_CHANNEL_MAX
 || 
m¥
->
deviû
[
dd
].
chªÃl
[cd].
ş›Á_út
 == 0)

739 
	`BUG
("invalid channel_read state\n");

740 
bugout
;

743 
¡©
 = (
m¥
->
deviû
[
dd
].
vf
.
chªÃl_»ad
)(&m¥->deviû[dd], &m¥->deviû[dd].
chªÃl
[
cd
], 
buf
, 
size
, 
£c_timeout
, 
by‹s_»ad
);

745 
bugout
:

746  
¡©
;

747 
	}
}

749 
HPMUD_RESULT
 
	$hpmud_g‘_d¡©
(
HPMUD_DEVICE
 
dd
, 
hpmud_d¡©
 *
ds
)

751 
HPMUD_RESULT
 
¡©
 = 
HPMUD_R_INVALID_STATE
;

753 
	`DBG
("[%d] hpmud_d¡©(èdd=%d ds=%p\n", 
	`g‘pid
(), 
dd
, 
ds
);

755 ià(
dd
 <ğ0 || dd > 
HPMUD_DEVICE_MAX
)

757 
	`BUG
("invalid dstat state\n");

758 
bugout
;

761 
	`¡ºıy
(
ds
->
uri
, 
m¥
->
deviû
[
dd
].uri, (ds->uri));

762 
ds
->
io_mode
 = 
m¥
->
deviû
[
dd
].io_mode;

763 
ds
->
chªÃl_út
 = 
m¥
->
deviû
[
dd
].channel_cnt;

764 
ds
->
mlc_up
 = 
m¥
->
deviû
[
dd
].mlc_up;

766 
¡©
 = 
HPMUD_R_OK
;

768 
bugout
:

769  
¡©
;

770 
	}
}

	@io/hpmud/hpmud.h

27 #iâdeà
_HPMUD_H


28 
	#_HPMUD_H


	)

30 
	eHPMUD_RESULT


32 
	mHPMUD_R_OK
 = 0,

33 
	mHPMUD_R_INVALID_DEVICE
 = 2,

34 
	mHPMUD_R_INVALID_DESCRIPTOR
 = 3,

35 
	mHPMUD_R_INVALID_URI
 = 4,

36 
	mHPMUD_R_INVALID_LENGTH
 = 8,

37 
	mHPMUD_R_IO_ERROR
 = 12,

38 
	mHPMUD_R_DEVICE_BUSY
 = 21,

39 
	mHPMUD_R_INVALID_SN
 = 28,

40 
	mHPMUD_R_INVALID_CHANNEL_ID
 = 30,

41 
	mHPMUD_R_INVALID_STATE
 = 31,

42 
	mHPMUD_R_INVALID_DEVICE_OPEN
 = 37,

43 
	mHPMUD_R_INVALID_DEVICE_NODE
 = 38,

44 
	mHPMUD_R_INVALID_IP
 = 45,

45 
	mHPMUD_R_INVALID_IP_PORT
 = 46,

46 
	mHPMUD_R_INVALID_TIMEOUT
 = 47,

47 
	mHPMUD_R_DATFILE_ERROR
 = 48,

48 
	mHPMUD_R_IO_TIMEOUT
 = 49,

49 
	mHPMUD_R_INVALID_MDNS
 = 50,

52 
	eHPMUD_IO_MODE


54 
	mHPMUD_UNI_MODE
=0,

55 
	mHPMUD_RAW_MODE
=1,

56 
	mHPMUD_DOT4_MODE
=3,

57 
	mHPMUD_DOT4_PHOENIX_MODE
=4,

58 
	mHPMUD_DOT4_BRIDGE_MODE
=5,

59 
	mHPMUD_MLC_GUSHER_MODE
=6,

60 
	mHPMUD_MLC_MISER_MODE
=7,

63 
	eHPMUD_BUS_ID


65 
	mHPMUD_BUS_NA
=0,

66 
	mHPMUD_BUS_USB
=1,

67 
	mHPMUD_BUS_PARALLEL
,

68 
	mHPMUD_BUS_ALL


71 
	eHPMUD_DEVICE_TYPE


73 
	mHPMUD_AIO
=0,

74 
	mHPMUD_PRINTER
=1,

75 
	mHPMUD_SCANNER
=2,

78 
	eHPMUD_SCANTYPE


80 
	mHPMUD_SCANTYPE_NA
 = 0,

81 
	mHPMUD_SCANTYPE_SCL
 = 1,

82 
	mHPMUD_SCANTYPE_PML
 = 2,

83 
	mHPMUD_SCANTYPE_SOAP
 = 3,

84 
	mHPMUD_SCANTYPE_MARVELL
 = 4,

85 
	mHPMUD_SCANTYPE_SOAPHT
 = 5,

86 
	mHPMUD_SCANTYPE_SCL_DUPLEX
 = 6,

87 
	mHPMUD_SCANTYPE_LEDM
 = 7,

88 
	mHPMUD_SCANTYPE_MARVELL2
 = 8,

89 
	mHPMUD_SCANTYPE_ESCL
=9,

90 
	mHPMUD_SCANTYPE_ORBLITE
=10

93 
	eHPMUD_SCANSRC


95 
	mHPMUD_SCANSRC_NA
 = 0,

96 
	mHPMUD_SCANSRC_FLATBED
 = 0x1,

97 
	mHPMUD_SCANSRC_ADF
= 0x2,

98 
	mHPMUD_SCANSRC_CAMERA
 = 0x4,

101 
	eHPMUD_STATUSTYPE


103 
	mHPMUD_STATUSTYPE_NA
 = 0,

104 
	mHPMUD_STATUSTYPE_VSTATUS
 = 1,

105 
	mHPMUD_STATUSTYPE_SFIELD
 = 2,

106 
	mHPMUD_STATUSTYPE_PML
 = 3,

107 
	mHPMUD_STATUSTYPE_EWS
 = 6,

108 
	mHPMUD_STATUSTYPE_PJL
 = 8,

109 
	mHPMUD_STATUSTYPE_PJLPML
 = 9,

112 
	eHPMUD_SUPPORT_TYPE


114 
	mHPMUD_SUPPORT_TYPE_NONE
 = 0,

115 
	mHPMUD_SUPPORT_TYPE_HPIJS
 = 1,

116 
	mHPMUD_SUPPORT_TYPE_HPLIP
 = 2,

119 
	eHPMUD_PLUGIN_TYPE


121 
	mHPMUD_PLUGIN_TYPE_NONE
 = 0,

122 
	mHPMUD_PLUGIN_TYPE_REQUIRED
 = 1,

123 
	mHPMUD_PLUGIN_TYPE_OPTIONAL
 = 2,

128 
	#HPMUD_S_PRINT_CHANNEL
 "PRINT"

	)

129 
	#HPMUD_S_PML_CHANNEL
 "HP-MESSAGE"

	)

130 
	#HPMUD_S_SCAN_CHANNEL
 "HP-SCAN"

	)

131 
	#HPMUD_S_FAX_SEND_CHANNEL
 "HP-FAX-SEND"

	)

132 
	#HPMUD_S_CONFIG_UPLOAD_CHANNEL
 "HP-CONFIGURATION-UPLOAD"

	)

133 
	#HPMUD_S_CONFIG_DOWNLOAD_CHANNEL
 "HP-CONFIGURATION-DOWNLOAD"

	)

134 
	#HPMUD_S_MEMORY_CARD_CHANNEL
 "HP-CARD-ACCESS"

	)

135 
	#HPMUD_S_EWS_CHANNEL
 "HP-EWS"

	)

136 
	#HPMUD_S_EWS_LEDM_CHANNEL
 "HP-EWS-LEDM"

	)

137 
	#HPMUD_S_SOAP_SCAN
 "HP-SOAP-SCAN"

	)

138 
	#HPMUD_S_SOAP_FAX
 "HP-SOAP-FAX"

	)

139 
	#HPMUD_S_DEVMGMT_CHANNEL
 "HP-DEVMGMT"

	)

140 
	#HPMUD_S_MARVELL_SCAN_CHANNEL
 "HP-MARVELL-SCAN"

	)

141 
	#HPMUD_S_MARVELL_FAX_CHANNEL
 "HP-MARVELL-FAX"

	)

142 
	#HPMUD_S_LEDM_SCAN
 "HP-LEDM-SCAN"

	)

143 
	#HPMUD_S_WIFI_CHANNEL
 "HP-WIFICONFIG"

	)

144 
	#HPMUD_S_MARVELL_EWS_CHANNEL
 "HP-MARVELL-EWS"

	)

145 
	#HPMUD_S_IPP_CHANNEL
 "HP-IPP"

	)

146 
	#HPMUD_S_IPP_CHANNEL2
 "HP-IPP2"

	)

147 
	#HPMUD_S_ESCL_SCAN
 "HP-ESCL-SCAN"

	)

149 
	tHPMUD_DEVICE
;

150 
	#HPMUD_DEVICE_MAX
 2

	)

152 
	tHPMUD_CHANNEL
;

153 
	#HPMUD_CHANNEL_MAX
 
HPMUD_MAX_CHANNEL_ID


	)

155 
	#HPMUD_LINE_SIZE
 256

	)

156 
	#HPMUD_BUFFER_SIZE
 16384

	)

158 
	shpmud_d¡©


160 
	muri
[
HPMUD_LINE_SIZE
];

161 
	mş›Á_út
;

162 
HPMUD_IO_MODE
 
	mio_mode
;

163 
	mchªÃl_út
;

164 
	mmlc_up
;

167 
	shpmud_mod–_©Œibu‹s


169 
HPMUD_IO_MODE
 
	m´t_mode
;

170 
HPMUD_IO_MODE
 
	mmå_mode
;

171 
HPMUD_SCANTYPE
 
	msÿÁy³
;

172 
HPMUD_STATUSTYPE
 
	m¡©u¡y³
;

173 
HPMUD_SUPPORT_TYPE
 
	msuµÜt
;

174 
HPMUD_PLUGIN_TYPE
 
	m¶ugš
;

175 
HPMUD_SUPPORT_TYPE
 
	m»£rved
[5];

176 
HPMUD_SCANSRC
 
	msÿn¤c
;

179 #ifdeà
__ılu¥lus


194 
HPMUD_RESULT
 
hpmud_İ’_deviû
(cÚ¡ *
uri
, 
HPMUD_IO_MODE
 
io_mode
, 
HPMUD_DEVICE
 *
dd
);

205 
HPMUD_RESULT
 
hpmud_şo£_deviû
(
HPMUD_DEVICE
 
dd
);

221 
HPMUD_RESULT
 
hpmud_g‘_deviû_id
(
HPMUD_DEVICE
 
dd
, *
buf
, 
buf_size
, *
by‹s_»ad
);

233 
HPMUD_RESULT
 
hpmud_g‘_deviû_¡©us
(
HPMUD_DEVICE
 
dd
, *
¡©us
);

248 
HPMUD_RESULT
 
hpmud_´obe_deviûs
(
HPMUD_BUS_ID
 
bus
, *
buf
, 
buf_size
, *
út
, *
by‹s_»ad
);

263 
HPMUD_RESULT
 
hpmud_´obe_´š‹rs
(
HPMUD_BUS_ID
 
bus
, *
buf
, 
buf_size
, *
út
, *
by‹s_»ad
);

278 
HPMUD_RESULT
 
hpmud_İ’_chªÃl
(
HPMUD_DEVICE
 
dd
, cÚ¡ *
chªÃl_Çme
, 
HPMUD_CHANNEL
 *
cd
);

290 
HPMUD_RESULT
 
hpmud_şo£_chªÃl
(
HPMUD_DEVICE
 
dd
, 
HPMUD_CHANNEL
 
cd
);

308 
HPMUD_RESULT
 
hpmud_wr™e_chªÃl
(
HPMUD_DEVICE
 
dd
, 
HPMUD_CHANNEL
 
cd
, cÚ¡ *
buf
, 
size
, 
timeout
, *
by‹s_wr™‹n
);

326 
HPMUD_RESULT
 
hpmud_»ad_chªÃl
(
HPMUD_DEVICE
 
dd
, 
HPMUD_CHANNEL
 
cd
, *
buf
, 
size
, 
timeout
, *
by‹s_»ad
);

338 
HPMUD_RESULT
 
hpmud_g‘_d¡©
(
HPMUD_DEVICE
 
dd
, 
hpmud_d¡©
 *
ds
);

359 
HPMUD_RESULT
 
hpmud_£t_pml
(
HPMUD_DEVICE
 
deviû
, 
HPMUD_CHANNEL
 
chªÃl
, cÚ¡ *
¢mp_oid
, 
ty³
, *
d©a
, 
d©a_size
, *
pml_»suÉ
);

380 
HPMUD_RESULT
 
hpmud_g‘_pml
(
HPMUD_DEVICE
 
deviû
, 
HPMUD_CHANNEL
 
chªÃl
, cÚ¡ *
¢mp_oid
, *
buf
, 
buf_size
, *
by‹s_»ad
, *
ty³
, *
pml_»suÉ
);

395 
hpmud_g‘_mod–
(cÚ¡ *
id
, *
buf
, 
buf_size
);

410 
hpmud_g‘_¿w_mod–
(*
id
, *
¿w
, 
¿wSize
);

425 
hpmud_g‘_uri_mod–
(cÚ¡ *
uri
, *
buf
, 
buf_size
);

440 
hpmud_g‘_uri_d©®šk
(cÚ¡ *
uri
, *
buf
, 
buf_size
);

457 
HPMUD_RESULT
 
hpmud_g‘_mod–_©Œibu‹s
(*
uri
, *
©Œ
, 
©ŒSize
, *
by‹s_»ad
);

472 
HPMUD_RESULT
 
hpmud_qu”y_mod–
(*
uri
, 
hpmud_mod–_©Œibu‹s
 *
ma
);

490 
HPMUD_RESULT
 
hpmud_make_usb_uri
(cÚ¡ *
bu¢um
, cÚ¡ *
devnum
, *
uri
, 
uri_size
, *
by‹s_»ad
);

507 
HPMUD_RESULT
 
hpmud_make_usb_£rŸl_uri
(cÚ¡ *
¢
, *
uri
, 
uri_size
, *
by‹s_»ad
);

524 
HPMUD_RESULT
 
hpmud_make_Ãt_uri
(cÚ¡ *

, 
pÜt
, *
uri
, 
uri_size
, *
by‹s_»ad
);

540 
HPMUD_RESULT
 
hpmud_make_·r_uri
(cÚ¡ *
dnode
, *
uri
, 
uri_size
, *
by‹s_»ad
);

557 
HPMUD_RESULT
 
hpmud_make_mdns_uri
(cÚ¡ *
ho¡
, 
pÜt
, *
uri
, 
uri_size
, *
by‹s_»ad
);

559 #ifdeà
__ılu¥lus


568 #ià
PY_MAJOR_VERSION
 >= 3

569 
	#MOD_ERROR_VAL
 
NULL


	)

570 
	#MOD_SUCCESS_VAL
(
v®
è
	)
val

571 
	#MOD_INIT
(
Çme
è
PyMODINIT_FUNC
 
PyIn™_
##
	`Çme
()

	)

572 
	#MOD_DEF
(
ob
, 
Çme
, 
doc
, 
m‘hods
) \

573 
PyModuËDef
 
moduËdef
 = { \

574 
PyModuËDef_HEAD_INIT
, 
Çme
, 
doc
, -1, 
m‘hods
, }; \

575 
ob
 = 
	`PyModuË_C»©e
(&
moduËdef
);

	)

576 
	#FORMAT_STRING
 "(iy#ii)"

	)

577 
	#FORMAT_STRING1
 "(iy#)"

	)

579 
	#MOD_ERROR_VAL


	)

580 
	#MOD_SUCCESS_VAL
(
v®
)

	)

581 
	#MOD_INIT
(
Çme
è
š™
##
	`Çme
()

	)

582 
	#MOD_DEF
(
ob
, 
Çme
, 
doc
, 
m‘hods
) \

583 
ob
 = 
	`Py_In™ModuË3
(
Çme
, 
m‘hods
, 
doc
);

	)

584 
	#FORMAT_STRING
 "(is#ii)"

	)

585 
	#FORMAT_STRING1
 "(is#)"

	)

	@io/hpmud/hpmudi.h

27 #iâdeà
_HPMUDI_H


28 
	#_HPMUDI_H


	)

30 #iâdeà
_GNU_SOURCE


31 
	#_GNU_SOURCE


	)

34 
	~<uni¡d.h
>

35 
	~<sys/ty³s.h
>

36 
	~<sys/¡©.h
>

37 
	~<sys/mmª.h
>

38 
	~<sys/time.h
>

39 
	~<fú.h
>

40 
	~<”ºo.h
>

41 
	~<¡ršg.h
>

42 
	~<¡dio.h
>

43 
	~<sy¦og.h
>

44 
	~<time.h
>

45 
	~<ùy³.h
>

46 
	~<±h»ad.h
>

47 
	~<¬·/š‘.h
>

48 
	~"hpmud.h
"

49 
	~"musb.h
"

50 
	~"mlc.h
"

51 
	~"dÙ4.h
"

52 
	~"pml.h
"

53 #ifdeà
HAVE_LIBNETSNMP


54 
	~"jd.h
"

55 
	~"mdns.h
"

57 #ifdeà
HAVE_PPORT


58 
	~"µ.h
"

64 
	#_STRINGIZE
(
x
è#x

	)

65 
	#STRINGIZE
(
x
è
	`_STRINGIZE
(x)

	)

67 
	#BUG
(
¬gs
...è
	`sy¦og
(
LOG_ERR
, 
__FILE__
 " " 
	`STRINGIZE
(
__LINE__
è": "‡rgs)

	)

70 #ifdeà
HPMUD_DEBUG


71 
	#DBG
(
¬gs
...è
	`sy¦og
(
LOG_INFO
, 
__FILE__
 " " 
	`STRINGIZE
(
__LINE__
è": "‡rgs)

	)

73 
	#DBG_DUMP
(
d©a
, 
size
è
	`sysdump
((d©a), (size))

	)

74 
	#DBG_SZ
(
¬gs
...è
	`sy¦og
(
LOG_INFO
,‡rgs)

	)

76 
	#DBG
(
¬gs
...)

	)

77 
	#DBG_DUMP
(
d©a
, 
size
)

	)

78 
	#DBG_SZ
(
¬gs
...)

	)

81 
	#HEX2INT
(
x
, 
i
) if (x >= '0' && x <= '9') i |= x - '0'; \

82 ià(
x
 >ğ'A' && x <ğ'F'è
i
 |= 0xA + x - 'A'; \

83 ià(
x
 >ğ'a' && x <ğ'f'è
i
 |ğ0xA + x - 'a'

	)

86 
	#off£t_of
(
TYPE
, 
MEMBER
è((
size_t
è&((TYPE *)0)->MEMBER)

	)

88 
	#HPMUD_EXCEPTION_TIMEOUT
 45000000

	)

89 
	#HPMUD_EXCEPTION_SEC_TIMEOUT
 45

	)

90 
	#HPMUD_MDNS_TIMEOUT
 10

	)

92 
	#NFAULT_BIT
 0x08

	)

93 
	#PERROR_BIT
 0x20

	)

95 
	eHPMUD_CHANNEL_ID


97 
	mHPMUD_PML_CHANNEL
 = 1,

98 
	mHPMUD_PRINT_CHANNEL
 = 2,

99 
	mHPMUD_SCAN_CHANNEL
 = 4,

100 
	mHPMUD_FAX_SEND_CHANNEL
 = 7,

101 
	mHPMUD_CONFIG_UPLOAD_CHANNEL
 = 0xe,

102 
	mHPMUD_CONFIG_DOWNLOAD_CHANNEL
 = 0xf,

103 
	mHPMUD_MEMORY_CARD_CHANNEL
 = 0x11,

104 
	mHPMUD_EWS_CHANNEL
 = 0x12,

105 
	mHPMUD_SOAPSCAN_CHANNEL
 = 0x13,

106 
	mHPMUD_SOAPFAX_CHANNEL
 = 0x14,

107 
	mHPMUD_MARVELL_SCAN_CHANNEL
 = 0x15,

108 
	mHPMUD_MARVELL_FAX_CHANNEL
 = 0x16,

109 
	mHPMUD_EWS_LEDM_CHANNEL
 = 0x17,

110 
	mHPMUD_LEDM_SCAN_CHANNEL
 = 0x18,

111 
	mHPMUD_MARVELL_EWS_CHANNEL
 = 0x19,

112 
	mHPMUD_ESCL_SCAN_CHANNEL
 = 0x1a,

113 
	mHPMUD_WIFI_CHANNEL
 = 0x2b,

114 
	mHPMUD_DEVMGMT_CHANNEL
 = 0x2c,

115 
	mHPMUD_IPP_CHANNEL
 = 0x2d,

116 
	mHPMUD_IPP_CHANNEL2
 = 0x2e,

117 
	mHPMUD_MAX_CHANNEL_ID


120 
	#HPMUD_DEVICE_MAX
 2

	)

121 
	#HPMUD_CHANNEL_MAX
 
HPMUD_MAX_CHANNEL_ID


	)

126 
	mh2püed™
;

127 
	mp2hüed™
;

128 
	mh2psize
;

129 
	mp2hsize
;

130 } 
	tŒª¥Üt_©Œibu‹s
;

132 
	s_mud_chªÃl_vf


134 
HPMUD_RESULT
 (*
İ’
)(
_mud_chªÃl
 *
	mpc
);

135 
HPMUD_RESULT
 (*
şo£
)(
_mud_chªÃl
 *
	mpc
);

136 
HPMUD_RESULT
 (*
chªÃl_wr™e
)(
_mud_chªÃl
 *
	mpc
, cÚ¡ *
	mbuf
, 
	msize
, 
	mtimeout
, *
	mby‹s_wrÙe
);

137 
HPMUD_RESULT
 (*
chªÃl_»ad
)(
_mud_chªÃl
 *
	mpc
, *
	mbuf
, 
	msize
, 
	mtimeout
, *
	mby‹s_»ad
);

138 } 
	tmud_chªÃl_vf
;

140 
	s_mud_deviû_vf


142 (*
	mwr™e
)(
	mfd
, cÚ¡ *
	mbuf
, 
	msize
, 
	mu£c_timeout
);

143 (*
	m»ad
)(
	mfd
, *
	mbuf
, 
	msize
, 
	mu£c_timout
);

144 
HPMUD_RESULT
 (*
İ’
)(
_mud_deviû
 *
	mpd
);

145 
HPMUD_RESULT
 (*
şo£
)(
_mud_deviû
 *
	mpd
);

146 
HPMUD_RESULT
 (*
g‘_deviû_id
)(
_mud_deviû
 *
	mpd
, *
	mid
, 
	msize
, *
	mby‹s_»ad
);

147 
HPMUD_RESULT
 (*
g‘_deviû_¡©us
)(
_mud_deviû
 *
	mpd
, *
	m¡©us
);

148 
HPMUD_RESULT
 (*
chªÃl_İ’
)(
_mud_deviû
 *
	mpd
, cÚ¡ *
	mchªÃl_Çme
, 
HPMUD_CHANNEL
 *
	mcd
);

149 
HPMUD_RESULT
 (*
chªÃl_şo£
)(
_mud_deviû
 *
	mpd
, 
_mud_chªÃl
 *
	mpc
);

150 
HPMUD_RESULT
 (*
chªÃl_wr™e
)(
_mud_deviû
 *
	mpd
, 
_mud_chªÃl
 *
	mpc
, cÚ¡ *
	mbuf
, 
	msize
, 
	m£c_timeout
, *
	mby‹s_wrÙe
);

151 
HPMUD_RESULT
 (*
chªÃl_»ad
)(
_mud_deviû
 *
	mpd
, 
_mud_chªÃl
 *
	mpc
, *
	mbuf
, 
	msize
, 
	m£c_timeout
, *
	mby‹s_»ad
);

152 } 
	tmud_deviû_vf
;

154 
	s_mud_chªÃl


156 
	m¢
[
HPMUD_LINE_SIZE
];

157 
	msockid
;

158 
	mş›Á_út
;

159 
	mšdex
;

160 
	mfd
;

161 
pid_t
 
	mpid
;

162 
	mdšdex
;

165 
Œª¥Üt_©Œibu‹s
 
	m
;

166 
	mrbuf
[
HPMUD_BUFFER_SIZE
];

167 
	mršdex
;

168 
	mrút
;

171 
	msock‘
;

173 
mud_chªÃl_vf
 
	mvf
;

174 } 
	tmud_chªÃl
;

176 
	s_mud_deviû


178 
	muri
[
HPMUD_LINE_SIZE
];

179 
	mid
[1024];

180 
	mšdex
;

181 
HPMUD_IO_MODE
 
	mio_mode
;

182 
mud_chªÃl
 
	mchªÃl
[
HPMUD_CHANNEL_MAX
];

183 
	mchªÃl_út
;

184 
	mİ’_fd
;

187 
	mmlc_up
;

188 
	mmlc_fd
;

191 
	m
[
HPMUD_LINE_SIZE
];

192 
	mpÜt
;

194 
mud_deviû_vf
 
	mvf
;

195 
±h»ad_mu‹x_t
 
	mmu‹x
;

196 } 
	tmud_deviû
;

200 
mud_deviû
 
	mdeviû
[
HPMUD_DEVICE_MAX
];

201 
±h»ad_mu‹x_t
 
	mmu‹x
;

202 } 
	tmud_£ssiÚ
;

204 
mud_£ssiÚ
 *
m¥
 
__©Œibu‹__
 ((
visib™y
 ("hidden")));

206 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
sysdump
(cÚ¡ *
d©a
, 
size
);

207 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
mm_deviû_lock
(
fd
, 
HPMUD_DEVICE
 
šdex
);

208 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
mm_deviû_uÆock
(
fd
, 
HPMUD_DEVICE
 
šdex
);

209 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
mm_deviû_Œylock
(
fd
, 
HPMUD_DEVICE
 
šdex
);

210 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
is_hp
(cÚ¡ *
id
);

211 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
g’”®ize_mod–
(cÚ¡ *
sz
, *
buf
, 
bufSize
);

212 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
g’”®ize_£rŸl
(cÚ¡ *
sz
, *
buf
, 
bufSize
);

213 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
g‘_uri_mod–
(cÚ¡ *
uri
, *
buf
, 
bufSize
);

214 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
g‘_uri_£rŸl
(cÚ¡ *
uri
, *
buf
, 
bufSize
);

215 
HPMUD_RESULT
 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
£rviû_to_chªÃl
(
mud_deviû
 *
pd
, cÚ¡ *
¢
, 
HPMUD_CHANNEL
 *
šdex
);

216 (*
g‘SID©a
)(**
pD©a
 , *
pD©aL’
, **
pModeSw™ch
, *
pModeSw™chL’
);

217 (*
ä“SID©a
)(*
pD©a
, *
pModeSw™ch
);

219 cÚ¡ *
SnmpPÜt
[] = { "","public","public.1","public.2","public.3"
	}
};

221 
	#PORT_PUBLIC
 1

	)

222 
	#PORT_PUBLIC_1
 2

	)

223 
	#PORT_PUBLIC_2
 3

	)

224 
	#PORT_PUBLIC_3
 4

	)

	@io/hpmud/jd.c

27 #ifdeà
HAVE_LIBNETSNMP


29 #iâdeà
_GNU_SOURCE


30 
	#_GNU_SOURCE


	)

33 
	~<sigÇl.h
>

34 
	~"hpmud.h
"

35 
	~"hpmudi.h
"

38 
mud_deviû_vf
 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
	gjd_mud_deviû_vf
 =

40 .
İ’
 = 
jd_İ’
,

41 .
	gşo£
 = 
jd_şo£
,

42 .
	gg‘_deviû_id
 = 
jd_g‘_deviû_id
,

43 .
	gg‘_deviû_¡©us
 = 
jd_g‘_deviû_¡©us
,

44 .
	gchªÃl_İ’
 = 
jd_chªÃl_İ’
,

45 .
	gchªÃl_şo£
 = 
jd_chªÃl_şo£
,

46 .
	gchªÃl_wr™e
 = 
jd_chªÃl_wr™e
,

47 .
	gchªÃl_»ad
 = 
jd_chªÃl_»ad


50 
mud_chªÃl_vf
 
	gjd_chªÃl_vf
 =

52 .
İ’
 = 
jd_s_chªÃl_İ’
,

53 .
	gşo£
 = 
jd_s_chªÃl_şo£
,

54 .
	gchªÃl_wr™e
 = 
jd_s_chªÃl_wr™e
,

55 .
	gchªÃl_»ad
 = 
jd_s_chªÃl_»ad


58 cÚ¡ 
	gPrštPÜt
[] = { 0, 9100, 9100, 9101, 9102 };

59 cÚ¡ 
	gSÿnPÜt0
[] = { 0, 9290, 9290, 9291, 9292 };

60 cÚ¡ 
	gG’”icPÜt
[] = { 0, 9220, 9220, 9221, 9222 };

61 cÚ¡ 
	gSÿnPÜt1
[] = { 0, 8290, 8290, 0, 0 };

62 cÚ¡ 
	gG’”icPÜt1
[] = { 0, 8292, 8292, 0, 0 };

64 cÚ¡ 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è*
	gkStusOID
 = "1.3.6.1.4.1.11.2.3.9.1.1.7.0";

66 
	$R—dR•ly
(
mud_chªÃl
 *
pc
)

68 
buf
[
HPMUD_LINE_SIZE
];

69 
Ën
=0, 
num
=0;

70 *

;

71 
HPMUD_RESULT
 
¡©
;

73 
¡©
 = 
	`jd_s_chªÃl_»ad
(
pc
, 
buf
, (buf), 2, &
Ën
);

74 
buf
[
Ën
] = 0;

76 ià(
¡©
 =ğ
HPMUD_R_OK
)

77 
num
 = 
	`¡¹Ş
((*)
buf
, &

, 10);

79  
num
;

80 
	}
}

82 
	$deviû_id
(cÚ¡ *
Üho¡Çme
, 
pÜt
, *
bufãr
, 
size
)

84 
Ën
=0, 
maxSize
, 
»suÉ
, 
dt
, 
¡©us
;

86 
maxSize
 = (
size
 > 1024) ? 1024 : size;

88 ià((
Ën
 = 
	`G‘Snmp
(
Üho¡Çme
, 
pÜt
, (*)
kStusOID
, (*)
bufãr
, 
maxSize
, &
dt
, &
¡©us
, &
»suÉ
)) == 0)

91 ià((
Ën
 = 
	`G‘Snmp
(
Üho¡Çme
, 
PORT_PUBLIC_1
, (*)
kStusOID
, (*)
bufãr
, 
maxSize
, &
dt
, &
¡©us
, &
»suÉ
)) == 0)

93 
	`BUG
("unableo„ead device-id\n");

97  
Ën
;

98 
	}
}

101 
	$Ãw_chªÃl
(
mud_deviû
 *
pd
, 
šdex
, cÚ¡ *
¢
)

103 
¡©
=1;

106 ià(
pd
->
chªÃl
[
šdex
].
ş›Á_út
)

109 ià(
šdex
 =ğ
HPMUD_EWS_CHANNEL
)

111 
pd
->
chªÃl
[
šdex
].
ş›Á_út
++;

112 
¡©
 = 0;

113 
	`DBG
("»u£d % chªÃl=%d cl›ÁCÁ=%d chªÃlCÁ=%d\n", 
¢
, 
šdex
, 
pd
->
chªÃl
[šdex].
ş›Á_út
,…d->
chªÃl_út
);

117 
	`BUG
("% chªÃl=%d i busy, u£d by [%d], cl›ÁCÁ=%d chªÃlCÁ=%d\n", 
¢
, 
šdex
, 
pd
->
chªÃl
[šdex].
pid
,…d->chªÃl[šdex].
ş›Á_út
,…d->
chªÃl_út
);

118 
bugout
;

121 
pd
->
chªÃl
[
šdex
].
vf
 = 
jd_chªÃl_vf
;

122 
pd
->
chªÃl
[
šdex
].index = index;

123 
pd
->
chªÃl
[
šdex
].
ş›Á_út
 = 1;

124 
pd
->
chªÃl
[
šdex
].
sockid
 = index;

125 
pd
->
chªÃl
[
šdex
].
pid
 = 
	`g‘pid
();

126 
pd
->
chªÃl
[
šdex
].
dšdex
 =…d->index;

127 
pd
->
chªÃl
[
šdex
].
fd
 = 0;

128 
pd
->
chªÃl
[
šdex
].
sock‘
 = -1;

129 
	`¡rıy
(
pd
->
chªÃl
[
šdex
].
¢
, sn);

130 
pd
->
chªÃl_út
++;

132 
¡©
 = 0;

133 
	`DBG
("Ãw % chªÃl=%d cl›ÁCÁ=%d chªÃlCÁ=%d\n", 
¢
, 
šdex
, 
pd
->
chªÃl
[šdex].
ş›Á_út
,…d->
chªÃl_út
);

135 
bugout
:

136  
¡©
;

137 
	}
}

140 
	$d–_chªÃl
(
mud_deviû
 *
pd
, 
mud_chªÃl
 *
pc
)

142 
pc
->
ş›Á_út
--;

144 ià(
pc
->
ş›Á_út
 <= 0)

146 
pd
->
chªÃl_út
--;

148 
	`DBG
("»moved % chªÃl=%d cl›ÁCÁ=%d chªÃlCÁ=%d\n", 
pc
->
¢
,…c->
šdex
,…c->
ş›Á_út
, 
pd
->
chªÃl_út
);

150 
	}
}

156 
HPMUD_RESULT
 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
	$jd_İ’
(
mud_deviû
 *
pd
)

158 
uri_mod–
[128];

159 
mod–
[128];

160 *
p
, *

;

161 
Ën
=0;

162 
´štqueue
 = 0;

163 
HPMUD_RESULT
 
¡©
 = 
HPMUD_R_IO_ERROR
;

165 
	`±h»ad_mu‹x_lock
(&
pd
->
mu‹x
);

171 
´štqueue
 = (
	`¡r¡r
(
pd
->
uri
, "queue=false") )? 0:1;

175 if(
	`¡r¡r
(
pd
->
uri
, "scanjet"))

176 
´štqueue
 = 0;

178 ià(
pd
->
id
[0] == 0)

181 
	`hpmud_g‘_uri_d©®šk
(
pd
->
uri
,…d->

, (pd->ip));

183 ià((
p
 = 
	`¡rÿ£¡r
(
pd
->
uri
, "pÜt=")è!ğ
NULL
)

184 
pd
->
pÜt
 = 
	`¡¹Ş
(
p
+5, &

, 10);

186 
pd
->
pÜt
 = 
PORT_PUBLIC
;

188 ià(
pd
->
pÜt
 > 
PORT_PUBLIC_3
)

190 
¡©
 = 
HPMUD_R_INVALID_IP_PORT
;

191 
	`BUG
("šv®id i°pÜt=%d\n", 
pd
->
pÜt
);

192 
bÏckout
;

195 if(
´štqueue
)

197 
Ën
 = 
	`deviû_id
(
pd
->

,…d->
pÜt
,…d->
id
, (pd->id));

198 ià(
Ën
 == 0)

200 
¡©
 = 
HPMUD_R_IO_ERROR
;

201 
bÏckout
;

206 if(
´štqueue
)

209 
	`hpmud_g‘_uri_mod–
(
pd
->
uri
, 
uri_mod–
, (uri_model));

210 
	`hpmud_g‘_mod–
(
pd
->
id
, 
mod–
, (model));

211 ià(
	`¡rÿ£cmp
(
uri_mod–
, 
mod–
) != 0)

213 
¡©
 = 
HPMUD_R_INVALID_URI
;

214 
	`BUG
("šv®id ur˜mod– % !ğ%s\n", 
uri_mod–
, 
mod–
);

215 
bÏckout
;

219 
¡©
 = 
HPMUD_R_OK
;

221 
bÏckout
:

222 
	`±h»ad_mu‹x_uÆock
(&
pd
->
mu‹x
);

224  
¡©
;

225 
	}
}

227 
HPMUD_RESULT
 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
	$jd_şo£
(
mud_deviû
 *
pd
)

229 
HPMUD_RESULT
 
¡©
 = 
HPMUD_R_OK
;

231 
	`±h»ad_mu‹x_lock
(&
pd
->
mu‹x
);

232 
pd
->
id
[0] = 0;

233 
	`±h»ad_mu‹x_uÆock
(&
pd
->
mu‹x
);

235  
¡©
;

236 
	}
}

238 
HPMUD_RESULT
 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
	$jd_g‘_deviû_id
(
mud_deviû
 *
pd
, *
buf
, 
size
, *
Ën
)

240 
HPMUD_RESULT
 
¡©
 = 
HPMUD_R_IO_ERROR
;

242 *
Ën
=0;

244 
	`±h»ad_mu‹x_lock
(&
pd
->
mu‹x
);

246 *
Ën
 = 
	`deviû_id
(
pd
->

,…d->
pÜt
,…d->
id
, (pd->id));

248 ià(*
Ën
)

250 
	`memıy
(
buf
, 
pd
->
id
, *
Ën
 > 
size
 ? size : *len);

251 
¡©
 = 
HPMUD_R_OK
;

254 
	`±h»ad_mu‹x_uÆock
(&
pd
->
mu‹x
);

255  
¡©
;

256 
	}
}

258 
HPMUD_RESULT
 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
	$jd_g‘_deviû_¡©us
(
mud_deviû
 *
pd
, *
¡©us
)

260 *
¡©us
 = 
NFAULT_BIT
;

261  
HPMUD_R_OK
;

262 
	}
}

264 
HPMUD_RESULT
 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
	$jd_chªÃl_wr™e
(
mud_deviû
 *
pd
, 
mud_chªÃl
 *
pc
, cÚ¡ *
buf
, 
Ëngth
, 
£c_timeout
, *
by‹s_wrÙe
)

266 
HPMUD_RESULT
 
¡©
;

268 
	`±h»ad_mu‹x_lock
(&
pd
->
mu‹x
);

269 
¡©
 = (
pc
->
vf
.
chªÃl_wr™e
)Õc, 
buf
, 
Ëngth
, 
£c_timeout
, 
by‹s_wrÙe
);

270 
	`±h»ad_mu‹x_uÆock
(&
pd
->
mu‹x
);

271  
¡©
;

272 
	}
}

274 
HPMUD_RESULT
 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
	$jd_chªÃl_»ad
(
mud_deviû
 *
pd
, 
mud_chªÃl
 *
pc
, *
buf
, 
Ëngth
, 
£c_timeout
, *
by‹s_»ad
)

276 
HPMUD_RESULT
 
¡©
;

278 ià(
pd
->
io_mode
 =ğ
HPMUD_UNI_MODE
)

280 
¡©
 = 
HPMUD_R_INVALID_STATE
;

281 
	`BUG
("šv®id chªÃl_»ad io_mode=%d\n", 
pd
->
io_mode
);

284 
	`±h»ad_mu‹x_lock
(&
pd
->
mu‹x
);

285 
¡©
 = (
pc
->
vf
.
chªÃl_»ad
)Õc, 
buf
, 
Ëngth
, 
£c_timeout
, 
by‹s_»ad
);

286 
	`±h»ad_mu‹x_uÆock
(&
pd
->
mu‹x
);

287  
¡©
;

288 
	}
}

290 
HPMUD_RESULT
 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
	$jd_chªÃl_İ’
(
mud_deviû
 *
pd
, cÚ¡ *
¢
, 
HPMUD_CHANNEL
 *
cd
)

292 
šdex
;

293 
HPMUD_RESULT
 
¡©
;

296 ià((
¡©
 = 
	`£rviû_to_chªÃl
(
pd
, 
¢
, &
šdex
)è!ğ
HPMUD_R_OK
)

297 
bugout
;

299 
	`±h»ad_mu‹x_lock
(&
pd
->
mu‹x
);

301 ià(
	`Ãw_chªÃl
(
pd
, 
šdex
, 
¢
))

303 
¡©
 = 
HPMUD_R_DEVICE_BUSY
;

307 ià((
¡©
 = (
pd
->
chªÃl
[
šdex
].
vf
.
İ’
)(&pd->chªÃl[šdex])è!ğ
HPMUD_R_OK
)

308 
	`d–_chªÃl
(
pd
, &pd->
chªÃl
[
šdex
]);

310 *
cd
 = 
šdex
;

313 
	`±h»ad_mu‹x_uÆock
(&
pd
->
mu‹x
);

315 
bugout
:

316  
¡©
;

317 
	}
}

319 
HPMUD_RESULT
 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
	$jd_chªÃl_şo£
(
mud_deviû
 *
pd
, 
mud_chªÃl
 *
pc
)

321 
HPMUD_RESULT
 
¡©
 = 
HPMUD_R_OK
;

323 
	`±h»ad_mu‹x_lock
(&
pd
->
mu‹x
);

324 
¡©
 = (
pc
->
vf
.
şo£
)(pc);

325 
	`d–_chªÃl
(
pd
, 
pc
);

326 
	`±h»ad_mu‹x_uÆock
(&
pd
->
mu‹x
);

328  
¡©
;

329 
	}
}

335 
HPMUD_RESULT
 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
	$jd_s_chªÃl_İ’
(
mud_chªÃl
 *
pc
)

337 
mud_deviû
 *
pd
 = &
m¥
->
deviû
[
pc
->
dšdex
];

338 
sockaddr_š
 
pš
,
tmp_pš
;

339 
ho¡’t
 *
he
;

340 
buf
[
HPMUD_LINE_SIZE
];

341 
r
, 
Ën
, 
pÜt
;

342 
HPMUD_RESULT
 
¡©
 = 
HPMUD_R_IO_ERROR
;

344 
	`bz”o
(&
tmp_pš
, (tmp_pin));

345 
	`bz”o
(&
pš
, (pin));

346 
pš
.
sš_çmy
 = 
AF_INET
;

348 if(
	`š‘_±Ú
(
AF_INET
, 
pd
->

, &(
tmp_pš
.
sš_addr
)))

349 
pš
.
sš_addr
.
s_addr
 = 
	`š‘_addr
(
pd
->

);

352 if((
he
=
	`g‘ho¡byÇme
(
pd
->

)è=ğ
NULL
)

354 
	`BUG
("gethostbyname()„eturned NULL\n");

355 
bugout
;

358 
pš
.
sš_addr
 = *((
š_addr
 *)
he
->
h_addr
);

361 
pc
->
šdex
)

363 
HPMUD_PRINT_CHANNEL
:

364 
pÜt
 = 
PrštPÜt
[
pd
->port];

365 
pš
.
sš_pÜt
 = 
	`htÚs
(
pÜt
);

366 ià((
pc
->
sock‘
 = 
	`sock‘
(
AF_INET
, 
SOCK_STREAM
, 0)) == -1)

368 
	`BUG
("uÇbËØİ’…ršˆpÜˆ%d: %m %s\n", 
pÜt
, 
pd
->
uri
);

369 
bugout
;

371 ià(
	`cÚÃù
(
pc
->
sock‘
, (
sockaddr
 *)&
pš
, (pin)) == -1)

373 
	`BUG
("uÇbËØcÚÃùØ´šˆpÜˆ%d: %m %s\n", 
pÜt
, 
pd
->
uri
);

374 
bugout
;

377 
HPMUD_SCAN_CHANNEL
:

378 ià(
pd
->
io_mode
 =ğ
HPMUD_DOT4_PHOENIX_MODE
)

379 
pÜt
 = 
SÿnPÜt1
[
pd
->port];

381 
pÜt
 = 
SÿnPÜt0
[
pd
->port];

382 
pš
.
sš_pÜt
 = 
	`htÚs
(
pÜt
);

384 ià((
pc
->
sock‘
 = 
	`sock‘
(
AF_INET
, 
SOCK_STREAM
, 0)) == -1)

386 
	`BUG
("uÇbËØİ’ sÿÀpÜˆ%d: %m %s\n", 
pÜt
, 
pd
->
uri
);

387 
bugout
;

389 ià(
	`cÚÃù
(
pc
->
sock‘
, (
sockaddr
 *)&
pš
, (pin)) == -1)

391 
	`BUG
("uÇbËØcÚÃùØsÿÀ”r=%d…Üˆ%d: %m %s\n", 
”ºo
, 
pÜt
, 
pd
->
uri
);

392 
bugout
;

394 ià(
pd
->
io_mode
 !ğ
HPMUD_DOT4_PHOENIX_MODE
)

396 
r
 = 
	`R—dR•ly
(
pc
);

397 ià(
r
 != 0)

399 
	`BUG
("šv®id sÿÀ»¥Ú£ %d…Üˆ%d %s\n", 
r
, 
pÜt
, 
pd
->
uri
);

400 
bugout
;

404 
HPMUD_MEMORY_CARD_CHANNEL
:

405 
HPMUD_FAX_SEND_CHANNEL
:

406 
HPMUD_CONFIG_UPLOAD_CHANNEL
:

407 
HPMUD_CONFIG_DOWNLOAD_CHANNEL
:

408 ià(
pd
->
io_mode
 =ğ
HPMUD_DOT4_PHOENIX_MODE
)

409 
pÜt
 = 
G’”icPÜt1
[
pd
->port];

411 
pÜt
 = 
G’”icPÜt
[
pd
->port];

412 
pš
.
sš_pÜt
 = 
	`htÚs
(
pÜt
);

413 ià((
pc
->
sock‘
 = 
	`sock‘
(
AF_INET
, 
SOCK_STREAM
, 0)) == -1)

415 
	`BUG
("uÇbËØİ’…Üˆ%d: %m %s\n", 
pÜt
, 
pd
->
uri
);

416 
bugout
;

418 ià(
	`cÚÃù
(
pc
->
sock‘
, (
sockaddr
 *)&
pš
, (pin)) == -1)

420 
	`BUG
("uÇbËØcÚÃùØpÜˆ%d: %m %s\n", 
pÜt
, 
pd
->
uri
);

421 
bugout
;

424 ià(
pd
->
io_mode
 !ğ
HPMUD_DOT4_PHOENIX_MODE
)

426 
r
 = 
	`R—dR•ly
(
pc
);

427 ià(
r
 != 220)

429 
	`BUG
("šv®id„e¥Ú£ %d…Üˆ%d %s\n", 
r
, 
pÜt
, 
pd
->
uri
);

430 
bugout
;

432 
Ën
 = 
	`¥rštf
(
buf
, "İ’ %d\n", 
pc
->
šdex
);

433 
	`£nd
(
pc
->
sock‘
, 
buf
, 
Ën
, 0);

434 
r
 = 
	`R—dR•ly
(
pc
);

435 ià(
r
 != 200)

437 
	`BUG
("šv®id„e¥Ú£ %d…Üˆ%d %s\n", 
r
, 
pÜt
, 
pd
->
uri
);

438 
bugout
;

440 
Ën
 = 
	`¥rštf
(
buf
, "data\n");

441 
	`£nd
(
pc
->
sock‘
, "d©a\n", 
Ën
, 0);

442 
r
 = 
	`R—dR•ly
(
pc
);

443 ià(
r
 != 200)

445 
	`BUG
("šv®id„e¥Ú£ %d…Üˆ%d %s\n", 
r
, 
pÜt
, 
pd
->
uri
);

446 
bugout
;

451 
HPMUD_EWS_CHANNEL
:

452 
pÜt
 = 80;

453 
pš
.
sš_pÜt
 = 
	`htÚs
(
pÜt
);

454 ià((
pc
->
sock‘
 = 
	`sock‘
(
AF_INET
, 
SOCK_STREAM
, 0)) == -1)

456 
	`BUG
("uÇbËØİ’ƒw pÜˆ%d: %m %s\n", 
pÜt
, 
pd
->
uri
);

457 
bugout
;

459 ià(
	`cÚÃù
(
pc
->
sock‘
, (
sockaddr
 *)&
pš
, (pin)) == -1)

461 
	`BUG
("uÇbËØcÚÃùØew pÜˆ%d: %m %s\n", 
pÜt
, 
pd
->
uri
);

462 
bugout
;

465 
HPMUD_SOAPSCAN_CHANNEL
:

466 
pÜt
 = 8289;

467 
pš
.
sš_pÜt
 = 
	`htÚs
(
pÜt
);

468 ià((
pc
->
sock‘
 = 
	`sock‘
(
AF_INET
, 
SOCK_STREAM
, 0)) == -1)

470 
	`BUG
("uÇbËØİ’ sßp-sÿÀpÜˆ%d: %m %s\n", 
pÜt
, 
pd
->
uri
);

471 
bugout
;

473 ià(
	`cÚÃù
(
pc
->
sock‘
, (
sockaddr
 *)&
pš
, (pin)) == -1)

475 
	`BUG
("uÇbËØcÚÃùØsßp-sÿÀpÜˆ%d: %m %s\n", 
pÜt
, 
pd
->
uri
);

476 
bugout
;

479 
HPMUD_SOAPFAX_CHANNEL
:

480 
pÜt
 = 8295;

481 
pš
.
sš_pÜt
 = 
	`htÚs
(
pÜt
);

482 ià((
pc
->
sock‘
 = 
	`sock‘
(
AF_INET
, 
SOCK_STREAM
, 0)) == -1)

484 
	`BUG
("uÇbËØİ’ sßp-çx…Üˆ%d: %m %s\n", 
pÜt
, 
pd
->
uri
);

485 
bugout
;

487 ià(
	`cÚÃù
(
pc
->
sock‘
, (
sockaddr
 *)&
pš
, (pin)) == -1)

489 
	`BUG
("uÇbËØcÚÃùØsßp-çx…Üˆ%d: %m %s\n", 
pÜt
, 
pd
->
uri
);

490 
bugout
;

493 
HPMUD_MARVELL_SCAN_CHANNEL
:

494 
pÜt
 = 8290;

495 
pš
.
sš_pÜt
 = 
	`htÚs
(
pÜt
);

496 ià((
pc
->
sock‘
 = 
	`sock‘
(
AF_INET
, 
SOCK_STREAM
, 0)) == -1)

498 
	`BUG
("uÇbËØİ’ m¬v–l-sÿÀpÜˆ%d: %m %s\n", 
pÜt
, 
pd
->
uri
);

499 
bugout
;

501 ià(
	`cÚÃù
(
pc
->
sock‘
, (
sockaddr
 *)&
pš
, (pin)) == -1)

503 
	`BUG
("uÇbËØcÚÃùØm¬v–l-sÿÀpÜˆ%d: %m %s\n", 
pÜt
, 
pd
->
uri
);

504 
bugout
;

507 
HPMUD_LEDM_SCAN_CHANNEL
:

508 
HPMUD_EWS_LEDM_CHANNEL
:

509 
pÜt
 = 8080;

510 
pš
.
sš_pÜt
 = 
	`htÚs
(
pÜt
);

511 ià((
pc
->
sock‘
 = 
	`sock‘
(
AF_INET
, 
SOCK_STREAM
, 0)) == -1)

513 
	`BUG
("uÇbËØİ’†edm-sÿÀpÜˆ%d: %m %s\n", 
pÜt
, 
pd
->
uri
);

514 
bugout
;

516 ià(
	`cÚÃù
(
pc
->
sock‘
, (
sockaddr
 *)&
pš
, (pin)) == -1)

518 
	`BUG
("uÇbËØcÚÃùØËdm-sÿÀpÜˆ%d: %m %s\n", 
pÜt
, 
pd
->
uri
);

519 
bugout
;

522 
HPMUD_ESCL_SCAN_CHANNEL
:

523 
pÜt
 = 80;

524 
pš
.
sš_pÜt
 = 
	`htÚs
(
pÜt
);

525 ià((
pc
->
sock‘
 = 
	`sock‘
(
AF_INET
, 
SOCK_STREAM
, 0)) == -1)

527 
	`BUG
("uÇbËØİ’ƒsş-sÿÀpÜˆ%d: %m %s\n", 
pÜt
, 
pd
->
uri
);

528 
bugout
;

530 ià(
	`cÚÃù
(
pc
->
sock‘
, (
sockaddr
 *)&
pš
, (pin)) == -1)

532 
	`BUG
("uÇbËØcÚÃùØesş-sÿÀpÜˆ%d: %m %s\n", 
pÜt
, 
pd
->
uri
);

533 
bugout
;

536 
HPMUD_IPP_CHANNEL
:

537 
pÜt
 = 80;

538 
pš
.
sš_pÜt
 = 
	`htÚs
(
pÜt
);

539 ià((
pc
->
sock‘
 = 
	`sock‘
(
AF_INET
, 
SOCK_STREAM
, 0)) == -1)

541 
	`BUG
("uÇbËØİ’ iµ…Üˆ%d: %m %s\n", 
pÜt
, 
pd
->
uri
);

542 
pÜt
 = 631;

543 
pš
.
sš_pÜt
 = 
	`htÚs
(
pÜt
);

544 if((
pc
->
sock‘
 = 
	`sock‘
(
AF_INET
, 
SOCK_STREAM
, 0)) == -1)

545 
bugout
;

547 ià(
	`cÚÃù
(
pc
->
sock‘
, (
sockaddr
 *)&
pš
, (pin)) == -1)

549 
	`BUG
("uÇbËØcÚÃùØ°pÜˆ%d: %m %s\n", 
pÜt
, 
pd
->
uri
);

550 
bugout
;

553 
HPMUD_MARVELL_FAX_CHANNEL
:

554 
pÜt
 = 8285;

555 
pš
.
sš_pÜt
 = 
	`htÚs
(
pÜt
);

556 ià((
pc
->
sock‘
 = 
	`sock‘
(
AF_INET
, 
SOCK_STREAM
, 0)) == -1)

558 
	`BUG
("uÇbËØİ’ m¬v–l-çx…Üˆ%d: %m %s\n", 
pÜt
, 
pd
->
uri
);

559 
bugout
;

561 ià(
	`cÚÃù
(
pc
->
sock‘
, (
sockaddr
 *)&
pš
, (pin)) == -1)

563 
	`BUG
("uÇbËØcÚÃùØm¬v–l-çx…Üˆ%d: %m %s\n", 
pÜt
, 
pd
->
uri
);

564 
bugout
;

567 
HPMUD_PML_CHANNEL
:

571 
	`BUG
("unsuµÜ‹d s”viû %d %s\n", 
pc
->
šdex
, 
pd
->
uri
);

572 
¡©
 = 
HPMUD_R_INVALID_SN
;

573 
bugout
;

577 
¡©
 = 
HPMUD_R_OK
;

579 
bugout
:

580  
¡©
;

581 
	}
}

583 
HPMUD_RESULT
 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
	$jd_s_chªÃl_şo£
(
mud_chªÃl
 *
pc
)

585 ià(
pc
->
sock‘
 >= 0)

587 
	`şo£
(
pc
->
sock‘
);

590 
	`u¦“p
(100000);

593 
pc
->
sock‘
 = -1;

595  
HPMUD_R_OK
;

596 
	}
}

598 
HPMUD_RESULT
 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
	$jd_s_chªÃl_wr™e
(
mud_chªÃl
 *
pc
, cÚ¡ *
buf
, 
Ëngth
, 
£c_timeout
, *
by‹s_wrÙe
)

600 
mud_deviû
 *
pd
 = &
m¥
->
deviû
[
pc
->
dšdex
];

601 
Ën
, 
size
, 
tÙ®
=0;

602 
timev®
 
tmo
;

603 
fd_£t
 
ma¡”
;

604 
fd_£t
 
wr™efd
;

605 
maxfd
, 
»t
;

606 
HPMUD_RESULT
 
¡©
 = 
HPMUD_R_IO_ERROR
;

608 *
by‹s_wrÙe
=0;

609 
size
 = 
Ëngth
;

611 ià(
pc
->
sock‘
<0)

613 
¡©
 = 
HPMUD_R_INVALID_STATE
;

614 
	`BUG
("šv®id d©¨lšk sock‘=%d %s\n", 
pc
->
sock‘
, 
pd
->
uri
);

615 
bugout
;

618 
	`FD_ZERO
(&
ma¡”
);

619 
	`FD_SET
(
pc
->
sock‘
, &
ma¡”
);

620 
maxfd
 = 
pc
->
sock‘
;

621 
size
 = 
Ëngth
;

623 
size
 > 0)

625 
tmo
.
tv_£c
 = 
HPMUD_EXCEPTION_SEC_TIMEOUT
;

626 
tmo
.
tv_u£c
 = 0;

627 
wr™efd
 = 
ma¡”
;

628 ià((
»t
 = 
	`£Ëù
(
maxfd
+1, 
NULL
, &
wr™efd
, NULL, &
tmo
)) == 0)

630 
¡©
 = 
HPMUD_R_IO_TIMEOUT
;

631 
	`BUG
("timeouˆwr™e_chªÃÈ%s\n", 
pd
->
uri
);

632 
bugout
;

634 
Ën
 = 
	`£nd
(
pc
->
sock‘
, 
buf
+
tÙ®
, 
size
, 0);

635 ià(
Ën
 < 0)

637 
	`BUG
("uÇbËØwr™e_chªÃl: %m %s\n", 
pd
->
uri
);

638 
bugout
;

640 
size
-=
Ën
;

641 
tÙ®
+=
Ën
;

642 *
by‹s_wrÙe
+=
Ën
;

645 
	`DBG
("wr™sock‘=%d†’=%d size=%d\n", 
pc
->
sock‘
, 
Ën
, 
Ëngth
);

646 
	`DBG_DUMP
(
buf
, 
Ën
 < 32 ?†en : 32);

648 
¡©
 = 
HPMUD_R_OK
;

650 
bugout
:

651  
¡©
;

652 
	}
}

658 
HPMUD_RESULT
 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
	$jd_s_chªÃl_»ad
(
mud_chªÃl
 *
pc
, *
buf
, 
Ëngth
, 
£c_timeout
, *
by‹s_»ad
)

660 
mud_deviû
 *
pd
 = &
m¥
->
deviû
[
pc
->
dšdex
];

661 
Ën
=0;

662 
timev®
 
tmo
;

663 
fd_£t
 
ma¡”
;

664 
fd_£t
 
»adfd
;

665 
maxfd
, 
»t
;

666 
HPMUD_RESULT
 
¡©
 = 
HPMUD_R_IO_ERROR
;

668 *
by‹s_»ad
 = 0;

670 ià(
pc
->
sock‘
<0)

672 
¡©
 = 
HPMUD_R_INVALID_STATE
;

673 
	`BUG
("šv®id d©¨lšk sock‘=%d %s\n", 
pc
->
sock‘
, 
pd
->
uri
);

674 
bugout
;

677 
	`FD_ZERO
(&
ma¡”
);

678 
	`FD_SET
(
pc
->
sock‘
, &
ma¡”
);

679 
maxfd
 = 
pc
->
sock‘
;

680 
tmo
.
tv_£c
 = 
£c_timeout
;

681 
tmo
.
tv_u£c
 = 0;

683 
»adfd
 = 
ma¡”
;

684 
»t
 = 
	`£Ëù
(
maxfd
+1, &
»adfd
, 
NULL
, NULL, &
tmo
);

685 ià(
»t
 < 0)

687 
	`BUG
("uÇbËØ»ad_chªÃl: %m %s\n", 
pd
->
uri
);

688 
bugout
;

690 ià(
»t
 == 0)

692 
¡©
 = 
HPMUD_R_IO_TIMEOUT
;

694 
	`BUG
("timeouˆ»ad_chªÃÈ£c=%d %s\n", 
£c_timeout
, 
pd
->
uri
);

695 
bugout
;

699 ià((
Ën
 = 
	`»cv
(
pc
->
sock‘
, 
buf
, 
Ëngth
, 0)) < 0)

701 
	`BUG
("uÇbËØ»ad_chªÃl: %m %s\n", 
pd
->
uri
);

702 
bugout
;

706 
	`DBG
("»ad sock‘=%d†’=%d size=%d\n", 
pc
->
sock‘
, 
Ën
, 
Ëngth
);

707 
	`DBG_DUMP
(
buf
, 
Ën
 < 32 ?†en : 32);

709 *
by‹s_»ad
 = 
Ën
;

710 
¡©
 = 
HPMUD_R_OK
;

712 
bugout
:

713  
¡©
;

714 
	}
}

716 
HPMUD_RESULT
 
	$hpmud_make_Ãt_uri
(cÚ¡ *

, 
pÜt
, *
uri
, 
uri_size
, *
by‹s_»ad
)

718 
id
[1024];

719 
mod–
[128];

720 
HPMUD_RESULT
 
¡©
;

722 
	`DBG
("[%d] hpmud_make_Ãt_uri(è=% pÜt=%d\n", 
	`g‘pid
(), 

, 
pÜt
);

724 *
by‹s_»ad
=0;

726 
uri
[0]=0;

728 ià(

 == 0 || ip[0]==0)

730 
	`BUG
("šv®id i°%s\n", 

);

731 
¡©
 = 
HPMUD_R_INVALID_IP
;

732 
bugout
;

735 ià(
	`deviû_id
(

, 
pÜt
, 
id
, (id)è> 0 && 
	`is_hp
(id))

737 
	`hpmud_g‘_mod–
(
id
, 
mod–
, (model));

738 ià(
pÜt
 =ğ
PORT_PUBLIC
)

739 *
by‹s_»ad
 = 
	`¢´štf
(
uri
, 
uri_size
, "hp:/Ãt/%s?=%s", 
mod–
, 

);

741 *
by‹s_»ad
 = 
	`¢´štf
(
uri
, 
uri_size
, "hp:/Ãt/%s?=%s&pÜt=%d", 
mod–
, 

, 
pÜt
);

745 
	`BUG
("šv®id i°%s\n", 

);

746 
¡©
 = 
HPMUD_R_INVALID_IP
;

747 
bugout
;

750 
¡©
 = 
HPMUD_R_OK
;

752 
bugout
:

753  
¡©
;

754 
	}
}

756 
HPMUD_RESULT
 
	$hpmud_make_mdns_uri
(cÚ¡ *
ho¡
, 
pÜt
, *
uri
, 
uri_size
, *
by‹s_»ad
)

758 
id
[1024];

759 
mod–
[128];

760 

[
HPMUD_LINE_SIZE
];

761 
HPMUD_RESULT
 
¡©
;

763 
	`DBG
("[%d] hpmud_make_mdns_uri(èho¡=% pÜt=%d\n", 
	`g‘pid
(), 
ho¡
, 
pÜt
);

765 *
by‹s_»ad
=0;

767 
uri
[0]=0;

769 ià(
ho¡
 == 0 || host[0]==0)

771 
	`BUG
("šv®id ho¡ %s\n", 
ho¡
);

772 
¡©
 = 
HPMUD_R_INVALID_MDNS
;

773 
bugout
;

776 ià(
	`mdns_lookup
(
ho¡
, 

è!ğ
MDNS_STATUS_OK
)

778 
	`BUG
("šv®id ho¡ %s, check fœew®ÈUDP/5353 o¸Œy usšg IP\n", 
ho¡
);

779 
¡©
 = 
HPMUD_R_INVALID_MDNS
;

780 
bugout
;

783 ià(
	`deviû_id
(

, 
pÜt
, 
id
, (id)è> 0 && 
	`is_hp
(id))

785 
	`hpmud_g‘_mod–
(
id
, 
mod–
, (model));

786 ià(
pÜt
 == 1)

787 *
by‹s_»ad
 = 
	`¢´štf
(
uri
, 
uri_size
, "hp:/Ãt/%s?zc=%s", 
mod–
, 
ho¡
);

789 *
by‹s_»ad
 = 
	`¢´štf
(
uri
, 
uri_size
, "hp:/Ãt/%s?zc=%s&pÜt=%d", 
mod–
, 
ho¡
, 
pÜt
);

793 
	`BUG
("šv®id ho¡ %s, o¸Œy usšg IP\n", 
ho¡
);

794 
¡©
 = 
HPMUD_R_INVALID_MDNS
;

795 
bugout
;

798 
¡©
 = 
HPMUD_R_OK
;

800 
bugout
:

801  
¡©
;

802 
	}
}

	@io/hpmud/jd.h

26 #iâdeà
_JD_H


27 
	#_JD_H


	)

29 
	~<sys/sock‘.h
>

30 
	~<Ãtš‘/š.h
>

31 
	~<Ãtdb.h
>

32 
	~<¬·/š‘.h
>

33 
	~"hpmud.h
"

34 
	~"hpmudi.h
"

36 
	g_mud_deviû
;

37 
	g_mud_chªÃl
;

39 cÚ¡ 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è*
kStusOID
;

41 
_mud_deviû_vf
 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
jd_mud_deviû_vf
;

43 
HPMUD_RESULT
 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
jd_İ’
(
_mud_deviû
 *
pd
);

44 
HPMUD_RESULT
 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
jd_şo£
(
_mud_deviû
 *
pd
);

45 
HPMUD_RESULT
 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
jd_g‘_deviû_id
(
_mud_deviû
 *
pd
, *
buf
, 
size
, *
Ën
);

46 
HPMUD_RESULT
 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
jd_g‘_deviû_¡©us
(
_mud_deviû
 *
pd
, *
¡©us
);

47 
HPMUD_RESULT
 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
jd_chªÃl_İ’
(
_mud_deviû
 *
pd
, cÚ¡ *
¢
, 
HPMUD_CHANNEL
 *
cd
);

48 
HPMUD_RESULT
 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
jd_chªÃl_şo£
(
_mud_deviû
 *
pd
, 
_mud_chªÃl
 *
pc
);

49 
HPMUD_RESULT
 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
jd_chªÃl_wr™e
(
_mud_deviû
 *
pd
, 
_mud_chªÃl
 *
pc
, cÚ¡ *
buf
, 
Ëngth
, 
timeout
, *
by‹s_wrÙe
);

50 
HPMUD_RESULT
 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
jd_chªÃl_»ad
(
_mud_deviû
 *
pd
, 
_mud_chªÃl
 *
pc
, *
buf
, 
Ëngth
, 
timeout
, *
by‹s_»ad
);

52 
HPMUD_RESULT
 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
jd_s_chªÃl_İ’
(
_mud_chªÃl
 *
pc
);

53 
HPMUD_RESULT
 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
jd_s_chªÃl_şo£
(
_mud_chªÃl
 *
pc
);

54 
HPMUD_RESULT
 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
jd_s_chªÃl_wr™e
(
_mud_chªÃl
 *
pc
, cÚ¡ *
buf
, 
Ëngth
, 
timeout
, *
by‹s_wrÙe
);

55 
HPMUD_RESULT
 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
jd_s_chªÃl_»ad
(
_mud_chªÃl
 *
pc
, *
buf
, 
Ëngth
, 
timeout
, *
by‹s_wrÙe
);

	@io/hpmud/list.h

1 #iâdeà
_LIST_H


2 
	#_LIST_H


	)

9 
	sli¡_h—d
 {

10 
li¡_h—d
 *
	mÃxt
, *
	m´ev
;

13 
	#INIT_LIST_HEAD
(
±r
) do { \

14 (
±r
)->
Ãxt
 = (±r); (±r)->
´ev
 = (ptr); \

15 } 0)

	)

23 
šlše
 
	$__li¡_add
(
li¡_h—d
 * 
Ãw_’Œy
,

24 
li¡_h—d
 * 
´ev
,

25 
li¡_h—d
 * 
Ãxt
)

27 
Ãxt
->
´ev
 = 
Ãw_’Œy
;

28 
Ãw_’Œy
->
Ãxt
 =‚ext;

29 
Ãw_’Œy
->
´ev
 =…rev;

30 
´ev
->
Ãxt
 = 
Ãw_’Œy
;

31 
	}
}

41 
šlše
 
	$li¡_add
(
li¡_h—d
 *
Ãw_’Œy
, li¡_h—d *
h—d
)

43 
	`__li¡_add
(
Ãw_’Œy
, 
h—d
, h—d->
Ãxt
);

44 
	}
}

54 
šlše
 
	$li¡_add_
(
li¡_h—d
 *
Ãw_’Œy
, li¡_h—d *
h—d
)

56 
	`__li¡_add
(
Ãw_’Œy
, 
h—d
->
´ev
, head);

57 
	}
}

66 
šlše
 
	$__li¡_d–
(
li¡_h—d
 * 
´ev
,

67 
li¡_h—d
 * 
Ãxt
)

69 
Ãxt
->
´ev
 =…rev;

70 
´ev
->
Ãxt
 =‚ext;

71 
	}
}

78 
šlše
 
	$li¡_d–
(
li¡_h—d
 *
’Œy
)

80 
	`__li¡_d–
(
’Œy
->
´ev
,ƒÁry->
Ãxt
);

81 
’Œy
->
Ãxt
 =ƒÁry->
´ev
 = 0;

82 
	}
}

88 
šlše
 
	$li¡_d–_š™
(
li¡_h—d
 *
’Œy
)

90 
	`__li¡_d–
(
’Œy
->
´ev
,ƒÁry->
Ãxt
);

91 
	`INIT_LIST_HEAD
(
’Œy
);

92 
	}
}

98 
šlše
 
	$li¡_em±y
(
li¡_h—d
 *
h—d
)

100  
h—d
->
Ãxt
 == head;

101 
	}
}

109 
	#li¡_’Œy
(
±r
, 
ty³
, 
memb”
) \

110 ((
ty³
 *)((*)(
±r
)-()(&(Ñy³ *)0)->
memb”
)))

	)

117 
	#li¡_fÜ_—ch
(
pos
, 
h—d
) \

118 
pos
 = (
h—d
)->
Ãxt
;…os != (head); \

119 
pos
 =…os->
Ãxt
)

	)

127 
	#li¡_fÜ_—ch_§ã
(
pos
, 
n
, 
h—d
) \

128 
pos
 = (
h—d
)->
Ãxt
, 
n
 =…os->next;…os != (head); \

129 
pos
 = 
n
,‚ =…os->
Ãxt
)

	)

	@io/hpmud/mlc.c

26 
	~"hpmud.h
"

27 
	~"hpmudi.h
"

29 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
	$cut_buf
(
mud_chªÃl
 *
pc
, *
buf
, 
size
)

31 
Ën
;

33 ià(
pc
->
rút
 > 
size
)

36 
Ën
 = 
size
;

37 
	`memıy
(
buf
, &
pc
->
rbuf
[pc->
ršdex
], 
Ën
);

38 
pc
->
ršdex
 +ğ
Ën
;

39 
pc
->
rút
 -ğ
Ën
;

44 
Ën
 = 
pc
->
rút
;

45 
	`memıy
(
buf
, &
pc
->
rbuf
[pc->
ršdex
], 
Ën
);

46 
pc
->
ršdex
 =…c->
rút
 = 0;

49  
Ën
;

50 
	}
}

53 
	$MlcFÜw¬dR•ly
(
mud_chªÃl
 *
pc
, 
fd
, *
buf
, 
size
)

55 
mud_deviû
 *
pd
 = &
m¥
->
deviû
[
pc
->
dšdex
];

56 
Ën
=0;

58 ià((
Ën
 = (
pd
->
vf
.
wr™e
)(
fd
, 
buf
, 
size
, 
HPMUD_EXCEPTION_TIMEOUT
)) != size)

60 
	`BUG
("unableo MlcForwarReply: %m\n");

62  
Ën
;

63 
	}
}

66 
	$MlcExecRev”£Cmd
(
mud_chªÃl
 *
pc
, 
fd
, *
buf
)

68 
mud_deviû
 *
pd
 = &
m¥
->
deviû
[
pc
->
dšdex
];

69 
mud_chªÃl
 *
out_of_bound_chªÃl
;

70 
MLCCmd
 *
pCmd
;

71 
MLCR•ly
 *
pR•ly
;

72 
MLCC»d™
 *
pC»d™
;

73 
MLCC»d™R•ly
 *
pC»d™R•ly
;

74 
MLCC»d™Reque¡
 *
pC»d™Req
;

75 
MLCC»d™Reque¡R•ly
 *
pC»d™ReqR•ly
;

76 
MLCE¼Ü
 *
pE¼Ü
;

77 
Ën
, 
size
;

78 
út
;

80 
pCmd
 = (
MLCCmd
 *)
buf
;

83 ià(!(
pCmd
->
h
.
hsid
 =ğ0 &&…Cmd->h.
psid
 == 0))

85 ià(
pCmd
->
h
.
hsid
 =ğpCmd->h.
psid
)

88 
out_of_bound_chªÃl
 = &
pd
->
chªÃl
[
pCmd
->
h
.
hsid
];

90 ià(
out_of_bound_chªÃl
->

.
p2hüed™
 <= 0)

92 
	`BUG
("šv®id d©¨·ck‘ c»d™=%d\n", 
out_of_bound_chªÃl
->

.
p2hüed™
);

96 
size
 = 
	`Áohs
(
pCmd
->
h
.
Ëngth
è- (
MLCH—d”
);

97 ià(
size
 > (
HPMUD_BUFFER_SIZE
 - 
out_of_bound_chªÃl
->
rút
))

99 
	`BUG
("šv®id d©¨·ck‘ size=%d\n", 
size
);

102 
	`memıy
(&
out_of_bound_chªÃl
->
rbuf
[out_of_bound_chªÃl->
rút
], 
buf
+(
MLCH—d”
), 
size
);

103 
out_of_bound_chªÃl
->
rút
 +ğ
size
;

104 ià(
pCmd
->
h
.
üed™
)

105 
out_of_bound_chªÃl
->

.
h2püed™
 +ğ
pCmd
->
h
.
üed™
;

106 
out_of_bound_chªÃl
->

.
p2hüed™
--;

110 
Ën
 = 
	`Áohs
(
pCmd
->
h
.
Ëngth
);

111 
	`BUG
("unsŞic™ed d©¨·ck‘: hsid=%x,…sid=%x,†’gth=%d, c»d™=%d, stus=%x\n", 
pCmd
->
h
.
hsid
,

112 
pCmd
->
h
.
psid
, 
Ën
,…Cmd->h.
üed™
,…Cmd->h.
¡©us
);

113 
	`DBG_DUMP
(
buf
, 
Ën
);

119 
pCmd
->
cmd
)

121 
MLC_CREDIT
:

122 
pC»d™
 = (
MLCC»d™
 *)
buf
;

123 
out_of_bound_chªÃl
 = &
pd
->
chªÃl
[
pC»d™
->
hsock‘
];

124 
out_of_bound_chªÃl
->

.
h2püed™
 +ğ
	`Áohs
(
pC»d™
->
üed™
);

125 
pC»d™R•ly
 = (
MLCC»d™R•ly
 *)
buf
;

126 
pC»d™R•ly
->
h
.
Ëngth
 = 
	`htÚs
((
MLCC»d™R•ly
));

127 
pC»d™R•ly
->
cmd
 |= 0x80;

128 
pC»d™R•ly
->
»suÉ
 = 0;

129 
	`MlcFÜw¬dR•ly
(
pc
, 
fd
, (*)
pC»d™R•ly
, (
MLCC»d™R•ly
));

131 
MLC_CREDIT_REQUEST
:

132 
pC»d™Req
 = (
MLCC»d™Reque¡
 *)
buf
;

133 ià(
út
++ < 5)

134 
	`BUG
("uÃx³ùed MLCC»d™Reque¡: cmd=%x, hid=%x,…id=%x, c»d™=%d\n", 
pC»d™Req
->
cmd
,

135 
pC»d™Req
->
hsock‘
,…C»d™Req->
psock‘
, 
	`Áohs
ÕC»d™Req->
üed™
));

136 
pC»d™ReqR•ly
 = (
MLCC»d™Reque¡R•ly
 *)
buf
;

137 
pC»d™ReqR•ly
->
h
.
Ëngth
 = 
	`htÚs
((
MLCC»d™Reque¡R•ly
));

138 
pC»d™ReqR•ly
->
cmd
 |= 0x80;

139 
pC»d™ReqR•ly
->
»suÉ
 = 0;

140 
pC»d™ReqR•ly
->
üed™
 = 0;

141 
	`MlcFÜw¬dR•ly
(
pc
, 
fd
, (*)
pC»d™ReqR•ly
, (
MLCC»d™Reque¡R•ly
));

143 
MLC_ERROR
:

144 
pE¼Ü
 = (
MLCE¼Ü
 *)
buf
;

145 
	`BUG
("uÃx³ùed MLCE¼Ü: cmd=%x,„esuÉ=%x\n", 
pE¼Ü
->
cmd
,…E¼Ü->
»suÉ
);

148 
pR•ly
 = (
MLCR•ly
 *)
buf
;

149 
	`BUG
("uÃx³ùed commªd: cmd=%x,„esuÉ=%x\n", 
pR•ly
->
cmd
,…R•ly->
»suÉ
);

150 
pR•ly
->
h
.
Ëngth
 = 
	`htÚs
((
MLCR•ly
));

151 
pR•ly
->
cmd
 |= 0x80;

152 
pR•ly
->
»suÉ
 = 1;

153 
	`MlcFÜw¬dR•ly
(
pc
, 
fd
, (*)
pR•ly
, (
MLCR•ly
));

157 
	}
}

160 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
	$MlcRev”£Cmd
(
mud_chªÃl
 *
pc
, 
fd
)

162 
mud_deviû
 *
pd
 = &
m¥
->
deviû
[
pc
->
dšdex
];

163 
buf
[
HPMUD_BUFFER_SIZE
];

164 
¡©
=0, 
Ën
, 
size
;

165 
pkËn
;

166 *
pBuf
;

167 
MLCR•ly
 *
pPk
;

169 
pPk
 = (
MLCR•ly
 *)
buf
;

171 
pBuf
 = 
buf
;

174 
size
 = (
MLCH—d”
);

175 
size
 > 0)

177 ià((
Ën
 = (
pd
->
vf
.
»ad
)(
fd
, 
pBuf
, 
size
, 
HPMUD_EXCEPTION_TIMEOUT
)) < 0)

179 
	`BUG
("unableo„ead MlcReverseCmd header: %m\n");

180 
¡©
 = 1;

181 
bugout
;

183 
size
-=
Ën
;

184 
pBuf
+=
Ën
;

188 ià((
pkËn
 = 
	`Áohs
(
pPk
->
h
.
Ëngth
)è> (
buf
))

190 
	`BUG
("šv®id MlcRev”£Cmd…ack‘ size: size=%d\n", 
pkËn
);

191 
¡©
 = 1;

192 
bugout
;

196 
size
 = 
pkËn
 - (
MLCH—d”
);

197 
size
 > 0)

199 ià((
Ën
 = (
pd
->
vf
.
»ad
)(
fd
, 
pBuf
, 
size
, 
HPMUD_EXCEPTION_TIMEOUT
)) < 0)

201 
	`BUG
("unableo„ead MlcReverseCmd data: %m\n");

202 
¡©
 = 1;

203 
bugout
;

205 
size
-=
Ën
;

206 
pBuf
+=
Ën
;

209 
¡©
 = 
	`MlcExecRev”£Cmd
(
pc
, 
fd
, 
buf
);

211 
bugout
:

212  
¡©
;

213 
	}
}

219 
	$MlcRev”£R•ly
(
mud_chªÃl
 *
pc
, 
fd
, *
buf
, 
bufsize
)

221 
mud_deviû
 *
pd
 = &
m¥
->
deviû
[
pc
->
dšdex
];

222 
¡©
=0, 
Ën
, 
size
, 
pkËn
;

223 *
pBuf
;

224 
MLCR•ly
 *
pPk
;

226 
pPk
 = (
MLCR•ly
 *)
buf
;

230 
pBuf
 = 
buf
;

233 
size
 = (
MLCH—d”
);

234 
size
 > 0)

236 ià((
Ën
 = (
pd
->
vf
.
»ad
)(
fd
, 
pBuf
, 
size
, 4000000)) < 0)

238 
	`BUG
("uÇbËØ»ad MlcRev”£R•ly h—d”: %m by‹sR—d=%zd\n", (
MLCH—d”
)-
size
);

239 
¡©
 = 2;

240 
bugout
;

242 
size
-=
Ën
;

243 
pBuf
+=
Ën
;

247 
pkËn
 = 
	`Áohs
(
pPk
->
h
.
Ëngth
);

248 ià(
pkËn
 < 0 ||…kËÀ> 
bufsize
)

250 
	`BUG
("šv®id MlcRev”£R•ly…ack‘ size: size=%d, buf=%d\n", 
pkËn
, 
bufsize
);

251 
¡©
 = 1;

252 
bugout
;

255 ià(
pkËn
 == 0)

258 
	`BUG
("trying MlcReverseReply firmware hack\n");

259 
	`memıy
(
buf
, &buf[1], (
MLCH—d”
)-1);

260 
pkËn
 = 
	`Áohs
(
pPk
->
h
.
Ëngth
);

261 ià(
pkËn
 <ğ0 ||…kËÀ> 
bufsize
)

263 
	`BUG
("šv®id MlcRev”£R•ly…ack‘ size: size=%d, buf=%d\n", 
pkËn
, 
bufsize
);

264 
¡©
 = 1;

265 
bugout
;

267 ià((
Ën
 = (
pd
->
vf
.
»ad
)(
fd
, --
pBuf
, 1, 1000000)) < 0)

269 
	`BUG
("unableo„ead MlcReverseReply header: %m\n");

270 
¡©
 = 1;

271 
bugout
;

273 
pBuf
++;

274 
	`DBG_DUMP
(
buf
, (
MLCH—d”
));

278 
size
 = 
pkËn
 - (
MLCH—d”
);

279 
size
 > 0)

281 ià((
Ën
 = (
pd
->
vf
.
»ad
)(
fd
, 
pBuf
, 
size
, 
HPMUD_EXCEPTION_TIMEOUT
)) < 0)

283 
	`BUG
("uÇbËØ»ad MlcRev”£R•ly d©a: %mƒxp=%zd‡ù=%zd\n", 
pkËn
-(
MLCH—d”
),…kËn-(MLCH—d”)-
size
);

284 
¡©
 = 1;

285 
bugout
;

287 
size
-=
Ën
;

288 
pBuf
+=
Ën
;

292 ià(
pPk
->
cmd
 & 0x80)

295 
¡©
 = 
	`MlcExecRev”£Cmd
(
pc
, 
fd
, 
buf
);

297 ià(
¡©
 != 0)

302 
bugout
:

303  
¡©
;

304 
	}
}

306 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
	$MlcIn™
(
mud_chªÃl
 *
pc
, 
fd
)

308 
mud_deviû
 *
pd
 = &
m¥
->
deviû
[
pc
->
dšdex
];

309 
buf
[
HPMUD_BUFFER_SIZE
];

310 
¡©
=0, 
Ën
, 
n
, 
út
;

311 
MLCIn™
 *
pCmd
;

312 
MLCIn™R•ly
 *
pR•ly
;

314 
	`mem£t
(
buf
, 0, (
MLCIn™
));

315 
pCmd
 = (
MLCIn™
 *)
buf
;

316 
n
 = (
MLCIn™
);

317 
pCmd
->
h
.
Ëngth
 = 
	`htÚs
(
n
);

318 
pCmd
->
cmd
 = 
MLC_INIT
;

319 
pCmd
->
»v
 = 3;

321 ià((
Ën
 = (
pd
->
vf
.
wr™e
)(
fd
, 
pCmd
, 
n
, 
HPMUD_EXCEPTION_TIMEOUT
)) !=‚)

323 
	`BUG
("unableo write MLCInit: %m\n");

324 
¡©
 = 1;

325 
bugout
;

328 
út
=0;

331 
¡©
 = 
	`MlcRev”£R•ly
(
pc
, 
fd
, 
buf
, (buf));

332 
pR•ly
 = (
MLCIn™R•ly
 *)
buf
;

334 ià((
¡©
 !ğ0è|| (
pR•ly
->
cmd
 !ğ(0x80 | 
MLC_INIT
)è|| (pR•ly->
»suÉ
 != 0))

336 ià(
”ºo
 =ğ
EIO
 && 
út
<1)

339 
	`BUG
("invalid MLCInitReply„etrying...\n");

340 
	`¦“p
(1);

341 
út
++;

344 ià(
¡©
 =ğ2 && 
út
<1)

347 
	`BUG
("invalid MLCInitReply„etrying command...\n");

348 
	`mem£t
(
buf
, 0, (
MLCIn™
));

349 
n
 = (
MLCIn™
);

350 
pCmd
->
h
.
Ëngth
 = 
	`htÚs
(
n
);

351 
pCmd
->
cmd
 = 
MLC_INIT
;

352 
pCmd
->
»v
 = 3;

353 (
pd
->
vf
.
wr™e
)(
fd
, 
pCmd
, 
n
, 
HPMUD_EXCEPTION_TIMEOUT
);

354 
út
++;

357 
	`BUG
("šv®id MLCIn™R•ly: cmd=%x,„esuÉ=%x\n,„evisiÚ=%x\n", 
pR•ly
->
cmd
,…R•ly->
»suÉ
,…R•ly->
»v
);

358 
¡©
 = 1;

359 
bugout
;

364 
bugout
:

365  
¡©
;

366 
	}
}

368 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
	$MlcEx™
(
mud_chªÃl
 *
pc
, 
fd
)

370 
mud_deviû
 *
pd
 = &
m¥
->
deviû
[
pc
->
dšdex
];

371 
buf
[
HPMUD_BUFFER_SIZE
];

372 
¡©
=0, 
Ën
, 
n
;

373 
MLCEx™
 *
pCmd
;

374 
MLCEx™R•ly
 *
pR•ly
;

376 
	`mem£t
(
buf
, 0, (
MLCEx™
));

377 
pCmd
 = (
MLCEx™
 *)
buf
;

378 
n
 = (
MLCEx™
);

379 
pCmd
->
h
.
Ëngth
 = 
	`htÚs
(
n
);

380 
pCmd
->
cmd
 = 
MLC_EXIT
;

382 ià((
Ën
 = (
pd
->
vf
.
wr™e
)(
fd
, 
pCmd
, 
n
, 
HPMUD_EXCEPTION_TIMEOUT
)) !=‚)

384 
	`BUG
("unableo write MLCExit: %m\n");

385 
¡©
 = 1;

386 
bugout
;

389 
¡©
 = 
	`MlcRev”£R•ly
(
pc
, 
fd
, 
buf
, (buf));

390 
pR•ly
 = (
MLCEx™R•ly
 *)
buf
;

392 ià((
¡©
 !ğ0è|| (
pR•ly
->
cmd
 !ğ(0x80 | 
MLC_EXIT
)è|| (pR•ly->
»suÉ
 != 0))

394 
	`BUG
("šv®id MLCEx™R•ly: cmd=%x,„esuÉ=%x\n", 
pR•ly
->
cmd
,…R•ly->
»suÉ
);

395 
¡©
 = 1;

396 
bugout
;

399 
bugout
:

400  
¡©
;

401 
	}
}

403 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
	$MlcCÚfigSock‘
(
mud_chªÃl
 *
pc
, 
fd
)

405 
mud_deviû
 *
pd
 = &
m¥
->
deviû
[
pc
->
dšdex
];

406 
buf
[
HPMUD_BUFFER_SIZE
];

407 
¡©
=0, 
Ën
, 
n
;

408 
MLCCÚfigSock‘
 *
pCmd
;

409 
MLCCÚfigSock‘R•ly
 *
pR•ly
;

411 ià(
pc
->

.
h2psize
 > 0)

412  
¡©
;

414 
	`mem£t
(
buf
, 0, (
MLCCÚfigSock‘
));

415 
pCmd
 = (
MLCCÚfigSock‘
 *)
buf
;

416 
n
 = (
MLCCÚfigSock‘
);

417 
pCmd
->
h
.
Ëngth
 = 
	`htÚs
(
n
);

418 
pCmd
->
cmd
 = 
MLC_CONFIG_SOCKET
;

419 
pCmd
->
sock‘
 = 
pc
->
sockid
;

420 
pCmd
->
h2psize
 = 
	`htÚs
(
HPMUD_BUFFER_SIZE
);

421 
pCmd
->
p2hsize
 = 
	`htÚs
(
HPMUD_BUFFER_SIZE
);

422 
pCmd
->
¡©us
 = 0;

424 ià((
Ën
 = (
pd
->
vf
.
wr™e
)(
fd
, 
pCmd
, 
n
, 
HPMUD_EXCEPTION_TIMEOUT
)) !=‚)

426 
	`BUG
("unableo write MLCConfigSocket: %m\n");

427 
¡©
 = 1;

428 
bugout
;

431 
¡©
 = 
	`MlcRev”£R•ly
(
pc
, 
fd
, 
buf
, (buf));

432 
pR•ly
 = (
MLCCÚfigSock‘R•ly
 *)
buf
;

434 ià((
¡©
 !ğ0è|| (
pR•ly
->
cmd
 !ğ(0x80 | 
MLC_CONFIG_SOCKET
)è|| (pR•ly->
»suÉ
 != 0))

436 
	`BUG
("šv®id MLCCÚfigSock‘R•ly: cmd=%x,„esuÉ=%x\n", 
pR•ly
->
cmd
,…R•ly->
»suÉ
);

437 
¡©
 = 1;

438 
bugout
;

441 
pc
->

.
h2psize
 = 
	`Áohs
(
pR•ly
->h2psize);

442 
pc
->

.
p2hsize
 = 
	`Áohs
(
pR•ly
->p2hsize);

444 
bugout
:

445  
¡©
;

446 
	}
}

449 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
	$MlcFÜw¬dD©a
(
mud_chªÃl
 *
pc
, 
fd
, cÚ¡ *
buf
, 
size
, 
u£c_timeout
)

451 
mud_deviû
 *
pd
 = &
m¥
->
deviû
[
pc
->
dšdex
];

452 
¡©
=0, 
Ën
, 
n
;

453 
MLCH—d”
 
h
;

455 
	`mem£t
(&
h
, 0, (h));

456 
n
 = (
MLCH—d”
è+ 
size
;

457 
h
.
Ëngth
 = 
	`htÚs
(
n
);

458 
h
.
hsid
 = 
pc
->
sockid
;

459 
h
.
psid
 = 
pc
->
sockid
;

461 ià((
Ën
 = (
pd
->
vf
.
wr™e
)(
fd
, &
h
, (
MLCH—d”
), 
u£c_timeout
)) != (MLCHeader))

463 
	`BUG
("unableo write MlcForwardData header: %m\n");

464 
¡©
 = 1;

465 
bugout
;

468 ià((
Ën
 = (
pd
->
vf
.
wr™e
)(
fd
, 
buf
, 
size
, 
u£c_timeout
)) != size)

470 
	`BUG
("unableo write MlcForwardData: %m\n");

471 
¡©
 = 1;

472 
bugout
;

475 
bugout
:

476  
¡©
;

477 
	}
}

480 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
	$MlcRev”£D©a
(
mud_chªÃl
 *
pc
, 
fd
, *
buf
, 
Ëngth
, 
u£c_timeout
)

482 
mud_deviû
 *
pd
 = &
m¥
->
deviû
[
pc
->
dšdex
];

483 
mud_chªÃl
 *
out_of_bound_chªÃl
;

484 
Ën
, 
size
, 
tÙ®
;

485 
MLCH—d”
 *
pPk
;

487 
pPk
 = (
MLCH—d”
 *)
buf
;

491 
tÙ®
 = 0;

494 
size
 = (
MLCH—d”
);

495 
size
 > 0)

498 ià(
tÙ®
 == 0)

499 
Ën
 = (
pd
->
vf
.
»ad
)(
fd
, 
buf
+
tÙ®
, 
size
, 
u£c_timeout
);

501 
Ën
 = (
pd
->
vf
.
»ad
)(
fd
, 
buf
+
tÙ®
, 
size
, 
HPMUD_EXCEPTION_TIMEOUT
);

503 ià(
Ën
 < 0)

506 ià(
u£c_timeout
 >ğ
HPMUD_EXCEPTION_TIMEOUT
 || 
tÙ®
 > 0)

507 
	`BUG
("uÇbËØ»ad MlcRev”£D©¨h—d”: %m %s\n", 
pd
->
uri
);

508 
bugout
;

510 
size
-=
Ën
;

511 
tÙ®
+=
Ën
;

515 
size
 = 
	`Áohs
(
pPk
->
Ëngth
è- (
MLCH—d”
);

517 ià(
size
 > 
Ëngth
)

519 
	`BUG
("šv®id MlcRev”£D©¨size: size=%d, buf=%d\n", 
size
, 
Ëngth
);

520 
bugout
;

524 ià(
pPk
->
hsid
 !ğ
pc
->
sockid
 &&…Pk->
psid
 !=…c->sockid)

526 ià(
pPk
->
hsid
 =ğ0 &&…Pk->
psid
 == 0)

529 
size
 > 0)

531 ià((
Ën
 = (
pd
->
vf
.
»ad
)(
fd
, 
buf
+
tÙ®
, 
size
, 
HPMUD_EXCEPTION_TIMEOUT
)) < 0)

533 
	`BUG
("unableo„ead MlcReverseData command: %m\n");

534 
bugout
;

536 
size
-=
Ën
;

537 
tÙ®
=
Ën
;

539 
	`MlcExecRev”£Cmd
(
pc
, 
fd
, 
buf
);

542 ià(
pPk
->
hsid
 =ğpPk->
psid
)

545 
out_of_bound_chªÃl
 = &
pd
->
chªÃl
[
pPk
->
hsid
];

546 *
pBuf
;

548 ià(
out_of_bound_chªÃl
->

.
p2hüed™
 <= 0)

550 
	`BUG
("šv®id d©¨·ck‘ c»d™=%d\n", 
out_of_bound_chªÃl
->

.
p2hüed™
);

551 
bugout
;

554 ià(
size
 > (
HPMUD_BUFFER_SIZE
 - 
out_of_bound_chªÃl
->
rút
))

556 
	`BUG
("šv®id d©¨·ck‘ size=%d\n", 
size
);

557 
bugout
;

560 
tÙ®
 = 0;

561 
pBuf
 = &
out_of_bound_chªÃl
->
rbuf
[out_of_bound_chªÃl->
rút
];

562 
size
 > 0)

564 ià((
Ën
 = (
pd
->
vf
.
»ad
)(
fd
, 
pBuf
+
tÙ®
, 
size
, 
HPMUD_EXCEPTION_TIMEOUT
)) < 0)

566 
	`BUG
("unableo„ead MlcReverseData: %m\n");

567 
bugout
;

569 
size
-=
Ën
;

570 
tÙ®
+=
Ën
;

573 
out_of_bound_chªÃl
->
rút
 +ğ
tÙ®
;

574 ià(
pPk
->
üed™
)

575 
out_of_bound_chªÃl
->

.
h2püed™
 +ğ
pPk
->
üed™
;

576 
out_of_bound_chªÃl
->

.
p2hüed™
--;

581 
MLCCmd
 *
pCmd
 = (MLCCmd *)
buf
;

582 
	`BUG
("šv®id MlcRev”£D©¨¡©e:ƒx°hsid=%x,‡ù hsid=%x,…sid=%x,†’gth=%d, c»d™=%d, stus=%x, cmd=%x\n", 
pc
->
sockid
,

583 
pPk
->
hsid
,…Pk->
psid
, 
	`Áohs
ÕPk->
Ëngth
),…Pk->
üed™
,…Pk->
¡©us
, 
pCmd
->
cmd
);

584 
bugout
;

588 ià(
pPk
->
üed™
)

590 
pc
->

.
h2püed™
 +ğ
pPk
->
üed™
;

593 
tÙ®
 = 0;

596 
size
 > 0)

598 ià((
Ën
 = (
pd
->
vf
.
»ad
)(
fd
, 
buf
+
tÙ®
, 
size
, 
HPMUD_EXCEPTION_TIMEOUT
)) < 0)

600 
	`BUG
("unableo„ead MlcReverseData: %m\n");

601 
bugout
;

603 
size
-=
Ën
;

604 
tÙ®
+=
Ën
;

609 
bugout
:

610  
tÙ®
;

611 
	}
}

613 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
	$MlcO³nChªÃl
(
mud_chªÃl
 *
pc
, 
fd
)

615 
mud_deviû
 *
pd
 = &
m¥
->
deviû
[
pc
->
dšdex
];

616 
buf
[
HPMUD_BUFFER_SIZE
];

617 
¡©
=0, 
Ën
, 
n
;

618 
MLCO³nChªÃl
 *
pCmd
;

619 
MLCO³nChªÃlR•ly
 *
pR•ly
;

621 
	`mem£t
(
buf
, 0, (
MLCO³nChªÃl
));

622 
pCmd
 = (
MLCO³nChªÃl
 *)
buf
;

623 
n
 = (
MLCO³nChªÃl
);

624 
pCmd
->
h
.
Ëngth
 = 
	`htÚs
(
n
);

625 
pCmd
->
cmd
 = 
MLC_OPEN_CHANNEL
;

626 
pCmd
->
hsock‘
 = 
pc
->
sockid
;

627 
pCmd
->
psock‘
 = 
pc
->
sockid
;

628 
pCmd
->
üed™
 = 
	`htÚs
(0);

631 ià((
Ën
 = (
pd
->
vf
.
wr™e
)(
fd
, 
pCmd
, 
n
, 
HPMUD_EXCEPTION_TIMEOUT
)) !=‚)

633 
	`BUG
("unableo write MlcOpenChannel: %m\n");

634 
¡©
 = 1;

635 
bugout
;

638 
¡©
 = 
	`MlcRev”£R•ly
(
pc
, 
fd
, 
buf
, (buf));

639 
pR•ly
 = (
MLCO³nChªÃlR•ly
 *)
buf
;

641 ià((
¡©
 !ğ0è|| (
pR•ly
->
cmd
 !ğ(0x80 | 
MLC_OPEN_CHANNEL
)è|| (pR•ly->
»suÉ
 != 0))

643 
	`BUG
("šv®id MlcO³nChªÃlR•ly: cmd=%x,„esuÉ=%x\n", 
pR•ly
->
cmd
,…R•ly->
»suÉ
);

644 
¡©
 = 1;

645 
bugout
;

648 
pc
->

.
h2püed™
 = 
	`Áohs
(
pR•ly
->
üed™
);

650 
bugout
:

651  
¡©
;

652 
	}
}

654 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
	$MlcClo£ChªÃl
(
mud_chªÃl
 *
pc
, 
fd
)

656 
mud_deviû
 *
pd
 = &
m¥
->
deviû
[
pc
->
dšdex
];

657 
buf
[
HPMUD_BUFFER_SIZE
];

658 
¡©
=0, 
Ën
, 
n
;

659 
MLCClo£ChªÃl
 *
pCmd
;

660 
MLCClo£ChªÃlR•ly
 *
pR•ly
;

662 
	`mem£t
(
buf
, 0, (
MLCClo£ChªÃl
));

663 
pCmd
 = (
MLCClo£ChªÃl
 *)
buf
;

664 
n
 = (
MLCClo£ChªÃl
);

665 
pCmd
->
h
.
Ëngth
 = 
	`htÚs
(
n
);

666 
pCmd
->
cmd
 = 
MLC_CLOSE_CHANNEL
;

667 
pCmd
->
hsock‘
 = 
pc
->
sockid
;

668 
pCmd
->
psock‘
 = 
pc
->
sockid
;

670 ià((
Ën
 = (
pd
->
vf
.
wr™e
)(
fd
, 
pCmd
, 
n
, 
HPMUD_EXCEPTION_TIMEOUT
)) !=‚)

672 
	`BUG
("unableo write MlcCloseChannel: %m\n");

673 
¡©
 = 1;

674 
bugout
;

677 
¡©
 = 
	`MlcRev”£R•ly
(
pc
, 
fd
, 
buf
, (buf));

678 
pR•ly
 = (
MLCClo£ChªÃlR•ly
 *)
buf
;

680 ià((
¡©
 !ğ0è|| (
pR•ly
->
cmd
 !ğ(0x80 | 
MLC_CLOSE_CHANNEL
)è|| (pR•ly->
»suÉ
 != 0))

682 
	`BUG
("šv®id MlcClo£ChªÃlR•ly: cmd=%x,„esuÉ=%x\n", 
pR•ly
->
cmd
,…R•ly->
»suÉ
);

683 
¡©
 = 1;

684 
bugout
;

687 
bugout
:

688  
¡©
;

689 
	}
}

691 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
	$MlcC»d™
(
mud_chªÃl
 *
pc
, 
fd
, 
üed™
)

693 
mud_deviû
 *
pd
 = &
m¥
->
deviû
[
pc
->
dšdex
];

694 
buf
[
HPMUD_BUFFER_SIZE
];

695 
¡©
=0, 
Ën
, 
n
;

696 
MLCC»d™
 *
pCmd
;

697 
MLCC»d™R•ly
 *
pR•ly
;

699 
	`mem£t
(
buf
, 0, (
MLCC»d™
));

700 
pCmd
 = (
MLCC»d™
 *)
buf
;

701 
n
 = (
MLCC»d™
);

702 
pCmd
->
h
.
Ëngth
 = 
	`htÚs
(
n
);

703 
pCmd
->
cmd
 = 
MLC_CREDIT
;

704 
pCmd
->
hsock‘
 = 
pc
->
sockid
;

705 
pCmd
->
psock‘
 = 
pc
->
sockid
;

706 
pCmd
->
üed™
 = 
	`htÚs
(credit);

708 ià((
Ën
 = (
pd
->
vf
.
wr™e
)(
fd
, 
pCmd
, 
n
, 
HPMUD_EXCEPTION_TIMEOUT
)) !=‚)

710 
	`BUG
("unableo write MlcCredit: %m\n");

711 
¡©
 = 1;

712 
bugout
;

715 
¡©
 = 
	`MlcRev”£R•ly
(
pc
, 
fd
, 
buf
, (buf));

716 
pR•ly
 = (
MLCC»d™R•ly
 *)
buf
;

718 ià((
¡©
 !ğ0è|| (
pR•ly
->
cmd
 !ğ(0x80 | 
MLC_CREDIT
)è|| (pR•ly->
»suÉ
 != 0))

720 
	`BUG
("šv®id MlcC»d™R•ly: cmd=%x,„esuÉ=%x\n", 
pR•ly
->
cmd
,…R•ly->
»suÉ
);

721 
¡©
 = 1;

722 
bugout
;

725 
pc
->

.
p2hüed™
 +ğ
üed™
;

727 
bugout
:

728  
¡©
;

729 
	}
}

731 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
	$MlcC»d™Reque¡
(
mud_chªÃl
 *
pc
, 
fd
, 
üed™
)

733 
mud_deviû
 *
pd
 = &
m¥
->
deviû
[
pc
->
dšdex
];

734 
buf
[
HPMUD_BUFFER_SIZE
];

735 
¡©
=0, 
Ën
, 
n
;

736 
MLCC»d™Reque¡
 *
pCmd
;

737 
MLCC»d™Reque¡R•ly
 *
pR•ly
;

739 
	`mem£t
(
buf
, 0, (
MLCC»d™Reque¡
));

740 
pCmd
 = (
MLCC»d™Reque¡
 *)
buf
;

741 
n
 = (
MLCC»d™Reque¡
);

742 
pCmd
->
h
.
Ëngth
 = 
	`htÚs
(
n
);

743 
pCmd
->
cmd
 = 
MLC_CREDIT_REQUEST
;

744 
pCmd
->
hsock‘
 = 
pc
->
sockid
;

745 
pCmd
->
psock‘
 = 
pc
->
sockid
;

746 
pCmd
->
üed™
 = 
	`htÚs
(credit);

748 ià((
Ën
 = (
pd
->
vf
.
wr™e
)(
fd
, 
pCmd
, 
n
, 
HPMUD_EXCEPTION_TIMEOUT
)) !=‚)

750 
	`BUG
("unableo write MlcCreditRequest: %m\n");

751 
¡©
 = 1;

752 
bugout
;

755 
¡©
 = 
	`MlcRev”£R•ly
(
pc
, 
fd
, 
buf
, (buf));

756 
pR•ly
 = (
MLCC»d™Reque¡R•ly
 *)
buf
;

758 ià((
¡©
 !ğ0è|| (
pR•ly
->
cmd
 !ğ(0x80 | 
MLC_CREDIT_REQUEST
)è|| (pR•ly->
»suÉ
 != 0))

760 
	`BUG
("šv®id MlcC»d™Reque¡R•ly: cmd=%x,„esuÉ=%x\n", 
pR•ly
->
cmd
,…R•ly->
»suÉ
);

761 
¡©
 = 1;

762 
bugout
;

765 
pc
->

.
h2püed™
 +ğ
	`Áohs
(
pR•ly
->
üed™
);

767 
bugout
:

768  
¡©
;

769 
	}
}

	@io/hpmud/mlc.h

26 #iâdeà
_MLC_H


27 
	#_MLC_H


	)

29 
	eMLC_COMMAND


31 
	mMLC_INIT
 = 0,

32 
	mMLC_OPEN_CHANNEL
 = 1,

33 
	mMLC_CLOSE_CHANNEL
 = 2,

34 
	mMLC_CREDIT
 = 3,

35 
	mMLC_CREDIT_REQUEST
 = 4,

36 
	mMLC_DEBIT
 = 5,

37 
	mMLC_DEBIT_REQUEST
 = 6,

38 
	mMLC_CONFIG_SOCKET
 = 7,

39 
	mMLC_EXIT
 = 8,

40 
	mMLC_ERROR
 = 0x7f

45 
	mhsid
;

46 
	mpsid
;

47 
	mËngth
;

48 
	müed™
;

49 
	m¡©us
;

50 } 
	t__©Œibu‹__
((
	t·cked
)è
	tMLCH—d”
;

54 
MLCH—d”
 
	mh
;

55 
	mcmd
;

56 
	m»v
;

57 } 
	t__©Œibu‹__
((
	t·cked
)è
	tMLCIn™
;

61 
MLCH—d”
 
	mh
;

62 
	mcmd
;

63 
	m»suÉ
;

64 
	m»v
;

65 } 
	t__©Œibu‹__
((
	t·cked
)è
	tMLCIn™R•ly
;

69 
MLCH—d”
 
	mh
;

70 
	mcmd
;

71 } 
	t__©Œibu‹__
((
	t·cked
)è
	tMLCEx™
;

75 
MLCH—d”
 
	mh
;

76 
	mcmd
;

77 
	m»suÉ
;

78 } 
	t__©Œibu‹__
((
	t·cked
)è
	tMLCEx™R•ly
;

82 
MLCH—d”
 
	mh
;

83 
	mcmd
;

84 
	msock‘
;

85 
	mh2psize
;

86 
	mp2hsize
;

87 
	m¡©us
;

88 } 
	t__©Œibu‹__
((
	t·cked
)è
	tMLCCÚfigSock‘
;

92 
MLCH—d”
 
	mh
;

93 
	mcmd
;

94 
	m»suÉ
;

95 
	mh2psize
;

96 
	mp2hsize
;

97 
	m¡©us
;

98 } 
	t__©Œibu‹__
((
	t·cked
)è
	tMLCCÚfigSock‘R•ly
;

102 
MLCH—d”
 
	mh
;

103 
	mcmd
;

104 
	mhsock‘
;

105 
	mpsock‘
;

106 
	müed™
;

107 } 
	t__©Œibu‹__
((
	t·cked
)è
	tMLCO³nChªÃl
;

111 
MLCH—d”
 
	mh
;

112 
	mcmd
;

113 
	m»suÉ
;

114 
	müed™
;

115 } 
	t__©Œibu‹__
((
	t·cked
)è
	tMLCO³nChªÃlR•ly
;

119 
MLCH—d”
 
	mh
;

120 
	mcmd
;

121 
	mhsock‘
;

122 
	mpsock‘
;

123 } 
	t__©Œibu‹__
((
	t·cked
)è
	tMLCClo£ChªÃl
;

125 
MLCEx™R•ly
 
	tMLCClo£ChªÃlR•ly
;

126 
MLCEx™R•ly
 
	tMLCR•ly
;

127 
MLCEx™
 
	tMLCCmd
;

128 
MLCO³nChªÃl
 
	tMLCC»d™
;

129 
MLCEx™R•ly
 
	tMLCC»d™R•ly
;

130 
MLCO³nChªÃl
 
	tMLCC»d™Reque¡
;

131 
MLCO³nChªÃlR•ly
 
	tMLCC»d™Reque¡R•ly
;

132 
MLCEx™R•ly
 
	tMLCE¼Ü
;

134 
	g_mud_deviû
;

135 
	g_mud_chªÃl
;

137 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
cut_buf
(
_mud_chªÃl
 *
pc
, *
buf
, 
size
);

138 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
MlcIn™
(
_mud_chªÃl
 *
pc
, 
fd
);

139 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
MlcEx™
(
_mud_chªÃl
 *
pc
, 
fd
);

140 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
MlcCÚfigSock‘
(
_mud_chªÃl
 *
pc
, 
fd
);

141 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
MlcFÜw¬dD©a
(
_mud_chªÃl
 *
pc
, 
fd
, cÚ¡ *
buf
, 
size
, 
u£c_timeout
);

142 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
MlcRev”£D©a
(
_mud_chªÃl
 *
pc
, 
fd
, *
buf
, 
Ëngth
, 
u£c_timeout
);

143 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
MlcO³nChªÃl
(
_mud_chªÃl
 *
pc
, 
fd
);

144 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
MlcClo£ChªÃl
(
_mud_chªÃl
 *
pc
, 
fd
);

145 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
MlcC»d™
(
_mud_chªÃl
 *
pc
, 
fd
, 
üed™
);

146 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
MlcC»d™Reque¡
(
_mud_chªÃl
 *
pc
, 
fd
, 
üed™
);

147 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
MlcRev”£Cmd
(
_mud_chªÃl
 *
pc
, 
fd
);

	@io/hpmud/model.c

26 #iâdeà
_GNU_SOURCE


27 
	#_GNU_SOURCE


	)

30 
	~<sys/ty³s.h
>

31 
	~<sys/¡©.h
>

32 
	~<¡dio.h
>

33 
	~<¡dlib.h
>

34 
	~<fú.h
>

35 
	~<¡ršg.h
>

36 
	~<uni¡d.h
>

37 
	~<¡d¬g.h
>

38 
	~"li¡.h
"

39 
	~"hpmud.h
"

40 
	~"hpmudi.h
"

42 
	#SECTION_SIZE
 4096

	)

46 *
	mÇme
;

47 *
	mšcFe
;

48 
	mv®ueSize
;

49 *
	mv®ue
;

50 
li¡_h—d
 
	mli¡
;

51 } 
	tLab–RecÜd
;

53 
Lab–RecÜd
 
	gh—d
;

54 
	ghomedœ
[255] = "";

56 
	$G‘Paœ
(*
buf
, 
buf_Ën
, *
key
, *
v®ue
, **

)

58 
i
=0, 
j
;

60 
key
[0] = 0;

61 
v®ue
[0] = 0;

63 ià(
buf
[
i
] == '#')

65 ; 
buf
[
i
] !ğ'\n' && i < 
buf_Ën
; i++);

66 ià(
buf
[
i
] == '\n')

67 
i
++;

70 
j
 = 0;

71 (
buf
[
i
] !ğ'='è&& (˜< 
buf_Ën
è&& (
j
 < 
HPMUD_LINE_SIZE
))

72 
key
[
j
++] = 
buf
[
i
++];

73 
j
--; 
key
[j] == ' ' && j > 0; j--);

74 
key
[++
j
] = 0;

76 ià(
buf
[
i
] == '=')

77 
i
++; 
buf
[i] =ğ' ' && i < 
buf_Ën
; i++);

79 
j
 = 0;

80 (
buf
[
i
] !ğ'\n'è&& (˜< 
buf_Ën
è&& (
j
 < 
HPMUD_LINE_SIZE
))

81 
v®ue
[
j
++] = 
buf
[
i
++];

82 
j
--; 
v®ue
[j] == ' ' && j > 0; j--);

83 
v®ue
[++
j
] = 0;

85 ià(
buf
[
i
] == '\n')

86 
i
++;

88 ià(

 !ğ
NULL
)

89 *

 = 
buf
 + 
i
;

91  
i
;

92 
	}
}

94 
	$R—dCÚfig
()

96 
key
[
HPMUD_LINE_SIZE
];

97 
v®ue
[
HPMUD_LINE_SIZE
];

98 
rcbuf
[255];

99 
£ùiÚ
[32];

100 *

;

101 
FILE
 *
šFe
 = 
NULL
;

102 
¡©
=1;

104 
homedœ
[0] = 0;

106 if((
šFe
 = 
	`fİ’
(
CONFDIR
 "/h¶.cÚf", "r")è=ğ
NULL
)

108 
	`BUG
("uÇbËØİ’ %s: %m\n", 
CONFDIR
 "/hplip.conf");

109 
bugout
;

112 
£ùiÚ
[0] = 0;

115 (
	`fg‘s
(
rcbuf
, Ôcbuf), 
šFe
è!ğ
NULL
))

117 ià(
rcbuf
[0] == '[')

119 
	`¡ºıy
(
£ùiÚ
, 
rcbuf
, (section));

123 
	`G‘Paœ
(
rcbuf
, 
	`¡¾’
Ôcbuf), 
key
, 
v®ue
, &

);

125 ià((
	`¡ºÿ£cmp
(
£ùiÚ
, "[dœs]", 6è=ğ0è&& (
	`¡rÿ£cmp
(
key
, "home") == 0))

127 
	`¡ºıy
(
homedœ
, 
v®ue
, (homedir));

132 
¡©
 = 0;

134 
bugout
:

135 ià(
šFe
 !ğ
NULL
)

136 
	`fşo£
(
šFe
);

138  
¡©
;

139 
	}
}

142 *
	$¡¼¡r
(cÚ¡ *
x
, cÚ¡ *
y
)

144 *
´ev
=
NULL
, *
Ãxt
;

146 ià(*
y
 == '\0')

147  
	`¡rchr
(
x
, '\0');

149 (
Ãxt
 = 
	`¡r¡r
(
x
, 
y
)è!ğ
NULL
)

151 
´ev
 = 
Ãxt
;

152 
x
 = 
Ãxt
 + 1;

154  
´ev
;

155 
	}
}

157 
	$CİyLab–
(*
Ïb–
, *
buf
, 
bufSize
)

159 
li¡_h—d
 *
p
;

160 
Lab–RecÜd
 *
¶
;

161 
i
=0, 
found
=0;

164 
	`li¡_fÜ_—ch
(
p
, &
h—d
.
li¡
)

166 
¶
 = 
	`li¡_’Œy
(
p
, 
Lab–RecÜd
, 
li¡
);

167 ià(
	`¡rÿ£cmp
(
¶
->
Çme
, 
Ïb–
) == 0)

169 
found
 = 1;

174 ià(!
found
)

176 
	`BUG
("”rÜ undefšed†ab– %s\n", 
Ïb–
);

177 
bugout
;

180 ià(
¶
->
v®ueSize
 > 
bufSize
)

182 
	`BUG
("”rÜ†ab– % size=%d buf=%d\n", 
Ïb–
, 
¶
->
v®ueSize
, 
bufSize
);

183 
bugout
;

186 
	`memıy
(
buf
, 
¶
->
v®ue
,…l->
v®ueSize
);

187 
i
=
¶
->
v®ueSize
;

189 
bugout
:

190  
i
;

191 
	}
}

193 
	$ResŞveA‰ribu‹s
(
FILE
 *
å
, *
©Œ
, 
©ŒSize
)

195 
Ïb–
[128];

196 
i
=0, 
j
, 
ch
;

199 
ch
 = 
	`fg‘c
(
å
);

200 
ch
 !ğ
EOF
)

202 ià(
ch
 == '[')

204 
	`ung‘c
(
ch
, 
å
);

208 ià(
ch
 == '#' || ch == ' ')

210 (
ch
 = 
	`fg‘c
(
å
)è!ğ'\n' && ch !ğ
EOF
);

212 ià(
ch
 == '\n')

216 ià(
ch
 == '%')

218 
j
=0;

219 (
ch
 = 
	`fg‘c
(
å
)è!ğ'\n' && ch !ğ
EOF
)

221 ià(
j
 < (
Ïb–
)-1)

222 
Ïb–
[
j
++] = 
ch
;

224 
Ïb–
[
j
-1] = 0;

225 
i
 +ğ
	`CİyLab–
(
Ïb–
, 
©Œ
+i, 
©ŒSize
-i);

229 ià(
i
 < 
©ŒSize
-1)

230 
©Œ
[
i
++] = 
ch
;

231 (
ch
 = 
	`fg‘c
(
å
)è!ğ'\n' && ch !ğ
EOF
)

233 ià(
i
 < 
©ŒSize
-1)

234 
©Œ
[
i
++] = 
ch
;

236 ià(
i
 < 
©ŒSize
-1)

237 
©Œ
[
i
++] = '\n';

240 ià(
ch
 == '\n')

241 
ch
 = 
	`fg‘c
(
å
);

245 
©Œ
[
i
] = 0;

247  
i
;

248 
	}
}

249 
	$Regi¡”Lab–
(
FILE
 *
å
, *
šcFe
, *
Ïb–
)

251 
li¡_h—d
 *
p
;

252 
Lab–RecÜd
 *
¶
;

253 
buf
[
SECTION_SIZE
];

254 
i
=0, 
¡©
=1, 
ch
;

257 
	`li¡_fÜ_—ch
(
p
, &
h—d
.
li¡
)

259 
¶
 = 
	`li¡_’Œy
(
p
, 
Lab–RecÜd
, 
li¡
);

260 ià(
	`¡rÿ£cmp
(
¶
->
Çme
, 
Ïb–
) == 0)

262 
	`BUG
("”rÜ du¶iÿ‹†ab– %s\n", 
Ïb–
);

263 
bugout
;

267 ià((
¶
 = (
Lab–RecÜd
 *)
	`m®loc
((Lab–RecÜd))è=ğ
NULL
)

269 
	`BUG
("unableo creat†abel„ecord: %m\n");

270 
bugout
;

273 
¶
->
šcFe
 = 
	`¡rdup
(incFile);

274 
¶
->
Çme
 = 
	`¡rdup
(
Ïb–
);

277 
ch
 = 
	`fg‘c
(
å
);

278 
ch
 !ğ
EOF
)

280 ià(
ch
 == '[')

282 
	`ung‘c
(
ch
, 
å
);

286 ià(
ch
 == '#' || ch == ' ')

288 (
ch
 = 
	`fg‘c
(
å
)è!ğ'\n' && ch !ğ
EOF
);

290 ià(
ch
 == '\n')

296 ià(
i
 < 
SECTION_SIZE
-1)

297 
buf
[
i
++] = 
ch
;

298 (
ch
 = 
	`fg‘c
(
å
)è!ğ'\n' && ch !ğ
EOF
)

300 ià(
i
 < 
SECTION_SIZE
-1)

301 
buf
[
i
++] = 
ch
;

303 ià(
i
 < 
SECTION_SIZE
-1)

304 
buf
[
i
++] = '\n';

307 ià(
ch
 == '\n')

308 
ch
 = 
	`fg‘c
(
å
);

312 
buf
[
i
] = 0;

314 
¶
->
v®ue
 = 
	`¡rdup
(
buf
);

315 
¶
->
v®ueSize
 = 
i
;

317 
	`li¡_add
(&(
¶
->
li¡
), &(
h—d
.list));

318 
¡©
 = 0;

320 
bugout
:

322  
¡©
;

323 
	}
}

325 
	$UnRegi¡”Lab–
(
Lab–RecÜd
 *
¶
)

327 ià(
¶
->
šcFe
)

328 
	`ä“
(
¶
->
šcFe
);

329 ià(
¶
->
Çme
)

330 
	`ä“
(
¶
->
Çme
);

331 ià(
¶
->
v®ue
)

332 
	`ä“
(
¶
->
v®ue
);

333 
	`li¡_d–
(&(
¶
->
li¡
));

334 
	`ä“
(
¶
);

336 
	}
}

338 
	$D–Li¡
()

340 
li¡_h—d
 *
p
, *
n
;

341 
Lab–RecÜd
 *
¶
;

344 
	`li¡_fÜ_—ch_§ã
(
p
, 
n
, &
h—d
.
li¡
)

346 
¶
 = 
	`li¡_’Œy
(
p
, 
Lab–RecÜd
, 
li¡
);

347 
	`UnRegi¡”Lab–
(
¶
);

350 
	}
}

353 
	$P¬£Inc
(*
šcFe
)

355 
FILE
 *
å
=
NULL
;

356 
li¡_h—d
 *
p
;

357 
Lab–RecÜd
 *
¶
;

358 
rcbuf
[255];

359 
£ùiÚ
[128];

360 
¡©
=1, 
n
;

363 
	`li¡_fÜ_—ch
(
p
, &
h—d
.
li¡
)

365 
¶
 = 
	`li¡_’Œy
(
p
, 
Lab–RecÜd
, 
li¡
);

366 ià(
	`¡rcmp
(
¶
->
šcFe
, incFile) == 0)

368 
	`BUG
("”rÜ du¶iÿ‹ inşudf%s\n", 
šcFe
);

369 
bugout
;

373 ià((
å
 = 
	`fİ’
(
šcFe
, "r")è=ğ
NULL
)

375 
	`BUG
("İ’ % çed: %m\n", 
šcFe
);

376 
bugout
;

379 
£ùiÚ
[0] = 0;

382 (
	`fg‘s
(
rcbuf
, Ôcbuf), 
å
è!ğ
NULL
))

384 ià(
rcbuf
[0] == '[')

386 
	`¡ºıy
(
£ùiÚ
, 
rcbuf
+1, (section));

387 
n
 = 
	`¡¾’
(
£ùiÚ
);

388 
£ùiÚ
[
n
-2]=0;

389 
	`Regi¡”Lab–
(
å
, 
šcFe
, 
£ùiÚ
);

393 
¡©
 = 0;

395 
bugout
:

396 ià(
å
)

397 
	`fşo£
(
å
);

398  
¡©
;

399 
	}
}

402 
	$P¬£Fe
(*
d©Fe
, *
mod–
, *
©Œ
, 
©ŒSize
, *
by‹s_»ad
)

404 
FILE
 *
å
;

405 
rcbuf
[255];

406 
£ùiÚ
[128];

407 
fe
[128];

408 
found
=0, 
n
;

410 ià((
å
 = 
	`fİ’
(
d©Fe
, "r")è=ğ
NULL
)

411 
bugout
;

413 
£ùiÚ
[0] = 0;

416 (
	`fg‘s
(
rcbuf
, Ôcbuf), 
å
è!ğ
NULL
))

418 ià(
rcbuf
[0] == '[')

420 
	`¡ºıy
(
£ùiÚ
, 
rcbuf
+1, (section));

421 
n
 = 
	`¡¾’
(
£ùiÚ
);

422 
£ùiÚ
[
n
-2]=0;

423 ià(
	`¡rÿ£cmp
(
mod–
, 
£ùiÚ
) == 0)

426 *
by‹s_»ad
 = 
	`ResŞveA‰ribu‹s
(
å
, 
©Œ
, 
©ŒSize
);

427 
found
 = 1;

431 ià(
	`¡ºcmp
(
rcbuf
, "%include", 8) == 0)

433 
	`¡ºıy
(
fe
, 
d©Fe
, (file));

434 
n
 = 
	`¡¼¡r
(
fe
, "/") - file + 1;

435 
	`¡ºıy
(
fe
+
n
, 
rcbuf
+9, (file)-n);

436 
n
 = 
	`¡¾’
(
fe
);

437 
fe
[
n
-1]=0;

438 
	`P¬£Inc
(
fe
);

442 
bugout
:

443 ià(
å
)

444 
	`fşo£
(
å
);

446  
found
;

447 
	}
}

450 
	$·r£_key_v®ue_·œ
(*
buf
, 
Ën
, 
hpmud_mod–_©Œibu‹s
 *
ma
)

452 
key
[
HPMUD_LINE_SIZE
];

453 
v®ue
[
HPMUD_LINE_SIZE
];

454 *

, *
2
;

455 
i
=0, 
»t
=
HPMUD_R_OK
;

457 
ma
->
´t_mode
 = 
HPMUD_RAW_MODE
;

458 
ma
->
må_mode
 = 
HPMUD_DOT4_MODE
;

459 
ma
->
sÿÁy³
 = 0;

460 
ma
->
¡©u¡y³
 = 
HPMUD_STATUSTYPE_SFIELD
;

461 
ma
->
suµÜt
 = 
HPMUD_SUPPORT_TYPE_NONE
;

463 ià(
buf
 =ğ
NULL
)

464  
HPMUD_R_OK
;

466 

 = 
buf
;

468 
i
 < 
Ën
)

470 
i
 +ğ
	`G‘Paœ
(

, 
Ën
-i, 
key
, 
v®ue
, &tail);

472 ià(
	`¡rÿ£cmp
(
key
, "io-mode") == 0)

474 
ma
->
´t_mode
 = 
	`¡¹Ş
(
v®ue
, &
2
, 10);

476 ià(
	`¡rÿ£cmp
(
key
, "io-mfp-mode") == 0)

478 
ma
->
må_mode
 = 
	`¡¹Ş
(
v®ue
, &
2
, 10);

480 if(
	`¡rÿ£cmp
(
key
, "scan-type") == 0)

482 
ma
->
sÿÁy³
 = 
	`¡¹Ş
(
v®ue
, &
2
, 10);

484 if(
	`¡rÿ£cmp
(
key
, "scan-src") == 0)

486 
ma
->
sÿn¤c
 = 
	`¡¹Ş
(
v®ue
, &
2
, 10);

488 if(
	`¡rÿ£cmp
(
key
, "status-type") == 0)

490 
ma
->
¡©u¡y³
 = 
	`¡¹Ş
(
v®ue
, &
2
, 10);

492 if(
	`¡rÿ£cmp
(
key
, "support-type") == 0)

494 
ma
->
suµÜt
 = 
	`¡¹Ş
(
v®ue
, &
2
, 10);

496 if(
	`¡rÿ£cmp
(
key
, "plugin") == 0)

498 
ma
->
¶ugš
 = 
	`¡¹Ş
(
v®ue
, &
2
, 10);

506  
»t
;

507 
	}
}

510 
HPMUD_RESULT
 
	$hpmud_g‘_mod–_©Œibu‹s
(*
uri
, *
©Œ
, 
©ŒSize
, *
by‹s_»ad
)

512 
sz
[256];

513 
mod–
[256];

514 
found
;

515 
HPMUD_RESULT
 
¡©
 = 
HPMUD_R_DATFILE_ERROR
;

517 
	`mem£t
(
©Œ
, 0, 
©ŒSize
);

519 
	`INIT_LIST_HEAD
(&
h—d
.
li¡
);

521 ià(
homedœ
[0] == 0)

522 
	`R—dCÚfig
();

524 
	`hpmud_g‘_uri_mod–
(
uri
, 
mod–
, (model));

527 
	`¢´štf
(
sz
, (sz), "%s/d©a/mod–s/mod–s.d©", 
homedœ
);

528 
found
 = 
	`P¬£Fe
(
sz
, 
mod–
, 
©Œ
, 
©ŒSize
, 
by‹s_»ad
);

530 ià(!
found
)

532 
	`BUG
("nØ% ©Œibu‹ found iÀ%s\n", 
mod–
, 
sz
);

534 
	`D–Li¡
();

537 
	`¢´štf
(
sz
, (sz), "%s/d©a/mod–s/uÄ–—£d/uÄ–—£d.d©", 
homedœ
);

538 
found
 = 
	`P¬£Fe
(
sz
, 
mod–
, 
©Œ
, 
©ŒSize
, 
by‹s_»ad
);

541 ià(!
found
)

543 
	`BUG
("nØ% ©Œibu‹ found iÀ%s\n", 
mod–
, 
sz
);

544 
bugout
;

547 
¡©
 = 
HPMUD_R_OK
;

549 
bugout
:

550 
	`D–Li¡
();

551  
¡©
;

552 
	}
}

555 
HPMUD_RESULT
 
	$hpmud_qu”y_mod–
(*
uri
, 
hpmud_mod–_©Œibu‹s
 *
ma
)

557 
buf
[
SECTION_SIZE
];

558 
Ën
;

559 
HPMUD_RESULT
 
¡©
 = 
HPMUD_R_DATFILE_ERROR
;

561 
	`·r£_key_v®ue_·œ
(
NULL
, 0, 
ma
);

563 ià(
	`hpmud_g‘_mod–_©Œibu‹s
(
uri
, 
buf
, (buf), &
Ën
) != 0)

564 
bugout
;

566 
	`·r£_key_v®ue_·œ
(
buf
, 
Ën
, 
ma
);

568 
¡©
=
HPMUD_R_OK
;

570 
bugout
:

572  
¡©
;

573 
	}
}

	@io/hpmud/musb.c

28 
	~"hpmud.h
"

29 
	~"hpmudi.h
"

30 
	~<dlfú.h
>

31 
	~<¡dlib.h
>

32 
	~"uts.h
"

35 
mud_deviû_vf
 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
	gmusb_mud_deviû_vf
 =

37 .
»ad
 = 
musb_»ad
,

38 .
	gwr™e
 = 
musb_wr™e
,

39 .
	gİ’
 = 
musb_İ’
,

40 .
	gşo£
 = 
musb_şo£
,

41 .
	gg‘_deviû_id
 = 
musb_g‘_deviû_id
,

42 .
	gg‘_deviû_¡©us
 = 
musb_g‘_deviû_¡©us
,

43 .
	gchªÃl_İ’
 = 
musb_chªÃl_İ’
,

44 .
	gchªÃl_şo£
 = 
musb_chªÃl_şo£
,

45 .
	gchªÃl_wr™e
 = 
musb_chªÃl_wr™e
,

46 .
	gchªÃl_»ad
 = 
musb_chªÃl_»ad


49 
mud_chªÃl_vf
 
	gmusb_¿w_chªÃl_vf
 =

51 .
İ’
 = 
musb_¿w_chªÃl_İ’
,

52 .
	gşo£
 = 
musb_¿w_chªÃl_şo£
,

53 .
	gchªÃl_wr™e
 = 
musb_¿w_chªÃl_wr™e
,

54 .
	gchªÃl_»ad
 = 
musb_¿w_chªÃl_»ad


57 
mud_chªÃl_vf
 
	gmusb_comp_chªÃl_vf
 =

59 .
İ’
 = 
musb_comp_chªÃl_İ’
,

60 .
	gşo£
 = 
musb_¿w_chªÃl_şo£
,

61 .
	gchªÃl_wr™e
 = 
musb_¿w_chªÃl_wr™e
,

62 .
	gchªÃl_»ad
 = 
musb_¿w_chªÃl_»ad


65 
mud_chªÃl_vf
 
	gmusb_mlc_chªÃl_vf
 =

67 .
İ’
 = 
musb_mlc_chªÃl_İ’
,

68 .
	gşo£
 = 
musb_mlc_chªÃl_şo£
,

69 .
	gchªÃl_wr™e
 = 
musb_mlc_chªÃl_wr™e
,

70 .
	gchªÃl_»ad
 = 
musb_mlc_chªÃl_»ad


73 
mud_chªÃl_vf
 
	gmusb_dÙ4_chªÃl_vf
 =

75 .
İ’
 = 
musb_dÙ4_chªÃl_İ’
,

76 .
	gşo£
 = 
musb_dÙ4_chªÃl_şo£
,

77 .
	gchªÃl_wr™e
 = 
musb_dÙ4_chªÃl_wr™e
,

78 .
	gchªÃl_»ad
 = 
musb_dÙ4_chªÃl_»ad


85 *
	gfd_Çme
[
MAX_FD
] =

103 
	gfd_şass
[
MAX_FD
] =

108 
	gfd_subşass
[
MAX_FD
] =

113 
	gfd_´ÙocŞ
[
MAX_FD
] =

118 cÚ¡ 
	gv’iû_pow”_Ú
[] = {0x1b, '%','P','u','i','f','p','.','p','o','w','e','r',' ','1',';',

121 
libusb_deviû
 *
	glibusb_dev
 = 
NULL
;

122 
libusb_cÚ‹xt
 *
	glibusb_ùx
 = 
NULL
;

123 
libusb_deviû
 **
	glibusb_dev_li¡
 = 
NULL
;

125 
fe_desütÜ
 
	gfd_bË
[
MAX_FD
];

128 
	$g‘_¡ršg_desütÜ
(
libusb_deviû_hªdË
 *
dev_hªdË
, 
šdex
, *
buf
, 
size_t
 
buæ’
)

130 
tbuf
[255] = {0,};

131 
»t
, 
si
, 
di
, 
út
=5;

133 
út
--)

135 
»t
 = 
	`libusb_cÚŒŞ_Œªsãr
(
dev_hªdË
,

136 
LIBUSB_ENDPOINT_IN
,

137 
LIBUSB_REQUEST_GET_DESCRIPTOR
,

138 (
LIBUSB_DT_STRING
 << 8è+ 
šdex
,

140 
tbuf
, Ñbuf), 
LIBUSB_CONTROL_REQ_TIMEOUT
);

142 ià(
»t
==0)

145 
	`BUG
("get_string_descriptor zero„esult,„etrying...");

151 ià(
»t
 < 0)

153 
	`BUG
("uÇbË g‘_¡ršg_desütÜ %d: %m\n", 
»t
);

154  
»t
;

157 ià(
tbuf
[1] !ğ
LIBUSB_DT_STRING
)

159 
	`BUG
("šv®id g‘_¡ršg_desütÜag‡ù=%dƒxp=%d\n", 
tbuf
[1], 
LIBUSB_DT_STRING
);

160  -
EIO
;

163 ià(
tbuf
[0] > 
»t
)

165 
	`BUG
("šv®id g‘_¡ršg_desütÜ sizaù=%dƒxp=%d\n", 
tbuf
[0], 
»t
);

166  -
EFBIG
;

169 
di
 = 0, 
si
 = 2; s˜< 
tbuf
[0]; si += 2)

171 ià(
di
 >ğ(
buæ’
 - 1))

174 ià(
tbuf
[
si
 + 1])

175 
buf
[
di
++] = '0';

177 
buf
[
di
++] = 
tbuf
[
si
];

180 
buf
[
di
] = 0;

182  
di
;

183 
	}
}

186 
	$wr™e_eı_chªÃl
(
fe_desütÜ
 *
pfd
, 
v®ue
)

188 
libusb_deviû_hªdË
 *
hd
;

189 
š‹rçû
 = 
pfd
->interface;

190 
Ën
, 
¡©
=1;

191 
by‹
;

193 ià(
pfd
->
hd
 =ğ
NULL
)

195 
	`BUG
("invalid write_ecp_channel state\n");

196 
bugout
;

199 
hd
 = 
pfd
->hd;

201 
Ën
 = 
	`libusb_cÚŒŞ_Œªsãr
(
hd
,

202 
LIBUSB_ENDPOINT_IN
 | 
LIBUSB_REQUEST_TYPE_VENDOR
 | 
LIBUSB_RECIPIENT_INTERFACE
,

203 
LIBUSB_REQUEST_GET_STATUS
,

204 
v®ue
,

205 
š‹rçû
,

206 &
by‹
, 1, 
LIBUSB_CONTROL_REQ_TIMEOUT
);

208 ià(
Ën
 != 1)

210 
	`BUG
("invalid write_ecp_channel: %m\n");

211 
bugout
;

214 
¡©
 = 0;

216 
bugout
:

217  
¡©
;

218 
	}
}

221 
	$bridge_ch_up
(
fe_desütÜ
 *
pfd
)

223 
libusb_deviû_hªdË
 *
hd
;

224 
Ën
, 
¡©
=1;

225 
buf
[9];

226 
nuÎBy‹
=0;

228 ià(
pfd
->
hd
 =ğ
NULL
)

230 
	`BUG
("invalid bridge_chip_up state\n");

231 
bugout
;

234 
hd
 = 
pfd
->hd;

236 
	`mem£t
(
buf
, 0, (buf));

239 
Ën
 = 
	`libusb_cÚŒŞ_Œªsãr
(
hd
,

240 
LIBUSB_ENDPOINT_IN
 | 
LIBUSB_REQUEST_TYPE_VENDOR
 | 
LIBUSB_RECIPIENT_DEVICE
,

241 
LIBUSB_REQUEST_SET_FEATURE
,

244 
buf
, (buf), 
LIBUSB_CONTROL_REQ_TIMEOUT
);

245 ià(
Ën
 < 0)

247 
	`BUG
("invalid write_bridge_up: %m\n");

248 
bugout
;

252 ià(
buf
[
ECRR
] != 0x43)

255 
Ën
 = 
	`libusb_cÚŒŞ_Œªsãr
(
hd
,

256 
LIBUSB_ENDPOINT_OUT
 | 
LIBUSB_REQUEST_TYPE_VENDOR
 | 
LIBUSB_RECIPIENT_DEVICE
,

260 
NULL
, 0, 
LIBUSB_CONTROL_REQ_TIMEOUT
);

262 
Ën
 = 
	`libusb_cÚŒŞ_Œªsãr
(
hd
,

263 
LIBUSB_ENDPOINT_OUT
 | 
LIBUSB_REQUEST_TYPE_VENDOR
 | 
LIBUSB_RECIPIENT_DEVICE
,

267 
NULL
, 0, 
LIBUSB_CONTROL_REQ_TIMEOUT
);

269 
Ën
 = 
	`libusb_cÚŒŞ_Œªsãr
(
hd
,

270 
LIBUSB_ENDPOINT_OUT
 | 
LIBUSB_REQUEST_TYPE_VENDOR
 | 
LIBUSB_RECIPIENT_DEVICE
,

274 
NULL
, 0, 
LIBUSB_CONTROL_REQ_TIMEOUT
);

276 
Ën
 = 
	`libusb_cÚŒŞ_Œªsãr
(
hd
,

277 
LIBUSB_ENDPOINT_OUT
 | 
LIBUSB_REQUEST_TYPE_VENDOR
 | 
LIBUSB_RECIPIENT_DEVICE
,

281 
NULL
, 0, 
LIBUSB_CONTROL_REQ_TIMEOUT
);

283 
Ën
 = 
	`libusb_cÚŒŞ_Œªsãr
(
hd
,

284 
LIBUSB_ENDPOINT_IN
 | 
LIBUSB_REQUEST_TYPE_VENDOR
 | 
LIBUSB_RECIPIENT_DEVICE
,

285 
LIBUSB_REQUEST_SET_FEATURE
,

288 
buf
, (buf), 
LIBUSB_CONTROL_REQ_TIMEOUT
);

289 ià(
buf
[
ECRR
] != 0x43)

291 
	`BUG
("šv®id‡utØeı modmode=%d\n", 
buf
[
ECRR
]);

296 
Ën
 = 
	`libusb_cÚŒŞ_Œªsãr
(
hd
,

297 
LIBUSB_ENDPOINT_OUT
 | 
LIBUSB_REQUEST_TYPE_VENDOR
 | 
LIBUSB_RECIPIENT_DEVICE
,

301 
NULL
, 0, 
LIBUSB_CONTROL_REQ_TIMEOUT
);

302 
	`musb_wr™e
(
pfd
->
fd
, &
nuÎBy‹
, 1, 
HPMUD_EXCEPTION_TIMEOUT
);

305 
Ën
 = 
	`libusb_cÚŒŞ_Œªsãr
(
hd
,

306 
LIBUSB_ENDPOINT_OUT
 | 
LIBUSB_REQUEST_TYPE_VENDOR
 | 
LIBUSB_RECIPIENT_DEVICE
,

310 
NULL
, 0, 
LIBUSB_CONTROL_REQ_TIMEOUT
);

312 
¡©
 = 0;

314 
bugout
:

315  
¡©
;

316 
	}
}

319 
	$bridge_ch_down
(
fe_desütÜ
 *
pfd
)

321 
libusb_deviû_hªdË
 *
hd
;

322 
Ën
, 
¡©
=1;

324 ià(
pfd
->
hd
 =ğ
NULL
)

326 
	`BUG
("invalid bridge_chip_down state\n");

327 
bugout
;

330 
hd
 = 
pfd
->hd;

332 
Ën
 = 
	`libusb_cÚŒŞ_Œªsãr
(
hd
,

333 
LIBUSB_ENDPOINT_OUT
 | 
LIBUSB_REQUEST_TYPE_VENDOR
 | 
LIBUSB_RECIPIENT_DEVICE
,

337 
NULL
, 0, 
LIBUSB_CONTROL_REQ_TIMEOUT
);

338 ià(
Ën
 < 0)

340 
	`BUG
("invalid write_bridge_up: %m\n");

341 
bugout
;

344 
¡©
 = 0;

346 
bugout
:

347  
¡©
;

348 
	}
}

351 
	$wr™e_phÛnix_£tup
(
fe_desütÜ
 *
pfd
)

353 
libusb_deviû_hªdË
 *
hd
;

354 
Ën
, 
¡©
=1;

356 ià(
pfd
->
hd
 =ğ
NULL
)

358 
	`BUG
("invalid write_phoenix_setup state\n");

359 
bugout
;

362 
hd
 = 
pfd
->hd;

364 
Ën
 = 
	`libusb_cÚŒŞ_Œªsãr
(
hd
,

365 
LIBUSB_ENDPOINT_OUT
 | 
LIBUSB_REQUEST_TYPE_CLASS
 | 
LIBUSB_RECIPIENT_OTHER
,

369 
NULL
, 0, 
LIBUSB_CONTROL_REQ_TIMEOUT
);

371 ià(
Ën
 < 0)

373 
	`BUG
("invalid write_phoenix_setup: %m\n");

374 
bugout
;

377 
¡©
 = 0;

379 
bugout
:

380  
¡©
;

381 
	}
}

384 
	$d‘ach
(
libusb_deviû_hªdË
 *
hd
, 
š‹rçû
)

386 
»t
 ;

388 
»t
 = 
	`libusb_k”Ãl_driv”_aùive
 (
hd
, 
š‹rçû
);

389 
	`DBG
("Aùivk”ÃÈdriv” oÀš‹rçû=%d„‘=%d\n", 
š‹rçû
, 
»t
);

390 ià(
»t
 == 1)

392 
»t
 = 
	`libusb_d‘ach_k”Ãl_driv”
(
hd
, 
š‹rçû
);

393 
	`DBG
("D‘achšg k”ÃÈdriv” oÀš‹rçû=%d„‘=%d\n", 
š‹rçû
, 
»t
);

394 ià(
»t
 < 0)

395 
	`BUG
("could‚Ù„emovk”ÃÈdriv” iÁ”çû=%d: %m\n", 
š‹rçû
);

398 
	}
}

401 
	$g‘_š‹rçû
(
libusb_deviû
 *
dev
, 
FD_ID
 
šdex
, 
fe_desütÜ
 *
pfd
)

403 
libusb_deviû_desütÜ
 
deviû_desc
;

404 
libusb_cÚfig_desütÜ
 *
cÚåŒ
 = 
NULL
;

405 
libusb_š‹rçû
 *
içû±r
 = 
NULL
;

406 
libusb_š‹rçû_desütÜ
 *
®Œ
 = 
NULL
;

407 
cÚf
, 
içû
, 
®t£t
;

409 
	`libusb_g‘_deviû_desütÜ
 (
dev
, &
deviû_desc
);

410 
cÚf
 = 0 ; cÚà< 
deviû_desc
.
bNumCÚfigu¿tiÚs
; conf++)

412 ià(
	`libusb_g‘_cÚfig_desütÜ
(
dev
, 
cÚf
, &
cÚåŒ
) != 0)

414 
içû
 = 0, 
içû±r
 = 
cÚåŒ
->
š‹rçû
; içû < cÚåŒ->
bNumIÁ”çûs
; iface++, ifaceptr++)

416 
®t£t
 = 0, 
®Œ
 = 
içû±r
->
®t£‰šg
;‡É£ˆ< içû±r->
num_®t£‰šg
;‡ltset ++,‡ltptr ++)

418 ià(
®Œ
 &&

419 
®Œ
->
bIÁ”çûCÏss
 =ğ
fd_şass
[
šdex
] &&

420 
®Œ
->
bIÁ”çûSubCÏss
 =ğ
fd_subşass
[
šdex
] &&

421 
®Œ
->
bIÁ”çûPrÙocŞ
 =ğ
fd_´ÙocŞ
[
šdex
])

423 
pfd
->
cÚfig
=
cÚf
;

424 
pfd
->
š‹rçû
=
içû
;

425 
pfd
->
®t_£‰šg
=
®t£t
;

426 
pfd
->
fd
=
šdex
;

427 
	`DBG
("Found iÁ”çû cÚf=%d, içû=%d,‡É£t=%d, index=%d\n", 
cÚf
, 
içû
, 
®t£t
, 
šdex
);

429 
	`libusb_ä“_cÚfig_desütÜ
(
cÚåŒ
);

434 
	`libusb_ä“_cÚfig_desütÜ
(
cÚåŒ
);

438 
	}
}

441 
	$g‘_•
(
libusb_deviû
 *
dev
, 
cÚfig
, 
š‹rçû
, 
®t£t
, 
libusb_Œªsãr_ty³
 
ty³
, 
libusb_’dpošt_dœeùiÚ
 
•dœ
)

443 
libusb_cÚfig_desütÜ
 *
cÚåŒ
 = 
NULL
;

444 cÚ¡ 
libusb_š‹rçû_desütÜ
 *
pi
;

445 
i
, 
’dpošt
 = -1;

447 ià(
	`libusb_g‘_cÚfig_desütÜ
(
dev
, 
cÚfig
, &
cÚåŒ
) != 0)

448 
bugout
;

450 ià(
cÚåŒ
 =ğ
NULL
 || cÚåŒ->
š‹rçû
 =ğNULL || cÚåŒ->š‹rçû[š‹rçû].
®t£‰šg
 == NULL)

451 
bugout
;

453 
pi
 = &(
cÚåŒ
->
š‹rçû
[š‹rçû].
®t£‰šg
[
®t£t
]);

454 
i
=0; i<
pi
->
bNumEndpošts
; i++)

456 ià(
pi
->
’dpošt
 =ğ
NULL
)

457 
bugout
;

458 ià(
pi
->
’dpošt
[
i
].
bmA‰ribu‹s
 =ğ
ty³
)

460 ià(
•dœ
 =ğ
LIBUSB_ENDPOINT_IN
)

462 ià(
pi
->
’dpošt
[
i
].
bEndpoštAdd»ss
 & 
LIBUSB_ENDPOINT_IN
)

464 
’dpošt
 = 
pi
->’dpošt[
i
].
bEndpoštAdd»ss
;

468 ià(
•dœ
 =ğ
LIBUSB_ENDPOINT_OUT
)

470 ià(!(
pi
->
’dpošt
[
i
].
bEndpoštAdd»ss
 & 
LIBUSB_ENDPOINT_IN
))

472 
’dpošt
 = 
pi
->’dpošt[
i
].
bEndpoštAdd»ss
;

479 
bugout
:

480 
	`libusb_ä“_cÚfig_desütÜ
(
cÚåŒ
);

481 ià(
’dpošt
 =ğ-1è
	`DBG
("get_ep: ERROR!„eturning -1\n");

482  
’dpošt
;

483 
	}
}

485 
	$g‘_š_•
(
libusb_deviû
 *
dev
, 
cÚfig
, 
š‹rçû
, 
®t£t
, 
libusb_Œªsãr_ty³
 
ty³
)

487  
	`g‘_•
(
dev
, 
cÚfig
, 
š‹rçû
, 
®t£t
, 
ty³
, 
LIBUSB_ENDPOINT_IN
);

488 
	}
}

490 
	$g‘_out_•
(
libusb_deviû
 *
dev
, 
cÚfig
, 
š‹rçû
, 
®t£t
, 
libusb_Œªsãr_ty³
 
ty³
)

492  
	`g‘_•
(
dev
, 
cÚfig
, 
š‹rçû
, 
®t£t
, 
ty³
, 
LIBUSB_ENDPOINT_OUT
);

493 
	}
}

496 
	$şaim_š‹rçû
(
libusb_deviû
 *
dev
, 
fe_desütÜ
 *
pfd
)

498 
¡©
=1;

500 ià(
pfd
->
hd
 !ğ
NULL
)

503 
	`libusb_İ’
(
dev
, &
pfd
->
hd
);

504 ià(
pfd
->
hd
 ==
NULL
)

506 
	`BUG
("invalid usb_open: %m\n");

507 
bugout
;

509 
	`d‘ach
(
pfd
->
hd
,…fd->
š‹rçû
);

511 ià(
	`libusb_şaim_š‹rçû
(
pfd
->
hd
,…fd->
š‹rçû
))

513 
	`libusb_şo£
(
pfd
->
hd
);

514 
pfd
->
hd
 = 
NULL
;

515 
	`DBG
("šv®id cÏim_š‹rçû %s: %m\n", 
fd_Çme
[
pfd
->
fd
]);

516 
bugout
;

519 if(
pfd
->
®t_£‰šg
)

521 ià(
	`libusb_£t_š‹rçû_®t_£‰šg
(
pfd
->
hd
,…fd->
š‹rçû
,…fd->
®t_£‰šg
))

523 
	`libusb_»Ëa£_š‹rçû
(
pfd
->
hd
,…fd->
š‹rçû
);

524 
	`libusb_şo£
(
pfd
->
hd
);

525 
pfd
->
hd
 = 
NULL
;

526 
	`BUG
("šv®id s‘_®tš‹rçû % ®t£t=%d: %m\n", 
fd_Çme
[
pfd
->
fd
],…fd->
®t_£‰šg
);

527 
bugout
;

531 
pfd
->
wr™e_aùive
=0;

532 
	`±h»ad_mu‹x_š™
(&
pfd
->
mu‹x
, 
NULL
);

533 
	`±h»ad_cÚd_š™
(&
pfd
->
wr™e_dÚe_cÚd
, 
NULL
);

535 
	`DBG
("şaimed % š‹rçû\n", 
fd_Çme
[
pfd
->
fd
]);

537 
¡©
=0;

539 
bugout
:

540  
¡©
;

541 
	}
}

543 
	$»Ëa£_š‹rçû
(
fe_desütÜ
 *
pfd
)

545 ià(
pfd
->
hd
 =ğ
NULL
)

548 ià(
pfd
->
wr™e_aùive
)

550 
	`BUG
("abÜtšg out¡ªdšg % wr™e\n", 
fd_Çme
[
pfd
->
fd
]);

551 
	`±h»ad_ÿnûl
(
pfd
->
tid
);

552 
pfd
->
wr™e_aùive
 = 0;

555 
	`libusb_»Ëa£_š‹rçû
(
pfd
->
hd
,…fd->
š‹rçû
);

556 
	`libusb_şo£
(
pfd
->
hd
);

557 
pfd
->
hd
 = 
NULL
;

558 
	`±h»ad_mu‹x_de¡roy
(&
pfd
->
mu‹x
);

559 
	`±h»ad_cÚd_de¡roy
(&
pfd
->
wr™e_dÚe_cÚd
);

561 
	`DBG
("»Ëa£d % š‹rçû\n", 
fd_Çme
[
pfd
->
fd
]);

564 
	}
}

567 
	$şaim_id_š‹rçû
(
libusb_deviû
 *
dev
)

569 
FD_ID
 
i
;

571 
i
=
FD_7_1_2
; i!=
MAX_FD
; i++)

573 ià(
	`g‘_š‹rçû
(
dev
, 
i
, &
fd_bË
[i]) == 0)

575 ià(
	`şaim_š‹rçû
(
dev
, &
fd_bË
[
i
]))

581  
i
;

582 
	}
}

585 
	$is_uri
(
libusb_deviû
 *
dev
, cÚ¡ *
uri
)

587 
libusb_deviû_hªdË
 *
hd
=
NULL
;

588 
libusb_deviû_desütÜ
 
devdesc
;

589 
sz
[128], 
uriMod–
[128], 
uriS”Ÿl
[128], 
g’
[128];

590 
r
, 
¡©
=0;

592 
	`libusb_İ’
(
dev
, &
hd
);

593 ià(
hd
 =ğ
NULL
)

595 
	`BUG
("invalid usb_open: %m\n");

596 
bugout
;

599 
	`libusb_g‘_deviû_desütÜ
(
dev
, &
devdesc
);

600 ià(
devdesc
.
idV’dÜ
 != 0x3f0)

601 
bugout
;

603 ià((
r
=
	`g‘_¡ršg_desütÜ
(
hd
, 
devdesc
.
iProduù
, 
sz
, (sz))) < 0)

605 
	`BUG
("šv®id…roduù id sŒšg„‘=%d\n", 
r
);

606 
bugout
;

609 
	`g’”®ize_mod–
(
sz
, 
g’
, (gen));

611 
	`hpmud_g‘_uri_mod–
(
uri
, 
uriMod–
, (uriModel));

612 ià(
	`¡rÿ£cmp
(
uriMod–
, 
g’
) != 0)

613 
bugout
;

615 ià((
r
=
	`g‘_¡ršg_desütÜ
(
hd
, 
devdesc
.
iS”ŸlNumb”
, 
sz
, (sz))) < 0)

617 
	`BUG
("šv®id s”ŸÈid sŒšg„‘=%d\n", 
r
);

618 
bugout
;

621 ià(
sz
[0])

622 
	`g’”®ize_£rŸl
(
sz
, 
g’
, (gen));

624 
	`¡rıy
(
g’
, "0");

626 
	`g‘_uri_£rŸl
(
uri
, 
uriS”Ÿl
, (uriSerial));

627 ià(
	`¡rcmp
(
uriS”Ÿl
, 
g’
) != 0)

628 
bugout
;

630 
¡©
 = 1;

632 
bugout
:

633 ià(
hd
 !ğ
NULL
)

634 
	`libusb_şo£
(
hd
);

636  
¡©
;

637 
	}
}

640 
	$is_£rŸl
(
libusb_deviû
 *
dev
, cÚ¡ *
¢
, *
mod–
, 
mod–_size
)

642 
libusb_deviû_hªdË
 *
hd
=
NULL
;

643 
libusb_deviû_desütÜ
 
devdesc
;

644 
sz
[128];

645 
g’
[128];

646 
r
, 
¡©
=0;

648 
	`libusb_İ’
(
dev
, &
hd
);

649 ià(
hd
 =ğ
NULL
)

651 
	`BUG
("invalid usb_open: %m\n");

652 
bugout
;

655 
	`libusb_g‘_deviû_desütÜ
(
dev
, &
devdesc
);

656 ià(
devdesc
.
idV’dÜ
 != 0x3f0)

657 
bugout
;

659 ià((
r
=
	`g‘_¡ršg_desütÜ
(
hd
, 
devdesc
.
iS”ŸlNumb”
, 
sz
, (sz))) < 0)

661 
	`BUG
("šv®id s”ŸÈid sŒšg„‘=%d\n", 
r
);

662 
bugout
;

664 ià(
sz
[0])

665 
	`g’”®ize_£rŸl
(
sz
, 
g’
, (gen));

667 
	`¡rıy
(
g’
, "0");

669 ià(
	`¡ºcmp
(
¢
, 
g’
, (gen)) != 0)

670 
bugout
;

672 ià((
r
=
	`g‘_¡ršg_desütÜ
(
hd
, 
devdesc
.
iProduù
, 
sz
, (sz))) < 0)

674 
	`BUG
("šv®id…roduù id sŒšg„‘=%d\n", 
r
);

675 
bugout
;

677 
	`g’”®ize_mod–
(
sz
, 
mod–
, 
mod–_size
);

679 
¡©
 = 1;

681 
bugout
:

682 ià(
hd
 !ğ
NULL
)

683 
	`libusb_şo£
(
hd
);

685  
¡©
;

686 
	}
}

688 
libusb_deviû
 *
	$g‘_libusb_deviû
(cÚ¡ *
uri
)

690 
libusb_deviû
 *
dev
 = 
NULL
;

691 
libusb_deviû_desütÜ
 
devdesc
;

692 
libusb_cÚfig_desütÜ
 *
cÚåŒ
 = 
NULL
;

693 cÚ¡ 
libusb_š‹rçû
 *
içû±r
 = 
NULL
;

694 cÚ¡ 
libusb_š‹rçû_desütÜ
 *
®Œ
 = 
NULL
;

695 
numdevs
 = 0;

696 
i
, 
cÚf
, 
içû
, 
®t£t
 ;

698 
	`libusb_š™
(&
libusb_ùx
);

699 
numdevs
 = 
	`libusb_g‘_deviû_li¡
(
libusb_ùx
, &
libusb_dev_li¡
);

700 
i
=0; i< 
numdevs
; i++)

702 
dev
 = 
libusb_dev_li¡
[
i
];

703 
	`mem£t
(&
devdesc
, 0, (devdesc));

704 
	`libusb_g‘_deviû_desütÜ
 (
dev
, &
devdesc
);

706 ià(!
devdesc
.
bNumCÚfigu¿tiÚs
 || !devdesc.
idV’dÜ
 || !devdesc.
idProduù
)

709 ià(
devdesc
.
idV’dÜ
 != 0x3f0)

712 
cÚf
 = 0; cÚà< 
devdesc
.
bNumCÚfigu¿tiÚs
; conf++)

714 ià(
	`libusb_g‘_cÚfig_desütÜ
 (
dev
, 
cÚf
, &
cÚåŒ
) < 0)

716 
içû
 = 0, 
içû±r
 = 
cÚåŒ
->
š‹rçû
; içû < cÚåŒ->
bNumIÁ”çûs
; iface ++, ifaceptr ++)

718 
®t£t
 = 0, 
®Œ
 = 
içû±r
->
®t£‰šg
;‡É£ˆ< içû±r->
num_®t£‰šg
;‡ltset++,‡ltptr++)

720 iàĞ((
®Œ
->
bIÁ”çûCÏss
 =ğ
LIBUSB_CLASS_PRINTER
è&& (®Œ->
bIÁ”çûSubCÏss
 == 1)) ||\

721 ((
®Œ
->
bIÁ”çûCÏss
 =ğ
LIBUSB_CLASS_VENDOR_SPEC
è&& (®Œ->
bIÁ”çûSubCÏss
 == 0xcc)) )

723 ià(
	`is_uri
(
dev
, 
uri
))

725 
	`libusb_ä“_cÚfig_desütÜ
(
cÚåŒ
);

726  
dev
;

731 
	`libusb_ä“_cÚfig_desütÜ
(
cÚåŒ
); cÚåŒ = 
NULL
;

734 
bugout
:

735 ià(
cÚåŒ
)

736 
	`libusb_ä“_cÚfig_desütÜ
(
cÚåŒ
);

738  
NULL
;

739 
	}
}

741 
	$deviû_id
(
fd
, *
bufãr
, 
size
)

743 
libusb_deviû_hªdË
 *
hd
;

744 
cÚfig
,
š‹rçû
,
®t
;

745 
Ën
=0, 
¾’
, 
maxSize
;

747 
hd
 = 
fd_bË
[
fd
].hd;

748 
cÚfig
 = 
fd_bË
[
fd
].config;

749 
š‹rçû
 = 
fd_bË
[
fd
].interface;

750 
®t
 = 
fd_bË
[
fd
].
®t_£‰šg
;

752 ià(
hd
 =ğ
NULL
)

754 
	`BUG
("invalid device_id state\n");

755 
bugout
;

758 
maxSize
 = (
size
 > 1024) ? 1024 : size;

760 
¾’
 = 
	`libusb_cÚŒŞ_Œªsãr
(
hd
,

761 
LIBUSB_ENDPOINT_IN
 | 
LIBUSB_REQUEST_TYPE_CLASS
 | 
LIBUSB_RECIPIENT_INTERFACE
,

762 
LIBUSB_REQUEST_GET_STATUS
,

763 
cÚfig
,

764 
š‹rçû
,

765 
bufãr
, 
maxSize
, 
LIBUSB_CONTROL_REQ_TIMEOUT
);

767 ià(
¾’
 < 0)

769 
	`BUG
("šv®id deviûid„‘=%d: %m\n", 
¾’
);

770 
bugout
;

773 
Ën
 = 
	`Áohs
(*(*)
bufãr
);

774 ià(
Ën
 > (
size
-1))

775 
Ën
 = 
size
-1;

776 ià(
Ën
 > 2)

777 
Ën
 -= 2;

778 
	`memıy
(
bufãr
, bufãr+2, 
Ën
);

779 
bufãr
[
Ën
]=0;

780 
	`DBG
("»ad‡ùu® deviû_id sucûssfuÎy fd=%d†’=%d\n", 
fd
, 
Ën
);

782 
bugout
:

783  
Ën
;

784 
	}
}

786 
	$deviû_¡©us
(
fd
, *
¡©us
)

788 
libusb_deviû_hªdË
 *
hd
;

789 
š‹rçû
;

790 
Ën
, 
¡©
=1;

791 
by‹
;

793 
hd
 = 
fd_bË
[
fd
].hd;

794 
š‹rçû
 = 
fd_bË
[
fd
].interface;

796 ià(
hd
 =ğ
NULL
)

798 
	`BUG
("invalid device_status state\n");

799 
bugout
;

802 
Ën
 = 
	`libusb_cÚŒŞ_Œªsãr
(
hd
,

803 
LIBUSB_ENDPOINT_IN
 | 
LIBUSB_REQUEST_TYPE_CLASS
 | 
LIBUSB_RECIPIENT_INTERFACE
,

804 
LIBUSB_REQUEST_CLEAR_FEATURE
,

806 
š‹rçû
,

807 &
by‹
, 1, 
LIBUSB_CONTROL_REQ_TIMEOUT
);

809 ià(
Ën
 < 0)

811 
	`BUG
("invalid device_status: %m\n");

812 
bugout
;

815 *
¡©us
 = ()
by‹
;

816 
¡©
 = 0;

817 
	`DBG
("»ad‡ùu® deviû_¡©u sucûssfuÎy fd=%d\n", 
fd
);

819 
bugout
:

820  
¡©
;

821 
	}
}

824 
	$sf›ld_´š‹r_¡©e
(cÚ¡ *
id
)

826 *
pSf
;

827 
v¡©us
=0, 
v”
;

829 ià((
pSf
 = 
	`¡r¡r
(
id
, ";S:")è=ğ
NULL
)

831 
	`BUG
("invalid S-field\n");

832  
v¡©us
;

836 
pSf
+=3;

837 
v”
 = 0;

838 
	`HEX2INT
(*
pSf
, 
v”
);

839 
pSf
++;

840 
v”
 = ver << 4;

841 
	`HEX2INT
(*
pSf
, 
v”
);

842 
pSf
++;

845 
v”
)

850 
pSf
+=12;

853 
pSf
+=14;

856 
pSf
+=18;

859 
	`BUG
("unknowÀS-f›ld v”siÚ=%d\n", 
v”
);

860 
pSf
+=12;

865 
v¡©us
 = 0;

866 
	`HEX2INT
(*
pSf
, 
v¡©us
);

867 
pSf
++;

868 
v¡©us
 = vstatus << 4;

869 
	`HEX2INT
(*
pSf
, 
v¡©us
);

871  
v¡©us
;

872 
	}
}

878 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
	$pow”_up
(
mud_deviû
 *
pd
, 
fd
)

880 cÚ¡ *
pSf
;

882 ià((
pSf
 = 
	`¡r¡r
(
pd
->
id
, "CMD:LDL")è!ğ
NULL
)

885 ià((
pSf
 = 
	`¡r¡r
(
pd
->
id
, ";S:")è!ğ
NULL
)

887 ià(
	`sf›ld_´š‹r_¡©e
(
pd
->
id
) != 3)

890 ià((
pSf
 = 
	`¡r¡r
(
pd
->
id
, "VSTATUS:")è!ğ
NULL
)

893 ià(!(
	`¡r¡r
(
pSf
+8, "OFFF") || strstr(pSf+8, "PWDN") || strstr(pSf+8, "$X")))

899 (
pd
->
vf
.
wr™e
)(
fd
, 
v’iû_pow”_Ú
, (v’iû_pow”_Ú), 
HPMUD_EXCEPTION_TIMEOUT
);

900 
	`¦“p
(2);

903 
	}
}

905 
	$libusb_bulk_»ad
(
libusb_deviû_hªdË
 *
dev
, 
•
, *
by‹s
, 
size
, 
timeout
)

907 
aùu®_Ën
 = 0;

909 
	`libusb_bulk_Œªsãr
(
dev
, 
•
, (*)
by‹s
, 
size
, &
aùu®_Ën
, 
timeout
);

910  
aùu®_Ën
 ;

911 
	}
}

913 
	$libusb_bulk_wr™e
(
libusb_deviû_hªdË
 *
dev
, 
•
, *
by‹s
, 
size
, 
timeout
)

915 
aùu®_Ën
 = 0;

917 
	`libusb_bulk_Œªsãr
(
dev
, 
•
, (*)
by‹s
, 
size
, &
aùu®_Ën
, 
timeout
);

918  
aùu®_Ën
 ;

919 
	}
}

922 
	$Ãw_chªÃl
(
mud_deviû
 *
pd
, 
šdex
, cÚ¡ *
¢
)

924 
¡©
=1;

927 ià(
pd
->
chªÃl
[
šdex
].
ş›Á_út
)

929 
	`BUG
("% chªÃl=%d i busy, u£d by [%d], cl›ÁCÁ=%d chªÃlCÁ=%d\n", 
¢
, 
šdex
, 
pd
->
chªÃl
[šdex].
pid
,…d->chªÃl[šdex].
ş›Á_út
,…d->
chªÃl_út
);

930 
bugout
;

933 ià(
šdex
 =ğ
HPMUD_EWS_CHANNEL
 || index =ğ
HPMUD_EWS_LEDM_CHANNEL
 ||

934 
šdex
 =ğ
HPMUD_SOAPSCAN_CHANNEL
 || index =ğ
HPMUD_SOAPFAX_CHANNEL
 ||

935 
šdex
 =ğ
HPMUD_MARVELL_SCAN_CHANNEL
 || index =ğ
HPMUD_MARVELL_FAX_CHANNEL
 ||

936 
šdex
 =ğ
HPMUD_LEDM_SCAN_CHANNEL
 || index =ğ
HPMUD_MARVELL_EWS_CHANNEL
 ||

937 
šdex
 =ğ
HPMUD_IPP_CHANNEL
 || index =ğ
HPMUD_IPP_CHANNEL2
 || index =ğ
HPMUD_ESCL_SCAN_CHANNEL
) {

938 
pd
->
chªÃl
[
šdex
].
vf
 = 
musb_comp_chªÃl_vf
;

940 ià(
pd
->
io_mode
 =ğ
HPMUD_RAW_MODE
 ||…d->io_mod=ğ
HPMUD_UNI_MODE
) {

941 
pd
->
chªÃl
[
šdex
].
vf
 = 
musb_¿w_chªÃl_vf
;

943 ià(
pd
->
io_mode
 =ğ
HPMUD_MLC_GUSHER_MODE
 ||…d->io_mod=ğ
HPMUD_MLC_MISER_MODE
) {

944 
pd
->
chªÃl
[
šdex
].
vf
 = 
musb_mlc_chªÃl_vf
;

947 
pd
->
chªÃl
[
šdex
].
vf
 = 
musb_dÙ4_chªÃl_vf
;

950 
pd
->
chªÃl
[
šdex
].index = index;

951 
pd
->
chªÃl
[
šdex
].
ş›Á_út
 = 1;

952 
pd
->
chªÃl
[
šdex
].
sockid
 = index;

953 
pd
->
chªÃl
[
šdex
].
pid
 = 
	`g‘pid
();

954 
pd
->
chªÃl
[
šdex
].
dšdex
 =…d->index;

955 
pd
->
chªÃl
[
šdex
].
fd
 = 0;

956 
	`¡rıy
(
pd
->
chªÃl
[
šdex
].
¢
, sn);

957 
pd
->
chªÃl_út
++;

959 
¡©
 = 0;

960 
	`DBG
("Ãw % chªÃl=%d cl›ÁCÁ=%d chªÃlCÁ=%d\n", 
¢
, 
šdex
, 
pd
->
chªÃl
[šdex].
ş›Á_út
,…d->
chªÃl_út
);

962 
bugout
:

963  
¡©
;

964 
	}
}

967 
	$d–_chªÃl
(
mud_deviû
 *
pd
, 
mud_chªÃl
 *
pc
)

969 
pc
->
ş›Á_út
--;

971 ià(
pc
->
ş›Á_út
 <= 0)

973 
pd
->
chªÃl_út
--;

975 
	`DBG
("»moved % chªÃl=%d cl›ÁCÁ=%d chªÃlCÁ=%d\n", 
pc
->
¢
,…c->
šdex
,…c->
ş›Á_út
, 
pd
->
chªÃl_út
);

977 
	}
}

979 
	$wr™e_th»ad
(
fe_desütÜ
 *
pfd
)

981 
•
 = -1;

983 
	`±h»ad_d‘ach
(
	`±h»ad_£lf
());

985 
•
 = 
	`g‘_out_•
(
libusb_dev
, 
pfd
->
cÚfig
,…fd->
š‹rçû
,…fd->
®t_£‰šg
, 
LIBUSB_TRANSFER_TYPE_BULK
);

986 ià(
•
 < 0)

988 
	`BUG
("invalid bulk outƒndpoint\n");

989 
pfd
->
wr™e_»tuº
 = -
ENOTCONN
;

990 
bugout
;

994 
pfd
->
wr™e_»tuº
 = 
	`libusb_bulk_wr™e
 (pfd->
hd
, 
•
, (*ífd->
wr™e_buf
,…fd->
wr™e_size
, 72*3600*1000);

996 
bugout
:

997 
	`±h»ad_mu‹x_lock
(&
pfd
->
mu‹x
);

998 
pfd
->
wr™e_buf
 = 
NULL
;

999 
	`±h»ad_cÚd_sigÇl
(&
pfd
->
wr™e_dÚe_cÚd
);

1000 
	`±h»ad_mu‹x_uÆock
(&
pfd
->
mu‹x
);

1003 
	}
}

1009 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
	$musb_wr™e
(
fd
, cÚ¡ *
buf
, 
size
, 
u£c
)

1011 
Ën
=-
EIO
;

1013 ià(
fd_bË
[
fd
].
hd
 =ğ
NULL
)

1015 
	`BUG
("invalid musb_write state\n");

1016 
bugout
;

1020 
timev®
 
now
;

1021 
time¥ec
 
timeout
;

1022 
»t
;

1024 ià(!
fd_bË
[
fd
].
wr™e_aùive
)

1026 
fd_bË
[
fd
].
wr™e_aùive
 = 1;

1027 
fd_bË
[
fd
].
wr™e_buf
 = 
buf
;

1028 
fd_bË
[
fd
].
wr™e_size
 = 
size
;

1031 ià(
	`±h»ad_ü—‹
(&
fd_bË
[
fd
].
tid
, 
NULL
, (*(*)(*))
wr™e_th»ad
, (*)&fd_table[fd]) != 0)

1033 
	`BUG
("unableo creat write_thread: %m\n");

1034 
bugout
;

1038 
	`±h»ad_mu‹x_lock
(&
fd_bË
[
fd
].
mu‹x
);

1039 
	`g‘timeofday
(&
now
, 
NULL
);

1040 
now
.
tv_u£c
 +ğ
u£c
;

1041 
now
.
tv_£c
 +ğnow.
tv_u£c
 / 1000000;

1042 
now
.
tv_u£c
 %= 1000000;

1043 
timeout
.
tv_£c
 = 
now
.tv_sec;

1044 
timeout
.
tv_n£c
 = 
now
.
tv_u£c
 * 1000;

1045 
»t
 = 0;

1046 
fd_bË
[
fd
].
wr™e_buf
 && 
»t
 !ğ
ETIMEDOUT
)

1048 
»t
 = 
	`±h»ad_cÚd_timedwa™
(&
fd_bË
[
fd
].
wr™e_dÚe_cÚd
, &fd_bË[fd].
mu‹x
, &
timeout
);

1050 
	`±h»ad_mu‹x_uÆock
(&
fd_bË
[
fd
].
mu‹x
);

1051 ià(
»t
 =ğ
ETIMEDOUT
)

1053 
Ën
 = -
ETIMEDOUT
;

1054 
bugout
;

1057 
fd_bË
[
fd
].
wr™e_aùive
 = 0;

1059 
Ën
 = 
fd_bË
[
fd
].
wr™e_»tuº
;

1061 
•
;

1062 ià((
•
 = 
	`g‘_out_•
(
libusb_dev
, 
fd_bË
[
fd
].
cÚfig
, fd_bË[fd].
š‹rçû
, fd_bË[fd].
®t_£‰šg
, 
LIBUSB_TRANSFER_TYPE_BULK
)) < 0)

1064 
	`BUG
("invalid bulk outƒndpoint\n");

1065 
bugout
;

1068 
Ën
 = 
	`libusb_bulk_wr™e
(
fd_bË
[
fd
].
hd
, 
•
, (*)
buf
, 
size
, 
u£c
);

1071 ià(
Ën
 < 0)

1073 
	`BUG
("bulk_wr™çed buf=%°size=%d†’=%d: %m\n", 
buf
, 
size
, 
Ën
);

1074 
bugout
;

1077 
	`DBG_DUMP
(
buf
, 
Ën
 < 512 ?†en : 512);

1079 
bugout
:

1080  
Ën
;

1081 
	}
}

1083 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
	$musb_»ad
(
fd
, *
buf
, 
size
, 
u£c
)

1085 
timev®
 
t1
, 
t2
;

1086 
tÙ®_u£c
, 
tmo_u£c
=
u£c
;

1087 
Ën
=-
EIO
, 
•
;

1089 ià(
fd_bË
[
fd
].
hd
 =ğ
NULL
)

1091 
	`BUG
("invalid musb_read state\n");

1092 
bugout
;

1095 
	`g‘timeofday
 (&
t1
, 
NULL
);

1097 
•
 = 
	`g‘_š_•
(
libusb_dev
, 
fd_bË
[
fd
].
cÚfig
, fd_bË[fd].
š‹rçû
, fd_bË[fd].
®t_£‰šg
, 
LIBUSB_TRANSFER_TYPE_BULK
);

1098 ià(
•
 < 0)

1100 
	`BUG
("invalid bulk inƒndpoint\n");

1101 
bugout
;

1106 
Ën
 = 
	`libusb_bulk_»ad
(
fd_bË
[
fd
].
hd
, 
•
, (*)
buf
, 
size
, 
tmo_u£c
/1000);

1108 ià(
Ën
 =ğ-
ETIMEDOUT
)

1109 
bugout
;

1111 ià(
Ën
 < 0)

1113 
	`BUG
("bulk_read failed: %m\n");

1114 
bugout
;

1117 ià(
Ën
 == 0)

1120 
	`g‘timeofday
(&
t2
, 
NULL
);

1122 
tÙ®_u£c
 = (
t2
.
tv_£c
 - 
t1
.tv_sec)*1000000;

1123 
tÙ®_u£c
 +ğ(
t2
.
tv_u£c
 > 
t1
.tv_usec) ?2.tv_usec -1.tv_usec :1.tv_usec -2.tv_usec;

1124 ià(
tÙ®_u£c
 > 
u£c
)

1126 
Ën
 = -
ETIMEDOUT
;

1127 
bugout
;

1129 
tmo_u£c
 = 
u£c
 - 
tÙ®_u£c
;

1137 
	`DBG_DUMP
(
buf
, 
Ën
 < 32 ?†en : 32);

1139 
bugout
:

1140  
Ën
;

1141 
	}
}

1143 
HPMUD_RESULT
 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
	$musb_İ’
(
mud_deviû
 *
pd
)

1145 
Ën
=0, 
fd
=0;

1146 
HPMUD_RESULT
 
¡©
 = 
HPMUD_R_IO_ERROR
;

1149 ià((
libusb_dev
 = 
	`g‘_libusb_deviû
(
pd
->
uri
)è=ğ
NULL
)

1151 
	`BUG
("uÇbËØİ’ %s\n", 
pd
->
uri
);

1152 
bugout
;

1155 
	`±h»ad_mu‹x_lock
(&
pd
->
mu‹x
);

1157 ià(
pd
->
id
[0] == 0)

1160 ià((
fd
 = 
	`şaim_id_š‹rçû
(
libusb_dev
)è=ğ
MAX_FD
)

1162 
¡©
 = 
HPMUD_R_DEVICE_BUSY
;

1163 
bÏckout
;

1166 
Ën
 = 
	`deviû_id
(
fd
, (*)
pd
->
id
, (pd->id));

1168 ià(
Ën
 > 0 && 
	`is_hp
(
pd
->
id
))

1169 
	`pow”_up
(
pd
, 
fd
);

1171 
	`»Ëa£_š‹rçû
(&
fd_bË
[
fd
]);

1173 ià(
Ën
 == 0)

1174 
bÏckout
;

1176 
pd
->
İ’_fd
 = 
fd
;

1179 
¡©
 = 
HPMUD_R_OK
;

1181 
bÏckout
:

1182 
	`±h»ad_mu‹x_uÆock
(&
pd
->
mu‹x
);

1184 
bugout
:

1185  
¡©
;

1186 
	}
}

1188 
HPMUD_RESULT
 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
	$musb_şo£
(
mud_deviû
 *
pd
)

1190 
i
;

1191 
HPMUD_RESULT
 
¡©
 = 
HPMUD_R_OK
;

1193 
	`±h»ad_mu‹x_lock
(&
pd
->
mu‹x
);

1195 
i
=1; i<
MAX_FD
; i++)

1197 ià(
fd_bË
[
i
].
hd
 !ğ
NULL
)

1198 
	`»Ëa£_š‹rçû
(&
fd_bË
[
i
]);

1201 
pd
->
id
[0] = 0;

1203 ià(
libusb_dev
)

1205 
	`libusb_ä“_deviû_li¡
(
libusb_dev_li¡
, 1);

1206 
	`libusb_ex™
(
libusb_ùx
);

1207 
libusb_ùx
 = 
NULL
;

1208 
libusb_dev_li¡
 = 
NULL
;

1209 
libusb_dev
 = 
NULL
 ;

1212 
	`±h»ad_mu‹x_uÆock
(&
pd
->
mu‹x
);

1214  
¡©
;

1215 
	}
}

1217 
HPMUD_RESULT
 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
	$musb_g‘_deviû_id
(
mud_deviû
 *
pd
, *
buf
, 
size
, *
Ën
)

1219 
i
, 
fd
=
FD_NA
;

1220 
HPMUD_RESULT
 
¡©
 = 
HPMUD_R_DEVICE_BUSY
;

1222 *
Ën
=0;

1224 
	`±h»ad_mu‹x_lock
(&
pd
->
mu‹x
);

1226 ià(
pd
->
io_mode
 =ğ
HPMUD_DOT4_BRIDGE_MODE
 ||…d->io_mod=ğ
HPMUD_UNI_MODE
)

1228 *
Ën
 = 
	`¡¾’
(
pd
->
id
);

1233 
i
=1; i<
MAX_FD
; i++)

1235 ià(
fd_bË
[
i
].
hd
 !ğ
NULL
)

1237 
fd
 = 
i
;

1242 ià(
fd
 =ğ
FD_NA
)

1245 ià((
fd
 = 
	`şaim_id_š‹rçû
(
libusb_dev
)è!ğ
MAX_FD
)

1247 *
Ën
 = 
	`deviû_id
(
fd
, (*)
pd
->
id
, (pd->id));

1248 
	`»Ëa£_š‹rçû
(&
fd_bË
[
fd
]);

1253 *
Ën
 = 
	`¡¾’
(
pd
->
id
);

1259 *
Ën
 = 
	`deviû_id
(
fd
, (*)
pd
->
id
, (pd->id));

1263 ià(*
Ën
)

1265 
	`memıy
(
buf
, 
pd
->
id
, *
Ën
 > 
size
 ? size : *len);

1266 
¡©
 = 
HPMUD_R_OK
;

1269 
	`±h»ad_mu‹x_uÆock
(&
pd
->
mu‹x
);

1270  
¡©
;

1271 
	}
}

1273 
HPMUD_RESULT
 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
	$musb_g‘_deviû_¡©us
(
mud_deviû
 *
pd
, *
¡©us
)

1275 
i
, 
fd
=
FD_NA
;

1276 
HPMUD_RESULT
 
¡©
 = 
HPMUD_R_DEVICE_BUSY
;

1277 
r
=1;

1279 
	`±h»ad_mu‹x_lock
(&
pd
->
mu‹x
);

1281 ià(
pd
->
io_mode
 =ğ
HPMUD_DOT4_BRIDGE_MODE
 ||…d->io_mod=ğ
HPMUD_UNI_MODE
)

1282 *
¡©us
 = 
NFAULT_BIT
;

1286 
i
=1; i<
MAX_FD
; i++)

1288 ià(
fd_bË
[
i
].
hd
 !ğ
NULL
)

1290 
fd
 = 
i
;

1295 ià(
fd
 =ğ
FD_NA
)

1298 ià((
fd
 = 
	`şaim_id_š‹rçû
(
libusb_dev
)è!ğ
MAX_FD
)

1300 
r
 = 
	`deviû_¡©us
(
fd
, 
¡©us
);

1301 
	`»Ëa£_š‹rçû
(&
fd_bË
[
fd
]);

1307 
r
 = 
	`deviû_¡©us
(
fd
, 
¡©us
);

1311 
	`±h»ad_mu‹x_uÆock
(&
pd
->
mu‹x
);

1313 ià(
r
 != 0)

1314 
bugout
;

1316 
¡©
 = 
HPMUD_R_OK
;

1318 
bugout
:

1319  
¡©
;

1320 
	}
}

1322 
HPMUD_RESULT
 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
	$musb_chªÃl_wr™e
(
mud_deviû
 *
pd
, 
mud_chªÃl
 *
pc
, cÚ¡ *
buf
, 
Ëngth
, 
£c_timeout
, *
by‹s_wrÙe
)

1324 
HPMUD_RESULT
 
¡©
;

1326 
	`±h»ad_mu‹x_lock
(&
pd
->
mu‹x
);

1327 
¡©
 = (
pc
->
vf
.
chªÃl_wr™e
)Õc, 
buf
, 
Ëngth
, 
£c_timeout
, 
by‹s_wrÙe
);

1328 
	`±h»ad_mu‹x_uÆock
(&
pd
->
mu‹x
);

1329  
¡©
;

1330 
	}
}

1332 
HPMUD_RESULT
 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
	$musb_chªÃl_»ad
(
mud_deviû
 *
pd
, 
mud_chªÃl
 *
pc
, *
buf
, 
Ëngth
, 
£c_timeout
, *
by‹s_»ad
)

1334 
HPMUD_RESULT
 
¡©
;

1336 ià(
pd
->
io_mode
 =ğ
HPMUD_UNI_MODE
)

1338 
¡©
 = 
HPMUD_R_INVALID_STATE
;

1339 
	`BUG
("šv®id chªÃl_»ad io_mode=%d\n", 
pd
->
io_mode
);

1340 
bugout
;

1343 
	`±h»ad_mu‹x_lock
(&
pd
->
mu‹x
);

1344 
¡©
 = (
pc
->
vf
.
chªÃl_»ad
)Õc, 
buf
, 
Ëngth
, 
£c_timeout
, 
by‹s_»ad
);

1345 
	`±h»ad_mu‹x_uÆock
(&
pd
->
mu‹x
);

1347 
bugout
:

1348  
¡©
;

1349 
	}
}

1351 
HPMUD_RESULT
 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
	$musb_chªÃl_İ’
(
mud_deviû
 *
pd
, cÚ¡ *
¢
, 
HPMUD_CHANNEL
 *
cd
)

1353 
šdex
;

1354 
HPMUD_RESULT
 
¡©
;

1357 ià((
¡©
 = 
	`£rviû_to_chªÃl
(
pd
, 
¢
, &
šdex
)è!ğ
HPMUD_R_OK
)

1358 
bugout
;

1360 
	`±h»ad_mu‹x_lock
(&
pd
->
mu‹x
);

1362 ià(
	`Ãw_chªÃl
(
pd
, 
šdex
, 
¢
))

1364 
¡©
 = 
HPMUD_R_DEVICE_BUSY
;

1368 ià((
¡©
 = (
pd
->
chªÃl
[
šdex
].
vf
.
İ’
)(&pd->chªÃl[šdex])è!ğ
HPMUD_R_OK
)

1369 
	`d–_chªÃl
(
pd
, &pd->
chªÃl
[
šdex
]);

1371 *
cd
 = 
šdex
;

1374 
	`±h»ad_mu‹x_uÆock
(&
pd
->
mu‹x
);

1376 
bugout
:

1377  
¡©
;

1378 
	}
}

1380 
HPMUD_RESULT
 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
	$musb_chªÃl_şo£
(
mud_deviû
 *
pd
, 
mud_chªÃl
 *
pc
)

1382 
HPMUD_RESULT
 
¡©
 = 
HPMUD_R_OK
;

1384 
	`±h»ad_mu‹x_lock
(&
pd
->
mu‹x
);

1385 
¡©
 = (
pc
->
vf
.
şo£
)(pc);

1386 
	`d–_chªÃl
(
pd
, 
pc
);

1387 
	`±h»ad_mu‹x_uÆock
(&
pd
->
mu‹x
);

1389  
¡©
;

1390 
	}
}

1396 
HPMUD_RESULT
 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
	$musb_¿w_chªÃl_İ’
(
mud_chªÃl
 *
pc
)

1398 
fd
 = 
FD_7_1_2
;

1399 
HPMUD_RESULT
 
¡©
 = 
HPMUD_R_DEVICE_BUSY
;

1401 
	`g‘_š‹rçû
(
libusb_dev
, 
fd
, &
fd_bË
[fd]);

1403 ià(
	`şaim_š‹rçû
(
libusb_dev
, &
fd_bË
[
fd
]))

1404 
bugout
;

1406 
pc
->
fd
 = fd;

1408 
¡©
 = 
HPMUD_R_OK
;

1410 
bugout
:

1411  
¡©
;

1412 
	}
}

1414 
HPMUD_RESULT
 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
	$musb_¿w_chªÃl_şo£
(
mud_chªÃl
 *
pc
)

1416 
fd
 = 
pc
->fd;

1419 
•
 = -1;

1421 ià(Ğ
•
 = 
	`g‘_š_•
(
libusb_dev
, 
fd_bË
[
fd
].
cÚfig
, fd_bË[fd].
š‹rçû
, fd_bË[fd].
®t_£‰šg
, 
LIBUSB_TRANSFER_TYPE_BULK
)) >= 0)

1426 ià(Ğ
•
 = 
	`g‘_out_•
(
libusb_dev
, 
fd_bË
[
fd
].
cÚfig
, fd_bË[fd].
š‹rçû
, fd_bË[fd].
®t_£‰šg
, 
LIBUSB_TRANSFER_TYPE_BULK
)) >= 0)

1430 
	`»Ëa£_š‹rçû
(&
fd_bË
[
fd
]);

1432 
pc
->
fd
 = 0;

1434  
HPMUD_R_OK
;

1435 
	}
}

1437 
HPMUD_RESULT
 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
	$musb_¿w_chªÃl_wr™e
(
mud_chªÃl
 *
pc
, cÚ¡ *
buf
, 
Ëngth
, 
£c_timeout
, *
by‹s_wrÙe
)

1439 
Ën
, 
size
, 
tÙ®
=0;

1440 
HPMUD_RESULT
 
¡©
 = 
HPMUD_R_IO_ERROR
;

1442 *
by‹s_wrÙe
=0;

1443 
size
 = 
Ëngth
;

1445 
size
 > 0)

1447 
Ën
 = (
m¥
->
deviû
[
pc
->
dšdex
].
vf
.
wr™e
)Õc->
fd
, 
buf
+
tÙ®
, 
size
, 
£c_timeout
*1000000);

1448 ià(
Ën
 < 0)

1450 ià(
Ën
 =ğ-
ETIMEDOUT
)

1452 
¡©
 = 
HPMUD_R_IO_TIMEOUT
;

1453 ià(
£c_timeout
 >ğ
HPMUD_EXCEPTION_SEC_TIMEOUT
)

1454 
	`BUG
("uÇbËØwr™d©¨%s: %d secÚd iØtimeout\n", 
m¥
->
deviû
[
pc
->
dšdex
].
uri
, 
£c_timeout
);

1457 
	`BUG
("uÇbËØwr™d©¨Ö’ = %dè%s: %m\n", 
m¥
->
deviû
[
pc
->
dšdex
].
uri
, 
Ën
);

1458 
bugout
;

1460 if(
Ën
 =ğ0 && 
size
 > 0)

1462 
¡©
 = 
HPMUD_R_IO_ERROR
;

1463 
bugout
;

1465 
size
-=
Ën
;

1466 
tÙ®
+=
Ën
;

1467 *
by‹s_wrÙe
+=
Ën
;

1470 
¡©
 = 
HPMUD_R_OK
;

1472 
bugout
:

1473  
¡©
;

1474 
	}
}

1480 
HPMUD_RESULT
 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
	$musb_¿w_chªÃl_»ad
(
mud_chªÃl
 *
pc
, *
buf
, 
Ëngth
, 
£c_timeout
, *
by‹s_»ad
)

1482 
Ën
=0, 
u£c
;

1483 
HPMUD_RESULT
 
¡©
 = 
HPMUD_R_IO_ERROR
;

1485 *
by‹s_»ad
 = 0;

1487 ià(
£c_timeout
==0)

1488 
u£c
 = 1000;

1490 
u£c
 = 
£c_timeout
*1000000;

1492 
Ën
 = (
m¥
->
deviû
[
pc
->
dšdex
].
vf
.
»ad
)Õc->
fd
, 
buf
, 
Ëngth
, 
u£c
);

1493 ià(
Ën
 < 0)

1495 ià(
Ën
 =ğ-
ETIMEDOUT
)

1497 
¡©
 = 
HPMUD_R_IO_TIMEOUT
;

1498 ià(
£c_timeout
 >ğ
HPMUD_EXCEPTION_SEC_TIMEOUT
)

1499 
	`BUG
("uÇbËØ»ad d©¨%s: %d secÚd iØtimeout\n", 
m¥
->
deviû
[
pc
->
dšdex
].
uri
, 
£c_timeout
);

1502 
	`BUG
("uÇbËØ»ad d©¨%s: %m\n", 
m¥
->
deviû
[
pc
->
dšdex
].
uri
);

1503 
bugout
;

1506 *
by‹s_»ad
 = 
Ën
;

1507 
¡©
 = 
HPMUD_R_OK
;

1509 
bugout
:

1510  
¡©
;

1511 
	}
}

1517 
HPMUD_RESULT
 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
	$musb_comp_chªÃl_İ’
(
mud_chªÃl
 *
pc
)

1519 
fd
;

1520 
HPMUD_RESULT
 
¡©
 = 
HPMUD_R_DEVICE_BUSY
;

1523 
pc
->
šdex
)

1525 
HPMUD_EWS_CHANNEL
:

1526 
fd
 = 
FD_ff_1_1
;

1528 
HPMUD_EWS_LEDM_CHANNEL
:

1529 
fd
 = 
FD_ff_4_1
;

1531 
HPMUD_SOAPSCAN_CHANNEL
:

1532 
fd
 = 
FD_ff_2_1
;

1534 
HPMUD_SOAPFAX_CHANNEL
:

1535 
fd
 = 
FD_ff_3_1
;

1537 
HPMUD_MARVELL_SCAN_CHANNEL
:

1538 
fd
 = 
FD_ff_ff_ff
;

1540 
HPMUD_MARVELL_FAX_CHANNEL
:

1541 
fd
 = 
FD_ff_1_0
;

1543 
HPMUD_LEDM_SCAN_CHANNEL
:

1544 
HPMUD_ESCL_SCAN_CHANNEL
:

1545 
fd
 = 
FD_ff_cc_0
;

1547 
HPMUD_MARVELL_EWS_CHANNEL
:

1548 
fd
 = 
FD_ff_2_10
;

1550 
HPMUD_IPP_CHANNEL
:

1551 
fd
 = 
FD_7_1_4
;

1553 
HPMUD_IPP_CHANNEL2
:

1554 
fd
 = 
FD_ff_9_1
;

1557 
¡©
 = 
HPMUD_R_INVALID_SN
;

1558 
	`BUG
("šv®id % chªÃl=%d\n", 
pc
->
¢
,…c->
šdex
);

1559 
bugout
;

1563 ià(
	`g‘_š‹rçû
(
libusb_dev
, 
fd
, &
fd_bË
[fd]))

1565 
¡©
 = 
HPMUD_R_INVALID_SN
;

1566 
	`BUG
("šv®id % chªÃl=%d\n", 
pc
->
¢
,…c->
šdex
);

1567 
bugout
;

1570 ià(
	`şaim_š‹rçû
(
libusb_dev
, &
fd_bË
[
fd
]))

1571 
bugout
;

1573 
pc
->
fd
 = fd;

1575 
¡©
 = 
HPMUD_R_OK
;

1577 
bugout
:

1578  
¡©
;

1579 
	}
}

1585 
HPMUD_RESULT
 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
	$musb_mlc_chªÃl_İ’
(
mud_chªÃl
 *
pc
)

1587 
mud_deviû
 *
pd
 = &
m¥
->
deviû
[
pc
->
dšdex
];

1588 
FD_ID
 
fd
;

1589 
HPMUD_RESULT
 
¡©
 = 
HPMUD_R_IO_ERROR
;

1592 ià(
pd
->
chªÃl_út
==1)

1594 ià(
	`g‘_š‹rçû
(
libusb_dev
, 
FD_7_1_3
, &
fd_bË
[FD_7_1_3]è=ğ0 && 
	`şaim_š‹rçû
(libusb_dev, &fd_table[FD_7_1_3]) == 0)

1595 
fd
 = 
FD_7_1_3
;

1596 ià(
	`g‘_š‹rçû
(
libusb_dev
, 
FD_ff_ff_ff
, &
fd_bË
[FD_ff_ff_ff]è=ğ0 && 
	`şaim_š‹rçû
(libusb_dev, &fd_table[FD_ff_ff_ff]) == 0)

1597 
fd
 = 
FD_ff_ff_ff
;

1598 ià(
	`g‘_š‹rçû
(
libusb_dev
, 
FD_ff_d4_0
, &
fd_bË
[FD_ff_d4_0]è=ğ0 && 
	`şaim_š‹rçû
(libusb_dev, &fd_table[FD_ff_d4_0]) == 0)

1599 
fd
 = 
FD_ff_d4_0
;

1600 ià(
	`g‘_š‹rçû
(
libusb_dev
, 
FD_7_1_2
, &
fd_bË
[FD_7_1_2]è=ğ0 && 
	`şaim_š‹rçû
(libusb_dev, &fd_table[FD_7_1_2]) == 0)

1601 
fd
 = 
FD_7_1_2
;

1604 
¡©
 = 
HPMUD_R_DEVICE_BUSY
;

1605 
bugout
;

1608 ià(
fd
 =ğ
FD_7_1_2
)

1611 ià(
	`wr™e_eı_chªÃl
(&
fd_bË
[
fd
], 77))

1612 
bugout
;

1615 
i
;

1618 ià(
	`MlcIn™
(
pc
, 
fd
) != 0)

1619 
bugout
;

1622 
i
=0; i<
HPMUD_CHANNEL_MAX
; i++)

1623 
	`mem£t
(&
pd
->
chªÃl
[
i
].

, 0 , (
Œª¥Üt_©Œibu‹s
));

1625 
pd
->
mlc_fd
 = 
fd
;

1626 
pd
->
mlc_up
=1;

1630 ià(
	`MlcCÚfigSock‘
(
pc
, 
pd
->
mlc_fd
))

1631 
bugout
;

1633 ià(
	`MlcO³nChªÃl
(
pc
, 
pd
->
mlc_fd
))

1634 
bugout
;

1636 
pc
->
rút
 =…c->
ršdex
 = 0;

1638 
¡©
 = 
HPMUD_R_OK
;

1640 
bugout
:

1641  
¡©
;

1642 
	}
}

1644 
HPMUD_RESULT
 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
	$musb_mlc_chªÃl_şo£
(
mud_chªÃl
 *
pc
)

1646 
mud_deviû
 *
pd
 = &
m¥
->
deviû
[
pc
->
dšdex
];

1647 
nuÎBy‹
=0;

1648 
HPMUD_RESULT
 
¡©
 = 
HPMUD_R_OK
;

1650 ià(
pd
->
mlc_up
)

1652 ià(
	`MlcClo£ChªÃl
(
pc
, 
pd
->
mlc_fd
))

1653 
¡©
 = 
HPMUD_R_IO_ERROR
;

1657 ià(
pd
->
chªÃl_út
==1)

1659 ià(
pd
->
mlc_up
)

1661 ià(
	`MlcEx™
(
pc
, 
pd
->
mlc_fd
))

1662 
¡©
 = 
HPMUD_R_IO_ERROR
;

1664 
pd
->
mlc_up
=0;

1666 ià(
pd
->
mlc_fd
 =ğ
FD_7_1_2
)

1668 
	`wr™e_eı_chªÃl
(&
fd_bË
[
pd
->
mlc_fd
], 78);

1669 (
pd
->
vf
.
wr™e
)Õd->
mlc_fd
, &
nuÎBy‹
, 1, 
HPMUD_EXCEPTION_TIMEOUT
);

1670 
	`wr™e_eı_chªÃl
(&
fd_bË
[
pd
->
mlc_fd
], 0);

1673 
	`»Ëa£_š‹rçû
(&
fd_bË
[
pd
->
mlc_fd
]);

1676 
	`¦“p
(1);

1679  
¡©
;

1680 
	}
}

1682 
HPMUD_RESULT
 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
	$musb_mlc_chªÃl_wr™e
(
mud_chªÃl
 *
pc
, cÚ¡ *
buf
, 
Ëngth
, 
£c_timeout
, *
by‹s_wrÙe
)

1684 
mud_deviû
 *
pd
 = &
m¥
->
deviû
[
pc
->
dšdex
];

1685 
»t
, 
Ën
, 
size
, 
dËn
, 
tÙ®
=0;

1686 
HPMUD_RESULT
 
¡©
 = 
HPMUD_R_IO_ERROR
;

1688 *
by‹s_wrÙe
=0;

1689 
size
 = 
Ëngth
;

1690 
dËn
 = 
pc
->

.
h2psize
 - (
MLCH—d”
);

1691 
size
 > 0)

1693 
Ën
 = (
size
 > 
dËn
) ? dlen : size;

1695 ià(
pc
->

.
h2püed™
 =ğ0 && 
pd
->
io_mode
 =ğ
HPMUD_MLC_MISER_MODE
)

1697 ià(
	`MlcC»d™Reque¡
(
pc
, 
pd
->
mlc_fd
, 1))

1699 
	`BUG
("invalid MlcCreditRequest from…eripheral\n");

1700 
bugout
;

1704 ià(
pc
->

.
h2püed™
 == 0)

1706 
»t
 = 
	`MlcRev”£Cmd
(
pc
, 
pd
->
mlc_fd
);

1707 ià(
pc
->

.
h2püed™
 == 0)

1709 ià(
»t
 == 0)

1712 ià(
pd
->
io_mode
 !ğ
HPMUD_MLC_MISER_MODE
)

1715 
	`BUG
("invalid MlcCredit from…eripheral,rying miser\n");

1716 
pd
->
io_mode
 = 
HPMUD_MLC_MISER_MODE
;

1720 
	`BUG
("invalid MlcCredit from…eripheral\n");

1721 
bugout
;

1725 ià(
	`MlcFÜw¬dD©a
(
pc
, 
pd
->
mlc_fd
, 
buf
+
tÙ®
, 
Ën
, 
£c_timeout
*1000000))

1727 
bugout
;

1730 
pc
->

.
h2püed™
--;

1731 
size
-=
Ën
;

1732 
tÙ®
+=
Ën
;

1733 *
by‹s_wrÙe
+=
Ën
;

1736 
¡©
 = 
HPMUD_R_OK
;

1738 
bugout
:

1739  
¡©
;

1740 
	}
}

1755 
HPMUD_RESULT
 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
	$musb_mlc_chªÃl_»ad
(
mud_chªÃl
 *
pc
, *
buf
, 
Ëngth
, 
£c_timeout
, *
by‹s_»ad
)

1757 
mud_deviû
 *
pd
 = &
m¥
->
deviû
[
pc
->
dšdex
];

1758 
HPMUD_RESULT
 
¡©
 = 
HPMUD_R_IO_ERROR
;

1760 *
by‹s_»ad
=0;

1761 ià(
pc
->

.
p2hsize
==0)

1763 
	`BUG
("invalid channel_read state\n");

1764 
bugout
;

1767 ià(
pc
->
rút
)

1769 
¡©
=
HPMUD_R_OK
;

1770 *
by‹s_»ad
 = 
	`cut_buf
(
pc
, 
buf
, 
Ëngth
);

1771 
bugout
;

1774 ià(
pc
->

.
p2hüed™
 == 0)

1777 ià(
	`MlcC»d™
(
pc
, 
pd
->
mlc_fd
, 1))

1778 
bugout
;

1781 
¡©
=
HPMUD_R_OK
;

1782 
pc
->
rút
 = 
	`MlcRev”£D©a
Õc, 
pd
->
mlc_fd
,…c->
rbuf
, Õc->rbuf), 
£c_timeout
*1000000);

1783 ià(
pc
->
rút
)

1784 
pc
->

.
p2hüed™
--;

1786 *
by‹s_»ad
 = 
	`cut_buf
(
pc
, 
buf
, 
Ëngth
);

1788 
bugout
:

1789  
¡©
;

1790 
	}
}

1796 
HPMUD_RESULT
 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
	$musb_dÙ4_chªÃl_İ’
(
mud_chªÃl
 *
pc
)

1798 
mud_deviû
 *
pd
 = &
m¥
->
deviû
[
pc
->
dšdex
];

1799 
FD_ID
 
fd
;

1800 
HPMUD_RESULT
 
¡©
 = 
HPMUD_R_IO_ERROR
;

1803 ià(
pd
->
chªÃl_út
==1)

1805 ià(
	`g‘_š‹rçû
(
libusb_dev
, 
FD_7_1_3
, &
fd_bË
[FD_7_1_3]è=ğ0 && 
	`şaim_š‹rçû
(libusb_dev, &fd_table[FD_7_1_3]) == 0)

1806 
fd
 = 
FD_7_1_3
;

1807 ià(
	`g‘_š‹rçû
(
libusb_dev
, 
FD_ff_ff_ff
, &
fd_bË
[FD_ff_ff_ff]è=ğ0 && 
	`şaim_š‹rçû
(libusb_dev, &fd_table[FD_ff_ff_ff]) == 0)

1808 
fd
 = 
FD_ff_ff_ff
;

1809 ià(
	`g‘_š‹rçû
(
libusb_dev
, 
FD_ff_d4_0
, &
fd_bË
[FD_ff_d4_0]è=ğ0 && 
	`şaim_š‹rçû
(libusb_dev, &fd_table[FD_ff_d4_0]) == 0)

1810 
fd
 = 
FD_ff_d4_0
;

1811 ià(
	`g‘_š‹rçû
(
libusb_dev
, 
FD_7_1_2
, &
fd_bË
[FD_7_1_2]è=ğ0 && 
	`şaim_š‹rçû
(libusb_dev, &fd_table[FD_7_1_2]) == 0)

1812 
fd
 = 
FD_7_1_2
;

1815 
¡©
 = 
HPMUD_R_DEVICE_BUSY
;

1816 
bugout
;

1819 ià(
fd
 =ğ
FD_7_1_2
)

1821 ià(
pd
->
io_mode
 =ğ
HPMUD_DOT4_BRIDGE_MODE
)

1824 ià(
	`bridge_ch_up
(&
fd_bË
[
fd
]))

1825 
bugout
;

1830 ià(
	`wr™e_eı_chªÃl
(&
fd_bË
[
fd
], 77))

1831 
bugout
;

1835 ià(
pd
->
io_mode
 =ğ
HPMUD_DOT4_PHOENIX_MODE
)

1836 
	`wr™e_phÛnix_£tup
(&
fd_bË
[
fd
]);

1838 
i
;

1841 ià(
	`DÙ4In™
(
pc
, 
fd
) != 0)

1842 
bugout
;

1845 
i
=0; i<
HPMUD_CHANNEL_MAX
; i++)

1846 
	`mem£t
(&
pd
->
chªÃl
[
i
].

, 0 , (
Œª¥Üt_©Œibu‹s
));

1848 
pd
->
mlc_fd
 = 
fd
;

1849 
pd
->
mlc_up
=1;

1853 ià(
	`DÙ4G‘Sock‘
(
pc
, 
pd
->
mlc_fd
))

1854 
bugout
;

1856 ià(
	`DÙ4O³nChªÃl
(
pc
, 
pd
->
mlc_fd
))

1857 
bugout
;

1859 ià(
pd
->
io_mode
 =ğ
HPMUD_DOT4_PHOENIX_MODE
)

1862 ià(
	`DÙ4C»d™
(
pc
, 
pd
->
mlc_fd
, 2))

1864 
	`BUG
("invalid Dot4Credito…eripheral\n");

1865 
bugout
;

1868 
pc
->
rút
 =…c->
ršdex
 = 0;

1870 
¡©
 = 
HPMUD_R_OK
;

1872 
bugout
:

1873  
¡©
;

1874 
	}
}

1876 
HPMUD_RESULT
 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
	$musb_dÙ4_chªÃl_şo£
(
mud_chªÃl
 *
pc
)

1878 
mud_deviû
 *
pd
 = &
m¥
->
deviû
[
pc
->
dšdex
];

1879 
HPMUD_RESULT
 
¡©
 = 
HPMUD_R_OK
;

1881 ià(
pd
->
mlc_up
)

1883 ià(
	`DÙ4Clo£ChªÃl
(
pc
, 
pd
->
mlc_fd
))

1884 
¡©
 = 
HPMUD_R_IO_ERROR
;

1888 ià(
pd
->
chªÃl_út
==1)

1890 ià(
pd
->
mlc_up
)

1892 ià(
	`DÙ4Ex™
(
pc
, 
pd
->
mlc_fd
))

1893 
¡©
 = 
HPMUD_R_IO_ERROR
;

1895 
pd
->
mlc_up
=0;

1897 ià(
pd
->
mlc_fd
 =ğ
FD_7_1_2
)

1899 ià(
pd
->
io_mode
 =ğ
HPMUD_DOT4_BRIDGE_MODE
)

1901 
	`bridge_ch_down
(&
fd_bË
[
pd
->
mlc_fd
]);

1905 
	`wr™e_eı_chªÃl
(&
fd_bË
[
pd
->
mlc_fd
], 78);

1906 
	`wr™e_eı_chªÃl
(&
fd_bË
[
pd
->
mlc_fd
], 0);

1910 
	`»Ëa£_š‹rçû
(&
fd_bË
[
pd
->
mlc_fd
]);

1913 
	`¦“p
(1);

1916  
¡©
;

1917 
	}
}

1919 
HPMUD_RESULT
 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
	$musb_dÙ4_chªÃl_wr™e
(
mud_chªÃl
 *
pc
, cÚ¡ *
buf
, 
Ëngth
, 
£c_timeout
, *
by‹s_wrÙe
)

1921 
mud_deviû
 *
pd
 = &
m¥
->
deviû
[
pc
->
dšdex
];

1922 
»t
, 
Ën
, 
size
, 
dËn
, 
tÙ®
=0, 
út
=0;

1923 
HPMUD_RESULT
 
¡©
 = 
HPMUD_R_IO_ERROR
;

1925 *
by‹s_wrÙe
=0;

1926 
size
 = 
Ëngth
;

1927 
dËn
 = 
pc
->

.
h2psize
 - (
DOT4H—d”
);

1928 
size
 > 0)

1930 
Ën
 = (
size
 > 
dËn
) ? dlen : size;

1932 ià(
pc
->

.
h2püed™
 =ğ0 && 
pd
->
io_mode
 =ğ
HPMUD_DOT4_PHOENIX_MODE
)

1935 ià(
	`DÙ4C»d™Reque¡
(
pc
, 
pd
->
mlc_fd
, 1))

1937 
	`BUG
("invalid Dot4CreditRequest from…eripheral\n");

1938 
bugout
;

1940 ià(
pc
->

.
h2püed™
 == 0)

1942 ià(
út
++ > 
HPMUD_EXCEPTION_SEC_TIMEOUT
)

1944 
	`BUG
("invalid Dot4CreditRequest from…eripheral\n");

1945 
bugout
;

1947 
	`¦“p
(1);

1952 ià(
pc
->

.
h2püed™
 == 0)

1954 
»t
 = 
	`DÙ4Rev”£Cmd
(
pc
, 
pd
->
mlc_fd
);

1955 ià(
pc
->

.
h2püed™
 == 0)

1957 ià(
»t
 == 0)

1960 
	`BUG
("invalid Dot4Credit from…eripheral\n");

1961 
bugout
;

1965 ià(
	`DÙ4FÜw¬dD©a
(
pc
, 
pd
->
mlc_fd
, 
buf
+
tÙ®
, 
Ën
, 
£c_timeout
*1000000))

1967 
bugout
;

1970 
pc
->

.
h2püed™
--;

1971 
size
-=
Ën
;

1972 
tÙ®
+=
Ën
;

1973 *
by‹s_wrÙe
+=
Ën
;

1974 
út
=0;

1977 
¡©
 = 
HPMUD_R_OK
;

1979 
bugout
:

1980  
¡©
;

1981 
	}
}

1996 
HPMUD_RESULT
 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
	$musb_dÙ4_chªÃl_»ad
(
mud_chªÃl
 *
pc
, *
buf
, 
Ëngth
, 
£c_timeout
, *
by‹s_»ad
)

1998 
mud_deviû
 *
pd
 = &
m¥
->
deviû
[
pc
->
dšdex
];

1999 
HPMUD_RESULT
 
¡©
 = 
HPMUD_R_IO_ERROR
;

2001 *
by‹s_»ad
=0;

2002 ià(
pc
->

.
p2hsize
==0)

2004 
	`BUG
("invalid channel_read state\n");

2005 
bugout
;

2008 ià(
pc
->
rút
)

2010 
¡©
=
HPMUD_R_OK
;

2011 *
by‹s_»ad
 = 
	`cut_buf
(
pc
, 
buf
, 
Ëngth
);

2012 
bugout
;

2015 ià(
pc
->

.
p2hüed™
 == 0)

2018 ià(
	`DÙ4C»d™
(
pc
, 
pd
->
mlc_fd
, 1))

2019 
bugout
;

2022 
¡©
=
HPMUD_R_OK
;

2023 
pc
->
rút
 = 
	`DÙ4Rev”£D©a
Õc, 
pd
->
mlc_fd
,…c->
rbuf
, Õc->rbuf), 
£c_timeout
*1000000);

2024 ià(
pc
->
rút
)

2025 
pc
->

.
p2hüed™
--;

2027 *
by‹s_»ad
 = 
	`cut_buf
(
pc
, 
buf
, 
Ëngth
);

2029 
bugout
:

2030  
¡©
;

2031 
	}
}

2037 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
	$musb_´obe_deviûs
(*
l¡
, 
l¡_size
, *
út
, 
HPMUD_DEVICE_TYPE
 
devty³
)

2039 
libusb_cÚ‹xt
 *
ùx
 = 
NULL
;

2040 
libusb_deviû
 **
li¡
;

2041 
libusb_deviû
 *
dev
 = 
NULL
;

2042 
libusb_deviû_desütÜ
 
devdesc
;

2043 
libusb_cÚfig_desütÜ
 *
cÚåŒ
 = 
NULL
;

2044 cÚ¡ 
libusb_š‹rçû
 *
içû±r
 = 
NULL
;

2045 cÚ¡ 
libusb_š‹rçû_desütÜ
 *
®Œ
 = 
NULL
;

2046 
libusb_deviû_hªdË
 *
hd
 = 
NULL
;

2048 
numdevs
 = 0;

2049 
i
, 
cÚf
, 
içû
, 
®t£t
 ;

2050 
dev_®»ady_couÁed
 = 0;

2052 
hpmud_mod–_©Œibu‹s
 
ma
;

2053 
rmod–
[128], 
r£rŸl
[128], 
mod–
[128];

2054 
£rŸl
[128], 
mfg
[128], 
sz
[
HPMUD_LINE_SIZE
];

2055 
r
, 
size
=0;

2057 
	`libusb_š™
(&
ùx
);

2058 
numdevs
 = 
	`libusb_g‘_deviû_li¡
(
ùx
, &
li¡
);

2060 ià(
numdevs
 <= 0)

2061 
bugout
;

2063 
mod–
[0] = 
£rŸl
[0] = 
rmod–
[0] = 
r£rŸl
[0] = 
sz
[0] = 
mfg
[0] = 0;

2065 
i
 = 0; i < 
numdevs
; i++)

2067 
dev
 = 
li¡
[
i
];

2068 
dev_®»ady_couÁed
 = 0 ;

2072 
	`libusb_g‘_deviû_desütÜ
 (
dev
, &
devdesc
);

2074 ià(!
devdesc
.
bNumCÚfigu¿tiÚs
 || !devdesc.
idV’dÜ
 || !devdesc.
idProduù
)

2077 if(
devdesc
.
idV’dÜ
 != 0x3f0)

2080 
cÚf
 = 0; (
dev_®»ady_couÁed
 =ğ0 && cÚà< 
devdesc
.
bNumCÚfigu¿tiÚs
); conf++)

2082 ià(
	`libusb_g‘_cÚfig_desütÜ
 (
dev
, 
cÚf
, &
cÚåŒ
) < 0)

2084 
içû
 = 0, 
içû±r
 = 
cÚåŒ
->
š‹rçû
;

2085 (
dev_®»ady_couÁed
 =ğ0 && 
içû
 < 
cÚåŒ
->
bNumIÁ”çûs
); içû ++, 
içû±r
 ++)

2087 
®t£t
 = 0, 
®Œ
 = 
içû±r
->
®t£‰šg
;‡É£ˆ< içû±r->
num_®t£‰šg
;‡ltset++,‡ltptr++)

2089 ià((
®Œ
->
bIÁ”çûCÏss
 =ğ
LIBUSB_CLASS_PRINTER
è|| (®Œ->bIÁ”çûCÏs =ğ
LIBUSB_CLASS_VENDOR_SPEC
))

2091 ifĞ(
devty³
 =ğ
HPMUD_PRINTER
è&& (
®Œ
->
bIÁ”çûPrÙocŞ
 != 0x02) )

2096 
	`libusb_İ’
(
dev
, &
hd
);

2097 ià(
hd
 =ğ
NULL
)

2099 
	`BUG
("Invalid usb_open: %m\n");

2103 ià((
r
=
	`g‘_¡ršg_desütÜ
(
hd
, 
devdesc
.
iProduù
, 
rmod–
, (rmodel))) < 0)

2104 
	`BUG
("šv®id…roduù id sŒšg„‘=%d\n", 
r
);

2106 
	`g’”®ize_mod–
(
rmod–
, 
mod–
, (model));

2108 ià((
r
=
	`g‘_¡ršg_desütÜ
(
hd
, 
devdesc
.
iS”ŸlNumb”
, 
r£rŸl
, (rserial))) < 0)

2109 
	`BUG
("šv®id s”ŸÈid sŒšg„‘=%d\n", 
r
);

2111 
	`g’”®ize_£rŸl
(
r£rŸl
, 
£rŸl
, (serial));

2113 ià((
r
=
	`g‘_¡ršg_desütÜ
(
hd
, 
devdesc
.
iMªuçùu»r
, 
sz
, (sz))) < 0)

2114 
	`BUG
("šv®id mªuçùu»¸¡ršg„‘=%d\n", 
r
);

2116 
	`g’”®ize_£rŸl
(
sz
, 
mfg
, (
£rŸl
));

2118 ià(!
£rŸl
[0])

2119 
	`¡rıy
(
£rŸl
, "0");

2121 ià(
mod–
[0])

2123 
	`¢´štf
(
sz
, (sz), "hp:/usb/%s?£rŸl=%s", 
mod–
, 
£rŸl
);

2126 
	`hpmud_qu”y_mod–
(
sz
, &
ma
);

2127 ià(
ma
.
suµÜt
 !ğ
HPMUD_SUPPORT_TYPE_HPLIP
)

2129 
	`BUG
("ignÜšg % suµÜt=%d\n", 
sz
, 
ma
.
suµÜt
);

2137 ià(
	`¡ºÿ£cmp
(
rmod–
, "hp ", 3) == 0)

2138 
size
 +ğ
	`¢´štf
(
l¡
+size, 
l¡_size
-size, "direct %s \"HP %s\" \"HP %s USB %s HPLIP\" \"MFG:%s;MDL:%s;CLS:PRINTER;DES:%s;SN:%s;\"\n",

2139 
sz
, &
rmod–
[3], &rmod–[3], 
£rŸl
, 
mfg
,„mod–,„mod–, 
r£rŸl
);

2141 
size
 +ğ
	`¢´štf
(
l¡
+size, 
l¡_size
-size, "direct %s \"HP %s\" \"HP %s USB %s HPLIP\" \"MFG:%s;MDL:%s;CLS:PRINTER;DES:%s;SN:%s;\"\n",

2142 
sz
, 
rmod–
,„mod–, 
£rŸl
, 
mfg
,„mod–,„mod–, 
r£rŸl
);

2144 *
út
+=1;

2146 
	`libusb_şo£
(
hd
); hd = 
NULL
;

2147 
dev_®»ady_couÁed
 = 1;

2152 
	`libusb_ä“_cÚfig_desütÜ
(
cÚåŒ
); cÚåŒ = 
NULL
;

2157 
bugout
:

2158 ià(!
hd
)

2159 
	`libusb_şo£
(
hd
);

2160 ià(
cÚåŒ
)

2161 
	`libusb_ä“_cÚfig_desütÜ
(
cÚåŒ
);

2162 
	`libusb_ä“_deviû_li¡
(
li¡
, 1);

2163 
	`libusb_ex™
(
ùx
);

2165  
size
;

2166 
	}
}

2168 
HPMUD_RESULT
 
	$hpmud_make_usb_uri
(cÚ¡ *
bu¢um
, cÚ¡ *
devnum
, *
uri
, 
uri_size
, *
by‹s_»ad
)

2170 
libusb_cÚ‹xt
 *
ùx
 = 
NULL
;

2171 
libusb_deviû
 **
li¡
;

2172 
libusb_deviû
 *
dev
 = 
NULL
, *
found_dev
=NULL;

2173 
libusb_deviû_hªdË
 *
hd
=
NULL
;

2174 
libusb_deviû_desütÜ
 
devdesc
;

2175 
libusb_cÚfig_desütÜ
 *
cÚåŒ
 = 
NULL
;

2176 cÚ¡ 
libusb_š‹rçû
 *
içû±r
 = 
NULL
;

2177 cÚ¡ 
libusb_š‹rçû_desütÜ
 *
®Œ
 = 
NULL
;

2178 
mod–
[128], 
£rŸl
[128], 
sz
[256];

2179 
r
, 
numdevs
, 
i
;

2180 
cÚf
, 
içû
, 
®t£t
 ;

2181 
bus_num
, 
dev_num
;

2182 
HPMUD_RESULT
 
¡©
 = 
HPMUD_R_INVALID_DEVICE_NODE
;

2183 
isSm¬tIn¡®l_’abËd
 = 0, 
isPrš‹r
 = 0;

2185 
	`DBG
("[%d] hpmud_make_usb_uri(èbus=% dev=%s\n", 
	`g‘pid
(), 
bu¢um
, 
devnum
);

2187 *
by‹s_»ad
=0;

2189 
	`libusb_š™
(&
ùx
);

2190 
numdevs
 = 
	`libusb_g‘_deviû_li¡
(
ùx
, &
li¡
);

2192 ià(
numdevs
 <= 0)

2193 
bugout
;

2195 
i
 = 0; i < 
numdevs
; i++)

2197 
dev
 = 
li¡
[
i
];

2198 
bus_num
 = 
	`libusb_g‘_bus_numb”
(
dev
);

2199 ià(
bus_num
 !ğ
	`©oi
(
bu¢um
))

2202 
dev_num
 = 
	`libusb_g‘_deviû_add»ss
(
dev
);

2203 ià(
dev_num
 !ğ
	`©oi
(
devnum
))

2206 
found_dev
 = 
dev
;

2209 ià(
found_dev
 =ğ
NULL
)

2211 
	`BUG
("šv®id bu¢um:devnum %s:%s\n", 
bu¢um
, 
devnum
);

2212 
bugout
;

2215 
dev
 = 
found_dev
;

2216 
	`libusb_İ’
(
dev
, &
hd
);

2218 ià(
hd
 =ğ
NULL
)

2220 
	`BUG
("invalid†ibusb_open: %m\n");

2221 
bugout
;

2224 
mod–
[0] = 
£rŸl
[0] = 
sz
[0] = 0;

2226 
	`libusb_g‘_deviû_desütÜ
 (
dev
, &
devdesc
);

2228 ià(
devdesc
.
idV’dÜ
 == 0x3f0)

2231 ià((
r
=
	`g‘_¡ršg_desütÜ
(
hd
, 
devdesc
.
iProduù
, 
sz
, (sz))) < 0)

2232 
	`BUG
("šv®id…roduù id sŒšg„‘=%d\n", 
r
);

2234 
	`g’”®ize_mod–
(
sz
, 
mod–
, (model));

2236 ià((
r
=
	`g‘_¡ršg_desütÜ
(
hd
, 
devdesc
.
iS”ŸlNumb”
, 
sz
, (sz))) < 0)

2237 
	`BUG
("šv®id s”ŸÈid sŒšg„‘=%d\n", 
r
);

2239 
	`g’”®ize_£rŸl
(
sz
, 
£rŸl
, (serial));

2241 ià(!
£rŸl
[0])

2242 
	`¡rıy
(
£rŸl
, "0");

2244 
cÚf
 = 0; cÚà< 
devdesc
.
bNumCÚfigu¿tiÚs
; conf++)

2246 ià(
	`libusb_g‘_cÚfig_desütÜ
 (
dev
, 
cÚf
, &
cÚåŒ
) < 0)

2249 
içû
 = 0, 
içû±r
 = 
cÚåŒ
->
š‹rçû
; içû < cÚåŒ->
bNumIÁ”çûs
; iface ++, ifaceptr ++)

2251 
®t£t
 = 0, 
®Œ
 = 
içû±r
->
®t£‰šg
;‡É£ˆ< içû±r->
num_®t£‰šg
;‡ltset++,‡ltptr++)

2253 ià(
cÚåŒ
->
bNumIÁ”çûs
 =ğ1 && 
®Œ
->
bIÁ”çûCÏss
 =ğ
LIBUSB_CLASS_MASS_STORAGE
 )

2255 
	`¡rıy
(
£rŸl
, "SMART_INSTALL_ENABLED");

2256 
isSm¬tIn¡®l_’abËd
 = 1;

2259 ià(
®Œ
->
bIÁ”çûCÏss
 =ğ
LIBUSB_CLASS_PRINTER
 )

2261 
isPrš‹r
 = 1;

2266 
	`libusb_ä“_cÚfig_desütÜ
(
cÚåŒ
); cÚåŒ = 
NULL
;

2272 
	`BUG
("šv®id v’dÜ id: %d\n", 
devdesc
.
idV’dÜ
);

2273 
bugout
;

2276 ià(!
mod–
[0] || !
£rŸl
[0])

2277 
bugout
;

2279 iàĞ
isPrš‹r
 =ğ1 || 
isSm¬tIn¡®l_’abËd
 == 1)

2281 *
by‹s_»ad
 = 
	`¢´štf
(
uri
, 
uri_size
, "hp:/usb/%s?£rŸl=%s", 
mod–
, 
£rŸl
);

2282 
	`DBG
("hpmud_make_usb_uri(èuri=% by‹s_»ad=%d\n", 
uri
, *
by‹s_»ad
);

2283 
¡©
 = 
HPMUD_R_OK
;

2286 
	`DBG
("hpmud_make_usb_uri(èInv®id Deviû =%s\n", 
mod–
);

2288 
bugout
:

2289 ià(
hd
 !ğ
NULL
)

2290 
	`libusb_şo£
(
hd
);

2292 
	`libusb_ä“_deviû_li¡
(
li¡
, 1);

2293 
	`libusb_ex™
(
ùx
);

2295  
¡©
;

2296 
	}
}

2298 
HPMUD_RESULT
 
	$hpmud_make_usb_£rŸl_uri
(cÚ¡ *
¢
, *
uri
, 
uri_size
, *
by‹s_»ad
)

2300 
libusb_cÚ‹xt
 *
ùx
 = 
NULL
;

2301 
libusb_deviû
 **
li¡
;

2302 
libusb_deviû
 *
dev
 = 
NULL
, *
found_dev
=NULL;

2304 
mod–
[128];

2305 
HPMUD_RESULT
 
¡©
 = 
HPMUD_R_INVALID_DEVICE_NODE
;

2306 
i
, 
numdevs
;

2308 
	`DBG
("[%d] hpmud_make_usb_£rŸl_uri(è¢=%s\n", 
	`g‘pid
(), 
¢
);

2310 *
by‹s_»ad
=0;

2312 
	`libusb_š™
(&
ùx
);

2313 
numdevs
 = 
	`libusb_g‘_deviû_li¡
(
ùx
, &
li¡
);

2315 ià(
numdevs
 <= 0)

2316 
bugout
;

2318 
i
 = 0; i < 
numdevs
; i++)

2320 
dev
 = 
li¡
[
i
];

2321 ià(
	`is_£rŸl
(
dev
, 
¢
, 
mod–
, (model)))

2323 
found_dev
 = 
dev
;

2328 ià(
found_dev
 =ğ
NULL
)

2330 
	`BUG
("šv®id sÀ%s\n", 
¢
);

2331 
bugout
;

2334 *
by‹s_»ad
 = 
	`¢´štf
(
uri
, 
uri_size
, "hp:/usb/%s?£rŸl=%s", 
mod–
, 
¢
);

2335 
¡©
 = 
HPMUD_R_OK
;

2337 
bugout
:

2338 
	`libusb_ä“_deviû_li¡
(
li¡
, 1);

2339 
	`libusb_ex™
(
ùx
);

2341  
¡©
;

2342 
	}
}

	@io/hpmud/musb.h

27 #iâdeà
_MUSB_H


28 
	#_MUSB_H


	)

30 #ifdeà
HAVE_LIBUSB01


31 
	~<usb.h
>

33 
	~<libusb.h
>

36 
	~"hpmud.h
"

37 
	~"hpmudi.h
"

39 
	#LIBUSB_TIMEOUT
 30000

	)

40 
	#LIBUSB_CONTROL_REQ_TIMEOUT
 5000

	)

42 
	eFD_ID


44 
	mFD_NA
=0,

45 
	mFD_7_1_2
,

46 
	mFD_7_1_3
,

47 
	mFD_7_1_4
,

48 
	mFD_ff_1_1
,

49 
	mFD_ff_2_1
,

50 
	mFD_ff_3_1
,

51 
	mFD_ff_ff_ff
,

52 
	mFD_ff_d4_0
,

53 
	mFD_ff_4_1
,

54 
	mFD_ff_1_0
,

55 
	mFD_ff_cc_0
,

56 
	mFD_ff_2_10
,

57 
	mFD_ff_9_1
,

58 
	mMAX_FD


61 
	eBRIGE_REG_ID


63 
	mECRR
=2,

64 
	mCCTR
=3,

65 
	mATAA
=8

71 #ifdeà
HAVE_LIBUSB01


72 
usb_dev_hªdË
 *
	mhd
;

74 
libusb_deviû_hªdË
 *
	mhd
;

77 
FD_ID
 
	mfd
;

78 
	mcÚfig
;

79 
	mš‹rçû
;

80 
	m®t_£‰šg
;

83 
	mwr™e_aùive
;

84 cÚ¡ *
	mwr™e_buf
;

85 
	mwr™e_size
;

86 
	mwr™e_»tuº
;

87 
±h»ad_t
 
	mtid
;

88 
±h»ad_mu‹x_t
 
	mmu‹x
;

89 
±h»ad_cÚd_t
 
	mwr™e_dÚe_cÚd
;

91 
	mubuf
[
HPMUD_BUFFER_SIZE
];

92 
	mušdex
;

93 
	muút
;

94 } 
	tfe_desütÜ
;

96 
	g_mud_deviû
;

97 
	g_mud_chªÃl
;

99 
_mud_deviû_vf
 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
musb_mud_deviû_vf
;

101 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
musb_wr™e
(
fd
, cÚ¡ *
buf
, 
size
, 
u£c_timout
);

102 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
musb_»ad
(
fd
, *
buf
, 
size
, 
u£c_timout
);

103 
HPMUD_RESULT
 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
musb_İ’
(
_mud_deviû
 *
pd
);

104 
HPMUD_RESULT
 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
musb_şo£
(
_mud_deviû
 *
pd
);

105 
HPMUD_RESULT
 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
musb_g‘_deviû_id
(
_mud_deviû
 *
pd
, *
buf
, 
size
, *
Ën
);

106 
HPMUD_RESULT
 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
musb_g‘_deviû_¡©us
(
_mud_deviû
 *
pd
, *
¡©us
);

107 
HPMUD_RESULT
 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
musb_chªÃl_İ’
(
_mud_deviû
 *
pd
, cÚ¡ *
¢
, 
HPMUD_CHANNEL
 *
cd
);

108 
HPMUD_RESULT
 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
musb_chªÃl_şo£
(
_mud_deviû
 *
pd
, 
_mud_chªÃl
 *
pc
);

109 
HPMUD_RESULT
 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
musb_chªÃl_wr™e
(
_mud_deviû
 *
pd
, 
_mud_chªÃl
 *
pc
, cÚ¡ *
buf
, 
Ëngth
, 
timeout
, *
by‹s_wrÙe
);

110 
HPMUD_RESULT
 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
musb_chªÃl_»ad
(
_mud_deviû
 *
pd
, 
_mud_chªÃl
 *
pc
, *
buf
, 
Ëngth
, 
timeout
, *
by‹s_»ad
);

112 
HPMUD_RESULT
 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
musb_¿w_chªÃl_İ’
(
_mud_chªÃl
 *
pc
);

113 
HPMUD_RESULT
 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
musb_¿w_chªÃl_şo£
(
_mud_chªÃl
 *
pc
);

114 
HPMUD_RESULT
 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
musb_¿w_chªÃl_wr™e
(
_mud_chªÃl
 *
pc
, cÚ¡ *
buf
, 
Ëngth
, 
timeout
, *
by‹s_wrÙe
);

115 
HPMUD_RESULT
 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
musb_¿w_chªÃl_»ad
(
_mud_chªÃl
 *
pc
, *
buf
, 
Ëngth
, 
timeout
, *
by‹s_wrÙe
);

117 
HPMUD_RESULT
 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
musb_comp_chªÃl_İ’
(
_mud_chªÃl
 *
pc
);

119 
HPMUD_RESULT
 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
musb_mlc_chªÃl_İ’
(
_mud_chªÃl
 *
pc
);

120 
HPMUD_RESULT
 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
musb_mlc_chªÃl_şo£
(
_mud_chªÃl
 *
pc
);

121 
HPMUD_RESULT
 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
musb_mlc_chªÃl_wr™e
(
_mud_chªÃl
 *
pc
, cÚ¡ *
buf
, 
Ëngth
, 
timeout
, *
by‹s_wrÙe
);

122 
HPMUD_RESULT
 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
musb_mlc_chªÃl_»ad
(
_mud_chªÃl
 *
pc
, *
buf
, 
Ëngth
, 
timeout
, *
by‹s_wrÙe
);

124 
HPMUD_RESULT
 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
musb_dÙ4_chªÃl_İ’
(
_mud_chªÃl
 *
pc
);

125 
HPMUD_RESULT
 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
musb_dÙ4_chªÃl_şo£
(
_mud_chªÃl
 *
pc
);

126 
HPMUD_RESULT
 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
musb_dÙ4_chªÃl_wr™e
(
_mud_chªÃl
 *
pc
, cÚ¡ *
buf
, 
Ëngth
, 
£c_timeout
, *
by‹s_wrÙe
);

127 
HPMUD_RESULT
 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
musb_dÙ4_chªÃl_»ad
(
_mud_chªÃl
 *
pc
, *
buf
, 
Ëngth
, 
£c_timeout
, *
by‹s_»ad
);

129 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
musb_´obe_deviûs
(*
l¡
, 
l¡_size
, *
út
, 
HPMUD_DEVICE_TYPE
 
devty³
);

130 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
pow”_up
(
_mud_deviû
 *
pd
, 
fd
);

	@io/hpmud/musb_libusb01.c

28 
	~"hpmud.h
"

29 
	~"hpmudi.h
"

30 
	~<dlfú.h
>

31 
	~"uts.h
"

33 
mud_deviû_vf
 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
	gmusb_mud_deviû_vf
 =

35 .
»ad
 = 
musb_»ad
,

36 .
	gwr™e
 = 
musb_wr™e
,

37 .
	gİ’
 = 
musb_İ’
,

38 .
	gşo£
 = 
musb_şo£
,

39 .
	gg‘_deviû_id
 = 
musb_g‘_deviû_id
,

40 .
	gg‘_deviû_¡©us
 = 
musb_g‘_deviû_¡©us
,

41 .
	gchªÃl_İ’
 = 
musb_chªÃl_İ’
,

42 .
	gchªÃl_şo£
 = 
musb_chªÃl_şo£
,

43 .
	gchªÃl_wr™e
 = 
musb_chªÃl_wr™e
,

44 .
	gchªÃl_»ad
 = 
musb_chªÃl_»ad


47 
mud_chªÃl_vf
 
	gmusb_¿w_chªÃl_vf
 =

49 .
İ’
 = 
musb_¿w_chªÃl_İ’
,

50 .
	gşo£
 = 
musb_¿w_chªÃl_şo£
,

51 .
	gchªÃl_wr™e
 = 
musb_¿w_chªÃl_wr™e
,

52 .
	gchªÃl_»ad
 = 
musb_¿w_chªÃl_»ad


55 
mud_chªÃl_vf
 
	gmusb_comp_chªÃl_vf
 =

57 .
İ’
 = 
musb_comp_chªÃl_İ’
,

58 .
	gşo£
 = 
musb_¿w_chªÃl_şo£
,

59 .
	gchªÃl_wr™e
 = 
musb_¿w_chªÃl_wr™e
,

60 .
	gchªÃl_»ad
 = 
musb_¿w_chªÃl_»ad


63 
mud_chªÃl_vf
 
	gmusb_mlc_chªÃl_vf
 =

65 .
İ’
 = 
musb_mlc_chªÃl_İ’
,

66 .
	gşo£
 = 
musb_mlc_chªÃl_şo£
,

67 .
	gchªÃl_wr™e
 = 
musb_mlc_chªÃl_wr™e
,

68 .
	gchªÃl_»ad
 = 
musb_mlc_chªÃl_»ad


71 
mud_chªÃl_vf
 
	gmusb_dÙ4_chªÃl_vf
 =

73 .
İ’
 = 
musb_dÙ4_chªÃl_İ’
,

74 .
	gşo£
 = 
musb_dÙ4_chªÃl_şo£
,

75 .
	gchªÃl_wr™e
 = 
musb_dÙ4_chªÃl_wr™e
,

76 .
	gchªÃl_»ad
 = 
musb_dÙ4_chªÃl_»ad


83 *
	gfd_Çme
[
MAX_FD
] =

101 
	gfd_şass
[
MAX_FD
] =

106 
	gfd_subşass
[
MAX_FD
] =

111 
	gfd_´ÙocŞ
[
MAX_FD
] =

116 cÚ¡ 
	gv’iû_pow”_Ú
[] = {0x1b, '%','P','u','i','f','p','.','p','o','w','e','r',' ','1',';',

119 
usb_deviû
 *
	glibusb_deviû
;

121 
fe_desütÜ
 
	gfd_bË
[
MAX_FD
];

124 
	$g‘_¡ršg_desütÜ
(
usb_dev_hªdË
 *
dev
, 
šdex
, *
buf
, 
size_t
 
buæ’
)

126 
tbuf
[255];

127 
»t
, 
si
, 
di
, 
út
=5;

129 
út
--)

131 
»t
 = 
	`usb_cÚŒŞ_msg
(
dev
, 
USB_ENDPOINT_IN
, 
USB_REQ_GET_DESCRIPTOR
, (
USB_DT_STRING
 << 8è+ 
šdex
,

132 0x409, 
tbuf
, Ñbuf), 
LIBUSB_CONTROL_REQ_TIMEOUT
);

133 ià(
»t
==0)

136 
	`BUG
("get_string_descriptor zero„esult,„etrying...");

142 ià(
»t
 < 0)

144 
	`BUG
("uÇbË g‘_¡ršg_desütÜ %d: %m\n", 
»t
);

145  
»t
;

148 ià(
tbuf
[1] !ğ
USB_DT_STRING
)

150 
	`BUG
("šv®id g‘_¡ršg_desütÜag‡ù=%dƒxp=%d\n", 
tbuf
[1], 
USB_DT_STRING
);

151  -
EIO
;

154 ià(
tbuf
[0] > 
»t
)

156 
	`BUG
("šv®id g‘_¡ršg_desütÜ sizaù=%dƒxp=%d\n", 
tbuf
[0], 
»t
);

157  -
EFBIG
;

160 
di
 = 0, 
si
 = 2; s˜< 
tbuf
[0]; si += 2)

162 ià(
di
 >ğ(
buæ’
 - 1))

165 ià(
tbuf
[
si
 + 1])

166 
buf
[
di
++] = '0';

168 
buf
[
di
++] = 
tbuf
[
si
];

171 
buf
[
di
] = 0;

173  
di
;

174 
	}
}

177 
	$is_š‹rçû
(
usb_deviû
 *
dev
, 
dşass
)

179 
usb_š‹rçû_desütÜ
 *
pi
;

180 
i
, 
j
, 
k
;

182 
i
=0; i<
dev
->
desütÜ
.
bNumCÚfigu¿tiÚs
; i++)

184 
j
=0; j<
dev
->
cÚfig
[
i
].
bNumIÁ”çûs
; j++)

186 
k
=0; k<
dev
->
cÚfig
[
i
].
š‹rçû
[
j
].
num_®t£‰šg
; k++)

188 
pi
 = &
dev
->
cÚfig
[
i
].
š‹rçû
[
j
].
®t£‰šg
[
k
];

189 ià(
pi
->
bIÁ”çûCÏss
 =ğ
dşass
)

197 
	}
}

201 
	$is_´š‹r
(
usb_deviû
 *
dev
)

203 
usb_š‹rçû_desütÜ
 *
pi
;

204 
i
, 
j
, 
k
;

206 
i
=0; i<
dev
->
desütÜ
.
bNumCÚfigu¿tiÚs
; i++)

208 
j
=0; j<
dev
->
cÚfig
[
i
].
bNumIÁ”çûs
; j++)

210 
k
=0; k<
dev
->
cÚfig
[
i
].
š‹rçû
[
j
].
num_®t£‰šg
; k++)

212 
pi
 = &
dev
->
cÚfig
[
i
].
š‹rçû
[
j
].
®t£‰šg
[
k
];

213 ià(
pi
->
bIÁ”çûCÏss
 =ğ0x07 &&…i->
bIÁ”çûPrÙocŞ
 == 0x02)

221 
	}
}

224 
	$wr™e_eı_chªÃl
(
fe_desütÜ
 *
pfd
, 
v®ue
)

226 
usb_dev_hªdË
 *
hd
;

227 
š‹rçû
 = 
pfd
->interface;

228 
Ën
, 
¡©
=1;

229 
by‹
;

231 ià(
pfd
->
hd
 =ğ
NULL
)

233 
	`BUG
("invalid write_ecp_channel state\n");

234 
bugout
;

237 
hd
 = 
pfd
->hd;

239 
Ën
 = 
	`usb_cÚŒŞ_msg
(
hd
,

240 
USB_ENDPOINT_IN
 | 
USB_TYPE_VENDOR
 | 
USB_RECIP_INTERFACE
,

241 
USB_REQ_GET_STATUS
,

242 
v®ue
,

243 
š‹rçû
,

244 &
by‹
, 1, 
LIBUSB_CONTROL_REQ_TIMEOUT
);

246 ià(
Ën
 != 1)

248 
	`BUG
("invalid write_ecp_channel: %m\n");

249 
bugout
;

252 
¡©
 = 0;

254 
bugout
:

255  
¡©
;

256 
	}
}

259 
	$bridge_ch_up
(
fe_desütÜ
 *
pfd
)

261 
usb_dev_hªdË
 *
hd
;

262 
Ën
, 
¡©
=1;

263 
buf
[9];

264 
nuÎBy‹
=0;

266 ià(
pfd
->
hd
 =ğ
NULL
)

268 
	`BUG
("invalid bridge_chip_up state\n");

269 
bugout
;

272 
hd
 = 
pfd
->hd;

274 
	`mem£t
(
buf
, 0, (buf));

277 
Ën
 = 
	`usb_cÚŒŞ_msg
(
hd
,

278 
USB_ENDPOINT_IN
 | 
USB_TYPE_VENDOR
 | 
USB_RECIP_DEVICE
,

279 
USB_REQ_SET_FEATURE
,

282 
buf
, (buf), 
LIBUSB_CONTROL_REQ_TIMEOUT
);

283 ià(
Ën
 < 0)

285 
	`BUG
("invalid write_bridge_up: %m\n");

286 
bugout
;

290 ià(
buf
[
ECRR
] != 0x43)

293 
Ën
 = 
	`usb_cÚŒŞ_msg
(
hd
,

294 
USB_ENDPOINT_OUT
 | 
USB_TYPE_VENDOR
 | 
USB_RECIP_DEVICE
,

298 
NULL
, 0, 
LIBUSB_CONTROL_REQ_TIMEOUT
);

300 
Ën
 = 
	`usb_cÚŒŞ_msg
(
hd
,

301 
USB_ENDPOINT_OUT
 | 
USB_TYPE_VENDOR
 | 
USB_RECIP_DEVICE
,

305 
NULL
, 0, 
LIBUSB_CONTROL_REQ_TIMEOUT
);

307 
Ën
 = 
	`usb_cÚŒŞ_msg
(
hd
,

308 
USB_ENDPOINT_OUT
 | 
USB_TYPE_VENDOR
 | 
USB_RECIP_DEVICE
,

312 
NULL
, 0, 
LIBUSB_CONTROL_REQ_TIMEOUT
);

314 
Ën
 = 
	`usb_cÚŒŞ_msg
(
hd
,

315 
USB_ENDPOINT_OUT
 | 
USB_TYPE_VENDOR
 | 
USB_RECIP_DEVICE
,

319 
NULL
, 0, 
LIBUSB_CONTROL_REQ_TIMEOUT
);

321 
Ën
 = 
	`usb_cÚŒŞ_msg
(
hd
,

322 
USB_ENDPOINT_IN
 | 
USB_TYPE_VENDOR
 | 
USB_RECIP_DEVICE
,

323 
USB_REQ_SET_FEATURE
,

326 
buf
, (buf), 
LIBUSB_CONTROL_REQ_TIMEOUT
);

327 ià(
buf
[
ECRR
] != 0x43)

329 
	`BUG
("šv®id‡utØeı modmode=%d\n", 
buf
[
ECRR
]);

334 
Ën
 = 
	`usb_cÚŒŞ_msg
(
hd
,

335 
USB_ENDPOINT_OUT
 | 
USB_TYPE_VENDOR
 | 
USB_RECIP_DEVICE
,

339 
NULL
, 0, 
LIBUSB_CONTROL_REQ_TIMEOUT
);

340 
	`musb_wr™e
(
pfd
->
fd
, &
nuÎBy‹
, 1, 
HPMUD_EXCEPTION_TIMEOUT
);

343 
Ën
 = 
	`usb_cÚŒŞ_msg
(
hd
,

344 
USB_ENDPOINT_OUT
 | 
USB_TYPE_VENDOR
 | 
USB_RECIP_DEVICE
,

348 
NULL
, 0, 
LIBUSB_CONTROL_REQ_TIMEOUT
);

350 
¡©
 = 0;

352 
bugout
:

353  
¡©
;

354 
	}
}

357 
	$bridge_ch_down
(
fe_desütÜ
 *
pfd
)

359 
usb_dev_hªdË
 *
hd
;

360 
Ën
, 
¡©
=1;

362 ià(
pfd
->
hd
 =ğ
NULL
)

364 
	`BUG
("invalid bridge_chip_down state\n");

365 
bugout
;

368 
hd
 = 
pfd
->hd;

370 
Ën
 = 
	`usb_cÚŒŞ_msg
(
hd
,

371 
USB_ENDPOINT_OUT
 | 
USB_TYPE_VENDOR
 | 
USB_RECIP_DEVICE
,

375 
NULL
, 0, 
LIBUSB_CONTROL_REQ_TIMEOUT
);

376 ià(
Ën
 < 0)

378 
	`BUG
("invalid write_bridge_up: %m\n");

379 
bugout
;

382 
¡©
 = 0;

384 
bugout
:

385  
¡©
;

386 
	}
}

389 
	$wr™e_phÛnix_£tup
(
fe_desütÜ
 *
pfd
)

391 
usb_dev_hªdË
 *
hd
;

392 
Ën
, 
¡©
=1;

394 ià(
pfd
->
hd
 =ğ
NULL
)

396 
	`BUG
("invalid write_phoenix_setup state\n");

397 
bugout
;

400 
hd
 = 
pfd
->hd;

402 
Ën
 = 
	`usb_cÚŒŞ_msg
(
hd
,

403 
USB_ENDPOINT_OUT
 | 
USB_TYPE_CLASS
 | 
USB_RECIP_OTHER
,

407 
NULL
, 0, 
LIBUSB_CONTROL_REQ_TIMEOUT
);

409 ià(
Ën
 < 0)

411 
	`BUG
("invalid write_phoenix_setup: %m\n");

412 
bugout
;

415 
¡©
 = 0;

417 
bugout
:

418  
¡©
;

419 
	}
}

422 
	$d‘ach
(
usb_dev_hªdË
 *
hd
, 
š‹rçû
)

424 
driv”
[32];

426 
driv”
[0] = 0;

428 #ifdeà
LIBUSB_HAS_DETACH_KERNEL_DRIVER_NP


430 
	`usb_g‘_driv”_Å
(
hd
, 
š‹rçû
, 
driv”
, (driver));

431 ià((
driv”
[0] !ğ0è&& (
	`¡rÿ£cmp
(driver, "usbfs") != 0))

433 
	`DBG
("»movšg % driv” iÁ”çû=%d\n", 
driv”
, 
š‹rçû
);

434 ià(
	`usb_d‘ach_k”Ãl_driv”_Å
(
hd
, 
š‹rçû
) < 0)

435 
	`BUG
("could‚Ù„emov% driv” iÁ”çû=%d: %m\n", 
driv”
, 
š‹rçû
);

440 
	}
}

443 
	$g‘_š‹rçû
(
usb_deviû
 *
dev
, 
FD_ID
 
šdex
, 
fe_desütÜ
 *
pfd
)

445 
usb_š‹rçû_desütÜ
 *
pi
;

446 
i
, 
j
, 
k
;

448 
i
=0; i<
dev
->
desütÜ
.
bNumCÚfigu¿tiÚs
; i++)

450 ià(
dev
->
cÚfig
 =ğ
NULL
)

451 
bugout
;

453 
j
=0; j<
dev
->
cÚfig
[
i
].
bNumIÁ”çûs
; j++)

455 ià(
dev
->
cÚfig
[
i
].
š‹rçû
 =ğ
NULL
)

456 
bugout
;

458 
k
=0; k<
dev
->
cÚfig
[
i
].
š‹rçû
[
j
].
num_®t£‰šg
; k++)

460 ià(
dev
->
cÚfig
[
i
].
š‹rçû
[
j
].
®t£‰šg
 =ğ
NULL
)

461 
bugout
;

463 
pi
 = &
dev
->
cÚfig
[
i
].
š‹rçû
[
j
].
®t£‰šg
[
k
];

464 ià(
pi
->
bIÁ”çûCÏss
 =ğ
fd_şass
[
šdex
] &&…i->
bIÁ”çûSubCÏss
 =ğ
fd_subşass
[šdex] &&…i->
bIÁ”çûPrÙocŞ
 =ğ
fd_´ÙocŞ
[index])

466 
pfd
->
cÚfig
=
i
;

467 
pfd
->
š‹rçû
=
j
;

468 
pfd
->
®t_£‰šg
=
k
;

469 
pfd
->
fd
=
šdex
;

476 
bugout
:

478 
	}
}

481 
	$g‘_out_•
(
usb_deviû
 *
dev
, 
cÚfig
, 
š‹rçû
, 
®t£t
, 
ty³
)

483 
usb_š‹rçû_desütÜ
 *
pi
;

484 
i
;

486 ià(
dev
->
cÚfig
 =ğ
NULL
 || dev->cÚfig[cÚfig].
š‹rçû
 =ğNULL || dev->cÚfig[cÚfig].š‹rçû[š‹rçû].
®t£‰šg
 == NULL)

487 
bugout
;

489 
pi
 = &
dev
->
cÚfig
[cÚfig].
š‹rçû
[š‹rçû].
®t£‰šg
[
®t£t
];

490 
i
=0; i<
pi
->
bNumEndpošts
; i++)

492 ià(
pi
->
’dpošt
 =ğ
NULL
)

493 
bugout
;

494 ià(
pi
->
’dpošt
[
i
].
bmA‰ribu‹s
 =ğ
ty³
 && !Õi->’dpošt[i].
bEndpoštAdd»ss
 & 
USB_ENDPOINT_DIR_MASK
)) {

495 
	`DBG
("g‘_out_•Ñy³=%d): out=%d\n", 
ty³
, 
pi
->
’dpošt
[
i
].
bEndpoštAdd»ss
);

496  
pi
->
’dpošt
[
i
].
bEndpoštAdd»ss
;

500 
bugout
:

501 
	`DBG
("get_out_ep: ERROR!„eturning -1\n");

503 
	}
}

506 
	$g‘_š_•
(
usb_deviû
 *
dev
, 
cÚfig
, 
š‹rçû
, 
®t£t
, 
ty³
)

508 
usb_š‹rçû_desütÜ
 *
pi
;

509 
i
;

511 ià(
dev
->
cÚfig
 =ğ
NULL
 || dev->cÚfig[cÚfig].
š‹rçû
 =ğNULL || dev->cÚfig[cÚfig].š‹rçû[š‹rçû].
®t£‰šg
 == NULL)

512 
bugout
;

514 
pi
 = &
dev
->
cÚfig
[cÚfig].
š‹rçû
[š‹rçû].
®t£‰šg
[
®t£t
];

515 
i
=0; i<
pi
->
bNumEndpošts
; i++)

517 ià(
pi
->
’dpošt
 =ğ
NULL
)

518 
bugout
;

519 ià(
pi
->
’dpošt
[
i
].
bmA‰ribu‹s
 =ğ
ty³
 && (pi->’dpošt[i].
bEndpoštAdd»ss
 & 
USB_ENDPOINT_DIR_MASK
)) {

520 
	`DBG
("g‘_š_•Ñy³=%d): out=%d\n", 
ty³
, 
pi
->
’dpošt
[
i
].
bEndpoštAdd»ss
);

521  
pi
->
’dpošt
[
i
].
bEndpoštAdd»ss
;

525 
bugout
:

526 
	`DBG
("get_in_ep: ERROR!„eturning -1\n");

528 
	}
}

530 
	$şaim_š‹rçû
(
usb_deviû
 *
dev
, 
fe_desütÜ
 *
pfd
)

532 
¡©
=1;

534 ià(
pfd
->
hd
 !ğ
NULL
)

537 ià((
pfd
->
hd
 = 
	`usb_İ’
(
dev
)è=ğ
NULL
)

539 
	`BUG
("invalid usb_open: %m\n");

540 
bugout
;

543 
	`d‘ach
(
pfd
->
hd
,…fd->
š‹rçû
);

546 ià(
	`usb_£t_cÚfigu¿tiÚ
(
FD
[
fd
].
pHD
, 
dev
->
cÚfig
[cÚfig].
bCÚfigu¿tiÚV®ue
))

547 
bugout
;

550 ià(
	`usb_şaim_š‹rçû
(
pfd
->
hd
,…fd->
š‹rçû
))

552 
	`usb_şo£
(
pfd
->
hd
);

553 
pfd
->
hd
 = 
NULL
;

554 
	`DBG
("šv®id cÏim_š‹rçû %s: %m\n", 
fd_Çme
[
pfd
->
fd
]);

555 
bugout
;

558 ià(
	`usb_£t_®tš‹rçû
(
pfd
->
hd
,…fd->
®t_£‰šg
))

560 
	`usb_»Ëa£_š‹rçû
(
pfd
->
hd
,…fd->
š‹rçû
);

561 
	`usb_şo£
(
pfd
->
hd
);

562 
pfd
->
hd
 = 
NULL
;

563 
	`BUG
("šv®id s‘_®tš‹rçû % ®t£t=%d: %m\n", 
fd_Çme
[
pfd
->
fd
],…fd->
®t_£‰šg
);

564 
bugout
;

567 
pfd
->
wr™e_aùive
=0;

568 
	`±h»ad_mu‹x_š™
(&
pfd
->
mu‹x
, 
NULL
);

569 
	`±h»ad_cÚd_š™
(&
pfd
->
wr™e_dÚe_cÚd
, 
NULL
);

571 
	`DBG
("şaimed % š‹rçû\n", 
fd_Çme
[
pfd
->
fd
]);

573 
¡©
=0;

575 
bugout
:

576  
¡©
;

577 
	}
}

579 
	$»Ëa£_š‹rçû
(
fe_desütÜ
 *
pfd
)

581 ià(
pfd
->
hd
 =ğ
NULL
)

584 ià(
pfd
->
wr™e_aùive
)

586 
	`BUG
("abÜtšg out¡ªdšg % wr™e\n", 
fd_Çme
[
pfd
->
fd
]);

587 
	`±h»ad_ÿnûl
(
pfd
->
tid
);

588 
pfd
->
wr™e_aùive
 = 0;

591 
	`usb_»Ëa£_š‹rçû
(
pfd
->
hd
,…fd->
š‹rçû
);

592 
	`usb_şo£
(
pfd
->
hd
);

593 
pfd
->
hd
 = 
NULL
;

594 
	`±h»ad_mu‹x_de¡roy
(&
pfd
->
mu‹x
);

595 
	`±h»ad_cÚd_de¡roy
(&
pfd
->
wr™e_dÚe_cÚd
);

597 
	`DBG
("»Ëa£d % š‹rçû\n", 
fd_Çme
[
pfd
->
fd
]);

600 
	}
}

603 
	$şaim_id_š‹rçû
(
usb_deviû
 *
dev
)

605 
FD_ID
 
i
;

607 
i
=
FD_7_1_2
; i!=
MAX_FD
; i++)

609 ià(
	`g‘_š‹rçû
(
dev
, 
i
, &
fd_bË
[i]) == 0)

611 ià(
	`şaim_š‹rçû
(
libusb_deviû
, &
fd_bË
[
i
]))

617  
i
;

618 
	}
}

621 
	$is_uri
(
usb_deviû
 *
dev
, cÚ¡ *
uri
)

623 
usb_dev_hªdË
 *
hd
=
NULL
;

624 
sz
[128];

625 
uriMod–
[128];

626 
uriS”Ÿl
[128];

627 
g’
[128];

628 
r
, 
¡©
=0;

630 ià((
hd
 = 
	`usb_İ’
(
dev
)è=ğ
NULL
)

632 
	`BUG
("invalid usb_open: %m\n");

633 
bugout
;

636 ià(
dev
->
desütÜ
.
idV’dÜ
 != 0x3f0)

637 
bugout
;

639 ià((
r
=
	`g‘_¡ršg_desütÜ
(
hd
, 
dev
->
desütÜ
.
iProduù
, 
sz
, (sz))) < 0)

641 
	`BUG
("šv®id…roduù id sŒšg„‘=%d\n", 
r
);

642 
bugout
;

645 
	`g’”®ize_mod–
(
sz
, 
g’
, (gen));

647 
	`hpmud_g‘_uri_mod–
(
uri
, 
uriMod–
, (uriModel));

648 ià(
	`¡rÿ£cmp
(
uriMod–
, 
g’
) != 0)

649 
bugout
;

651 ià((
r
=
	`g‘_¡ršg_desütÜ
(
hd
, 
dev
->
desütÜ
.
iS”ŸlNumb”
, 
sz
, (sz))) < 0)

653 
	`BUG
("šv®id s”ŸÈid sŒšg„‘=%d\n", 
r
);

654 
bugout
;

657 ià(
sz
[0])

658 
	`g’”®ize_£rŸl
(
sz
, 
g’
, (gen));

660 
	`¡rıy
(
g’
, "0");

662 
	`g‘_uri_£rŸl
(
uri
, 
uriS”Ÿl
, (uriSerial));

663 ià(
	`¡rcmp
(
uriS”Ÿl
, 
g’
) != 0)

664 
bugout
;

666 
¡©
 = 1;

668 
bugout
:

669 ià(
hd
 !ğ
NULL
)

670 
	`usb_şo£
(
hd
);

672  
¡©
;

673 
	}
}

676 
	$is_£rŸl
(
usb_deviû
 *
dev
, cÚ¡ *
¢
, *
mod–
, 
mod–_size
)

678 
usb_dev_hªdË
 *
hd
=
NULL
;

679 
sz
[128];

680 
g’
[128];

681 
r
, 
¡©
=0;

683 ià((
hd
 = 
	`usb_İ’
(
dev
)è=ğ
NULL
)

685 
	`BUG
("invalid usb_open: %m\n");

686 
bugout
;

689 ià(
dev
->
desütÜ
.
idV’dÜ
 != 0x3f0)

690 
bugout
;

692 ià((
r
=
	`g‘_¡ršg_desütÜ
(
hd
, 
dev
->
desütÜ
.
iS”ŸlNumb”
, 
sz
, (sz))) < 0)

694 
	`BUG
("šv®id s”ŸÈid sŒšg„‘=%d\n", 
r
);

695 
bugout
;

697 ià(
sz
[0])

698 
	`g’”®ize_£rŸl
(
sz
, 
g’
, (gen));

700 
	`¡rıy
(
g’
, "0");

702 ià(
	`¡ºcmp
(
¢
, 
g’
, (gen)) != 0)

703 
bugout
;

705 ià((
r
=
	`g‘_¡ršg_desütÜ
(
hd
, 
dev
->
desütÜ
.
iProduù
, 
sz
, (sz))) < 0)

707 
	`BUG
("šv®id…roduù id sŒšg„‘=%d\n", 
r
);

708 
bugout
;

710 
	`g’”®ize_mod–
(
sz
, 
mod–
, 
mod–_size
);

712 
¡©
 = 1;

714 
bugout
:

715 ià(
hd
 !ğ
NULL
)

716 
	`usb_şo£
(
hd
);

718  
¡©
;

719 
	}
}

721 
usb_deviû
 *
	$g‘_libusb_deviû
(cÚ¡ *
uri
)

723 
usb_bus
 *
bus
;

724 
usb_deviû
 *
dev
;

726 
bus
=
usb_bus£s
; bus; bus=bus->
Ãxt
)

727 
dev
=
bus
->
deviûs
; dev; dev=dev->
Ãxt
)

728 ià(
dev
->
desütÜ
.
idV’dÜ
 =ğ0x3f0 && 
	`is_š‹rçû
(dev, 7))

729 ià(
	`is_uri
(
dev
, 
uri
))

730  
dev
;

732  
NULL
;

733 
	}
}

735 
	$deviû_id
(
fd
, *
bufãr
, 
size
)

737 
usb_dev_hªdË
 *
hd
;

738 
cÚfig
,
š‹rçû
,
®t
;

739 
Ën
=0, 
¾’
, 
maxSize
;

741 
hd
 = 
fd_bË
[
fd
].hd;

742 
cÚfig
 = 
fd_bË
[
fd
].config;

743 
š‹rçû
 = 
fd_bË
[
fd
].interface;

744 
®t
 = 
fd_bË
[
fd
].
®t_£‰šg
;

746 ià(
hd
 =ğ
NULL
)

748 
	`BUG
("invalid device_id state\n");

749 
bugout
;

752 
maxSize
 = (
size
 > 1024) ? 1024 : size;

754 
¾’
 = 
	`usb_cÚŒŞ_msg
(
hd
,

755 
USB_ENDPOINT_IN
 | 
USB_TYPE_CLASS
 | 
USB_RECIP_INTERFACE
,

756 
USB_REQ_GET_STATUS
,

757 
cÚfig
,

758 
š‹rçû
,

759 
bufãr
, 
maxSize
, 
LIBUSB_CONTROL_REQ_TIMEOUT
);

761 ià(
¾’
 < 0)

765 
	`BUG
("šv®id deviûid wIndex=%x,„‘ryšg wIndex=%x: %m\n", 
š‹rçû
, interface << 8);

766 
¾’
 = 
	`usb_cÚŒŞ_msg
(
hd
,

767 
USB_ENDPOINT_IN
 | 
USB_TYPE_CLASS
 | 
USB_RECIP_INTERFACE
,

768 
USB_REQ_GET_STATUS
,

769 
cÚfig
,

770 
š‹rçû
 << 8,

771 
bufãr
, 
maxSize
, 
LIBUSB_CONTROL_REQ_TIMEOUT
);

772 ià(
¾’
 < 0)

774 
	`BUG
("šv®id deviûid„‘ry„‘=%d: %m\n", 
¾’
);

775 
bugout
;

778 
	`BUG
("šv®id deviûid„‘=%d: %m\n", 
¾’
);

779 
bugout
;

782 
Ën
 = 
	`Áohs
(*(*)
bufãr
);

783 ià(
Ën
 > (
size
-1))

784 
Ën
 = 
size
-1;

785 ià(
Ën
 > 2)

786 
Ën
 -= 2;

787 
	`memıy
(
bufãr
, bufãr+2, 
Ën
);

788 
bufãr
[
Ën
]=0;

789 
	`DBG
("»ad‡ùu® deviû_id sucûssfuÎy fd=%d†’=%d\n", 
fd
, 
Ën
);

791 
bugout
:

792  
Ën
;

793 
	}
}

795 
	$deviû_¡©us
(
fd
, *
¡©us
)

797 
usb_dev_hªdË
 *
hd
;

798 
š‹rçû
;

799 
Ën
, 
¡©
=1;

800 
by‹
;

802 
hd
 = 
fd_bË
[
fd
].hd;

803 
š‹rçû
 = 
fd_bË
[
fd
].interface;

805 ià(
hd
 =ğ
NULL
)

807 
	`BUG
("invalid device_status state\n");

808 
bugout
;

811 
Ën
 = 
	`usb_cÚŒŞ_msg
(
hd
,

812 
USB_ENDPOINT_IN
 | 
USB_TYPE_CLASS
 | 
USB_RECIP_INTERFACE
,

813 
USB_REQ_CLEAR_FEATURE
,

815 
š‹rçû
,

816 &
by‹
, 1, 
LIBUSB_CONTROL_REQ_TIMEOUT
);

818 ià(
Ën
 < 0)

820 
	`BUG
("invalid device_status: %m\n");

821 
bugout
;

824 *
¡©us
 = ()
by‹
;

825 
¡©
 = 0;

826 
	`DBG
("»ad‡ùu® deviû_¡©u sucûssfuÎy fd=%d\n", 
fd
);

828 
bugout
:

829  
¡©
;

830 
	}
}

833 
	$sf›ld_´š‹r_¡©e
(cÚ¡ *
id
)

835 *
pSf
;

836 
v¡©us
=0, 
v”
;

838 ià((
pSf
 = 
	`¡r¡r
(
id
, ";S:")è=ğ
NULL
)

840 
	`BUG
("invalid S-field\n");

841  
v¡©us
;

845 
pSf
+=3;

846 
v”
 = 0;

847 
	`HEX2INT
(*
pSf
, 
v”
);

848 
pSf
++;

849 
v”
 = ver << 4;

850 
	`HEX2INT
(*
pSf
, 
v”
);

851 
pSf
++;

854 
v”
)

859 
pSf
+=12;

862 
pSf
+=14;

865 
pSf
+=18;

868 
	`BUG
("unknowÀS-f›ld v”siÚ=%d\n", 
v”
);

869 
pSf
+=12;

874 
v¡©us
 = 0;

875 
	`HEX2INT
(*
pSf
, 
v¡©us
);

876 
pSf
++;

877 
v¡©us
 = vstatus << 4;

878 
	`HEX2INT
(*
pSf
, 
v¡©us
);

880  
v¡©us
;

881 
	}
}

887 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
	$pow”_up
(
mud_deviû
 *
pd
, 
fd
)

889 cÚ¡ *
pSf
;

891 ià((
pSf
 = 
	`¡r¡r
(
pd
->
id
, "CMD:LDL")è!ğ
NULL
)

894 ià((
pSf
 = 
	`¡r¡r
(
pd
->
id
, ";S:")è!ğ
NULL
)

896 ià(
	`sf›ld_´š‹r_¡©e
(
pd
->
id
) != 3)

899 ià((
pSf
 = 
	`¡r¡r
(
pd
->
id
, "VSTATUS:")è!ğ
NULL
)

902 ià(!(
	`¡r¡r
(
pSf
+8, "OFFF") || strstr(pSf+8, "PWDN") || strstr(pSf+8, "$X")))

908 (
pd
->
vf
.
wr™e
)(
fd
, 
v’iû_pow”_Ú
, (v’iû_pow”_Ú), 
HPMUD_EXCEPTION_TIMEOUT
);

909 
	`¦“p
(2);

912 
	}
}

915 
	$Ãw_chªÃl
(
mud_deviû
 *
pd
, 
šdex
, cÚ¡ *
¢
)

917 
¡©
=1;

920 ià(
pd
->
chªÃl
[
šdex
].
ş›Á_út
)

923 ià(
šdex
 =ğ
HPMUD_EWS_CHANNEL
)

925 
pd
->
chªÃl
[
šdex
].
ş›Á_út
++;

926 
¡©
 = 0;

927 
	`DBG
("»u£d % chªÃl=%d cl›ÁCÁ=%d chªÃlCÁ=%d\n", 
¢
, 
šdex
, 
pd
->
chªÃl
[šdex].
ş›Á_út
,…d->
chªÃl_út
);

931 
	`BUG
("% chªÃl=%d i busy, u£d by [%d], cl›ÁCÁ=%d chªÃlCÁ=%d\n", 
¢
, 
šdex
, 
pd
->
chªÃl
[šdex].
pid
,…d->chªÃl[šdex].
ş›Á_út
,…d->
chªÃl_út
);

932 
bugout
;

935 ià(
šdex
 =ğ
HPMUD_EWS_CHANNEL
 || index =ğ
HPMUD_EWS_LEDM_CHANNEL
 ||

936 
šdex
 =ğ
HPMUD_SOAPSCAN_CHANNEL
 || index =ğ
HPMUD_SOAPFAX_CHANNEL
 ||

937 
šdex
 =ğ
HPMUD_MARVELL_SCAN_CHANNEL
 || index =ğ
HPMUD_MARVELL_FAX_CHANNEL
 ||

938 
šdex
 =ğ
HPMUD_LEDM_SCAN_CHANNEL
 || index =ğ
HPMUD_MARVELL_EWS_CHANNEL
 ||

939 
šdex
 =ğ
HPMUD_IPP_CHANNEL
 || index =ğ
HPMUD_IPP_CHANNEL2
 || index =ğ
HPMUD_ESCL_SCAN_CHANNEL
) {

940 
pd
->
chªÃl
[
šdex
].
vf
 = 
musb_comp_chªÃl_vf
;

942 ià(
pd
->
io_mode
 =ğ
HPMUD_RAW_MODE
 ||…d->io_mod=ğ
HPMUD_UNI_MODE
) {

943 
pd
->
chªÃl
[
šdex
].
vf
 = 
musb_¿w_chªÃl_vf
;

945 ià(
pd
->
io_mode
 =ğ
HPMUD_MLC_GUSHER_MODE
 ||…d->io_mod=ğ
HPMUD_MLC_MISER_MODE
) {

946 
pd
->
chªÃl
[
šdex
].
vf
 = 
musb_mlc_chªÃl_vf
;

949 
pd
->
chªÃl
[
šdex
].
vf
 = 
musb_dÙ4_chªÃl_vf
;

952 
pd
->
chªÃl
[
šdex
].index = index;

953 
pd
->
chªÃl
[
šdex
].
ş›Á_út
 = 1;

954 
pd
->
chªÃl
[
šdex
].
sockid
 = index;

955 
pd
->
chªÃl
[
šdex
].
pid
 = 
	`g‘pid
();

956 
pd
->
chªÃl
[
šdex
].
dšdex
 =…d->index;

957 
pd
->
chªÃl
[
šdex
].
fd
 = 0;

958 
	`¡rıy
(
pd
->
chªÃl
[
šdex
].
¢
, sn);

959 
pd
->
chªÃl_út
++;

961 
¡©
 = 0;

962 
	`DBG
("Ãw % chªÃl=%d cl›ÁCÁ=%d chªÃlCÁ=%d\n", 
¢
, 
šdex
, 
pd
->
chªÃl
[šdex].
ş›Á_út
,…d->
chªÃl_út
);

964 
bugout
:

965  
¡©
;

966 
	}
}

969 
	$d–_chªÃl
(
mud_deviû
 *
pd
, 
mud_chªÃl
 *
pc
)

971 
pc
->
ş›Á_út
--;

973 ià(
pc
->
ş›Á_út
 <= 0)

975 
pd
->
chªÃl_út
--;

977 
	`DBG
("»moved % chªÃl=%d cl›ÁCÁ=%d chªÃlCÁ=%d\n", 
pc
->
¢
,…c->
šdex
,…c->
ş›Á_út
, 
pd
->
chªÃl_út
);

979 
	}
}

981 
	$wr™e_th»ad
(
fe_desütÜ
 *
pfd
)

983 
•
;

985 
	`±h»ad_d‘ach
(
	`±h»ad_£lf
());

987 ià((
•
 = 
	`g‘_out_•
(
libusb_deviû
, 
pfd
->
cÚfig
,…fd->
š‹rçû
,…fd->
®t_£‰šg
, 
USB_ENDPOINT_TYPE_BULK
)) < 0)

989 
	`BUG
("invalid bulk outƒndpoint\n");

990 
pfd
->
wr™e_»tuº
 = -
ENOTCONN
;

991 
bugout
;

995 
pfd
->
wr™e_»tuº
 = 
	`usb_bulk_wr™e
Õfd->
hd
, 
•
, (*ífd->
wr™e_buf
,…fd->
wr™e_size
, 72*3600*1000);

997 
bugout
:

998 
	`±h»ad_mu‹x_lock
(&
pfd
->
mu‹x
);

999 
pfd
->
wr™e_buf
 = 
NULL
;

1000 
	`±h»ad_cÚd_sigÇl
(&
pfd
->
wr™e_dÚe_cÚd
);

1001 
	`±h»ad_mu‹x_uÆock
(&
pfd
->
mu‹x
);

1004 
	}
}

1010 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
	$musb_wr™e
(
fd
, cÚ¡ *
buf
, 
size
, 
u£c
)

1012 
Ën
=-
EIO
;

1014 ià(
fd_bË
[
fd
].
hd
 =ğ
NULL
)

1016 
	`BUG
("invalid musb_write state\n");

1017 
bugout
;

1021 
timev®
 
now
;

1022 
time¥ec
 
timeout
;

1023 
»t
;

1025 ià(!
fd_bË
[
fd
].
wr™e_aùive
)

1027 
fd_bË
[
fd
].
wr™e_aùive
 = 1;

1028 
fd_bË
[
fd
].
wr™e_buf
 = 
buf
;

1029 
fd_bË
[
fd
].
wr™e_size
 = 
size
;

1032 ià(
	`±h»ad_ü—‹
(&
fd_bË
[
fd
].
tid
, 
NULL
, (*(*)(*))
wr™e_th»ad
, (*)&fd_table[fd]) != 0)

1034 
	`BUG
("unableo creat write_thread: %m\n");

1035 
bugout
;

1040 
	`±h»ad_mu‹x_lock
(&
fd_bË
[
fd
].
mu‹x
);

1041 
	`g‘timeofday
(&
now
, 
NULL
);

1042 
now
.
tv_u£c
 +ğ
u£c
;

1043 
now
.
tv_£c
 +ğnow.
tv_u£c
 / 1000000;

1044 
now
.
tv_u£c
 %= 1000000;

1045 
timeout
.
tv_£c
 = 
now
.tv_sec;

1046 
timeout
.
tv_n£c
 = 
now
.
tv_u£c
 * 1000;

1047 
»t
 = 0;

1048 
fd_bË
[
fd
].
wr™e_buf
 && 
»t
 !ğ
ETIMEDOUT
)

1050 
»t
 = 
	`±h»ad_cÚd_timedwa™
(&
fd_bË
[
fd
].
wr™e_dÚe_cÚd
, &fd_bË[fd].
mu‹x
, &
timeout
);

1052 
	`±h»ad_mu‹x_uÆock
(&
fd_bË
[
fd
].
mu‹x
);

1054 ià(
»t
 =ğ
ETIMEDOUT
)

1056 
Ën
 = -
ETIMEDOUT
;

1057 
bugout
;

1060 
fd_bË
[
fd
].
wr™e_aùive
 = 0;

1062 
Ën
 = 
fd_bË
[
fd
].
wr™e_»tuº
;

1064 
•
;

1065 ià((
•
 = 
	`g‘_out_•
(
libusb_deviû
, 
fd_bË
[
fd
].
cÚfig
, fd_bË[fd].
š‹rçû
, fd_bË[fd].
®t_£‰šg
, 
USB_ENDPOINT_TYPE_BULK
)) < 0)

1067 
	`BUG
("invalid bulk outƒndpoint\n");

1068 
bugout
;

1071 
Ën
 = 
	`usb_bulk_wr™e
(
fd_bË
[
fd
].
hd
, 
•
, (*)
buf
, 
size
, 
u£c
);

1074 ià(
Ën
 < 0)

1076 
	`BUG
("bulk_wr™çed buf=%°size=%d†’=%d: %m\n", 
buf
, 
size
, 
Ën
);

1077 
bugout
;

1080 
	`DBG
("wr™fd=%d†’=%d size=%d u£c=%d\n", 
fd
, 
Ën
, 
size
, 
u£c
);

1081 
	`DBG_DUMP
(
buf
, 
Ën
 < 512 ?†en : 512);

1083 
bugout
:

1084  
Ën
;

1085 
	}
}

1087 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
	$musb_»ad
(
fd
, *
buf
, 
size
, 
u£c
)

1089 
timev®
 
t1
, 
t2
;

1090 
tÙ®_u£c
, 
tmo_u£c
=
u£c
;

1091 
Ën
=-
EIO
, 
•
;

1093 ià(
fd_bË
[
fd
].
hd
 =ğ
NULL
)

1095 
	`BUG
("invalid musb_read state\n");

1096 
bugout
;

1099 
	`g‘timeofday
 (&
t1
, 
NULL
);

1101 ià((
•
 = 
	`g‘_š_•
(
libusb_deviû
, 
fd_bË
[
fd
].
cÚfig
, fd_bË[fd].
š‹rçû
, fd_bË[fd].
®t_£‰šg
, 
USB_ENDPOINT_TYPE_BULK
)) < 0)

1103 
	`BUG
("invalid bulk inƒndpoint\n");

1104 
bugout
;

1109 
Ën
 = 
	`usb_bulk_»ad
(
fd_bË
[
fd
].
hd
, 
•
, (*)
buf
, 
size
, 
tmo_u£c
/1000);

1111 ià(
Ën
 =ğ-
ETIMEDOUT
)

1112 
bugout
;

1114 ià(
Ën
 < 0)

1116 
	`BUG
("bulk_read failed: %m\n");

1117 
bugout
;

1120 ià(
Ën
 == 0)

1123 
	`g‘timeofday
(&
t2
, 
NULL
);

1125 
tÙ®_u£c
 = (
t2
.
tv_£c
 - 
t1
.tv_sec)*1000000;

1126 
tÙ®_u£c
 +ğ(
t2
.
tv_u£c
 > 
t1
.tv_usec) ?2.tv_usec -1.tv_usec :1.tv_usec -2.tv_usec;

1127 ià(
tÙ®_u£c
 > 
u£c
)

1129 
Ën
 = -
ETIMEDOUT
;

1130 
bugout
;

1132 
tmo_u£c
 = 
u£c
 - 
tÙ®_u£c
;

1139 
	`DBG
("»ad fd=%d†’=%d size=%d u£c=%d\n", 
fd
, 
Ën
, 
size
, 
u£c
);

1140 
	`DBG_DUMP
(
buf
, 
Ën
 < 32 ?†en : 32);

1142 
bugout
:

1143  
Ën
;

1144 
	}
}

1146 
HPMUD_RESULT
 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
	$musb_İ’
(
mud_deviû
 *
pd
)

1148 
Ën
=0, 
fd
=0;

1149 
HPMUD_RESULT
 
¡©
 = 
HPMUD_R_IO_ERROR
;

1151 
	`usb_š™
();

1152 
	`usb_fšd_bus£s
();

1153 
	`usb_fšd_deviûs
();

1156 ià((
libusb_deviû
 = 
	`g‘_libusb_deviû
(
pd
->
uri
)è=ğ
NULL
)

1158 
	`BUG
("uÇbËØİ’ %s\n", 
pd
->
uri
);

1159 
bugout
;

1162 
	`±h»ad_mu‹x_lock
(&
pd
->
mu‹x
);

1164 ià(
pd
->
id
[0] == 0)

1168 ià((
fd
 = 
	`şaim_id_š‹rçû
(
libusb_deviû
)è=ğ
MAX_FD
)

1170 
¡©
 = 
HPMUD_R_DEVICE_BUSY
;

1171 
bÏckout
;

1174 
Ën
 = 
	`deviû_id
(
fd
, 
pd
->
id
, (pd->id));

1176 ià(
Ën
 > 0 && 
	`is_hp
(
pd
->
id
))

1177 
	`pow”_up
(
pd
, 
fd
);

1179 
	`»Ëa£_š‹rçû
(&
fd_bË
[
fd
]);

1181 ià(
Ën
 == 0)

1182 
bÏckout
;

1184 
pd
->
İ’_fd
 = 
fd
;

1187 
¡©
 = 
HPMUD_R_OK
;

1189 
bÏckout
:

1190 
	`±h»ad_mu‹x_uÆock
(&
pd
->
mu‹x
);

1192 
bugout
:

1193  
¡©
;

1194 
	}
}

1196 
HPMUD_RESULT
 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
	$musb_şo£
(
mud_deviû
 *
pd
)

1198 
i
;

1199 
HPMUD_RESULT
 
¡©
 = 
HPMUD_R_OK
;

1201 
	`±h»ad_mu‹x_lock
(&
pd
->
mu‹x
);

1203 
i
=1; i<
MAX_FD
; i++)

1205 ià(
fd_bË
[
i
].
hd
 !ğ
NULL
)

1206 
	`»Ëa£_š‹rçû
(&
fd_bË
[
i
]);

1209 
pd
->
id
[0] = 0;

1211 
	`±h»ad_mu‹x_uÆock
(&
pd
->
mu‹x
);

1213  
¡©
;

1214 
	}
}

1216 
HPMUD_RESULT
 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
	$musb_g‘_deviû_id
(
mud_deviû
 *
pd
, *
buf
, 
size
, *
Ën
)

1218 
i
, 
fd
=
FD_NA
;

1219 
HPMUD_RESULT
 
¡©
 = 
HPMUD_R_DEVICE_BUSY
;

1221 *
Ën
=0;

1223 
	`±h»ad_mu‹x_lock
(&
pd
->
mu‹x
);

1225 ià(
pd
->
io_mode
 =ğ
HPMUD_DOT4_BRIDGE_MODE
 ||…d->io_mod=ğ
HPMUD_UNI_MODE
)

1227 *
Ën
 = 
	`¡¾’
(
pd
->
id
);

1232 
i
=1; i<
MAX_FD
; i++)

1234 ià(
fd_bË
[
i
].
hd
 !ğ
NULL
)

1236 
fd
 = 
i
;

1241 ià(
fd
 =ğ
FD_NA
)

1244 ià((
fd
 = 
	`şaim_id_š‹rçû
(
libusb_deviû
)è!ğ
MAX_FD
)

1246 *
Ën
 = 
	`deviû_id
(
fd
, 
pd
->
id
, (pd->id));

1247 
	`»Ëa£_š‹rçû
(&
fd_bË
[
fd
]);

1252 *
Ën
 = 
	`¡¾’
(
pd
->
id
);

1258 *
Ën
 = 
	`deviû_id
(
fd
, 
pd
->
id
, (pd->id));

1262 ià(*
Ën
)

1264 
	`memıy
(
buf
, 
pd
->
id
, *
Ën
 > 
size
 ? size : *len);

1265 
¡©
 = 
HPMUD_R_OK
;

1268 
	`±h»ad_mu‹x_uÆock
(&
pd
->
mu‹x
);

1269  
¡©
;

1270 
	}
}

1272 
HPMUD_RESULT
 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
	$musb_g‘_deviû_¡©us
(
mud_deviû
 *
pd
, *
¡©us
)

1274 
i
, 
fd
=
FD_NA
;

1275 
HPMUD_RESULT
 
¡©
 = 
HPMUD_R_DEVICE_BUSY
;

1276 
r
=1;

1278 
	`±h»ad_mu‹x_lock
(&
pd
->
mu‹x
);

1280 ià(
pd
->
io_mode
 =ğ
HPMUD_DOT4_BRIDGE_MODE
 ||…d->io_mod=ğ
HPMUD_UNI_MODE
)

1281 *
¡©us
 = 
NFAULT_BIT
;

1285 
i
=1; i<
MAX_FD
; i++)

1287 ià(
fd_bË
[
i
].
hd
 !ğ
NULL
)

1289 
fd
 = 
i
;

1294 ià(
fd
 =ğ
FD_NA
)

1297 ià((
fd
 = 
	`şaim_id_š‹rçû
(
libusb_deviû
)è!ğ
MAX_FD
)

1299 
r
 = 
	`deviû_¡©us
(
fd
, 
¡©us
);

1300 
	`»Ëa£_š‹rçû
(&
fd_bË
[
fd
]);

1306 
r
 = 
	`deviû_¡©us
(
fd
, 
¡©us
);

1310 
	`±h»ad_mu‹x_uÆock
(&
pd
->
mu‹x
);

1312 ià(
r
 != 0)

1313 
bugout
;

1315 
¡©
 = 
HPMUD_R_OK
;

1317 
bugout
:

1318  
¡©
;

1319 
	}
}

1321 
HPMUD_RESULT
 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
	$musb_chªÃl_wr™e
(
mud_deviû
 *
pd
, 
mud_chªÃl
 *
pc
, cÚ¡ *
buf
, 
Ëngth
, 
£c_timeout
, *
by‹s_wrÙe
)

1323 
HPMUD_RESULT
 
¡©
;

1325 
	`±h»ad_mu‹x_lock
(&
pd
->
mu‹x
);

1326 
¡©
 = (
pc
->
vf
.
chªÃl_wr™e
)Õc, 
buf
, 
Ëngth
, 
£c_timeout
, 
by‹s_wrÙe
);

1327 
	`±h»ad_mu‹x_uÆock
(&
pd
->
mu‹x
);

1328  
¡©
;

1329 
	}
}

1331 
HPMUD_RESULT
 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
	$musb_chªÃl_»ad
(
mud_deviû
 *
pd
, 
mud_chªÃl
 *
pc
, *
buf
, 
Ëngth
, 
£c_timeout
, *
by‹s_»ad
)

1333 
HPMUD_RESULT
 
¡©
;

1335 ià(
pd
->
io_mode
 =ğ
HPMUD_UNI_MODE
)

1337 
¡©
 = 
HPMUD_R_INVALID_STATE
;

1338 
	`BUG
("šv®id chªÃl_»ad io_mode=%d\n", 
pd
->
io_mode
);

1339 
bugout
;

1342 
	`±h»ad_mu‹x_lock
(&
pd
->
mu‹x
);

1343 
¡©
 = (
pc
->
vf
.
chªÃl_»ad
)Õc, 
buf
, 
Ëngth
, 
£c_timeout
, 
by‹s_»ad
);

1344 
	`±h»ad_mu‹x_uÆock
(&
pd
->
mu‹x
);

1346 
bugout
:

1347  
¡©
;

1348 
	}
}

1350 
HPMUD_RESULT
 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
	$musb_chªÃl_İ’
(
mud_deviû
 *
pd
, cÚ¡ *
¢
, 
HPMUD_CHANNEL
 *
cd
)

1352 
šdex
;

1353 
HPMUD_RESULT
 
¡©
;

1356 ià((
¡©
 = 
	`£rviû_to_chªÃl
(
pd
, 
¢
, &
šdex
)è!ğ
HPMUD_R_OK
)

1357 
bugout
;

1359 
	`±h»ad_mu‹x_lock
(&
pd
->
mu‹x
);

1361 ià(
	`Ãw_chªÃl
(
pd
, 
šdex
, 
¢
))

1363 
¡©
 = 
HPMUD_R_DEVICE_BUSY
;

1367 ià((
¡©
 = (
pd
->
chªÃl
[
šdex
].
vf
.
İ’
)(&pd->chªÃl[šdex])è!ğ
HPMUD_R_OK
)

1368 
	`d–_chªÃl
(
pd
, &pd->
chªÃl
[
šdex
]);

1370 *
cd
 = 
šdex
;

1373 
	`±h»ad_mu‹x_uÆock
(&
pd
->
mu‹x
);

1375 
bugout
:

1376  
¡©
;

1377 
	}
}

1379 
HPMUD_RESULT
 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
	$musb_chªÃl_şo£
(
mud_deviû
 *
pd
, 
mud_chªÃl
 *
pc
)

1381 
HPMUD_RESULT
 
¡©
 = 
HPMUD_R_OK
;

1383 
	`±h»ad_mu‹x_lock
(&
pd
->
mu‹x
);

1384 
¡©
 = (
pc
->
vf
.
şo£
)(pc);

1385 
	`d–_chªÃl
(
pd
, 
pc
);

1386 
	`±h»ad_mu‹x_uÆock
(&
pd
->
mu‹x
);

1388  
¡©
;

1389 
	}
}

1395 
HPMUD_RESULT
 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
	$musb_¿w_chªÃl_İ’
(
mud_chªÃl
 *
pc
)

1397 
fd
 = 
FD_7_1_2
;

1398 
HPMUD_RESULT
 
¡©
 = 
HPMUD_R_DEVICE_BUSY
;

1400 
	`g‘_š‹rçû
(
libusb_deviû
, 
fd
, &
fd_bË
[fd]);

1402 ià(
	`şaim_š‹rçû
(
libusb_deviû
, &
fd_bË
[
fd
]))

1403 
bugout
;

1405 
pc
->
fd
 = fd;

1407 
¡©
 = 
HPMUD_R_OK
;

1409 
bugout
:

1410  
¡©
;

1411 
	}
}

1413 
HPMUD_RESULT
 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
	$musb_¿w_chªÃl_şo£
(
mud_chªÃl
 *
pc
)

1415 
fd
 = 
pc
->fd;

1418 
•
 = -1;

1419 ià(Ğ
•
 = 
	`g‘_š_•
(
libusb_deviû
, 
fd_bË
[
fd
].
cÚfig
, fd_bË[fd].
š‹rçû
, fd_bË[fd].
®t_£‰šg
, 
USB_ENDPOINT_TYPE_BULK
)) >= 0)

1421 
	`usb_ş—r_h®t
(
fd_bË
[
fd
].
hd
, 
•
);

1424 ià(Ğ
•
 = 
	`g‘_out_•
(
libusb_deviû
, 
fd_bË
[
fd
].
cÚfig
, fd_bË[fd].
š‹rçû
, fd_bË[fd].
®t_£‰šg
, 
USB_ENDPOINT_TYPE_BULK
)) >= 0)

1426 
	`usb_ş—r_h®t
(
fd_bË
[
fd
].
hd
, 
•
);

1429 
	`»Ëa£_š‹rçû
(&
fd_bË
[
fd
]);

1431 
pc
->
fd
 = 0;

1433  
HPMUD_R_OK
;

1434 
	}
}

1436 
HPMUD_RESULT
 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
	$musb_¿w_chªÃl_wr™e
(
mud_chªÃl
 *
pc
, cÚ¡ *
buf
, 
Ëngth
, 
£c_timeout
, *
by‹s_wrÙe
)

1438 
Ën
, 
size
, 
tÙ®
=0;

1439 
HPMUD_RESULT
 
¡©
 = 
HPMUD_R_IO_ERROR
;

1441 *
by‹s_wrÙe
=0;

1442 
size
 = 
Ëngth
;

1444 
size
 > 0)

1446 
Ën
 = (
m¥
->
deviû
[
pc
->
dšdex
].
vf
.
wr™e
)Õc->
fd
, 
buf
+
tÙ®
, 
size
, 
£c_timeout
*1000000);

1447 ià(
Ën
 < 0)

1449 ià(
Ën
 =ğ-
ETIMEDOUT
)

1451 
¡©
 = 
HPMUD_R_IO_TIMEOUT
;

1452 ià(
£c_timeout
 >ğ
HPMUD_EXCEPTION_SEC_TIMEOUT
)

1453 
	`BUG
("uÇbËØwr™d©¨%s: %d secÚd iØtimeout\n", 
m¥
->
deviû
[
pc
->
dšdex
].
uri
, 
£c_timeout
);

1456 
	`BUG
("uÇbËØwr™d©¨% Ö’ = %d): %m\n", 
m¥
->
deviû
[
pc
->
dšdex
].
uri
, 
Ën
);

1457 
bugout
;

1459 
size
-=
Ën
;

1460 
tÙ®
+=
Ën
;

1461 *
by‹s_wrÙe
+=
Ën
;

1464 
¡©
 = 
HPMUD_R_OK
;

1466 
bugout
:

1467  
¡©
;

1468 
	}
}

1474 
HPMUD_RESULT
 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
	$musb_¿w_chªÃl_»ad
(
mud_chªÃl
 *
pc
, *
buf
, 
Ëngth
, 
£c_timeout
, *
by‹s_»ad
)

1476 
Ën
=0, 
u£c
;

1477 
HPMUD_RESULT
 
¡©
 = 
HPMUD_R_IO_ERROR
;

1479 *
by‹s_»ad
 = 0;

1481 ià(
£c_timeout
==0)

1482 
u£c
 = 1000;

1484 
u£c
 = 
£c_timeout
*1000000;

1486 
Ën
 = (
m¥
->
deviû
[
pc
->
dšdex
].
vf
.
»ad
)Õc->
fd
, 
buf
, 
Ëngth
, 
u£c
);

1487 ià(
Ën
 < 0)

1489 ià(
Ën
 =ğ-
ETIMEDOUT
)

1491 
¡©
 = 
HPMUD_R_IO_TIMEOUT
;

1492 ià(
£c_timeout
 >ğ
HPMUD_EXCEPTION_SEC_TIMEOUT
)

1493 
	`BUG
("uÇbËØ»ad d©¨%s: %d secÚd iØtimeout\n", 
m¥
->
deviû
[
pc
->
dšdex
].
uri
, 
£c_timeout
);

1496 
	`BUG
("uÇbËØ»ad d©¨%s: %m\n", 
m¥
->
deviû
[
pc
->
dšdex
].
uri
);

1497 
bugout
;

1500 *
by‹s_»ad
 = 
Ën
;

1501 
¡©
 = 
HPMUD_R_OK
;

1503 
bugout
:

1504  
¡©
;

1505 
	}
}

1511 
HPMUD_RESULT
 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
	$musb_comp_chªÃl_İ’
(
mud_chªÃl
 *
pc
)

1513 
fd
;

1514 
HPMUD_RESULT
 
¡©
 = 
HPMUD_R_DEVICE_BUSY
;

1517 
pc
->
šdex
)

1519 
HPMUD_EWS_CHANNEL
:

1520 
fd
 = 
FD_ff_1_1
;

1522 
HPMUD_EWS_LEDM_CHANNEL
:

1523 
fd
 = 
FD_ff_4_1
;

1525 
HPMUD_SOAPSCAN_CHANNEL
:

1526 
fd
 = 
FD_ff_2_1
;

1528 
HPMUD_SOAPFAX_CHANNEL
:

1529 
fd
 = 
FD_ff_3_1
;

1531 
HPMUD_MARVELL_SCAN_CHANNEL
:

1532 
fd
 = 
FD_ff_ff_ff
;

1534 
HPMUD_MARVELL_FAX_CHANNEL
:

1535 
fd
 = 
FD_ff_1_0
;

1537 
HPMUD_LEDM_SCAN_CHANNEL
:

1538 
HPMUD_ESCL_SCAN_CHANNEL
:

1539 
fd
 = 
FD_ff_cc_0
;

1541 
HPMUD_MARVELL_EWS_CHANNEL
:

1542 
fd
 = 
FD_ff_2_10
;

1544 
HPMUD_IPP_CHANNEL
:

1545 
fd
 = 
FD_7_1_4
;

1547 
HPMUD_IPP_CHANNEL2
:

1548 
fd
 = 
FD_ff_9_1
;

1551 
¡©
 = 
HPMUD_R_INVALID_SN
;

1552 
	`BUG
("šv®id % chªÃl=%d\n", 
pc
->
¢
,…c->
šdex
);

1553 
bugout
;

1557 ià(
	`g‘_š‹rçû
(
libusb_deviû
, 
fd
, &
fd_bË
[fd]))

1559 
¡©
 = 
HPMUD_R_INVALID_SN
;

1560 
	`BUG
("šv®id % chªÃl=%d\n", 
pc
->
¢
,…c->
šdex
);

1561 
bugout
;

1564 ià(
	`şaim_š‹rçû
(
libusb_deviû
, &
fd_bË
[
fd
]))

1565 
bugout
;

1567 
pc
->
fd
 = fd;

1569 
¡©
 = 
HPMUD_R_OK
;

1571 
bugout
:

1572  
¡©
;

1573 
	}
}

1579 
HPMUD_RESULT
 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
	$musb_mlc_chªÃl_İ’
(
mud_chªÃl
 *
pc
)

1581 
mud_deviû
 *
pd
 = &
m¥
->
deviû
[
pc
->
dšdex
];

1582 
FD_ID
 
fd
;

1583 
HPMUD_RESULT
 
¡©
 = 
HPMUD_R_IO_ERROR
;

1586 ià(
pd
->
chªÃl_út
==1)

1588 ià(
	`g‘_š‹rçû
(
libusb_deviû
, 
FD_7_1_3
, &
fd_bË
[FD_7_1_3]è=ğ0 && 
	`şaim_š‹rçû
(libusb_device, &fd_table[FD_7_1_3]) == 0)

1589 
fd
 = 
FD_7_1_3
;

1590 ià(
	`g‘_š‹rçû
(
libusb_deviû
, 
FD_ff_ff_ff
, &
fd_bË
[FD_ff_ff_ff]è=ğ0 && 
	`şaim_š‹rçû
(libusb_device, &fd_table[FD_ff_ff_ff]) == 0)

1591 
fd
 = 
FD_ff_ff_ff
;

1592 ià(
	`g‘_š‹rçû
(
libusb_deviû
, 
FD_ff_d4_0
, &
fd_bË
[FD_ff_d4_0]è=ğ0 && 
	`şaim_š‹rçû
(libusb_device, &fd_table[FD_ff_d4_0]) == 0)

1593 
fd
 = 
FD_ff_d4_0
;

1594 ià(
	`g‘_š‹rçû
(
libusb_deviû
, 
FD_7_1_2
, &
fd_bË
[FD_7_1_2]è=ğ0 && 
	`şaim_š‹rçû
(libusb_device, &fd_table[FD_7_1_2]) == 0)

1595 
fd
 = 
FD_7_1_2
;

1598 
¡©
 = 
HPMUD_R_DEVICE_BUSY
;

1599 
bugout
;

1602 ià(
fd
 =ğ
FD_7_1_2
)

1605 ià(
	`wr™e_eı_chªÃl
(&
fd_bË
[
fd
], 77))

1606 
bugout
;

1609 
i
;

1612 
Ën
;

1613 
buf
[255];

1616 
i
=0,
Ën
=1;†’ > 0 && i < (
buf
); i++)

1617 
Ën
 = (
pd
->
vf
.
»ad
)(
fd
, 
buf
+
i
, 1, 0);

1621 ià(
	`MlcIn™
(
pc
, 
fd
) != 0)

1622 
bugout
;

1625 
i
=0; i<
HPMUD_CHANNEL_MAX
; i++)

1626 
	`mem£t
(&
pd
->
chªÃl
[
i
].

, 0 , (
Œª¥Üt_©Œibu‹s
));

1628 
pd
->
mlc_fd
 = 
fd
;

1629 
pd
->
mlc_up
=1;

1633 ià(
	`MlcCÚfigSock‘
(
pc
, 
pd
->
mlc_fd
))

1634 
bugout
;

1636 ià(
	`MlcO³nChªÃl
(
pc
, 
pd
->
mlc_fd
))

1637 
bugout
;

1639 
pc
->
rút
 =…c->
ršdex
 = 0;

1641 
¡©
 = 
HPMUD_R_OK
;

1643 
bugout
:

1644  
¡©
;

1645 
	}
}

1647 
HPMUD_RESULT
 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
	$musb_mlc_chªÃl_şo£
(
mud_chªÃl
 *
pc
)

1649 
mud_deviû
 *
pd
 = &
m¥
->
deviû
[
pc
->
dšdex
];

1650 
nuÎBy‹
=0;

1651 
HPMUD_RESULT
 
¡©
 = 
HPMUD_R_OK
;

1653 ià(
pd
->
mlc_up
)

1655 ià(
	`MlcClo£ChªÃl
(
pc
, 
pd
->
mlc_fd
))

1656 
¡©
 = 
HPMUD_R_IO_ERROR
;

1660 ià(
pd
->
chªÃl_út
==1)

1662 ià(
pd
->
mlc_up
)

1664 ià(
	`MlcEx™
(
pc
, 
pd
->
mlc_fd
))

1665 
¡©
 = 
HPMUD_R_IO_ERROR
;

1667 
pd
->
mlc_up
=0;

1669 ià(
pd
->
mlc_fd
 =ğ
FD_7_1_2
)

1671 
	`wr™e_eı_chªÃl
(&
fd_bË
[
pd
->
mlc_fd
], 78);

1672 (
pd
->
vf
.
wr™e
)Õd->
mlc_fd
, &
nuÎBy‹
, 1, 
HPMUD_EXCEPTION_TIMEOUT
);

1673 
	`wr™e_eı_chªÃl
(&
fd_bË
[
pd
->
mlc_fd
], 0);

1676 
	`»Ëa£_š‹rçû
(&
fd_bË
[
pd
->
mlc_fd
]);

1679 
	`¦“p
(1);

1682  
¡©
;

1683 
	}
}

1685 
HPMUD_RESULT
 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
	$musb_mlc_chªÃl_wr™e
(
mud_chªÃl
 *
pc
, cÚ¡ *
buf
, 
Ëngth
, 
£c_timeout
, *
by‹s_wrÙe
)

1687 
mud_deviû
 *
pd
 = &
m¥
->
deviû
[
pc
->
dšdex
];

1688 
»t
, 
Ën
, 
size
, 
dËn
, 
tÙ®
=0;

1689 
HPMUD_RESULT
 
¡©
 = 
HPMUD_R_IO_ERROR
;

1691 *
by‹s_wrÙe
=0;

1692 
size
 = 
Ëngth
;

1693 
dËn
 = 
pc
->

.
h2psize
 - (
MLCH—d”
);

1694 
size
 > 0)

1696 
Ën
 = (
size
 > 
dËn
) ? dlen : size;

1698 ià(
pc
->

.
h2püed™
 =ğ0 && 
pd
->
io_mode
 =ğ
HPMUD_MLC_MISER_MODE
)

1700 ià(
	`MlcC»d™Reque¡
(
pc
, 
pd
->
mlc_fd
, 1))

1702 
	`BUG
("invalid MlcCreditRequest from…eripheral\n");

1703 
bugout
;

1707 ià(
pc
->

.
h2püed™
 == 0)

1709 
»t
 = 
	`MlcRev”£Cmd
(
pc
, 
pd
->
mlc_fd
);

1710 ià(
pc
->

.
h2püed™
 == 0)

1712 ià(
»t
 == 0)

1715 ià(
pd
->
io_mode
 !ğ
HPMUD_MLC_MISER_MODE
)

1718 
	`BUG
("invalid MlcCredit from…eripheral,rying miser\n");

1719 
pd
->
io_mode
 = 
HPMUD_MLC_MISER_MODE
;

1723 
	`BUG
("invalid MlcCredit from…eripheral\n");

1724 
bugout
;

1728 ià(
	`MlcFÜw¬dD©a
(
pc
, 
pd
->
mlc_fd
, 
buf
+
tÙ®
, 
Ën
, 
£c_timeout
*1000000))

1730 
bugout
;

1733 
pc
->

.
h2püed™
--;

1734 
size
-=
Ën
;

1735 
tÙ®
+=
Ën
;

1736 *
by‹s_wrÙe
+=
Ën
;

1739 
¡©
 = 
HPMUD_R_OK
;

1741 
bugout
:

1742  
¡©
;

1743 
	}
}

1758 
HPMUD_RESULT
 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
	$musb_mlc_chªÃl_»ad
(
mud_chªÃl
 *
pc
, *
buf
, 
Ëngth
, 
£c_timeout
, *
by‹s_»ad
)

1760 
mud_deviû
 *
pd
 = &
m¥
->
deviû
[
pc
->
dšdex
];

1761 
HPMUD_RESULT
 
¡©
 = 
HPMUD_R_IO_ERROR
;

1763 *
by‹s_»ad
=0;

1764 ià(
pc
->

.
p2hsize
==0)

1766 
	`BUG
("invalid channel_read state\n");

1767 
bugout
;

1770 ià(
pc
->
rút
)

1772 
¡©
=
HPMUD_R_OK
;

1773 *
by‹s_»ad
 = 
	`cut_buf
(
pc
, 
buf
, 
Ëngth
);

1774 
bugout
;

1777 ià(
pc
->

.
p2hüed™
 == 0)

1780 ià(
	`MlcC»d™
(
pc
, 
pd
->
mlc_fd
, 1))

1781 
bugout
;

1784 
¡©
=
HPMUD_R_OK
;

1785 
pc
->
rút
 = 
	`MlcRev”£D©a
Õc, 
pd
->
mlc_fd
,…c->
rbuf
, Õc->rbuf), 
£c_timeout
*1000000);

1786 ià(
pc
->
rút
)

1787 
pc
->

.
p2hüed™
--;

1789 *
by‹s_»ad
 = 
	`cut_buf
(
pc
, 
buf
, 
Ëngth
);

1791 
bugout
:

1792  
¡©
;

1793 
	}
}

1799 
HPMUD_RESULT
 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
	$musb_dÙ4_chªÃl_İ’
(
mud_chªÃl
 *
pc
)

1801 
mud_deviû
 *
pd
 = &
m¥
->
deviû
[
pc
->
dšdex
];

1802 
FD_ID
 
fd
;

1803 
HPMUD_RESULT
 
¡©
 = 
HPMUD_R_IO_ERROR
;

1806 ià(
pd
->
chªÃl_út
==1)

1808 ià(
	`g‘_š‹rçû
(
libusb_deviû
, 
FD_7_1_3
, &
fd_bË
[FD_7_1_3]è=ğ0 && 
	`şaim_š‹rçû
(libusb_device, &fd_table[FD_7_1_3]) == 0)

1809 
fd
 = 
FD_7_1_3
;

1810 ià(
	`g‘_š‹rçû
(
libusb_deviû
, 
FD_ff_ff_ff
, &
fd_bË
[FD_ff_ff_ff]è=ğ0 && 
	`şaim_š‹rçû
(libusb_device, &fd_table[FD_ff_ff_ff]) == 0)

1811 
fd
 = 
FD_ff_ff_ff
;

1812 ià(
	`g‘_š‹rçû
(
libusb_deviû
, 
FD_ff_d4_0
, &
fd_bË
[FD_ff_d4_0]è=ğ0 && 
	`şaim_š‹rçû
(libusb_device, &fd_table[FD_ff_d4_0]) == 0)

1813 
fd
 = 
FD_ff_d4_0
;

1814 ià(
	`g‘_š‹rçû
(
libusb_deviû
, 
FD_7_1_2
, &
fd_bË
[FD_7_1_2]è=ğ0 && 
	`şaim_š‹rçû
(libusb_device, &fd_table[FD_7_1_2]) == 0)

1815 
fd
 = 
FD_7_1_2
;

1818 
¡©
 = 
HPMUD_R_DEVICE_BUSY
;

1819 
bugout
;

1822 ià(
fd
 =ğ
FD_7_1_2
)

1824 ià(
pd
->
io_mode
 =ğ
HPMUD_DOT4_BRIDGE_MODE
)

1827 ià(
	`bridge_ch_up
(&
fd_bË
[
fd
]))

1828 
bugout
;

1833 ià(
	`wr™e_eı_chªÃl
(&
fd_bË
[
fd
], 77))

1834 
bugout
;

1838 ià(
pd
->
io_mode
 =ğ
HPMUD_DOT4_PHOENIX_MODE
)

1839 
	`wr™e_phÛnix_£tup
(&
fd_bË
[
fd
]);

1841 
i
;

1844 
buf
[255];

1845 
Ën
;

1848 
i
=0,
Ën
=1;†’ > 0 && i < (
buf
); i++)

1849 
Ën
 = (
pd
->
vf
.
»ad
)(
fd
, 
buf
+
i
, 1, 0);

1852 ià(
	`DÙ4In™
(
pc
, 
fd
) != 0)

1853 
bugout
;

1856 
i
=0; i<
HPMUD_CHANNEL_MAX
; i++)

1857 
	`mem£t
(&
pd
->
chªÃl
[
i
].

, 0 , (
Œª¥Üt_©Œibu‹s
));

1859 
pd
->
mlc_fd
 = 
fd
;

1860 
pd
->
mlc_up
=1;

1864 ià(
	`DÙ4G‘Sock‘
(
pc
, 
pd
->
mlc_fd
))

1865 
bugout
;

1867 ià(
	`DÙ4O³nChªÃl
(
pc
, 
pd
->
mlc_fd
))

1868 
bugout
;

1870 ià(
pd
->
io_mode
 =ğ
HPMUD_DOT4_PHOENIX_MODE
)

1873 ià(
	`DÙ4C»d™
(
pc
, 
pd
->
mlc_fd
, 2))

1875 
	`BUG
("invalid Dot4Credito…eripheral\n");

1876 
bugout
;

1880 
pc
->
rút
 =…c->
ršdex
 = 0;

1882 
¡©
 = 
HPMUD_R_OK
;

1884 
bugout
:

1885  
¡©
;

1886 
	}
}

1888 
HPMUD_RESULT
 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
	$musb_dÙ4_chªÃl_şo£
(
mud_chªÃl
 *
pc
)

1890 
mud_deviû
 *
pd
 = &
m¥
->
deviû
[
pc
->
dšdex
];

1891 
HPMUD_RESULT
 
¡©
 = 
HPMUD_R_OK
;

1893 ià(
pd
->
mlc_up
)

1895 ià(
	`DÙ4Clo£ChªÃl
(
pc
, 
pd
->
mlc_fd
))

1896 
¡©
 = 
HPMUD_R_IO_ERROR
;

1900 ià(
pd
->
chªÃl_út
==1)

1902 ià(
pd
->
mlc_up
)

1904 ià(
	`DÙ4Ex™
(
pc
, 
pd
->
mlc_fd
))

1905 
¡©
 = 
HPMUD_R_IO_ERROR
;

1907 
pd
->
mlc_up
=0;

1909 ià(
pd
->
mlc_fd
 =ğ
FD_7_1_2
)

1911 ià(
pd
->
io_mode
 =ğ
HPMUD_DOT4_BRIDGE_MODE
)

1913 
	`bridge_ch_down
(&
fd_bË
[
pd
->
mlc_fd
]);

1917 
	`wr™e_eı_chªÃl
(&
fd_bË
[
pd
->
mlc_fd
], 78);

1918 
	`wr™e_eı_chªÃl
(&
fd_bË
[
pd
->
mlc_fd
], 0);

1922 
	`»Ëa£_š‹rçû
(&
fd_bË
[
pd
->
mlc_fd
]);

1925 
	`¦“p
(1);

1928  
¡©
;

1929 
	}
}

1931 
HPMUD_RESULT
 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
	$musb_dÙ4_chªÃl_wr™e
(
mud_chªÃl
 *
pc
, cÚ¡ *
buf
, 
Ëngth
, 
£c_timeout
, *
by‹s_wrÙe
)

1933 
mud_deviû
 *
pd
 = &
m¥
->
deviû
[
pc
->
dšdex
];

1934 
»t
, 
Ën
, 
size
, 
dËn
, 
tÙ®
=0, 
út
=0;

1935 
HPMUD_RESULT
 
¡©
 = 
HPMUD_R_IO_ERROR
;

1937 *
by‹s_wrÙe
=0;

1938 
size
 = 
Ëngth
;

1939 
dËn
 = 
pc
->

.
h2psize
 - (
DOT4H—d”
);

1940 
size
 > 0)

1942 
Ën
 = (
size
 > 
dËn
) ? dlen : size;

1944 ià(
pc
->

.
h2püed™
 =ğ0 && 
pd
->
io_mode
 =ğ
HPMUD_DOT4_PHOENIX_MODE
)

1947 ià(
	`DÙ4C»d™Reque¡
(
pc
, 
pd
->
mlc_fd
, 1))

1949 
	`BUG
("invalid Dot4CreditRequest from…eripheral\n");

1950 
bugout
;

1952 ià(
pc
->

.
h2püed™
 == 0)

1954 ià(
út
++ > 
HPMUD_EXCEPTION_SEC_TIMEOUT
)

1956 
	`BUG
("invalid Dot4CreditRequest from…eripheral\n");

1957 
bugout
;

1959 
	`¦“p
(1);

1964 ià(
pc
->

.
h2püed™
 == 0)

1966 
»t
 = 
	`DÙ4Rev”£Cmd
(
pc
, 
pd
->
mlc_fd
);

1967 ià(
pc
->

.
h2püed™
 == 0)

1969 ià(
»t
 == 0)

1972 
	`BUG
("invalid Dot4Credit from…eripheral\n");

1973 
bugout
;

1977 ià(
	`DÙ4FÜw¬dD©a
(
pc
, 
pd
->
mlc_fd
, 
buf
+
tÙ®
, 
Ën
, 
£c_timeout
*1000000))

1979 
bugout
;

1982 
pc
->

.
h2püed™
--;

1983 
size
-=
Ën
;

1984 
tÙ®
+=
Ën
;

1985 *
by‹s_wrÙe
+=
Ën
;

1986 
út
=0;

1989 
¡©
 = 
HPMUD_R_OK
;

1991 
bugout
:

1992  
¡©
;

1993 
	}
}

2008 
HPMUD_RESULT
 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
	$musb_dÙ4_chªÃl_»ad
(
mud_chªÃl
 *
pc
, *
buf
, 
Ëngth
, 
£c_timeout
, *
by‹s_»ad
)

2010 
mud_deviû
 *
pd
 = &
m¥
->
deviû
[
pc
->
dšdex
];

2011 
HPMUD_RESULT
 
¡©
 = 
HPMUD_R_IO_ERROR
;

2013 *
by‹s_»ad
=0;

2014 ià(
pc
->

.
p2hsize
==0)

2016 
	`BUG
("invalid channel_read state\n");

2017 
bugout
;

2020 ià(
pc
->
rút
)

2022 
¡©
=
HPMUD_R_OK
;

2023 *
by‹s_»ad
 = 
	`cut_buf
(
pc
, 
buf
, 
Ëngth
);

2024 
bugout
;

2027 ià(
pc
->

.
p2hüed™
 == 0)

2030 ià(
	`DÙ4C»d™
(
pc
, 
pd
->
mlc_fd
, 1))

2031 
bugout
;

2034 
¡©
=
HPMUD_R_OK
;

2035 
pc
->
rút
 = 
	`DÙ4Rev”£D©a
Õc, 
pd
->
mlc_fd
,…c->
rbuf
, Õc->rbuf), 
£c_timeout
*1000000);

2036 ià(
pc
->
rút
)

2037 
pc
->

.
p2hüed™
--;

2039 *
by‹s_»ad
 = 
	`cut_buf
(
pc
, 
buf
, 
Ëngth
);

2041 
bugout
:

2042  
¡©
;

2043 
	}
}

2049 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
	$musb_´obe_deviûs
(*
l¡
, 
l¡_size
, *
út
, 
HPMUD_DEVICE_TYPE
 
devty³
)

2051 
usb_bus
 *
bus
;

2052 
usb_deviû
 *
dev
;

2053 
usb_dev_hªdË
 *
hd
;

2054 
hpmud_mod–_©Œibu‹s
 
ma
;

2055 
rmod–
[128];

2056 
r£rŸl
[128];

2057 
mod–
[128];

2058 
£rŸl
[128];

2059 
mfg
[128];

2060 
sz
[
HPMUD_LINE_SIZE
];

2061 
r
, 
size
=0;

2063 
	`usb_š™
();

2064 
	`usb_fšd_bus£s
();

2065 
	`usb_fšd_deviûs
();

2067 
bus
=
usb_bus£s
; bus; bus=bus->
Ãxt
)

2069 
dev
=
bus
->
deviûs
; dev; dev=dev->
Ãxt
)

2072 
mod–
[0] = 
£rŸl
[0] = 
rmod–
[0] = 
r£rŸl
[0] = 
sz
[0] = 
mfg
[0] = 0;

2074 ià(
dev
->
desütÜ
.
idV’dÜ
 =ğ0x3f0 && 
	`is_š‹rçû
(dev, 7))

2076 if((
devty³
 =ğ
HPMUD_PRINTER
è&& !
	`is_´š‹r
(
dev
))

2081 if((
hd
 = 
	`usb_İ’
(
dev
)è=ğ
NULL
)

2083 
	`BUG
("Invalid usb_open: %m\n");

2087 ià((
r
=
	`g‘_¡ršg_desütÜ
(
hd
, 
dev
->
desütÜ
.
iProduù
, 
rmod–
, (rmodel))) < 0)

2088 
	`BUG
("šv®id…roduù id sŒšg„‘=%d\n", 
r
);

2090 
	`g’”®ize_mod–
(
rmod–
, 
mod–
, (model));

2092 ià((
r
=
	`g‘_¡ršg_desütÜ
(
hd
, 
dev
->
desütÜ
.
iS”ŸlNumb”
, 
r£rŸl
, (rserial))) < 0)

2093 
	`BUG
("šv®id s”ŸÈid sŒšg„‘=%d\n", 
r
);

2095 
	`g’”®ize_£rŸl
(
r£rŸl
, 
£rŸl
, (serial));

2097 ià((
r
=
	`g‘_¡ršg_desütÜ
(
hd
, 
dev
->
desütÜ
.
iMªuçùu»r
, 
sz
, (sz))) < 0)

2098 
	`BUG
("šv®id mªuçùu»¸¡ršg„‘=%d\n", 
r
);

2100 
	`g’”®ize_£rŸl
(
sz
, 
mfg
, (
£rŸl
));

2102 ià(!
£rŸl
[0])

2103 
	`¡rıy
(
£rŸl
, "0");

2105 ià(
mod–
[0])

2107 
	`¢´štf
(
sz
, (sz), "hp:/usb/%s?£rŸl=%s", 
mod–
, 
£rŸl
);

2110 
	`hpmud_qu”y_mod–
(
sz
, &
ma
);

2111 ià(
ma
.
suµÜt
 !ğ
HPMUD_SUPPORT_TYPE_HPLIP
)

2113 
	`BUG
("ignÜšg % suµÜt=%d\n", 
sz
, 
ma
.
suµÜt
);

2121 ià(
	`¡ºÿ£cmp
(
rmod–
, "hp ", 3) == 0)

2122 
size
 +ğ
	`¢´štf
(
l¡
+size, 
l¡_size
-size, "direct %s \"HP %s\" \"HP %s USB %s HPLIP\" \"MFG:%s;MDL:%s;CLS:PRINTER;DES:%s;SN:%s;\"\n",

2123 
sz
, &
rmod–
[3], &rmod–[3], 
£rŸl
, 
mfg
,„mod–,„mod–, 
r£rŸl
);

2125 
size
 +ğ
	`¢´štf
(
l¡
+size, 
l¡_size
-size, "direct %s \"HP %s\" \"HP %s USB %s HPLIP\" \"MFG:%s;MDL:%s;CLS:PRINTER;DES:%s;SN:%s;\"\n",

2126 
sz
, 
rmod–
,„mod–, 
£rŸl
, 
mfg
,„mod–,„mod–, 
r£rŸl
);

2128 *
út
+=1;

2130 
	`usb_şo£
(
hd
);

2135  
size
;

2136 
	}
}

2138 
HPMUD_RESULT
 
	$hpmud_make_usb_uri
(cÚ¡ *
bu¢um
, cÚ¡ *
devnum
, *
uri
, 
uri_size
, *
by‹s_»ad
)

2140 
usb_bus
 *
bus
;

2141 
usb_deviû
 *
dev
, *
found_dev
=
NULL
;

2142 
usb_dev_hªdË
 *
hd
=
NULL
;

2143 
mod–
[128];

2144 
£rŸl
[128];

2145 
sz
[256];

2146 
r
;

2147 
HPMUD_RESULT
 
¡©
 = 
HPMUD_R_INVALID_DEVICE_NODE
;

2149 
	`DBG
("[%d] hpmud_make_usb_uri(èbus=% dev=%s\n", 
	`g‘pid
(), 
bu¢um
, 
devnum
);

2151 *
by‹s_»ad
=0;

2153 
	`usb_š™
();

2154 
	`usb_fšd_bus£s
();

2155 
	`usb_fšd_deviûs
();

2157 
bus
=
usb_bus£s
; bu && !
found_dev
; bus=bus->
Ãxt
)

2158 ià(
	`¡rcmp
(
bus
->
dœÇme
, 
bu¢um
) == 0)

2159 
dev
=
bus
->
deviûs
; dev && !
found_dev
; dev=dev->
Ãxt
)

2160 ià(
	`¡rcmp
(
dev
->
f’ame
, 
devnum
) == 0)

2161 
found_dev
 = 
dev
;

2163 ià(
found_dev
 =ğ
NULL
)

2165 
	`BUG
("šv®id bu¢um:devnum %s:%s\n", 
bu¢um
, 
devnum
);

2166 
bugout
;

2169 
dev
 = 
found_dev
;

2170 ià((
hd
 = 
	`usb_İ’
(
dev
)è=ğ
NULL
)

2172 
	`BUG
("invalid usb_open: %m\n");

2173 
bugout
;

2176 
mod–
[0] = 
£rŸl
[0] = 
sz
[0] = 0;

2178 ià(
dev
->
desütÜ
.
idV’dÜ
 == 0x3f0)

2181 ià((
r
=
	`g‘_¡ršg_desütÜ
(
hd
, 
dev
->
desütÜ
.
iProduù
, 
sz
, (sz))) < 0)

2182 
	`BUG
("šv®id…roduù id sŒšg„‘=%d\n", 
r
);

2184 
	`g’”®ize_mod–
(
sz
, 
mod–
, (model));

2186 ià((
r
=
	`g‘_¡ršg_desütÜ
(
hd
, 
dev
->
desütÜ
.
iS”ŸlNumb”
, 
sz
, (sz))) < 0)

2187 
	`BUG
("šv®id s”ŸÈid sŒšg„‘=%d\n", 
r
);

2189 
	`g’”®ize_£rŸl
(
sz
, 
£rŸl
, (serial));

2191 ià(!
£rŸl
[0])

2192 
	`¡rıy
(
£rŸl
, "0");

2194 ifĞ
dev
->
cÚfig
[0].
bNumIÁ”çûs
 =ğ1 && 
	`is_š‹rçû
(dev, 8))

2196 
	`¡rıy
(
£rŸl
, "SMART_INSTALL_ENABLED");

2201 
	`BUG
("šv®id v’dÜ id: %d\n", 
dev
->
desütÜ
.
idV’dÜ
);

2202 
bugout
;

2205 ià(!
mod–
[0] || !
£rŸl
[0])

2206 
bugout
;

2208 *
by‹s_»ad
 = 
	`¢´štf
(
uri
, 
uri_size
, "hp:/usb/%s?£rŸl=%s", 
mod–
, 
£rŸl
);

2209 
¡©
 = 
HPMUD_R_OK
;

2211 
bugout
:

2212 ià(
hd
 !ğ
NULL
)

2213 
	`usb_şo£
(
hd
);

2215  
¡©
;

2216 
	}
}

2218 
HPMUD_RESULT
 
	$hpmud_make_usb_£rŸl_uri
(cÚ¡ *
¢
, *
uri
, 
uri_size
, *
by‹s_»ad
)

2220 
usb_bus
 *
bus
;

2221 
usb_deviû
 *
dev
, *
found_dev
=
NULL
;

2222 
mod–
[128];

2223 
HPMUD_RESULT
 
¡©
 = 
HPMUD_R_INVALID_DEVICE_NODE
;

2225 
	`DBG
("[%d] hpmud_make_usb_£rŸl_uri(è¢=%s\n", 
	`g‘pid
(), 
¢
);

2227 *
by‹s_»ad
=0;

2229 
	`usb_š™
();

2230 
	`usb_fšd_bus£s
();

2231 
	`usb_fšd_deviûs
();

2233 
bus
=
usb_bus£s
; bu && !
found_dev
; bus=bus->
Ãxt
)

2234 
dev
=
bus
->
deviûs
; dev && !
found_dev
; dev=dev->
Ãxt
)

2235 ià(
	`is_£rŸl
(
dev
, 
¢
, 
mod–
, (model)))

2236 
found_dev
 = 
dev
;

2238 ià(
found_dev
 =ğ
NULL
)

2240 
	`BUG
("šv®id sÀ%s\n", 
¢
);

2241 
bugout
;

2244 *
by‹s_»ad
 = 
	`¢´štf
(
uri
, 
uri_size
, "hp:/usb/%s?£rŸl=%s", 
mod–
, 
¢
);

2245 
¡©
 = 
HPMUD_R_OK
;

2247 
bugout
:

2248  
¡©
;

2249 
	}
}

	@io/hpmud/pml.c

30 #iâdeà
_GNU_SOURCE


31 
	#_GNU_SOURCE


	)

34 
	~<¡dlib.h
>

35 
	~<¡ršg.h
>

36 
	~"hpmud.h
"

37 
	~"hpmudi.h
"

39 #ifdeà
HAVE_LIBNETSNMP


40 #ifdeà
HAVE_UCDSNMP


41 
	~<ucd-¢mp/ucd-¢mp-cÚfig.h
>

42 
	~<ucd-¢mp/ucd-¢mp-šşudes.h
>

44 
	~<Ãt-¢mp/Ãt-¢mp-cÚfig.h
>

45 
	~<Ãt-¢mp/Ãt-¢mp-šşudes.h
>

49 
	$PmlOidToHex
(cÚ¡ *
szoid
, *
oid
, 
oidSize
)

51 *

;

52 
i
=0, 
v®
;

54 ià(
szoid
[0] == 0)

55 
bugout
;

57 
v®
 = 
	`¡¹Ş
(
szoid
, &

, 10);

59 
i
 < 
oidSize
)

61 ià(
v®
 > 128)

63 
	`BUG
("šv®id oid size: oid=%s\n", 
szoid
);

64 
bugout
;

66 
oid
[
i
++] = ()
v®
;

68 ià(*

 == 0)

71 
v®
 = 
	`¡¹Ş
(

+1, &tail, 10);

74 
bugout
:

75  
i
;

76 
	}
}

79 
	$SnmpToPml
(cÚ¡ *
¢mp_oid
, *
oid
, 
oidSize
)

81 cÚ¡ 
hp_pml_mib_´efix
[] = "1.3.6.1.4.1.11.2.3.9.4.2";

82 cÚ¡ 
¡ªd¬d_´š‹r_mib_´efix
[] = "1.3.6.1.2.1.43";

83 cÚ¡ 
ho¡_»sourû_mib_´efix
[] = "1.3.6.1.2.1.25";

84 
Ën
=0;

86 ià(
	`¡ºcmp
(
¢mp_oid
, 
hp_pml_mib_´efix
, (hp_pml_mib_prefix)-1) == 0)

89 
Ën
 = 0;

90 
Ën
 +ğ
	`PmlOidToHex
(&
¢mp_oid
[(
hp_pml_mib_´efix
)], &
oid
[0], 
oidSize
);

91 
Ën
--;

93 ià(
	`¡ºcmp
(
¢mp_oid
, 
¡ªd¬d_´š‹r_mib_´efix
, (standard_printer_mib_prefix)-1) == 0)

96 
Ën
 = 1;

97 
oid
[0] = 0x2;

98 
Ën
 +ğ
	`PmlOidToHex
(&
¢mp_oid
[(
¡ªd¬d_´š‹r_mib_´efix
)], &
oid
[1], 
oidSize
);

100 ià(
	`¡ºcmp
(
¢mp_oid
, 
ho¡_»sourû_mib_´efix
, (host_resource_mib_prefix)-1) == 0)

103 
Ën
 = 1;

104 
oid
[0] = 0x3;

105 
Ën
 +ğ
	`PmlOidToHex
(&
¢mp_oid
[(
ho¡_»sourû_mib_´efix
)], &
oid
[1], 
oidSize
);

108 
	`BUG
("SnmpToPmÈçed snm°oid=%s\n", 
¢mp_oid
);

110  
Ën
;

111 
	}
}

113 #ifdeà
HAVE_LIBNETSNMP


115 
	$SnmpE¼ÜToPml
(
¢mp_”rÜ
)

117 
”r
;

119 
¢mp_”rÜ
)

121 
SNMP_ERR_NOERROR
:

122 
”r
 = 
PML_EV_OK
;

124 
SNMP_ERR_TOOBIG
:

125 
”r
 = 
PML_EV_ERROR_BUFFER_OVERFLOW
;

127 
SNMP_ERR_NOSUCHNAME
:

128 
”r
 = 
PML_EV_ERROR_UNKNOWN_OBJECT_IDENTIFIER
;

130 
SNMP_ERR_BADVALUE
:

131 
”r
 = 
PML_EV_ERROR_INVALID_OR_UNSUPPORTED_VALUE
;

133 
SNMP_ERR_READONLY
:

134 
”r
 = 
PML_EV_ERROR_OBJECT_DOES_NOT_SUPPORT_REQUESTED_ACTION
;

136 
SNMP_ERR_GENERR
:

138 
”r
 = 
PML_EV_ERROR_UNKNOWN_REQUEST
;

142  
”r
;

143 
	}
}

145 
	$S‘Snmp
(cÚ¡ *

, 
pÜt
, cÚ¡ *
szoid
, 
ty³
, *
bufãr
, 
size
, *
pml_»suÉ
, *
»suÉ
)

147 
¢mp_£ssiÚ
 
£ssiÚ
, *
ss
=
NULL
;

148 
¢mp_pdu
 *
pdu
=
NULL
;

149 
¢mp_pdu
 *
»¥Ú£
=
NULL
;

150 
oid
 
ªOID
[
MAX_OID_LEN
];

151 
size_t
 
ªOID_Ën
 = 
MAX_OID_LEN
;

152 
i
, 
Ën
=0;

153 
ušt32_t
 
v®
;

155 *
»suÉ
 = 
HPMUD_R_IO_ERROR
;

156 *
pml_»suÉ
 = 
PML_EV_ERROR_UNKNOWN_REQUEST
;

158 
	`š™_¢mp
("snmpapp");

160 
	`¢mp_£ss_š™
(&
£ssiÚ
 );

161 
£ssiÚ
.
³”Çme
 = (*)

;

162 
£ssiÚ
.
v”siÚ
 = 
SNMP_VERSION_1
;

163 
£ssiÚ
.
commun™y
 = (*)
SnmpPÜt
[
pÜt
];

164 
£ssiÚ
.
commun™y_Ën
 = 
	`¡¾’
((cÚ¡ *)£ssiÚ.
commun™y
);

165 
ss
 = 
	`¢mp_İ’
(&
£ssiÚ
);

166 ià(
ss
 =ğ
NULL
)

167 
bugout
;

169 
pdu
 = 
	`¢mp_pdu_ü—‹
(
SNMP_MSG_SET
);

170 
	`»ad_objid
(
szoid
, 
ªOID
, &
ªOID_Ën
);

172 
ty³
)

174 
PML_DT_ENUMERATION
:

175 
PML_DT_SIGNED_INTEGER
:

177 
i
=0, 
v®
=0; i<
size
 && i<(val); i++)

178 
v®
 = ((v® << 8è| ((*)
bufãr
)[
i
]);

179 
	`¢mp_pdu_add_v¬ŸbË
(
pdu
, 
ªOID
, 
ªOID_Ën
, 
ASN_INTEGER
, (*)&
v®
, (val));

181 
PML_DT_REAL
:

182 
PML_DT_STRING
:

183 
PML_DT_BINARY
:

184 
PML_DT_NULL_VALUE
:

185 
PML_DT_COLLECTION
:

187 
	`¢mp_pdu_add_v¬ŸbË
(
pdu
, 
ªOID
, 
ªOID_Ën
, 
ASN_OCTET_STR
, 
bufãr
, 
size
);

193 ià(
	`¢mp_synch_»¥Ú£
(
ss
, 
pdu
, &
»¥Ú£
è!ğ
STAT_SUCCESS
)

194 
bugout
;

196 ià(
»¥Ú£
->
”r¡©
 =ğ
SNMP_ERR_NOERROR
)

198 
Ën
 = 
size
;

201 *
pml_»suÉ
 = 
	`SnmpE¼ÜToPml
(
»¥Ú£
->
”r¡©
);

202 *
»suÉ
 = 
HPMUD_R_OK
;

204 
bugout
:

205 ià(
»¥Ú£
 !ğ
NULL
)

206 
	`¢mp_ä“_pdu
(
»¥Ú£
);

207 ià(
ss
 !ğ
NULL
)

208 
	`¢mp_şo£
(
ss
);

209  
Ën
;

210 
	}
}

212 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
	$G‘Snmp
(cÚ¡ *

, 
pÜt
, cÚ¡ *
szoid
, *
bufãr
, 
size
, *
ty³
, *
pml_»suÉ
, *
»suÉ
)

214 
¢mp_£ssiÚ
 
£ssiÚ
, *
ss
=
NULL
;

215 
¢mp_pdu
 *
pdu
=
NULL
;

216 
¢mp_pdu
 *
»¥Ú£
=
NULL
;

217 
i
, 
Ën
=0;

218 
oid
 
ªOID
[
MAX_OID_LEN
];

219 
size_t
 
ªOID_Ën
 = 
MAX_OID_LEN
;

220 
v¬ŸbË_li¡
 *
v¬s
;

221 
ušt32_t
 
v®
;

222 
tmp
[(
ušt32_t
)];

224 *
»suÉ
 = 
HPMUD_R_IO_ERROR
;

225 *
ty³
 = 
PML_DT_NULL_VALUE
;

226 *
pml_»suÉ
 = 
PML_EV_ERROR_UNKNOWN_REQUEST
;

228 
	`š™_¢mp
("snmpapp");

230 
	`¢mp_£ss_š™
(&
£ssiÚ
 );

231 
£ssiÚ
.
³”Çme
 = (*)

;

232 
£ssiÚ
.
v”siÚ
 = 
SNMP_VERSION_1
;

233 
£ssiÚ
.
commun™y
 = (*)
SnmpPÜt
[
pÜt
];

234 
£ssiÚ
.
commun™y_Ën
 = 
	`¡¾’
((cÚ¡ *)£ssiÚ.
commun™y
);

235 
£ssiÚ
.
»Œ›s
 = 1;

236 
£ssiÚ
.
timeout
 = 1000000;

237 
ss
 = 
	`¢mp_İ’
(&
£ssiÚ
);

238 ià(
ss
 =ğ
NULL
)

239 
bugout
;

241 
pdu
 = 
	`¢mp_pdu_ü—‹
(
SNMP_MSG_GET
);

242 
	`»ad_objid
(
szoid
, 
ªOID
, &
ªOID_Ën
);

243 
	`¢mp_add_nuÎ_v¬
(
pdu
, 
ªOID
, 
ªOID_Ën
);

246 ià(
	`¢mp_synch_»¥Ú£
(
ss
, 
pdu
, &
»¥Ú£
è!ğ
STAT_SUCCESS
)

247 
bugout
;

249 ià(
»¥Ú£
->
”r¡©
 =ğ
SNMP_ERR_NOERROR
)

251 
v¬s
 = 
»¥Ú£
->
v¬ŸbËs
;

252 
v¬s
->
ty³
)

254 
ASN_INTEGER
:

255 *
ty³
 = 
PML_DT_SIGNED_INTEGER
;

258 
Ën
 = ((
ušt32_t
è< 
size
) ? (uint32_t) : size;

259 
v®
 = *
v¬s
->v®.
š‹g”
;

260 
i
=
Ën
; i>0; i--)

262 
tmp
[
i
-1] = 
v®
 & 0xff;

263 
v®
 >>= 8;

267 ; 
tmp
[
i
]==0 && i<
Ën
; i++)

269 
Ën
 -ğ
i
;

271 
	`memıy
(
bufãr
, 
tmp
+
i
, 
Ën
);

273 
ASN_NULL
:

274 *
ty³
 = 
PML_DT_NULL_VALUE
;

276 
ASN_OCTET_STR
:

277 *
ty³
 = 
PML_DT_STRING
;

278 
Ën
 = (
v¬s
->
v®_Ën
 < 
size
) ? vars->val_len : size;

279 
	`memıy
(
bufãr
, 
v¬s
->
v®
.
¡ršg
, 
Ën
);

282 
	`BUG
("uÇbËØG‘Snmp: d©¨ty³=%d\n", 
v¬s
->
ty³
);

283 
bugout
;

288 *
pml_»suÉ
 = 
	`SnmpE¼ÜToPml
(
»¥Ú£
->
”r¡©
);

289 *
»suÉ
 = 
HPMUD_R_OK
;

291 
bugout
:

292 ià(
»¥Ú£
 !ğ
NULL
)

293 
	`¢mp_ä“_pdu
(
»¥Ú£
);

294 ià(
ss
 !ğ
NULL
)

295 
	`¢mp_şo£
(
ss
);

296  
Ën
;

297 
	}
}

301 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
	$S‘Snmp
(cÚ¡ *

, 
pÜt
, cÚ¡ *
szoid
, 
ty³
, *
bufãr
, 
size
, *
pml_»suÉ
, *
»suÉ
)

303 
	`BUG
("no JetDirect supportƒnabled\n");

305 
	}
}

307 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
	$G‘Snmp
(cÚ¡ *

, 
pÜt
, cÚ¡ *
szoid
, *
bufãr
, 
size
, *
ty³
, *
pml_»suÉ
, *
»suÉ
)

309 
	`BUG
("no JetDirect supportƒnabled\n");

311 
	}
}

316 
HPMUD_RESULT
 
	$hpmud_£t_pml
(
HPMUD_DEVICE
 
deviû
, 
HPMUD_CHANNEL
 
chªÃl
, cÚ¡ *
¢mp_oid
, 
ty³
, *
d©a
, 
d©a_size
, *
pml_»suÉ
)

318 
mes§ge
[
HPMUD_BUFFER_SIZE
];

319 
oid
[
HPMUD_LINE_SIZE
];

320 

[
HPMUD_LINE_SIZE
], *
psz
, *

;

321 *
p
=
mes§ge
;

322 
Ën
, 
dL’
, 
»suÉ
, 
»¶y
, 
¡©us
, 
pÜt
;

323 
hpmud_d¡©
 
ds
;

324 
HPMUD_RESULT
 
¡©
 = 
HPMUD_R_IO_ERROR
;

326 
	`DBG
("[%d] hpmud_£t_pml(èdd=%d cd=%d oid=% ty³=%d d©a=%°size=%d\n", 
	`g‘pid
(), 
deviû
, 
chªÃl
, 
¢mp_oid
, 
ty³
, 
d©a
, 
d©a_size
);

328 ià((
»suÉ
 = 
	`hpmud_g‘_d¡©
(
deviû
, &
ds
)è!ğ
HPMUD_R_OK
)

330 
¡©
 = 
»suÉ
;

331 
bugout
;

334 ià(
	`¡rÿ£¡r
(
ds
.
uri
, "Ãt/"è!ğ
NULL
)

338 
	`hpmud_g‘_uri_d©®šk
(
ds
.
uri
, 

, (ip));

340 ià((
psz
 = 
	`¡r¡r
(
ds
.
uri
, "pÜt=")è!ğ
NULL
)

341 
pÜt
 = 
	`¡¹Ş
(
psz
+5, &

, 10);

343 
pÜt
 = 
PORT_PUBLIC
;

345 
	`S‘Snmp
(

, 
pÜt
, 
¢mp_oid
, 
ty³
, 
d©a
, 
d©a_size
, &
¡©us
, &
»suÉ
);

346 ià(
»suÉ
 !ğ
HPMUD_R_OK
)

348 
	`BUG
("S‘PmÈçed„‘=%d\n", 
»suÉ
);

349 
¡©
 = 
»suÉ
;

350 
bugout
;

358 
dL’
 = 
	`SnmpToPml
(
¢mp_oid
, 
oid
, (oid));

360 *
p
++ = 
PML_SET_REQUEST
;

361 *
p
++ = 
PML_DT_OBJECT_IDENTIFIER
;

362 *
p
++ = 
dL’
;

363 
	`memıy
(
p
, 
oid
, 
dL’
);

364 
p
+=
dL’
;

365 *
p
 = 
ty³
;

366 *
p
 |ğ
d©a_size
 >> 8;

367 *(
p
+1èğ
d©a_size
 & 0xff;

368 
p
 += 2;

369 
	`memıy
(
p
, 
d©a
, 
d©a_size
);

371 
»suÉ
 = 
	`hpmud_wr™e_chªÃl
(
deviû
, 
chªÃl
, 
mes§ge
, 
dL’
+
d©a_size
+3+2, 
HPMUD_EXCEPTION_SEC_TIMEOUT
, &
Ën
);

372 ià(
»suÉ
 !ğ
HPMUD_R_OK
)

374 
	`BUG
("S‘PmÈchªÃl_wr™çed„‘=%d\n", 
»suÉ
);

375 
¡©
 = 
»suÉ
;

376 
bugout
;

379 
»suÉ
 = 
	`hpmud_»ad_chªÃl
(
deviû
, 
chªÃl
, 
mes§ge
, (mes§ge), 
HPMUD_EXCEPTION_SEC_TIMEOUT
, &
Ën
);

380 ià(
»suÉ
 !ğ
HPMUD_R_OK
 || 
Ën
 == 0)

382 
	`BUG
("S‘PmÈchªÃl_»ad faed„‘=%d†’=%d\n", 
»suÉ
, 
Ën
);

383 
bugout
;

386 
p
 = 
mes§ge
;

387 
»¶y
 = *
p
++;

388 
¡©us
 = *
p
++;

390 ià(
»¶y
 !ğ(
PML_SET_REQUEST
 | 0x80è&& 
¡©us
 & 0x80)

392 
	`BUG
("S‘PmÈçed„•ly=%x outcome=%x\n", 
»¶y
, 
¡©us
);

393 
	`DBG_DUMP
(
p
, 
Ën
-2);

394 
bugout
;

398 *
pml_»suÉ
 = 
¡©us
;

399 
¡©
 = 
HPMUD_R_OK
;

401 
	`DBG
("£t_pmÈ»suÉ…mÌesuÉ=%x\n", 
¡©us
);

403 
bugout
:

404  
¡©
;

405 
	}
}

408 
HPMUD_RESULT
 
	$hpmud_g‘_pml
(
HPMUD_DEVICE
 
deviû
, 
HPMUD_CHANNEL
 
chªÃl
, cÚ¡ *
¢mp_oid
, *
buf
, 
buf_size
, *
by‹s_»ad
, *
ty³
, *
pml_»suÉ
)

410 
mes§ge
[
HPMUD_BUFFER_SIZE
];

411 
oid
[
HPMUD_LINE_SIZE
];

412 

[
HPMUD_LINE_SIZE
], *
psz
, *

;

413 *
p
=
mes§ge
;

414 
Ën
, 
dL’
, 
»suÉ
, 
»¶y
, 
¡©us
, 
dt
, 
pÜt
;

415 
hpmud_d¡©
 
ds
;

416 
HPMUD_RESULT
 
¡©
 = 
HPMUD_R_IO_ERROR
;

418 
	`DBG
("[%d] hpmud_g‘_pml(èdd=%d cd=%d oid=% d©a=%°size=%d\n", 
	`g‘pid
(), 
deviû
, 
chªÃl
, 
¢mp_oid
, 
buf
, 
buf_size
);

420 ià((
»suÉ
 = 
	`hpmud_g‘_d¡©
(
deviû
, &
ds
)è!ğ
HPMUD_R_OK
)

422 
¡©
 = 
»suÉ
;

423 
bugout
;

426 ià(
	`¡rÿ£¡r
(
ds
.
uri
, "Ãt/"è!ğ
NULL
)

430 
	`hpmud_g‘_uri_d©®šk
(
ds
.
uri
, 

, (ip));

432 ià((
psz
 = 
	`¡r¡r
(
ds
.
uri
, "pÜt=")è!ğ
NULL
)

433 
pÜt
 = 
	`¡¹Ş
(
psz
+5, &

, 10);

435 
pÜt
 = 
PORT_PUBLIC
;

437 
dL’
 = 
	`G‘Snmp
(

, 
pÜt
, 
¢mp_oid
, 
mes§ge
, (mes§ge), &
dt
, &
¡©us
, &
»suÉ
);

438 ià(
»suÉ
 !ğ
HPMUD_R_OK
)

441 
dL’
 = 
	`G‘Snmp
(

, 
PORT_PUBLIC_1
, 
¢mp_oid
, 
mes§ge
, (mes§ge), &
dt
, &
¡©us
, &
»suÉ
);

442 ià(
»suÉ
 !ğ
HPMUD_R_OK
)

444 
	`BUG
("G‘PmÈçed„‘=%d\n", 
»suÉ
);

445 
¡©
 = 
»suÉ
;

446 
bugout
;

449 
p
 = 
mes§ge
;

456 
dL’
 = 
	`SnmpToPml
(
¢mp_oid
, 
oid
, (oid));

458 *
p
++ = 
PML_GET_REQUEST
;

459 *
p
++ = 
PML_DT_OBJECT_IDENTIFIER
;

460 *
p
++ = 
dL’
;

462 
	`memıy
(
p
, 
oid
, 
dL’
);

463 
»suÉ
 = 
	`hpmud_wr™e_chªÃl
(
deviû
, 
chªÃl
, 
mes§ge
, 
dL’
+3, 
HPMUD_EXCEPTION_SEC_TIMEOUT
, &
Ën
);

464 ià(
»suÉ
 !ğ
HPMUD_R_OK
)

466 
	`BUG
("G‘PmÈchªÃl_wr™çed„‘=%d\n", 
»suÉ
);

467 
¡©
 = 
»suÉ
;

468 
bugout
;

471 
»suÉ
 = 
	`hpmud_»ad_chªÃl
(
deviû
, 
chªÃl
, 
mes§ge
, (mes§ge), 
HPMUD_EXCEPTION_SEC_TIMEOUT
, &
Ën
);

472 ià(
»suÉ
 !ğ
HPMUD_R_OK
 || 
Ën
 == 0)

474 
	`BUG
("G‘PmÈchªÃl_»ad faed„‘=%d†’=%d\n", 
»suÉ
, 
Ën
);

475 
bugout
;

478 
p
 = 
mes§ge
;

479 
»¶y
 = *
p
++;

480 
¡©us
 = *
p
++;

482 ià(
»¶y
 !ğ(
PML_GET_REQUEST
 | 0x80è&& 
¡©us
 & 0x80)

484 
	`BUG
("G‘PmÈçed„•ly=%x outcome=%x\n", 
»¶y
, 
¡©us
);

485 
	`DBG_DUMP
(
p
, 
Ën
-2);

486 
bugout
;

489 
dt
 = *
p
++;

491 ià(
dt
 =ğ
PML_DT_ERROR_CODE
)

494 
p
 += 2;

495 
dt
 = *
p
++;

498 ià(
dt
 !ğ
PML_DT_OBJECT_IDENTIFIER
)

500 
	`BUG
("G‘PmÈçed d©¨ty³=%x\n", 
dt
);

501 
bugout
;

504 
dL’
 = *
p
++;

505 
p
 +ğ
dL’
;

507 
dt
 = *
p
;

508 
dL’
 = ((*
p
 & 0x3) << 8 | *(p+1));

509 
p
 += 2;

512 ià(
dL’
 > 
buf_size
)

513 
dL’
 = 
buf_size
;

515 
	`memıy
(
buf
, 
p
, 
dL’
);

516 *
by‹s_»ad
 = 
dL’
;

517 *
ty³
 = 
dt
;

518 *
pml_»suÉ
 = 
¡©us
;

519 
¡©
 = 
HPMUD_R_OK
;

521 
	`DBG
("g‘_pmÈ»suÉ†’=%d d©©y³=%x…mÌesuÉ=%x\n", 
dL’
, 
dt
, 
¡©us
);

522 
	`DBG_DUMP
(
buf
, 
dL’
);

524 
bugout
:

525  
¡©
;

526 
	}
}

	@io/hpmud/pml.h

27 #iâdeà
_PML_H


28 
	#_PML_H


	)

34 
	ePML_REQUESTS


36 
	mPML_GET_REQUEST
 = 0,

37 
	mPML_GET_NEXT_REQUEST
 = 0x1,

38 
	mPML_BLOCK_REQUEST
 = 0x3,

39 
	mPML_SET_REQUEST
 = 0x4,

40 
	mPML_ENABLE_TRAP_REQUEST
 = 0x5,

41 
	mPML_DISABLE_TRAP_REQUEST
 = 0x6,

42 
	mPML_TRAP_REQUEST
 = 0x7

45 
	ePML_ERROR_VALUES


47 
	mPML_EV_OK
 = 0,

48 
	mPML_EV_OK_END_OF_SUPPORTED_OBJECTS
 = 0x1,

49 
	mPML_EV_OK_NEAREST_LEGAL_VALUE_SUBSTITUTED
 = 0x2,

50 
	mPML_EV_ERROR_UNKNOWN_REQUEST
 = 0x80,

51 
	mPML_EV_ERROR_BUFFER_OVERFLOW
 = 0x81,

52 
	mPML_EV_ERROR_COMMAND_EXECUTION_ERROR
 = 0x82,

53 
	mPML_EV_ERROR_UNKNOWN_OBJECT_IDENTIFIER
 = 0x83,

54 
	mPML_EV_ERROR_OBJECT_DOES_NOT_SUPPORT_REQUESTED_ACTION
 = 0x84,

55 
	mPML_EV_ERROR_INVALID_OR_UNSUPPORTED_VALUE
 = 0x85,

56 
	mPML_EV_ERROR_PAST_END_OF_SUPPORTED_OBJECTS
 = 0x86,

57 
	mPML_EV_ERROR_ACTION_CAN_NOT_BE_PERFORMED_NOW
 = 0x87

60 
	ePML_DATA_TYPES


62 
	mPML_DT_OBJECT_IDENTIFIER
 = 0,

63 
	mPML_DT_ENUMERATION
 = 0x04,

64 
	mPML_DT_SIGNED_INTEGER
 = 0x08,

65 
	mPML_DT_REAL
 = 0x0C,

66 
	mPML_DT_STRING
 = 0x10,

67 
	mPML_DT_BINARY
 = 0x14,

68 
	mPML_DT_ERROR_CODE
 = 0x18,

69 
	mPML_DT_NULL_VALUE
 = 0x1C,

70 
	mPML_DT_COLLECTION
 = 0x20,

71 
	mPML_DT_UNKNOWN
 = 0xff

74 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
G‘Snmp
(cÚ¡ *

, 
pÜt
, cÚ¡ *
szoid
, *
bufãr
, 
size
, *
ty³
, *
pml_»suÉ
, *
»suÉ
);

	@io/hpmud/pp.c

27 #ifdeà
HAVE_PPORT


29 
	~"hpmud.h
"

30 
	~"hpmudi.h
"

32 
mud_deviû_vf
 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
	gµ_mud_deviû_vf
 =

34 .
»ad
 = 
µ_»ad
,

35 .
	gwr™e
 = 
µ_wr™e
,

36 .
	gİ’
 = 
µ_İ’
,

37 .
	gşo£
 = 
µ_şo£
,

38 .
	gg‘_deviû_id
 = 
µ_g‘_deviû_id
,

39 .
	gg‘_deviû_¡©us
 = 
µ_g‘_deviû_¡©us
,

40 .
	gchªÃl_İ’
 = 
µ_chªÃl_İ’
,

41 .
	gchªÃl_şo£
 = 
µ_chªÃl_şo£
,

42 .
	gchªÃl_wr™e
 = 
musb_chªÃl_wr™e
,

43 .
	gchªÃl_»ad
 = 
musb_chªÃl_»ad


46 
mud_chªÃl_vf
 
	gµ_¿w_chªÃl_vf
 =

48 .
İ’
 = 
µ_¿w_chªÃl_İ’
,

49 .
	gşo£
 = 
µ_¿w_chªÃl_şo£
,

50 .
	gchªÃl_wr™e
 = 
musb_¿w_chªÃl_wr™e
,

51 .
	gchªÃl_»ad
 = 
musb_¿w_chªÃl_»ad


54 
mud_chªÃl_vf
 
	gµ_mlc_chªÃl_vf
 =

56 .
İ’
 = 
µ_mlc_chªÃl_İ’
,

57 .
	gşo£
 = 
µ_mlc_chªÃl_şo£
,

58 .
	gchªÃl_wr™e
 = 
musb_mlc_chªÃl_wr™e
,

59 .
	gchªÃl_»ad
 = 
musb_mlc_chªÃl_»ad


62 
mud_chªÃl_vf
 
	gµ_dÙ4_chªÃl_vf
 =

64 .
İ’
 = 
µ_dÙ4_chªÃl_İ’
,

65 .
	gşo£
 = 
µ_dÙ4_chªÃl_şo£
,

66 .
	gchªÃl_wr™e
 = 
musb_dÙ4_chªÃl_wr™e
,

67 .
	gchªÃl_»ad
 = 
musb_dÙ4_chªÃl_»ad


70 
	$äob_cÚŒŞ
(
fd
, 
mask
, 
v®
)

72 
µdev_äob_¡ruù
 
äob
;

75 
äob
.
v®
 = v® ^ (
mask
 & (
PARPORT_CONTROL_STROBE
 | 
PARPORT_CONTROL_AUTOFD
 | 
PARPORT_CONTROL_SELECT
));

77 
äob
.
mask
 = mask;

78  
	`ioùl
(
fd
, 
PPFCONTROL
, &
äob
);

79 
	}
}

81 
	$»ad_¡©us
(
fd
)

83 
¡©us
;

84 ià(
	`ioùl
(
fd
, 
PPRSTATUS
, &
¡©us
))

85 
	`BUG
("read_statusƒrror: %m\n");

88  (
¡©us
 ^ 
PARPORT_STATUS_BUSY
);

89 
	}
}

91 
	$wa™_¡©us
(
fd
, 
mask
, 
v®
, 
u£c
)

93 
timev®
 
tmo
, 
now
;

94 
time¥ec
 
mš
;

95 
¡©us
;

96 
út
=0;

98 
	`g‘timeofday
 (&
tmo
, 
NULL
);

99 
tmo
.
tv_u£c
 +ğ
u£c
;

100 
tmo
.
tv_£c
 +ğtmo.
tv_u£c
 / 1000000;

101 
tmo
.
tv_u£c
 %= 1000000;

103 
mš
.
tv_£c
 = 0;

104 
mš
.
tv_n£c
 = 5000000;

108 
¡©us
 = 
	`»ad_¡©us
(
fd
);

109 ià((
¡©us
 & 
mask
è=ğ
v®
)

114 
út
++;

116 
	`g‘timeofday
(&
now
, 
NULL
);

117 ià((
now
.
tv_£c
 > 
tmo
.tv_£cè|| (now.tv_£ø=ğtmo.tv_£ø&&‚ow.
tv_u£c
 >mo.tv_usec))

119 
	`DBG
("wa™_¡©u timeouˆ¡©us=%x mask=%x v®=%x us=%d\n", 
¡©us
, 
mask
, 
v®
, 
u£c
);

123 
	}
}

125 
	$wa™
(
u£c
)

127 
timev®
 
tmo
, 
now
;

128 
út
=0;

130 
	`g‘timeofday
 (&
tmo
, 
NULL
);

131 
tmo
.
tv_u£c
 +ğ
u£c
;

132 
tmo
.
tv_£c
 +ğtmo.
tv_u£c
 / 1000000;

133 
tmo
.
tv_u£c
 %= 1000000;

137 
út
++;

138 
	`g‘timeofday
(&
now
, 
NULL
);

139 ià((
now
.
tv_£c
 > 
tmo
.tv_£cè|| (now.tv_£ø=ğtmo.tv_£ø&&‚ow.
tv_u£c
 >mo.tv_usec))

144 
	}
}

146 
	$eı_is_fwd
(
fd
)

148 
¡©us
;

150 
¡©us
 = 
	`»ad_¡©us
(
fd
);

151 ià((
¡©us
 & 
PARPORT_STATUS_PAPEROUT
) == PARPORT_STATUS_PAPEROUT)

154 
	}
}

156 
	$eı_is_»v
(
fd
)

158 
¡©us
;

160 
¡©us
 = 
	`»ad_¡©us
(
fd
);

161 ià((
¡©us
 & 
PARPORT_STATUS_PAPEROUT
) == 0)

164 
	}
}

166 
	$eı_»v_to_fwd
(
fd
)

168 
dœ
=0;

170 ià(
	`eı_is_fwd
(
fd
))

174 
	`äob_cÚŒŞ
(
fd
, 
PARPORT_CONTROL_INIT
, PARPORT_CONTROL_INIT);

180 
	`wa™_¡©us
(
fd
, 
PARPORT_STATUS_PAPEROUT
, PARPORT_STATUS_PAPEROUT, 
PP_SIGNAL_TIMEOUT
);

182 
	`ioùl
(
fd
, 
PPDATADIR
, &
dœ
);

185 
	}
}

187 
	$eı_fwd_to_»v
(
fd
)

189 
dœ
=1;

191 ià(
	`eı_is_»v
(
fd
))

195 
	`wa™_¡©us
(
fd
, 
PARPORT_STATUS_BUSY
 | 
PARPORT_STATUS_ERROR
, 0, 
PP_DEVICE_TIMEOUT
);

198 
	`ioùl
(
fd
, 
PPDATADIR
, &
dœ
);

199 
	`äob_cÚŒŞ
(
fd
, 
PARPORT_CONTROL_AUTOFD
, 0);

200 
	`wa™
(
PP_SETUP_TIMEOUT
);

203 
	`äob_cÚŒŞ
(
fd
, 
PARPORT_CONTROL_INIT
, 0);

206 
	`wa™_¡©us
(
fd
, 
PARPORT_STATUS_PAPEROUT
, 0, 
PP_SIGNAL_TIMEOUT
);

209 
	}
}

211 
	$eı_wr™e_addr
(
fd
, 
d©a
)

213 
út
=0, 
Ën
=0;

214 
d
=(
d©a
 | 0x80);

216 
	`eı_»v_to_fwd
(
fd
);

219 ià(
	`wa™_¡©us
(
fd
, 
PARPORT_STATUS_BUSY
, 0, 
PP_SIGNAL_TIMEOUT
))

221 
	`BUG
("ecp_write_addrransfer stalled\n");

222 
bugout
;

228 
	`äob_cÚŒŞ
(
fd
, 
PARPORT_CONTROL_AUTOFD
, 0);

229 
	`ioùl
(
fd
, 
PPWDATA
, &
d
);

232 
	`äob_cÚŒŞ
(
fd
, 
PARPORT_CONTROL_STROBE
, 0);

235 ià(
	`wa™_¡©us
(
fd
, 
PARPORT_STATUS_BUSY
, PARPORT_STATUS_BUSY, 
PP_SIGNAL_TIMEOUT
))

239 
	`äob_cÚŒŞ
(
fd
, 
PARPORT_CONTROL_INIT
, 0);

242 
	`wa™_¡©us
(
fd
, 
PARPORT_STATUS_PAPEROUT
, 0, 
PP_SIGNAL_TIMEOUT
);

245 
	`äob_cÚŒŞ
(
fd
, 
PARPORT_CONTROL_INIT
, PARPORT_CONTROL_INIT);

248 
	`wa™_¡©us
(
fd
, 
PARPORT_STATUS_PAPEROUT
, PARPORT_STATUS_PAPEROUT, 
PP_SIGNAL_TIMEOUT
);

250 
út
++;

251 ià(
út
 > 4)

253 
	`BUG
("ecp_write_addrransfer stalled\n");

254 
bugout
;

256 
	`BUG
("eı_wr™e_add¸ho¡¿nsã¸»cov”y cÁ=%d\n", 
út
);

262 
Ën
 = 1;

264 
bugout
:

267 
	`äob_cÚŒŞ
(
fd
, 
PARPORT_CONTROL_STROBE
, PARPORT_CONTROL_STROBE);

269  
Ën
;

270 
	}
}

272 
	$eı_wr™e_d©a
(
fd
, 
d©a
)

274 
út
=0, 
Ën
=0;

279 ià(
	`wa™_¡©us
(
fd
, 
PARPORT_STATUS_BUSY
, 0, 
PP_SIGNAL_TIMEOUT
))

281 
	`BUG
("ecp_write_dataransfer stalled\n");

282 
bugout
;

288 
	`äob_cÚŒŞ
(
fd
, 
PARPORT_CONTROL_AUTOFD
, PARPORT_CONTROL_AUTOFD);

289 
	`ioùl
(
fd
, 
PPWDATA
, &
d©a
);

292 
	`äob_cÚŒŞ
(
fd
, 
PARPORT_CONTROL_STROBE
, 0);

295 ià(
	`wa™_¡©us
(
fd
, 
PARPORT_STATUS_BUSY
, PARPORT_STATUS_BUSY, 
PP_SIGNAL_TIMEOUT
))

299 
	`äob_cÚŒŞ
(
fd
, 
PARPORT_CONTROL_INIT
, 0);

302 
	`wa™_¡©us
(
fd
, 
PARPORT_STATUS_PAPEROUT
, 0, 
PP_SIGNAL_TIMEOUT
);

305 
	`äob_cÚŒŞ
(
fd
, 
PARPORT_CONTROL_INIT
, PARPORT_CONTROL_INIT);

308 
	`wa™_¡©us
(
fd
, 
PARPORT_STATUS_PAPEROUT
, PARPORT_STATUS_PAPEROUT, 
PP_SIGNAL_TIMEOUT
);

310 
út
++;

311 ià(
út
 > 4)

313 
	`BUG
("ecp_write_dataransfer stalled\n");

314 
bugout
;

316 
	`BUG
("eı_wr™e_d©¨ho¡¿nsã¸»cov”y cÁ=%d\n", 
út
);

322 
Ën
 = 1;

324 
bugout
:

327 
	`äob_cÚŒŞ
(
fd
, 
PARPORT_CONTROL_STROBE
, PARPORT_CONTROL_STROBE);

329  
Ën
;

330 
	}
}

332 
	$eı_»ad_d©a
(
fd
, *
d©a
)

334 
Ën
=0;

339 ià(
	`wa™_¡©us
(
fd
, 
PARPORT_STATUS_ACK
, 0, 
PP_SIGNAL_TIMEOUT
))

341 
Ën
 = -1;

342 
bugout
;

344 
	`ioùl
(
fd
, 
PPRDATA
, 
d©a
);

347 
	`äob_cÚŒŞ
(
fd
, 
PARPORT_CONTROL_AUTOFD
, PARPORT_CONTROL_AUTOFD);

350 
	`wa™_¡©us
(
fd
, 
PARPORT_STATUS_ACK
, PARPORT_STATUS_ACK, 
PP_SIGNAL_TIMEOUT
);

353 
	`äob_cÚŒŞ
(
fd
, 
PARPORT_CONTROL_AUTOFD
, 0);

355 
Ën
 = 1;

357 
bugout
:

359  
Ën
;

360 
	}
}

362 
	$eı_»ad
(
fd
, *
bufãr
, 
size
, 
u£c
)

364 
i
=0;

365 *
p
 = (*)
bufãr
;

367 
	`eı_fwd_to_»v
(
fd
);

369 
i
 < 
size
)

371 ià(
	`eı_»ad_d©a
(
fd
, 
p
+
i
) != 1)

373 
u£c
-=
PP_SIGNAL_TIMEOUT
;

374 ià(
u£c
 > 0)

378  -
ETIMEDOUT
;

380 
i
++;

382  
i
;

383 
	}
}

385 
	$eı_wr™e
(
fd
, cÚ¡ *
bufãr
, 
size
)

387 
i
;

388 *
p
 = (*)
bufãr
;

389 
timeout
=0;

391 ià(
timeout
)

393 
timeout
=0;

397 
	`eı_»v_to_fwd
(
fd
);

399 
i
=0; i < 
size
; i++)

401 ià(
	`eı_wr™e_d©a
(
fd
, 
p
[
i
]) != 1)

403 ià(
i
)

404 
timeout
=1;

406 
i
=-1;

410  
i
;

411 
	}
}

413 
	$nibbË_»ad_d©a
(
fd
, *
d©a
)

415 
Ën
=0;

416 
nibbË
;

419 
	`äob_cÚŒŞ
(
fd
, 
PARPORT_CONTROL_AUTOFD
, 0);

424 ià(
	`wa™_¡©us
(
fd
, 
PARPORT_STATUS_ACK
, 0, 
PP_SIGNAL_TIMEOUT
))

426 
Ën
 = -1;

427 
bugout
;

429 
nibbË
 = 
	`»ad_¡©us
(
fd
) >> 3;

430 
nibbË
 = ((nibble & 0x10) >> 1) | (nibble & 0x7);

431 *
d©a
 = 
nibbË
;

434 
	`äob_cÚŒŞ
(
fd
, 
PARPORT_CONTROL_AUTOFD
, PARPORT_CONTROL_AUTOFD);

437 
	`wa™_¡©us
(
fd
, 
PARPORT_STATUS_ACK
, PARPORT_STATUS_ACK, 
PP_SIGNAL_TIMEOUT
);

440 
	`äob_cÚŒŞ
(
fd
, 
PARPORT_CONTROL_AUTOFD
, 0);

445 ià(
	`wa™_¡©us
(
fd
, 
PARPORT_STATUS_ACK
, 0, 
PP_SIGNAL_TIMEOUT
))

447 
Ën
 = -1;

448 
bugout
;

450 
nibbË
 = 
	`»ad_¡©us
(
fd
) >> 3;

451 
nibbË
 = ((nibble & 0x10) >> 1) | (nibble & 0x7);

452 *
d©a
 |ğ(
nibbË
<<4);

455 
	`äob_cÚŒŞ
(
fd
, 
PARPORT_CONTROL_AUTOFD
, PARPORT_CONTROL_AUTOFD);

458 
	`wa™_¡©us
(
fd
, 
PARPORT_STATUS_ACK
, PARPORT_STATUS_ACK, 
PP_SIGNAL_TIMEOUT
);

460 
Ën
 = 1;

462 
bugout
:

464  
Ën
;

465 
	}
}

467 
	$nibbË_»ad
(
fd
, 
æag
, *
bufãr
, 
size
, 
u£c
)

469 
i
=0;

470 *
p
 = (*)
bufãr
;

471 
m
 = 
IEEE1284_MODE_NIBBLE
 | 
æag
;

472 
mc
 = 
IEEE1284_MODE_COMPAT
;

473 
¡©us
;

475 
	`ioùl
 (
fd
, 
PPNEGOT
, &
mc
);

476 ià(
	`ioùl
 (
fd
, 
PPNEGOT
, &
m
))

478 
	`DBG
("nibble_read‚egotiation failed: %m\n");

482 
i
 < 
size
)

484 ià(
	`nibbË_»ad_d©a
(
fd
, 
p
+
i
) != 1)

486 
u£c
-=
PP_SIGNAL_TIMEOUT
;

487 ià(
u£c
 > 0)

491  -
ETIMEDOUT
;

494 
i
++;

497 
¡©us
 = 
	`»ad_¡©us
(
fd
);

498 ià(
¡©us
 & 
PARPORT_STATUS_ERROR
)

501 
	`äob_cÚŒŞ
(
fd
, 
PARPORT_CONTROL_AUTOFD
, 0);

507  
i
;

508 
	}
}

510 
	$com·t_wr™e_d©a
(
fd
, 
d©a
)

512 
Ën
=0;

515 ià(
	`wa™_¡©us
(
fd
, 
PARPORT_STATUS_BUSY
, 0, 
PP_DEVICE_TIMEOUT
))

517 
	`BUG
("compat_write_dataransfer stalled\n");

518 
bugout
;

521 
	`ioùl
(
fd
, 
PPWDATA
, &
d©a
);

522 
	`wa™
(
PP_SETUP_TIMEOUT
);

525 
	`äob_cÚŒŞ
(
fd
, 
PARPORT_CONTROL_STROBE
, 0);

528 ià(
	`wa™_¡©us
(
fd
, 
PARPORT_STATUS_BUSY
, PARPORT_STATUS_BUSY, 
PP_SIGNAL_TIMEOUT
))

530 
	`BUG
("compat_write_dataransfer stalled\n");

531 
bugout
;

535 
	`äob_cÚŒŞ
(
fd
, 
PARPORT_CONTROL_STROBE
, PARPORT_CONTROL_STROBE);

537 
Ën
 = 1;

539 
bugout
:

540  
Ën
;

541 
	}
}

543 
	$com·t_wr™e
(
fd
, cÚ¡ *
bufãr
, 
size
)

545 
i
=0;

546 *
p
 = (*)
bufãr
;

547 
m
 = 
IEEE1284_MODE_COMPAT
;

548 
timeout
=0;

550 ià(
timeout
)

552 
timeout
=0;

556 ià(
	`ioùl
(
fd
, 
PPNEGOT
, &
m
))

558 
	`BUG
("compat_write failed: %m\n");

559 
bugout
;

562 
i
=0; i < 
size
; i++)

564 ià(
	`com·t_wr™e_d©a
(
fd
, 
p
[
i
]) != 1)

566 ià(
i
)

567 
timeout
=1;

569 
i
=-1;

574 
bugout
:

575  
i
;

576 
	}
}

578 
	$şaim_µ
(
fd
)

580 
¡©
=1;

583 ià(
	`ioùl
(
fd
, 
PPCLAIM
))

585 
	`BUG
("çed cÏim_µ fd=%d: %m\n", 
fd
);

586 
bugout
;

589 
	`DBG
("şaimed…°fd=%d\n", 
fd
);

591 
¡©
=0;

593 
bugout
:

594  
¡©
;

595 
	}
}

597 
	$»Ëa£_µ
(
fd
)

599 
¡©
=1, 
m
=
IEEE1284_MODE_COMPAT
;

602 ià(
	`ioùl
(
fd
, 
PPNEGOT
, &
m
))

604 
	`BUG
("çed„–—£_µ fd=%d: %m\n", 
fd
);

605 
bugout
;

608 
	`ioùl
(
fd
, 
PPRELEASE
);

610 
	`DBG
("»Ëa£d…°fd=%d\n", 
fd
);

612 
¡©
=0;

614 
bugout
:

616 
	}
}

618 
	$deviû_id
(
fd
, *
bufãr
, 
size
)

620 
Ën
=0, 
maxSize
;

622 
maxSize
 = (
size
 > 1024) ? 1024 : size;

624 
Ën
 = 
	`nibbË_»ad
(
fd
, 
IEEE1284_DEVICEID
, 
bufãr
, 
maxSize
, 0);

625 ià(
Ën
 < 0)

627 
	`BUG
("uÇbËØ»ad deviû-id„‘=%d\n", 
Ën
);

628 
Ën
 = 0;

629 
bugout
;

631 ià(
Ën
 > (
size
-1))

632 
Ën
 = 
size
-1;

633 ià(
Ën
 > 2)

634 
Ën
 -= 2;

635 
	`memıy
(
bufãr
, bufãr+2, 
Ën
);

636 
bufãr
[
Ën
]=0;

638 
	`DBG
("»ad‡ùu® deviû_id sucûssfuÎy fd=%d†’=%d\n", 
fd
, 
Ën
);

640 
bugout
:

641  
Ën
;

642 
	}
}

644 
	$deviû_¡©us
(
fd
, *
¡©us
)

646 
m
, 
¡©
=1;

647 
by‹
 = 
NFAULT_BIT
;

649 
m
 = 
IEEE1284_MODE_COMPAT
;

650 ià(
	`ioùl
 (
fd
, 
PPNEGOT
, &
m
))

652 
	`BUG
("unableo„ead device_status: %m\n");

653 
¡©
 = 
HPMUD_R_IO_ERROR
;

654 
bugout
;

656 
by‹
 = 
	`»ad_¡©us
(
fd
);

658 *
¡©us
 = ()
by‹
;

659 
¡©
 = 0;

660 
	`DBG
("»ad‡ùu® deviû_¡©u sucûssfuÎy fd=%d\n", 
fd
);

662 
bugout
:

663  
¡©
;

664 
	}
}

667 
	$Ãw_chªÃl
(
mud_deviû
 *
pd
, 
šdex
, cÚ¡ *
¢
)

669 
¡©
=1;

672 ià(
pd
->
chªÃl
[
šdex
].
ş›Á_út
)

675 ià(
šdex
 =ğ
HPMUD_EWS_CHANNEL
)

677 
pd
->
chªÃl
[
šdex
].
ş›Á_út
++;

678 
¡©
 = 0;

679 
	`DBG
("»u£d % chªÃl=%d cl›ÁCÁ=%d chªÃlCÁ=%d\n", 
¢
, 
šdex
, 
pd
->
chªÃl
[šdex].
ş›Á_út
,…d->
chªÃl_út
);

683 
	`BUG
("% chªÃl=%d i busy, u£d by [%d], cl›ÁCÁ=%d chªÃlCÁ=%d\n", 
¢
, 
šdex
, 
pd
->
chªÃl
[šdex].
pid
,…d->chªÃl[šdex].
ş›Á_út
,…d->
chªÃl_út
);

684 
bugout
;

687 ià(
pd
->
io_mode
 =ğ
HPMUD_RAW_MODE
 ||…d->io_mod=ğ
HPMUD_UNI_MODE
)

688 
pd
->
chªÃl
[
šdex
].
vf
 = 
µ_¿w_chªÃl_vf
;

689 ià(
pd
->
io_mode
 =ğ
HPMUD_MLC_GUSHER_MODE
 ||…d->io_mod=ğ
HPMUD_MLC_MISER_MODE
)

690 
pd
->
chªÃl
[
šdex
].
vf
 = 
µ_mlc_chªÃl_vf
;

692 
pd
->
chªÃl
[
šdex
].
vf
 = 
µ_dÙ4_chªÃl_vf
;

694 
pd
->
chªÃl
[
šdex
].index = index;

695 
pd
->
chªÃl
[
šdex
].
ş›Á_út
 = 1;

696 
pd
->
chªÃl
[
šdex
].
sockid
 = index;

697 
pd
->
chªÃl
[
šdex
].
pid
 = 
	`g‘pid
();

698 
pd
->
chªÃl
[
šdex
].
dšdex
 =…d->index;

699 
pd
->
chªÃl
[
šdex
].
fd
 = -1;

700 
	`¡rıy
(
pd
->
chªÃl
[
šdex
].
¢
, sn);

701 
pd
->
chªÃl_út
++;

703 
¡©
 = 0;

704 
	`DBG
("Ãw % chªÃl=%d cl›ÁCÁ=%d chªÃlCÁ=%d\n", 
¢
, 
šdex
, 
pd
->
chªÃl
[šdex].
ş›Á_út
,…d->
chªÃl_út
);

706 
bugout
:

707  
¡©
;

708 
	}
}

711 
	$d–_chªÃl
(
mud_deviû
 *
pd
, 
mud_chªÃl
 *
pc
)

713 
pc
->
ş›Á_út
--;

715 ià(
pc
->
ş›Á_út
 <= 0)

717 
pd
->
chªÃl_út
--;

719 
	`DBG
("»moved % chªÃl=%d cl›ÁCÁ=%d chªÃlCÁ=%d\n", 
pc
->
¢
,…c->
šdex
,…c->
ş›Á_út
, 
pd
->
chªÃl_út
);

721 
	}
}

727 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
	$µ_wr™e
(
fd
, cÚ¡ *
buf
, 
size
, 
u£c
)

729 
Ën
=0, 
m
;

731 
	`ioùl
(
fd
, 
PPGETMODE
, &
m
);

733 ià(
m
 & (
IEEE1284_MODE_ECPSWE
 | 
IEEE1284_MODE_ECP
))

735 
Ën
 = 
	`eı_wr™e
(
fd
, 
buf
, 
size
);

739 
Ën
 = 
	`com·t_wr™e
(
fd
, 
buf
, 
size
);

742 
	`DBG
("wr™fd=%d†’=%d size=%d\n", 
fd
, 
Ën
, 
size
);

743 
	`DBG_DUMP
(
buf
, 
Ën
 < 32 ?†en : 32);

745  
Ën
;

746 
	}
}

748 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
	$µ_»ad
(
fd
, *
buf
, 
size
, 
u£c
)

750 
Ën
=0, 
m
;

753 
	`ioùl
(
fd
, 
PPGETMODE
, &
m
);

755 ià(
m
 & (
IEEE1284_MODE_ECPSWE
 | 
IEEE1284_MODE_ECP
))

757 
Ën
 = 
	`eı_»ad
(
fd
, 
buf
, 
size
, 
u£c
);

761 
Ën
 = 
	`nibbË_»ad
(
fd
, 0, 
buf
, 
size
, 
u£c
);

764 
	`DBG
("»ad fd=%d†’=%d size=%d u£c=%d\n", 
fd
, 
Ën
, 
size
, 
u£c
);

765 
	`DBG_DUMP
(
buf
, 
Ën
 < 32 ?†en : 32);

767  
Ën
;

768 
	}
}

770 
HPMUD_RESULT
 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
	$µ_İ’
(
mud_deviû
 *
pd
)

772 
dev
[255], 
uriMod–
[128], 
mod–
[128];

773 
Ën
, 
m
, 
fd
;

774 
HPMUD_RESULT
 
¡©
 = 
HPMUD_R_IO_ERROR
;

776 
	`±h»ad_mu‹x_lock
(&
pd
->
mu‹x
);

778 
	`hpmud_g‘_uri_mod–
(
pd
->
uri
, 
uriMod–
, (uriModel));

780 ià(
pd
->
id
[0] == 0)

783 
	`hpmud_g‘_uri_d©®šk
(
pd
->
uri
, 
dev
, (dev));

784 ià((
fd
 = 
	`İ’
(
dev
, 
O_RDWR
 | 
O_NOCTTY
)) < 0)

786 
	`BUG
("uÇbËØİ’ %s: %m\n", 
pd
->
uri
);

787 
bugout
;

791 ià(
	`ioùl
(
fd
, 
PPGETMODES
, &
m
))

793 
	`BUG
("uÇbËØİ’ %s: %m\n", 
pd
->
uri
);

794 
bugout
;

798 ià(
	`şaim_µ
(
fd
))

799 
bugout
;

801 
Ën
 = 
	`deviû_id
(
fd
, 
pd
->
id
, (pd->id));

803 ià(
Ën
 > 0 && 
	`is_hp
(
pd
->
id
))

804 
	`pow”_up
(
pd
, 
fd
);

806 
	`»Ëa£_µ
(
fd
);

808 ià(
Ën
 == 0)

809 
bugout
;

811 
pd
->
İ’_fd
 = 
fd
;

815 
	`hpmud_g‘_mod–
(
pd
->
id
, 
mod–
, (model));

816 ià(
	`¡rcmp
(
uriMod–
, 
mod–
) != 0)

818 
¡©
 = 
HPMUD_R_INVALID_DEVICE_NODE
;

819 
	`BUG
("šv®id mod– % !ğ%s\n", 
uriMod–
, 
mod–
);

820 
bugout
;

823 
¡©
 = 
HPMUD_R_OK
;

825 
bugout
:

826 
	`±h»ad_mu‹x_uÆock
(&
pd
->
mu‹x
);

827  
¡©
;

828 
	}
}

830 
HPMUD_RESULT
 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
	$µ_şo£
(
mud_deviû
 *
pd
)

832 
HPMUD_RESULT
 
¡©
 = 
HPMUD_R_OK
;

834 
	`±h»ad_mu‹x_lock
(&
pd
->
mu‹x
);

836 ià(
pd
->
İ’_fd
 >=0)

837 
	`şo£
(
pd
->
İ’_fd
);

839 
pd
->
İ’_fd
 = -1;

840 
pd
->
id
[0] = 0;

842 
	`±h»ad_mu‹x_uÆock
(&
pd
->
mu‹x
);

844  
¡©
;

845 
	}
}

847 
HPMUD_RESULT
 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
	$µ_g‘_deviû_id
(
mud_deviû
 *
pd
, *
buf
, 
size
, *
Ën
)

849 
m
, 
fd
 = 
pd
->
İ’_fd
;

850 
HPMUD_RESULT
 
¡©
 = 
HPMUD_R_DEVICE_BUSY
;

852 *
Ën
=0;

854 
	`±h»ad_mu‹x_lock
(&
pd
->
mu‹x
);

856 ià(
fd
 < 0)

858 
¡©
 = 
HPMUD_R_INVALID_STATE
;

859 
	`BUG
("invalid get_device_id state\n");

860 
bugout
;

863 ià(
pd
->
io_mode
 =ğ
HPMUD_UNI_MODE
)

865 *
Ën
 = 
	`¡¾’
(
pd
->
id
);

866 
	`DBG
("usšg cached deviû_id io_mode=%d\n", 
pd
->
io_mode
);

870 
	`ioùl
(
fd
, 
PPGETMODE
, &
m
);

871 ià(
m
 & (
IEEE1284_MODE_ECPSWE
 | 
IEEE1284_MODE_ECP
))

873 *
Ën
 = 
	`¡¾’
(
pd
->
id
);

874 
	`DBG
("usšg cached deviû_id m=%x\n", 
m
);

878 ià(
pd
->
chªÃl_út
 == 0)

881 ià(
	`şaim_µ
(
fd
))

882 
bugout
;

883 *
Ën
 = 
	`deviû_id
(
fd
, 
pd
->
id
, (pd->id));

884 
	`»Ëa£_µ
(
fd
);

889 *
Ën
 = 
	`deviû_id
(
fd
, 
pd
->
id
, (pd->id));

894 ià(*
Ën
)

896 
	`memıy
(
buf
, 
pd
->
id
, *
Ën
 > 
size
 ? size : *len);

897 
¡©
 = 
HPMUD_R_OK
;

900 
bugout
:

901 
	`±h»ad_mu‹x_uÆock
(&
pd
->
mu‹x
);

902  
¡©
;

903 
	}
}

905 
HPMUD_RESULT
 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
	$µ_g‘_deviû_¡©us
(
mud_deviû
 *
pd
, *
¡©us
)

907 
fd
=
pd
->
İ’_fd
;

908 
HPMUD_RESULT
 
¡©
 = 
HPMUD_R_DEVICE_BUSY
;

909 
m
, 
r
=0;

911 
	`±h»ad_mu‹x_lock
(&
pd
->
mu‹x
);

913 ià(
fd
 < 0)

915 
¡©
 = 
HPMUD_R_INVALID_STATE
;

916 
	`BUG
("invalid get_device_id state\n");

917 
bugout
;

920 ià(
pd
->
io_mode
 =ğ
HPMUD_UNI_MODE
)

922 *
¡©us
 = 
NFAULT_BIT
;

923 
	`DBG
("usšg cached deviû_¡©u io_mode=%d\n", 
pd
->
io_mode
);

927 
	`ioùl
(
fd
, 
PPGETMODE
, &
m
);

928 ià(
m
 & (
IEEE1284_MODE_ECPSWE
 | 
IEEE1284_MODE_ECP
))

930 *
¡©us
 = 
NFAULT_BIT
;

931 
	`DBG
("usšg cached deviû_¡©u m=%x\n", 
m
);

935 ià(
pd
->
chªÃl_út
 == 0)

938 ià(
	`şaim_µ
(
fd
))

939 
bugout
;

940 
r
 = 
	`deviû_¡©us
(
fd
, 
¡©us
);

941 
	`»Ëa£_µ
(
fd
);

946 
r
 = 
	`deviû_¡©us
(
fd
, 
¡©us
);

951 ià(
r
 != 0)

952 
bugout
;

954 
¡©
 = 
HPMUD_R_OK
;

956 
bugout
:

957 
	`±h»ad_mu‹x_uÆock
(&
pd
->
mu‹x
);

958  
¡©
;

959 
	}
}

961 
HPMUD_RESULT
 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
	$µ_chªÃl_İ’
(
mud_deviû
 *
pd
, cÚ¡ *
¢
, 
HPMUD_CHANNEL
 *
cd
)

963 
šdex
;

964 
HPMUD_RESULT
 
¡©
 = 
HPMUD_R_DEVICE_BUSY
;

967 ià((
¡©
 = 
	`£rviû_to_chªÃl
(
pd
, 
¢
, &
šdex
)è!ğ
HPMUD_R_OK
)

968 
bugout
;

970 
	`±h»ad_mu‹x_lock
(&
pd
->
mu‹x
);

972 ià(
	`Ãw_chªÃl
(
pd
, 
šdex
, 
¢
))

974 
¡©
 = 
HPMUD_R_DEVICE_BUSY
;

978 ià((
¡©
 = (
pd
->
chªÃl
[
šdex
].
vf
.
İ’
)(&pd->chªÃl[šdex])è!ğ
HPMUD_R_OK
)

979 
	`d–_chªÃl
(
pd
, &pd->
chªÃl
[
šdex
]);

981 *
cd
 = 
šdex
;

984 
	`±h»ad_mu‹x_uÆock
(&
pd
->
mu‹x
);

986 
bugout
:

987  
¡©
;

988 
	}
}

990 
HPMUD_RESULT
 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
	$µ_chªÃl_şo£
(
mud_deviû
 *
pd
, 
mud_chªÃl
 *
pc
)

992 
HPMUD_RESULT
 
¡©
 = 
HPMUD_R_OK
;

994 
	`±h»ad_mu‹x_lock
(&
pd
->
mu‹x
);

995 
¡©
 = (
pc
->
vf
.
şo£
)(pc);

996 
	`d–_chªÃl
(
pd
, 
pc
);

997 
	`±h»ad_mu‹x_uÆock
(&
pd
->
mu‹x
);

999  
¡©
;

1000 
	}
}

1006 
HPMUD_RESULT
 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
	$µ_¿w_chªÃl_İ’
(
mud_chªÃl
 *
pc
)

1008 
mud_deviû
 *
pd
 = &
m¥
->
deviû
[
pc
->
dšdex
];

1009 ià(
	`şaim_µ
(
pd
->
İ’_fd
))

1010  
HPMUD_R_IO_ERROR
;

1011 
pc
->
fd
 = 
pd
->
İ’_fd
;

1012  
HPMUD_R_OK
;

1013 
	}
}

1015 
HPMUD_RESULT
 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
	$µ_¿w_chªÃl_şo£
(
mud_chªÃl
 *
pc
)

1017 ià(
pc
->
fd
 >= 0)

1018 
	`»Ëa£_µ
(
pc
->
fd
);

1019 
pc
->
fd
 = -1;

1020  
HPMUD_R_OK
;

1021 
	}
}

1027 
HPMUD_RESULT
 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
	$µ_mlc_chªÃl_İ’
(
mud_chªÃl
 *
pc
)

1029 
mud_deviû
 *
pd
 = &
m¥
->
deviû
[
pc
->
dšdex
];

1030 
HPMUD_RESULT
 
¡©
 = 
HPMUD_R_IO_ERROR
;

1031 
i
, 
m
;

1034 ià(
pd
->
chªÃl_út
==1)

1036 ià(
	`şaim_µ
(
pd
->
İ’_fd
))

1037 
bugout
;

1040 
m
 = 
IEEE1284_MODE_ECPSWE
;

1041 ià(
	`ioùl
(
pd
->
İ’_fd
, 
PPNEGOT
, &
m
))

1043 
	`BUG
("uÇbËØÃgÙŸ‹ % ECP mode: %m\n", 
pd
->
uri
);

1044 
bugout
;

1048 
	`eı_wr™e_addr
(
pd
->
İ’_fd
, 78);

1049 
	`eı_wr™e
(
pd
->
İ’_fd
, "\0", 1);

1050 
	`eı_wr™e_addr
(
pd
->
İ’_fd
, 77);

1053 ià(
	`MlcIn™
(
pc
, 
pd
->
İ’_fd
) != 0)

1054 
bugout
;

1057 
i
=0; i<
HPMUD_CHANNEL_MAX
; i++)

1058 
	`mem£t
(&
pd
->
chªÃl
[
i
].

, 0 , (
Œª¥Üt_©Œibu‹s
));

1060 
pd
->
mlc_fd
 =…d->
İ’_fd
;

1061 
pd
->
mlc_up
=1;

1065 ià(
	`MlcCÚfigSock‘
(
pc
, 
pd
->
mlc_fd
))

1066 
bugout
;

1068 ià(
	`MlcO³nChªÃl
(
pc
, 
pd
->
mlc_fd
))

1069 
bugout
;

1071 
pc
->
rút
 =…c->
ršdex
 = 0;

1073 
¡©
 = 
HPMUD_R_OK
;

1075 
bugout
:

1076  
¡©
;

1077 
	}
}

1079 
HPMUD_RESULT
 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
	$µ_mlc_chªÃl_şo£
(
mud_chªÃl
 *
pc
)

1081 
mud_deviû
 *
pd
 = &
m¥
->
deviû
[
pc
->
dšdex
];

1082 
HPMUD_RESULT
 
¡©
 = 
HPMUD_R_OK
;

1083 
m
;

1085 ià(
pd
->
mlc_up
)

1087 ià(
	`MlcClo£ChªÃl
(
pc
, 
pd
->
mlc_fd
))

1088 
¡©
 = 
HPMUD_R_IO_ERROR
;

1092 ià(
pd
->
chªÃl_út
==1)

1094 ià(
pd
->
mlc_up
)

1096 ià(
	`MlcEx™
(
pc
, 
pd
->
mlc_fd
))

1097 
¡©
 = 
HPMUD_R_IO_ERROR
;

1099 
pd
->
mlc_up
=0;

1101 
	`eı_wr™e_addr
(
pd
->
mlc_fd
, 78);

1102 
	`eı_wr™e
(
pd
->
mlc_fd
, "\0", 1);

1104 
m
 = 
IEEE1284_MODE_NIBBLE
;

1105 
	`ioùl
(
pd
->
mlc_fd
, 
PPNEGOT
, &
m
);

1106 
	`»Ëa£_µ
(
pd
->
mlc_fd
);

1109 
	`¦“p
(1);

1112  
¡©
;

1113 
	}
}

1119 
HPMUD_RESULT
 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
	$µ_dÙ4_chªÃl_İ’
(
mud_chªÃl
 *
pc
)

1121 
mud_deviû
 *
pd
 = &
m¥
->
deviû
[
pc
->
dšdex
];

1122 
HPMUD_RESULT
 
¡©
 = 
HPMUD_R_IO_ERROR
;

1123 
i
, 
m
;

1126 ià(
pd
->
chªÃl_út
==1)

1128 ià(
	`şaim_µ
(
pd
->
İ’_fd
))

1129 
bugout
;

1132 
m
 = 
IEEE1284_MODE_ECPSWE
;

1133 ià(
	`ioùl
(
pd
->
İ’_fd
, 
PPNEGOT
, &
m
))

1135 
	`BUG
("uÇbËØÃgÙŸ‹ % ECP mode: %m\n", 
pd
->
uri
);

1136 
bugout
;

1140 
	`eı_wr™e_addr
(
pd
->
İ’_fd
, 78);

1141 
	`eı_wr™e
(
pd
->
İ’_fd
, "\0", 1);

1142 
	`eı_wr™e_addr
(
pd
->
İ’_fd
, 77);

1145 ià(
	`DÙ4In™
(
pc
, 
pd
->
İ’_fd
) != 0)

1146 
bugout
;

1149 
i
=0; i<
HPMUD_CHANNEL_MAX
; i++)

1150 
	`mem£t
(&
pd
->
chªÃl
[
i
].

, 0 , (
Œª¥Üt_©Œibu‹s
));

1152 
pd
->
mlc_fd
 =…d->
İ’_fd
;

1153 
pd
->
mlc_up
=1;

1157 ià(
	`DÙ4G‘Sock‘
(
pc
, 
pd
->
mlc_fd
))

1158 
bugout
;

1160 ià(
	`DÙ4O³nChªÃl
(
pc
, 
pd
->
mlc_fd
))

1161 
bugout
;

1163 
pc
->
rút
 =…c->
ršdex
 = 0;

1165 
¡©
 = 
HPMUD_R_OK
;

1167 
bugout
:

1168  
¡©
;

1169 
	}
}

1171 
HPMUD_RESULT
 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
	$µ_dÙ4_chªÃl_şo£
(
mud_chªÃl
 *
pc
)

1173 
mud_deviû
 *
pd
 = &
m¥
->
deviû
[
pc
->
dšdex
];

1174 
HPMUD_RESULT
 
¡©
 = 
HPMUD_R_OK
;

1175 
m
;

1177 ià(
pd
->
mlc_up
)

1179 ià(
	`DÙ4Clo£ChªÃl
(
pc
, 
pd
->
mlc_fd
))

1180 
¡©
 = 
HPMUD_R_IO_ERROR
;

1184 ià(
pd
->
chªÃl_út
==1)

1186 ià(
pd
->
mlc_up
)

1188 ià(
	`DÙ4Ex™
(
pc
, 
pd
->
mlc_fd
))

1189 
¡©
 = 
HPMUD_R_IO_ERROR
;

1191 
pd
->
mlc_up
=0;

1193 
	`eı_wr™e_addr
(
pd
->
mlc_fd
, 78);

1194 
	`eı_wr™e
(
pd
->
mlc_fd
, "\0", 1);

1196 
m
 = 
IEEE1284_MODE_NIBBLE
;

1197 
	`ioùl
(
pd
->
mlc_fd
, 
PPNEGOT
, &
m
);

1198 
	`»Ëa£_µ
(
pd
->
mlc_fd
);

1201 
	`¦“p
(1);

1204  
¡©
;

1205 
	}
}

1211 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
	$µ_´obe_deviûs
(*
l¡
, 
l¡_size
, *
út
)

1213 
hpmud_mod–_©Œibu‹s
 
ma
;

1214 
dev
[
HPMUD_LINE_SIZE
];

1215 
rmod–
[128];

1216 
mod–
[128];

1217 
id
[1024];

1218 
i
, 
size
=0, 
fd
, 
m
;

1220 
i
=0; i < 4; i++)

1222 
	`¥rštf
(
dev
, "/dev/·½Üt%d", 
i
);

1224 ià((
fd
 = 
	`İ’
(
dev
, 
O_RDONLY
 | 
O_NOCTTY
)) < 0)

1228 ià(
	`ioùl
(
fd
, 
PPGETMODES
, &
m
) == 0)

1230 ià(
	`şaim_µ
(
fd
) == 0)

1232 ià(
	`deviû_id
(
fd
, 
id
, (id)è> 0 && 
	`is_hp
(id))

1234 
	`hpmud_g‘_mod–
(
id
, 
mod–
, (model));

1235 
	`hpmud_g‘_¿w_mod–
(
id
, 
rmod–
, (rmodel));

1236 
	`¢´štf
(
dev
, (dev), "hp:/·r/%s?deviû=/dev/·½Üt%d", 
mod–
, 
i
);

1239 
	`hpmud_qu”y_mod–
(
dev
, &
ma
);

1240 ià(
ma
.
suµÜt
 !ğ
HPMUD_SUPPORT_TYPE_HPLIP
)

1242 
	`»Ëa£_µ
(
fd
);

1243 
	`şo£
(
fd
);

1244 
	`BUG
("ignÜšg % suµÜt=%d\n", 
dev
, 
ma
.
suµÜt
);

1248 ià(
	`¡ºÿ£cmp
(
rmod–
, "hp ", 3) == 0)

1249 
size
 +ğ
	`¥rštf
(
l¡
+size,"dœeù % \"HP %s\" \"HP % LPT…¬pÜt%d HPLIP\" \"%s\"\n", 
dev
, &
rmod–
[3], &rmod–[3], 
i
, 
id
);

1251 
size
 +ğ
	`¥rštf
(
l¡
+size,"dœeù % \"HP %s\" \"HP % LPT…¬pÜt%d HPLIP\" \"%s\"\n", 
dev
, 
rmod–
,„mod–, 
i
, 
id
);

1252 *
út
+=1;

1254 
	`»Ëa£_µ
(
fd
);

1258 
	`BUG
("uÇbËØ´ob%s: %m\n", 
dev
);

1261 
	`şo£
(
fd
);

1263  
size
;

1264 
	}
}

1266 
HPMUD_RESULT
 
	$hpmud_make_·r_uri
(cÚ¡ *
dnode
, *
uri
, 
uri_size
, *
by‹s_»ad
)

1268 
mod–
[128];

1269 
id
[1024];

1270 
HPMUD_RESULT
 
¡©
 = 
HPMUD_R_IO_ERROR
;

1271 
fd
=-1, 
m
;

1273 
	`DBG
("[%d] hpmud_make_·r_uri(èdnode=%s\n", 
	`g‘pid
(), 
dnode
);

1275 *
by‹s_»ad
=0;

1277 
uri
[0]=0;

1279 ià((
fd
 = 
	`İ’
(
dnode
, 
O_RDONLY
 | 
O_NOCTTY
)) < 0)

1281 
	`BUG
("uÇbËØİ’ %s: %m\n", 
dnode
);

1282 
bugout
;

1285 ià(
	`ioùl
(
fd
, 
PPGETMODES
, &
m
))

1287 
	`BUG
("uÇbËØmakur˜%s: %m\n", 
dnode
);

1288 
bugout
;

1291 ià(
	`şaim_µ
(
fd
))

1293 
	`BUG
("uÇbËØmakur˜%s: %m\n", 
dnode
);

1294 
bugout
;

1297 ià(
	`deviû_id
(
fd
, 
id
, (id)è> 0 && 
	`is_hp
(id))

1299 
	`hpmud_g‘_mod–
(
id
, 
mod–
, (model));

1300 *
by‹s_»ad
 = 
	`¢´štf
(
uri
, 
uri_size
, "hp:/·r/%s?deviû=%s", 
mod–
, 
dnode
);

1302 
	`»Ëa£_µ
(
fd
);

1304 
¡©
 = 
HPMUD_R_OK
;

1306 
bugout
:

1307 ià(
fd
 >= 0)

1308 
	`şo£
(
fd
);

1309  
¡©
;

1310 
	}
}

	@io/hpmud/pp.h

26 #iâdeà
_PP_H


27 
	#_PP_H


	)

29 
	~<sys/ioùl.h
>

30 
	~<lšux/·½Üt.h
>

31 
	~<lšux/µdev.h
>

32 
	~"hpmud.h
"

33 
	~"hpmudi.h
"

70 
	#PP_DEVICE_TIMEOUT
 30000000

	)

73 
	#PP_SIGNAL_TIMEOUT
 100000

	)

74 
	#PP_SETUP_TIMEOUT
 10

	)

76 
	g_mud_deviû
;

77 
	g_mud_chªÃl
;

79 
_mud_deviû_vf
 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
µ_mud_deviû_vf
;

81 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
µ_wr™e
(
fd
, cÚ¡ *
buf
, 
size
, 
u£c
);

82 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
µ_»ad
(
fd
, *
buf
, 
size
, 
u£c
);

83 
HPMUD_RESULT
 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
µ_İ’
(
_mud_deviû
 *
pd
);

84 
HPMUD_RESULT
 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
µ_şo£
(
_mud_deviû
 *
pd
);

85 
HPMUD_RESULT
 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
µ_g‘_deviû_id
(
_mud_deviû
 *
pd
, *
buf
, 
size
, *
Ën
);

86 
HPMUD_RESULT
 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
µ_g‘_deviû_¡©us
(
_mud_deviû
 *
pd
, *
¡©us
);

87 
HPMUD_RESULT
 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
µ_chªÃl_İ’
(
_mud_deviû
 *
pd
, cÚ¡ *
¢
, 
HPMUD_CHANNEL
 *
cd
);

88 
HPMUD_RESULT
 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
µ_chªÃl_şo£
(
_mud_deviû
 *
pd
, 
_mud_chªÃl
 *
pc
);

90 
HPMUD_RESULT
 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
µ_¿w_chªÃl_İ’
(
_mud_chªÃl
 *
pc
);

91 
HPMUD_RESULT
 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
µ_¿w_chªÃl_şo£
(
_mud_chªÃl
 *
pc
);

92 
HPMUD_RESULT
 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
µ_mlc_chªÃl_İ’
(
_mud_chªÃl
 *
pc
);

93 
HPMUD_RESULT
 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
µ_mlc_chªÃl_şo£
(
_mud_chªÃl
 *
pc
);

94 
HPMUD_RESULT
 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
µ_dÙ4_chªÃl_İ’
(
_mud_chªÃl
 *
pc
);

95 
HPMUD_RESULT
 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
µ_dÙ4_chªÃl_şo£
(
_mud_chªÃl
 *
pc
);

97 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
µ_´obe_deviûs
(*
l¡
, 
l¡_size
, *
út
);

	@io/mudext/hpmudext.c

27 
	~<PythÚ.h
>

28 
	~<¡d¬g.h
>

29 
	~"hpmud.h
"

30 
	~"hpmudi.h
"

33 #ià
PY_VERSION_HEX
 < 0x02050000

34 
	tPy_ssize_t
;

35 
	#PY_SSIZE_T_MAX
 
INT_MAX


	)

36 
	#PY_SSIZE_T_MIN
 
INT_MIN


	)

39 
	#_STRINGIZE
(
x
è#x

	)

40 
	#STRINGIZE
(
x
è
	`_STRINGIZE
(x)

	)

81 
PyObjeù
 *
	$İ’_deviû
(
PyObjeù
 *
£lf
, PyObjeù *
¬gs
)

83 * 
uri
;

84 
HPMUD_IO_MODE
 
io_mode
;

85 
HPMUD_DEVICE
 
dd
;

86 
HPMUD_RESULT
 
»suÉ
 = 
HPMUD_R_OK
;

88 ià(!
	`PyArg_P¬£Tu¶e
(
¬gs
, "si", &
uri
, &
io_mode
))

89  
NULL
;

91 
Py_BEGIN_ALLOW_THREADS


92 
»suÉ
 = 
	`hpmud_İ’_deviû
(
uri
, 
io_mode
, &
dd
);

93 
Py_END_ALLOW_THREADS


95  
	`Py_BudV®ue
("(ii)", 
»suÉ
, 
dd
);

96 
	}
}

98 
PyObjeù
 *
	$şo£_deviû
(
PyObjeù
 *
£lf
, PyObjeù *
¬gs
)

100 
HPMUD_DEVICE
 
dd
;

101 
HPMUD_RESULT
 
»suÉ
 = 
HPMUD_R_OK
;

103 ià(!
	`PyArg_P¬£Tu¶e
(
¬gs
, "i", &
dd
))

104  
NULL
;

106 
Py_BEGIN_ALLOW_THREADS


107 
»suÉ
 = 
	`hpmud_şo£_deviû
(
dd
);

108 
Py_END_ALLOW_THREADS


110  
	`Py_BudV®ue
("i", 
»suÉ
);

111 
	}
}

113 
PyObjeù
 *
	$g‘_deviû_id
(
PyObjeù
 *
£lf
, PyObjeù *
¬gs
)

115 
HPMUD_DEVICE
 
dd
;

116 
HPMUD_RESULT
 
»suÉ
 = 
HPMUD_R_OK
;

117 
buf
[
HPMUD_BUFFER_SIZE
];

118 
by‹s_»ad
 = 0;

120 ià(!
	`PyArg_P¬£Tu¶e
(
¬gs
, "i", &
dd
))

121  
NULL
;

123 
Py_BEGIN_ALLOW_THREADS


124 
»suÉ
 = 
	`hpmud_g‘_deviû_id
(
dd
, 
buf
, 
HPMUD_BUFFER_SIZE
, &
by‹s_»ad
);

125 
Py_END_ALLOW_THREADS


127  
	`Py_BudV®ue
("(is#)", 
»suÉ
, 
buf
, 
by‹s_»ad
);

129 
	}
}

131 
PyObjeù
 *
	$´obe_deviûs
(
PyObjeù
 *
£lf
, PyObjeù *
¬gs
)

133 
HPMUD_BUS_ID
 
bus
;

134 
HPMUD_RESULT
 
»suÉ
 = 
HPMUD_R_OK
;

135 
út
 = 0;

136 
by‹s_»ad
 = 0;

137 
buf
[
HPMUD_BUFFER_SIZE
 * 4];

139 ià(!
	`PyArg_P¬£Tu¶e
(
¬gs
, "i", &
bus
))

140  
NULL
;

142 
Py_BEGIN_ALLOW_THREADS


143 
»suÉ
 = 
	`hpmud_´obe_deviûs
(
bus
, 
buf
, 
HPMUD_BUFFER_SIZE
 * 4, &
út
, &
by‹s_»ad
);

144 
Py_END_ALLOW_THREADS


146  
	`Py_BudV®ue
("(is#)", 
»suÉ
, 
buf
, 
by‹s_»ad
);

147 
	}
}

149 
PyObjeù
 *
	$İ’_chªÃl
(
PyObjeù
 *
£lf
, PyObjeù *
¬gs
)

151 
HPMUD_RESULT
 
»suÉ
 = 
HPMUD_R_OK
;

152 
HPMUD_DEVICE
 
dd
 = -1;

153 * 
chªÃl_Çme
;

154 
HPMUD_CHANNEL
 
cd
 = -1;

156 ià(!
	`PyArg_P¬£Tu¶e
(
¬gs
, "is", &
dd
, &
chªÃl_Çme
))

157  
NULL
;

159 
Py_BEGIN_ALLOW_THREADS


160 
»suÉ
 = 
	`hpmud_İ’_chªÃl
(
dd
, 
chªÃl_Çme
, &
cd
);

161 
Py_END_ALLOW_THREADS


163  
	`Py_BudV®ue
("(ii)", 
»suÉ
, 
cd
);

165 
	}
}

167 
PyObjeù
 *
	$şo£_chªÃl
(
PyObjeù
 *
£lf
, PyObjeù *
¬gs
)

169 
HPMUD_RESULT
 
»suÉ
 = 
HPMUD_R_OK
;

170 
HPMUD_DEVICE
 
dd
;

171 
HPMUD_CHANNEL
 
cd
;

173 ià(!
	`PyArg_P¬£Tu¶e
(
¬gs
, "ii", &
dd
, &
cd
))

174  
NULL
;

176 
Py_BEGIN_ALLOW_THREADS


177 
»suÉ
 = 
	`hpmud_şo£_chªÃl
(
dd
, 
cd
);

178 
Py_END_ALLOW_THREADS


180  
	`Py_BudV®ue
("i", 
»suÉ
);

181 
	}
}

183 
PyObjeù
 *
	$wr™e_chªÃl
(
PyObjeù
 *
£lf
, PyObjeù *
¬gs
)

185 
HPMUD_RESULT
 
»suÉ
 = 
HPMUD_R_OK
;

186 
HPMUD_DEVICE
 
dd
;

187 
HPMUD_CHANNEL
 
cd
;

188 
timeout
 = 30;

189 * 
buf
;

190 
buf_size
 = 0;

191 
by‹s_wr™‹n
 = 0;

193 ià(!
	`PyArg_P¬£Tu¶e
(
¬gs
, "iis#|i", &
dd
, &
cd
, &
buf
, &
buf_size
, &
timeout
))

194  
NULL
;

196 
Py_BEGIN_ALLOW_THREADS


197 
»suÉ
 = 
	`hpmud_wr™e_chªÃl
(
dd
, 
cd
, 
buf
, 
buf_size
, 
timeout
, &
by‹s_wr™‹n
);

198 
Py_END_ALLOW_THREADS


200  
	`Py_BudV®ue
("(ii)", 
»suÉ
, 
by‹s_wr™‹n
);

201 
	}
}

203 
PyObjeù
 *
	$»ad_chªÃl
(
PyObjeù
 *
£lf
, PyObjeù *
¬gs
)

205 
HPMUD_RESULT
 
»suÉ
 = 
HPMUD_R_OK
;

206 
HPMUD_DEVICE
 
dd
;

207 
HPMUD_CHANNEL
 
cd
;

208 
timeout
 = 30;

209 
buf
[
HPMUD_BUFFER_SIZE
];

210 
by‹s_»ad
 = 0;

211 
by‹s_to_»ad
;

213 ià(!
	`PyArg_P¬£Tu¶e
(
¬gs
, "iii|i", &
dd
, &
cd
, &
by‹s_to_»ad
, &
timeout
))

214  
NULL
;

216 ià(
by‹s_to_»ad
 > 
HPMUD_BUFFER_SIZE
)

217  
	`Py_BudV®ue
("(is#)", 
HPMUD_R_INVALID_LENGTH
, "", 0);

219 
Py_BEGIN_ALLOW_THREADS


220 
»suÉ
 = 
	`hpmud_»ad_chªÃl
(
dd
, 
cd
, (*)
buf
, 
by‹s_to_»ad
, 
timeout
, &
by‹s_»ad
);

221 
Py_END_ALLOW_THREADS


223  
	`Py_BudV®ue
(
FORMAT_STRING1
, 
»suÉ
, 
buf
, 
by‹s_»ad
);

224 
	}
}

226 
PyObjeù
 *
	$£t_pml
(
PyObjeù
 *
£lf
, PyObjeù *
¬gs
)

228 
HPMUD_RESULT
 
»suÉ
 = 
HPMUD_R_OK
;

229 
HPMUD_DEVICE
 
dd
;

230 
HPMUD_CHANNEL
 
cd
;

231 * 
oid
;

232 
ty³
;

233 * 
d©a
;

234 
d©a_size
;

235 
pml_»suÉ
;

237 ià(!
	`PyArg_P¬£Tu¶e
(
¬gs
, "iisis#", &
dd
, &
cd
, &
oid
, &
ty³
, &
d©a
, &
d©a_size
))

238  
NULL
;

240 
Py_BEGIN_ALLOW_THREADS


241 
»suÉ
 = 
	`hpmud_£t_pml
(
dd
, 
cd
, 
oid
, 
ty³
, (*)
d©a
, 
d©a_size
, &
pml_»suÉ
);

242 
Py_END_ALLOW_THREADS


244  
	`Py_BudV®ue
("(ii)", 
»suÉ
, 
pml_»suÉ
);

245 
	}
}

247 
PyObjeù
 *
	$g‘_pml
(
PyObjeù
 *
£lf
, PyObjeù *
¬gs
)

249 
HPMUD_RESULT
 
»suÉ
 = 
HPMUD_R_OK
;

250 
HPMUD_DEVICE
 
dd
;

251 
HPMUD_CHANNEL
 
cd
;

252 * 
oid
;

253 
ty³
;

254 
buf
[
HPMUD_BUFFER_SIZE
 * 4];

255 
pml_»suÉ
;

256 
by‹s_»ad
 = 0;

258 ià(!
	`PyArg_P¬£Tu¶e
(
¬gs
, "iisi", &
dd
, &
cd
, &
oid
, &
ty³
))

259  
NULL
;

261 
Py_BEGIN_ALLOW_THREADS


262 
»suÉ
 = 
	`hpmud_g‘_pml
(
dd
, 
cd
, 
oid
, (*)
buf
, 
HPMUD_BUFFER_SIZE
 * 4, &
by‹s_»ad
, &
ty³
, &
pml_»suÉ
);

263 
Py_END_ALLOW_THREADS


264  
	`Py_BudV®ue
(
FORMAT_STRING
, 
»suÉ
, 
buf
, 
by‹s_»ad
, 
ty³
, 
pml_»suÉ
);

265 
	}
}

267 
PyObjeù
 *
	$make_usb_uri
(
PyObjeù
 *
£lf
, PyObjeù *
¬gs
)

269 * 
bu¢um
;

270 * 
devnum
;

271 
uri
[
HPMUD_BUFFER_SIZE
];

272 
HPMUD_RESULT
 
»suÉ
 = 
HPMUD_R_OK
;

273 
by‹s_»ad
 = 0;

275 ià(!
	`PyArg_P¬£Tu¶e
(
¬gs
, "ss", &
bu¢um
, &
devnum
))

276  
NULL
;

278 
Py_BEGIN_ALLOW_THREADS


279 
»suÉ
 = 
	`hpmud_make_usb_uri
(
bu¢um
, 
devnum
, 
uri
, 
HPMUD_BUFFER_SIZE
, &
by‹s_»ad
);

280 
Py_END_ALLOW_THREADS


282  
	`Py_BudV®ue
(
FORMAT_STRING1
, 
»suÉ
, 
uri
, 
by‹s_»ad
);

283 
	}
}

285 #ifdeà
HAVE_LIBNETSNMP


286 
PyObjeù
 *
	$make_Ãt_uri
(
PyObjeù
 *
£lf
, PyObjeù *
¬gs
)

288 * 

;

289 
pÜt
;

290 
uri
[
HPMUD_BUFFER_SIZE
];

291 
HPMUD_RESULT
 
»suÉ
 = 
HPMUD_R_OK
;

292 
by‹s_»ad
 = 0;

294 ià(!
	`PyArg_P¬£Tu¶e
(
¬gs
, "si", &

, &
pÜt
))

295  
NULL
;

297 
Py_BEGIN_ALLOW_THREADS


298 
»suÉ
 = 
	`hpmud_make_Ãt_uri
(

, 
pÜt
, 
uri
, 
HPMUD_BUFFER_SIZE
, &
by‹s_»ad
);

299 
Py_END_ALLOW_THREADS


301  
	`Py_BudV®ue
(
FORMAT_STRING1
, 
»suÉ
, 
uri
, 
by‹s_»ad
);

302 
	}
}

304 
PyObjeù
 *
	$make_Ãt_uri
(
PyObjeù
 *
£lf
, PyObjeù *
¬gs
)

306  
	`Py_BudV®ue
(
FORMAT_STRING1
, 
HPMUD_R_INVALID_URI
, "", 0);

307 
	}
}

310 #ifdeà
HAVE_LIBNETSNMP


311 
PyObjeù
 *
	$make_zc_uri
(
PyObjeù
 *
£lf
, PyObjeù *
¬gs
)

313 *
hn
;

314 
pÜt
;

315 
uri
[
HPMUD_BUFFER_SIZE
];

316 
by‹s_»ad
 = 0;

317 
HPMUD_RESULT
 
»suÉ
 = 
HPMUD_R_OK
;

319 ià(!
	`PyArg_P¬£Tu¶e
(
¬gs
, "si", &
hn
, &
pÜt
))

320  
NULL
;

322 
Py_BEGIN_ALLOW_THREADS


323 
»suÉ
 = 
	`hpmud_make_mdns_uri
(
hn
, 
pÜt
, 
uri
, 
HPMUD_BUFFER_SIZE
, &
by‹s_»ad
);

324 
Py_END_ALLOW_THREADS


326  
	`Py_BudV®ue
(
FORMAT_STRING1
, 
»suÉ
, 
uri
, 
by‹s_»ad
);

327 
	}
}

329 
PyObjeù
 *
	$make_zc_uri
(
PyObjeù
 *
£lf
, PyObjeù *
¬gs
)

331  
	`Py_BudV®ue
(
FORMAT_STRING1
, 
HPMUD_R_INVALID_URI
, "", 0);

332 
	}
}

335 #ifdeà
HAVE_LIBNETSNMP


336 
PyObjeù
 *
	$g‘_zc__add»ss
(
PyObjeù
 *
£lf
, PyObjeù *
¬gs
)

338 *
hn
;

339 

[
HPMUD_BUFFER_SIZE
] = {0,};

340 
HPMUD_RESULT
 
»suÉ
 = 
HPMUD_R_OK
;

342 ià(!
	`PyArg_P¬£Tu¶e
(
¬gs
, "s", &
hn
))

343  
NULL
;

345 
Py_BEGIN_ALLOW_THREADS


347 if(
	`mdns_lookup
(
hn
, 

è!ğ
MDNS_STATUS_OK
)

348 
»suÉ
 = 
HPMUD_R_INVALID_MDNS
;

350 
Py_END_ALLOW_THREADS


352  
	`Py_BudV®ue
("(is)", 
»suÉ
, 

);

353 
	}
}

355 
PyObjeù
 *
	$g‘_zc__add»ss
(
PyObjeù
 *
£lf
, PyObjeù *
¬gs
)

357  
	`Py_BudV®ue
("(is)", 
HPMUD_R_INVALID_URI
, "");

358 
	}
}

361 #ifdeà
HAVE_PPORT


362 
PyObjeù
 *
	$make_·r_uri
(
PyObjeù
 *
£lf
, PyObjeù *
¬gs
)

364 * 
devnode
;

365 
uri
[
HPMUD_BUFFER_SIZE
];

366 
HPMUD_RESULT
 
»suÉ
 = 
HPMUD_R_OK
;

367 
by‹s_»ad
 = 0;

369 ià(!
	`PyArg_P¬£Tu¶e
(
¬gs
, "s", &
devnode
))

370  
NULL
;

372 
Py_BEGIN_ALLOW_THREADS


373 
»suÉ
 = 
	`hpmud_make_·r_uri
(
devnode
, 
uri
, 
HPMUD_BUFFER_SIZE
, &
by‹s_»ad
);

374 
Py_END_ALLOW_THREADS


376  
	`Py_BudV®ue
(
FORMAT_STRING1
, 
»suÉ
, 
uri
, 
by‹s_»ad
);

377 
	}
}

379 
PyObjeù
 *
	$make_·r_uri
(
PyObjeù
 *
£lf
, PyObjeù *
¬gs
)

381  
	`Py_BudV®ue
(
FORMAT_STRING1
, 
HPMUD_R_INVALID_URI
, "", 0);

382 
	}
}

395 
PyM‘hodDef
 
	gmudext_funùiÚs
[] =

397 {"İ’_deviû", (
PyCFunùiÚ
)
İ’_deviû
, 
METH_VARARGS
 },

398 {"şo£_deviû", (
PyCFunùiÚ
)
şo£_deviû
, 
METH_VARARGS
 },

399 {"g‘_deviû_id", (
PyCFunùiÚ
)
g‘_deviû_id
, 
METH_VARARGS
 },

400 {"´obe_deviûs", (
PyCFunùiÚ
)
´obe_deviûs
, 
METH_VARARGS
 },

401 {"İ’_chªÃl", (
PyCFunùiÚ
)
İ’_chªÃl
, 
METH_VARARGS
 },

402 {"wr™e_chªÃl", (
PyCFunùiÚ
)
wr™e_chªÃl
, 
METH_VARARGS
 },

403 {"»ad_chªÃl", (
PyCFunùiÚ
)
»ad_chªÃl
, 
METH_VARARGS
 },

404 {"şo£_chªÃl", (
PyCFunùiÚ
)
şo£_chªÃl
, 
METH_VARARGS
 },

405 {"£t_pml", (
PyCFunùiÚ
)
£t_pml
, 
METH_VARARGS
 },

406 {"g‘_pml", (
PyCFunùiÚ
)
g‘_pml
, 
METH_VARARGS
 },

407 {"make_usb_uri", (
PyCFunùiÚ
)
make_usb_uri
, 
METH_VARARGS
 },

408 {"make_Ãt_uri", (
PyCFunùiÚ
)
make_Ãt_uri
, 
METH_VARARGS
 },

409 {"make_zc_uri", (
PyCFunùiÚ
)
make_zc_uri
, 
METH_VARARGS
 },

410 {"g‘_zc__add»ss", (
PyCFunùiÚ
)
g‘_zc__add»ss
, 
METH_VARARGS
 },

411 {"make_·r_uri", (
PyCFunùiÚ
)
make_·r_uri
, 
METH_VARARGS
 },

412 { 
NULL
, NULL }

416 
	gmudext_docum’tiÚ
[] = "Pythonƒxtension for HP multi-pointransport driver";

418 
	$šsšt
(
PyObjeù
 *
d
, *
Çme
, 
v®ue
)

420 
PyObjeù
 *
v
 = 
	`PyLÚg_FromLÚg
((è
v®ue
);

422 ià(!
v
 || 
	`PyDiù_S‘I‹mSŒšg
(
d
, 
Çme
, v))

423 
	`Py_F©®E¼Ü
("Initialization failed.");

425 
	`Py_DECREF
(
v
);

426 
	}
}

428 
	$šs¡r
(
PyObjeù
 *
d
, *
Çme
, *
v®ue
)

430 
PyObjeù
 *
v
 = 
	`PyUnicode_FromSŒšg
(
v®ue
);

432 ià(!
v
 || 
	`PyDiù_S‘I‹mSŒšg
(
d
, 
Çme
, v))

433 
	`Py_F©®E¼Ü
("Initialization failed.");

435 
	`Py_DECREF
(
v
);

436 
	}
}

438 #ià
PY_MAJOR_VERSION
 >= 3

439 
PyModuËDef
 
	gmoduËdef
 = {

440 
PyModuËDef_HEAD_INIT
,

442 
mudext_docum’tiÚ
,

444 
mudext_funùiÚs
,

445 
NULL
,

446 
NULL
,

447 
NULL
,

448 
NULL
,

525 
	$MOD_INIT
(
hpmudext
) {

526 
PyObjeù
* 
mod
 ;

527 
	`MOD_DEF
(
mod
, "hpmudext", 
mudext_docum’tiÚ
, 
mudext_funùiÚs
);

528 ià(
mod
 =ğ
NULL
)

529  
MOD_ERROR_VAL
;

531 
PyObjeù
* 
d
 = 
	`PyModuË_G‘Diù
(
mod
);

534 
	`šsšt
(
d
, "HPMUD_R_OK", 
HPMUD_R_OK
);

535 
	`šsšt
(
d
, "HPMUD_R_INVALID_DEVICE", 
HPMUD_R_INVALID_DEVICE
);

536 
	`šsšt
(
d
, "HPMUD_R_INVALID_DESCRIPTOR", 
HPMUD_R_INVALID_DESCRIPTOR
);

537 
	`šsšt
(
d
, "HPMUD_R_INVALID_URI", 
HPMUD_R_INVALID_URI
);

538 
	`šsšt
(
d
, "HPMUD_R_INVALID_LENGTH", 
HPMUD_R_INVALID_LENGTH
);

539 
	`šsšt
(
d
, "HPMUD_R_IO_ERROR", 
HPMUD_R_IO_ERROR
);

540 
	`šsšt
(
d
, "HPMUD_R_DEVICE_BUSY", 
HPMUD_R_DEVICE_BUSY
);

541 
	`šsšt
(
d
, "HPMUD_R_INVALID_SN", 
HPMUD_R_INVALID_SN
);

542 
	`šsšt
(
d
, "HPMUD_R_INVALID_CHANNEL_ID", 
HPMUD_R_INVALID_CHANNEL_ID
);

543 
	`šsšt
(
d
, "HPMUD_R_INVALID_STATE", 
HPMUD_R_INVALID_STATE
);

544 
	`šsšt
(
d
, "HPMUD_R_INVALID_DEVICE_OPEN", 
HPMUD_R_INVALID_DEVICE_OPEN
);

545 
	`šsšt
(
d
, "HPMUD_R_INVALID_DEVICE_NODE", 
HPMUD_R_INVALID_DEVICE_NODE
);

546 
	`šsšt
(
d
, "HPMUD_R_INVALID_IP", 
HPMUD_R_INVALID_IP
);

547 
	`šsšt
(
d
, "HPMUD_R_INVALID_IP_PORT", 
HPMUD_R_INVALID_IP_PORT
);

548 
	`šsšt
(
d
, "HPMUD_R_INVALID_TIMEOUT", 
HPMUD_R_INVALID_TIMEOUT
);

549 
	`šsšt
(
d
, "HPMUD_R_DATFILE_ERROR", 
HPMUD_R_DATFILE_ERROR
);

550 
	`šsšt
(
d
, "HPMUD_R_IO_TIMEOUT", 
HPMUD_R_IO_TIMEOUT
);

553 
	`šsšt
(
d
, "HPMUD_UNI_MODE", 
HPMUD_UNI_MODE
);

554 
	`šsšt
(
d
, "HPMUD_RAW_MODE",
HPMUD_RAW_MODE
);

555 
	`šsšt
(
d
, "HPMUD_DOT4_MODE", 
HPMUD_DOT4_MODE
);

556 
	`šsšt
(
d
, "HPMUD_DOT4_PHOENIX_MODE", 
HPMUD_DOT4_PHOENIX_MODE
);

557 
	`šsšt
(
d
, "HPMUD_DOT4_BRIDGE_MODE", 
HPMUD_DOT4_BRIDGE_MODE
);

558 
	`šsšt
(
d
, "HPMUD_MLC_GUSHER_MODE", 
HPMUD_MLC_GUSHER_MODE
);

559 
	`šsšt
(
d
, "HPMUD_MLC_MISER_MODE", 
HPMUD_MLC_MISER_MODE
);

562 
	`šsšt
(
d
, "HPMUD_BUS_NA", 
HPMUD_BUS_NA
);

563 
	`šsšt
(
d
, "HPMUD_BUS_USB", 
HPMUD_BUS_USB
);

564 
	`šsšt
(
d
, "HPMUD_BUS_PARALLEL", 
HPMUD_BUS_PARALLEL
);

565 
	`šsšt
(
d
, "HPMUD_BUS_ALL", 
HPMUD_BUS_ALL
);

568 
	`šs¡r
(
d
, "HPMUD_S_PRINT_CHANNEL", 
HPMUD_S_PRINT_CHANNEL
);

569 
	`šs¡r
(
d
, "HPMUD_S_PML_CHANNEL", 
HPMUD_S_PML_CHANNEL
);

570 
	`šs¡r
(
d
, "HPMUD_S_SCAN_CHANNEL", 
HPMUD_S_SCAN_CHANNEL
);

571 
	`šs¡r
(
d
, "HPMUD_S_FAX_SEND_CHANNEL", 
HPMUD_S_FAX_SEND_CHANNEL
);

572 
	`šs¡r
(
d
, "HPMUD_S_CONFIG_UPLOAD_CHANNEL", 
HPMUD_S_CONFIG_UPLOAD_CHANNEL
);

573 
	`šs¡r
(
d
, "HPMUD_S_CONFIG_DOWNLOAD_CHANNEL", 
HPMUD_S_CONFIG_DOWNLOAD_CHANNEL
);

574 
	`šs¡r
(
d
, "HPMUD_S_MEMORY_CARD_CHANNEL", 
HPMUD_S_MEMORY_CARD_CHANNEL
);

575 
	`šs¡r
(
d
, "HPMUD_S_EWS_CHANNEL", 
HPMUD_S_EWS_CHANNEL
);

576 
	`šs¡r
(
d
, "HPMUD_S_EWS_LEDM_CHANNEL", 
HPMUD_S_EWS_LEDM_CHANNEL
);

577 
	`šs¡r
(
d
, "HPMUD_S_SOAP_SCAN", 
HPMUD_S_SOAP_SCAN
);

578 
	`šs¡r
(
d
, "HPMUD_S_SOAP_FAX", 
HPMUD_S_SOAP_FAX
);

579 
	`šs¡r
(
d
, "HPMUD_S_DEVMGMT_CHANNEL", 
HPMUD_S_DEVMGMT_CHANNEL
);

580 
	`šs¡r
(
d
, "HPMUD_S_WIFI_CHANNEL", 
HPMUD_S_WIFI_CHANNEL
);

581 
	`šs¡r
(
d
, "HPMUD_S_MARVELL_FAX_CHANNEL", 
HPMUD_S_MARVELL_FAX_CHANNEL
);

582 
	`šs¡r
(
d
, "HPMUD_S_LEDM_SCAN", 
HPMUD_S_LEDM_SCAN
);

583 
	`šs¡r
(
d
, "HPMUD_S_MARVELL_EWS_CHANNEL", 
HPMUD_S_MARVELL_EWS_CHANNEL
);

586 
	`šsšt
(
d
, "HPMUD_BUFFER_SIZE", 
HPMUD_BUFFER_SIZE
);

589  
	`MOD_SUCCESS_VAL
(
mod
);

591 
	}
}

	@ip/hpip.h

48 #ià!
defšed
 
HPIP_INC


49 
	#HPIP_INC


	)

51 #ià
defšed
(
__ılu¥lus
)

55 
	~<¡dlib.h
>

59 #undeà
LITTLE_ENDIAN


61 
	#FAR


	)

62 
	#WINAPI


	)

63 
	#EXPORT
(
x
è
	)
x

65 
	tBYTE
, *
	tPBYTE
, 
	tFAR
 *
	tLPBYTE
;

66 
	tWORD
, *
	tPWORD
, 
	tFAR
 *
	tLPWORD
;

67 
	tUSHORT
, *
	tPUSHORT
, 
	tFAR
 *
	tLPUSHORT
;

68 
	tDWORD
, *
	tPDWORD
, 
	tFAR
 *
	tLPDWORD
;

69 
	tUINT
, *
	tPUINT
, 
	tFAR
 *
	tLPUINT
;

70 
	tULONG
, *
	tPULONG
, 
	tFAR
 *
	tLPULONG
;

71 #iâdeà
FALSE


72 
	#FALSE
 0

	)

74 #iâdeà
TRUE


75 
	#TRUE
 1

	)

77 
	tBOOL
;

80 
	tVOID
;

81 *
	tPVOID
, 
	tFAR
 *
	tLPVOID
;

82 
	t__št64
;

85 
BYTE
 
rgbRed
:8;

86 
BYTE
 
rgbG»’
:8;

87 
BYTE
 
rgbBlue
:8;

88 } 
	t__©Œibu‹__
((
	t·cked
)è
	tRGBQUAD
;

98 
	#IP_MAX_XFORMS
 20

	)

104 
	#IP_READY_FOR_DATA
 0X0001u

	)

105 
	#IP_PARSED_HEADER
 0x0002u

	)

106 
	#IP_CONSUMED_ROW
 0x0004u

	)

107 
	#IP_PRODUCED_ROW
 0x0008u

	)

108 
	#IP_INPUT_ERROR
 0x0010u

	)

109 
	#IP_FATAL_ERROR
 0x0020u

	)

110 
	#IP_NEW_INPUT_PAGE
 0x0040u

	)

111 
	#IP_NEW_OUTPUT_PAGE
 0x0080u

	)

112 
	#IP_WRITE_INSERT_OK
 0x0100u

	)

113 
	#IP_DONE
 0x0200u

	)

121 
iPix–sP”Row
;

122 
iB™sP”Pix–
;

123 
iCompÚ’tsP”Pix–
;

124 
lHÜizDPI
;

125 
lV”tDPI
;

126 
lNumRows
;

127 
iNumPages
;

128 
iPageNum
;

129 } 
	tIP_IMAGE_TRAITS
, *
	tPIP_IMAGE_TRAITS
, 
	tFAR
*
	tLPIP_IMAGE_TRAITS
;

132 
DWORD
 
dwÜd
;

133 
PVOID
 
pvoid
;

134 
__št64
 
i64
;

135 
RGBQUAD
 
rgbquad
;

136 
æ
;

137 } 
	tDWORD_OR_PVOID
;

140 
	~"xfÜm.h
"

172 
	tFAR
*
	tIP_HANDLE
, *FAR*
	tPIP_HANDLE
, FAR*FAR*
	tLPIP_HANDLE
;

174 (
WINAPI
 *
	tLPIP_PEEK_FUNC
)(

175 
	tIP_HANDLE
 
	thJob
,

176 
	tLPIP_IMAGE_TRAITS
 
	tpT¿™s
,

177 
	tnBy‹s
,

178 
	tLPBYTE
 
	tpBuf
,

179 
	tnFePos
,

180 
	tPVOID
 
	tpU£rd©a
);

189 
X_FAX_ENCODE
, 
X_FAX_DECODE
,

190 
X_PCX_ENCODE
, 
X_PCX_DECODE
,

192 
X_JPG_ENCODE
, 
X_JPG_DECODE
, 
X_JPG_FIX
,

193 
X_TIF_ENCODE
, 
X_TIF_DECODE
,

194 
X_PNM_ENCODE
, 
X_PNM_DECODE
,

195 
X_SCALE
,

196 
X_GRAY_2_BI
, 
X_BI_2_GRAY
,

197 
X_CNV_COLOR_SPACE
,

198 
X_Y_EXTRACT
,

200 
X_THUMB
,

201 
X_TABLE
,

202 
X_CROP
,

203 
X_TONEMAP
,

204 
X_SATURATION
,

205 
X_ROTATE
,

206 
X_PAD
,

207 
X_FAKE_MONO
,

208 
X_GRAYOUT
,

209 
X_CHANGE_BPP
,

210 
X_MATRIX
,

211 
X_CONVOLVE
,

212 
X_INVERT
,

213 
X_SKEL
,

214 } 
	tIP_XFORM
, *
	tPIP_XFORM
, 
	tFAR
*
	tLPIP_XFORM
;

217 
	#IP_MAX_XFORM_INFO
 8

	)

223 
LPIP_XFORM_TBL
 
pXfÜm
;

224 
IP_XFORM
 
eXfÜm
;

225 
LPIP_PEEK_FUNC
 
pfR—dP“k
;

226 
LPIP_PEEK_FUNC
 
pfWr™eP“k
;

227 
PVOID
 
pU£rD©a
;

228 
DWORD_OR_PVOID
 
aXfÜmInfo
[
IP_MAX_XFORM_INFO
];

229 } 
	tIP_XFORM_SPEC
, *
	tPIP_XFORM_SPEC
, 
	tFAR
*
	tLPIP_XFORM_SPEC
;

255 
EXPORT
(
WORD
è
O³n
 (

256 
nXfÜms
,

257 
LPIP_XFORM_SPEC
 
ÍXfÜms
,

258 
nCl›ÁD©a
,

259 
LPIP_HANDLE
 
phJob
);

270 
VOID
 
MœrÜBy‹s
(
PBYTE
 
pbIÅutBuf
,
DWORD
 
dwIÅutAva
);

339 
EXPORT
(
WORD
è
CÚv”t
 (

340 
IP_HANDLE
 
hJob
,

341 
DWORD
 
dwIÅutAva
,

342 
LPBYTE
 
pbIÅutBuf
,

343 
LPDWORD
 
pdwIÅutU£d
,

344 
LPDWORD
 
pdwIÅutNextPos
,

345 
DWORD
 
dwOuutAva
,

346 
LPBYTE
 
pbOuutBuf
,

347 
LPDWORD
 
pdwOuutU£d
,

348 
LPDWORD
 
pdwOuutThisPos
);

365 
EXPORT
(
WORD
è
Clo£
 (

366 
IP_HANDLE
 
hJob
);

386 
EXPORT
(
WORD
è
ResuÉMask
 (

387 
IP_HANDLE
 
hJob
,

388 
WORD
 
wMask
);

405 
EXPORT
(
WORD
è
G‘Cl›ÁD©aPŒ
 (

406 
IP_HANDLE
 
hJob
,

407 
LPVOID
 
FAR
*
µvCl›ÁD©a
);

425 
EXPORT
(
WORD
è
S‘DeçuÉIÅutT¿™s
 (

426 
IP_HANDLE
 
hJob
,

427 
LPIP_IMAGE_TRAITS
 
pT¿™s
);

447 
EXPORT
(
WORD
è
G‘OuutT¿™s
 (

448 
IP_HANDLE
 
hJob
,

449 
LPIP_IMAGE_TRAITS
 
pT¿™s
);

470 
EXPORT
(
WORD
è
G‘ImageT¿™s
 (

471 
IP_HANDLE
 
hJob
,

472 
LPIP_IMAGE_TRAITS
 
pIÅutT¿™s
,

473 
LPIP_IMAGE_TRAITS
 
pOuutT¿™s
);

492 
EXPORT
(
WORD
è
In£¹edD©a
 (

493 
IP_HANDLE
 
hJob
,

494 
DWORD
 
dwNumBy‹s
);

519 
EXPORT
(
WORD
è
Ov”rideDPI
 (

520 
IP_HANDLE
 
hJob
,

521 
DWORD
 
dwHÜizDPI
,

522 
DWORD
 
dwV”tDPI
);

550 
EXPORT
(
WORD
è
G‘XfÜmTabË
 (
LPIP_XFORM_TBL
 
phXfÜm
);

555 
WORD
 (
	tWINAPI
 *
	tIPOPEN
è(, 
	tLPIP_XFORM_SPEC
,

556 , 
	tLPIP_HANDLE
);

557 
WORD
 (
	tWINAPI
 *
	tIPCONVERT
è(
	tIP_HANDLE
, 
	tDWORD
, 
	tLPBYTE
,

558 
	tLPDWORD
, LPDWORD, 
	tDWORD
,

559 
	tLPBYTE
, 
	tLPDWORD
, LPDWORD);

560 
WORD
 (
	tWINAPI
 *
	tIPCLOSE
è(
	tIP_HANDLE
);

561 
WORD
 (
	tWINAPI
 *
	tIPGETCLIENTDATAPTR
è(
	tIP_HANDLE
, 
	tLPVOID
 
	tFAR
 *);

562 
WORD
 (
	tWINAPI
 *
	tIPRESULTMASK
è(
	tIP_HANDLE
, 
	tWORD
);

563 
WORD
 (
	tWINAPI
 *
	tIPSETDEFAULTINPUTTRAITS
è(
	tIP_HANDLE
,

564 
	tLPIP_IMAGE_TRAITS
);

565 
WORD
 (
	tWINAPI
 *
	tIPGETIMAGETRAITS
è(
	tIP_HANDLE
,

566 
	tLPIP_IMAGE_TRAITS
,

567 
	tLPIP_IMAGE_TRAITS
);

568 
WORD
 (
	tWINAPI
 *
	tIPINSERTEDDATA
è(
	tIP_HANDLE
, 
	tDWORD
);

569 
WORD
 (
	tWINAPI
 *
	tIPOVERRIDEDPI
è(
	tIP_HANDLE
, 
	tDWORD
, DWORD);

571 
WORD
 (
	tWINAPI
 *
	tIPGETXFORMTABLE
è(
	tLPIP_XFORM_TBL
);

573 
WORD
 (
	tWINAPI
 *
	tIPGETOUTPUTTRAITS
è(
	tIP_HANDLE
,

574 
	tLPIP_IMAGE_TRAITS
);

577 
WORD
 
wSŒuùSize
;

578 
IPOPEN
 
O³n
;

579 
IPCONVERT
 
CÚv”t
;

580 
IPCLOSE
 
Clo£
;

581 
IPGETCLIENTDATAPTR
 
G‘Cl›ÁD©aPŒ
;

582 
IPRESULTMASK
 
ResuÉMask
;

583 
IPSETDEFAULTINPUTTRAITS
 
S‘DeçuÉIÅutT¿™s
;

584 
IPGETIMAGETRAITS
 
G‘ImageT¿™s
;

585 
IPINSERTEDDATA
 
In£¹edD©a
;

586 
IPOVERRIDEDPI
 
Ov”rideDPI
;

587 
IPGETOUTPUTTRAITS
 
G‘OuutT¿™s
;

588 } 
	tIP_JUMP_TBL
, * 
	tPIP_JUMP_TBL
, 
	tFAR
 * 
	tLPIP_JUMP_TBL
;

591 
WORD
 (
	tWINAPI
 *
	tLPFNIPGETFUNCPTRS
è(
	tLPIP_JUMP_TBL
);

593 
EXPORT
(
WORD
è
G‘FuncPŒs
 (
LPIP_JUMP_TBL
 
ÍJumpTbl
);

609 
	#IP_BI_2_GRAY_OUTPUT_BPP
 0

	)

610 
	#IP_BI_2_GRAY_WHITE_PIXEL
 1

	)

611 
	#IP_BI_2_GRAY_BLACK_PIXEL
 2

	)

622 
	#IP_BMP_NEGATIVE_HEIGHT
 0

	)

633 
	#IP_CHANGE_BPP_OUTPUT_BPP
 0

	)

642 
	#IP_CNV_COLOR_SPACE_WHICH_CNV
 0

	)

643 
	#IP_CNV_COLOR_SPACE_GAMMA
 1

	)

648 
IP_CNV_YCC_TO_CIELAB
 = 0,

649 
IP_CNV_CIELAB_TO_YCC
 = 1,

650 
IP_CNV_YCC_TO_SRGB
 = 2,

651 
IP_CNV_SRGB_TO_YCC
 = 3,

652 
IP_CNV_LHS_TO_SRGB
 = 4,

653 
IP_CNV_SRGB_TO_LHS
 = 5,

654 
IP_CNV_BGR_SWAP
 = 100

655 } 
	tIP_WHICH_CNV
;

664 
	#IP_CONVOLVE_NROWS
 0

	)

665 
	#IP_CONVOLVE_NCOLS
 1

	)

666 
	#IP_CONVOLVE_MATRIX
 2

	)

667 
	#IP_CONVOLVE_DIVISOR
 3

	)

669 
	#IP_CONVOLVE_MAXSIZE
 9

	)

678 
	#IP_CROP_LEFT
 0

	)

679 
	#IP_CROP_RIGHT
 1

	)

680 
	#IP_CROP_TOP
 2

	)

681 
	#IP_CROP_MAXOUTROWS
 3

	)

690 
	#IP_FAKE_MONO_BPP
 0

	)

699 
	#IP_FAX_FORMAT
 0

	)

700 
	#IP_FAX_NO_EOLS
 1

	)

701 
	#IP_FAX_MIN_ROW_LEN
 2

	)

703 ’um {
IP_FAX_MH
, 
IP_FAX_MR
, 
IP_FAX_MMR
};

712 
	#IP_GRAY_2_BI_THRESHOLD
 0

	)

721 
	#IP_GRAYOUT_LEFT
 0

	)

722 
	#IP_GRAYOUT_RIGHT
 1

	)

723 
	#IP_GRAYOUT_TOP
 2

	)

724 
	#IP_GRAYOUT_BOTTOM
 3

	)

736 
	#IP_HEADER_SPEC
 0

	)

741 
PSTR
 
pszLeáSŒ
;

742 
PSTR
 
pszC’‹rSŒ
;

743 
PSTR
 
pszRightSŒ
;

744 
WORD
 
wCh¬S‘
;

745 
PSTR
 
pszTy³Faû
;

746 
fHeightPošts
;

747 
fM¬gšPošts
;

748 
BOOL
 
bOv”Ïy
;

749 
RGBQUAD
 
rgbWh™e
;

750 
RGBQUAD
 
rgbBÏck
;

751 } 
	t__©Œibu‹__
((
	t·cked
)è
	tXHEADER_SPEC
, *
	tPXHEADER_SPEC
, 
	tFAR
*
	tLPXHEADER_SPEC
;

781 
	#IP_JPG_DECODE_OUTPUT_SUBSAMPLED
 0

	)

782 
	#IP_JPG_DECODE_FROM_DENALI
 1

	)

786 
	#IP_JPG_ENCODE_QUALITY_FACTORS
 0

	)

787 
	#IP_JPG_ENCODE_SAMPLE_FACTORS
 1

	)

788 
	#IP_JPG_ENCODE_ALREADY_SUBSAMPLED
 2

	)

789 
	#IP_JPG_ENCODE_FOR_DENALI
 3

	)

790 
	#IP_JPG_ENCODE_OUTPUT_DNL
 4

	)

791 
	#IP_JPG_ENCODE_FOR_COLOR_FAX
 5

	)

792 
	#IP_JPG_ENCODE_DUMMY_HEADER_LEN
 6

	)

801 
	#IP_PAD_LEFT
 0

	)

802 
	#IP_PAD_RIGHT
 1

	)

803 
	#IP_PAD_TOP
 2

	)

804 
	#IP_PAD_BOTTOM
 3

	)

805 
	#IP_PAD_VALUE
 4

	)

806 
	#IP_PAD_MIN_HEIGHT
 5

	)

815 
	#IP_ROTATE_UPPER_LEFT
 0

	)

816 
	#IP_ROTATE_UPPER_RIGHT
 1

	)

817 
	#IP_ROTATE_LOWER_LEFT
 2

	)

818 
	#IP_ROTATE_OUTPUT_SIZE
 3

	)

819 
	#IP_ROTATE_FAST
 4

	)

828 
	#IP_SATURATION_FACTOR
 0

	)

837 
	#IP_SCALE_HORIZ_FACTOR
 0

	)

838 
	#IP_SCALE_VERT_FACTOR
 1

	)

839 
	#IP_SCALE_FAST
 2

	)

848 
	#IP_SKEL_SPEC_1
 0

	)

849 
	#IP_SKEL_SPEC_2
 1

	)

858 
	#IP_TABLE_WHICH
 0

	)

859 
	#IP_TABLE_OPTION
 1

	)

861 
	#IP_TABLE_COLOR_1
 1

	)

862 
	#IP_TABLE_COLOR_2
 2

	)

863 
	#IP_TABLE_COLOR_3
 3

	)

866 
IP_TABLE_USER
,

867 
IP_TABLE_PASS_THRU
,

868 
IP_TABLE_GAMMA
,

869 
IP_TABLE_THRESHOLD
,

870 
IP_TABLE_MIRROR
,

871 
IP_TABLE_USER_THREE
,

872 
IP_TABLE_BW_CLIP
,

873 
IP_TABLE_USER_WORD
,

874 
IP_TABLE_USER_THREE_WORD


875 } 
	tIP_TABLE_TYPE
;

884 
	#IP_THUMB_SCALE_SPEC
 0

	)

893 
	#IP_TIFF_FILE_PATH
 0

	)

902 
	#IP_TONEMAP_POINTER
 0

	)

903 
	#IP_TONEMAP_LUM_SPACE
 1

	)

912 
	#IP_Y_EXTRACT_COLOR_SPACE
 0

	)

915 
IP_Y_EXTRACT_LUM_CHROME
,

916 
IP_Y_EXTRACT_RGB
,

917 
IP_Y_EXTRACT_BGR


918 } 
	tIP_Y_EXTRACT_WHICH_SPACE
;

920 #ià
defšed
(
__ılu¥lus
)

	@ip/ipdefs.h

45 #ià! 
defšed
 
IPDEFS_INC


46 
	#IPDEFS_INC


	)

48 #ifdeà
EXPORT_TRANSFORM


49 
	#çlB»akPošt
(è
	`as£¹
(0);

	)

51 
çlB»akPošt
();

54 
	#INSURE
(
mu¡_be_Œue
) \

56 ià(! (
mu¡_be_Œue
)) { \

57 
	`çlB»akPošt
(); \

58 
çl_”rÜ
; \

60 } 0)

	)

63 
	#HANDLE_TO_PTR
(
hJob_maı¬
, 
š¡_maı¬
) \

65 
š¡_maı¬
 = (*)
hJob_maı¬
; \

66 
	`INSURE
 (
š¡_maı¬
->
dwV®idChk
 =ğ
CHECK_VALUE
); \

67 } 0)

	)

70 
	#IP_MEM_ALLOC
(
nBy‹s_maı¬
, 
±r_maı¬
) \

75 (
±r_maı¬
èğ
	`m®loc
(
nBy‹s_maı¬
+12); \

76 
	`INSURE
 (
±r_maı¬
 !ğ
NULL
); \

77 } 0)

	)

80 
	#IP_MEM_FREE
(
±r_maı¬
) \

82 ià(
±r_maı¬
 !ğ
NULL
) \

83 
	`ä“
 (
±r_maı¬
); \

84 } 0)

	)

87 
	#IP_MAX
(
v®OÃ
,
v®Two
) \

88 ((
v®OÃ
)>(
v®Two
è? (v®OÃè: (v®Two))

	)

90 
	#IP_MIN
(
v®OÃ
,
v®Two
) \

91 ((
v®OÃ
)<(
v®Two
è? (v®OÃè: (v®Two))

	)

95 
	#NTSC_LUMINANCE
(
Rv®
,
Gv®
,
Bv®
) \

96 ((((
Rv®
)<<2è+ (Rv®è+ ((
Gv®
)<<3è+ (Gv®è+ ((
Bv®
)<<1)è>> 4)

	)

104 
	#MUL32HIHALF
(
fœ¡·r
, 
£cÚd·r
, 
hih®äesuÉ
) { \

105 
__št64
 
´od64
; \

106 
´od64
 = (
__št64
)(
fœ¡·r
è* (
£cÚd·r
); \

107 
hih®äesuÉ
 = ((*)&
´od64
)[1]; \

108 

	)

110 
	#MUL32HIHALF
(
fœ¡·r
, 
£cÚd·r
, 
hih®äesuÉ
) { \

111 
hih®äesuÉ
 = ((
__št64
)(
fœ¡·r
è* (
£cÚd·r
)) >> 32; \

112 }

	)

	@ip/ipmain.c

47 
	~<sys/ty³s.h
>

48 
	~<sys/¡©.h
>

49 
	~<fú.h
>

50 
	~<¡ršg.h
>

51 
	~<uni¡d.h
>

52 
	~"hp.h
"

53 
	~"defs.h
"

57 #ifdeà
HPIP_DEBUG


58 
	~<¡dio.h
>

59 
	~<as£¹.h
>

61 
	#_T
(
msg
è
	)
msg

63 
	#PRINT0
(
¬gs
...è
	`årštf
(
¡d”r
,‡rgs)

	)

66 
	#PRINT1
(
¬gs
...è
	`årštf
(
¡d”r
,‡rgs)

	)

68 
	#PRINT1
(
¬gs
...)

	)

71 #undeà
INSURE


72 
	#INSURE
(
boŞexp
) \

73 dØ{ ià(0è
çl_”rÜ
; 
	`as£¹
(
boŞexp
); } 0)

	)

75 
	gšfd
;

76 
	goutfd
;

79 
	#PRINT0
(
¬gs
...)

	)

80 
	#PRINT1
(
¬gs
...)

	)

92 
	#CHECK_VALUE
 0xACEC0DE4U

	)

93 
	#MIN_GENBUF_LEN
 4000

	)

94 
	#PERMANENT_RESULTS
 \

95 (
IP_INPUT_ERROR
 | 
IP_FATAL_ERROR
 | 
IP_DONE
)

	)

109 
	mXS_NONEXISTENT
=0,

110 
	mXS_PARSING_HEADER
,

111 
	mXS_CONVERTING
,

112 
	mXS_CONV_NOT_RFD
,

113 
	mXS_FLUSHING
,

114 
	mXS_DONE


115 } 
	tXFORM_STATE
;

121 
XFORM_STATE
 
	meS‹
;

122 
PIP_XFORM_TBL
 
	mpXfÜm
;

123 
LPIP_PEEK_FUNC
 
	mpfR—dP“k
;

124 
LPIP_PEEK_FUNC
 
	mpfWr™eP“k
;

125 
PVOID
 
	mpU£rD©a
;

126 
DWORD_OR_PVOID
 
	maXfÜmInfo
[8];

127 
IP_XFORM_HANDLE
 
	mhXfÜm
;

128 
IP_IMAGE_TRAITS
 
	mšT¿™s
;

129 
IP_IMAGE_TRAITS
 
	moutT¿™s
;

130 
DWORD
 
	mdwMšInBufL’
;

131 
DWORD
 
	mdwMšOutBufL’
;

132 } 
	tXFORM_INFO
, *
	tPXFORM_INFO
;

139 
PBYTE
 
	mpbBuf
;

140 
DWORD
 
	mdwBufL’
;

141 
DWORD
 
	mdwV®idS¹
;

142 
DWORD
 
	mdwV®idL’
;

143 
DWORD
 
	mdwFePos
;

144 } 
	tGENBUF
, *
	tPGENBUF
;

156 
GENBUF
 
	mgbIn
;

157 
GENBUF
 
	mgbOut
;

165 
PBYTE
 
	mpbMidInBuf
;

166 
PBYTE
 
	mpbMidOutBuf
;

167 
DWORD
 
	mdwMidL’
;

168 
DWORD
 
	mdwMidV®idL’
;

169 
	miOwÃr
;

175 
XFORM_INFO
 
	mxfA¼ay
[
IP_MAX_XFORMS
];

176 
WORD
 
	mxfCouÁ
;

180 
DWORD
 
	mdwV®idChk
;

181 
DWORD
 
	mdwFÜûdHÜizDPI
;

182 
DWORD
 
	mdwFÜûdV”tDPI
;

183 
WORD
 
	mwResuÉMask
;

184 
	mlInRows
;

185 
	mlOutRows
;

186 
	miInPages
;

187 
	miOutPages
;

188 
BOOL
 
	m³ndšgIn£¹
;

190 } 
	tINST
, *
	tPINST
;

203 
IP_XFORM_TBL
 
çxEncodeTbl
, 
çxDecodeTbl
;

204 
IP_XFORM_TBL
 
pcxEncodeTbl
, 
pcxDecodeTbl
;

206 
IP_XFORM_TBL
 
jpgEncodeTbl
, 
jpgDecodeTbl
, 
jpgFixTbl
;

207 
IP_XFORM_TBL
 
tifEncodeTbl
, 
tifDecodeTbl
;

208 
IP_XFORM_TBL
 
²mEncodeTbl
, 
²mDecodeTbl
;

209 
IP_XFORM_TBL
 
sÿËTbl
;

210 
IP_XFORM_TBL
 
g¿y2biTbl
, 
bi2g¿yTbl
;

211 
IP_XFORM_TBL
 
cŞÜTbl
;

212 
IP_XFORM_TBL
 
yXŒaùTbl
;

214 
IP_XFORM_TBL
 
thumbTbl
;

215 
IP_XFORM_TBL
 
bËTbl
;

216 
IP_XFORM_TBL
 
üİTbl
;

217 
IP_XFORM_TBL
 
tÚem­Tbl
;

218 
IP_XFORM_TBL
 
§tu¿tiÚTbl
;

219 
IP_XFORM_TBL
 
rÙ©eTbl
;

220 
IP_XFORM_TBL
 
·dTbl
;

221 
IP_XFORM_TBL
 
çkeMÚoTbl
;

222 
IP_XFORM_TBL
 
g¿yOutTbl
;

223 
IP_XFORM_TBL
 
chªgeBPPTbl
;

224 
IP_XFORM_TBL
 
m©rixTbl
;

225 
IP_XFORM_TBL
 
cÚvŞveTbl
;

226 
IP_XFORM_TBL
 
šv”tTbl
;

227 
IP_XFORM_TBL
 
sk–Tbl
;

229 
IP_XFORM_TBL
 * cÚ¡ 
	gxfÜmJumpTabËs
[] = {

230 &
çxEncodeTbl
, &
çxDecodeTbl
,

231 &
pcxEncodeTbl
, &
pcxDecodeTbl
,

233 &
jpgEncodeTbl
, &
jpgDecodeTbl
, &
jpgFixTbl
,

234 &
tifEncodeTbl
, &
tifDecodeTbl
,

235 &
²mEncodeTbl
, &
²mDecodeTbl
,

236 &
sÿËTbl
,

237 &
g¿y2biTbl
, &
bi2g¿yTbl
,

238 &
cŞÜTbl
,

239 &
yXŒaùTbl
,

241 &
thumbTbl
,

242 &
bËTbl
,

243 &
üİTbl
,

244 &
tÚem­Tbl
,

245 &
§tu¿tiÚTbl
,

246 &
rÙ©eTbl
,

247 &
·dTbl
,

248 &
çkeMÚoTbl
,

249 &
g¿yOutTbl
,

250 &
chªgeBPPTbl
,

251 &
m©rixTbl
,

252 &
cÚvŞveTbl
,

253 &
šv”tTbl
,

254 &
sk–Tbl
,

265 
	$çlB»akPošt
 ()

268 
	`PRINT0
 (
	`_T
("\nhit fatalBreakPoint!\n"));

269 
	}
}

279 
	$d–‘eMidBufs
 (
PINST
 
g
)

281 
	`PRINT0
 (
	`_T
("deleteMidBufs\n"));

283 ià(
g
->
pbMidInBuf
 !ğ
NULL
)

284 
	`IP_MEM_FREE
 (
g
->
pbMidInBuf
);

286 ià(
g
->
pbMidOutBuf
 !ğ
NULL
)

287 
	`IP_MEM_FREE
 (
g
->
pbMidOutBuf
);

289 
g
->
pbMidInBuf
 = 
NULL
;

290 
g
->
pbMidOutBuf
 = 
NULL
;

291 
	}
}

301 
	$EXPORT
(
WORD
è
	$O³n
 (

302 
nXfÜms
,

303 
LPIP_XFORM_SPEC
 
ÍXfÜms
,

304 
nCl›ÁD©a
,

305 
PIP_HANDLE
 
phJob
)

307 
PINST
 
g
;

308 
i
;

309 
PIP_XFORM_SPEC
 
¤c
;

310 
PXFORM_INFO
 
de¡
;

312 #ifdeà
HPIP_DEBUG


313 *
In
 = "/tmp/ipIn.dib";

316 
	`PRINT0
 (
	`_T
("O³n:‚XfÜms=%d\n"), 
nXfÜms
);

317 
	`INSURE
 (
nXfÜms
>0 && 
ÍXfÜms
!=
NULL
 && 
nCl›ÁD©a
>=0 && 
phJob
!=NULL);

319 #ifdeà
HPIP_DEBUG


320 
i
=0; i<
nXfÜms
; i++)

322 
ÍXfÜms
[
i
].
eXfÜm
)

324 
X_FAX_DECODE
:

325 
	`PRINT0
("Fax_fÜm©=%d\n", 
ÍXfÜms
[
i
].
aXfÜmInfo
[
IP_FAX_FORMAT
].
dwÜd
);

326 
In
 = "/tmp/ipIn.pbm";

328 
X_JPG_DECODE
:

329 
	`PRINT0
("JPG_decode=%d\n", 
ÍXfÜms
[
i
].
aXfÜmInfo
[
IP_JPG_DECODE_FROM_DENALI
].
dwÜd
);

330 
In
 = "/tmp/ipIn.jpg";

332 
X_CNV_COLOR_SPACE
:

333 
	`PRINT0
("CŞÜ_¥aû cÚv”siÚ=%d\n", 
ÍXfÜms
[
i
].
aXfÜmInfo
[
IP_CNV_COLOR_SPACE_WHICH_CNV
].
dwÜd
);

334 
	`PRINT0
("CŞÜ_¥aû gamma=%d\n", 
ÍXfÜms
[
i
].
aXfÜmInfo
[
IP_CNV_COLOR_SPACE_GAMMA
].
dwÜd
);

336 
X_CROP
:

337 
	`PRINT0
("Crİ_Ëá=%d\n", 
ÍXfÜms
[
i
].
aXfÜmInfo
[
IP_CROP_LEFT
].
dwÜd
);

338 
	`PRINT0
("Crİ_right=%d\n", 
ÍXfÜms
[
i
].
aXfÜmInfo
[
IP_CROP_RIGHT
].
dwÜd
);

339 
	`PRINT0
("Crİ_tİ=%d\n", 
ÍXfÜms
[
i
].
aXfÜmInfo
[
IP_CROP_TOP
].
dwÜd
);

340 
	`PRINT0
("Crİ_maxouŒows=%d\n", 
ÍXfÜms
[
i
].
aXfÜmInfo
[
IP_CROP_MAXOUTROWS
].
dwÜd
);

342 
X_PAD
:

343 
	`PRINT0
("Pad_Ëá=%d\n", 
ÍXfÜms
[
i
].
aXfÜmInfo
[
IP_PAD_LEFT
].
dwÜd
);

344 
	`PRINT0
("Pad_right=%d\n", 
ÍXfÜms
[
i
].
aXfÜmInfo
[
IP_PAD_RIGHT
].
dwÜd
);

345 
	`PRINT0
("Pad_tİ=%d\n", 
ÍXfÜms
[
i
].
aXfÜmInfo
[
IP_PAD_TOP
].
dwÜd
);

346 
	`PRINT0
("Pad_bÙtom=%d\n", 
ÍXfÜms
[
i
].
aXfÜmInfo
[
IP_PAD_BOTTOM
].
dwÜd
);

347 
	`PRINT0
("Pad_v®ue=%d\n", 
ÍXfÜms
[
i
].
aXfÜmInfo
[
IP_PAD_VALUE
].
dwÜd
);

348 
	`PRINT0
("Pad_mšheight=%d\n", 
ÍXfÜms
[
i
].
aXfÜmInfo
[
IP_PAD_MIN_HEIGHT
].
dwÜd
);

351 
	`PRINT0
("Unknown xform\n");

356 
šfd
 = 
	`ü—t
(
In
, 0600);

357 
outfd
 = 
	`ü—t
("/tmp/ipOut.ppm", 0600);

362 
	`IP_MEM_ALLOC
 ((
INST
è+ 
nCl›ÁD©a
, 
g
);

363 *
phJob
 = 
g
;

365 
	`mem£t
 (
g
, 0, (
INST
));

366 
g
->
dwV®idChk
 = 
CHECK_VALUE
;

367 
g
->
iOwÃr
 = -1;

368 
g
->
wResuÉMask
 = 
PERMANENT_RESULTS
;

372 
g
->
xfCouÁ
 = (
WORD
)
nXfÜms
;

374 
i
=0; i<
nXfÜms
; i++) {

375 
¤c
 = &(
ÍXfÜms
[
i
]);

376 
de¡
 = &(
g
->
xfA¼ay
[
i
]);

378 
de¡
->
eS‹
 = 
XS_NONEXISTENT
;

379 
de¡
->
pXfÜm
 = (
¤c
->pXfÜm !ğ
NULL
)

380 ? 
¤c
->
pXfÜm


381 : 
xfÜmJumpTabËs
[
¤c
->
eXfÜm
];

382 
	`INSURE
 (
de¡
->
pXfÜm
 !ğ
NULL
);

383 
de¡
->
pfR—dP“k
 = 
¤c
->pfReadPeek;

384 
de¡
->
pfWr™eP“k
 = 
¤c
->pfWritePeek;

385 
de¡
->
pU£rD©a
 = 
¤c
->pUserData;

386 
	`memıy
 (
de¡
->
aXfÜmInfo
, 
¤c
->aXformInfo, (dest->aXformInfo));

389  
IP_DONE
;

391 
çl_”rÜ
:

392  
IP_FATAL_ERROR
;

393 
	}
}

403 
	$EXPORT
(
WORD
è
	$Clo£
 (
IP_HANDLE
 
hJob
)

405 
PINST
 
g
;

406 
PXFORM_INFO
 
pXfÜm
;

407 
WORD
 
n
;

409 
	`PRINT0
 (
	`_T
("Clo£: hJob=%p\n"), (*)
hJob
);

410 
	`HANDLE_TO_PTR
 (
hJob
, 
g
);

414 
	`d–‘eMidBufs
 (
g
);

415 
g
->
dwMidL’
 = 0;

416 
g
->
dwMidV®idL’
 = 0;

418 ià(
g
->
gbIn
.
pbBuf
 !ğ
NULL
è
	`IP_MEM_FREE
 (g->gbIn.pbBuf);

419 ià(
g
->
gbOut
.
pbBuf
 !ğ
NULL
è
	`IP_MEM_FREE
 (g->gbOut.pbBuf);

423 
n
=0;‚<
g
->
xfCouÁ
;‚++) {

424 
pXfÜm
 = &(
g
->
xfA¼ay
[
n
]);

425 ià(
pXfÜm
->
hXfÜm
 !ğ
NULL
)

426 
pXfÜm
->pXfÜm->
	`şo£XfÜm
 (pXfÜm->
hXfÜm
);

429 
	`IP_MEM_FREE
 (
g
);

431 #ifdeà
HPIP_DEBUG


432 
	`şo£
(
šfd
);

433 
	`şo£
(
outfd
);

436  
IP_DONE
;

438 
çl_”rÜ
:

439  
IP_FATAL_ERROR
;

440 
	}
}

450 
	$EXPORT
(
WORD
è
	$G‘Cl›ÁD©aPŒ
 (

451 
IP_HANDLE
 
hJob
,

452 
PVOID
 *
µvCl›ÁD©a
)

454 
PINST
 
g
;

456 
	`PRINT0
 (
	`_T
("ipGetClientDataPtr\n"));

457 
	`HANDLE_TO_PTR
 (
hJob
, 
g
);

458 *
µvCl›ÁD©a
 = (
PVOID
)((
PBYTE
)
g
 + (
INST
));

459  
IP_DONE
;

461 
çl_”rÜ
:

462  
IP_FATAL_ERROR
;

463 
	}
}

473 
	$EXPORT
(
WORD
è
	$ResuÉMask
 (

474 
IP_HANDLE
 
hJob
,

475 
WORD
 
wMask
)

477 
PINST
 
g
;

479 
	`PRINT0
 (
	`_T
("ResuÉMask: hJob=%p, wMask=%04x\n"), (*)
hJob
, 
wMask
);

480 
	`HANDLE_TO_PTR
 (
hJob
, 
g
);

481 
g
->
wResuÉMask
 = 
wMask
 | 
PERMANENT_RESULTS
;

482  
IP_DONE
;

484 
çl_”rÜ
:

485  
IP_FATAL_ERROR
;

486 
	}
}

504 
	$EXPORT
(
WORD
è
	$S‘DeçuÉIÅutT¿™s
 (

505 
IP_HANDLE
 
hJob
,

506 
LPIP_IMAGE_TRAITS
 
pT¿™s
)

508 
PINST
 
g
;

509 
PIP_IMAGE_TRAITS
 
p
;

511 
	`PRINT0
 (
	`_T
("ipSetDefaultInputTraits: hJob=%p PixelsPerRow=%d BitsPerPixel=%d ComponentsPerPixel=%d HorzDPI=%ld VertDPI=%ld Rows=%ld Pages=%d PageNum=%d\n"),

512 (*)
hJob
, 
pT¿™s
->
iPix–sP”Row
,…T¿™s->
iB™sP”Pix–
,…T¿™s->
iCompÚ’tsP”Pix–
,…T¿™s->
lHÜizDPI
,

513 
pT¿™s
->
lV”tDPI
,…T¿™s->
lNumRows
,…T¿™s->
iNumPages
,…T¿™s->
iPageNum
);

514 
	`HANDLE_TO_PTR
 (
hJob
, 
g
);

515 
	`INSURE
 (
g
->
xfA¼ay
[0].
eS‹
 =ğ
XS_NONEXISTENT
);

516 
g
->
xfA¼ay
[0].
šT¿™s
 = *
pT¿™s
;

519 
p
 = &(
g
->
xfA¼ay
[0].
šT¿™s
);

520 ià(
p
->
lHÜizDPI
 < 0x10000)…->lHorizDPI <<= 16;

521 ià(
p
->
lV”tDPI
 < 0x10000)…->lVertDPI <<= 16;

523  
IP_DONE
;

525 
çl_”rÜ
:

526  
IP_FATAL_ERROR
;

527 
	}
}

542 
	$EXPORT
(
WORD
è
	$G‘ImageT¿™s
 (

543 
IP_HANDLE
 
hJob
,

544 
LPIP_IMAGE_TRAITS
 
pIÅutT¿™s
,

545 
LPIP_IMAGE_TRAITS
 
pOuutT¿™s
)

547 
PINST
 
g
;

548 
PXFORM_INFO
 
pTa
;

550 
	`PRINT0
 (
	`_T
("G‘ImageT¿™s: hJob=%p\n"), (*)
hJob
);

551 
	`HANDLE_TO_PTR
 (
hJob
, 
g
);

552 
	`INSURE
 (
g
->
xfCouÁ
 > 0);

553 
pTa
 = &(
g
->
xfA¼ay
[g->
xfCouÁ
-1]);

555 ià(
pIÅutT¿™s
 !ğ
NULL
) {

556 
	`INSURE
 (
g
->
xfA¼ay
[0].
eS‹
 > 
XS_PARSING_HEADER
);

557 *
pIÅutT¿™s
 = 
g
->
xfA¼ay
[0].
šT¿™s
;

558 
	`PRINT0
 (
	`_T
("InputTraits: hJob=%p PixelsPerRow=%d BitsPerPixel=%d ComponentsPerPixel=%d HorzDPI=%ld VertDPI=%ld Rows=%ld Pages=%d PageNum=%d\n"),

559 (*)
hJob
, 
pIÅutT¿™s
->
iPix–sP”Row
,…IÅutT¿™s->
iB™sP”Pix–
,…IÅutT¿™s->
iCompÚ’tsP”Pix–
,…IÅutT¿™s->
lHÜizDPI
,

560 
pIÅutT¿™s
->
lV”tDPI
,…IÅutT¿™s->
lNumRows
,…IÅutT¿™s->
iNumPages
,…IÅutT¿™s->
iPageNum
);

563 ià(
pOuutT¿™s
 !ğ
NULL
) {

564 
	`INSURE
 (
pTa
->
eS‹
 > 
XS_PARSING_HEADER
);

565 *
pOuutT¿™s
 = 
pTa
->
outT¿™s
;

566 
	`PRINT0
 (
	`_T
("OutputTraits: hJob=%p PixelsPerRow=%d BitsPerPixel=%d ComponentsPerPixel=%d HorzDPI=%ld VertDPI=%ld Rows=%ld Pages=%d PageNum=%d\n"),

567 (*)
hJob
, 
pOuutT¿™s
->
iPix–sP”Row
,…OuutT¿™s->
iB™sP”Pix–
,…OuutT¿™s->
iCompÚ’tsP”Pix–
,…OuutT¿™s->
lHÜizDPI
,

568 
pOuutT¿™s
->
lV”tDPI
,…OuutT¿™s->
lNumRows
,…OuutT¿™s->
iNumPages
,…OuutT¿™s->
iPageNum
);

571  
IP_DONE
;

573 
çl_”rÜ
:

574  
IP_FATAL_ERROR
;

575 
	}
}

585 
	$EXPORT
(
WORD
è
	$In£¹edD©a
 (

586 
IP_HANDLE
 
hJob
,

587 
DWORD
 
dwNumBy‹s
)

589 
PINST
 
g
;

590 
PXFORM_INFO
 
pTa
;

592 
	`PRINT0
 (
	`_T
("In£¹edD©a: hJob=%p, dwNumBy‹s=%d\n"), (*)
hJob
, 
dwNumBy‹s
);

593 
	`HANDLE_TO_PTR
 (
hJob
, 
g
);

594 
	`INSURE
 (
g
->
xfCouÁ
 > 0);

595 
pTa
 = &(
g
->
xfA¼ay
[g->
xfCouÁ
-1]);

596 
	`INSURE
 (
pTa
->
eS‹
 > 
XS_PARSING_HEADER
);

597 
	`INSURE
 (
g
->
gbOut
.
dwV®idL’
 == 0);

599 
pTa
->
pXfÜm
->
	`š£¹edD©a
 (pTa->
hXfÜm
, 
dwNumBy‹s
);

600  
IP_DONE
;

602 
çl_”rÜ
:

603  
IP_FATAL_ERROR
;

604 
	}
}

614 
	$EXPORT
(
WORD
è
	$Ov”rideDPI
 (

615 
IP_HANDLE
 
hJob
,

616 
DWORD
 
dwHÜizDPI
,

617 
DWORD
 
dwV”tDPI
)

619 
PINST
 
g
;

621 
	`PRINT0
 (
	`_T
("ipOverrideDPI: dwHorizDPI=%x, dwVertDPI=%x\n"),

622 
dwHÜizDPI
, 
dwV”tDPI
);

623 
	`HANDLE_TO_PTR
 (
hJob
, 
g
);

626 ià(
dwHÜizDPI
 < 0x10000) dwHorizDPI <<= 16;

627 ià(
dwV”tDPI
 < 0x10000) dwVertDPI <<= 16;

629 
g
->
dwFÜûdHÜizDPI
 = 
dwHÜizDPI
;

630 
g
->
dwFÜûdV”tDPI
 = 
dwV”tDPI
;

631  
IP_DONE
;

633 
çl_”rÜ
:

634  
IP_FATAL_ERROR
;

635 
	}
}

645 
	$EXPORT
(
WORD
è
	$G‘FuncPŒs
 (
LPIP_JUMP_TBL
 
ÍJumpTbl
)

647 
	`PRINT0
 (
	`_T
("ipGetFuncPtrs\n"));

648 
	`INSURE
 (
ÍJumpTbl
!=
NULL
 &&†pJumpTbl->
wSŒuùSize
==(
IP_JUMP_TBL
));

650 
ÍJumpTbl
->
O³n
 = (
LPVOID
) ipOpen;

651 
ÍJumpTbl
->
CÚv”t
 = (
LPVOID
) ipConvert;

652 
ÍJumpTbl
->
Clo£
 = (
LPVOID
) ipClose;

653 
ÍJumpTbl
->
G‘Cl›ÁD©aPŒ
 = (
LPVOID
) ipGetClientDataPtr;

654 
ÍJumpTbl
->
ResuÉMask
 = (
LPVOID
) ipResultMask;

655 
ÍJumpTbl
->
S‘DeçuÉIÅutT¿™s
 = (
LPVOID
) ipSetDefaultInputTraits;

656 
ÍJumpTbl
->
G‘ImageT¿™s
 = (
LPVOID
) ipGetImageTraits;

657 
ÍJumpTbl
->
In£¹edD©a
 = (
LPVOID
) ipInsertedData;

658 
ÍJumpTbl
->
Ov”rideDPI
 = (
LPVOID
) ipOverrideDPI;

659 
ÍJumpTbl
->
G‘OuutT¿™s
 = (
LPVOID
) ipGetOutputTraits;

661  
IP_DONE
;

663 
çl_”rÜ
:

664  
IP_FATAL_ERROR
;

665 
	}
}

685 
	$EXPORT
(
WORD
è
	$G‘OuutT¿™s
 (

686 
IP_HANDLE
 
hJob
,

687 
LPIP_IMAGE_TRAITS
 
pT¿™s
)

689 
PINST
 
g
;

690 
IP_IMAGE_TRAITS
 
šT¿™s
, 
outT¿™s
;

691 
iXfÜm
;

692 
PXFORM_INFO
 
pXfÜm
;

693 
WORD
 
»suÉ
;

694 
DWORD
 
dwH—d”L’
;

695 
DWORD
 
dwInU£d
, 
dwInNextPos
;

697 
	`HANDLE_TO_PTR
 (
hJob
, 
g
);

698 
	`INSURE
 (
g
->
xfCouÁ
>=1);

699 
šT¿™s
 = 
g
->
xfA¼ay
[0].inTraits;

701 
iXfÜm
=0; iXfÜm<
g
->
xfCouÁ
; iXform++) {

702 
pXfÜm
 = &(
g
->
xfA¼ay
[
iXfÜm
]);

703 
	`INSURE
 (
pXfÜm
->
eS‹
 =ğ
XS_NONEXISTENT
);

707 
»suÉ
 = 
pXfÜm
->pXfÜm->
	`İ’XfÜm
 (&pXfÜm->
hXfÜm
);

708 
	`INSURE
 (
»suÉ
 =ğ
IP_DONE
);

710 
»suÉ
 = 
pXfÜm
->pXfÜm->
	`£tDeçuÉIÅutT¿™s
 (

711 
pXfÜm
->
hXfÜm
, &
šT¿™s
);

712 
	`INSURE
 (
»suÉ
 =ğ
IP_DONE
);

714 
»suÉ
 = 
pXfÜm
->pXfÜm->
	`£tXfÜmS³c
 (

715 
pXfÜm
->
hXfÜm
,…XfÜm->
aXfÜmInfo
);

716 
	`INSURE
 (
»suÉ
 =ğ
IP_DONE
);

718 
»suÉ
 = 
pXfÜm
->pXfÜm->
	`g‘H—d”BufSize
 (

719 
pXfÜm
->
hXfÜm
, &
dwH—d”L’
);

720 
	`INSURE
 (
»suÉ
 =ğ
IP_DONE
);

721 
	`INSURE
 (
dwH—d”L’
 == 0);

723 
»suÉ
 = 
pXfÜm
->pXfÜm->
	`g‘Aùu®T¿™s
 (

724 
pXfÜm
->
hXfÜm
,

725 0, 
NULL
, &
dwInU£d
, &
dwInNextPos
,

726 &
šT¿™s
, &
outT¿™s
);

727 
	`INSURE
 (
»suÉ
 & 
IP_DONE
);

729 
»suÉ
 = 
pXfÜm
->pXfÜm->
	`şo£XfÜm
 (pXfÜm->
hXfÜm
);

730 
	`INSURE
 (
»suÉ
 =ğ
IP_DONE
);

732 
šT¿™s
 = 
outT¿™s
;

733 
pXfÜm
->
hXfÜm
 = 
NULL
;

736 *
pT¿™s
 = 
outT¿™s
;

737  
IP_DONE
;

739 
çl_”rÜ
:

740  
IP_FATAL_ERROR
;

741 
	}
}

751 
	$EXPORT
(
WORD
è
	$CÚv”t
 (

752 
IP_HANDLE
 
hJob
,

753 
DWORD
 
dwIÅutAva
,

754 
PBYTE
 
pbIÅutBuf
,

755 
PDWORD
 
pdwIÅutU£d
,

756 
PDWORD
 
pdwIÅutNextPos
,

757 
DWORD
 
dwOuutAva
,

758 
PBYTE
 
pbOuutBuf
,

759 
PDWORD
 
pdwOuutU£d
,

760 
PDWORD
 
pdwOuutThisPos
)

762 
PINST
 
g
;

763 
WORD
 
ResuÉ
;

764 
iXfÜm
;

765 
WORD
 
»suÉ
;

766 
PGENBUF
 
pgbIn
, 
pgbOut
;

767 
BOOL
 
©TheH—d
, 
©TheTa
;

768 
PXFORM_INFO
 
pXfÜm
, 
pPriÜXfÜm
, 
pNextXfÜm
;

769 
BOOL
 
ÃedIÅut
, 
£ËùCnvS‹
;

770 
DWORD
 
dwBy‹s
;

771 
i
;

772 
DWORD
 
n
;

773 
DWORD
 
dwInU£d
, 
dwOutU£d
;

774 
DWORD
 
dwInNextPos
, 
dwOutThisPos
;

775 
DWORD
 
dwTheInL’
, 
dwTheOutL’
;

776 
PBYTE
 
pbTemp
;

777 
PBYTE
 
pbTheInBuf
, 
pbTheOutBuf
;

778 
DWORD
 
dwJunk
;

780 ià(
pbOuutBuf
 =ğ
NULL
) {

782 
pdwOuutU£d
 = &
dwJunk
;

783 
pdwOuutThisPos
 = &
dwJunk
;

784 
dwOuutAva
 = 0xfffffffu;

787 
	`PRINT0
 (
	`_T
("ipConvert: hJob=%p,…bInputBuf=%p InputBufSize=%d…bOutputBuf=%p OutputBufSize=%d\n"),

788 (*)
hJob
, 
pbIÅutBuf
, 
dwIÅutAva
, 
pbOuutBuf
, 
dwOuutAva
);

789 
	`INSURE
 (
pdwIÅutU£d
 !=
NULL
 && 
pdwIÅutNextPos
 !=NULL &&

790 
pdwOuutU£d
!=
NULL
 && 
pdwOuutThisPos
!=NULL);

791 
	`HANDLE_TO_PTR
 (
hJob
, 
g
);

792 
	`INSURE
 (
g
->
xfCouÁ
>=1);

794 
pgbIn
 = &
g
->
gbIn
;

795 
pgbOut
 = &
g
->
gbOut
;

797 *
pdwIÅutU£d
 = 0;

798 *
pdwOuutU£d
 = 0;

799 
ResuÉ
 = 0;

805 
TRUE
) {

809 ià(*
pdwOuutU£d
 == 0)

810 *
pdwOuutThisPos
 = 
pgbOut
->
dwFePos
;

812 ià(
pgbOut
->
dwV®idL’
 != 0) {

826 ià((*
pdwOuutThisPos
+*
pdwOuutU£d
è!ğ
pgbOut
->
dwFePos
) {

827 
	`PRINT0
 (
	`_T
("CÚv”t: ouuˆ£ekØ%d\n"), 
pgbOut
->
dwFePos
);

828 
ex™Loİ
;

831 
dwBy‹s
 = 
pgbOut
->
dwV®idL’
;

832 ià(
dwOuutAva
 < 
dwBy‹s
)

833 
dwBy‹s
 = 
dwOuutAva
;

835 ià(
pbOuutBuf
 !ğ
NULL
) {

836 
	`memıy
 (
pbOuutBuf
 + *
pdwOuutU£d
,

837 
pgbOut
->
pbBuf
 +…gbOut->
dwV®idS¹
,

838 
dwBy‹s
);

841 *
pdwOuutU£d
 +ğ
dwBy‹s
;

842 
dwOuutAva
 -ğ
dwBy‹s
;

843 
pgbOut
->
dwV®idS¹
 +ğ
dwBy‹s
;

844 
pgbOut
->
dwFePos
 +ğ
dwBy‹s
;

845 
pgbOut
->
dwV®idL’
 -ğ
dwBy‹s
;

847 ià(
pgbOut
->
dwV®idL’
 != 0)

848 
ex™Loİ
;

850 
pgbOut
->
dwV®idS¹
 = 0;

853 ià(
g
->
³ndšgIn£¹
) {

854 
g
->
³ndšgIn£¹
 = 
FALSE
;

855 
ResuÉ
 |ğ
IP_WRITE_INSERT_OK
;

860 ià(
ResuÉ
 & 
g
->
wResuÉMask
)

861 
ex™Loİ
;

866 
iXfÜm
 = 
g
->
iOwÃr
;

868 ià(
iXfÜm
 < 0) {

869 
i
=
g
->
xfCouÁ
-1; i>=0; i--) {

870 ià(
g
->
xfA¼ay
[
i
].
eS‹
 =ğ
XS_CONV_NOT_RFD
) {

873 
iXfÜm
 = 
i
;

879 ià(
iXfÜm
 < 0) {

880 
i
=0; i<
g
->
xfCouÁ
; i++) {

881 ià(
g
->
xfA¼ay
[
i
].
eS‹
 !ğ
XS_DONE
) {

883 
iXfÜm
 = 
i
;

889 ià(
iXfÜm
 < 0) {

891 *
pdwIÅutU£d
 = 
dwIÅutAva
;

892 
ResuÉ
 |ğ
IP_DONE
;

895 
g
->
xfA¼ay
[g->
xfCouÁ
-1].
outT¿™s
.
lNumRows
 = g->
lOutRows
;

897 
g
->
xfA¼ay
[0].
šT¿™s
.
lNumRows
 = g->
lInRows
;

898 
ex™Loİ
;

903 
pXfÜm
 = &(
g
->
xfA¼ay
[
iXfÜm
]);

904 
©TheH—d
 = (
iXfÜm
 == 0);

905 
©TheTa
 = (
iXfÜm
 =ğ
g
->
xfCouÁ
-1);

906 
pPriÜXfÜm
 = 
©TheH—d
 ? 
NULL
 : &(
g
->
xfA¼ay
[
iXfÜm
-1]);

907 
pNextXfÜm
 = 
©TheTa
 ? 
NULL
 : &(
g
->
xfA¼ay
[
iXfÜm
+1]);

911 ià(
pXfÜm
->
eS‹
 =ğ
XS_NONEXISTENT
) {

912 
	`PRINT0
 (
	`_T
("CÚv”t: c»©šg xfÜm %d\n"), 
iXfÜm
);

913 
	`INSURE
 (
©TheH—d
 || 
pPriÜXfÜm
->
eS‹
>=
XS_CONVERTING
);

915 ià(
©TheH—d
) {

919 
	`memıy
 (&
pXfÜm
->
šT¿™s
, &
pPriÜXfÜm
->
outT¿™s
,

920 (
IP_IMAGE_TRAITS
));

922 ià(
©TheTa
) {

924 ià(
g
->
dwFÜûdHÜizDPI
 != 0)

925 
pXfÜm
->
šT¿™s
.
lHÜizDPI
 = ()
g
->
dwFÜûdHÜizDPI
;

926 ià(
g
->
dwFÜûdV”tDPI
 != 0)

927 
pXfÜm
->
šT¿™s
.
lV”tDPI
 = ()
g
->
dwFÜûdV”tDPI
;

931 
»suÉ
 = 
pXfÜm
->pXfÜm->
	`İ’XfÜm
 (&pXfÜm->
hXfÜm
);

932 
	`INSURE
 (
»suÉ
 =ğ
IP_DONE
);

933 
»suÉ
 = 
pXfÜm
->pXfÜm->
	`£tDeçuÉIÅutT¿™s
 (

934 
pXfÜm
->
hXfÜm
, &pXfÜm->
šT¿™s
);

935 
	`INSURE
 (
»suÉ
 =ğ
IP_DONE
);

936 
»suÉ
 = 
pXfÜm
->pXfÜm->
	`£tXfÜmS³c
 (

937 
pXfÜm
->
hXfÜm
,…XfÜm->
aXfÜmInfo
);

938 
	`INSURE
 (
»suÉ
 =ğ
IP_DONE
);

939 
»suÉ
 = 
pXfÜm
->pXfÜm->
	`g‘H—d”BufSize
 (

940 
pXfÜm
->
hXfÜm
, &pXfÜm->
dwMšInBufL’
);

941 
	`INSURE
 (
»suÉ
 =ğ
IP_DONE
);

943 ià(! 
©TheH—d
) {

945 
	`INSURE
 (
pXfÜm
->
dwMšInBufL’
 == 0);

948 ià(
pXfÜm
->
dwMšInBufL’
 == 0)

949 
pXfÜm
->
dwMšInBufL’
 = 1;

950 
	`PRINT0
 (
	`_T
("ipConvert:‡lloc input genbuf,†en=%d\n"),

951 
pXfÜm
->
dwMšInBufL’
);

952 
	`IP_MEM_ALLOC
 (
pXfÜm
->
dwMšInBufL’
, 
pgbIn
->
pbBuf
);

953 
pgbIn
->
dwBufL’
 = 
pXfÜm
->
dwMšInBufL’
;

954 
pgbIn
->
dwV®idS¹
 = 0;

955 
pgbIn
->
dwV®idL’
 = 0;

956 
pgbIn
->
dwFePos
 = 0;

959 
pXfÜm
->
eS‹
 = 
XS_PARSING_HEADER
;

964 ià(
pXfÜm
->
eS‹
 =ğ
XS_CONVERTING
 &&

965 (Ğ
©TheH—d
 && 
pbIÅutBuf
==
NULL
 && 
pgbIn
->
dwV®idL’
==0) ||

966 (!
©TheH—d
 && 
pPriÜXfÜm
->
eS‹
==
XS_DONE
 && 
g
->
iOwÃr
<0))) {

968 
	`PRINT0
 (
	`_T
("CÚv”t: xfÜm %d i now flushšg\n"), 
iXfÜm
);

969 
pXfÜm
->
eS‹
 = 
XS_FLUSHING
;

974 
ÃedIÅut
 = (
pXfÜm
->
eS‹
==
XS_PARSING_HEADER
 ||

975 
pXfÜm
->
eS‹
==
XS_CONVERTING
);

977 ià(
ÃedIÅut
) {

978 ià(! 
©TheH—d
) {

980 
	`INSURE
 (
g
->
iOwÃr
>=0 && g->
dwMidV®idL’
>0);

981 
	`PRINT1
 (
	`_T
("nÙ‡ˆh—d,…ix– ğ%08x\n"), *(
DWORD
*)(
g
->
pbMidInBuf
));

982 } ià(
pbIÅutBuf
 !ğ
NULL
) {

983 
DWORD
 
dwUnu£dS¹
;

987 ià(
pgbIn
->
dwBufL’
-pgbIn->
dwV®idS¹
 < 
pXfÜm
->
dwMšInBufL’
) {

989 
	`memmove
 (
pgbIn
->
pbBuf
,…gbIn->pbBuà+…gbIn->
dwV®idS¹
,

990 
pgbIn
->
dwV®idL’
);

991 
pgbIn
->
dwV®idS¹
 = 0;

992 
	`PRINT1
 (
	`_T
("Ëá ju¡,…ix– ğ%08x\n"), *(
DWORD
*)(
pgbIn
->
pbBuf
));

997 
dwUnu£dS¹
 = 
pgbIn
->
dwV®idS¹
 +…gbIn->
dwV®idL’
;

998 
dwBy‹s
 = 
pgbIn
->
dwBufL’
 - 
dwUnu£dS¹
;

999 ià(
dwBy‹s
 > 
dwIÅutAva
)

1000 
dwBy‹s
 = 
dwIÅutAva
;

1002 
	`memıy
 (
pgbIn
->
pbBuf
 + 
dwUnu£dS¹
,

1003 
pbIÅutBuf
 + *
pdwIÅutU£d
,

1004 
dwBy‹s
);

1006 
pgbIn
->
dwV®idL’
 +ğ
dwBy‹s
;

1007 *
pdwIÅutU£d
 +ğ
dwBy‹s
;

1008 
dwIÅutAva
 -ğ
dwBy‹s
;

1009 *
pdwIÅutNextPos
 +ğ
dwBy‹s
;

1012 ià(
pgbIn
->
dwV®idL’
 < 
pXfÜm
->
dwMšInBufL’
)

1013 
ex™Loİ
;

1014 
	`PRINT1
 (
	`_T
("© h—d,…ix– ğ%08x\n"), *(
DWORD
*)(
pgbIn
->
pbBuf
));

1018 ià(
©TheTa
 && 
pXfÜm
->
eS‹
!=
XS_PARSING_HEADER
) {

1020 
	`INSURE
 (
pgbOut
->
dwV®idL’
 == 0);

1025 
pbTheInBuf
 = 
©TheH—d
 ? 
pgbIn
->
pbBuf
 +…gbIn->
dwV®idS¹
 : 
g
->
pbMidInBuf
;

1026 
dwTheInL’
 = 
©TheH—d
 ? 
pgbIn
->
dwV®idL’
 : 
g
->
dwMidV®idL’
;

1027 
pbTheOutBuf
 = 
©TheTa
 ? 
pgbOut
->
pbBuf
 : 
g
->
pbMidOutBuf
;

1028 
dwTheOutL’
 = 
©TheTa
 ? 
pgbOut
->
dwBufL’
 : 
g
->
dwMidL’
;

1030 ià(
pXfÜm
->
eS‹
 =ğ
XS_PARSING_HEADER
) {

1031 
»suÉ
 = 
pXfÜm
->pXfÜm->
	`g‘Aùu®T¿™s
 (

1032 
pXfÜm
->
hXfÜm
,

1033 
dwTheInL’
, 
pbTheInBuf
, &
dwInU£d
, &
dwInNextPos
,

1034 &
pXfÜm
->
šT¿™s
,

1035 &
pXfÜm
->
outT¿™s
);

1036 
dwOutU£d
 = 0;

1037 
dwOutThisPos
 = 0;

1039 ià(
pXfÜm
->
eS‹
 =ğ
XS_FLUSHING
)

1040 
pbTheInBuf
 = 
NULL
;

1041 
»suÉ
 = 
pXfÜm
->pXfÜm->
	`cÚv”t
 (

1042 
pXfÜm
->
hXfÜm
,

1043 
dwTheInL’
, 
pbTheInBuf
, &
dwInU£d
, &
dwInNextPos
,

1044 
dwTheOutL’
, 
pbTheOutBuf
, &
dwOutU£d
, &
dwOutThisPos
);

1047 
	`PRINT1
 (
	`_T
("CÚv”t: xfÜm %d„‘uºed %04x\n"), 
iXfÜm
, 
»suÉ
);

1048 
	`PRINT1
 (
	`_T
("ipConvert: consumed %d‡nd…roduced %d bytes\n"),

1049 
dwInU£d
, 
dwOutU£d
);

1051 ià(
pbTheOutBuf
 !ğ
NULL
)

1052 
	`PRINT1
 (
	`_T
("CÚv”t: ouˆd©¨ğ%08x\n"), *(
DWORD
*)
pbTheOutBuf
);

1054 
	`INSURE
 ((
»suÉ
 & 
IP_FATAL_ERROR
) == 0);

1058 ià(
dwInU£d
 > 0) {

1059 ià(
pXfÜm
->
pfR—dP“k
 !ğ
NULL
) {

1060 #ià
defšed
 
_WIN32


1061 
__Œy
 {

1063 
pXfÜm
->
	`pfR—dP“k
 (
hJob
, &ÕXfÜm->
šT¿™s
),

1064 
dwInU£d
, 
pbTheInBuf
, 
pgbIn
->
dwFePos
,

1065 
pXfÜm
->
pU£rD©a
);

1066 #ià
defšed
 
_WIN32


1067 } 
	`__exû±
 (
EXCEPTION_EXECUTE_HANDLER
) {

1068 
çl_”rÜ
;

1073 ià(! 
©TheH—d
) {

1075 
g
->
iOwÃr
 = -1;

1076 
g
->
dwMidV®idL’
 = 0;

1080 ià(
ÃedIÅut
 && 
©TheH—d
) {

1081 ià(
dwInU£d
 >ğ
pgbIn
->
dwV®idL’
) {

1083 
pgbIn
->
dwV®idL’
 = 0;

1084 
pgbIn
->
dwV®idS¹
 = 0;

1085 
pgbIn
->
dwFePos
 = 
dwInNextPos
;

1088 
pgbIn
->
dwV®idL’
 -ğ
dwInU£d
;

1089 
pgbIn
->
dwV®idS¹
 +ğ
dwInU£d
;

1090 
pgbIn
->
dwFePos
 +ğ
dwInU£d
;

1095 ià(
pgbIn
->
dwFePos
 !ğ
dwInNextPos
) {

1096 
	`PRINT0
 (
	`_T
("CÚv”t: iÅuˆ£ekØ%d\n"), 
dwInNextPos
);

1097 
pgbIn
->
dwV®idL’
 = 0;

1098 
pgbIn
->
dwV®idS¹
 = 0;

1099 
pgbIn
->
dwFePos
 = 
dwInNextPos
;

1103 ià(
dwOutU£d
 > 0) {

1104 ià(
pXfÜm
->
pfWr™eP“k
 !ğ
NULL
) {

1105 #ià
defšed
 
_WIN32


1106 
__Œy
 {

1108 
pXfÜm
->
	`pfWr™eP“k
 (
hJob
, &ÕXfÜm->
outT¿™s
),

1109 
dwOutU£d
, 
pbTheOutBuf
, 
dwOutThisPos
,

1110 
pXfÜm
->
pU£rD©a
);

1111 #ià
defšed
 
_WIN32


1112 } 
	`__exû±
 (
EXCEPTION_EXECUTE_HANDLER
) {

1113 
çl_”rÜ
;

1118 ià(
©TheTa
) {

1119 
pgbOut
->
dwFePos
 = 
dwOutThisPos
;

1120 
pgbOut
->
dwV®idS¹
 = 0;

1121 
pgbOut
->
dwV®idL’
 = 
dwOutU£d
;

1123 
	`INSURE
 (
g
->
iOwÃr
 < 0);

1124 
g
->
iOwÃr
 = 
iXfÜm
 + 1;

1126 
pbTemp
 = 
g
->
pbMidInBuf
;

1127 
g
->
pbMidInBuf
 = g->
pbMidOutBuf
;

1128 
g
->
pbMidOutBuf
 = 
pbTemp
;

1129 
g
->
dwMidV®idL’
 = 
dwOutU£d
;

1135 
£ËùCnvS‹
 = 
FALSE
;

1137 ià(
pXfÜm
->
eS‹
 =ğ
XS_PARSING_HEADER
) {

1139 ià(
»suÉ
 & 
IP_DONE
) {

1140 
	`PRINT0
 (
	`_T
("CÚv”t: xfÜm %d i dÚ·rsšg h—d”\n"), 
iXfÜm
);

1141 
pXfÜm
->pXfÜm->
	`g‘Aùu®BufSizes
 (pXfÜm->
hXfÜm
,

1142 &
pXfÜm
->
dwMšInBufL’
, &pXfÜm->
dwMšOutBufL’
);

1144 ià(
©TheH—d
) {

1146 
n
 = 
pXfÜm
->
dwMšInBufL’
;

1147 ià(
n
 < 
MIN_GENBUF_LEN
)

1148 
n
 = 
MIN_GENBUF_LEN
;

1149 ià(
n
 < 
pgbIn
->
dwV®idL’
)

1150 
n
 = 
pgbIn
->
dwV®idL’
;

1151 
	`PRINT0
 (
	`_T
("ipConvert:‡lloc‚ew input genbuf, ")

1152 
	`_T
("Şd†’=%d,‚ew†’=%d\n"), 
pgbIn
->
dwBufL’
, 
n
);

1153 
	`PRINT0
 (
	`_T
(" dwMinInBufLen=%d, dwValidLen=%d\n"),

1154 
pXfÜm
->
dwMšInBufL’
, 
pgbIn
->
dwV®idL’
);

1155 
	`IP_MEM_ALLOC
 (
n
, 
pbTemp
);

1156 
	`memıy
 (
pbTemp
,

1157 
pgbIn
->
pbBuf
 +…gbIn->
dwV®idS¹
,

1158 
pgbIn
->
dwV®idL’
);

1159 
	`IP_MEM_FREE
 (
pgbIn
->
pbBuf
);

1160 
pgbIn
->
pbBuf
 = 
pbTemp
;

1161 
pgbIn
->
dwBufL’
 = 
n
;

1162 
pgbIn
->
dwV®idS¹
 = 0;

1166 
n
 = 
©TheH—d
 ? 0 : 
pXfÜm
->
dwMšInBufL’
;

1167 ià(!
©TheTa
 && 
pXfÜm
->
dwMšOutBufL’
 > 
n
)

1168 
n
 = 
pXfÜm
->
dwMšOutBufL’
;

1171 ià(
n
 > 
g
->
dwMidL’
) {

1174 
PBYTE
 
pbOldMidInBuf
 = 
g
->
pbMidInBuf
;

1175 
g
->
pbMidInBuf
 = 
NULL
;

1176 
	`PRINT0
 (
	`_T
("ipConvert:‡lloc mid-bufs, old†en=%d,‚ew†en=%d\n"),

1177 
g
->
dwMidL’
, 
n
);

1178 
	`d–‘eMidBufs
 (
g
);

1179 
	`IP_MEM_ALLOC
 (
n
, 
g
->
pbMidInBuf
 );

1180 
	`IP_MEM_ALLOC
 (
n
, 
g
->
pbMidOutBuf
);

1181 ià(
pbOldMidInBuf
 !ğ
NULL
) {

1182 
	`memıy
 (
g
->
pbMidInBuf
, 
pbOldMidInBuf
, g->
dwMidL’
);

1183 
	`IP_MEM_FREE
 (
pbOldMidInBuf
);

1185 
g
->
dwMidL’
 = 
n
;

1188 ià(
©TheTa
) {

1190 
n
 = 
pXfÜm
->
dwMšOutBufL’
;

1191 ià(
n
 < 
MIN_GENBUF_LEN
)

1192 
n
 = 
MIN_GENBUF_LEN
;

1193 
	`PRINT0
 (
	`_T
("ipConvert:‡lloc output genbuf,†en=%d, minlen=%d\n"),

1194 
n
, 
pXfÜm
->
dwMšOutBufL’
);

1195 
	`IP_MEM_ALLOC
 (
n
, 
pgbOut
->
pbBuf
);

1196 
pgbOut
->
dwBufL’
 = 
n
;

1197 
pgbOut
->
dwV®idS¹
 = 0;

1198 
pgbOut
->
dwV®idL’
 = 0;

1204 
ResuÉ
 |ğ
IP_PARSED_HEADER
;

1207 
£ËùCnvS‹
 = 
TRUE
;

1212 ià(
©TheH—d
) {

1214 ià(
»suÉ
 & 
IP_CONSUMED_ROW
) {

1215 
g
->
lInRows
 += 1;

1216 
ResuÉ
 |ğ
IP_CONSUMED_ROW
;

1218 ià(
»suÉ
 & 
IP_NEW_OUTPUT_PAGE
) {

1221 
g
->
iInPages
 += 1;

1222 
ResuÉ
 |ğ
IP_NEW_INPUT_PAGE
;

1226 ià(
©TheTa
) {

1228 
ResuÉ
 |ğ(
»suÉ
 & (
IP_PRODUCED_ROW
 | 
IP_NEW_OUTPUT_PAGE
));

1229 ià(
»suÉ
 & 
IP_PRODUCED_ROW
)

1230 
g
->
lOutRows
 += 1;

1231 ià(
»suÉ
 & 
IP_NEW_OUTPUT_PAGE
)

1232 
g
->
iOutPages
 += 1;

1233 ià(
»suÉ
 & 
IP_WRITE_INSERT_OK
 & 
g
->
wResuÉMask
)

1234 
g
->
³ndšgIn£¹
 = 
TRUE
;

1235 } ià(
»suÉ
 & 
IP_NEW_OUTPUT_PAGE
) {

1237 
	`PRINT0
 (
	`_T
("CÚv”t: xfÜm %d h™ƒnd oà·ge\n"), 
iXfÜm
);

1238 
pNextXfÜm
->
pXfÜm
->
	`ÃwPage
 (pNextXfÜm->
hXfÜm
);

1241 ià(
»suÉ
 & 
IP_DONE
) {

1242 
	`PRINT0
 (
	`_T
("CÚv”t: xfÜm %d i dÚe\n"), 
iXfÜm
);

1243 
pXfÜm
->
eS‹
 = 
XS_DONE
;

1244 } ià(
pXfÜm
->
eS‹
 !ğ
XS_FLUSHING
)

1245 
£ËùCnvS‹
 = 
TRUE
;

1248 ià(
£ËùCnvS‹
) {

1250 ià((
»suÉ
 & 
IP_READY_FOR_DATA
) == 0)

1251 
	`PRINT1
 (
	`_T
("CÚv”t: xfÜm %d i nÙ„—dy fÜ d©a\n"), 
iXfÜm
);

1252 
pXfÜm
->
eS‹
 = (
»suÉ
 & 
IP_READY_FOR_DATA
)

1253 ? 
XS_CONVERTING
 : 
XS_CONV_NOT_RFD
;

1257 
ex™Loİ
: ;

1263 *
pdwIÅutNextPos
 = 
pgbIn
->
dwFePos
 +…gbIn->
dwV®idL’
;

1266 ià(
g
->
xfA¼ay
[g->
xfCouÁ
-1].
eS‹
 >ğ
XS_CONVERTING
)

1267 
ResuÉ
 |ğ
IP_PARSED_HEADER
;

1269 
	`PRINT0
 (
	`_T
("ipConvert: ipResult=%04x,„eturning %04x, InputUsed=%d InputNextPos=%d OutputUsed=%d OutputThisPos=%d\n"),

1270 
ResuÉ
, ipResuÉ & 
g
->
wResuÉMask
, *
pdwIÅutU£d
, *
pdwIÅutNextPos
, *
pdwOuutU£d
, *
pdwOuutThisPos
);

1272 #ifdeà
HPIP_DEBUG


1273 ià(
pbIÅutBuf
 && *
pdwIÅutU£d
)

1274 
	`wr™e
(
šfd
, 
pbIÅutBuf
, *
pdwIÅutU£d
);

1276 ià(*
pdwOuutU£d
)

1277 
	`wr™e
(
outfd
, 
pbOuutBuf
, *
pdwOuutU£d
);

1280  
ResuÉ
 & 
g
->
wResuÉMask
;

1282 
çl_”rÜ
:

1283  
IP_FATAL_ERROR
;

1284 
	}
}

1295 cÚ¡ 
BYTE
 
	gbaMœrÜImage
[256] =

1331 
VOID
 
	$MœrÜBy‹s
(
PBYTE
 
pbIÅutBuf
,
DWORD
 
dwIÅutAva
) {

1332 
dwIÅutAva
>0) {

1333 *
pbIÅutBuf
=
baMœrÜImage
[*pbInputBuf];

1334 
pbIÅutBuf
++;

1335 
dwIÅutAva
--;

1337 
	}
}

	@ip/xbi2gray.c

86 
	~"hp.h
"

87 
	~"defs.h
"

88 
	~"¡ršg.h
"

92 
	~"¡dio.h
"

93 
	~<tch¬.h
>

95 
	#PRINT
(
msg
,
¬g1
,
¬g2
) \

96 
	`_á´štf
(
¡d”r
, 
msg
, ()
¬g1
, ()
¬g2
)

	)

98 
	#PRINT
(
msg
,
¬g1
,
¬g2
)

	)

101 
	#CHECK_VALUE
 0x1û5ÿ7e

	)

104 
IP_IMAGE_TRAITS
 
	mšT¿™s
;

105 
UINT
 
	muRowsDÚe
;

106 
WORD
 
	mwOutB™sP”Pix–
;

107 
RGBQUAD
 
	mrgbWh™e
;

108 
RGBQUAD
 
	mrgbBÏck
;

109 
DWORD
 
	mdwInRowBy‹s
;

110 
DWORD
 
	mdwOutRowBy‹s
;

111 
DWORD
 
	mdwInNextPos
;

112 
DWORD
 
	mdwOutNextPos
;

113 
DWORD
 
	mdwV®idChk
;

114 } 
	tB2G_INST
, *
	tPB2G_INST
;

131 
WORD
 
	$bi2g¿y_İ’XfÜm
 (

132 
IP_XFORM_HANDLE
 *
pXfÜm
)

134 
PB2G_INST
 
g
;

136 
	`INSURE
 (
pXfÜm
 !ğ
NULL
);

137 
	`IP_MEM_ALLOC
 ((
B2G_INST
), 
g
);

138 *
pXfÜm
 = 
g
;

139 
	`mem£t
 (
g
, 0, (
B2G_INST
));

140 
g
->
dwV®idChk
 = 
CHECK_VALUE
;

141  
IP_DONE
;

143 
çl_”rÜ
:

144  
IP_FATAL_ERROR
;

145 
	}
}

164 
WORD
 
	$bi2g¿y_£tDeçuÉIÅutT¿™s
 (

165 
IP_XFORM_HANDLE
 
hXfÜm
,

166 
PIP_IMAGE_TRAITS
 
pT¿™s
)

168 
PB2G_INST
 
g
;

170 
	`HANDLE_TO_PTR
 (
hXfÜm
, 
g
);

173 
	`INSURE
 (
pT¿™s
->
iB™sP”Pix–
 == 1);

174 
	`INSURE
 (
pT¿™s
->
iCompÚ’tsP”Pix–
 == 1);

175 
	`INSURE
 (
pT¿™s
->
iPix–sP”Row
 > 0);

177 
g
->
šT¿™s
 = *
pT¿™s
;

178  
IP_DONE
;

180 
çl_”rÜ
:

181  
IP_FATAL_ERROR
;

182 
	}
}

192 
WORD
 
	$bi2g¿y_£tXfÜmS³c
 (

193 
IP_XFORM_HANDLE
 
hXfÜm
,

194 
DWORD_OR_PVOID
 
aXfÜmInfo
[])

196 
PB2G_INST
 
g
;

197 
UINT
 
nB™s
;

199 
	`HANDLE_TO_PTR
 (
hXfÜm
, 
g
);

200 
nB™s
 = 
aXfÜmInfo
[
IP_BI_2_GRAY_OUTPUT_BPP
].
dwÜd
;

201 
	`INSURE
 (
nB™s
==8 ||‚Bits==24);

202 
g
->
wOutB™sP”Pix–
 = (
WORD
)
nB™s
;

203 
g
->
rgbWh™e
 = 
aXfÜmInfo
[
IP_BI_2_GRAY_WHITE_PIXEL
].
rgbquad
;

204 
g
->
rgbBÏck
 = 
aXfÜmInfo
[
IP_BI_2_GRAY_BLACK_PIXEL
].
rgbquad
;

205  
IP_DONE
;

207 
çl_”rÜ
:

208  
IP_FATAL_ERROR
;

209 
	}
}

219 
WORD
 
	$bi2g¿y_g‘H—d”BufSize
 (

220 
IP_XFORM_HANDLE
 
hXfÜm
,

221 
DWORD
 *
pdwInBufL’
)

224 *
pdwInBufL’
 = 0;

225  
IP_DONE
;

226 
	}
}

236 
WORD
 
	$bi2g¿y_g‘Aùu®T¿™s
 (

237 
IP_XFORM_HANDLE
 
hXfÜm
,

238 
DWORD
 
dwIÅutAva
,

239 
PBYTE
 
pbIÅutBuf
,

240 
PDWORD
 
pdwIÅutU£d
,

241 
PDWORD
 
pdwIÅutNextPos
,

242 
PIP_IMAGE_TRAITS
 
pInT¿™s
,

243 
PIP_IMAGE_TRAITS
 
pOutT¿™s
)

245 
PB2G_INST
 
g
;

247 
	`HANDLE_TO_PTR
 (
hXfÜm
, 
g
);

250 *
pdwIÅutU£d
 = 0;

251 *
pdwIÅutNextPos
 = 0;

253 *
pInT¿™s
 = 
g
->
šT¿™s
;

254 *
pOutT¿™s
 = 
g
->
šT¿™s
;

255 
pOutT¿™s
->
iB™sP”Pix–
 = 
g
->
wOutB™sP”Pix–
;

256 
pOutT¿™s
->
iCompÚ’tsP”Pix–
 = 
g
->
wOutB™sP”Pix–
==8 ? 1 : 3;

258 
g
->
dwInRowBy‹s
 = (g->
šT¿™s
.
iPix–sP”Row
+7) / 8;

259 
g
->
dwOutRowBy‹s
 = g->
šT¿™s
.
iPix–sP”Row
 * 
pOutT¿™s
->
iCompÚ’tsP”Pix–
;

261  
IP_DONE
 | 
IP_READY_FOR_DATA
;

263 
çl_”rÜ
:

264  
IP_FATAL_ERROR
;

265 
	}
}

275 
WORD
 
	$bi2g¿y_g‘Aùu®BufSizes
 (

276 
IP_XFORM_HANDLE
 
hXfÜm
,

277 
PDWORD
 
pdwMšInBufL’
,

278 
PDWORD
 
pdwMšOutBufL’
)

280 
PB2G_INST
 
g
;

282 
	`HANDLE_TO_PTR
 (
hXfÜm
, 
g
);

283 *
pdwMšInBufL’
 = 
g
->
dwInRowBy‹s
;

284 *
pdwMšOutBufL’
 = 
g
->
dwOutRowBy‹s
;

286  
IP_DONE
;

288 
çl_”rÜ
:

289  
IP_FATAL_ERROR
;

290 
	}
}

300 
WORD
 
	$bi2g¿y_cÚv”t
 (

301 
IP_XFORM_HANDLE
 
hXfÜm
,

302 
DWORD
 
dwIÅutAva
,

303 
PBYTE
 
pbIÅutBuf
,

304 
PDWORD
 
pdwIÅutU£d
,

305 
PDWORD
 
pdwIÅutNextPos
,

306 
DWORD
 
dwOuutAva
,

307 
PBYTE
 
pbOuutBuf
,

308 
PDWORD
 
pdwOuutU£d
,

309 
PDWORD
 
pdwOuutThisPos
)

311 
PB2G_INST
 
g
;

312 
PBYTE
 
pIn
, 
pOut
, 
pInAá”
;

313 
BYTE
 
bMask
, 
bBev–
;

315 
	`HANDLE_TO_PTR
 (
hXfÜm
, 
g
);

319 ià(
pbIÅutBuf
 =ğ
NULL
) {

320 
	`PRINT
 (
	`_T
("bi2gray_convert: Toldo flush.\n"), 0, 0);

321 *
pdwIÅutU£d
 = *
pdwOuutU£d
 = 0;

322 *
pdwIÅutNextPos
 = 
g
->
dwInNextPos
;

323 *
pdwOuutThisPos
 = 
g
->
dwOutNextPos
;

324  
IP_DONE
;

329 
	`INSURE
 (
dwIÅutAva
 >ğ
g
->
dwInRowBy‹s
 );

330 
	`INSURE
 (
dwOuutAva
 >ğ
g
->
dwOutRowBy‹s
);

332 
pIn
 = 
pbIÅutBuf
;

333 
pOut
 = 
pbOuutBuf
;

334 
pInAá”
 = 
pIn
 + 
g
->
dwInRowBy‹s
;

336 
pIn
 < 
pInAá”
) {

337 
bBev–
 = *
pIn
++;

339 ià(
g
->
wOutB™sP”Pix–
 == 24) {

340 
bMask
=0x80u; bMask!=0; bMask>>=1) {

341 *(
RGBQUAD
*)
pOut
 = (
bMask
 & 
bBev–
)

342 ? 
g
->
rgbBÏck


343 : 
g
->
rgbWh™e
;

344 
pOut
 += 3;

347 
bMask
=0x80u; bMask!=0; bMask>>=1) {

348 *
pOut
++ = (
bMask
 & 
bBev–
)

349 ? 
g
->
rgbBÏck
.
rgbRed


350 : 
g
->
rgbWh™e
.
rgbRed
;

355 *
pdwIÅutU£d
 = 
g
->
dwInRowBy‹s
;

356 
g
->
dwInNextPos
 +ğg->
dwInRowBy‹s
;

357 *
pdwIÅutNextPos
 = 
g
->
dwInNextPos
;

359 *
pdwOuutU£d
 = 
g
->
dwOutRowBy‹s
;

360 *
pdwOuutThisPos
 = 
g
->
dwOutNextPos
;

361 
g
->
dwOutNextPos
 +ğg->
dwOutRowBy‹s
;

363 
g
->
uRowsDÚe
 += 1;

365  
IP_CONSUMED_ROW
 | 
IP_PRODUCED_ROW
 | 
IP_READY_FOR_DATA
;

367 
çl_”rÜ
:

368  
IP_FATAL_ERROR
;

369 
	}
}

379 
WORD
 
	$bi2g¿y_š£¹edD©a
 (

380 
IP_XFORM_HANDLE
 
hXfÜm
,

381 
DWORD
 
dwNumBy‹s
)

383 
	`çlB»akPošt
 ();

384  
IP_FATAL_ERROR
;

385 
	}
}

395 
WORD
 
	$bi2g¿y_ÃwPage
 (

396 
IP_XFORM_HANDLE
 
hXfÜm
)

398 
PB2G_INST
 
g
;

400 
	`HANDLE_TO_PTR
 (
hXfÜm
, 
g
);

402  
IP_DONE
;

404 
çl_”rÜ
:

405  
IP_FATAL_ERROR
;

407 
	}
}

417 
WORD
 
	$bi2g¿y_şo£XfÜm
 (
IP_XFORM_HANDLE
 
hXfÜm
)

419 
PB2G_INST
 
g
;

421 
	`HANDLE_TO_PTR
 (
hXfÜm
, 
g
);

423 
g
->
dwV®idChk
 = 0;

424 
	`IP_MEM_FREE
 (
g
);

426  
IP_DONE
;

428 
çl_”rÜ
:

429  
IP_FATAL_ERROR
;

430 
	}
}

440 
IP_XFORM_TBL
 
	gbi2g¿yTbl
 = {

441 
bi2g¿y_İ’XfÜm
,

442 
bi2g¿y_£tDeçuÉIÅutT¿™s
,

443 
bi2g¿y_£tXfÜmS³c
,

444 
bi2g¿y_g‘H—d”BufSize
,

445 
bi2g¿y_g‘Aùu®T¿™s
,

446 
bi2g¿y_g‘Aùu®BufSizes
,

447 
bi2g¿y_cÚv”t
,

448 
bi2g¿y_ÃwPage
,

449 
bi2g¿y_š£¹edD©a
,

450 
bi2g¿y_şo£XfÜm


	@ip/xchgbpp.c

83 
	~"hp.h
"

84 
	~"defs.h
"

85 
	~"¡ršg.h
"

86 
	~"as£¹.h
"

90 
	~"¡dio.h
"

91 
	~<tch¬.h
>

93 
	#PRINT
(
msg
,
¬g1
,
¬g2
) \

94 
	`_á´štf
(
¡d”r
, 
msg
, ()
¬g1
, ()
¬g2
)

	)

96 
	#PRINT
(
msg
,
¬g1
,
¬g2
)

	)

99 
	#CHECK_VALUE
 0x1û5ÿ7e

	)

102 
IP_IMAGE_TRAITS
 
	mšT¿™s
;

103 
UINT
 
	muRowsDÚe
;

104 
WORD
 
	mwOutB™sP”Pix–
;

105 
DWORD
 
	mdwInRowBy‹s
;

106 
DWORD
 
	mdwOutRowBy‹s
;

107 
DWORD
 
	mdwInNextPos
;

108 
DWORD
 
	mdwOutNextPos
;

109 
DWORD
 
	mdwV®idChk
;

110 } 
	tCBPP_INST
, *
	tPCBPP_INST
;

127 
WORD
 
	$chªgeBPP_İ’XfÜm
 (

128 
IP_XFORM_HANDLE
 *
pXfÜm
)

130 
PCBPP_INST
 
g
;

132 
	`INSURE
 (
pXfÜm
 !ğ
NULL
);

133 
	`IP_MEM_ALLOC
 ((
CBPP_INST
), 
g
);

134 *
pXfÜm
 = 
g
;

135 
	`mem£t
 (
g
, 0, (
CBPP_INST
));

136 
g
->
dwV®idChk
 = 
CHECK_VALUE
;

137  
IP_DONE
;

139 
çl_”rÜ
:

140  
IP_FATAL_ERROR
;

141 
	}
}

160 
WORD
 
	$chªgeBPP_£tDeçuÉIÅutT¿™s
 (

161 
IP_XFORM_HANDLE
 
hXfÜm
,

162 
PIP_IMAGE_TRAITS
 
pT¿™s
)

164 
PCBPP_INST
 
g
;

165 
bµ
;

167 
	`HANDLE_TO_PTR
 (
hXfÜm
, 
g
);

170 
bµ
 = 
pT¿™s
->
iB™sP”Pix–
;

171 
	`INSURE
 (
bµ
==1 || bpp==8 || bpp==16 || bpp==24 || bpp==48);

172 
	`INSURE
 (
pT¿™s
->
iCompÚ’tsP”Pix–
==1 ||…Traits->iComponentsPerPixel==3);

173 
	`INSURE
 (
pT¿™s
->
iPix–sP”Row
 > 0);

175 
g
->
šT¿™s
 = *
pT¿™s
;

176  
IP_DONE
;

178 
çl_”rÜ
:

179  
IP_FATAL_ERROR
;

180 
	}
}

190 
WORD
 
	$chªgeBPP_£tXfÜmS³c
 (

191 
IP_XFORM_HANDLE
 
hXfÜm
,

192 
DWORD_OR_PVOID
 
aXfÜmInfo
[])

194 
PCBPP_INST
 
g
;

195 
UINT
 
nB™s
;

197 
	`HANDLE_TO_PTR
 (
hXfÜm
, 
g
);

198 
nB™s
 = 
aXfÜmInfo
[
IP_CHANGE_BPP_OUTPUT_BPP
].
dwÜd
;

199 
g
->
wOutB™sP”Pix–
 = (
WORD
)
nB™s
;

200  
IP_DONE
;

202 
çl_”rÜ
:

203  
IP_FATAL_ERROR
;

204 
	}
}

214 
WORD
 
	$chªgeBPP_g‘H—d”BufSize
 (

215 
IP_XFORM_HANDLE
 
hXfÜm
,

216 
DWORD
 *
pdwInBufL’
)

219 *
pdwInBufL’
 = 0;

220  
IP_DONE
;

221 
	}
}

231 
WORD
 
	$chªgeBPP_g‘Aùu®T¿™s
 (

232 
IP_XFORM_HANDLE
 
hXfÜm
,

233 
DWORD
 
dwIÅutAva
,

234 
PBYTE
 
pbIÅutBuf
,

235 
PDWORD
 
pdwIÅutU£d
,

236 
PDWORD
 
pdwIÅutNextPos
,

237 
PIP_IMAGE_TRAITS
 
pInT¿™s
,

238 
PIP_IMAGE_TRAITS
 
pOutT¿™s
)

240 
PCBPP_INST
 
g
;

242 
	`HANDLE_TO_PTR
 (
hXfÜm
, 
g
);

245 *
pdwIÅutU£d
 = 0;

246 *
pdwIÅutNextPos
 = 0;

248 *
pInT¿™s
 = 
g
->
šT¿™s
;

249 *
pOutT¿™s
 = 
g
->
šT¿™s
;

250 
pOutT¿™s
->
iB™sP”Pix–
 = 
g
->
wOutB™sP”Pix–
;

251 
pOutT¿™s
->
iCompÚ’tsP”Pix–
 = 
g
->
wOutB™sP”Pix–
<24 ? 1 : 3;

253 
g
->
dwInRowBy‹s
 = (g->
šT¿™s
.
iPix–sP”Row
*g->šT¿™s.
iB™sP”Pix–
 + 7) / 8;

254 
g
->
dwOutRowBy‹s
 = (g->
šT¿™s
.
iPix–sP”Row
*g->
wOutB™sP”Pix–
 + 7) / 8;

256  
IP_DONE
 | 
IP_READY_FOR_DATA
;

258 
çl_”rÜ
:

259  
IP_FATAL_ERROR
;

260 
	}
}

270 
WORD
 
	$chªgeBPP_g‘Aùu®BufSizes
 (

271 
IP_XFORM_HANDLE
 
hXfÜm
,

272 
PDWORD
 
pdwMšInBufL’
,

273 
PDWORD
 
pdwMšOutBufL’
)

275 
PCBPP_INST
 
g
;

277 
	`HANDLE_TO_PTR
 (
hXfÜm
, 
g
);

278 *
pdwMšInBufL’
 = 
g
->
dwInRowBy‹s
;

279 *
pdwMšOutBufL’
 = 
g
->
dwOutRowBy‹s
;

281  
IP_DONE
;

283 
çl_”rÜ
:

284  
IP_FATAL_ERROR
;

285 
	}
}

295 
WORD
 
	$chªgeBPP_cÚv”t
 (

296 
IP_XFORM_HANDLE
 
hXfÜm
,

297 
DWORD
 
dwIÅutAva
,

298 
PBYTE
 
pbIÅutBuf
,

299 
PDWORD
 
pdwIÅutU£d
,

300 
PDWORD
 
pdwIÅutNextPos
,

301 
DWORD
 
dwOuutAva
,

302 
PBYTE
 
pbOuutBuf
,

303 
PDWORD
 
pdwOuutU£d
,

304 
PDWORD
 
pdwOuutThisPos
)

306 
PCBPP_INST
 
g
;

307 
PBYTE
 
pIn
, 
pOut
, 
pInAá”
;

308 
rv
, 
gv
, 
bv
;

309 
BYTE
 
bMask
, 
bBev–
;

310 
BYTE
 
bPix–s
;

311 
WORD
 
wPix–s
;

312 
DWORD
 
dwPix–s
;

314 
	#OUTPUT_THRESHOLDED_BIT
(
g¿yP¬am
) { \

315 
g¿y
 = 
g¿yP¬am
; \

316 ià(
g¿y
 < 128è
bBev–
 |ğ
bMask
; \

317 
bMask
 >>= 1; \

318 ià(
bMask
 == 0) { \

319 *
pOut
++ = (
BYTE
)
bBev–
; \

320 
bBev–
 = 0; \

321 
bMask
 = (
BYTE
)0x80; \

323 }

	)

325 
	`HANDLE_TO_PTR
 (
hXfÜm
, 
g
);

329 ià(
pbIÅutBuf
 =ğ
NULL
) {

330 
	`PRINT
 (
	`_T
("changeBPP_convert: Toldo flush.\n"), 0, 0);

331 *
pdwIÅutU£d
 = *
pdwOuutU£d
 = 0;

332 *
pdwIÅutNextPos
 = 
g
->
dwInNextPos
;

333 *
pdwOuutThisPos
 = 
g
->
dwOutNextPos
;

334  
IP_DONE
;

339 
	`INSURE
 (
dwIÅutAva
 >ğ
g
->
dwInRowBy‹s
 );

340 
	`INSURE
 (
dwOuutAva
 >ğ
g
->
dwOutRowBy‹s
);

342 
bMask
 = 0x80;

343 
bBev–
 = 0;

345 
pIn
 = 
pbIÅutBuf
;

346 
pOut
 = 
pbOuutBuf
;

347 
pInAá”
 = 
pIn
 + 
g
->
dwInRowBy‹s
;

349 ià(
g
->
šT¿™s
.
iB™sP”Pix–
 =ğg->
wOutB™sP”Pix–
) {

351 
	`memıy
 (
pOut
, 
pIn
, 
g
->
dwInRowBy‹s
);

352 } ià(
g
->
šT¿™s
.
iB™sP”Pix–
 == 1) {

353 
pIn
 < 
pInAá”
) {

354 
bBev–
 = *
pIn
++;

356 ià(
g
->
wOutB™sP”Pix–
 == 48) {

357 
bMask
=0x80u; bMask!=0; bMask>>=1) {

358 
dwPix–s
 = (
bMask
 & 
bBev–
)

361 *(
DWORD
*)
pOut
 = 
dwPix–s
;

362 *(
WORD
*)(
pOut
+4èğ(WORD)
dwPix–s
;

363 
pOut
 += 6;

365 } ià(
g
->
wOutB™sP”Pix–
 == 24) {

366 
bMask
=0x80u; bMask!=0; bMask>>=1) {

367 *(
DWORD
*)
pOut
 = (
bMask
 & 
bBev–
)

370 
pOut
 += 3;

372 } ià(
g
->
wOutB™sP”Pix–
 == 16) {

373 
bMask
=0x80u; bMask!=0; bMask>>=1) {

374 *(
WORD
*)
pOut
 = (
bMask
 & 
bBev–
)

377 
pOut
 += 2;

379 } ià(
g
->
wOutB™sP”Pix–
 == 8) {

380 
bMask
=0x80u; bMask!=0; bMask>>=1) {

381 *
pOut
++ = (
bMask
 & 
bBev–
)

386 
	`as£¹
 (0);

389 ià(
g
->
šT¿™s
.
iB™sP”Pix–
 == 8) {

390 ià(
g
->
wOutB™sP”Pix–
 == 48) {

391 
pIn
 < 
pInAá”
) {

392 
wPix–s
 = (*
pIn
++ << 8);

393 *(
WORD
*)(
pOut
+0èğ
wPix–s
;

394 *(
WORD
*)(
pOut
+2èğ
wPix–s
;

395 *(
WORD
*)(
pOut
+4èğ
wPix–s
;

396 
pOut
 += 6;

398 } ià(
g
->
wOutB™sP”Pix–
 == 24) {

399 
pIn
 < 
pInAá”
) {

400 
bPix–s
 = *
pIn
++;

401 *
pOut
++ = 
bPix–s
;

402 *
pOut
++ = 
bPix–s
;

403 *
pOut
++ = 
bPix–s
;

405 } ià(
g
->
wOutB™sP”Pix–
 == 16) {

406 
pIn
 < 
pInAá”
) {

407 
wPix–s
 = (*
pIn
++ << 8);

408 *(
WORD
*)
pOut
 = 
wPix–s
;

409 
pOut
 += 2;

411 } ià(
g
->
wOutB™sP”Pix–
 == 1) {

412 
pIn
 < 
pInAá”
) {

413 
	`OUTPUT_THRESHOLDED_BIT
 (*
pIn
);

414 
pIn
++;

417 
	`as£¹
 (0);

419 ià(
g
->
šT¿™s
.
iB™sP”Pix–
 == 16) {

420 ià(
g
->
wOutB™sP”Pix–
 == 48) {

421 
pIn
 < 
pInAá”
) {

422 
wPix–s
 = *(
WORD
*)
pIn
;

423 *(
WORD
*)(
pOut
+0èğ
wPix–s
;

424 *(
WORD
*)(
pOut
+2èğ
wPix–s
;

425 *(
WORD
*)(
pOut
+4èğ
wPix–s
;

426 
pIn
 += 2;

427 
pOut
 += 6;

429 } ià(
g
->
wOutB™sP”Pix–
 == 24) {

430 
pIn
 < 
pInAá”
) {

431 
bPix–s
 = (*(
WORD
*)
pIn
) >> 8;

432 
pIn
 += 2;

433 *
pOut
++ = 
bPix–s
;

434 *
pOut
++ = 
bPix–s
;

435 *
pOut
++ = 
bPix–s
;

437 } ià(
g
->
wOutB™sP”Pix–
 == 8) {

438 
pIn
 < 
pInAá”
) {

439 *
pOut
++ = (*(
WORD
*)
pIn
) >> 8;

440 
pIn
 += 2;

442 } ià(
g
->
wOutB™sP”Pix–
 == 1) {

443 
pIn
 < 
pInAá”
) {

444 
	`OUTPUT_THRESHOLDED_BIT
 ((*(
WORD
*)
pIn
) >> 8);

445 
pIn
 += 2;

448 
	`as£¹
 (0);

450 ià(
g
->
šT¿™s
.
iB™sP”Pix–
 == 24) {

451 ià(
g
->
wOutB™sP”Pix–
 == 48) {

452 
pIn
 < 
pInAá”
) {

453 *(
WORD
*)(
pOut
+0èğ(WORD)(*
pIn
++) << 8;

454 *(
WORD
*)(
pOut
+2èğ(WORD)(*
pIn
++) << 8;

455 *(
WORD
*)(
pOut
+4èğ(WORD)(*
pIn
++) << 8;

456 
pOut
 += 6;

458 } ià(
g
->
wOutB™sP”Pix–
 == 16) {

460 
pIn
 < 
pInAá”
) {

461 
rv
 = (*
pIn
++) << 8;

462 
gv
 = (*
pIn
++) << 8;

463 
bv
 = (*
pIn
++) << 8;

464 *(
WORD
*)
pOut
 = 
	`NTSC_LUMINANCE
 (
rv
, 
gv
, 
bv
);

465 
pOut
 += 2;

467 } ià(
g
->
wOutB™sP”Pix–
 == 8) {

469 
pIn
 < 
pInAá”
) {

470 
rv
 = *
pIn
++;

471 
gv
 = *
pIn
++;

472 
bv
 = *
pIn
++;

473 *
pOut
++ = 
	`NTSC_LUMINANCE
 (
rv
, 
gv
, 
bv
);

475 } ià(
g
->
wOutB™sP”Pix–
 == 1) {

477 
pIn
 < 
pInAá”
) {

478 
rv
 = *
pIn
++;

479 
gv
 = *
pIn
++;

480 
bv
 = *
pIn
++;

481 
	`OUTPUT_THRESHOLDED_BIT
 (
	`NTSC_LUMINANCE
(
rv
,
gv
,
bv
));

484 
	`as£¹
 (0);

486 ià(
g
->
šT¿™s
.
iB™sP”Pix–
 == 48) {

487 ià(
g
->
wOutB™sP”Pix–
 == 24) {

488 
pIn
 < 
pInAá”
) {

489 *
pOut
++ = ((
WORD
*)
pIn
)[0] >> 8;

490 *
pOut
++ = ((
WORD
*)
pIn
)[1] >> 8;

491 *
pOut
++ = ((
WORD
*)
pIn
)[2] >> 8;

492 
pIn
 += 6;

494 } ià(
g
->
wOutB™sP”Pix–
 == 16) {

496 
pIn
 < 
pInAá”
) {

497 
rv
 = ((
WORD
*)
pIn
)[0];

498 
gv
 = ((
WORD
*)
pIn
)[1];

499 
bv
 = ((
WORD
*)
pIn
)[2];

500 *(
WORD
*)
pOut
 = 
	`NTSC_LUMINANCE
 (
rv
, 
gv
, 
bv
);

501 
pIn
 += 6;

502 
pOut
 += 2;

504 } ià(
g
->
wOutB™sP”Pix–
 == 8) {

506 
pIn
 < 
pInAá”
) {

507 
rv
 = ((
WORD
*)
pIn
)[0];

508 
gv
 = ((
WORD
*)
pIn
)[1];

509 
bv
 = ((
WORD
*)
pIn
)[2];

510 *
pOut
++ = 
	`NTSC_LUMINANCE
 (
rv
, 
gv
, 
bv
) >> 8;

511 
pIn
 += 6;

513 } ià(
g
->
wOutB™sP”Pix–
 == 1) {

515 
pIn
 < 
pInAá”
) {

516 
rv
 = ((
WORD
*)
pIn
)[0];

517 
gv
 = ((
WORD
*)
pIn
)[1];

518 
bv
 = ((
WORD
*)
pIn
)[2];

519 
	`OUTPUT_THRESHOLDED_BIT
 (
	`NTSC_LUMINANCE
(
rv
,
gv
,
bv
) >> 8);

520 
pIn
 += 6;

523 
	`as£¹
 (0);

526 ià(
g
->
šT¿™s
.
iB™sP”Pix–
>1 && g->
wOutB™sP”Pix–
==1 && 
bMask
!=(
BYTE
)0x80)

527 *
pOut
 = 
bBev–
;

529 *
pdwIÅutU£d
 = 
g
->
dwInRowBy‹s
;

530 
g
->
dwInNextPos
 +ğg->
dwInRowBy‹s
;

531 *
pdwIÅutNextPos
 = 
g
->
dwInNextPos
;

533 *
pdwOuutU£d
 = 
g
->
dwOutRowBy‹s
;

534 *
pdwOuutThisPos
 = 
g
->
dwOutNextPos
;

535 
g
->
dwOutNextPos
 +ğg->
dwOutRowBy‹s
;

537 
g
->
uRowsDÚe
 += 1;

539  
IP_CONSUMED_ROW
 | 
IP_PRODUCED_ROW
 | 
IP_READY_FOR_DATA
;

541 
çl_”rÜ
:

542  
IP_FATAL_ERROR
;

543 
	}
}

553 
WORD
 
	$chªgeBPP_š£¹edD©a
 (

554 
IP_XFORM_HANDLE
 
hXfÜm
,

555 
DWORD
 
dwNumBy‹s
)

557 
	`çlB»akPošt
 ();

558  
IP_FATAL_ERROR
;

559 
	}
}

569 
WORD
 
	$chªgeBPP_ÃwPage
 (

570 
IP_XFORM_HANDLE
 
hXfÜm
)

572 
PCBPP_INST
 
g
;

574 
	`HANDLE_TO_PTR
 (
hXfÜm
, 
g
);

576  
IP_DONE
;

578 
çl_”rÜ
:

579  
IP_FATAL_ERROR
;

581 
	}
}

591 
WORD
 
	$chªgeBPP_şo£XfÜm
 (
IP_XFORM_HANDLE
 
hXfÜm
)

593 
PCBPP_INST
 
g
;

595 
	`HANDLE_TO_PTR
 (
hXfÜm
, 
g
);

597 
g
->
dwV®idChk
 = 0;

598 
	`IP_MEM_FREE
 (
g
);

600  
IP_DONE
;

602 
çl_”rÜ
:

603  
IP_FATAL_ERROR
;

604 
	}
}

614 
IP_XFORM_TBL
 
	gchªgeBPPTbl
 = {

615 
chªgeBPP_İ’XfÜm
,

616 
chªgeBPP_£tDeçuÉIÅutT¿™s
,

617 
chªgeBPP_£tXfÜmS³c
,

618 
chªgeBPP_g‘H—d”BufSize
,

619 
chªgeBPP_g‘Aùu®T¿™s
,

620 
chªgeBPP_g‘Aùu®BufSizes
,

621 
chªgeBPP_cÚv”t
,

622 
chªgeBPP_ÃwPage
,

623 
chªgeBPP_š£¹edD©a
,

624 
chªgeBPP_şo£XfÜm


	@ip/xcolrspc.c

99 
	~"m©h.h
"

100 
	~"hp.h
"

101 
	~"defs.h
"

102 
	~"¡ršg.h
"

103 
	~"as£¹.h
"

107 
	gS’d_yTabË
[100] = {

121 
	~"¡dio.h
"

122 
	~<tch¬.h
>

123 
	#PRINT
(
msg
,
¬g1
,
¬g2
) \

124 
	`_á´štf
(
¡d”r
, 
msg
, ()
¬g1
, ()
¬g2
)

	)

126 
	#PRINT
(
msg
,
¬g1
,
¬g2
)

	)

129 
	#CHECK_VALUE
 0x4ba1daû

	)

133 
IP_IMAGE_TRAITS
 
	mŒa™s
;

134 
IP_WHICH_CNV
 
	mwhich_úv
;

135 
BYTE
 
	mbGammaTbl
[256];

136 
DWORD
 
	mdwRowsDÚe
;

137 
DWORD
 
	mdwInNextPos
;

138 
DWORD
 
	mdwOutNextPos
;

139 
DWORD
 
	mdwV®idChk
;

140 } 
	tCOL_INST
, *
	tPCOL_INST
;

142 
BOOL
 
	gfIn™ed
 = 
FALSE
;

145 
	#NEUTRAL_SHIFT_SEND
 
TRUE


	)

149 
	#RGBTOY_R_FAC
 0.30078125f

	)

150 
	#RGBTOY_G_FAC
 0.5859375f

	)

151 
	#RGBTOY_B_FAC
 0.11328125f

	)

154 
	#YCCTORGB_CR_TO_R
 1.39946f

	)

155 
	#YCCTORGB_CB_TO_G
 -0.344228f

	)

156 
	#YCCTORGB_CR_TO_G
 -0.717202f

	)

157 
	#YCCTORGB_CB_TO_B
 1.77243f

	)

164 
	gRGBtoYCC
[3][3]= {

170 
	gYCCtoRGB
[3][3]= {

178 
	#X_SCALE
 (255.0/244.0)

	)

179 
	#Y_SCALE
 (255.0/255.0)

	)

180 
	#Z_SCALE
 (255.0/210.0)

	)

182 
	#DEFAULT_GAMMA
 2.2f

	)

183 
	#SLIGHT_BOOST
 (255.0/253.0)

184 

	)

196 
	#CLIP
(
wma
è((wma>255è? 255 : ((wma<0è? 0 : (wma)))

	)

198 
	#TERM_FRAC_BITS
 4

199 
	#CONV_FRAC_BITS
 4

200 
	#CONV_FRAC_ROUND
 (1L<<(
CONV_FRAC_BITS
-1))

	)

201 
	#TBL33_FRAC_BITS
 16

202 
	#TABLE_FRAC_SCALE
 (1L << 
TBL33_FRAC_BITS
)

	)

207 
BYTE
 
	gYtoL
 [256];

208 
BYTE
 
	gLtoY
 [256];

209 
	gcubeRoÙ
 [256];

210 
BYTE
 
	gcube
 [256];

212 
	gcb2b
 [256];

213 
	gü2r
 [256];

214 
	gü2g_fix
 [256];

215 
	gcb2g_fix
 [256];

217 
	gr2y_fix
 [256];

218 
	gg2y_fix
 [256];

219 
	gb2y_fix
 [256];

221 
BYTE
 
	gby2cb
 [2*256];

222 
BYTE
 
	gry2ü
 [2*256];

228 
	$VeùMuÉ
(

229 
šPix–
[3],

230 
outPix–
[3],

231 *
pM©
)

233 
i
;

235 
i
=0; i<3; i++) {

236 
outPix–
[
i
] = ()Ğ
pM©
[0]*
šPix–
[0] +

237 
pM©
[1]*
šPix–
[1] +

238 
pM©
[2]*
šPix–
[2] + (1L<<(
TBL33_FRAC_BITS
-1))

239 è>> 
TBL33_FRAC_BITS
;

240 
pM©
 += 3;

242 
	}
}

260 
	$š™TabËs
 ()

262 
v®
;

263 
iü
, 
icb
;

264 
fv®
;

265 
t
;

267 
v®
=0; val<=255; val++)

269 
fv®
 = ()
v®
 / 255.0f;

273 ià(
fv®
 > 0.008856fè
t
 = 116.0f*()
	`pow
(fval,1.0/3.0) - 16.0f;

274 
t
 = 903.3f*
fv®
;

275 
t
 = (255.0f/100.0f)*t;

276 ià(
t
 < 0.0f) = 0.0f;

277 ià(
t
 > 255.0f) = 255.0f;

278 
YtoL
[
v®
] = (
BYTE
)(
t
 + 0.5f);

282 ià(
v®
 <= 7)

283 
t
 = 
v®
 * (100.0f/903.3f);

285 
t
 = (
fv®
*100.0f+16.0f) / 116.0f;

286 
t
 = 255.0f*t*t*t;

288 
LtoY
[
v®
] = (
BYTE
)(
t
 + 0.5f);

294 ià(
fv®
 > 0.008856fè
t
 = ()
	`pow
(fval, 1.0f/3.0f);

295 
t
 = 7.7867f*
fv®
 + 16.0f/116.0f;

296 
cubeRoÙ
[
v®
] = ()(
t
*255.0f*(1L<<
TERM_FRAC_BITS
) + 0.5f);

298 
cube
[
v®
] = (
BYTE
)(255.0f*
fv®
*fval*fval);

303 
fv®
 = ()
v®
;

305 
r2y_fix
[
v®
] = ()(
SLIGHT_BOOST
*
RGBTOY_R_FAC
*
fv®
*(1<<
CONV_FRAC_BITS
));

306 
g2y_fix
[
v®
] = ()(
SLIGHT_BOOST
*
RGBTOY_G_FAC
*
fv®
*(1<<
CONV_FRAC_BITS
));

307 
b2y_fix
[
v®
] = ()(
SLIGHT_BOOST
*
RGBTOY_B_FAC
*
fv®
*(1<<
CONV_FRAC_BITS
));

309 
fv®
 -= 128.0f;

311 
cb2b
 [
v®
] = ()(
	`æoÜ
(
YCCTORGB_CB_TO_B
*
fv®
 + 0.5));

312 
ü2r
 [
v®
] = ()(
	`æoÜ
(
YCCTORGB_CR_TO_R
*
fv®
 + 0.5));

313 
cb2g_fix
[
v®
] = ()(
YCCTORGB_CB_TO_G
*
fv®
*(1<<
CONV_FRAC_BITS
));

314 
ü2g_fix
[
v®
] = ()(
YCCTORGB_CR_TO_G
*
fv®
*(1<<
CONV_FRAC_BITS
));

318 
v®
=0; val<=2*255; val++)

320 
fv®
 = ()
v®
 - 255.0f;

322 
icb
 = ()
	`æoÜ
(
fv®
/
YCCTORGB_CB_TO_B
 + 0.5);

323 ià(
icb
>=-4 && icb<=4)

324 
icb
 = 0;

325 
icb
 += 128;

326 
by2cb
[
v®
] = (
BYTE
)
	`CLIP
(
icb
);

328 
iü
 = ()
	`æoÜ
(
fv®
/
YCCTORGB_CR_TO_R
 + 0.5);

329 ià(
iü
>=-4 && icr<=4)

330 
iü
 = 0;

331 
iü
 += 128;

332 
ry2ü
[
v®
] = (
BYTE
)
	`CLIP
(
iü
);

334 
	}
}

338 
	$ÿlcGammaTabË
 (

339 
PCOL_INST
 
g
,

340 
DWORD
 
dwGamma
)

342 
	#MAX_GAMMA_SLOPE
 4

	)

344 
i
;

345 
maxv®
;

346 
fGamma
, 
f
, 
gamv®
;

347 
BYTE
 
bGamV®
;

349 
fGamma
 = (
dwGamma
 =ğ0è? 
DEFAULT_GAMMA
 : ()dwGamma/(1L<<16);

351 
g
->
which_úv
) {

352 
IP_CNV_YCC_TO_CIELAB
:

356 
fGamma
 = 1.0f / fGamma;

359 
IP_CNV_CIELAB_TO_YCC
:

367 
fGamma
 = 1.0f;

370 ià(
fGamma
 == 1.0f) {

372 
i
=0; i<=255; i++)

373 
g
->
bGammaTbl
[
i
] = i;

375 
fGamma
 = 1.0f / fGamma;

376 
i
=0; i<=255; i++) {

377 
f
 = ()
i
 / 255.0f;

378 
gamv®
 = ()
	`pow
(
f
, 
fGamma
);

379 
bGamV®
 = (
BYTE
)(255.0f*
gamv®
 + 0.5f);

380 
maxv®
 = ()(
i
 * 
MAX_GAMMA_SLOPE
);

381 ià(
fGamma
<1.0à&& 
bGamV®
>
maxv®
)

382 
bGamV®
 = 
maxv®
;

383 
g
->
bGammaTbl
[
i
] = 
bGamV®
;

386 
	}
}

401 
	gRGBtoXYZ50
[9] = {

402 ()(0.4358530*
X_SCALE
*
TABLE_FRAC_SCALE
 + 0.5),

403 ()(0.3840300*
X_SCALE
*
TABLE_FRAC_SCALE
 + 0.5),

404 ()(0.1431260*
X_SCALE
*
TABLE_FRAC_SCALE
 + 0.5),

406 ()(0.2225640*
Y_SCALE
*
TABLE_FRAC_SCALE
 + 0.5),

407 ()(0.7200520*
Y_SCALE
*
TABLE_FRAC_SCALE
 + 0.5),

408 ()(0.0607176*
Y_SCALE
*
TABLE_FRAC_SCALE
 + 0.5),

410 ()(0.0139307*
Z_SCALE
*
TABLE_FRAC_SCALE
 + 0.5),

411 ()(0.0973260*
Z_SCALE
*
TABLE_FRAC_SCALE
 + 0.5),

412 ()(0.7142870*
Z_SCALE
*
TABLE_FRAC_SCALE
 + 0.5)

419 
	gRGBtoXYZ50
[9] = {

420 ()(0.464700*
X_SCALE
*
TABLE_FRAC_SCALE
 + 0.5),

421 ()(0.339211*
X_SCALE
*
TABLE_FRAC_SCALE
 + 0.5),

422 ()(0.156961*
X_SCALE
*
TABLE_FRAC_SCALE
 + 0.5),

424 ()(0.220615*
Y_SCALE
*
TABLE_FRAC_SCALE
 + 0.5),

425 ()(0.700919*
Y_SCALE
*
TABLE_FRAC_SCALE
 + 0.5),

426 ()(0.053199*
Y_SCALE
*
TABLE_FRAC_SCALE
 + 0.5),

428 ()(0.005146*
Z_SCALE
*
TABLE_FRAC_SCALE
 + 0.5),

429 ()(0.050405*
Z_SCALE
*
TABLE_FRAC_SCALE
 + 0.5),

430 ()(0.774384*
Z_SCALE
*
TABLE_FRAC_SCALE
 + 0.5)

442 
	$YCCToCIELab
 (

443 
PBYTE
 
pYCC
,

444 
PBYTE
 
pCIELab
,

445 
PBYTE
 
pGamma
)

447 
iy
, 
icb
,
iü
;

448 
sR
, 
sG
, 
sB
;

449 
sRGBv®
[3];

450 
XYZ50v®
[3];

451 
x
, 
y
, 
z
;

452 
x‹rm
, 
y‹rm
, 
z‹rm
;

453 
L
, 
a
, 
b
;

454 
absCr
, 
absCb
;

457 
iy
 = 
pYCC
[0];

458 
icb
 = 
pYCC
[1];

459 
iü
 = 
pYCC
[2];

461 #ifdeà
NEUTRAL_SHIFT_SEND


463 
absCb
 = 
	`abs
(
icb
-128);

464 
absCr
 = 
	`abs
(
iü
-128);

466 ià(
iy
>=210)

468 
iy
 = 
S’d_yTabË
[iy-210];

471 ià(
iy
 ==255)

474 ià((
absCb
 < 5è&& (
absCr
 <5))

476 
iü
 = 
icb
 = 128;

479 ià(
iy
>240)

481 ià((
absCb
 < 4è&& (
absCr
 <4))

483 
iü
=
icb
=128;

484 
iy
 = 255;

486 ià((
absCb
 < 3è&& (
absCr
 <3))

488 
iü
=
icb
=128;

491 ià(
iy
>230)

493 ià((
absCb
 < 3è&& (
absCr
 <3))

495 
iü
=
icb
=128;

496 
iy
 = 250;

499 ià(
iy
>220)

501 ià((
absCb
 < 3è&& (
absCr
 <3))

503 
iü
=
icb
=128;

504 
iy
 = 240;

507 ià(
iy
 >60)

509 ià((
absCb
 <3è&& (
absCr
 <3))

511 
iü
=
icb
=128;

524 
sR
 = 
iy
 + 
ü2r
[
iü
];

525 
sR
 = 
	`CLIP
(sR);

527 
sG
 = 
iy
 + ((
ü2g_fix
[
iü
] + 
cb2g_fix
[
icb
] + 
CONV_FRAC_ROUND
è>> 
CONV_FRAC_BITS
);

528 
sG
 = 
	`CLIP
(sG);

530 
sB
 = 
iy
 + 
cb2b
[
icb
];

531 
sB
 = 
	`CLIP
(sB);

535 
sRGBv®
[0] = ()
pGamma
[
sR
];

536 
sRGBv®
[1] = ()
pGamma
[
sG
];

537 
sRGBv®
[2] = ()
pGamma
[
sB
];

539 
	`VeùMuÉ
 (
sRGBv®
, 
XYZ50v®
, 
RGBtoXYZ50
);

541 
x
 = 
	`CLIP
(
XYZ50v®
[0]);

542 
y
 = 
	`CLIP
(
XYZ50v®
[1]);

543 
z
 = 
	`CLIP
(
XYZ50v®
[2]);

547 
pCIELab
[0] = 
L
 = 
YtoL
[
y
];

548 
x‹rm
 = 
cubeRoÙ
[
x
];

549 
y‹rm
 = 
cubeRoÙ
[
y
];

550 
z‹rm
 = 
cubeRoÙ
[
z
];

552 
b
 = 
y‹rm
 - 
z‹rm
;

553 
b
 +ğ(96<<
TERM_FRAC_BITS
) + (1<<(TERM_FRAC_BITS-1));

554 
b
 >>ğ
TERM_FRAC_BITS
;

555 
pCIELab
[2] = (
BYTE
)
	`CLIP
(
b
);

557 ià(
b
 < 0) {

561 
x‹rm
 +ğ6*
b
;

562 
L
 -ğ
b
>>1;

563 
pCIELab
[0] = (
BYTE
)
	`CLIP
(
L
);

568 
a
 = 
x‹rm
 - 
y‹rm
;

569 
a
 =‡ +‡ +‡ - (a>>4);

570 
a
 +ğ(128<<
TERM_FRAC_BITS
) + (1<<(TERM_FRAC_BITS-1));

571 
a
 >>ğ
TERM_FRAC_BITS
;

572 
pCIELab
[1] = (
BYTE
)
	`CLIP
(
a
);

573 
	}
}

579 
	$YCCTosRGB
 (

580 
PBYTE
 
pYCC
,

581 
PBYTE
 
psRGB
)

583 
iy
, 
icb
, 
iü
;

584 
sR
, 
sG
, 
sB
;

586 
iy
 = 
pYCC
[0];

587 
icb
 = 
pYCC
[1];

588 
iü
 = 
pYCC
[2];

590 
sR
 = 
iy
 + 
ü2r
[
iü
];

591 
psRGB
[0] = (
BYTE
)
	`CLIP
(
sR
);

593 
sG
 = 
iy
 + ((
ü2g_fix
[
iü
] + 
cb2g_fix
[
icb
] + 
CONV_FRAC_ROUND
è>> 
CONV_FRAC_BITS
);

594 
psRGB
[1] = (
BYTE
)
	`CLIP
(
sG
);

596 
sB
 = 
iy
 + 
cb2b
[
icb
];

597 
psRGB
[2] = (
BYTE
)
	`CLIP
(
sB
);

598 
	}
}

611 
	gXYZ50tosRGB
[9] = {

612 ()Ğ3.1344500*
TABLE_FRAC_SCALE
 /
X_SCALE
 + 0.5),

613 ()(-1.6177000*
TABLE_FRAC_SCALE
 /
Y_SCALE
 - 0.5),

614 ()(-0.4905000*
TABLE_FRAC_SCALE
 /
Z_SCALE
 - 0.5),

616 ()(-0.9788600*
TABLE_FRAC_SCALE
 /
X_SCALE
 - 0.5),

617 ()Ğ1.9164800*
TABLE_FRAC_SCALE
 /
Y_SCALE
 + 0.5),

618 ()Ğ0.0334962*
TABLE_FRAC_SCALE
 /
Z_SCALE
 + 0.5),

620 ()Ğ0.0719813*
TABLE_FRAC_SCALE
 /
X_SCALE
 + 0.5),

621 ()(-0.2290660*
TABLE_FRAC_SCALE
 /
Y_SCALE
 - 0.5),

622 ()Ğ1.4050500*
TABLE_FRAC_SCALE
 /
Z_SCALE
 + 0.5)

633 
	$CIELabToYCC
 (

634 
PBYTE
 
pCIELab
,

635 
PBYTE
 
pYCC
,

636 
PBYTE
 
pGamma
)

638 
a
, 
b
, 
x‹rm
, 
y‹rm
, 
z‹rm
;

639 
Y
;

640 
çùÜ
;

641 
XYZ50
[3];

642 
sRGB
[3];

643 
sR
,
sG
,
sB
;

644 
iy
;

645 
iü
, 
icb
;

649 
çùÜ
 = ()((1L<<16)*170.0/500.0);

650 
a
 = ()((((()
pCIELab
[1]-128è* 
çùÜ
) + 0x8000L) >> 16);

651 
b
 = ()
pCIELab
[2] - 96;

653 
XYZ50
[1] = 
Y
 = 
LtoY
[
pCIELab
[0]];

654 
y‹rm
 = (
cubeRoÙ
[
Y
] + (1<<(
TERM_FRAC_BITS
-1))) >> TERM_FRAC_BITS;

656 
x‹rm
 = 
a
 + 
y‹rm
;

657 
XYZ50
[0] = 
cube
[
	`CLIP
(
x‹rm
)];

659 
z‹rm
 = 
y‹rm
 - 
b
;

660 
XYZ50
[2] = 
cube
[
	`CLIP
(
z‹rm
)];

664 
	`VeùMuÉ
 (
XYZ50
, 
sRGB
, 
XYZ50tosRGB
);

666 
sR
 = 
pGamma
[
	`CLIP
(
sRGB
[0])];

667 
sG
 = 
pGamma
[
	`CLIP
(
sRGB
[1])];

668 
sB
 = 
pGamma
[
	`CLIP
(
sRGB
[2])];

672 
iy
 = 
r2y_fix
[
sR
] + 
g2y_fix
[
sG
] + 
b2y_fix
[
sB
];

673 
iy
 = (iy + 
CONV_FRAC_ROUND
è>> 
CONV_FRAC_BITS
;

674 
iy
 = 
	`CLIP
(iy);

681 
icb
 = ()((
by2cb
+255)[
sB
-
iy
]);

682 
iü
 = ()((
ry2ü
+255)[
sR
-
iy
]);

684 
pYCC
[0] = (
BYTE
)
iy
;

685 
pYCC
[1] = (
BYTE
)
icb
;

686 
pYCC
[2] = (
BYTE
)
iü
;

690 
	}
}

696 
	$sRGBToYCC
 (

697 
PBYTE
 
psRGB
,

698 
PBYTE
 
pYCC
)

700 
sR
, 
sG
, 
sB
;

701 
iy
;

703 
sR
 = 
psRGB
[0];

704 
sG
 = 
psRGB
[1];

705 
sB
 = 
psRGB
[2];

707 
iy
 = 
r2y_fix
[
sR
] + 
g2y_fix
[
sG
] + 
b2y_fix
[
sB
];

708 
iy
 = (iy + 
CONV_FRAC_ROUND
è>> 
CONV_FRAC_BITS
;

709 
iy
 = 
	`CLIP
(iy);

710 
pYCC
[0] = (
BYTE
)
iy
;

712 
pYCC
[1] = (
by2cb
+255)[
sB
-
iy
];

713 
pYCC
[2] = (
ry2ü
+255)[
sR
-
iy
];

714 
	}
}

730 
	$sRGBToLHS
 (

731 
PBYTE
 
psRGB
,

732 
PBYTE
 
pLHS
)

734 
R
, 
G
, 
B
;

735 
L
, 
H
, 
S
;

736 
maxV®
, 
mšV®
, 
diff
, 
sum
, 
num”©Ü
;

738 
R
 = ()
psRGB
[0];

739 
G
 = ()
psRGB
[1];

740 
B
 = ()
psRGB
[2];

742 
maxV®
 = 
	`IP_MAX
 (
R
, 
G
);

743 
maxV®
 = 
	`IP_MAX
 (maxV®, 
B
);

744 
mšV®
 = 
	`IP_MIN
 (
R
, 
G
);

745 
mšV®
 = 
	`IP_MIN
 (mšV®, 
B
);

746 
diff
 = 
maxV®
 - 
mšV®
;

747 
sum
 = 
maxV®
 + 
mšV®
;

748 
L
 = 
sum
 >> 1;

750 ià(
diff
 <= 1) {

751 
S
 = 0;

752 
H
 = 0;

755 
S
 = ((
diff
<<9è- difà- diffè/ (
L
<=127 ? 
sum
 : 510-sum);

756 
S
 = (S+1) >> 1;

759 ià(
R
 =ğ
maxV®
) {

760 
num”©Ü
 = (
maxV®
-
B
è- (maxV®-
G
);

761 
H
 = 0;

762 } ià(
G
 =ğ
maxV®
) {

763 
num”©Ü
 = (
maxV®
-
R
è- (maxV®-
B
);

764 
H
 = (1<<12)*1/3;

766 
num”©Ü
 = (
maxV®
-
G
è- (maxV®-
R
);

767 
H
 = (1<<12)*2/3;

772 
H
 +ğ(
num”©Ü
<<11è/ (
diff
+diff+diff);

773 
H
 = (H + (1<<3)) >> 4;

776 
pLHS
[0] = ()
L
;

777 
pLHS
[1] = ()
H
;

778 
pLHS
[2] = ()
S
;

779 
	}
}

785 
	$LHSTosRGB
 (

786 
PBYTE
 
pLHS
,

787 
PBYTE
 
psRGB
)

789 
L
, 
H
, 
S
;

790 
R
=0, 
G
=0, 
B
=0;

791 
hba£
, 
häac
, 
´oduù
, 
maxV®
, 
mšV®
, 
midV®
;

793 
L
 = ()
pLHS
[0];

794 
H
 = ()
pLHS
[1];

795 
S
 = ()
pLHS
[2];

799 
L
 = (L<<6) + (1<<4);

800 
S
 = S<<6;

802 
H
 *= 6;

803 
hba£
 = 
H
 >> 8;

804 
häac
 = 
H
 & 0x00ff;

806 
´oduù
 = 
L
*
S
;

807 
´oduù
 = (product + (product>>8)) >> (8+6);

808 ià(
L
 <ğ(127<<6)+(1<<4)è
maxV®
 = L + 
´oduù
;

809 
maxV®
 = 
L
 + 
S
 - 
´oduù
;

811 
mšV®
 = 
L
 + L - 
maxV®
;

812 
midV®
 = 
mšV®
 + (((
maxV®
-mšV®è* ((
hba£
&1è? 256-
häac
 : hfrac)) >> 8);

815 
mšV®
 = (minVal+(1<<5)) >> 6;

816 
midV®
 = (midVal+(1<<5)) >> 6;

817 
maxV®
 = (maxVal+(1<<5)) >> 6;

825 
hba£
)

827 0: 
R
 = 
maxV®
; 
G
 = 
midV®
; 
B
 = 
mšV®
; ;

828 1: 
R
 = 
midV®
; 
G
 = 
maxV®
; 
B
 = 
mšV®
; ;

829 2: 
R
 = 
mšV®
; 
G
 = 
maxV®
; 
B
 = 
midV®
; ;

830 3: 
R
 = 
mšV®
; 
G
 = 
midV®
; 
B
 = 
maxV®
; ;

831 4: 
R
 = 
midV®
; 
G
 = 
mšV®
; 
B
 = 
maxV®
; ;

832 5: 
R
 = 
maxV®
; 
G
 = 
mšV®
; 
B
 = 
midV®
; ;

835 
psRGB
[0] = (
BYTE
)
R
;

836 
psRGB
[1] = (
BYTE
)
G
;

837 
psRGB
[2] = (
BYTE
)
B
;

838 
	}
}

865 
WORD
 
	$cŞÜ_İ’XfÜm
 (

866 
IP_XFORM_HANDLE
 *
pXfÜm
)

868 
PCOL_INST
 
g
;

870 ià(! 
fIn™ed
) {

871 
	`š™TabËs
 ();

872 
fIn™ed
 = 
TRUE
;

875 
	`INSURE
 (
pXfÜm
 !ğ
NULL
);

876 
	`IP_MEM_ALLOC
 ((
COL_INST
), 
g
);

877 *
pXfÜm
 = 
g
;

878 
	`mem£t
 (
g
, 0, (
COL_INST
));

879 
g
->
dwV®idChk
 = 
CHECK_VALUE
;

880  
IP_DONE
;

882 
çl_”rÜ
:

883  
IP_FATAL_ERROR
;

884 
	}
}

903 
WORD
 
	$cŞÜ_£tDeçuÉIÅutT¿™s
 (

904 
IP_XFORM_HANDLE
 
hXfÜm
,

905 
PIP_IMAGE_TRAITS
 
pT¿™s
)

907 
PCOL_INST
 
g
;

909 
	`HANDLE_TO_PTR
 (
hXfÜm
, 
g
);

912 
	`INSURE
 (
pT¿™s
->
iB™sP”Pix–
 <= 24);

913 
	`INSURE
 (
pT¿™s
->
iPix–sP”Row
 > 0);

915 
g
->
Œa™s
 = *
pT¿™s
;

916  
IP_DONE
;

918 
çl_”rÜ
:

919  
IP_FATAL_ERROR
;

920 
	}
}

930 
WORD
 
	$cŞÜ_£tXfÜmS³c
 (

931 
IP_XFORM_HANDLE
 
hXfÜm
,

932 
DWORD_OR_PVOID
 
aXfÜmInfo
[])

934 
PCOL_INST
 
g
;

936 
	`HANDLE_TO_PTR
 (
hXfÜm
, 
g
);

937 
g
->
which_úv
 = (
IP_WHICH_CNV
)
aXfÜmInfo
[
IP_CNV_COLOR_SPACE_WHICH_CNV
].
dwÜd
;

938 
	`ÿlcGammaTabË
 (
g
, 
aXfÜmInfo
[
IP_CNV_COLOR_SPACE_GAMMA
].
dwÜd
);

940  
IP_DONE
;

942 
çl_”rÜ
:

943  
IP_FATAL_ERROR
;

944 
	}
}

954 
WORD
 
	$cŞÜ_g‘H—d”BufSize
 (

955 
IP_XFORM_HANDLE
 
hXfÜm
,

956 
DWORD
 *
pdwInBufL’
)

959 *
pdwInBufL’
 = 0;

960  
IP_DONE
;

961 
	}
}

971 
WORD
 
	$cŞÜ_g‘Aùu®T¿™s
 (

972 
IP_XFORM_HANDLE
 
hXfÜm
,

973 
DWORD
 
dwIÅutAva
,

974 
PBYTE
 
pbIÅutBuf
,

975 
PDWORD
 
pdwIÅutU£d
,

976 
PDWORD
 
pdwIÅutNextPos
,

977 
PIP_IMAGE_TRAITS
 
pIÁ¿™s
,

978 
PIP_IMAGE_TRAITS
 
pOutT¿™s
)

980 
PCOL_INST
 
g
;

982 
	`HANDLE_TO_PTR
 (
hXfÜm
, 
g
);

985 *
pdwIÅutU£d
 = 0;

986 *
pdwIÅutNextPos
 = 0;

988 *
pIÁ¿™s
 = 
g
->
Œa™s
;

989 *
pOutT¿™s
 = 
g
->
Œa™s
;

991  
IP_DONE
 | 
IP_READY_FOR_DATA
;

993 
çl_”rÜ
:

994  
IP_FATAL_ERROR
;

995 
	}
}

1005 
WORD
 
	$cŞÜ_g‘Aùu®BufSizes
 (

1006 
IP_XFORM_HANDLE
 
hXfÜm
,

1007 
PDWORD
 
pdwMšInBufL’
,

1008 
PDWORD
 
pdwMšOutBufL’
)

1010 
PCOL_INST
 
g
;

1012 
	`HANDLE_TO_PTR
 (
hXfÜm
, 
g
);

1013 *
pdwMšInBufL’
 = *
pdwMšOutBufL’
 =

1014 (
g
->
Œa™s
.
iPix–sP”Row
*g->Œa™s.
iB™sP”Pix–
 + 7) / 8;

1015  
IP_DONE
;

1017 
çl_”rÜ
:

1018  
IP_FATAL_ERROR
;

1019 
	}
}

1029 
WORD
 
	$cŞÜ_cÚv”t
 (

1030 
IP_XFORM_HANDLE
 
hXfÜm
,

1031 
DWORD
 
dwIÅutAva
,

1032 
PBYTE
 
pbIÅutBuf
,

1033 
PDWORD
 
pdwIÅutU£d
,

1034 
PDWORD
 
pdwIÅutNextPos
,

1035 
DWORD
 
dwOuutAva
,

1036 
PBYTE
 
pbOuutBuf
,

1037 
PDWORD
 
pdwOuutU£d
,

1038 
PDWORD
 
pdwOuutThisPos
)

1040 
PCOL_INST
 
g
;

1041 
nBy‹s
;

1042 
PBYTE
 
pIn
, 
pOut
, 
pOutAá”
;

1044 
	`HANDLE_TO_PTR
 (
hXfÜm
, 
g
);

1048 ià(
pbIÅutBuf
 =ğ
NULL
) {

1049 
	`PRINT
 (
	`_T
("color_convert: Toldo flush.\n"), 0, 0);

1050 *
pdwIÅutU£d
 = *
pdwOuutU£d
 = 0;

1051 *
pdwIÅutNextPos
 = 
g
->
dwInNextPos
;

1052 *
pdwOuutThisPos
 = 
g
->
dwOutNextPos
;

1053  
IP_DONE
;

1058 
nBy‹s
 = (
g
->
Œa™s
.
iPix–sP”Row
*g->Œa™s.
iB™sP”Pix–
 + 7) / 8;

1059 
	`INSURE
 (
dwIÅutAva
 >ğ(
DWORD
)
nBy‹s
 );

1060 
	`INSURE
 (
dwOuutAva
 >ğ(
DWORD
)
nBy‹s
);

1062 
pIn
 = 
pbIÅutBuf
;

1063 
pOut
 = 
pbOuutBuf
;

1064 
pOutAá”
 = 
pOut
 + 
nBy‹s
;

1066 ià(
g
->
Œa™s
.
iB™sP”Pix–
 < 24) {

1068 
	`memıy
 (
pOut
, 
pIn
, 
nBy‹s
);

1069 } ià(
g
->
which_úv
 =ğ
IP_CNV_BGR_SWAP
) {

1070 
pOut
 < 
pOutAá”
) {

1071 
pOut
[0] = 
pIn
[2];

1072 
pOut
[1] = 
pIn
[1];

1073 
pOut
[2] = 
pIn
[0];

1074 
pIn
 += 3;

1075 
pOut
 += 3;

1078 
pOut
 < 
pOutAá”
) {

1079 
g
->
which_úv
) {

1080 
IP_CNV_YCC_TO_CIELAB
: 
	`YCCToCIELab
 (
pIn
, 
pOut
, 
g
->
bGammaTbl
); ;

1081 
IP_CNV_CIELAB_TO_YCC
: 
	`CIELabToYCC
 (
pIn
, 
pOut
, 
g
->
bGammaTbl
); ;

1082 
IP_CNV_YCC_TO_SRGB
: 
	`YCCTosRGB
 (
pIn
, 
pOut
); ;

1083 
IP_CNV_SRGB_TO_YCC
: 
	`sRGBToYCC
 (
pIn
, 
pOut
); ;

1084 
IP_CNV_LHS_TO_SRGB
: 
	`LHSTosRGB
 (
pIn
, 
pOut
); ;

1085 
IP_CNV_SRGB_TO_LHS
: 
	`sRGBToLHS
 (
pIn
, 
pOut
); ;

1086 : 
çl_”rÜ
;

1089 
pIn
 += 3;

1090 
pOut
 += 3;

1094 *
pdwIÅutU£d
 = 
nBy‹s
;

1095 
g
->
dwInNextPos
 +ğ
nBy‹s
;

1096 *
pdwIÅutNextPos
 = 
g
->
dwInNextPos
;

1098 *
pdwOuutU£d
 = 
nBy‹s
;

1099 *
pdwOuutThisPos
 = 
g
->
dwOutNextPos
;

1100 
g
->
dwOutNextPos
 +ğ
nBy‹s
;

1102 
g
->
dwRowsDÚe
 += 1;

1104  
IP_CONSUMED_ROW
 | 
IP_PRODUCED_ROW
 | 
IP_READY_FOR_DATA
;

1106 
çl_”rÜ
:

1107  
IP_FATAL_ERROR
;

1108 
	}
}

1118 
WORD
 
	$cŞÜ_š£¹edD©a
 (

1119 
IP_XFORM_HANDLE
 
hXfÜm
,

1120 
DWORD
 
dwNumBy‹s
)

1122 
	`çlB»akPošt
 ();

1123  
IP_FATAL_ERROR
;

1124 
	}
}

1134 
WORD
 
	$cŞÜ_ÃwPage
 (

1135 
IP_XFORM_HANDLE
 
hXfÜm
)

1137 
PCOL_INST
 
g
;

1139 
	`HANDLE_TO_PTR
 (
hXfÜm
, 
g
);

1140  
IP_DONE
;

1142 
çl_”rÜ
:

1143  
IP_FATAL_ERROR
;

1145 
	}
}

1155 
WORD
 
	$cŞÜ_şo£XfÜm
 (
IP_XFORM_HANDLE
 
hXfÜm
)

1157 
PCOL_INST
 
g
;

1159 
	`HANDLE_TO_PTR
 (
hXfÜm
, 
g
);

1161 
g
->
dwV®idChk
 = 0;

1162 
	`IP_MEM_FREE
 (
g
);

1164  
IP_DONE
;

1166 
çl_”rÜ
:

1167  
IP_FATAL_ERROR
;

1168 
	}
}

1178 
IP_XFORM_TBL
 
	gcŞÜTbl
 = {

1179 
cŞÜ_İ’XfÜm
,

1180 
cŞÜ_£tDeçuÉIÅutT¿™s
,

1181 
cŞÜ_£tXfÜmS³c
,

1182 
cŞÜ_g‘H—d”BufSize
,

1183 
cŞÜ_g‘Aùu®T¿™s
,

1184 
cŞÜ_g‘Aùu®BufSizes
,

1185 
cŞÜ_cÚv”t
,

1186 
cŞÜ_ÃwPage
,

1187 
cŞÜ_š£¹edD©a
,

1188 
cŞÜ_şo£XfÜm


	@ip/xconvolve.c

94 
	~"hp.h
"

95 
	~"defs.h
"

96 
	~"¡ršg.h
"

100 
	~"¡dio.h
"

101 
	~<tch¬.h
>

102 
	#PRINT
(
msg
,
¬g1
,
¬g2
) \

103 
	`_á´štf
(
¡d”r
, 
msg
, ()
¬g1
, ()
¬g2
)

	)

105 
	#PRINT
(
msg
,
¬g1
,
¬g2
)

	)

108 
	#CHECK_VALUE
 0x4ba1daû

	)

110 #ifdeà
EXPORT_TRANSFORM


111 
	#FUNC_STATUS
 
	`__deş¥ec
 (
dÎexpÜt
)

	)

113 
	#FUNC_STATUS
 

	)

117 
IP_IMAGE_TRAITS
 
	mŒa™s
;

118 
DWORD
 
	mdwBy‹sP”Row
;

119 
	miBy‹sP”Pix–
;

120 
DWORD
 
	mdwRowsR—d
;

121 
DWORD
 
	mdwRowsWr™‹n
;

122 
DWORD
 
	mdwInNextPos
;

123 
DWORD
 
	mdwOutNextPos
;

124 
	mnCŞs
;

125 
	mnRows
;

126 
	mnRowsFËd
;

127 
	miDivisÜ
;

128 
	mm©rix
[
IP_CONVOLVE_MAXSIZE
*IP_CONVOLVE_MAXSIZE];

129 
PBYTE
 
	m­Rows
[
IP_CONVOLVE_MAXSIZE
];

130 
DWORD
 
	mdwV®idChk
;

131 } 
	tCONV_INST
, *
	tPCONV_INST
;

148 
FUNC_STATUS
 
WORD
 
	$cÚvŞve_İ’XfÜm
 (

149 
IP_XFORM_HANDLE
 *
pXfÜm
)

151 
PCONV_INST
 
g
;

153 
	`INSURE
 (
pXfÜm
 !ğ
NULL
);

154 
	`IP_MEM_ALLOC
 ((
CONV_INST
), 
g
);

155 *
pXfÜm
 = 
g
;

156 
	`mem£t
 (
g
, 0, (
CONV_INST
));

157 
g
->
dwV®idChk
 = 
CHECK_VALUE
;

158  
IP_DONE
;

160 
çl_”rÜ
:

161  
IP_FATAL_ERROR
;

162 
	}
}

181 
FUNC_STATUS
 
WORD
 
	$cÚvŞve_£tDeçuÉIÅutT¿™s
 (

182 
IP_XFORM_HANDLE
 
hXfÜm
,

183 
PIP_IMAGE_TRAITS
 
pT¿™s
)

185 
PCONV_INST
 
g
;

186 
bµ
;

187 
comps
;

189 
	`HANDLE_TO_PTR
 (
hXfÜm
, 
g
);

192 
bµ
 = 
pT¿™s
->
iB™sP”Pix–
;

193 
comps
 = 
pT¿™s
->
iCompÚ’tsP”Pix–
;

194 
	`INSURE
 ((
comps
==1 && (
bµ
==8 || bpp==16)) ||

195 (
comps
==3 && (
bµ
==24 || bpp==48)));

196 
	`INSURE
 (
pT¿™s
->
iPix–sP”Row
 > 0);

198 
g
->
Œa™s
 = *
pT¿™s
;

199 
g
->
iBy‹sP”Pix–
 = g->
Œa™s
.
iB™sP”Pix–
 / 8;

200 
g
->
dwBy‹sP”Row
 = g->
Œa™s
.
iPix–sP”Row
 * g->
iBy‹sP”Pix–
;

201  
IP_DONE
;

203 
çl_”rÜ
:

204  
IP_FATAL_ERROR
;

205 
	}
}

215 
FUNC_STATUS
 
WORD
 
	$cÚvŞve_£tXfÜmS³c
 (

216 
IP_XFORM_HANDLE
 
hXfÜm
,

217 
DWORD_OR_PVOID
 
aXfÜmInfo
[])

219 
PCONV_INST
 
g
;

220 
i
, 
n
;

222 
	`HANDLE_TO_PTR
 (
hXfÜm
, 
g
);

224 
g
->
nRows
 = 
aXfÜmInfo
[
IP_CONVOLVE_NROWS
 ].
dwÜd
;

225 
g
->
nCŞs
 = 
aXfÜmInfo
[
IP_CONVOLVE_NCOLS
 ].
dwÜd
;

226 
g
->
iDivisÜ
 = 
aXfÜmInfo
[
IP_CONVOLVE_DIVISOR
].
dwÜd
;

228 
	`INSURE
 ((
g
->
nRows
&1)!=0 && g->nRows>0 && g->nRows<=
IP_CONVOLVE_MAXSIZE
);

229 
	`INSURE
 ((
g
->
nCŞs
&1)!=0 && g->nCŞs>0 && g->nCŞs<=
IP_CONVOLVE_MAXSIZE
);

230 
	`INSURE
 (
g
->
iDivisÜ
 != 0);

231 
	`INSURE
 (
aXfÜmInfo
[
IP_CONVOLVE_MATRIX
].
pvoid
 != 0);

233 
n
 = 
g
->
nRows
 * g->
nCŞs
;

234 
i
=0; i<
n
; i++)

235 
g
->
m©rix
[
i
] = ((*)(
aXfÜmInfo
[
IP_CONVOLVE_MATRIX
].
pvoid
))[i];

237  
IP_DONE
;

239 
çl_”rÜ
:

240  
IP_FATAL_ERROR
;

241 
	}
}

251 
FUNC_STATUS
 
WORD
 
	$cÚvŞve_g‘H—d”BufSize
 (

252 
IP_XFORM_HANDLE
 
hXfÜm
,

253 
DWORD
 *
pdwInBufL’
)

256 *
pdwInBufL’
 = 0;

257  
IP_DONE
;

258 
	}
}

268 
FUNC_STATUS
 
WORD
 
	$cÚvŞve_g‘Aùu®T¿™s
 (

269 
IP_XFORM_HANDLE
 
hXfÜm
,

270 
DWORD
 
dwIÅutAva
,

271 
PBYTE
 
pbIÅutBuf
,

272 
PDWORD
 
pdwIÅutU£d
,

273 
PDWORD
 
pdwIÅutNextPos
,

274 
PIP_IMAGE_TRAITS
 
pIÁ¿™s
,

275 
PIP_IMAGE_TRAITS
 
pOutT¿™s
)

277 
PCONV_INST
 
g
;

279 
	`HANDLE_TO_PTR
 (
hXfÜm
, 
g
);

282 *
pdwIÅutU£d
 = 0;

283 *
pdwIÅutNextPos
 = 0;

285 *
pIÁ¿™s
 = 
g
->
Œa™s
;

286 *
pOutT¿™s
 = 
g
->
Œa™s
;

288  
IP_DONE
 | 
IP_READY_FOR_DATA
;

290 
çl_”rÜ
:

291  
IP_FATAL_ERROR
;

292 
	}
}

302 
FUNC_STATUS
 
WORD
 
	$cÚvŞve_g‘Aùu®BufSizes
 (

303 
IP_XFORM_HANDLE
 
hXfÜm
,

304 
PDWORD
 
pdwMšInBufL’
,

305 
PDWORD
 
pdwMšOutBufL’
)

307 
PCONV_INST
 
g
;

309 
	`HANDLE_TO_PTR
 (
hXfÜm
, 
g
);

311 *
pdwMšInBufL’
 = *
pdwMšOutBufL’
 = 
g
->
dwBy‹sP”Row
;

312  
IP_DONE
;

314 
çl_”rÜ
:

315  
IP_FATAL_ERROR
;

316 
	}
}

326 
	$CİyRow
 (

327 
PCONV_INST
 
g
,

328 
PBYTE
 
pbSrc
,

329 
PBYTE
 
pbDe¡
)

331 
nSidePix–s
;

332 
i
;

334 
nSidePix–s
 = 
g
->
nCŞs
 / 2;

337 
i
=0; i<
nSidePix–s
; i++) {

338 
	`memıy
 (
pbDe¡
, 
pbSrc
, 
g
->
iBy‹sP”Pix–
);

339 
pbDe¡
 +ğ
g
->
iBy‹sP”Pix–
;

343 
	`memıy
 (
pbDe¡
, 
pbSrc
, 
g
->
dwBy‹sP”Row
);

344 
pbDe¡
 +ğ
g
->
dwBy‹sP”Row
;

345 
pbSrc
 +ğ
g
->
dwBy‹sP”Row
 - g->
iBy‹sP”Pix–
;

348 
i
=0; i<
nSidePix–s
; i++) {

349 
	`memıy
 (
pbDe¡
, 
pbSrc
, 
g
->
iBy‹sP”Pix–
);

350 
pbDe¡
 +ğ
g
->
iBy‹sP”Pix–
;

352 
	}
}

362 
	$cÚvŞve_by‹s
 (

363 
PCONV_INST
 
g
,

364 
PBYTE
 
pbDe¡
)

366 
PBYTE
 
pbSrc
, 
pbDe¡Aá”
;

367 
iSrcOff£t
, 
iSideOff£t
, 
iSum
;

368 *
pM©rix
;

369 
row
, 
cŞ
;

371 
pbDe¡Aá”
 = 
pbDe¡
 + 
g
->
dwBy‹sP”Row
;

372 
iSrcOff£t
 = 0;

373 
iSideOff£t
 = 
g
->
iBy‹sP”Pix–
 * (g->
nCŞs
>>1);

375 
pbDe¡
 < 
pbDe¡Aá”
)

377 
iSum
 = 0;

378 
pM©rix
 = 
g
->
m©rix
;

380 
row
=0;„ow<
g
->
nRows
;„ow++) {

381 
pbSrc
 = 
g
->
­Rows
[
row
] + 
iSrcOff£t
;

382 
cŞ
=0; cŞ<
g
->
nCŞs
; col++) {

383 
iSum
 +ğ(*
pM©rix
++è* ()()(*
pbSrc
);

384 
pbSrc
 +ğ
g
->
iBy‹sP”Pix–
;

388 
iSum
 = (iSum + (
g
->
iDivisÜ
>>1)) / g->iDivisor;

389 ià(
iSum
 < 0) iSum = 0; if (iSum > 255) iSum = 255;

390 *
pbDe¡
++ = (
BYTE
)
iSum
;

392 ià(
g
->
iBy‹sP”Pix–
 == 3) {

394 
pbSrc
 = 
g
->
­Rows
[g->
nRows
>>1] + (
iSideOff£t
 + 
iSrcOff£t
 + 1);

395 *
pbDe¡
++ = *
pbSrc
++;

396 *
pbDe¡
++ = *
pbSrc
++;

399 
iSrcOff£t
 +ğ
g
->
iBy‹sP”Pix–
;

401 
	}
}

411 
	$cÚvŞve_wÜds
 (

412 
PCONV_INST
 
g
,

413 
PWORD
 
pwDe¡
)

415 
PWORD
 
pwSrc
, 
pwDe¡Aá”
;

416 
iSrcOff£t
, 
iSideOff£t
, 
iSum
;

417 *
pM©rix
;

418 
row
, 
cŞ
;

420 
pwDe¡Aá”
 = 
pwDe¡
 + (
g
->
dwBy‹sP”Row
>>1);

421 
iSrcOff£t
 = 0;

422 
iSideOff£t
 = 
g
->
Œa™s
.
iCompÚ’tsP”Pix–
 * (g->
nCŞs
>>1);

424 
pwDe¡
 < 
pwDe¡Aá”
)

426 
iSum
 = 0;

427 
pM©rix
 = 
g
->
m©rix
;

429 
row
=0;„ow<
g
->
nRows
;„ow++) {

430 
pwSrc
 = (
WORD
*)(
g
->
­Rows
[
row
]è+ 
iSrcOff£t
;

431 
cŞ
=0; cŞ<
g
->
nCŞs
; col++) {

432 
iSum
 +ğ(*
pM©rix
++è* ()()(*
pwSrc
);

433 
pwSrc
 +ğ
g
->
Œa™s
.
iCompÚ’tsP”Pix–
;

437 
iSum
 = (iSum + (
g
->
iDivisÜ
>>1)) / g->iDivisor;

438 ià(
iSum
 < 0) iSum = 0; if (iSum > 0x00ffff) iSum = 0x00ffff;

439 *
pwDe¡
++ = (
WORD
)
iSum
;

441 ià(
g
->
Œa™s
.
iCompÚ’tsP”Pix–
 == 3) {

443 
pwSrc
 = (
WORD
*)(
g
->
­Rows
[g->
nRows
>>1]è+ (
iSideOff£t
 + 
iSrcOff£t
 + 1);

444 *
pwDe¡
++ = *
pwSrc
++;

445 *
pwDe¡
++ = *
pwSrc
++;

448 
iSrcOff£t
 +ğ
g
->
Œa™s
.
iCompÚ’tsP”Pix–
;

450 
	}
}

460 
FUNC_STATUS
 
WORD
 
	$cÚvŞve_cÚv”t
 (

461 
IP_XFORM_HANDLE
 
hXfÜm
,

462 
DWORD
 
dwIÅutAva
,

463 
PBYTE
 
pbIÅutBuf
,

464 
PDWORD
 
pdwIÅutU£d
,

465 
PDWORD
 
pdwIÅutNextPos
,

466 
DWORD
 
dwOuutAva
,

467 
PBYTE
 
pbOuutBuf
,

468 
PDWORD
 
pdwOuutU£d
,

469 
PDWORD
 
pdwOuutThisPos
)

471 
PCONV_INST
 
g
;

472 
WORD
 
wFÏgs
;

474 
	`HANDLE_TO_PTR
 (
hXfÜm
, 
g
);

476 *
pdwIÅutU£d
 = *
pdwOuutU£d
 = 0;

477 *
pdwIÅutNextPos
 = 
g
->
dwInNextPos
;

478 *
pdwOuutThisPos
 = 
g
->
dwOutNextPos
;

479 
wFÏgs
 = 0;

483 ià(
pbIÅutBuf
 !ğ
NULL
) {

484 
	`INSURE
 (
dwIÅutAva
 >ğ
g
->
dwBy‹sP”Row
);

485 *
pdwIÅutU£d
 = 
g
->
dwBy‹sP”Row
;

486 
g
->
dwInNextPos
 +ğg->
dwBy‹sP”Row
;

487 *
pdwIÅutNextPos
 = 
g
->
dwInNextPos
;

488 
g
->
dwRowsR—d
 += 1;

489 
wFÏgs
 |ğ
IP_CONSUMED_ROW
 | 
IP_READY_FOR_DATA
;

494 ià(
g
->
nRowsFËd
 < g->
nRows
) {

495 
	`INSURE
 (
pbIÅutBuf
 !ğ
NULL
);

497 
	`IP_MEM_ALLOC
 (
g
->
dwBy‹sP”Row
 + g->
iBy‹sP”Pix–
*g->
nCŞs
,

498 
g
->
­Rows
[g->
nRowsFËd
]);

499 
	`CİyRow
 (
g
, 
pbIÅutBuf
, g->
­Rows
[g->
nRowsFËd
]);

500 
g
->
nRowsFËd
 += 1;

501 } 
g
->
nRowsFËd
 < (g->
nRows
+1)/2);

503 ià(
g
->
nRowsFËd
 < g->
nRows
)

504  
wFÏgs
;

507 
i
;

508 
PBYTE
 
pBÙtomRow
;

510 ià(
pbIÅutBuf
 =ğ
NULL
) {

512 ià(
g
->
dwRowsR—d
 =ğg->
dwRowsWr™‹n
)

513  
IP_DONE
;

514 
pbIÅutBuf
 = 
g
->
­Rows
[g->
nRows
-1];

517 
pBÙtomRow
 = 
g
->
­Rows
[0];

518 
i
=1; i<
g
->
nRows
; i++)

519 
g
->
­Rows
[
i
-1] = g->apRows[i];

520 
g
->
­Rows
[g->
nRows
-1] = 
pBÙtomRow
;

522 
	`CİyRow
 (
g
, 
pbIÅutBuf
, 
pBÙtomRow
);

527 
	`INSURE
 (
dwOuutAva
 >ğ
g
->
dwBy‹sP”Row
);

529 ià(
g
->
Œa™s
.
iB™sP”Pix–
==8 || g->traits.iBitsPerPixel==24)

530 
	`cÚvŞve_by‹s
 (
g
, 
pbOuutBuf
);

532 
	`cÚvŞve_wÜds
 (
g
, (
WORD
*)
pbOuutBuf
);

534 *
pdwOuutU£d
 = 
g
->
dwBy‹sP”Row
;

535 *
pdwOuutThisPos
 = 
g
->
dwOutNextPos
;

536 
g
->
dwOutNextPos
 +ğg->
dwBy‹sP”Row
;

537 
g
->
dwRowsWr™‹n
 += 1;

538 
wFÏgs
 |ğ
IP_PRODUCED_ROW
;

540  
wFÏgs
;

542 
çl_”rÜ
:

543  
IP_FATAL_ERROR
;

544 
	}
}

554 
FUNC_STATUS
 
WORD
 
	$cÚvŞve_š£¹edD©a
 (

555 
IP_XFORM_HANDLE
 
hXfÜm
,

556 
DWORD
 
dwNumBy‹s
)

558 
	`çlB»akPošt
 ();

559  
IP_FATAL_ERROR
;

560 
	}
}

570 
FUNC_STATUS
 
WORD
 
	$cÚvŞve_ÃwPage
 (

571 
IP_XFORM_HANDLE
 
hXfÜm
)

573 
PCONV_INST
 
g
;

575 
	`HANDLE_TO_PTR
 (
hXfÜm
, 
g
);

577  
IP_DONE
;

579 
çl_”rÜ
:

580  
IP_FATAL_ERROR
;

582 
	}
}

592 
FUNC_STATUS
 
WORD
 
	$cÚvŞve_şo£XfÜm
 (
IP_XFORM_HANDLE
 
hXfÜm
)

594 
PCONV_INST
 
g
;

595 
i
;

597 
	`HANDLE_TO_PTR
 (
hXfÜm
, 
g
);

600 
i
=0; i<
IP_CONVOLVE_MAXSIZE
; i++)

601 ià(
g
->
­Rows
[
i
] !ğ
NULL
)

602 
	`IP_MEM_FREE
 (
g
->
­Rows
[
i
]);

604 
g
->
dwV®idChk
 = 0;

605 
	`IP_MEM_FREE
 (
g
);

607  
IP_DONE
;

609 
çl_”rÜ
:

610  
IP_FATAL_ERROR
;

611 
	}
}

621 #ifdeà
EXPORT_TRANSFORM


622 
	$__deş¥ec
 (
dÎexpÜt
)

624 
IP_XFORM_TBL
 
cÚvŞveTbl
 = {

625 
cÚvŞve_İ’XfÜm
,

626 
cÚvŞve_£tDeçuÉIÅutT¿™s
,

627 
cÚvŞve_£tXfÜmS³c
,

628 
cÚvŞve_g‘H—d”BufSize
,

629 
cÚvŞve_g‘Aùu®T¿™s
,

630 
cÚvŞve_g‘Aùu®BufSizes
,

631 
cÚvŞve_cÚv”t
,

632 
cÚvŞve_ÃwPage
,

633 
cÚvŞve_š£¹edD©a
,

634 
cÚvŞve_şo£XfÜm


635 
	}
};

646 #ifdeà
EXPORT_TRANSFORM


647 
	$EXPORT
(
WORD
è
	$G‘XfÜmTabË
 (
LPIP_XFORM_TBL
 
pXfÜm
)

649 
WORD
 
wR‘
 = 
IP_DONE
;

651 ià(
pXfÜm
)

652 *
pXfÜm
 = 
şrm­Tbl
;

654 
wR‘
 = 
IP_FATAL_ERROR
;

656  
wR‘
;

657 
	}
}

	@ip/xcrop.c

83 
	~"hp.h
"

84 
	~"defs.h
"

85 
	~"¡ršg.h
"

89 
	~"¡dio.h
"

90 
	~<tch¬.h
>

92 
	#PRINT
(
msg
,
¬g1
,
¬g2
) \

93 
	`_á´štf
(
¡d”r
, 
msg
, ()
¬g1
, ()
¬g2
)

	)

95 
	#PRINT
(
msg
,
¬g1
,
¬g2
)

	)

98 
	#CHECK_VALUE
 0x4ba1daû

	)

102 
IP_IMAGE_TRAITS
 
	mŒa™s
;

103 
DWORD
 
	mdwLeá
, 
	mdwRight
;

104 
DWORD
 
	mdwTİ
;

105 
DWORD
 
	mdwMaxOutRows
;

106 
DWORD
 
	mdwInBy‹sP”Row
;

107 
DWORD
 
	mdwOutBy‹sP”Row
;

108 
DWORD
 
	mdwLeáCrİBy‹s
;

109 
DWORD
 
	mdwInRows
;

110 
DWORD
 
	mdwOutRows
;

111 
DWORD
 
	mdwInNextPos
;

112 
DWORD
 
	mdwOutNextPos
;

113 
DWORD
 
	mdwV®idChk
;

114 } 
	tCROP_INST
, *
	tPCROP_INST
;

131 
WORD
 
	$üİ_İ’XfÜm
 (

132 
IP_XFORM_HANDLE
 *
pXfÜm
)

134 
PCROP_INST
 
g
;

136 
	`INSURE
 (
pXfÜm
 !ğ
NULL
);

137 
	`IP_MEM_ALLOC
 ((
CROP_INST
), 
g
);

138 *
pXfÜm
 = 
g
;

139 
	`mem£t
 (
g
, 0, (
CROP_INST
));

140 
g
->
dwV®idChk
 = 
CHECK_VALUE
;

141  
IP_DONE
;

143 
çl_”rÜ
:

144  
IP_FATAL_ERROR
;

145 
	}
}

164 
WORD
 
	$üİ_£tDeçuÉIÅutT¿™s
 (

165 
IP_XFORM_HANDLE
 
hXfÜm
,

166 
PIP_IMAGE_TRAITS
 
pT¿™s
)

168 
PCROP_INST
 
g
;

170 
	`HANDLE_TO_PTR
 (
hXfÜm
, 
g
);

173 
	`INSURE
 (
pT¿™s
->
iPix–sP”Row
>0 &&…T¿™s->
iB™sP”Pix–
>0);

174 
g
->
Œa™s
 = *
pT¿™s
;

175  
IP_DONE
;

177 
çl_”rÜ
:

178  
IP_FATAL_ERROR
;

179 
	}
}

189 
WORD
 
	$üİ_£tXfÜmS³c
 (

190 
IP_XFORM_HANDLE
 
hXfÜm
,

191 
DWORD_OR_PVOID
 
aXfÜmInfo
[])

193 
PCROP_INST
 
g
;

195 
	`HANDLE_TO_PTR
 (
hXfÜm
, 
g
);

197 
g
->
dwLeá
 = 
aXfÜmInfo
[
IP_CROP_LEFT
].
dwÜd
;

198 
g
->
dwRight
 = 
aXfÜmInfo
[
IP_CROP_RIGHT
].
dwÜd
;

199 
g
->
dwTİ
 = 
aXfÜmInfo
[
IP_CROP_TOP
].
dwÜd
;

200 
g
->
dwMaxOutRows
 = 
aXfÜmInfo
[
IP_CROP_MAXOUTROWS
].
dwÜd
;

202 ià(
g
->
dwMaxOutRows
 == 0)

203 
g
->
dwMaxOutRows
 = 0x7ffffffful;

205  
IP_DONE
;

207 
çl_”rÜ
:

208  
IP_FATAL_ERROR
;

209 
	}
}

219 
WORD
 
	$üİ_g‘H—d”BufSize
 (

220 
IP_XFORM_HANDLE
 
hXfÜm
,

221 
DWORD
 *
pdwInBufL’
)

224 *
pdwInBufL’
 = 0;

225  
IP_DONE
;

226 
	}
}

236 
WORD
 
	$üİ_g‘Aùu®T¿™s
 (

237 
IP_XFORM_HANDLE
 
hXfÜm
,

238 
DWORD
 
dwIÅutAva
,

239 
PBYTE
 
pbIÅutBuf
,

240 
PDWORD
 
pdwIÅutU£d
,

241 
PDWORD
 
pdwIÅutNextPos
,

242 
PIP_IMAGE_TRAITS
 
pInT¿™s
,

243 
PIP_IMAGE_TRAITS
 
pOutT¿™s
)

245 
PCROP_INST
 
g
;

246 
Ëá
, 
right
, 
shiá
;

247 
šWidth
, 
outWidth
;

248 
bµ
;

249 
aùu®Out
, 
maxOut
;

251 
	`HANDLE_TO_PTR
 (
hXfÜm
, 
g
);

255 *
pdwIÅutU£d
 = 0;

256 *
pdwIÅutNextPos
 = 0;

260 
bµ
 = 
g
->
Œa™s
.
iB™sP”Pix–
;

261 
Ëá
 = 
g
->
dwLeá
;

262 
right
 = 
g
->
dwRight
;

263 
šWidth
 = 
g
->
Œa™s
.
iPix–sP”Row
;

264 
outWidth
 = 
šWidth
 - 
Ëá
 - 
right
;

265 
	`INSURE
 (
outWidth
 >= 0);

267 ià(
bµ
 == 1) {

269 
shiá
 = ((
Ëá
+4) & ~7) -†eft;

270 
Ëá
 +ğ
shiá
;

271 
right
 +ğ
shiá
;

274 
g
->
dwInBy‹sP”Row
 = (
bµ
*
šWidth
 + 7) / 8;

275 
g
->
dwOutBy‹sP”Row
 = (
bµ
*
outWidth
 + 7) / 8;

276 
g
->
dwLeáCrİBy‹s
 = (
bµ
*
Ëá
 + 7) / 8;

280 *
pInT¿™s
 = 
g
->
Œa™s
;

281 *
pOutT¿™s
 = 
g
->
Œa™s
;

282 
pOutT¿™s
->
iPix–sP”Row
 = 
outWidth
;

285 ià(
pInT¿™s
->
lNumRows
 > 0) {

286 
maxOut
 = 
g
->
dwMaxOutRows
;

287 
aùu®Out
 = 
pInT¿™s
->
lNumRows
 - ()
g
->
dwTİ
;

288 
	`INSURE
 (
aùu®Out
 >= 0);

289 
pOutT¿™s
->
lNumRows
 = 
aùu®Out
<
maxOut
 ?‡ctualOut : maxOut;

292  
IP_DONE
 | 
IP_READY_FOR_DATA
;

294 
çl_”rÜ
:

295  
IP_FATAL_ERROR
;

296 
	}
}

306 
WORD
 
	$üİ_g‘Aùu®BufSizes
 (

307 
IP_XFORM_HANDLE
 
hXfÜm
,

308 
PDWORD
 
pdwMšInBufL’
,

309 
PDWORD
 
pdwMšOutBufL’
)

311 
PCROP_INST
 
g
;

313 
	`HANDLE_TO_PTR
 (
hXfÜm
, 
g
);

315 *
pdwMšInBufL’
 = 
g
->
dwInBy‹sP”Row
;

316 *
pdwMšOutBufL’
 = 
g
->
dwOutBy‹sP”Row
;

317  
IP_DONE
;

319 
çl_”rÜ
:

320  
IP_FATAL_ERROR
;

321 
	}
}

331 
WORD
 
	$üİ_cÚv”t
 (

332 
IP_XFORM_HANDLE
 
hXfÜm
,

333 
DWORD
 
dwIÅutAva
,

334 
PBYTE
 
pbIÅutBuf
,

335 
PDWORD
 
pdwIÅutU£d
,

336 
PDWORD
 
pdwIÅutNextPos
,

337 
DWORD
 
dwOuutAva
,

338 
PBYTE
 
pbOuutBuf
,

339 
PDWORD
 
pdwOuutU£d
,

340 
PDWORD
 
pdwOuutThisPos
)

342 
PCROP_INST
 
g
;

343 
DWORD
 
dwOutBy‹s
;

345 
	`HANDLE_TO_PTR
 (
hXfÜm
, 
g
);

349 ià(
pbIÅutBuf
 =ğ
NULL
) {

350 
	`PRINT
 (
	`_T
("crop_convert: Toldo flush.\n"), 0, 0);

351 *
pdwIÅutU£d
 = *
pdwOuutU£d
 = 0;

352 *
pdwIÅutNextPos
 = 
g
->
dwInNextPos
;

353 *
pdwOuutThisPos
 = 
g
->
dwOutNextPos
;

354  
IP_DONE
;

359 
dwOutBy‹s
 = (
g
->
dwInRows
 < g->
dwTİ
 || g->
dwOutRows
 >ğg->
dwMaxOutRows
)

360 ? 0 : 
g
->
dwOutBy‹sP”Row
;

364 
	`INSURE
 (
dwIÅutAva
 >ğ
g
->
dwInBy‹sP”Row
);

365 
	`INSURE
 (
dwOuutAva
 >ğ
dwOutBy‹s
);

367 ià(
dwOutBy‹s
 > 0) {

368 
	`memıy
 (
pbOuutBuf
, 
pbIÅutBuf
+
g
->
dwLeáCrİBy‹s
, 
dwOutBy‹s
);

369 
g
->
dwOutRows
 += 1;

372 
g
->
dwInRows
 += 1;

374 *
pdwIÅutU£d
 = 
g
->
dwInBy‹sP”Row
;

375 
g
->
dwInNextPos
 +ğg->
dwInBy‹sP”Row
;

376 *
pdwIÅutNextPos
 = 
g
->
dwInNextPos
;

378 *
pdwOuutU£d
 = 
dwOutBy‹s
;

379 *
pdwOuutThisPos
 = 
g
->
dwOutNextPos
;

380 
g
->
dwOutNextPos
 +ğ
dwOutBy‹s
;

382  
IP_CONSUMED_ROW
 | 
IP_PRODUCED_ROW
 | 
IP_READY_FOR_DATA
;

384 
çl_”rÜ
:

385  
IP_FATAL_ERROR
;

386 
	}
}

396 
WORD
 
	$üİ_š£¹edD©a
 (

397 
IP_XFORM_HANDLE
 
hXfÜm
,

398 
DWORD
 
dwNumBy‹s
)

400 
	`çlB»akPošt
 ();

401  
IP_FATAL_ERROR
;

402 
	}
}

412 
WORD
 
	$üİ_ÃwPage
 (

413 
IP_XFORM_HANDLE
 
hXfÜm
)

415 
PCROP_INST
 
g
;

417 
	`HANDLE_TO_PTR
 (
hXfÜm
, 
g
);

419  
IP_DONE
;

421 
çl_”rÜ
:

422  
IP_FATAL_ERROR
;

424 
	}
}

434 
WORD
 
	$üİ_şo£XfÜm
 (
IP_XFORM_HANDLE
 
hXfÜm
)

436 
PCROP_INST
 
g
;

438 
	`HANDLE_TO_PTR
 (
hXfÜm
, 
g
);

440 
g
->
dwV®idChk
 = 0;

441 
	`IP_MEM_FREE
 (
g
);

443  
IP_DONE
;

445 
çl_”rÜ
:

446  
IP_FATAL_ERROR
;

447 
	}
}

457 
IP_XFORM_TBL
 
	güİTbl
 = {

458 
üİ_İ’XfÜm
,

459 
üİ_£tDeçuÉIÅutT¿™s
,

460 
üİ_£tXfÜmS³c
,

461 
üİ_g‘H—d”BufSize
,

462 
üİ_g‘Aùu®T¿™s
,

463 
üİ_g‘Aùu®BufSizes
,

464 
üİ_cÚv”t
,

465 
üİ_ÃwPage
,

466 
üİ_š£¹edD©a
,

467 
üİ_şo£XfÜm


	@ip/xfakemono.c

77 
	~"hp.h
"

78 
	~"defs.h
"

79 
	~"¡ršg.h
"

83 
	~"¡dio.h
"

84 
	~<tch¬.h
>

85 
	#PRINT
(
msg
,
¬g1
,
¬g2
) \

86 
	`_á´štf
(
¡d”r
, 
msg
, ()
¬g1
, ()
¬g2
)

	)

88 
	#PRINT
(
msg
,
¬g1
,
¬g2
)

	)

91 
	#CHECK_VALUE
 0x4ba1daû

	)

93 #ifdeà
EXPORT_TRANSFORM


94 
	#FUNC_STATUS
 
	`__deş¥ec
 (
dÎexpÜt
)

	)

96 
	#FUNC_STATUS
 

	)

100 
IP_IMAGE_TRAITS
 
	mŒa™s
;

101 
	miFakeDPI
;

102 
DWORD
 
	mdwBy‹sP”Row
;

103 
DWORD
 
	mdwRowsDÚe
;

104 
DWORD
 
	mdwInNextPos
;

105 
DWORD
 
	mdwOutNextPos
;

106 
DWORD
 
	mdwV®idChk
;

107 } 
	tFMON_INST
, *
	tPFMON_INST
;

124 
FUNC_STATUS
 
WORD
 
	$çkeMÚo_İ’XfÜm
 (

125 
IP_XFORM_HANDLE
 *
pXfÜm
)

127 
PFMON_INST
 
g
;

129 
	`INSURE
 (
pXfÜm
 !ğ
NULL
);

130 
	`IP_MEM_ALLOC
 ((
FMON_INST
), 
g
);

131 *
pXfÜm
 = 
g
;

132 
	`mem£t
 (
g
, 0, (
FMON_INST
));

133 
g
->
dwV®idChk
 = 
CHECK_VALUE
;

134 
g
->
iFakeDPI
 = 8;

135  
IP_DONE
;

137 
çl_”rÜ
:

138  
IP_FATAL_ERROR
;

139 
	}
}

158 
FUNC_STATUS
 
WORD
 
	$çkeMÚo_£tDeçuÉIÅutT¿™s
 (

159 
IP_XFORM_HANDLE
 
hXfÜm
,

160 
PIP_IMAGE_TRAITS
 
pT¿™s
)

162 
PFMON_INST
 
g
;

164 
	`HANDLE_TO_PTR
 (
hXfÜm
, 
g
);

167 
	`INSURE
 (
pT¿™s
->
iPix–sP”Row
 > 0 &&

168 
pT¿™s
->
iB™sP”Pix–
 == 24 &&

169 
pT¿™s
->
iCompÚ’tsP”Pix–
 == 3);

171 
g
->
Œa™s
 = *
pT¿™s
;

172 
g
->
dwBy‹sP”Row
 = (g->
Œa™s
.
iPix–sP”Row
*g->Œa™s.
iB™sP”Pix–
 + 7) / 8;

173  
IP_DONE
;

175 
çl_”rÜ
:

176  
IP_FATAL_ERROR
;

177 
	}
}

187 
FUNC_STATUS
 
WORD
 
	$çkeMÚo_£tXfÜmS³c
 (

188 
IP_XFORM_HANDLE
 
hXfÜm
,

189 
DWORD_OR_PVOID
 
aXfÜmInfo
[])

191 
PFMON_INST
 
g
;

192 
	`HANDLE_TO_PTR
 (
hXfÜm
, 
g
);

193 
g
->
iFakeDPI
 = 
aXfÜmInfo
[
IP_FAKE_MONO_BPP
].
dwÜd
;

194 
	`INSURE
 (
g
->
iFakeDPI
==1 || g->iFakeDPI==8);

195  
IP_DONE
;

197 
çl_”rÜ
:

198  
IP_FATAL_ERROR
;

199 
	}
}

209 
FUNC_STATUS
 
WORD
 
	$çkeMÚo_g‘H—d”BufSize
 (

210 
IP_XFORM_HANDLE
 
hXfÜm
,

211 
DWORD
 *
pdwInBufL’
)

214 *
pdwInBufL’
 = 0;

215  
IP_DONE
;

216 
	}
}

226 
FUNC_STATUS
 
WORD
 
	$çkeMÚo_g‘Aùu®T¿™s
 (

227 
IP_XFORM_HANDLE
 
hXfÜm
,

228 
DWORD
 
dwIÅutAva
,

229 
PBYTE
 
pbIÅutBuf
,

230 
PDWORD
 
pdwIÅutU£d
,

231 
PDWORD
 
pdwIÅutNextPos
,

232 
PIP_IMAGE_TRAITS
 
pIÁ¿™s
,

233 
PIP_IMAGE_TRAITS
 
pOutT¿™s
)

235 
PFMON_INST
 
g
;

237 
	`HANDLE_TO_PTR
 (
hXfÜm
, 
g
);

240 *
pdwIÅutU£d
 = 0;

241 *
pdwIÅutNextPos
 = 0;

243 *
pIÁ¿™s
 = 
g
->
Œa™s
;

244 *
pOutT¿™s
 = 
g
->
Œa™s
;

246  
IP_DONE
 | 
IP_READY_FOR_DATA
;

248 
çl_”rÜ
:

249  
IP_FATAL_ERROR
;

250 
	}
}

260 
FUNC_STATUS
 
WORD
 
	$çkeMÚo_g‘Aùu®BufSizes
 (

261 
IP_XFORM_HANDLE
 
hXfÜm
,

262 
PDWORD
 
pdwMšInBufL’
,

263 
PDWORD
 
pdwMšOutBufL’
)

265 
PFMON_INST
 
g
;

266 
	`HANDLE_TO_PTR
 (
hXfÜm
, 
g
);

267 *
pdwMšInBufL’
 = *
pdwMšOutBufL’
 = 
g
->
dwBy‹sP”Row
;

268  
IP_DONE
;

270 
çl_”rÜ
:

271  
IP_FATAL_ERROR
;

272 
	}
}

282 
FUNC_STATUS
 
WORD
 
	$çkeMÚo_cÚv”t
 (

283 
IP_XFORM_HANDLE
 
hXfÜm
,

284 
DWORD
 
dwIÅutAva
,

285 
PBYTE
 
pbIÅutBuf
,

286 
PDWORD
 
pdwIÅutU£d
,

287 
PDWORD
 
pdwIÅutNextPos
,

288 
DWORD
 
dwOuutAva
,

289 
PBYTE
 
pbOuutBuf
,

290 
PDWORD
 
pdwOuutU£d
,

291 
PDWORD
 
pdwOuutThisPos
)

293 
PFMON_INST
 
g
;

294 
nBy‹s
;

295 
PBYTE
 
pIn
, 
pInAá”
, 
pOut
;

296 
rv
, 
gv
, 
bv
;

297 
g¿y
;

299 
	`HANDLE_TO_PTR
 (
hXfÜm
, 
g
);

303 ià(
pbIÅutBuf
 =ğ
NULL
) {

304 
	`PRINT
 (
	`_T
("fakeMono_convert: Toldo flush.\n"), 0, 0);

305 *
pdwIÅutU£d
 = *
pdwOuutU£d
 = 0;

306 *
pdwIÅutNextPos
 = 
g
->
dwInNextPos
;

307 *
pdwOuutThisPos
 = 
g
->
dwOutNextPos
;

308  
IP_DONE
;

313 
nBy‹s
 = 
g
->
dwBy‹sP”Row
;

314 
	`INSURE
 (
dwIÅutAva
 >ğ(
DWORD
)
nBy‹s
 );

315 
	`INSURE
 (
dwOuutAva
 >ğ(
DWORD
)
nBy‹s
);

317 
pIn
 = 
pbIÅutBuf
;

318 
pOut
 = 
pbOuutBuf
;

319 
pInAá”
 = 
pIn
 + 
nBy‹s
;

321 ià(
g
->
iFakeDPI
 == 1) {

322 
pIn
 < 
pInAá”
) {

323 
rv
 = *
pIn
++;

324 
gv
 = *
pIn
++;

325 
bv
 = *
pIn
++;

326 
g¿y
 = 
	`NTSC_LUMINANCE
 (
rv
, 
gv
, 
bv
);

327 
g¿y
 = (gray >= 128) ? 255 : 0;

328 *
pOut
++ = (
BYTE
)
g¿y
;

329 *
pOut
++ = (
BYTE
)
g¿y
;

330 *
pOut
++ = (
BYTE
)
g¿y
;

333 
pIn
 < 
pInAá”
) {

334 
rv
 = *
pIn
++;

335 
gv
 = *
pIn
++;

336 
bv
 = *
pIn
++;

337 
g¿y
 = 
	`NTSC_LUMINANCE
 (
rv
, 
gv
, 
bv
);

338 *
pOut
++ = (
BYTE
)
g¿y
;

339 *
pOut
++ = (
BYTE
)
g¿y
;

340 *
pOut
++ = (
BYTE
)
g¿y
;

344 *
pdwIÅutU£d
 = 
nBy‹s
;

345 
g
->
dwInNextPos
 +ğ
nBy‹s
;

346 *
pdwIÅutNextPos
 = 
g
->
dwInNextPos
;

348 *
pdwOuutU£d
 = 
nBy‹s
;

349 *
pdwOuutThisPos
 = 
g
->
dwOutNextPos
;

350 
g
->
dwOutNextPos
 +ğ
nBy‹s
;

352 
g
->
dwRowsDÚe
 += 1;

354  
IP_CONSUMED_ROW
 | 
IP_PRODUCED_ROW
 | 
IP_READY_FOR_DATA
;

356 
çl_”rÜ
:

357  
IP_FATAL_ERROR
;

358 
	}
}

368 
FUNC_STATUS
 
WORD
 
	$çkeMÚo_š£¹edD©a
 (

369 
IP_XFORM_HANDLE
 
hXfÜm
,

370 
DWORD
 
dwNumBy‹s
)

372 
	`çlB»akPošt
 ();

373  
IP_FATAL_ERROR
;

374 
	}
}

384 
FUNC_STATUS
 
WORD
 
	$çkeMÚo_ÃwPage
 (

385 
IP_XFORM_HANDLE
 
hXfÜm
)

387 
PFMON_INST
 
g
;

389 
	`HANDLE_TO_PTR
 (
hXfÜm
, 
g
);

391  
IP_DONE
;

393 
çl_”rÜ
:

394  
IP_FATAL_ERROR
;

396 
	}
}

406 
FUNC_STATUS
 
WORD
 
	$çkeMÚo_şo£XfÜm
 (
IP_XFORM_HANDLE
 
hXfÜm
)

408 
PFMON_INST
 
g
;

410 
	`HANDLE_TO_PTR
 (
hXfÜm
, 
g
);

412 
g
->
dwV®idChk
 = 0;

413 
	`IP_MEM_FREE
 (
g
);

415  
IP_DONE
;

417 
çl_”rÜ
:

418  
IP_FATAL_ERROR
;

419 
	}
}

428 #ifdeà
EXPORT_TRANSFORM


429 
	$__deş¥ec
 (
dÎexpÜt
)

431 
IP_XFORM_TBL
 
çkeMÚoTbl
 = {

432 
çkeMÚo_İ’XfÜm
,

433 
çkeMÚo_£tDeçuÉIÅutT¿™s
,

434 
çkeMÚo_£tXfÜmS³c
,

435 
çkeMÚo_g‘H—d”BufSize
,

436 
çkeMÚo_g‘Aùu®T¿™s
,

437 
çkeMÚo_g‘Aùu®BufSizes
,

438 
çkeMÚo_cÚv”t
,

439 
çkeMÚo_ÃwPage
,

440 
çkeMÚo_š£¹edD©a
,

441 
çkeMÚo_şo£XfÜm


442 
	}
};

453 #ifdeà
EXPORT_TRANSFORM


454 
	$EXPORT
(
WORD
è
	$G‘XfÜmTabË
 (
LPIP_XFORM_TBL
 
pXfÜm
)

456 
WORD
 
wR‘
 = 
IP_DONE
;

458 ià(
pXfÜm
)

459 *
pXfÜm
 = 
şrm­Tbl
;

461 
wR‘
 = 
IP_FATAL_ERROR
;

463  
wR‘
;

464 
	}
}

	@ip/xfax.c

96 
	~"hp.h
"

97 
	~"defs.h
"

98 
	~"¡ršg.h
"

99 
	~"as£¹.h
"

103 
	~"¡dio.h
"

104 
	~<tch¬.h
>

106 
	#PRINT
(
msg
,
¬g1
,
¬g2
) \

107 
	`_á´štf
(
¡dout
, 
msg
, ()
¬g1
, ()
¬g2
)

	)

109 
	#PRINT
(
msg
,
¬g1
,
¬g2
)

	)

112 
	#CHECK_VALUE
 0x1û5ÿ7e

	)

132 cÚ¡ 
BYTE
 
	gbaLeáZ”ÛsTbl
[256] =

155 cÚ¡ 
BYTE
 
	gbaRightZ”ÛsTbl
[256] =

194 
	$sÿn_to
 (

195 
UINT
 
sk
,

196 
BYTE
 *
buf_p
,

197 
¡¬t_pos
,

198 
pix–s_š_row
)

224 
BYTE
 *
cur_p
;

225 
UINT
 
by‹_mask
;

226 
UINT
 
by‹
;

227 
pos
;

229 
by‹_mask
 = 0x00FFu;

230 
cur_p
 = 
buf_p
 + (
¡¬t_pos
 >> 3);

231 
sk
 &ğ
by‹_mask
;

232 
by‹
 = (*
cur_p
 ^ 
sk
è& (
by‹_mask
 >> (
¡¬t_pos
 & 7));

234 ià(
by‹
 == 0) {

236 
cur_p
 += 1;

237 
by‹
 = *
cur_p
;

238 } 
by‹
 =ğ
sk
);

239 
by‹
 ^ğ
sk
;

242 
pos
 = ((
cur_p
-
buf_p
)<<3è+ 
baLeáZ”ÛsTbl
[
by‹
];

244 ià(
pos
 > 
pix–s_š_row
)

245 
pos
 = 
pix–s_š_row
;

246  
pos
;

247 
	}
}

257 
	#WORST_EXPAND_1D
 (9<<1è

	)

258 
	#WORST_EXPAND_2D
 (6<<2è

	)

260 
	$wÜ¡_buf_size
 (

261 
WORD
 
wFmt
,

262 
iRowWidth
)

264  ( ( (
wFmt
==
IP_FAX_MH
 ? 
WORST_EXPAND_1D
 : 
WORST_EXPAND_2D
)

265 * ((
iRowWidth
+7)/8)

268 
	}
}

288 
IP_IMAGE_TRAITS
 
	mŒa™s
;

289 
DWORD
 
	mdwV®idChk
;

290 
DWORD
 
	mdwInNextPos
;

291 
DWORD
 
	mdwOutNextPos
;

292 
	miRowL’
;

293 
BYTE
 
	mwOutFmt
;

294 
BOOL
 
	mfNoEOLs
;

295 
UINT
 
	mw12Cyşe
;

296 
UINT
 
	mwMšB™s
;

297 
	miRowNum
;

298 
BYTE
 *
	m´iÜ_p
;

301 
BYTE
 *
	mpbBufS¹
;

302 
BYTE
 *
	mpbOutBy‹
;

303 
DWORD
 
	mdwB™Bufãr
;

304 
UINT
 
	mwB™sAva
;

305 } 
	tENC_INST
, *
	tPENC_INST
;

332 
	$put_š™
 (

333 
ENC_INST
 *
g
,

334 
BYTE
 *
pbOutBuf
)

336 
g
->
dwB™Bufãr
 = 0;

337 
g
->
wB™sAva
 = 32;

338 
g
->
pbOutBy‹
 = 
pbOutBuf
;

339 
g
->
pbBufS¹
 = 
pbOutBuf
;

340 
	}
}

359 
	$wr™e_by‹s
 (
ENC_INST
 *
g
)

364 
BYTE
 *
by‹_p
;

365 
DWORD
 
b™buf
;

366 
UINT
 
b™§va
;

369 
by‹_p
 = 
g
->
pbOutBy‹
;

370 
b™buf
 = 
g
->
dwB™Bufãr
;

371 
b™§va
 = 
g
->
wB™sAva
;

374 *
by‹_p
++ = (
BYTE
 )(
b™buf
 >> 24);

375 
b™buf
 <<= 8;

376 
b™§va
 += 8;

377 } 
b™§va
 <= 24);

379 
g
->
pbOutBy‹
 = 
by‹_p
;

380 
g
->
dwB™Bufãr
 = 
b™buf
;;

381 
g
->
wB™sAva
 = 
b™§va
;

382 
	}
}

385 
	#put_b™s
(
g
, 
Ëngth_·r
, 
b™s_·r
) \

387 
UINT
 
Ëngth_loc
 = 
Ëngth_·r
; \

388 
DWORD
 
b™s_loc
 = 
b™s_·r
; \

390 ià(
Ëngth_loc
 > 
g
->
wB™sAva
) \

391 
	`wr™e_by‹s
 (
g
); \

393 
g
->
wB™sAva
 -ğ
Ëngth_loc
; \

394 
g
->
dwB™Bufãr
 |ğ
b™s_loc
 << g->
wB™sAva
; \

395 } 0)

	)

398 
	$put_b™s_routše
 (

399 
ENC_INST
 *
g
,

400 
UINT
 
Ëngth
,

401 
DWORD
 
b™s
)

403 
	`put_b™s
 (
g
, 
Ëngth
, 
b™s
);

404 
	}
}

413 
	$put_æush
 (
ENC_INST
 *
g
)

415 ià(
g
->
wB™sAva
 < 32) {

416 
g
->
wB™sAva
 &= ~7ul;

417 
	`wr™e_by‹s
 (
g
);

420 
	`as£¹
 (
g
->
wB™sAva
 == 32);

421 
	}
}

436 
	$put_fl_b™s
 (
ENC_INST
 *
g
)

438 
iMÜe
;

440 
	`put_æush
 (
g
);

444 
iMÜe
 = ()
g
->
wMšB™s
 - 8*(g->
pbOutBy‹
 - g->
pbBufS¹
);

445 ià(
iMÜe
 > 0) {

446 
iMÜe
 = (iMore+7) / 8;

447 
	`mem£t
 (
g
->
pbOutBy‹
, 0, 
iMÜe
);

448 
g
->
pbOutBy‹
 +ğ
iMÜe
;

450 
	}
}

463 
	$put_g¿b
 (
ENC_INST
 *
g
)

465 
n
;

467 
n
 = 
g
->
pbOutBy‹
 - g->
pbBufS¹
;

468 
g
->
pbOutBy‹
 = g->
pbBufS¹
;

469  
n
;

470 
	}
}

479 
	$put_Ãw_buf
 (

480 
ENC_INST
 *
g
,

481 
BYTE
 *
pbOutBuf
)

483 
	`as£¹
 (
g
->
pbOutBy‹
 =ğg->
pbBufS¹
);

484 
g
->
pbOutBy‹
 = 
pbOutBuf
;

485 
g
->
pbBufS¹
 = 
pbOutBuf
;

486 
	}
}

495 
	$put_dÚe
 (

496 
ENC_INST
 *
g
)

498 
	`put_æush
 (
g
);

499  
g
->
pbOutBy‹
 - g->
pbBufS¹
;

500 
	}
}

522 
USHORT
 
	mb™s
;

523 
USHORT
 
	mËngth
;

524 } 
	thuff_t
;

528 cÚ¡ 
huff_t
 
	gMHWh™eRuns
[] = {

549 cÚ¡ 
huff_t
 
	gMHMakeupWh™e
[] = {

561 cÚ¡ 
huff_t
 
	gMHBÏckRuns
[] = {

582 cÚ¡ 
huff_t
 
	gMHMakeupBÏck
[] = {

594 cÚ¡ 
huff_t
 
	gMHExtMakeup
[] = {

603 cÚ¡ 
huff_t
 
	gV”tTbl
[] = {

620 
	$put_run_routše
(

621 
ENC_INST
 *
g
,

622 
iRunL’
,

623 cÚ¡ 
huff_t
 *
makeup_tbl
,

624 cÚ¡ 
huff_t
 *
code_tbl
)

626 
huff_t
 
‹
;

628 
iRunL’
 >= 1792) {

629 
os
;

630 
os
 = (
iRunL’
>>6) - (1792>>6);

631 ià(
os
 > 12)

632 
os
 = 12;

633 
‹
 = 
MHExtMakeup
 [
os
];

634 
	`put_b™s_routše
 (
g
, 
‹
.
Ëngth
,e.
b™s
);

635 
iRunL’
 -ğ(
os
+(1792>>6)) << 6;

638 ià(
iRunL’
 >= 64) {

639 
‹
 = 
makeup_tbl
 [(
iRunL’
>>6) - 1];

640 
	`put_b™s_routše
 (
g
, 
‹
.
Ëngth
,e.
b™s
);

641 
iRunL’
 &= 63;

644 
‹
 = 
code_tbl
 [
iRunL’
];

645 
	`put_b™s_routše
 (
g
, 
‹
.
Ëngth
,e.
b™s
);

646 
	}
}

648 
	#put_run
(
g
, 
·r_run_Ën
, 
·r_makeup_tbl
, 
·r_code_tbl
) \

650 
huff_t
 
‹
; \

651 
loc_run_Ën
 = 
·r_run_Ën
; \

653 ià(
loc_run_Ën
 >= 64) \

654 
	`put_run_routše
 (
g
, 
loc_run_Ën
, 
·r_makeup_tbl
, 
·r_code_tbl
); \

656 
‹
 = 
·r_code_tbl
 [
loc_run_Ën
]; \

657 
	`put_b™s
 (
g
, 
‹
.
Ëngth
,e.
b™s
); \

659 } 0)

	)

663 
	#PutWh™eRun
(
g
, 
iRunL’
) \

664 
	`put_run
 (
g
, 
iRunL’
, 
MHMakeupWh™e
, 
MHWh™eRuns
)

	)

667 
	#PutBÏckRun
(
g
, 
iRunL’
) \

668 
	`put_run
 (
g
, 
iRunL’
, 
MHMakeupBÏck
, 
MHBÏckRuns
)

	)

671 
	$PutEOL
(
ENC_INST
 *
g
)

673 
	`put_b™s_routše
 (
g
, 12, 0x001);

674 
	}
}

688 
	$’code_row_1d
 (

689 
ENC_INST
 *
g
,

690 
BYTE
 *
pbPix–Row
,

691 
iPix–s
,

692 
BOOL
 
fDošgMR
)

694 
iS¹Pos
;

695 
iChªge
;

696 
UINT
 
sk
;

698 
	`PutEOL
 (
g
);

699 ià(
fDošgMR
)

700 
	`put_b™s_routše
 (
g
,1,1);

702 
pbPix–Row
[
iPix–s
>>3] = 0x55u;

703 
iS¹Pos
 = 0;

704 
sk
 = 0;

706 
iS¹Pos
 < 
iPix–s
) {

707 
iChªge
 = 
	`sÿn_to
 (
sk
, 
pbPix–Row
, 
iS¹Pos
, 
iPix–s
);

708 ià(
sk
è
	`PutBÏckRun
 (
g
, 
iChªge
-
iS¹Pos
);

709 
	`PutWh™eRun
 (
g
, 
iChªge
-
iS¹Pos
);

710 
iS¹Pos
 = 
iChªge
;

711 
sk
 = ~skip;

713 
	}
}

846 
	$’code_row_2d
 (

847 
ENC_INST
 *
g
,

848 
BYTE
 *
pbPix–Row
,

849 
BYTE
 *
pbRefRow
,

850 
iPix–s
,

851 
BOOL
 
fDošgMR
)

853 
	#A1
 1

	)

854 
	#B0
 2

	)

855 
	#B1
 4

	)

856 
	#B2
 8

	)

858 
a0
, 
a1
, 
a2
;

859 
b1
, 
b2
;

860 
iD–
;

861 
UINT
 
sk
;

862 
UINT
 
Ãed
;

864 ià(
fDošgMR
) {

865 
	`PutEOL
 (
g
);

866 
	`put_b™s_routše
 (
g
,1,0);

869 
pbPix–Row
[
iPix–s
>>3] = 0x55u;

870 
pbRefRow
 [
iPix–s
>>3] = 0x55u;

876 
a1
 = 
	`sÿn_to
 ( 0x00, 
pbPix–Row
, 0, 
iPix–s
);

877 
b1
 = 
	`sÿn_to
 ( 0x00, 
pbRefRow
, 0, 
iPix–s
);

878 
b2
 = 
	`sÿn_to
 ((
UINT
)~0x00, 
pbRefRow
, 
b1
+1, 
iPix–s
);

879 
sk
 = (
UINT
)~0x00u;

880 
a0
 = 0;

882 
TRUE
) {

886 
iD–
 = 
a1
 - 
b1
;

888 ià(
b2
 < 
a1
) {

889 
	`put_b™s
 (
g
,4,1);

890 
Ãed
 = 
B1
 | 
B2
;

891 
a0
 = 
b2
;

892 
b1
 = 
b2
;

893 } ià(-3<=
iD–
 && iDelta<=3) {

894 
huff_t
 
‹
 = 
V”tTbl
[
iD–
+3];

895 
	`put_b™s
 (
g
, 
‹
.
Ëngth
,e.
b™s
);

896 
Ãed
 = 
A1
 | 
B2
;

897 ià(
b2
==
a1
 || 
iD–
<=-2)

898 
Ãed
 = 
A1
 | 
B0
 | 
B1
 | 
B2
;

899 
a0
 = 
a1
;

900 
b1
 = 
b2
;

901 
sk
 = ~skip;

903 
a2
 = 
	`sÿn_to
 (
sk
, 
pbPix–Row
, 
a1
+1, 
iPix–s
);

904 
	`put_b™s
 (
g
,3,1);

905 ià(
sk
) {

906 
	`PutWh™eRun
 (
g
,
a1
-
a0
);

907 
	`PutBÏckRun
 (
g
,
a2
-
a1
);

909 
	`PutBÏckRun
 (
g
,
a1
-
a0
);

910 
	`PutWh™eRun
 (
g
,
a2
-
a1
);

912 ià(
a2
 > 
b2
) {

913 
Ãed
 = 
A1
 | 
B0
 | 
B1
 | 
B2
;

914 } ià(
a2
 < 
b1
) {

915 
Ãed
 = 
A1
;

917 
b1
 = 
b2
;

918 
Ãed
 = 
A1
 | 
B1
 | 
B2
;

920 
a0
 = 
a2
;

923 ià(
a0
 >ğ
iPix–s
)

928 ià(
Ãed
 & 
A1
è
a1
 = 
	`sÿn_to
 (~
sk
, 
pbPix–Row
, 
a0
+1, 
iPix–s
);

929 ià(
Ãed
 & 
B0
è
b1
 = 
	`sÿn_to
 ( 
sk
, 
pbRefRow
, 
a0
, 
iPix–s
);

930 ià(
Ãed
 & 
B1
è
b1
 = 
	`sÿn_to
 (~
sk
, 
pbRefRow
, b1+1, 
iPix–s
);

931 ià(
Ãed
 & 
B2
è
b2
 = 
	`sÿn_to
 ( 
sk
, 
pbRefRow
, 
b1
+1, 
iPix–s
);

933 
	}
}

964 
WORD
 
	$çxEncode_İ’XfÜm
 (

965 
IP_XFORM_HANDLE
 *
pXfÜm
)

967 
PENC_INST
 
g
;

969 
	`INSURE
 (
pXfÜm
 !ğ
NULL
);

970 
	`IP_MEM_ALLOC
 ((
ENC_INST
), 
g
);

971 *
pXfÜm
 = 
g
;

972 
	`mem£t
 (
g
, 0, (
ENC_INST
));

973 
g
->
dwV®idChk
 = 
CHECK_VALUE
;

974 
	`put_š™
 (
g
, 
NULL
);

976  
IP_DONE
;

978 
çl_”rÜ
:

979  
IP_FATAL_ERROR
;

980 
	}
}

999 
WORD
 
	$çxEncode_£tDeçuÉIÅutT¿™s
 (

1000 
IP_XFORM_HANDLE
 
hXfÜm
,

1001 
PIP_IMAGE_TRAITS
 
pT¿™s
)

1003 
PENC_INST
 
g
;

1005 
	`HANDLE_TO_PTR
 (
hXfÜm
, 
g
);

1008 
	`INSURE
 (
pT¿™s
->
iPix–sP”Row
 > 0);

1009 
	`INSURE
 (
pT¿™s
->
iB™sP”Pix–
 == 1);

1011 
g
->
Œa™s
 = *
pT¿™s
;

1013  
IP_DONE
;

1015 
çl_”rÜ
:

1016  
IP_FATAL_ERROR
;

1017 
	}
}

1027 
WORD
 
	$çxEncode_£tXfÜmS³c
 (

1028 
IP_XFORM_HANDLE
 
hXfÜm
,

1029 
DWORD_OR_PVOID
 
aXfÜmInfo
[])

1031 
PENC_INST
 
g
;

1033 
	`HANDLE_TO_PTR
 (
hXfÜm
, 
g
);

1034 
g
->
wOutFmt
 = (
BYTE
)
aXfÜmInfo
[
IP_FAX_FORMAT
].
dwÜd
;

1035 
g
->
fNoEOLs
 = (
BOOL
)
aXfÜmInfo
[
IP_FAX_NO_EOLS
].
dwÜd
;

1036 
g
->
wMšB™s
 = (
WORD
)
aXfÜmInfo
[
IP_FAX_MIN_ROW_LEN
].
dwÜd
;

1037  
IP_DONE
;

1039 
çl_”rÜ
:

1040  
IP_FATAL_ERROR
;

1041 
	}
}

1051 
WORD
 
	$çxEncode_g‘H—d”BufSize
 (

1052 
IP_XFORM_HANDLE
 
hXfÜm
,

1053 
DWORD
 *
pdwInBufL’
)

1056 *
pdwInBufL’
 = 0;

1057  
IP_DONE
;

1058 
	}
}

1072 
WORD
 
	$çxEncode_g‘Aùu®T¿™s
 (

1073 
IP_XFORM_HANDLE
 
hXfÜm
,

1074 
DWORD
 
dwIÅutAva
,

1075 
PBYTE
 
pbIÅutBuf
,

1076 
PDWORD
 
pdwIÅutU£d
,

1077 
PDWORD
 
pdwIÅutNextPos
,

1078 
PIP_IMAGE_TRAITS
 
pInT¿™s
,

1079 
PIP_IMAGE_TRAITS
 
pOutT¿™s
)

1081 
PENC_INST
 
g
;

1082 
šBy‹s
;

1084 
	`HANDLE_TO_PTR
 (
hXfÜm
, 
g
);

1088 *
pdwIÅutU£d
 = 0;

1089 *
pdwIÅutNextPos
 = 0;

1093 *
pInT¿™s
 = 
g
->
Œa™s
;

1094 *
pOutT¿™s
 = 
g
->
Œa™s
;

1098 
g
->
iRowL’
 = g->
Œa™s
.
iPix–sP”Row
;

1101 
g
->
w12Cyşe
 = (g->
Œa™s
.
lV”tDPI
 < (150l<<16)) ? 2 : 4;

1105 ià(
g
->
wOutFmt
 !ğ
IP_FAX_MH
) {

1106 ià(
g
->
´iÜ_p
 !ğ
NULL
)

1107 
	`IP_MEM_FREE
 (
g
->
´iÜ_p
);

1108 
šBy‹s
 = (
g
->
iRowL’
+7) / 8;

1109 
	`IP_MEM_ALLOC
 (
šBy‹s
, 
g
->
´iÜ_p
);

1110 
	`mem£t
 (
g
->
´iÜ_p
, 0, 
šBy‹s
);

1113  
IP_DONE
 | 
IP_READY_FOR_DATA
;

1115 
çl_”rÜ
:

1116  
IP_FATAL_ERROR
;

1117 
	}
}

1127 
WORD
 
	$çxEncode_g‘Aùu®BufSizes
 (

1128 
IP_XFORM_HANDLE
 
hXfÜm
,

1129 
PDWORD
 
pdwMšInBufL’
,

1130 
PDWORD
 
pdwMšOutBufL’
)

1132 
PENC_INST
 
g
;

1133 
UINT
 
uWÜ¡Buf
, 
uMšBy‹s
;

1135 
	`HANDLE_TO_PTR
 (
hXfÜm
, 
g
);

1136 *
pdwMšInBufL’
 = (
g
->
iRowL’
+7) / 8;

1138 
uWÜ¡Buf
 = 
	`wÜ¡_buf_size
 (
g
->
wOutFmt
, g->
iRowL’
);

1139 
uMšBy‹s
 = (
g
->
wMšB™s
+7) / 8;

1140 *
pdwMšOutBufL’
 = 
uWÜ¡Buf
 > 
uMšBy‹s
 ? uWorstBuf : uMinBytes;

1141  
IP_DONE
;

1143 
çl_”rÜ
:

1144  
IP_FATAL_ERROR
;

1145 
	}
}

1160 
WORD
 
	$çxEncode_cÚv”t
 (

1161 
IP_XFORM_HANDLE
 
hXfÜm
,

1162 
DWORD
 
dwIÅutAva
,

1163 
PBYTE
 
pbIÅutBuf
,

1164 
PDWORD
 
pdwIÅutU£d
,

1165 
PDWORD
 
pdwIÅutNextPos
,

1166 
DWORD
 
dwOuutAva
,

1167 
PBYTE
 
pbOuutBuf
,

1168 
PDWORD
 
pdwOuutU£d
,

1169 
PDWORD
 
pdwOuutThisPos
)

1171 
PENC_INST
 
g
;

1172 
šBy‹s
;

1173 
i
;

1175 
	`HANDLE_TO_PTR
 (
hXfÜm
, 
g
);

1177 
	`put_Ãw_buf
 (
g
, 
pbOuutBuf
);

1183 ià(
dwIÅutAva
 == 0) {

1185 
g
->
wOutFmt
) {

1186 
IP_FAX_MH
:

1187 
i
=6; i>0; i--)

1188 
	`PutEOL
 (
g
);

1191 
IP_FAX_MR
:

1192 
i
=6; i>0; i--) {

1193 
	`PutEOL
 (
g
);

1194 
	`put_b™s_routše
 (
g
,1,1);

1198 
IP_FAX_MMR
:

1199 
	`PutEOL
 (
g
);

1200 
	`PutEOL
 (
g
);

1204 *
pdwIÅutU£d
 = 0;

1205 *
pdwOuutU£d
 = 
	`put_dÚe
 (
g
);

1206 *
pdwIÅutNextPos
 = 
g
->
dwInNextPos
;

1207 *
pdwOuutThisPos
 = 
g
->
dwOutNextPos
;

1208  
IP_DONE
;

1215 
šBy‹s
 = (
g
->
iRowL’
+7) / 8;

1216 
	`INSURE
 (
dwIÅutAva
 >ğ(
DWORD
)
šBy‹s
);

1217 
	`INSURE
 (
dwOuutAva
 > 0);

1219 
g
->
wOutFmt
) {

1220 
IP_FAX_MH
:

1221 
	`’code_row_1d
 (
g
, 
pbIÅutBuf
, g->
iRowL’
, 
FALSE
);

1222 
	`put_fl_b™s
 (
g
);

1225 
IP_FAX_MR
:

1226 ià(
g
->
iRowNum
 % g->
w12Cyşe
 == 0)

1227 
	`’code_row_1d
 (
g
, 
pbIÅutBuf
, g->
iRowL’
, 
TRUE
);

1229 
	`’code_row_2d
 (
g
, 
pbIÅutBuf
, g->
´iÜ_p
, g->
iRowL’
, 
TRUE
);

1230 
	`put_fl_b™s
 (
g
);

1233 
IP_FAX_MMR
:

1234 
	`’code_row_2d
 (
g
, 
pbIÅutBuf
, g->
´iÜ_p
, g->
iRowL’
, 
FALSE
);

1238 ià(
g
->
´iÜ_p
 !ğ
NULL
)

1239 
	`memıy
 (
g
->
´iÜ_p
, 
pbIÅutBuf
, 
šBy‹s
);

1241 *
pdwIÅutU£d
 = 
šBy‹s
;

1242 
g
->
dwInNextPos
 +ğ
šBy‹s
;

1243 *
pdwIÅutNextPos
 = 
g
->
dwInNextPos
;

1245 *
pdwOuutU£d
 = 
	`put_g¿b
 (
g
);

1246 *
pdwOuutThisPos
 = 
g
->
dwOutNextPos
;

1247 
g
->
dwOutNextPos
 +ğ*
pdwOuutU£d
;

1248 
g
->
iRowNum
 += 1;

1250  
IP_CONSUMED_ROW
 | 
IP_PRODUCED_ROW
 | 
IP_READY_FOR_DATA
;

1252 
çl_”rÜ
:

1253  
IP_FATAL_ERROR
;

1254 
	}
}

1264 
WORD
 
	$çxEncode_š£¹edD©a
 (

1265 
IP_XFORM_HANDLE
 
hXfÜm
,

1266 
DWORD
 
dwNumBy‹s
)

1268 
	`çlB»akPošt
 ();

1269  
IP_FATAL_ERROR
;

1270 
	}
}

1280 
WORD
 
	$çxEncode_ÃwPage
 (

1281 
IP_XFORM_HANDLE
 
hXfÜm
)

1283 
PENC_INST
 
g
;

1285 
	`HANDLE_TO_PTR
 (
hXfÜm
, 
g
);

1287  
IP_DONE
;

1289 
çl_”rÜ
:

1290  
IP_FATAL_ERROR
;

1292 
	}
}

1302 
WORD
 
	$çxEncode_şo£XfÜm
 (
IP_XFORM_HANDLE
 
hXfÜm
)

1304 
PENC_INST
 
g
;

1306 
	`HANDLE_TO_PTR
 (
hXfÜm
, 
g
);

1308 ià(
g
->
´iÜ_p
 !ğ
NULL
)

1309 
	`IP_MEM_FREE
 (
g
->
´iÜ_p
);

1311 
g
->
dwV®idChk
 = 0;

1312 
	`IP_MEM_FREE
 (
g
);

1313  
IP_DONE
;

1315 
çl_”rÜ
:

1316  
IP_FATAL_ERROR
;

1317 
	}
}

1327 
IP_XFORM_TBL
 
	gçxEncodeTbl
 = {

1328 
çxEncode_İ’XfÜm
,

1329 
çxEncode_£tDeçuÉIÅutT¿™s
,

1330 
çxEncode_£tXfÜmS³c
,

1331 
çxEncode_g‘H—d”BufSize
,

1332 
çxEncode_g‘Aùu®T¿™s
,

1333 
çxEncode_g‘Aùu®BufSizes
,

1334 
çxEncode_cÚv”t
,

1335 
çxEncode_ÃwPage
,

1336 
çxEncode_š£¹edD©a
,

1337 
çxEncode_şo£XfÜm


1356 
	#NONWHITE_ROW
 0x0000

	)

1357 
	#WHITE_ROW
 0x0000

	)

1359 
	#MAX_CODE_LEN
 13

	)

1360 
	#EOL_LEN
 12

	)

1361 
	#EOLS_FOR_MH_MR
 3

	)

1362 
	#EOLS_FOR_MMR
 1

	)

1369 cÚ¡ 
BYTE
 
çx_v”t_huff_šdex
[];

1370 cÚ¡ 
USHORT
 
çx_v”t_huff
[];

1371 cÚ¡ 
BYTE
 
çx_bÏck_huff_šdex
[];

1372 cÚ¡ 
USHORT
 
çx_bÏck_huff
[];

1373 cÚ¡ 
BYTE
 
çx_wh™e_huff_šdex
[];

1374 cÚ¡ 
USHORT
 
çx_wh™e_huff
[];

1376 
	#MAX_BLACK_CODELEN
 13

	)

1377 
	#MAX_WHITE_CODELEN
 12

	)

1378 
	#MAX_VERT_CODELEN
 7

	)

1380 
	#CODELEN_SHIFT
 12

	)

1381 
	#VALUE_MASK
 0x0fffu

	)

1384 
	#LAST_VERT
 6

	)

1385 
	#PASS_MODE
 7

	)

1386 
	#HORIZ_MODE
 8

	)

1389 
	mRET_GOT_CODE
,

1390 
	mRET_BAD_CODE
,

1391 
	mRET_FILL
,

1392 
	mRET_HIT_EOL
,

1393 
	mRET_NEED_MORE


1405 
	mNORMAL_2D
,

1406 
	mHORIZ_1ST
,

1407 
	mHORIZ_2ND


1408 } 
	tSTATE_2D
;

1411 
IP_IMAGE_TRAITS
 
	mŒa™s
;

1412 
DWORD
 
	mdwInNextPos
;

1413 
DWORD
 
	mdwOutNextPos
;

1414 
DWORD
 
	mdwV®idChk
;

1417 
BYTE
 *
	mgb_buf_p
;

1418 
BYTE
 *
	mgb_buf_aá”_p
;

1419 
BYTE
 *
	mgb_by‹_p
;

1420 
	mgb_ÿche_út
;

1421 
DWORD
 
	mgb_ÿche
;

1423 
	mgb_num_z”Ûs
;

1426 
	mpix–_pos
;

1427 
BYTE
 
	mwh™e
;

1428 
STATE_2D
 
	m¡©e_2d
;

1429 
	ma0
;

1430 
BYTE
 *
	m´iÜ_p
;

1431 
BOOL
 
	m»f_row_šv®id
;

1434 
BYTE
 
	mšput_fÜm©
;

1435 
BYTE
 
	mnum_eŞs
;

1436 
BOOL
 
	mno_eŞs
;

1437 
BOOL
 
	mtoss_ev”ythšg
;

1438 
BOOL
 
	mæushšg_to_eŞ
;

1439 
BOOL
 
	mgÙ_fl
;

1440 
BOOL
 
	mgÙ_bÏck
;

1441 
BOOL
 
	mtwo_dim
;

1442 
	mrow_Ën
;

1443 
	mby‹s_š_row
;

1444 } 
	tDEC_INST
, *
	tPDEC_INST
;

1475 
	$b™s_š™
 (
DEC_INST
 *
g
)

1477 
g
->
gb_num_z”Ûs
 = 0;

1478 
g
->
gb_ÿche_út
 = 0;

1479 
	}
}

1488 
	$b™s_buf_İ’
 (

1489 
DEC_INST
 *
g
,

1490 
BYTE
 *
buf_p
,

1491 
num_by‹s
)

1493 
g
->
gb_by‹_p
 = 
buf_p
;

1494 
g
->
gb_buf_p
 = 
buf_p
;

1495 
g
->
gb_buf_aá”_p
 = 
buf_p
 + 
num_by‹s
;

1496 
	}
}

1505 
UINT
 
	$b™s_buf_şo£
 (
DEC_INST
 *
g
)

1507  (
g
->
gb_by‹_p
 - g->
gb_buf_p
);

1508 
	}
}

1517 
	$b™s_æush
 (
DEC_INST
 *
g
)

1519 
g
->
gb_ÿche_út
 = 0;

1520 
g
->
gb_by‹_p
 = g->
gb_buf_aá”_p
;

1521 
	}
}

1530 
	#BITS_REFILL_CACHE
(
g
) \

1532 
ÿche_út
 = 
g
->
gb_ÿche_út
; \

1533 
DWORD
 
ÿche
 = 
g
->
gb_ÿche
; \

1534 
BYTE
 *
by‹_p
 = 
g
->
gb_by‹_p
; \

1535 
BYTE
 *
buf_aá”_p
 = 
g
->
gb_buf_aá”_p
; \

1537 
ÿche_út
<=24 && 
by‹_p
<
buf_aá”_p
) { \

1538 
ÿche
 = (ÿch<< 8è| (*
by‹_p
++); \

1539 
ÿche_út
 += 8; \

1542 
g
->
gb_ÿche_út
 = 
ÿche_út
; \

1543 
g
->
gb_ÿche
 = 
ÿche
; \

1544 
g
->
gb_by‹_p
 = 
by‹_p
; \

1545 }

	)

1554 
	#BITS_IN_CACHE
(
g
è(g->
gb_ÿche_út
)

	)

1572 
BOOL
 
	$b™s_æush_to_eŞ
 (

1573 
DEC_INST
 *
g
,

1574 
BOOL
 
gÙ_fl
,

1575 
BOOL
 
Ëave_a_b™
)

1577 
	#CLEAR_UNUSED_CACHE_BITS
 \

1578 ià(
g
->
gb_ÿche_út
 < 32) \

1579 
g
->
gb_ÿche
 &ğ(1lu << g->
gb_ÿche_út
è- 1lu;

	)

1581 
DWORD
 
b™
;

1582 
BYTE
 
byt
;

1588 ià(
g
->
gb_num_z”Ûs
 >= 11)

1589 
gÙ_fl
 = 
TRUE
;

1591 ià(! 
gÙ_fl
)

1593 ià(
g
->
gb_ÿche_út
 != 0) {

1594 
b™
 = (1lu<<(
g
->
gb_ÿche_út
-1));

1595 
b™
 != 0;

1596 
b™
 >>= 1) {

1597 
g
->
gb_ÿche_út
 -= 1;

1598 ià(
b™
 & 
g
->
gb_ÿche
)

1599 
g
->
gb_num_z”Ûs
 =0;

1601 
g
->
gb_num_z”Ûs
 += 1;

1602 ià(
g
->
gb_num_z”Ûs
 >= 11)

1610 
TRUE
) {

1611 ià(
g
->
gb_by‹_p
 >ğg->
gb_buf_aá”_p
)

1612  
FALSE
;

1613 
byt
 = *(
g
->
gb_by‹_p
)++;

1614 
g
->
gb_num_z”Ûs
 +ğ
baLeáZ”ÛsTbl
[
byt
];

1615 ià(
g
->
gb_num_z”Ûs
 >= 11) {

1616 
g
->
gb_by‹_p
 -= 1;

1619 ià(
byt
 != 0)

1620 
g
->
gb_num_z”Ûs
 = 
baRightZ”ÛsTbl
[
byt
];

1628 
TRUE
)

1630 
	`BITS_REFILL_CACHE
 (
g
)

1631 ià(
g
->
gb_ÿche_út
==0 || (
Ëave_a_b™
 && g->gb_cache_cnt==1))

1632  
FALSE
;

1634 
CLEAR_UNUSED_CACHE_BITS


1636 ià(
g
->
gb_ÿche
 == 0)

1637 
g
->
gb_ÿche_út
 = 0;

1640 
b™
 = (1lu<<(
g
->
gb_ÿche_út
-1));

1641 (
b™
 & 
g
->
gb_ÿche
) == 0;

1642 
b™
 >>= 1)

1643 
g
->
gb_ÿche_út
 -= 1;

1649 ià(!
Ëave_a_b™
 || 
g
->
gb_ÿche_út
>=2) {

1650 
g
->
gb_ÿche_út
 -= 1;

1651 
g
->
gb_num_z”Ûs
 = 0;

1652  
TRUE
;

1663 ià(
g
->
gb_ÿche_út
 == 0)

1664 
g
->
gb_by‹_p
<g->
gb_buf_aá”_p
 && *(g->gb_byte_p)==0)

1665 
g
->
gb_by‹_p
++;

1667 
	}
}

1676 
	#BITS_LOAD
(
g
, 
num_b™s
, 
·r_»suÉ
) { \

1677 
n_b™s
 = ()(
num_b™s
); \

1679 
·r_»suÉ
 = (
g
->
gb_ÿche
 >> (g->
gb_ÿche_út
-
n_b™s
)) \

1680 & ((1u<<
n_b™s
) - 1u); \

1681 }

	)

1685 
	#BITS_LOAD
(
g
, 
num_b™s
, 
·r_»suÉ
) { \

1686 
n_b™s
 = ()(
num_b™s
); \

1688 
·r_»suÉ
 = 
g
->
gb_ÿche
; \

1690 
	`asm
 ("extract %1,%2,%0" \

1691 : "=d" (
·r_»suÉ
) \

1692 : "dI" (
g
->
gb_ÿche_út
 - 
n_b™s
), "dI" (n_b™s), "0" (
·r_»suÉ
)); \

1693 }

	)

1704 
	#BITS_ADVANCE
(
g
, 
num_b™s
) { \

1705 
g
->
gb_ÿche_út
 -ğ(
num_b™s
); \

1706 }

	)

1737 
UINT
 
	$·r£_code_routše
 (

1738 
DEC_INST
 *
g
,

1739 
b™s_š_šdex
,

1740 cÚ¡ 
BYTE
 
šdex_tbl
[],

1741 cÚ¡ 
USHORT
 
v®ue_tbl
[],

1742 *
v®ue_p
)

1744 
UINT
 
blob
, 
v®ues
;

1746 
	`BITS_REFILL_CACHE
(
g
)

1747 ià(
	`BITS_IN_CACHE
(
g
è< 
b™s_š_šdex
)

1748  
RET_NEED_MORE
;

1750 
	`BITS_LOAD
 (
g
, 
b™s_š_šdex
, 
blob
);

1751 
v®ues
 = 
v®ue_tbl
[
šdex_tbl
[
blob
]];

1753 ià(
v®ues
 != 0) {

1755 
	`BITS_ADVANCE
 (
g
, 
v®ues
 >> 
CODELEN_SHIFT
);

1756 *
v®ue_p
 = 
v®ues
 & 
VALUE_MASK
;

1757  
RET_GOT_CODE
;

1760 ià(
	`BITS_IN_CACHE
(
g
è< 
MAX_CODE_LEN
)

1761  
RET_NEED_MORE
;

1763 
	`BITS_LOAD
 (
g
, 
EOL_LEN
, 
blob
);

1765 ià(
blob
 == 1) {

1766 
	`BITS_ADVANCE
 (
g
, 
EOL_LEN
);

1767  
RET_HIT_EOL
;

1770 ià(
blob
 == 0) {

1771 
	`BITS_ADVANCE
 (
g
, 
EOL_LEN
);

1772  
RET_FILL
;

1775  
RET_BAD_CODE
;

1776 
	}
}

1785 
	#PARSE_CODE
( \

1786 
g
, \

1787 
b™s_š_šdex
, \

1788 
šdex_tbl
, \

1789 
v®ue_tbl
, \

1790 
out_»suÉ
, \

1791 
out_v®ue
) \

1793 
UINT
 
blob
, 
v®ues
; \

1795 ià(
	`BITS_IN_CACHE
(
g
è< 
b™s_š_šdex
) \

1796 
ÿÎ
##
v®ue_tbl
; \

1798 
	`BITS_LOAD
 (
g
, 
b™s_š_šdex
, 
blob
); \

1799 
v®ues
 = 
v®ue_tbl
[
šdex_tbl
[
blob
]]; \

1801 ià(
v®ues
 == 0) { \

1802 
ÿÎ
##
v®ue_tbl
: \

1803 
out_»suÉ
 = 
·r£_code_routše
 \

1804 (
g
, 
b™s_š_šdex
, 
šdex_tbl
, 
v®ue_tbl
, &
out_v®ue
); \

1806 
	`BITS_ADVANCE
 (
g
, 
v®ues
 >> 
CODELEN_SHIFT
); \

1807 
out_»suÉ
 = 
RET_GOT_CODE
; \

1808 
out_v®ue
 = 
v®ues
 & 
VALUE_MASK
; \

1810 } 0)

	)

1824 cÚ¡ 
USHORT
 
	gruns_¬¿y_Ë
[256] = {

1859 cÚ¡ 
USHORT
 
	gruns_¬¿y_be
[256] = {

1894 cÚ¡ 
USHORT
 *
	gruns_¬¿y
 = 
runs_¬¿y_Ë
;

1896 
	$š™RunA¼ay
() {

1897 
iTe¡
=1;

1898 *
pcTe¡
=((*)(&
iTe¡
));

1900 ià(*
pcTe¡
==1) {

1901 
runs_¬¿y
 = 
runs_¬¿y_Ë
;

1903 
runs_¬¿y
 = 
runs_¬¿y_be
;

1905 
	}
}

1919 
	$£t_run
 (

1920 
BYTE
 *
buf_p
,

1921 
¡¬t_pos
,

1922 
run_Ën
,

1923 
row_Ën
)

1941 
’d_pos
;

1942 
¡¬t_šdex
;

1943 
BYTE
 *
Ëá_p
;

1944 
BYTE
 *
right_p
;

1946 
’d_pos
 = 
¡¬t_pos
 + 
run_Ën
 - 1;

1948 ià(
’d_pos
 >ğ
row_Ën
)

1949 
’d_pos
 = 
row_Ën
 - 1;

1951 
¡¬t_šdex
 = 
¡¬t_pos
 >> 4;

1953 ià((
’d_pos
 >> 4è=ğ
¡¬t_šdex
) {

1955 ((
USHORT
*)
buf_p
)[
¡¬t_šdex
] |=

1956 
runs_¬¿y
 [((
¡¬t_pos
 & 15)<<4è| (
’d_pos
 & 15)];

1957 } ià(
’d_pos
 > 
¡¬t_pos
) {

1959 
Ëá_p
 = 
buf_p
 + (
¡¬t_pos
 >> 3);

1960 
right_p
 = 
buf_p
 + (
’d_pos
 >> 3);

1962 *
Ëá_p
 |ğ(
BYTE
 )0xFFu >> (
UINT
)Ğ
¡¬t_pos
 & 7u );

1963 *
right_p
 = (
BYTE
 )0xFFu << (
UINT
)(7u - (
’d_pos
 & 7u));

1964 
Ëá_p
++;

1966 
Ëá_p
 < 
right_p
)

1967 *
Ëá_p
++ = 0xFFu;

1969 
	}
}

1999 
	#DECODE_HIT_EOL
 0x4000u

	)

2000 
	#DECODE_HIT_FILL
 0x8000u

	)

2008 
	$decode_row_š™
 (
DEC_INST
 *
g
)

2010 
g
->
pix–_pos
 = 0;

2011 
g
->
wh™e
 = 0xFFu;

2012 
g
->
¡©e_2d
 = 
NORMAL_2D
;

2013 
g
->
a0
 = -1;

2014 
g
->
gÙ_bÏck
 = 
FALSE
;

2015 
	}
}

2024 
UINT
 
	$decode_row_1d
 (

2025 
DEC_INST
 *
g
,

2026 
BYTE
 *
pbP»vOutBuf
,

2027 
BYTE
 *
pbOutBuf
)

2029 
run_Ën
;

2030 
UINT
 
wh™e
;

2031 
pix–_pos
;

2032 
UINT
 
»suÉ
;

2033 
UINT
 
»t_v®
 = 0;

2034 
šdex_Ëngth
;

2035 cÚ¡ 
BYTE
 *
šdex_tbl_p
;

2036 cÚ¡ 
USHORT
 *
v®ue_tbl_p
;

2038 ià(
g
->
pix–_pos
 == 0) {

2039 
	`mem£t
 (
pbOutBuf
, 0, 
g
->
by‹s_š_row
);

2040 
g
->
»f_row_šv®id
 = 
TRUE
;

2043 
wh™e
 = (
UINT
)()(sigÃd )
g
->white;

2044 
pix–_pos
 = 
g
->pixel_pos;

2046 
TRUE
) {

2048 ià(
wh™e
) {

2049 
šdex_Ëngth
 = 
MAX_WHITE_CODELEN
;

2050 
šdex_tbl_p
 = 
çx_wh™e_huff_šdex
;

2051 
v®ue_tbl_p
 = 
çx_wh™e_huff
;

2053 
šdex_Ëngth
 = 
MAX_BLACK_CODELEN
;

2054 
šdex_tbl_p
 = 
çx_bÏck_huff_šdex
;

2055 
v®ue_tbl_p
 = 
çx_bÏck_huff
;

2058 
	`PARSE_CODE
 (
g
, 
šdex_Ëngth
, 
šdex_tbl_p
, 
v®ue_tbl_p
, 
»suÉ
, 
run_Ën
);

2059 
	`PRINT
 (
	`_T
("pø»suÉ=%d,†’=%d\n"), 
»suÉ
, 
run_Ën
);

2061 ià(
»suÉ
 =ğ
RET_GOT_CODE
) {

2063 ià(! 
wh™e
) {

2064 
	`£t_run
 (
pbOutBuf
, 
pix–_pos
, 
run_Ën
, 
g
->
row_Ën
);

2065 
g
->
gÙ_bÏck
 = 
TRUE
;

2068 
pix–_pos
 +ğ
run_Ën
;

2069 ià(
run_Ën
 <= 63)

2070 
wh™e
 = ~white;

2074 
»suÉ
) {

2076 
RET_NEED_MORE
:

2077 
»t_v®
 = 0;

2078 
ba_out
;

2081 
RET_BAD_CODE
:

2082 
	`memıy
 (
pbOutBuf
, 
pbP»vOutBuf
, 
g
->
by‹s_š_row
);

2083 
»t_v®
 = 
IP_PRODUCED_ROW
 | 
IP_INPUT_ERROR
;

2084 
ba_out
;

2087 
RET_FILL
:

2088 
RET_HIT_EOL
:

2089 
»t_v®
 = 
»suÉ
==
RET_FILL
 ? 
DECODE_HIT_FILL
 : 
DECODE_HIT_EOL
;

2090 ià(
pix–_pos
 == 0)

2091 
ba_out
;

2092 ià(
pix–_pos
 =ğ
g
->
row_Ën
) {

2093 
»t_v®
 |ğ
IP_PRODUCED_ROW
;

2094 
g
->
»f_row_šv®id
 = 
FALSE
;

2095 
ba_out
;

2097 
	`memıy
 (
pbOutBuf
, 
pbP»vOutBuf
, 
g
->
by‹s_š_row
);

2098 
»t_v®
 |ğ
IP_PRODUCED_ROW
 | 
IP_INPUT_ERROR
;

2099 
ba_out
;

2103 
	`as£¹
 (
FALSE
);

2107 
ba_out
:

2109 
g
->
wh™e
 = white;

2110 
g
->
pix–_pos
 =…ixel_pos;

2112  
»t_v®
;

2113 
	}
}

2122 
UINT
 
	$decode_row_2d
 (

2123 
DEC_INST
 *
g
,

2124 
BYTE
 *
pbP»vBuf
,

2125 
BYTE
 *
pbOutBuf
)

2127 
UINT
 
group4
;

2128 
iAùiÚ
;

2129 
UINT
 
wh™e
;

2130 
UINT
 
»suÉ
 = 0;

2131 
row_Ën
;

2132 
run_Ën
;

2133 
a0
, 
a1
;

2134 
b1
=0, 
b2
;

2135 
UINT
 
Ãed_b0
;

2136 
UINT
 
»t_v®
 = 0;

2138 
group4
 = (
g
->
šput_fÜm©
 =ğ
IP_FAX_MMR
);

2139 
row_Ën
 = 
g
->row_len;

2140 
wh™e
 = (
UINT
)()(sigÃd )
g
->white;

2141 
a0
 = 
g
->a0;

2143 ià(
a0
 < 0) {

2144 
	`mem£t
 (
pbOutBuf
, 0, 
g
->
by‹s_š_row
);

2145 
pbP»vBuf
[
g
->
by‹s_š_row
] = 0x55u;

2148 
TRUE
) {

2154 
Ãed_b0
 = 
TRUE
;

2156 
g
->
¡©e_2d
 =ğ
NORMAL_2D
) {

2158 ià(
a0
>=
row_Ën
 && 
group4
) {

2161 ià(
a0
 =ğ
row_Ën
è
»t_v®
 = 
IP_PRODUCED_ROW
;

2162 
»t_v®
 = 
IP_INPUT_ERROR
;

2163 
ba_out
;

2166 
	`PARSE_CODE
 (
g
, 
MAX_VERT_CODELEN
, 
çx_v”t_huff_šdex
,

2167 
çx_v”t_huff
, 
»suÉ
, 
iAùiÚ
);

2168 ià(
»suÉ
 !ğ
RET_GOT_CODE
)

2169 
unusu®_cÚd™iÚ
;

2171 ià(
iAùiÚ
 =ğ
HORIZ_MODE
) {

2172 
g
->
¡©e_2d
 = 
HORIZ_1ST
;

2176 ià(
a0
 < 0) {

2177 
a0
 = 0;

2178 
b1
 = -1;

2179 } ià(
Ãed_b0
)

2180 
b1
 = 
	`sÿn_to
 (
wh™e
, 
pbP»vBuf
, 
a0
, 
row_Ën
);

2182 
b1
 = 
	`sÿn_to
 (~
wh™e
, 
pbP»vBuf
, b1+1, 
row_Ën
);

2184 ià(
iAùiÚ
 <ğ
LAST_VERT
) {

2185 
iAùiÚ
 -= 3;

2186 
a1
 = 
b1
 + 
iAùiÚ
;

2187 
Ãed_b0
 = (
iAùiÚ
<-1 || iAction>0);

2188 ià(! 
wh™e
) {

2189 
	`£t_run
 (
pbOutBuf
, 
a0
, 
a1
-a0, 
row_Ën
);

2190 
g
->
gÙ_bÏck
 = 
TRUE
;

2192 ià(
a1
<
a0
 ||‡1>
row_Ën
è
cÜru±
;

2193 
a0
 = 
a1
;

2194 
wh™e
 = ~white;

2196 
b2
 = 
	`sÿn_to
 (
wh™e
, 
pbP»vBuf
, 
b1
+1, 
row_Ën
);

2197 ià(! 
wh™e
) {

2198 
	`£t_run
 (
pbOutBuf
, 
a0
, 
b2
-a0, 
row_Ën
);

2199 
g
->
gÙ_bÏck
 = 
TRUE
;

2201 
Ãed_b0
 = 
FALSE
;

2202 
a0
 = 
b2
;

2203 
b1
 = 
b2
;

2211 
TRUE
) {

2212 
šdex_Ëngth
;

2213 cÚ¡ 
BYTE
 *
šdex_tbl_p
;

2214 cÚ¡ 
USHORT
 *
v®ue_tbl_p
;

2217 ià(
wh™e
) {

2218 
šdex_Ëngth
 = 
MAX_WHITE_CODELEN
;

2219 
šdex_tbl_p
 = 
çx_wh™e_huff_šdex
;

2220 
v®ue_tbl_p
 = 
çx_wh™e_huff
;

2222 
šdex_Ëngth
 = 
MAX_BLACK_CODELEN
;

2223 
šdex_tbl_p
 = 
çx_bÏck_huff_šdex
;

2224 
v®ue_tbl_p
 = 
çx_bÏck_huff
;

2227 
	`PARSE_CODE
 (
g
, 
šdex_Ëngth
, 
šdex_tbl_p
, 
v®ue_tbl_p
,

2228 
»suÉ
, 
run_Ën
);

2230 ià(
»suÉ
 !ğ
RET_GOT_CODE
)

2231 
unusu®_cÚd™iÚ
;

2232 ià(
a0
 < 0)

2233 
a0
 = 0;

2235 ià(! 
wh™e
) {

2236 
	`£t_run
 (
pbOutBuf
, 
a0
, 
run_Ën
, 
row_Ën
);

2237 
g
->
gÙ_bÏck
 = 
TRUE
;

2239 
a0
 +ğ
run_Ën
;

2240 } 
run_Ën
 > 63);

2242 
wh™e
 = ~white;

2243 ià(
g
->
¡©e_2d
 =ğ
HORIZ_1ST
)

2244 
g
->
¡©e_2d
 = 
HORIZ_2ND
;

2246 
g
->
¡©e_2d
 = 
NORMAL_2D
;

2247 ià(
a0
 > 
row_Ën
è
cÜru±
;

2258 
cÜru±
:

2259 
»suÉ
 = 
RET_BAD_CODE
;

2261 
unusu®_cÚd™iÚ
:

2263 
»suÉ
) {

2265 
RET_GOT_CODE
:

2269 
RET_NEED_MORE
:

2270 
»t_v®
 = 0;

2271 
ba_out
;

2274 
RET_BAD_CODE
:

2275 
g
->
¡©e_2d
 = 
NORMAL_2D
;

2276 
	`memıy
 (
pbOutBuf
, 
pbP»vBuf
, 
g
->
by‹s_š_row
);

2277 
»t_v®
 = 
IP_PRODUCED_ROW
 | 
IP_INPUT_ERROR
;

2278 
g
->
»f_row_šv®id
 = 
TRUE
;

2279 
ba_out
;

2282 
RET_FILL
:

2283 
RET_HIT_EOL
:

2284 
»t_v®
 = 
»suÉ
==
RET_FILL
 ? 
DECODE_HIT_FILL
 : 
DECODE_HIT_EOL
;

2285 
g
->
¡©e_2d
 = 
NORMAL_2D
;

2287 ià(
group4
) {

2290 ià(
a0
 >= 0)

2291 
»t_v®
 |ğ
IP_INPUT_ERROR
;

2293 ià(!
g
->
»f_row_šv®id
 && 
a0
==
row_Ën
)

2294 
»t_v®
 |ğ
IP_PRODUCED_ROW
;

2295 ià(
a0
 >= 0) {

2296 
	`memıy
 (
pbOutBuf
, 
pbP»vBuf
, 
g
->
by‹s_š_row
);

2297 
»t_v®
 |ğ
IP_PRODUCED_ROW
 | 
IP_INPUT_ERROR
;

2298 
g
->
»f_row_šv®id
 = 
TRUE
;

2301 
ba_out
;

2305 
	`as£¹
 (
FALSE
);

2310 
ba_out
:

2313 
g
->
a0
 =‡0;

2314 
g
->
wh™e
 = white;

2316  
»t_v®
;

2317 
	}
}

2334 
WORD
 
	$çxDecode_İ’XfÜm
 (

2335 
IP_XFORM_HANDLE
 *
pXfÜm
)

2337 
PDEC_INST
 
g
;

2339 
	`š™RunA¼ay
();

2340 
	`INSURE
 (
pXfÜm
 !ğ
NULL
);

2341 
	`IP_MEM_ALLOC
 ((
DEC_INST
), 
g
);

2342 *
pXfÜm
 = 
g
;

2343 
	`mem£t
 (
g
, 0, (
DEC_INST
));

2344 
g
->
dwV®idChk
 = 
CHECK_VALUE
;

2346 
	`b™s_š™
 (
g
);

2347 
	`decode_row_š™
 (
g
);

2348  
IP_DONE
;

2350 
çl_”rÜ
:

2351  
IP_FATAL_ERROR
;

2352 
	}
}

2371 
WORD
 
	$çxDecode_£tDeçuÉIÅutT¿™s
 (

2372 
IP_XFORM_HANDLE
 
hXfÜm
,

2373 
PIP_IMAGE_TRAITS
 
pT¿™s
)

2375 
PDEC_INST
 
g
;

2377 
	`HANDLE_TO_PTR
 (
hXfÜm
, 
g
);

2380 
	`INSURE
 (
pT¿™s
->
iPix–sP”Row
 > 0);

2381 
	`INSURE
 (
pT¿™s
->
iB™sP”Pix–
 == 1);

2383 
g
->
Œa™s
 = *
pT¿™s
;

2385  
IP_DONE
;

2387 
çl_”rÜ
:

2388  
IP_FATAL_ERROR
;

2389 
	}
}

2399 
WORD
 
	$çxDecode_£tXfÜmS³c
 (

2400 
IP_XFORM_HANDLE
 
hXfÜm
,

2401 
DWORD_OR_PVOID
 
aXfÜmInfo
[])

2403 
PDEC_INST
 
g
;

2405 
	`HANDLE_TO_PTR
 (
hXfÜm
, 
g
);

2406 
g
->
šput_fÜm©
 = (
BYTE
)
aXfÜmInfo
[
IP_FAX_FORMAT
].
dwÜd
;

2407 
g
->
no_eŞs
 = (
BOOL
)
aXfÜmInfo
[
IP_FAX_NO_EOLS
].
dwÜd
;

2408  
IP_DONE
;

2410 
çl_”rÜ
:

2411  
IP_FATAL_ERROR
;

2412 
	}
}

2422 
WORD
 
	$çxDecode_g‘H—d”BufSize
 (

2423 
IP_XFORM_HANDLE
 
hXfÜm
,

2424 
DWORD
 *
pdwInBufL’
)

2427 *
pdwInBufL’
 = 0;

2428  
IP_DONE
;

2429 
	}
}

2443 
WORD
 
	$çxDecode_g‘Aùu®T¿™s
 (

2444 
IP_XFORM_HANDLE
 
hXfÜm
,

2445 
DWORD
 
dwIÅutAva
,

2446 
PBYTE
 
pbIÅutBuf
,

2447 
PDWORD
 
pdwIÅutU£d
,

2448 
PDWORD
 
pdwIÅutNextPos
,

2449 
PIP_IMAGE_TRAITS
 
pInT¿™s
,

2450 
PIP_IMAGE_TRAITS
 
pOutT¿™s
)

2452 
PDEC_INST
 
g
;

2453 
šBy‹s
;

2455 
	`HANDLE_TO_PTR
 (
hXfÜm
, 
g
);

2459 *
pdwIÅutU£d
 = 0;

2460 *
pdwIÅutNextPos
 = 0;

2464 *
pInT¿™s
 = 
g
->
Œa™s
;

2465 *
pOutT¿™s
 = 
g
->
Œa™s
;

2469 
g
->
row_Ën
 = g->
Œa™s
.
iPix–sP”Row
;

2470 
g
->
by‹s_š_row
 = 
šBy‹s
 = (g->
row_Ën
+7) / 8;

2471 
g
->
two_dim
 = (g->
šput_fÜm©
 =ğ
IP_FAX_MMR
);

2474 
g
->
æushšg_to_eŞ
 = ! g->
two_dim
;

2478 ià(
g
->
´iÜ_p
 !ğ
NULL
)

2479 
	`IP_MEM_FREE
 (
g
->
´iÜ_p
);

2480 
	`IP_MEM_ALLOC
 (
šBy‹s
, 
g
->
´iÜ_p
);

2481 
	`mem£t
 (
g
->
´iÜ_p
, 0, 
šBy‹s
);

2483  
IP_DONE
 | 
IP_READY_FOR_DATA
;

2485 
çl_”rÜ
:

2486  
IP_FATAL_ERROR
;

2487 
	}
}

2497 
WORD
 
	$çxDecode_g‘Aùu®BufSizes
 (

2498 
IP_XFORM_HANDLE
 
hXfÜm
,

2499 
PDWORD
 
pdwMšInBufL’
,

2500 
PDWORD
 
pdwMšOutBufL’
)

2502 
PDEC_INST
 
g
;

2504 
	`HANDLE_TO_PTR
 (
hXfÜm
, 
g
);

2505 *
pdwMšInBufL’
 = 1;

2506 *
pdwMšOutBufL’
 = 
g
->
by‹s_š_row
;

2507  
IP_DONE
;

2509 
çl_”rÜ
:

2510  
IP_FATAL_ERROR
;

2511 
	}
}

2521 
WORD
 
	$çxDecode_cÚv”t
 (

2522 
IP_XFORM_HANDLE
 
hXfÜm
,

2523 
DWORD
 
dwIÅutAva
,

2524 
PBYTE
 
pbIÅutBuf
,

2525 
PDWORD
 
pdwIÅutU£d
,

2526 
PDWORD
 
pdwIÅutNextPos
,

2527 
DWORD
 
dwOuutAva
,

2528 
PBYTE
 
pbOuutBuf
,

2529 
PDWORD
 
pdwOuutU£d
,

2530 
PDWORD
 
pdwOuutThisPos
)

2532 
PDEC_INST
 
g
;

2533 
UINT
 
b™
;

2534 
UINT
 
»t_v®
;

2536 
	`HANDLE_TO_PTR
 (
hXfÜm
, 
g
);

2538 *
pdwOuutU£d
 = 0;

2540 ià(
dwIÅutAva
==0 && 
	`BITS_IN_CACHE
(
g
)<
MAX_CODE_LEN
) {

2543 *
pdwIÅutU£d
 = 0;

2544 *
pdwIÅutNextPos
 = 
g
->
dwInNextPos
;

2545 *
pdwOuutThisPos
 = 
g
->
dwOutNextPos
;

2546  
IP_DONE
;

2549 ià(
g
->
toss_ev”ythšg
) {

2550 *
pdwIÅutU£d
 = 
dwIÅutAva
;

2551 *
pdwIÅutNextPos
 = 
g
->
dwInNextPos
 = g->dwInNextPo + 
dwIÅutAva
;

2552 *
pdwOuutThisPos
 = 
g
->
dwOutNextPos
;

2553  
IP_READY_FOR_DATA
;

2556 
	`b™s_buf_İ’
 (
g
, 
pbIÅutBuf
, 
dwIÅutAva
);

2558 ià(
g
->
æushšg_to_eŞ
) {

2559 
»t_v®
 = 
	`b™s_æush_to_eŞ
(
g
, g->
gÙ_fl
,

2560 (
BOOL
)(
g
->
šput_fÜm©
==
IP_FAX_MR
))

2561 ? 
DECODE_HIT_EOL
 : 0;

2563 ià(
g
->
two_dim
è
»t_v®
 = 
	`decode_row_2d
(g, g->
´iÜ_p
, 
pbOuutBuf
);

2564 
»t_v®
 = 
	`decode_row_1d
(
g
, g->
´iÜ_p
, 
pbOuutBuf
);

2565 
	`PRINT
 (
	`_T
("decod”„‘uºed %x\n"), 
»t_v®
, 0);

2568 ià(
»t_v®
 & 
IP_INPUT_ERROR
) {

2569 ià(
g
->
šput_fÜm©
 =ğ
IP_FAX_MMR
) {

2570 
	`b™s_æush
 (
g
);

2571 
g
->
toss_ev”ythšg
 = 
TRUE
;

2575 
g
->
æushšg_to_eŞ
 = 
TRUE
;

2576 
g
->
num_eŞs
 = 0;

2580 ià(
»t_v®
 & 
IP_PRODUCED_ROW
) {

2581 ià(
g
->
gÙ_bÏck
è
»t_v®
 |ğ
NONWHITE_ROW
 | 
IP_CONSUMED_ROW
;

2582 
»t_v®
 |ğ
WHITE_ROW
 | 
IP_CONSUMED_ROW
;

2583 *
pdwOuutU£d
 = 
g
->
by‹s_š_row
;

2584 
	`memıy
 (
g
->
´iÜ_p
, 
pbOuutBuf
, g->
by‹s_š_row
);

2585 
	`decode_row_š™
 (
g
);

2586 
g
->
num_eŞs
 = 0;

2589 ià(
»t_v®
 & 
DECODE_HIT_FILL
) {

2590 
g
->
æushšg_to_eŞ
 = 
TRUE
;

2591 
g
->
gÙ_fl
 = 
TRUE
;

2594 ià(
»t_v®
 & 
DECODE_HIT_EOL
) {

2595 ià(
g
->
šput_fÜm©
 =ğ
IP_FAX_MR
) {

2597 
	`BITS_LOAD
 (
g
, 1, 
b™
)

2598 
g
->
two_dim
 = (
b™
 == 0);

2599 
	`BITS_ADVANCE
 (
g
, 1)

2602 
	`decode_row_š™
 (
g
);

2603 
g
->
æushšg_to_eŞ
 = 
FALSE
;

2604 
g
->
gÙ_fl
 = 
FALSE
;

2605 
g
->
num_eŞs
 += 1;

2607 ià(
g
->
num_eŞs
>=
EOLS_FOR_MH_MR
 ||

2608 (
g
->
šput_fÜm©
==
IP_FAX_MMR
 && g->
num_eŞs
>=
EOLS_FOR_MMR
)) {

2610 
g
->
num_eŞs
 = 0;

2611 
	`b™s_æush
 (
g
);

2612 
»t_v®
 |ğ
IP_NEW_OUTPUT_PAGE
;

2616 *
pdwIÅutU£d
 = 
	`b™s_buf_şo£
 (
g
);

2617 
g
->
dwInNextPos
 +ğ*
pdwIÅutU£d
;

2618 *
pdwIÅutNextPos
 = 
g
->
dwInNextPos
;

2620 *
pdwOuutU£d
 = (
»t_v®
 & 
IP_PRODUCED_ROW
è? 
g
->
by‹s_š_row
 : 0;

2621 *
pdwOuutThisPos
 = 
g
->
dwOutNextPos
;

2622 
g
->
dwOutNextPos
 +ğ*
pdwOuutU£d
;

2626 
i
;

2627 
i
=0; i<*
pdwIÅutU£d
; i++)

2628 
	`PRINT
 (
	`_T
("%02x "), 
pbIÅutBuf
[
i
], 0);

2632  (
»t_v®
 | 
IP_READY_FOR_DATA
)

2633 & (
IP_CONSUMED_ROW
 | 
IP_PRODUCED_ROW
 | 
IP_READY_FOR_DATA
 |

2635 
IP_NEW_OUTPUT_PAGE
 |

2636 
IP_INPUT_ERROR
 | 
IP_FATAL_ERROR
);

2638 
çl_”rÜ
:

2639  
IP_FATAL_ERROR
;

2640 
	}
}

2650 
WORD
 
	$çxDecode_š£¹edD©a
 (

2651 
IP_XFORM_HANDLE
 
hXfÜm
,

2652 
DWORD
 
dwNumBy‹s
)

2654 
	`çlB»akPošt
 ();

2655  
IP_FATAL_ERROR
;

2656 
	}
}

2666 
WORD
 
	$çxDecode_ÃwPage
 (

2667 
IP_XFORM_HANDLE
 
hXfÜm
)

2669 
PDEC_INST
 
g
;

2671 
	`HANDLE_TO_PTR
 (
hXfÜm
, 
g
);

2673  
IP_DONE
;

2675 
çl_”rÜ
:

2676  
IP_FATAL_ERROR
;

2678 
	}
}

2688 
WORD
 
	$çxDecode_şo£XfÜm
 (
IP_XFORM_HANDLE
 
hXfÜm
)

2690 
PDEC_INST
 
g
;

2692 
	`HANDLE_TO_PTR
 (
hXfÜm
, 
g
);

2694 ià(
g
->
´iÜ_p
 !ğ
NULL
)

2695 
	`IP_MEM_FREE
 (
g
->
´iÜ_p
);

2697 
g
->
dwV®idChk
 = 0;

2698 
	`IP_MEM_FREE
 (
g
);

2699  
IP_DONE
;

2701 
çl_”rÜ
:

2702  
IP_FATAL_ERROR
;

2703 
	}
}

2713 
IP_XFORM_TBL
 
	gçxDecodeTbl
 = {

2714 
çxDecode_İ’XfÜm
,

2715 
çxDecode_£tDeçuÉIÅutT¿™s
,

2716 
çxDecode_£tXfÜmS³c
,

2717 
çxDecode_g‘H—d”BufSize
,

2718 
çxDecode_g‘Aùu®T¿™s
,

2719 
çxDecode_g‘Aùu®BufSizes
,

2720 
çxDecode_cÚv”t
,

2721 
çxDecode_ÃwPage
,

2722 
çxDecode_š£¹edD©a
,

2723 
çxDecode_şo£XfÜm


2739 cÚ¡ 
USHORT
 
	gçx_wh™e_huff
[105] = { 0,

2756 cÚ¡ 
BYTE
 
	gçx_wh™e_huff_šdex
[4096] = {

3016 cÚ¡ 
USHORT
 
	gçx_bÏck_huff
[105] = { 0,

3033 cÚ¡ 
BYTE
 
	gçx_bÏck_huff_šdex
[8192] = {

3549 cÚ¡ 
USHORT
 
	gçx_v”t_huff
[10] = { 0,

3555 cÚ¡ 
BYTE
 
	gçx_v”t_huff_šdex
[128] = {

	@ip/xform.h

42 #ià! 
defšed
 
XFORM_H_INC


43 
	#XFORM_H_INC


	)

108 * 
	tIP_XFORM_HANDLE
;

113 
	sIP_XFORM_TBL_s
 {

122 
WORD
 (*
İ’XfÜm
) (

123 
IP_XFORM_HANDLE
 *
	mpXfÜm
);

135 
WORD
 (*
£tDeçuÉIÅutT¿™s
) (

136 
IP_XFORM_HANDLE
 
	mhXfÜm
,

137 
PIP_IMAGE_TRAITS
 
	mpT¿™s
);

153 
WORD
 (*
£tXfÜmS³c
) (

154 
IP_XFORM_HANDLE
 
	mhXfÜm
,

155 
DWORD_OR_PVOID
 
	maXfÜmInfo
[]);

167 
WORD
 (*
g‘H—d”BufSize
) (

168 
IP_XFORM_HANDLE
 
	mhXfÜm
,

169 
DWORD
 *
	mpdwInBufL’
);

196 
WORD
 (*
g‘Aùu®T¿™s
) (

197 
IP_XFORM_HANDLE
 
	mhXfÜm
,

198 
DWORD
 
	mdwIÅutAva
,

199 
PBYTE
 
	mpbIÅutBuf
,

200 
PDWORD
 
	mpdwIÅutU£d
,

201 
PDWORD
 
	mpdwIÅutNextPos
,

202 
PIP_IMAGE_TRAITS
 
	mpInT¿™s
,

203 
PIP_IMAGE_TRAITS
 
	mpOutT¿™s
);

214 
WORD
 (*
g‘Aùu®BufSizes
) (

215 
IP_XFORM_HANDLE
 
	mhXfÜm
,

216 
PDWORD
 
	mpwMšInBufL’
,

217 
PDWORD
 
	mpwMšOutBufL’
);

292 
WORD
 (*
cÚv”t
) (

293 
IP_XFORM_HANDLE
 
	mhXfÜm
,

294 
DWORD
 
	mdwIÅutAva
,

295 
PBYTE
 
	mpbIÅutBuf
,

296 
PDWORD
 
	mpdwIÅutU£d
,

297 
PDWORD
 
	mpdwIÅutNextPos
,

298 
DWORD
 
	mdwOuutAva
,

299 
PBYTE
 
	mpbOuutBuf
,

300 
PDWORD
 
	mpdwOuutU£d
,

301 
PDWORD
 
	mpdwOuutThisPos
);

314 
WORD
 (*
ÃwPage
è(
IP_XFORM_HANDLE
 
	mhXfÜm
);

324 
WORD
 (*
š£¹edD©a
) (

325 
IP_XFORM_HANDLE
 
	mhXfÜm
,

326 
DWORD
 
	mdwNumBy‹s
);

336 
WORD
 (*
şo£XfÜm
)(
IP_XFORM_HANDLE
 
	mhXfÜm
);

338 } 
	tIP_XFORM_TBL
, *
	tPIP_XFORM_TBL
, 
	tFAR
*
	tLPIP_XFORM_TBL
;

	@ip/xgamma.c

77 
	~"hp.h
"

78 
	~"defs.h
"

79 
	~"¡ršg.h
"

83 
	~"¡dio.h
"

84 
	#PRINT
(
msg
,
¬g1
,
¬g2
) \

85 
	`årštf
(
¡d”r
, 
msg
, ()
¬g1
, ()
¬g2
)

	)

87 
	#PRINT
(
msg
,
¬g1
,
¬g2
)

	)

90 
	#CHECK_VALUE
 0x4ba1daû

	)

94 
IP_IMAGE_TRAITS
 
	mŒa™s
;

95 
BYTE
 
	mgammaTabË
[256];

96 
WORD
 
	mwRowsDÚe
;

97 
DWORD
 
	mdwInNextPos
;

98 
DWORD
 
	mdwOutNextPos
;

99 
DWORD
 
	mdwV®idChk
;

100 } 
	tGAM_INST
, *
	tPGAM_INST
;

118 
	$ç¡_sš
 (
ULONG
 
ªg
)

120 
ULONG
 
ªg31
, 
ªg30
, 
d–_ªg
, 
»suÉ
;

121 
UINT
 
šdex
, 
ba£
, 
Ãxt
;

124 
	#INDEX_BITS
 6

	)

125 
	#N_INTERVALS
 (1<<
INDEX_BITS
)

	)

126 
	#HALF_WORST_ERR
 3

	)

128 cÚ¡ 
USHORT
 
sš_bË
[
N_INTERVALS
+2] = {

141 
ªg31
 = (
ªg
 << 1) >> 1;

144 
ªg30
 = 
ªg31
;

145 ià(
ªg30
 >= 0x40000000u)

146 
ªg30
 = 0x80000000u -‡ng30;

148 
šdex
 = 
ªg30
 >> (30-
INDEX_BITS
);

149 
ba£
 = 
sš_bË
 [
šdex
];

150 
Ãxt
 = 
sš_bË
 [
šdex
+1];

151 
d–_ªg
 = 
ªg30
>>(14-
INDEX_BITS
) & 0x0000ffffu;

152 
»suÉ
 = ((
Ãxt
-
ba£
)*
d–_ªg
 >> 16è+ ba£ + 
HALF_WORST_ERR
;

155 ià(()
ªg
 < 0)

156 
»suÉ
 = (
ULONG
)(-()result);

158  ()
»suÉ
;

160 #undeà
INDEX_BITS


161 #undeà
N_INTERVALS


162 #undeà
HALF_WORST_ERR


163 
	}
}

166 
	$ç¡_cos
 (
UINT
 
ªg
)

168  
	`ç¡_sš
(0x40000000u-
ªg
);

169 
	}
}

174 
	~<¡dio.h
>

175 
	~<m©h.h
>

177 
	$maš
 ()

179 
i
;

180 
”r
, 
max_”r
;

182 
max_”r
 = 0.0;

184 
i
=0; i<=16*65536; i++) {

185 
”r
 = 
	`sš
 (()
i
 * (2.0*3.1415926535897932384626/(16*65536.0)))

186 - 
	`ç¡_sš
(
i
<<12)/65536.0;

187 ià(
”r
 < 0)ƒrr = -err;

188 ià(
”r
 > 
max_”r
) max_err =ƒrr;

191 
	`´štf
 ("maxƒ¼ = %f\n", 
max_”r
);

192 
	}
}

199 
	~<¡dio.h
>

200 
	~<m©h.h
>

202 
	$maš
 ()

204 
i
;

205 
s
;

207 
i
=0; i<=64; i++) {

208 
s
 = 
	`sš
 (()
i
 * (3.1415926535897932384626/(2.0*64.0)));

209 
	`´štf
 ("%5d, ", ()(
s
*(1<<16) + 0.5));

210 ià(
i
%8 =ğ7è
	`puts
("");

212 
	}
}

219 
	ma
, 
	mb
, 
	mc
;

220 
	md
, 
	me
, 
	mf
;

221 } 
	tcubic_t
;

234 
	$ÿlc_cubic_cÛffs
 (

235 
ULONG
 
¡¬t_ªg
,

236 
ULONG
 
fš®_ªg
,

237 
¡¬t_v–
,

238 
fš®_v–
,

239 
cubic_t
 *
p
)

241 
¡¬t_x
, 
¡¬t_y
, 
fš®_x
, 
fš®_y
;

246 
¡¬t_v–
 = (¡¬t_v–<<11è/ ((1lu<<14è+ (
	`ç¡_cos
(
¡¬t_ªg
)>>2));

247 
fš®_v–
 = (fš®_v–<<11è/ ((1lu<<14è+ (
	`ç¡_cos
(
fš®_ªg
)>>2));

252 
¡¬t_x
 = 
¡¬t_v–
*(
	`ç¡_cos
(
¡¬t_ªg
)>>2) >> 10;

253 
¡¬t_y
 = 
¡¬t_v–
*(
	`ç¡_sš
(
¡¬t_ªg
)>>2) >> 10;

254 
fš®_x
 = 
fš®_v–
*(
	`ç¡_cos
(
fš®_ªg
)>>2) >> 10;

255 
fš®_y
 = 
fš®_v–
*(
	`ç¡_sš
(
fš®_ªg
)>>2) >> 10;

257 
p
->
a
 = 
¡¬t_x
;

258 
p
->
d
 = 
¡¬t_y
;

259 
p
->
b
 = (3<<16è- 2*
¡¬t_x
 - 
fš®_x
;

260 
p
->
e
 = -2*
¡¬t_y
 - 
fš®_y
;

261 
p
->
c
 = 
¡¬t_x
 + 
fš®_x
 - (2<<16);

262 
p
->
f
 = 
¡¬t_y
 + 
fš®_y
;

263 
	}
}

272 
	$ŒªsfÜm_cubic
 (

273 
x_’d
,

274 
y_’d
,

275 
cubic_t
 *
p
)

277 
cubic_t
 
q
;

279 
q
.
a
 = 
p
->a*
x_’d
 -…->
d
*
y_’d
;

280 
q
.
b
 = 
p
->b*
x_’d
 -…->
e
*
y_’d
;

281 
q
.
c
 = 
p
->c*
x_’d
 -…->
f
*
y_’d
;

283 
q
.
d
 = 
p
->
a
*
y_’d
 +…->d*
x_’d
;

284 
q
.
e
 = 
p
->
b
*
y_’d
 +…->e*
x_’d
;

285 
q
.
f
 = 
p
->
c
*
y_’d
 +…->f*
x_’d
;

287 *
p
 = 
q
;

288 
	}
}

297 
	$ÿlc_gamma_äom_cÛffs
 (

298 
cubic_t
 *
p
,

299 
BYTE
 
tbl
[])

301 
	#LG_N_INTERVALS
 7

	)

302 
	#N_INTERVALS
 (1u<<
LG_N_INTERVALS
)

	)

303 
	#RND_PROD
(
p
è((Õè+ ((1<<
LG_N_INTERVALS
)-1)è>> LG_N_INTERVALS)

	)

305 
t
, 
x
, 
y
, 
x´ev
=0, 
y´ev
=0, 
xtmp
, 
ytmp
;

307 
t
=0;<=
N_INTERVALS
;+=1) {

308 
x
 = (((
	`RND_PROD
((RND_PROD(
p
->
c
*
t
è+…->
b
)*tè+…->
a
)*t

309 >> (
LG_N_INTERVALS
+15)) + 1) >> 1;

310 
y
 = (((
	`RND_PROD
((RND_PROD(
p
->
f
*
t
è+…->
e
)*tè+…->
d
)*t

311 >> (
LG_N_INTERVALS
+15)) + 1) >> 1;

313 ià(
t
==0 || 
x
!=
x´ev
è
tbl
[x] = 
y
;

315 ià(
t
 > 0) {

316 
xtmp
 = 
x´ev
 + 1;

317 
ytmp
 = (
y´ev
+
y
) / 2;

318 
xtmp
 < 
x
)

319 
tbl
[
xtmp
++] = 
ytmp
;

322 
x´ev
 = 
x
; 
y´ev
 = 
y
;

324 
	}
}

333 
	$ÿlc_gamma_bË
 (

334 
gamma
,

335 
BYTE
 
tbl
[])

337 
	#FLOAT_TO_FIX
(
f
è(()((f)*0x1000 + 0.5)è

	)

338 
	#FLOAT_TO_ANG
(
f
è((
USHORT
)()((f)*0x10000/360.0 + 0.5))

	)

340 
	#MIN_INDEX
 0

	)

341 
	#MAX_INDEX
 6

	)

344 
¡¬t_v–_ba£
; 
¡¬t_v–_¦İe
;

345 
USHORT
 
¡¬t_ªg_ba£
; 
¡¬t_ªg_¦İe
;

346 
fš®_v–_ba£
; 
fš®_v–_¦İe
;

347 
USHORT
 
fš®_ªg_ba£
; 
fš®_ªg_¦İe
;

348 } 
	t¥ec_t
;

350 cÚ¡ 
¥ec_t
 
¥ecs
[
MAX_INDEX
-
MIN_INDEX
+1] = {

352 
	`FLOAT_TO_FIX
(1.0), FLOAT_TO_FIX(0.0),

353 
	`FLOAT_TO_ANG
(0.0), 
	`FLOAT_TO_FIX
(0.0),

354 
	`FLOAT_TO_FIX
(1.0), FLOAT_TO_FIX(0.0),

355 
	`FLOAT_TO_ANG
(0.0), 
	`FLOAT_TO_FIX
(0.0),

358 
	`FLOAT_TO_FIX
(0.05), FLOAT_TO_FIX(0.5),

359 
	`FLOAT_TO_ANG
(-75.0), 
	`FLOAT_TO_FIX
(150.0/360.0),

360 
	`FLOAT_TO_FIX
(2.0), FLOAT_TO_FIX(0.0),

361 
	`FLOAT_TO_ANG
(15.0), 
	`FLOAT_TO_FIX
(-30.0/360.0),

364 
	`FLOAT_TO_FIX
(0.3), FLOAT_TO_FIX(0.2),

365 
	`FLOAT_TO_ANG
(0.0), 
	`FLOAT_TO_FIX
(60.0/360.0),

366 
	`FLOAT_TO_FIX
(2.0), FLOAT_TO_FIX(0.0),

367 
	`FLOAT_TO_ANG
(0.0), 
	`FLOAT_TO_FIX
(-20.0/360.0),

370 
	`FLOAT_TO_FIX
(0.4), FLOAT_TO_FIX(0.2),

371 
	`FLOAT_TO_ANG
(30.0), 
	`FLOAT_TO_FIX
(20.0/360.0),

372 
	`FLOAT_TO_FIX
(2.0), FLOAT_TO_FIX(0.0),

373 
	`FLOAT_TO_ANG
(-10.0), 
	`FLOAT_TO_FIX
(-16.0/360.0),

376 
	`FLOAT_TO_FIX
(0.5), FLOAT_TO_FIX(0.3),

377 
	`FLOAT_TO_ANG
(40.0), 
	`FLOAT_TO_FIX
(4.0/360.0),

378 
	`FLOAT_TO_FIX
(2.0), FLOAT_TO_FIX(0.0),

379 
	`FLOAT_TO_ANG
(-18.0), 
	`FLOAT_TO_FIX
(-8.0/360.0),

382 
	`FLOAT_TO_FIX
(0.65), FLOAT_TO_FIX(0.4),

383 
	`FLOAT_TO_ANG
(42.0), 
	`FLOAT_TO_FIX
(4.0/360.0),

384 
	`FLOAT_TO_FIX
(2.0), FLOAT_TO_FIX(0.0),

385 
	`FLOAT_TO_ANG
(-22.0), 
	`FLOAT_TO_FIX
(-6.0/360.0),

388 
	`FLOAT_TO_FIX
(0.85), FLOAT_TO_FIX(0.5),

389 
	`FLOAT_TO_ANG
(44.0), 
	`FLOAT_TO_FIX
(1.0/360.0),

390 
	`FLOAT_TO_FIX
(2.0), FLOAT_TO_FIX(0.0),

391 
	`FLOAT_TO_ANG
(-25.0), 
	`FLOAT_TO_FIX
(-4.0/360.0),

395 
	#BEGIN_BLACKS
 0

	)

396 
	#END_WHITES
 4

	)

398 cÚ¡ 
¥ec_t
 *
p
;

399 
¡¬t_v–
, 
fš®_v–
;

400 
ULONG
 
¡¬t_ªg
, 
fš®_ªg
;

401 
cubic_t
 
cubic
;

402 
i
;

404 
i
 = 
gamma
 >> 7;

405 ià(
i
 > 
MAX_INDEX
) i = MAX_INDEX;

406 
p
 = &
¥ecs
[
i
-
MIN_INDEX
];

407 
gamma
 -ğ
i
 << 7;

409 
¡¬t_v–
 = (()
p
->
¡¬t_v–_ba£
 << 4)

410 + (
p
->
¡¬t_v–_¦İe
*
gamma
 >> 4);

411 
fš®_v–
 = (()
p
->
fš®_v–_ba£
 << 4)

412 + (
p
->
fš®_v–_¦İe
*
gamma
 >> 4);

413 
¡¬t_ªg
 = (()
p
->
¡¬t_ªg_ba£
 << 16)

414 + (
p
->
¡¬t_ªg_¦İe
*
gamma
 << 12);

415 
fš®_ªg
 = (()
p
->
fš®_ªg_ba£
 << 16)

416 + (
p
->
fš®_ªg_¦İe
*
gamma
 << 12);

418 
	`ÿlc_cubic_cÛffs
 (
¡¬t_ªg
, 
fš®_ªg
, 
¡¬t_v–
, 
fš®_v–
, &
cubic
);

419 
	`ŒªsfÜm_cubic
 (255-
BEGIN_BLACKS
-
END_WHITES
, 254, &
cubic
);

420 
	`ÿlc_gamma_äom_cÛffs
 (&
cubic
, 
tbl
);

422 
	`memmove
 (&
tbl
[
BEGIN_BLACKS
], &tbl[0], (256-BEGIN_BLACKS)*(
BYTE
));

423 
tbl
[0] = 0;

424 
i
=0; i<
BEGIN_BLACKS
; i++)

425 
tbl
[
i
] = 0;

427 
i
=256-
END_WHITES
; i<=255; i++)

428 
tbl
[
i
] = 255;

429 
	}
}

447 
WORD
 
	$gamma_İ’XfÜm
 (

448 
IP_XFORM_HANDLE
 *
pXfÜm
)

450 
PGAM_INST
 
g
;

452 
	`INSURE
 (
pXfÜm
 !ğ
NULL
);

453 
	`IP_MEM_ALLOC
 ((
GAM_INST
), 
g
);

454 *
pXfÜm
 = 
g
;

455 
	`mem£t
 (
g
, 0, (
GAM_INST
));

456 
g
->
dwV®idChk
 = 
CHECK_VALUE
;

457  
IP_DONE
;

459 
çl_”rÜ
:

460  
IP_FATAL_ERROR
;

461 
	}
}

480 
WORD
 
	$gamma_£tDeçuÉIÅutT¿™s
 (

481 
IP_XFORM_HANDLE
 
hXfÜm
,

482 
PIP_IMAGE_TRAITS
 
pT¿™s
)

484 
PGAM_INST
 
g
;

486 
	`HANDLE_TO_PTR
 (
hXfÜm
, 
g
);

489 
	`INSURE
 (
pT¿™s
->
iB™sP”Pix–
 == 8);

490 
	`INSURE
 (
pT¿™s
->
iCompÚ’tsP”Pix–
 == 1);

491 
	`INSURE
 (
pT¿™s
->
iPix–sP”Row
 > 0);

493 
g
->
Œa™s
 = *
pT¿™s
;

494  
IP_DONE
;

496 
çl_”rÜ
:

497  
IP_FATAL_ERROR
;

498 
	}
}

508 
WORD
 
	$gamma_£tXfÜmS³c
 (

509 
IP_XFORM_HANDLE
 
hXfÜm
,

510 
DWORD_OR_PVOID
 
aXfÜmInfo
[])

512 
PGAM_INST
 
g
;

513 
DWORD
 
gamma
;

515 
	`HANDLE_TO_PTR
 (
hXfÜm
, 
g
);

516 
gamma
 = 
aXfÜmInfo
[0].
dwÜd
;

517 
	`INSURE
 (
gamma
 <= 0x38000u);

519 
	`ÿlc_gamma_bË
 ((
gamma
+0x0080u)>>8, 
g
->
gammaTabË
);

522  
IP_DONE
;

524 
çl_”rÜ
:

525  
IP_FATAL_ERROR
;

526 
	}
}

536 
WORD
 
	$gamma_g‘H—d”BufSize
 (

537 
IP_XFORM_HANDLE
 
hXfÜm
,

538 
DWORD
 *
pwInBufL’
)

541 *
pwInBufL’
 = 0;

542  
IP_DONE
;

543 
	}
}

553 
WORD
 
	$gamma_g‘Aùu®T¿™s
 (

554 
IP_XFORM_HANDLE
 
hXfÜm
,

555 
DWORD
 
wIÅutAva
,

556 
PBYTE
 
pbIÅutBuf
,

557 
PDWORD
 
pwIÅutU£d
,

558 
PDWORD
 
pdwIÅutNextPos
,

559 
PIP_IMAGE_TRAITS
 
pIÁ¿™s
,

560 
PIP_IMAGE_TRAITS
 
pOutT¿™s
)

562 
PGAM_INST
 
g
;

564 
	`HANDLE_TO_PTR
 (
hXfÜm
, 
g
);

567 *
pwIÅutU£d
 = 0;

568 *
pdwIÅutNextPos
 = 0;

570 *
pIÁ¿™s
 = 
g
->
Œa™s
;

571 *
pOutT¿™s
 = 
g
->
Œa™s
;

573  
IP_DONE
;

575 
çl_”rÜ
:

576  
IP_FATAL_ERROR
;

577 
	}
}

587 
WORD
 
	$gamma_g‘Aùu®BufSizes
 (

588 
IP_XFORM_HANDLE
 
hXfÜm
,

589 
PDWORD
 
pwMšInBufL’
,

590 
PDWORD
 
pwMšOutBufL’
)

592 
PGAM_INST
 
g
;

594 
	`HANDLE_TO_PTR
 (
hXfÜm
, 
g
);

595 *
pwMšInBufL’
 = *
pwMšOutBufL’
 = 
g
->
Œa™s
.
iPix–sP”Row
;

596  
IP_DONE
;

598 
çl_”rÜ
:

599  
IP_FATAL_ERROR
;

600 
	}
}

610 
WORD
 
	$gamma_cÚv”t
 (

611 
IP_XFORM_HANDLE
 
hXfÜm
,

612 
DWORD
 
wIÅutAva
,

613 
PBYTE
 
pbIÅutBuf
,

614 
PDWORD
 
pwIÅutU£d
,

615 
PDWORD
 
pdwIÅutNextPos
,

616 
DWORD
 
wOuutAva
,

617 
PBYTE
 
pbOuutBuf
,

618 
PDWORD
 
pwOuutU£d
,

619 
PDWORD
 
pdwOuutThisPos
)

621 
PGAM_INST
 
g
;

622 
nBy‹s
;

623 
PBYTE
 
pIn
, 
pOut
, 
pOutAá”
;

625 
	`HANDLE_TO_PTR
 (
hXfÜm
, 
g
);

629 ià(
pbIÅutBuf
 =ğ
NULL
) {

630 
	`PRINT
 ("gamma_convert: Toldo flush.\n", 0, 0);

631 *
pwIÅutU£d
 = *
pwOuutU£d
 = 0;

632 *
pdwIÅutNextPos
 = 
g
->
dwInNextPos
;

633 *
pdwOuutThisPos
 = 
g
->
dwOutNextPos
;

634  
IP_DONE
;

639 
nBy‹s
 = 
g
->
Œa™s
.
iPix–sP”Row
;

640 
	`INSURE
 (
wIÅutAva
 >ğ
nBy‹s
 );

641 
	`INSURE
 (
wOuutAva
 >ğ
nBy‹s
);

643 
pIn
 = 
pbIÅutBuf
;

644 
pOut
 = 
pbOuutBuf
;

645 
pOutAá”
 = 
pOut
 + 
nBy‹s
;

647 
pOut
 < 
pOutAá”
) {

648 
pOut
[0] = 
g
->
gammaTabË
[
pIn
[0]];

649 
pOut
[1] = 
g
->
gammaTabË
[
pIn
[1]];

650 
pOut
[2] = 
g
->
gammaTabË
[
pIn
[2]];

651 
pOut
[3] = 
g
->
gammaTabË
[
pIn
[3]];

652 
pOut
[4] = 
g
->
gammaTabË
[
pIn
[4]];

653 
pOut
[5] = 
g
->
gammaTabË
[
pIn
[5]];

654 
pOut
[6] = 
g
->
gammaTabË
[
pIn
[6]];

655 
pOut
[7] = 
g
->
gammaTabË
[
pIn
[7]];

657 
pIn
 += 8;

658 
pOut
 += 8;

661 *
pwIÅutU£d
 = 
nBy‹s
;

662 
g
->
dwInNextPos
 +ğ
nBy‹s
;

663 *
pdwIÅutNextPos
 = 
g
->
dwInNextPos
;

665 *
pwOuutU£d
 = 
nBy‹s
;

666 *
pdwOuutThisPos
 = 
g
->
dwOutNextPos
;

667 
g
->
dwOutNextPos
 +ğ
nBy‹s
;

669 
g
->
wRowsDÚe
 += 1;

671 
	`PRINT
 ("gamma_cÚv”t: R‘uºšg, ouˆu£d = %d\n", 
out_u£d
, 0);

672  
IP_CONSUMED_ROW
 | 
IP_PRODUCED_ROW
 | 
IP_READY_FOR_DATA
;

674 
çl_”rÜ
:

675  
IP_FATAL_ERROR
;

676 
	}
}

686 
WORD
 
	$gamma_š£¹edD©a
 (

687 
IP_XFORM_HANDLE
 
hXfÜm
,

688 
DWORD
 
wNumBy‹s
)

690 
	`çlB»akPošt
 ();

691  
IP_FATAL_ERROR
;

692 
	}
}

702 
WORD
 
	$gamma_ÃwPage
 (

703 
IP_XFORM_HANDLE
 
hXfÜm
)

705 
PGAM_INST
 
g
;

707 
	`HANDLE_TO_PTR
 (
hXfÜm
, 
g
);

709  
IP_DONE
;

711 
çl_”rÜ
:

712  
IP_FATAL_ERROR
;

714 
	}
}

724 
WORD
 
	$gamma_şo£XfÜm
 (
IP_XFORM_HANDLE
 
hXfÜm
)

726 
PGAM_INST
 
g
;

728 
	`HANDLE_TO_PTR
 (
hXfÜm
, 
g
);

730 
g
->
dwV®idChk
 = 0;

731 
	`IP_MEM_FREE
 (
g
);

733  
IP_DONE
;

735 
çl_”rÜ
:

736  
IP_FATAL_ERROR
;

737 
	}
}

747 
IP_XFORM_TBL
 
	ggammaTbl
 = {

748 
gamma_İ’XfÜm
,

749 
gamma_£tDeçuÉIÅutT¿™s
,

750 
gamma_£tXfÜmS³c
,

751 
gamma_g‘H—d”BufSize
,

752 
gamma_g‘Aùu®T¿™s
,

753 
gamma_g‘Aùu®BufSizes
,

754 
gamma_cÚv”t
,

755 
gamma_ÃwPage
,

756 
gamma_š£¹edD©a
,

757 
gamma_şo£XfÜm


	@ip/xgray2bi.c

89 
	~"hp.h
"

90 
	~"defs.h
"

91 
	~"¡ršg.h
"

95 
	~"¡dio.h
"

96 
	~<tch¬.h
>

98 
	#PRINT
(
msg
,
¬g1
,
¬g2
) \

99 
	`_á´štf
(
¡d”r
, 
msg
, ()
¬g1
, ()
¬g2
)

	)

101 
	#PRINT
(
msg
,
¬g1
,
¬g2
)

	)

104 
	#CHECK_VALUE
 0x1û5ÿ7e

	)

108 
IP_IMAGE_TRAITS
 
	mšT¿™s
;

109 
DWORD
 
	mdwRowsDÚe
;

110 
BYTE
 
	mbTh»shŞd
;

111 
DWORD
 
	mdwInNextPos
;

112 
DWORD
 
	mdwOutNextPos
;

113 
DWORD
 
	mdwV®idChk
;

114 *
	mpE¼Buf
;

115 } 
	tG2B_INST
, *
	tPG2B_INST
;

125 
	$th»shŞdRow
 (

126 
iPix–sP”Row
,

127 
BYTE
 
bTh»shŞd
,

128 
BYTE
 
baInBuf
 [],

129 
BYTE
 
baOutBuf
 [])

131 
iMÜe
;

132 
PBYTE
 
pbIn
, 
pbOut
;

133 
BYTE
 
bOut
, 
bMask
;

135 
pbIn
 = 
baInBuf
;

136 
pbOut
 = 
baOutBuf
;

138 
iMÜe
=
iPix–sP”Row
; iMore>0; iMore-=8)

140 
bOut
 = 0;

142 
bMask
=0x80u; bMask!=0; bMask>>=1)

144 ià(*
pbIn
++ < 
bTh»shŞd
)

145 
bOut
 |ğ
bMask
;

148 *
pbOut
++ = 
bOut
;

150 
	}
}

160 
	$diffu£Row
 (

161 
iPix–sP”Row
,

162 
ŸE¼Buf
 [],

163 
BYTE
 
baInBuf
 [],

164 
BYTE
 
baOutBuf
 [])

166 
¼
, 
r
, 
cur
;

167 
br
, 
b
, 
bl
, 
bÎ
;

168 
”r
;

169 
weight4
, 
weight2
, 
weight1
;

170 *
•Œ
;

171 
noi£
;

172 
BYTE
 *
š±r
, *
šaá”
;

173 
BYTE
 *
ouŒ
;

174 
BYTE
 
outv®ue
;

175 
mask
;

176 
BOOL
 
£cÚd
;

191 
	#DIFFUSE
(
·r_outmask
) { \

192 
mask
 = 
cur
 >> (8*(cur)-1); \

193 
outv®ue
 |ğ
·r_outmask
 & 
mask
; \

194 
weight4
 = (
cur
 - (~
mask
&0x0ff0)) >> 2; \

196 
noi£
 = (
cur
 & (0x7f<<1)) - 0x7f; \

197 
cur
 = (()(*
š±r
++) << 4) \

198 + 
•Œ
[3] + 
weight2
 + 
weight4
 + 
noi£
 ; \

199 
weight2
 = (
weight4
>>1); \

200 
weight1
 = (
weight2
>>1); \

201 *
•Œ
++ = 
bÎ
 + 
weight1
 - 
noi£
 ; \

202 
bÎ
 = 
bËá
 + 
weight2
 + 
weight1
 ; \

203 
bËá
 = 
b–ow
 + 
weight4
 - 
noi£
 ; \

204 
b–ow
 = 
weight2
 + 
noi£
 ; \

205 }

	)

207 
cur
 = 
ŸE¼Buf
[2] + (()(*
š±r
++) << 4);

208 
bÎ
 = 0;

209 
bËá
 = 0;

210 
b–ow
 = 0;

211 
weight2
 = 0;

215 
	#DIFFUSE
(
·r_outmask
) { \

217 
mask
 = (
cur
-0x800) >> (8*(cur)-1); \

218 
outv®ue
 |ğ
·r_outmask
 & 
mask
; \

221 
”r
 = 
cur
 - (~
mask
&0x0ff0); \

223 
”r
 =ƒrr - (err>>4); \

224 
weight4
 = 
”r
 >> 2; \

225 
weight2
 = 
weight4
 >> 1; \

226 
weight1
 = 
weight2
 >> 1; \

229 
noi£
 = 
”r
 & 0x00ff; \

230 
¼
 +ğ
weight2
; \

231 
r
 +ğ
weight4
 + 
noi£
; \

232 
br
 = 
weight2
 + 
noi£
; \

233 
b
 +ğ
weight4
 - 
noi£
; \

234 
bl
 +ğ
weight2
 + 
weight1
; \

235 
bÎ
 +ğ
weight1
 - 
noi£
; \

238 
cur
 = 
r
; \

239 
r
 = 
¼
; \

240 
¼
 = (()(*
š±r
++è<< 4è+ 
•Œ
[2]; \

241 
•Œ
[-2] = 
bÎ
; \

242 
bÎ
 = 
bl
; \

243 
bl
 = 
b
; \

244 
b
 = 
br
; \

245 
•Œ
 += 1; \

246 }

	)

248 
š±r
 = 
baInBuf
;

249 
šaá”
 = 
baInBuf
 + 
iPix–sP”Row
;

250 
ouŒ
 = 
baOutBuf
;

251 
•Œ
 = 
ŸE¼Buf
 + 2;

252 
outv®ue
 = 0;

253 
£cÚd
 = 
FALSE
;

255 
cur
 = (()
š±r
[0] << 4è+ 
•Œ
[0];

256 
r
 = (()
š±r
[1] << 4è+ 
•Œ
[1];

257 
¼
 = (()
š±r
[2] << 4è+ 
•Œ
[2];

258 
š±r
 += 3;

259 
bÎ
 = 
bl
 = 
b
 = 
br
 = 0;

261 
š±r
 < 
šaá”
) {

262 
	`DIFFUSE
 (0x08);

263 
	`DIFFUSE
 (0x04);

264 
	`DIFFUSE
 (0x02);

265 
	`DIFFUSE
 (0x01);

267 ià(! 
£cÚd
) {

269 
outv®ue
 <<= 4;

270 
£cÚd
 = 
TRUE
;

273 *
ouŒ
++ = 
outv®ue
;

274 
outv®ue
 = 0;

275 
£cÚd
 = 
FALSE
;

279 ià(
£cÚd
)

280 *
ouŒ
 = 
outv®ue
;

282 
•Œ
[-2] = 
bÎ
;

283 
•Œ
[-1] = 
bl
;

284 
•Œ
[ 0] = 
b
;

286 #undeà
DIFFUSE


287 
	}
}

304 
WORD
 
	$g¿y2bi_İ’XfÜm
 (

305 
IP_XFORM_HANDLE
 *
pXfÜm
)

307 
PG2B_INST
 
g
;

309 
	`INSURE
 (
pXfÜm
 !ğ
NULL
);

310 
	`IP_MEM_ALLOC
 ((
G2B_INST
), 
g
);

311 *
pXfÜm
 = 
g
;

312 
	`mem£t
 (
g
, 0, (
G2B_INST
));

313 
g
->
dwV®idChk
 = 
CHECK_VALUE
;

314  
IP_DONE
;

316 
çl_”rÜ
:

317  
IP_FATAL_ERROR
;

318 
	}
}

337 
WORD
 
	$g¿y2bi_£tDeçuÉIÅutT¿™s
 (

338 
IP_XFORM_HANDLE
 
hXfÜm
,

339 
PIP_IMAGE_TRAITS
 
pT¿™s
)

341 
PG2B_INST
 
g
;

343 
	`HANDLE_TO_PTR
 (
hXfÜm
, 
g
);

346 
	`INSURE
 (
pT¿™s
->
iB™sP”Pix–
 == 8);

347 
	`INSURE
 (
pT¿™s
->
iCompÚ’tsP”Pix–
 == 1);

348 
	`INSURE
 (
pT¿™s
->
iPix–sP”Row
 > 0);

350 
g
->
šT¿™s
 = *
pT¿™s
;

352  
IP_DONE
;

354 
çl_”rÜ
:

355  
IP_FATAL_ERROR
;

356 
	}
}

366 
WORD
 
	$g¿y2bi_£tXfÜmS³c
 (

367 
IP_XFORM_HANDLE
 
hXfÜm
,

368 
DWORD_OR_PVOID
 
aXfÜmInfo
[])

370 
PG2B_INST
 
g
;

372 
	`HANDLE_TO_PTR
 (
hXfÜm
, 
g
);

373 
	`INSURE
 ((
DWORD
)
aXfÜmInfo
[
IP_GRAY_2_BI_THRESHOLD
].
dwÜd
 <= 255);

374 
g
->
bTh»shŞd
 = (
BYTE
)
aXfÜmInfo
[
IP_GRAY_2_BI_THRESHOLD
].
dwÜd
;

376  
IP_DONE
;

378 
çl_”rÜ
:

379  
IP_FATAL_ERROR
;

380 
	}
}

390 
WORD
 
	$g¿y2bi_g‘H—d”BufSize
 (

391 
IP_XFORM_HANDLE
 
hXfÜm
,

392 
DWORD
 *
pdwInBufL’
)

395 *
pdwInBufL’
 = 0;

396  
IP_DONE
;

397 
	}
}

407 
WORD
 
	$g¿y2bi_g‘Aùu®T¿™s
 (

408 
IP_XFORM_HANDLE
 
hXfÜm
,

409 
DWORD
 
dwIÅutAva
,

410 
PBYTE
 
pbIÅutBuf
,

411 
PDWORD
 
pdwIÅutU£d
,

412 
PDWORD
 
pdwIÅutNextPos
,

413 
PIP_IMAGE_TRAITS
 
pInT¿™s
,

414 
PIP_IMAGE_TRAITS
 
pOutT¿™s
)

416 
PG2B_INST
 
g
;

417 
nBy‹s
;

419 
	`HANDLE_TO_PTR
 (
hXfÜm
, 
g
);

422 *
pdwIÅutU£d
 = 0;

423 *
pdwIÅutNextPos
 = 0;

425 *
pInT¿™s
 = 
g
->
šT¿™s
;

426 *
pOutT¿™s
 = 
g
->
šT¿™s
;

427 
pOutT¿™s
->
iB™sP”Pix–
 = 1;

429 ià(
g
->
bTh»shŞd
 == 0) {

430 
nBy‹s
 = (è* 
g
->
šT¿™s
.
iPix–sP”Row
;

431 
	`IP_MEM_ALLOC
 (
nBy‹s
, 
g
->
pE¼Buf
);

432 
	`mem£t
 (
g
->
pE¼Buf
, 0, 
nBy‹s
);

435  
IP_DONE
 | 
IP_READY_FOR_DATA
;

437 
çl_”rÜ
:

438  
IP_FATAL_ERROR
;

439 
	}
}

449 
WORD
 
	$g¿y2bi_g‘Aùu®BufSizes
 (

450 
IP_XFORM_HANDLE
 
hXfÜm
,

451 
PDWORD
 
pdwMšInBufL’
,

452 
PDWORD
 
pdwMšOutBufL’
)

454 
PG2B_INST
 
g
;

456 
	`HANDLE_TO_PTR
 (
hXfÜm
, 
g
);

457 *
pdwMšInBufL’
 = 
g
->
šT¿™s
.
iPix–sP”Row
;

458 *
pdwMšOutBufL’
 = (
g
->
šT¿™s
.
iPix–sP”Row
 + 7) / 8;

460  
IP_DONE
;

462 
çl_”rÜ
:

463  
IP_FATAL_ERROR
;

464 
	}
}

474 
WORD
 
	$g¿y2bi_cÚv”t
 (

475 
IP_XFORM_HANDLE
 
hXfÜm
,

476 
DWORD
 
dwIÅutAva
,

477 
PBYTE
 
pbIÅutBuf
,

478 
PDWORD
 
pdwIÅutU£d
,

479 
PDWORD
 
pdwIÅutNextPos
,

480 
DWORD
 
dwOuutAva
,

481 
PBYTE
 
pbOuutBuf
,

482 
PDWORD
 
pdwOuutU£d
,

483 
PDWORD
 
pdwOuutThisPos
)

485 
PG2B_INST
 
g
;

486 
šBy‹s
, 
outBy‹s
;

488 
	`HANDLE_TO_PTR
 (
hXfÜm
, 
g
);

492 ià(
pbIÅutBuf
 =ğ
NULL
) {

493 
	`PRINT
 (
	`_T
("gray2bi_convert: Toldo flush.\n"), 0, 0);

494 *
pdwIÅutU£d
 = *
pdwOuutU£d
 = 0;

495 *
pdwIÅutNextPos
 = 
g
->
dwInNextPos
;

496 *
pdwOuutThisPos
 = 
g
->
dwOutNextPos
;

497  
IP_DONE
;

502 
šBy‹s
 = 
g
->
šT¿™s
.
iPix–sP”Row
;

503 
outBy‹s
 = (
šBy‹s
 + 7) / 8;

504 
	`INSURE
 (
dwIÅutAva
 >ğ(
DWORD
)
šBy‹s
 );

505 
	`INSURE
 (
dwOuutAva
 >ğ(
DWORD
)
outBy‹s
);

507 ià(
g
->
bTh»shŞd
 == 0) {

508 
	`INSURE
 (
g
->
pE¼Buf
 !ğ
NULL
);

509 
	`diffu£Row
 (
šBy‹s
, 
g
->
pE¼Buf
, 
pbIÅutBuf
, 
pbOuutBuf
);

511 
	`th»shŞdRow
 (
šBy‹s
, 
g
->
bTh»shŞd
, 
pbIÅutBuf
, 
pbOuutBuf
);

513 *
pdwIÅutU£d
 = 
šBy‹s
;

514 
g
->
dwInNextPos
 +ğ
šBy‹s
;

515 *
pdwIÅutNextPos
 = 
g
->
dwInNextPos
;

517 *
pdwOuutU£d
 = 
outBy‹s
;

518 *
pdwOuutThisPos
 = 
g
->
dwOutNextPos
;

519 
g
->
dwOutNextPos
 +ğ
outBy‹s
;

521 
g
->
dwRowsDÚe
 += 1;

523  
IP_CONSUMED_ROW
 | 
IP_PRODUCED_ROW
 | 
IP_READY_FOR_DATA
;

525 
çl_”rÜ
:

526  
IP_FATAL_ERROR
;

527 
	}
}

537 
WORD
 
	$g¿y2bi_š£¹edD©a
 (

538 
IP_XFORM_HANDLE
 
hXfÜm
,

539 
DWORD
 
dwNumBy‹s
)

541 
	`çlB»akPošt
 ();

542  
IP_FATAL_ERROR
;

543 
	}
}

553 
WORD
 
	$g¿y2bi_ÃwPage
 (

554 
IP_XFORM_HANDLE
 
hXfÜm
)

556 
PG2B_INST
 
g
;

558 
	`HANDLE_TO_PTR
 (
hXfÜm
, 
g
);

560  
IP_DONE
;

562 
çl_”rÜ
:

563  
IP_FATAL_ERROR
;

565 
	}
}

575 
WORD
 
	$g¿y2bi_şo£XfÜm
 (
IP_XFORM_HANDLE
 
hXfÜm
)

577 
PG2B_INST
 
g
;

579 
	`HANDLE_TO_PTR
 (
hXfÜm
, 
g
);

581 ià(
g
->
pE¼Buf
 !ğ
NULL
)

582 
	`IP_MEM_FREE
 (
g
->
pE¼Buf
);

584 
g
->
dwV®idChk
 = 0;

585 
	`IP_MEM_FREE
 (
g
);

587  
IP_DONE
;

589 
çl_”rÜ
:

590  
IP_FATAL_ERROR
;

591 
	}
}

601 
IP_XFORM_TBL
 
	gg¿y2biTbl
 = {

602 
g¿y2bi_İ’XfÜm
,

603 
g¿y2bi_£tDeçuÉIÅutT¿™s
,

604 
g¿y2bi_£tXfÜmS³c
,

605 
g¿y2bi_g‘H—d”BufSize
,

606 
g¿y2bi_g‘Aùu®T¿™s
,

607 
g¿y2bi_g‘Aùu®BufSizes
,

608 
g¿y2bi_cÚv”t
,

609 
g¿y2bi_ÃwPage
,

610 
g¿y2bi_š£¹edD©a
,

611 
g¿y2bi_şo£XfÜm


	@ip/xgrayout.c

88 
	#TARGET_GRAY
 0xB0

	)

94 
	~"hp.h
"

95 
	~"defs.h
"

96 
	~"¡ršg.h
"

100 
	~"¡dio.h
"

101 
	~<tch¬.h
>

102 
	#PRINT
(
msg
,
¬g1
,
¬g2
) \

103 
	`_á´štf
(
¡d”r
, 
msg
, ()
¬g1
, ()
¬g2
)

	)

105 
	#PRINT
(
msg
,
¬g1
,
¬g2
)

	)

108 
	#CHECK_VALUE
 0x4ba1daû

	)

110 #ifdeà
EXPORT_TRANSFORM


111 
	#FUNC_STATUS
 
	`__deş¥ec
 (
dÎexpÜt
)

	)

113 
	#FUNC_STATUS
 

	)

117 
IP_IMAGE_TRAITS
 
	mŒa™s
;

118 
DWORD
 
	mdwBy‹sP”Row
;

119 
	miLeá
, 
	miRight
;

120 
	miTİ
, 
	miBÙtom
;

121 
DWORD
 
	mdwRowsDÚe
;

122 
DWORD
 
	mdwInNextPos
;

123 
DWORD
 
	mdwOutNextPos
;

124 
DWORD
 
	mdwV®idChk
;

125 } 
	tGRAYOUT_INST
, *
	tPGRAYOUT_INST
;

142 
FUNC_STATUS
 
WORD
 
	$g¿yOut_İ’XfÜm
 (

143 
IP_XFORM_HANDLE
 *
pXfÜm
)

145 
PGRAYOUT_INST
 
g
;

147 
	`INSURE
 (
pXfÜm
 !ğ
NULL
);

148 
	`IP_MEM_ALLOC
 ((
GRAYOUT_INST
), 
g
);

149 *
pXfÜm
 = 
g
;

150 
	`mem£t
 (
g
, 0, (
GRAYOUT_INST
));

151 
g
->
dwV®idChk
 = 
CHECK_VALUE
;

152 
g
->
iRight
 = 1000000;

153 
g
->
iBÙtom
 = 1000000;

154  
IP_DONE
;

156 
çl_”rÜ
:

157  
IP_FATAL_ERROR
;

158 
	}
}

177 
FUNC_STATUS
 
WORD
 
	$g¿yOut_£tDeçuÉIÅutT¿™s
 (

178 
IP_XFORM_HANDLE
 
hXfÜm
,

179 
PIP_IMAGE_TRAITS
 
pT¿™s
)

181 
PGRAYOUT_INST
 
g
;

183 
	`HANDLE_TO_PTR
 (
hXfÜm
, 
g
);

186 
	`INSURE
 (
pT¿™s
->
iPix–sP”Row
 > 0 &&

187 
pT¿™s
->
iB™sP”Pix–
 == 24 &&

188 
pT¿™s
->
iCompÚ’tsP”Pix–
 == 3);

189 
g
->
Œa™s
 = *
pT¿™s
;

190 
g
->
dwBy‹sP”Row
 = (g->
Œa™s
.
iPix–sP”Row
*g->Œa™s.
iB™sP”Pix–
 + 7) / 8;

191  
IP_DONE
;

193 
çl_”rÜ
:

194  
IP_FATAL_ERROR
;

195 
	}
}

205 
FUNC_STATUS
 
WORD
 
	$g¿yOut_£tXfÜmS³c
 (

206 
IP_XFORM_HANDLE
 
hXfÜm
,

207 
DWORD_OR_PVOID
 
aXfÜmInfo
[])

209 
PGRAYOUT_INST
 
g
;

211 
	`HANDLE_TO_PTR
 (
hXfÜm
, 
g
);

212 
g
->
iLeá
 = 
aXfÜmInfo
[
IP_GRAYOUT_LEFT
 ].
dwÜd
;

213 
g
->
iRight
 = 
aXfÜmInfo
[
IP_GRAYOUT_RIGHT
 ].
dwÜd
;

214 
g
->
iTİ
 = 
aXfÜmInfo
[
IP_GRAYOUT_TOP
 ].
dwÜd
;

215 
g
->
iBÙtom
 = 
aXfÜmInfo
[
IP_GRAYOUT_BOTTOM
].
dwÜd
;

216  
IP_DONE
;

218 
çl_”rÜ
:

219  
IP_FATAL_ERROR
;

220 
	}
}

230 
FUNC_STATUS
 
WORD
 
	$g¿yOut_g‘H—d”BufSize
 (

231 
IP_XFORM_HANDLE
 
hXfÜm
,

232 
DWORD
 *
pdwInBufL’
)

235 *
pdwInBufL’
 = 0;

236  
IP_DONE
;

237 
	}
}

247 
FUNC_STATUS
 
WORD
 
	$g¿yOut_g‘Aùu®T¿™s
 (

248 
IP_XFORM_HANDLE
 
hXfÜm
,

249 
DWORD
 
dwIÅutAva
,

250 
PBYTE
 
pbIÅutBuf
,

251 
PDWORD
 
pdwIÅutU£d
,

252 
PDWORD
 
pdwIÅutNextPos
,

253 
PIP_IMAGE_TRAITS
 
pIÁ¿™s
,

254 
PIP_IMAGE_TRAITS
 
pOutT¿™s
)

256 
PGRAYOUT_INST
 
g
;

258 
	`HANDLE_TO_PTR
 (
hXfÜm
, 
g
);

261 *
pdwIÅutU£d
 = 0;

262 *
pdwIÅutNextPos
 = 0;

264 *
pIÁ¿™s
 = 
g
->
Œa™s
;

265 *
pOutT¿™s
 = 
g
->
Œa™s
;

267  
IP_DONE
 | 
IP_READY_FOR_DATA
;

269 
çl_”rÜ
:

270  
IP_FATAL_ERROR
;

271 
	}
}

281 
FUNC_STATUS
 
WORD
 
	$g¿yOut_g‘Aùu®BufSizes
 (

282 
IP_XFORM_HANDLE
 
hXfÜm
,

283 
PDWORD
 
pdwMšInBufL’
,

284 
PDWORD
 
pdwMšOutBufL’
)

286 
PGRAYOUT_INST
 
g
;

288 
	`HANDLE_TO_PTR
 (
hXfÜm
, 
g
);

289 *
pdwMšInBufL’
 = *
pdwMšOutBufL’
 = 
g
->
dwBy‹sP”Row
;

290  
IP_DONE
;

292 
çl_”rÜ
:

293  
IP_FATAL_ERROR
;

294 
	}
}

304 
FUNC_STATUS
 
WORD
 
	$g¿yOut_cÚv”t
 (

305 
IP_XFORM_HANDLE
 
hXfÜm
,

306 
DWORD
 
dwIÅutAva
,

307 
PBYTE
 
pbIÅutBuf
,

308 
PDWORD
 
pdwIÅutU£d
,

309 
PDWORD
 
pdwIÅutNextPos
,

310 
DWORD
 
dwOuutAva
,

311 
PBYTE
 
pbOuutBuf
,

312 
PDWORD
 
pdwOuutU£d
,

313 
PDWORD
 
pdwOuutThisPos
)

315 
PGRAYOUT_INST
 
g
;

316 
nBy‹s
;

317 
PBYTE
 
pIn
, 
pInAá”
, 
pOut
, 
pLeá
, 
pRight
;

319 
	#GRAYOUT_PIXEL
 \

320 *
pOut
++ = (
BYTE
)((()(*
pIn
++)+
TARGET_GRAY
) >> 1); \

321 *
pOut
++ = (
BYTE
)((()(*
pIn
++)+
TARGET_GRAY
) >> 1); \

322 *
pOut
++ = (
BYTE
)((()(*
pIn
++)+
TARGET_GRAY
è>> 1);

	)

324 
	`HANDLE_TO_PTR
 (
hXfÜm
, 
g
);

328 ià(
pbIÅutBuf
 =ğ
NULL
) {

329 
	`PRINT
 (
	`_T
("grayOut_convert: Toldo flush.\n"), 0, 0);

330 *
pdwIÅutU£d
 = *
pdwOuutU£d
 = 0;

331 *
pdwIÅutNextPos
 = 
g
->
dwInNextPos
;

332 *
pdwOuutThisPos
 = 
g
->
dwOutNextPos
;

333  
IP_DONE
;

338 
nBy‹s
 = 
g
->
dwBy‹sP”Row
;

339 
	`INSURE
 (
dwIÅutAva
 >ğ(
DWORD
)
nBy‹s
 );

340 
	`INSURE
 (
dwOuutAva
 >ğ(
DWORD
)
nBy‹s
);

342 
pIn
 = 
pbIÅutBuf
;

343 
pOut
 = 
pbOuutBuf
;

344 
pInAá”
 = 
pIn
 + 
nBy‹s
;

346 ià(()
g
->
dwRowsDÚe
<g->
iTİ
 || ()g->dwRowsDÚe>g->
iBÙtom
) {

348 
pIn
 < 
pInAá”
) {

349 
GRAYOUT_PIXEL


353 
pLeá
 = 
pIn
 + 3*
g
->
iLeá
;

354 
pRight
 = 
pIn
 + 3*
g
->
iRight
;

356 ià(
pLeá
 >ğ
pInAá”
)

357 
pLeá
 = 
pInAá”
 - 3;

358 ià(
pRight
 >ğ
pInAá”
)

359 
pRight
 = 
pInAá”
 - 3;

361 
pIn
 < 
pLeá
) {

362 
GRAYOUT_PIXEL


364 
pIn
 <ğ
pRight
) {

365 *
pOut
++ = *
pIn
++;

366 *
pOut
++ = *
pIn
++;

367 *
pOut
++ = *
pIn
++;

369 
pIn
 < 
pInAá”
) {

370 
GRAYOUT_PIXEL


374 *
pdwIÅutU£d
 = 
nBy‹s
;

375 
g
->
dwInNextPos
 +ğ
nBy‹s
;

376 *
pdwIÅutNextPos
 = 
g
->
dwInNextPos
;

378 *
pdwOuutU£d
 = 
nBy‹s
;

379 *
pdwOuutThisPos
 = 
g
->
dwOutNextPos
;

380 
g
->
dwOutNextPos
 +ğ
nBy‹s
;

382 
g
->
dwRowsDÚe
 += 1;

384  
IP_CONSUMED_ROW
 | 
IP_PRODUCED_ROW
 | 
IP_READY_FOR_DATA
;

386 
çl_”rÜ
:

387  
IP_FATAL_ERROR
;

388 
	}
}

398 
FUNC_STATUS
 
WORD
 
	$g¿yOut_š£¹edD©a
 (

399 
IP_XFORM_HANDLE
 
hXfÜm
,

400 
DWORD
 
dwNumBy‹s
)

402 
	`çlB»akPošt
 ();

403  
IP_FATAL_ERROR
;

404 
	}
}

414 
FUNC_STATUS
 
WORD
 
	$g¿yOut_ÃwPage
 (

415 
IP_XFORM_HANDLE
 
hXfÜm
)

417 
PGRAYOUT_INST
 
g
;

419 
	`HANDLE_TO_PTR
 (
hXfÜm
, 
g
);

421  
IP_DONE
;

423 
çl_”rÜ
:

424  
IP_FATAL_ERROR
;

426 
	}
}

436 
FUNC_STATUS
 
WORD
 
	$g¿yOut_şo£XfÜm
 (
IP_XFORM_HANDLE
 
hXfÜm
)

438 
PGRAYOUT_INST
 
g
;

440 
	`HANDLE_TO_PTR
 (
hXfÜm
, 
g
);

442 
g
->
dwV®idChk
 = 0;

443 
	`IP_MEM_FREE
 (
g
);

445  
IP_DONE
;

447 
çl_”rÜ
:

448  
IP_FATAL_ERROR
;

449 
	}
}

458 #ifdeà
EXPORT_TRANSFORM


459 
	$__deş¥ec
 (
dÎexpÜt
)

461 
IP_XFORM_TBL
 
g¿yOutTbl
 = {

462 
g¿yOut_İ’XfÜm
,

463 
g¿yOut_£tDeçuÉIÅutT¿™s
,

464 
g¿yOut_£tXfÜmS³c
,

465 
g¿yOut_g‘H—d”BufSize
,

466 
g¿yOut_g‘Aùu®T¿™s
,

467 
g¿yOut_g‘Aùu®BufSizes
,

468 
g¿yOut_cÚv”t
,

469 
g¿yOut_ÃwPage
,

470 
g¿yOut_š£¹edD©a
,

471 
g¿yOut_şo£XfÜm


472 
	}
};

483 #ifdeà
EXPORT_TRANSFORM


484 
	$EXPORT
(
WORD
è
	$G‘XfÜmTabË
 (
LPIP_XFORM_TBL
 
pXfÜm
)

486 
WORD
 
wR‘
 = 
IP_DONE
;

488 ià(
pXfÜm
)

489 *
pXfÜm
 = 
şrm­Tbl
;

491 
wR‘
 = 
IP_FATAL_ERROR
;

493  
wR‘
;

494 
	}
}

	@ip/xinvert.c

77 
	~"hp.h
"

78 
	~"defs.h
"

79 
	~"¡ršg.h
"

83 
	~"¡dio.h
"

84 
	~<tch¬.h
>

85 
	#PRINT
(
msg
,
¬g1
,
¬g2
) \

86 
	`_á´štf
(
¡d”r
, 
msg
, ()
¬g1
, ()
¬g2
)

	)

88 
	#PRINT
(
msg
,
¬g1
,
¬g2
)

	)

91 
	#CHECK_VALUE
 0x4ba1daû

	)

93 #ifdeà
EXPORT_TRANSFORM


94 
	#FUNC_STATUS
 
	`__deş¥ec
 (
dÎexpÜt
)

	)

96 
	#FUNC_STATUS
 

	)

100 
IP_IMAGE_TRAITS
 
	mŒa™s
;

101 
DWORD
 
	mdwBy‹sP”Row
;

102 
DWORD
 
	mdwRowsDÚe
;

103 
DWORD
 
	mdwInNextPos
;

104 
DWORD
 
	mdwOutNextPos
;

105 
DWORD
 
	mdwAddToNÙ
;

106 
DWORD
 
	mdwV®idChk
;

107 } 
	tINVERT_INST
, *
	tPINVERT_INST
;

124 
FUNC_STATUS
 
WORD
 
	$šv”t_İ’XfÜm
 (

125 
IP_XFORM_HANDLE
 *
pXfÜm
)

127 
PINVERT_INST
 
g
;

129 
	`INSURE
 (
pXfÜm
 !ğ
NULL
);

130 
	`IP_MEM_ALLOC
 ((
INVERT_INST
), 
g
);

131 *
pXfÜm
 = 
g
;

132 
	`mem£t
 (
g
, 0, (
INVERT_INST
));

133 
g
->
dwV®idChk
 = 
CHECK_VALUE
;

134  
IP_DONE
;

136 
çl_”rÜ
:

137  
IP_FATAL_ERROR
;

138 
	}
}

157 
FUNC_STATUS
 
WORD
 
	$šv”t_£tDeçuÉIÅutT¿™s
 (

158 
IP_XFORM_HANDLE
 
hXfÜm
,

159 
PIP_IMAGE_TRAITS
 
pT¿™s
)

161 
PINVERT_INST
 
g
;

163 
	`HANDLE_TO_PTR
 (
hXfÜm
, 
g
);

166 
	`INSURE
 (
pT¿™s
->
iPix–sP”Row
>0 &&…T¿™s->
iB™sP”Pix–
>0);

167 
g
->
Œa™s
 = *
pT¿™s
;

168 
g
->
dwBy‹sP”Row
 = (g->
Œa™s
.
iPix–sP”Row
*g->Œa™s.
iB™sP”Pix–
 + 7) / 8;

169 ià(
pT¿™s
->
iB™sP”Pix–
>3) {

170 
g
->
dwAddToNÙ
=1;

172 
g
->
dwAddToNÙ
=0;

174  
IP_DONE
;

176 
çl_”rÜ
:

177  
IP_FATAL_ERROR
;

178 
	}
}

188 
FUNC_STATUS
 
WORD
 
	$šv”t_£tXfÜmS³c
 (

189 
IP_XFORM_HANDLE
 
hXfÜm
,

190 
DWORD_OR_PVOID
 
aXfÜmInfo
[])

192 
PINVERT_INST
 
g
;

194 
	`HANDLE_TO_PTR
 (
hXfÜm
, 
g
);

201  
IP_DONE
;

203 
çl_”rÜ
:

204  
IP_FATAL_ERROR
;

205 
	}
}

215 
FUNC_STATUS
 
WORD
 
	$šv”t_g‘H—d”BufSize
 (

216 
IP_XFORM_HANDLE
 
hXfÜm
,

217 
DWORD
 *
pdwInBufL’
)

220 *
pdwInBufL’
 = 0;

221  
IP_DONE
;

222 
	}
}

232 
FUNC_STATUS
 
WORD
 
	$šv”t_g‘Aùu®T¿™s
 (

233 
IP_XFORM_HANDLE
 
hXfÜm
,

234 
DWORD
 
dwIÅutAva
,

235 
PBYTE
 
pbIÅutBuf
,

236 
PDWORD
 
pdwIÅutU£d
,

237 
PDWORD
 
pdwIÅutNextPos
,

238 
PIP_IMAGE_TRAITS
 
pInT¿™s
,

239 
PIP_IMAGE_TRAITS
 
pOutT¿™s
)

241 
PINVERT_INST
 
g
;

243 
	`HANDLE_TO_PTR
 (
hXfÜm
, 
g
);

246 *
pdwIÅutU£d
 = 0;

247 *
pdwIÅutNextPos
 = 0;

248 
g
->
dwInNextPos
 = 0;

250 *
pInT¿™s
 = 
g
->
Œa™s
;

251 *
pOutT¿™s
 = 
g
->
Œa™s
;

253  
IP_DONE
 | 
IP_READY_FOR_DATA
;

255 
çl_”rÜ
:

256  
IP_FATAL_ERROR
;

257 
	}
}

267 
FUNC_STATUS
 
WORD
 
	$šv”t_g‘Aùu®BufSizes
 (

268 
IP_XFORM_HANDLE
 
hXfÜm
,

269 
PDWORD
 
pdwMšInBufL’
,

270 
PDWORD
 
pdwMšOutBufL’
)

272 
PINVERT_INST
 
g
;

274 
	`HANDLE_TO_PTR
 (
hXfÜm
, 
g
);

276 *
pdwMšInBufL’
 = *
pdwMšOutBufL’
 = 
g
->
dwBy‹sP”Row
;

277  
IP_DONE
;

279 
çl_”rÜ
:

280  
IP_FATAL_ERROR
;

281 
	}
}

291 
FUNC_STATUS
 
WORD
 
	$šv”t_cÚv”t
 (

292 
IP_XFORM_HANDLE
 
hXfÜm
,

293 
DWORD
 
dwIÅutAva
,

294 
PBYTE
 
pbIÅutBuf
,

295 
PDWORD
 
pdwIÅutU£d
,

296 
PDWORD
 
pdwIÅutNextPos
,

297 
DWORD
 
dwOuutAva
,

298 
PBYTE
 
pbOuutBuf
,

299 
PDWORD
 
pdwOuutU£d
,

300 
PDWORD
 
pdwOuutThisPos
)

302 
PINVERT_INST
 
g
;

303 
nBy‹s
,
i
;

304 
PBYTE
 
pIn
, 
pOut
;

306 
	`HANDLE_TO_PTR
 (
hXfÜm
, 
g
);

310 ià(
pbIÅutBuf
 =ğ
NULL
) {

311 
	`PRINT
 (
	`_T
("invert_convert: Toldo flush.\n"), 0, 0);

312 *
pdwIÅutU£d
 = *
pdwOuutU£d
 = 0;

313 *
pdwIÅutNextPos
 = 
g
->
dwInNextPos
;

314 *
pdwOuutThisPos
 = 
g
->
dwOutNextPos
;

315  
IP_DONE
;

320 
nBy‹s
 = 
g
->
dwBy‹sP”Row
;

321 
	`INSURE
 (
dwIÅutAva
 >ğ(
DWORD
)
nBy‹s
 );

322 
	`INSURE
 (
dwOuutAva
 >ğ(
DWORD
)
nBy‹s
);

324 
pIn
 = 
pbIÅutBuf
;

325 
pOut
 = 
pbOuutBuf
;

330 
i
=0;i<
nBy‹s
;i++) {

331 
pOut
[
i
]=~
pIn
[i]+
g
->
dwAddToNÙ
;

334 *
pdwIÅutU£d
 = 
nBy‹s
;

335 
g
->
dwInNextPos
 +ğ
nBy‹s
;

336 *
pdwIÅutNextPos
 = 
g
->
dwInNextPos
;

338 *
pdwOuutU£d
 = 
nBy‹s
;

339 *
pdwOuutThisPos
 = 
g
->
dwOutNextPos
;

340 
g
->
dwOutNextPos
 +ğ
nBy‹s
;

342 
g
->
dwRowsDÚe
 += 1;

344  
IP_CONSUMED_ROW
 | 
IP_PRODUCED_ROW
 | 
IP_READY_FOR_DATA
;

346 
çl_”rÜ
:

347  
IP_FATAL_ERROR
;

348 
	}
}

358 
FUNC_STATUS
 
WORD
 
	$šv”t_š£¹edD©a
 (

359 
IP_XFORM_HANDLE
 
hXfÜm
,

360 
DWORD
 
dwNumBy‹s
)

362 
	`çlB»akPošt
 ();

363  
IP_FATAL_ERROR
;

364 
	}
}

374 
FUNC_STATUS
 
WORD
 
	$šv”t_ÃwPage
 (

375 
IP_XFORM_HANDLE
 
hXfÜm
)

377 
PINVERT_INST
 
g
;

379 
	`HANDLE_TO_PTR
 (
hXfÜm
, 
g
);

381  
IP_DONE
;

383 
çl_”rÜ
:

384  
IP_FATAL_ERROR
;

386 
	}
}

396 
FUNC_STATUS
 
WORD
 
	$šv”t_şo£XfÜm
 (
IP_XFORM_HANDLE
 
hXfÜm
)

398 
PINVERT_INST
 
g
;

400 
	`HANDLE_TO_PTR
 (
hXfÜm
, 
g
);

402 
g
->
dwV®idChk
 = 0;

403 
	`IP_MEM_FREE
 (
g
);

405  
IP_DONE
;

407 
çl_”rÜ
:

408  
IP_FATAL_ERROR
;

409 
	}
}

418 #ifdeà
EXPORT_TRANSFORM


419 
	$__deş¥ec
 (
dÎexpÜt
)

421 
IP_XFORM_TBL
 
šv”tTbl
 = {

422 
šv”t_İ’XfÜm
,

423 
šv”t_£tDeçuÉIÅutT¿™s
,

424 
šv”t_£tXfÜmS³c
,

425 
šv”t_g‘H—d”BufSize
,

426 
šv”t_g‘Aùu®T¿™s
,

427 
šv”t_g‘Aùu®BufSizes
,

428 
šv”t_cÚv”t
,

429 
šv”t_ÃwPage
,

430 
šv”t_š£¹edD©a
,

431 
šv”t_şo£XfÜm


432 
	}
};

443 #ifdeà
EXPORT_TRANSFORM


444 
	$EXPORT
(
WORD
è
	$G‘XfÜmTabË
 (
LPIP_XFORM_TBL
 
pXfÜm
)

446 
WORD
 
wR‘
 = 
IP_DONE
;

448 ià(
pXfÜm
)

450 *
pXfÜm
 = 
şrm­Tbl
;

454 
wR‘
 = 
IP_FATAL_ERROR
;

457  
wR‘
;

458 
	}
}

	@ip/xjpg_dct.c

46 
	~"xjpg_dù.h
"

54 
	#SUB_AND_ADD
(
a
,
b
) { \

55 
b
 +ğ
a
; \

56 
a
 +=‡; \

57 
a
 -ğ
b
; \

58 }

	)

70 #ià(
defšed
 
_WINDOWS
è&& !(defšed 
_WIN32
)

74 
	#MUL_ROUND
(
c
,
x
) { \

75 
´oduù
; \

76 
´oduù
 = ()(
x
è* (()(
c
è<< (16-
CONST_FRAC_BITS
)); \

77 
x
 = (
´oduù
+0x8000L) >> 16; \

78 }

	)

82 
	#MUL_ROUND
(
c
,
x
) { \

83 
x
 = ()(xè* ()(
c
); \

84 
x
 = ((x)+(1l<<(
CONST_FRAC_BITS
-1))) >> CONST_FRAC_BITS; \

85 }

	)

106 
	$dù_fÜw¬d
 (*
block_p
)

108 
	#CONST_FRAC_BITS
 14

	)

110 
	#CONST_1
 (23170/2è

	)

111 
	#CONST_2
 (17734/2)

	)

112 
	#CONST_3
 (23170/2)

	)

113 
	#CONST_4
 (42813/2è

	)

114 
	#CONST_5
 (12540/2)

	)

116 *
d©a_p
;

117 
d0
, 
d1
, 
d2
, 
d3
, 
d4
, 
d5
, 
d6
, 
d7
;

123 
d©a_p
=
block_p
; data_p<block_p+64; data_p+=8)

125 
d0
 = 
d©a_p
[0];

126 
d1
 = 
d©a_p
[1];

127 
d2
 = 
d©a_p
[2];

128 
d3
 = 
d©a_p
[3];

129 
d4
 = 
d©a_p
[4];

130 
d5
 = 
d©a_p
[5];

131 
d6
 = 
d©a_p
[6];

132 
d7
 = 
d©a_p
[7];

134 
	`SUB_AND_ADD
 (
d0
, 
d7
)

135 
	`SUB_AND_ADD
 (
d1
, 
d6
)

136 
	`SUB_AND_ADD
 (
d2
, 
d5
)

137 
	`SUB_AND_ADD
 (
d4
, 
d3
)

139 
	`SUB_AND_ADD
 (
d7
, 
d3
)

140 
	`SUB_AND_ADD
 (
d6
, 
d5
)

142 
	`SUB_AND_ADD
 (
d3
, 
d5
)

143 
d©a_p
[4] = 
d3
;

144 
d©a_p
[0] = 
d5
;

146 
d6
 +ğ
d7
;

147 
	`MUL_ROUND
 (
CONST_1
, 
d6
)

148 
	`SUB_AND_ADD
 (
d7
, 
d6
)

149 
d©a_p
[6] = 
d7
;

150 
d©a_p
[2] = 
d6
;

154 
d7
 = 
d1
 + 
d2
;

155 
	`MUL_ROUND
 (
CONST_3
, 
d7
)

156 
d1
 +ğ
d0
;

157 
	`SUB_AND_ADD
 (
d0
, 
d7
)

158 
d4
 -ğ
d2
;

159 
d6
 = 
d1
 + 
d4
;

160 
	`MUL_ROUND
 (
CONST_5
, 
d6
)

161 
	`MUL_ROUND
 (
CONST_4
, 
d1
)

162 
d1
 -ğ
d6
;

164 
	`SUB_AND_ADD
 (
d7
, 
d1
)

165 
d©a_p
[7] = 
d7
;

166 
d©a_p
[1] = 
d1
;

168 
	`MUL_ROUND
 (
CONST_2
, 
d4
)

169 
d4
 +ğ
d6
;

170 
	`SUB_AND_ADD
 (
d0
, 
d4
)

171 
d©a_p
[5] = 
d0
;

172 
d©a_p
[3] = 
d4
;

179 
d©a_p
=
block_p
; data_p<block_p+8; data_p++)

181 
d0
 = 
d©a_p
[0*8];

182 
d7
 = 
d©a_p
[7*8];

183 
	`SUB_AND_ADD
 (
d0
, 
d7
)

185 
d4
 = 
d©a_p
[4*8];

186 
d3
 = 
d©a_p
[3*8];

187 
	`SUB_AND_ADD
 (
d4
, 
d3
)

189 
d1
 = 
d©a_p
[1*8];

190 
d6
 = 
d©a_p
[6*8];

191 
	`SUB_AND_ADD
 (
d1
, 
d6
)

193 
d2
 = 
d©a_p
[2*8];

194 
d5
 = 
d©a_p
[5*8];

195 
	`SUB_AND_ADD
 (
d2
, 
d5
)

197 
	`SUB_AND_ADD
 (
d7
, 
d3
)

198 
	`SUB_AND_ADD
 (
d6
, 
d5
)

200 
	`SUB_AND_ADD
 (
d3
, 
d5
)

201 
d©a_p
[4*8] = 
d3
;

202 
d©a_p
[0*8] = 
d5
;

204 
d6
 +ğ
d7
;

205 
	`MUL_ROUND
 (
CONST_1
, 
d6
)

206 
	`SUB_AND_ADD
 (
d7
, 
d6
)

207 
d©a_p
[6*8] = 
d7
;

208 
d©a_p
[2*8] = 
d6
;

212 
d7
 = 
d1
 + 
d2
;

213 
	`MUL_ROUND
 (
CONST_3
, 
d7
)

214 
d1
 +ğ
d0
;

215 
	`SUB_AND_ADD
 (
d0
, 
d7
)

216 
d4
 -ğ
d2
;

217 
d6
 = 
d1
 + 
d4
;

218 
	`MUL_ROUND
 (
CONST_5
, 
d6
)

219 
	`MUL_ROUND
 (
CONST_4
, 
d1
)

220 
d1
 -ğ
d6
;

222 
	`SUB_AND_ADD
 (
d7
, 
d1
)

223 
d©a_p
[7*8] = 
d7
;

224 
d©a_p
[1*8] = 
d1
;

226 
	`MUL_ROUND
 (
CONST_2
, 
d4
)

227 
d4
 +ğ
d6
;

228 
	`SUB_AND_ADD
 (
d0
, 
d4
)

229 
d©a_p
[5*8] = 
d0
;

230 
d©a_p
[3*8] = 
d4
;

233 #undeà
CONST_FRAC_BITS


234 #undeà
CONST_1


235 #undeà
CONST_2


236 #undeà
CONST_3


237 #undeà
CONST_4


238 #undeà
CONST_5


239 
	}
}

260 
	$dù_šv”£
 (*
block_p
)

262 
	#CONST_FRAC_BITS
 13

	)

264 
	#CONST_1
 ((46341+2)/4è

	)

265 
	#CONST_2
 ((85627+2)/4)

	)

266 
	#CONST_3
 ((46341+2)/4)

	)

267 
	#CONST_4
 ((35468+2)/4)

	)

268 
	#CONST_5
 ((25080+2)/4)

	)

270 *
d©a_p
;

271 
d0
, 
d1
, 
d2
, 
d3
, 
d4
, 
d5
, 
d6
, 
d7
, 
tmp
;

277 
d©a_p
=
block_p
; data_p<block_p+8; data_p++)

279 
d0
 = 
d©a_p
[0*8];

280 
d4
 = 
d©a_p
[4*8];

281 
	`SUB_AND_ADD
 (
d0
, 
d4
)

283 
d1
 = 
d©a_p
[1*8];

284 
d7
 = 
d©a_p
[7*8];

285 
	`SUB_AND_ADD
 (
d1
, 
d7
)

287 
d2
 = 
d©a_p
[2*8];

288 
d6
 = 
d©a_p
[6*8];

289 
	`SUB_AND_ADD
 (
d2
, 
d6
)

291 
d5
 = 
d©a_p
[5*8];

292 
d3
 = 
d©a_p
[3*8];

293 
	`SUB_AND_ADD
 (
d5
, 
d3
)

295 
	`MUL_ROUND
 (
CONST_1
, 
d2
)

296 
d2
 -ğ
d6
;

297 
	`SUB_AND_ADD
 (
d0
, 
d2
)

298 
	`SUB_AND_ADD
 (
d4
, 
d6
)

299 
	`SUB_AND_ADD
 (
d7
, 
d3
)

301 
tmp
 = 
d3
;

302 
	`SUB_AND_ADD
 (
d6
, 
d3
)

303 
d©a_p
[7*8] = 
d6
;

304 
d©a_p
[0*8] = 
d3
;

306 
d6
 = 
d5
 - 
d1
;

307 
	`MUL_ROUND
 (
CONST_5
, 
d6
);

308 
	`MUL_ROUND
 (
CONST_4
, 
d1
)

309 
d1
 -ğ
d6
;

310 
d1
 -ğ
tmp
;

311 
	`MUL_ROUND
 (
CONST_3
, 
d7
)

312 
d7
 -ğ
d1
;

313 
	`MUL_ROUND
 (
CONST_2
, 
d5
)

314 
d6
 -ğ
d5
;

315 
d6
 +ğ
d7
;

317 
	`SUB_AND_ADD
 (
d2
, 
d1
)

318 
d©a_p
[6*8] = 
d2
;

319 
d©a_p
[1*8] = 
d1
;

321 
	`SUB_AND_ADD
 (
d0
, 
d7
)

322 
d©a_p
[5*8] = 
d0
;

323 
d©a_p
[2*8] = 
d7
;

325 
	`SUB_AND_ADD
 (
d4
, 
d6
)

326 
d©a_p
[3*8] = 
d4
;

327 
d©a_p
[4*8] = 
d6
;

334 
d©a_p
=
block_p
; data_p<block_p+64; data_p+=8)

336 
d0
 = 
d©a_p
[0];

337 
d1
 = 
d©a_p
[1];

338 
d2
 = 
d©a_p
[2];

339 
d3
 = 
d©a_p
[3];

340 
d4
 = 
d©a_p
[4];

341 
d5
 = 
d©a_p
[5];

342 
d6
 = 
d©a_p
[6];

343 
d7
 = 
d©a_p
[7];

345 
	`SUB_AND_ADD
 (
d0
, 
d4
)

346 
	`SUB_AND_ADD
 (
d1
, 
d7
)

347 
	`SUB_AND_ADD
 (
d2
, 
d6
)

348 
	`SUB_AND_ADD
 (
d5
, 
d3
)

350 
	`MUL_ROUND
 (
CONST_1
, 
d2
)

351 
d2
 -ğ
d6
;

352 
	`SUB_AND_ADD
 (
d0
, 
d2
)

353 
	`SUB_AND_ADD
 (
d4
, 
d6
)

354 
	`SUB_AND_ADD
 (
d7
, 
d3
)

356 
tmp
 = 
d3
;

357 
	`SUB_AND_ADD
 (
d6
, 
d3
)

358 
d©a_p
[7] = 
d6
;

359 
d©a_p
[0] = 
d3
;

361 
d6
 = 
d5
 - 
d1
;

362 
	`MUL_ROUND
 (
CONST_5
, 
d6
)

363 
	`MUL_ROUND
 (
CONST_4
, 
d1
)

364 
d1
 -ğ
d6
;

365 
d1
 -ğ
tmp
;

366 
	`MUL_ROUND
 (
CONST_3
, 
d7
)

367 
d7
 -ğ
d1
;

368 
	`MUL_ROUND
 (
CONST_2
, 
d5
)

369 
d6
 -ğ
d5
;

370 
d6
 +ğ
d7
;

372 
	`SUB_AND_ADD
 (
d2
, 
d1
)

373 
d©a_p
[6] = 
d2
;

374 
d©a_p
[1] = 
d1
;

376 
	`SUB_AND_ADD
 (
d0
, 
d7
)

377 
d©a_p
[5] = 
d0
;

378 
d©a_p
[2] = 
d7
;

380 
	`SUB_AND_ADD
 (
d4
, 
d6
)

381 
d©a_p
[3] = 
d4
;

382 
d©a_p
[4] = 
d6
;

385 #undeà
CONST_FRAC_BITS


386 #undeà
CONST_1


387 #undeà
CONST_2


388 #undeà
CONST_3


389 #undeà
CONST_4


390 #undeà
CONST_5


391 
	}
}

	@ip/xjpg_dct.h

46 
dù_fÜw¬d
 (*
block_p
);

48 
dù_šv”£
 (*
block_p
);

	@ip/xjpg_dec.c

102 
	~<¡ršg.h
>

103 
	~<as£¹.h
>

105 
	~"hp.h
"

106 
	~"defs.h
"

107 
	~"£tjmp.h
"

108 
	~"xjpg_dù.h
"

109 
	~"xjpg_mrk.h
"

112 
	#DUMP_JPEG
 0

	)

114 #ià
DUMP_JPEG


115 
	~"¡dio.h
"

116 
	~<tch¬.h
>

118 
	#DUMP
(
msg
,
¬g1
,
¬g2
,
¬g3
) \

119 
	`_á´štf
(
¡dout
, 
msg
, ()(
¬g1
), ()(
¬g2
), ()(
¬g3
))

	)

121 
	#DUMP
(
msg
,
¬g1
,
¬g2
,
¬g3
)

	)

126 
	~"¡dio.h
"

127 
	~<tch¬.h
>

128 
	#PRINT
(
msg
,
¬g1
,
¬g2
) \

129 
	`_á´štf
(
¡dout
, 
	`_T
("(j³gè"è
msg
, ()
¬g1
, ()
¬g2
)

	)

131 
	#PRINT
(
msg
,
¬g1
,
¬g2
)

	)

141 
	#MAX_HUFF_TBLS
 4

	)

143 
	#UNEXPECTED_MARKER
 1

	)

144 
	#BAD_MARKER_ID
 2

	)

145 
	#BAD_MARKER_DATA
 3

	)

146 
	#NO_RESTART_MARKER
 4

	)

147 
	#BAD_HUFF_CODE
 5

	)

148 
	#UNEXPECTED_END_OF_DATA
 6

	)

149 
	#NOT_IMPLEMENTED
 7

	)

151 
	#MAX_MARKER_LEN
 15000

	)

152 
	#MAX_HEADER_SIZE
 (
MAX_MARKER_LEN
+2000)

	)

153 
	#MAX_BLOCKS_IN_MCU
 6

	)

154 
	#MAX_MCU_SIZE
 (
MAX_BLOCKS_IN_MCU
*304)

	)

156 
	#INBUF_NUM_MCUS
 2

	)

158 
	#DC_TBL_INDEX_LEN
 9

	)

159 
	#AC_TBL_INDEX_LEN
 12

	)

161 
	#CHECK_VALUE
 0x1û5ÿ7e

	)

172 
BYTE
 
	msize
;

173 
BYTE
 
	mv®ue
;

174 } 
	tmaš_huff_–em_t
;

177 
WORD
 
	mcode
;

178 
BYTE
 
	msize
;

179 
BYTE
 
	mv®ue
;

180 } 
	taux_huff_–em_t
;

183 
BYTE
 *
	mšdex_p
;

184 
maš_huff_–em_t
 *
	mmaš_p
;

185 
aux_huff_–em_t
 *
	maux_p
;

186 } 
	thuff_tbl_t
;

201 
BYTE
 *
	mout_rows_­
[4][32];

205 
IP_IMAGE_TRAITS
 
	mŒa™s
;

206 
BYTE
 
	mnum_comps
;

207 
BYTE
 
	mhÜiz_§mp_çcs
[4];

208 
BYTE
 
	mv”t_§mp_çcs
 [4];

209 
BYTE
 
	mmax_hÜiz_§mp_çc
;

210 
BYTE
 
	mmax_v”t_§mp_çc
;

211 
BYTE
 
	mwhich_quªt_tbl
[4];

212 
UINT
 
	mrows_³r_mcu
;

213 
UINT
 
	mcŞs_³r_mcu
;

214 
UINT
 
	mmcus_³r_row
;

215 
UINT
 
	mrowCouÁOff£t
;

219 
WORD
 
	m»¡¬t_š‹rv®
;

220 
	mquªt_tbls
[4][64];

221 
BYTE
 
	mwhich_dc_tbl
[4];

222 
BYTE
 
	mwhich_ac_tbl
[4];

223 
BOOL
 
	mfCŞÜFax
;

227 
huff_tbl_t
 
	mdc_tbls
[
MAX_HUFF_TBLS
];

228 
huff_tbl_t
 
	mac_tbls
[
MAX_HUFF_TBLS
];

232 
BOOL
 
	mouut_sub§m¶ed
;

233 
BOOL
 
	mfD’®i
;

237 
DWORD
 
	mdwInNextPos
;

238 
DWORD
 
	mdwOutNextPos
;

239 
	mrows_dÚe
;

240 
UINT
 
	mmcus_dÚe
;

241 
BOOL
 
	m£ndšg_rows
;

242 
BOOL
 
	mgÙ_shÜt_h—d”
;

243 
BOOL
 
	mgÙ_EOI
;

244 
BYTE
 
	m»¡¬t_cur_m¬k”
;

245 
WORD
 
	m»¡¬t_cur_mcu
;

246 
	m´iÜ_dc
[4];

247 
jmp_buf
 
	msyÁax_”rÜ
;

248 
jmp_buf
 
	mŞd_syÁax_”rÜ
;

249 
DWORD
 
	mdwV®idChk
;

253 
DWORD
 
	mrd_b™_buf
;

256 
	mrd_b™s_ava
;

259 
BYTE
 *
	mrd_šbuf_beg
;

262 
BYTE
 *
	mrd_šbuf_Ãxt
;

267 
	mblock
[64];

268 *
	mblock_zz
[64+16];

270 } 
	tJDEC_INST
, *
	tPJDEC_INST
;

280 
huff_defše_bË
 (

281 
PJDEC_INST
 
g
,

282 
BOOL
 
ac
,

283 
UINT
 
id
,

284 cÚ¡ 
BYTE
 
couÁs
[16],

285 cÚ¡ 
BYTE
 
v®ues
[]);

287 
wšo_sÿË_bË
 (*
tbl_p
);

320 
	$»ad_š™
 (
PJDEC_INST
 
g
)

322 
g
->
rd_b™s_ava
 = 0;

323 
g
->
rd_b™_buf
 = 0;

324 
	}
}

336 
	$»ad_buf_İ’
 (
PJDEC_INST
 
g
, 
BYTE
 *
buf_p
)

338 
g
->
rd_šbuf_beg
 = 
buf_p
;

339 
g
->
rd_šbuf_Ãxt
 = 
buf_p
;

340 
	}
}

352 
	$»ad_buf_şo£
 (
PJDEC_INST
 
g
)

354  
g
->
rd_šbuf_Ãxt
 - g->
rd_šbuf_beg
;

355 
	}
}

364 
	$rd_sync
 (
PJDEC_INST
 
g
)

366 
g
->
rd_b™s_ava
 = 0;

367 
	}
}

376 
BYTE
 
	$»ad_by‹
 (
PJDEC_INST
 
g
)

378 
	`rd_sync
 (
g
);

379  *(
g
->
rd_šbuf_Ãxt
)++;

380 
	}
}

389 
	$»ad_ušt
 (
PJDEC_INST
 
g
)

391 
UINT
 
uv®
;

393 
	`rd_sync
 (
g
);

394 
uv®
 = ()*(
g
->
rd_šbuf_Ãxt
)++ << 8;

395  
uv®
 | *(
g
->
rd_šbuf_Ãxt
)++;

396 
	}
}

405 
	$»ad_sk_fÜw¬d
 (
PJDEC_INST
 
g
, 
UINT
 
n
)

407 ià(
n
 > 
MAX_MARKER_LEN
)

408 
	`lÚgjmp
 (
g
->
syÁax_”rÜ
, 
BAD_MARKER_DATA
);

409 
	`rd_sync
 (
g
);

410 
g
->
rd_šbuf_Ãxt
 +ğ
n
;

411 
	}
}

420 
	$»ad_sk_backw¬d
 (
PJDEC_INST
 
g
, 
UINT
 
n
)

422 
	`rd_sync
 (
g
);

423 
g
->
rd_šbuf_Ãxt
 -ğ
n
;

424 
	}
}

445 
	#CANT_LOAD_NEAR_MARKER
(
g
) \

446 (
g
->
rd_b™s_ava
<=0 || \

447 (
g
->
rd_b™s_ava
<=7 && (((1u<<g->rd_b™s_ava)-1è& ~g->
rd_b™_buf
è=ğ0))

	)

452 
	#READ_BITS_LOAD
(
g
, 
fixed_Ën
, 
·r_n_b™s
, 
·r_v®ue
, 
h™_m¬k”
) \

454 ià(()(
·r_n_b™s
è> 
g
->
rd_b™s_ava
) { \

455 
BYTE
 
a_by‹
; \

458 
a_by‹
 = *(
g
->
rd_šbuf_Ãxt
)++; \

459 
	`DUMP
 (
	`_T
("<%02x>"), 
a_by‹
, 0, 0); \

461 ià(
a_by‹
 =ğ(
BYTE
 )0xffu) { \

462 ià(*(
g
->
rd_šbuf_Ãxt
)++ != 0) { \

463 
g
->
rd_šbuf_Ãxt
 -= 2; \

464 ià(
	`CANT_LOAD_NEAR_MARKER
(
g
)) \

465 
h™_m¬k”
; \

470 
g
->
rd_b™_buf
 = (g->rd_b™_buf<<8è| 
a_by‹
; \

471 
g
->
rd_b™s_ava
 += 8; \

472 } 
g
->
rd_b™s_ava
 <= 24); \

475 
·r_v®ue
 = (
g
->
rd_b™_buf
 << (32-g->
rd_b™s_ava
)è>> (32-(
·r_n_b™s
)); \

476 }

	)

485 
	#READ_BITS_ADVANCE
(
g
, 
·r_n_b™s
) \

487 
g
->
rd_b™s_ava
 -ğ
·r_n_b™s
; \

488 }

	)

517 
UINT
 
	$·r£_çùÜs
 (

518 
UINT
 
çùÜs
,

519 
BYTE
 
çc_¬¿y
[4])

521 
i
;

522 
UINT
 
çc
;

523 
UINT
 
max_çc
;

525 
max_çc
 = 0;

527 
i
=3; i>=0; i--) {

528 
çc
 = 
çùÜs
 & 0x000fu;

529 
çùÜs
 >>= 4;

530 ià(
çc
 > 
max_çc
) max_fac = fac;

531 
çc_¬¿y
[
i
] = 
çc
;

534  
max_çc
;

535 
	}
}

548 
	$ÿlc_quªt_bË
 (

549 
PJDEC_INST
 
g
,

550 
UINT
 
dc_q_çc
,

551 
UINT
 
ac_q_çc
,

552 cÚ¡ 
BYTE
 *
Üig_tbl_p
,

553 
UINT
 
which_q_tbl
)

555 
i
;

556 
UINT
 
quªt
;

557 *
tbl_p
;

559 
tbl_p
 = 
g
->
quªt_tbls
[
which_q_tbl
];

561 
i
=0; i<64; i++) {

562 
quªt
 = ((*
Üig_tbl_p
++)*(
i
==0 ? 
dc_q_çc
 : 
ac_q_çc
) + 25u) / 50u;

563 ià(
quªt
 == 0) quant = 1;

564 ià(
quªt
 > 255) quant = 255;

565 
tbl_p
[
i
] = 
quªt
;

568 
	`wšo_sÿË_bË
 (
tbl_p
);

569 
	}
}

578 
UINT
 
	$m¬_g‘
 (
PJDEC_INST
 
g
)

580 
UINT
 
m¬k”
 = 0;

581 
BOOL
 
gÙ_ff
;

583 
gÙ_ff
 = 
FALSE
;

585 
TRUE
) {

586 
m¬k”
 = 
	`»ad_by‹
 (
g
);

587 ià(
m¬k”
 =ğ0xffè
gÙ_ff
 = 
TRUE
;

591 ià(!
gÙ_ff
 || 
m¬k”
==0)

592 
	`lÚgjmp
 (
g
->
syÁax_”rÜ
, 
BAD_MARKER_ID
);

594  
m¬k”
;

595 
	}
}

604 
	$m¬_æush
 (
PJDEC_INST
 
g
, 
UINT
 
m¬k”
)

606 ià(
m¬k”
==
MARKER_SOI
 || m¬k”==
MARKER_EOI
 ||

607 (
m¬k”
>=
MARKER_RST0
 && m¬k”<=
MARKER_RST7
))

610 
	`»ad_sk_fÜw¬d
 (
g
, 
	`»ad_ušt
(g) - 2);

611 
	}
}

623 
	$·r£_­p_jfif
 (
PJDEC_INST
 
g
)

625 
UINT
 
Ën
;

626 
BYTE
 
byt
;

627 
UINT
 
h_dpi
, 
v_dpi
;

629 
Ën
 = 
	`»ad_ušt
 (
g
);

630 
byt
 = 
	`»ad_by‹
 (
g
);

631 ià(! (
Ën
==16 && (
byt
==(
BYTE
 )'J' || byt==(BYTE )'j'))) {

633 
	`»ad_sk_fÜw¬d
 (
g
, 
Ën
-3);

637 
	`»ad_sk_fÜw¬d
 (
g
,6);

638 
byt
 = 
	`»ad_by‹
 (
g
);

639 
h_dpi
 = 
	`»ad_ušt
 (
g
);

640 
v_dpi
 = 
	`»ad_ušt
 (
g
);

641 
	`»ad_sk_fÜw¬d
 (
g
,2);

643 ià(
byt
 == 1) {

644 
g
->
Œa™s
.
lHÜizDPI
 = (
DWORD
)
h_dpi
 << 16;

645 
g
->
Œa™s
.
lV”tDPI
 = (
DWORD
)
v_dpi
 << 16;

647 
	}
}

659 
	$·r£_­p_g3çx
 (
PJDEC_INST
 
g
)

661 
i
;

662 
UINT
 
Ën
, 
dpi
;

663 
BYTE
 
id_v”
[8];

664 cÚ¡ 
BYTE
 
v®id_id_v”
[8] = {

668 
Ën
 = 
	`»ad_ušt
 (
g
);

669 ià(
Ën
 != 12) {

671 
	`»ad_sk_fÜw¬d
 (
g
, 
Ën
-2);

675 
i
=0; i<8; i++)

676 
id_v”
[
i
] = 
	`»ad_by‹
 (
g
);

678 
dpi
 = 
	`»ad_ušt
 (
g
);

680 ià(
	`memcmp
(
id_v”
,
v®id_id_v”
,8) == 0

681 && (
dpi
==200 || dpi==300 || dpi==400)) {

683 
g
->
Œa™s
.
lHÜizDPI
 = g->Œa™s.
lV”tDPI
 = ()
dpi
 << 16;

684 
g
->
fCŞÜFax
 = 
TRUE
;

686 
	}
}

695 
	$·r£_­p_shÜt_h—d”
 (
PJDEC_INST
 
g
)

700 cÚ¡ 
BYTE
 
Üig_lum_quªt
[64] = {

712 cÚ¡ 
BYTE
 
Üig_chrom_quªt
[64] = {

723 cÚ¡ 
BYTE
 
lum_DC_couÁs
[16] = {

728 cÚ¡ 
BYTE
 
lum_DC_v®ues
[12] = {

732 cÚ¡ 
BYTE
 
chrom_DC_couÁs
[16] = {

737 cÚ¡ 
BYTE
 
chrom_DC_v®ues
[12] = {

741 cÚ¡ 
BYTE
 
lum_AC_couÁs
[16] = {

746 cÚ¡ 
BYTE
 
lum_AC_couÁs_D’®i
[16] = {

761 cÚ¡ 
BYTE
 
lum_AC_v®ues
[162] = {

785 cÚ¡ 
BYTE
 
chrom_AC_couÁs
[16] = {

790 cÚ¡ 
BYTE
 
chrom_AC_v®ues
[162] = {

814 
UINT
 
Ën
;

815 
UINT
 
dc_q_çc
, 
ac_q_çc
;

816 
UINT
 
»£rved
;

820 
g
->
»¡¬t_š‹rv®
 = 0;

822 
g
->
which_quªt_tbl
[0] = 0;

823 
g
->
which_quªt_tbl
[1] = 1;

824 
g
->
which_quªt_tbl
[2] = 1;

826 
g
->
which_dc_tbl
[0] = 0;

827 
g
->
which_ac_tbl
[0] = 0;

828 
g
->
which_dc_tbl
[1] = 1;

829 
g
->
which_ac_tbl
[1] = 1;

830 
g
->
which_dc_tbl
[2] = 1;

831 
g
->
which_ac_tbl
[2] = 1;

833 
	`huff_defše_bË
 (
g
, 
FALSE
, 0, 
lum_DC_couÁs
 , 
lum_DC_v®ues
);

834 
	`huff_defše_bË
 (
g
, 
TRUE
 , 0, g->
fD’®i
 ? 
lum_AC_couÁs_D’®i


835 : 
lum_AC_couÁs
, 
lum_AC_v®ues
);

836 
	`huff_defše_bË
 (
g
, 
FALSE
, 1, 
chrom_DC_couÁs
, 
chrom_DC_v®ues
);

837 
	`huff_defše_bË
 (
g
, 
TRUE
 , 1, 
chrom_AC_couÁs
, 
chrom_AC_v®ues
);

841 
Ën
 = 
	`»ad_ušt
 (
g
);

842 ià(
Ën
 != 18)

843 
	`lÚgjmp
 (
g
->
syÁax_”rÜ
, 
BAD_MARKER_DATA
);

845 
g
->
Œa™s
.
lNumRows
 = 
	`»ad_ušt
 (g);

846 
g
->
Œa™s
.
iPix–sP”Row
 = 
	`»ad_ušt
 (g);

847 
g
->
Œa™s
.
lHÜizDPI
 = ()
	`»ad_ušt
(g) << 16;

848 
g
->
Œa™s
.
lV”tDPI
 = ()
	`»ad_ušt
(g) << 16;

849 
ac_q_çc
 = 
	`»ad_by‹
 (
g
);

850 
g
->
num_comps
 = 
	`»ad_by‹
 (g);

851 
g
->
max_hÜiz_§mp_çc
 = 
	`·r£_çùÜs
 (
	`»ad_ušt
(g), g->
hÜiz_§mp_çcs
);

852 
g
->
max_v”t_§mp_çc
 = 
	`·r£_çùÜs
 (
	`»ad_ušt
(g), g->
v”t_§mp_çcs
);

853 
dc_q_çc
 = 
	`»ad_by‹
 (
g
);

854 
»£rved
 = 
	`»ad_by‹
 (
g
);

856 
g
->
Œa™s
.
iCompÚ’tsP”Pix–
 = g->
num_comps
;

857 
g
->
Œa™s
.
iB™sP”Pix–
 = g->
num_comps
 * 8;

858 ià(
g
->
Œa™s
.
lNumRows
 == 0)

859 
g
->
Œa™s
.
lNumRows
 = -1;

860 ià(
dc_q_çc
 == 0)

861 
dc_q_çc
 = 
ac_q_çc
;

863 
	`ÿlc_quªt_bË
 (
g
, 
dc_q_çc
, 
ac_q_çc
, 
Üig_lum_quªt
, 0);

864 
	`ÿlc_quªt_bË
 (
g
, 
dc_q_çc
, 
ac_q_çc
, 
Üig_chrom_quªt
, 1);

866 
g
->
gÙ_shÜt_h—d”
 = 
TRUE
;

867 
	}
}

879 
	$m¬_·r£_­p
 (
PJDEC_INST
 
g
, 
UINT
 
m¬k”
)

881 
UINT
 
Ën
;

882 
BYTE
 
id1
, 
id2
, 
id3
;

884 
Ën
 = 
	`»ad_ušt
 (
g
);

885 ià(
Ën
 <= 5) {

887 
	`»ad_sk_fÜw¬d
 (
g
, 
Ën
-2);

891 
id1
 = 
	`»ad_by‹
 (
g
);

892 
id2
 = 
	`»ad_by‹
 (
g
);

893 
id3
 = 
	`»ad_by‹
 (
g
);

894 
	`»ad_sk_backw¬d
 (
g
, 5);

896 ià(
m¬k”
==
MARKER_APP
+1 && 
id1
==0x47 && 
id2
==0x33 && 
id3
==0x46) {

898 
	`·r£_­p_g3çx
 (
g
);

899 } ià(
m¬k”
==
MARKER_APP
+0 && (
id1
=='J' || id1=='j')

900 && (
id2
=='F' || id2=='f'è&& (
id3
=='I' || id3=='i')) {

902 
	`·r£_­p_jfif
 (
g
);

903 } ià(
m¬k”
==
MARKER_APP
+1 && 
Ën
==18) {

905 
	`·r£_­p_shÜt_h—d”
 (
g
);

908 
	`»ad_sk_fÜw¬d
 (
g
, 
Ën
);

910 
	}
}

927 
	$m¬_·r£_sof
 (
PJDEC_INST
 
g
, 
UINT
 
m¬k”
)

929 
UINT
 
Ën
;

930 
UINT
 
uB™sP”Comp
;

931 
UINT
 
comp
;

932 
BYTE
 
comp_id
;

933 
BYTE
 
hv_§mp
;

934 
BYTE
 
q_bË
;

935 
BYTE
 
h
, 
v
;

937 
Ën
 = 
	`»ad_ušt
 (
g
);

938 
uB™sP”Comp
 = 
	`»ad_by‹
 (
g
);

939 
g
->
rowCouÁOff£t
=g->
rd_šbuf_Ãxt
-g->
rd_šbuf_beg
;

940 
g
->
Œa™s
.
lNumRows
 = 
	`»ad_ušt
 (g);

941 
g
->
Œa™s
.
iPix–sP”Row
 = 
	`»ad_ušt
 (g);

942 
g
->
Œa™s
.
iCompÚ’tsP”Pix–
 = g->
num_comps
 = 
	`»ad_by‹
 (g);

943 
g
->
Œa™s
.
iB™sP”Pix–
 = g->
num_comps
 * 
uB™sP”Comp
;

945 ià(
g
->
Œa™s
.
lNumRows
 == 0)

946 
g
->
Œa™s
.
lNumRows
 = -1;

948 ià(
Ën
 !ğ(8u + 3u*
g
->
num_comps
) || g->num_comps==0)

949 
	`lÚgjmp
 (
g
->
syÁax_”rÜ
, 
BAD_MARKER_DATA
);

952 ià((
m¬k”
!=
MARKER_SOF0
 && marker!=MARKER_SOF0+1)

953 || 
uB™sP”Comp
!=8 || 
g
->
num_comps
>4)

954 
	`lÚgjmp
 (
g
->
syÁax_”rÜ
, 
NOT_IMPLEMENTED
);

956 
g
->
max_hÜiz_§mp_çc
 = 1;

957 
g
->
max_v”t_§mp_çc
 = 1;

959 #ià
DUMP_JPEG


960 
	`_á´štf
 (
¡d”r
, 
	`_T
("\nSOF marker:\n"));

961 
	`_á´štf
 (
¡d”r
, 
	`_T
(" b™ ³¸§m¶ğ%d\n"), 
uB™sP”Comp
);

962 
	`_á´štf
 (
¡d”r
, 
	`_T
("‚umb” oàrow  = %d\n"), 
g
->
Œa™s
.
lNumRows
);

963 
	`_á´štf
 (
¡d”r
, 
	`_T
("…ix– ³¸row = %d\n"), 
g
->
Œa™s
.
iPix–sP”Row
);

964 
	`_á´štf
 (
¡d”r
, 
	`_T
(" # compÚ’t  = %d\n"), 
g
->
num_comps
);

967 
comp
=0; comp<
g
->
num_comps
; comp++) {

968 
comp_id
 = 
	`»ad_by‹
 (
g
);

969 
hv_§mp
 = 
	`»ad_by‹
 (
g
);

970 
q_bË
 = 
	`»ad_by‹
 (
g
);

972 #ià
DUMP_JPEG


973 
	`_á´štf
 (
¡d”r
,

974 
	`_T
(" %d: comp id = %d, hv samp fac = %02x, which q = %d\n"),

975 
comp
, 
comp_id
, 
hv_§mp
, 
q_bË
);

978 
g
->
hÜiz_§mp_çcs
[
comp
] = 
h
 = 
hv_§mp
 >> 4;

979 
g
->
v”t_§mp_çcs
 [
comp
] = 
v
 = 
hv_§mp
 & 0x0fu;

980 
g
->
which_quªt_tbl
[
comp
] = 
q_bË
;

982 ià(
h
 > 
g
->
max_hÜiz_§mp_çc
) g->max_horiz_samp_fac = h;

983 ià(
v
 > 
g
->
max_v”t_§mp_çc
 ) g->max_vert_samp_fac = v;

985 
	}
}

997 
	$m¬_·r£_dqt
 (
PJDEC_INST
 
g
)

999 
Ën
, 
i
;

1000 
BYTE
 
±
;

1001 *
tbl_p
;

1003 
Ën
 = 
	`»ad_ušt
(
g
) - 2;

1005 
Ën
 >= 65) {

1006 
Ën
 -= 65;

1007 
±
 = 
	`»ad_by‹
 (
g
);

1008 ià((
±
 & 0xfcu) != 0)

1009 
	`lÚgjmp
 (
g
->
syÁax_”rÜ
, 
NOT_IMPLEMENTED
);

1010 
tbl_p
 = 
g
->
quªt_tbls
[
±
 & 3];

1011 
	`DUMP
 (
	`_T
("\nDQT m¬k”:abË=%d"), 
±
 & 3, 0, 0);

1012 
i
=0; i<64; i++) {

1013 ià((
i
 & 15è=ğ0è
	`DUMP
(
	`_T
("\n "), 0,0,0);

1014 
tbl_p
[
i
] = 
	`»ad_by‹
 (
g
);

1015 
	`DUMP
 (
	`_T
("%2d "), 
tbl_p
[
i
], 0, 0);

1017 
	`DUMP
 (
	`_T
("\n"), 0,0,0);

1018 
	`wšo_sÿË_bË
 (
tbl_p
);

1021 ià(
Ën
 != 0)

1022 
	`lÚgjmp
 (
g
->
syÁax_”rÜ
, 
BAD_MARKER_DATA
);

1023 
	}
}

1035 
	$m¬_·r£_dht
 (
PJDEC_INST
 
g
)

1037 
BYTE
 
num_codes
[16];

1038 
BYTE
 
v®ues
[256];

1040 
Ën
, 
i
, 
tÙ_codes
;

1041 
BYTE
 
şass_id
;

1043 
Ën
 = 
	`»ad_ušt
(
g
) - 2;

1045 
Ën
 > 17) {

1046 
şass_id
 = 
	`»ad_by‹
 (
g
);

1048 
tÙ_codes
=0, 
i
=0; i<=15; i++) {

1049 
num_codes
[
i
] = 
	`»ad_by‹
 (
g
);

1050 
tÙ_codes
 +ğ
num_codes
[
i
];

1053 
Ën
 -= 17;

1054 ià(
Ën
 < 
tÙ_codes
)

1055 
	`lÚgjmp
 (
g
->
syÁax_”rÜ
, 
BAD_MARKER_DATA
);

1057 
i
=0; i<
tÙ_codes
; i++)

1058 
v®ues
[
i
] = 
	`»ad_by‹
 (
g
);

1059 
Ën
 -ğ
tÙ_codes
;

1061 #ià
DUMP_JPEG


1062 
	`_á´štf
 (
¡d”r
, 
	`_T
("\nDHT marker: class=%d, id=%d\n counts = "),

1063 (
BOOL
 )(
şass_id
>>4), class_id & 0x0f);

1064 
i
=0; i<16; i++)

1065 
	`_á´štf
 (
¡d”r
, 
	`_T
("%2d "), 
num_codes
[
i
]);

1066 
	`_á´štf
 (
¡d”r
, 
	`_T
("\n values = "));

1067 
i
=0; i<
tÙ_codes
; i++)

1068 
	`_á´štf
 (
¡d”r
, 
	`_T
("%02x "), 
v®ues
[
i
]);

1069 
	`_á´štf
 (
¡d”r
, 
	`_T
("\n"));

1072 
	`huff_defše_bË
 (
g
, (
BOOL
)(
şass_id
>>4), class_id & 0x0f,

1073 
num_codes
, 
v®ues
);

1076 ià(
Ën
 != 0)

1077 
	`lÚgjmp
 (
g
->
syÁax_”rÜ
, 
BAD_MARKER_DATA
);

1078 
	}
}

1090 
	$m¬_·r£_dri
 (
PJDEC_INST
 
g
)

1092 
UINT
 
Ën
;

1094 
Ën
 = 
	`»ad_ušt
 (
g
);

1095 ià(
Ën
 != 4)

1096 
	`lÚgjmp
 (
g
->
syÁax_”rÜ
, 
BAD_MARKER_DATA
);

1098 
g
->
»¡¬t_š‹rv®
 = 
	`»ad_ušt
 (g);

1099 
	`DUMP
 (
	`_T
("\nDRI m¬k”:„e¡¬ˆš‹rv® = %d\n"), 
g
->
»¡¬t_š‹rv®
, 0,0);

1100 
	}
}

1109 
	$m¬_·r£_sos
 (
PJDEC_INST
 
g
)

1111 
UINT
 
Ën
;

1112 
UINT
 
comp
;

1113 
UINT
 
cs
;

1114 
UINT
 
dc_ac
;

1116 
Ën
 = 
	`»ad_ušt
 (
g
);

1117 ià(
Ën
 !ğ6u+2u*
g
->
num_comps
)

1118 
	`lÚgjmp
 (
g
->
syÁax_”rÜ
, 
BAD_MARKER_DATA
);

1120 
	`»ad_by‹
 (
g
);

1122 
	`DUMP
 (
	`_T
("\nSOS marker:\n"), 0,0,0);

1124 
comp
=0; comp<
g
->
num_comps
; comp++) {

1125 
cs
 = 
	`»ad_by‹
 (
g
);

1126 
dc_ac
 = 
	`»ad_by‹
 (
g
);

1127 
	`DUMP
 (
	`_T
(" %d: c ğ%d, which dc_aøtbÈğ%02x\n"), 
comp
, 
cs
, 
dc_ac
);

1128 
g
->
which_dc_tbl
[
comp
] = 
dc_ac
 >> 4;

1129 
g
->
which_ac_tbl
[
comp
] = 
dc_ac
 & 0x0fu;

1132 
	`»ad_by‹
 (
g
);

1133 
	`»ad_by‹
 (
g
);

1134 
	`»ad_by‹
 (
g
);

1135 
	}
}

1147 
	$m¬_·r£_dÆ
 (
PJDEC_INST
 
g
)

1149 
UINT
 
Ën
, 
nRows
;

1151 
Ën
 = 
	`»ad_ušt
 (
g
);

1152 
nRows
 = 
	`»ad_ušt
 (
g
);

1154 ià(
Ën
!=4u || 
nRows
==0)

1155 
	`lÚgjmp
 (
g
->
syÁax_”rÜ
, 
BAD_MARKER_DATA
);

1157 
	`DUMP
 (
	`_T
("\nDNL m¬k”: %d\n"), 
nRows
,0,0);

1158 
g
->
Œa™s
.
lNumRows
 = 
nRows
;

1159 
	}
}

1168 
	$m¬_·r£
 (
PJDEC_INST
 
g
, 
UINT
 
m¬k”
)

1170 
	`PRINT
 (
	`_T
("m¬_·r£: m¬k” = %02xh\n"), 
m¬k”
, 0);

1172 
m¬k”
)

1174 
MARKER_APP
+0:

1175 
MARKER_APP
+1:

1176 
MARKER_APP
+2:

1177 
MARKER_APP
+3:

1178 
MARKER_APP
+4:

1179 
MARKER_APP
+5:

1180 
MARKER_APP
+6:

1181 
MARKER_APP
+7:

1182 
MARKER_APP
+8:

1183 
MARKER_APP
+9:

1184 
MARKER_APP
+10:

1185 
MARKER_APP
+11:

1186 
MARKER_APP
+12:

1187 
MARKER_APP
+13:

1188 
MARKER_APP
+14:

1189 
MARKER_APP
+15:

1190 
	`m¬_·r£_­p
 (
g
, 
m¬k”
);

1193 
MARKER_COM
:

1194 
MARKER_JPG
+0:

1195 
MARKER_JPG
+1:

1196 
MARKER_JPG
+2:

1197 
MARKER_JPG
+3:

1198 
MARKER_JPG
+4:

1199 
MARKER_JPG
+5:

1200 
MARKER_JPG
+6:

1201 
MARKER_JPG
+7:

1202 
MARKER_JPG
+8:

1203 
MARKER_JPG
+9:

1204 
MARKER_JPG
+10:

1205 
MARKER_JPG
+11:

1206 
MARKER_JPG
+12:

1207 
MARKER_JPG
+13:

1208 
	`m¬_æush
 (
g
, 
m¬k”
);

1211 
MARKER_SOF0
:

1212 
MARKER_SOF1
:

1213 
MARKER_SOF2
:

1214 
MARKER_SOF3
:

1215 
MARKER_SOF5
:

1216 
MARKER_SOF6
:

1217 
MARKER_SOF7
:

1218 
MARKER_SOF8
:

1219 
MARKER_SOF9
:

1220 
MARKER_SOFA
:

1221 
MARKER_SOFB
:

1222 
MARKER_SOFD
:

1223 
MARKER_SOFE
:

1224 
MARKER_SOFF
:

1225 
	`m¬_·r£_sof
 (
g
, 
m¬k”
);

1228 
MARKER_RST0
:

1229 
MARKER_RST1
:

1230 
MARKER_RST2
:

1231 
MARKER_RST3
:

1232 
MARKER_RST4
:

1233 
MARKER_RST5
:

1234 
MARKER_RST6
:

1235 
MARKER_RST7
:

1236 
	`DUMP
 (
	`_T
("\nRST marker.\n"), 0,0,0);

1239 
MARKER_DHT
: 
	`m¬_·r£_dht
 (
g
); ;

1240 
MARKER_DQT
: 
	`m¬_·r£_dqt
 (
g
); ;

1241 
MARKER_DRI
: 
	`m¬_·r£_dri
 (
g
); ;

1242 
MARKER_SOS
: 
	`m¬_·r£_sos
 (
g
); ;

1243 
MARKER_DNL
: 
	`m¬_·r£_dÆ
 (
g
); ;

1245 
MARKER_DAC
:

1246 
MARKER_DHP
:

1247 
MARKER_EXP
:

1248 
	`lÚgjmp
 (
g
->
syÁax_”rÜ
, 
NOT_IMPLEMENTED
);

1253 
MARKER_SOI
:

1254 
	`DUMP
 (
	`_T
("\nSOI marker.\n"), 0,0,0);

1257 
MARKER_EOI
:

1258 
	`DUMP
 (
	`_T
("\nEOI marker.\n"), 0,0,0);

1262 
	`lÚgjmp
 (
g
->
syÁax_”rÜ
, 
BAD_MARKER_DATA
);

1264 
	}
}

1292 
	#DECODE_HUFF
( \

1293 
g
, \

1294 
huff_tbl_p
, \

1295 
maš_ix_Ën
, \

1296 
·r_»suÉ
, \

1297 
h™_m¬k”
) \

1299 
UINT
 
tbl_šdex
, 
code
, 
size
; \

1300 
maš_huff_–em_t
 *
–em
; \

1302 
	`READ_BITS_LOAD
 (
g
, 
FALSE
, 
maš_ix_Ën
, 
code
, 
h™_m¬k”
) \

1303 
tbl_šdex
 = 
huff_tbl_p
->
šdex_p
[
code
]; \

1304 
–em
 = &(
huff_tbl_p
->
maš_p
[
tbl_šdex
]); \

1305 
·r_»suÉ
 = 
–em
->
v®ue
; \

1306 
size
 = 
–em
->size; \

1308 ià(
size
 == 0) { \

1309 
·r_»suÉ
 = 
	`·r£_aux_code
 (
g
, 
huff_tbl_p
->
aux_p
); \

1311 
	`DUMP
 (
	`_T
(" %2d-%04x-%3d(mašè "), 
size
, 
code
, 
·r_»suÉ
); \

1312 
	`READ_BITS_ADVANCE
 (
g
, 
size
) \

1314 }

	)

1326 
UINT
 
	$·r£_aux_code
 (

1327 
PJDEC_INST
 
g
,

1328 
aux_huff_–em_t
 *
aux_tbl_·r_p
)

1330 
UINT
 
code
, 
size
, 
v®
;

1331 
UINT
 
diff
;

1332 
UINT
 
exûss
;

1333 
aux_huff_–em_t
 *
lo_p
, *
hi_p
, *
mid_p
;

1335 
	`READ_BITS_LOAD
 (
g
, 
FALSE
, 16, 
code
, 
syÁax_”r
)

1338 ià((
BYTE
 *)
aux_tbl_·r_p
 =ğ
dec_AC_aux_tbl
)

1341 
v®
 = 
dec_AC_aux_tbl
 [
code
 & 0x7f];

1342 
	`DUMP
 (
	`_T
(" %2d-%4x-%3d×ux-romè "), 16, 
code
, 
v®
);

1343 ià(
v®
==0 || (
code
 & 0xff80)!=0xff80è
syÁax_”r
;

1344 
	`READ_BITS_ADVANCE
 (
g
,16)

1348 
lo_p
 = 
aux_tbl_·r_p
;

1349 
hi_p
 = 
lo_p
 +†o_p->
size
 - 1;

1350 
lo_p
 += 1;

1352 (
diff
=(
hi_p
-
lo_p
)) > 1) {

1353 
mid_p
 = 
lo_p
 + (
diff
>>1);

1354 ià(
mid_p
->
code
 > codeè
hi_p
 = mid_p;

1355 
lo_p
 = 
mid_p
;

1358 
size
 = 
lo_p
->size;

1359 
exûss
 = 16u - 
size
;

1360 ià((
code
>>
exûss
è!ğ(
UINT
)(
lo_p
->code>>excess)) {

1361 
lo_p
 = 
hi_p
;

1362 
size
 = 
lo_p
->size;

1363 
exûss
 = 16u - 
size
;

1364 ià((
code
>>
exûss
è!ğ(
UINT
)(
lo_p
->code>>excess)) {

1365 
	`PRINT
 (
	`_T
("aux codoà%x‚Ù found\n"), 
code
, 0);

1366 
syÁax_”r
;

1370 
v®
 = 
lo_p
->
v®ue
;

1371 
	`READ_BITS_ADVANCE
 (
g
,
size
)

1372 
	`DUMP
 (
	`_T
(" %2d-%4x-%3d×uxè "), 
size
, 
code
, 
v®
);

1374  
v®
;

1376 
syÁax_”r
:

1377 
	`PRINT
 (
	`_T
("parse_aux_code: syntaxƒrror\n"), 0, 0);

1378 
	`lÚgjmp
 (
g
->
syÁax_”rÜ
, 
BAD_HUFF_CODE
);

1379 
	}
}

1388 
	$huff_š™
 (
PJDEC_INST
 
g
)

1390 
	`mem£t
 (
g
->
dc_tbls
, 0, (g->dc_tbls));

1391 
	`mem£t
 (
g
->
ac_tbls
, 0, (g->ac_tbls));

1392 
	}
}

1401 
	$huff_ä“_tbl
 (
PJDEC_INST
 
g
, 
huff_tbl_t
 *
tbl_p
)

1403 ià(
tbl_p
->
šdex_p
 !ğ
NULL
)

1404 
	`IP_MEM_FREE
 (
tbl_p
->
šdex_p
);

1405 ià(
tbl_p
->
maš_p
 !ğ
NULL
)

1406 
	`IP_MEM_FREE
 (
tbl_p
->
maš_p
);

1407 ià(
tbl_p
->
aux_p
 !ğ
NULL
)

1408 
	`IP_MEM_FREE
 (
tbl_p
->
aux_p
);

1410 
tbl_p
->
šdex_p
 = 
NULL
;

1411 
tbl_p
->
maš_p
 = 
NULL
;

1412 
tbl_p
->
aux_p
 = 
NULL
;

1413 
	}
}

1422 
	$huff_ä“_®l
 (
PJDEC_INST
 
g
)

1424 
i
;

1426 
i
=0; i<
MAX_HUFF_TBLS
; i++) {

1427 
	`huff_ä“_tbl
 (
g
, &(g->
dc_tbls
[
i
]));

1428 
	`huff_ä“_tbl
 (
g
, &(g->
ac_tbls
[
i
]));

1430 
	}
}

1439 
	$ÿlc_bË
 (

1440 cÚ¡ 
BYTE
 
couÁs
[16],

1441 cÚ¡ 
BYTE
 
huffv®
[],

1442 
UINT
 
maš_ix_Ën
,

1443 
huff_tbl_t
 *
huff_tbl_p
)

1445 
BYTE
 
huffsize
[257];

1446 
WORD
 
huffcode
[257];

1447 
tÙ_codes
;

1448 
i
;

1449 
BYTE
 *
šdex_p
;

1450 
maš_huff_–em_t
 *
maš_p
;

1451 
aux_huff_–em_t
 *
aux_p
;

1459 
i
, 
j
, 
k
, 
code
, 
siz
;

1467 
tÙ_codes
 = 0;

1468 
i
=1; i<=16; i++)

1469 
j
=1; j<=
couÁs
[
i
-1]; j++)

1470 
huffsize
[
tÙ_codes
++] = 
i
;

1472 
huffsize
[
tÙ_codes
] = 0;

1475 ià(
	`memcmp
(
couÁs
, 
rom_couÁs
, 16) == 0 &&

1476 
	`memcmp
(
huffv®
, 
rom_v®
, 
tÙ_codes
) == 0) {

1477 
	`PRINT
 (
	`_T
("calc_table: using ROM Huffmanables\n"), 0, 0);

1478  
FALSE
;

1487 
k
 = 0;

1488 
code
 = 0;

1489 
siz
 = 
huffsize
[0];

1490 
TRUE
) {

1492 
huffcode
[
k
++] = 
code
++;

1493 } 
huffsize
[
k
]==
siz
 && k<257);

1494 ià(
huffsize
[
k
] == 0)

1497 
code
 <<= 1;

1498 
siz
 += 1;

1499 } 
huffsize
[
k
] !ğ
siz
);

1511 
i
, 
nby‹s
;

1512 
exŒa_b™s
;

1513 
UINT
 
fœ¡
, 
fš®
, 
code_¶us_junk
;

1515 ià(
maš_ix_Ën
 == 0)

1516 
maš_ix_Ën
 = 
huffsize
[
tÙ_codes
-1];

1518 
nby‹s
 = (
tÙ_codes
+1è* (
maš_huff_–em_t
);

1519 
	`IP_MEM_ALLOC
 (
nby‹s
, 
maš_p
);

1520 
	`mem£t
 (
maš_p
, 0, 
nby‹s
);

1522 
nby‹s
 = 1lu << 
maš_ix_Ën
;

1523 
	`IP_MEM_ALLOC
 (
nby‹s
, 
šdex_p
);

1524 
	`mem£t
 (
šdex_p
, 0, 
nby‹s
);

1526 
i
=0; i<
tÙ_codes
 && 
huffsize
[i]<=
maš_ix_Ën
; i++) {

1527 
maš_p
[
i
+1].
v®ue
 = 
huffv®
 [i];

1528 
maš_p
[
i
+1].
size
 = 
huffsize
[i] ;

1530 
exŒa_b™s
 = 
maš_ix_Ën
 - 
huffsize
[
i
];

1531 
fœ¡
 = 
huffcode
[
i
] << 
exŒa_b™s
;

1532 
fš®
 = 
fœ¡
 + (1lu << 
exŒa_b™s
) - 1;

1533 
code_¶us_junk
 = 
fœ¡
;

1534 
code_¶us_junk
 <ğ
fš®
;

1535 
code_¶us_junk
++)

1536 
šdex_p
[
code_¶us_junk
] = 
i
+1;

1551 
fœ¡
, 
n_’Œ›s
;

1552 
aux_huff_–em_t
 *
p
;

1555 
fœ¡
=0; fœ¡<
tÙ_codes
 && 
huffsize
[fœ¡]<=
maš_ix_Ën
; first++);

1557 ià(
fœ¡
 =ğ
tÙ_codes
) {

1559 
	`IP_MEM_ALLOC
 (1, 
aux_p
);

1561 
n_’Œ›s
 = 
tÙ_codes
 - 
fœ¡
 + 1;

1562 
	`IP_MEM_ALLOC
 (
n_’Œ›s
 * (
aux_huff_–em_t
), 
aux_p
);

1565 
p
 = 
aux_p
;

1566 
p
->
size
 = (
UINT
è
n_’Œ›s
;

1567 
p
->
code
 =…->
v®ue
 = 0;

1568 
p
 += 1;

1570 
i
=
fœ¡
; i<
tÙ_codes
; i++) {

1571 
p
->
size
 = 
huffsize
[
i
];

1572 
p
->
code
 = 
huffcode
[
i
] << (16u -…->
size
);

1573 
p
->
v®ue
 = 
huffv®
 [
i
];

1574 
p
 += 1;

1579 #ià
DUMP_JPEG


1581 
i
, 
n
;

1583 
	`_á´štf
 (
¡d”r
, 
	`_T
("\nOriginal size-code-valuples:\n"));

1584 
i
=0; i<
tÙ_codes
; i++) {

1585 ià((
i
&7è=ğ0è
	`_á´štf
(
¡d”r
, 
	`_T
(" "));

1586 
	`_á´štf
 (
¡d”r
, 
	`_T
("%2d-%04x-%02x "),

1587 
huffsize
[
i
], 
huffcode
[i], 
huffv®
[i]);

1588 ià((
i
&7)==7 || i==
tÙ_codes
-1è
	`_á´štf
(
¡d”r
, 
	`_T
("\n"));

1591 
	`_á´štf
(
¡d”r
, 
	`_T
("\nIndexabË: (%dƒÁr›s)\n"), 1lu<<
maš_ix_Ën
);

1592 
i
=0; i<(1lu<<
maš_ix_Ën
); i++) {

1593 ià((
i
&7è=ğ0è
	`_á´štf
(
¡d”r
, 
	`_T
(" %3d: "), i);

1594 
	`_á´štf
 (
¡d”r
, 
	`_T
("%3d, "), 
šdex_p
[
i
]);

1595 ià((
i
&7è=ğ7è
	`_á´štf
(
¡d”r
, 
	`_T
("\n"));

1598 
	`_á´štf
(
¡d”r
, 
	`_T
("\nMašabË: (%dƒÁr›s)\n"), 
tÙ_codes
+1);

1599 
i
=0; i<
tÙ_codes
; i++) {

1600 ià((
i
&7è=ğ0è
	`_á´štf
(
¡d”r
, 
	`_T
(" %3d: "), i);

1601 
	`_á´štf
 (
¡d”r
, 
	`_T
("%04x(%2dè"), 
maš_p
[
i
].
v®ue
, maš_p[i].
size
);

1602 ià((
i
&7)==7 || i==
tÙ_codes
-1è
	`_á´štf
(
¡d”r
, 
	`_T
("\n"));

1605 ià(
huffsize
[
tÙ_codes
-1] > 
maš_ix_Ën
) {

1606 
n
 = 
aux_p
[0].
size
;

1607 
	`_á´štf
(
¡d”r
, 
	`_T
("\nAuxabË: (%dƒÁr› oàsize-code-v®ue)\n"),
n
);

1608 
i
=0; i<
n
; i++) {

1609 ià((
i
&3è=ğ0è
	`_á´štf
(
¡d”r
, 
	`_T
(" %3d: "), i);

1610 
	`_á´štf
 (
¡d”r
, 
	`_T
("%2d-%4x-%3d "),

1611 
aux_p
[
i
].
size
,‡ux_p[i].
code
,‡ux_p[i].
v®ue
);

1612 ià((
i
&3)==3 || i==
n
-1è
	`_á´štf
(
¡d”r
, 
	`_T
("\n"));

1618 
huff_tbl_p
->
šdex_p
 = index_p;

1619 
huff_tbl_p
->
maš_p
 = main_p;

1620 
huff_tbl_p
->
aux_p
 =‡ux_p;

1623 
çl_”rÜ
:

1624 
	`as£¹
 (0);

1625 
	}
}

1637 
	$huff_defše_bË
 (

1638 
PJDEC_INST
 
g
,

1639 
BOOL
 
ac
,

1640 
UINT
 
id
,

1641 cÚ¡ 
BYTE
 
couÁs
[16],

1642 cÚ¡ 
BYTE
 
v®ues
[])

1644 
huff_tbl_t
 *
tbl_p
;

1646 
tbl_p
 = 
ac
 ? &(
g
->
ac_tbls
[
id
]è: &(g->
dc_tbls
[id]);

1647 
	`huff_ä“_tbl
 (
g
,
tbl_p
);

1649 
	`DUMP
 (
	`_T
("\nhuff_defše_bË:‡c=%d, id=%d\n"), 
ac
, 
id
, 0);

1650 
	`ÿlc_bË
 (
couÁs
, 
v®ues
,

1651 
ac
 ? 
AC_TBL_INDEX_LEN
 : 
DC_TBL_INDEX_LEN
,

1652 
tbl_p
);

1653 
	}
}

1675 
	#SHIFT_TRUNC
(
mv®ue
,
mshiá
è((mv®ueè>> (mshiá))

	)

1677 
	#QNORM_TO_INPUT
(
mv®
è
	`SHIFT_TRUNC
(mv®, 
QNORM_PRECISION
-
INPUT_PRECISION
)

	)

1679 
	#QNORM_PRECISION
 16

	)

1680 
	#INPUT_PRECISION
 5

	)

1681 
	#CONST_PRECISION
 9

	)

1683 
	#b1
 724L

	)

1684 
	#b2
 1338L

	)

1685 
	#b3
 724L

	)

1686 
	#b4
 554L

	)

1687 
	#b5
 392L

	)

1690 
	#CONST_PRECISION
 15

	)

1692 
	#b1
 46341L

	)

1693 
	#b2
 85627L

	)

1694 
	#b3
 46341L

	)

1695 
	#b4
 35468L

	)

1696 
	#b5
 25080L

	)

1712 cÚ¡ 
	gšv_dù_nÜm
[] = {

1731 
	$wšo_sÿË_bË
 (

1732 *
tbl_p
)

1734 cÚ¡ *
åŒ
;

1735 
i
;

1737 
åŒ
 = 
šv_dù_nÜm
;

1738 
i
=0; i<64; i++) {

1739 *
tbl_p
 = (è((*tbl_pè* (*
åŒ
++è* (1l<<
QNORM_PRECISION
) + 0.5);

1740 
tbl_p
 += 1;

1742 
	}
}

1762 
BYTE
 cÚ¡ 
	gzigzag_šdex_tbl
[] = {

1782 
	$decode_š™
 (
PJDEC_INST
 
g
)

1784 
BYTE
 cÚ¡ *
zig_p
;

1785 **
block_µ
;

1787 
zig_p
 = 
zigzag_šdex_tbl
;

1788 
block_µ
=
g
->
block_zz
; block_pp<g->block_zz+(64+16); block_pp++)

1789 *
block_µ
 = &(
g
->
block
[*
zig_p
++]);

1790 
	}
}

1799 
	$z”o_´iÜ_DC
 (
PJDEC_INST
 
g
)

1801 
g
->
´iÜ_dc
[0] = g->prior_dc[1] = g->prior_dc[2] = g->prior_dc[3] = 0;

1802 
	}
}

1816 
BOOL
 
	$·r£_block
 (

1817 
PJDEC_INST
 
g
,

1818 
comp
)

1830 
	#FIX_TERM
(
msize
,
m‹rm
) { \

1831 ià((
m‹rm
 & (1u<<((
msize
)-1))) == 0) \

1832 
m‹rm
 = (m‹rm | (-1 << (
msize
))) + 1; \

1833 }

	)

1837 
	#FIX_TERM
(
msize
,
m‹rm
) { \

1838 
mask
 = -1 << 
msize
; \

1839 ià(((
m‹rm
<<1è& 
mask
) == 0) \

1840 
m‹rm
 +ğ
mask
 + 1; \

1841 }

	)

1845 
	#FIX_TERM
(
msize
,
m‹rm
) \

1846 
m‹rm
 +ğ((m‹rm>>(
msize
-1)è- 1è& ~((1<<msizeè- 2);

	)

1849 
huff_tbl_t
 *
huff_p
;

1850 **
block_p
;

1851 *
dequªt_p
;

1852 
UINT
 
siz
, 
run
, 
¾_by‹
;

1853 
dc
, 
ac
;

1857 *
block_p
, *
aá”_p
;

1859 
block_p
=
g
->
block
, 
aá”_p
=g->block+64; block_p<after_p; ) {

1860 *
block_p
++ = 0;

1861 *
block_p
++ = 0;

1862 *
block_p
++ = 0;

1863 *
block_p
++ = 0;

1864 *
block_p
++ = 0;

1865 *
block_p
++ = 0;

1866 *
block_p
++ = 0;

1867 *
block_p
++ = 0;

1871 
dequªt_p
 = 
g
->
quªt_tbls
[g->
which_quªt_tbl
[
comp
]];

1872 
block_p
 = 
g
->
block_zz
;

1878 
	`DUMP
 (
	`_T
("\nS¹ oàblock fÜ compÚ’ˆ%d:\n"), 
comp
, 0, 0);

1880 
huff_p
 = &(
g
->
dc_tbls
[g->
which_dc_tbl
[
comp
]]);

1881 
	`DECODE_HUFF
 (
g
, 
huff_p
, 
DC_TBL_INDEX_LEN
, 
siz
, 
h™_m¬k”
)

1883 ià(
siz
 == 0) {

1884 
	`DUMP
 (
	`_T
("dc=0, size of dc=0\n"), 0,0,0);

1885 
dc
 = 0;

1887 
	`READ_BITS_LOAD
 (
g
, 
TRUE
, 
siz
, 
dc
, 
syÁax_”r
)

1888 
	`READ_BITS_ADVANCE
 (
g
, 
siz
)

1889 
	`DUMP
 (
	`_T
("dc=%x, sizoàdc=%d\n"), 
dc
, 
siz
, 0);

1890 
	`FIX_TERM
 (
siz
, 
dc
)

1893 
dc
 +ğ
g
->
´iÜ_dc
[
comp
];

1894 
g
->
´iÜ_dc
[
comp
] = 
dc
;

1895 *(*
block_p
++èğ
	`QNORM_TO_INPUT
 (()*
dequªt_p
++ * 
dc
);

1901 
huff_p
 = &(
g
->
ac_tbls
[g->
which_ac_tbl
[
comp
]]);

1909 
TRUE
) {

1910 
	`DECODE_HUFF
 (
g
, 
huff_p
, 
AC_TBL_INDEX_LEN
, 
¾_by‹
, 
h™_m¬k”
);

1911 
run
 = 
¾_by‹
 >> 4;

1912 
siz
 = 
¾_by‹
 & 0x0f;

1913 
	`DUMP
 (
	`_T
("¾c:„un=%d, sizoàac=%d"), 
run
, 
siz
, 0);

1915 ià(
siz
 == 0) {

1916 ià(
run
 == 15) {

1917 
	`DUMP
 (
	`_T
(",„un of 16\n"), 0,0,0);

1918 
block_p
 += 16;

1919 
dequªt_p
 += 16;

1920 } ià(
run
 == 0) {

1921 
	`DUMP
 (
	`_T
(", EOB\n"), 0,0,0);

1924 
syÁax_”r
;

1926 
block_p
 +ğ
run
;

1927 
dequªt_p
 +ğ
run
;

1928 
	`READ_BITS_LOAD
 (
g
, 
TRUE
, 
siz
, 
ac
, 
h™_m¬k”
);

1929 
	`READ_BITS_ADVANCE
 (
g
, 
siz
);

1930 
	`DUMP
 (
	`_T
(",‡c=%x\n"), 
ac
, 
siz
, 0);

1931 
	`FIX_TERM
 (
siz
, 
ac
);

1932 *(*
block_p
++èğ
	`QNORM_TO_INPUT
 (()*
dequªt_p
++ * 
ac
);

1935 ià(
block_p
 >ğ
g
->
block_zz
+64) {

1936 ià(
block_p
 > 
g
->
block_zz
+64) {

1937 
	`PRINT
(
	`_T
("parse_block: over 63 ACerms\n"), 0,0);

1938 
syÁax_”r
;

1940 ià(! 
g
->
fD’®i
)

1945  
TRUE
;

1947 
syÁax_”r
:

1948 
	`PRINT
(
	`_T
("parse_block: syntaxƒrror\n"), 0,0);

1949 
	`lÚgjmp
 (
g
->
syÁax_”rÜ
, 
BAD_HUFF_CODE
);

1951 
h™_m¬k”
:

1952  
FALSE
;

1954 #undeà
FIX_TERM


1955 
	}
}

1968 
	$hªdËM¬k”InSŒ—m
 (
PJDEC_INST
 
g
)

1970 
BYTE
 
m¬k”
;

1972 
m¬k”
 = 
	`m¬_g‘
(
g
);

1974 ià(
m¬k”
 =ğ
MARKER_EOI
) {

1975 
	`PRINT
 (
	`_T
("handleMarkerInStream:…arsed EOI\n"), 0, 0);

1976 
g
->
gÙ_EOI
 = 
TRUE
;

1977 } ià(
m¬k”
 =ğ
MARKER_DNL
) {

1978 
	`PRINT
 (
	`_T
("handleMarkerInStream:…arsing DNL\n"), 0, 0);

1979 
	`m¬_·r£_dÆ
 (
g
);

1980 } ià(
g
->
»¡¬t_š‹rv®
 > 0

1981 && 
g
->
»¡¬t_cur_mcu
 =ğg->
»¡¬t_š‹rv®


1982 && (
m¬k”
-
MARKER_RST0
è=ğ
g
->
»¡¬t_cur_m¬k”
)

1985 
	`PRINT
 (
	`_T
("handleMarkerInStream:…arsedƒxpected RST\n"), 0, 0);

1986 
g
->
»¡¬t_cur_m¬k”
 = (g->restart_cur_marker+1) & 7;

1987 
g
->
»¡¬t_cur_mcu
 = 0;

1988 
	`z”o_´iÜ_DC
 (
g
);

1990 
	`PRINT
 (
	`_T
("hªdËM¬k”InSŒ—m: iÎeg® m¬k”=0x%2.2X\n"), 
m¬k”
, 0);

1991 
	`lÚgjmp
 (
g
->
syÁax_”rÜ
, 
BAD_MARKER_DATA
);

1993 
	}
}

2002 
	$Lev–ShiáAndRound
 (*
šBlock_p
, 
BYTE
 *
outBlock_p
)

2004 
BYTE
 *
outAá”
;

2005 
pix–
;

2007 
outAá”
 = 
outBlock_p
 + 64;

2008 
outBlock_p
 < 
outAá”
;

2009 
outBlock_p
++, 
šBlock_p
++)

2011 
pix–
 = (*
šBlock_p
 +

2012 ((1<<(
INPUT_PRECISION
-1)) + (128<<INPUT_PRECISION)))

2013 >> 
INPUT_PRECISION
;

2014 ià(
pix–
>>8 != 0)

2015 
pix–
 =…ixel>0 ? 255 : 0;

2016 *
outBlock_p
 = (
BYTE
è
pix–
;

2018 
	}
}

2033 
BOOL
 
	$decode_MCU
 (
PJDEC_INST
 
g
)

2035 
BYTE
 
baPix–s
[256];

2036 
BYTE
 *
pPix–
;

2037 
comp
;

2038 
h_block
, 
v_block
;

2039 
ul_row
, 
ul_cŞ
;

2040 
row
;

2041 
BYTE
 **
row_µ
;

2042 
BYTE
 *
row_p
;

2044 
comp
=0; comp<
g
->
num_comps
; comp++) {

2045 
v_block
=0; v_block<
g
->
v”t_§mp_çcs
[
comp
]; v_block++) {

2046 
h_block
=0; h_block<
g
->
hÜiz_§mp_çcs
[
comp
]; h_block++) {

2050 ! 
	`·r£_block
(
g
,
comp
)) {

2058 ià(
comp
>0 || 
v_block
>0 || 
h_block
>0)

2059 
	`lÚgjmp
 (
g
->
syÁax_”rÜ
, 
UNEXPECTED_MARKER
);

2061 
	`hªdËM¬k”InSŒ—m
(
g
);

2062 ià(
g
->
gÙ_EOI
)

2063  
FALSE
;

2066 
	`dù_šv”£
 (
g
->
block
);

2070 
	`Lev–ShiáAndRound
 (
g
->
block
, 
baPix–s
);

2074 
ul_row
 = 
v_block
*8;

2075 
ul_cŞ
 = (
g
->
mcus_dÚe
*g->
hÜiz_§mp_çcs
[
comp
] + 
h_block
) * 8;

2076 
row_µ
 = &(
g
->
out_rows_­
[
comp
][
ul_row
]);

2077 
pPix–
 = 
baPix–s
;

2079 
row
=0;„ow<8;„ow++) {

2080 
row_p
 = *
row_µ
++ + 
ul_cŞ
;

2082 *(
DWORD
*è
row_p
 = *(DWORD*è
pPix–
;

2083 *(
DWORD
*)(
row_p
+4èğ*(DWORD*)(
pPix–
+4);

2084 
pPix–
 += 8;

2090 ià(
g
->
»¡¬t_š‹rv®
>0 && g->
»¡¬t_cur_mcu
==g->restart_interval)

2091 
	`lÚgjmp
 (
g
->
syÁax_”rÜ
, 
NO_RESTART_MARKER
);

2092 
g
->
»¡¬t_cur_mcu
 += 1;

2094  
TRUE
;

2095 
	}
}

2132 
	$cİy_out_rows
 (

2133 
PJDEC_INST
 
g
,

2134 
UINT
 
row_šdex
,

2135 
BYTE
 *
outbuf_p
,

2136 
UINT
 *
n_rows_p
,

2137 
UINT
 *
n_by‹s_p
)

2139 
BYTE
 *
out_p
;

2140 
UINT
 
comp
;

2141 
UINT
 
v”t_³riod
, 
v”t_mod
;

2142 
UINT
 
row
, 
cŞ
;

2143 
BYTE
 *
row_p
;

2145 
v”t_³riod
 = 
row_šdex
 / 
g
->
max_v”t_§mp_çc
;

2146 
v”t_mod
 = 
row_šdex
 % 
g
->
max_v”t_§mp_çc
;

2148 ià(! 
g
->
ouut_sub§m¶ed
) {

2154 
UINT
 
§mp_çc
;

2155 
UINT
 
hÜiz_mod
;

2157 
comp
=0; comp<
g
->
num_comps
; comp++) {

2158 
§mp_çc
 = 
g
->
v”t_§mp_çcs
[
comp
];

2159 
out_p
 = 
outbuf_p
 + 
comp
;

2160 
row
 = 
v”t_³riod
*
§mp_çc
 +

2161 (
v”t_mod
<
§mp_çc
 ? vert_mod : samp_fac-1);

2162 
row_p
 = 
g
->
out_rows_­
[
comp
][
row
];

2164 
hÜiz_mod
 = 0;

2165 
§mp_çc
 = 
g
->
hÜiz_§mp_çcs
[
comp
];

2167 ià(
§mp_çc
 =ğ
g
->
max_hÜiz_§mp_çc
) {

2171 ià(
g
->
num_comps
 == 1) {

2172 
	`memıy
 (
out_p
, 
row_p
, 
g
->
Œa™s
.
iPix–sP”Row
);

2174 
cŞ
=0; cŞ<(
UINT
)
g
->
Œa™s
.
iPix–sP”Row
; col++) {

2175 *
out_p
 = *
row_p
++;

2176 
out_p
 +ğ
g
->
num_comps
;

2180 } ià(
§mp_çc
==1 && 
g
->
max_hÜiz_§mp_çc
==2) {

2184 
BYTE
 
´ev_pix
;

2185 
cŞ
=0; cŞ<(
UINT
)
g
->
Œa™s
.
iPix–sP”Row
; col+=2) {

2186 *
out_p
 = 
´ev_pix
 = *
row_p
++;

2187 
out_p
 +ğ
g
->
num_comps
;

2188 *
out_p
 = 
´ev_pix
;

2189 
out_p
 +ğ
g
->
num_comps
;

2196 
cŞ
=0; cŞ<(
UINT
)
g
->
Œa™s
.
iPix–sP”Row
; col++) {

2197 *
out_p
 = 
hÜiz_mod
<
§mp_çc
 ? *
row_p
++ :„ow_p[-1];

2198 
out_p
 +ğ
g
->
num_comps
;

2199 
hÜiz_mod
 += 1;

2200 ià(
hÜiz_mod
 =ğ
g
->
max_hÜiz_§mp_çc
) horiz_mod = 0;

2205 *
n_rows_p
 = 1;

2206 *
n_by‹s_p
 = 
g
->
num_comps
 * g->
Œa™s
.
iPix–sP”Row
;

2214 
UINT
 
hÜiz_³riod
, 
³riods_³r_row
;

2215 
UINT
 
ul_row
, 
ul_cŞ
;

2216 
BYTE
 *
row_y1_p
, *
row_y2_p
, *
row_cb_p
, *
row_ü_p
;

2218 
out_p
 = 
outbuf_p
;

2219 
³riods_³r_row
 = 
g
->
mcus_³r_row
 * 8;

2221 ià(
g
->
num_comps
==1 && g->
max_hÜiz_§mp_çc
==1 && g->
max_v”t_§mp_çc
==1) {

2225 
	`memıy
 (
out_p
, 
g
->
out_rows_­
[0][
row_šdex
], g->
Œa™s
.
iPix–sP”Row
);

2226 
out_p
 +ğ
g
->
Œa™s
.
iPix–sP”Row
;

2228 } ià(
g
->
num_comps
==3 &&

2229 (
g
->
hÜiz_§mp_çcs
[0]==1 &&

2230 
g
->
hÜiz_§mp_çcs
[1]==1 &&

2231 
g
->
hÜiz_§mp_çcs
[2]==1) &&

2232 (
g
->
v”t_§mp_çcs
[0]==1 &&

2233 
g
->
v”t_§mp_çcs
[1]==1 &&

2234 
g
->
v”t_§mp_çcs
[2]==1)) {

2238 
row_y1_p
 = 
g
->
out_rows_­
[0][
v”t_³riod
];

2239 
row_cb_p
 = 
g
->
out_rows_­
[1][
v”t_³riod
];

2240 
row_ü_p
 = 
g
->
out_rows_­
[2][
v”t_³riod
];

2241 
cŞ
=0; cŞ<(
UINT
)
g
->
Œa™s
.
iPix–sP”Row
; col++) {

2242 *
out_p
++ = *
row_y1_p
++;

2243 *
out_p
++ = *
row_cb_p
++;

2244 *
out_p
++ = *
row_ü_p
++;

2247 } ià(
g
->
num_comps
==3 &&

2248 (
g
->
hÜiz_§mp_çcs
[0]==2 &&

2249 
g
->
hÜiz_§mp_çcs
[1]==1 &&

2250 
g
->
hÜiz_§mp_çcs
[2]==1) &&

2251 (
g
->
v”t_§mp_çcs
[0]==2 &&

2252 
g
->
v”t_§mp_çcs
[1]==1 &&

2253 
g
->
v”t_§mp_çcs
[2]==1)) {

2257 
row_y1_p
 = 
g
->
out_rows_­
[0][2*
v”t_³riod
];

2258 
row_y2_p
 = 
g
->
out_rows_­
[0][2*
v”t_³riod
+1];

2259 
row_cb_p
 = 
g
->
out_rows_­
[1][
v”t_³riod
];

2260 
row_ü_p
 = 
g
->
out_rows_­
[2][
v”t_³riod
];

2261 
hÜiz_³riod
=0; hÜiz_³riod<
³riods_³r_row
; horiz_period++) {

2262 *
out_p
++ = *
row_y1_p
++;

2263 *
out_p
++ = *
row_y1_p
++;

2264 *
out_p
++ = *
row_y2_p
++;

2265 *
out_p
++ = *
row_y2_p
++;

2266 *
out_p
++ = *
row_cb_p
++;

2267 *
out_p
++ = *
row_ü_p
++;

2274 
hÜiz_³riod
=0; hÜiz_³riod<
³riods_³r_row
; horiz_period++) {

2275 
comp
=0; comp<
g
->
num_comps
; comp++) {

2276 
ul_row
 = 
v”t_³riod
 * 
g
->
v”t_§mp_çcs
[
comp
];

2277 
ul_cŞ
 = 
hÜiz_³riod
 * 
g
->
hÜiz_§mp_çcs
[
comp
];

2279 
row
=
ul_row
;„ow<ul_row+ 
g
->
v”t_§mp_çcs
[
comp
];„ow++)

2280 
cŞ
=
ul_cŞ
; cŞ<ul_cŞ+
g
->
hÜiz_§mp_çcs
[
comp
]; col++) {

2281 *
out_p
++ = 
g
->
out_rows_­
[
comp
][
row
][
cŞ
];

2287 *
n_rows_p
 = 
g
->
max_v”t_§mp_çc
;

2288 *
n_by‹s_p
 = 
out_p
 - 
outbuf_p
;

2290 
	}
}

2318 
WORD
 
	$jpgDecode_İ’XfÜm
 (

2319 
IP_XFORM_HANDLE
 *
pXfÜm
)

2321 
PJDEC_INST
 
g
;

2323 
	`INSURE
 (
pXfÜm
 !ğ
NULL
);

2324 
	`IP_MEM_ALLOC
 ((
JDEC_INST
), 
g
);

2325 *
pXfÜm
 = 
g
;

2326 
	`mem£t
 (
g
, 0, (
JDEC_INST
));

2327 
g
->
dwV®idChk
 = 
CHECK_VALUE
;

2328 
	`decode_š™
 (
g
);

2329  
IP_DONE
;

2331 
çl_”rÜ
:

2332  
IP_FATAL_ERROR
;

2333 
	}
}

2352 
WORD
 
	$jpgDecode_£tDeçuÉIÅutT¿™s
 (

2353 
IP_XFORM_HANDLE
 
hXfÜm
,

2354 
PIP_IMAGE_TRAITS
 
pT¿™s
)

2356 
PJDEC_INST
 
g
;

2358 
	`HANDLE_TO_PTR
 (
hXfÜm
, 
g
);

2359 
g
->
Œa™s
 = *
pT¿™s
;

2360  
IP_DONE
;

2362 
çl_”rÜ
:

2363  
IP_FATAL_ERROR
;

2364 
	}
}

2374 
WORD
 
	$jpgDecode_£tXfÜmS³c
 (

2375 
IP_XFORM_HANDLE
 
hXfÜm
,

2376 
DWORD_OR_PVOID
 
aXfÜmInfo
[])

2378 
PJDEC_INST
 
g
;

2380 
	`HANDLE_TO_PTR
 (
hXfÜm
, 
g
);

2381 
g
->
ouut_sub§m¶ed
 = 
aXfÜmInfo
[
IP_JPG_DECODE_OUTPUT_SUBSAMPLED
].
dwÜd
;

2382 
g
->
fD’®i
 = 
aXfÜmInfo
[
IP_JPG_DECODE_FROM_DENALI
].
dwÜd
;

2383  
IP_DONE
;

2385 
çl_”rÜ
:

2386  
IP_FATAL_ERROR
;

2387 
	}
}

2397 
WORD
 
	$jpgDecode_g‘H—d”BufSize
 (

2398 
IP_XFORM_HANDLE
 
hXfÜm
,

2399 
DWORD
 *
pdwInBufL’
)

2401 
PJDEC_INST
 
g
;

2403 
	`HANDLE_TO_PTR
 (
hXfÜm
, 
g
);

2404 *
pdwInBufL’
 = 
MAX_HEADER_SIZE
;

2405  
IP_DONE
;

2407 
çl_”rÜ
:

2408  
IP_FATAL_ERROR
;

2409 
	}
}

2419 
WORD
 
	$jpgDecode_g‘Aùu®T¿™s
 (

2420 
IP_XFORM_HANDLE
 
hXfÜm
,

2421 
DWORD
 
dwIÅutAva
,

2422 
PBYTE
 
pbIÅutBuf
,

2423 
PDWORD
 
pdwIÅutU£d
,

2424 
PDWORD
 
pdwIÅutNextPos
,

2425 
PIP_IMAGE_TRAITS
 
pInT¿™s
,

2426 
PIP_IMAGE_TRAITS
 
pOutT¿™s
)

2428 
PJDEC_INST
 
g
;

2429 
UINT
 
comp
;

2430 
UINT
 
m¬k”
;

2431 
UINT
 
row_Ën
, 
n_rows
;

2432 
UINT
 
row
;

2433 
UINT
 
”r
;

2434 
BYTE
 *
p
;

2440 
	`HANDLE_TO_PTR
 (
hXfÜm
, 
g
);

2442 
g
->
rows_dÚe
 = 0;

2443 
g
->
mcus_dÚe
 = 0;

2444 
g
->
£ndšg_rows
 = 
FALSE
;

2445 
g
->
gÙ_EOI
 = 
FALSE
;

2446 
g
->
gÙ_shÜt_h—d”
 = 
FALSE
;

2447 
	`»ad_š™
 (
g
);

2448 
	`huff_š™
 (
g
);

2449 
	`z”o_´iÜ_DC
 (
g
);

2450 
g
->
»¡¬t_cur_mcu
 = 0;

2451 
g
->
»¡¬t_cur_m¬k”
 = 0;

2452 
g
->
dwOutNextPos
 = 0;

2458 ià((
”r
=
	`£tjmp
(
g
->
syÁax_”rÜ
)) != 0) {

2459 
	`PRINT
 (
	`_T
("j³g_decode_·r£_h—d”: syÁaxƒ¼Ü = %d\n"), 
”r
, 0);

2460  
IP_FATAL_ERROR
 | 
IP_INPUT_ERROR
;

2463 
	`»ad_buf_İ’
 (
g
, 
pbIÅutBuf
);

2465 ià(
	`m¬_g‘
(
g
è!ğ
MARKER_SOI
)

2466  
IP_FATAL_ERROR
 | 
IP_INPUT_ERROR
;

2469 
m¬k”
 = 
	`m¬_g‘
 (
g
);

2470 
	`m¬_·r£
 (
g
, 
m¬k”
);

2471 ià(
m¬k”
 =ğ
MARKER_EOI
)

2472  
IP_FATAL_ERROR
 | 
IP_INPUT_ERROR
;

2473 } !(
m¬k”
==
MARKER_SOS
 || 
g
->
gÙ_shÜt_h—d”
));

2475 *
pdwIÅutNextPos
 = 
g
->
dwInNextPos
 = *
pdwIÅutU£d
 = 
	`»ad_buf_şo£
 (g);

2479 
	`PRINT
 (
	`_T
("jpeg_decode_parse_header:…ixels/row=%d,‚um_rows=%d\n"),

2480 
g
->
Œa™s
.
iPix–sP”Row
, g->Œa™s.
lNumRows
);

2482 
g
->
cŞs_³r_mcu
 = g->
max_hÜiz_§mp_çc
 * 8;

2483 
g
->
rows_³r_mcu
 = g->
max_v”t_§mp_çc
 * 8;

2484 
g
->
mcus_³r_row
 = (g->
Œa™s
.
iPix–sP”Row
 + g->
cŞs_³r_mcu
 - 1) / g->cols_per_mcu;

2490 
	`mem£t
 (
g
->
out_rows_­
, 0, (g->out_rows_ap));

2492 
comp
=0; comp<
g
->
num_comps
; comp++) {

2493 
row_Ën
 = 
g
->
hÜiz_§mp_çcs
[
comp
] * g->
mcus_³r_row
 * 8;

2494 
n_rows
 = 
g
->
v”t_§mp_çcs
[
comp
] * 8;

2496 
row
=0;„ow<
n_rows
;„ow++) {

2497 
	`IP_MEM_ALLOC
 (
row_Ën
, 
p
);

2498 
g
->
out_rows_­
[
comp
][
row
] = 
p
;

2506 *
pInT¿™s
 = 
g
->
Œa™s
;

2507 *
pOutT¿™s
 = 
g
->
Œa™s
;

2509  
IP_DONE
 | 
IP_READY_FOR_DATA
;

2511 
çl_”rÜ
:

2512  
IP_FATAL_ERROR
;

2513 
	}
}

2523 
WORD
 
	$jpgDecode_g‘Aùu®BufSizes
 (

2524 
IP_XFORM_HANDLE
 
hXfÜm
,

2525 
PDWORD
 
pdwMšInBufL’
,

2526 
PDWORD
 
pdwMšOutBufL’
)

2528 
PJDEC_INST
 
g
;

2530 
	`HANDLE_TO_PTR
 (
hXfÜm
, 
g
);

2531 *
pdwMšInBufL’
 = 
INBUF_NUM_MCUS
 * 
MAX_MCU_SIZE
;

2532 *
pdwMšOutBufL’
 = 
g
->
num_comps
 * g->
Œa™s
.
iPix–sP”Row
;

2534  
IP_DONE
;

2536 
çl_”rÜ
:

2537  
IP_FATAL_ERROR
;

2538 
	}
}

2548 
WORD
 
	$jpgDecode_cÚv”t
 (

2549 
IP_XFORM_HANDLE
 
hXfÜm
,

2550 
DWORD
 
dwIÅutAva
,

2551 
PBYTE
 
pbIÅutBuf
,

2552 
PDWORD
 
pdwIÅutU£d
,

2553 
PDWORD
 
pdwIÅutNextPos
,

2554 
DWORD
 
dwOuutAva
,

2555 
PBYTE
 
pbOuutBuf
,

2556 
PDWORD
 
pdwOuutU£d
,

2557 
PDWORD
 
pdwOuutThisPos
)

2559 
PJDEC_INST
 
g
;

2562 
»t_v®
;

2563 
UINT
 
comp
, 
row
, 
row_Ën
, 
n_rows
, 
n_by‹s
, 
Œash
;

2564 
iE¼ÜCode
;

2565 
BOOL
 
bDecoded
;

2566 cÚ¡ 
BYTE
 
ycc_wh™e
[4] = { 255, 128, 128, 255 };

2568 
	`HANDLE_TO_PTR
 (
hXfÜm
, 
g
);

2570 *
pdwIÅutU£d
 = 0;

2571 *
pdwOuutThisPos
 = 
g
->
dwOutNextPos
;

2572 *
pdwOuutU£d
 = 0;

2573 
»t_v®
 = 
IP_READY_FOR_DATA
;

2575 ià(
	`£tjmp
(
g
->
syÁax_”rÜ
) != 0) {

2576 
	`PRINT
 (
	`_T
("got‡ syntaxƒrror\n"), 0, 0);

2577 *
pdwIÅutNextPos
 = 
g
->
dwInNextPos
;

2578  
IP_FATAL_ERROR
 | 
IP_INPUT_ERROR
;

2585 ià(! 
g
->
£ndšg_rows
) {

2586 ià(
pbIÅutBuf
 =ğ
NULL
) {

2590 ià(! 
g
->
gÙ_EOI
) {

2592 
»t_v®
 |ğ
IP_INPUT_ERROR
;

2594 
»t_v®
 |ğ
IP_DONE
;

2596 } ià(
g
->
gÙ_EOI
) {

2600 *
pdwIÅutU£d
 = 
dwIÅutAva
;

2604 ià(
g
->
mcus_dÚe
 == 0) {

2606 
	`PRINT
 (
	`_T
("initing‡ll„ow-bufferso white\n"), 0, 0);

2607 
comp
=0; comp<
g
->
num_comps
; comp++) {

2608 
row_Ën
 = 
g
->
hÜiz_§mp_çcs
[
comp
] * g->
mcus_³r_row
 * 8;

2609 
n_rows
 = 
g
->
v”t_§mp_çcs
[
comp
] * 8;

2611 
row
=0;„ow<
n_rows
;„ow++)

2612 
	`mem£t
 (
g
->
out_rows_­
[
comp
][
row
], 
ycc_wh™e
[comp], 
row_Ën
);

2617 
bDecoded
 = 
FALSE
;

2618 
	`»ad_buf_İ’
 (
g
, 
pbIÅutBuf
 + *
pdwIÅutU£d
);

2619 
	`memıy
(&(
g
->
Şd_syÁax_”rÜ
), &(g->
syÁax_”rÜ
), (
jmp_buf
));

2620 
iE¼ÜCode
 = 
	`£tjmp
(
g
->
syÁax_”rÜ
);

2621 ià(
iE¼ÜCode
 == 0) {

2622 
bDecoded
 = 
	`decode_MCU
(
g
);

2628 ià(! 
g
->
gÙ_EOI
) {

2629 
	`READ_BITS_LOAD
 (
g
, 
FALSE
, 8, 
Œash
, 
©_a_m¬k”
);

2630 
no_m¬k”
;

2631 
©_a_m¬k”
:

2632 
	`hªdËM¬k”InSŒ—m
(
g
);

2633 
no_m¬k”
:;

2636 
	`memıy
(&(
g
->
syÁax_”rÜ
), &(g->
Şd_syÁax_”rÜ
), (
jmp_buf
));

2637 
n_by‹s
 = 
	`»ad_buf_şo£
 (
g
);

2639 *
pdwIÅutU£d
 +ğ
n_by‹s
;

2640 
g
->
dwInNextPos
 +ğ
n_by‹s
;

2642 ià(*
pdwIÅutU£d
 > 
dwIÅutAva
) {

2644 *
pdwIÅutU£d
 = 
dwIÅutAva
;

2645 
g
->
dwInNextPos
 +ğ
dwIÅutAva
 - 
n_by‹s
;

2652 
»t_v®
 |ğ
IP_INPUT_ERROR
;

2653 } ià(
iE¼ÜCode
 != 0) {

2655 
	`lÚgjmp
 (
g
->
syÁax_”rÜ
, 
iE¼ÜCode
);

2656 } ià(
g
->
gÙ_EOI
) {

2657 
»t_v®
 |ğ
IP_NEW_OUTPUT_PAGE
;

2663 ià(
bDecoded
) {

2664 
g
->
mcus_dÚe
 += 1;

2666 ià(
g
->
mcus_dÚe
 >ğg->
mcus_³r_row
) {

2667 
	`PRINT
 (
	`_T
("done with„ow of MCUs; starting„ow-sends\n"), 0, 0);

2668 
g
->
£ndšg_rows
 = 
TRUE
;

2669 
g
->
mcus_dÚe
 = 0;

2672 } !
g
->
gÙ_EOI
 && !g->
£ndšg_rows
 &&

2673 (
dwIÅutAva
-*
pdwIÅutU£d
è>ğ
MAX_MCU_SIZE
);

2681 ià(
g
->
£ndšg_rows
) {

2682 ià(
g
->
rows_dÚe
>=g->
Œa™s
.
lNumRows
 && g->traits.lNumRows>=0) {

2684 
g
->
£ndšg_rows
 = 
FALSE
;

2686 
	`cİy_out_rows
 (

2687 
g
,

2688 
g
->
rows_dÚe
 % g->
rows_³r_mcu
,

2689 
pbOuutBuf
,

2690 &
n_rows
,

2691 &
n_by‹s
);

2692 
	`PRINT
 (
	`_T
("cİ›d ouˆ%d„ows\n"), 
n_rows
, 0);

2693 *
pdwOuutU£d
 = 
n_by‹s
;

2694 
g
->
dwOutNextPos
 +ğ
n_by‹s
;

2695 
g
->
rows_dÚe
 +ğ
n_rows
;

2697 ià((
g
->
rows_dÚe
>=g->
Œa™s
.
lNumRows
 && g->traits.lNumRows>=0)

2698 || (
g
->
rows_dÚe
 % g->
rows_³r_mcu
)==0) {

2699 
g
->
£ndšg_rows
 = 
FALSE
;

2702 ià(
n_rows
 > 0)

2703 
»t_v®
 |ğ
IP_CONSUMED_ROW
 | 
IP_PRODUCED_ROW
;

2707 *
pdwIÅutNextPos
 = 
g
->
dwInNextPos
;

2709 
	`PRINT
 (
	`_T
("jpeg_decode_convert_row: Returning %04x, in_used=%d\n"),

2710 
»t_v®
, *
pdwIÅutU£d
);

2711  
»t_v®
;

2713 
çl_”rÜ
:

2714  
IP_FATAL_ERROR
;

2715 
	}
}

2725 
WORD
 
	$jpgDecode_š£¹edD©a
 (

2726 
IP_XFORM_HANDLE
 
hXfÜm
,

2727 
DWORD
 
dwNumBy‹s
)

2729 
	`çlB»akPošt
 ();

2730  
IP_FATAL_ERROR
;

2731 
	}
}

2741 
WORD
 
	$jpgDecode_ÃwPage
 (

2742 
IP_XFORM_HANDLE
 
hXfÜm
)

2744  
IP_DONE
;

2745 
	}
}

2755 
WORD
 
	$jpgDecode_şo£XfÜm
 (
IP_XFORM_HANDLE
 
hXfÜm
)

2757 
PJDEC_INST
 
g
;

2758 
BYTE
 **
row_µ
, **
aá”_µ
, *
p
;

2760 
	`HANDLE_TO_PTR
 (
hXfÜm
, 
g
);

2761 
	`PRINT
 (
	`_T
("jpeg_decode_close\n"), 0, 0);

2763 
row_µ
 = &(
g
->
out_rows_­
[0][0]);

2764 
aá”_µ
 = 
row_µ
 + ((
g
->
out_rows_­
)/(
BYTE
 *));

2766  ; 
row_µ
<
aá”_µ
;„ow_pp++) {

2767 
p
 = *
row_µ
;

2768 ià(
p
 !ğ
NULL
) {

2769 
	`IP_MEM_FREE
 (
p
);

2770 *
row_µ
 = 
NULL
;

2774 
	`huff_ä“_®l
 (
g
);

2775 
g
->
dwV®idChk
 = 0;

2776 
	`IP_MEM_FREE
 (
g
);

2777  
IP_DONE
;

2779 
çl_”rÜ
:

2780  
IP_FATAL_ERROR
;

2781 
	}
}

2791 
WORD
 
	$jpgDecode_g‘RowCouÁInfo
(
IP_XFORM_HANDLE
 
hXfÜm
,

2792 *
pRcCouÁup
,*
pRcT¿™s
,*
pSofOff£t
)

2794 
PJDEC_INST
 
g
;

2796 
	`HANDLE_TO_PTR
 (
hXfÜm
, 
g
);

2797 *
pRcCouÁup
=
g
->
rows_dÚe
;

2798 *
pRcT¿™s
=
g
->
Œa™s
.
lNumRows
;

2799 *
pSofOff£t
=
g
->
rowCouÁOff£t
;

2801  
IP_DONE
;

2803 
çl_”rÜ
:

2804  
IP_FATAL_ERROR
;

2805 
	}
}

2815 
IP_XFORM_TBL
 
	gjpgDecodeTbl
 = {

2816 
jpgDecode_İ’XfÜm
,

2817 
jpgDecode_£tDeçuÉIÅutT¿™s
,

2818 
jpgDecode_£tXfÜmS³c
,

2819 
jpgDecode_g‘H—d”BufSize
,

2820 
jpgDecode_g‘Aùu®T¿™s
,

2821 
jpgDecode_g‘Aùu®BufSizes
,

2822 
jpgDecode_cÚv”t
,

2823 
jpgDecode_ÃwPage
,

2824 
jpgDecode_š£¹edD©a
,

2825 
jpgDecode_şo£XfÜm


	@ip/xjpg_enc.c

107 
	~<¡ršg.h
>

108 
	~"hp.h
"

109 
	~"defs.h
"

110 
	~"xjpg_dù.h
"

111 
	~"xjpg_mrk.h
"

115 
	~"¡dio.h
"

116 
	~<tch¬.h
>

117 
	#PRINT
(
msg
,
¬g1
,
¬g2
) \

118 
	`_á´štf
(
¡dout
, 
	`_T
("(j³gè"è
msg
, ()
¬g1
, ()
¬g2
)

	)

120 
	#PRINT
(
msg
,
¬g1
,
¬g2
)

	)

124 
	#RUN_OF_16
 0xf0

	)

125 
	#MAX_HEADER_SIZE
 2000

	)

126 
	#MAX_BLOCKS_IN_MCU
 6

	)

127 
	#MAX_MCU_SIZE
 (
MAX_BLOCKS_IN_MCU
*304)

	)

129 
	#OUTBUF_NUM_MCUS
 2

	)

131 
	#Q_DEFAULT
 20

	)

132 
	#MONO_FACTORS
 0x10001000u

	)

133 
	#COLOR_FACTORS
 0x21102110u

	)

135 
	#CHECK_VALUE
 0xAûC0de4U

	)

159 
BYTE
 
	mlum_quªt
[64];

160 
BYTE
 
	mchrom_quªt
[64];

162 
	mwšo_lum_quªt
[64];

163 
	mwšo_lum_quªt_th»s
[64];

164 
	mwšo_chrom_quªt
[64];

165 
	mwšo_chrom_quªt_th»s
[64];

167 
BOOL
 
	mšput_sub§m¶ed
;

168 
BOOL
 
	mfD’®i
;

169 
BOOL
 
	mfOuutDNL
;

170 
BOOL
 
	mfOuutG3APP1
;

171 
DWORD
 
	mdwDummyH—d”By‹s
;

172 
UINT
 
	mrows_š_mcu
;

173 
UINT
 
	mcŞs_š_mcu
;

174 
UINT
 
	mmcus_š_row
;

175 
DWORD
 
	m§m¶e_çùÜs
;

176 
BYTE
 
	mhÜiz_§m_çcs
[4];

177 
BYTE
 
	mv”t_§m_çcs
 [4];

178 
BYTE
 
	mmax_hÜiz_§m_çc
;

179 
BYTE
 
	mmax_v”t_§m_çc
;

180 
BYTE
 
	mdc_q_çùÜ
;

181 
BYTE
 
	mac_q_çùÜ
;

182 
BYTE
 
	mcomps_š_pix–
;

183 
BYTE
 
	mwh™ePix–
[4];

184 
UINT
 
	mpix–s_š_row
;

185 
	mrows_š_·ge
;

186 
	mxRes
;

187 
	myRes
;

191 
DWORD
 
	mwr_b™_buf
;

194 
	mwr_b™s_ava
;

197 
BYTE
 *
	mwr_outbuf_beg
;

200 
BYTE
 *
	mwr™e_buf_Ãxt
;

205 
	m’c_block
[64];

206 *
	m’c_block_zz
[64+16];

207 
	m´iÜ_DC
[4];

211 
UINT
 
	mrows_»ûived
;

212 
UINT
 
	mrows_lßded
;

213 
UINT
 
	mmcus_£Á
;

214 
BOOL
 
	mlßdšg_rows
;

218 
IP_IMAGE_TRAITS
 
	mŒa™s
;

219 
BYTE
 *
	mš_rows_­
[4][32];

220 
BOOL
 
	mfDidH—d”
;

221 
DWORD
 
	mdwInNextPos
;

222 
DWORD
 
	mdwOutNextPos
;

223 
DWORD
 
	mdwV®idChk
;

225 } 
	tJENC_INST
, *
	tPJENC_INST
;

236 cÚ¡ 
BYTE
 
	gÜig_lum_quªt
[64] = {

248 cÚ¡ 
BYTE
 
	gÜig_chrom_quªt
[64] = {

268 cÚ¡ 
BYTE
 
	gÜig_lum_quªt
[64] = {

288 cÚ¡ 
BYTE
 
	gÜig_chrom_quªt
[64] = {

310 cÚ¡ 
BYTE
 
	gcodesize_¬¿y
[256] = {

341 cÚ¡ 
BYTE
 
	glum_DC_couÁs
[16] = {

346 cÚ¡ 
BYTE
 
	glum_DC_v®ues
[12] = {

350 cÚ¡ 
BYTE
 
	gchrom_DC_couÁs
[16] = {

355 cÚ¡ 
BYTE
 
	gchrom_DC_v®ues
[12] = {

359 cÚ¡ 
BYTE
 
	glum_AC_couÁs
[16] = {

364 cÚ¡ 
BYTE
 
	glum_AC_couÁs_D’®i
[16] = {

379 cÚ¡ 
BYTE
 
	glum_AC_v®ues
[162] = {

403 cÚ¡ 
BYTE
 
	gchrom_AC_couÁs
[16] = {

408 cÚ¡ 
BYTE
 
	gchrom_AC_v®ues
[162] = {

441 
WORD
 
	mcode
;

442 
BYTE
 
	msize
;

443 } 
	thuff_–em_t
;

446 cÚ¡ 
huff_–em_t
 
	glum_DC_bË
[] = {

454 cÚ¡ 
huff_–em_t
 
	glum_AC_bË
[] = {

522 cÚ¡ 
huff_–em_t
 
	glum_AC_bË_D’®i
[] = {

590 cÚ¡ 
huff_–em_t
 
	gchrom_DC_bË
[] = {

598 cÚ¡ 
huff_–em_t
 
	gchrom_AC_bË
[] = {

692 
	#INITIAL_BITS_AVAIL
 (8*(
DWORD
))

	)

706 
	#PUT_BYTE_STUFF
(
g
, 
pbs_by‹_ex´essiÚ
) { \

707 
BYTE
 
pbs_by‹
; \

709 
pbs_by‹
 = (
BYTE
)(
pbs_by‹_ex´essiÚ
); \

710 *(
g
->
wr™e_buf_Ãxt
)++ = 
pbs_by‹
; \

711 ià(
pbs_by‹
 =ğ(
BYTE
)0xff) \

712 *(
g
->
wr™e_buf_Ãxt
)++ = 0; \

713 }

	)

722 
	$wr™e_š™
 (
PJENC_INST
 
g
)

724 
g
->
wr_b™s_ava
 = 
INITIAL_BITS_AVAIL
;

725 
g
->
wr_b™_buf
 = 0;

726 
	}
}

738 
	$wr™e_buf_İ’
 (
PJENC_INST
 
g
, 
BYTE
 *
buf_p
)

740 
g
->
wr_outbuf_beg
 = g->
wr™e_buf_Ãxt
 = 
buf_p
;

741 
	}
}

753 
	$wr™e_buf_şo£
 (
PJENC_INST
 
g
)

755  
g
->
wr™e_buf_Ãxt
 - g->
wr_outbuf_beg
;

756 
	}
}

770 
	#WRITE_BITS_OPEN
(
g
) \

771 
tmp_b™s_ava
 = 
g
->
wr_b™s_ava
; \

772 
DWORD
 
tmp_b™_buf
 = 
g
->
wr_b™_buf
;

	)

775 
	#WRITE_BITS_HIZERO
(
g
,
wb_v®ue
,
wb_nb™s
) { \

776 
DWORD
 
b™s_loc
; \

777 
Ëngth_loc
; \

779 
Ëngth_loc
 = ()(
wb_nb™s
); \

780 
b™s_loc
 = (
DWORD
)(
wb_v®ue
); \

782 ià(
Ëngth_loc
 > 
tmp_b™s_ava
) { \

784 
	`PUT_BYTE_STUFF
 (
g
, 
tmp_b™_buf
 >> 24) \

785 
tmp_b™_buf
 <<= 8; \

786 
tmp_b™s_ava
 += 8; \

787 } 
tmp_b™s_ava
 <= 24); \

790 
tmp_b™s_ava
 -ğ
Ëngth_loc
; \

791 
tmp_b™_buf
 |ğ
b™s_loc
 << 
tmp_b™s_ava
; \

792 }

	)

795 
	#WRITE_BITS
(
g
,
wb_v®ue
,
wb_nb™s
) { \

796 
Ën_loc
; \

798 
Ën_loc
 = ()(
wb_nb™s
); \

799 
	`WRITE_BITS_HIZERO
 (
g
, (
DWORD
 )(
wb_v®ue
è& ((1ul<<
Ën_loc
)-1),†en_loc) \

800 }

	)

803 
	#WRITE_BITS_CLOSE
(
g
) { \

804 
g
->
wr_b™s_ava
 = 
tmp_b™s_ava
; \

805 
g
->
wr_b™_buf
 = 
tmp_b™_buf
; \

806 }

	)

818 
	$wr™e_b™s_æush
 (
PJENC_INST
 
g
)

820 
b™s_u£d
;

822 ià(
g
->
wr_b™s_ava
 !ğ
INITIAL_BITS_AVAIL
) {

824 
g
->
wr_b™_buf
 |ğ((
DWORD
 )1 << g->
wr_b™s_ava
) - 1;

826 
b™s_u£d
 = 
INITIAL_BITS_AVAIL
 - 
g
->
wr_b™s_ava
;

827 
b™s_u£d
 > 0;

828 
b™s_u£d
 -= 8) {

829 
	`PUT_BYTE_STUFF
 (
g
, g->
wr_b™_buf
 >> 24)

830 
g
->
wr_b™_buf
 <<= 8;

833 
g
->
wr_b™s_ava
 = 
INITIAL_BITS_AVAIL
;

834 
g
->
wr_b™_buf
 = 0;

836 
	}
}

857 
	#PUT_MARKER
(
g
,
m¬k”
) \

859 *(
g
->
wr™e_buf_Ãxt
)++ = 0xff; \

860 *(
g
->
wr™e_buf_Ãxt
)++ = (
BYTE
)
m¬k”
; \

861 } 0)

	)

864 
	#PUT_INT
(
g
,
v®ue
) \

866 
loc_v®
 = ()(
v®ue
); \

867 *(
g
->
wr™e_buf_Ãxt
)++ = 
loc_v®
 >> 8; \

868 *(
g
->
wr™e_buf_Ãxt
)++ = 
loc_v®
 & 0xff; \

869 } 0)

	)

878 
	$em_wr™e_SOI
 (
PJENC_INST
 
g
)

880 
	`PUT_MARKER
(
g
, 
MARKER_SOI
);

881 
	}
}

889 
	$em_wr™e_EOI
 (
PJENC_INST
 
g
)

891 
	`PUT_MARKER
(
g
, 
MARKER_EOI
);

892 
	}
}

900 
	$em_wr™e_JFIF_APP0
 (

901 
PJENC_INST
 
g
,

902 
xRes
,

903 
yRes
)

905 
	`PUT_MARKER
 (
g
, 
MARKER_APP
+0);

906 
	`PUT_INT
 (
g
, 16);

909 *(
g
->
wr™e_buf_Ãxt
)++ = 'J';

910 *(
g
->
wr™e_buf_Ãxt
)++ = 'F';

911 *(
g
->
wr™e_buf_Ãxt
)++ = 'I';

912 *(
g
->
wr™e_buf_Ãxt
)++ = 'F';

913 *(
g
->
wr™e_buf_Ãxt
)++ = '\0';

916 *(
g
->
wr™e_buf_Ãxt
)++ = 0x01;

917 *(
g
->
wr™e_buf_Ãxt
)++ = 0x00;

920 *(
g
->
wr™e_buf_Ãxt
)++ = 0x01;

922 
	`PUT_INT
(
g
, 
xRes
);

923 
	`PUT_INT
(
g
, 
yRes
);

926 *(
g
->
wr™e_buf_Ãxt
)++ = 0x00;

927 *(
g
->
wr™e_buf_Ãxt
)++ = 0x00;

928 
	}
}

936 
	$em_wr™e_G3_APP1
 (

937 
PJENC_INST
 
g
,

938 
»s
)

940 
»s
 = ((res+50)/100)*100;

942 
	`PUT_MARKER
 (
g
, 
MARKER_APP
+1);

943 
	`PUT_INT
 (
g
, 12);

946 *(
g
->
wr™e_buf_Ãxt
)++ = 'G';

947 *(
g
->
wr™e_buf_Ãxt
)++ = '3';

948 *(
g
->
wr™e_buf_Ãxt
)++ = 'F';

949 *(
g
->
wr™e_buf_Ãxt
)++ = 'A';

950 *(
g
->
wr™e_buf_Ãxt
)++ = 'X';

951 *(
g
->
wr™e_buf_Ãxt
)++ = 0;

953 
	`PUT_INT
 (
g
, 1994);

954 
	`PUT_INT
 (
g
, 
»s
);

955 
	}
}

963 
	$em_wr™e_SOF
 (

964 
PJENC_INST
 
g
,

965 
width
,

966 
height
,

967 
ncomps
,

968 
BYTE
 
h_§m_çcs
[],

969 
BYTE
 
v_§m_çcs
[])

971 
i
;

973 
	`PUT_MARKER
(
g
, 
MARKER_SOF0
);

974 
	`PUT_INT
(
g
, 8 + 
ncomps
*3);

975 *(
g
->
wr™e_buf_Ãxt
)++ = 8;

976 
	`PUT_INT
(
g
, 
height
);

977 
	`PUT_INT
(
g
, 
width
);

978 *(
g
->
wr™e_buf_Ãxt
)++ = 
ncomps
;

980 
i
=0; i<
ncomps
; i++) {

981 *(
g
->
wr™e_buf_Ãxt
)++ = 
i
;

982 *(
g
->
wr™e_buf_Ãxt
)++ = 
h_§m_çcs
[
i
]<<4 | 
v_§m_çcs
[i];

983 *(
g
->
wr™e_buf_Ãxt
)++ = (
i
==0 ? 0 : 1);

985 
	}
}

993 
	$em_wr™e_DQT
 (

994 
PJENC_INST
 
g
,

995 
´ecisiÚ
,

996 
id’t
,

997 
BYTE
 
–em’ts
[64])

999 
	`PUT_MARKER
(
g
, 
MARKER_DQT
);

1000 
	`PUT_INT
(
g
, 67);

1001 *(
g
->
wr™e_buf_Ãxt
)++ = (
´ecisiÚ
 << 4è+ 
id’t
;

1002 
	`memıy
 (
g
->
wr™e_buf_Ãxt
, 
–em’ts
, 64);

1003 
g
->
wr™e_buf_Ãxt
 += 64;

1004 
	}
}

1012 
	$em_wr™e_DHTs
 (

1013 
PJENC_INST
 
g
,

1014 
ÁabËs
,

1015 
BYTE
 
hşass
[],

1016 
BYTE
 
id’t
[],

1017 cÚ¡ 
BYTE
 *
couÁs
[],

1018 cÚ¡ 
BYTE
 *
huffv®
[])

1020 
nv®s
, 
i
, 
j
;

1022 
nv®s
 = 0;

1023 
i
=0; i<
ÁabËs
; i++) {

1024 
j
=0; j<16; j++)

1025 
nv®s
 +ğ
couÁs
[
i
][
j
];

1028 
	`PUT_MARKER
(
g
, 
MARKER_DHT
);

1029 
	`PUT_INT
(
g
, 2 + 17*
ÁabËs
 + 
nv®s
);

1031 
i
=0; i<
ÁabËs
; i++) {

1032 
nv®s
=
j
=0; j<16; j++)

1033 
nv®s
 +ğ
couÁs
[
i
][
j
];

1035 *(
g
->
wr™e_buf_Ãxt
)++ = 
hşass
[
i
]<<4 | 
id’t
[i];

1036 
j
=0; j<16; j++è*(
g
->
wr™e_buf_Ãxt
)++ = 
couÁs
[
i
][j];

1037 
j
=0; j<
nv®s
; j++è*(
g
->
wr™e_buf_Ãxt
)++ = 
huffv®
[
i
][j];

1039 
	}
}

1047 
	$em_wr™e_SOS
 (

1048 
PJENC_INST
 
g
,

1049 
ncomps
)

1051 
i
;

1053 
	`PUT_MARKER
(
g
, 
MARKER_SOS
);

1054 
	`PUT_INT
(
g
, 6 + 2*
ncomps
);

1055 *(
g
->
wr™e_buf_Ãxt
)++ = 
ncomps
;

1057 
i
=0; i<
ncomps
; i++) {

1058 *(
g
->
wr™e_buf_Ãxt
)++ = 
i
;

1059 *(
g
->
wr™e_buf_Ãxt
)++ = (
i
==0 ? 0x00 : 0x11);

1062 *(
g
->
wr™e_buf_Ãxt
)++ = 0;

1063 *(
g
->
wr™e_buf_Ãxt
)++ = 63;

1064 *(
g
->
wr™e_buf_Ãxt
)++ = 0;

1065 
	}
}

1073 
	$em_wr™e_DNL
 (

1074 
PJENC_INST
 
g
,

1075 
Æšes
)

1077 
	`PUT_MARKER
(
g
, 
MARKER_DNL
);

1078 
	`PUT_INT
(
g
, 4);

1079 
	`PUT_INT
(
g
, 
Æšes
);

1080 
	}
}

1093 
	$em_wr™e_shÜt_h—d”
 (

1094 
PJENC_INST
 
g
,

1095 
UINT
 
rows_š_·ge
,

1096 
UINT
 
pix–s_š_row
,

1097 
UINT
 
xRes
,

1098 
UINT
 
yRes
,

1099 
UINT
 
dc_q_çùÜ
,

1100 
UINT
 
ac_q_çùÜ
,

1101 
UINT
 
comps_š_pix–
,

1102 
DWORD
 
§m¶e_çùÜs
)

1104 
	`PUT_MARKER
 (
g
, 
MARKER_SHORT_HEADER
);

1105 
	`PUT_INT
 (
g
, 18);

1106 
	`PUT_INT
 (
g
, 
rows_š_·ge
);

1107 
	`PUT_INT
 (
g
, 
pix–s_š_row
);

1108 
	`PUT_INT
 (
g
, 
xRes
);

1109 
	`PUT_INT
 (
g
, 
yRes
);

1110 *(
g
->
wr™e_buf_Ãxt
)++ = 
ac_q_çùÜ
 * 5 / 2;

1111 *(
g
->
wr™e_buf_Ãxt
)++ = 
comps_š_pix–
;

1112 
	`PUT_INT
 (
g
, 
§m¶e_çùÜs
 >> 16);

1113 
	`PUT_INT
 (
g
, 
§m¶e_çùÜs
 & 0x0000ffffu);

1114 *(
g
->
wr™e_buf_Ãxt
)++ = 
dc_q_çùÜ
 * 5 / 2;

1115 *(
g
->
wr™e_buf_Ãxt
)++ = 0;

1116 
	}
}

1130 
	#BITS_IN_DCT_FRAC
 15

	)

1131 
	#ROUND
(
x
è(((x)+(1l<<(
BITS_IN_DCT_FRAC
-1))è>> BITS_IN_DCT_FRAC)

	)

1142 
	#a1
 23170L

	)

1143 
	#a2
 17734L

	)

1144 
	#a3
 23170L

	)

1145 
	#a4
 42813L

	)

1146 
	#a5
 12540L

	)

1155 cÚ¡ 
	gwšo_nÜm_tbl
[] = {

1180 
	$sÿË_fÜ_wšo
 (

1181 
BYTE
 *
š
,

1182 *
out
,

1183 *
th»sh
)

1185 
	#FIX
(
x
è((è((x)*(1l<<
BITS_IN_DCT_FRAC
è+ 0.5))

	)

1186 cÚ¡ *
åŒ
;

1187 
i
, 
q
;

1194 ià(
š
[63] < 2) in[63] = 2;

1196 
åŒ
 = 
wšo_nÜm_tbl
;

1197 
i
=0; i<64; i++) {

1198 
q
 = 
	`FIX
 (*
åŒ
++ / ()(*
š
++));

1199 *
out
++ = 
q
;

1200 ià(
q
 =ğ0è*
th»sh
++ = 32767;

1201 *
th»sh
++ = (1 << (
BITS_IN_DCT_FRAC
-1)è/ 
q
;

1203 
	}
}

1217 cÚ¡ 
BYTE
 
	gzigzag_šdex_bË
[64] = {

1229 
	#WRITE_HUFF_CODE
(
g
,
v®
,
huffmª
) { \

1230 
whc_v®
 = ()(
v®
); \

1231 
	`WRITE_BITS_HIZERO
 (
g
, 
huffmª
[
whc_v®
].
code
, huffmª[whc_v®].
size
) \

1232 }

	)

1236 
	$z”o_´iÜ_DC
 (
PJENC_INST
 
g
)

1238 
g
->
´iÜ_DC
[0] = g->prior_DC[1] = g->prior_DC[2] = g->prior_DC[3] = 0;

1239 
	}
}

1248 
	$’code_š™
 (
PJENC_INST
 
g
)

1250 
BYTE
 cÚ¡ *
zig_p
;

1251 **
block_µ
;

1253 
zig_p
 = 
zigzag_šdex_bË
;

1254 
block_µ
=
g
->
’c_block_zz
; block_pp<g->enc_block_zz+(64+16); block_pp++)

1255 *
block_µ
 = &(
g
->
’c_block
[*
zig_p
++]);

1256 
	}
}

1272 
	$’code_block
 (

1273 
PJENC_INST
 
g
,

1274 
comp
,

1275 cÚ¡ 
huff_–em_t
 *
dc_huff_p
,

1276 cÚ¡ 
huff_–em_t
 *
ac_huff_p
,

1277 *
quªt_p
,

1278 *
th»sh_p
)

1280 **
block_p
;

1281 
i
, 
d©a
, 
absd©a
, 
run
, 
siz
;

1282 
diff
, 
absdiff
;

1283 
	`WRITE_BITS_OPEN
(
g
)

1289 
th»sh_p
++;

1290 
block_p
 = 
g
->
’c_block_zz
;

1291 
d©a
 = 
	`ROUND
 (()*(*
block_p
++è* (*
quªt_p
++));

1292 
absdiff
 = 
diff
 = 
d©a
 - 
g
->
´iÜ_DC
[
comp
];

1293 ià(
absdiff
 < 0)‡bsdiff = -absdiff;

1294 
g
->
´iÜ_DC
[
comp
] = 
d©a
;

1296 ià(
absdiff
 < 256è
siz
 = 
codesize_¬¿y
[absdiff];

1297 
siz
 = 
codesize_¬¿y
[
absdiff
>>8] + 8;

1299 
	`WRITE_HUFF_CODE
 (
g
, 
siz
, 
dc_huff_p
)

1300 
	`WRITE_BITS
 (
g
, 
diff
<0 ? diff-1 : diff, 
siz
)

1306 
run
 = 0;

1308 
i
=63; i>0; i--)

1310 
absd©a
 = 
d©a
 = *(*
block_p
++);

1311 ià(
absd©a
 < 0)‡bsdata = -absdata;

1313 ià(
absd©a
 <ğ*
th»sh_p
++) {

1315 
quªt_p
++;

1316 
run
++;

1320 
run
 >= 16) {

1321 
	`WRITE_HUFF_CODE
 (
g
, 
RUN_OF_16
, 
ac_huff_p
)

1322 
run
 -= 16;

1325 
absd©a
 = 
	`ROUND
 ((
DWORD
 )absd©¨* (DWORD )(*
quªt_p
++));

1326 ià(
absd©a
 < 256è
siz
 = 
codesize_¬¿y
[absdata];

1327 
siz
 = 
codesize_¬¿y
[
absd©a
>>8] + 8;

1330 
	`WRITE_HUFF_CODE
 (
g
, (
run
<<4è+ 
siz
, 
ac_huff_p
)

1331 
	`WRITE_BITS
 (
g
, 
d©a
<0 ? ~
absd©a
 :‡bsd©a, 
siz
)

1332 
run
 = 0;

1336 ià(
run
>0 || 
g
->
fD’®i
)

1337 
	`WRITE_HUFF_CODE
 (
g
, 0, 
ac_huff_p
)

1339 
	`WRITE_BITS_CLOSE
(
g
)

1340 
	}
}

1349 
	$’code_MCU
 (

1350 
PJENC_INST
 
g
,

1351 
UINT
 
mcu_šdex
)

1353 *
block_p
;

1354 
UINT
 
comp
;

1355 
UINT
 
h_block
, 
v_block
;

1356 
UINT
 
ul_row
, 
ul_cŞ
;

1357 
UINT
 
row
;

1358 
BYTE
 **
row_µ
;

1359 
BYTE
 *
row_p
;

1361 
comp
=0; comp<
g
->
comps_š_pix–
; comp++) {

1362 
v_block
=0; v_block<
g
->
v”t_§m_çcs
[
comp
]; v_block++) {

1363 
h_block
=0; h_block<
g
->
hÜiz_§m_çcs
[
comp
]; h_block++) {

1367 
ul_row
 = 
v_block
*8;

1368 
ul_cŞ
 = (
mcu_šdex
*
g
->
hÜiz_§m_çcs
[
comp
] + 
h_block
) * 8;

1369 
row_µ
 = &(
g
->
š_rows_­
[
comp
][
ul_row
]);

1370 
block_p
 = 
g
->
’c_block
;

1372 
row
=0;„ow<8;„ow++) {

1373 
row_p
 = *
row_µ
++ + 
ul_cŞ
;

1375 *
block_p
++ = ()(
UINT
)*
row_p
++ - 128;

1376 *
block_p
++ = ()(
UINT
)*
row_p
++ - 128;

1377 *
block_p
++ = ()(
UINT
)*
row_p
++ - 128;

1378 *
block_p
++ = ()(
UINT
)*
row_p
++ - 128;

1379 *
block_p
++ = ()(
UINT
)*
row_p
++ - 128;

1380 *
block_p
++ = ()(
UINT
)*
row_p
++ - 128;

1381 *
block_p
++ = ()(
UINT
)*
row_p
++ - 128;

1382 *
block_p
++ = ()(
UINT
)*
row_p
 - 128;

1385 
	`dù_fÜw¬d
 (
g
->
’c_block
);

1389 ià(
comp
 == 0) {

1390 
	`’code_block
 (
g
, 
comp
, 
lum_DC_bË
, g->
fD’®i
 ? 
lum_AC_bË_D’®i
 : 
lum_AC_bË
,

1391 
g
->
wšo_lum_quªt
, g->
wšo_lum_quªt_th»s
);

1393 
	`’code_block
 (
g
, 
comp
, 
chrom_DC_bË
, 
chrom_AC_bË
,

1394 
g
->
wšo_chrom_quªt
, g->
wšo_chrom_quªt_th»s
);

1399 
	}
}

1436 
	$cİy_š_rows
 (

1437 
PJENC_INST
 
g
,

1438 
UINT
 
row_šdex
,

1439 
BYTE
 *
šbuf_p
,

1440 
UINT
 *
n_rows_p
,

1441 
UINT
 *
n_by‹s_p
)

1443 
BYTE
 *
š_p
;

1444 
UINT
 
comp
;

1445 
UINT
 
v”t_³riod
, 
v”t_mod
;

1447 
v”t_³riod
 = 
row_šdex
 / 
g
->
max_v”t_§m_çc
;

1448 
v”t_mod
 = 
row_šdex
 % 
g
->
max_v”t_§m_çc
;

1450 ià(!
g
->
šput_sub§m¶ed
 || (g->
max_v”t_§m_çc
==1 && g->
max_hÜiz_§m_çc
==1))

1456 
BYTE
 *
row_p
;

1457 
UINT
 
§m_çc
;

1458 
UINT
 
cŞ
, 
hÜiz_mod
;

1459 
UINT
 
šc
;

1461 
comp
=0; comp<
g
->
comps_š_pix–
; comp++) {

1462 
§m_çc
 = 
g
->
v”t_§m_çcs
[
comp
];

1464 ià(
v”t_mod
 < 
§m_çc
) {

1465 
š_p
 = 
šbuf_p
 + 
comp
;

1466 
row_p
 = 
g
->
š_rows_­
[
comp
][
v”t_³riod
*
§m_çc
 + 
v”t_mod
];

1467 
hÜiz_mod
 = 0;

1468 
§m_çc
 = 
g
->
hÜiz_§m_çcs
[
comp
];

1470 ià(
§m_çc
 =ğ
g
->
max_hÜiz_§m_çc
) {

1474 ià(
g
->
comps_š_pix–
 == 1) {

1475 
	`memıy
 (
row_p
, 
š_p
, 
g
->
pix–s_š_row
);

1477 
cŞ
=0; cŞ<
g
->
pix–s_š_row
; col+=4) {

1478 *
row_p
++ = *
š_p
; in_°+ğ
g
->
comps_š_pix–
;

1479 *
row_p
++ = *
š_p
; in_°+ğ
g
->
comps_š_pix–
;

1480 *
row_p
++ = *
š_p
; in_°+ğ
g
->
comps_š_pix–
;

1481 *
row_p
++ = *
š_p
; in_°+ğ
g
->
comps_š_pix–
;

1485 } ià(
§m_çc
==1 && 
g
->
max_hÜiz_§m_çc
==2) {

1489 
šc
 = 2 * 
g
->
comps_š_pix–
;

1490 
cŞ
=0; cŞ<
g
->
pix–s_š_row
; col+=8) {

1491 *
row_p
++ = *
š_p
; in_°+ğ
šc
;

1492 *
row_p
++ = *
š_p
; in_°+ğ
šc
;

1493 *
row_p
++ = *
š_p
; in_°+ğ
šc
;

1494 *
row_p
++ = *
š_p
; in_°+ğ
šc
;

1501 
cŞ
=0; cŞ<
g
->
pix–s_š_row
; col++) {

1502 ià(
hÜiz_mod
 < 
§m_çc
è*
row_p
++ = *
š_p
;

1503 
š_p
 +ğ
g
->
comps_š_pix–
;

1504 
hÜiz_mod
 += 1;

1505 ià(
hÜiz_mod
 =ğ
g
->
max_hÜiz_§m_çc
) horiz_mod = 0;

1511 *
n_rows_p
 = 1;

1512 *
n_by‹s_p
 = 
g
->
comps_š_pix–
 * g->
pix–s_š_row
;

1520 
UINT
 
hÜiz_³riod
, 
³riods_š_row
;

1521 
UINT
 
ul_row
, 
ul_cŞ
, 
row
, 
cŞ
;

1522 
BYTE
 *
row_y1_p
, *
row_y2_p
, *
row_cb_p
, *
row_ü_p
;

1524 
š_p
 = 
šbuf_p
;

1525 
³riods_š_row
 = 
g
->
mcus_š_row
 * 8;

1527 ià(
g
->
§m¶e_çùÜs
 == 0x21102110u) {

1528 
row_y1_p
 = 
g
->
š_rows_­
[0][2*
v”t_³riod
];

1529 
row_y2_p
 = 
g
->
š_rows_­
[0][2*
v”t_³riod
+1];

1530 
row_cb_p
 = 
g
->
š_rows_­
[1][
v”t_³riod
];

1531 
row_ü_p
 = 
g
->
š_rows_­
[2][
v”t_³riod
];

1532 
hÜiz_³riod
=0; hÜiz_³riod<
³riods_š_row
; horiz_period++) {

1533 *
row_y1_p
++ = *
š_p
++;

1534 *
row_y1_p
++ = *
š_p
++;

1535 *
row_y2_p
++ = *
š_p
++;

1536 *
row_y2_p
++ = *
š_p
++;

1537 *
row_cb_p
++ = *
š_p
++;

1538 *
row_ü_p
++ = *
š_p
++;

1542 
hÜiz_³riod
=0; hÜiz_³riod<
³riods_š_row
; horiz_period++) {

1543 
comp
=0; comp<
g
->
comps_š_pix–
; comp++) {

1544 
ul_row
 = 
v”t_³riod
 * 
g
->
v”t_§m_çcs
[
comp
];

1545 
ul_cŞ
 = 
hÜiz_³riod
 * 
g
->
hÜiz_§m_çcs
[
comp
];

1547 
row
=
ul_row
;„ow<ul_row+ 
g
->
v”t_§m_çcs
[
comp
];„ow++)

1548 
cŞ
=
ul_cŞ
; cŞ<ul_cŞ+
g
->
hÜiz_§m_çcs
[
comp
]; col++) {

1549 
g
->
š_rows_­
[
comp
][
row
][
cŞ
] = *
š_p
++;

1555 *
n_rows_p
 = 
g
->
max_v”t_§m_çc
;

1556 *
n_by‹s_p
 = 
š_p
 - 
šbuf_p
;

1558 
	}
}

1576 
	$sÿË_q_bË
 (

1577 
UINT
 
dc_q_çùÜ
,

1578 
UINT
 
ac_q_çùÜ
,

1579 cÚ¡ 
BYTE
 *
š
,

1580 
BYTE
 *
out
)

1582 
	#FINAL_DC_INDEX
 9

	)

1584 
UINT
 
i
, 
v®
;

1585 
UINT
 
q
;

1587 
q
 = 
dc_q_çùÜ
;

1589 
i
=0; i<64; i++) {

1590 
v®
 = ((*
š
++)*
q
 + 
Q_DEFAULT
/2) / Q_DEFAULT;

1591 ià(
v®
 < 1) val = 1;

1592 ià(
v®
 > 255) val = 255;

1593 *
out
++ = (
BYTE
)
v®
;

1594 ià(
i
 =ğ
FINAL_DC_INDEX
)

1595 
q
 = 
ac_q_çùÜ
;

1597 
	}
}

1610 
UINT
 
	$ouut_h—d”
 (

1611 
PJENC_INST
 
g
,

1612 
BYTE
 *
buf_p
)

1614 
BYTE
 
hşass
[4];

1615 
BYTE
 
id’t
[4];

1616 cÚ¡ 
BYTE
 *
couÁs
[4];

1617 cÚ¡ 
BYTE
 *
huffv®
[4];

1619 
hşass
 [0] = 0;

1620 
id’t
 [0] = 0;

1621 
couÁs
 [0] = 
lum_DC_couÁs
;

1622 
huffv®
[0] = 
lum_DC_v®ues
;

1624 
hşass
 [1] = 1;

1625 
id’t
 [1] = 0;

1626 
couÁs
 [1] = 
g
->
fD’®i
 ? 
lum_AC_couÁs_D’®i
 : 
lum_AC_couÁs
;

1627 
huffv®
[1] = 
lum_AC_v®ues
;

1629 
hşass
 [2] = 0;

1630 
id’t
 [2] = 1;

1631 
couÁs
 [2] = 
chrom_DC_couÁs
;

1632 
huffv®
[2] = 
chrom_DC_v®ues
;

1634 
hşass
 [3] = 1;

1635 
id’t
 [3] = 1;

1636 
couÁs
 [3] = 
chrom_AC_couÁs
;

1637 
huffv®
[3] = 
chrom_AC_v®ues
;

1639 
	`wr™e_buf_İ’
 (
g
, 
buf_p
);

1640 
	`em_wr™e_SOI
 (
g
);

1643 
	`em_wr™e_shÜt_h—d”
 (
g
, g->
rows_š_·ge
<0 ? 0 : g->rows_in_page,

1644 
g
->
pix–s_š_row
,

1645 
g
->
xRes
, g->
yRes
,

1646 
g
->
dc_q_çùÜ
, g->
ac_q_çùÜ
,

1647 
g
->
comps_š_pix–
,

1648 
g
->
§m¶e_çùÜs
);

1650 ià(
g
->
fOuutG3APP1
)

1651 
	`em_wr™e_G3_APP1
 (
g
, g->
xRes
);

1653 
	`em_wr™e_JFIF_APP0
 (
g
, g->
xRes
, g->
yRes
);

1654 
	`em_wr™e_SOF
 (
g
, g->
pix–s_š_row
, g->
rows_š_·ge
<0 ? 0 : g->rows_in_page,

1655 
g
->
comps_š_pix–
, g->
hÜiz_§m_çcs
, g->
v”t_§m_çcs
);

1656 
	`em_wr™e_DQT
 (
g
, 0, 0, g->
lum_quªt
);

1657 ià(
g
->
comps_š_pix–
 > 1)

1658 
	`em_wr™e_DQT
 (
g
, 0, 1, g->
chrom_quªt
);

1659 
	`em_wr™e_DHTs
 (
g
, g->
comps_š_pix–
==1 ? 2 : 4,

1660 
hşass
, 
id’t
, 
couÁs
, 
huffv®
);

1661 
	`em_wr™e_SOS
 (
g
, g->
comps_š_pix–
);

1663  
	`wr™e_buf_şo£
 (
g
);

1664 
	}
}

1681 
WORD
 
	$jpgEncode_İ’XfÜm
 (

1682 
IP_XFORM_HANDLE
 *
pXfÜm
)

1684 
PJENC_INST
 
g
;

1686 
	`INSURE
 (
pXfÜm
 !ğ
NULL
);

1687 
	`IP_MEM_ALLOC
 ((
JENC_INST
), 
g
);

1688 *
pXfÜm
 = 
g
;

1689 
	`mem£t
 (
g
, 0, (
JENC_INST
));

1690 
g
->
dwV®idChk
 = 
CHECK_VALUE
;

1691  
IP_DONE
;

1693 
çl_”rÜ
:

1694  
IP_FATAL_ERROR
;

1695 
	}
}

1714 
WORD
 
	$jpgEncode_£tDeçuÉIÅutT¿™s
 (

1715 
IP_XFORM_HANDLE
 
hXfÜm
,

1716 
PIP_IMAGE_TRAITS
 
pT¿™s
)

1718 
PJENC_INST
 
g
;

1720 
	`HANDLE_TO_PTR
 (
hXfÜm
, 
g
);

1721 
g
->
Œa™s
 = *
pT¿™s
;

1723 
	`INSURE
 (
g
->
Œa™s
.
iPix–sP”Row
 > 0);

1724 
	`INSURE
 (
g
->
Œa™s
.
iCompÚ’tsP”Pix–
==1 || g->traits.iComponentsPerPixel==3);

1726 
g
->
pix–s_š_row
 = g->
Œa™s
.
iPix–sP”Row
;

1727 
g
->
comps_š_pix–
 = g->
Œa™s
.
iCompÚ’tsP”Pix–
;

1728 
g
->
rows_š_·ge
 = g->
Œa™s
.
lNumRows
;

1729 
g
->
xRes
 = g->
Œa™s
.
lHÜizDPI
 >> 16;

1730 
g
->
yRes
 = g->
Œa™s
.
lV”tDPI
 >> 16;

1731 ià(
g
->
xRes
 < 0) g->xRes = 300;

1732 ià(
g
->
yRes
 < 0) g->yRes = 300;

1734 
g
->
fDidH—d”
 = 
FALSE
;

1735  
IP_DONE
;

1737 
çl_”rÜ
:

1738  
IP_FATAL_ERROR
;

1739 
	}
}

1749 
WORD
 
	$jpgEncode_£tXfÜmS³c
 (

1750 
IP_XFORM_HANDLE
 
hXfÜm
,

1751 
DWORD_OR_PVOID
 
aXfÜmInfo
[])

1753 
PJENC_INST
 
g
;

1754 
UINT
 
qçcs
;

1756 
	`HANDLE_TO_PTR
 (
hXfÜm
, 
g
);

1758 
qçcs
 = 
aXfÜmInfo
[
IP_JPG_ENCODE_QUALITY_FACTORS
].
dwÜd
;

1759 
g
->
§m¶e_çùÜs
 = 
aXfÜmInfo
[
IP_JPG_ENCODE_SAMPLE_FACTORS
].
dwÜd
;

1760 
g
->
šput_sub§m¶ed
 = 
aXfÜmInfo
[
IP_JPG_ENCODE_ALREADY_SUBSAMPLED
].
dwÜd
;

1761 
g
->
fD’®i
 = (
BOOL
)
aXfÜmInfo
[
IP_JPG_ENCODE_FOR_DENALI
].
dwÜd
;

1762 
g
->
fOuutDNL
 = (
BOOL
)
aXfÜmInfo
[
IP_JPG_ENCODE_OUTPUT_DNL
].
dwÜd
;

1763 
g
->
fOuutG3APP1
 = (
BOOL
)
aXfÜmInfo
[
IP_JPG_ENCODE_FOR_COLOR_FAX
].
dwÜd
;

1764 
g
->
dwDummyH—d”By‹s
 = 
aXfÜmInfo
[
IP_JPG_ENCODE_DUMMY_HEADER_LEN
].
dwÜd
;

1766 
g
->
dc_q_çùÜ
 = (
BYTE
)(
qçcs
 >> 8);

1767 
g
->
ac_q_çùÜ
 = (
BYTE
)(
qçcs
);

1769  
IP_DONE
;

1771 
çl_”rÜ
:

1772  
IP_FATAL_ERROR
;

1773 
	}
}

1783 
WORD
 
	$jpgEncode_g‘H—d”BufSize
 (

1784 
IP_XFORM_HANDLE
 
hXfÜm
,

1785 
DWORD
 *
pdwInBufL’
)

1787 
PJENC_INST
 
g
;

1789 
	`HANDLE_TO_PTR
 (
hXfÜm
, 
g
);

1791 *
pdwInBufL’
 = 0;

1792  
IP_DONE
;

1794 
çl_”rÜ
:

1795  
IP_FATAL_ERROR
;

1796 
	}
}

1806 
WORD
 
	$jpgEncode_g‘Aùu®T¿™s
 (

1807 
IP_XFORM_HANDLE
 
hXfÜm
,

1808 
DWORD
 
dwIÅutAva
,

1809 
PBYTE
 
pbIÅutBuf
,

1810 
PDWORD
 
pdwIÅutU£d
,

1811 
PDWORD
 
pdwIÅutNextPos
,

1812 
PIP_IMAGE_TRAITS
 
pInT¿™s
,

1813 
PIP_IMAGE_TRAITS
 
pOutT¿™s
)

1815 
PJENC_INST
 
g
;

1817 
	`HANDLE_TO_PTR
 (
hXfÜm
, 
g
);

1820 *
pdwIÅutU£d
 = 0;

1821 *
pdwIÅutNextPos
 = 0;

1824 *
pInT¿™s
 = 
g
->
Œa™s
;

1825 *
pOutT¿™s
 = 
g
->
Œa™s
;

1827  
IP_DONE
 | 
IP_READY_FOR_DATA
;

1829 
çl_”rÜ
:

1830  
IP_FATAL_ERROR
;

1831 
	}
}

1841 
WORD
 
	$jpgEncode_g‘Aùu®BufSizes
 (

1842 
IP_XFORM_HANDLE
 
hXfÜm
,

1843 
PDWORD
 
pdwMšInBufL’
,

1844 
PDWORD
 
pdwMšOutBufL’
)

1846 
PJENC_INST
 
g
;

1847 
WORD
 
n
;

1849 
	`HANDLE_TO_PTR
 (
hXfÜm
, 
g
);

1850 *
pdwMšInBufL’
 = 
g
->
comps_š_pix–
 * g->
pix–s_š_row
;

1852 
n
 = 
OUTBUF_NUM_MCUS
 * 
MAX_MCU_SIZE
;

1853 ià(
n
 < 
MAX_HEADER_SIZE
)‚ = MAX_HEADER_SIZE;

1854 *
pdwMšOutBufL’
 = 
n
;

1856  
IP_DONE
;

1858 
çl_”rÜ
:

1859  
IP_FATAL_ERROR
;

1860 
	}
}

1870 
WORD
 
	$jpgEncode_cÚv”t
 (

1871 
IP_XFORM_HANDLE
 
hXfÜm
,

1872 
DWORD
 
dwIÅutAva
,

1873 
PBYTE
 
pbIÅutBuf
,

1874 
PDWORD
 
pdwIÅutU£d
,

1875 
PDWORD
 
pdwIÅutNextPos
,

1876 
DWORD
 
dwOuutAva
,

1877 
PBYTE
 
pbOuutBuf
,

1878 
PDWORD
 
pdwOuutU£d
,

1879 
PDWORD
 
pdwOuutThisPos
)

1881 
PJENC_INST
 
g
;

1882 
»t_v®
;

1883 
UINT
 
row
, 
n_rows
, 
n_by‹s
;

1884 
comp
;

1885 
UINT
 
row_Ën
;

1886 
UINT
 
n_lßded
;

1888 
	`HANDLE_TO_PTR
 (
hXfÜm
, 
g
);

1890 *
pdwIÅutNextPos
 = 
g
->
dwInNextPos
;

1891 *
pdwIÅutU£d
 = 0;

1892 *
pdwOuutThisPos
 = 
g
->
dwOutNextPos
;

1893 *
pdwOuutU£d
 = 0;

1894 
»t_v®
 = 
IP_READY_FOR_DATA
;

1900 ià(! 
g
->
fDidH—d”
) {

1901 
UINT
 
row_Ën
;

1902 
BYTE
 *
p
;

1903 
DWORD
 
çùÜs
;

1904 
UINT
 
çc
;

1908 
g
->
rows_lßded
 = 0;

1909 
g
->
mcus_£Á
 = 0;

1910 
g
->
lßdšg_rows
 = 
TRUE
;

1911 
	`wr™e_š™
 (
g
);

1912 
	`z”o_´iÜ_DC
 (
g
);

1913 
	`’code_š™
 (
g
);

1915 ià(
g
->
ac_q_çùÜ
 == 0)

1916 
g
->
ac_q_çùÜ
 = 
Q_DEFAULT
;

1917 ià(
g
->
dc_q_çùÜ
 == 0)

1918 
g
->
dc_q_çùÜ
 = g->
ac_q_çùÜ
;

1920 ià(
g
->
§m¶e_çùÜs
 == 0)

1921 
g
->
§m¶e_çùÜs
 = g->
comps_š_pix–
==1 ? 
MONO_FACTORS
 : 
COLOR_FACTORS
;

1923 
çùÜs
 = 
g
->
§m¶e_çùÜs
 >> 16;

1924 
g
->
max_hÜiz_§m_çc
 = 0;

1925 
comp
=3; comp>=0; comp--) {

1926 
çc
 = 
çùÜs
 & 0x0fu;

1927 ià(
çc
 > 
g
->
max_hÜiz_§m_çc
) g->max_horiz_sam_fac = fac;

1928 
g
->
hÜiz_§m_çcs
[
comp
] = 
çc
;

1929 
çùÜs
 >>= 4;

1932 
çùÜs
 = 
g
->
§m¶e_çùÜs
 & 0x0000ffffu;

1933 
g
->
max_v”t_§m_çc
 = 0;

1934 
comp
=3; comp>=0; comp--) {

1935 
çc
 = 
çùÜs
 & 0x0fu;

1936 ià(
çc
 > 
g
->
max_v”t_§m_çc
) g->max_vert_sam_fac = fac;

1937 
g
->
v”t_§m_çcs
[
comp
] = 
çc
;

1938 
çùÜs
 >>= 4;

1941 
g
->
cŞs_š_mcu
 = g->
max_hÜiz_§m_çc
 * 8;

1942 
g
->
rows_š_mcu
 = g->
max_v”t_§m_çc
 * 8;

1943 
g
->
mcus_š_row
 = (g->
pix–s_š_row
 + g->
cŞs_š_mcu
 - 1) / g->cols_in_mcu;

1945 
	`sÿË_q_bË
 (
g
->
dc_q_çùÜ
, g->
ac_q_çùÜ
, 
Üig_lum_quªt
, g->
lum_quªt
);

1946 
	`sÿË_q_bË
 (
g
->
dc_q_çùÜ
, g->
ac_q_çùÜ
, 
Üig_chrom_quªt
, g->
chrom_quªt
);

1949 
	`sÿË_fÜ_wšo
 (
g
->
lum_quªt
, g->
wšo_lum_quªt
, g->
wšo_lum_quªt_th»s
);

1950 
	`sÿË_fÜ_wšo
 (
g
->
chrom_quªt
, g->
wšo_chrom_quªt
, g->
wšo_chrom_quªt_th»s
);

1952 
g
->
wh™ePix–
[0] = 255;

1953 
g
->
wh™ePix–
[1] = 128;

1954 
g
->
wh™ePix–
[2] = 128;

1955 
g
->
wh™ePix–
[3] = 255;

1957 
g
->
dwOutNextPos
 = *
pdwOuutU£d
 = (g->
dwDummyH—d”By‹s
 == 0)

1958 ? 
	`ouut_h—d”
 (
g
,
pbOuutBuf
)

1959 : 
g
->
dwDummyH—d”By‹s
;

1961 *
pdwOuutThisPos
 = 0;

1965 
	`mem£t
 (
g
->
š_rows_­
, 0, (g->in_rows_ap));

1967 
comp
=0; comp<()
g
->
comps_š_pix–
; comp++) {

1968 
row_Ën
 = 
g
->
hÜiz_§m_çcs
[
comp
] * g->
mcus_š_row
 * 8;

1969 
n_rows
 = 
g
->
v”t_§m_çcs
[
comp
] * 8;

1971 
row
=0;„ow<
n_rows
;„ow++) {

1972 
	`IP_MEM_ALLOC
 (
row_Ën
, 
p
);

1973 
g
->
š_rows_­
[
comp
][
row
] = 
p
;

1977 *
pdwIÅutU£d
 = 0;

1978 *
pdwIÅutNextPos
 = 0;

1979 
g
->
dwInNextPos
 = 0;

1980 
g
->
fDidH—d”
 = 
TRUE
;

1982  
IP_READY_FOR_DATA
;

1989 ià(
g
->
lßdšg_rows
) {

1993 
n_lßded
 = 
g
->
rows_lßded
 % g->
rows_š_mcu
;

1995 ià(
n_lßded
 == 0) {

1996 
comp
=0; comp<
g
->
comps_š_pix–
; comp++) {

1997 
row_Ën
 = 
g
->
hÜiz_§m_çcs
[
comp
] * g->
mcus_š_row
 * 8;

1998 
n_rows
 = 
g
->
v”t_§m_çcs
[
comp
] * 8;

2000 
row
=0;„ow<
n_rows
;„ow++)

2001 
	`mem£t
 (
g
->
š_rows_­
[
comp
][
row
], g->
wh™ePix–
[comp], 
row_Ën
);

2005 ià(
pbIÅutBuf
 =ğ
NULL
) {

2009 ià(
n_lßded
 != 0) {

2011 
g
->
lßdšg_rows
 = 
FALSE
;

2014 
g
->
rows_lßded
 +ğg->
rows_š_mcu
 - 
n_lßded
;

2015 } ià((
g
->
rows_š_·ge
<0 || ()g->
rows_»ûived
<g->rows_in_page)

2016 && 
g
->
dwDummyH—d”By‹s
 == 0) {

2018 
g
->
rows_š_·ge
 = g->
rows_»ûived
;

2019 *
pdwOuutU£d
 = 
	`ouut_h—d”
 (
g
, 
pbOuutBuf
);

2020 *
pdwOuutThisPos
 = 0;

2023 
	`PRINT
 (
	`_T
("jpeg_encode_convert_row: Done\n"),0,0);

2024 
	`wr™e_buf_İ’
 (
g
, 
pbOuutBuf
);

2025 
	`wr™e_b™s_æush
 (
g
);

2026 ià(
g
->
fOuutDNL
)

2027 
	`em_wr™e_DNL
 (
g
, g->
rows_»ûived
);

2028 
	`em_wr™e_EOI
 (
g
);

2029 *
pdwOuutU£d
 = 
	`wr™e_buf_şo£
 (
g
);

2030 
»t_v®
 |ğ
IP_DONE
;

2036 
	`cİy_š_rows
 (

2037 
g
,

2038 
n_lßded
,

2039 
pbIÅutBuf
,

2040 &
n_rows
,

2041 &
n_by‹s
);

2043 *
pdwIÅutU£d
 = 
n_by‹s
;

2044 *
pdwIÅutNextPos
 = (
g
->
dwInNextPos
 +ğ
n_by‹s
);

2045 
g
->
rows_lßded
 +ğ
n_rows
;

2046 
g
->
rows_»ûived
 +ğ
n_rows
;

2047 
n_lßded
 = 
g
->
rows_lßded
 % g->
rows_š_mcu
;

2050 ià(
n_rows
 > 0)

2051 
»t_v®
 |ğ
IP_CONSUMED_ROW
 | 
IP_PRODUCED_ROW
;

2055 ià(
n_lßded
 == 0) {

2057 
g
->
lßdšg_rows
 = 
FALSE
;

2066 !
g
->
lßdšg_rows
 &&

2067 
dwOuutAva
-*
pdwOuutU£d
 > 
MAX_MCU_SIZE
) {

2068 
	`PRINT
 (
	`_T
("jpeg_encode_convert_row: Encoding MCU, mcus_sent=%d\n"),

2069 
g
->
mcus_£Á
, 0);

2071 
	`wr™e_buf_İ’
 (
g
, 
pbOuutBuf
 + *
pdwOuutU£d
);

2072 
	`’code_MCU
 (
g
, g->
mcus_£Á
);

2073 
n_by‹s
 = 
	`wr™e_buf_şo£
 (
g
);

2075 
g
->
dwOutNextPos
 +ğ
n_by‹s
;

2076 *
pdwOuutU£d
 +ğ
n_by‹s
;

2078 
g
->
mcus_£Á
 += 1;

2079 ià(
g
->
mcus_£Á
 >ğg->
mcus_š_row
) {

2080 
g
->
lßdšg_rows
 = 
TRUE
;

2081 
g
->
mcus_£Á
 = 0;

2085 
	`PRINT
 (
	`_T
("jpeg_encode_convert_row: Returning %04x, out_used=%d\n"),

2086 
»t_v®
, *
pdwOuutU£d
);

2087  
»t_v®
;

2089 
çl_”rÜ
:

2090  
IP_FATAL_ERROR
;

2091 
	}
}

2101 
WORD
 
	$jpgEncode_š£¹edD©a
 (

2102 
IP_XFORM_HANDLE
 
hXfÜm
,

2103 
DWORD
 
dwNumBy‹s
)

2105 
	`çlB»akPošt
 ();

2106  
IP_FATAL_ERROR
;

2107 
	}
}

2117 
WORD
 
	$jpgEncode_ÃwPage
 (

2118 
IP_XFORM_HANDLE
 
hXfÜm
)

2120 
PJENC_INST
 
g
;

2122 
	`HANDLE_TO_PTR
 (
hXfÜm
, 
g
);

2124  
IP_DONE
;

2126 
çl_”rÜ
:

2127  
IP_FATAL_ERROR
;

2128 
	}
}

2138 
WORD
 
	$jpgEncode_şo£XfÜm
 (
IP_XFORM_HANDLE
 
hXfÜm
)

2140 
PJENC_INST
 
g
;

2141 
BYTE
 **
row_µ
, **
aá”_µ
, *
p
;

2143 
	`HANDLE_TO_PTR
 (
hXfÜm
, 
g
);

2144 
row_µ
 = &(
g
->
š_rows_­
[0][0]);

2145 
aá”_µ
 = 
row_µ
 + ((
g
->
š_rows_­
)/(
BYTE
*));

2147  ; 
row_µ
<
aá”_µ
;„ow_pp++) {

2148 
p
 = *
row_µ
;

2149 ià(
p
 !ğ
NULL
) {

2150 
	`IP_MEM_FREE
 (
p
);

2151 *
row_µ
 = 
NULL
;

2155 
g
->
dwV®idChk
 = 0;

2156 
	`IP_MEM_FREE
 (
g
);

2157  
IP_DONE
;

2159 
çl_”rÜ
:

2160  
IP_FATAL_ERROR
;

2161 
	}
}

2171 
IP_XFORM_TBL
 
	gjpgEncodeTbl
 = {

2172 
jpgEncode_İ’XfÜm
,

2173 
jpgEncode_£tDeçuÉIÅutT¿™s
,

2174 
jpgEncode_£tXfÜmS³c
,

2175 
jpgEncode_g‘H—d”BufSize
,

2176 
jpgEncode_g‘Aùu®T¿™s
,

2177 
jpgEncode_g‘Aùu®BufSizes
,

2178 
jpgEncode_cÚv”t
,

2179 
jpgEncode_ÃwPage
,

2180 
jpgEncode_š£¹edD©a
,

2181 
jpgEncode_şo£XfÜm


	@ip/xjpg_fix.c

82 
	~"hp.h
"

83 
	~"defs.h
"

84 
	~"¡ršg.h
"

85 
	~<¡dio.h
>

87 
	#PRINTF
(
¬gs
...è
	`årštf
(
¡d”r
,¬gs)

	)

90 
IP_XFORM_TBL
 
jpgDecodeTbl
;

91 
WORD
 
jpgDecode_g‘RowCouÁInfo
(
IP_XFORM_HANDLE
 
hXfÜm
,

92 *
pRcCouÁup
,*
pRcT¿™s
,*
pSofOff£t
);

95 
	~"¡dio.h
"

96 
	~<tch¬.h
>

97 
	#PRINT
(
msg
,
¬g1
,
¬g2
) \

98 
	`_á´štf
(
¡d”r
, 
msg
, ()
¬g1
, ()
¬g2
)

	)

100 
	#PRINT
(
msg
,
¬g1
,
¬g2
)

	)

103 
	#CHECK_VALUE
 0x4ba1daû

	)

105 
	#FUNC_STATUS
 

	)

107 
	#BEND_GET_SHORT
(
s
è(((s)[0]<<8)|((s)[1]))

	)

108 
	#BEND_SET_SHORT
(
s
,
x
è((s)[0]=((x)>>8)&0xFF,(s)[1]=(x)&0xFF)

	)

111 
IP_XFORM_HANDLE
 
	mpSÏveXfÜm
;

112 
PBYTE
 
	mh—d”Bufãr
;

113 
DWORD
 
	moutNextPos
;

114 
DWORD
 
	mËnH—d”
;

115 
DWORD
 
	mËnAddedH—d”
;

116 
DWORD
 
	mËnH—d”Bufãr
;

117 
DWORD
 
	m»adyFÜSofRewr™e
;

118 
DWORD
 
	mdwV®idChk
;

119 } 
	tJFIX_INST
, *
	tPJFIX_INST
;

133 cÚ¡ 
	gÜig_lum_quªt
[64] = {

144 cÚ¡ 
	gÜig_chrom_quªt
[64] = {

161 cÚ¡ 
	glum_DC_couÁs
[16] = {

166 cÚ¡ 
	glum_DC_v®ues
[12] = {

170 cÚ¡ 
	gchrom_DC_couÁs
[16] = {

175 cÚ¡ 
	gchrom_DC_v®ues
[12] = {

179 cÚ¡ 
	glum_AC_couÁs
[16] = {

184 cÚ¡ 
	glum_AC_v®ues
[162] = {

208 cÚ¡ 
	gchrom_AC_couÁs
[16] = {

213 cÚ¡ 
	gchrom_AC_v®ues
[162] = {

243 
	$sÿË_q_bË
(
dc_q_çùÜ
,
ac_q_çùÜ
,
id’t
,

244 *
out
) {

245 cÚ¡ 
Q_DEFAULT
=20;

246 cÚ¡ 
FINAL_DC_INDEX
=9;

247 
i
,
v®
;

248 
q
=
dc_q_çùÜ
;

249 cÚ¡ *
š
=
Üig_lum_quªt
;

250 ià(
id’t
è
š
=
Üig_chrom_quªt
;

252 
i
=0; i<64; i++) {

253 
v®
 = ((*
š
++)*
q
 + 
Q_DEFAULT
/2) / Q_DEFAULT;

254 ià(
v®
 < 1) val = 1;

255 ià(
v®
 > 255) val = 255;

256 *
out
++ = ()
v®
;

257 ià(
i
 =ğ
FINAL_DC_INDEX
) {

258 
q
 = 
ac_q_çùÜ
;

261 
	}
}

277 
FUNC_STATUS
 
WORD
 
	$jpgFix_İ’XfÜm
 (

278 
IP_XFORM_HANDLE
 *
pXfÜm
)

280 
PJFIX_INST
 
g
;

282 
	`INSURE
 (
pXfÜm
 !ğ
NULL
);

283 
	`IP_MEM_ALLOC
 ((
JFIX_INST
), 
g
);

284 *
pXfÜm
 = 
g
;

285 
	`mem£t
 (
g
, 0, (
JFIX_INST
));

286 ià(
jpgDecodeTbl
.
	`İ’XfÜm
(&
g
->
pSÏveXfÜm
)!=
IP_DONE
) {

287 
	`IP_MEM_FREE
(
g
);

288 
çl_”rÜ
;

290 
g
->
dwV®idChk
 = 
CHECK_VALUE
;

291  
IP_DONE
;

293 
çl_”rÜ
:

294  
IP_FATAL_ERROR
;

295 
	}
}

314 
FUNC_STATUS
 
WORD
 
	$jpgFix_£tDeçuÉIÅutT¿™s
 (

315 
IP_XFORM_HANDLE
 
hXfÜm
,

316 
PIP_IMAGE_TRAITS
 
pT¿™s
)

318 
PJFIX_INST
 
g
;

320 
	`HANDLE_TO_PTR
 (
hXfÜm
, 
g
);

322  
jpgDecodeTbl
.
	`£tDeçuÉIÅutT¿™s
(
g
->
pSÏveXfÜm
,
pT¿™s
);

324 
çl_”rÜ
:

325  
IP_FATAL_ERROR
;

326 
	}
}

336 
FUNC_STATUS
 
WORD
 
	$jpgFix_£tXfÜmS³c
 (

337 
IP_XFORM_HANDLE
 
hXfÜm
,

338 
DWORD_OR_PVOID
 
aXfÜmInfo
[])

340 
PJFIX_INST
 
g
;

342 
	`HANDLE_TO_PTR
 (
hXfÜm
, 
g
);

349  
IP_DONE
;

351 
çl_”rÜ
:

352  
IP_FATAL_ERROR
;

353 
	}
}

363 
FUNC_STATUS
 
WORD
 
	$jpgFix_g‘H—d”BufSize
 (

364 
IP_XFORM_HANDLE
 
hXfÜm
,

365 
DWORD
 *
pdwInBufL’
)

367 
WORD
 
r
;

368 
PJFIX_INST
 
g
;

370 
	`HANDLE_TO_PTR
 (
hXfÜm
, 
g
);

372 
r
=
jpgDecodeTbl
.
	`g‘H—d”BufSize
(
g
->
pSÏveXfÜm
,
pdwInBufL’
);

373 ià(
r
!=
IP_DONE
) „;

375 
g
->
ËnH—d”Bufãr
=*
pdwInBufL’
;

376 
	`IP_MEM_ALLOC
(
g
->
ËnH—d”Bufãr
,g->
h—d”Bufãr
);

377  
IP_DONE
;

379 
çl_”rÜ
:

380  
IP_FATAL_ERROR
;

381 
	}
}

393 
	#MYLOCATE
(
p
èÕ)=(*)(
g
->
h—d”Bufãr
+
ËnAddedH—d”
)

	)

394 
	#MYWRITE
(
p
è
ËnAddedH—d”
+=(*Õ))

	)

395 
	#MYWRITEBUF
(
d©a
,
d©®’
) \

397 
	`INSURE
((
d©®’
)<=
g
->
ËnH—d”Bufãr
-
ËnAddedH—d”
); \

398 
	`memıy
(
g
->
h—d”Bufãr
+
ËnAddedH—d”
,(*)(
d©a
),(
d©®’
)); \

399 
ËnAddedH—d”
+=(
d©®’
); \

400 } 0)

	)

402 
FUNC_STATUS
 
WORD
 
	$jpgFix_g‘Aùu®T¿™s
 (

403 
IP_XFORM_HANDLE
 
hXfÜm
,

404 
DWORD
 
dwIÅutAva
,

405 
PBYTE
 
pbIÅutBuf
,

406 
PDWORD
 
pdwIÅutU£d
,

407 
PDWORD
 
pdwIÅutNextPos
,

408 
PIP_IMAGE_TRAITS
 
pInT¿™s
,

409 
PIP_IMAGE_TRAITS
 
pOutT¿™s
)

411 
	sshÜtH—d”_s
 {

412 
soi
[2];

414 
­p1
[2];

415 
­p1L’gth
[2];

416 
height
[2];

417 
width
[2];

418 
x»s
[2];

419 
y»s
[2];

420 
ac_q_çùÜ
;

421 
numCompÚ’ts
;

422 
xSam¶eFaùÜs
[2];

423 
ySam¶eFaùÜs
[2];

424 
dc_q_çùÜ
;

425 
»£rved
;

426 } *
pIÅutH—d”
=(
shÜtH—d”_s
 *)
pbIÅutBuf
;

427 
	souutSoiAµ0_s
 {

428 
soi
[2];

430 
­p0
[2];

431 
­p0L’gth
[2];

432 
jfif
[5];

433 
majÜV”siÚ
;

434 
mšÜV”siÚ
;

435 
un™s
;

436 
x»s
[2];

437 
y»s
[2];

438 
xthumb
;

439 
ythumb
;

440 } *
pOuutSoiAµ0
;

442 
sof0
[2];

443 
sof0L’gth
[2];

444 
eight
;

445 
height
[2];

446 
width
[2];

447 
numCompÚ’ts
;

448 } *
pOuutSof0P¬t1
;

450 
iCompÚ’t
;

451 
xySam¶eFaùÜs
;

452 
isNÙFœ¡CompÚ’t
;

453 } *
pOuutSofCompÚ’t
;

455 
dqt
[2];

456 
dqtL’gth
[2];

457 
id’t
;

458 
–em’ts
[64];

459 } *
pOuutDqt
;

461 
dht
[2];

462 
dhtL’gth
[2];

463 } *
pOuutDhtP¬t1
;

465 
hşass_id’t
;

466 
couÁs
[16];

468 } *
pOuutDhtP¬t2
;

470 
hşass_id’t
;

471 cÚ¡ *
couÁs
;

472 cÚ¡ *
huffv®
;

473 } 
dhtInfo
[4]={

474 {0x00,
lum_DC_couÁs
,
lum_DC_v®ues
},

475 {0x10,
lum_AC_couÁs
,
lum_AC_v®ues
},

476 {0x01,
chrom_DC_couÁs
,
chrom_DC_v®ues
},

477 {0x11,
chrom_AC_couÁs
,
chrom_AC_v®ues
}

479 
dhtCouÁCouÁs
[4];

481 
sos
[2];

482 
sosL’gth
[2];

483 
numCompÚ’ts
;

484 } *
pOuutSosP¬t1
;

486 
iCompÚ’t
;

487 
x00x11
;

488 } *
pOuutSosCompÚ’t
;

490 
z”o1
;

491 
sixtyth»e
;

492 
z”o2
;

493 } *
pOuutSosP¬t2
;

495 
PJFIX_INST
 
g
;

496 
DWORD
 
ËnRemovedH—d”
=0,
ËnAddedH—d”
=0;

497 
imax
,
i
,
j
,
x
,
y
,
r
,
Ën
;

499 
	`HANDLE_TO_PTR
 (
hXfÜm
, 
g
);

504 ià(
dwIÅutAva
>=(*
pIÅutH—d”
) &&

505 
pIÅutH—d”
->
soi
[0]==0xFF &&…InputHeader->soi[1]==0xD8 &&

506 
pIÅutH—d”
->
­p1
[0]==0xFF &&…InputHeader->app1[1]==0xE1 &&

507 !
pIÅutH—d”
->
­p1L’gth
[0] &&…InputHeader->app1Length[1]==0x12) {

510 
ËnRemovedH—d”
=(*
pIÅutH—d”
);

513 
	`MYLOCATE
(
pOuutSoiAµ0
);

514 
pOuutSoiAµ0
->
soi
[0]=0xFF;

515 
pOuutSoiAµ0
->
soi
[1]=0xD8;

517 
pOuutSoiAµ0
->
­p0
[0]=0xFF;

518 
pOuutSoiAµ0
->
­p0
[1]=0xE0;

519 
pOuutSoiAµ0
->
­p0L’gth
[0]=0x00;

520 
pOuutSoiAµ0
->
­p0L’gth
[1]=(*pOutputSoiApp0)-4;

521 
	`¡rıy
((*)
pOuutSoiAµ0
->
jfif
,"JFIF");

522 
pOuutSoiAµ0
->
majÜV”siÚ
=0x01;

523 
pOuutSoiAµ0
->
mšÜV”siÚ
=0x00;

524 
pOuutSoiAµ0
->
un™s
=0x01;

525 
pOuutSoiAµ0
->
x»s
[0]=
pIÅutH—d”
->xres[0];

526 
pOuutSoiAµ0
->
x»s
[1]=
pIÅutH—d”
->xres[1];

527 
pOuutSoiAµ0
->
y»s
[0]=
pIÅutH—d”
->yres[0];

528 
pOuutSoiAµ0
->
y»s
[1]=
pIÅutH—d”
->yres[1];

529 
pOuutSoiAµ0
->
xthumb
=0;

530 
pOuutSoiAµ0
->
ythumb
=0;

531 
	`MYWRITE
(
pOuutSoiAµ0
);

534 
	`MYLOCATE
(
pOuutSof0P¬t1
);

535 
pOuutSof0P¬t1
->
sof0
[0]=0xFF;

536 
pOuutSof0P¬t1
->
sof0
[1]=0xC0;

537 
pOuutSof0P¬t1
->
sof0L’gth
[0]=0x00;

538 
pOuutSof0P¬t1
->
sof0L’gth
[1]=(*pOutputSof0Part1)-2+

539 
pIÅutH—d”
->
numCompÚ’ts
*(*
pOuutSofCompÚ’t
);

540 
pOuutSof0P¬t1
->
eight
=0x08;

541 
pOuutSof0P¬t1
->
height
[0]=
pIÅutH—d”
->height[0];

542 
pOuutSof0P¬t1
->
height
[1]=
pIÅutH—d”
->height[1];

543 
pOuutSof0P¬t1
->
width
[0]=
pIÅutH—d”
->width[0];

544 
pOuutSof0P¬t1
->
width
[1]=
pIÅutH—d”
->width[1];

545 
pOuutSof0P¬t1
->
numCompÚ’ts
=
pIÅutH—d”
->numComponents;

546 
	`MYWRITE
(
pOuutSof0P¬t1
);

547 
x
=
	`BEND_GET_SHORT
(
pIÅutH—d”
->
xSam¶eFaùÜs
);

548 
y
=
	`BEND_GET_SHORT
(
pIÅutH—d”
->
ySam¶eFaùÜs
);

549 
i
=0;i<
pIÅutH—d”
->
numCompÚ’ts
;i++) {

550 
	`MYLOCATE
(
pOuutSofCompÚ’t
);

551 
pOuutSofCompÚ’t
->
iCompÚ’t
=
i
;

552 
pOuutSofCompÚ’t
->
xySam¶eFaùÜs
=

553 (((
x
>>(4*(3-
i
)))&0x0F)<<4è| ((
y
>>(4*(3-i)))&0x0F);

554 
pOuutSofCompÚ’t
->
isNÙFœ¡CompÚ’t
=(!
i
?0:1);

555 
	`MYWRITE
(
pOuutSofCompÚ’t
);

559 
imax
=
pIÅutH—d”
->
numCompÚ’ts
>1?1:0;

560 
i
=0;i<=
imax
;i++) {

561 
	`MYLOCATE
(
pOuutDqt
);

562 
pOuutDqt
->
dqt
[0]=0xFF;

563 
pOuutDqt
->
dqt
[1]=0xDB;

564 
pOuutDqt
->
dqtL’gth
[0]=0x00;

565 
pOuutDqt
->
dqtL’gth
[1]=(*pOutputDqt)-2;

566 
pOuutDqt
->
id’t
=
i
;

567 
	`sÿË_q_bË
(
pIÅutH—d”
->
dc_q_çùÜ
,pIÅutH—d”->
ac_q_çùÜ
,

568 
i
,
pOuutDqt
->
–em’ts
);

569 
	`MYWRITE
(
pOuutDqt
);

571 
imax
=
pIÅutH—d”
->
numCompÚ’ts
>1?4:2;

572 
x
=(*
pOuutDhtP¬t1
)-2;

573 
i
=0;i<
imax
;i++) {

574 
dhtCouÁCouÁs
[
i
]=0;

575 
x
+=(*
pOuutDhtP¬t2
);

576 
j
=0;j<16;j++) {

577 
y
=
dhtInfo
[
i
].
couÁs
[
j
];

578 
dhtCouÁCouÁs
[
i
]+=
y
;

579 
x
+=
y
;

582 
	`MYLOCATE
(
pOuutDhtP¬t1
);

583 
pOuutDhtP¬t1
->
dht
[0]=0xFF;

584 
pOuutDhtP¬t1
->
dht
[1]=0xC4;

585 
	`BEND_SET_SHORT
(
pOuutDhtP¬t1
->
dhtL’gth
,
x
);

586 
	`MYWRITE
(
pOuutDhtP¬t1
);

587 
i
=0;i<
imax
;i++) {

588 
	`MYLOCATE
(
pOuutDhtP¬t2
);

589 
pOuutDhtP¬t2
->
hşass_id’t
=
dhtInfo
[
i
].hclass_ident;

590 
	`memıy
(
pOuutDhtP¬t2
->
couÁs
,
dhtInfo
[
i
].counts,16);

591 
	`MYWRITE
(
pOuutDhtP¬t2
);

592 
	`MYWRITEBUF
(
dhtInfo
[
i
].
huffv®
,
dhtCouÁCouÁs
[i]);

596 
	`MYLOCATE
(
pOuutSosP¬t1
);

597 
imax
=
pIÅutH—d”
->
numCompÚ’ts
;

598 
pOuutSosP¬t1
->
sos
[0]=0xFF;

599 
pOuutSosP¬t1
->
sos
[1]=0xDA;

600 
pOuutSosP¬t1
->
sosL’gth
[0]=0;

601 
pOuutSosP¬t1
->
sosL’gth
[1]=(*pOutputSosPart1)-2+

602 
imax
*(*
pOuutSosCompÚ’t
)+(*
pOuutSosP¬t2
);

603 
pOuutSosP¬t1
->
numCompÚ’ts
=
imax
;

604 
	`MYWRITE
(
pOuutSosP¬t1
);

605 
i
=0;i<
imax
;i++) {

606 
	`MYLOCATE
(
pOuutSosCompÚ’t
);

607 
pOuutSosCompÚ’t
->
iCompÚ’t
=
i
;

608 
pOuutSosCompÚ’t
->
x00x11
=(!
i
?0x00:0x11);

609 
	`MYWRITE
(
pOuutSosCompÚ’t
);

611 
	`MYLOCATE
(
pOuutSosP¬t2
);

612 
pOuutSosP¬t2
->
z”o1
=0;

613 
pOuutSosP¬t2
->
sixtyth»e
=63;

614 
pOuutSosP¬t2
->
z”o2
=0;

615 
	`MYWRITE
(
pOuutSosP¬t2
);

620 
Ën
=
dwIÅutAva
-(
ËnAddedH—d”
-
ËnRemovedH—d”
);

621 ià(
Ën
>
g
->
ËnH—d”Bufãr
-
ËnAddedH—d”
) {

622 
Ën
=
g
->
ËnH—d”Bufãr
-
ËnAddedH—d”
;

624 
	`memıy
(
g
->
h—d”Bufãr
+
ËnAddedH—d”
,
pbIÅutBuf
+
ËnRemovedH—d”
,
Ën
);

627 
r
=
jpgDecodeTbl
.
	`g‘Aùu®T¿™s
(
g
->
pSÏveXfÜm
,

628 
Ën
+
ËnAddedH—d”
,
g
->
h—d”Bufãr
,

629 
pdwIÅutU£d
,
pdwIÅutNextPos
,

630 
pInT¿™s
,
pOutT¿™s
);

631 ià((
r
&(
IP_DONE
|
IP_READY_FOR_DATA
))!=(IP_DONE|IP_READY_FOR_DATA)) {

632  (
r
|
IP_FATAL_ERROR
);

635 
g
->
ËnH—d”
=*
pdwIÅutU£d
;

636 
g
->
ËnAddedH—d”
ö’AddedH—d”-
ËnRemovedH—d”
;

637 *
pdwIÅutU£d
-=
g
->
ËnAddedH—d”
;

638 *
pdwIÅutNextPos
-=
g
->
ËnAddedH—d”
;

640  
r
;

642 
çl_”rÜ
:

643  
IP_FATAL_ERROR
;

644 
	}
}

654 
FUNC_STATUS
 
WORD
 
	$jpgFix_g‘Aùu®BufSizes
 (

655 
IP_XFORM_HANDLE
 
hXfÜm
,

656 
PDWORD
 
pdwMšInBufL’
,

657 
PDWORD
 
pdwMšOutBufL’
)

659 
WORD
 
r
;

660 
PJFIX_INST
 
g
;

662 
	`HANDLE_TO_PTR
 (
hXfÜm
, 
g
);

664 
r
=
jpgDecodeTbl
.
	`g‘Aùu®BufSizes
(
g
->
pSÏveXfÜm
,

665 
pdwMšInBufL’
,
pdwMšOutBufL’
);

666 ià(
r
==
IP_DONE
) {

667 
	`INSURE
(*
pdwMšOutBufL’
<=
g
->
ËnH—d”Bufãr
);

669 *
pdwMšOutBufL’
=
g
->
ËnH—d”Bufãr
;

670  
r
;

672 
çl_”rÜ
:

673  
IP_FATAL_ERROR
;

674 
	}
}

684 
FUNC_STATUS
 
WORD
 
	$jpgFix_cÚv”t
 (

685 
IP_XFORM_HANDLE
 
hXfÜm
,

686 
DWORD
 
dwIÅutAva
,

687 
PBYTE
 
pbIÅutBuf
,

688 
PDWORD
 
pdwIÅutU£d
,

689 
PDWORD
 
pdwIÅutNextPos
,

690 
DWORD
 
dwOuutAva
,

691 
PBYTE
 
pbOuutBuf
,

692 
PDWORD
 
pdwOuutU£d
,

693 
PDWORD
 
pdwOuutThisPos
)

695 
PJFIX_INST
 
g
;

696 
WORD
 
r
=0;

698 
	`HANDLE_TO_PTR
 (
hXfÜm
, 
g
);

700 ià(
g
->
outNextPos
<g->
ËnH—d”
) {

701 
DWORD
 
Ën
=
g
->
ËnH—d”
-g->
outNextPos
;

702 ià(
Ën
>
dwOuutAva
)†en=dwOutputAvail;

703 ià(
Ën
) {

704 
	`memıy
(
pbOuutBuf
,
g
->
h—d”Bufãr
+g->
outNextPos
,
Ën
);

706 *
pdwIÅutU£d
=0;

707 *
pdwIÅutNextPos
=
g
->
ËnH—d”
-g->
ËnAddedH—d”
;

708 *
pdwOuutU£d
=
Ën
;

709 *
pdwOuutThisPos
=
g
->
outNextPos
;

710 
g
->
outNextPos
+=
Ën
;

711 
r
|=
IP_READY_FOR_DATA
;

713 } ià(!
g
->
»adyFÜSofRewr™e
) {

714 
DWORD
 
dwOuutU£d
,
dwOuutThisPos
;

715 
r
=
jpgDecodeTbl
.
	`cÚv”t
(
g
->
pSÏveXfÜm
,

716 
dwIÅutAva
,
pbIÅutBuf
,
pdwIÅutU£d
,
pdwIÅutNextPos
,

717 
g
->
ËnH—d”Bufãr
,g->
h—d”Bufãr
,

718 &
dwOuutU£d
,&
dwOuutThisPos
);

719 *
pdwIÅutNextPos
-=
g
->
ËnAddedH—d”
;

720 ià(
r
&
IP_DONE
) {

721 
g
->
»adyFÜSofRewr™e
=1;

722 ià(!*
pdwIÅutU£d
è
»wr™eSof
;

724 ià(*
pdwIÅutU£d
) {

725 
	`INSURE
(*
pdwIÅutU£d
<=
dwOuutAva
);

726 
	`memıy
(
pbOuutBuf
,
pbIÅutBuf
,*
pdwIÅutU£d
);

728 *
pdwOuutU£d
=*
pdwIÅutU£d
;

729 *
pdwOuutThisPos
=
g
->
outNextPos
;

730 
g
->
outNextPos
+=*
pdwIÅutU£d
;

733 
»wr™eSof
:

734 
r
|=
IP_DONE
;

735 *
pdwIÅutU£d
=0;

736 *
pdwIÅutNextPos
=
g
->
outNextPos
-g->
ËnAddedH—d”
;

737 *
pdwOuutU£d
=0;

738 *
pdwOuutThisPos
=
g
->
outNextPos
;

739 ià(
g
->
»adyFÜSofRewr™e
>0) {

740 
rcCouÁup
,
rcT¿™s
,
sofOff£t
;

741 
r
=
	`jpgDecode_g‘RowCouÁInfo
(
g
->
pSÏveXfÜm
,

742 &
rcCouÁup
,&
rcT¿™s
,&
sofOff£t
);

743 
	`BEND_SET_SHORT
(
pbOuutBuf
,
rcCouÁup
);

744 *
pdwOuutU£d
=2;

745 *
pdwOuutThisPos
=
sofOff£t
;

746 
g
->
»adyFÜSofRewr™e
=-1;

750  
r
;

752 
çl_”rÜ
:

753  
IP_FATAL_ERROR
;

754 
	}
}

764 
FUNC_STATUS
 
WORD
 
	$jpgFix_š£¹edD©a
 (

765 
IP_XFORM_HANDLE
 
hXfÜm
,

766 
DWORD
 
dwNumBy‹s
)

768 
	`çlB»akPošt
 ();

769  
IP_FATAL_ERROR
;

770 
	}
}

780 
FUNC_STATUS
 
WORD
 
	$jpgFix_ÃwPage
 (

781 
IP_XFORM_HANDLE
 
hXfÜm
)

783 
PJFIX_INST
 
g
;

785 
	`HANDLE_TO_PTR
 (
hXfÜm
, 
g
);

787  
IP_DONE
;

789 
çl_”rÜ
:

790  
IP_FATAL_ERROR
;

792 
	}
}

802 
FUNC_STATUS
 
WORD
 
	$jpgFix_şo£XfÜm
 (
IP_XFORM_HANDLE
 
hXfÜm
)

804 
PJFIX_INST
 
g
;

806 
	`HANDLE_TO_PTR
 (
hXfÜm
, 
g
);

808 ià(
g
->
pSÏveXfÜm
è
jpgDecodeTbl
.
	`şo£XfÜm
(g->pSlaveXform);

809 ià(
g
->
h—d”Bufãr
è
	`IP_MEM_FREE
(g->headerBuffer);

810 
g
->
dwV®idChk
 = 0;

811 
	`IP_MEM_FREE
 (
g
);

813  
IP_DONE
;

815 
çl_”rÜ
:

816  
IP_FATAL_ERROR
;

817 
	}
}

826 
IP_XFORM_TBL
 
	gjpgFixTbl
 = {

827 
jpgFix_İ’XfÜm
,

828 
jpgFix_£tDeçuÉIÅutT¿™s
,

829 
jpgFix_£tXfÜmS³c
,

830 
jpgFix_g‘H—d”BufSize
,

831 
jpgFix_g‘Aùu®T¿™s
,

832 
jpgFix_g‘Aùu®BufSizes
,

833 
jpgFix_cÚv”t
,

834 
jpgFix_ÃwPage
,

835 
jpgFix_š£¹edD©a
,

836 
jpgFix_şo£XfÜm


	@ip/xjpg_huf.c

46 
	~"xjpg_huf.h
"

55 cÚ¡ 
BYTE
 
	gLumšªûDCCouÁs
[16] = {

60 cÚ¡ 
BYTE
 
	gLumšªûDCV®ues
[12] = {

64 #ifdeà
COLOR_JPEG


65 cÚ¡ 
BYTE
 
	gChromšªûDCCouÁs
[16] = {

70 cÚ¡ 
BYTE
 
	gChromšªûDCV®ues
[12] = {

75 cÚ¡ 
BYTE
 
	gLumšªûACCouÁs
[16] = {

84 cÚ¡ 
BYTE
 
	gLumšªûACV®ues
[162] = {

108 #ifdeà
COLOR_JPEG


109 cÚ¡ 
BYTE
 
	gChromšªûACCouÁs
[16] = {

114 cÚ¡ 
BYTE
 
	gChromšªûACV®ues
[162] = {

148 cÚ¡ 
’c_huff_–em_t
 
	g’c_DC_bË
[] = {

157 cÚ¡ 
dec_huff_–em_t
 
	gdec_DC_bË
[] = { {0,0},

163 cÚ¡ 
BYTE
 
	gdec_DC_bË_šdex
[] = {

199 cÚ¡ 
’c_huff_–em_t
 
	g’c_AC_bË
[] = {

267 cÚ¡ 
dec_huff_–em_t
 
	gdec_AC_maš_bË
[] = { {0,0},

279 cÚ¡ 
BYTE
 
	gdec_AC_maš_bË_šdex
[] = {

539 cÚ¡ 
BYTE
 
	gdec_AC_aux_bË
[] = {

	@ip/xjpg_huf.h

46 
	~"hp.h
"

49 
WORD
 
	mcode
;

50 
BYTE
 
	msize
;

51 } 
	t’c_huff_–em_t
;

54 
BYTE
 
	msize
;

55 
BYTE
 
	mv®ue
;

56 } 
	tdec_huff_–em_t
;

60 cÚ¡ 
’c_huff_–em_t
 
’c_DC_bË
[17];

61 cÚ¡ 
’c_huff_–em_t
 
’c_AC_bË
[256];

64 cÚ¡ 
dec_huff_–em_t
 
dec_DC_bË
[13];

65 cÚ¡ 
BYTE
 
dec_DC_bË_šdex
[512];

66 cÚ¡ 
dec_huff_–em_t
 
dec_AC_maš_bË
[37];

67 cÚ¡ 
BYTE
 
dec_AC_maš_bË_šdex
[4096];

68 cÚ¡ 
BYTE
 
dec_AC_aux_bË
[128];

71 cÚ¡ 
BYTE
 
LumšªûDCCouÁs
[16];

72 cÚ¡ 
BYTE
 
LumšªûDCV®ues
[12];

73 cÚ¡ 
BYTE
 
LumšªûACCouÁs
[16];

74 cÚ¡ 
BYTE
 
LumšªûACV®ues
[162];

77 cÚ¡ 
BYTE
 
ChromšªûDCCouÁs
[16];

78 cÚ¡ 
BYTE
 
ChromšªûDCV®ues
[12];

79 cÚ¡ 
BYTE
 
ChromšªûACCouÁs
[16];

80 cÚ¡ 
BYTE
 
ChromšªûACV®ues
[162];

	@ip/xjpg_mrk.h

46 
	#MARKER_NONE
 0x00

	)

47 
	#MARKER_END_FILE
 0x100

	)

49 
	#MARKER_SOF0
 0xc0

	)

50 
	#MARKER_SOF1
 0xc1

	)

51 
	#MARKER_SOF2
 0xc2

	)

52 
	#MARKER_SOF3
 0xc3

	)

53 
	#MARKER_SOF5
 0xc5

	)

54 
	#MARKER_SOF6
 0xc6

	)

55 
	#MARKER_SOF7
 0xc7

	)

56 
	#MARKER_SOF8
 0xc8

	)

57 
	#MARKER_SOF9
 0xc9

	)

58 
	#MARKER_SOFA
 0xÿ

	)

59 
	#MARKER_SOFB
 0xcb

	)

60 
	#MARKER_SOFD
 0xcd

	)

61 
	#MARKER_SOFE
 0xû

	)

62 
	#MARKER_SOFF
 0xcf

	)

64 
	#MARKER_DHT
 0xc4

	)

65 
	#MARKER_DAC
 0xcc

	)

67 
	#MARKER_RST0
 0xd0

	)

68 
	#MARKER_RST1
 0xd1

	)

69 
	#MARKER_RST2
 0xd2

	)

70 
	#MARKER_RST3
 0xd3

	)

71 
	#MARKER_RST4
 0xd4

	)

72 
	#MARKER_RST5
 0xd5

	)

73 
	#MARKER_RST6
 0xd6

	)

74 
	#MARKER_RST7
 0xd7

	)

76 
	#MARKER_SOI
 0xd8

	)

77 
	#MARKER_EOI
 0xd9

	)

78 
	#MARKER_SOS
 0xda

	)

79 
	#MARKER_DQT
 0xdb

	)

80 
	#MARKER_DNL
 0xdc

	)

81 
	#MARKER_DRI
 0xdd

	)

82 
	#MARKER_DHP
 0xde

	)

83 
	#MARKER_EXP
 0xdf

	)

85 
	#MARKER_APP
 0xe0

	)

86 
	#MARKER_JPG
 0xf0

	)

87 
	#MARKER_COM
 0xã

	)

89 
	#MARKER_SHORT_HEADER
 (
MARKER_APP
+1)

	)

	@ip/xmatrix.c

85 
	~"hp.h
"

86 
	~"defs.h
"

87 
	~"¡ršg.h
"

91 
	~"¡dio.h
"

92 
	~<tch¬.h
>

93 
	#PRINT
(
msg
,
¬g1
,
¬g2
) \

94 
	`_á´štf
(
¡d”r
, 
msg
, ()
¬g1
, ()
¬g2
)

	)

96 
	#PRINT
(
msg
,
¬g1
,
¬g2
)

	)

99 
	#CHECK_VALUE
 0x4ba1daû

	)

101 #ifdeà
EXPORT_TRANSFORM


102 
	#FUNC_STATUS
 
	`__deş¥ec
 (
dÎexpÜt
)

	)

104 
	#FUNC_STATUS
 

	)

109 
IP_IMAGE_TRAITS
 
	mŒa™s
;

110 
DWORD
 
	mdwBy‹sP”Row
;

111 
DWORD
 
	mdwRowsDÚe
;

112 
DWORD
 
	mdwInNextPos
;

113 
DWORD
 
	mdwOutNextPos
;

114 
	mm©
[9];

115 
DWORD
 
	mdwV®idChk
;

116 } 
	tMAT_INST
, *
	tPMAT_INST
;

133 
FUNC_STATUS
 
WORD
 
	$m©_İ’XfÜm
 (

134 
IP_XFORM_HANDLE
 *
pXfÜm
)

136 
PMAT_INST
 
g
;

138 
	`INSURE
 (
pXfÜm
 !ğ
NULL
);

139 
	`IP_MEM_ALLOC
 ((
MAT_INST
), 
g
);

140 *
pXfÜm
 = 
g
;

141 
	`mem£t
 (
g
, 0, (
MAT_INST
));

142 
g
->
dwV®idChk
 = 
CHECK_VALUE
;

143  
IP_DONE
;

145 
çl_”rÜ
:

146  
IP_FATAL_ERROR
;

147 
	}
}

166 
FUNC_STATUS
 
WORD
 
	$m©_£tDeçuÉIÅutT¿™s
 (

167 
IP_XFORM_HANDLE
 
hXfÜm
,

168 
PIP_IMAGE_TRAITS
 
pT¿™s
)

170 
PMAT_INST
 
g
;

172 
	`HANDLE_TO_PTR
 (
hXfÜm
, 
g
);

175 
	`INSURE
 (
pT¿™s
->
iPix–sP”Row
 > 0);

176 
	`INSURE
 (
pT¿™s
->
iB™sP”Pix–
==24 ||…Traits->iBitsPerPixel==48);

177 
	`INSURE
 (
pT¿™s
->
iCompÚ’tsP”Pix–
 == 3);

179 
g
->
Œa™s
 = *
pT¿™s
;

180  
IP_DONE
;

182 
çl_”rÜ
:

183  
IP_FATAL_ERROR
;

184 
	}
}

194 
FUNC_STATUS
 
WORD
 
	$m©_£tXfÜmS³c
 (

195 
IP_XFORM_HANDLE
 
hXfÜm
,

196 
DWORD_OR_PVOID
 
aXfÜmInfo
[])

198 
PMAT_INST
 
g
;

199 *
±r
;

201 
	`HANDLE_TO_PTR
 (
hXfÜm
, 
g
);

203 
±r
 = (*)
aXfÜmInfo
[0].
pvoid
;

204 
	`INSURE
 (
±r
 !ğ
NULL
);

205 
	`memıy
 (
g
->
m©
, 
±r
, (g->mat));

207  
IP_DONE
;

209 
çl_”rÜ
:

210  
IP_FATAL_ERROR
;

211 
	}
}

221 
FUNC_STATUS
 
WORD
 
	$m©_g‘H—d”BufSize
 (

222 
IP_XFORM_HANDLE
 
hXfÜm
,

223 
DWORD
 *
pdwInBufL’
)

226 *
pdwInBufL’
 = 0;

227  
IP_DONE
;

228 
	}
}

238 
FUNC_STATUS
 
WORD
 
	$m©_g‘Aùu®T¿™s
 (

239 
IP_XFORM_HANDLE
 
hXfÜm
,

240 
DWORD
 
dwIÅutAva
,

241 
PBYTE
 
pbIÅutBuf
,

242 
PDWORD
 
pdwIÅutU£d
,

243 
PDWORD
 
pdwIÅutNextPos
,

244 
PIP_IMAGE_TRAITS
 
pIÁ¿™s
,

245 
PIP_IMAGE_TRAITS
 
pOutT¿™s
)

247 
PMAT_INST
 
g
;

249 
	`HANDLE_TO_PTR
 (
hXfÜm
, 
g
);

252 *
pdwIÅutU£d
 = 0;

253 *
pdwIÅutNextPos
 = 0;

255 *
pIÁ¿™s
 = 
g
->
Œa™s
;

256 *
pOutT¿™s
 = 
g
->
Œa™s
;

259 
g
->
dwBy‹sP”Row
 = (g->
Œa™s
.
iPix–sP”Row
*g->Œa™s.
iB™sP”Pix–
 + 7) / 8;

261 ià(
g
->
Œa™s
.
iB™sP”Pix–
 == 24) {

262 
i
;

263 
i
=0; i<9; i++) {

265 
g
->
m©
[
i
] = (g->mat[i]+(1<<7)) >> 8;

269  
IP_DONE
 | 
IP_READY_FOR_DATA
;

271 
çl_”rÜ
:

272  
IP_FATAL_ERROR
;

273 
	}
}

283 
FUNC_STATUS
 
WORD
 
	$m©_g‘Aùu®BufSizes
 (

284 
IP_XFORM_HANDLE
 
hXfÜm
,

285 
PDWORD
 
pdwMšInBufL’
,

286 
PDWORD
 
pdwMšOutBufL’
)

288 
PMAT_INST
 
g
;

290 
	`HANDLE_TO_PTR
 (
hXfÜm
, 
g
);

292 *
pdwMšInBufL’
 = *
pdwMšOutBufL’
 = 
g
->
dwBy‹sP”Row
;

293  
IP_DONE
;

295 
çl_”rÜ
:

296  
IP_FATAL_ERROR
;

297 
	}
}

307 
FUNC_STATUS
 
WORD
 
	$m©_cÚv”t
 (

308 
IP_XFORM_HANDLE
 
hXfÜm
,

309 
DWORD
 
dwIÅutAva
,

310 
PBYTE
 
pbIÅutBuf
,

311 
PDWORD
 
pdwIÅutU£d
,

312 
PDWORD
 
pdwIÅutNextPos
,

313 
DWORD
 
dwOuutAva
,

314 
PBYTE
 
pbOuutBuf
,

315 
PDWORD
 
pdwOuutU£d
,

316 
PDWORD
 
pdwOuutThisPos
)

318 
PMAT_INST
 
g
;

319 
nBy‹s
;

320 
PBYTE
 
pIn
, 
pOut
, 
pOutAá”
;

321 
rIn
, 
gIn
, 
bIn
, 
rOut
, 
gOut
, 
bOut
;

323 
	`HANDLE_TO_PTR
 (
hXfÜm
, 
g
);

327 ià(
pbIÅutBuf
 =ğ
NULL
) {

328 
	`PRINT
 (
	`_T
("mat_convert: Toldo flush.\n"), 0, 0);

330 *
pdwIÅutU£d
 = *
pdwOuutU£d
 = 0;

331 *
pdwIÅutNextPos
 = 
g
->
dwInNextPos
;

332 *
pdwOuutThisPos
 = 
g
->
dwOutNextPos
;

333  
IP_DONE
;

338 
nBy‹s
 = 
g
->
dwBy‹sP”Row
;

339 
	`INSURE
 (
dwIÅutAva
 >ğ(
DWORD
)
nBy‹s
);

340 
	`INSURE
 (
dwOuutAva
 >ğ(
DWORD
)
nBy‹s
);

342 
pIn
 = 
pbIÅutBuf
;

343 
pOut
 = 
pbOuutBuf
;

344 
pOutAá”
 = 
pbOuutBuf
 + 
nBy‹s
;

346 ià(
g
->
Œa™s
.
iB™sP”Pix–
 == 24)

348 
pOut
 < 
pOutAá”
)

350 
rIn
 = ()()(*
pIn
++);

351 
gIn
 = ()()(*
pIn
++);

352 
bIn
 = ()()(*
pIn
++);

356 
rOut
 = 
rIn
*
g
->
m©
[0] + 
gIn
*g->m©[1] + 
bIn
*g->mat[2];

357 
gOut
 = 
rIn
*
g
->
m©
[3] + 
gIn
*g->m©[4] + 
bIn
*g->mat[5];

358 
bOut
 = 
rIn
*
g
->
m©
[6] + 
gIn
*g->m©[7] + 
bIn
*g->mat[8];

361 
rOut
 = (rOut+(1<<15)) >> 16;

362 
gOut
 = (gOut+(1<<15)) >> 16;

363 
bOut
 = (bOut+(1<<15)) >> 16;

366 ià(
rOut
 > 255)„Out = 255; if (rOut < 0)„Out = 0;

367 ià(
gOut
 > 255) gOut = 255; if (gOut < 0) gOut = 0;

368 ià(
bOut
 > 255) bOut = 255; if (bOut < 0) bOut = 0;

370 *
pOut
++ = (
BYTE
)
rOut
;

371 *
pOut
++ = (
BYTE
)
gOut
;

372 *
pOut
++ = (
BYTE
)
bOut
;

377 
WORD
 *
pwIn
, *
pwOut
;

378 
pwIn
 = (
WORD
*)
pIn
;

379 
pwOut
 = (
WORD
*)
pOut
;

381 
pwOut
 < (
WORD
*)
pOutAá”
)

383 
´od0
 = 0, 
´od1
 = 0, 
´od2
 = 0;

396 
rIn
 = ()()(*
pwIn
++) << 15;

397 
gIn
 = ()()(*
pwIn
++) << 15;

398 
bIn
 = ()()(*
pwIn
++) << 15;

400 
	`MUL32HIHALF
 (
rIn
, 
g
->
m©
[0], 
´od0
);

401 
	`MUL32HIHALF
 (
gIn
, 
g
->
m©
[1], 
´od1
);

402 
	`MUL32HIHALF
 (
bIn
, 
g
->
m©
[2], 
´od2
);

403 
rOut
 = (
´od0
 + 
´od1
 + 
´od2
 + (1<<6)) >> 7;

404 ià(
rOut
 > 0x00ffff)„Out = 0x00ffff; if (rOut < 0)„Out = 0;

405 *
pwOut
++ = 
rOut
;

407 
	`MUL32HIHALF
 (
rIn
, 
g
->
m©
[3], 
´od0
);

408 
	`MUL32HIHALF
 (
gIn
, 
g
->
m©
[4], 
´od1
);

409 
	`MUL32HIHALF
 (
bIn
, 
g
->
m©
[5], 
´od2
);

410 
gOut
 = (
´od0
 + 
´od1
 + 
´od2
 + (1<<6)) >> 7;

411 ià(
gOut
 > 0x00ffff) gOut = 0x00ffff; if (gOut < 0) gOut = 0;

412 *
pwOut
++ = 
gOut
;

414 
	`MUL32HIHALF
 (
rIn
, 
g
->
m©
[6], 
´od0
);

415 
	`MUL32HIHALF
 (
gIn
, 
g
->
m©
[7], 
´od1
);

416 
	`MUL32HIHALF
 (
bIn
, 
g
->
m©
[8], 
´od2
);

417 
bOut
 = (
´od0
 + 
´od1
 + 
´od2
 + (1<<6)) >> 7;

418 ià(
bOut
 > 0x00ffff) bOut = 0x00ffff; if (bOut < 0) bOut = 0;

419 *
pwOut
++ = 
bOut
;

423 *
pdwIÅutU£d
 = 
nBy‹s
;

424 
g
->
dwInNextPos
 +ğ
nBy‹s
;

425 *
pdwIÅutNextPos
 = 
g
->
dwInNextPos
;

427 *
pdwOuutU£d
 = 
nBy‹s
;

428 *
pdwOuutThisPos
 = 
g
->
dwOutNextPos
;

429 
g
->
dwOutNextPos
 +ğ
nBy‹s
;

431 
g
->
dwRowsDÚe
 += 1;

432  
IP_CONSUMED_ROW
 | 
IP_PRODUCED_ROW
 | 
IP_READY_FOR_DATA
;

434 
çl_”rÜ
:

435  
IP_FATAL_ERROR
;

436 
	}
}

446 
FUNC_STATUS
 
WORD
 
	$m©_š£¹edD©a
 (

447 
IP_XFORM_HANDLE
 
hXfÜm
,

448 
DWORD
 
dwNumBy‹s
)

450 
	`çlB»akPošt
 ();

451  
IP_FATAL_ERROR
;

452 
	}
}

462 
FUNC_STATUS
 
WORD
 
	$m©_ÃwPage
 (

463 
IP_XFORM_HANDLE
 
hXfÜm
)

465 
PMAT_INST
 
g
;

467 
	`HANDLE_TO_PTR
 (
hXfÜm
, 
g
);

469  
IP_DONE
;

471 
çl_”rÜ
:

472  
IP_FATAL_ERROR
;

474 
	}
}

484 
FUNC_STATUS
 
WORD
 
	$m©_şo£XfÜm
 (
IP_XFORM_HANDLE
 
hXfÜm
)

486 
PMAT_INST
 
g
;

488 
	`HANDLE_TO_PTR
 (
hXfÜm
, 
g
);

490 
g
->
dwV®idChk
 = 0;

491 
	`IP_MEM_FREE
 (
g
);

493  
IP_DONE
;

495 
çl_”rÜ
:

496  
IP_FATAL_ERROR
;

497 
	}
}

506 #ifdeà
EXPORT_TRANSFORM


507 
	$__deş¥ec
 (
dÎexpÜt
)

509 
IP_XFORM_TBL
 
m©rixTbl
 = {

510 
m©_İ’XfÜm
,

511 
m©_£tDeçuÉIÅutT¿™s
,

512 
m©_£tXfÜmS³c
,

513 
m©_g‘H—d”BufSize
,

514 
m©_g‘Aùu®T¿™s
,

515 
m©_g‘Aùu®BufSizes
,

516 
m©_cÚv”t
,

517 
m©_ÃwPage
,

518 
m©_š£¹edD©a
,

519 
m©_şo£XfÜm


520 
	}
};

531 #ifdeà
EXPORT_TRANSFORM


532 
	$EXPORT
(
WORD
è
	$G‘XfÜmTabË
 (
LPIP_XFORM_TBL
 
pXfÜm
)

534 
WORD
 
wR‘
 = 
IP_DONE
;

536 ià(
pXfÜm
)

538 *
pXfÜm
 = 
şrm­Tbl
;

542 
wR‘
 = 
IP_FATAL_ERROR
;

545  
wR‘
;

546 
	}
}

	@ip/xpad.c

90 
	~"hp.h
"

91 
	~"defs.h
"

92 
	~"¡ršg.h
"

96 
	~"¡dio.h
"

97 
	~<tch¬.h
>

99 
	#PRINT
(
msg
,
¬g1
,
¬g2
) \

100 
	`_á´štf
(
¡d”r
, 
msg
, ()
¬g1
, ()
¬g2
)

	)

102 
	#PRINT
(
msg
,
¬g1
,
¬g2
)

	)

105 
	#CHECK_VALUE
 0x4ba1daû

	)

109 
IP_IMAGE_TRAITS
 
	mŒa™s
;

110 
DWORD
 
	mdwLeá
, 
	mdwRight
;

111 
DWORD
 
	mdwTİ
;

112 
DWORD
 
	mdwBÙtom
;

113 
DWORD
 
	mdwMšInRows
;

114 
DWORD
 
	mdwInBy‹sP”Row
;

115 
DWORD
 
	mdwOutBy‹sP”Row
;

116 
DWORD
 
	mdwLeáPadBy‹s
;

117 
DWORD
 
	mdwRightPadBy‹s
;

118 
BYTE
 
	mbPadV®
;

119 
DWORD
 
	mdwInRows
;

120 
DWORD
 
	mdwOutRows
;

121 
DWORD
 
	mdwInNextPos
;

122 
DWORD
 
	mdwOutNextPos
;

123 
DWORD
 
	mdwV®idChk
;

124 } 
	tPAD_INST
, *
	tPPAD_INST
;

141 
WORD
 
	$·d_İ’XfÜm
 (

142 
IP_XFORM_HANDLE
 *
pXfÜm
)

144 
PPAD_INST
 
g
;

146 
	`INSURE
 (
pXfÜm
 !ğ
NULL
);

147 
	`IP_MEM_ALLOC
 ((
PAD_INST
), 
g
);

148 *
pXfÜm
 = 
g
;

149 
	`mem£t
 (
g
, 0, (
PAD_INST
));

150 
g
->
dwV®idChk
 = 
CHECK_VALUE
;

151  
IP_DONE
;

153 
çl_”rÜ
:

154  
IP_FATAL_ERROR
;

155 
	}
}

174 
WORD
 
	$·d_£tDeçuÉIÅutT¿™s
 (

175 
IP_XFORM_HANDLE
 
hXfÜm
,

176 
PIP_IMAGE_TRAITS
 
pT¿™s
)

178 
PPAD_INST
 
g
;

180 
	`HANDLE_TO_PTR
 (
hXfÜm
, 
g
);

183 
	`INSURE
 (
pT¿™s
->
iPix–sP”Row
>0 &&…T¿™s->
iB™sP”Pix–
>0);

184 
g
->
Œa™s
 = *
pT¿™s
;

185  
IP_DONE
;

187 
çl_”rÜ
:

188  
IP_FATAL_ERROR
;

189 
	}
}

199 
WORD
 
	$·d_£tXfÜmS³c
 (

200 
IP_XFORM_HANDLE
 
hXfÜm
,

201 
DWORD_OR_PVOID
 
aXfÜmInfo
[])

203 
PPAD_INST
 
g
;

205 
	`HANDLE_TO_PTR
 (
hXfÜm
, 
g
);

207 
g
->
dwLeá
 = 
aXfÜmInfo
[
IP_PAD_LEFT
].
dwÜd
;

208 
g
->
dwRight
 = 
aXfÜmInfo
[
IP_PAD_RIGHT
].
dwÜd
;

209 
g
->
dwTİ
 = 
aXfÜmInfo
[
IP_PAD_TOP
].
dwÜd
;

210 
g
->
dwBÙtom
 = 
aXfÜmInfo
[
IP_PAD_BOTTOM
].
dwÜd
;

211 
g
->
bPadV®
 = (
BYTE
)
aXfÜmInfo
[
IP_PAD_VALUE
].
dwÜd
;

212 
g
->
dwMšInRows
 = 
aXfÜmInfo
[
IP_PAD_MIN_HEIGHT
].
dwÜd
;

214  
IP_DONE
;

216 
çl_”rÜ
:

217  
IP_FATAL_ERROR
;

218 
	}
}

228 
WORD
 
	$·d_g‘H—d”BufSize
 (

229 
IP_XFORM_HANDLE
 
hXfÜm
,

230 
DWORD
 *
pdwInBufL’
)

233 *
pdwInBufL’
 = 0;

234  
IP_DONE
;

235 
	}
}

245 
WORD
 
	$·d_g‘Aùu®T¿™s
 (

246 
IP_XFORM_HANDLE
 
hXfÜm
,

247 
DWORD
 
dwIÅutAva
,

248 
PBYTE
 
pbIÅutBuf
,

249 
PDWORD
 
pdwIÅutU£d
,

250 
PDWORD
 
pdwIÅutNextPos
,

251 
PIP_IMAGE_TRAITS
 
pInT¿™s
,

252 
PIP_IMAGE_TRAITS
 
pOutT¿™s
)

254 
PPAD_INST
 
g
;

255 
Ëá
, 
right
, 
shiá
, 
mÜe
;

256 
šWidth
, 
outWidth
;

257 
bµ
;

259 
	`HANDLE_TO_PTR
 (
hXfÜm
, 
g
);

263 *
pdwIÅutU£d
 = 0;

264 *
pdwIÅutNextPos
 = 0;

268 
bµ
 = 
g
->
Œa™s
.
iB™sP”Pix–
;

269 
Ëá
 = 
g
->
dwLeá
;

270 
right
 = 
g
->
dwRight
;

271 
šWidth
 = 
g
->
Œa™s
.
iPix–sP”Row
;

273 ià(
Ëá
 < 0) {

274 
Ëá
 = -left;

276 
outWidth
 = ((
šWidth
+
Ëá
-1) /†eft) *†eft;

277 
mÜe
 = 
outWidth
 - 
šWidth
;

278 
Ëá
 = 
mÜe
 >> 1;

279 
right
 = 
mÜe
 - 
Ëá
;

280 
g
->
dwLeá
 = 
Ëá
;

281 
g
->
dwRight
 = 
right
;

284 
outWidth
 = 
šWidth
 + 
Ëá
 + 
right
;

286 ià(
bµ
 == 1) {

288 
shiá
 = ((
Ëá
+4) & ~7) -†eft;

289 
Ëá
 +ğ
shiá
;

290 
right
 +ğ
shiá
;

292 
g
->
bPadV®
 = g->bPadVal & 1 ? 0xffu : 0;

295 
g
->
dwInBy‹sP”Row
 = (
bµ
*
šWidth
 + 7) / 8;

296 
g
->
dwOutBy‹sP”Row
 = (
bµ
*
outWidth
 + 7) / 8;

297 
g
->
dwLeáPadBy‹s
 = (
bµ
*
Ëá
 + 7) / 8;

298 
g
->
dwRightPadBy‹s
 = g->
dwOutBy‹sP”Row
 - g->
dwInBy‹sP”Row
 - g->
dwLeáPadBy‹s
;

302 *
pInT¿™s
 = 
g
->
Œa™s
;

303 *
pOutT¿™s
 = 
g
->
Œa™s
;

304 
pOutT¿™s
->
iPix–sP”Row
 = 
outWidth
;

306 ià(
pInT¿™s
->
lNumRows
 > 0) {

307 ià(()
g
->
dwTİ
 < 0) {

308 
tİ
, 
bÙ
, 
šHeight
, 
outHeight
;

309 
tİ
 = - ()
g
->
dwTİ
;

311 
šHeight
 = 
pInT¿™s
->
lNumRows
;

312 
outHeight
 = ((
šHeight
+
tİ
-1) /op) *op;

313 
mÜe
 = 
outHeight
 - 
šHeight
;

314 
tİ
 = 
mÜe
 >> 1;

315 
bÙ
 = 
mÜe
 - 
tİ
;

316 
g
->
dwTİ
 = 
tİ
;

317 
g
->
dwBÙtom
 = 
bÙ
;

320 
pOutT¿™s
->
lNumRows
 = 
pInT¿™s
->lNumRow + 
g
->
dwTİ
 + g->
dwBÙtom
;

323 
	`INSURE
 (()
g
->
dwLeá
 >= 0);

324 
	`INSURE
 (()
g
->
dwTİ
 >= 0);

326  
IP_DONE
 | (
g
->
dwTİ
>0 ? 0 : 
IP_READY_FOR_DATA
);

328 
çl_”rÜ
:

329  
IP_FATAL_ERROR
;

330 
	}
}

340 
WORD
 
	$·d_g‘Aùu®BufSizes
 (

341 
IP_XFORM_HANDLE
 
hXfÜm
,

342 
PDWORD
 
pdwMšInBufL’
,

343 
PDWORD
 
pdwMšOutBufL’
)

345 
PPAD_INST
 
g
;

347 
	`HANDLE_TO_PTR
 (
hXfÜm
, 
g
);

349 *
pdwMšInBufL’
 = 
g
->
dwInBy‹sP”Row
;

350 *
pdwMšOutBufL’
 = 
g
->
dwOutBy‹sP”Row
;

351  
IP_DONE
;

353 
çl_”rÜ
:

354  
IP_FATAL_ERROR
;

355 
	}
}

365 
WORD
 
	$·d_cÚv”t
 (

366 
IP_XFORM_HANDLE
 
hXfÜm
,

367 
DWORD
 
dwIÅutAva
,

368 
PBYTE
 
pbIÅutBuf
,

369 
PDWORD
 
pdwIÅutU£d
,

370 
PDWORD
 
pdwIÅutNextPos
,

371 
DWORD
 
dwOuutAva
,

372 
PBYTE
 
pbOuutBuf
,

373 
PDWORD
 
pdwOuutU£d
,

374 
PDWORD
 
pdwOuutThisPos
)

376 
PPAD_INST
 
g
;

377 
BOOL
 
bWh™eRow
;

379 
	`HANDLE_TO_PTR
 (
hXfÜm
, 
g
);

380 
bWh™eRow
 = 
FALSE
;

384 ià(
pbIÅutBuf
 =ğ
NULL
) {

385 
	`PRINT
 (
	`_T
("pad_convert: Toldo flush.\n"), 0, 0);

387 ià(
g
->
dwInRows
 < g->
dwMšInRows
) {

389 
bWh™eRow
 = 
TRUE
;

390 
g
->
dwInRows
 += 1;

391 } ià(
g
->
dwBÙtom
 > 0) {

393 
bWh™eRow
 = 
TRUE
;

394 
g
->
dwBÙtom
 -= 1;

397 *
pdwIÅutU£d
 = *
pdwOuutU£d
 = 0;

398 *
pdwIÅutNextPos
 = 
g
->
dwInNextPos
;

399 *
pdwOuutThisPos
 = 
g
->
dwOutNextPos
;

400  
IP_DONE
;

402 } ià(
g
->
dwOutRows
 < g->
dwTİ
) {

404 
bWh™eRow
 = 
TRUE
;

409 
	`INSURE
 (
bWh™eRow
 || (
dwIÅutAva
 >ğ
g
->
dwInBy‹sP”Row
));

410 
	`INSURE
 (
dwOuutAva
 >ğ
g
->
dwOutBy‹sP”Row
);

412 ià(
bWh™eRow
)

413 
	`mem£t
 (
pbOuutBuf
, 
g
->
bPadV®
, g->
dwOutBy‹sP”Row
);

415 
BYTE
 *
p
 = 
pbOuutBuf
;

416 
	`mem£t
 (
p
, 
g
->
bPadV®
, g->
dwLeáPadBy‹s
);

417 
p
 +ğ
g
->
dwLeáPadBy‹s
;

418 
	`memıy
 (
p
, 
pbIÅutBuf
, 
g
->
dwInBy‹sP”Row
);

419 
p
 +ğ
g
->
dwInBy‹sP”Row
;

420 
	`mem£t
 (
p
, 
g
->
bPadV®
, g->
dwRightPadBy‹s
);

422 
g
->
dwInRows
 += 1;

423 *
pdwIÅutU£d
 = 
g
->
dwInBy‹sP”Row
;

424 
g
->
dwInNextPos
 +ğg->
dwInBy‹sP”Row
;

427 
g
->
dwOutRows
 += 1;

428 *
pdwIÅutNextPos
 = 
g
->
dwInNextPos
;

429 *
pdwOuutU£d
 = 
g
->
dwOutBy‹sP”Row
;

430 *
pdwOuutThisPos
 = 
g
->
dwOutNextPos
;

431 
g
->
dwOutNextPos
 +ğg->
dwOutBy‹sP”Row
;

433  (
bWh™eRow
 ? 0 : 
IP_CONSUMED_ROW
) |

434 
IP_PRODUCED_ROW
 |

435 (
g
->
dwOutRows
 < g->
dwTİ
 ? 0 : 
IP_READY_FOR_DATA
);

437 
çl_”rÜ
:

438  
IP_FATAL_ERROR
;

439 
	}
}

449 
WORD
 
	$·d_š£¹edD©a
 (

450 
IP_XFORM_HANDLE
 
hXfÜm
,

451 
DWORD
 
dwNumBy‹s
)

453 
	`çlB»akPošt
 ();

454  
IP_FATAL_ERROR
;

455 
	}
}

465 
WORD
 
	$·d_ÃwPage
 (

466 
IP_XFORM_HANDLE
 
hXfÜm
)

468 
PPAD_INST
 
g
;

470 
	`HANDLE_TO_PTR
 (
hXfÜm
, 
g
);

472  
IP_DONE
;

474 
çl_”rÜ
:

475  
IP_FATAL_ERROR
;

477 
	}
}

487 
WORD
 
	$·d_şo£XfÜm
 (
IP_XFORM_HANDLE
 
hXfÜm
)

489 
PPAD_INST
 
g
;

491 
	`HANDLE_TO_PTR
 (
hXfÜm
, 
g
);

493 
g
->
dwV®idChk
 = 0;

494 
	`IP_MEM_FREE
 (
g
);

496  
IP_DONE
;

498 
çl_”rÜ
:

499  
IP_FATAL_ERROR
;

500 
	}
}

510 
IP_XFORM_TBL
 
	g·dTbl
 = {

511 
·d_İ’XfÜm
,

512 
·d_£tDeçuÉIÅutT¿™s
,

513 
·d_£tXfÜmS³c
,

514 
·d_g‘H—d”BufSize
,

515 
·d_g‘Aùu®T¿™s
,

516 
·d_g‘Aùu®BufSizes
,

517 
·d_cÚv”t
,

518 
·d_ÃwPage
,

519 
·d_š£¹edD©a
,

520 
·d_şo£XfÜm


	@ip/xpcx.c

103 
	~"hp.h
"

104 
	~"defs.h
"

105 
	~"¡ršg.h
"

109 
	~"¡dio.h
"

110 
	~<tch¬.h
>

112 
	#PRINT
(
msg
,
¬g1
,
¬g2
) \

113 
	`_á´štf
(
¡d”r
, 
msg
, ()
¬g1
, ()
¬g2
)

	)

115 
	#PRINT
(
msg
,
¬g1
,
¬g2
)

	)

118 
	#CHECK_VALUE
 0x1û5ÿ7e

	)

121 
	#LITTLE_ENDIAN
 (! (
defšed
 
SNAKES
))

	)

127 
IP_IMAGE_TRAITS
 
	mŒa™s
;

128 
DWORD
 
	mdwInNextPos
;

129 
DWORD
 
	mdwOutNextPos
;

130 
BOOL
 
	mfDidH—d”
;

131 
BYTE
 *
	mpPÏÃs
;

132 
UINT
 
	muBy‹sP”RawRow
;

133 
UINT
 
	muBy‹sP”PÏÃ
;

134 
UINT
 
	muRowsDÚe
;

135 
DWORD
 
	mdwV®idChk
;

136 } 
	tPCX_INST
, *
	tPPCX_INST
;

146 
BYTE
 
	mPcxId
;

147 
BYTE
 
	mV”siÚ
;

148 
BYTE
 
	mEncodšgM‘hod
;

149 
BYTE
 
	mB™sP”Pix–
;

150 
WORD
 
	mXMš
;

151 
WORD
 
	mYMš
;

152 
WORD
 
	mXMax
;

153 
WORD
 
	mYMax
;

154 
WORD
 
	mHÜizResŞutiÚ
;

155 
WORD
 
	mV”tResŞutiÚ
;

156 
BYTE
 
	mP®‘‹Info
[48];

157 
BYTE
 
	mRe£rved1
;

158 
BYTE
 
	mCŞÜPÏÃs
;

159 
WORD
 
	mBy‹sP”PÏÃ
;

160 
BYTE
 
	mRe£rved2
[60];

161 } 
	tpcx_h—d”_t
;

163 
	#PCX_ID
 0x0A

	)

164 
	#PCX_VERSION
 2

	)

165 
	#PCX_HEADER_SIZE
 128

	)

173 
	$sw­_h—d”_by‹s
 (
pcx_h—d”_t
 *
h—d_p
)

175 #ià! 
LITTLE_ENDIAN


176 
	#SWAP_IT
(
™em
) \

177 
h—d_p
->
™em
 = (h—d_p->™em << 8è| (h—d_p->™em >> 8)

	)

179 
	`SWAP_IT
 (
XMš
);

180 
	`SWAP_IT
 (
YMš
);

181 
	`SWAP_IT
 (
XMax
);

182 
	`SWAP_IT
 (
YMax
);

183 
	`SWAP_IT
 (
HÜizResŞutiÚ
);

184 
	`SWAP_IT
 (
V”tResŞutiÚ
);

185 
	`SWAP_IT
 (
By‹sP”PÏÃ
);

187 
	}
}

196 
UINT
 
	$’code_bufãr
 (

197 
PCX_INST
 *
g
,

198 
BYTE
 *
šbuf_p
,

199 
BYTE
 *
outbuf_p
)

201 
BYTE
 *
out_p
;

202 
BYTE
 *
beg_run_p
;

203 
BYTE
 *
aá_run_p
;

204 
BYTE
 *
šbuf_aá_p
;

205 
BYTE
 
byt
;

206 
UINT
 
run_Ën
;

208 
out_p
 = 
outbuf_p
;

209 
beg_run_p
 = 
šbuf_p
;

210 
šbuf_aá_p
 = 
šbuf_p
 + 
g
->
uBy‹sP”PÏÃ
 * g->
Œa™s
.
iB™sP”Pix–
;

212 
beg_run_p
 < 
šbuf_aá_p
)

214 
byt
 = *
beg_run_p
;

216 
aá_run_p
 = 
beg_run_p
+1;

217 
aá_run_p
<
šbuf_aá_p
 && *aá_run_p==
byt
;

218 
aá_run_p
++) ;

220 
run_Ën
 = 
aá_run_p
 - 
beg_run_p
;

221 ià(
run_Ën
 > 63) {

222 
run_Ën
 = 63;

223 
aá_run_p
 = 
beg_run_p
 + 63;

226 ià(
run_Ën
>1 || 
byt
>=(
BYTE
)0xc0)

227 *
out_p
++ = (
BYTE
)
run_Ën
 | (BYTE)0xc0;

228 *
out_p
++ = 
byt
;

230 
beg_run_p
 = 
aá_run_p
;

233  
out_p
 - 
outbuf_p
;

234 
	}
}

243 
UINT
 
	$decode_bufãr
 (

244 
PCX_INST
 *
g
,

245 
BYTE
 *
šbuf_p
,

246 
BYTE
 *
outbuf_p
)

248 
BYTE
 *
š_p
;

249 
BYTE
 *
out_p
;

250 
BYTE
 *
out_aá_p
;

251 
UINT
 
run_Ën
;

252 
BYTE
 
byt
;

254 
š_p
 = 
šbuf_p
;

255 
out_p
 = 
outbuf_p
;

256 
out_aá_p
 = 
outbuf_p
 + 
g
->
uBy‹sP”PÏÃ
*g->
Œa™s
.
iB™sP”Pix–
;

258 
out_p
 < 
out_aá_p
)

260 
byt
 = *
š_p
++;

262 ià(
byt
 < (
BYTE
)0xc0)

263 *
out_p
++ = 
byt
;

265 
run_Ën
 = 
byt
 & (
BYTE
)0x3f;

266 ià(
run_Ën
 > (
UINT
è(
out_aá_p
 - 
out_p
))

267 
run_Ën
 = 
out_aá_p
-
out_p
;

268 
	`mem£t
 (
out_p
, *
š_p
++, 
run_Ën
);

269 
out_p
 +ğ
run_Ën
;

273  
š_p
 - 
šbuf_p
;

274 
	}
}

291 
	$æ_pix–s
 (

292 
PCX_INST
 *
g
,

293 
BYTE
 *
by‹_buf_p
)

295 
ULONG
 *
buf_p
;

296 
ULONG
 *
buf_aá_p
;

298 
buf_p
 = (
ULONG
*)
by‹_buf_p
;

299 
buf_aá_p
 = 
buf_p
 + ((
g
->
uBy‹sP”RawRow
+3) >> 2);

300  ; 
buf_p
<
buf_aá_p
; buf_p++)

301 *
buf_p
 = ~ *buf_p;

302 
	}
}

306 
UINT
 
	$’code_1
 (

307 
PCX_INST
 *
g
,

308 
BYTE
 *
šbuf_p
,

309 
BYTE
 *
outbuf_p
)

311 
UINT
 
n_by‹s
;

313 
	`æ_pix–s
 (
g
, 
šbuf_p
);

314 
n_by‹s
 = 
	`’code_bufãr
 (
g
, 
šbuf_p
, 
outbuf_p
);

315 
	`æ_pix–s
 (
g
, 
šbuf_p
);

316  
n_by‹s
;

317 
	}
}

321 
UINT
 
	$decode_1
 (

322 
PCX_INST
 *
g
,

323 
BYTE
 *
šbuf_p
,

324 
BYTE
 *
outbuf_p
)

326 
UINT
 
u£d
;

328 
u£d
 = 
	`decode_bufãr
 (
g
, 
šbuf_p
, 
outbuf_p
);

329 
	`æ_pix–s
 (
g
, 
outbuf_p
);

330  
u£d
;

331 
	}
}

350 
	~<¡dio.h
>

351 
	#l™e_’dŸn
 1

	)

353 
	$maš
 ()

355 
nib
;

356 
ouÚg
;

358 
nib
=0;‚ib<=15;‚ib++) {

359 
ouÚg
 = 0;

360 ià(
nib
 & 0x08è
ouÚg
 |= 0x10000000;

361 ià(
nib
 & 0x04è
ouÚg
 |= 0x00100000;

362 ià(
nib
 & 0x02è
ouÚg
 |= 0x00001000;

363 ià(
nib
 & 0x01è
ouÚg
 |= 0x00000010;

365 ià(
l™e_’dŸn
)

366 
ouÚg
 = (outlong & 0xff000000) >> 24 |

367 (
ouÚg
 & 0x00ff0000) >> 8 |

368 (
ouÚg
 & 0x0000ff00) << 8 |

369 (
ouÚg
 & 0x000000ff) << 24;

371 
	`_rštf
 (
	`_T
("0x%08x, "), 
ouÚg
);

372 ià((
nib
%4è=ğ3è
	`_uts
(
	`_T
(""));

374 
	`_uts
 (
	`_T
(""));

375 
	}
}

381 
UINT
 
	$’code_4
 (

382 
PCX_INST
 *
g
,

383 
BYTE
 *
šbuf_p
,

384 
BYTE
 *
outbuf_p
)

386 #ià
LITTLE_ENDIAN


387 
	#NIB_0
 0x000000f0

	)

388 
	#NIB_1
 0x0000f000

	)

389 
	#NIB_2
 0x00f00000

	)

390 
	#NIB_3
 0xf0000000

	)

392 
	#NIB_0
 0xf0000000

	)

393 
	#NIB_1
 0x00f00000

	)

394 
	#NIB_2
 0x0000f000

	)

395 
	#NIB_3
 0x000000f0

	)

398 
ULONG
 *
š_p
;

399 
ULONG
 *
š_aá_p
;

400 
BYTE
 *
¶ªe_p
;

401 
ULONG
 
quad
;

402 
ULONG
 
mask
;

403 
BYTE
 
byt
;

407 
š_aá_p
 = (
ULONG
 *è(
šbuf_p
 + 
g
->
uBy‹sP”RawRow
);

408 
¶ªe_p
 = 
g
->
pPÏÃs
;

409 
mask
 = 0x10101010;

411 
TRUE
)

413 
š_p
=(
ULONG
*)
šbuf_p
; in_p<
š_aá_p
; ) {

414 
byt
 = 0;

415 
quad
 = *
š_p
++ & 
mask
;

416 ià(
quad
 & 
NIB_0
è
byt
 = 0x80;

417 ià(
quad
 & 
NIB_1
è
byt
 |= 0x40;

418 ià(
quad
 & 
NIB_2
è
byt
 |= 0x20;

419 ià(
quad
 & 
NIB_3
è
byt
 |= 0x10;

421 
quad
 = *
š_p
++ & 
mask
;

422 ià(
quad
 & 
NIB_0
è
byt
 |= 0x08;

423 ià(
quad
 & 
NIB_1
è
byt
 |= 0x04;

424 ià(
quad
 & 
NIB_2
è
byt
 |= 0x02;

425 ià(
quad
 & 
NIB_3
è
byt
 |= 0x01;

426 *
¶ªe_p
++ = 
byt
;

429 ià(
mask
 == 0x80808080)

431 
mask
 <<= 1;

434  
	`’code_bufãr
 (
g
, g->
pPÏÃs
, 
outbuf_p
);

435 
	}
}

439 
UINT
 
	$decode_4
 (

440 
PCX_INST
 *
g
,

441 
BYTE
 *
šbuf_p
,

442 
BYTE
 *
outbuf_p
)

444 #ià
LITTLE_ENDIAN


445 cÚ¡ 
ULONG
 
unsüambË
[16] = {

452 cÚ¡ 
ULONG
 
unsüambË
[16] = {

460 
UINT
 
u£d
;

461 
BYTE
 *
¶ªe_p
;

462 
BYTE
 *
¶ªe_aá_p
;

463 
ULONG
 *
out_p
;

465 
u£d
 = 
	`decode_bufãr
 (
g
, 
šbuf_p
, g->
pPÏÃs
);

469 
¶ªe_p
 = 
g
->
pPÏÃs
;

471 
out_p
 = (
ULONG
*)
outbuf_p
;

472 
¶ªe_aá_p
 = 
¶ªe_p
 + 
g
->
uBy‹sP”PÏÃ
;

473 ; 
¶ªe_p
<
¶ªe_aá_p
;…lane_p++) {

474 *
out_p
++ = 
unsüambË
[*
¶ªe_p
 >> 4];

475 *
out_p
++ = 
unsüambË
[*
¶ªe_p
 & 15];

478 
out_p
 = (
ULONG
*)
outbuf_p
;

479 
¶ªe_aá_p
 = 
¶ªe_p
 + 
g
->
uBy‹sP”PÏÃ
;

480 ; 
¶ªe_p
<
¶ªe_aá_p
;…lane_p++) {

481 *
out_p
++ |ğ
unsüambË
[*
¶ªe_p
 >> 4] << 1;

482 *
out_p
++ |ğ
unsüambË
[*
¶ªe_p
 & 15] << 1;

485 
out_p
 = (
ULONG
*)
outbuf_p
;

486 
¶ªe_aá_p
 = 
¶ªe_p
 + 
g
->
uBy‹sP”PÏÃ
;

487 ; 
¶ªe_p
<
¶ªe_aá_p
;…lane_p++) {

488 *
out_p
++ |ğ
unsüambË
[*
¶ªe_p
 >> 4] << 2;

489 *
out_p
++ |ğ
unsüambË
[*
¶ªe_p
 & 15] << 2;

492 
out_p
 = (
ULONG
*)
outbuf_p
;

493 
¶ªe_aá_p
 = 
¶ªe_p
 + 
g
->
uBy‹sP”PÏÃ
;

494 ; 
¶ªe_p
<
¶ªe_aá_p
;…lane_p++) {

495 *
out_p
++ |ğ
unsüambË
[*
¶ªe_p
 >> 4] << 3;

496 *
out_p
++ |ğ
unsüambË
[*
¶ªe_p
 & 15] << 3;

499  
u£d
;

500 
	}
}

513 
UINT
 
	$’code_8
 (

514 
PCX_INST
 *
g
,

515 
BYTE
 *
šbuf_p
,

516 
BYTE
 *
outbuf_p
)

518 
	`as£¹
 (0);

520 
	}
}

524 
UINT
 
	$decode_8
 (

525 
PCX_INST
 *
g
,

526 
BYTE
 *
šbuf_p
,

527 
BYTE
 *
outbuf_p
)

529 
	`as£¹
 (0);

531 
	}
}

564 
WORD
 
	$pcxEncode_İ’XfÜm
 (

565 
IP_XFORM_HANDLE
 *
pXfÜm
)

567 
PPCX_INST
 
g
;

569 
	`INSURE
 (
pXfÜm
 !ğ
NULL
);

570 
	`IP_MEM_ALLOC
 ((
PCX_INST
), 
g
);

571 *
pXfÜm
 = 
g
;

572 
	`mem£t
 (
g
, 0, (
PCX_INST
));

573 
g
->
dwV®idChk
 = 
CHECK_VALUE
;

574 
	`INSURE
 ((
pcx_h—d”_t
è=ğ
PCX_HEADER_SIZE
);

575  
IP_DONE
;

577 
çl_”rÜ
:

578  
IP_FATAL_ERROR
;

579 
	}
}

598 
WORD
 
	$pcxEncode_£tDeçuÉIÅutT¿™s
 (

599 
IP_XFORM_HANDLE
 
hXfÜm
,

600 
PIP_IMAGE_TRAITS
 
pT¿™s
)

602 
PPCX_INST
 
g
;

604 
	`HANDLE_TO_PTR
 (
hXfÜm
, 
g
);

605 
	`INSURE
 (
pT¿™s
->
iB™sP”Pix–
==1 ||…Traits->iBitsPerPixel==4);

606 
	`INSURE
 (
pT¿™s
->
iPix–sP”Row
 > 0);

607 
g
->
Œa™s
 = *
pT¿™s
;

608  
IP_DONE
;

610 
çl_”rÜ
:

611  
IP_FATAL_ERROR
;

612 
	}
}

622 
WORD
 
	$pcxEncode_£tXfÜmS³c
 (

623 
IP_XFORM_HANDLE
 
hXfÜm
,

624 
DWORD_OR_PVOID
 
aXfÜmInfo
[])

626 
PPCX_INST
 
g
;

628 
	`HANDLE_TO_PTR
 (
hXfÜm
, 
g
);

630  
IP_DONE
;

632 
çl_”rÜ
:

633  
IP_FATAL_ERROR
;

634 
	}
}

644 
WORD
 
	$pcxEncode_g‘H—d”BufSize
 (

645 
IP_XFORM_HANDLE
 
hXfÜm
,

646 
DWORD
 *
pdwInBufL’
)

648 *
pdwInBufL’
 = 0;

649  
IP_DONE
;

650 
	}
}

673 
WORD
 
	$pcxEncode_g‘Aùu®T¿™s
 (

674 
IP_XFORM_HANDLE
 
hXfÜm
,

675 
DWORD
 
dwIÅutAva
,

676 
PBYTE
 
pbIÅutBuf
,

677 
PDWORD
 
pdwIÅutU£d
,

678 
PDWORD
 
pdwIÅutNextPos
,

679 
PIP_IMAGE_TRAITS
 
pInT¿™s
,

680 
PIP_IMAGE_TRAITS
 
pOutT¿™s
)

682 
PPCX_INST
 
g
;

684 
	`HANDLE_TO_PTR
 (
hXfÜm
, 
g
);

687 *
pdwIÅutU£d
 = 0;

688 *
pdwIÅutNextPos
 = 0;

691 *
pInT¿™s
 = 
g
->
Œa™s
;

692 *
pOutT¿™s
 = 
g
->
Œa™s
;

698 
g
->
uBy‹sP”PÏÃ
 = (g->
Œa™s
.
iPix–sP”Row
 + 7) / 8;

699 
g
->
uBy‹sP”RawRow
 = g->
Œa™s
.
iB™sP”Pix–
 == 1

700 ? 
g
->
uBy‹sP”PÏÃ


701 : 
g
->
Œa™s
.
iPix–sP”Row
;

703 
	`PRINT
 (
	`_T
("pcx_encode_output_header:…ixels/row=%d,‚_rows=%d\n"),

704 
g
->
Œa™s
.
iPix–sP”Row
, g->Œa™s.
lNumRows
);

705 
	`PRINT
 (
	`_T
("pcx_encode_output_header: depth=%d, uBytesPerRawRow=%d\n"),

706 
g
->
Œa™s
.
iB™sP”Pix–
, g->
uBy‹sP”RawRow
);

708 ià(
g
->
Œa™s
.
iB™sP”Pix–
 > 1)

709 
	`IP_MEM_ALLOC
 (
g
->
uBy‹sP”PÏÃ
*g->
Œa™s
.
iB™sP”Pix–
, g->
pPÏÃs
);

711  
IP_DONE
 | 
IP_READY_FOR_DATA
;

713 
çl_”rÜ
:

714  
IP_FATAL_ERROR
;

715 
	}
}

725 
WORD
 
	$pcxEncode_g‘Aùu®BufSizes
 (

726 
IP_XFORM_HANDLE
 
hXfÜm
,

727 
PDWORD
 
pdwMšInBufL’
,

728 
PDWORD
 
pdwMšOutBufL’
)

730 
PPCX_INST
 
g
;

732 
	`HANDLE_TO_PTR
 (
hXfÜm
, 
g
);

733 *
pdwMšInBufL’
 = 
g
->
uBy‹sP”RawRow
;

734 *
pdwMšOutBufL’
 = 
g
->
Œa™s
.
iB™sP”Pix–
 * g->
uBy‹sP”PÏÃ
 * 2;

735  
IP_DONE
;

737 
çl_”rÜ
:

738  
IP_FATAL_ERROR
;

739 
	}
}

749 
WORD
 
	$ouutH—d”
 (

750 
PPCX_INST
 
g
,

751 
DWORD
 
dwOuutAva
,

752 
PBYTE
 
pbOuutBuf
,

753 
PDWORD
 
pdwOuutU£d
,

754 
PDWORD
 
pdwOuutThisPos
)

756 
pcx_h—d”_t
 *
pPCXH—d”
;

757 
PIP_IMAGE_TRAITS
 
pTr
;

758 
BYTE
 *
·l_p
;

759 
UINT
 
i
;

761 *
pdwOuutThisPos
 = 0;

762 *
pdwOuutU£d
 = 
PCX_HEADER_SIZE
;

763 
g
->
dwOutNextPos
 = 
PCX_HEADER_SIZE
;

764 
	`INSURE
 (
dwOuutAva
 >ğ
PCX_HEADER_SIZE
);

766 
pTr
 = &
g
->
Œa™s
;

767 
pPCXH—d”
 = (
pcx_h—d”_t
 *)
pbOuutBuf
;

769 
pPCXH—d”
->
PcxId
 = 
PCX_ID
;

770 
pPCXH—d”
->
V”siÚ
 = 
PCX_VERSION
;

771 
pPCXH—d”
->
EncodšgM‘hod
 = 1;

772 
pPCXH—d”
->
B™sP”Pix–
 = 1;

773 
pPCXH—d”
->
XMš
 = 0;

774 
pPCXH—d”
->
YMš
 = 0;

775 
pPCXH—d”
->
XMax
 = 
pTr
->
iPix–sP”Row
 - 1;

776 
pPCXH—d”
->
YMax
 = 
pTr
->
lNumRows
<=0 ? 0 :…Tr->lNumRows-1;

777 
pPCXH—d”
->
HÜizResŞutiÚ
 = (
USHORT
)(
pTr
->
lHÜizDPI
>>16);

778 
pPCXH—d”
->
V”tResŞutiÚ
 = (
USHORT
)(
pTr
->
lV”tDPI
 >>16);

779 
pPCXH—d”
->
Re£rved1
 = 0;

780 
pPCXH—d”
->
CŞÜPÏÃs
 = 
pTr
->
iB™sP”Pix–
;

781 
pPCXH—d”
->
By‹sP”PÏÃ
 = 
g
->
uBy‹sP”PÏÃ
;

783 
	`mem£t
 (
pPCXH—d”
->
Re£rved2
, 0, 60);

785 
·l_p
 = 
pPCXH—d”
->
P®‘‹Info
;

786 ià(
pTr
->
iB™sP”Pix–
 == 1) {

787 
	`mem£t
 (
·l_p
, 0, 48);

788 
·l_p
[3] =…al_p[4] =…al_p[5] = 255;

791 
i
=0; i<=15; i++) {

792 *
·l_p
++ = 
i
 << 4;

793 *
·l_p
++ = 
i
 << 4;

794 *
·l_p
++ = 
i
 << 4;

798 
	`sw­_h—d”_by‹s
 (
pPCXH—d”
);

799  
IP_READY_FOR_DATA
;

801 
çl_”rÜ
:

802  
IP_FATAL_ERROR
;

803 
	}
}

813 
WORD
 
	$pcxEncode_cÚv”t
 (

814 
IP_XFORM_HANDLE
 
hXfÜm
,

815 
DWORD
 
dwIÅutAva
,

816 
PBYTE
 
pbIÅutBuf
,

817 
PDWORD
 
pdwIÅutU£d
,

818 
PDWORD
 
pdwIÅutNextPos
,

819 
DWORD
 
dwOuutAva
,

820 
PBYTE
 
pbOuutBuf
,

821 
PDWORD
 
pdwOuutU£d
,

822 
PDWORD
 
pdwOuutThisPos
)

824 
PPCX_INST
 
g
;

825 
UINT
 
out_u£d
 = 0;

827 
	`HANDLE_TO_PTR
 (
hXfÜm
, 
g
);

831 ià(! 
g
->
fDidH—d”
) {

832 
g
->
fDidH—d”
 = 
TRUE
;

833 *
pdwIÅutU£d
 = 0;

834 *
pdwIÅutNextPos
 = 0;

835  
	`ouutH—d”
 (
g
, 
dwOuutAva
, 
pbOuutBuf
,

836 
pdwOuutU£d
, 
pdwOuutThisPos
);

841 ià(
pbIÅutBuf
 =ğ
NULL
) {

842 
	`PRINT
 (
	`_T
("pcx_encode_convert_row: Toldo flush.\n"), 0, 0);

843 ià(
g
->
Œa™s
.
lNumRows
 < 0) {

846 
g
->
Œa™s
.
lNumRows
 = g->
uRowsDÚe
;

847 *
pdwIÅutU£d
 = 0;

848 *
pdwIÅutNextPos
 = 
g
->
dwInNextPos
;

849  
	`ouutH—d”
 (
g
, 
dwOuutAva
, 
pbOuutBuf
,

850 
pdwOuutU£d
, 
pdwOuutThisPos
);

853 *
pdwIÅutU£d
 = *
pdwOuutU£d
 = 0;

854 *
pdwIÅutNextPos
 = 
g
->
dwInNextPos
;

855 *
pdwOuutThisPos
 = 
g
->
dwOutNextPos
;

856  
IP_DONE
;

861 
g
->
Œa™s
.
iB™sP”Pix–
) {

862 1: 
out_u£d
 = 
	`’code_1
 (
g
, 
pbIÅutBuf
, 
pbOuutBuf
);

865 4: 
out_u£d
 = 
	`’code_4
 (
g
, 
pbIÅutBuf
, 
pbOuutBuf
);

868 8: 
out_u£d
 = 
	`’code_8
 (
g
, 
pbIÅutBuf
, 
pbOuutBuf
);

873 
	`INSURE
 (
dwIÅutAva
 >ğ
g
->
uBy‹sP”RawRow
);

874 
	`INSURE
 (
dwOuutAva
 >ğ
out_u£d
);

876 
g
->
dwInNextPos
 +ğg->
uBy‹sP”RawRow
;

877 *
pdwIÅutNextPos
 = 
g
->
dwInNextPos
;

878 *
pdwIÅutU£d
 = 
g
->
uBy‹sP”RawRow
;

879 *
pdwOuutU£d
 = 
out_u£d
;

880 *
pdwOuutThisPos
 = 
g
->
dwOutNextPos
;

881 
g
->
dwOutNextPos
 +ğ
out_u£d
;

883 
g
->
uRowsDÚe
 += 1;

885 
	`PRINT
 (
	`_T
("pcx_’code_cÚv”t_row: R‘uºšg, ouˆu£d = %d\n"), 
out_u£d
, 0);

886  
IP_CONSUMED_ROW
 | 
IP_PRODUCED_ROW
 | 
IP_READY_FOR_DATA
;

888 
çl_”rÜ
:

889  
IP_FATAL_ERROR
;

890 
	}
}

900 
WORD
 
	$pcxEncode_š£¹edD©a
 (

901 
IP_XFORM_HANDLE
 
hXfÜm
,

902 
DWORD
 
dwNumBy‹s
)

904 
	`çlB»akPošt
 ();

905  
IP_FATAL_ERROR
;

906 
	}
}

916 
WORD
 
	$pcxEncode_ÃwPage
 (

917 
IP_XFORM_HANDLE
 
hXfÜm
)

919 
PPCX_INST
 
g
;

921 
	`HANDLE_TO_PTR
 (
hXfÜm
, 
g
);

923  
IP_DONE
;

925 
çl_”rÜ
:

926  
IP_FATAL_ERROR
;

928 
	}
}

938 
WORD
 
	$pcxEncode_şo£XfÜm
 (
IP_XFORM_HANDLE
 
hXfÜm
)

940 
PPCX_INST
 
g
;

942 
	`HANDLE_TO_PTR
 (
hXfÜm
, 
g
);

943 ià(
g
->
pPÏÃs
 !ğ
NULL
)

944 
	`IP_MEM_FREE
 (
g
->
pPÏÃs
);

945 
g
->
dwV®idChk
 = 0;

946 
	`IP_MEM_FREE
 (
g
);

947  
IP_DONE
;

949 
çl_”rÜ
:

950  
IP_FATAL_ERROR
;

951 
	}
}

961 
IP_XFORM_TBL
 
	gpcxEncodeTbl
 = {

962 
pcxEncode_İ’XfÜm
,

963 
pcxEncode_£tDeçuÉIÅutT¿™s
,

964 
pcxEncode_£tXfÜmS³c
,

965 
pcxEncode_g‘H—d”BufSize
,

966 
pcxEncode_g‘Aùu®T¿™s
,

967 
pcxEncode_g‘Aùu®BufSizes
,

968 
pcxEncode_cÚv”t
,

969 
pcxEncode_ÃwPage
,

970 
pcxEncode_š£¹edD©a
,

971 
pcxEncode_şo£XfÜm


1003 
WORD
 
	$pcxDecode_İ’XfÜm
 (

1004 
IP_XFORM_HANDLE
 *
pXfÜm
)

1006  
	`pcxEncode_İ’XfÜm
(
pXfÜm
);

1007 
	}
}

1026 
WORD
 
	$pcxDecode_£tDeçuÉIÅutT¿™s
 (

1027 
IP_XFORM_HANDLE
 
hXfÜm
,

1028 
PIP_IMAGE_TRAITS
 
pT¿™s
)

1030 
PPCX_INST
 
g
;

1032 
	`HANDLE_TO_PTR
 (
hXfÜm
, 
g
);

1034 
g
->
Œa™s
 = *
pT¿™s
;

1035  
IP_DONE
;

1037 
çl_”rÜ
:

1038  
IP_FATAL_ERROR
;

1039 
	}
}

1049 
WORD
 
	$pcxDecode_£tXfÜmS³c
 (

1050 
IP_XFORM_HANDLE
 
hXfÜm
,

1051 
DWORD_OR_PVOID
 
aXfÜmInfo
[])

1053 
PPCX_INST
 
g
;

1055 
	`HANDLE_TO_PTR
 (
hXfÜm
, 
g
);

1057  
IP_DONE
;

1059 
çl_”rÜ
:

1060  
IP_FATAL_ERROR
;

1061 
	}
}

1071 
WORD
 
	$pcxDecode_g‘H—d”BufSize
 (

1072 
IP_XFORM_HANDLE
 
hXfÜm
,

1073 
DWORD
 *
pdwInBufL’
)

1075 *
pdwInBufL’
 = 
PCX_HEADER_SIZE
;

1076  
IP_DONE
;

1077 
	}
}

1087 
WORD
 
	$pcxDecode_g‘Aùu®T¿™s
 (

1088 
IP_XFORM_HANDLE
 
hXfÜm
,

1089 
DWORD
 
dwIÅutAva
,

1090 
PBYTE
 
pbIÅutBuf
,

1091 
PDWORD
 
pdwIÅutU£d
,

1092 
PDWORD
 
pdwIÅutNextPos
,

1093 
PIP_IMAGE_TRAITS
 
pInT¿™s
,

1094 
PIP_IMAGE_TRAITS
 
pOutT¿™s
)

1096 
PPCX_INST
 
g
;

1097 
pcx_h—d”_t
 *
pcxh—d_p
;

1098 
PIP_IMAGE_TRAITS
 
pTr
;

1099 
WORD
 
»t_v®
;

1101 
»t_v®
 = 
IP_DONE
 | 
IP_READY_FOR_DATA
;

1102 
	`HANDLE_TO_PTR
 (
hXfÜm
, 
g
);

1104 
	`INSURE
 (
dwIÅutAva
 >ğ
PCX_HEADER_SIZE
);

1105 *
pdwIÅutU£d
 = 
PCX_HEADER_SIZE
;

1106 *
pdwIÅutNextPos
 = 
PCX_HEADER_SIZE
;

1107 
g
->
dwInNextPos
 = 
PCX_HEADER_SIZE
;

1109 
pcxh—d_p
 = (
pcx_h—d”_t
*)
pbIÅutBuf
;

1110 
pTr
 = &
g
->
Œa™s
;

1112 
	`sw­_h—d”_by‹s
 (
pcxh—d_p
);

1113 
pTr
->
lNumRows
 = 
pcxh—d_p
->
YMax
 -…cxh—d_p->
YMš
 + 1;

1114 
pTr
->
iPix–sP”Row
 = 
pcxh—d_p
->
XMax
 -…cxh—d_p->
XMš
 + 1;

1115 
pTr
->
iB™sP”Pix–
 = 
pcxh—d_p
->
CŞÜPÏÃs
;

1116 
pTr
->
lHÜizDPI
 = (
ULONG
)
pcxh—d_p
->
HÜizResŞutiÚ
 << 16;

1117 
pTr
->
lV”tDPI
 = (
ULONG
)
pcxh—d_p
->
V”tResŞutiÚ
 << 16;

1118 
pTr
->
iCompÚ’tsP”Pix–
 = 1;

1119 
g
->
uBy‹sP”PÏÃ
 = 
pcxh—d_p
->
By‹sP”PÏÃ
;

1120 
	`sw­_h—d”_by‹s
 (
pcxh—d_p
);

1122 
g
->
uBy‹sP”RawRow
 = 
pTr
->
iB™sP”Pix–
 == 1

1123 ? 
g
->
uBy‹sP”PÏÃ


1124 : 
g
->
Œa™s
.
iPix–sP”Row
;

1126 ià(! (
pcxh—d_p
->
PcxId
 =ğ
PCX_ID


1127 && 
pTr
->
iPix–sP”Row
 > 1

1128 && 
g
->
uBy‹sP”PÏÃ
 =ğ((
UINT
)
pTr
->
iPix–sP”Row
+7)/8

1129 && (
pTr
->
iB™sP”Pix–
==1 ||…Tr->iBitsPerPixel==4)))

1130 
»t_v®
 |ğ
IP_INPUT_ERROR
;

1132 ià(
pTr
->
iB™sP”Pix–
 > 1)

1133 
	`IP_MEM_ALLOC
 (
g
->
uBy‹sP”PÏÃ
*
pTr
->
iB™sP”Pix–
, g->
pPÏÃs
);

1135 ià(
pTr
->
lNumRows
 <= 1)

1136 
pTr
->
lNumRows
 = -1;

1138 *
pInT¿™s
 = *
pOutT¿™s
 = 
g
->
Œa™s
;

1140 
	`PRINT
 (
	`_T
("pcx_decode_parse_header: depth=%d,‚_rows=%d\n"),

1141 
g
->
Œa™s
.
iB™sP”Pix–
, g->Œa™s.
lNumRows
);

1143  
»t_v®
;

1145 
çl_”rÜ
:

1146  
IP_FATAL_ERROR
;

1147 
	}
}

1157 
WORD
 
	$pcxDecode_g‘Aùu®BufSizes
 (

1158 
IP_XFORM_HANDLE
 
hXfÜm
,

1159 
PDWORD
 
pdwMšInBufL’
,

1160 
PDWORD
 
pdwMšOutBufL’
)

1162 
PPCX_INST
 
g
;

1164 
	`HANDLE_TO_PTR
 (
hXfÜm
, 
g
);

1165 *
pdwMšInBufL’
 = 
g
->
Œa™s
.
iB™sP”Pix–
 * g->
uBy‹sP”PÏÃ
 * 2;

1166 *
pdwMšOutBufL’
 = 
g
->
uBy‹sP”RawRow
;

1167  
IP_DONE
;

1169 
çl_”rÜ
:

1170  
IP_FATAL_ERROR
;

1171 
	}
}

1181 
WORD
 
	$pcxDecode_cÚv”t
 (

1182 
IP_XFORM_HANDLE
 
hXfÜm
,

1183 
DWORD
 
dwIÅutAva
,

1184 
PBYTE
 
pbIÅutBuf
,

1185 
PDWORD
 
pdwIÅutU£d
,

1186 
PDWORD
 
pdwIÅutNextPos
,

1187 
DWORD
 
dwOuutAva
,

1188 
PBYTE
 
pbOuutBuf
,

1189 
PDWORD
 
pdwOuutU£d
,

1190 
PDWORD
 
pdwOuutThisPos
)

1192 
PPCX_INST
 
g
;

1193 
DWORD
 
š_u£d
=0;

1195 
	`HANDLE_TO_PTR
 (
hXfÜm
, 
g
);

1197 ià(
pbIÅutBuf
 =ğ
NULL
) {

1199 
	`PRINT
 (
	`_T
("pcx_decode_convert_row: Toldo flush; doing‚othing.\n"), 0, 0);

1200 *
pdwIÅutU£d
 = *
pdwOuutU£d
 = 0;

1201 *
pdwIÅutNextPos
 = 
g
->
dwInNextPos
;

1202 *
pdwOuutThisPos
 = 
g
->
dwOutNextPos
;

1203  
IP_DONE
;

1206 ià(
g
->
Œa™s
.
lNumRows
>=0 && g->
uRowsDÚe
==(
UINT
)g->traits.lNumRows) {

1208 *
pdwIÅutU£d
 = 
dwIÅutAva
;

1209 
g
->
dwInNextPos
 +ğ
dwIÅutAva
;

1210 *
pdwOuutU£d
 = 0;

1211 *
pdwIÅutNextPos
 = 
g
->
dwInNextPos
;

1212 *
pdwOuutThisPos
 = 
g
->
dwOutNextPos
;

1216 
g
->
Œa™s
.
iB™sP”Pix–
) {

1217 1: 
š_u£d
 = 
	`decode_1
 (
g
, 
pbIÅutBuf
, 
pbOuutBuf
);

1220 4: 
š_u£d
 = 
	`decode_4
 (
g
, 
pbIÅutBuf
, 
pbOuutBuf
);

1223 8: 
š_u£d
 = 
	`decode_8
 (
g
, 
pbIÅutBuf
, 
pbOuutBuf
);

1228 
	`INSURE
 (
dwIÅutAva
 >ğ
š_u£d
);

1229 
	`INSURE
 (
dwOuutAva
 >ğ
g
->
uBy‹sP”RawRow
);

1231 
g
->
dwInNextPos
 +ğ
š_u£d
;

1232 *
pdwIÅutNextPos
 = 
g
->
dwInNextPos
;

1233 *
pdwIÅutU£d
 = 
š_u£d
;

1234 *
pdwOuutU£d
 = 
g
->
uBy‹sP”RawRow
;

1235 *
pdwOuutThisPos
 = 
g
->
dwOutNextPos
;

1236 
g
->
dwOutNextPos
 +ğg->
uBy‹sP”RawRow
;

1238 
g
->
uRowsDÚe
 += 1;

1240 
	`PRINT
 (
	`_T
("pcx_decode_cÚv”t_row: R‘uºšg, iÀu£d = %d\n"), 
š_u£d
, 0);

1241  
IP_CONSUMED_ROW
 | 
IP_PRODUCED_ROW
 | 
IP_READY_FOR_DATA
;

1243 
çl_”rÜ
:

1244  
IP_FATAL_ERROR
;

1245 
	}
}

1255 
WORD
 
	$pcxDecode_š£¹edD©a
 (

1256 
IP_XFORM_HANDLE
 
hXfÜm
,

1257 
DWORD
 
dwNumBy‹s
)

1259 
	`çlB»akPošt
 ();

1260  
IP_FATAL_ERROR
;

1261 
	}
}

1271 
WORD
 
	$pcxDecode_ÃwPage
 (

1272 
IP_XFORM_HANDLE
 
hXfÜm
)

1274 
PPCX_INST
 
g
;

1276 
	`HANDLE_TO_PTR
 (
hXfÜm
, 
g
);

1278  
IP_DONE
;

1280 
çl_”rÜ
:

1281  
IP_FATAL_ERROR
;

1282 
	}
}

1292 
WORD
 
	$pcxDecode_şo£XfÜm
 (
IP_XFORM_HANDLE
 
hXfÜm
)

1294  
	`pcxEncode_şo£XfÜm
 (
hXfÜm
);

1295 
	}
}

1305 
IP_XFORM_TBL
 
	gpcxDecodeTbl
 = {

1306 
pcxDecode_İ’XfÜm
,

1307 
pcxDecode_£tDeçuÉIÅutT¿™s
,

1308 
pcxDecode_£tXfÜmS³c
,

1309 
pcxDecode_g‘H—d”BufSize
,

1310 
pcxDecode_g‘Aùu®T¿™s
,

1311 
pcxDecode_g‘Aùu®BufSizes
,

1312 
pcxDecode_cÚv”t
,

1313 
pcxDecode_ÃwPage
,

1314 
pcxDecode_š£¹edD©a
,

1315 
pcxDecode_şo£XfÜm


	@ip/xpnm.c

70 
	~"hp.h
"

71 
	~"defs.h
"

72 
	~"¡ršg.h
"

73 
	~<¡dio.h
>

77 
	~"¡dio.h
"

78 
	~<tch¬.h
>

79 
	#PRINT
(
msg
,
¬g1
,
¬g2
) \

80 
	`_á´štf
(
¡d”r
, 
msg
, ()
¬g1
, ()
¬g2
)

	)

82 
	#PRINT
(
msg
,
¬g1
,
¬g2
)

	)

85 
	#CHECK_VALUE
 0x4ba1daû

	)

87 
	#FUNC_STATUS
 

	)

90 
IP_IMAGE_TRAITS
 
	mŒa™s
;

91 
DWORD
 
	mdwBy‹sP”Row
;

92 
DWORD
 
	mdwRowsDÚe
;

93 
DWORD
 
	mdwInNextPos
;

94 
DWORD
 
	mdwOutNextPos
;

95 
DWORD
 
	mdwV®idChk
;

96 
BOOL
 
	mfIsEncode
;

97 
BOOL
 
	mfDidH—d”
;

98 } 
	tPNM_INST
, *
	tPPNM_INST
;

100 
	#MAX_DECODE_HEADER_SIZE
 4096

	)

101 
	#MAX_ENCODE_HEADER_SIZE
 128

	)

118 
FUNC_STATUS
 
WORD
 
	$²mDecode_İ’XfÜm
 (

119 
IP_XFORM_HANDLE
 *
pXfÜm
)

121 
PPNM_INST
 
g
;

123 
	`INSURE
 (
pXfÜm
 !ğ
NULL
);

124 
	`IP_MEM_ALLOC
 ((
PNM_INST
), 
g
);

125 *
pXfÜm
 = 
g
;

126 
	`mem£t
 (
g
, 0, (
PNM_INST
));

127 
g
->
dwV®idChk
 = 
CHECK_VALUE
;

128  
IP_DONE
;

130 
çl_”rÜ
:

131  
IP_FATAL_ERROR
;

132 
	}
}

134 
FUNC_STATUS
 
WORD
 
	$²mEncode_İ’XfÜm
 (

135 
IP_XFORM_HANDLE
 *
pXfÜm
)

137 
WORD
 
wResuÉ
=
	`²mDecode_İ’XfÜm
(
pXfÜm
);

138 ià(
wResuÉ
==
IP_DONE
) {

139 
PPNM_INST
 
g
;

141 
	`HANDLE_TO_PTR
 (*
pXfÜm
, 
g
);

143 
g
->
dwOutNextPos
=
MAX_ENCODE_HEADER_SIZE
;

144 
g
->
fIsEncode
=
TRUE
;

146  
wResuÉ
;

148 
çl_”rÜ
:

149  
IP_FATAL_ERROR
;

150 
	}
}

168 
FUNC_STATUS
 
WORD
 
	$²m_£tDeçuÉIÅutT¿™s
 (

169 
IP_XFORM_HANDLE
 
hXfÜm
,

170 
PIP_IMAGE_TRAITS
 
pT¿™s
)

172 
PPNM_INST
 
g
;

174 
	`HANDLE_TO_PTR
 (
hXfÜm
, 
g
);

176 
g
->
Œa™s
 = *
pT¿™s
;

177 ià(
g
->
fIsEncode
) {

179 
	`INSURE
 (
pT¿™s
->
iPix–sP”Row
>0 &&…T¿™s->
iB™sP”Pix–
>0);

180 
g
->
dwBy‹sP”Row
 = (g->
Œa™s
.
iPix–sP”Row
*g->Œa™s.
iB™sP”Pix–
 + 7) / 8;

182  
IP_DONE
;

184 
çl_”rÜ
:

185  
IP_FATAL_ERROR
;

186 
	}
}

196 
FUNC_STATUS
 
WORD
 
	$²m_£tXfÜmS³c
 (

197 
IP_XFORM_HANDLE
 
hXfÜm
,

198 
DWORD_OR_PVOID
 
aXfÜmInfo
[])

200 
PPNM_INST
 
g
;

202 
	`HANDLE_TO_PTR
 (
hXfÜm
, 
g
);

209  
IP_DONE
;

211 
çl_”rÜ
:

212  
IP_FATAL_ERROR
;

213 
	}
}

223 
FUNC_STATUS
 
WORD
 
	$²m_g‘H—d”BufSize
 (

224 
IP_XFORM_HANDLE
 
hXfÜm
,

225 
DWORD
 *
pdwInBufL’
)

227 
PPNM_INST
 
g
;

229 
	`HANDLE_TO_PTR
 (
hXfÜm
, 
g
);

231 ià(!
g
->
fIsEncode
) {

232 *
pdwInBufL’
 = 
MAX_DECODE_HEADER_SIZE
;

235 *
pdwInBufL’
 = 0;

237  
IP_DONE
;

239 
çl_”rÜ
:

240  
IP_FATAL_ERROR
;

241 
	}
}

251 
	#PEEK_CHAR
(
pc
) \

253 ià(*
pdwIÅutU£d
>=
dwIÅutAva
) { \

254  
IP_INPUT_ERROR
; \

256 *(
pc
)=
pbIÅutBuf
[*
pdwIÅutU£d
]; \

257 } 0)

	)

259 
	#NEXT_CHAR
 ((*
pdwIÅutU£d
)++)

	)

261 
	#GET_CHAR
(
pc
) \

263 
	`PEEK_CHAR
(
pc
); \

264 
NEXT_CHAR
; \

265 } 0)

	)

267 
	#SKIP_WS
 \

269 
c
; \

270 
	`PEEK_CHAR
(&
c
); \

271 ià(
c
=='#') { \

274 
	`GET_CHAR
(&
c
); \

275 } 
c
!='\n'); \

276 
	`PEEK_CHAR
(&
c
); \

278 ià(
c
>' ') ; \

279 
NEXT_CHAR
; \

280 } 42)

	)

282 
	#GET_INT
(
pi
) \

284 
c
; \

285 *(
pi
)=0; \

286 
SKIP_WS
; \

288 
	`GET_CHAR
(&
c
); \

289 
c
-='0'; \

290 ià(
c
>9) { \

293 *(
pi
)=(*Õi)*10)+
c
; \

295 } 0)

	)

297 
FUNC_STATUS
 
WORD
 
	$²m_g‘Aùu®T¿™s
 (

298 
IP_XFORM_HANDLE
 
hXfÜm
,

299 
DWORD
 
dwIÅutAva
,

300 
PBYTE
 
pbIÅutBuf
,

301 
PDWORD
 
pdwIÅutU£d
,

302 
PDWORD
 
pdwIÅutNextPos
,

303 
PIP_IMAGE_TRAITS
 
pInT¿™s
,

304 
PIP_IMAGE_TRAITS
 
pOutT¿™s
)

306 
PPNM_INST
 
g
;

308 
	`HANDLE_TO_PTR
 (
hXfÜm
, 
g
);

311 *
pdwIÅutU£d
 = 0;

314 ià(!
g
->
fIsEncode
) {

315 
c
;

316 
maxv®
;

318 
	`GET_CHAR
(&
c
);

319 ià(
c
!='P') {

320  
IP_INPUT_ERROR
;

322 
	`GET_CHAR
(&
c
);

323 ià(
c
=='4') {

325 
g
->
Œa™s
.
iCompÚ’tsP”Pix–
=1;

326 
g
->
Œa™s
.
iB™sP”Pix–
=1;

328 } ià(
c
=='5') {

330 
g
->
Œa™s
.
iCompÚ’tsP”Pix–
=1;

331 
g
->
Œa™s
.
iB™sP”Pix–
=0;

333 } ià(
c
=='6') {

335 
g
->
Œa™s
.
iCompÚ’tsP”Pix–
=3;

336 
g
->
Œa™s
.
iB™sP”Pix–
=0;

340  
IP_INPUT_ERROR
;

343 
	`GET_INT
(&
g
->
Œa™s
.
iPix–sP”Row
);

344 
	`GET_INT
(&
g
->
Œa™s
.
lNumRows
);

345 ià(!
g
->
Œa™s
.
iB™sP”Pix–
) {

346 
	`GET_INT
(&
maxv®
);

347 
maxv®
) {

348 
g
->
Œa™s
.
iB™sP”Pix–
++;

349 
maxv®
>>=1;

352 
g
->
Œa™s
.
iB™sP”Pix–
*=g->Œa™s.
iCompÚ’tsP”Pix–
;

353 
g
->
dwBy‹sP”Row
 = (g->
Œa™s
.
iPix–sP”Row
*g->Œa™s.
iB™sP”Pix–
 + 7) / 8;

356 *
pdwIÅutNextPos
 = *
pdwIÅutU£d
;

357 
g
->
dwInNextPos
 = *
pdwIÅutU£d
;

359 *
pInT¿™s
 = 
g
->
Œa™s
;

360 *
pOutT¿™s
 = 
g
->
Œa™s
;

362  
IP_DONE
 | 
IP_READY_FOR_DATA
;

364 
çl_”rÜ
:

365  
IP_FATAL_ERROR
;

366 
	}
}

376 
FUNC_STATUS
 
WORD
 
	$²m_g‘Aùu®BufSizes
 (

377 
IP_XFORM_HANDLE
 
hXfÜm
,

378 
PDWORD
 
pdwMšInBufL’
,

379 
PDWORD
 
pdwMšOutBufL’
)

381 
PPNM_INST
 
g
;

383 
	`HANDLE_TO_PTR
 (
hXfÜm
, 
g
);

385 *
pdwMšInBufL’
 = *
pdwMšOutBufL’
 = 
g
->
dwBy‹sP”Row
;

386  
IP_DONE
;

388 
çl_”rÜ
:

389  
IP_FATAL_ERROR
;

390 
	}
}

400 
FUNC_STATUS
 
WORD
 
	$²m_cÚv”t
 (

401 
IP_XFORM_HANDLE
 
hXfÜm
,

402 
DWORD
 
dwIÅutAva
,

403 
PBYTE
 
pbIÅutBuf
,

404 
PDWORD
 
pdwIÅutU£d
,

405 
PDWORD
 
pdwIÅutNextPos
,

406 
DWORD
 
dwOuutAva
,

407 
PBYTE
 
pbOuutBuf
,

408 
PDWORD
 
pdwOuutU£d
,

409 
PDWORD
 
pdwOuutThisPos
)

411 
PPNM_INST
 
g
;

412 
nBy‹s
;

413 
PBYTE
 
pIn
, 
pOut
;

415 
	`HANDLE_TO_PTR
 (
hXfÜm
, 
g
);

419 ià(
pbIÅutBuf
 =ğ
NULL
) {

420 
	`PRINT
 (
	`_T
("pnm_convert: Toldo flush.\n"), 0, 0);

421 *
pdwIÅutU£d
 = *
pdwOuutU£d
 = 0;

422 *
pdwIÅutNextPos
 = 
g
->
dwInNextPos
;

423 *
pdwOuutThisPos
 = 
g
->
dwOutNextPos
;

424 ià(
g
->
fIsEncode
 && !g->
fDidH—d”
) {

425 
BYTE
 
bufãr
[
MAX_ENCODE_HEADER_SIZE
];

426 
DWORD
 
maxv®
=(2<<((
g
->
Œa™s
.
iB™sP”Pix–
/

427 
g
->
Œa™s
.
iCompÚ’tsP”Pix–
)-1))-1;

428 
Ën
;

430 
	`INSURE
(
dwOuutAva
>=
MAX_ENCODE_HEADER_SIZE
);

432 
	`mem£t
(
pbOuutBuf
,' ',
MAX_ENCODE_HEADER_SIZE
);

433 
pbOuutBuf
[0]='P';

434 ià(
g
->
Œa™s
.
iCompÚ’tsP”Pix–
==1) {

435 ià(
maxv®
==1) {

436 
pbOuutBuf
[1]='4';

438 
pbOuutBuf
[1]='5';

440 } ià(
g
->
Œa™s
.
iCompÚ’tsP”Pix–
==3) {

441 
pbOuutBuf
[1]='6';

443 
çl_”rÜ
;

446 
	`¢´štf
((*)
bufãr
,
MAX_ENCODE_HEADER_SIZE
,"\n%d %d\n",

447 
g
->
Œa™s
.
iPix–sP”Row
,g->
dwRowsDÚe
);

448 ià(
g
->
Œa™s
.
iCompÚ’tsP”Pix–
>1 || 
maxv®
>1) {

449 
bufãr
[
MAX_ENCODE_HEADER_SIZE
-1]=0;

450 
Ën
=
	`¡¾’
((*)
bufãr
);

451 
	`¢´štf
((*)
bufãr
+
Ën
,
MAX_ENCODE_HEADER_SIZE
-len,

452 "%d\n",
maxv®
);

455 
bufãr
[
MAX_ENCODE_HEADER_SIZE
-1]=0;

456 
Ën
=
	`¡¾’
((*)
bufãr
);

457 
	`memıy
(
pbOuutBuf
+
MAX_ENCODE_HEADER_SIZE
-
Ën
,
bufãr
,len);

459 *
pdwOuutU£d
=
MAX_ENCODE_HEADER_SIZE
;

460 *
pdwOuutThisPos
=0;

461 
g
->
dwOutNextPos
=
MAX_ENCODE_HEADER_SIZE
;

462 
g
->
fDidH—d”
=1;

464  
IP_DONE
;

469 
nBy‹s
 = 
g
->
dwBy‹sP”Row
;

470 
	`INSURE
 (
dwIÅutAva
 >ğ(
DWORD
)
nBy‹s
 );

471 
	`INSURE
 (
dwOuutAva
 >ğ(
DWORD
)
nBy‹s
);

473 
pIn
 = 
pbIÅutBuf
;

474 
pOut
 = 
pbOuutBuf
;

479 
	`memıy
(
pOut
,
pIn
,
nBy‹s
);

481 *
pdwIÅutU£d
 = 
nBy‹s
;

482 
g
->
dwInNextPos
 +ğ
nBy‹s
;

483 *
pdwIÅutNextPos
 = 
g
->
dwInNextPos
;

485 *
pdwOuutU£d
 = 
nBy‹s
;

486 *
pdwOuutThisPos
 = 
g
->
dwOutNextPos
;

487 
g
->
dwOutNextPos
 +ğ
nBy‹s
;

489 
g
->
dwRowsDÚe
 += 1;

491  
IP_CONSUMED_ROW
 | 
IP_PRODUCED_ROW
 | 
IP_READY_FOR_DATA
;

493 
çl_”rÜ
:

494  
IP_FATAL_ERROR
;

495 
	}
}

505 
FUNC_STATUS
 
WORD
 
	$²m_š£¹edD©a
 (

506 
IP_XFORM_HANDLE
 
hXfÜm
,

507 
DWORD
 
dwNumBy‹s
)

509 
	`çlB»akPošt
 ();

510  
IP_FATAL_ERROR
;

511 
	}
}

521 
FUNC_STATUS
 
WORD
 
	$²m_ÃwPage
 (

522 
IP_XFORM_HANDLE
 
hXfÜm
)

524 
PPNM_INST
 
g
;

526 
	`HANDLE_TO_PTR
 (
hXfÜm
, 
g
);

528  
IP_DONE
;

530 
çl_”rÜ
:

531  
IP_FATAL_ERROR
;

533 
	}
}

543 
FUNC_STATUS
 
WORD
 
	$²m_şo£XfÜm
 (
IP_XFORM_HANDLE
 
hXfÜm
)

545 
PPNM_INST
 
g
;

547 
	`HANDLE_TO_PTR
 (
hXfÜm
, 
g
);

549 
g
->
dwV®idChk
 = 0;

550 
	`IP_MEM_FREE
 (
g
);

552  
IP_DONE
;

554 
çl_”rÜ
:

555  
IP_FATAL_ERROR
;

556 
	}
}

565 
IP_XFORM_TBL
 
	g²mDecodeTbl
 = {

566 
²mDecode_İ’XfÜm
,

567 
²m_£tDeçuÉIÅutT¿™s
,

568 
²m_£tXfÜmS³c
,

569 
²m_g‘H—d”BufSize
,

570 
²m_g‘Aùu®T¿™s
,

571 
²m_g‘Aùu®BufSizes
,

572 
²m_cÚv”t
,

573 
²m_ÃwPage
,

574 
²m_š£¹edD©a
,

575 
²m_şo£XfÜm


578 
IP_XFORM_TBL
 
	g²mEncodeTbl
 = {

579 
²mEncode_İ’XfÜm
,

580 
²m_£tDeçuÉIÅutT¿™s
,

581 
²m_£tXfÜmS³c
,

582 
²m_g‘H—d”BufSize
,

583 
²m_g‘Aùu®T¿™s
,

584 
²m_g‘Aùu®BufSizes
,

585 
²m_cÚv”t
,

586 
²m_ÃwPage
,

587 
²m_š£¹edD©a
,

588 
²m_şo£XfÜm


	@ip/xrotate.c

110 
	~"hp.h
"

111 
	~"defs.h
"

112 
	~"¡ršg.h
"

113 
	~"m©h.h
"

117 
	~"¡dio.h
"

118 
	~<tch¬.h
>

119 
	#PRINT
(
msg
,
¬g1
,
¬g2
) \

120 
	`_á´štf
(
¡d”r
, 
msg
, ()
¬g1
, ()
¬g2
)

	)

122 
	#PRINT
(
msg
,
¬g1
,
¬g2
)

	)

125 
	#CHECK_VALUE
 0x4ba1daû

	)

127 #ifdeà
EXPORT_TRANSFORM


128 
	#FUNC_STATUS
 
	`__deş¥ec
 (
dÎexpÜt
)

	)

130 
	#FUNC_STATUS
 

	)

134 
IP_IMAGE_TRAITS
 
	mšT¿™s
;

135 
IP_IMAGE_TRAITS
 
	moutT¿™s
;

138 
	mxUL
, 
	myUL
;

139 
	mxUR
, 
	myUR
;

140 
	mxLL
, 
	myLL
;

141 
	mxLR
, 
	myLR
;

142 
	miOutWidth
;

143 
	miOutHeight
;

144 
BOOL
 
	mbRÙ©eFa¡
;

146 
	mhSlİeDx
, 
	mhSlİeDy
;

147 
	mvSlİeDx
, 
	mvSlİeDy
;

148 
	mxLeá
, 
	myLeá
;

149 
	mxRight
, 
	myRight
;

150 
BYTE
 *
	mpSŒ
;

151 
BYTE
 *
	mpSŒAá”
;

152 
	m¡rIndexYTİ
;

153 
	m¡rYTİ
;

154 
	m¡rYBÙtom
;

155 
	m¡rRows
;

156 
	m¡rLßded
;

157 
	m¡rSize
;

158 
	m¡rBy‹sP”Row
;

159 
	mšBy‹sP”Row
;

160 
	moutBy‹sP”Row
;

161 
	mby‹sP”Pix–
;

162 
DWORD
 
	mdwRowsS’t
;

163 
DWORD
 
	mdwInNextPos
;

164 
DWORD
 
	mdwOutNextPos
;

165 
DWORD
 
	mdwV®idChk
;

166 } 
	tROTATE_INST
, *
	tPROTATE_INST
;

183 
FUNC_STATUS
 
WORD
 
	$rÙ©e_İ’XfÜm
 (

184 
IP_XFORM_HANDLE
 *
pXfÜm
)

186 
PROTATE_INST
 
g
;

188 
	`INSURE
 (
pXfÜm
 !ğ
NULL
);

189 
	`IP_MEM_ALLOC
 ((
ROTATE_INST
), 
g
);

190 *
pXfÜm
 = 
g
;

191 
	`mem£t
 (
g
, 0, (
ROTATE_INST
));

192 
g
->
dwV®idChk
 = 
CHECK_VALUE
;

193  
IP_DONE
;

195 
çl_”rÜ
:

196  
IP_FATAL_ERROR
;

197 
	}
}

216 
FUNC_STATUS
 
WORD
 
	$rÙ©e_£tDeçuÉIÅutT¿™s
 (

217 
IP_XFORM_HANDLE
 
hXfÜm
,

218 
PIP_IMAGE_TRAITS
 
pT¿™s
)

220 
PROTATE_INST
 
g
;

222 
	`HANDLE_TO_PTR
 (
hXfÜm
, 
g
);

225 
	`INSURE
 (
pT¿™s
->
iPix–sP”Row
 > 0 &&

226 
pT¿™s
->
lNumRows
 > 0 &&

227 
pT¿™s
->
iB™sP”Pix–
 > 0);

228 
g
->
šT¿™s
 = *
pT¿™s
;

229  
IP_DONE
;

231 
çl_”rÜ
:

232  
IP_FATAL_ERROR
;

233 
	}
}

243 
FUNC_STATUS
 
WORD
 
	$rÙ©e_£tXfÜmS³c
 (

244 
IP_XFORM_HANDLE
 
hXfÜm
,

245 
DWORD_OR_PVOID
 
aXfÜmInfo
[])

247 
PROTATE_INST
 
g
;

248 
i
;

250 
	`HANDLE_TO_PTR
 (
hXfÜm
, 
g
);

252 
i
 = 
aXfÜmInfo
[
IP_ROTATE_UPPER_LEFT
].
dwÜd
;

253 
g
->
xUL
 = 
i
 >> 16;

254 
g
->
yUL
 = 
i
 & 0xFFFF;

256 
i
 = 
aXfÜmInfo
[
IP_ROTATE_UPPER_RIGHT
].
dwÜd
;

257 
g
->
xUR
 = 
i
 >> 16;

258 
g
->
yUR
 = 
i
 & 0xFFFF;

260 
i
 = 
aXfÜmInfo
[
IP_ROTATE_LOWER_LEFT
].
dwÜd
;

261 
g
->
xLL
 = 
i
 >> 16;

262 
g
->
yLL
 = 
i
 & 0xFFFF;

264 
i
 = 
aXfÜmInfo
[
IP_ROTATE_OUTPUT_SIZE
].
dwÜd
;

265 
g
->
iOutWidth
 = 
i
 >> 16;

266 
g
->
iOutHeight
 = 
i
 & 0xFFFF;

268 
g
->
bRÙ©eFa¡
 = 
aXfÜmInfo
[
IP_ROTATE_FAST
].
dwÜd
 == 1;

270 
	`INSURE
 (
g
->
iOutWidth
>=0 && g->
iOutHeight
>=0);

271 
g
->
xLR
 = g->
xUR
 + (g->
xLL
 - g->
xUL
);

272 
g
->
yLR
 = g->
yUR
 + (g->
yLL
 - g->
yUL
);

274  
IP_DONE
;

276 
çl_”rÜ
:

277  
IP_FATAL_ERROR
;

278 
	}
}

288 
FUNC_STATUS
 
WORD
 
	$rÙ©e_g‘H—d”BufSize
 (

289 
IP_XFORM_HANDLE
 
hXfÜm
,

290 
DWORD
 *
pdwInBufL’
)

293 *
pdwInBufL’
 = 0;

294  
IP_DONE
;

295 
	}
}

305 
FUNC_STATUS
 
WORD
 
	$rÙ©e_g‘Aùu®T¿™s
 (

306 
IP_XFORM_HANDLE
 
hXfÜm
,

307 
DWORD
 
dwIÅutAva
,

308 
PBYTE
 
pbIÅutBuf
,

309 
PDWORD
 
pdwIÅutU£d
,

310 
PDWORD
 
pdwIÅutNextPos
,

311 
PIP_IMAGE_TRAITS
 
pIÁ¿™s
,

312 
PIP_IMAGE_TRAITS
 
pOutT¿™s
)

314 
PROTATE_INST
 
g
;

315 
dxH
, 
dyH
, 
dxV
, 
dyV
;

316 
rÙWidthSq
, 
rÙHeightSq
, 
rÙWidth
, 
rÙHeight
;

318 
	`HANDLE_TO_PTR
 (
hXfÜm
, 
g
);

322 
	`memıy
 (&
g
->
outT¿™s
, &g->
šT¿™s
, (
IP_IMAGE_TRAITS
));

324 
dxH
 = 
g
->
xUR
 - g->
xUL
;

325 
dyH
 = 
g
->
yUR
 - g->
yUL
;

326 
dxV
 = 
g
->
xLL
 - g->
xUL
;

327 
dyV
 = 
g
->
yLL
 - g->
yUL
;

329 
rÙWidthSq
 = 
dxH
*dxH + 
dyH
*dyH;

330 
rÙWidth
 = 
	`sq¹
 (
rÙWidthSq
);

331 
rÙHeightSq
 = 
dxV
*dxV + 
dyV
*dyV;

332 
rÙHeight
 = 
	`sq¹
 (
rÙHeightSq
);

333 
	`INSURE
 (
rÙWidth
>0.0 && 
rÙHeight
>0.0);

335 ià(
g
->
iOutWidth
 == 0)

336 
g
->
iOutWidth
 = ()(
rÙWidth
+0.5);

337 ià(
g
->
iOutHeight
 == 0)

338 
g
->
iOutHeight
 = ()(
rÙHeight
+0.5);

340 
g
->
outT¿™s
.
iPix–sP”Row
 = g->
iOutWidth
;

341 
g
->
outT¿™s
.
lNumRows
 = g->
iOutHeight
;

343 
g
->
by‹sP”Pix–
 = g->
šT¿™s
.
iB™sP”Pix–
 / 8;

344 ià(
g
->
by‹sP”Pix–
 == 0)

345 
g
->
by‹sP”Pix–
 = 1;

347 
g
->
šBy‹sP”Row
 = (g->
šT¿™s
.
iPix–sP”Row
*g->šT¿™s.
iB™sP”Pix–
 + 7) / 8;

348 
g
->
outBy‹sP”Row
 = (g->
iOutWidth
 *g->
šT¿™s
.
iB™sP”Pix–
 + 7) / 8;

350 
g
->
hSlİeDx
 = (
dxH
 << 16è/ g->
iOutWidth
;

351 
g
->
hSlİeDy
 = (
dyH
 << 16è/ g->
iOutWidth
;

352 
g
->
vSlİeDx
 = (
dxV
 << 16è/ g->
iOutHeight
;

353 
g
->
vSlİeDy
 = (
dyV
 << 16è/ g->
iOutHeight
;

359 
g
->
xLeá
 = g->
xUL
 << 16;

360 
g
->
yLeá
 = g->
yUL
 << 16;

361 
g
->
xRight
 = g->
xUR
 << 16;

362 
g
->
yRight
 = g->
yUR
 << 16;

365 
g
->
¡rBy‹sP”Row
 = g->
šT¿™s
.
iPix–sP”Row
 * g->
by‹sP”Pix–
;

366 
g
->
¡rIndexYTİ
 = 0;

367 
g
->
¡rYTİ
 = 0;

368 
g
->
¡rYBÙtom
 = -1;

369 
g
->
¡rLßded
 = 0;

370 ià(
g
->
vSlİeDy
 < 0)

371 
g
->
¡rRows
 = 
	`IP_MAX
(g->
yUL
, g->
yUR
è- 
	`IP_MIN
(g->
yLL
, g->
yLR
) + 1;

373 
g
->
¡rRows
 = 
	`IP_MAX
(g->
yUL
, g->
yUR
è- 
	`IP_MIN
(g->yUL, g->yUR) + 1;

374 
g
->
¡rRows
 += 2;

375 
g
->
¡rSize
 = g->
¡rRows
 * g->
¡rBy‹sP”Row
;

376 
	`IP_MEM_ALLOC
 (
g
->
¡rSize
, g->
pSŒ
);

377 
g
->
pSŒAá”
 = g->
pSŒ
 + g->
¡rSize
;

382 *
pdwIÅutU£d
 = 0;

383 *
pdwIÅutNextPos
 = 0;

385 *
pIÁ¿™s
 = 
g
->
šT¿™s
;

386 *
pOutT¿™s
 = 
g
->
outT¿™s
;

388  
IP_DONE
 | 
IP_READY_FOR_DATA
;

390 
çl_”rÜ
:

391  
IP_FATAL_ERROR
;

392 
	}
}

402 
FUNC_STATUS
 
WORD
 
	$rÙ©e_g‘Aùu®BufSizes
 (

403 
IP_XFORM_HANDLE
 
hXfÜm
,

404 
PDWORD
 
pdwMšInBufL’
,

405 
PDWORD
 
pdwMšOutBufL’
)

407 
PROTATE_INST
 
g
;

409 
	`HANDLE_TO_PTR
 (
hXfÜm
, 
g
);

411 *
pdwMšInBufL’
 = 
g
->
šBy‹sP”Row
;

412 *
pdwMšOutBufL’
 = 
g
->
outBy‹sP”Row
;

413  
IP_DONE
;

415 
çl_”rÜ
:

416  
IP_FATAL_ERROR
;

417 
	}
}

430 
	$Ex·ndBev–Row
 (

431 
PBYTE
 
pDe¡
,

432 
PBYTE
 
pSrc
,

433 
nPix–s
)

435 
BYTE
 
mask
, 
šby‹
=0;

437 
mask
 = 0;

439 
nPix–s
 > 0) {

440 ià(
mask
 == 0) {

441 
mask
 = 0x80u;

442 
šby‹
 = *
pSrc
++;

444 *
pDe¡
++ = 
šby‹
 & 
mask
 ? 0 : 255;

445 
mask
 >>= 1;

446 
nPix–s
 -= 1;

448 
	}
}

452 
FUNC_STATUS
 
WORD
 
	$rÙ©e_cÚv”t
 (

453 
IP_XFORM_HANDLE
 
hXfÜm
,

454 
DWORD
 
dwIÅutAva
,

455 
PBYTE
 
pbIÅutBuf
,

456 
PDWORD
 
pdwIÅutU£d
,

457 
PDWORD
 
pdwIÅutNextPos
,

458 
DWORD
 
dwOuutAva
,

459 
PBYTE
 
pbOuutBuf
,

460 
PDWORD
 
pdwOuutU£d
,

461 
PDWORD
 
pdwOuutThisPos
)

465 
	#NEED_MORE
 \

466 ((
g
->
yLeá
 >>16è>ğg->
¡rYBÙtom
 || (g->
yRight
>>16è>ğg->¡rYBÙtom)

	)

468 
PROTATE_INST
 
g
;

469 
PBYTE
 
pSrc
, 
pDe¡
;

471 
	`HANDLE_TO_PTR
 (
hXfÜm
, 
g
);

473 *
pdwIÅutU£d
 = *
pdwOuutU£d
 = 0;

474 *
pdwIÅutNextPos
 = 
g
->
dwInNextPos
;

475 *
pdwOuutThisPos
 = 
g
->
dwOutNextPos
;

479 ià(
pbIÅutBuf
 =ğ
NULL
) {

480 
	`PRINT
 (
	`_T
("rotate_convert: Toldo flush.\n"), 0, 0);

481 
dwIÅutAva
 = (
DWORD
)
g
->
šBy‹sP”Row
;

482 ià(()
g
->
dwRowsS’t
 >ğg->
outT¿™s
.
lNumRows
)

483  
IP_DONE
;

488 ià(
g
->
¡rLßded
 < g->
¡rRows
) {

489 ià(
dwIÅutAva
 == 0)

490  
IP_READY_FOR_DATA
;

491 
	`INSURE
 (
dwIÅutAva
 >ğ(
DWORD
)
g
->
šBy‹sP”Row
);

492 
pDe¡
 = 
g
->
pSŒ
 + g->
¡rBy‹sP”Row
*g->
¡rLßded
;

493 ià(
g
->
šT¿™s
.
iB™sP”Pix–
 == 1)

494 
	`Ex·ndBev–Row
 (
pDe¡
, 
pbIÅutBuf
, 
g
->
šT¿™s
.
iPix–sP”Row
);

495 ià(
pbIÅutBuf
 =ğ
NULL
)

496 
	`memıy
 (
pDe¡
,…De¡ - 
g
->
¡rBy‹sP”Row
, g->stripBytesPerRow);

498 
	`memıy
 (
pDe¡
, 
pbIÅutBuf
, 
g
->
¡rBy‹sP”Row
);

499 
g
->
¡rLßded
 += 1;

500 
g
->
¡rYBÙtom
 += 1;

501 ià(
g
->
¡rLßded
 == 1) {

503 
	`memıy
 (
g
->
pSŒ
+g->
¡rBy‹sP”Row
, g->pStrip, g->stripBytesPerRow);

504 
g
->
¡rLßded
 += 1;

505 
g
->
¡rYBÙtom
 += 1;

507 ià(
pbIÅutBuf
 =ğ
NULL
)

509 *
pdwIÅutU£d
 = (
DWORD
)
g
->
šBy‹sP”Row
;

510 
g
->
dwInNextPos
 +ğ(
DWORD
)g->
šBy‹sP”Row
;

511 *
pdwIÅutNextPos
 = 
g
->
dwInNextPos
;

512  ((
g
->
¡rLßded
<g->
¡rRows
 || 
NEED_MORE
è? 
IP_READY_FOR_DATA
 : 0)

513 | 
IP_CONSUMED_ROW
;

518 ià(
NEED_MORE
)

521 ià(
dwIÅutAva
 == 0)

522  
IP_READY_FOR_DATA
;

523 
	`INSURE
 (
dwIÅutAva
 >ğ(
DWORD
)
g
->
šBy‹sP”Row
);

524 
pDe¡
 = 
g
->
pSŒ
 + g->
¡rBy‹sP”Row
*g->
¡rIndexYTİ
;

525 ià(
pbIÅutBuf
 =ğ
NULL
)

526 
	`mem£t
 (
pDe¡
, 255, 
g
->
¡rBy‹sP”Row
);

527 ià(
g
->
šT¿™s
.
iB™sP”Pix–
 == 1)

528 
	`Ex·ndBev–Row
 (
pDe¡
, 
pbIÅutBuf
, 
g
->
šT¿™s
.
iPix–sP”Row
);

530 
	`memıy
 (
pDe¡
, 
pbIÅutBuf
, 
g
->
¡rBy‹sP”Row
);

531 
g
->
¡rIndexYTİ
 = (g->¡rIndexYTİ + 1è% g->
¡rRows
;

532 
g
->
¡rYTİ
 += 1;

533 
g
->
¡rYBÙtom
 += 1;

534 ià(
pbIÅutBuf
 !ğ
NULL
) {

535 *
pdwIÅutU£d
 = (
DWORD
)
g
->
šBy‹sP”Row
;

536 
g
->
dwInNextPos
 +ğ(
DWORD
)g->
šBy‹sP”Row
;

537 *
pdwIÅutNextPos
 = 
g
->
dwInNextPos
;

543 ià(()
g
->
dwRowsS’t
 >ğg->
outT¿™s
.
lNumRows
)

546 
g
->
¡rYBÙtom
 = -100000;

548 ià(! 
NEED_MORE
)

550 
rowIndex
, 
iPix
;

551 
xcur
,
ycur
, 
xšt
,
yšt
;

552 
xäac
,
yäac
;

553 
PBYTE
 
pNextRow
;

554 
BYTE
 
mask
;

556 
	`INSURE
 (
dwOuutAva
 >ğ(
DWORD
)
g
->
outBy‹sP”Row
);

558 
pDe¡
 = 
pbOuutBuf
;

559 
xcur
 = 
g
->
xLeá
;

560 
ycur
 = 
g
->
yLeá
;

563 *
pDe¡
 = 0;

564 
mask
 = 0x80u;

566 
iPix
=0; iPix<
g
->
outT¿™s
.
iPix–sP”Row
; iPix++)

568 
xšt
 = 
xcur
 >> 16;

569 
yšt
 = (
ycur
 >> 16è- 
g
->
¡rYTİ
;

573 ià(()
yšt
 < ()(
g
->
¡rRows
-1) &&

574 ()
xšt
 < ()
g
->
šT¿™s
.
iPix–sP”Row
)

579 
rowIndex
 = 
yšt
 + 
g
->
¡rIndexYTİ
;

580 ià(
rowIndex
 >ğ
g
->
¡rRows
)

581 
rowIndex
 -ğ
g
->
¡rRows
;

582 
pSrc
 = (
rowIndex
*
g
->
šT¿™s
.
iPix–sP”Row
 + 
xšt
è* g->
by‹sP”Pix–


583 + 
g
->
pSŒ
;

590 
	#INTERPOLATE_BYTE
(
±rOut
,
±rSrcCur
,
±rSrcNex
,
bµ
) { \

591 
xtİ
, 
xbÙ
, 
v®
; \

592 
xtİ
 = (
±rSrcCur
)[0]*(256-
xäac
è+ (±rSrcCur)[
bµ
]*xfrac; \

593 
xbÙ
 = (
±rSrcNex
)[0]*(256-
xäac
è+ (±rSrcNex)[
bµ
]*xfrac; \

594 
v®
 = 
xtİ
*(256-
yäac
è+ 
xbÙ
*yfrac; \

595 
v®
 = (val + 0x8000) >> 16; \

596 *(
±rOut
èğ(
BYTE
)
v®
; \

597 }

	)

599 
	#INTERPOLATE_WORD
(
±rOut
,
±rSrcCur
,
±rSrcNex
,
bµ
) { \

600 
WORD
 *
w±rOut
 = (
PWORD
)(
±rOut
 ); \

601 
WORD
 *
w±rSrcCur
 = (
PWORD
)(
±rSrcCur
); \

602 
WORD
 *
w±rSrcNex
 = (
PWORD
)(
±rSrcNex
); \

603 
xtİ
, 
xbÙ
, 
v®
; \

604 
xtİ
 = ((
w±rSrcCur
)[0]*(0x10000-
xäac
)>>8è+ ((w±rSrcCur)[
bµ
]*xfrac>>8); \

605 
xtİ
 = (xtop+128) >> 8; \

606 
xbÙ
 = ((
w±rSrcNex
)[0]*(0x10000-
xäac
)>>8è+ ((w±rSrcNex)[
bµ
]*xfrac>>8); \

607 
xbÙ
 = (xbot+128) >> 8; \

608 
v®
 = (
xtİ
*(0x10000-
yäac
)>>8è+ (
xbÙ
*yfrac>>8); \

609 
v®
 = (val+128) >> 8; \

610 *(
w±rOut
èğ(
WORD
)
v®
; \

611 }

	)

613 
pNextRow
 = 
pSrc
 + 
g
->
¡rBy‹sP”Row
;

614 ià(
pNextRow
 >ğ
g
->
pSŒAá”
)

615 
pNextRow
 -ğ
g
->
¡rSize
;

617 
xäac
 = (
xcur
>>8) & 0x0000ff;

618 
yäac
 = (
ycur
>>8) & 0x0000ff;

620 ià(
g
->
by‹sP”Pix–
 == 3) {

621 ià(
g
->
bRÙ©eFa¡
) {

622 
pDe¡
[0] = 
pSrc
[0];

623 
pDe¡
[1] = 
pSrc
[1];

624 
pDe¡
[2] = 
pSrc
[2];

627 
	`INTERPOLATE_BYTE
 (
pDe¡
+0, 
pSrc
+0, 
pNextRow
+0, 3)

628 
	`INTERPOLATE_BYTE
 (
pDe¡
+1, 
pSrc
+1, 
pNextRow
+1, 3)

629 
	`INTERPOLATE_BYTE
 (
pDe¡
+2, 
pSrc
+2, 
pNextRow
+2, 3)

631 
pDe¡
 += 3;

632 } ià(
g
->
by‹sP”Pix–
 == 1) {

633 
BYTE
 
byt
;

635 ià(
g
->
bRÙ©eFa¡
)

636 
byt
 = 
pSrc
[0];

638 
	`INTERPOLATE_BYTE
 (&
byt
, 
pSrc
, 
pNextRow
, 1)

640 ià(
g
->
šT¿™s
.
iB™sP”Pix–
 == 8)

641 *
pDe¡
++ = 
byt
;

644 ià(
byt
 < 128)

645 *
pDe¡
 |ğ
mask
;

646 
mask
 >>= 1;

647 ià(
mask
 == 0) {

648 
mask
 = 0x80u;

649 
pDe¡
 += 1;

650 *
pDe¡
 = 0;

653 } ià(
g
->
by‹sP”Pix–
==2 || g->bytesPerPixel==6) {

655 ià(
g
->
bRÙ©eFa¡
) {

656 
	`memıy
 (
pDe¡
, 
pSrc
, 
g
->
by‹sP”Pix–
);

658 
xäac
 = 
xcur
 & 0x00ffff;

659 
yäac
 = 
ycur
 & 0x00ffff;

660 
	`INTERPOLATE_WORD
 (
pDe¡
+0, 
pSrc
+0, 
pNextRow
+0, 
g
->
šT¿™s
.
iCompÚ’tsP”Pix–
)

661 ià(
g
->
by‹sP”Pix–
 == 6) {

662 
	`INTERPOLATE_WORD
 (
pDe¡
+2, 
pSrc
+2, 
pNextRow
+2, 3)

663 
	`INTERPOLATE_WORD
 (
pDe¡
+4, 
pSrc
+4, 
pNextRow
+4, 3)

667 
pDe¡
 +ğ
g
->
by‹sP”Pix–
;

670 
	`INSURE
 (
FALSE
);

675 ià(
g
->
šT¿™s
.
iB™sP”Pix–
 == 1) {

676 
mask
 >>= 1;

677 ià(
mask
 == 0) {

678 
mask
 = 0x80u;

679 
pDe¡
 += 1;

680 *
pDe¡
 = 0;

683 
	`mem£t
 (
pDe¡
, 255, 
g
->
by‹sP”Pix–
);

684 
pDe¡
 +ğ
g
->
by‹sP”Pix–
;

689 
xcur
 +ğ
g
->
hSlİeDx
;

690 
ycur
 +ğ
g
->
hSlİeDy
;

693 *
pdwOuutU£d
 = (
DWORD
)
g
->
outBy‹sP”Row
;

694 *
pdwOuutThisPos
 = 
g
->
dwOutNextPos
;

695 
g
->
dwOutNextPos
 +ğ(
DWORD
)g->
outBy‹sP”Row
;

697 
g
->
dwRowsS’t
 += 1;

699 
g
->
xLeá
 +ğg->
vSlİeDx
;

700 
g
->
yLeá
 +ğg->
vSlİeDy
;

701 
g
->
xRight
 +ğg->
vSlİeDx
;

702 
g
->
yRight
 +ğg->
vSlİeDy
;

705  (*
pdwIÅutU£d
 !=0 ? 
IP_CONSUMED_ROW
 : 0) |

706 (*
pdwOuutU£d
!=0 ? 
IP_PRODUCED_ROW
 : 0) |

707 (
NEED_MORE
 ? 
IP_READY_FOR_DATA
 : 0);

709 
çl_”rÜ
:

710  
IP_FATAL_ERROR
;

711 
	}
}

721 
FUNC_STATUS
 
WORD
 
	$rÙ©e_š£¹edD©a
 (

722 
IP_XFORM_HANDLE
 
hXfÜm
,

723 
DWORD
 
dwNumBy‹s
)

725 
	`çlB»akPošt
 ();

726  
IP_FATAL_ERROR
;

727 
	}
}

737 
FUNC_STATUS
 
WORD
 
	$rÙ©e_ÃwPage
 (

738 
IP_XFORM_HANDLE
 
hXfÜm
)

740 
PROTATE_INST
 
g
;

742 
	`HANDLE_TO_PTR
 (
hXfÜm
, 
g
);

744  
IP_DONE
;

746 
çl_”rÜ
:

747  
IP_FATAL_ERROR
;

749 
	}
}

759 
FUNC_STATUS
 
WORD
 
	$rÙ©e_şo£XfÜm
 (
IP_XFORM_HANDLE
 
hXfÜm
)

761 
PROTATE_INST
 
g
;

763 
	`HANDLE_TO_PTR
 (
hXfÜm
, 
g
);

765 ià(
g
->
pSŒ
 !ğ
NULL
)

766 
	`IP_MEM_FREE
 (
g
->
pSŒ
);

767 
g
->
dwV®idChk
 = 0;

768 
	`IP_MEM_FREE
 (
g
);

770  
IP_DONE
;

772 
çl_”rÜ
:

773  
IP_FATAL_ERROR
;

774 
	}
}

784 #ifdeà
EXPORT_TRANSFORM


785 
	$__deş¥ec
 (
dÎexpÜt
)

787 
IP_XFORM_TBL
 
rÙ©eTbl
 = {

788 
rÙ©e_İ’XfÜm
,

789 
rÙ©e_£tDeçuÉIÅutT¿™s
,

790 
rÙ©e_£tXfÜmS³c
,

791 
rÙ©e_g‘H—d”BufSize
,

792 
rÙ©e_g‘Aùu®T¿™s
,

793 
rÙ©e_g‘Aùu®BufSizes
,

794 
rÙ©e_cÚv”t
,

795 
rÙ©e_ÃwPage
,

796 
rÙ©e_š£¹edD©a
,

797 
rÙ©e_şo£XfÜm


798 
	}
};

808 #ifdeà
EXPORT_TRANSFORM


809 
	$EXPORT
(
WORD
è
	$rÙ©eG‘XfÜmTabË
 (
LPIP_XFORM_TBL
 
pXfÜm
)

811 ià(
pXfÜm
 =ğ
NULL
)

812  
IP_FATAL_ERROR
;

814 *
pXfÜm
 = 
şrm­Tbl
;

815  
IP_DONE
;

816 
	}
}

	@ip/xsaturation.c

79 
	~"hp.h
"

80 
	~"defs.h
"

81 
	~"¡ršg.h
"

85 
	~"¡dio.h
"

86 
	~<tch¬.h
>

88 
	#PRINT
(
msg
,
¬g1
,
¬g2
) \

89 
	`_á´štf
(
¡d”r
, 
msg
, ()
¬g1
, ()
¬g2
)

	)

91 
	#PRINT
(
msg
,
¬g1
,
¬g2
)

	)

94 
	#CHECK_VALUE
 0x4ba1daû

	)

98 
IP_IMAGE_TRAITS
 
	mŒa™s
;

99 
DWORD
 
	mdwS©Fac
;

100 
DWORD
 
	mdwBy‹sP”Row
;

101 
DWORD
 
	mdwRowsDÚe
;

102 
DWORD
 
	mdwInNextPos
;

103 
DWORD
 
	mdwOutNextPos
;

104 
DWORD
 
	mdwV®idChk
;

105 } 
	tSAT_INST
, *
	tPSAT_INST
;

122 
WORD
 
	$§tu¿tiÚ_İ’XfÜm
 (

123 
IP_XFORM_HANDLE
 *
pXfÜm
)

125 
PSAT_INST
 
g
;

127 
	`INSURE
 (
pXfÜm
 !ğ
NULL
);

128 
	`IP_MEM_ALLOC
 ((
SAT_INST
), 
g
);

129 *
pXfÜm
 = 
g
;

130 
	`mem£t
 (
g
, 0, (
SAT_INST
));

131 
g
->
dwV®idChk
 = 
CHECK_VALUE
;

132  
IP_DONE
;

134 
çl_”rÜ
:

135  
IP_FATAL_ERROR
;

136 
	}
}

155 
WORD
 
	$§tu¿tiÚ_£tDeçuÉIÅutT¿™s
 (

156 
IP_XFORM_HANDLE
 
hXfÜm
,

157 
PIP_IMAGE_TRAITS
 
pT¿™s
)

159 
PSAT_INST
 
g
;

161 
	`HANDLE_TO_PTR
 (
hXfÜm
, 
g
);

164 
	`INSURE
 (
pT¿™s
->
iPix–sP”Row
>0

165 && (
pT¿™s
->
iB™sP”Pix–
==24 ||…Traits->iBitsPerPixel==48));

166 
g
->
Œa™s
 = *
pT¿™s
;

167 
g
->
dwBy‹sP”Row
 = (g->
Œa™s
.
iPix–sP”Row
*g->Œa™s.
iB™sP”Pix–
 + 7) / 8;

168  
IP_DONE
;

170 
çl_”rÜ
:

171  
IP_FATAL_ERROR
;

172 
	}
}

182 
WORD
 
	$§tu¿tiÚ_£tXfÜmS³c
 (

183 
IP_XFORM_HANDLE
 
hXfÜm
,

184 
DWORD_OR_PVOID
 
aXfÜmInfo
[])

186 
PSAT_INST
 
g
;

188 
	`HANDLE_TO_PTR
 (
hXfÜm
, 
g
);

189 
g
->
dwS©Fac
 = 
aXfÜmInfo
[
IP_SATURATION_FACTOR
].
dwÜd
;

190  
IP_DONE
;

192 
çl_”rÜ
:

193  
IP_FATAL_ERROR
;

194 
	}
}

204 
WORD
 
	$§tu¿tiÚ_g‘H—d”BufSize
 (

205 
IP_XFORM_HANDLE
 
hXfÜm
,

206 
DWORD
 *
pdwInBufL’
)

209 *
pdwInBufL’
 = 0;

210  
IP_DONE
;

211 
	}
}

221 
WORD
 
	$§tu¿tiÚ_g‘Aùu®T¿™s
 (

222 
IP_XFORM_HANDLE
 
hXfÜm
,

223 
DWORD
 
dwIÅutAva
,

224 
PBYTE
 
pbIÅutBuf
,

225 
PDWORD
 
pdwIÅutU£d
,

226 
PDWORD
 
pdwIÅutNextPos
,

227 
PIP_IMAGE_TRAITS
 
pIÁ¿™s
,

228 
PIP_IMAGE_TRAITS
 
pOutT¿™s
)

230 
PSAT_INST
 
g
;

232 
	`HANDLE_TO_PTR
 (
hXfÜm
, 
g
);

235 *
pdwIÅutU£d
 = 0;

236 *
pdwIÅutNextPos
 = 0;

238 *
pIÁ¿™s
 = 
g
->
Œa™s
;

239 *
pOutT¿™s
 = 
g
->
Œa™s
;

241  
IP_DONE
 | 
IP_READY_FOR_DATA
;

243 
çl_”rÜ
:

244  
IP_FATAL_ERROR
;

245 
	}
}

255 
WORD
 
	$§tu¿tiÚ_g‘Aùu®BufSizes
 (

256 
IP_XFORM_HANDLE
 
hXfÜm
,

257 
PDWORD
 
pdwMšInBufL’
,

258 
PDWORD
 
pdwMšOutBufL’
)

260 
PSAT_INST
 
g
;

262 
	`HANDLE_TO_PTR
 (
hXfÜm
, 
g
);

264 *
pdwMšInBufL’
 = *
pdwMšOutBufL’
 = 
g
->
dwBy‹sP”Row
;

265  
IP_DONE
;

267 
çl_”rÜ
:

268  
IP_FATAL_ERROR
;

269 
	}
}

279 
WORD
 
	$§tu¿tiÚ_cÚv”t
 (

280 
IP_XFORM_HANDLE
 
hXfÜm
,

281 
DWORD
 
dwIÅutAva
,

282 
PBYTE
 
pbIÅutBuf
,

283 
PDWORD
 
pdwIÅutU£d
,

284 
PDWORD
 
pdwIÅutNextPos
,

285 
DWORD
 
dwOuutAva
,

286 
PBYTE
 
pbOuutBuf
,

287 
PDWORD
 
pdwOuutU£d
,

288 
PDWORD
 
pdwOuutThisPos
)

290 
PSAT_INST
 
g
;

291 
nBy‹s
;

292 
PBYTE
 
pIn
, 
pOut
, 
pOutAá”
;

293 
l
, 
rv
, 
gv
, 
bv
;

295 
	`HANDLE_TO_PTR
 (
hXfÜm
, 
g
);

299 ià(
pbIÅutBuf
 =ğ
NULL
) {

300 
	`PRINT
 (
	`_T
("saturation_convert: Toldo flush.\n"), 0, 0);

301 *
pdwIÅutU£d
 = *
pdwOuutU£d
 = 0;

302 *
pdwIÅutNextPos
 = 
g
->
dwInNextPos
;

303 *
pdwOuutThisPos
 = 
g
->
dwOutNextPos
;

304  
IP_DONE
;

309 
nBy‹s
 = 
g
->
dwBy‹sP”Row
;

310 
	`INSURE
 (
dwIÅutAva
 >ğ(
DWORD
)
nBy‹s
 );

311 
	`INSURE
 (
dwOuutAva
 >ğ(
DWORD
)
nBy‹s
);

313 
pIn
 = 
pbIÅutBuf
;

314 
pOut
 = 
pbOuutBuf
;

315 
pOutAá”
 = 
pOut
 + 
nBy‹s
;

317 ià(
g
->
Œa™s
.
iB™sP”Pix–
 == 24) {

320 
pOut
 < 
pOutAá”
) {

321 
rv
 = *
pIn
++;

322 
gv
 = *
pIn
++;

323 
bv
 = *
pIn
++;

325 
l
 = 
	`NTSC_LUMINANCE
 (
rv
,
gv
,
bv
);

327 
rv
 = 
l
 + ((Ôv-l)*()
g
->
dwS©Fac
 + (1<<7)) >> 8);

328 
gv
 = 
l
 + (((gv-l)*()
g
->
dwS©Fac
 + (1<<7)) >> 8);

329 
bv
 = 
l
 + (((bv-l)*()
g
->
dwS©Fac
 + (1<<7)) >> 8);

331 ià(
rv
 > 255)„v = 255; if (rv < 0)„v = 0;

332 ià(
gv
 > 255) gv = 255; if (gv < 0) gv = 0;

333 ià(
bv
 > 255) bv = 255; if (bv < 0) bv = 0;

335 *
pOut
++ = (
BYTE
)
rv
;

336 *
pOut
++ = (
BYTE
)
gv
;

337 *
pOut
++ = (
BYTE
)
bv
;

340 
PWORD
 
¤c
 = (PWORD)
pIn
;

341 
PWORD
 
d¡
 = (PWORD)
pOut
;

342 
PWORD
 
d¡Aá”
 = (PWORD)
pOutAá”
;

344 
d¡
 < 
d¡Aá”
) {

345 
rv
 = ()(*
¤c
++);

346 
gv
 = ()(*
¤c
++);

347 
bv
 = ()(*
¤c
++);

349 
l
 = 
	`NTSC_LUMINANCE
 (
rv
,
gv
,
bv
);

351 
rv
 = 
l
 + ((Ôv-l)*()
g
->
dwS©Fac
 + (1<<7)) >> 8);

352 
gv
 = 
l
 + (((gv-l)*()
g
->
dwS©Fac
 + (1<<7)) >> 8);

353 
bv
 = 
l
 + (((bv-l)*()
g
->
dwS©Fac
 + (1<<7)) >> 8);

355 ià(
rv
 > 65535)„v = 65535; if (rv < 0)„v = 0;

356 ià(
gv
 > 65535) gv = 65535; if (gv < 0) gv = 0;

357 ià(
bv
 > 65535) bv = 65535; if (bv < 0) bv = 0;

359 *
d¡
++ = (
WORD
)
rv
;

360 *
d¡
++ = (
WORD
)
gv
;

361 *
d¡
++ = (
WORD
)
bv
;

365 *
pdwIÅutU£d
 = 
nBy‹s
;

366 
g
->
dwInNextPos
 +ğ
nBy‹s
;

367 *
pdwIÅutNextPos
 = 
g
->
dwInNextPos
;

369 *
pdwOuutU£d
 = 
nBy‹s
;

370 *
pdwOuutThisPos
 = 
g
->
dwOutNextPos
;

371 
g
->
dwOutNextPos
 +ğ
nBy‹s
;

373 
g
->
dwRowsDÚe
 += 1;

375  
IP_CONSUMED_ROW
 | 
IP_PRODUCED_ROW
 | 
IP_READY_FOR_DATA
;

377 
çl_”rÜ
:

378  
IP_FATAL_ERROR
;

379 
	}
}

389 
WORD
 
	$§tu¿tiÚ_š£¹edD©a
 (

390 
IP_XFORM_HANDLE
 
hXfÜm
,

391 
DWORD
 
dwNumBy‹s
)

393 
	`çlB»akPošt
 ();

394  
IP_FATAL_ERROR
;

395 
	}
}

405 
WORD
 
	$§tu¿tiÚ_ÃwPage
 (

406 
IP_XFORM_HANDLE
 
hXfÜm
)

408 
PSAT_INST
 
g
;

410 
	`HANDLE_TO_PTR
 (
hXfÜm
, 
g
);

412  
IP_DONE
;

414 
çl_”rÜ
:

415  
IP_FATAL_ERROR
;

417 
	}
}

427 
WORD
 
	$§tu¿tiÚ_şo£XfÜm
 (
IP_XFORM_HANDLE
 
hXfÜm
)

429 
PSAT_INST
 
g
;

431 
	`HANDLE_TO_PTR
 (
hXfÜm
, 
g
);

433 
g
->
dwV®idChk
 = 0;

434 
	`IP_MEM_FREE
 (
g
);

436  
IP_DONE
;

438 
çl_”rÜ
:

439  
IP_FATAL_ERROR
;

440 
	}
}

450 
IP_XFORM_TBL
 
	g§tu¿tiÚTbl
 = {

451 
§tu¿tiÚ_İ’XfÜm
,

452 
§tu¿tiÚ_£tDeçuÉIÅutT¿™s
,

453 
§tu¿tiÚ_£tXfÜmS³c
,

454 
§tu¿tiÚ_g‘H—d”BufSize
,

455 
§tu¿tiÚ_g‘Aùu®T¿™s
,

456 
§tu¿tiÚ_g‘Aùu®BufSizes
,

457 
§tu¿tiÚ_cÚv”t
,

458 
§tu¿tiÚ_ÃwPage
,

459 
§tu¿tiÚ_š£¹edD©a
,

460 
§tu¿tiÚ_şo£XfÜm


	@ip/xscale.c

98 
	~"¡ršg.h
"

99 
	~"as£¹.h
"

101 
	~"hp.h
"

102 
	~"defs.h
"

106 
	~"¡dio.h
"

107 
	~<tch¬.h
>

109 
	#PRINT
(
msg
,
¬g1
,
¬g2
) \

110 
	`_á´štf
(
¡d”r
, 
msg
, ()
¬g1
, ()
¬g2
)

	)

112 
	#PRINT
(
msg
,
¬g1
,
¬g2
)

	)

115 
	#CHECK_VALUE
 0x1û5ÿ7e

	)

116 
	#SC_WHITE_ROW
 1

	)

126 
	#MAX_ROWS_AP
 6

	)

127 
	#HELD_ARRAY_SIZE
 7

	)

130 
	mIM_BILEVEL
,

131 
	mIM_GRAY
,

132 
	mIM_COLOR


133 } 
	tIM_TYPE
;

139 
IM_TYPE
 
	mimage_ty³
;

140 
BOOL
 
	mç¡
;

141 
BYTE
 
	mnMÜeFlush
;

142 
ULONG
 
	mhÜiz_çc
;

143 
ULONG
 
	mv”t_çc
;

144 
	mv”t_pos
;

145 
	mš_row_nby‹s
;

146 
	mout_row_nby‹s
;

147 
	mout_row_pix–s
;

148 
	mš_Äows
;

149 
	mout_Äows
;

150 
BYTE
 *
	mrows_­
[
MAX_ROWS_AP
];

151 
	mnMaxOutRows
;

152 
	mnMÜeH–dOutRows
;

153 
	miNextH–dOutRow
;

154 
BYTE
 *
	m­H–dOutRows
[
HELD_ARRAY_SIZE
];

157 
	mtİ_row
;

158 
ULONG
 
	mpo¡_çc
;

159 
BYTE
 
	mmid_Œa™s
;

161 
ULONG
 
	mšv_hÜiz_çc
;

162 
ULONG
 
	mšv_v”t_çc
;

163 
	mšv_v”t_pos
;

164 
BYTE
 
	mn_§ved_rows
;

165 
BYTE
 
	mn_®loûd_rows
;

167 
IP_IMAGE_TRAITS
 
	mšT¿™s
;

168 
DWORD
 
	mdwInNextPos
;

169 
DWORD
 
	mdwOutNextPos
;

170 
DWORD
 
	mdwV®idChk
;

171 } 
	tSC_INST
, *
	tPSC_INST
;

187 
	$bi_ç¡_İ’
(
PSC_INST
 
g
, 
UINT
 
š_row_Ën
) {

188 
	`çlB»akPošt
();

189 
	}
}

191 
	$bi_sÿË_İ’
(
PSC_INST
 
g
, 
UINT
 
š_row_Ën
) {

192 
	`çlB»akPošt
();

193 
	}
}

195 
	$bi_ç¡_row
(
PSC_INST
 
g
,
PBYTE
 
pbIÅutBuf
,
BYTE
 
¤c_Œa™s
,

196 
BYTE
 *
­H–dOutRows
[],
ULONG
 *
pde¡_Œa™s
) {

197 
	`çlB»akPošt
();

199 
	}
}

201 
	$bi_sÿË_row
(
PSC_INST
 
g
,
PBYTE
 
pbIÅutBuf
,
BYTE
 
¤c_Œa™s
,

202 
BYTE
 *
­H–dOutRows
[],
ULONG
 *
pde¡_Œa™s
) {

203 
	`çlB»akPošt
();

205 
	}
}

207 
	$bi_ç¡_şo£
(
PSC_INST
 
g
) {

208 
	`çlB»akPošt
();

209 
	}
}

211 
	$bi_sÿË_şo£
(
PSC_INST
 
g
) {

212 
	`çlB»akPošt
();

213 
	}
}

294 
	#CONTONE_MIN_HORIZ_FAC
 (
ULONG
)0x04000

	)

297 
	#CONTONE_MAX_HORIZ_FAC
 ((
ULONG
)
MAX_ROWS_AP
 << 16)

	)

300 
	#CONTONE_MIN_VERT_FAC
 (
ULONG
)0x04000

	)

303 
	#CONTONE_MAX_VERT_FAC
 ((
ULONG
)
MAX_ROWS_AP
 << 16)

	)

318 
	$g¿y_hÜiz_sÿË
 (

319 
SC_INST
 *
g
,

320 
BYTE
 *
¤c_p
,

321 
BYTE
 *
de¡_p
)

323 
ULONG
 
hÜiz_pos
, 
Ãw_pos
;

324 
BYTE
 *
š_p
, *
out_p
, *
out_aá_p
;

325 
UINT
 
sum
, 
pix
;

326 
UINT
 
w1
, 
w2
;

327 
UINT
 
n_pix
, 
u
;

329 
š_p
 = 
¤c_p
;

330 
out_p
 = 
de¡_p
;

331 
out_aá_p
 = 
out_p
 + 
g
->
out_row_nby‹s
;

332 
š_p
[
g
->
š_row_nby‹s
] = in_p[g->in_row_nbytes-1];

338 ià(
g
->
hÜiz_çc
 >= 0x00010000u)

340 
hÜiz_pos
 = 0;

342 
out_p
 < 
out_aá_p
) {

344 
w2
 = (
UINT
è(
hÜiz_pos
 >> 8);

345 
w1
 = 256 - 
w2
;

346 *
out_p
++ = (
w1
*
š_p
[0] + 
w2
*in_p[1]) >> 8;

347 
hÜiz_pos
 +ğ
g
->
šv_hÜiz_çc
;

348 } (
hÜiz_pos
>>16) == 0);

350 
hÜiz_pos
 &= 0x0000ffffu;

351 
š_p
 += 1;

359 ià(
g
->
ç¡
)

361 
hÜiz_pos
 = 0;

362 
out_p
 < 
out_aá_p
) {

363 *
out_p
++ = *
š_p
;

364 
hÜiz_pos
 +ğ
g
->
šv_hÜiz_çc
;

365 
š_p
 +ğ
hÜiz_pos
 >> 16;

366 
hÜiz_pos
 &= 0x0000ffffu;

371 
hÜiz_pos
 = 
g
->
hÜiz_çc
;

372 
w2
 = 
g
->
hÜiz_çc
 >> 8;

374 
out_p
 < 
out_aá_p
) {

375 
Ãw_pos
 = 
hÜiz_pos
;

376 
n_pix
 = 1;

378 
Ãw_pos
 +ğ
g
->
hÜiz_çc
;

379 
n_pix
 += 1;

380 } (
Ãw_pos
>>16) == 0);

387 
sum
 = 
hÜiz_pos
 >> 8;

388 
pix
 = 
sum
 * (*
š_p
++);

390 
u
=1; u<=
n_pix
-2; u++) {

391 
pix
 +ğ
w2
 * (*
š_p
++);

392 
sum
 +ğ
w2
;

395 
pix
 +ğ(256-
sum
è* (*
š_p
);

397 *
out_p
++ = 
pix
 >> 8;

398 
hÜiz_pos
 = 
Ãw_pos
 & 0x0000ffffu;

401 
	}
}

415 
	$cŞÜ_hÜiz_sÿË
 (

416 
SC_INST
 *
g
,

417 
BYTE
 *
¤c_p
,

418 
BYTE
 *
de¡_p
)

420 
ULONG
 
hÜiz_pos
, 
Ãw_pos
;

421 
BYTE
 *
š_p
, *
out_p
, *
out_aá_p
, *
p
;

422 
UINT
 
sum
, 
pix_y
, 
pix_u
, 
pix_v
;

423 
UINT
 
w1
, 
w2
;

424 
UINT
 
n_pix
, 
u
;

426 
š_p
 = 
¤c_p
;

427 
out_p
 = 
de¡_p
;

428 
out_aá_p
 = 
out_p
 + 
g
->
out_row_nby‹s
;

430 
p
 = 
š_p
 + 
g
->
š_row_nby‹s
;

431 
p
[0] =…[-3];

432 
p
[1] =…[-2];

433 
p
[2] =…[-1];

439 ià(
g
->
hÜiz_çc
 >= 0x00010000u)

441 
hÜiz_pos
 = 0;

443 
out_p
 < 
out_aá_p
) {

445 
w2
 = (
UINT
è(
hÜiz_pos
 >> 8);

446 
w1
 = 256 - 
w2
;

447 *
out_p
++ = (
w1
*
š_p
[0] + 
w2
*in_p[3]) >> 8;

448 *
out_p
++ = (
w1
*
š_p
[1] + 
w2
*in_p[4]) >> 8;

449 *
out_p
++ = (
w1
*
š_p
[2] + 
w2
*in_p[5]) >> 8;

450 
hÜiz_pos
 +ğ
g
->
šv_hÜiz_çc
;

451 } (
hÜiz_pos
>>16) == 0);

453 
hÜiz_pos
 &= 0x0000ffffu;

454 
š_p
 += 3;

462 ià(
g
->
ç¡
)

464 
iS‹p
;

465 
hÜiz_pos
 = 0;

466 
out_p
 < 
out_aá_p
) {

467 *
out_p
++ = 
š_p
[0];

468 *
out_p
++ = 
š_p
[1];

469 *
out_p
++ = 
š_p
[2];

471 
hÜiz_pos
 +ğ
g
->
šv_hÜiz_çc
;

472 
iS‹p
 = 
hÜiz_pos
 >> 16;

473 
š_p
 +ğ
iS‹p
 + iStep + iStep;

474 
hÜiz_pos
 &= 0x0000ffffu;

479 
hÜiz_pos
 = 
g
->
hÜiz_çc
;

480 
w2
 = 
g
->
hÜiz_çc
 >> 8;

482 
out_p
 < 
out_aá_p
) {

483 
Ãw_pos
 = 
hÜiz_pos
;

484 
n_pix
 = 1;

486 
Ãw_pos
 +ğ
g
->
hÜiz_çc
;

487 
n_pix
 += 1;

488 } (
Ãw_pos
>>16) == 0);

495 
sum
 = 
hÜiz_pos
 >> 8;

496 
pix_y
 = 
sum
 * (*
š_p
++);

497 
pix_u
 = 
sum
 * (*
š_p
++);

498 
pix_v
 = 
sum
 * (*
š_p
++);

500 
u
=1; u<=
n_pix
-2; u++) {

501 
pix_y
 +ğ
w2
 * (*
š_p
++);

502 
pix_u
 +ğ
w2
 * (*
š_p
++);

503 
pix_v
 +ğ
w2
 * (*
š_p
++);

504 
sum
 +ğ
w2
;

507 
sum
 = 256 - sum;

508 
pix_y
 +ğ
sum
 * 
š_p
[0];

509 
pix_u
 +ğ
sum
 * 
š_p
[1];

510 
pix_v
 +ğ
sum
 * 
š_p
[2];

512 *
out_p
++ = 
pix_y
 >> 8;

513 *
out_p
++ = 
pix_u
 >> 8;

514 *
out_p
++ = 
pix_v
 >> 8;

515 
hÜiz_pos
 = 
Ãw_pos
 & 0x0000ffffu;

518 
	}
}

532 
	$weight_two_rows
 (

533 
SC_INST
 *
g
,

534 
ULONG
 
fœ¡_weight
,

535 
BYTE
 *
de¡_p
)

537 
BYTE
 *
p1
, *
p2
;

538 
BYTE
 *
out_p
, *
out_aá_p
;

540 
p1
 = 
g
->
rows_­
[0];

541 
p2
 = 
g
->
rows_­
[1];

542 
out_p
 = 
de¡_p
;

543 
out_aá_p
 = 
out_p
 + 
g
->
out_row_nby‹s
;

546 
UINT
 
w1
, 
w2
;

547 
w1
 = 
fœ¡_weight
 >> 8;

548 
w2
 = 256 - 
w1
;

549 
out_p
 < 
out_aá_p
)

550 *
out_p
++ = (
w1
*(*
p1
++è+ 
w2
*(*
p2
++)) >> 8;

552 (
fœ¡_weight
+(1u<<12)) >> 13)

555 
	`memıy
 (
out_p
, 
p2
, 
g
->
out_row_nby‹s
);

558 
out_p
 < 
out_aá_p
)

559 *
out_p
++ = (*
p1
>>3è+ *
p2
 - (*p2>>3);

560 
p1
++; 
p2
++;

563 
out_p
 < 
out_aá_p
)

564 *
out_p
++ = (*
p1
>>2è+ *
p2
 - (*p2>>2);

565 
p1
++; 
p2
++;

568 
out_p
 < 
out_aá_p
)

569 *
out_p
++ = (*
p1
>>2è+ (*p1>>3è+ (*
p2
>>1) + (*p2>>3);

570 
p1
++; 
p2
++;

573 
out_p
 < 
out_aá_p
)

574 *
out_p
++ = (*
p1
>>1è+ (*
p2
>>1);

575 
p1
++; 
p2
++;

578 
out_p
 < 
out_aá_p
)

579 *
out_p
++ = (*
p1
>>1è+ (*p1>>3è+ (*
p2
>>2) + (*p2>>3);

580 
p1
++; 
p2
++;

583 
out_p
 < 
out_aá_p
)

584 *
out_p
++ = *
p1
 - (*p1>>2è+ (*
p2
>>2);

585 
p1
++; 
p2
++;

588 
out_p
 < 
out_aá_p
)

589 *
out_p
++ = *
p1
 - (*p1>>3è+ (*
p2
>>3);

590 
p1
++; 
p2
++;

593 
	`memıy
 (
out_p
, 
p1
, 
g
->
out_row_nby‹s
);

596 
	`as£¹
 (0);

599 
	}
}

614 
	$weight_n_rows
 (

615 
SC_INST
 *
g
,

616 
UINT
 
n_rows
,

617 
ULONG
 
fœ¡_weight
,

618 
ULONG
 
mid_weight
,

619 
BYTE
 *
de¡_p
)

621 
BYTE
 *
š_p
[
MAX_ROWS_AP
];

622 
BYTE
 *
out_p
, *
out_aá_p
;

623 
UINT
 
weights
[
MAX_ROWS_AP
];

624 
UINT
 
sum
;

625 
UINT
 
u
;

627 
	`as£¹
 (
n_rows
>=2 &&‚_rows<=
MAX_ROWS_AP
);

629 ià(
n_rows
 == 2) {

630 
	`weight_two_rows
 (
g
, 
fœ¡_weight
, 
de¡_p
);

634 
out_p
 = 
de¡_p
;

635 
out_aá_p
 = 
out_p
 + 
g
->
out_row_nby‹s
;

636 
u
=0; u<
n_rows
; u++)

637 
š_p
[
u
] = 
g
->
rows_­
[u];

639 
sum
 = 
weights
[0] = 
fœ¡_weight
 >> 8;

640 
u
=1; u<=
n_rows
-2; u++)

641 
sum
 +ğ(
weights
[
u
] = 
mid_weight
 >> 8);

642 
weights
[
n_rows
-1] = 256 - 
sum
;

644 
out_p
 < 
out_aá_p
) {

645 
sum
 = 0;

646 
u
=0; u<
n_rows
; u++)

647 
sum
 +ğ
weights
[
u
] * (*
š_p
[u]++);

648 *
out_p
++ = 
sum
 >> 8;

650 
	}
}

659 
	$cÚtÚe_sÿË_İ’
 (

660 
SC_INST
 *
g
,

661 
UINT
 
š_row_Ën
)

663 
ULONG
 
hÜiz_çc
;

664 
ULONG
 
v”t_çc
;

665 
UINT
 
n
;

667 
hÜiz_çc
 = 
g
->horiz_fac;

668 
v”t_çc
 = 
g
->vert_fac;

670 ià(! 
g
->
ç¡
) {

671 
	`as£¹
 (
hÜiz_çc
>=
CONTONE_MIN_HORIZ_FAC
 &&

672 
hÜiz_çc
<=
CONTONE_MAX_HORIZ_FAC
);

673 
	`as£¹
 ( 
v”t_çc
>=
CONTONE_MIN_VERT_FAC
 &&

674 
v”t_çc
<=
CONTONE_MAX_VERT_FAC
);

677 
g
->
v”t_pos
 = 0;

678 
g
->
š_row_nby‹s
 = 
š_row_Ën
;

679 
g
->
out_row_pix–s
 = g->
out_row_nby‹s
 = (
hÜiz_çc
*
š_row_Ën
) >> 16;

681 ià(
g
->
image_ty³
 =ğ
IM_COLOR
) {

682 
g
->
š_row_nby‹s
 *= 3;

683 
g
->
out_row_nby‹s
 *= 3;

686 
g
->
šv_hÜiz_çc
 = ((0x80000000u / 
hÜiz_çc
) << 1) + 1u;

687 
g
->
šv_v”t_çc
 = ((0x80000000u / 
v”t_çc
) << 1) + 1u;

690 ià(
g
->
ç¡
) {

691 
g
->
n_®loûd_rows
 = 0;

692 } ià(
v”t_çc
 >= 0x00010000u) {

693 
g
->
šv_v”t_pos
 = g->
šv_v”t_çc
;

694 
g
->
n_®loûd_rows
 = 2;

696 
g
->
n_®loûd_rows
 = (
BYTE
)((g->
šv_v”t_çc
+0x0000ffffu) >> 16) + 1;

697 
g
->
v”t_pos
 = 
v”t_çc
;

700 
n
=0;‚<
g
->
n_®loûd_rows
;‚++) {

701 
	`IP_MEM_ALLOC
 (
g
->
out_row_nby‹s
, g->
rows_­
[
n
]);

702 
	`mem£t
 (
g
->
rows_­
[
n
], 0xff, g->
out_row_nby‹s
 + 4);

705 
g
->
nMÜeFlush
 = 0;

708 
çl_”rÜ
:

709 
	`as£¹
 (0);

710 
	}
}

719 
	$cÚtÚe_sÿË_şo£
 (
SC_INST
 *
g
)

721 
UINT
 
n
;

723 
n
=0;‚<
g
->
n_®loûd_rows
;‚++)

724 
	`IP_MEM_FREE
 (
g
->
rows_­
[
n
]);

725 
	}
}

734 
	$cÚtÚe_sÿË_row
 (

735 
SC_INST
 *
g
,

736 
BYTE
 *
¤c_row_p
,

737 
BYTE
 *
de¡_rows_­
[])

739 
UINT
 
n_out_rows
;

740 
UINT
 
u
;

741 
weight
;

742 
Ãw_pos
;

743 
BYTE
 *
p
;

745 
	`as£¹
 (
¤c_row_p
 !ğ
NULL
);

747 ià(
g
->
ç¡
 && g->
v”t_çc
<=0x00010000u)

750 
g
->
v”t_pos
 +ğg->
v”t_çc
;

751 
n_out_rows
 = 
g
->
v”t_pos
 >> 16;

752 
g
->
v”t_pos
 &= 0x0000ffffu;

754 ià(
n_out_rows
 > 0) {

755 ià(
g
->
image_ty³
 =ğ
IM_GRAY
è
	`g¿y_hÜiz_sÿË
 (g, 
¤c_row_p
, 
de¡_rows_­
[0]);

756 
	`cŞÜ_hÜiz_sÿË
 (
g
, 
¤c_row_p
, 
de¡_rows_­
[0]);

759  
n_out_rows
;

762 
p
 = 
g
->
rows_­
[g->
n_§ved_rows
];

763 ià(
g
->
image_ty³
 =ğ
IM_GRAY
è
	`g¿y_hÜiz_sÿË
 (g, 
¤c_row_p
, 
p
);

764 
	`cŞÜ_hÜiz_sÿË
 (
g
, 
¤c_row_p
, 
p
);

766 
g
->
n_§ved_rows
 += 1;

768 ià(
g
->
n_§ved_rows
 == 1) {

770  
	`cÚtÚe_sÿË_row
 (
g
, 
¤c_row_p
, 
de¡_rows_­
);

777 ià(
g
->
v”t_çc
 >= 0x00010000u)

779 
n_out_rows
 = 0;

781 ià(
g
->
n_§ved_rows
 == 2) {

784 
	`weight_two_rows
 (
g
, 0x10000u-g->
v”t_pos
,

785 
de¡_rows_­
[
n_out_rows
]);

786 
n_out_rows
 += 1;

787 
g
->
v”t_pos
 +ğg->
šv_v”t_çc
;

788 } (
g
->
v”t_pos
>>16) == 0);

789 
g
->
v”t_pos
 &= 0x0000ffffu;

798 
g
->
v”t_pos
 +ğg->
v”t_çc
;

799 
n_out_rows
 = (
UINT
)(
g
->
v”t_pos
 >> 16);

800 
g
->
v”t_pos
 &= 0x0000ffffu;

802 
u
=0; u<
n_out_rows
; u++) {

803 
weight
 = 0x10000 - 
g
->
šv_v”t_pos
;

804 ià(
weight
 < 0) weight = 0;

805 ià(
weight
 > 0x10000) weight = 0x10000;

806 
	`weight_two_rows
 (
g
, 
weight
, 
de¡_rows_­
[
u
]);

807 
g
->
šv_v”t_pos
 +ğg->
šv_v”t_çc
;

810 
g
->
šv_v”t_pos
 -= 0x10000;

813 
g
->
n_§ved_rows
 = 1;

814 
p
 = 
g
->
rows_­
[0];

815 
g
->
rows_­
[0] = g->rows_ap[1];

816 
g
->
rows_­
[1] = 
p
;

826 
n_out_rows
 = 0;

827 
Ãw_pos
 = 
g
->
v”t_pos
 + (g->
n_§ved_rows
-1)*g->
v”t_çc
;

829 ià((
Ãw_pos
>>16) != 0) {

830 
	`weight_n_rows
 (
g
, g->
n_§ved_rows
, g->
v”t_pos
, g->
v”t_çc
,

831 
de¡_rows_­
[0]);

832 
n_out_rows
 = 1;

833 
g
->
v”t_pos
 = 
Ãw_pos
 & 0x0000ffffu;

836 
p
 = 
g
->
rows_­
[0];

837 
g
->
rows_­
[0] = g->rows_­[g->
n_§ved_rows
-1];

838 
g
->
rows_­
[g->
n_§ved_rows
-1] = 
p
;

839 
g
->
n_§ved_rows
 = 1;

843  
n_out_rows
;

844 
	}
}

871 
WORD
 
	$sÿË_İ’XfÜm
 (

872 
IP_XFORM_HANDLE
 *
pXfÜm
)

874 
PSC_INST
 
g
;

876 
	`INSURE
 (
pXfÜm
 !ğ
NULL
);

877 
	`IP_MEM_ALLOC
 ((
SC_INST
), 
g
);

878 *
pXfÜm
 = 
g
;

879 
	`mem£t
 (
g
, 0, (
SC_INST
));

880 
g
->
dwV®idChk
 = 
CHECK_VALUE
;

881  
IP_DONE
;

883 
çl_”rÜ
:

884  
IP_FATAL_ERROR
;

885 
	}
}

904 
WORD
 
	$sÿË_£tDeçuÉIÅutT¿™s
 (

905 
IP_XFORM_HANDLE
 
hXfÜm
,

906 
PIP_IMAGE_TRAITS
 
pT¿™s
)

908 
PSC_INST
 
g
;

910 
	`HANDLE_TO_PTR
 (
hXfÜm
, 
g
);

913 
	`INSURE
 ( (
pT¿™s
->
iB™sP”Pix–
==24 &&…T¿™s->
iCompÚ’tsP”Pix–
==3)

914 || (
pT¿™s
->
iB™sP”Pix–
==8 &&…T¿™s->
iCompÚ’tsP”Pix–
==1)

915 || (
pT¿™s
->
iB™sP”Pix–
==1 &&…T¿™s->
iCompÚ’tsP”Pix–
==1));

916 
	`INSURE
 (
pT¿™s
->
iPix–sP”Row
 > 0);

918 
pT¿™s
->
iB™sP”Pix–
) {

919 1: 
g
->
image_ty³
 = 
IM_BILEVEL
; ;

920 8: 
g
->
image_ty³
 = 
IM_GRAY
; ;

921 24: 
g
->
image_ty³
 = 
IM_COLOR
; ;

925 
	`INSURE
(
g
->
image_ty³
 !ğ
IM_BILEVEL
);

927 
g
->
šT¿™s
 = *
pT¿™s
;

928  
IP_DONE
;

930 
çl_”rÜ
:

931  
IP_FATAL_ERROR
;

932 
	}
}

942 
WORD
 
	$sÿË_£tXfÜmS³c
 (

943 
IP_XFORM_HANDLE
 
hXfÜm
,

944 
DWORD_OR_PVOID
 
aXfÜmInfo
[])

946 
PSC_INST
 
g
;

947 
	`HANDLE_TO_PTR
 (
hXfÜm
, 
g
);

949 
g
->
hÜiz_çc
 = (
aXfÜmInfo
[
IP_SCALE_HORIZ_FACTOR
].
dwÜd
+0x80) >> 8;

950 
g
->
v”t_çc
 = (
aXfÜmInfo
[
IP_SCALE_VERT_FACTOR
].
dwÜd
+0x80) >> 8;

951 
g
->
ç¡
 = 
aXfÜmInfo
[
IP_SCALE_FAST
].
dwÜd
;

952  
IP_DONE
;

954 
çl_”rÜ
:

955  
IP_FATAL_ERROR
;

956 
	}
}

966 
WORD
 
	$sÿË_g‘H—d”BufSize
 (

967 
IP_XFORM_HANDLE
 
hXfÜm
,

968 
DWORD
 *
pdwInBufL’
)

971 *
pdwInBufL’
 = 0;

972  
IP_DONE
;

973 
	}
}

983 
WORD
 
	$sÿË_g‘Aùu®T¿™s
 (

984 
IP_XFORM_HANDLE
 
hXfÜm
,

985 
DWORD
 
dwIÅutAva
,

986 
PBYTE
 
pbIÅutBuf
,

987 
PDWORD
 
pdwIÅutU£d
,

988 
PDWORD
 
pdwIÅutNextPos
,

989 
PIP_IMAGE_TRAITS
 
pInT¿™s
,

990 
PIP_IMAGE_TRAITS
 
pOutT¿™s
)

992 
PSC_INST
 
g
;

993 
i
;

994 
UINT
 
š_row_Ën
;

996 
	`HANDLE_TO_PTR
 (
hXfÜm
, 
g
);

1000 *
pdwIÅutU£d
 = 0;

1001 *
pdwIÅutNextPos
 = 0;

1005 
š_row_Ën
 = 
g
->
šT¿™s
.
iPix–sP”Row
;

1007 
g
->
image_ty³
) {

1008 
IM_BILEVEL
:

1009 ià(
g
->
v”t_çc
 < 0x10000u)

1010 
g
->
ç¡
 = 
FALSE
;

1011 ià(
g
->
ç¡
è
	`bi_ç¡_İ’
 (g, 
š_row_Ën
);

1012 
	`bi_sÿË_İ’
 (
g
, 
š_row_Ën
);

1015 
IM_GRAY
:

1016 
IM_COLOR
:

1017 ià(
g
->
v”t_çc
 > 0x10000u)

1018 
g
->
ç¡
 = 
FALSE
;

1019 
	`cÚtÚe_sÿË_İ’
 (
g
, 
š_row_Ën
);

1025 
g
->
nMaxOutRows
 = (g->
v”t_çc
+0x0000ffffu) >> 16;

1026 
	`INSURE
 (
g
->
nMaxOutRows
 <ğ
HELD_ARRAY_SIZE
);

1027 
i
=1; i<
g
->
nMaxOutRows
; i++)

1028 
	`IP_MEM_ALLOC
 (
g
->
out_row_nby‹s
, g->
­H–dOutRows
[
i
]);

1032 *
pInT¿™s
 = 
g
->
šT¿™s
;

1033 *
pOutT¿™s
 = 
g
->
šT¿™s
;

1034 
pOutT¿™s
->
iPix–sP”Row
 = 
g
->
out_row_pix–s
;

1035 ià(
pInT¿™s
->
lNumRows
 >= 0) {

1038 
pOutT¿™s
->
lNumRows
 = ()

1039 (()
pInT¿™s
->
lNumRows
 * 
g
->
v”t_çc
 / 65536.0);

1042  
IP_DONE
 | 
IP_READY_FOR_DATA
;

1044 
çl_”rÜ
:

1045  
IP_FATAL_ERROR
;

1046 
	}
}

1056 
WORD
 
	$sÿË_g‘Aùu®BufSizes
 (

1057 
IP_XFORM_HANDLE
 
hXfÜm
,

1058 
PDWORD
 
pdwMšInBufL’
,

1059 
PDWORD
 
pdwMšOutBufL’
)

1061 
PSC_INST
 
g
;

1063 
	`HANDLE_TO_PTR
 (
hXfÜm
, 
g
);

1064 *
pdwMšInBufL’
 = 
g
->
š_row_nby‹s
;

1065 *
pdwMšOutBufL’
 = 
g
->
out_row_nby‹s
;

1067  
IP_DONE
;

1069 
çl_”rÜ
:

1070  
IP_FATAL_ERROR
;

1071 
	}
}

1081 
WORD
 
	$sÿË_cÚv”t
 (

1082 
IP_XFORM_HANDLE
 
hXfÜm
,

1083 
DWORD
 
dwIÅutAva
,

1084 
PBYTE
 
pbIÅutBuf
,

1085 
PDWORD
 
pdwIÅutU£d
,

1086 
PDWORD
 
pdwIÅutNextPos
,

1087 
DWORD
 
dwOuutAva
,

1088 
PBYTE
 
pbOuutBuf
,

1089 
PDWORD
 
pdwOuutU£d
,

1090 
PDWORD
 
pdwOuutThisPos
)

1092 
PSC_INST
 
g
;

1093 
BYTE
 
¤c_Œa™s
;

1094 
ULONG
 
de¡_Œa™s
;

1095 
šU£d
, 
outU£d
;

1096 
n_rows
;

1097 
WORD
 
wResuÉs
;

1099 
	`HANDLE_TO_PTR
 (
hXfÜm
, 
g
);

1100 
šU£d
 = 0;

1101 
outU£d
 = 0;

1105 ià(
g
->
nMÜeH–dOutRows
 > 0) {

1106 
	`memıy
 (
pbOuutBuf
,

1107 
g
->
­H–dOutRows
[g->
iNextH–dOutRow
],

1108 
g
->
out_row_nby‹s
);

1109 
g
->
nMÜeH–dOutRows
 -= 1;

1110 
g
->
iNextH–dOutRow
 += 1;

1111 
outU£d
 = 
g
->
out_row_nby‹s
;

1112 
fšish
;

1117 ià(
pbIÅutBuf
 =ğ
NULL
) {

1118 
	`PRINT
 (
	`_T
("scale_convert: Toldo flush.\n"), 0, 0);

1119 ià(
g
->
nMÜeFlush
 == 0)

1120 
fšish
;

1121 
g
->
nMÜeFlush
 -= 1;

1124 
šU£d
 = 
g
->
š_row_nby‹s
;

1128 
g
->
­H–dOutRows
[0] = 
pbOuutBuf
;

1129 
n_rows
 = 0;

1130 
¤c_Œa™s
 = 0;

1132 
g
->
image_ty³
) {

1133 
IM_BILEVEL
:

1134 ià(
g
->
ç¡
)

1135 
n_rows
 = 
	`bi_ç¡_row
 (
g
, 
pbIÅutBuf
, 
¤c_Œa™s
,

1136 
g
->
­H–dOutRows
, &
de¡_Œa™s
);

1138 
n_rows
 = 
	`bi_sÿË_row
 (
g
, 
pbIÅutBuf
, 
¤c_Œa™s
,

1139 
g
->
­H–dOutRows
, &
de¡_Œa™s
);

1142 
IM_GRAY
:

1143 
IM_COLOR
:

1144 
n_rows
 = 
	`cÚtÚe_sÿË_row
 (
g
, 
pbIÅutBuf
, g->
­H–dOutRows
);

1148 
	`INSURE
 (
n_rows
 <ğ
g
->
nMaxOutRows
);

1149 ià(
n_rows
 > 0) {

1150 
g
->
nMÜeH–dOutRows
 = 
n_rows
 - 1;

1151 
g
->
iNextH–dOutRow
 = 1;

1152 
outU£d
 = 
g
->
out_row_nby‹s
;

1157 
fšish
:

1159 *
pdwIÅutU£d
 = (
DWORD
)
šU£d
;

1160 
g
->
dwInNextPos
 +ğ(
DWORD
)
šU£d
;

1161 *
pdwIÅutNextPos
 = 
g
->
dwInNextPos
;

1163 *
pdwOuutU£d
 = (
DWORD
)
outU£d
;

1164 *
pdwOuutThisPos
 = 
g
->
dwOutNextPos
;

1165 
g
->
dwOutNextPos
 +ğ(
DWORD
)
outU£d
;

1167 
wResuÉs
 = ( 
šU£d
>0 ? 
IP_CONSUMED_ROW
 : 0)

1168 | (
outU£d
>0 ? 
IP_PRODUCED_ROW
 : 0)

1169 | (
g
->
nMÜeH–dOutRows
==0 ? 
IP_READY_FOR_DATA
 : 0)

1170 | (
pbIÅutBuf
==
NULL
 &&

1171 
g
->
nMÜeFlush
==0 &&

1172 
g
->
nMÜeH–dOutRows
==0 ? 
IP_DONE
 : 0);

1173  
wResuÉs
;

1175 
çl_”rÜ
:

1176  
IP_FATAL_ERROR
;

1177 
	}
}

1187 
WORD
 
	$sÿË_š£¹edD©a
 (

1188 
IP_XFORM_HANDLE
 
hXfÜm
,

1189 
DWORD
 
dwNumBy‹s
)

1191 
	`çlB»akPošt
 ();

1192  
IP_FATAL_ERROR
;

1193 
	}
}

1203 
WORD
 
	$sÿË_ÃwPage
 (

1204 
IP_XFORM_HANDLE
 
hXfÜm
)

1206 
PSC_INST
 
g
;

1208 
	`HANDLE_TO_PTR
 (
hXfÜm
, 
g
);

1210  
IP_DONE
;

1212 
çl_”rÜ
:

1213  
IP_FATAL_ERROR
;

1215 
	}
}

1225 
WORD
 
	$sÿË_şo£XfÜm
 (
IP_XFORM_HANDLE
 
hXfÜm
)

1227 
PSC_INST
 
g
;

1228 
i
;

1230 
	`HANDLE_TO_PTR
 (
hXfÜm
, 
g
);

1232 
g
->
image_ty³
) {

1233 
IM_BILEVEL
:

1234 ià(
g
->
ç¡
è
	`bi_ç¡_şo£
 (g);

1235 
	`bi_sÿË_şo£
 (
g
);

1238 
IM_GRAY
:

1239 
IM_COLOR
:

1240 
	`cÚtÚe_sÿË_şo£
 (
g
);

1244 
i
=1; i<
g
->
nMaxOutRows
; i++)

1245 
	`IP_MEM_FREE
 (
g
->
­H–dOutRows
[
i
]);

1247 
g
->
dwV®idChk
 = 0;

1248 
	`IP_MEM_FREE
 (
g
);

1250  
IP_DONE
;

1252 
çl_”rÜ
:

1253  
IP_FATAL_ERROR
;

1254 
	}
}

1264 
IP_XFORM_TBL
 
	gsÿËTbl
 = {

1265 
sÿË_İ’XfÜm
,

1266 
sÿË_£tDeçuÉIÅutT¿™s
,

1267 
sÿË_£tXfÜmS³c
,

1268 
sÿË_g‘H—d”BufSize
,

1269 
sÿË_g‘Aùu®T¿™s
,

1270 
sÿË_g‘Aùu®BufSizes
,

1271 
sÿË_cÚv”t
,

1272 
sÿË_ÃwPage
,

1273 
sÿË_š£¹edD©a
,

1274 
sÿË_şo£XfÜm


	@ip/xskel.c

82 
	~"hp.h
"

83 
	~"defs.h
"

84 
	~"¡ršg.h
"

88 
	~"¡dio.h
"

89 
	~<tch¬.h
>

90 
	#PRINT
(
msg
,
¬g1
,
¬g2
) \

91 
	`_á´štf
(
¡d”r
, 
msg
, ()
¬g1
, ()
¬g2
)

	)

93 
	#PRINT
(
msg
,
¬g1
,
¬g2
)

	)

96 
	#CHECK_VALUE
 0x4ba1daû

	)

98 #ifdeà
EXPORT_TRANSFORM


99 
	#FUNC_STATUS
 
	`__deş¥ec
 (
dÎexpÜt
)

	)

101 
	#FUNC_STATUS
 

	)

105 
IP_IMAGE_TRAITS
 
	mŒa™s
;

106 
DWORD
 
	mdwBy‹sP”Row
;

107 
DWORD
 
	mdwRowsDÚe
;

108 
DWORD
 
	mdwInNextPos
;

109 
DWORD
 
	mdwOutNextPos
;

110 
DWORD
 
	mdwV®idChk
;

111 } 
	tSKEL_INST
, *
	tPSKEL_INST
;

128 
FUNC_STATUS
 
WORD
 
	$sk–_İ’XfÜm
 (

129 
IP_XFORM_HANDLE
 *
pXfÜm
)

131 
PSKEL_INST
 
g
;

133 
	`INSURE
 (
pXfÜm
 !ğ
NULL
);

134 
	`IP_MEM_ALLOC
 ((
SKEL_INST
), 
g
);

135 *
pXfÜm
 = 
g
;

136 
	`mem£t
 (
g
, 0, (
SKEL_INST
));

137 
g
->
dwV®idChk
 = 
CHECK_VALUE
;

138  
IP_DONE
;

140 
çl_”rÜ
:

141  
IP_FATAL_ERROR
;

142 
	}
}

161 
FUNC_STATUS
 
WORD
 
	$sk–_£tDeçuÉIÅutT¿™s
 (

162 
IP_XFORM_HANDLE
 
hXfÜm
,

163 
PIP_IMAGE_TRAITS
 
pT¿™s
)

165 
PSKEL_INST
 
g
;

167 
	`HANDLE_TO_PTR
 (
hXfÜm
, 
g
);

170 
	`INSURE
 (
pT¿™s
->
iPix–sP”Row
>0 &&…T¿™s->
iB™sP”Pix–
>0);

171 
g
->
Œa™s
 = *
pT¿™s
;

172 
g
->
dwBy‹sP”Row
 = (g->
Œa™s
.
iPix–sP”Row
*g->Œa™s.
iB™sP”Pix–
 + 7) / 8;

173  
IP_DONE
;

175 
çl_”rÜ
:

176  
IP_FATAL_ERROR
;

177 
	}
}

187 
FUNC_STATUS
 
WORD
 
	$sk–_£tXfÜmS³c
 (

188 
IP_XFORM_HANDLE
 
hXfÜm
,

189 
DWORD_OR_PVOID
 
aXfÜmInfo
[])

191 
PSKEL_INST
 
g
;

193 
	`HANDLE_TO_PTR
 (
hXfÜm
, 
g
);

200  
IP_DONE
;

202 
çl_”rÜ
:

203  
IP_FATAL_ERROR
;

204 
	}
}

214 
FUNC_STATUS
 
WORD
 
	$sk–_g‘H—d”BufSize
 (

215 
IP_XFORM_HANDLE
 
hXfÜm
,

216 
DWORD
 *
pdwInBufL’
)

219 *
pdwInBufL’
 = 0;

220  
IP_DONE
;

221 
	}
}

231 
FUNC_STATUS
 
WORD
 
	$sk–_g‘Aùu®T¿™s
 (

232 
IP_XFORM_HANDLE
 
hXfÜm
,

233 
DWORD
 
dwIÅutAva
,

234 
PBYTE
 
pbIÅutBuf
,

235 
PDWORD
 
pdwIÅutU£d
,

236 
PDWORD
 
pdwIÅutNextPos
,

237 
PIP_IMAGE_TRAITS
 
pInT¿™s
,

238 
PIP_IMAGE_TRAITS
 
pOutT¿™s
)

240 
PSKEL_INST
 
g
;

242 
	`HANDLE_TO_PTR
 (
hXfÜm
, 
g
);

245 *
pdwIÅutU£d
 = 0;

246 *
pdwIÅutNextPos
 = 0;

247 
g
->
dwInNextPos
 = 0;

249 *
pInT¿™s
 = 
g
->
Œa™s
;

250 *
pOutT¿™s
 = 
g
->
Œa™s
;

252  
IP_DONE
 | 
IP_READY_FOR_DATA
;

254 
çl_”rÜ
:

255  
IP_FATAL_ERROR
;

256 
	}
}

266 
FUNC_STATUS
 
WORD
 
	$sk–_g‘Aùu®BufSizes
 (

267 
IP_XFORM_HANDLE
 
hXfÜm
,

268 
PDWORD
 
pdwMšInBufL’
,

269 
PDWORD
 
pdwMšOutBufL’
)

271 
PSKEL_INST
 
g
;

273 
	`HANDLE_TO_PTR
 (
hXfÜm
, 
g
);

275 *
pdwMšInBufL’
 = *
pdwMšOutBufL’
 = 
g
->
dwBy‹sP”Row
;

276  
IP_DONE
;

278 
çl_”rÜ
:

279  
IP_FATAL_ERROR
;

280 
	}
}

290 
FUNC_STATUS
 
WORD
 
	$sk–_cÚv”t
 (

291 
IP_XFORM_HANDLE
 
hXfÜm
,

292 
DWORD
 
dwIÅutAva
,

293 
PBYTE
 
pbIÅutBuf
,

294 
PDWORD
 
pdwIÅutU£d
,

295 
PDWORD
 
pdwIÅutNextPos
,

296 
DWORD
 
dwOuutAva
,

297 
PBYTE
 
pbOuutBuf
,

298 
PDWORD
 
pdwOuutU£d
,

299 
PDWORD
 
pdwOuutThisPos
)

301 
PSKEL_INST
 
g
;

302 
nBy‹s
;

303 
PBYTE
 
pIn
, 
pOut
;

305 
	`HANDLE_TO_PTR
 (
hXfÜm
, 
g
);

309 ià(
pbIÅutBuf
 =ğ
NULL
) {

310 
	`PRINT
 (
	`_T
("skel_convert: Toldo flush.\n"), 0, 0);

311 *
pdwIÅutU£d
 = *
pdwOuutU£d
 = 0;

312 *
pdwIÅutNextPos
 = 
g
->
dwInNextPos
;

313 *
pdwOuutThisPos
 = 
g
->
dwOutNextPos
;

314  
IP_DONE
;

319 
nBy‹s
 = 
g
->
dwBy‹sP”Row
;

320 
	`INSURE
 (
dwIÅutAva
 >ğ(
DWORD
)
nBy‹s
 );

321 
	`INSURE
 (
dwOuutAva
 >ğ(
DWORD
)
nBy‹s
);

323 
pIn
 = 
pbIÅutBuf
;

324 
pOut
 = 
pbOuutBuf
;

329 
	`memıy
(
pOut
,
pIn
,
nBy‹s
);

331 *
pdwIÅutU£d
 = 
nBy‹s
;

332 
g
->
dwInNextPos
 +ğ
nBy‹s
;

333 *
pdwIÅutNextPos
 = 
g
->
dwInNextPos
;

335 *
pdwOuutU£d
 = 
nBy‹s
;

336 *
pdwOuutThisPos
 = 
g
->
dwOutNextPos
;

337 
g
->
dwOutNextPos
 +ğ
nBy‹s
;

339 
g
->
dwRowsDÚe
 += 1;

341  
IP_CONSUMED_ROW
 | 
IP_PRODUCED_ROW
 | 
IP_READY_FOR_DATA
;

343 
çl_”rÜ
:

344  
IP_FATAL_ERROR
;

345 
	}
}

355 
FUNC_STATUS
 
WORD
 
	$sk–_š£¹edD©a
 (

356 
IP_XFORM_HANDLE
 
hXfÜm
,

357 
DWORD
 
dwNumBy‹s
)

359 
	`çlB»akPošt
 ();

360  
IP_FATAL_ERROR
;

361 
	}
}

371 
FUNC_STATUS
 
WORD
 
	$sk–_ÃwPage
 (

372 
IP_XFORM_HANDLE
 
hXfÜm
)

374 
PSKEL_INST
 
g
;

376 
	`HANDLE_TO_PTR
 (
hXfÜm
, 
g
);

378  
IP_DONE
;

380 
çl_”rÜ
:

381  
IP_FATAL_ERROR
;

383 
	}
}

393 
FUNC_STATUS
 
WORD
 
	$sk–_şo£XfÜm
 (
IP_XFORM_HANDLE
 
hXfÜm
)

395 
PSKEL_INST
 
g
;

397 
	`HANDLE_TO_PTR
 (
hXfÜm
, 
g
);

399 
g
->
dwV®idChk
 = 0;

400 
	`IP_MEM_FREE
 (
g
);

402  
IP_DONE
;

404 
çl_”rÜ
:

405  
IP_FATAL_ERROR
;

406 
	}
}

415 #ifdeà
EXPORT_TRANSFORM


416 
	$__deş¥ec
 (
dÎexpÜt
)

418 
IP_XFORM_TBL
 
sk–Tbl
 = {

419 
sk–_İ’XfÜm
,

420 
sk–_£tDeçuÉIÅutT¿™s
,

421 
sk–_£tXfÜmS³c
,

422 
sk–_g‘H—d”BufSize
,

423 
sk–_g‘Aùu®T¿™s
,

424 
sk–_g‘Aùu®BufSizes
,

425 
sk–_cÚv”t
,

426 
sk–_ÃwPage
,

427 
sk–_š£¹edD©a
,

428 
sk–_şo£XfÜm


429 
	}
};

440 #ifdeà
EXPORT_TRANSFORM


441 
	$EXPORT
(
WORD
è
	$G‘XfÜmTabË
 (
LPIP_XFORM_TBL
 
pXfÜm
)

443 
WORD
 
wR‘
 = 
IP_DONE
;

445 ià(
pXfÜm
)

447 *
pXfÜm
 = 
şrm­Tbl
;

451 
wR‘
 = 
IP_FATAL_ERROR
;

454  
wR‘
;

455 
	}
}

	@ip/xtable.c

127 
	~"hp.h
"

128 
	~"defs.h
"

129 
	~"¡ršg.h
"

130 
	~"m©h.h
"

134 
	~"¡dio.h
"

135 
	~<tch¬.h
>

137 
	#PRINT
(
msg
,
¬g1
,
¬g2
) \

138 
	`_á´štf
(
¡d”r
, 
msg
, ()
¬g1
, ()
¬g2
)

	)

140 
	#PRINT
(
msg
,
¬g1
,
¬g2
)

	)

143 
	#CHECK_VALUE
 0x4ba1daû

	)

147 
IP_IMAGE_TRAITS
 
	mŒa™s
;

148 
BYTE
 
	mbWhich
;

149 
BYTE
 
	mbTabËs
[3][256];

150 
WORD
 *
	mpwTabËs
[3];

151 
BOOL
 
	mbBigTabË
;

152 
	mnTabËs
;

153 
DWORD
 
	mdwBy‹sP”Row
;

154 
DWORD
 
	mdwRowsDÚe
;

155 
DWORD
 
	mdwInNextPos
;

156 
DWORD
 
	mdwOutNextPos
;

157 
DWORD
 
	mdwV®idChk
;

158 } 
	tTBL_INST
, *
	tPTBL_INST
;

162 
	mTBL_USER
,

163 
	mTBL_PASS_THRU
,

164 
	mTBL_GAMMA
,

165 
	mTBL_THRESHOLD
,

166 
	mTBL_MIRROR
,

167 
	mTBL_USER_THREE
,

168 
	mTBL_BW_CLIP


169 } 
	tTABLE_TYPE
;

173 
BOOL
 
	$g’”©eTabË
 (

174 
PTBL_INST
 
g
,

175 
DWORD_OR_PVOID
 
aXfÜmInfo
[])

177 
IP_TABLE_TYPE
 
which
;

178 
DWORD
 
dw·¿m
;

179 
PVOID
 
pv·¿m
;

180 
æ·¿m
;

181 
PBYTE
 
pTabË
;

182 
PWORD
 
pwTabË
;

183 
nTabË
;

185 
g
->
nTabËs
 = 1;

186 
g
->
bBigTabË
 = 
FALSE
;

187 
pTabË
 = 
g
->
bTabËs
[0];

188 
dw·¿m
 = 
aXfÜmInfo
[
IP_TABLE_OPTION
].
dwÜd
;

189 
pv·¿m
 = 
aXfÜmInfo
[
IP_TABLE_OPTION
].
pvoid
;

190 
æ·¿m
 = 
aXfÜmInfo
[
IP_TABLE_OPTION
].
æ
;

191 
which
 = (
IP_TABLE_TYPE
)
aXfÜmInfo
[
IP_TABLE_WHICH
].
dwÜd
;

192 
g
->
bWhich
 = (
BYTE
)
which
;

194 
which
)

196 
IP_TABLE_USER
:

197 ià(
pv·¿m
 == 0)

198  
FALSE
;

199 
	`memıy
 (
pTabË
, (
PBYTE
)
pv·¿m
, 256);

202 
IP_TABLE_USER_WORD
:

203 ià(
pv·¿m
 == 0)

204  
FALSE
;

205 
	`IP_MEM_ALLOC
 (4097*(
WORD
), 
pwTabË
);

206 
g
->
pwTabËs
[0] = 
pwTabË
;

207 
	`memıy
 (
pwTabË
, (
PWORD
)
pv·¿m
, 4096*(
WORD
));

208 
pwTabË
[4096] =…wTable[4095];

209 
g
->
bBigTabË
 = 
TRUE
;

212 
IP_TABLE_USER_THREE
:

213 ià(
aXfÜmInfo
[
IP_TABLE_COLOR_1
].
pvoid
==0 ||

214 
aXfÜmInfo
[
IP_TABLE_COLOR_2
].
pvoid
==0 ||

215 
aXfÜmInfo
[
IP_TABLE_COLOR_3
].
pvoid
==0)

216  
FALSE
;

217 
	`memıy
 (
g
->
bTabËs
[0], (
PBYTE
)
aXfÜmInfo
[
IP_TABLE_COLOR_1
].
pvoid
, 256);

218 
	`memıy
 (
g
->
bTabËs
[1], (
PBYTE
)
aXfÜmInfo
[
IP_TABLE_COLOR_2
].
pvoid
, 256);

219 
	`memıy
 (
g
->
bTabËs
[2], (
PBYTE
)
aXfÜmInfo
[
IP_TABLE_COLOR_3
].
pvoid
, 256);

220 
g
->
nTabËs
 = 3;

223 
IP_TABLE_USER_THREE_WORD
:

224 ià(
aXfÜmInfo
[
IP_TABLE_COLOR_1
].
pvoid
==0 ||

225 
aXfÜmInfo
[
IP_TABLE_COLOR_2
].
pvoid
==0 ||

226 
aXfÜmInfo
[
IP_TABLE_COLOR_3
].
pvoid
==0)

227  
FALSE
;

229 
nTabË
=0;‚Table<3;‚Table++) {

230 
	`IP_MEM_ALLOC
 (4097*(
WORD
), 
pwTabË
);

231 
g
->
pwTabËs
[
nTabË
] = 
pwTabË
;

232 
	`memıy
 (
pwTabË
, (
PWORD
)
aXfÜmInfo
[
IP_TABLE_COLOR_1
+
nTabË
].
pvoid
, 4096*(
WORD
));

233 
pwTabË
[4096] =…wTable[4095];

235 
g
->
nTabËs
 = 3;

236 
g
->
bBigTabË
 = 
TRUE
;

239 
IP_TABLE_PASS_THRU
:

241 
i
;

243 
i
=0; i<=255; i++)

244 
pTabË
[
i
] = i;

248 
IP_TABLE_GAMMA
:

250 
šdex
;

251 
fv®
;

252 
gamma
;

253 
gamv®
;

255 
gamma
 = ()
æ·¿m
 / ()(1L<<16);

256 ià(
gamma
<=0.0f || gamma>=10.0f)

257  
FALSE
;

258 
gamma
 = 1.0f / gamma;

260 ià(
g
->
Œa™s
.
iB™sP”Pix–
==16 || g->traits.iBitsPerPixel==48) {

261 
WORD
 *
pwTabË
;

262 
	`IP_MEM_ALLOC
 (4097*(
WORD
), 
pwTabË
);

263 
g
->
pwTabËs
[0] = 
pwTabË
;

265 
šdex
=0; index<=4095u; index++) {

266 
fv®
 = ()
šdex
 / 4095.0f;

267 
gamv®
 = 65535.0à* ()
	`pow
(
fv®
, 
gamma
);

268 
pwTabË
[
šdex
] = (
WORD
)(
gamv®
 + 0.5f);

271 
pwTabË
[4096] =…wTable[4095];

272 
g
->
bBigTabË
 = 
TRUE
;

274 
šdex
=0; index<=255u; index++) {

275 
fv®
 = ()
šdex
 / 255.0f;

276 
gamv®
 = 255.0à* ()
	`pow
(
fv®
, 
gamma
);

277 
pTabË
[
šdex
] = (
BYTE
)(
gamv®
 + 0.5f);

283 
IP_TABLE_THRESHOLD
:

284 ià(
dw·¿m
<1 || dwparam>255)

285  
FALSE
;

286 
	`mem£t
 (
pTabË
, 0, 
dw·¿m
);

287 
	`mem£t
 (
pTabË
+
dw·¿m
, 255, 256-dwparam);

290 
IP_TABLE_MIRROR
:

292 
UINT
 
šdex
, 
mask
;

294 
šdex
=0; index<=255; index++) {

295 
mask
=0x01u; mask<=0x80u; mask<<=1) {

296 
pTabË
[
šdex
] <<= 1;

297 ià(
šdex
 & 
mask
)

298 
pTabË
[
šdex
] += 1;

304 
IP_TABLE_BW_CLIP
:

306 
DWORD
 
nBÏck
, 
nWh™e
, 
nMid
, 
¦İeMid
, 
posMid
, 
šdex
;

308 
nBÏck
 = 
dw·¿m
 >> 16;

309 
nWh™e
 = 
dw·¿m
 & 0xFFFFu;

311 ià(
nBÏck
+
nWh™e
 > 256)

312  
FALSE
;

314 
šdex
=0; index<
nBÏck
; index++)

315 
pTabË
[
šdex
] = 0;

317 
šdex
=256-
nWh™e
; index<=255; index++)

318 
pTabË
[
šdex
] = 255;

320 
nMid
 = 256 - 
nBÏck
 - 
nWh™e
;

321 
¦İeMid
 = (255ul<<16è/ (
nMid
 + 1);

322 
posMid
 = 0x8000u;

324 
šdex
=
nBÏck
; index<256-
nWh™e
; index++) {

325 
posMid
 +ğ
¦İeMid
;

326 
pTabË
[
šdex
] = (
BYTE
)(
posMid
 >> 16);

332  
FALSE
;

335  
TRUE
;

337 
çl_”rÜ
:

338  
FALSE
;

339 
	}
}

356 
WORD
 
	$bË_İ’XfÜm
 (

357 
IP_XFORM_HANDLE
 *
pXfÜm
)

359 
PTBL_INST
 
g
;

361 
	`INSURE
 (
pXfÜm
 !ğ
NULL
);

362 
	`IP_MEM_ALLOC
 ((
TBL_INST
), 
g
);

363 *
pXfÜm
 = 
g
;

364 
	`mem£t
 (
g
, 0, (
TBL_INST
));

365 
g
->
dwV®idChk
 = 
CHECK_VALUE
;

366  
IP_DONE
;

368 
çl_”rÜ
:

369  
IP_FATAL_ERROR
;

370 
	}
}

389 
WORD
 
	$bË_£tDeçuÉIÅutT¿™s
 (

390 
IP_XFORM_HANDLE
 
hXfÜm
,

391 
PIP_IMAGE_TRAITS
 
pT¿™s
)

393 
PTBL_INST
 
g
;

395 
	`HANDLE_TO_PTR
 (
hXfÜm
, 
g
);

398 
	`INSURE
 (
pT¿™s
->
iPix–sP”Row
>0 &&…T¿™s->
iB™sP”Pix–
>0);

399 
g
->
Œa™s
 = *
pT¿™s
;

400 
g
->
dwBy‹sP”Row
 = (g->
Œa™s
.
iPix–sP”Row
*g->Œa™s.
iB™sP”Pix–
 + 7) / 8;

401  
IP_DONE
;

403 
çl_”rÜ
:

404  
IP_FATAL_ERROR
;

405 
	}
}

415 
WORD
 
	$bË_£tXfÜmS³c
 (

416 
IP_XFORM_HANDLE
 
hXfÜm
,

417 
DWORD_OR_PVOID
 
aXfÜmInfo
[])

419 
PTBL_INST
 
g
;

421 
	`HANDLE_TO_PTR
 (
hXfÜm
, 
g
);

423 ià(! 
	`g’”©eTabË
(
g
,
aXfÜmInfo
))

424 
çl_”rÜ
;

425  
IP_DONE
;

427 
çl_”rÜ
:

428  
IP_FATAL_ERROR
;

429 
	}
}

439 
WORD
 
	$bË_g‘H—d”BufSize
 (

440 
IP_XFORM_HANDLE
 
hXfÜm
,

441 
DWORD
 *
pdwInBufL’
)

444 *
pdwInBufL’
 = 0;

445  
IP_DONE
;

446 
	}
}

456 
WORD
 
	$bË_g‘Aùu®T¿™s
 (

457 
IP_XFORM_HANDLE
 
hXfÜm
,

458 
DWORD
 
dwIÅutAva
,

459 
PBYTE
 
pbIÅutBuf
,

460 
PDWORD
 
pdwIÅutU£d
,

461 
PDWORD
 
pdwIÅutNextPos
,

462 
PIP_IMAGE_TRAITS
 
pIÁ¿™s
,

463 
PIP_IMAGE_TRAITS
 
pOutT¿™s
)

465 
PTBL_INST
 
g
;

467 
	`HANDLE_TO_PTR
 (
hXfÜm
, 
g
);

470 *
pdwIÅutU£d
 = 0;

471 *
pdwIÅutNextPos
 = 0;

473 *
pIÁ¿™s
 = 
g
->
Œa™s
;

474 *
pOutT¿™s
 = 
g
->
Œa™s
;

476  
IP_DONE
 | 
IP_READY_FOR_DATA
;

478 
çl_”rÜ
:

479  
IP_FATAL_ERROR
;

480 
	}
}

490 
WORD
 
	$bË_g‘Aùu®BufSizes
 (

491 
IP_XFORM_HANDLE
 
hXfÜm
,

492 
PDWORD
 
pdwMšInBufL’
,

493 
PDWORD
 
pdwMšOutBufL’
)

495 
PTBL_INST
 
g
;

497 
	`HANDLE_TO_PTR
 (
hXfÜm
, 
g
);

499 *
pdwMšInBufL’
 = *
pdwMšOutBufL’
 = 
g
->
dwBy‹sP”Row
;

500  
IP_DONE
;

502 
çl_”rÜ
:

503  
IP_FATAL_ERROR
;

504 
	}
}

514 
WORD
 
	$bË_cÚv”t
 (

515 
IP_XFORM_HANDLE
 
hXfÜm
,

516 
DWORD
 
dwIÅutAva
,

517 
PBYTE
 
pbIÅutBuf
,

518 
PDWORD
 
pdwIÅutU£d
,

519 
PDWORD
 
pdwIÅutNextPos
,

520 
DWORD
 
dwOuutAva
,

521 
PBYTE
 
pbOuutBuf
,

522 
PDWORD
 
pdwOuutU£d
,

523 
PDWORD
 
pdwOuutThisPos
)

525 
PTBL_INST
 
g
;

526 
nBy‹s
, 
nTabË
;

527 
PBYTE
 
pIn
, 
pOut
, 
pOutAá”
;

529 
	`HANDLE_TO_PTR
 (
hXfÜm
, 
g
);

533 ià(
pbIÅutBuf
 =ğ
NULL
) {

534 
	`PRINT
 (
	`_T
("table_convert: Toldo flush.\n"), 0, 0);

535 *
pdwIÅutU£d
 = *
pdwOuutU£d
 = 0;

536 *
pdwIÅutNextPos
 = 
g
->
dwInNextPos
;

537 *
pdwOuutThisPos
 = 
g
->
dwOutNextPos
;

538  
IP_DONE
;

543 
nBy‹s
 = 
g
->
dwBy‹sP”Row
;

544 
	`INSURE
 (
dwIÅutAva
 >ğ(
DWORD
)
nBy‹s
);

545 
	`INSURE
 (
dwOuutAva
 >ğ(
DWORD
)
nBy‹s
);

547 
pIn
 = 
pbIÅutBuf
;

548 
pOut
 = 
pbOuutBuf
;

549 
pOutAá”
 = 
pOut
 + 
nBy‹s
;

551 ià(
g
->
bWhich
 =ğ
IP_TABLE_PASS_THRU
)

553 
	`memıy
 (
pOut
, 
pIn
, 
nBy‹s
);

555 ià(
g
->
Œa™s
.
iB™sP”Pix–
==16 || g->traits.iBitsPerPixel==48)

558 
x
, 
xHi
, 
y1
, 
y2
;

559 
WORD
 *
pwTabË
, *
pwIn
, *
pwOut
, *
pwOutAá”
;

560 
BYTE
 *
pbTabË
;

562 
pwIn
 = (
WORD
*)
pIn
;

563 
pwOut
 = (
WORD
*)
pOut
;

564 
pwOutAá”
 = (
WORD
*)
pOutAá”
;

566 ià(
g
->
bBigTabË
)

569 
pwOut
 < 
pwOutAá”
) {

570 
nTabË
=0;‚TabË<
g
->
nTabËs
;‚Table++) {

571 
pwTabË
 = 
g
->
pwTabËs
[
nTabË
];

572 
x
 = ()(*
pwIn
++);

573 
xHi
 = 
x
 >> 4;

574 
y1
 = ()
pwTabË
[
xHi
 ];

575 
y2
 = ()
pwTabË
[
xHi
+1];

577 *
pwOut
++ = (
WORD
)(((
y2
-
y1
)*(
x
&0x0f)>>4) + y1);

583 
pwOut
 < 
pwOutAá”
) {

584 
nTabË
=0;‚TabË<
g
->
nTabËs
;‚Table++) {

585 
pbTabË
 = 
g
->
bTabËs
[
nTabË
];

586 
x
 = ()(*
pwIn
++);

587 
xHi
 = 
x
 >> 8;

588 
y1
 = ()
pbTabË
[
xHi
];

589 
y2
 = ()
pbTabË
[
xHi
==255 ? 255 : xHi+1];

591 *
pwOut
++ = (
WORD
)((
y2
-
y1
)*(
x
&0x0ff) + (y1<<8));

598 ià(
g
->
bBigTabË
)

601 
pOut
 < 
pOutAá”
)

602 
nTabË
=0;‚TabË<
g
->
nTabËs
;‚Table++)

603 *
pOut
++ = (
BYTE
)(
g
->
pwTabËs
[
nTabË
][()(*
pIn
++)<<4] >> 8);

605 ià(
g
->
nTabËs
 == 3)

607 
pOut
 < 
pOutAá”
) {

609 
pOut
[0] = 
g
->
bTabËs
[0][
pIn
[0]];

610 
pOut
[1] = 
g
->
bTabËs
[1][
pIn
[1]];

611 
pOut
[2] = 
g
->
bTabËs
[2][
pIn
[2]];

612 
pOut
[3] = 
g
->
bTabËs
[0][
pIn
[3]];

613 
pOut
[4] = 
g
->
bTabËs
[1][
pIn
[4]];

614 
pOut
[5] = 
g
->
bTabËs
[2][
pIn
[5]];

616 
pIn
 += 6;

617 
pOut
 += 6;

622 
pOut
 < 
pOutAá”
) {

624 
pOut
[0] = 
g
->
bTabËs
[0][
pIn
[0]];

625 
pOut
[1] = 
g
->
bTabËs
[0][
pIn
[1]];

626 
pOut
[2] = 
g
->
bTabËs
[0][
pIn
[2]];

627 
pOut
[3] = 
g
->
bTabËs
[0][
pIn
[3]];

628 
pOut
[4] = 
g
->
bTabËs
[0][
pIn
[4]];

629 
pOut
[5] = 
g
->
bTabËs
[0][
pIn
[5]];

630 
pOut
[6] = 
g
->
bTabËs
[0][
pIn
[6]];

631 
pOut
[7] = 
g
->
bTabËs
[0][
pIn
[7]];

633 
pIn
 += 8;

634 
pOut
 += 8;

639 *
pdwIÅutU£d
 = 
nBy‹s
;

640 
g
->
dwInNextPos
 +ğ
nBy‹s
;

641 *
pdwIÅutNextPos
 = 
g
->
dwInNextPos
;

643 *
pdwOuutU£d
 = 
nBy‹s
;

644 *
pdwOuutThisPos
 = 
g
->
dwOutNextPos
;

645 
g
->
dwOutNextPos
 +ğ
nBy‹s
;

647 
g
->
dwRowsDÚe
 += 1;

649  
IP_CONSUMED_ROW
 | 
IP_PRODUCED_ROW
 | 
IP_READY_FOR_DATA
;

651 
çl_”rÜ
:

652  
IP_FATAL_ERROR
;

653 
	}
}

663 
WORD
 
	$bË_š£¹edD©a
 (

664 
IP_XFORM_HANDLE
 
hXfÜm
,

665 
DWORD
 
dwNumBy‹s
)

667 
	`çlB»akPošt
 ();

668  
IP_FATAL_ERROR
;

669 
	}
}

679 
WORD
 
	$bË_ÃwPage
 (

680 
IP_XFORM_HANDLE
 
hXfÜm
)

682 
PTBL_INST
 
g
;

684 
	`HANDLE_TO_PTR
 (
hXfÜm
, 
g
);

686  
IP_DONE
;

688 
çl_”rÜ
:

689  
IP_FATAL_ERROR
;

691 
	}
}

701 
WORD
 
	$bË_şo£XfÜm
 (
IP_XFORM_HANDLE
 
hXfÜm
)

703 
PTBL_INST
 
g
;

704 
i
;

706 
	`HANDLE_TO_PTR
 (
hXfÜm
, 
g
);

708 
i
=0; i<3; i++)

709 ià(
g
->
pwTabËs
[
i
] !ğ
NULL
)

710 
	`IP_MEM_FREE
 (
g
->
pwTabËs
[
i
]);

712 
g
->
dwV®idChk
 = 0;

713 
	`IP_MEM_FREE
 (
g
);

715  
IP_DONE
;

717 
çl_”rÜ
:

718  
IP_FATAL_ERROR
;

719 
	}
}

729 
IP_XFORM_TBL
 
	gbËTbl
 = {

730 
bË_İ’XfÜm
,

731 
bË_£tDeçuÉIÅutT¿™s
,

732 
bË_£tXfÜmS³c
,

733 
bË_g‘H—d”BufSize
,

734 
bË_g‘Aùu®T¿™s
,

735 
bË_g‘Aùu®BufSizes
,

736 
bË_cÚv”t
,

737 
bË_ÃwPage
,

738 
bË_š£¹edD©a
,

739 
bË_şo£XfÜm


	@ip/xthumb.c

97 
	~"hp.h
"

98 
	~"defs.h
"

99 
	~"¡ršg.h
"

103 
	~"¡dio.h
"

104 
	~<tch¬.h
>

106 
	#PRINT
(
msg
,
¬g1
,
¬g2
) \

107 
	`_á´štf
(
¡d”r
, 
msg
, ()
¬g1
, ()
¬g2
)

	)

109 
	#PRINT
(
msg
,
¬g1
,
¬g2
)

	)

112 
	#CHECK_VALUE
 0x4ba1daû

	)

116 
IP_IMAGE_TRAITS
 
	mšT¿™s
;

117 
	miFaùÜS³c
;

118 
WORD
 
	mwSÿË
;

119 
WORD
 
	mwP»Shiá
;

120 
DWORD
 
	mdwSumFac
;

121 
DWORD
 
	mdwOuutWidth
;

122 
DWORD
 
	mdwInRowBy‹s
;

123 
DWORD
 
	mdwOutRowBy‹s
;

124 
WORD
 
	mwMÜeRows2Sum
;

125 
PULONG
 
	mpulSums
;

126 
ULONG
 
	mulRowsIÅut
;

127 
ULONG
 
	mulRowsOuut
;

128 
DWORD
 
	mdwInNextPos
;

129 
DWORD
 
	mdwOutNextPos
;

130 
DWORD
 
	mdwV®idChk
;

131 } 
	tTN_INST
, *
	tPTN_INST
;

148 
WORD
 
	$thumb_İ’XfÜm
 (

149 
IP_XFORM_HANDLE
 *
pXfÜm
)

151 
PTN_INST
 
g
;

153 
	`INSURE
 (
pXfÜm
 !ğ
NULL
);

154 
	`IP_MEM_ALLOC
 ((
TN_INST
), 
g
);

155 *
pXfÜm
 = 
g
;

156 
	`mem£t
 (
g
, 0, (
TN_INST
));

157 
g
->
dwV®idChk
 = 
CHECK_VALUE
;

158  
IP_DONE
;

160 
çl_”rÜ
:

161  
IP_FATAL_ERROR
;

162 
	}
}

181 
WORD
 
	$thumb_£tDeçuÉIÅutT¿™s
 (

182 
IP_XFORM_HANDLE
 
hXfÜm
,

183 
PIP_IMAGE_TRAITS
 
pT¿™s
)

185 
PTN_INST
 
g
;

187 
	`HANDLE_TO_PTR
 (
hXfÜm
, 
g
);

189 
	`INSURE
 (
pT¿™s
->
iPix–sP”Row
 > 0);

190 
g
->
šT¿™s
 = *
pT¿™s
;

191  
IP_DONE
;

193 
çl_”rÜ
:

194  
IP_FATAL_ERROR
;

195 
	}
}

205 
WORD
 
	$thumb_£tXfÜmS³c
 (

206 
IP_XFORM_HANDLE
 
hXfÜm
,

207 
DWORD_OR_PVOID
 
aXfÜmInfo
[])

209 
PTN_INST
 
g
;

211 
	`HANDLE_TO_PTR
 (
hXfÜm
, 
g
);

212 
g
->
iFaùÜS³c
 = ()
aXfÜmInfo
[
IP_THUMB_SCALE_SPEC
].
dwÜd
;

213  
IP_DONE
;

215 
çl_”rÜ
:

216  
IP_FATAL_ERROR
;

217 
	}
}

227 
WORD
 
	$thumb_g‘H—d”BufSize
 (

228 
IP_XFORM_HANDLE
 
hXfÜm
,

229 
DWORD
 *
pdwInBufL’
)

232 *
pdwInBufL’
 = 0;

233  
IP_DONE
;

234 
	}
}

244 
WORD
 
	$thumb_g‘Aùu®T¿™s
 (

245 
IP_XFORM_HANDLE
 
hXfÜm
,

246 
DWORD
 
dwIÅutAva
,

247 
PBYTE
 
pbIÅutBuf
,

248 
PDWORD
 
pdwIÅutU£d
,

249 
PDWORD
 
pdwIÅutNextPos
,

250 
PIP_IMAGE_TRAITS
 
pInT¿™s
,

251 
PIP_IMAGE_TRAITS
 
pOutT¿™s
)

253 
PTN_INST
 
g
;

254 
N
;

255 
lMaxSum
;

256 
nBy‹s
;

258 
	`HANDLE_TO_PTR
 (
hXfÜm
, 
g
);

261 *
pdwIÅutU£d
 = 0;

262 *
pdwIÅutNextPos
 = 0;

265 ià(
g
->
iFaùÜS³c
 <= 0) {

266 
N
 = -(
g
->
iFaùÜS³c
);

272 
N
 = (
g
->
šT¿™s
.
iPix–sP”Row
 + g->
iFaùÜS³c
 - 1) / g->iFactorSpec;

275 ià(
N
 < 1) N = 1;

276 
g
->
wSÿË
 = 
N
;

279 
lMaxSum
 = ()
N
*N * (
g
->
šT¿™s
.
iB™sP”Pix–
==1 ? 1 : 255);

282 ià(
lMaxSum
 >ğ(1L<<28)è
g
->
wP»Shiá
 = 16;

283 ià(
lMaxSum
 >ğ(1L<<24)è
g
->
wP»Shiá
 = 12;

284 ià(
lMaxSum
 >ğ(1L<<20)è
g
->
wP»Shiá
 = 8;

285 ià(
lMaxSum
 >ğ(1L<<16)è
g
->
wP»Shiá
 = 4;

286 
g
->
wP»Shiá
 = 0;

289 
lMaxSum
 >>ğ
g
->
wP»Shiá
;

290 
	`INSURE
 (
lMaxSum
 < (1L<<16));

293 
g
->
dwSumFac
 = (
DWORD
)((255.0/()
lMaxSum
) * ()(1L<<16));

295 *
pInT¿™s
 = 
g
->
šT¿™s
;

296 *
pOutT¿™s
 = 
g
->
šT¿™s
;

298 ià(
pOutT¿™s
->
iB™sP”Pix–
 == 1)

299 
pOutT¿™s
->
iB™sP”Pix–
 = 8;

300 
pOutT¿™s
->
iPix–sP”Row
 = 
g
->
dwOuutWidth
 = 
pInT¿™s
->iPix–sP”Row / 
N
;

301 ià(
pOutT¿™s
->
lNumRows
 >= 0)

302 
pOutT¿™s
->
lNumRows
 /ğ
N
;

304 
g
->
wMÜeRows2Sum
 = 
N
;

305 
g
->
dwInRowBy‹s
 =

306 (
pInT¿™s
->
iPix–sP”Row
 *…InT¿™s->
iB™sP”Pix–
 + 7) / 8;

307 
g
->
dwOutRowBy‹s
 = g->
dwOuutWidth
 * 
pInT¿™s
->
iCompÚ’tsP”Pix–
;

309 
nBy‹s
 = 
g
->
dwOutRowBy‹s
 * (
ULONG
);

310 
	`IP_MEM_ALLOC
 (
nBy‹s
, 
g
->
pulSums
);

311 
	`mem£t
 (
g
->
pulSums
, 0, 
nBy‹s
);

313  
IP_DONE
 | 
IP_READY_FOR_DATA
;

315 
çl_”rÜ
:

316  
IP_FATAL_ERROR
;

317 
	}
}

327 
WORD
 
	$thumb_g‘Aùu®BufSizes
 (

328 
IP_XFORM_HANDLE
 
hXfÜm
,

329 
PDWORD
 
pdwMšInBufL’
,

330 
PDWORD
 
pdwMšOutBufL’
)

332 
PTN_INST
 
g
;

334 
	`HANDLE_TO_PTR
 (
hXfÜm
, 
g
);

335 *
pdwMšInBufL’
 = 
g
->
dwInRowBy‹s
;

336 *
pdwMšOutBufL’
 = 
g
->
dwOutRowBy‹s
;

337  
IP_DONE
;

339 
çl_”rÜ
:

340  
IP_FATAL_ERROR
;

341 
	}
}

351 
WORD
 
	$thumb_cÚv”t
 (

352 
IP_XFORM_HANDLE
 
hXfÜm
,

353 
DWORD
 
dwIÅutAva
,

354 
PBYTE
 
pbIÅutBuf
,

355 
PDWORD
 
pdwIÅutU£d
,

356 
PDWORD
 
pdwIÅutNextPos
,

357 
DWORD
 
dwOuutAva
,

358 
PBYTE
 
pbOuutBuf
,

359 
PDWORD
 
pdwOuutU£d
,

360 
PDWORD
 
pdwOuutThisPos
)

362 
PTN_INST
 
g
;

363 
PBYTE
 
pIn
, 
pOut
;

364 
BYTE
 
bMask
, 
bV®
=0;

365 
ULONG
 
ulSum
, 
sum0
, 
sum1
, 
sum2
;

366 
ULONG
 *
pulSum
, *
pulSumAá”
;

367 
UINT
 
u
;

368 
BOOL
 
fS’tRow
;

370 
	`HANDLE_TO_PTR
 (
hXfÜm
, 
g
);

371 
pulSumAá”
 = 
g
->
pulSums
 + g->
dwOutRowBy‹s
;

375 ià(
pbIÅutBuf
 =ğ
NULL
) {

376 
	`PRINT
 (
	`_T
("thumb_convert: Toldo flush.\n"), 0, 0);

377 *
pdwIÅutU£d
 = *
pdwOuutU£d
 = 0;

378 *
pdwIÅutNextPos
 = 
g
->
dwInNextPos
;

379 *
pdwOuutThisPos
 = 
g
->
dwOutNextPos
;

380  
IP_DONE
;

385 
	`INSURE
 (
dwIÅutAva
 >ğ
g
->
dwInRowBy‹s
);

386 
pIn
 = 
pbIÅutBuf
;

388 
g
->
šT¿™s
.
iB™sP”Pix–
) {

390 
bMask
 = 0;

391 
pulSum
=
g
->
pulSums
;…ulSum<
pulSumAá”
;…ulSum++) {

392 
ulSum
 = *
pulSum
;

393 
u
=
g
->
wSÿË
; u>0; u--) {

394 ià(
bMask
 == 0) {

395 
bMask
 = 0x80u;

396 
bV®
 = *
pIn
++;

398 ià((
bMask
 & 
bV®
) == 0) {

401 
ulSum
 += 1;

403 
bMask
 >>= 1;

405 *
pulSum
 = 
ulSum
;

410 
pulSum
=
g
->
pulSums
;…ulSum<
pulSumAá”
;…ulSum++) {

411 
ulSum
 = *
pulSum
;

412 
u
=
g
->
wSÿË
; u>0; u--)

413 
ulSum
 +ğ(
ULONG
)(*
pIn
++);

414 *
pulSum
 = 
ulSum
;

419 
pulSum
=
g
->
pulSums
;…ulSum<
pulSumAá”
;…ulSum+=3) {

420 
sum0
 = 
pulSum
[0];

421 
sum1
 = 
pulSum
[1];

422 
sum2
 = 
pulSum
[2];

423 
u
=
g
->
wSÿË
; u>0; u--) {

424 
sum0
 +ğ(
ULONG
)(*
pIn
++);

425 
sum1
 +ğ(
ULONG
)(*
pIn
++);

426 
sum2
 +ğ(
ULONG
)(*
pIn
++);

428 
pulSum
[0] = 
sum0
;

429 
pulSum
[1] = 
sum1
;

430 
pulSum
[2] = 
sum2
;

435 *
pdwIÅutU£d
 = 
g
->
dwInRowBy‹s
;

436 
g
->
dwInNextPos
 +ğg->
dwInRowBy‹s
;

437 *
pdwIÅutNextPos
 = 
g
->
dwInNextPos
;

438 
g
->
ulRowsIÅut
 += 1;

442 *
pdwOuutThisPos
 = 
g
->
dwOutNextPos
;

443 
g
->
wMÜeRows2Sum
 -= 1;

445 ià(
g
->
wMÜeRows2Sum
 > 0) {

446 
fS’tRow
 = 
FALSE
;

447 *
pdwOuutU£d
 = 0;

449 
g
->
wMÜeRows2Sum
 = g->
wSÿË
;

450 
fS’tRow
 = 
TRUE
;

451 
g
->
ulRowsOuut
 += 1;

452 
	`INSURE
 (
dwOuutAva
 >ğ
g
->
dwOutRowBy‹s
);

453 *
pdwOuutU£d
 = 
g
->
dwOutRowBy‹s
;

454 
g
->
dwOutNextPos
 +ğg->
dwOutRowBy‹s
;

456 
pulSum
 = 
g
->
pulSums
;

457 
pOut
 = 
pbOuutBuf
;

458 
pulSum
=
g
->
pulSums
;…ulSum<
pulSumAá”
;…ulSum++) {

459 *
pOut
++ = (
BYTE
)((*
pulSum
 >> 
g
->
wP»Shiá
è* g->
dwSumFac
 >> 16);

462 
	`mem£t
 (
g
->
pulSums
, 0, g->
dwOutRowBy‹s
*(
ULONG
));

467  
IP_CONSUMED_ROW
 |

468 
IP_READY_FOR_DATA
 |

469 (
fS’tRow
 ? 
IP_PRODUCED_ROW
 : 0);

471 
çl_”rÜ
:

472  
IP_FATAL_ERROR
;

473 
	}
}

483 
WORD
 
	$thumb_š£¹edD©a
 (

484 
IP_XFORM_HANDLE
 
hXfÜm
,

485 
DWORD
 
dwNumBy‹s
)

487 
	`çlB»akPošt
 ();

488  
IP_FATAL_ERROR
;

489 
	}
}

499 
WORD
 
	$thumb_ÃwPage
 (

500 
IP_XFORM_HANDLE
 
hXfÜm
)

502 
PTN_INST
 
g
;

504 
	`HANDLE_TO_PTR
 (
hXfÜm
, 
g
);

505  
IP_DONE
;

507 
çl_”rÜ
:

508  
IP_FATAL_ERROR
;

510 
	}
}

520 
WORD
 
	$thumb_şo£XfÜm
 (
IP_XFORM_HANDLE
 
hXfÜm
)

522 
PTN_INST
 
g
;

524 
	`HANDLE_TO_PTR
 (
hXfÜm
, 
g
);

526 ià(
g
->
pulSums
 !ğ
NULL
)

527 
	`IP_MEM_FREE
 (
g
->
pulSums
);

528 
g
->
dwV®idChk
 = 0;

529 
	`IP_MEM_FREE
 (
g
);

531  
IP_DONE
;

533 
çl_”rÜ
:

534  
IP_FATAL_ERROR
;

535 
	}
}

545 
IP_XFORM_TBL
 
	gthumbTbl
 = {

546 
thumb_İ’XfÜm
,

547 
thumb_£tDeçuÉIÅutT¿™s
,

548 
thumb_£tXfÜmS³c
,

549 
thumb_g‘H—d”BufSize
,

550 
thumb_g‘Aùu®T¿™s
,

551 
thumb_g‘Aùu®BufSizes
,

552 
thumb_cÚv”t
,

553 
thumb_ÃwPage
,

554 
thumb_š£¹edD©a
,

555 
thumb_şo£XfÜm


	@ip/xtiff.c

92 
	~"¡dio.h
"

93 
	~"as£¹.h
"

94 
	~"hp.h
"

95 
	~"defs.h
"

96 
	~"¡ršg.h
"

100 
	~"¡dio.h
"

101 
	~<tch¬.h
>

103 
	#PRINT
(
msg
,
¬g1
,
¬g2
) \

104 
	`_á´štf
(
¡d”r
, 
msg
, ()
¬g1
, ()
¬g2
)

	)

106 
	#PRINT
(
msg
,
¬g1
,
¬g2
)

	)

109 
	#CHECK_VALUE
 0x1û5ÿ7e

	)

123 
IP_IMAGE_TRAITS
 
	mŒa™s
;

124 
	miB™sP”Sam¶e
;

125 
BOOL
 
	mbBy‹Sw­
;

126 
	msFeP©h
[200];

127 
FILE
 *
	mfeOut
;

128 
DWORD
 
	mdwRawRowBy‹s
;

129 
DWORD
 
	mdwRowsDÚe
;

130 
DWORD
 
	mdwV®idChk
;

131 
DWORD
 
	mdwInNextPos
;

132 
DWORD
 
	mdwOutNextPos
;

133 
BOOL
 
	mfDidH—d”
;

134 } 
	tTIF_INST
, *
	tPTIF_INST
;

138 
	tTIFF_UBYTE
;

139 
	tTIFF_USHORT
;

140 
	tTIFF_ULONG
;

141 sigÃd 
	tTIFF_SBYTE
;

142 sigÃd 
	tTIFF_SSHORT
;

143 sigÃd 
	tTIFF_SLONG
;

146 
	#INTEL
 0x4949

	)

147 
	#TIFF_VERSION
 42

	)

150 
	#TIFFBYTE
 1

	)

151 
	#TIFFASCII
 2

	)

152 
	#TIFFSHORT
 3

	)

153 
	#TIFFLONG
 4

	)

154 
	#TIFFRATIONAL
 5

	)

155 
	#TIFFSBYTE
 6

	)

156 
	#TIFFUNDEFINED
 7

	)

157 
	#TIFFSSHORT
 8

	)

158 
	#TIFFSLONG
 9

	)

159 
	#TIFFSRATIONAL
 10

	)

162 
	#NOCOMPRESSION
 1

	)

165 
	#CONTIGUOUS
 1

	)

166 
	#PLANAR
 2

	)

169 
	#ZERO_IS_WHITE
 0

	)

170 
	#ZERO_IS_BLACK
 1

	)

171 
	#RGB_COLOR
 2

	)

174 
	#DOTS_PER_INCH
 2

	)

178 
	#NUMTAGS
 13

	)

179 
	#BITS_PER_SAMPLE
 258

180 
	#COMPRESSION
 259

181 
	#IMAGE_LENGTH
 257

182 
	#IMAGE_WIDTH
 256

183 
	#NEW_SUBFILE
 254

184 
	#PHOTO_INTERPRET
 262

185 
	#RESOLUTION_UNIT
 296

186 
	#ROWS_PER_STRIP
 278

187 
	#SAMPLES_PER_PIXEL
 277

188 
	#STRIP_COUNTS
 279

189 
	#STRIP_OFFSETS
 273

190 
	#XRESOLUTION
 282

191 
	#YRESOLUTION
 283

192 

	)

194 
TIFF_ULONG
 
	mn
;

195 
TIFF_ULONG
 
	md
;

196 } 
	t__©Œibu‹__
((
	t·cked
)è
	tRATIONAL
;

199 
TIFF_UBYTE
 
	mb
[4];

200 
TIFF_USHORT
 
	ms
[2];

201 
TIFF_ULONG
 
	ml
;

202 
TIFF_ULONG
 
	mo
;

203 } 
	t__©Œibu‹__
((
	t·cked
)è
	tTIFFVALUE
;

206 
TIFF_USHORT
 
	mTagID
;

207 
TIFF_USHORT
 
	mKšd
;

208 
TIFF_ULONG
 
	mL’gth
;

209 
TIFFVALUE
 
	mV®ue
;

210 } 
	t__©Œibu‹__
((
	t·cked
)è
	tTIFFTAG
;

213 
TIFF_USHORT
 
	mNumTags
;

214 
TIFFTAG
 
	mTag
[
NUMTAGS
];

215 
TIFF_ULONG
 
	mOff£tNextIFD
;

216 } 
	t__©Œibu‹__
((
	t·cked
)è
	tTIFFIFD
;

219 
TIFF_UBYTE
 
	mBy‹Ord”
[2];

220 
TIFF_USHORT
 
	mV”siÚ
;

221 
TIFF_ULONG
 
	mOff£tFœ¡IFD
;

222 } 
	t__©Œibu‹__
((
	t·cked
)è
	tTIFFHEADER
;

224 
	#NUMEXTBYTES
 (2*(
RATIONAL
è+ 3*(
TIFF_USHORT
))

	)

225 
	#MAX_HEADER_SIZE
 ((
TIFFHEADER
è+ (
TIFFIFD
è+ 
NUMEXTBYTES
)

	)

242 
WORD
 
	$tifEncode_İ’XfÜm
 (

243 
IP_XFORM_HANDLE
 *
pXfÜm
)

245 
PTIF_INST
 
g
;

247 
	`INSURE
 (
pXfÜm
 !ğ
NULL
);

248 
	`IP_MEM_ALLOC
 ((
TIF_INST
), 
g
);

249 *
pXfÜm
 = 
g
;

250 
	`mem£t
 (
g
, 0, (
TIF_INST
));

251 
g
->
dwV®idChk
 = 
CHECK_VALUE
;

252  
IP_DONE
;

254 
çl_”rÜ
:

255  
IP_FATAL_ERROR
;

256 
	}
}

275 
WORD
 
	$tifEncode_£tDeçuÉIÅutT¿™s
 (

276 
IP_XFORM_HANDLE
 
hXfÜm
,

277 
PIP_IMAGE_TRAITS
 
pT¿™s
)

279 
PTIF_INST
 
g
;

280 
µr
, 
bµ
;

282 
	`HANDLE_TO_PTR
 (
hXfÜm
, 
g
);

283 
µr
 = 
pT¿™s
->
iPix–sP”Row
;

284 
bµ
 = 
pT¿™s
->
iB™sP”Pix–
;

287 
	`INSURE
 (
µr
 > 0);

288 
	`INSURE
 (
bµ
 > 0);

290 
g
->
dwRawRowBy‹s
 = (
µr
*
bµ
 + 7) / 8;

291 
g
->
Œa™s
 = *
pT¿™s
;

293  
IP_DONE
;

295 
çl_”rÜ
:

296  
IP_FATAL_ERROR
;

297 
	}
}

307 
WORD
 
	$tifEncode_£tXfÜmS³c
 (

308 
IP_XFORM_HANDLE
 
hXfÜm
,

309 
DWORD_OR_PVOID
 
aXfÜmInfo
[])

311 
PTIF_INST
 
g
;

312 *
s
;

314 
	`HANDLE_TO_PTR
 (
hXfÜm
, 
g
);

315 
s
 = (*)
aXfÜmInfo
[
IP_TIFF_FILE_PATH
].
pvoid
;

316 ià(
s
 !ğ
NULL
)

317 
	`¡rıy
 (
g
->
sFeP©h
, 
s
);

318  
IP_DONE
;

320 
çl_”rÜ
:

321  
IP_FATAL_ERROR
;

322 
	}
}

332 
WORD
 
	$tifEncode_g‘H—d”BufSize
 (

333 
IP_XFORM_HANDLE
 
hXfÜm
,

334 
DWORD
 *
pdwInBufL’
)

337 *
pdwInBufL’
 = 0;

338  
IP_DONE
;

339 
	}
}

349 
WORD
 
	$tifEncode_g‘Aùu®T¿™s
 (

350 
IP_XFORM_HANDLE
 
hXfÜm
,

351 
DWORD
 
dwIÅutAva
,

352 
PBYTE
 
pbIÅutBuf
,

353 
PDWORD
 
pdwIÅutU£d
,

354 
PDWORD
 
pdwIÅutNextPos
,

355 
PIP_IMAGE_TRAITS
 
pInT¿™s
,

356 
PIP_IMAGE_TRAITS
 
pOutT¿™s
)

358 
PTIF_INST
 
g
;

360 
	`HANDLE_TO_PTR
 (
hXfÜm
, 
g
);

363 *
pdwIÅutU£d
 = 0;

364 *
pdwIÅutNextPos
 = 0;

367 *
pInT¿™s
 = 
g
->
Œa™s
;

368 *
pOutT¿™s
 = 
g
->
Œa™s
;

369  
IP_DONE
 | 
IP_READY_FOR_DATA
;

371 
çl_”rÜ
:

372  
IP_FATAL_ERROR
;

373 
	}
}

383 
WORD
 
	$tifEncode_g‘Aùu®BufSizes
 (

384 
IP_XFORM_HANDLE
 
hXfÜm
,

385 
PDWORD
 
pdwMšInBufL’
,

386 
PDWORD
 
pdwMšOutBufL’
)

388 
PTIF_INST
 
g
;

389 
UINT
 
Ën
;

391 
	`HANDLE_TO_PTR
 (
hXfÜm
, 
g
);

392 
Ën
 = 
g
->
dwRawRowBy‹s
;

393 *
pdwMšInBufL’
 = 
Ën
;

395 ià(
Ën
 < 
MAX_HEADER_SIZE
)

396 
Ën
 = 
MAX_HEADER_SIZE
;

397 *
pdwMšOutBufL’
 = 
Ën
;

399  
IP_DONE
;

401 
çl_”rÜ
:

402  
IP_FATAL_ERROR
;

403 
	}
}

415 
	$S‘Tag
 (
TIFFTAG
 *
pTag
,

416 
TagID
, 
Kšd
, 
L’gth
, 
V®ue
)

418 
pTag
->
TagID
 = (
TIFF_USHORT
)TagID;

419 
pTag
->
Kšd
 = (
TIFF_USHORT
)Kind;

420 
pTag
->
L’gth
 = (
TIFF_ULONG
)Length;

421 
pTag
->
V®ue
.
l
 = (
TIFF_ULONG
)Value;

422 
	}
}

426 
	$Wr™eFeH—d”
 (
PBYTE
 
pTIFF
)

428 
TIFFHEADER
 *
pH—d
;

430 
pH—d
 = (
TIFFHEADER
*è
pTIFF
;

431 
pH—d
->
By‹Ord”
[0] = 'I';

432 
pH—d
->
By‹Ord”
[1] = 'I';

433 
pH—d
->
V”siÚ
 = 42;

434 
pH—d
->
Off£tFœ¡IFD
 = 8;

437 
	}
}

441 
	$Wr™eIFD
 (

442 
PBYTE
 
pTIFF
,

443 
iS¹Off£t
,

444 
WidthBy‹s
,

445 
WidthPix–s
,

446 
Height
,

447 
BPP
,

448 
XRes
,

449 
YRes
)

451 
TIFFIFD
 *
pIFD
;

452 
TIFFTAG
 *
pTag
;

453 
BYTE
 *
pMÜe
;

454 
TIFF_USHORT
 *
pBPS
;

455 
iBPSOff£t
, 
iImageOff£t
;

456 
SPP
, 
BPS
, 
PI
;

458 
pIFD
 = (
TIFFIFD
*)
pTIFF
;

459 
pMÜe
 = 
pTIFF
 + (
TIFFIFD
);

462 
iBPSOff£t
 = 
iS¹Off£t
 + (
pMÜe
-
pTIFF
);

463 
pBPS
 = (
TIFF_USHORT
*)
pMÜe
;

464 
pMÜe
 +ğ3*(
TIFF_USHORT
);

467 
iImageOff£t
 = 
iS¹Off£t
 + (
pMÜe
-
pTIFF
);

469 
BPP
) {

471 
PI
 = 
ZERO_IS_WHITE
; 
SPP
 = 1; 
BPS
 = 1; ;

473 
PI
 = 
ZERO_IS_BLACK
; 
SPP
 = 1; 
BPS
 = 8; ;

475 
PI
 = 
ZERO_IS_BLACK
; 
SPP
 = 1; 
BPS
 = 16; ;

477 
PI
 = 
RGB_COLOR
; 
SPP
 = 3; 
BPS
 = 8; ;

479 
PI
 = 
RGB_COLOR
; 
SPP
 = 3; 
BPS
 = 16; ;

481 
PI
 = 
RGB_COLOR
; 
SPP
 = 3; 
BPS
 = 8;

482 
	`as£¹
 (0);

485 
pIFD
->
NumTags
 = 
NUMTAGS
;

486 
pTag
 = 
pIFD
->
Tag
;

487 
	`S‘Tag
 (
pTag
++, 
NEW_SUBFILE
, 
TIFFSHORT
, 1, 0);

488 
	`S‘Tag
 (
pTag
++, 
IMAGE_WIDTH
, 
TIFFLONG
, 1, 
WidthPix–s
);

489 
	`S‘Tag
 (
pTag
++, 
IMAGE_LENGTH
, 
TIFFLONG
, 1, 
Height
);

490 
	`S‘Tag
 (
pTag
++, 
BITS_PER_SAMPLE
, 
TIFFSHORT
, 
SPP
, SPP>1 ? 
iBPSOff£t
 : 
BPS
);

491 
	`S‘Tag
 (
pTag
++, 
COMPRESSION
, 
TIFFSHORT
, 1, 1);

492 
	`S‘Tag
 (
pTag
++, 
PHOTO_INTERPRET
, 
TIFFSHORT
, 1, 
PI
);

493 
	`S‘Tag
 (
pTag
++, 
STRIP_OFFSETS
, 
TIFFLONG
, 1, 
iImageOff£t
);

494 
	`S‘Tag
 (
pTag
++, 
SAMPLES_PER_PIXEL
, 
TIFFSHORT
, 1, 
SPP
);

495 
	`S‘Tag
 (
pTag
++, 
ROWS_PER_STRIP
, 
TIFFLONG
, 1, 
Height
);

496 
	`S‘Tag
 (
pTag
++, 
STRIP_COUNTS
, 
TIFFLONG
, 1, 
WidthBy‹s
*
Height
);

497 
	`S‘Tag
 (
pTag
++, 
XRESOLUTION
, 
TIFFSHORT
, 1, 
XRes
);

498 
	`S‘Tag
 (
pTag
++, 
YRESOLUTION
, 
TIFFSHORT
, 1, 
YRes
);

499 
	`S‘Tag
 (
pTag
++, 
RESOLUTION_UNIT
, 
TIFFSHORT
, 1, 2);

500 
	`as£¹
 ((
pTag
 - 
pIFD
->
Tag
è=ğ
NUMTAGS
);

501 
pIFD
->
Off£tNextIFD
 = 0L;

504 *
pBPS
++ = 
BPS
;

505 *
pBPS
++ = 
BPS
;

506 *
pBPS
++ = 
BPS
;

508  
pMÜe
 - 
pTIFF
;

509 
	}
}

513 
WORD
 
	$Aµ’dIFDToFe
 (

514 
PTIF_INST
 
g
,

515 
PBYTE
 
pbTempBuf
)

517 
»suÉ
;

518 
TIFF_ULONG
 
feEndPos
, 
IFDPos
, 
poš‹rPos
;

519 
TIFF_USHORT
 
numTags
;

520 
iH—d”L’
, 
iIFDL’
, 
iTÙ®L’
;

524 
g
->
feOut
 = 
	`fİ’
 (g->
sFeP©h
, "a+b");

525 
	`INSURE
 (
g
->
feOut
 !ğ
NULL
);

526 
»suÉ
 = 
	`f£ek
 (
g
->
feOut
, 0, 
SEEK_END
);

527 
	`INSURE
 (
»suÉ
 == 0);

528 
feEndPos
 = 
	`á–l
 (
g
->
feOut
);

529 
	`INSURE
 (
»suÉ
 >= 0);

531 ià(
feEndPos
 == 0) {

532 
iH—d”L’
 = 
	`Wr™eFeH—d”
(
pbTempBuf
);

533 
iIFDL’
 = 
	`Wr™eIFD
 (
pbTempBuf
+
iH—d”L’
, iHeaderLen,

534 
g
->
dwRawRowBy‹s
, g->
Œa™s
.
iPix–sP”Row
,

535 
g
->
Œa™s
.
lNumRows
, g->Œa™s.
iB™sP”Pix–
,

536 
g
->
Œa™s
.
lHÜizDPI
>>16, g->Œa™s.
lV”tDPI
>>16);

538 
iTÙ®L’
 = 
iH—d”L’
 + 
iIFDL’
;

539 
	`INSURE
 (
iTÙ®L’
 <ğ
MAX_HEADER_SIZE
);

541 
»suÉ
 = 
	`fwr™e
 (
pbTempBuf
, 1, 
iTÙ®L’
, 
g
->
feOut
);

542 
	`INSURE
 (
»suÉ
 =ğ
iTÙ®L’
);

544  
IP_READY_FOR_DATA
;

549 
»suÉ
 = 
	`f£ek
 (
g
->
feOut
, 4, 
SEEK_SET
);

550 
	`INSURE
 (
»suÉ
 == 0);

551 
»suÉ
 = 
	`ä—d
 (&
IFDPos
, 4, 1, 
g
->
feOut
);

552 
	`INSURE
 (
»suÉ
 == 1);

555 
»suÉ
 = 
	`f£ek
 (
g
->
feOut
, 
IFDPos
, 
SEEK_SET
);

556 
	`INSURE
 (
»suÉ
 == 0);

557 
»suÉ
 = 
	`ä—d
 (&
numTags
, 2, 1, 
g
->
feOut
);

558 
	`INSURE
 (
»suÉ
==1 && 
numTags
>0);

559 
poš‹rPos
 = 
IFDPos
 + 2 + 
numTags
*(
TIFFTAG
);

560 
»suÉ
 = 
	`f£ek
 (
g
->
feOut
, 
poš‹rPos
, 
SEEK_SET
);

561 
	`INSURE
 (
»suÉ
 == 0);

562 
»suÉ
 = 
	`ä—d
 (&
IFDPos
, 4, 1, 
g
->
feOut
);

563 
	`INSURE
 (
»suÉ
 == 1);

564 } 
IFDPos
 != 0);

569 
	`fşo£
 (
g
->
feOut
);

570 
g
->
feOut
 = 
	`fİ’
(g->
sFeP©h
, "r+b");

571 
	`INSURE
 (
g
->
feOut
 !ğ
NULL
);

573 
»suÉ
 = 
	`f£ek
 (
g
->
feOut
, 
poš‹rPos
, 
SEEK_SET
);

574 
	`INSURE
 (
»suÉ
 == 0);

575 
»suÉ
 = 
	`fwr™e
 (&
feEndPos
, 4, 1, 
g
->
feOut
);

576 
	`INSURE
 (
»suÉ
 == 1);

580 
iIFDL’
 = 
	`Wr™eIFD
 (
pbTempBuf
, 
feEndPos
,

581 
g
->
dwRawRowBy‹s
, g->
Œa™s
.
iPix–sP”Row
,

582 
g
->
Œa™s
.
lNumRows
, g->Œa™s.
iB™sP”Pix–
,

583 
g
->
Œa™s
.
lHÜizDPI
>>16, g->Œa™s.
lV”tDPI
>>16);

585 
»suÉ
 = 
	`f£ek
 (
g
->
feOut
, 0, 
SEEK_END
);

586 
	`INSURE
 (
»suÉ
 == 0);

587 
»suÉ
 = 
	`fwr™e
 (
pbTempBuf
, 1, 
iIFDL’
, 
g
->
feOut
);

588 
	`INSURE
 (
»suÉ
 =ğ
iIFDL’
);

591  
IP_READY_FOR_DATA
;

593 
çl_”rÜ
:

594  
IP_FATAL_ERROR
;

595 
	}
}

599 
WORD
 
	$ouutH—d”
 (

600 
PTIF_INST
 
g
,

601 
DWORD
 
dwOuutAva
,

602 
PBYTE
 
pbOuutBuf
,

603 
PDWORD
 
pdwOuutU£d
,

604 
PDWORD
 
pdwOuutThisPos
)

606 
iH—d”L’
, 
iIFDL’
, 
iTÙ®L’
;

608 
	`INSURE
 (
dwOuutAva
 >ğ
MAX_HEADER_SIZE
);

609 *
pdwOuutThisPos
 = 0;

611 ià(
g
->
sFeP©h
[0] != 0) {

612 *
pdwOuutU£d
 = 0;

613  
	`Aµ’dIFDToFe
 (
g
, 
pbOuutBuf
);

616 
iH—d”L’
 = 
	`Wr™eFeH—d”
(
pbOuutBuf
);

617 
iIFDL’
 = 
	`Wr™eIFD
 (
pbOuutBuf
+
iH—d”L’
, iHeaderLen,

618 
g
->
dwRawRowBy‹s
, g->
Œa™s
.
iPix–sP”Row
,

619 
g
->
Œa™s
.
lNumRows
, g->Œa™s.
iB™sP”Pix–
,

620 
g
->
Œa™s
.
lHÜizDPI
>>16, g->Œa™s.
lV”tDPI
>>16);

622 
iTÙ®L’
 = 
iH—d”L’
 + 
iIFDL’
;

623 
	`INSURE
 (
iTÙ®L’
 <ğ
MAX_HEADER_SIZE
);

624 *
pdwOuutU£d
 = 
iTÙ®L’
;

625 *
pdwOuutThisPos
 = 0;

626 
g
->
dwOutNextPos
 = 
iTÙ®L’
;

628  
IP_READY_FOR_DATA
;

630 
çl_”rÜ
:

631  
IP_FATAL_ERROR
;

632 
	}
}

642 
WORD
 
	$tifEncode_cÚv”t
 (

643 
IP_XFORM_HANDLE
 
hXfÜm
,

644 
DWORD
 
dwIÅutAva
,

645 
PBYTE
 
pbIÅutBuf
,

646 
PDWORD
 
pdwIÅutU£d
,

647 
PDWORD
 
pdwIÅutNextPos
,

648 
DWORD
 
dwOuutAva
,

649 
PBYTE
 
pbOuutBuf
,

650 
PDWORD
 
pdwOuutU£d
,

651 
PDWORD
 
pdwOuutThisPos
)

653 
PTIF_INST
 
g
;

654 
UINT
 
n
;

656 
	`HANDLE_TO_PTR
 (
hXfÜm
, 
g
);

660 ià(! 
g
->
fDidH—d”
) {

661 
g
->
fDidH—d”
 = 
TRUE
;

662 *
pdwIÅutU£d
 = 0;

663 *
pdwIÅutNextPos
 = 0;

664  
	`ouutH—d”
 (
g
, 
dwOuutAva
, 
pbOuutBuf
,

665 
pdwOuutU£d
, 
pdwOuutThisPos
);

670 ià(
pbIÅutBuf
 =ğ
NULL
) {

671 
	`PRINT
 (
	`_T
("tif_encode_convert_row: Toldo flush.\n"), 0, 0);

672 ià(
g
->
Œa™s
.
lNumRows
 < 0) {

675 
	`INSURE
 (
g
->
sFeP©h
[0] == 0);

676 
g
->
Œa™s
.
lNumRows
 = g->
dwRowsDÚe
;

677 *
pdwIÅutU£d
 = 0;

678 *
pdwIÅutNextPos
 = 
g
->
dwInNextPos
;

679  
	`ouutH—d”
 (
g
, 
dwOuutAva
, 
pbOuutBuf
,

680 
pdwOuutU£d
, 
pdwOuutThisPos
);

683 *
pdwIÅutU£d
 = *
pdwOuutU£d
 = 0;

684 *
pdwIÅutNextPos
 = 
g
->
dwInNextPos
;

685 *
pdwOuutThisPos
 = 
g
->
dwOutNextPos
;

686  
IP_DONE
;

691 
n
 = 
g
->
dwRawRowBy‹s
;

692 
	`INSURE
 (
dwIÅutAva
 >ğ
n
);

693 
	`INSURE
 (
dwOuutAva
 >ğ
n
);

695 ià(
g
->
sFeP©h
[0] == 0) {

696 
	`memıy
 (
pbOuutBuf
, 
pbIÅutBuf
, 
n
);

698 *
pdwOuutU£d
 = 
n
;

699 *
pdwOuutThisPos
 = 
g
->
dwOutNextPos
;

700 
g
->
dwOutNextPos
 +ğ
n
;

702 
UINT
 
»suÉ
;

703 
	`INSURE
 (
g
->
feOut
 !ğ
NULL
);

704 
»suÉ
 = 
	`fwr™e
 (
pbIÅutBuf
, 1, 
n
, 
g
->
feOut
);

705 
	`INSURE
 (
»suÉ
 =ğ
n
);

707 *
pdwOuutU£d
 = 0;

708 *
pdwOuutThisPos
 = 0;

709 
g
->
dwOutNextPos
 = 0;

712 
g
->
dwInNextPos
 +ğ
n
;

713 *
pdwIÅutNextPos
 = 
g
->
dwInNextPos
;

714 *
pdwIÅutU£d
 = 
n
;

715 
g
->
dwRowsDÚe
 += 1;

717  
IP_CONSUMED_ROW
 | 
IP_PRODUCED_ROW
 | 
IP_READY_FOR_DATA
;

719 
çl_”rÜ
:

720  
IP_FATAL_ERROR
;

721 
	}
}

731 
WORD
 
	$tifEncode_š£¹edD©a
 (

732 
IP_XFORM_HANDLE
 
hXfÜm
,

733 
DWORD
 
dwNumBy‹s
)

735 
	`çlB»akPošt
 ();

736  
IP_FATAL_ERROR
;

737 
	}
}

747 
WORD
 
	$tifEncode_ÃwPage
 (

748 
IP_XFORM_HANDLE
 
hXfÜm
)

750 
PTIF_INST
 
g
;

752 
	`HANDLE_TO_PTR
 (
hXfÜm
, 
g
);

754  
IP_DONE
;

756 
çl_”rÜ
:

757  
IP_FATAL_ERROR
;

759 
	}
}

769 
WORD
 
	$tifEncode_şo£XfÜm
 (
IP_XFORM_HANDLE
 
hXfÜm
)

771 
PTIF_INST
 
g
;

773 
	`HANDLE_TO_PTR
 (
hXfÜm
, 
g
);

774 ià(
g
->
feOut
 !ğ
NULL
)

775 
	`fşo£
 (
g
->
feOut
);

776 
g
->
dwV®idChk
 = 0;

777 
	`IP_MEM_FREE
 (
g
);

778  
IP_DONE
;

780 
çl_”rÜ
:

781  
IP_FATAL_ERROR
;

782 
	}
}

792 
IP_XFORM_TBL
 
	gtifEncodeTbl
 = {

793 
tifEncode_İ’XfÜm
,

794 
tifEncode_£tDeçuÉIÅutT¿™s
,

795 
tifEncode_£tXfÜmS³c
,

796 
tifEncode_g‘H—d”BufSize
,

797 
tifEncode_g‘Aùu®T¿™s
,

798 
tifEncode_g‘Aùu®BufSizes
,

799 
tifEncode_cÚv”t
,

800 
tifEncode_ÃwPage
,

801 
tifEncode_š£¹edD©a
,

802 
tifEncode_şo£XfÜm


832 
WORD
 
	$tifDecode_İ’XfÜm
 (

833 
IP_XFORM_HANDLE
 *
pXfÜm
)

835 
PTIF_INST
 
g
;

837 
	`INSURE
 (
pXfÜm
 !ğ
NULL
);

838 
	`IP_MEM_ALLOC
 ((
TIF_INST
), 
g
);

839 *
pXfÜm
 = 
g
;

840 
	`mem£t
 (
g
, 0, (
TIF_INST
));

841 
g
->
dwV®idChk
 = 
CHECK_VALUE
;

842  
IP_DONE
;

844 
çl_”rÜ
:

845  
IP_FATAL_ERROR
;

846 
	}
}

865 
WORD
 
	$tifDecode_£tDeçuÉIÅutT¿™s
 (

866 
IP_XFORM_HANDLE
 
hXfÜm
,

867 
PIP_IMAGE_TRAITS
 
pT¿™s
)

869 
PTIF_INST
 
g
;

871 
	`HANDLE_TO_PTR
 (
hXfÜm
, 
g
);

872 
g
->
Œa™s
 = *
pT¿™s
;

873  
IP_DONE
;

875 
çl_”rÜ
:

876  
IP_FATAL_ERROR
;

877 
	}
}

887 
WORD
 
	$tifDecode_£tXfÜmS³c
 (

888 
IP_XFORM_HANDLE
 
hXfÜm
,

889 
DWORD_OR_PVOID
 
aXfÜmInfo
[])

891 
PTIF_INST
 
g
;

892 *
s
;

894 
	`HANDLE_TO_PTR
 (
hXfÜm
, 
g
);

896 
s
 = (*)
aXfÜmInfo
[
IP_TIFF_FILE_PATH
].
pvoid
;

897 ià(
s
 !ğ
NULL
)

898 
	`¡rıy
 (
g
->
sFeP©h
, 
s
);

899  
IP_DONE
;

901 
çl_”rÜ
:

902  
IP_FATAL_ERROR
;

903 
	}
}

913 
WORD
 
	$tifDecode_g‘H—d”BufSize
 (

914 
IP_XFORM_HANDLE
 
hXfÜm
,

915 
DWORD
 *
pdwInBufL’
)

917 *
pdwInBufL’
 = 
MAX_HEADER_SIZE
 + 10000;

918  
IP_DONE
;

919 
	}
}

929 
	$By‹Sw­
 (

930 *
pvV¬
,

931 
nBy‹s
)

933 
BYTE
 
b
;

934 
BYTE
 *
pb
 = (BYTE*)
pvV¬
;

936 
nBy‹s
) {

941 
b
 = 
pb
[0];…b[0] =…b[1];…b[1] = b;

944 
b
 = 
pb
[1];…b[1] =…b[2];…b[2] = b;

945 
b
 = 
pb
[0];…b[0] =…b[3];…b[3] = b;

949 
	`By‹Sw­
 (
pvV¬
, 4);

950 
	`By‹Sw­
 ((
BYTE
*)
pvV¬
+4, 4);

953 
	}
}

963 
BOOL
 
	$P¬£Tag
 (

964 
PTIF_INST
 
g
,

965 
TIFFTAG
 *
pTag
,

966 
BYTE
 *
pbIÅutBuf
,

967 
BYTE
 *
pbBufAá”
,

968 
DWORD
 *
pdwImageOff£t
)

970 
id
;

971 
kšd
;

972 
couÁ
;

973 *
pV®ue
;

974 
v®ue
;

975 
nTy³By‹s
, 
nV®ueBy‹s
;

976 
i
;

978 ià(
g
->
bBy‹Sw­
) {

979 
	`By‹Sw­
 (&(
pTag
->
TagID
 ), 2);

980 
	`By‹Sw­
 (&(
pTag
->
Kšd
 ), 2);

981 
	`By‹Sw­
 (&(
pTag
->
L’gth
), 4);

984 
id
 = 
pTag
->
TagID
;

985 
kšd
 = 
pTag
->
Kšd
;

986 
couÁ
 = 
pTag
->
L’gth
;

988 
kšd
) {

989 
TIFFUNDEFINED
: 
nTy³By‹s
 = 1; ;

990 
TIFFBYTE
: 
nTy³By‹s
 = 1; ;

991 
TIFFSBYTE
: 
nTy³By‹s
 = 1; ;

992 
TIFFSHORT
: 
nTy³By‹s
 = 2; ;

993 
TIFFSSHORT
: 
nTy³By‹s
 = 2; ;

994 
TIFFLONG
: 
nTy³By‹s
 = 4; ;

995 
TIFFSLONG
: 
nTy³By‹s
 = 4; ;

996 
TIFFRATIONAL
: 
nTy³By‹s
 = 8; ;

997 
TIFFSRATIONAL
: 
nTy³By‹s
 = 8; ;

998 : 
	`INSURE
(0);

1001 
nV®ueBy‹s
 = 
couÁ
 * 
nTy³By‹s
;

1003 ià(
nV®ueBy‹s
 <= 4)

1004 
pV®ue
 = &(
pTag
->
V®ue
.
l
);

1006 ià(
g
->
bBy‹Sw­
)

1007 
	`By‹Sw­
 (&(
pTag
->
V®ue
.
l
), 4);

1008 
pV®ue
 = 
pbIÅutBuf
 + 
pTag
->
V®ue
.
l
;

1010 
	`INSURE
 ((
BYTE
*)
pV®ue
>
pbIÅutBuf
 && (BYTE*íV®ue<
pbBufAá”
);

1012 ià(
g
->
bBy‹Sw­
) {

1013 
i
=0; i<()
couÁ
; i++)

1014 
	`By‹Sw­
 ((
BYTE
*)
pV®ue
 + 
i
*
nTy³By‹s
,‚TypeBytes);

1017 
kšd
) {

1018 
TIFFUNDEFINED
: 
v®ue
 = *(
TIFF_UBYTE
 *)
pV®ue
; ;

1019 
TIFFBYTE
: 
v®ue
 = *(
TIFF_UBYTE
 *)
pV®ue
; ;

1020 
TIFFSBYTE
: 
v®ue
 = *(
TIFF_SBYTE
 *)
pV®ue
; ;

1021 
TIFFSHORT
: 
v®ue
 = *(
TIFF_USHORT
*)
pV®ue
; ;

1022 
TIFFSSHORT
: 
v®ue
 = *(
TIFF_SSHORT
*)
pV®ue
; ;

1023 
TIFFLONG
: 
v®ue
 = *(
TIFF_ULONG
 *)
pV®ue
; ;

1024 
TIFFSLONG
: 
v®ue
 = *(
TIFF_SLONG
 *)
pV®ue
; ;

1025 
TIFFRATIONAL
: 
v®ue
 = ((
RATIONAL
*)
pV®ue
)->
n
 / ((RATIONAL*íV®ue)->
d
; ;

1026 
TIFFSRATIONAL
: 
v®ue
 = ((
RATIONAL
*)
pV®ue
)->
n
 / ((RATIONAL*íV®ue)->
d
; ;

1027 : 
	`INSURE
(0);

1030 
id
) {

1031 
NEW_SUBFILE
:

1034 
IMAGE_WIDTH
:

1035 
g
->
Œa™s
.
iPix–sP”Row
 = 
v®ue
;

1037 
IMAGE_LENGTH
:

1038 
g
->
Œa™s
.
lNumRows
 = 
v®ue
;

1040 
BITS_PER_SAMPLE
:

1041 
g
->
iB™sP”Sam¶e
 = 
v®ue
;

1043 
COMPRESSION
:

1044 
	`INSURE
 (
v®ue
 == 1);

1046 
PHOTO_INTERPRET
:

1049 
STRIP_OFFSETS
:

1050 
	`INSURE
 (
couÁ
 == 1);

1051 *
pdwImageOff£t
 = 
v®ue
;

1053 
SAMPLES_PER_PIXEL
:

1054 
g
->
Œa™s
.
iCompÚ’tsP”Pix–
 = 
v®ue
;

1056 
ROWS_PER_STRIP
:

1059 
STRIP_COUNTS
:

1062 
XRESOLUTION
:

1063 
g
->
Œa™s
.
lHÜizDPI
 = 
v®ue
 << 16;

1065 
YRESOLUTION
:

1066 
g
->
Œa™s
.
lV”tDPI
 = 
v®ue
 << 16;

1068 
RESOLUTION_UNIT
:

1076  
TRUE
;

1078 
çl_”rÜ
:

1079  
FALSE
;

1080 
	}
}

1090 
WORD
 
	$tifDecode_g‘Aùu®T¿™s
 (

1091 
IP_XFORM_HANDLE
 
hXfÜm
,

1092 
DWORD
 
dwIÅutAva
,

1093 
PBYTE
 
pbIÅutBuf
,

1094 
PDWORD
 
pdwIÅutU£d
,

1095 
PDWORD
 
pdwIÅutNextPos
,

1096 
PIP_IMAGE_TRAITS
 
pInT¿™s
,

1097 
PIP_IMAGE_TRAITS
 
pOutT¿™s
)

1099 
PTIF_INST
 
g
;

1100 
DWORD
 
dwImageOff£t
;

1101 
PBYTE
 
pb
;

1102 
TIFFHEADER
 *
pH—d
;

1103 
TIFFIFD
 *
pIFD
;

1104 
iTag
, 
nTags
;

1106 
	`HANDLE_TO_PTR
 (
hXfÜm
, 
g
);

1107 
pb
 = 
pbIÅutBuf
;

1111 
pH—d
 = (
TIFFHEADER
*)
pb
;

1112 
	`INSURE
 (
pH—d
->
By‹Ord”
[0]=='I' ||…Head->ByteOrder[0]=='M');

1113 
	`INSURE
 (
pH—d
->
By‹Ord”
[1]=='I' ||…Head->ByteOrder[1]=='M');

1114 
g
->
bBy‹Sw­
 = 
pH—d
->
By‹Ord”
[0] == 'M';

1115 ià(
g
->
bBy‹Sw­
)

1116 
	`By‹Sw­
 (&(
pH—d
->
Off£tFœ¡IFD
), 4);

1117 
	`INSURE
 (
pH—d
->
Off£tFœ¡IFD
 < 
dwIÅutAva
);

1119 
pb
 = 
pbIÅutBuf
 + 
pH—d
->
Off£tFœ¡IFD
;

1123 
pIFD
 = (
TIFFIFD
*)
pb
;

1124 ià(
g
->
bBy‹Sw­
)

1125 
	`By‹Sw­
 (&(
pIFD
->
NumTags
), 2);

1126 
nTags
 = 
pIFD
->
NumTags
;

1127 
	`INSURE
 (
nTags
>0 &&‚Tags<100);

1128 
	`INSURE
 (
nTags
*(
TIFFTAG
è< 
dwIÅutAva
);

1129 
dwImageOff£t
 = 0;

1131 
iTag
=0; iTag<
nTags
; iTag++) {

1132 ià(! 
	`P¬£Tag
 (
g
, 
pIFD
->
Tag
+
iTag
, 
pbIÅutBuf
,…bIÅutBuf+
dwIÅutAva
, &
dwImageOff£t
))

1133 
çl_”rÜ
;

1136 
	`INSURE
 (
g
->
iB™sP”Sam¶e
==1 || g->iBitsPerSample==8 || g->iBitsPerSample==16);

1137 
g
->
Œa™s
.
iB™sP”Pix–
 = g->
iB™sP”Sam¶e
 * g->Œa™s.
iCompÚ’tsP”Pix–
;

1138 
	`INSURE
 (
dwImageOff£t
 <ğ
dwIÅutAva
);

1139 
g
->
dwRawRowBy‹s
 = (g->
Œa™s
.
iB™sP”Pix–
*g->Œa™s.
iPix–sP”Row
 + 7) / 8;

1143 
g
->
dwInNextPos
 = 
dwImageOff£t
;

1144 *
pdwIÅutU£d
 = 
dwImageOff£t
;

1145 *
pdwIÅutNextPos
 = 
dwImageOff£t
;

1147 *
pInT¿™s
 = 
g
->
Œa™s
;

1148 *
pOutT¿™s
 = 
g
->
Œa™s
;

1149  
IP_DONE
 | 
IP_READY_FOR_DATA
;

1151 
çl_”rÜ
:

1152  
IP_FATAL_ERROR
;

1153 
	}
}

1163 
WORD
 
	$tifDecode_g‘Aùu®BufSizes
 (

1164 
IP_XFORM_HANDLE
 
hXfÜm
,

1165 
PDWORD
 
pdwMšInBufL’
,

1166 
PDWORD
 
pdwMšOutBufL’
)

1168 
PTIF_INST
 
g
;

1170 
	`HANDLE_TO_PTR
 (
hXfÜm
, 
g
);

1171 *
pdwMšInBufL’
 = 
g
->
dwRawRowBy‹s
;

1172 *
pdwMšOutBufL’
 = 
g
->
dwRawRowBy‹s
;

1173  
IP_DONE
;

1175 
çl_”rÜ
:

1176  
IP_FATAL_ERROR
;

1177 
	}
}

1187 
WORD
 
	$tifDecode_cÚv”t
 (

1188 
IP_XFORM_HANDLE
 
hXfÜm
,

1189 
DWORD
 
dwIÅutAva
,

1190 
PBYTE
 
pbIÅutBuf
,

1191 
PDWORD
 
pdwIÅutU£d
,

1192 
PDWORD
 
pdwIÅutNextPos
,

1193 
DWORD
 
dwOuutAva
,

1194 
PBYTE
 
pbOuutBuf
,

1195 
PDWORD
 
pdwOuutU£d
,

1196 
PDWORD
 
pdwOuutThisPos
)

1198 
PTIF_INST
 
g
;

1199 
UINT
 
n
;

1201 
	`HANDLE_TO_PTR
 (
hXfÜm
, 
g
);

1205 ià(
pbIÅutBuf
 =ğ
NULL
) {

1206 
	`PRINT
 (
	`_T
("tif_decode_convert_row: Toldo flush.\n"), 0, 0);

1207 *
pdwIÅutU£d
 = *
pdwOuutU£d
 = 0;

1208 *
pdwIÅutNextPos
 = 
g
->
dwInNextPos
;

1209 *
pdwOuutThisPos
 = 
g
->
dwOutNextPos
;

1210  
IP_DONE
;

1215 
n
 = 
g
->
dwRawRowBy‹s
;

1217 ià(
dwIÅutAva
 < 
n
) {

1219 
g
->
dwInNextPos
 +ğ
dwIÅutAva
;

1220 *
pdwIÅutNextPos
 = 
g
->
dwInNextPos
;

1221 *
pdwIÅutU£d
 = 
dwIÅutAva
;

1222 *
pdwOuutU£d
 = 0;

1223 *
pdwOuutThisPos
 = 
g
->
dwOutNextPos
;

1224  
IP_READY_FOR_DATA
;

1227 
	`INSURE
 (
dwOuutAva
 >ğ
n
);

1228 
	`memıy
 (
pbOuutBuf
, 
pbIÅutBuf
, 
n
);

1230 ià(
g
->
bBy‹Sw­
 && g->
iB™sP”Sam¶e
==16) {

1232 
BYTE
 *
pb
, *
pbAá”
, 
b
;

1233 
pbAá”
 = 
pbIÅutBuf
 + 
n
;

1234 
pb
=
pbIÅutBuf
;…b<
pbAá”
;…b+=4) {

1236 
b
 = 
pb
[0];…b[0] =…b[1];…b[1] = b;

1237 
b
 = 
pb
[2];…b[2] =…b[3];…b[3] = b;

1241 *
pdwOuutU£d
 = 
n
;

1242 *
pdwOuutThisPos
 = 
g
->
dwOutNextPos
;

1243 
g
->
dwOutNextPos
 +ğ
n
;

1245 
g
->
dwInNextPos
 +ğ
n
;

1246 *
pdwIÅutNextPos
 = 
g
->
dwInNextPos
;

1247 *
pdwIÅutU£d
 = 
n
;

1248 
g
->
dwRowsDÚe
 += 1;

1250  
IP_CONSUMED_ROW
 | 
IP_PRODUCED_ROW
 | 
IP_READY_FOR_DATA
;

1252 
çl_”rÜ
:

1253  
IP_FATAL_ERROR
;

1254 
	}
}

1264 
WORD
 
	$tifDecode_š£¹edD©a
 (

1265 
IP_XFORM_HANDLE
 
hXfÜm
,

1266 
DWORD
 
dwNumBy‹s
)

1268 
	`çlB»akPošt
 ();

1269  
IP_FATAL_ERROR
;

1270 
	}
}

1280 
WORD
 
	$tifDecode_ÃwPage
 (

1281 
IP_XFORM_HANDLE
 
hXfÜm
)

1283 
PTIF_INST
 
g
;

1285 
	`HANDLE_TO_PTR
 (
hXfÜm
, 
g
);

1287  
IP_DONE
;

1289 
çl_”rÜ
:

1290  
IP_FATAL_ERROR
;

1292 
	}
}

1302 
WORD
 
	$tifDecode_şo£XfÜm
 (
IP_XFORM_HANDLE
 
hXfÜm
)

1304 
PTIF_INST
 
g
;

1306 
	`HANDLE_TO_PTR
 (
hXfÜm
, 
g
);

1307 ià(
g
->
feOut
 !ğ
NULL
)

1308 
	`fşo£
 (
g
->
feOut
);

1309 
g
->
dwV®idChk
 = 0;

1310 
	`IP_MEM_FREE
 (
g
);

1311  
IP_DONE
;

1313 
çl_”rÜ
:

1314  
IP_FATAL_ERROR
;

1315 
	}
}

1325 
IP_XFORM_TBL
 
	gtifDecodeTbl
 = {

1326 
tifDecode_İ’XfÜm
,

1327 
tifDecode_£tDeçuÉIÅutT¿™s
,

1328 
tifDecode_£tXfÜmS³c
,

1329 
tifDecode_g‘H—d”BufSize
,

1330 
tifDecode_g‘Aùu®T¿™s
,

1331 
tifDecode_g‘Aùu®BufSizes
,

1332 
tifDecode_cÚv”t
,

1333 
tifDecode_ÃwPage
,

1334 
tifDecode_š£¹edD©a
,

1335 
tifDecode_şo£XfÜm


	@ip/xtonemap.c

83 
	~"hp.h
"

84 
	~"defs.h
"

85 
	~"¡ršg.h
"

89 
	~"¡dio.h
"

90 
	~<tch¬.h
>

92 
	#PRINT
(
msg
,
¬g1
,
¬g2
) \

93 
	`_á´štf
(
¡d”r
, 
msg
, ()
¬g1
, ()
¬g2
)

	)

95 
	#PRINT
(
msg
,
¬g1
,
¬g2
)

	)

98 
	#CHECK_VALUE
 0x4ba1daû

	)

102 
IP_IMAGE_TRAITS
 
	mŒa™s
;

103 
BOOL
 
	mbLumS·û
;

104 
BYTE
 
	mtÚem­
[256];

105 
DWORD
 
	mdwBy‹sP”Row
;

106 
DWORD
 
	mdwRowsDÚe
;

107 
DWORD
 
	mdwInNextPos
;

108 
DWORD
 
	mdwOutNextPos
;

109 
DWORD
 
	mdwV®idChk
;

110 } 
	tTMAP_INST
, *
	tPTMAP_INST
;

127 
WORD
 
	$tÚem­_İ’XfÜm
 (

128 
IP_XFORM_HANDLE
 *
pXfÜm
)

130 
PTMAP_INST
 
g
;

132 
	`INSURE
 (
pXfÜm
 !ğ
NULL
);

133 
	`IP_MEM_ALLOC
 ((
TMAP_INST
), 
g
);

134 *
pXfÜm
 = 
g
;

135 
	`mem£t
 (
g
, 0, (
TMAP_INST
));

136 
g
->
dwV®idChk
 = 
CHECK_VALUE
;

137  
IP_DONE
;

139 
çl_”rÜ
:

140  
IP_FATAL_ERROR
;

141 
	}
}

160 
WORD
 
	$tÚem­_£tDeçuÉIÅutT¿™s
 (

161 
IP_XFORM_HANDLE
 
hXfÜm
,

162 
PIP_IMAGE_TRAITS
 
pT¿™s
)

164 
PTMAP_INST
 
g
;

166 
	`HANDLE_TO_PTR
 (
hXfÜm
, 
g
);

169 
	`INSURE
 (
pT¿™s
->
iPix–sP”Row
>0 &&…T¿™s->
iB™sP”Pix–
>1);

170 
g
->
Œa™s
 = *
pT¿™s
;

171 
g
->
dwBy‹sP”Row
 = (g->
Œa™s
.
iPix–sP”Row
*g->Œa™s.
iB™sP”Pix–
 + 7) / 8;

172  
IP_DONE
;

174 
çl_”rÜ
:

175  
IP_FATAL_ERROR
;

176 
	}
}

186 
WORD
 
	$tÚem­_£tXfÜmS³c
 (

187 
IP_XFORM_HANDLE
 
hXfÜm
,

188 
DWORD_OR_PVOID
 
aXfÜmInfo
[])

190 
PTMAP_INST
 
g
;

192 
	`HANDLE_TO_PTR
 (
hXfÜm
, 
g
);

193 
	`memıy
 (
g
->
tÚem­
, 
aXfÜmInfo
[
IP_TONEMAP_POINTER
].
pvoid
, 256);

194 
g
->
bLumS·û
 = 
aXfÜmInfo
[
IP_TONEMAP_LUM_SPACE
].
dwÜd
;

195  
IP_DONE
;

197 
çl_”rÜ
:

198  
IP_FATAL_ERROR
;

199 
	}
}

209 
WORD
 
	$tÚem­_g‘H—d”BufSize
 (

210 
IP_XFORM_HANDLE
 
hXfÜm
,

211 
DWORD
 *
pdwInBufL’
)

214 *
pdwInBufL’
 = 0;

215  
IP_DONE
;

216 
	}
}

226 
WORD
 
	$tÚem­_g‘Aùu®T¿™s
 (

227 
IP_XFORM_HANDLE
 
hXfÜm
,

228 
DWORD
 
dwIÅutAva
,

229 
PBYTE
 
pbIÅutBuf
,

230 
PDWORD
 
pdwIÅutU£d
,

231 
PDWORD
 
pdwIÅutNextPos
,

232 
PIP_IMAGE_TRAITS
 
pIÁ¿™s
,

233 
PIP_IMAGE_TRAITS
 
pOutT¿™s
)

235 
PTMAP_INST
 
g
;

237 
	`HANDLE_TO_PTR
 (
hXfÜm
, 
g
);

240 *
pdwIÅutU£d
 = 0;

241 *
pdwIÅutNextPos
 = 0;

243 *
pIÁ¿™s
 = 
g
->
Œa™s
;

244 *
pOutT¿™s
 = 
g
->
Œa™s
;

246  
IP_DONE
 | 
IP_READY_FOR_DATA
;

248 
çl_”rÜ
:

249  
IP_FATAL_ERROR
;

250 
	}
}

260 
WORD
 
	$tÚem­_g‘Aùu®BufSizes
 (

261 
IP_XFORM_HANDLE
 
hXfÜm
,

262 
PDWORD
 
pdwMšInBufL’
,

263 
PDWORD
 
pdwMšOutBufL’
)

265 
PTMAP_INST
 
g
;

267 
	`HANDLE_TO_PTR
 (
hXfÜm
, 
g
);

269 *
pdwMšInBufL’
 = *
pdwMšOutBufL’
 = 
g
->
dwBy‹sP”Row
;

270  
IP_DONE
;

272 
çl_”rÜ
:

273  
IP_FATAL_ERROR
;

274 
	}
}

284 
WORD
 
	$tÚem­_cÚv”t
 (

285 
IP_XFORM_HANDLE
 
hXfÜm
,

286 
DWORD
 
dwIÅutAva
,

287 
PBYTE
 
pbIÅutBuf
,

288 
PDWORD
 
pdwIÅutU£d
,

289 
PDWORD
 
pdwIÅutNextPos
,

290 
DWORD
 
dwOuutAva
,

291 
PBYTE
 
pbOuutBuf
,

292 
PDWORD
 
pdwOuutU£d
,

293 
PDWORD
 
pdwOuutThisPos
)

295 
PTMAP_INST
 
g
;

296 
nBy‹s
;

297 
PBYTE
 
pIn
, 
pOut
, 
pOutAá”
;

299 
	`HANDLE_TO_PTR
 (
hXfÜm
, 
g
);

303 ià(
pbIÅutBuf
 =ğ
NULL
) {

304 
	`PRINT
 (
	`_T
("tonemap_convert: Toldo flush.\n"), 0, 0);

305 *
pdwIÅutU£d
 = *
pdwOuutU£d
 = 0;

306 *
pdwIÅutNextPos
 = 
g
->
dwInNextPos
;

307 *
pdwOuutThisPos
 = 
g
->
dwOutNextPos
;

308  
IP_DONE
;

313 
nBy‹s
 = 
g
->
dwBy‹sP”Row
;

314 
	`INSURE
 (
dwIÅutAva
 >ğ(
DWORD
)
nBy‹s
 );

315 
	`INSURE
 (
dwOuutAva
 >ğ(
DWORD
)
nBy‹s
);

317 
pIn
 = 
pbIÅutBuf
;

318 
pOut
 = 
pbOuutBuf
;

319 
pOutAá”
 = 
pOut
 + 
nBy‹s
;

321 ià(
g
->
Œa™s
.
iB™sP”Pix–
 == 8) {

323 
pOut
 < 
pOutAá”
) {

324 *
pOut
++ = 
g
->
tÚem­
[*
pIn
++];

326 } ià(
g
->
Œa™s
.
iB™sP”Pix–
 == 24) {

327 ià(
g
->
bLumS·û
) {

329 
pOut
 < 
pOutAá”
) {

330 *
pOut
 = 
g
->
tÚem­
[*
pIn
];

331 
pIn
 += 3;

332 
pOut
 += 3;

336 
rv
, 
gv
, 
bv
;

337 
l_Şd
, 
l_Ãw
, 
dl
;

339 
pOut
 < 
pOutAá”
) {

340 
rv
 = *
pIn
++;

341 
gv
 = *
pIn
++;

342 
bv
 = *
pIn
++;

344 
l_Şd
 = 
	`NTSC_LUMINANCE
 (
rv
, 
gv
, 
bv
);

345 
l_Ãw
 = 
g
->
tÚem­
[
l_Şd
];

346 
dl
 = 
l_Ãw
 - 
l_Şd
;

347 
rv
 +ğ
dl
;

348 
gv
 +ğ
dl
;

349 
bv
 +ğ
dl
;

351 ià(
rv
 > 255)„v = 255; if (rv < 0)„v = 0;

352 ià(
gv
 > 255) gv = 255; if (gv < 0) gv = 0;

353 ià(
bv
 > 255) bv = 255; if (bv < 0) bv = 0;

355 *
pOut
++ = (
BYTE
)
rv
;

356 *
pOut
++ = (
BYTE
)
gv
;

357 *
pOut
++ = (
BYTE
)
bv
;

361 
PWORD
 
¤c
 = (PWORD)
pIn
;

362 
PWORD
 
d¡
 = (PWORD)
pOut
;

363 
PWORD
 
d¡Aá”
 = (PWORD)
pOutAá”
;

365 
rv
, 
gv
, 
bv
;

366 
l_Şd
, 
l_Şd8
, 
l_Ãw1
, 
l_Ãw2
, 
l_Ãw
, 
dl
;

368 
d¡
 < 
d¡Aá”
) {

369 
rv
 = *
¤c
++;

370 
gv
 = *
¤c
++;

371 
bv
 = *
¤c
++;

375 
l_Şd
 = 
g
->
bLumS·û
 ? 
rv
 : 
	`NTSC_LUMINANCE
 (rv, 
gv
, 
bv
);

376 
l_Şd8
 = 
l_Şd
 >> 8;

377 
l_Ãw1
 = 
g
->
tÚem­
[
l_Şd8
];

378 
l_Ãw2
 = 
l_Şd8
<255 ? 
g
->
tÚem­
[l_Şd8+1] : 
l_Ãw1
;

379 
l_Ãw
 = (
l_Ãw2
-
l_Ãw1
)*(
l_Şd
&0x00ff) + (l_new1<<8);

381 
dl
 = 
l_Ãw
 - 
l_Şd
;

382 
rv
 +ğ
dl
;

383 ià(
rv
 > 65535)„v = 65535; if (rv < 0)„v = 0;

385 ià(! 
g
->
bLumS·û
) {

386 
gv
 +ğ
dl
;

387 
bv
 +ğ
dl
;

388 ià(
gv
 > 65535) gv = 65535; if (gv < 0) gv = 0;

389 ià(
bv
 > 65535) bv = 65535; if (bv < 0) bv = 0;

392 *
d¡
++ = (
WORD
)
rv
;

393 *
d¡
++ = (
WORD
)
gv
;

394 *
d¡
++ = (
WORD
)
bv
;

398 *
pdwIÅutU£d
 = 
nBy‹s
;

399 
g
->
dwInNextPos
 +ğ
nBy‹s
;

400 *
pdwIÅutNextPos
 = 
g
->
dwInNextPos
;

402 *
pdwOuutU£d
 = 
nBy‹s
;

403 *
pdwOuutThisPos
 = 
g
->
dwOutNextPos
;

404 
g
->
dwOutNextPos
 +ğ
nBy‹s
;

406 
g
->
dwRowsDÚe
 += 1;

408  
IP_CONSUMED_ROW
 | 
IP_PRODUCED_ROW
 | 
IP_READY_FOR_DATA
;

410 
çl_”rÜ
:

411  
IP_FATAL_ERROR
;

412 
	}
}

422 
WORD
 
	$tÚem­_š£¹edD©a
 (

423 
IP_XFORM_HANDLE
 
hXfÜm
,

424 
DWORD
 
dwNumBy‹s
)

426 
	`çlB»akPošt
 ();

427  
IP_FATAL_ERROR
;

428 
	}
}

438 
WORD
 
	$tÚem­_ÃwPage
 (

439 
IP_XFORM_HANDLE
 
hXfÜm
)

441 
PTMAP_INST
 
g
;

443 
	`HANDLE_TO_PTR
 (
hXfÜm
, 
g
);

445  
IP_DONE
;

447 
çl_”rÜ
:

448  
IP_FATAL_ERROR
;

450 
	}
}

460 
WORD
 
	$tÚem­_şo£XfÜm
 (
IP_XFORM_HANDLE
 
hXfÜm
)

462 
PTMAP_INST
 
g
;

464 
	`HANDLE_TO_PTR
 (
hXfÜm
, 
g
);

466 
g
->
dwV®idChk
 = 0;

467 
	`IP_MEM_FREE
 (
g
);

469  
IP_DONE
;

471 
çl_”rÜ
:

472  
IP_FATAL_ERROR
;

473 
	}
}

483 
IP_XFORM_TBL
 
	gtÚem­Tbl
 = {

484 
tÚem­_İ’XfÜm
,

485 
tÚem­_£tDeçuÉIÅutT¿™s
,

486 
tÚem­_£tXfÜmS³c
,

487 
tÚem­_g‘H—d”BufSize
,

488 
tÚem­_g‘Aùu®T¿™s
,

489 
tÚem­_g‘Aùu®BufSizes
,

490 
tÚem­_cÚv”t
,

491 
tÚem­_ÃwPage
,

492 
tÚem­_š£¹edD©a
,

493 
tÚem­_şo£XfÜm


	@ip/xyxtract.c

79 
	~"hp.h
"

80 
	~"defs.h
"

81 
	~"¡ršg.h
"

85 
	~"¡dio.h
"

86 
	~<tch¬.h
>

88 
	#PRINT
(
msg
,
¬g1
,
¬g2
) \

89 
	`_á´štf
(
¡d”r
, 
msg
, ()
¬g1
, ()
¬g2
)

	)

91 
	#PRINT
(
msg
,
¬g1
,
¬g2
)

	)

94 
	#CHECK_VALUE
 0x1û5ÿ7e

	)

97 
IP_IMAGE_TRAITS
 
	mšT¿™s
;

98 
IP_Y_EXTRACT_WHICH_SPACE
 
	meIÅutTy³
;

99 
DWORD
 
	mdwRowsDÚe
;

100 
DWORD
 
	mdwInNextPos
;

101 
DWORD
 
	mdwOutNextPos
;

102 
DWORD
 
	mdwV®idChk
;

103 } 
	tYEX_INST
, *
	tPYEX_INST
;

120 
WORD
 
	$yXŒaù_İ’XfÜm
 (

121 
IP_XFORM_HANDLE
 *
pXfÜm
)

123 
PYEX_INST
 
g
;

125 
	`INSURE
 (
pXfÜm
 !ğ
NULL
);

126 
	`IP_MEM_ALLOC
 ((
YEX_INST
), 
g
);

127 *
pXfÜm
 = 
g
;

128 
	`mem£t
 (
g
, 0, (
YEX_INST
));

129 
g
->
dwV®idChk
 = 
CHECK_VALUE
;

130  
IP_DONE
;

132 
çl_”rÜ
:

133  
IP_FATAL_ERROR
;

134 
	}
}

153 
WORD
 
	$yXŒaù_£tDeçuÉIÅutT¿™s
 (

154 
IP_XFORM_HANDLE
 
hXfÜm
,

155 
PIP_IMAGE_TRAITS
 
pT¿™s
)

157 
PYEX_INST
 
g
;

159 
	`HANDLE_TO_PTR
 (
hXfÜm
, 
g
);

162 
	`INSURE
 (
pT¿™s
->
iB™sP”Pix–
 == 24);

163 
	`INSURE
 (
pT¿™s
->
iCompÚ’tsP”Pix–
 == 3);

164 
	`INSURE
 (
pT¿™s
->
iPix–sP”Row
 > 0);

166 
g
->
šT¿™s
 = *
pT¿™s
;

167  
IP_DONE
;

169 
çl_”rÜ
:

170  
IP_FATAL_ERROR
;

171 
	}
}

181 
WORD
 
	$yXŒaù_£tXfÜmS³c
 (

182 
IP_XFORM_HANDLE
 
hXfÜm
,

183 
DWORD_OR_PVOID
 
aXfÜmInfo
[])

185 
PYEX_INST
 
g
;

186 
	`HANDLE_TO_PTR
 (
hXfÜm
, 
g
);

187 
g
->
eIÅutTy³
 = (
IP_Y_EXTRACT_WHICH_SPACE
)
aXfÜmInfo
[
IP_Y_EXTRACT_COLOR_SPACE
].
dwÜd
;

188  
IP_DONE
;

190 
çl_”rÜ
:

191  
IP_FATAL_ERROR
;

192 
	}
}

202 
WORD
 
	$yXŒaù_g‘H—d”BufSize
 (

203 
IP_XFORM_HANDLE
 
hXfÜm
,

204 
DWORD
 *
pdwInBufL’
)

207 *
pdwInBufL’
 = 0;

208  
IP_DONE
;

209 
	}
}

219 
WORD
 
	$yXŒaù_g‘Aùu®T¿™s
 (

220 
IP_XFORM_HANDLE
 
hXfÜm
,

221 
DWORD
 
dwIÅutAva
,

222 
PBYTE
 
pbIÅutBuf
,

223 
PDWORD
 
pdwIÅutU£d
,

224 
PDWORD
 
pdwIÅutNextPos
,

225 
PIP_IMAGE_TRAITS
 
pInT¿™s
,

226 
PIP_IMAGE_TRAITS
 
pOutT¿™s
)

228 
PYEX_INST
 
g
;

230 
	`HANDLE_TO_PTR
 (
hXfÜm
, 
g
);

233 *
pdwIÅutU£d
 = 0;

234 *
pdwIÅutNextPos
 = 0;

236 *
pInT¿™s
 = 
g
->
šT¿™s
;

237 *
pOutT¿™s
 = 
g
->
šT¿™s
;

238 
pOutT¿™s
->
iB™sP”Pix–
 = 8;

239 
pOutT¿™s
->
iCompÚ’tsP”Pix–
 = 1;

241  
IP_DONE
 | 
IP_READY_FOR_DATA
;

243 
çl_”rÜ
:

244  
IP_FATAL_ERROR
;

245 
	}
}

255 
WORD
 
	$yXŒaù_g‘Aùu®BufSizes
 (

256 
IP_XFORM_HANDLE
 
hXfÜm
,

257 
PDWORD
 
pdwMšInBufL’
,

258 
PDWORD
 
pdwMšOutBufL’
)

260 
PYEX_INST
 
g
;

262 
	`HANDLE_TO_PTR
 (
hXfÜm
, 
g
);

263 *
pdwMšInBufL’
 = 3 * 
g
->
šT¿™s
.
iPix–sP”Row
;

264 *
pdwMšOutBufL’
 = 
g
->
šT¿™s
.
iPix–sP”Row
;

266  
IP_DONE
;

268 
çl_”rÜ
:

269  
IP_FATAL_ERROR
;

270 
	}
}

280 
WORD
 
	$yXŒaù_cÚv”t
 (

281 
IP_XFORM_HANDLE
 
hXfÜm
,

282 
DWORD
 
dwIÅutAva
,

283 
PBYTE
 
pbIÅutBuf
,

284 
PDWORD
 
pdwIÅutU£d
,

285 
PDWORD
 
pdwIÅutNextPos
,

286 
DWORD
 
dwOuutAva
,

287 
PBYTE
 
pbOuutBuf
,

288 
PDWORD
 
pdwOuutU£d
,

289 
PDWORD
 
pdwOuutThisPos
)

291 
PYEX_INST
 
g
;

292 
šBy‹s
, 
outBy‹s
;

293 
PBYTE
 
pIn
, 
pOut
, 
pOutAá”
;

294 
UINT
 
»d
, 
gº
, 
blu
;

296 
	`HANDLE_TO_PTR
 (
hXfÜm
, 
g
);

300 ià(
pbIÅutBuf
 =ğ
NULL
) {

301 
	`PRINT
 (
	`_T
("yXtract_convert: Toldo flush.\n"), 0, 0);

302 *
pdwIÅutU£d
 = *
pdwOuutU£d
 = 0;

303 *
pdwIÅutNextPos
 = 
g
->
dwInNextPos
;

304 *
pdwOuutThisPos
 = 
g
->
dwOutNextPos
;

305  
IP_DONE
;

310 
outBy‹s
 = 
g
->
šT¿™s
.
iPix–sP”Row
;

311 
šBy‹s
 = 3 * 
outBy‹s
;

312 
	`INSURE
 (
dwIÅutAva
 >ğ(
DWORD
)
šBy‹s
 );

313 
	`INSURE
 (
dwOuutAva
 >ğ(
DWORD
)
outBy‹s
);

315 
pIn
 = 
pbIÅutBuf
;

316 
pOut
 = 
pbOuutBuf
;

317 
pOutAá”
 = 
pOut
 + 
outBy‹s
;

319 
g
->
eIÅutTy³
) {

320 
IP_Y_EXTRACT_LUM_CHROME
:

321 
pOut
 < 
pOutAá”
) {

322 *
pOut
++ = *
pIn
;

323 
pIn
 += 3;

327 
IP_Y_EXTRACT_RGB
:

328 
pOut
 < 
pOutAá”
) {

329 
»d
 = (
UINT
)(*
pIn
++);

330 
gº
 = (
UINT
)(*
pIn
++);

331 
blu
 = (
UINT
)(*
pIn
++);

333 *
pOut
++ =

334 (
BYTE
)((((
»d
<<2)+»dè+ ((
gº
<<3)+gºè+ (
blu
<<1) + 8) >> 4);

338 
IP_Y_EXTRACT_BGR
:

339 
pOut
 < 
pOutAá”
) {

340 
blu
 = (
UINT
)(*
pIn
++);

341 
gº
 = (
UINT
)(*
pIn
++);

342 
»d
 = (
UINT
)(*
pIn
++);

344 *
pOut
++ =

345 (
BYTE
)((((
»d
<<2)+»dè+ ((
gº
<<3)+gºè+ (
blu
<<1) + 8) >> 4);

350 
çl_”rÜ
;

353 *
pdwIÅutU£d
 = 
šBy‹s
;

354 
g
->
dwInNextPos
 +ğ
šBy‹s
;

355 *
pdwIÅutNextPos
 = 
g
->
dwInNextPos
;

357 *
pdwOuutU£d
 = 
outBy‹s
;

358 *
pdwOuutThisPos
 = 
g
->
dwOutNextPos
;

359 
g
->
dwOutNextPos
 +ğ
outBy‹s
;

361 
g
->
dwRowsDÚe
 += 1;

363  
IP_CONSUMED_ROW
 | 
IP_PRODUCED_ROW
 | 
IP_READY_FOR_DATA
;

365 
çl_”rÜ
:

366  
IP_FATAL_ERROR
;

367 
	}
}

377 
WORD
 
	$yXŒaù_š£¹edD©a
 (

378 
IP_XFORM_HANDLE
 
hXfÜm
,

379 
DWORD
 
dwNumBy‹s
)

381 
	`çlB»akPošt
 ();

382  
IP_FATAL_ERROR
;

383 
	}
}

393 
WORD
 
	$yXŒaù_ÃwPage
 (

394 
IP_XFORM_HANDLE
 
hXfÜm
)

396 
PYEX_INST
 
g
;

398 
	`HANDLE_TO_PTR
 (
hXfÜm
, 
g
);

400  
IP_DONE
;

402 
çl_”rÜ
:

403  
IP_FATAL_ERROR
;

405 
	}
}

415 
WORD
 
	$yXŒaù_şo£XfÜm
 (
IP_XFORM_HANDLE
 
hXfÜm
)

417 
PYEX_INST
 
g
;

419 
	`HANDLE_TO_PTR
 (
hXfÜm
, 
g
);

421 
g
->
dwV®idChk
 = 0;

422 
	`IP_MEM_FREE
 (
g
);

424  
IP_DONE
;

426 
çl_”rÜ
:

427  
IP_FATAL_ERROR
;

428 
	}
}

438 
IP_XFORM_TBL
 
	gyXŒaùTbl
 = {

439 
yXŒaù_İ’XfÜm
,

440 
yXŒaù_£tDeçuÉIÅutT¿™s
,

441 
yXŒaù_£tXfÜmS³c
,

442 
yXŒaù_g‘H—d”BufSize
,

443 
yXŒaù_g‘Aùu®T¿™s
,

444 
yXŒaù_g‘Aùu®BufSizes
,

445 
yXŒaù_cÚv”t
,

446 
yXŒaù_ÃwPage
,

447 
yXŒaù_š£¹edD©a
,

448 
yXŒaù_şo£XfÜm


	@pcard/fat.c

29 
	~<¡dlib.h
>

30 
	~<¡dšt.h
>

31 
	~<¡dio.h
>

32 
	~<¡ršg.h
>

33 
	~<uni¡d.h
>

34 
	~<Ãtš‘/š.h
>

35 
	~"çt.h
"

43 
	mF©S¹SeùÜ
;

44 
	mD©aS¹SeùÜ
;

45 
	mRoÙDœS¹SeùÜ
;

46 
	mRoÙDœNumSeùÜs
;

47 
ušt8_t
 *
	mF©
;

48 
	mF©Size
;

49 
ušt8_t
 *
	mF©12
;

50 
	mF©12Size
;

51 
ušt8_t
 *
	mF©16
;

52 
	mWr™ePrÙeù
;

53 } 
	tDISK_ATTRIBUTES
;

57 
	mName
[16];

58 
	mS¹Clu¡”
;

59 
	mS¹SeùÜ
;

60 
	mCu¼SeùÜ
;

61 
	mNumEÁr›s
;

62 } 
	tCURRENT_WORKING_DIRECTORY
;

66 
	mName
[16];

67 
	mA‰r
;

68 
	mS¹Clu¡”
;

69 
	mCu¼Clu¡”
;

70 
	mSize
;

71 
	mCu¼SeùÜ
;

72 
	mCu¼SeùÜNumInClu¡”
;

73 
	mCu¼By‹
;

74 
	mDœSeùÜNum
;

75 
	mDœEÁryNum
;

76 } 
	tCURRENT_FILE_ATTRIBUTES
;

80 
	mJumpIn¡ruùiÚ
[3];

81 
	mOEMID
[8];

82 
ušt16_t
 
	mBy‹sP”SeùÜ
;

83 
ušt8_t
 
	mSeùÜsP”Clu¡”
;

84 
ušt16_t
 
	mRe£rvedSeùÜs
;

85 
ušt8_t
 
	mF©s
;

86 
ušt16_t
 
	mRoÙEÁr›s
;

87 
ušt16_t
 
	mSm®lSeùÜs
;

88 
ušt8_t
 
	mMedŸ
;

89 
ušt16_t
 
	mSeùÜsP”F©
;

90 
ušt16_t
 
	mSeùÜsP”T¿ck
;

91 
ušt16_t
 
	mH—ds
;

92 
ušt32_t
 
	mHidd’SeùÜs
;

93 
ušt32_t
 
	mL¬geSeùÜs
;

94 
ušt8_t
 
	mDriveNumb”
;

95 
ušt8_t
 
	mCu¼’tH—d
;

96 
ušt8_t
 
	mSigÇtu»
;

97 
ušt32_t
 
	mID
;

98 
ušt8_t
 
	mVŞumeLab–
[11];

99 
ušt8_t
 
	mSy¡emID
[8];

100 
ušt8_t
 
	mLßdIn¡ruùiÚs
[512-64];

101 
ušt16_t
 
	mEndSigÇtu»
;

102 } 
	t__©Œibu‹__
((
	t·cked
)è
	tFAT_BOOT_SECTOR
;

106 
	mName
[8],
	mExt
[3];

107 
ušt8_t
 
	mA‰ribu‹s
;

108 
ušt8_t
 
	mRe£rved
[10];

109 
ušt16_t
 
	mTime
;

110 
ušt16_t
 
	mD©e
;

111 
ušt16_t
 
	mS¹Clu¡”
;

112 
ušt32_t
 
	mSize
;

113 } 
	t__©Œibu‹__
((
	t·cked
)è
	tFAT_DIRECTORY
;

115 
	#FAT_IS_DIR
 0x10

	)

116 
	#FAT_END_OF_DIR
 0x2

	)

117 
	#FAT_FILE_DELETED
 0xe5

	)

118 
	#FAT_LONG_FILENAME
 0x3

	)

123 
FAT_BOOT_SECTOR
 
	gbpb
;

124 
DISK_ATTRIBUTES
 
	gda
;

125 
CURRENT_WORKING_DIRECTORY
 
	gcwd
;

126 
CURRENT_FILE_ATTRIBUTES
 
	gç
;

129 
	$CÚv”tF©12to16
(
ušt8_t
 *
de¡
, ušt8_ˆ*
¤c
, 
max’Œy
)

131 
ušt8_t
 *
p12
 = 
¤c
;

132 
ušt16_t
 *
p16
 = (ušt16_ˆ*)
de¡
;

133 
i
;

135 
i
=0; i<
max’Œy
; i++)

137 ià(
i
&1)

139 *
p16
++ = 
	`l™2hs
(*(
ušt16_t
 *)
p12
 >> 4);

140 
p12
+=2;

144 *
p16
++ = 
	`l™2hs
(*(
ušt16_t
 *)
p12
 & 0xfff);

145 
p12
++;

149 
	}
}

152 
	$CÚv”tF©16to12
(
ušt8_t
 *
de¡
, ušt8_ˆ*
¤c
, 
max’Œy
)

154 
ušt8_t
 *
p12
 = 
de¡
;

155 
ušt16_t
 *
p16
 = (ušt16_ˆ*)
¤c
;

156 
i
;

158 
i
=0; i<
max’Œy
; i++, 
p16
++)

160 ià(
i
&1)

162 *
p12
 = (
ušt8_t
)
	`h2l™s
(*
p16
 >> 4);

163 
p12
++;

167 *(
ušt16_t
 *)
p12
 = 
	`h2l™s
(*
p16
 | (*(p16+1) << 12));

168 
p12
+=2;

172 
	}
}

174 
	$»ad£ù
(
£ùÜ
, 
n£ùÜ
, *
buf
, 
size
)

176 
Ën
=
n£ùÜ
, 
tÙ®
=0;

177 
i
, 
n
, 
¡©
=1;

180 
i
=0; i<
n£ùÜ
; i+=
n
, 
Ën
-=n)

182 
n
 = 
Ën
 > 
FAT_BLKSIZE
 ? FAT_BLKSIZE :†en;

183 ià(
	`R—dSeùÜ
(
£ùÜ
+
i
, 
n
, 
buf
+
tÙ®
, 
size
-total) != 0)

184 
bugout
;

185 
tÙ®
 +ğ
n
*
FAT_HARDSECT
;

188 
¡©
 = 0;

190 
bugout
:

191  
¡©
;

192 
	}
};

194 
	$wr™e£ù
(
£ùÜ
, 
n£ùÜ
, *
buf
, 
size
)

196 
Ën
=
n£ùÜ
, 
tÙ®
=0;

197 
i
, 
n
, 
¡©
=1;

200 
i
=0; i<
n£ùÜ
; i+=
n
, 
Ën
-=n)

202 
n
 = 
Ën
 > 
FAT_BLKSIZE
 ? FAT_BLKSIZE :†en;

203 ià(
	`Wr™eSeùÜ
(
£ùÜ
+
i
, 
n
, 
buf
+
tÙ®
, 
size
-total) != 0)

204 
bugout
;

205 
tÙ®
 +ğ
n
*
FAT_HARDSECT
;

208 
¡©
 = 0;

210 
bugout
:

211  
¡©
;

212 
	}
};

214 
	$Upd©eF©
()

216 
¡©
=1;

217 
ušt8_t
 *
p12
=
NULL
;

218 
i
, 
tÙ®
=0;

220 ià(
	`¡rcmp
((*)
bpb
.
Sy¡emID
, "FAT12") == 0)

222 ià((
p12
 = 
	`m®loc
(
da
.
F©12Size
)è=ğ
NULL
)

223 
bugout
;

224 
	`CÚv”tF©16to12
(
p12
, 
da
.
F©
, da.
F©12Size
/1.5);

225 
i
=0; i<
bpb
.
SeùÜsP”F©
; i++)

227 ià(
	`memcmp
(
p12
+
tÙ®
, 
da
.
F©12
+tÙ®, 
FAT_HARDSECT
) != 0)

228 ià(
	`wr™e£ù
(
da
.
F©S¹SeùÜ
+
i
, 1, 
p12
+
tÙ®
, 
FAT_HARDSECT
) != 0)

229 
bugout
;

230 
tÙ®
 +ğ
FAT_HARDSECT
;

235 
i
=0; i<
bpb
.
SeùÜsP”F©
; i++)

237 ià(
	`memcmp
(
da
.
F©
+
tÙ®
, da.
F©16
+tÙ®, 
FAT_HARDSECT
) != 0)

238 ià(
	`wr™e£ù
(
da
.
F©S¹SeùÜ
+
i
, 1, da.
F©
+
tÙ®
, 
FAT_HARDSECT
) != 0)

239 
bugout
;

240 
tÙ®
 +ğ
FAT_HARDSECT
;

244 
¡©
 = 0;

246 
bugout
:

248 ià(
p12
 !ğ
NULL
)

249 
	`ä“
(
p12
);

251  
¡©
;

252 
	}
};

254 
	$RoÙS‘CWD
()

257 
cwd
.
Name
[0] = '/'; cwd.Name[1] = 0;

258 
cwd
.
S¹SeùÜ
 = 
da
.
RoÙDœS¹SeùÜ
;

259 
cwd
.
Cu¼SeùÜ
 = cwd.
S¹SeùÜ
;

260 
cwd
.
NumEÁr›s
 = 
bpb
.
RoÙEÁr›s
;

261 
cwd
.
S¹Clu¡”
 = 0;

264 
	}
};

267 
	$FšdF»eClu¡”s
()

269 
št16_t
 *
pçt
 = (št16_ˆ*)
da
.
F©
;

270 
max_’Œy
 = 
da
.
F©Size
/2;

271 
i
, 
ä“şu¡”s
=0;

273 
i
=0; i<
max_’Œy
; i++)

275 ià(*
pçt
++ == 0x0)

276 
ä“şu¡”s
++;

278  
ä“şu¡”s
;

279 
	}
}

281 
	$CÚv”tClu¡”ToSeùÜ
(
şu¡”
)

283 
£ùÜ
;

285 
£ùÜ
 = 
şu¡”
 - 2;

286 
£ùÜ
 *ğ
bpb
.
SeùÜsP”Clu¡”
;

287 
£ùÜ
 +ğ
da
.
D©aS¹SeùÜ
;

289  
£ùÜ
;

290 
	}
}

293 
	$G‘NextClu¡”
(
şu¡”
)

295 
ušt16_t
 *
pçt
 = (ušt16_ˆ*)
da
.
F©
;

296  *(
pçt
+
şu¡”
);

297 
	}
}

300 
	$LßdFeInCWD
(
f’umb”
)

302 
ušt8_t
 
buf
[
FAT_HARDSECT
];

303 
FAT_DIRECTORY
 *
pde
 = (FAT_DIRECTORY *)
buf
;

304 
i
, 
j
, 
â
, 
£ùÜ
, 
şu¡”
, 
şu¡”_út
;

305 
de_³r_£ùÜ
 = 
FAT_HARDSECT
/(
FAT_DIRECTORY
);

306 
ušt8_t
 
c
;

308 
£ùÜ
 = 
f’umb”
 / 
de_³r_£ùÜ
;

309 
â
 = 
f’umb”
 - (
£ùÜ
 * 
de_³r_£ùÜ
);

311 ià(
cwd
.
S¹Clu¡”
)

315 
şu¡”
 = 
cwd
.
S¹Clu¡”
;

316 
şu¡”_út
 = 
£ùÜ
 / 
bpb
.
SeùÜsP”Clu¡”
;

317 
i
=0; i<
şu¡”_út
 && 
şu¡”
<0xfff7 && cluster; i++)

318 
şu¡”
 = 
	`G‘NextClu¡”
(cluster);

319 ià(
şu¡”
 >= 0xfff7 || cluster == 0)

320  
FAT_END_OF_DIR
;

321 
cwd
.
Cu¼SeùÜ
 = 
	`CÚv”tClu¡”ToSeùÜ
(
şu¡”
);

322 
£ùÜ
 -ğ
şu¡”_út
 * 
bpb
.
SeùÜsP”Clu¡”
;

326 
cwd
.
Cu¼SeùÜ
 = cwd.
S¹SeùÜ
;

329 ià(
f’umb”
 > (
da
.
RoÙDœNumSeùÜs
 * 
de_³r_£ùÜ
))

330  
FAT_END_OF_DIR
;

333 
cwd
.
Cu¼SeùÜ
 +ğ
£ùÜ
;

335 
ç
.
DœEÁryNum
 = 
â
;

336 
ç
.
DœSeùÜNum
 = 
cwd
.
Cu¼SeùÜ
;

339 
pde
 +ğ
â
;

340 
pde
->
Name
[0] = 0;

341 
	`»ad£ù
(
ç
.
DœSeùÜNum
, 1, 
buf
, (buf));

343 
c
 = 
pde
->
Name
[0];

344 ià(
c
 == 0x0)

345  
FAT_END_OF_DIR
;

346 ià(
c
 =ğ
FAT_FILE_DELETED
)

347  
FAT_FILE_DELETED
;

350 
i
=0; (i<(
pde
->
Name
)) &&…de->Name[i] && (pde->Name[i] != ' '); i++)

351 
ç
.
Name
[
i
] = 
pde
->Name[i];

352 ià(
pde
->
Ext
[0] && (pde->Ext[0] != ' '))

354 
ç
.
Name
[
i
++] = '.';

355 
j
=0; (
pde
->
Ext
[j] !ğ' 'è&& (j<Õde->Ext)); j++, 
i
++)

356 
ç
.
Name
[
i
] = 
pde
->
Ext
[
j
];

359 
ç
.
Name
[
i
] = 0;

361 
ç
.
A‰r
 = 
pde
->
A‰ribu‹s
;

363 ià(
pde
->
A‰ribu‹s
 == 0xf)

365  
FAT_LONG_FILENAME
;

368 
ç
.
S¹Clu¡”
 = 
pde
->StartCluster;

369 
ç
.
Cu¼Clu¡”
 = fa.
S¹Clu¡”
;

370 
ç
.
Size
 = 
pde
->Size;

371 
ç
.
Cu¼SeùÜNumInClu¡”
 = 0;

374 
	}
}

377 
	$LßdFeW™hName
(*
f’ame
)

379 
f’um
;

380 
»t
, 
¡©
=1;

382 
f’um
 = 0;

386 
»t
 = 
	`LßdFeInCWD
(
f’um
);

387 ià(
»t
 =ğ
FAT_END_OF_DIR
)

390 ià((
»t
 !ğ
FAT_FILE_DELETED
è&& (»ˆ!ğ
FAT_LONG_FILENAME
))

392 ià(
	`¡rÿ£cmp
(
ç
.
Name
, 
f’ame
) == 0)

394 
¡©
 = 0;

398 
f’um
++;

400  
¡©
;

401 
	}
}

403 
	$PrštCu¼FeInfo
()

405 
	`årštf
(
¡dout
, "%  %d by‹ (şu¡” %d, seùÜ %d)", 
ç
.
Name
, fa.
Size
,

406 
ç
.
S¹Clu¡”
, 
	`CÚv”tClu¡”ToSeùÜ
(fa.StartCluster));

407 ià(
ç
.
A‰r
 & 
FAT_IS_DIR
)

408 
	`åuts
(" <DIR>\n", 
¡dout
);

410 
	`åutc
('\n', 
¡dout
);

411 
	}
}

414 
	$F©In™
()

416 
boÙ£ùÜ_¡¬t£ùÜ
, 
¡©
=1, 
çtsize
;

417 
dummy
[
FAT_HARDSECT
];

419 ià(
da
.
F©
 !ğ
NULL
)

420 
	`ä“
(
da
.
F©
);

421 ià(
da
.
F©12
 !ğ
NULL
)

422 
	`ä“
(
da
.
F©12
);

423 
da
.
F©
 = 
NULL
;

424 
da
.
F©12
 = 
NULL
;

427 
boÙ£ùÜ_¡¬t£ùÜ
 = 0;

431 ià(
	`»ad£ù
(
boÙ£ùÜ_¡¬t£ùÜ
, 1, &
bpb
, (bpb)) != 0)

432 
bugout
;

436 ià(
bpb
.
By‹sP”SeùÜ
 !ğ
FAT_HARDSECT
)

437 
bugout
;

439 
bpb
.
Sy¡emID
[5] = 0;

441 ià(
v”bo£
 > 0)

443 
	`årštf
(
¡d”r
, "by‹s/£ùÜs=%d\n", 
bpb
.
By‹sP”SeùÜ
);

444 
	`årštf
(
¡d”r
, "£ùÜs/şu¡”=%d\n", 
bpb
.
SeùÜsP”Clu¡”
);

445 
	`årštf
(
¡d”r
, "»£rved seùÜs=%d\n", 
bpb
.
Re£rvedSeùÜs
);

446 
	`årštf
(
¡d”r
, "£ùÜs/FAT=%d\n", 
bpb
.
SeùÜsP”F©
);

447 
	`årštf
(
¡d”r
, "roÙƒÁr›s=%d\n", 
bpb
.
RoÙEÁr›s
);

448 
	`årštf
(
¡d”r
, "sm®È£ùÜs=%d\n", 
bpb
.
Sm®lSeùÜs
);

449 
	`årštf
(
¡d”r
, "Ïrg£ùÜs=%d\n", 
bpb
.
L¬geSeùÜs
);

450 
	`årštf
(
¡d”r
, "sy¡em id=%s\n", 
bpb
.
Sy¡emID
);

454 
da
.
F©S¹SeùÜ
 = 
boÙ£ùÜ_¡¬t£ùÜ
 + 
bpb
.
Re£rvedSeùÜs
;

455 
da
.
RoÙDœNumSeùÜs
 = ((
bpb
.
RoÙEÁr›s
 * 32è+ (bpb.
By‹sP”SeùÜ
 - 1)) / bpb.BytesPerSector;

456 
da
.
RoÙDœS¹SeùÜ
 = da.
F©S¹SeùÜ
 + ((
št16_t
)
bpb
.
F©s
 * (št16_t)bpb.
SeùÜsP”F©
);

457 
da
.
D©aS¹SeùÜ
 = da.
RoÙDœS¹SeùÜ
 + da.
RoÙDœNumSeùÜs
;

459 
	`RoÙS‘CWD
();

460 
çtsize
 = 
bpb
.
SeùÜsP”F©
 * 
FAT_HARDSECT
;

462 ià(
	`¡rcmp
((*)
bpb
.
Sy¡emID
, "FAT12") == 0)

464 
da
.
F©12Size
 = 
çtsize
;

465 ià((
da
.
F©12
 = (
ušt8_t
 *)
	`m®loc
(da.
F©12Size
)è=ğ
NULL
)

466 
bugout
;

467 ià(
	`»ad£ù
(
da
.
F©S¹SeùÜ
, 
bpb
.
SeùÜsP”F©
, da.
F©12
, da.
F©12Size
) != 0)

468 
bugout
;

469 
da
.
F©Size
 = da.
F©12Size
/1.5*2;

470 ià((
da
.
F©
 = (
ušt8_t
 *)
	`m®loc
(da.
F©Size
)è=ğ
NULL
)

471 
bugout
;

472 
	`CÚv”tF©12to16
(
da
.
F©
, da.
F©12
, da.
F©12Size
/1.5);

476 
da
.
F©Size
 = 
çtsize
;

477 ià((
da
.
F©16
 = (
ušt8_t
 *)
	`m®loc
(da.
F©Size
)è=ğ
NULL
)

478 
bugout
;

479 ià(
	`»ad£ù
(
da
.
F©S¹SeùÜ
, 
bpb
.
SeùÜsP”F©
, da.
F©16
, da.
F©Size
) != 0)

480 
bugout
;

481 ià((
da
.
F©
 = (
ušt8_t
 *)
	`m®loc
(da.
F©Size
)è=ğ
NULL
)

482 
bugout
;

483 
	`memıy
(
da
.
F©
, da.
F©16
, da.
F©Size
);

486 ià(
v”bo£
 > 0)

488 
	`årštf
(
¡d”r
, "FAT s¹ seùÜ=%d\n", 
da
.
F©S¹SeùÜ
);

489 
	`årštf
(
¡d”r
, "roÙ s¹ seùÜ=%d\n", 
da
.
RoÙDœS¹SeùÜ
);

490 
	`årštf
(
¡d”r
, "roÙ‚umb” oà£ùÜs=%d\n", 
da
.
RoÙDœNumSeùÜs
);

491 
	`årštf
(
¡d”r
, "d©¨¡¬ˆ£ùÜ=%d\n", 
da
.
D©aS¹SeùÜ
);

495 
da
.
Wr™ePrÙeù
 = 1;

496 ià(
	`»ad£ù
(
da
.
RoÙDœS¹SeùÜ
+da.
RoÙDœNumSeùÜs
-1, 1, 
dummy
, (dummy)) == 0)

497 ià(
	`wr™e£ù
(
da
.
RoÙDœS¹SeùÜ
+da.
RoÙDœNumSeùÜs
-1, 1, 
dummy
, (dummy)) == 0)

498 
da
.
Wr™ePrÙeù
 = 0;

500 
¡©
 = 0;

502 
bugout
:

503 ià(
¡©
 != 0)

505 ià(
da
.
F©
 !ğ
NULL
)

506 
	`ä“
(
da
.
F©
);

507 ià(
da
.
F©12
 !ğ
NULL
)

508 
	`ä“
(
da
.
F©12
);

509 ià(
da
.
F©16
 !ğ
NULL
)

510 
	`ä“
(
da
.
F©16
);

512  
¡©
;

513 
	}
}

515 
	$F©F»eS·û
()

517 (
	`FšdF»eClu¡”s
(è* 
bpb
.
SeùÜsP”Clu¡”
 * 
FAT_HARDSECT
);

518 
	}
}

520 
	$F©DiskA‰ribu‹s
Ğ
PHOTO_CARD_ATTRIBUTES
 * 
·
 )

522 
	`¡ºıy
Ğ
·
->
OEMID
, 
bpb
.OEMID, 8 );

523 
·
->
By‹sP”SeùÜ
 = 
bpb
.BytesPerSector;

524 
·
->
SeùÜsP”Clu¡”
 = 
bpb
.SectorsPerCluster;

525 
·
->
Re£rvedSeùÜs
 = 
bpb
.ReservedSectors;

526 
·
->
SeùÜsP”F©
 = 
bpb
.SectorsPerFat;

527 
·
->
RoÙEÁr›s
 = 
bpb
.RootEntries;

528 
	`¡ºıy
Ğ
·
->
Sy¡emID
, (*)
bpb
.SystemID, 8 );

529 
	`¡ºıy
Ğ
·
->
VŞumeLab–
, (*)
bpb
.VolumeLabel, 11 );

530 
·
->
Wr™ePrÙeù
 = 
da
.WriteProtect;

533 
	}
}

536 
	$F©Li¡Dœ
()

538 
»t
, 
f’um
;

539 
ä“¥aû
;

541 ià(
v”bo£
 > 0)

543 
ä“¥aû
 = 
	`F©F»eS·û
();

544 
	`årštf
(
¡dout
, "F»S·û=%d by‹s\n", 
ä“¥aû
);

547 
f’um
 = 0;

550 
»t
 = 
	`LßdFeInCWD
(
f’um
);

551 ià(
»t
 =ğ
FAT_END_OF_DIR
)

553 
	`åuts
("<EOD>\n", 
¡dout
);

556 ià((
»t
 !ğ
FAT_FILE_DELETED
è&& (»ˆ!ğ
FAT_LONG_FILENAME
))

557 
	`PrštCu¼FeInfo
();

558 
f’um
++;

561 
	}
}

564 
	gçtdœ_f’um
 = 0;

566 
	$F©DœBegš
(
FILE_ATTRIBUTES
 *
a
)

568 
çtdœ_f’um
 = 0;

569  
	`F©DœNext
Ğ
a
 );

570 
	}
}

572 
	$F©DœNext
(
FILE_ATTRIBUTES
 *
a
)

574 
»t
;

575 
»t
 = 
	`LßdFeInCWD
Ğ
çtdœ_f’um
 );

577 ifĞ
»t
 =ğ
FAT_END_OF_DIR
 )

580 ià((
»t
 !ğ
FAT_FILE_DELETED
è&& (»ˆ!ğ
FAT_LONG_FILENAME
))

582 
	`¡rıy
Ğ
a
->
Name
, 
ç
.Name );

584 ifĞ
ç
.
A‰r
 =ğ
FAT_IS_DIR
 )

585 
a
->
A‰r
 = 'd';

587 
a
->
A‰r
 = ' ';

589 
a
->
Size
 = 
ç
.Size;

593 
	`¡rıy
Ğ
a
->
Name
, "" );

594 
a
->
A‰r
 = 'x';

595 
a
->
Size
 = 0;

598 
çtdœ_f’um
++;

600 
	}
}

603 
	$F©R—dFe
(*
Çme
, 
fd
)

605 
ušt8_t
 *
buf
=
NULL
;

606 
şu¡”
, 
£ùÜ
, 
Şd
;

607 
block
 = 
bpb
.
SeùÜsP”Clu¡”
 * 
FAT_HARDSECT
;

608 
i
, 
n
, 
tÙ®
 = 0;

610 ià(
	`LßdFeW™hName
(
Çme
) != 0)

611 
bugout
;

613 
şu¡”
 = 
ç
.
S¹Clu¡”
;

614 
£ùÜ
 = 
	`CÚv”tClu¡”ToSeùÜ
(
şu¡”
);

616 ià((
buf
 = 
	`m®loc
(
block
)è=ğ
NULL
)

618 
bugout
;

621 
i
=0; i<
ç
.
Size
; i+=
n
)

623 ià(
	`»ad£ù
(
£ùÜ
, 
bpb
.
SeùÜsP”Clu¡”
, 
buf
, 
block
) != 0)

625 
tÙ®
 = -1;

626 
bugout
;

629 
n
 = 
ç
.
Size
-
i
 > 
block
 ? block : fa.Size-i;

630 
	`wr™e
(
fd
, 
buf
, 
n
);

632 
tÙ®
 +ğ
n
;

633 
Şd
 = 
şu¡”
;

634 
şu¡”
 = 
	`G‘NextClu¡”
(cluster);

635 ià(
şu¡”
 >= 0xfff7 || cluster == 0)

638 
£ùÜ
 = 
	`CÚv”tClu¡”ToSeùÜ
(
şu¡”
);

641 
bugout
:

642 ià(
buf
 !ğ
NULL
)

643 
	`ä“
(
buf
);

645  
tÙ®
;

646 
	}
}

649 
	$F©R—dFeExt
(*
Çme
, 
off£t
, 
Ën
, *
outbuf
)

651 
ušt8_t
 *
buf
=
NULL
;

652 
şu¡”
, 
£ùÜ
, 
Şd
;

653 
block
 = 
bpb
.
SeùÜsP”Clu¡”
 * 
FAT_HARDSECT
;

654 
i
, 
n
, 
tÙ®
 = 0, 
btÙ®
 = 0;

655 
bn
, 
boff
, 
bËn
;

656 
b1
 = 
off£t
 / 
block
;

657 
b2
 = (
off£t
+
Ën
è/ 
block
;

659 ià(
	`LßdFeW™hName
(
Çme
) != 0)

660 
bugout
;

662 
şu¡”
 = 
ç
.
S¹Clu¡”
;

663 
£ùÜ
 = 
	`CÚv”tClu¡”ToSeùÜ
(
şu¡”
);

665 ià((
buf
 = 
	`m®loc
(
block
)è=ğ
NULL
)

667 
bugout
;

670 
i
=0, 
bn
=0; i<
ç
.
Size
; i+=
n
, bn++)

673 
n
 = 
ç
.
Size
-
i
 > 
block
 ? block : fa.Size-i;

676 ià(
bn
 >ğ
b1
)

678 ià(
	`»ad£ù
(
£ùÜ
, 
bpb
.
SeùÜsP”Clu¡”
, 
buf
, 
block
) != 0)

680 
tÙ®
 = -1;

681 
bugout
;

684 ià(
bn
 =ğ
b1
)

685 
boff
 = 
off£t
-
tÙ®
;

687 
boff
 = 0;

689 ià(
bn
 <ğ
b2
)

691 ià(
bn
 =ğ
b2
)

692 
bËn
 = (
off£t
+
Ën
)-
tÙ®
-
boff
;

694 
bËn
 = 
n
-
boff
;

696 
	`memıy
(
outbuf
+
btÙ®
, 
buf
+
boff
, 
bËn
);

697 
btÙ®
 +ğ
bËn
;

703 
tÙ®
 +ğ
n
;

704 
Şd
 = 
şu¡”
;

705 
şu¡”
 = 
	`G‘NextClu¡”
(cluster);

706 ià(
şu¡”
 >= 0xfff7 || cluster == 0)

709 
£ùÜ
 = 
	`CÚv”tClu¡”ToSeùÜ
(
şu¡”
);

712 
bugout
:

713 ià(
buf
 !ğ
NULL
)

714 
	`ä“
(
buf
);

716  
btÙ®
;

717 
	}
}

720 
	$F©S‘CWD
(*
dœ
)

722 
»t
;

724 ià(
dœ
[0] == '.')

727 ià(
dœ
[0] == '/')

729 
	`RoÙS‘CWD
();

733 ià(
	`¡rcmp
(
cwd
.
Name
, 
dœ
) == 0)

736 
»t
 = 
	`LßdFeW™hName
(
dœ
);

737 ià(
»t
 != 0)

738  
»t
;

740 ià(!(
ç
.
A‰r
 & 
FAT_IS_DIR
))

743 
	`¡ºıy
(
cwd
.
Name
, 
ç
.Name, (cwd.Name));

744 
cwd
.
S¹SeùÜ
 = 
	`CÚv”tClu¡”ToSeùÜ
(
ç
.
S¹Clu¡”
);

745 
cwd
.
Cu¼SeùÜ
 = cwd.
S¹SeùÜ
;

746 
cwd
.
S¹Clu¡”
 = 
ç
.StartCluster;

748 
	}
}

750 
	$F©D–‘eFe
(*
Çme
)

752 
ušt8_t
 
buf
[
FAT_HARDSECT
];

753 
ušt16_t
 *
pçt
 = (ušt16_ˆ*)
da
.
F©
;

754 
şu¡”
, 
Ãxt_şu¡”
, 
f’um
, 
¡©
=1;

756 ià(
	`LßdFeW™hName
(
Çme
) != 0)

757 
bugout
;

759 
şu¡”
 = 
ç
.
S¹Clu¡”
;

762 (
şu¡”
 <= 0xFFF8) && (cluster != 0x0000))

764 
Ãxt_şu¡”
 = *(
pçt
+
şu¡”
);

765 *(
pçt
+
şu¡”
) = 0;

766 
şu¡”
 = 
Ãxt_şu¡”
;

770 
	`»ad£ù
(
ç
.
DœSeùÜNum
, 1, 
buf
, (buf));

771 
f’um
 = 
ç
.
DœEÁryNum
 & 0x000F;

772 
f’um
 <<= 4;

773 
buf
[
f’um
 * 2] = 
FAT_FILE_DELETED
;

774 ià(
	`wr™e£ù
(
ç
.
DœSeùÜNum
, 1, 
buf
, (buf)) != 0)

775 
bugout
;

778 ià(
	`Upd©eF©
() != 0)

779 
bugout
;

781 
¡©
 = 0;

783 
bugout
:

784  
¡©
;

785 
	}
}

	@pcard/fat.h

22 #iâdeà
_FAT_H


23 
	#_FAT_H


	)

25 
	#FAT_HARDSECT
 512

	)

30 
	#FAT_BLKSIZE
 3

	)

34 
	mName
[16];

35 
	mA‰r
;

36 
	mSize
;

37 } 
	tFILE_ATTRIBUTES
;

41 
	mOEMID
[8];

42 
	mBy‹sP”SeùÜ
;

43 
	mSeùÜsP”Clu¡”
;

44 
	mRe£rvedSeùÜs
;

45 
	mRoÙEÁr›s
;

46 
	mSeùÜsP”F©
;

47 
	mVŞumeLab–
[11];

48 
	mSy¡emID
[8];

49 
	mWr™ePrÙeù
;

50 } 
	tPHOTO_CARD_ATTRIBUTES
;

53 
F©In™
();

54 
F©Li¡Dœ
();

55 
F©R—dFe
(*
Çme
, 
fd
);

56 
F©R—dFeExt
(*
Çme
, 
off£t
, 
Ën
, *
outbuf
);

57 
F©S‘CWD
(*
dœ
);

58 
F©D–‘eFe
(*
Çme
);

59 
F©F»eS·û
();

60 
F©DœBegš
(
FILE_ATTRIBUTES
 * 
a
);

61 
F©DœNext
(
FILE_ATTRIBUTES
 * 
a
);

62 
F©DiskA‰ribu‹s
(
PHOTO_CARD_ATTRIBUTES
 * 
·
);

65 
R—dSeùÜ
(
£ùÜ
, 
n£ùÜ
, *
buf
, 
size
);

66 
Wr™eSeùÜ
(
£ùÜ
, 
n£ùÜ
, *
buf
, 
size
);

68 
v”bo£
;

70 #ià
defšed
(
WORDS_BIGENDIAN
)

71 
	#h2l™s
(
A
è((((
ušt16_t
)(Aè& 0xff00è>> 8è| (((ušt16_t)(Aè& 0x00ffè<< 8)è

	)

72 
	#l™2hs
 
h2l™s


	)

75 
	#h2l™s
(
A
è(A)

	)

76 
	#l™2hs
(
A
è(A)

	)

	@pcard/pcardext/pcardext.c

27 
	~<PythÚ.h
>

28 
	~<¡ruùmemb”.h
>

29 
	~"../çt.h
"

33 #ià
PY_VERSION_HEX
 < 0x02050000

34 
	tPy_ssize_t
;

35 
	#PY_SSIZE_T_MAX
 
INT_MAX


	)

36 
	#PY_SSIZE_T_MIN
 
INT_MIN


	)

39 
	gv”bo£
=0;

41 
PyObjeù
 * 
	g»ad£ùÜFunc
 = 
NULL
;

42 
PyObjeù
 * 
	gwr™e£ùÜFunc
 = 
NULL
;

44 
	$R—dSeùÜ
(
£ùÜ
, 
n£ùÜ
, *
buf
, 
size
)

46 
PyObjeù
 * 
»suÉ
;

47 * 
»suÉ_¡r
;

49 ifĞ
»ad£ùÜFunc
 )

51 ifĞ
n£ùÜ
 <ğ0 || (n£ùÜ*
FAT_HARDSECT
è> 
size
 ||‚£ùÜ > 
FAT_BLKSIZE
 )

52 
abÜt
;

54 
»suÉ
 = 
	`PyObjeù_C®lFunùiÚ
Ğ
»ad£ùÜFunc
, "ii", 
£ùÜ
, 
n£ùÜ
 );

56 ifĞ
»suÉ
 )

58 
Py_ssize_t
 
Ën
 = 0;

59 
	`PySŒšg_AsSŒšgAndSize
Ğ
»suÉ
, &
»suÉ_¡r
, &
Ën
 );

61 ifĞ
Ën
 < 
n£ùÜ
*
FAT_HARDSECT
 )

63 
abÜt
;

66 
	`memıy
Ğ
buf
, 
»suÉ_¡r
, 
n£ùÜ
*
FAT_HARDSECT
 );

71 
abÜt
:

73 
	}
}

75 
	$Wr™eSeùÜ
(
£ùÜ
, 
n£ùÜ
, *
buf
, 
size
 )

77 
PyObjeù
 * 
»suÉ
;

79 ifĞ
wr™e£ùÜFunc
 )

81 
»suÉ
 = 
	`PyObjeù_C®lFunùiÚ
Ğ
wr™e£ùÜFunc
, "iis#", 
£ùÜ
, 
n£ùÜ
, 
buf
, 
size
 );

83  
	`PyIÁ_AS_LONG
Ğ
»suÉ
 );

87 
	}
}

90 
PyObjeù
 * 
	$pÿrdext_mouÁ
Ğ
PyObjeù
 * 
£lf
, PyObjeù * 
¬gs
 )

92 ifĞ!
	`PyArg_P¬£Tu¶e
Ğ
¬gs
, "OO", &
»ad£ùÜFunc
, &
wr™e£ùÜFunc
 ) )

94  
	`Py_BudV®ue
( "i", 1 );

97 ifĞ!
	`PyC®ÏbË_Check
Ğ
»ad£ùÜFunc
 ) || !PyC®ÏbË_CheckĞ
wr™e£ùÜFunc
 ) )

99  
	`Py_BudV®ue
( "i", 2 );

102 
	`Py_INCREF
Ğ
»ad£ùÜFunc
 );

103 
	`Py_INCREF
Ğ
wr™e£ùÜFunc
 );

105 
i
 = 
	`F©In™
();

110  
	`Py_BudV®ue
Ğ"i", 
i
 );

111 
	}
}

114 
PyObjeù
 * 
	$pÿrdext_df
Ğ
PyObjeù
 * 
£lf
, PyObjeù * 
¬gs
 )

116  
	`Py_BudV®ue
Ğ"i", 
	`F©F»eS·û
() );

117 
	}
}

120 
PyObjeù
 * 
	$pÿrdext_ls
Ğ
PyObjeù
 * 
£lf
, PyObjeù * 
¬gs
 )

122 
PyObjeù
 * 
fe_li¡
;

123 
fe_li¡
 = 
	`PyLi¡_New
((
Py_ssize_t
)0);

124 
FILE_ATTRIBUTES
 
ç
;

126 
	`F©DœBegš
Ğ&
ç
 );

130 ifĞ
ç
.
A‰r
 != 'x' )

131 
	`PyLi¡_Aµ’d
Ğ
fe_li¡
, 
	`Py_BudV®ue
Ğ"(sci)", 
ç
.
Name
, fa.
A‰r
, fa.
Size
 ) );

133 }  
	`F©DœNext
Ğ&
ç
 ) );

135  
fe_li¡
;

136 
	}
}

139 
PyObjeù
 * 
	$pÿrdext_ı
Ğ
PyObjeù
 * 
£lf
, PyObjeù * 
¬gs
 )

141 * 
Çme
;

142 
f’o
 = 0;

144 ifĞ!
	`PyArg_P¬£Tu¶e
Ğ
¬gs
, "si", &
Çme
, &
f’o
 ) )

146  
	`Py_BudV®ue
( "i", 0 );

149  
	`Py_BudV®ue
Ğ"i", 
	`F©R—dFe
Ğ
Çme
, 
f’o
 ) );

150 
	}
}

152 
PyObjeù
 * 
	$pÿrdext_cd
Ğ
PyObjeù
 * 
£lf
, PyObjeù * 
¬gs
 )

154 * 
dœ
;

156 ifĞ!
	`PyArg_P¬£Tu¶e
Ğ
¬gs
, "s", &
dœ
 ) )

158  
	`Py_BudV®ue
( "i", 0 );

161 
	`F©S‘CWD
Ğ
dœ
 );

163  
	`Py_BudV®ue
( "i", 1 );

164 
	}
}

166 
PyObjeù
 * 
	$pÿrdext_rm
Ğ
PyObjeù
 * 
£lf
, PyObjeù * 
¬gs
 )

168 * 
Çme
;

169 ifĞ!
	`PyArg_P¬£Tu¶e
Ğ
¬gs
, "s", &
Çme
 ) )

171  
	`Py_BudV®ue
( "i", 0 );

174  
	`Py_BudV®ue
Ğ"i", 
	`F©D–‘eFe
Ğ
Çme
 ) );

175 
	}
}

177 
PyObjeù
 * 
	$pÿrdext_umouÁ
Ğ
PyObjeù
 * 
£lf
, PyObjeù * 
¬gs
 )

179  
	`Py_BudV®ue
( "" );

180 
	}
}

182 
PyObjeù
 * 
	$pÿrdext_šfo
Ğ
PyObjeù
 * 
£lf
, PyObjeù * 
¬gs
 )

184 
PHOTO_CARD_ATTRIBUTES
 
·
;

185 
	`F©DiskA‰ribu‹s
Ğ&
·
 );

187  
	`Py_BudV®ue
Ğ"(siiiiissi)", 
·
.
OEMID
,…a.
By‹sP”SeùÜ
,…a.
SeùÜsP”Clu¡”
,…a.
Re£rvedSeùÜs
,

188 
·
.
RoÙEÁr›s
,…a.
SeùÜsP”F©
,…a.
VŞumeLab–
,…a.
Sy¡emID
,

189 
·
.
Wr™ePrÙeù
 );

190 
	}
}

192 
PyObjeù
 * 
	$pÿrdext_»ad
Ğ
PyObjeù
 * 
£lf
, PyObjeù * 
¬gs
 )

194 * 
Çme
;

195 
off£t
 = 0;

196 
Py_ssize_t
 
Ën
 = 0;

197 * 
bufãr
;

199 ifĞ!
	`PyArg_P¬£Tu¶e
Ğ
¬gs
, "sii", &
Çme
, &
off£t
, &
Ën
 ) )

201  
	`Py_BudV®ue
( "s", "" );

204 
bufãr
 = 
	`®loÿ
Ğ
Ën
 );

206 ifĞ
	`F©R—dFeExt
Ğ
Çme
, 
off£t
, 
Ën
, 
bufãr
 ) ==†en )

208  
	`PySŒšg_FromSŒšgAndSize
Ğ(*)
bufãr
, 
Ën
 );

212  
	`Py_BudV®ue
( "s", "" );

216 
	}
}

219 
PyM‘hodDef
 
	gpÿrdext_m‘hods
[] =

221 { "mouÁ", (
PyCFunùiÚ
)
pÿrdext_mouÁ
, 
METH_VARARGS
 },

222 { "ls", (
PyCFunùiÚ
)
pÿrdext_ls
, 
METH_VARARGS
 },

223 { "ı", (
PyCFunùiÚ
)
pÿrdext_ı
, 
METH_VARARGS
 },

224 { "cd", (
PyCFunùiÚ
)
pÿrdext_cd
, 
METH_VARARGS
 },

225 { "rm", (
PyCFunùiÚ
)
pÿrdext_rm
, 
METH_VARARGS
 },

226 { "umouÁ", (
PyCFunùiÚ
)
pÿrdext_umouÁ
, 
METH_VARARGS
 },

227 { "df", (
PyCFunùiÚ
)
pÿrdext_df
, 
METH_VARARGS
 },

228 { "šfo", (
PyCFunùiÚ
)
pÿrdext_šfo
, 
METH_VARARGS
 },

229 { "»ad", (
PyCFunùiÚ
)
pÿrdext_»ad
, 
METH_VARARGS
 },

230 { 
NULL
, NULL }

234 
	gpÿrdext_docum’tiÚ
[] = "Pythonƒxtension for HP…hotocard services";

236 
	$š™pÿrdext
( )

238 
PyObjeù
 * 
mod
 = 
	`Py_In™ModuË4
Ğ"pÿrdext", 
pÿrdext_m‘hods
,

239 
pÿrdext_docum’tiÚ
, (
PyObjeù
*)
NULL
,

240 
PYTHON_API_VERSION
 );

242 ià(
mod
 =ğ
NULL
)

244 
	}
}

	@pcard/ptest.c

23 
	~<sys/¡©.h
>

24 
	~<sys/sock‘.h
>

25 
	~<sys/ioùl.h
>

26 
	~<sys/ty³s.h
>

27 
	~<Ãtš‘/š.h
>

28 
	~<Ãtdb.h
>

29 
	~<¡dio.h
>

30 
	~<¡dlib.h
>

31 
	~<fú.h
>

32 
	~<¡ršg.h
>

33 
	~<uni¡d.h
>

34 
	~<sy¦og.h
>

35 
	~<¡d¬g.h
>

36 
	~<sigÇl.h
>

37 
	~<¬·/š‘.h
>

38 
	~<”ºo.h
>

39 
	~<ùy³.h
>

40 
	~"±e¡.h
"

41 
	~"çt.h
"

42 
	~"hpmud.h
"

44 
	#EXCEPTION_TIMEOUT
 45

	)

45 
	#DEV_ACK
 0x0100

	)

49 
	mcmd
;

50 
	mn£ùÜ
;

51 } 
	t__©Œibu‹__
((
	t·cked
)è
	tCMD_READ_REQUEST
;

54 
	mcmd
;

55 
	mn£ùÜ
;

56 
	mcs
;

57 } 
	t__©Œibu‹__
((
	t·cked
)è
	tCMD_WRITE_REQUEST
;

61 
	mcmd
;

62 
ušt32_t
 
	mn£ùÜ
;

63 
	mv”
;

64 } 
	t__©Œibu‹__
((
	t·cked
)è
	tRESPONSE_SECTOR
;

66 
	ghd
=-1, 
	gchªÃl
=-1;

68 
	gv”bo£
=0;

70 
	$bug
(cÚ¡ *
fmt
, ...)

72 
buf
[256];

73 
va_li¡
 
¬gs
;

74 
n
;

76 
	`va_¡¬t
(
¬gs
, 
fmt
);

78 ià((
n
 = 
	`v¢´štf
(
buf
, 256, 
fmt
, 
¬gs
)) == -1)

79 
buf
[255] = 0;

81 
	`årštf
(
¡d”r
, "%s", 
buf
);

82 
	`sy¦og
(
LOG_WARNING
, "%s", 
buf
);

84 
	`fæush
(
¡d”r
);

85 
	`va_’d
(
¬gs
);

86  
n
;

87 
	}
}

89 
	$Ï¡_¦ash
(cÚ¡ *
·th
, *
numb”_found
, *
·th_size
)

91 
i
, 
found
=0, 
Ï¡i
=0;

94 
i
=0; 
·th
[i] && i<
HPMUD_LINE_SIZE
; i++)

95 ià(
·th
[
i
] == '/')

97 
found
++;

98 
Ï¡i
=
i
;

101 *
numb”_found
 = 
found
;

102 *
·th_size
 = 
i
;

104  
Ï¡i
;

105 
	}
}

107 
	$Áh_¦ash
(cÚ¡ *
·th
, 
n
)

109 
i
, 
found
=0, 
Ï¡i
=0;

112 
i
=0; 
·th
[i] && i<
HPMUD_LINE_SIZE
; i++)

113 ià(
·th
[
i
] == '/')

115 
found
++;

116 
Ï¡i
=
i
;

117 ià(
found
 =ğ
n
)

121  
Ï¡i
;

122 
	}
}

124 *
	$ba£Çme
(cÚ¡ *
·th
)

126 
Ën
, 
found
=0, 
¦ash_šdex
=0;

128 
¦ash_šdex
 = 
	`Ï¡_¦ash
(
·th
, &
found
, &
Ën
);

129  
found
 ? (*)
·th
+
¦ash_šdex
+1 : (*)path;

130 
	}
}

132 
	$dœÇme
(cÚ¡ *
·th
, *
dœ
)

134 
Ën
, 
found
=0, 
¦ash_šdex
=0;

136 
¦ash_šdex
 = 
	`Ï¡_¦ash
(
·th
, &
found
, &
Ën
);

138 ià(
found
 == 0)

139 
	`¡rıy
(
dœ
, ".");

140 ià(
·th
[
¦ash_šdex
+1]==0 && 
found
==1)

141 
	`¡rıy
(
dœ
, "/");

142 ià(
·th
[
¦ash_šdex
+1]==0 && 
found
>1)

144 
¦ash_šdex
 = 
	`Áh_¦ash
(
·th
, 
found
-1);

145 
	`¡ºıy
(
dœ
, 
·th
, 
¦ash_šdex
);

146 
dœ
[
¦ash_šdex
]=0;

150 
	`¡ºıy
(
dœ
, 
·th
, 
¦ash_šdex
);

151 
dœ
[
¦ash_šdex
]=0;

153  
¦ash_šdex
;

154 
	}
}

156 
	$G‘Dœ
(*
·th
, *
dœ
, **

)

158 
i
=0;

160 
dœ
[0] = 0;

162 ià(
·th
[0] == 0)

164 
	`¡rıy
(
dœ
, ".");

165 
i
 = 0;

167 ià((
·th
[0] =ğ'/'è&& (*

 !=…ath))

169 
	`¡rıy
(
dœ
, "/");

170 
i
=1;

174 
i
=0; 
·th
[i] && (·th[i] !ğ'/'è&& (i<
HPMUD_LINE_SIZE
); i++)

175 
dœ
[
i
] = 
·th
[i];

176 ià(
i
==0)

177 
	`¡rıy
(
dœ
, ".");

179 
dœ
[
i
] = 0;

180 ià(
·th
[
i
] == '/')

181 
i
++;

184 ià(

 !ğ
NULL
)

185 *

 = 
·th
 + 
i
;

187  
i
;

188 
	}
}

190 
	$g‘_uri
(*
uri
, 
urisize
)

192 
buf
[
HPMUD_LINE_SIZE
*64];

193 
i
=0, 
út
, 
by‹s_»ad
;

194 *
pBeg
;

196 
uri
[0] = 0;

198 
	`hpmud_´obe_deviûs
(
HPMUD_BUS_USB
, 
buf
, (buf), &
út
, &
by‹s_»ad
);

201 ià(
út
 > 0)

203 
pBeg
 = 
	`¡r¡r
(
buf
, "hp:");

204 
i
=0; *
pBeg
 !ğ' ' && (˜< 
urisize
); i++,…Beg++)

205 
uri
[
i
] = *
pBeg
;

206 
uri
[
i
] = 0;

209  
i
;

210 
	}
}

212 
	$R—dSeùÜ
(
£ùÜ
, 
n£ùÜ
, *
buf
, 
size
)

214 
mes§ge
[
HPMUD_BUFFER_SIZE
];

215 
i
, 
Ën
, 
¾’
, 
wËn
, 
¡©
=1, 
tÙ®
=0;

216 
CMD_READ_REQUEST
 *
pC
;

217 
RESPONSE_SECTOR
 *
pR
;

218 
ušt32_t
 *
pSeù
;

219 
cmd
=0x0010;

221 ià(
n£ùÜ
 <ğ0 || (n£ùÜ*
FAT_HARDSECT
è> 
size
)

223 
	`bug
("R—dSeùÜ inv®id seùÜ couÁ=%d\n", 
n£ùÜ
);

224 
bugout
;

228 
pC
 = (
CMD_READ_REQUEST
 *)
mes§ge
;

229 
pC
->
cmd
 = 
	`htÚs
(cmd);

230 
pC
->
n£ùÜ
 = 
	`htÚs
(nsector);

231 
pSeù
 = (
ušt32_t
 *)(
mes§ge
 + (
CMD_READ_REQUEST
));

232 
i
=0; i<
n£ùÜ
; i++)

233 *
pSeù
++ = 
	`htÚl
(
£ùÜ
+
i
);

234 
wËn
 = (
CMD_READ_REQUEST
)+(4*
n£ùÜ
);

235 
	`hpmud_wr™e_chªÃl
(
hd
, 
chªÃl
, 
mes§ge
, 
wËn
, 
EXCEPTION_TIMEOUT
, &
Ën
);

238 
	`mem£t
(
mes§ge
, 0, (
RESPONSE_SECTOR
));

239 
¾’
 = (
RESPONSE_SECTOR
);

240 
	`hpmud_»ad_chªÃl
(
hd
, 
chªÃl
, 
mes§ge
, 
¾’
, 
EXCEPTION_TIMEOUT
, &
Ën
);

241 
pR
 = (
RESPONSE_SECTOR
 *)
mes§ge
;

242 ià(
	`Áohs
(
pR
->
cmd
è!ğ(cmd | 
DEV_ACK
))

244 
	`bug
("R—dSeùÜ inv®id„e¥Ú£ h—d” cmd=%xƒx³ùed=%x\n", 
	`Áohs
(
pR
->
cmd
), cmd | 
DEV_ACK
);

245 
bugout
;

248 ià(
v”bo£
 > 0)

250 
út
=0;

251 ià(
út
++ < 1)

252 
	`årštf
(
¡d”r
, "phÙØÿrd fœmw¬v”siÚ=%x\n", 
	`Áohs
(
pR
->
v”
));

256 
¾’
 = 
n£ùÜ
*
FAT_HARDSECT
;

257 
tÙ®
 < 
¾’
)

259 
	`hpmud_»ad_chªÃl
(
hd
, 
chªÃl
, 
buf
+
tÙ®
, 
¾’
, 
EXCEPTION_TIMEOUT
, &
Ën
);

260 ià(
Ën
 == 0)

262 
tÙ®
+=
Ën
;

265 ià(
tÙ®
 !ğ
¾’
)

267 
	`bug
("R—dSeùÜ inv®id„e¥Ú£ d©¨Ën=%dƒx³ùed=%d\n", 
tÙ®
, 
¾’
);

268 
bugout
;

271 
¡©
 = 0;

273 
bugout
:

274  
¡©
;

275 
	}
}

277 
	$Wr™eSeùÜ
(
£ùÜ
, 
n£ùÜ
, *
buf
, 
size
)

279 
mes§ge
[
HPMUD_BUFFER_SIZE
];

280 
i
, 
Ën
, 
wËn
, 
¡©
=1;

281 
CMD_WRITE_REQUEST
 *
pC
;

282 
ušt32_t
 *
pSeù
;

283 
»¥Ú£
=0, 
cmd
=0x0020;

285 ià(
n£ùÜ
 <ğ0 || (n£ùÜ*
FAT_HARDSECT
è> 
size
)

287 
	`bug
("Wr™eSeùÜ inv®id seùÜ couÁ=%d\n", 
n£ùÜ
);

288 
bugout
;

292 
pC
 = (
CMD_WRITE_REQUEST
 *)
mes§ge
;

293 
pC
->
cmd
 = 
	`htÚs
(cmd);

294 
pC
->
n£ùÜ
 = 
	`htÚs
(nsector);

295 
pC
->
cs
 = 0;

296 
pSeù
 = (
ušt32_t
 *)(
mes§ge
 + (
CMD_WRITE_REQUEST
));

297 
i
=0; i<
n£ùÜ
; i++)

298 *
pSeù
++ = 
	`htÚl
(
£ùÜ
+
i
);

299 
wËn
 = (
CMD_WRITE_REQUEST
)+(4*
n£ùÜ
);

300 
	`hpmud_wr™e_chªÃl
(
hd
, 
chªÃl
, 
mes§ge
, 
wËn
, 
EXCEPTION_TIMEOUT
, &
Ën
);

303 
	`hpmud_wr™e_chªÃl
(
hd
, 
chªÃl
, 
buf
, 
size
, 
EXCEPTION_TIMEOUT
, &
Ën
);

306 
	`hpmud_»ad_chªÃl
(
hd
, 
chªÃl
, &
»¥Ú£
, Ôe¥Ú£), 
EXCEPTION_TIMEOUT
, &
Ën
);

307 ià(
	`Áohs
(
»¥Ú£
è!ğ
DEV_ACK
)

309 
	`bug
("Wr™eSeùÜ inv®id„e¥Ú£ cmd=%xƒx³ùed=%x\n", 
	`Áohs
(
»¥Ú£
), 
DEV_ACK
);

310 
bugout
;

312 
¡©
 = 0;

314 
bugout
:

315  
¡©
;

316 
	}
}

318 
	$u§ge
()

320 
	`årštf
(
¡dout
, "HP MFP PhÙØC¬d FMªag” %s\n", 
VERSION
);

321 
	`årštf
(
¡dout
, "(c) 2004-2007 Copyright HP Development Company, LP\n");

322 
	`årštf
(
¡dout
, "usage:…test [-v] [-u uri] -c†s [-p…ath] (list directory)\n");

323 
	`årštf
(
¡dout
, "…test [-v] [-u uri] -c„ead -p…ath (read fileo stdout)\n");

324 
	`årštf
(
¡dout
, "…test [-v] [-u uri] -c„m -p…ath (delete file)\n");

326 
	}
}

328 
	$maš
(
¬gc
, *
¬gv
[])

330 
cmd
[16] = "", 
·th
[
HPMUD_LINE_SIZE
]="", 
uri
[HPMUD_LINE_SIZE]="", 
dœ
[HPMUD_LINE_SIZE]="", 
¥©h
[HPMUD_LINE_SIZE]="";

331 *
İrg
;

332 *

;

333 
i
, 
¡©
=-1;

334 
PHOTO_CARD_ATTRIBUTES
 
·
;

335 
hpmud_mod–_©Œibu‹s
 
ma
;

337 (
i
 = 
	`g‘İt
(
¬gc
, 
¬gv
, "vhu:c:p:")) != -1)

339 
i
)

342 
	`¡ºıy
(
cmd
, 
İrg
, (cmd));

345 
	`¡ºıy
(
·th
, 
İrg
, (path));

348 
	`¡ºıy
(
uri
, 
İrg
, (uri));

351 
v”bo£
++;

354 
	`u§ge
();

355 
	`ex™
(0);

357 
	`u§ge
();

358 
	`årštf
(
¡d”r
, "unknowÀ¬gum’t: %s\n", 
¬gv
[1]);

359 
	`ex™
(-1);

365 ià(
uri
[0] == 0)

366 
	`g‘_uri
(
uri
, (uri));

367 ià(
uri
[0] == 0)

369 
	`bug
("no uri found\n");

370 
bugout
;

374 
	`hpmud_qu”y_mod–
(
uri
, &
ma
);

376 ià(
	`hpmud_İ’_deviû
(
uri
, 
ma
.
må_mode
, &
hd
è!ğ
HPMUD_R_OK
)

378 
	`bug
("uÇbËØİ’ deviû %s\n", 
uri
);

379 
bugout
;

381 ià(
	`hpmud_İ’_chªÃl
(
hd
, "HP-CARD-ACCESS", &
chªÃl
è!ğ
HPMUD_R_OK
)

383 
	`bug
("uÇbËØİ’ hp-ÿrd-acûs chªÃÈ%s\n", 
uri
);

384 
bugout
;

387 ià(
	`F©In™
() != 0)

389 
	`bug
("uÇbËØ»ad…hÙØÿrd %s\n", 
uri
);

390 
bugout
;

393 
	`F©DiskA‰ribu‹s
(&
·
);

396 ià(
·
.
Wr™ePrÙeù
)

398 
	`hpmud_şo£_chªÃl
(
hd
, 
chªÃl
);

399 ià(
	`hpmud_İ’_chªÃl
(
hd
, "HP-CARD-ACCESS", &
chªÃl
è!ğ
HPMUD_R_OK
)

401 
	`bug
("uÇbËØİ’ hp-ÿrd-acûs chªÃÈ%s\n", 
uri
);

402 
bugout
;

406 ià(
	`¡rÿ£cmp
(
cmd
, "ls") == 0)

409 
	`G‘Dœ
(
·th
, 
dœ
, &

);

410 
	`F©S‘CWD
(
dœ
);

411 

[0] != 0)

413 
	`G‘Dœ
(

, 
dœ
, &tail);

414 
	`F©S‘CWD
(
dœ
);

416 
	`F©Li¡Dœ
();

418 ià(
	`¡rÿ£cmp
(
cmd
, "read") == 0)

420 
	`dœÇme
(
·th
, 
¥©h
);

421 
	`G‘Dœ
(
¥©h
, 
dœ
, &

);

422 
	`F©S‘CWD
(
dœ
);

423 

[0] != 0)

425 
	`G‘Dœ
(

, 
dœ
, &tail);

426 
	`F©S‘CWD
(
dœ
);

428 ià((
	`F©R—dFe
(
	`ba£Çme
(
·th
), 
STDOUT_FILENO
)) <= 0)

430 
	`bug
("uÇbËØloÿ‹ f%s\n", 
·th
);

431 
bugout
;

434 ià(
	`¡rÿ£cmp
(
cmd
, "rm") == 0)

436 
	`dœÇme
(
·th
, 
¥©h
);

437 
	`G‘Dœ
(
¥©h
, 
dœ
, &

);

438 
	`F©S‘CWD
(
dœ
);

439 

[0] != 0)

441 
	`G‘Dœ
(

, 
dœ
, &tail);

442 
	`F©S‘CWD
(
dœ
);

444 ià(
	`F©D–‘eFe
(
	`ba£Çme
(
·th
)) != 0)

446 
	`bug
("uÇbËØloÿ‹ f%s\n", 
·th
);

447 
bugout
;

452 
	`u§ge
();

453 
bugout
;

456 
¡©
 = 0;

458 
bugout
:

459 ià(
chªÃl
 >= 0)

460 
	`hpmud_şo£_chªÃl
(
hd
, 
chªÃl
);

461 ià(
hd
 >= 0)

462 
	`hpmud_şo£_deviû
(
hd
);

464 
	`ex™
 (
¡©
);

465 
	}
}

	@pcard/ptest.h

22 #iâdeà
_PTEST_H


23 
	#_PTEST_H


	)

25 
bug
(cÚ¡ *
fmt
, ...);

26 
sysdump
(*
d©a
, 
size
);

	@prnt/backend/hp.c

26 #iâdeà
_GNU_SOURCE


27 
	#_GNU_SOURCE


	)

30 
	~<sys/ty³s.h
>

31 
	~<sys/¡©.h
>

32 
	~<Ãtš‘/š.h
>

33 
	~<Ãtdb.h
>

34 
	~<¡dio.h
>

35 
	~<¡dlib.h
>

36 
	~<fú.h
>

37 
	~<¡ršg.h
>

38 
	~<uni¡d.h
>

39 
	~<¡d¬g.h
>

40 
	~<sy¦og.h
>

41 
	~<ùy³.h
>

42 
	~<±h»ad.h
>

43 #ifdeà
HAVE_DBUS


44 
	~<dbus/dbus.h
>

46 
	~"hpmud.h
"

47 
	~<sigÇl.h
>

48 
	~<”ºo.h
>

49 
	~<uts.h
>

53 
	eBACKEND_RESULT


55 
	mBACKEND_OK
 = 0,

56 
	mBACKEND_FAILED
 = 1,

57 
	mBACKEND_HOLD
 = 3,

58 
	mBACKEND_STOP
 = 4,

59 
	mBACKEND_CANCEL
 = 5

62 
	spjl_©Œibu‹s


64 
	mpjl_deviû
;

65 
	mcu¼’t_¡©us
;

66 
	meoj_·ges
;

67 
	mabÜt
;

68 
	mdÚe
;

69 
HPMUD_DEVICE
 
	mdd
;

70 
HPMUD_CHANNEL
 
	mcd
;

71 
±h»ad_t
 
	mtid
;

72 
±h»ad_mu‹x_t
 
	mmu‹x
;

73 
±h»ad_cÚd_t
 
	mdÚe_cÚd
;

76 
	#_STRINGIZE
(
x
è#x

	)

77 
	#STRINGIZE
(
x
è
	`_STRINGIZE
(x)

	)

79 
	#BUG
(
¬gs
...è
	`bug
(
__FILE__
 " " 
	`STRINGIZE
(
__LINE__
è": "‡rgs)

	)

81 #ifdeà
HP_DEBUG


82 
	#DBG
(
¬gs
...è
	`sy¦og
(
LOG_INFO
, 
__FILE__
 " " 
	`STRINGIZE
(
__LINE__
è": "‡rgs)

	)

83 
	#DBG_DUMP
(
d©a
, 
size
è
	`sysdump
((d©a), (size))

	)

84 
	#DBG_SZ
(
¬gs
...è
	`sy¦og
(
LOG_INFO
,‡rgs)

	)

86 
	#DBG
(
¬gs
...)

	)

87 
	#DBG_DUMP
(
d©a
, 
size
)

	)

88 
	#DBG_SZ
(
¬gs
...)

	)

91 
	#RETRY_TIMEOUT
 30

	)

92 
	#EXCEPTION_TIMEOUT
 45

	)

94 
	#NFAULT_BIT
 0x08

	)

95 
	#PERROR_BIT
 0x20

	)

97 
	#OOP
 (
NFAULT_BIT
 | 
PERROR_BIT
)

	)

98 
	#JAMMED
 (
PERROR_BIT
)

	)

99 
	#ERROR_TRAP
 (0)

	)

101 
	#STATUS_MASK
 (
NFAULT_BIT
 | 
PERROR_BIT
)

	)

103 
	#DEVICE_IS_OOP
(
»g
è(Ôeg & 
STATUS_MASK
è=ğ
OOP
)

	)

104 
	#DEVICE_PAPER_JAMMED
(
»g
è(Ôeg & 
STATUS_MASK
è=ğ
JAMMED
)

	)

105 
	#DEVICE_IO_TRAP
(
»g
è(Ôeg & 
STATUS_MASK
è=ğ
ERROR_TRAP
)

	)

107 
	#HEX2INT
(
x
, 
i
) if (x >= '0' && x <= '9') i |= x - '0'; \

108 ià(
x
 >ğ'A' && x <ğ'F'è
i
 |= 0xA + x - 'A'; \

109 ià(
x
 >ğ'a' && x <ğ'f'è
i
 |ğ0xA + x - 'a'

	)

112 
	#BASIC_LOG
 1

	)

113 
	#SAVE_OUT_FILE
 2

	)

114 
	#SAVE_INPUT_RASTERS
 4

	)

115 
	#SAVE_OUT_FILE_IN_BACKEND
 8

	)

116 
	#DONT_SEND_TO_BACKEND
 16

	)

117 
	#DONT_SEND_TO_PRINTER
 32

	)

123 
	mVSTATUS_IDLE
 = 1000,

124 
	mVSTATUS_BUSY
,

125 
	mVSTATUS_PRNT
,

126 
	mVSTATUS_OFFF
,

127 
	mVSTATUS_RPRT
,

128 
	mVSTATUS_CNCL
,

129 
	mVSTATUS_IOST
,

130 
	mVSTATUS_DRYW
,

131 
	mVSTATUS_PENC
,

132 
	mVSTATUS_OOPA
,

133 
	mVSTATUS_BNEJ
,

134 
	mVSTATUS_BNMZ
,

135 
	mVSTATUS_PHMZ
,

136 
	mVSTATUS_DPMZ
,

137 
	mVSTATUS_PAJM
,

138 
	mVSTATUS_CARS
,

139 
	mVSTATUS_PAPS
,

140 
	mVSTATUS_PENF
,

141 
	mVSTATUS_ERRO
,

142 
	mVSTATUS_PWDN
,

143 
	mVSTATUS_FPTS
,

144 
	mVSTATUS_CLNO


145 } 
	tVSTATUS
;

147 
	#EVENT_START_JOB
 500

	)

148 
	#EVENT_END_JOB
 501

	)

151 cÚ¡ 
	gpjl_u¡©us_cmd
[] = "\e%-12345X@PJL USTATUS DEVICE = ON \r\n@PJL USTATUS JOB = ON \r\n@PJL JOB \r\n\e%-12345X";

152 cÚ¡ 
	gpjl_job_’d_cmd
[] = "\e%-12345X@PJL EOJ \r\n\e%-12345X";

153 cÚ¡ 
	gpjl_u¡©us_off_cmd
[] = "\e%-12345X@PJL USTATUSOFF \r\n\e%-12345X";

155 #ifdeà
HAVE_DBUS


156 
	#DBUS_INTERFACE
 "com.h¶.StusS”viû"

	)

157 
	#DBUS_PATH
 "/"

	)

158 
DBusE¼Ü
 
	gdbus_”r
;

159 
DBusCÚÃùiÚ
 *
	gdbus_cÚn
;

162 
	$bug
(cÚ¡ *
fmt
, ...)

164 
buf
[256];

165 
va_li¡
 
¬gs
;

166 
n
;

168 
	`va_¡¬t
(
¬gs
, 
fmt
);

170 ià((
n
 = 
	`v¢´štf
(
buf
, 256, 
fmt
, 
¬gs
)) == -1)

171 
buf
[255] = 0;

173 
	`årštf
(
¡d”r
, "%s", 
buf
);

174 
	`sy¦og
(
LOG_ERR
, "%s", 
buf
);

176 
	`fæush
(
¡d”r
);

177 
	`va_’d
(
¬gs
);

178  
n
;

179 
	}
}

181 #ifdeà
HP_DEBUG


182 
	$sysdump
(cÚ¡ *
d©a
, 
size
)

188 *
p
 = (*)
d©a
;

189 
c
;

190 
n
;

191 
by‹¡r
[4] = {0};

192 
addr¡r
[10] = {0};

193 
hex¡r
[16*3 + 5] = {0};

194 
ch¬¡r
[16*1 + 5] = {0};

195 
n
=1;n<=
size
;n++) {

196 ià(
n
%16 == 1) {

198 
	`¢´štf
(
addr¡r
, ×ddr¡r), "%.4d", ()((
p
-(*)
d©a
) & 0xffff));

201 
c
 = *
p
;

202 ià(
	`i¥ršt
(
c
) == 0) {

203 
c
 = '.';

207 
	`¢´štf
(
by‹¡r
, (by‹¡r), "%02X ", *
p
);

208 
	`¡ºÿt
(
hex¡r
, 
by‹¡r
, (hex¡r)-
	`¡¾’
(hexstr)-1);

211 
	`¢´štf
(
by‹¡r
, (by‹¡r), "%c", 
c
);

212 
	`¡ºÿt
(
ch¬¡r
, 
by‹¡r
, (ch¬¡r)-
	`¡¾’
(charstr)-1);

214 if(
n
%16 == 0) {

216 
	`DBG_SZ
("[%4.4s] %-50.50  %s\n", 
addr¡r
, 
hex¡r
, 
ch¬¡r
);

217 
hex¡r
[0] = 0;

218 
ch¬¡r
[0] = 0;

220 
p
++;

223 ià(
	`¡¾’
(
hex¡r
) > 0) {

225 
	`DBG_SZ
("[%4.4s] %-50.50  %s\n", 
addr¡r
, 
hex¡r
, 
ch¬¡r
);

227 
	}
}

231 
	$m­_p_´š‹r_¡©e_»asÚ
(
¡©us
, cÚ¡ **
¡©e_msg
)

234 ià(
¡©us
 >= 1000 && status <= 1999)

237 
¡©us
)

239 
VSTATUS_IDLE
:

240 
VSTATUS_PRNT
:

241 *
¡©e_msg
 = "none";

243 
VSTATUS_OOPA
:

244 *
¡©e_msg
 = "media-empty-error";

246 (
VSTATUS_PAJM
):

247 *
¡©e_msg
 = "media-jam-error";

250 *
¡©e_msg
 = "other";

254 ià(
¡©us
 >= 10000 && status <= 55999)

257 ià(
¡©us
 >= 10000 && status <= 10999)

258 *
¡©e_msg
 = "none";

259 ià(
¡©us
 >= 41000 && status <= 41999)

260 *
¡©e_msg
 = "media-empty-error";

261 ià((
¡©us
 >= 42000 && status <= 42999) || (status >= 44000 && status <= 44999) || (status == 40022))

262 *
¡©e_msg
 = "media-jam-error";

263 ià(
¡©us
 == 40021)

264 *
¡©e_msg
 = "cover-open-error";

265 ià(
¡©us
 == 40600)

266 *
¡©e_msg
 = "toner-empty-error";

268 *
¡©e_msg
 = "other";

273 *
¡©e_msg
 = "other";

277 
	}
}

279 
HPMUD_RESULT
 
	$g‘_pjl_šput
(
HPMUD_DEVICE
 
dd
, 
HPMUD_CHANNEL
 
cd
, *
buf
, 
buf_size
, 
£c_timeout
, *
by‹s_»ad
)

281 
HPMUD_RESULT
 
¡©
;

282 
Ën
;

284 *
by‹s_»ad
 = 0;

287 
¡©
 = 
	`hpmud_»ad_chªÃl
(
dd
, 
cd
, 
buf
, 
buf_size
, 
£c_timeout
, &
Ën
);

288 ià(
¡©
 !ğ
HPMUD_R_OK
)

289 
bugout
;

291 
buf
[
Ën
]=0;

293 
	`DBG
("pjÈ»suÉ†’=%d\n", 
Ën
);

294 
	`DBG_DUMP
(
buf
, 
Ën
);

296 *
by‹s_»ad
 = 
Ën
;

298 
¡©
 = 
HPMUD_R_OK
;

300 
bugout
:

301  
¡©
;

302 
	}
}

304 
	$·r£_pjl_job_’d
(*
buf
, *
·ges
)

306 *
p
, *

;

307 
¡©
=0;

309 ià(
buf
[0] == 0)

310 
bugout
;

312 ià((
p
 = 
	`¡rÿ£¡r
(
buf
, "u¡©u job")è!ğ
NULL
)

314 ià(
	`¡ºÿ£cmp
(
p
+13, "end", 3) == 0)

316 
¡©
 = 1;

317 ià((
p
 = 
	`¡rÿ£¡r
Õ+13+5, "·ges=")è!ğ
NULL
)

318 *
·ges
 = 
	`¡¹Ş
(
p
+6, &

, 10);

322 
bugout
:

323  
¡©
;

324 
	}
}

326 
	$·r£_pjl_deviû_¡©us
(*
buf
, *
¡©us
)

328 *
p
, *

;

329 
¡©
=0;

331 ià(
buf
[0] == 0)

332 
bugout
;

334 ià((
p
 = 
	`¡rÿ£¡r
(
buf
, "code=")è!ğ
NULL
)

336 *
¡©us
 = 
	`¡¹Ş
(
p
+5, &

, 10);

337 
¡©
 = 1;

340 
bugout
:

341  
¡©
;

342 
	}
}

344 
	$pjl_»ad_th»ad
(
pjl_©Œibu‹s
 *
·
)

346 
HPMUD_RESULT
 
¡©
;

347 
Ën
, 
Ãw_¡©us
, 
Ãw_eoj
;

348 
buf
[1024];

350 
	`±h»ad_d‘ach
(
	`±h»ad_£lf
());

352 
	`DBG
("¡¬tšgh»ad %d\n", ()
·
->
tid
);

354 
·
->
cu¼’t_¡©us
 = 10001;

355 
·
->
eoj_·ges
 =…a->
abÜt
 =…a->
dÚe
 = 0;

357 !
·
->
abÜt
)

359 
¡©
 = 
	`g‘_pjl_šput
(
·
->
dd
,…a->
cd
, 
buf
, (buf), 0, &
Ën
);

360 ià(!(
¡©
 =ğ
HPMUD_R_OK
 || sˆ=ğ
HPMUD_R_IO_TIMEOUT
))

362 
	`BUG
("ex™šgh»ad %dƒ¼Ü=%d\n", ()
·
->
tid
, 
¡©
);

363 
	`±h»ad_mu‹x_lock
(&
·
->
mu‹x
);

364 
·
->
cu¼’t_¡©us
 = 5000+
¡©
;

365 
	`±h»ad_mu‹x_uÆock
(&
·
->
mu‹x
);

369 ià(
¡©
 =ğ
HPMUD_R_OK
)

371 
	`±h»ad_mu‹x_lock
(&
·
->
mu‹x
);

372 
Ãw_¡©us
 = 
	`·r£_pjl_deviû_¡©us
(
buf
, &
·
->
cu¼’t_¡©us
);

373 
Ãw_eoj
 = 
	`·r£_pjl_job_’d
(
buf
, &
·
->
eoj_·ges
);

374 
	`±h»ad_mu‹x_uÆock
(&
·
->
mu‹x
);

375 ià(
Ãw_¡©us
)

376 
	`BUG
("»ad‚ew…jÈ¡©us: %d\n", 
·
->
cu¼’t_¡©us
);

377 ià(
Ãw_eoj
)

378 
	`BUG
("»ad…jÈjob_’d: %d\n", 
·
->
eoj_·ges
);

381 
	`¦“p
(1);

384 
	`DBG
("ex™šgh»ad %d‡bÜt=%d st=%d\n", ()
·
->
tid
,…a->
abÜt
, 
¡©
);

386 
·
->
dÚe
=1;

387 
	`±h»ad_cÚd_sigÇl
(&
·
->
dÚe_cÚd
);

390 
	}
}

403 
	$g‘_´š‹r_¡©us
(
HPMUD_DEVICE
 
dd
, 
HPMUD_CHANNEL
 
cd
, 
pjl_©Œibu‹s
 *
·
)

405 
id
[1024];

406 *
pSf
;

407 
¡©us
, 
v”
, 
Ën
;

408 
HPMUD_RESULT
 
r
;

410 ià(
·
->
pjl_deviû
)

412 
	`±h»ad_mu‹x_lock
(&
·
->
mu‹x
);

413 
¡©us
 = 
·
->
cu¼’t_¡©us
;

414 
	`±h»ad_mu‹x_uÆock
(&
·
->
mu‹x
);

418 
¡©us
 = 
VSTATUS_IDLE
;

419 
r
 = 
	`hpmud_g‘_deviû_id
(
dd
, 
id
, (id), &
Ën
);

421 ià(
r
 !ğ
HPMUD_R_OK
)

423 
¡©us
 = 5000+
r
;

424 
bugout
;

428 ià((
pSf
 = 
	`¡r¡r
(
id
, ";S:")è=ğ
NULL
)

431 
b™_¡©us
;

432 
r
 = 
	`hpmud_g‘_deviû_¡©us
(
dd
, &
b™_¡©us
);

434 ià(
r
 !ğ
HPMUD_R_OK
)

436 
¡©us
 = 5000+
r
;

437 
bugout
;

440 ià(
	`DEVICE_IS_OOP
(
b™_¡©us
))

441 
¡©us
 = 
VSTATUS_OOPA
;

442 ià(
	`DEVICE_PAPER_JAMMED
(
b™_¡©us
))

443 
¡©us
 = 
VSTATUS_PAJM
;

444 ià(
	`DEVICE_IO_TRAP
(
b™_¡©us
))

445 
¡©us
 = 
VSTATUS_CARS
;

450 
pSf
+=3;

451 
v”
 = 0;

452 
	`HEX2INT
(*
pSf
, 
v”
);

453 
pSf
++;

454 
v”
 = ver << 4;

455 
	`HEX2INT
(*
pSf
, 
v”
);

456 
pSf
++;

459 
v”
)

464 
pSf
+=12;

467 
pSf
+=14;

470 
pSf
+=18;

473 
	`BUG
("WARNING: unknowÀS-f›ld v”siÚ=%d\n", 
v”
);

474 
pSf
+=12;

479 
¡©us
 = 0;

480 
	`HEX2INT
(*
pSf
, 
¡©us
);

481 
pSf
++;

482 
¡©us
 = status << 4;

483 
	`HEX2INT
(*
pSf
, 
¡©us
);

484 
¡©us
 += 1000;

488 
bugout
:

489  
¡©us
;

490 
	}
}

492 
	$deviû_discov”y
()

494 
buf
[
HPMUD_LINE_SIZE
*64];

495 
út
=0, 
by‹s_»ad
, 
r
=1;

496 
HPMUD_RESULT
 
¡©
;

498 
¡©
 = 
	`hpmud_´obe_´š‹rs
(
HPMUD_BUS_ALL
, 
buf
, (buf), &
út
, &
by‹s_»ad
);

500 ià(
¡©
 !ğ
HPMUD_R_OK
)

501 
bugout
;

503 ià(
út
 == 0)

504 #ifdeà
HAVE_CUPS11


505 
	`årštf
(
¡dout
, "direct hp:/no_device_found \"Unknown\" \"hp‚o_device_found\"\n");

507 
	`årštf
(
¡dout
, "direct hp \"Unknown\" \"HP Printer (HPLIP)\"\n");

510 
	`årštf
(
¡dout
, "%s", 
buf
);

512 
r
 = 0;

514 
bugout
:

515  
r
;

516 
	}
}

518 #ifdeà
HAVE_DBUS


519 
	$deviû_ev’t
(cÚ¡ *
dev
, cÚ¡ *
´š‹r
, 
code
,

520 cÚ¡ *
u£ºame
, cÚ¡ *
jobid
, cÚ¡ *
t™Ë
)

522 
DBusMes§ge
 * 
msg
 = 
NULL
;

523 
id
 = 
	`©oi
(
jobid
);

525 ià(
dbus_cÚn
 =ğ
NULL
)

528 
msg
 = 
	`dbus_mes§ge_Ãw_sigÇl
(
DBUS_PATH
, 
DBUS_INTERFACE
, "Event");

530 ià(
NULL
 =ğ
msg
)

532 
	`BUG
("dbus message is NULL!\n");

536 
	`dbus_mes§ge_­³nd_¬gs
(
msg
,

537 
DBUS_TYPE_STRING
, &
dev
,

538 
DBUS_TYPE_STRING
, &
´š‹r
,

539 
DBUS_TYPE_UINT32
, &
code
,

540 
DBUS_TYPE_STRING
, &
u£ºame
,

541 
DBUS_TYPE_UINT32
, &
id
,

542 
DBUS_TYPE_STRING
, &
t™Ë
,

543 
DBUS_TYPE_INVALID
);

545 ià(!
	`dbus_cÚÃùiÚ_£nd
(
dbus_cÚn
, 
msg
, 
NULL
))

547 
	`BUG
("dbus message send failed!\n");

551 
	`dbus_cÚÃùiÚ_æush
(
dbus_cÚn
);

552 
	`dbus_mes§ge_uÄef
(
msg
);

555 
	}
}

557 
	$š™_dbus
()

559 
	`dbus_”rÜ_š™
(&
dbus_”r
);

560 
dbus_cÚn
 = 
	`dbus_bus_g‘
(
DBUS_BUS_SYSTEM
, &
dbus_”r
);

562 ià(
	`dbus_”rÜ_is_£t
(&
dbus_”r
))

564 
	`BUG
("dBu CÚÃùiÚ E¼Ü (%s)!\n", 
dbus_”r
.
mes§ge
);

565 
	`dbus_”rÜ_ä“
(&
dbus_”r
);

568 ià(
dbus_cÚn
 =ğ
NULL
)

574 
	}
}

576 
	$deviû_ev’t
(cÚ¡ *
dev
, cÚ¡ *
´š‹r
, 
code
,

577 cÚ¡ *
u£ºame
, cÚ¡ *
jobid
, cÚ¡ *
t™Ë
)

580 
	}
}

581 
	$š™_dbus
()

584 
	}
}

588 
	$loİ_‹¡
(
HPMUD_DEVICE
 
dd
, 
HPMUD_CHANNEL
 
cd
, 
pjl_©Œibu‹s
 *
·
,

589 cÚ¡ *
dev
, cÚ¡ *
´š‹r
, cÚ¡ *
u£ºame
, cÚ¡ *
jobid
, cÚ¡ *
t™Ë
)

591 
¡©us
, 
¡©
;

592 cÚ¡ *
p¡©e
, *
Şd_¡©e
=
NULL
;

596 
¡©us
 = 
	`g‘_´š‹r_¡©us
(
dd
, 
cd
, 
·
);

597 
	`m­_p_´š‹r_¡©e_»asÚ
(
¡©us
, &
p¡©e
);

600 ià(
	`¡r¡r
(
p¡©e
, "error"))

602 ià(
p¡©e
 !ğ
Şd_¡©e
)

604 ià(
Şd_¡©e
)

608 
	`årštf
(
¡d”r
, "STATE: -%s\n", 
Şd_¡©e
);

612 
	`deviû_ev’t
(
dev
, 
´š‹r
, 
¡©us
, 
u£ºame
, 
jobid
, 
t™Ë
);

613 
	`årštf
(
¡d”r
, "STATE: +%s\n", 
p¡©e
);

614 
Şd_¡©e
 = 
p¡©e
;

616 
	`BUG
("ERROR: %d %s; wÈ»Œy iÀ%d secÚds...\n", 
¡©us
, 
p¡©e
, 
RETRY_TIMEOUT
);

617 
	`¦“p
(
RETRY_TIMEOUT
);

622 ià(
Şd_¡©e
)

623 
	`årštf
(
¡d”r
, "STATE: -%s\n", 
Şd_¡©e
);

626 ià(
¡©us
 >= 5000 && status <= 5999)

629 
	`deviû_ev’t
(
dev
, 
´š‹r
, 
¡©us
, 
u£ºame
, 
jobid
, 
t™Ë
);

630 
	`BUG
("ERROR: %d deviû communiÿtiÚƒ¼Ü!\n", 
¡©us
);

631 
¡©
 = 1;

634 
¡©
 = 0;

639  
¡©
;

640 
	}
}

642 
FILE
* 
	$ü—‹_out_fe
(* 
job_id
, * 
u£r_Çme
)

644 
âame
[256] = {0,};

645 
FILE
 *
‹mp_å
 = 
NULL
;

647 
	`¢´štf
(
âame
, (âame), "%s/hp_%s_out_%s_XXXXXX",
CUPS_TMP_DIR
, 
u£r_Çme
, 
job_id
);

648 
	`ü—‹TempFe
(
âame
, &
‹mp_å
);

650 ià(
‹mp_å
)

652 
	`chmod
(
âame
, 
S_IRUSR
 | 
S_IWUSR
 | 
S_IRGRP
 | 
S_IWGRP
 | 
S_IROTH
);

656 
	`BUG
("ERROR: uÇbËØü—‹ TempÜ¬y f%s: %m\n", 
âame
);

659  
‹mp_å
;

660 
	}
}

662 
	$§ve_out_fe
(
fd
, 
cİ›s
, 
FILE
 * 
‹mp_å
)

664 
Ën
 = 0;

665 
buf
[
HPMUD_BUFFER_SIZE
];

667 ià(
NULL
 =ğ
‹mp_å
)

669 
	`BUG
("ERROR: save_out_file function„ecieved NULLemp_fp…ointer\n");

673 
cİ›s
 > 0)

675 
cİ›s
--;

677 ià(
fd
 != 0)

679 
	`l£ek
(
fd
, 0, 
SEEK_SET
);

682 (
Ën
 = 
	`»ad
(
fd
, 
buf
, (buf))) > 0)

684 
	`fwr™e
 (
buf
, 1, 
Ën
, 
‹mp_å
);

688 
	}
}

690 
	$maš
(
¬gc
, *
¬gv
[])

692 
fd
;

693 
cİ›s
;

694 
Ën
, 
¡©us
, 
út
, 
ex™_¡©
=
BACKEND_FAILED
;

695 
buf
[
HPMUD_BUFFER_SIZE
];

696 
hpmud_mod–_©Œibu‹s
 
ma
;

697 
pjl_©Œibu‹s
 
·
;

698 
HPMUD_DEVICE
 
hd
=-1;

699 
HPMUD_CHANNEL
 
cd
=-1;

700 
n
, 
tÙ®
=0, 
»Œy
=0, 
size
, 
·ges
;

701 
HPMUD_RESULT
 
¡©
;

702 *
´š‹r
 = 
	`g‘’v
("PRINTER");

703 
iLogLev–
 = 0;

704 
FILE
 *
‹mp_å
 = 
NULL
;

705 
§veoutfe
 = 0;

710 
	`İ’log
("hp", 
LOG_PID
, 
LOG_DAEMON
);

712 
·
.
tid
 = 0;

714 ià(
¬gc
 > 1)

716 cÚ¡ *
¬g
 = 
¬gv
[1];

717 ià((
¬g
[0] == '-') && (arg[1] == 'h'))

719 
	`årštf
(
¡dout
, "HP Lšux Imagšg‡nd Prštšg Sy¡em\nCUPS Back’d %s\n", 
VERSION
);

720 
	`årštf
(
¡dout
, "(c) 2003-2008 Copyright HP Development Company, LP\n");

721 
	`ex™
(0);

725 ià(
¬gc
 == 1)

726 
	`ex™
 (
	`deviû_discov”y
());

728 ià(
¬gc
 < 6 ||‡rgc > 7)

730 
	`BUG
("ERROR: invalid usage: device_uri job-id useritle copies options [file]\n");

731 
	`ex™
 (1);

734 ià(
¬gc
 == 6)

736 
fd
 = 0;

737 
cİ›s
 = 1;

741 ià((
fd
 = 
	`İ’
(
¬gv
[6], 
O_RDONLY
)) < 0)

743 
	`BUG
("ERROR: uÇbËØİ’…ršˆf%s: %m\n", 
¬gv
[6]);

744 
	`ex™
 (1);

746 
cİ›s
 = 
	`©oi
(
¬gv
[4]);

749 
iLogLev–
 = 
	`g‘HPLogLev–
();

750 if(
SAVE_OUT_FILE_IN_BACKEND
 & 
iLogLev–
)

752 
‹mp_å
 = 
	`ü—‹_out_fe
(
¬gv
[1],‡rgv[2]);

753 if(
‹mp_å
)

754 
§veoutfe
 = 1;

757 ifĞ
DONT_SEND_TO_PRINTER
 & 
iLogLev–
 )

759 if(
‹mp_å
)

761 
§veoutfe
 = 1;

762 
	`§ve_out_fe
(
fd
, 
cİ›s
, 
‹mp_å
);

764 
	`ex™
 (
BACKEND_OK
);

769 
	`sigÇl
(
SIGTERM
, 
SIG_IGN
);

770 
	`š™_dbus
();

773 
	`hpmud_qu”y_mod–
(
¬gv
[0], &
ma
);

775 
	`DBG
("job s¹ % ´t_mode=%d stu¡y³=%d\n", 
¬gv
[0], 
ma
.
´t_mode
, ma.
¡©u¡y³
);

777 
·
.
pjl_deviû
 = 0;

778 ià(
	`¡rÿ£¡r
(
¬gv
[0], ":/Ãt"è=ğ
NULL
 && (
ma
.
¡©u¡y³
==
HPMUD_STATUSTYPE_PJL
 || ma.¡©u¡y³==
HPMUD_STATUSTYPE_PJLPML
))

779 
·
.
pjl_deviû
 = 1;

781 
	`deviû_ev’t
(
¬gv
[0], 
´š‹r
, 
EVENT_START_JOB
,‡rgv[2],‡rgv[1],‡rgv[3]);

784 
cİ›s
 > 0)

786 
cİ›s
--;

788 ià(
fd
 != 0)

790 
	`åuts
("PAGE: 1 1\n", 
¡d”r
);

791 
	`l£ek
(
fd
, 0, 
SEEK_SET
);

794 (
Ën
 = 
	`»ad
(
fd
, 
buf
, (buf))) > 0)

796 
size
=
Ën
;

797 
tÙ®
=0;

799 
size
 > 0)

801 ià(
§veoutfe
)

802 
	`fwr™e
 (
buf
, 1, 
Ën
, 
‹mp_å
);

805 ià(
hd
 <= 0)

807 
	`åuts
("STATE: +cÚÃùšg-to-deviû\n", 
¡d”r
);

810 (
¡©
 = 
	`hpmud_İ’_deviû
(
¬gv
[0], 
ma
.
´t_mode
, &
hd
)è!ğ
HPMUD_R_OK
)

812 ià(
	`g‘’v
("CLASS"è!ğ
NULL
)

817 
	`BUG
("INFO: o³Àdeviû faed st=%d: %s;ryšg‚exˆ´š‹¸š cÏss...\n", 
¡©
, 
¬gv
[0]);

818 
	`¦“p
 (5);

819 
bugout
;

822 ià(
¡©
 !ğ
HPMUD_R_DEVICE_BUSY
)

824 
	`BUG
("ERROR: o³Àdeviû faed st=%d: %s\n", 
¡©
, 
¬gv
[0]);

825 
bugout
;

829 
	`deviû_ev’t
(
¬gv
[0], 
´š‹r
, 5000+
¡©
,‡rgv[2],‡rgv[1],‡rgv[3]);

831 
	`BUG
("INFO: o³Àdeviû faed st=%d: %s; wÈ»Œy iÀ%d secÚds...\n", 
¡©
, 
¬gv
[0], 
RETRY_TIMEOUT
);

832 
	`¦“p
(
RETRY_TIMEOUT
);

833 
»Œy
 = 1;

836 ià(
»Œy
)

839 
	`deviû_ev’t
(
¬gv
[0], 
´š‹r
, 
VSTATUS_PRNT
,‡rgv[2],‡rgv[1],‡rgv[3]);

840 
»Œy
=0;

843 (
¡©
 = 
	`hpmud_İ’_chªÃl
(
hd
, 
HPMUD_S_PRINT_CHANNEL
, &
cd
)è!ğ
HPMUD_R_OK
)

845 ià(
¡©
 !ğ
HPMUD_R_DEVICE_BUSY
)

847 
	`BUG
("ERROR: cªnÙ o³ÀchªÃÈ%s\n", 
HPMUD_S_PRINT_CHANNEL
);

848 
bugout
;

850 
	`deviû_ev’t
(
¬gv
[0], 
´š‹r
, 5000+
¡©
,‡rgv[2],‡rgv[1],‡rgv[3]);

851 
	`BUG
("INFO: o³À´šˆchªÃÈçed st=%d; wÈ»Œy iÀ%d secÚds...\n", 
¡©
, 
RETRY_TIMEOUT
);

852 
	`¦“p
(
RETRY_TIMEOUT
);

853 
»Œy
 = 1;

856 ià(
»Œy
)

859 
	`deviû_ev’t
(
¬gv
[0], 
´š‹r
, 
VSTATUS_PRNT
,‡rgv[2],‡rgv[1],‡rgv[3]);

860 
»Œy
=0;

863 
	`åuts
("STATE: -cÚÃùšg-to-deviû\n", 
¡d”r
);

865 ià(
·
.
pjl_deviû
)

868 
	`hpmud_wr™e_chªÃl
(
hd
, 
cd
, 
pjl_u¡©us_cmd
, Õjl_u¡©us_cmd)-1, 5, &
Ën
);

869 
·
.
dd
 = 
hd
;

870 
·
.
cd
 = cd;

871 
	`±h»ad_mu‹x_š™
(&
·
.
mu‹x
, 
NULL
);

872 
	`±h»ad_cÚd_š™
(&
·
.
dÚe_cÚd
, 
NULL
);

873 
	`±h»ad_ü—‹
(&
·
.
tid
, 
NULL
, (*(*)(*))
pjl_»ad_th»ad
, (*)&pa);

877 
	`årštf
(
¡d”r
, "STATE: -%s\n", "media-empty-error,media-jam-error,hplip.plugin-error,"

882 
¡©
 = 
	`hpmud_wr™e_chªÃl
(
hd
, 
cd
, 
buf
+
tÙ®
, 
size
, 
EXCEPTION_TIMEOUT
, &
n
);

885 ià(
n
 !ğ
size
)

888 ià(
	`loİ_‹¡
(
hd
, 
cd
, &
·
, 
¬gv
[0], 
´š‹r
,‡rgv[2],‡rgv[1],‡rgv[3]))

890 
ex™_¡©
 = 
BACKEND_STOP
;

891 
bugout
;

897 ià(
·
.
pjl_deviû
)

900 ià(
	`loİ_‹¡
(
hd
, 
cd
, &
·
, 
¬gv
[0], 
´š‹r
,‡rgv[2],‡rgv[1],‡rgv[3]))

902 
ex™_¡©
 = 
BACKEND_STOP
;

903 
bugout
;

907 
tÙ®
+=
n
;

908 
size
-=
n
;

913 
	`DBG
("jobƒnd % ´t_mode=%d stu¡y³=%dÙ®=%d\n", 
¬gv
[0], 
ma
.
´t_mode
, ma.
¡©u¡y³
, 
tÙ®
);

916 ià(
tÙ®
==0)

918 
ex™_¡©
 = 
BACKEND_OK
;

919 
	`BUG
("ERROR:‚uÎ…ršˆjobÙ®=%d\n", 
tÙ®
);

920 
bugout
;

923 ià(
·
.
pjl_deviû
 &&…a.
tid
)

925 
	`±h»ad_mu‹x_lock
(&
·
.
mu‹x
);

926 
·
.
eoj_·ges
=0;

927 
	`±h»ad_mu‹x_uÆock
(&
·
.
mu‹x
);

928 
	`hpmud_wr™e_chªÃl
(
hd
, 
cd
, 
pjl_job_’d_cmd
, Õjl_job_’d_cmd)-1, 5, &
Ën
);

931 
út
=0; cnt<10; cnt++)

933 ià(
	`loİ_‹¡
(
hd
, 
cd
, &
·
, 
¬gv
[0], 
´š‹r
,‡rgv[2],‡rgv[1],‡rgv[3]))

935 
ex™_¡©
 = 
BACKEND_OK
;

936 
bugout
;

938 
	`±h»ad_mu‹x_lock
(&
·
.
mu‹x
);

939 
·ges
 = 
·
.
eoj_·ges
;

940 
	`±h»ad_mu‹x_uÆock
(&
·
.
mu‹x
);

941 ià(
·ges
 > 0)

943 
	`DBG
("jobƒnd…ages=%d\n", 
·ges
);

946 
	`DBG
("waiting for jobƒnd status...\n");

947 
	`¦“p
(2);

950 
	`hpmud_wr™e_chªÃl
(
hd
, 
cd
, 
pjl_u¡©us_off_cmd
, Õjl_u¡©us_off_cmd)-1, 5, &
Ën
);

952 ià((
ma
.
´t_mode
 !ğ
HPMUD_UNI_MODE
è&& (ma.
¡©u¡y³
 =ğ
HPMUD_STATUSTYPE_SFIELD
))

955 
¡©us
 = 
	`g‘_´š‹r_¡©us
(
hd
, 
cd
, &
·
);

956 ià(
¡©us
 < 5000)

959 
út
=0;

960 (
¡©us
 !ğ
VSTATUS_IDLE
è&& (¡©u < 5000è&& (
út
 < 5))

962 
	`¦“p
(2);

963 
¡©us
 = 
	`g‘_´š‹r_¡©us
(
hd
, 
cd
, &
·
);

964 
út
++;

971 
	`¦“p
(8);

974 
ex™_¡©
 = 
BACKEND_OK
;

975 
	`åuts
("INFO:„—dyØ´št\n", 
¡d”r
);

977 
bugout
:

979 
	`deviû_ev’t
(
¬gv
[0], 
´š‹r
, 
EVENT_END_JOB
,‡rgv[2],‡rgv[1],‡rgv[3]);

981 ià(
·
.
pjl_deviû
 &&…a.
tid
)

984 
	`±h»ad_mu‹x_lock
(&
·
.
mu‹x
);

985 
·
.
abÜt
=1;

986 !
·
.
dÚe
)

987 
	`±h»ad_cÚd_wa™
(&
·
.
dÚe_cÚd
, &·.
mu‹x
);

988 
	`±h»ad_mu‹x_uÆock
(&
·
.
mu‹x
);

989 
	`±h»ad_ÿnûl
(
·
.
tid
);

990 
	`±h»ad_mu‹x_de¡roy
(&
·
.
mu‹x
);

991 
	`±h»ad_cÚd_de¡roy
(&
·
.
dÚe_cÚd
);

994 ià(
cd
 >= 0)

995 
	`hpmud_şo£_chªÃl
(
hd
, 
cd
);

996 ià(
hd
 >= 0)

997 
	`hpmud_şo£_deviû
(
hd
);

998 ià(
fd
 != 0)

999 
	`şo£
(
fd
);

1000 ià(
‹mp_å
)

1001 
	`fşo£
(
‹mp_å
);

1003 
	`ex™
 (
ex™_¡©
);

1004 
	}
}

	@prnt/cupsext/cupsext.c

77 
	~<PythÚ.h
>

78 
	~<¡ruùmemb”.h
>

79 
	~<cups/cups.h
>

80 
	~<cups/Ïnguage.h
>

81 
	~<cups/µd.h
>

82 
	~<sy¦og.h
>

83 
	~<¡d¬g.h
>

84 
	~<sys/ty³s.h
>

85 
	~<pwd.h
>

88 
	~"cup£xt.h
"

89 
	~"hp_p.h
"

90 
	~"uts.h
"

94 #ià
PY_VERSION_HEX
 < 0x02050000

95 
	tPy_ssize_t
;

96 
	#PY_SSIZE_T_MAX
 
INT_MAX


	)

97 
	#PY_SSIZE_T_MIN
 
INT_MIN


	)

100 
	#_STRINGIZE
(
x
è#x

	)

101 
	#STRINGIZE
(
x
è
	`_STRINGIZE
(x)

	)

106 
PyObjeù
 * 
	$»Ëa£CupsIn¡ªû
Ğ
PyObjeù
 * 
£lf
, PyObjeù * 
¬gs
 )

108 
	`_»Ëa£CupsIn¡ªû
();

110  
	`Py_BudV®ue
( "i", 1 );

111 
	}
}

113 
	gg_num_İtiÚs
 = 0;

114 
cups_İtiÚ_t
 * 
	gg_İtiÚs
;

116 
µd_fe_t
 * 
	gµd
 = 
NULL
;

117 
cups_de¡_t
 * 
	gde¡
 = 
NULL
;

119 
cups_de¡_t
 * 
	gg_de¡s
 = 
NULL
;

120 
	gg_num_de¡s
 = 0;

124 cÚ¡ * 
	gg_µd_fe
 = 
NULL
;

126 *
	$g‘U£rName
()

128 
·sswd
 *
pw
 = 
	`g‘pwuid
(
	`g‘euid
());

129 ià(
pw
)

131  
pw
->
pw_Çme
;

133  
NULL
;

134 
	}
}

136 
PyObjeù
 * 
	$PyObj_äom_UTF8
(cÚ¡ *
utf8
)

138 
PyObjeù
 *
v®
 = 
	`PyUnicode_Decode
(
utf8
, 
	`¡¾’
(utf8), "utf-8", 
NULL
);

140 ià(!
v®
)

147 * 
ascii
;

148 cÚ¡ * 
Üig
 = 
utf8
;

149 
i
;

151 
	`PyE¼_CË¬
();

152 
ascii
 = 
	`m®loc
(1 + 
	`¡¾’
 (
Üig
));

154 
i
 = 0; 
Üig
[i]; i++)

156 
ascii
[
i
] = 
Üig
[i] & 0x7f;

159 
ascii
[
i
] = '\0';

161 
v®
 = 
	`PYUnicode_STRING
Ğ
ascii
 );

162 
	`ä“
Ğ
ascii
 );

165  
v®
;

166 
	}
}

168 
	$debug
(cÚ¡ * 
‹xt
)

170 
buf
[4096];

171 
	`¥rštf
Ğ
buf
, "´šˆ'%s'", 
‹xt
);

172 
	`PyRun_Sim¶eSŒšg
Ğ
buf
 );

174 
	}
}

177 
PyTy³Objeù
 
	g´š‹r_Ty³
;

179 
	#´š‹rObjeù_Check
(
v
è((v)->
ob_ty³
 =ğ&
´š‹r_Ty³
)

	)

183 
PyObjeù_HEAD


184 
PyObjeù
 * 
	mdeviû_uri
;

185 
PyObjeù
 * 
	m´š‹r_uri
;

186 
PyObjeù
 * 
	mÇme
;

187 
PyObjeù
 * 
	mloÿtiÚ
;

188 
PyObjeù
 * 
	mmakemod–
;

189 
PyObjeù
 * 
	mšfo
;

190 
	macû±šg
;

191 
	m¡©e
;

193 
	t´š‹r_Objeù
;

196 
	$´š‹r_d—Îoc
Ğ
´š‹r_Objeù
 * 
£lf
 )

199 
	`Py_XDECREF
Ğ
£lf
->
Çme
 );

200 
	`Py_XDECREF
Ğ
£lf
->
deviû_uri
 );

201 
	`Py_XDECREF
Ğ
£lf
->
´š‹r_uri
 );

202 
	`Py_XDECREF
Ğ
£lf
->
loÿtiÚ
 );

203 
	`Py_XDECREF
Ğ
£lf
->
makemod–
 );

204 
	`Py_XDECREF
Ğ
£lf
->
šfo
 );

205 
	`PyObjeù_DEL
Ğ
£lf
 );

206 
	}
}

209 
PyMemb”Def
 
	g´š‹r_memb”s
[] =

211 { "deviû_uri", 
T_OBJECT_EX
, 
off£tof
Ğ
´š‹r_Objeù
, 
deviû_uri
 ), 0, "Device URI (device-uri)" },

212 { "´š‹r_uri", 
T_OBJECT_EX
, 
off£tof
Ğ
´š‹r_Objeù
, 
´š‹r_uri
 ), 0, "Printer URI (printer-uri)" },

213 { "Çme", 
T_OBJECT_EX
, 
off£tof
Ğ
´š‹r_Objeù
, 
Çme
 ), 0, "Name (printer-name)" },

214 { "loÿtiÚ", 
T_OBJECT_EX
, 
off£tof
Ğ
´š‹r_Objeù
, 
loÿtiÚ
 ), 0, "Location (printer-location)" },

215 { "makemod–", 
T_OBJECT_EX
, 
off£tof
Ğ
´š‹r_Objeù
, 
makemod–
 ), 0, "Make‡nd model (printer-make-and-model)" },

216 { "¡©e", 
T_INT
, 
off£tof
Ğ
´š‹r_Objeù
, 
¡©e
 ), 0, "State (printer-state)" },

217 { "šfo", 
T_OBJECT_EX
, 
off£tof
Ğ
´š‹r_Objeù
, 
šfo
 ), 0, "Info/description (printer-info)" },

218 { "acû±šg", 
T_INT
, 
off£tof
Ğ
´š‹r_Objeù
, 
acû±šg
 ), 0, "Accepting/rejecting" },

222 
PyTy³Objeù
 
	g´š‹r_Ty³
 =

227 
PyV¬Objeù_HEAD_INIT
Ğ&
PyTy³_Ty³
, 0 )

229 Ğ
´š‹r_Objeù
 ),

231 Ğ
de¡ruùÜ
 ) 
´š‹r_d—Îoc
,

243 
PyObjeù_G’”icG‘A‰r
,

244 
PyObjeù_G’”icS‘A‰r
,

246 
Py_TPFLAGS_DEFAULT
 | 
Py_TPFLAGS_BASETYPE
,

255 
´š‹r_memb”s
,

270 
PyObjeù
 * 
	$_ÃwPrš‹r
Ğ* 
deviû_uri
,

271 * 
Çme
,

272 * 
´š‹r_uri
,

273 * 
loÿtiÚ
,

274 * 
makemod–
,

275 * 
šfo
,

276 
¡©e
,

277 
acû±šg
 )

279 
´š‹r_Objeù
 * 
£lf
 = 
	`PyObjeù_New
Ğ´š‹r_Objeù, &
´š‹r_Ty³
 );

281 iàĞ!
£lf
 )

282  
NULL
;

284 iàĞ
deviû_uri
 !ğ
NULL
 )

285 
£lf
->
deviû_uri
 = 
	`Py_BudV®ue
( "s", device_uri );

287 iàĞ
´š‹r_uri
 !ğ
NULL
 )

288 
£lf
->
´š‹r_uri
 = 
	`Py_BudV®ue
( "s",…rinter_uri );

290 iàĞ
Çme
 !ğ
NULL
 )

291 
£lf
->
Çme
 = 
	`Py_BudV®ue
( "s",‚ame );

293 iàĞ
loÿtiÚ
 !ğ
NULL
 )

294 
£lf
->
loÿtiÚ
 = 
	`Py_BudV®ue
( "s",†ocation );

296 iàĞ
makemod–
 !ğ
NULL
 )

297 
£lf
->
makemod–
 = 
	`Py_BudV®ue
( "s", makemodel );

299 iàĞ
šfo
 !ğ
NULL
 )

300 
£lf
->
šfo
 = 
	`Py_BudV®ue
( "s", info );

302 
£lf
->
acû±šg
 =‡ccepting;

303 
£lf
->
¡©e
 = state;

305  ( 
PyObjeù
 * ) 
£lf
;

306 
	}
}

308 
PyObjeù
 * 
	$ÃwPrš‹r
Ğ
PyObjeù
 * 
£lf
, PyObjeù * 
¬gs
, PyObjeù * 
kw¬gs
 )

310 * 
deviû_uri
 = "";

311 * 
Çme
 = "";

312 * 
loÿtiÚ
 = "";

313 * 
makemod–
 = "";

314 
¡©e
 = 0;

315 * 
´š‹r_uri
 = "";

316 * 
šfo
 = "";

317 
acû±šg
 = 0;

319 * 
kwds
[] = { "device_uri", "name", "printer_uri", "location",

320 "makemod–", "šfo", "¡©e", "acû±šg", 
NULL


323 iàĞ!
	`PyArg_P¬£Tu¶eAndKeywÜds
Ğ
¬gs
, 
kw¬gs
, "zz|zzzzii", 
kwds
,

324 &
deviû_uri
, &
Çme
, &
´š‹r_uri
,

325 &
loÿtiÚ
, &
makemod–
, &
šfo
, &
¡©e
,

326 &
acû±šg
 ) )

327  
NULL
;

329  
	`_ÃwPrš‹r
Ğ
deviû_uri
, 
´š‹r_uri
, 
Çme
, 
loÿtiÚ
, 
makemod–
, 
šfo
, 
¡©e
, 
acû±šg
);

330 
	}
}

333 
PyObjeù
 * 
	$g‘Prš‹rs
Ğ
PyObjeù
 * 
£lf
, PyObjeù * 
¬gs
 )

335 
¡©us
 = 0;

336 
šdex
 = 0;

337 
´š‹r_t
 *
´š‹r
 = 
NULL
;

338 
´š‹r_t
 *
´š‹r_li¡
 = 
NULL
;

340 
PyObjeù
 * 
py´š‹r_li¡
;

341 
py´š‹r_li¡
 = 
	`PyLi¡_New
( 0 );

344 
¡©us
 = 
	`g‘CupsPrš‹rs
(&
´š‹r_li¡
);

346 
´š‹r
 = 
´š‹r_li¡
;…rš‹r!=
NULL
;…rš‹rõrš‹r->
Ãxt
)

348 
´š‹r_Objeù
 * 
py´š‹r
;

349 
py´š‹r
 = ( 
´š‹r_Objeù
 * ) 
	`_ÃwPrš‹r
Ğ
´š‹r
->
deviû_uri
,

350 
´š‹r
->
Çme
,

351 
´š‹r
->
´š‹r_uri
,

352 
´š‹r
->
loÿtiÚ
,

353 
´š‹r
->
make_mod–
,

354 
´š‹r
->
šfo
,

355 
´š‹r
->
¡©e
,

356 
´š‹r
->
acû±šg
 );

359 
	`PyLi¡_Aµ’d
Ğ
py´š‹r_li¡
, ( 
PyObjeù
 * ) 
py´š‹r
 );

362 
abÜt
:

363 ià(
´š‹r_li¡
 !ğ
NULL
) {

364 
	`ä“Prš‹rLi¡
(
´š‹r_li¡
);

367  
py´š‹r_li¡
;

368 
	}
}

371 
PyObjeù
 * 
	$addPrš‹r
Ğ
PyObjeù
 * 
£lf
, PyObjeù * 
¬gs
 )

373 
¡©us
 = 0;

374 * 
Çme
, * 
deviû_uri
, *
loÿtiÚ
, *
µd_fe
, * 
šfo
, * 
mod–
;

375 cÚ¡ * 
¡©us_¡r
 = "successful-ok";

377 iàĞ!
	`PyArg_P¬£Tu¶e
Ğ
¬gs
, "zzzzzz",

378 &
Çme
,

379 &
deviû_uri
,

380 &
loÿtiÚ
,

381 &
µd_fe
,

382 &
mod–
,

383 &
šfo


386 
¡©us_¡r
 = "Invalid‡rguments";

387 
abÜt
;

390 
¡©us
 = 
	`addCupsPrš‹r
(
Çme
, 
deviû_uri
, 
loÿtiÚ
, 
µd_fe
, 
mod–
, 
šfo
);

391 
¡©us_¡r
 = 
	`g‘CupsE¼ÜSŒšg
(
¡©us
);

393 
abÜt
:

395  
	`Py_BudV®ue
Ğ"is", 
¡©us
, 
¡©us_¡r
 );

397 
	}
}

402 
PyObjeù
 * 
	$d–Prš‹r
Ğ
PyObjeù
 * 
£lf
, PyObjeù * 
¬gs
 )

404 * 
Çme
;

405 
¡©us
 = 0;

406 cÚ¡ * 
¡©us_¡r
 = "";

408 iàĞ!
	`PyArg_P¬£Tu¶e
Ğ
¬gs
, "z",

409 &
Çme
 ) )

411 
abÜt
;

414 
¡©us
 = 
	`d–CupsPrš‹r
(
Çme
);

415 
¡©us_¡r
 = 
	`g‘CupsE¼ÜSŒšg
(
¡©us
);

417 
abÜt
:

419  
	`Py_BudV®ue
Ğ"is", 
¡©us
 ,
¡©us_¡r
);

420 
	}
}

427 
PyObjeù
 * 
	$£tDeçuÉPrš‹r
Ğ
PyObjeù
 * 
£lf
, PyObjeù * 
¬gs
 )

430 * 
Çme
;

431 
¡©us
 = 0;

432 cÚ¡ * 
¡©us_¡r
 = "";

434 iàĞ!
	`PyArg_P¬£Tu¶e
Ğ
¬gs
, "z",

435 &
Çme
 ) )

437 
abÜt
;

440 
¡©us
 = 
	`£tDeçuÉCupsPrš‹r
(
Çme
);

441 
¡©us_¡r
 = 
	`g‘CupsE¼ÜSŒšg
(
¡©us
);

443 
abÜt
:

444  
	`Py_BudV®ue
Ğ"is", 
¡©us
, 
¡©us_¡r
 );

445 
	}
}

449 
PyObjeù
 * 
	$cÚŒŞPrš‹r
Ğ
PyObjeù
 * 
£lf
, PyObjeù * 
¬gs
 )

451 
¡©us
 = 0;

452 
İ
;

453 *
Çme
;

454 cÚ¡ * 
¡©us_¡r
 = "";

456 iàĞ!
	`PyArg_P¬£Tu¶e
Ğ
¬gs
, "zi", &
Çme
, &
İ
) )

458 
abÜt
;

461 
¡©us
 = 
	`cÚŒŞCupsPrš‹r
(
Çme
, 
İ
);

463 
¡©us_¡r
 = 
	`g‘CupsE¼ÜSŒšg
(
¡©us
);

464 iàĞ
¡©us
 <ğ
IPP_OK_CONFLICT
)

465 
¡©us
 = 
IPP_OK
;

467 
abÜt
:

468  
	`Py_BudV®ue
Ğ"is", 
¡©us
, 
¡©us_¡r
 );

469 
	}
}

474 
PyTy³Objeù
 
	gjob_Ty³
;

477 
PyObjeù_HEAD


478 
	mid
;

479 
PyObjeù
 * 
	mde¡
;

480 
PyObjeù
 * 
	mt™Ë
;

481 
PyObjeù
 * 
	mu£r
;

482 
	m¡©e
;

483 
	msize
;

485 
	tjob_Objeù
;

489 
	$job_d—Îoc
Ğ
job_Objeù
 * 
£lf
 )

492 
	`Py_XDECREF
Ğ
£lf
->
de¡
 );

493 
	`Py_XDECREF
Ğ
£lf
->
t™Ë
 );

494 
	`Py_XDECREF
Ğ
£lf
->
u£r
 );

495 
	`PyObjeù_DEL
Ğ
£lf
 );

496 
	}
}

498 
PyMemb”Def
 
	gjob_memb”s
[] =

500 { "id", 
T_INT
, 
off£tof
Ğ
job_Objeù
, 
id
 ), 0, "Id" },

501 { "de¡", 
T_OBJECT_EX
, 
off£tof
Ğ
job_Objeù
, 
de¡
 ), 0, "Destination" },

502 { "¡©e", 
T_INT
, 
off£tof
Ğ
job_Objeù
, 
¡©e
 ), 0, "State" },

503 { "t™Ë", 
T_OBJECT_EX
, 
off£tof
Ğ
job_Objeù
, 
t™Ë
 ), 0, "Title" },

504 { "u£r", 
T_OBJECT_EX
, 
off£tof
Ğ
job_Objeù
, 
u£r
 ), 0, "User" },

505 { "size", 
T_INT
, 
off£tof
Ğ
job_Objeù
, 
size
 ), 0, "Size" },

511 
PyTy³Objeù
 
	gjob_Ty³
 =

515 
PyV¬Objeù_HEAD_INIT
Ğ&
PyTy³_Ty³
, 0 )

517 Ğ
job_Objeù
 ),

519 Ğ
de¡ruùÜ
 ) 
job_d—Îoc
,

531 
PyObjeù_G’”icG‘A‰r
,

532 
PyObjeù_G’”icS‘A‰r
,

534 
Py_TPFLAGS_DEFAULT
,

543 
job_memb”s
,

559 
PyObjeù
 * 
	$_ÃwJob
Ğ
id
, 
¡©e
, * 
de¡
, * 
t™Ë
, * 
u£r
, 
size
 )

561 
job_Objeù
 * 
jo
;

562 
jo
 = 
	`PyObjeù_New
Ğ
job_Objeù
, &
job_Ty³
 );

563 iàĞ
jo
 =ğ
NULL
 )

564  
NULL
;

565 
jo
->
id
 = id;

566 
jo
->
size
 = size;

567 
jo
->
¡©e
 = state;

568 iàĞ
de¡
 !ğ
NULL
 )

569 
jo
->
de¡
 = 
	`PyObj_äom_UTF8
( dest );

571 
jo
->
de¡
 = 
	`Py_BudV®ue
( "" );

573 iàĞ
t™Ë
 !ğ
NULL
 )

574 
jo
->
t™Ë
 = 
	`PyObj_äom_UTF8
(itle );

576 
jo
->
t™Ë
 = 
	`Py_BudV®ue
( "" );

578 iàĞ
u£r
 !ğ
NULL
 )

579 
jo
->
u£r
 = 
	`PyObj_äom_UTF8
( user );

581 
jo
->
u£r
 = 
	`Py_BudV®ue
( "" );

583  ( 
PyObjeù
 * ) 
jo
;

585 
	}
}

587 
PyObjeù
 * 
	$ÃwJob
Ğ
PyObjeù
 * 
£lf
, PyObjeù * 
¬gs
, PyObjeù * 
kw¬gs
 )

589 * 
de¡
 = "";

590 
id
 = 0;

591 
¡©e
 = 0;

592 * 
t™Ë
 = "";

593 * 
u£r
 = "";

594 
size
 = 0;

596 * 
kwds
[] = { "id", "¡©e", "de¡", "t™Ë", "u£r", "size", 
NULL
 };

598 iàĞ!
	`PyArg_P¬£Tu¶eAndKeywÜds
Ğ
¬gs
, 
kw¬gs
, "i|izzzi", 
kwds
,

599 &
id
, &
¡©e
, &
de¡
, &
t™Ë
, &
u£r
, &
size
 ) )

600  
NULL
;

602  
	`_ÃwJob
Ğ
id
, 
¡©e
, 
de¡
, 
t™Ë
, 
u£r
, 
size
 );

604 
	}
}

607 
PyObjeù
 * 
	$g‘DeçuÉPrš‹r
Ğ
PyObjeù
 * 
£lf
, PyObjeù * 
¬gs
 )

609 cÚ¡ * 
defde¡
;

610 
defde¡
 = 
	`cupsG‘DeçuÉ
();

617 iàĞ
defde¡
 =ğ
NULL
 )

618  
	`Py_BudV®ue
( "" );

620  
	`Py_BudV®ue
Ğ"s", 
defde¡
 );

622 
	}
}

625 
PyObjeù
 * 
	$ÿnûlJob
Ğ
PyObjeù
 * 
£lf
, PyObjeù * 
¬gs
 )

627 
¡©us
;

628 
jobid
;

629 * 
de¡
;

631 iàĞ!
	`PyArg_P¬£Tu¶e
Ğ
¬gs
, "si", &
de¡
, &
jobid
 ) )

633  
	`Py_BudV®ue
( "i", 0 );

636 
¡©us
 = 
	`cupsCªûlJob
Ğ
de¡
, 
jobid
 );

638  
	`Py_BudV®ue
Ğ"i", 
¡©us
 );

639 
	}
}

641 
PyObjeù
 * 
	$g‘Jobs
Ğ
PyObjeù
 * 
£lf
, PyObjeù * 
¬gs
 )

643 
cups_job_t
 * 
jobs
;

644 
Py_ssize_t
 
i
;

645 
num_jobs
;

646 
PyObjeù
 * 
job_li¡
;

647 
my_job
;

648 
com¶‘ed
;

650 iàĞ!
	`PyArg_P¬£Tu¶e
Ğ
¬gs
, "ii", &
my_job
, &
com¶‘ed
 ) )

652  
	`PyLi¡_New
ĞĞ
Py_ssize_t
 ) 0 );

655 
num_jobs
 = 
	`cupsG‘Jobs
Ğ&
jobs
, 
NULL
, 
my_job
, 
com¶‘ed
 );

657 iàĞ
num_jobs
 > 0 )

659 
job_li¡
 = 
	`PyLi¡_New
Ğ
num_jobs
 );

661  
i
 = 0; i < 
num_jobs
; i++ )

663 
job_Objeù
 * 
Ãwjob
;

664 
Ãwjob
 = ( 
job_Objeù
 * ) 
	`_ÃwJob
Ğ
jobs
[ 
i
 ].
id
,

665 
jobs
[ 
i
 ].
¡©e
,

666 
jobs
[ 
i
 ].
de¡
,

667 
jobs
[ 
i
 ].
t™Ë
,

668 
jobs
[ 
i
 ].
u£r
,

669 
jobs
[ 
i
 ].
size
 );

671 
	`PyLi¡_S‘I‹m
Ğ
job_li¡
, 
i
, ( 
PyObjeù
 * ) 
Ãwjob
 );

674 
	`cupsF»eJobs
Ğ
num_jobs
, 
jobs
 );

678 
job_li¡
 = 
	`PyLi¡_New
ĞĞ
Py_ssize_t
 ) 0 );

680  
job_li¡
;

681 
	}
}

683 
PyObjeù
 * 
	$g‘V”siÚ
Ğ
PyObjeù
 * 
£lf
, PyObjeù * 
¬gs
 )

685  
	`Py_BudV®ue
Ğ"f", 
CUPS_VERSION
 );

686 
	}
}

688 
PyObjeù
 * 
	$g‘V”siÚTu¶e
Ğ
PyObjeù
 * 
£lf
, PyObjeù * 
¬gs
 )

690  
	`Py_BudV®ue
Ğ"(iii)", 
CUPS_VERSION_MAJOR
, 
CUPS_VERSION_MINOR
, 
CUPS_VERSION_PATCH
 );

691 
	}
}

693 
PyObjeù
 * 
	$g‘S”v”
Ğ
PyObjeù
 * 
£lf
, PyObjeù * 
¬gs
 )

695  
	`Py_BudV®ue
Ğ"s", 
	`cupsS”v”
() );

696 
	}
}

698 
PyObjeù
 * 
	$£tS”v”
Ğ
PyObjeù
 * 
£lf
, PyObjeù * 
¬gs
 )

700 * 
£rv”
 = 
NULL
;

702 ià(!
	`PyArg_P¬£Tu¶e
(
¬gs
, "z", &
£rv”
))

703  
	`Py_BudV®ue
( "" );

705 ià(!
	`¡¾’
(
£rv”
))

706 
£rv”
 = 
NULL
;

708 
	`cupsS‘S”v”
(
£rv”
);

710  
	`Py_BudV®ue
( "" );

711 
	}
}

717 
PyObjeù
 * 
	$g‘PPDLi¡
Ğ
PyObjeù
 * 
£lf
, PyObjeù * 
¬gs
 )

719 
¡©us
 = 0;

720 
PyObjeù
 * 
»suÉ
;

722 
»suÉ
 = 
	`PyDiù_New
 ();

724 
¡©us
 = 
	`g‘CupsPPDLi¡
();

726 
abÜt
:

727  
»suÉ
;

728 
	}
}

731 
PyObjeù
 *
	$g‘PPDLi¡
Ğ
PyObjeù
 * 
£lf
, PyObjeù * 
¬gs
 )

743 
p_t
 *
»que¡
 = 
NULL
,

744 *
»¥Ú£
 = 
NULL
;

745 
PyObjeù
 * 
»suÉ
;

746 
cups_Ïng_t
 *
Ïnguage
;

747 
p_©Œibu‹_t
 * 
©Œ
;

749 
»suÉ
 = 
	`PyDiù_New
 ();

751 ià(
	`acquœeCupsIn¡ªû
 (è=ğ
NULL
)

753 
abÜt
;

756 
»que¡
 = 
	`pNew
();

758 
	`pS‘O³¿tiÚ
Ğ
»que¡
, 
CUPS_GET_PPDS
 );

759 
	`pS‘Reque¡Id
 ( 
»que¡
, 1 );

761 
Ïnguage
 = 
	`cupsLªgDeçuÉ
();

763 
	`pAddSŒšg
(
»que¡
, 
IPP_TAG_OPERATION
, 
IPP_TAG_CHARSET
,

764 "©Œibu‹s-ch¬£t", 
NULL
, 
	`cupsLªgEncodšg
(
Ïnguage
));

766 
	`pAddSŒšg
(
»que¡
, 
IPP_TAG_OPERATION
, 
IPP_TAG_LANGUAGE
,

767 "©Œibu‹s-Çtu¿l-Ïnguage", 
NULL
, 
Ïnguage
->language);

772 
	`pAddSŒšg
(
»que¡
, 
IPP_TAG_OPERATION
, 
IPP_TAG_URI
, "printer-uri",

773 
NULL
, "ipp://localhost/printers/officejet_4100");

775 
	`pAddSŒšg
(
»que¡
, 
IPP_TAG_OPERATION
, 
IPP_TAG_URI
, "requested-attributes",

776 
NULL
, "all");

782 ià((
»¥Ú£
 = 
	`cupsDoReque¡
(
h‰p
, 
»que¡
, "/")è!ğ
NULL
)

785 
©Œ
 = 
	`pFœ¡A‰ribu‹
Ğ
»¥Ú£
 );‡‰r;‡‰¸ğ
	`pNextA‰ribu‹
(„esponse ))

787 
PyObjeù
 *
diù
;

788 *
µdÇme
 = 
NULL
;

790 
©Œ
 && 
	`pG‘GroupTag
Ğ©Œ ) !ğ
IPP_TAG_PRINTER
)

791 
©Œ
 = 
	`pNextA‰ribu‹
Ğ
»¥Ú£
 );

793 ià(!
©Œ
)

796 
diù
 = 
	`PyDiù_New
 ();

798 ; 
©Œ
 && 
	`pG‘GroupTag
Ğ©Œ ) =ğ
IPP_TAG_PRINTER
;‡‰¸ğ
	`pNextA‰ribu‹
Ğ
»¥Ú£
 ))

800 
PyObjeù
 *
v®
 = 
NULL
;

802 ià(!
	`¡rcmp
 (
	`pG‘Name
Ğ
©Œ
 ), "µd-Çme"è&& 
	`pG‘V®ueTag
Ğ©Œ ) =ğ
IPP_TAG_NAME
)

804 
µdÇme
 = 
	`pG‘SŒšg
Ğ
©Œ
, 0, 
NULL
 );

810 ià(
	`pG‘V®ueTag
Ğ
©Œ
 ) =ğ
IPP_TAG_TEXT
 || iµG‘V®ueTagĞ©Œ ) =ğ
IPP_TAG_NAME
 || iµG‘V®ueTagĞ©Œ ) =ğ
IPP_TAG_KEYWORD
)

816 
v®
 = 
	`PyObj_äom_UTF8
(
	`pG‘SŒšg
Ğ
©Œ
, 0, 
NULL
 ));

819 ià(
v®
)

821 
	`PyDiù_S‘I‹mSŒšg
 (
diù
, 
	`pG‘Name
Ğ
©Œ
 ), 
v®
);

822 
	`Py_DECREF
 (
v®
);

826 ià(
µdÇme
)

828 
	`PyDiù_S‘I‹mSŒšg
 (
»suÉ
, 
µdÇme
, 
diù
);

832 
	`Py_DECREF
 (
diù
);

835 ià(!
©Œ
)

842 
abÜt
:

843 iàĞ
»¥Ú£
 !ğ
NULL
 )

844 
	`pD–‘e
Ğ
»¥Ú£
 );

846  
»suÉ
;

847 
	}
}

859 
PyObjeù
 * 
	$g‘StusA‰ribu‹s
Ğ
PyObjeù
 * 
£lf
, PyObjeù * 
¬gs
 )

861 
p_t
 *
»¥Ú£
 = 
NULL
;

862 
p_©Œibu‹_t
 *
©Œ
 = 
NULL
;

863 
©Œ_t
* 
©Œ_li¡
 = 
NULL
;

864 
PyObjeù
 * 
diù
;

865 
PyObjeù
 * 
pyv®
;

866 
©Œ_couÁ
 = 0;

867 
šdex
 = 0;

868 
v®uešdex
 = 0;

869 * 
deviû_uri
;

871 iàĞ!
	`PyArg_P¬£Tu¶e
Ğ
¬gs
, "z", &
deviû_uri
) )

873 
abÜt
;

876 
»¥Ú£
 = 
	`g‘DeviûStusA‰ribu‹s
(
deviû_uri
, &
©Œ_couÁ
);

877 if(!
»¥Ú£
)

878 
abÜt
;

893 
diù
 = 
	`PyDiù_New
();

894 ià(
diù
 =ğ
NULL
)

895 
abÜt
;

897  
©Œ
 = 
	`pFœ¡A‰ribu‹
Ğ
»¥Ú£
 );‡‰¸!ğ
NULL
;‡‰¸ğ
	`pNextA‰ribu‹
(„esponse ) )

899 iàĞ
	`¡rcmp
Ğ
	`pG‘Name
Ğ
©Œ
 ), "attributes-charset" ) == 0 || strcmp(ippGetName(‡ttr ), "attributes-natural-language" ) == 0 )

902 
pyv®
 = 
	`PyLi¡_New
(0);

904 
šdex
 = 0; index < 
	`pG‘CouÁ
(
©Œ
); index++)

906 ià(
	`pG‘V®ueTag
Ğ
©Œ
 ) =ğ
IPP_TAG_ENUM
 || iµG‘V®ueTagĞ©Œ ) =ğ
IPP_TAG_INTEGER
)

908 
	`PyLi¡_Aµ’d
(
pyv®
, 
	`Py_BudV®ue
Ğ"i", 
	`pG‘IÁeg”
Ğ
©Œ
, 
šdex
)));

910 ià(
	`pG‘V®ueTag
Ğ
©Œ
 ) =ğ
IPP_TAG_TEXT
 || iµG‘V®ueTagĞ©Œ ) =ğ
IPP_TAG_NAME
 || iµG‘V®ueTagĞ©Œ ) =ğ
IPP_TAG_KEYWORD
)

912 
	`PyLi¡_Aµ’d
(
pyv®
, 
	`Py_BudV®ue
Ğ"s", 
	`pG‘SŒšg
Ğ
©Œ
, 
šdex
, 
NULL
 )));

916 
	`PyLi¡_Aµ’d
(
pyv®
, 
	`Py_BudV®ue
( "s", "?"));

920 
	`PyDiù_S‘I‹mSŒšg
 (
diù
, 
	`pG‘Name
Ğ
©Œ
 ), 
pyv®
);

921 
	`Py_DECREF
 (
pyv®
);

924 
abÜt
:

925 iàĞ
»¥Ú£
 !ğ
NULL
 )

926 
	`pD–‘e
Ğ
»¥Ú£
 );

928  
diù
;

929 
	}
}

936 
PyObjeù
 * 
	$İ’PPD
Ğ
PyObjeù
 * 
£lf
, PyObjeù * 
¬gs
 )

938 * 
´š‹r
;

939 
FILE
 * 
fe
;

940 
j
;

942 iàĞ!
	`PyArg_P¬£Tu¶e
Ğ
¬gs
, "z", &
´š‹r
 ) )

944  
	`Py_BudV®ue
( "" );

947 iàĞĞ
g_µd_fe
 = 
	`cupsG‘PPD
ĞĞcÚ¡ * ) 
´š‹r
 ) ) =ğ
NULL
 )

949 
baout
;

952 iàĞĞ
fe
 = 
	`fİ’
Ğ
g_µd_fe
, "r" )è=ğ
NULL
 )

954 
	`uÆšk
(
g_µd_fe
);

955 
g_µd_fe
 = 
NULL
;

956 
baout
;

959 
µd
 = 
	`µdO³n
Ğ
fe
 );

960 
	`µdLoÿlize
Ğ
µd
 );

961 
	`fşo£
Ğ
fe
 );

963 
g_num_de¡s
 = 
	`cupsG‘De¡s
Ğ&
g_de¡s
 );

965 iàĞ
g_num_de¡s
 == 0 )

967 
baout
;

970 iàĞĞ
de¡
 = 
	`cupsG‘De¡
Ğ
´š‹r
, 
NULL
, 
g_num_de¡s
, 
g_de¡s
 ) ) == NULL )

972 
baout
;

975 
	`µdM¬kDeçuÉs
Ğ
µd
 );

976 
	`cupsM¬kO±iÚs
Ğ
µd
, 
de¡
->
num_İtiÚs
, de¡->
İtiÚs
 );

978  
j
 = 0; j < 
de¡
->
num_İtiÚs
; j++ )

980 iàĞ
	`cupsG‘O±iÚ
Ğ
de¡
->
İtiÚs
[ 
j
 ].
Çme
, 
g_num_İtiÚs
, 
g_İtiÚs
 ) =ğ
NULL
 )

982 
g_num_İtiÚs
 = 
	`cupsAddO±iÚ
Ğ
de¡
->
İtiÚs
[ 
j
 ].
Çme
, de¡->İtiÚs[ j ].
v®ue
, g_num_İtiÚs, &
g_İtiÚs
 );

986 
baout
:

987  
	`Py_BudV®ue
Ğ"s", 
g_µd_fe
 );

988 
	}
}

991 
PyObjeù
 * 
	$şo£PPD
Ğ
PyObjeù
 * 
£lf
, PyObjeù * 
¬gs
 )

993 iàĞ
µd
 !ğ
NULL
 )

995 
	`µdClo£
Ğ
µd
 );

996 
	`uÆšk
Ğ
g_µd_fe
 );

999 
µd
 = 
NULL
;

1001  
	`Py_BudV®ue
( "" );

1002 
	}
}

1005 
PyObjeù
 * 
	$g‘PPD
Ğ
PyObjeù
 * 
£lf
, PyObjeù * 
¬gs
 )

1007 * 
´š‹r
;

1009 iàĞ!
	`PyArg_P¬£Tu¶e
Ğ
¬gs
, "z", &
´š‹r
 ) )

1011  
	`Py_BudV®ue
( "" );

1014 cÚ¡ * 
µd_fe
;

1015 
µd_fe
 = 
	`cupsG‘PPD
ĞĞcÚ¡ * ) 
´š‹r
 );

1017  
	`Py_BudV®ue
Ğ"s", 
µd_fe
 );

1019 
	}
}

1022 
PyObjeù
 * 
	$g‘PPDO±iÚ
Ğ
PyObjeù
 * 
£lf
, PyObjeù * 
¬gs
 )

1024 iàĞ
µd
 !ğ
NULL
 )

1026 * 
İtiÚ
;

1028 iàĞ!
	`PyArg_P¬£Tu¶e
Ğ
¬gs
, "z", &
İtiÚ
 ) )

1030  
	`Py_BudV®ue
( "" );

1033 
µd_choiû_t
 * 
m¬ked_choiû
;

1034 
m¬ked_choiû
 = 
	`µdFšdM¬kedChoiû
Ğ
µd
, 
İtiÚ
 );

1036 iàĞ
m¬ked_choiû
 =ğ
NULL
 )

1038  
	`Py_BudV®ue
( "" );

1042  
	`Py_BudV®ue
Ğ"s", 
m¬ked_choiû
->
‹xt
 );

1047  
	`Py_BudV®ue
( "" );

1049 
	}
}

1051 
PyObjeù
 * 
	$fšdPPDA‰ribu‹
Ğ
PyObjeù
 * 
£lf
, PyObjeù * 
¬gs
 )

1053 iàĞ
µd
 !ğ
NULL
 )

1055 * 
Çme
;

1056 * 
¥ec
;

1058 iàĞ!
	`PyArg_P¬£Tu¶e
Ğ
¬gs
, "zz", &
Çme
, &
¥ec
 ) )

1060  
	`Py_BudV®ue
( "" );

1063 
µd_©Œ_t
 * 
µd_©Œ
;

1064 
µd_©Œ
 = 
	`µdFšdA‰r
(
µd
, 
Çme
, 
¥ec
 );

1065 iàĞ
µd_©Œ
 =ğ
NULL
 )

1067  
	`Py_BudV®ue
( "" );

1071  
	`Py_BudV®ue
Ğ"s", 
µd_©Œ
->
v®ue
 );

1076  
	`Py_BudV®ue
( "" );

1078 
	}
}

1080 
PyObjeù
 * 
	$g‘PPDPageSize
Ğ
PyObjeù
 * 
£lf
, PyObjeù * 
¬gs
 )

1084 iàĞ
µd
 !ğ
NULL
 )

1086 
µd_size_t
 * 
size
 = 
NULL
;

1087 
width
 = 0.0;

1088 
Ëngth
 = 0.0;

1089 
µd_choiû_t
 * 
·ge_size
 = 
NULL
;

1091 
·ge_size
 = 
	`µdFšdM¬kedChoiû
Ğ
µd
, "PageSize" );

1096 iàĞ
·ge_size
 =ğ
NULL
 )

1097 
baout
;

1099 
size
 = 
	`µdPageSize
Ğ
µd
, 
·ge_size
->
‹xt
 );

1101 iàĞ
size
 =ğ
NULL
 )

1102 
baout
;

1107 
width
 = 
	`µdPageWidth
Ğ
µd
, 
·ge_size
->
‹xt
 );

1108 
Ëngth
 = 
	`µdPageL’gth
Ğ
µd
, 
·ge_size
->
‹xt
 );

1110  
	`Py_BudV®ue
Ğ"(sffffff)", 
·ge_size
->
‹xt
, 
width
, 
Ëngth
, 
size
->
Ëá
,

1111 
size
->
bÙtom
, size->
right
, size->
tİ
 );

1114 
baout
:

1115  
	`Py_BudV®ue
( "(sffffff)", "", 0.0, 0.0, 0.0, 0.0, 0.0, 0.0 );

1116 
	}
}

1122 
PyObjeù
 * 
	$»£tO±iÚs
Ğ
PyObjeù
 * 
£lf
, PyObjeù * 
¬gs
 )

1124 iàĞ
g_num_İtiÚs
 > 0 )

1125 
	`cupsF»eO±iÚs
Ğ
g_num_İtiÚs
, 
g_İtiÚs
 );

1126 
g_num_İtiÚs
 = 0;

1127 
g_İtiÚs
 = ( 
cups_İtiÚ_t
 * ) 0;

1129  
	`Py_BudV®ue
( "" );

1131 
	}
}

1133 
PyObjeù
 * 
	$addO±iÚ
Ğ
PyObjeù
 * 
£lf
, PyObjeù * 
¬gs
 )

1135 * 
İtiÚ
;

1137 iàĞ!
	`PyArg_P¬£Tu¶e
Ğ
¬gs
, "z", &
İtiÚ
 ) )

1139  
	`Py_BudV®ue
( "i", 0 );

1142 
g_num_İtiÚs
 = 
	`cupsP¬£O±iÚs
Ğ
İtiÚ
, g_num_İtiÚs, &
g_İtiÚs
 );

1144  
	`Py_BudV®ue
Ğ"i", 
g_num_İtiÚs
 );

1145 
	}
}

1147 
PyObjeù
 * 
	$»moveO±iÚ
Ğ
PyObjeù
 * 
£lf
, PyObjeù * 
¬gs
 )

1149 * 
İtiÚ
;

1150 
j
;

1151 
r
 = 0;

1153 iàĞ!
	`PyArg_P¬£Tu¶e
Ğ
¬gs
, "z", &
İtiÚ
 ) )

1155  
	`Py_BudV®ue
( "i", 0 );

1158 
j
 = 0; j < 
g_num_İtiÚs
; j++)

1160 iàĞ!
	`¡rÿ£cmp
(
g_İtiÚs
[
j
].
Çme
, 
İtiÚ
) )

1162 
g_num_İtiÚs
--;

1164 iàĞ
j
 < 
g_num_İtiÚs
 )

1166 
	`memıy
Ğ(
g_İtiÚs
 + 
j
), (g_options + j + 1),

1167 (
cups_İtiÚ_t
è* (
g_num_İtiÚs
 - 
j
) );

1169 
r
 = 1;

1174  
	`Py_BudV®ue
Ğ"i", 
r
 );

1175 
	}
}

1178 
PyObjeù
 * 
	$g‘O±iÚs
Ğ
PyObjeù
 * 
£lf
, PyObjeù * 
¬gs
 )

1180 
PyObjeù
 * 
İtiÚ_li¡
;

1181 
j
;

1183 
İtiÚ_li¡
 = 
	`PyLi¡_New
ĞĞ
Py_ssize_t
 ) 0 );

1184  
j
 = 0; j < 
g_num_İtiÚs
; j++ )

1186 
	`PyLi¡_Aµ’d
Ğ
İtiÚ_li¡
, 
	`Py_BudV®ue
Ğ"(ss)", 
g_İtiÚs
[ 
j
 ].
Çme
, g_İtiÚs[ j ].
v®ue
 ) );

1189  
İtiÚ_li¡
;

1190 
	}
}

1192 
PyObjeù
 * 
	$du¶iÿ‹SeùiÚ
Ğ
PyObjeù
 * 
£lf
, PyObjeù * 
¬gs
 )

1194 
i
 = 0, 
j
, 
k
, 
Ën
;

1195 cÚ¡ *
£ùiÚ
;

1197 iàĞ!
	`PyArg_P¬£Tu¶e
Ğ
¬gs
, "z", &
£ùiÚ
 ) )

1199  
	`Py_BudV®ue
( "" );

1202 
Ën
 = 
	`¡¾’
(
£ùiÚ
);

1203 iàĞ
µd
 !ğ
NULL
 )

1205  
j
 = 0; j < 
µd
->
num_groups
; j++)

1207  
k
 = 0; k < 
µd
->
groups
[
j
].
num_İtiÚs
; k++)

1209 if(
	`¡ºÿ£cmp
(
µd
->
groups
[
j
].
İtiÚs
[
k
].
keywÜd
, 
£ùiÚ
, 
Ën
) == 0)

1211 
i
 = 1;

1216  
	`Py_BudV®ue
Ğ"i", 
i
);

1217 
	}
}

1223 
PyObjeù
 * 
	$g‘GroupLi¡
Ğ
PyObjeù
 * 
£lf
, PyObjeù * 
¬gs
 )

1225 
PyObjeù
 * 
group_li¡
;

1226 
µd_group_t
 *
group
;

1227 
i
;

1231 iàĞ
µd
 !ğ
NULL
 && 
de¡
 != NULL )

1235 
group_li¡
 = 
	`PyLi¡_New
ĞĞ
Py_ssize_t
 ) 0 );

1236  
i
 = 
µd
->
num_groups
, 
group
 =…pd->
groups
; i > 0; i--, group++ )

1239 
	`PyLi¡_Aµ’d
Ğ
group_li¡
, 
	`PyObj_äom_UTF8
Ğ
group
->
Çme
 ) );

1242  
group_li¡
;

1245  
	`PyLi¡_New
ĞĞ
Py_ssize_t
 ) 0 );

1246 
	}
}

1249 
PyObjeù
 * 
	$g‘Group
Ğ
PyObjeù
 * 
£lf
, PyObjeù * 
¬gs
 )

1251 cÚ¡ *
the_group
;

1252 
µd_group_t
 *
group
;

1253 
i
;

1255 iàĞ!
	`PyArg_P¬£Tu¶e
Ğ
¬gs
, "z", &
the_group
 ) )

1257 
baout
;

1260 iàĞ
µd
 !ğ
NULL
 && 
de¡
 != NULL )

1262  
i
 = 
µd
->
num_groups
, 
group
 =…pd->
groups
; i > 0; i--, group++ )

1264 iàĞ
	`¡rÿ£cmp
Ğ
group
->
Çme
, 
the_group
 ) == 0 )

1266  
	`Py_BudV®ue
Ğ"(si)", 
group
->
‹xt
, group->
num_subgroups
);

1271 
baout
:

1272  
	`Py_BudV®ue
( "" );

1273 
	}
}

1277 
PyObjeù
 * 
	$g‘O±iÚLi¡
Ğ
PyObjeù
 * 
£lf
, PyObjeù * 
¬gs
 )

1279 
PyObjeù
 * 
İtiÚ_li¡
;

1280 cÚ¡ *
the_group
;

1281 
µd_group_t
 *
group
;

1282 
i
, 
j
;

1283 
µd_İtiÚ_t
 *
İtiÚ
;

1285 iàĞ!
	`PyArg_P¬£Tu¶e
Ğ
¬gs
, "z", &
the_group
 ) )

1287 
baout
;

1290 iàĞ
µd
 !ğ
NULL
 && 
de¡
 != NULL )

1292 
İtiÚ_li¡
 = 
	`PyLi¡_New
ĞĞ
Py_ssize_t
 ) 0 );

1294  
i
 = 
µd
->
num_groups
, 
group
 =…pd->
groups
; i > 0; i--, group++ )

1296 iàĞ
	`¡rÿ£cmp
Ğ
group
->
Çme
, 
the_group
 ) == 0 )

1298  
j
 = 
group
->
num_İtiÚs
, 
İtiÚ
 = group->
İtiÚs
; j > 0; j--, option++ )

1300 
	`PyLi¡_Aµ’d
Ğ
İtiÚ_li¡
, 
	`PyObj_äom_UTF8
Ğ
İtiÚ
->
keywÜd
 ) );

1307  
İtiÚ_li¡
;

1312 
baout
:

1313  
	`PyLi¡_New
ĞĞ
Py_ssize_t
 ) 0 );

1314 
	}
}

1319 
PyObjeù
 * 
	$g‘O±iÚ
Ğ
PyObjeù
 * 
£lf
, PyObjeù * 
¬gs
 )

1321 cÚ¡ *
the_group
;

1322 cÚ¡ *
the_İtiÚ
;

1323 
µd_group_t
 *
group
;

1324 
i
, 
j
;

1325 
µd_İtiÚ_t
 *
İtiÚ
;

1328 iàĞ!
	`PyArg_P¬£Tu¶e
Ğ
¬gs
, "zz", &
the_group
, &
the_İtiÚ
 ) )

1330 
baout
;

1333 iàĞ
µd
 !ğ
NULL
 && 
de¡
 != NULL )

1336  
i
 = 
µd
->
num_groups
, 
group
 =…pd->
groups
; i > 0; i--, group++ )

1338 iàĞ
	`¡rÿ£cmp
Ğ
group
->
Çme
, 
the_group
 ) == 0 )

1340  
j
 = 
group
->
num_İtiÚs
, 
İtiÚ
 = group->
İtiÚs
; j > 0; j--, option++ )

1342 iàĞ
	`¡rÿ£cmp
Ğ
İtiÚ
->
keywÜd
, 
the_İtiÚ
 ) == 0 )

1344  
	`Py_BudV®ue
Ğ"(ssbi)", 
İtiÚ
->
‹xt
, o±iÚ->
defchoiû
,

1345 
İtiÚ
->
cÚæiùed
 > 0 ? 1 : 0, o±iÚ->
ui
 );

1352 
baout
:

1353  
	`Py_BudV®ue
( "" );

1354 
	}
}

1357 
PyObjeù
 * 
	$g‘ChoiûLi¡
Ğ
PyObjeù
 * 
£lf
, PyObjeù * 
¬gs
 )

1359 
PyObjeù
 * 
choiû_li¡
;

1360 cÚ¡ *
the_group
;

1361 cÚ¡ *
the_İtiÚ
;

1362 
µd_group_t
 *
group
;

1363 
i
, 
j
, 
k
;

1364 
µd_İtiÚ_t
 *
İtiÚ
;

1365 
µd_choiû_t
 *
choiû
;

1367 iàĞ!
	`PyArg_P¬£Tu¶e
Ğ
¬gs
, "zz", &
the_group
, &
the_İtiÚ
 ) )

1369 
baout
;

1372 iàĞ
µd
 !ğ
NULL
 && 
de¡
 != NULL )

1374 
choiû_li¡
 = 
	`PyLi¡_New
ĞĞ
Py_ssize_t
 ) 0 );

1376  
i
 = 
µd
->
num_groups
, 
group
 =…pd->
groups
; i > 0; i--, group++ )

1378 iàĞ
	`¡rÿ£cmp
Ğ
group
->
Çme
, 
the_group
 ) == 0 )

1380  
j
 = 
group
->
num_İtiÚs
, 
İtiÚ
 = group->
İtiÚs
; j > 0; j--, option++ )

1382 iàĞ
	`¡rÿ£cmp
Ğ
İtiÚ
->
keywÜd
, 
the_İtiÚ
 ) == 0 )

1384  
k
 = 
İtiÚ
->
num_choiûs
, 
choiû
 = o±iÚ->
choiûs
; k > 0; k--, choice++ )

1386 
	`PyLi¡_Aµ’d
Ğ
choiû_li¡
, 
	`PyObj_äom_UTF8
Ğ
choiû
->choice ) );

1396  
choiû_li¡
;

1400 
baout
:

1401  
	`PyLi¡_New
ĞĞ
Py_ssize_t
 ) 0 );

1402 
	}
}

1406 
PyObjeù
 * 
	$g‘Choiû
Ğ
PyObjeù
 * 
£lf
, PyObjeù * 
¬gs
 )

1408 cÚ¡ * 
the_group
;

1409 cÚ¡ *
the_İtiÚ
;

1410 cÚ¡ *
the_choiû
;

1411 
µd_group_t
 *
group
;

1412 
i
, 
j
, 
k
;

1413 
µd_İtiÚ_t
 *
İtiÚ
;

1414 
µd_choiû_t
 *
choiû
;

1417 iàĞ!
	`PyArg_P¬£Tu¶e
Ğ
¬gs
, "zzz", &
the_group
, &
the_İtiÚ
, &
the_choiû
 ) )

1419 
baout
;

1422 iàĞ
µd
 !ğ
NULL
 && 
de¡
 != NULL )

1424  
i
 = 
µd
->
num_groups
, 
group
 =…pd->
groups
; i > 0; i--, group++ )

1426 iàĞ
	`¡rÿ£cmp
Ğ
group
->
Çme
, 
the_group
 ) == 0 )

1428  
j
 = 
group
->
num_İtiÚs
, 
İtiÚ
 = group->
İtiÚs
; j > 0; j--, option++ )

1430 iàĞ
	`¡rÿ£cmp
Ğ
İtiÚ
->
keywÜd
, 
the_İtiÚ
 ) == 0 )

1432  
k
 = 
İtiÚ
->
num_choiûs
, 
choiû
 = o±iÚ->
choiûs
; k > 0; k--, choice++ )

1434 iàĞ
	`¡rÿ£cmp
Ğ
choiû
->choiû, 
the_choiû
 ) == 0 )

1436  
	`Py_BudV®ue
Ğ"(sb)", 
choiû
->
‹xt
, choiû->
m¬ked
 > 0 ? 1 : 0 );

1446 
baout
:

1447  
	`Py_BudV®ue
( "" );

1451 
	}
}

1453 
PyObjeù
 * 
	$£tO±iÚs
Ğ
PyObjeù
 * 
£lf
, PyObjeù * 
¬gs
 )

1455 iàĞ
µd
 !ğ
NULL
 && 
de¡
 != NULL )

1457 
	`cupsF»eO±iÚs
Ğ
de¡
->
num_İtiÚs
, de¡->
İtiÚs
 );

1458 
de¡
->
num_İtiÚs
 = 
g_num_İtiÚs
;

1459 
de¡
->
İtiÚs
 = 
g_İtiÚs
;

1460 
	`cupsS‘De¡s
Ğ
g_num_de¡s
, 
g_de¡s
 );

1461 
	`cupsM¬kO±iÚs
Ğ
µd
, 
de¡
->
num_İtiÚs
, de¡->
İtiÚs
 );

1464  
	`Py_BudV®ue
( "" );

1465 
	}
}

1469 
PyObjeù
 * 
	$´štFeW™hO±iÚs
Ğ
PyObjeù
 * 
£lf
, PyObjeù * 
¬gs
 )

1471 * 
´š‹r
;

1472 * 
f’ame
;

1473 * 
t™Ë
;

1474 
job_id
 = -1;

1475 
cups_de¡_t
 * 
de¡s
 = 
NULL
;

1476 
cups_de¡_t
 * 
de¡
 = 
NULL
;

1477 
num_de¡s
 = 0;

1478 
i
 = 0;

1479 *
»que¡šg_u£r_Çme
 = 
NULL
;

1481 iàĞ!
	`PyArg_P¬£Tu¶e
Ğ
¬gs
, "zzz", &
´š‹r
, &
f’ame
, &
t™Ë
 ) )

1483  
	`Py_BudV®ue
( "" );

1485 
»que¡šg_u£r_Çme
 = 
	`g‘U£rName
();

1486 if(
»que¡šg_u£r_Çme
)

1488 
	`cupsS‘U£r
(
»que¡šg_u£r_Çme
);

1491 
num_de¡s
 = 
	`cupsG‘De¡s
(&
de¡s
);

1492 
de¡
 = 
	`cupsG‘De¡
Ğ
´š‹r
, 
NULL
, 
num_de¡s
, 
de¡s
 );

1494 iàĞ
de¡
 !ğ
NULL
 )

1496  
i
 = 0; i < 
de¡
->
num_İtiÚs
; i++ )

1498 iàĞ
	`cupsG‘O±iÚ
Ğ
de¡
->
İtiÚs
[
i
].
Çme
, 
g_num_İtiÚs
, 
g_İtiÚs
 ) =ğ
NULL
 )

1499 
g_num_İtiÚs
 = 
	`cupsAddO±iÚ
Ğ
de¡
->
İtiÚs
[
i
].
Çme
, de¡->İtiÚs[i].
v®ue
, g_num_İtiÚs, &
g_İtiÚs
 );

1503 
job_id
 = 
	`cupsPrštFe
Ğ
de¡
->
Çme
, 
f’ame
, 
t™Ë
, 
g_num_İtiÚs
, 
g_İtiÚs
 );

1505  
	`Py_BudV®ue
Ğ"i", 
job_id
 );

1509  
	`Py_BudV®ue
( "i", -1 );

1510 
	}
}

1514 
PyObjeù
 * 
	g·sswÜdFunc
 = 
NULL
;

1515 *
	g·sswÜdProm±
 = 
NULL
;

1517 cÚ¡ * 
	$·sswÜd_ÿÎback
(cÚ¡ * 
´om±
)

1520 
PyObjeù
 *
»suÉ
 = 
NULL
;

1521 
PyObjeù
 *
u£ºameObj
 = 
NULL
;

1522 
PyObjeù
 *
·sswÜdObj
 = 
NULL
;

1523 *
u£ºame
 = 
NULL
;

1524 *
·sswÜd
 = 
NULL
;

1526 ià(
·sswÜdFunc
 !ğ
NULL
)

1529 ià(
·sswÜdProm±
)

1530 
´om±
 = 
·sswÜdProm±
;

1532 
»suÉ
 = 
	`PyObjeù_C®lFunùiÚ
(
·sswÜdFunc
, "s", 
´om±
);

1533 ià(!
»suÉ
)

1536 
u£ºameObj
 = 
	`PyTu¶e_G‘I‹m
(
»suÉ
, 0);

1537 ià(!
u£ºameObj
)

1539 
u£ºame
 = 
	`PYUnicode_UNICODE
(
u£ºameObj
);

1541 ià(!
u£ºame
)

1544 
auth_ÿnûl_»q
 = ('\0' =ğ
u£ºame
[0])? 1 : 0 ;

1546 
·sswÜdObj
 = 
	`PyTu¶e_G‘I‹m
(
»suÉ
, 1);

1547 ià(!
·sswÜdObj
)

1549 
·sswÜd
 = 
	`PYUnicode_UNICODE
(
·sswÜdObj
);

1551 ià(!
·sswÜd
)

1554 
	`cupsS‘U£r
(
u£ºame
);

1555  
·sswÜd
;

1561 
	}
}

1563 
PyObjeù
 *
	$£tPasswÜdProm±
(
PyObjeù
 *
£lf
, PyObjeù *
¬gs
)

1566 *
u£rProm±
 = 
NULL
;

1568 ià(!
	`PyArg_P¬£Tu¶e
(
¬gs
, "z", &
u£rProm±
))

1569  
	`Py_BudV®ue
("");

1571 ià(
	`¡¾’
(
u£rProm±
) != 0)

1572 
·sswÜdProm±
 = 
u£rProm±
;

1574 
·sswÜdProm±
 = 
NULL
;

1576  
	`Py_BudV®ue
("");

1578 
	}
}

1580 
PyObjeù
 * 
	$£tPasswÜdC®lback
Ğ
PyObjeù
 * 
£lf
, PyObjeù * 
¬gs
 )

1582 ifĞ!
	`PyArg_P¬£Tu¶e
Ğ
¬gs
, "O", &
·sswÜdFunc
 ) )

1584  
	`Py_BudV®ue
( "i", 0 );

1587 
	`cupsS‘PasswÜdCB
(
·sswÜd_ÿÎback
);

1589  
	`Py_BudV®ue
( "i", 1 );

1590 
	}
}

1593 
PyObjeù
 * 
	$g‘PasswÜd
Ğ
PyObjeù
 * 
£lf
, PyObjeù * 
¬gs
 )

1595 cÚ¡ * 
pwd
;

1596 * 
´om±
;

1598 ifĞ!
	`PyArg_P¬£Tu¶e
Ğ
¬gs
, "s", &
´om±
 ) )

1600  
	`Py_BudV®ue
( "" );

1603 
pwd
 = 
	`cupsG‘PasswÜd
Ğ
´om±
 );

1605 ifĞ
pwd
 )

1607  
	`Py_BudV®ue
Ğ"s", 
pwd
 );

1611  
	`Py_BudV®ue
( "" );

1613 
	}
}

1619 
PyM‘hodDef
 
	gcup£xt_m‘hods
[] =

1621 { "g‘Prš‹rs", ( 
PyCFunùiÚ
 ) 
g‘Prš‹rs
, 
METH_VARARGS
 },

1622 { "addPrš‹r", ( 
PyCFunùiÚ
 ) 
addPrš‹r
, 
METH_VARARGS
 },

1623 { "d–Prš‹r", ( 
PyCFunùiÚ
 ) 
d–Prš‹r
, 
METH_VARARGS
 },

1624 { "g‘DeçuÉPrš‹r", ( 
PyCFunùiÚ
 ) 
g‘DeçuÉPrš‹r
, 
METH_VARARGS
 },

1625 { "£tDeçuÉPrš‹r", ( 
PyCFunùiÚ
 ) 
£tDeçuÉPrš‹r
, 
METH_VARARGS
 },

1626 { "cÚŒŞPrš‹r", ( 
PyCFunùiÚ
 ) 
cÚŒŞPrš‹r
, 
METH_VARARGS
 },

1627 { "g‘PPDLi¡", ( 
PyCFunùiÚ
 ) 
g‘PPDLi¡
, 
METH_VARARGS
 },

1628 { "g‘PPD", ( 
PyCFunùiÚ
 ) 
g‘PPD
, 
METH_VARARGS
 },

1629 { "İ’PPD", ( 
PyCFunùiÚ
 ) 
İ’PPD
, 
METH_VARARGS
 },

1630 { "şo£PPD", ( 
PyCFunùiÚ
 ) 
şo£PPD
, 
METH_VARARGS
 },

1631 { "g‘PPDO±iÚ", ( 
PyCFunùiÚ
 ) 
g‘PPDO±iÚ
, 
METH_VARARGS
 },

1632 { "g‘PPDPageSize", ( 
PyCFunùiÚ
 ) 
g‘PPDPageSize
, 
METH_VARARGS
 },

1633 { "g‘V”siÚ", ( 
PyCFunùiÚ
 ) 
g‘V”siÚ
, 
METH_VARARGS
 },

1634 { "g‘V”siÚTu¶e", ( 
PyCFunùiÚ
 ) 
g‘V”siÚTu¶e
, 
METH_VARARGS
 },

1635 { "ÿnûlJob", ( 
PyCFunùiÚ
 ) 
ÿnûlJob
, 
METH_VARARGS
 },

1636 { "g‘Jobs", ( 
PyCFunùiÚ
 ) 
g‘Jobs
, 
METH_VARARGS
 },

1637 { "g‘S”v”", ( 
PyCFunùiÚ
 ) 
g‘S”v”
, 
METH_VARARGS
 },

1638 { "£tS”v”", ( 
PyCFunùiÚ
 ) 
£tS”v”
, 
METH_VARARGS
 },

1639 { "addO±iÚ", ( 
PyCFunùiÚ
 ) 
addO±iÚ
, 
METH_VARARGS
 },

1640 { "»moveO±iÚ", ( 
PyCFunùiÚ
 ) 
»moveO±iÚ
, 
METH_VARARGS
 },

1641 { "»£tO±iÚs", ( 
PyCFunùiÚ
 ) 
»£tO±iÚs
, 
METH_VARARGS
 },

1642 { "´štFeW™hO±iÚs", ( 
PyCFunùiÚ
 ) 
´štFeW™hO±iÚs
, 
METH_VARARGS
 },

1643 { "Job", ( 
PyCFunùiÚ
 ) 
ÃwJob
, 
METH_VARARGS
 | 
METH_KEYWORDS
 },

1644 { "Prš‹r", ( 
PyCFunùiÚ
 ) 
ÃwPrš‹r
, 
METH_VARARGS
 | 
METH_KEYWORDS
 },

1645 { "g‘GroupLi¡", ( 
PyCFunùiÚ
 ) 
g‘GroupLi¡
, 
METH_VARARGS
 },

1646 { "g‘Group", ( 
PyCFunùiÚ
 ) 
g‘Group
, 
METH_VARARGS
 },

1647 { "g‘O±iÚLi¡", ( 
PyCFunùiÚ
 ) 
g‘O±iÚLi¡
, 
METH_VARARGS
 },

1648 { "g‘O±iÚ", ( 
PyCFunùiÚ
 ) 
g‘O±iÚ
, 
METH_VARARGS
 },

1649 { "g‘ChoiûLi¡", ( 
PyCFunùiÚ
 ) 
g‘ChoiûLi¡
, 
METH_VARARGS
 },

1650 { "g‘Choiû", ( 
PyCFunùiÚ
 ) 
g‘Choiû
, 
METH_VARARGS
 },

1651 { "£tO±iÚs", ( 
PyCFunùiÚ
 ) 
£tO±iÚs
, 
METH_VARARGS
 },

1652 { "g‘O±iÚs", ( 
PyCFunùiÚ
 ) 
g‘O±iÚs
, 
METH_VARARGS
 },

1653 { "du¶iÿ‹SeùiÚ", ( 
PyCFunùiÚ
 ) 
du¶iÿ‹SeùiÚ
, 
METH_VARARGS
 },

1654 { "£tPasswÜdProm±", (
PyCFunùiÚ
è
£tPasswÜdProm±
, 
METH_VARARGS
 },

1655 { "£tPasswÜdC®lback", ( 
PyCFunùiÚ
 ) 
£tPasswÜdC®lback
, 
METH_VARARGS
 },

1656 { "g‘PasswÜd", ( 
PyCFunùiÚ
 ) 
g‘PasswÜd
, 
METH_VARARGS
 },

1657 { "fšdPPDA‰ribu‹", ( 
PyCFunùiÚ
 ) 
fšdPPDA‰ribu‹
, 
METH_VARARGS
 },

1658 { "»Ëa£CupsIn¡ªû", ( 
PyCFunùiÚ
 ) 
»Ëa£CupsIn¡ªû
, 
METH_VARARGS
 },

1659 { "g‘StusA‰ribu‹s", ( 
PyCFunùiÚ
 ) 
g‘StusA‰ribu‹s
, 
METH_VARARGS
 },

1660 { 
NULL
, NULL }

1664 
	gcup£xt_docum’tiÚ
[] = "Pythonƒxtension for CUPS 1.x";

1678 
	$MOD_INIT
(
cup£xt
) {

1680 
PyObjeù
* 
mod
 ;

1681 
	`MOD_DEF
(
mod
, "cup£xt", 
cup£xt_docum’tiÚ
, 
cup£xt_m‘hods
);

1682 ià(
mod
 =ğ
NULL
)

1683  
MOD_ERROR_VAL
;

1685  
	`MOD_SUCCESS_VAL
(
mod
);

1687 
	}
}

	@prnt/cupsext/cupsext.h

1 #ià
PY_MAJOR_VERSION
 >= 3

2 
	#MOD_ERROR_VAL
 
NULL


	)

3 
	#MOD_SUCCESS_VAL
(
v®
è
	)
val

4 
	#MOD_INIT
(
Çme
è
PyMODINIT_FUNC
 
PyIn™_
##
	`Çme
()

	)

5 
	#MOD_DEF
(
ob
, 
Çme
, 
doc
, 
m‘hods
) \

6 
PyModuËDef
 
moduËdef
 = { \

7 
PyModuËDef_HEAD_INIT
, 
Çme
, 
doc
, -1, 
m‘hods
, }; \

8 
ob
 = 
	`PyModuË_C»©e
(&
moduËdef
);

	)

9 
	#PYUnicode_STRING
 
PyUnicode_FromSŒšg


	)

10 
	#PYUnicode_UNICODE
(
x
è
	`PyBy‹s_AS_STRING
(
	`PyUnicode_AsEncodedSŒšg
(x, "utf-8",""))

	)

12 
	#MOD_ERROR_VAL


	)

13 
	#MOD_SUCCESS_VAL
(
v®
)

	)

14 
	#MOD_INIT
(
Çme
è
š™
##
	`Çme
()

	)

15 
	#MOD_DEF
(
ob
, 
Çme
, 
doc
, 
m‘hods
) \

16 
ob
 = 
	`Py_In™ModuË3
(
Çme
, 
m‘hods
, 
doc
);

	)

17 
	#PYUnicode_STRING
 
PySŒšg_FromSŒšg


	)

18 
	#PYUnicode_UNICODE
 
PySŒšg_AsSŒšg


	)

	@prnt/hpcups/BreakTables.cpp

31 
	gHTBš¬y_İ’
[1024]=

291 
	gHT300x3004Ëv–_İ’
[1024]=

551 
	gHT600x6004Ëv–895_İ’
[1024]=

811 
	gHT300x3004Ëv–970_İ’
[1024] =

1071 
	gHT600x6004Ëv–970_İ’
[1024] =

1331 
	gHT600x6004Ëv–3600_İ’
[1024] =

1591 
	gHT1200x1200x1_PhÙoP»s970_İ’
[1024] =

1851 
	gHT600x600x4_P»s970_İ’
[1024] =

2111 
	gHT1200x1200x1PhÙoBe¡_İ’
[1024] =

	@prnt/hpcups/ColorMaps.h

1 
ušt32_t
 
ulM­DJ400_K
[9 * 9 * 9];

2 
ušt32_t
 
ulM­DJ400_CMY
[9 * 9 * 9];

4 
ušt32_t
 
ulM­DJ600_CCM_K
[ 9 * 9 * 9 ];

5 
ušt32_t
 
ulM­DJ600_CCM_K
[ 9 * 9 * 9 ];

6 
ušt32_t
 
ulM­DJ600_CCM_CMY
[ 9 * 9 * 9 ];

7 
ušt32_t
 
ulM­DJ660_CCM_KCMY
[ 9 * 9 * 9 ];

8 
ušt32_t
 
ulM­DJ690_CMYK
[ 9 * 9 * 9 ];

9 
ušt32_t
 
ulM­GRAY_K_6x6x1
[9 * 9 * 9];

10 
ušt32_t
 
ulM­DJ690_ClMlxx
[9 * 9 * 9];

12 
ušt32_t
 
ulM­DJ850_NÜm®_KCMY
[9 * 9 * 9];

14 
ušt32_t
 
ulM­DJ895_KCMY
[ 9 * 9 * 9 ];

15 
ušt32_t
 
ulM­DJ895_HB_KCMY
[ 9 * 9 * 9 ];

16 
ušt32_t
 
ulM­DJ895_Bš¬y_KCMY
[ 9 * 9 * 9 ];

18 
ušt32_t
 
ulM­DJ8x5PÏšNÜm®
[ 9 * 9 * 9 ];

19 
ušt32_t
 
ulM­DJ8x5D¿á
[ 9 * 9 * 9 ];

21 
ušt32_t
 
ulM­DJ970_KCMY
[9 * 9 * 9];

22 
ušt32_t
 
ulM­DJ970_KCMY_3x3x2
[9 * 9 * 9];

23 
ušt32_t
 
ulM­DJ970_Gossim”_NÜm®_KCMY
[9 * 9 * 9];

24 
ušt32_t
 
ulM­DJ600_CCM_K
[9 * 9 * 9];

25 
ušt32_t
 
ulM­GRAY_K_6x6x1
[9 * 9 * 9];

26 
ušt32_t
 
ulM­DJ970_D¿á_KCMY
[9 * 9 * 9];

28 
ušt32_t
 
ulM­DJ3320_K_3x3x1
[9 * 9 * 9];

29 
ušt32_t
 
ulM­DJ3320_K_6x6x1
[9 * 9 * 9];

30 
ušt32_t
 
ulM­DJ3320_CMY_3x3x1
[9 * 9 * 9];

31 
ušt32_t
 
ulM­DJ3320_CMY_6x6x1
[9 * 9 * 9];

32 
ušt32_t
 
ulM­DJ3320_KCMY_3x3x1
[9 * 9 * 9];

33 
ušt32_t
 
ulM­DJ3320_KCMY_6x6x1
[9 * 9 * 9];

34 
ušt32_t
 
ulM­DJ970_Gossim”_NÜm®_KCMY
[ 9 * 9 * 9 ];

36 
ušt32_t
 
ulM­DJ3600_KCMY_6x6x1
[9 * 9 * 9];

37 
ušt32_t
 
ulM­DJ3600_ClMlxx_6x6x1
[9 * 9 * 9];

38 
ušt32_t
 
ulM­DJ3600_KCMY_6x6x2
[9 * 9 * 9];

39 
ušt32_t
 
ulM­DJ3600_ClMlxx_6x6x2
[9 * 9 * 9];

40 
ušt32_t
 
ulM­DJ3600_KCMY_3x3x1
[9 * 9 * 9];

41 
ušt32_t
 
ulM­DJ3600_ClMlxx_3x3x1
[9 * 9 * 9];

43 
ucM­DJ4100_KCMY_6x6x1
[];

44 
ucM­DJ4100_KCMY_PhÙo_Be¡V_12x12x1
[];

45 
ucM­DJ4100_KCMY_PhÙo_Be¡A_12x12x1
[];

47 
ucM­DJ4100_KCMY_PhÙo_Be¡A_12x12x1
[17 * 17 * 17];

	@prnt/hpcups/ColorMatcher.cpp

31 
	~"CommÚDefš™iÚs.h
"

32 
	~"ProûssÜ.h
"

33 
	~"CŞÜM©ch”.h
"

35 
	gCŞÜM©ch”
::
CŞÜM©ch”


37 
CŞÜM­
 
cm
,

38 
	gDyeCouÁ
,

39 
	giIÅutWidth


40 è: 
CŞÜPÏÃCouÁ
(
DyeCouÁ
),

41 
IÅutWidth
(
iIÅutWidth
),

42 
	$cm­
(
cm
)

44 
cÚ¡ruùÜ_”rÜ
 = 
NO_ERROR
;

45 
	`ASSERT
((
cm­
.
ulM­1
 !ğ
NULL
 || cm­.
ulM­3
 != NULL));

46 
S¹PÏÃ
 = 
K
;

48 ià(
CŞÜPÏÃCouÁ
 == 3)

50 
S¹PÏÃ
 = 
C
;

53 
EndPÏÃ
 = 
Y
;

54 ià(
CŞÜPÏÃCouÁ
 == 6)

56 
EndPÏÃ
 = 
Mlight
;

58 ià(
CŞÜPÏÃCouÁ
 == 1)

60 
EndPÏÃ
 = 
K
;

63 
CÚtÚe
 = (
BYTE
 *è
Ãw
 BYTE[
IÅutWidth
 * 
CŞÜPÏÃCouÁ
];

64 ià(
CÚtÚe
 =ğ
NULL
)

66 
MemÜyE¼Ü
;

69 
	`Re¡¬t
();

73 
MemÜyE¼Ü
:

74 
cÚ¡ruùÜ_”rÜ
=
ALLOCMEM_ERROR
;

76 
	`F»eBufãrs
();

78 
	}
}

80 
	gCŞÜM©ch”
::~
	$CŞÜM©ch”
()

82 
	`F»eBufãrs
();

83 
	}
}

86 
	gCŞÜM©ch”
::
	$Re¡¬t
()

89 
	`mem£t
(
CÚtÚe
, 0, 
IÅutWidth
*
CŞÜPÏÃCouÁ
);

91 
¡¬‹d
 = 
çl£
;

92 
	}
}

94 
	gCŞÜM©ch”
::
	$Flush
()

97 ià(!
¡¬‹d
)

101 
	`Re¡¬t
();

102 
	}
}

104 
	gCŞÜM©ch”
::
	$F»eBufãrs
()

106 
d–‘e
 [] 
CÚtÚe
;

107 
	}
}

109 
boŞ
 
	gCŞÜM©ch”
::
	$NextOuutRa¡”
(
RASTERDATA
 &
Ãxt_¿¡”
)

111 ià(
iRa¡”sR—dy
 == 0)

112  
çl£
;

114 
iRa¡”sR—dy
--;

115 
iRa¡”sD–iv”ed
++;

116 ià(
¿¡”
.
¿¡”d©a
[
COLORTYPE_COLOR
] !ğ
NULL
)

118 
Ãxt_¿¡”
.
¿¡”size
[
COLORTYPE_COLOR
] = 
¿¡”
.rastersize[COLORTYPE_COLOR];

119 
Ãxt_¿¡”
.
¿¡”d©a
[
COLORTYPE_COLOR
] = 
CÚtÚe
;

123 
Ãxt_¿¡”
.
¿¡”size
[
COLORTYPE_COLOR
] = 0;

124 
Ãxt_¿¡”
.
¿¡”d©a
[
COLORTYPE_COLOR
] = 
¿¡”
.rasterdata[COLORTYPE_COLOR];

126 
Ãxt_¿¡”
.
¿¡”size
[
COLORTYPE_BLACK
] = 
¿¡”
.rastersize[COLORTYPE_BLACK];

127 
Ãxt_¿¡”
.
¿¡”d©a
[
COLORTYPE_BLACK
] = 
¿¡”
.rasterdata[COLORTYPE_BLACK];

128  
Œue
;

129 
	}
}

132 
	gCŞÜM©ch”
::
	$G‘MaxOuutWidth
()

134 ià(
my¶ªe
 =ğ
COLORTYPE_COLOR
)

136 ià(
¿¡”
.
¿¡”d©a
[
my¶ªe
] =ğ
NULL
)

139  
IÅutWidth
*
CŞÜPÏÃCouÁ
;

143  
¿¡”
.
¿¡”size
[
my¶ªe
];

145 
	}
}

147 
	gCŞÜM©ch”
::
CŞÜM©ch


149 
width
,

150 cÚ¡ 
ušt32_t
 *
	gm­
,

151 *
	grgb
,

152 *
	gk¶ªe
,

153 *
	gıÏÃ
,

154 *
	gm¶ªe
,

155 *
	gy¶ªe


158 
ušt32_t
 
	g´ev_»d
 = 255, 
	g´ev_g»’
 = 255, 
	g´ev_blue
 = 255;

159 
BYTE
 
	gbcyª
, 
	gbmag’
, 
	gby–low
, 
	gbbÏck
;

161 
ušt32_t
 
	gr
;

162 
ušt32_t
 
	gg
;

163 
ušt32_t
 
	gb
;

165 
	gi
 = 0; i < 
	gwidth
; i++)

167 
	gr
 = *
rgb
++;

168 
	gg
 = *
rgb
++;

169 
	gb
 = *
rgb
++;

171 if(
	gi
 =ğ0 || ( (
´ev_»d
 !ğ
r
è|| (
´ev_g»’
 !ğ
g
è|| (
´ev_blue
 !ğ
b
) ))

173 
´ev_»d
 = 
r
;

174 
	g´ev_g»’
 = 
g
;

175 
	g´ev_blue
 = 
b
;

177 
IÁ”pŞ©e
(
m­
, (
BYTE
)
r
, (BYTE)
g
,(BYTE)
b
, &
bbÏck
, &
bcyª
, &
bmag’
, &
by–low
);

179 ià(
	gk¶ªe
)

180 *(
	gk¶ªe
 + 
	gi
èğ
bbÏck
;

181 ià(
	gıÏÃ
)

182 *(
	gıÏÃ
 + 
	gi
èğ
bcyª
;

183 ià(
	gm¶ªe
)

184 *(
	gm¶ªe
 + 
	gi
èğ
bmag’
;

185 ià(
	gy¶ªe
)

186 *(
	gy¶ªe
 + 
	gi
èğ
by–low
;

192 
	gCŞÜM©ch”
::
CŞÜM©ch


194 
width
,

195 cÚ¡ *
	gm­
,

196 *
	grgb
,

197 *
	gk¶ªe
,

198 *
	gıÏÃ
,

199 *
	gm¶ªe
,

200 *
	gy¶ªe


203 
BYTE
 
	g´ev_»d
 = 255, 
	g´ev_g»’
 = 255, 
	g´ev_blue
 = 255;

204 
BYTE
 
	gbcyª
, 
	gbmag’
, 
	gby–low
, 
	gbbÏck
;

206 
BYTE
 
	gr
;

207 
BYTE
 
	gg
;

208 
BYTE
 
	gb
;

210 
	gi
 = 0; i < 
	gwidth
; i++)

212 
	gr
 = *
rgb
++;

213 
	gg
 = *
rgb
++;

214 
	gb
 = *
rgb
++;

215 if(
	gi
 =ğ0 || ( (
´ev_»d
 !ğ
r
è|| (
´ev_g»’
 !ğ
g
è|| (
´ev_blue
 !ğ
b
) ))

217 
´ev_»d
 = 
r
;

218 
	g´ev_g»’
 = 
g
;

219 
	g´ev_blue
 = 
b
;

221 
IÁ”pŞ©e
(
m­
, (
BYTE
)
r
, (BYTE)
g
,(BYTE)
b
, &
bbÏck
, &
bcyª
, &
bmag’
, &
by–low
);

223 ià(
	gk¶ªe
)

224 *(
	gk¶ªe
 + 
	gi
èğ
bbÏck
;

225 ià(
	gıÏÃ
)

226 *(
	gıÏÃ
 + 
	gi
èğ
bcyª
;

227 ià(
	gm¶ªe
)

228 *(
	gm¶ªe
 + 
	gi
èğ
bmag’
;

229 ià(
	gy¶ªe
)

230 *(
	gy¶ªe
 + 
	gi
èğ
by–low
;

236 
ušt32_t
 
	$Packed
(
k
,
c
,
m
,
y
)

238 
ušt32_t
 
p
 = 
y
;

239 
p
 =… << 8;

240 
p
 +ğ
m
;

241 
p
 =… << 8;

242 
p
 +ğ
c
;

243 
p
 =… << 8;

244 
p
 +ğ
k
;

245  
p
;

246 
	}
}

249 
DRIVER_ERROR
 
	gCŞÜM©ch”
::
	$MakeG¿yM­
(cÚ¡ 
ušt32_t
 *
cŞÜm­
, ušt32_t* 
g¿ym­
)

251 
ul_M­PŒ
;

252 
r
 = 0;„ < 9;„++)

254 
ul_RedM­PŒ
 = 
r
 * 9 * 9;

255 
g
 = 0; g < 9; g++)

257 
ul_G»’M­PŒ
 = 
g
 * 9;

258 
b
 = 0; b < 9; b++)

260 
m­±r
 = 
b
 + (
g
 * 9è+ (
r
 * 9 * 9);

261 
ul_M­PŒ
 = 
b
 + 
ul_G»’M­PŒ
 + 
ul_RedM­PŒ
;

262 
	`ASSERT
(
m­±r
 =ğ
ul_M­PŒ
);

264 
ŞdR
 = 
r
 * 255 >> 3;

265 
ŞdG
 = 
g
 * 255 >> 3;

266 
ŞdB
 = 
b
 * 255 >> 3;

269 
g¿y
 = ((30 * 
ŞdR
 + 59 * 
ŞdG
 + 11 * 
ŞdB
 + 50) / 100);

271 
ušt32_t
 *
¡¬t
;

272 
¡¬t
 = (
ušt32_t
 *)

273 Ğ((
g¿y
 & 0xE0) <<1) + ((gray & 0xE0)>>1) + (gray>>5) +

274 ((
g¿y
 & 0xE0è>>2è+ (g¿y>>5è+ (g¿y>>5è+ 
cŞÜm­
);

276 
BYTE
 
k
,
c
,
m
,
y
;

277 
	`IÁ”pŞ©e
(
¡¬t
, 
g¿y
, g¿y, g¿y, &
k
, &
c
, &
m
, &
y
);

281 *(
g¿ym­
 + 
m­±r
èğ
	`Packed
(
k
, 
c
, 
m
, 
y
);

285  
NO_ERROR
;

286 
	}
}

289 
boŞ
 
	gCŞÜM©ch”
::
	$Proûss
(
RASTERDATA
* 
pbyIÅutKRGBRa¡”
)

291 ià(
pbyIÅutKRGBRa¡”
 =ğ
NULL
 || (pbyIÅutKRGBRa¡”->
¿¡”d©a
[
COLORTYPE_BLACK
] =ğNULL &&…byIÅutKRGBRa¡”->¿¡”d©a[
COLORTYPE_COLOR
] == NULL))

293 
	`Re¡¬t
();

294  
çl£
;

296 
¡¬‹d
=
Œue
;

298 ià(
pbyIÅutKRGBRa¡”
->
¿¡”d©a
[
COLORTYPE_COLOR
])

300 
BYTE
* 
buff1
 = 
NULL
;

301 
BYTE
* 
buff2
 = 
NULL
;

302 
BYTE
* 
buff3
 = 
NULL
;

303 
BYTE
* 
buff4
 = 
NULL
;

305 ià(
S¹PÏÃ
 =ğ
K
)

307 
buff1
 = 
CÚtÚe
;

308 ià(
EndPÏÃ
>
K
)

310 
buff2
 = 
buff1
 + 
IÅutWidth
;

311 
buff3
 = 
buff2
 + 
IÅutWidth
;

312 
buff4
 = 
buff3
 + 
IÅutWidth
;

317 
buff2
 = 
CÚtÚe
;

318 
buff3
 = 
buff2
 + 
IÅutWidth
;

319 
buff4
 = 
buff3
 + 
IÅutWidth
;

322 ià(
cm­
.
ulM­3
)

324 
	`CŞÜM©ch
Ğ
IÅutWidth
,

325 (cÚ¡ *è
cm­
.
ulM­3
,

326 
pbyIÅutKRGBRa¡”
->
¿¡”d©a
[
COLORTYPE_COLOR
],

327 
buff1
,

328 
buff2
,

329 
buff3
,

330 
buff4


333 ià(
cm­
.
ulM­1
)

336 
	`CŞÜM©ch
Ğ
IÅutWidth
,

337 (cÚ¡ 
ušt32_t
 *è
cm­
.
ulM­1
,

338 
pbyIÅutKRGBRa¡”
->
¿¡”d©a
[
COLORTYPE_COLOR
],

339 
buff1
,

340 
buff2
,

341 
buff3
,

342 
buff4


346 ià(
EndPÏÃ
 > 
Y
 && 
cm­
.
ulM­2
)

348 
BYTE
* 
buff5
 = 
buff4
 + 
IÅutWidth
;

349 
BYTE
* 
buff6
 = 
buff5
 + 
IÅutWidth
;

351 
	`CŞÜM©ch
Ğ
IÅutWidth
,

352 (cÚ¡ 
ušt32_t
 *è
cm­
.
ulM­2
,

353 
pbyIÅutKRGBRa¡”
->
¿¡”d©a
[
COLORTYPE_COLOR
],

354 
NULL
,

355 
buff5
,
buff6
,

356 
NULL


361 
iRa¡”sR—dy
 = 1;

362 
iRa¡”sD–iv”ed
 = 0;

363  
Œue
;

364 
	}
}

366 
	#INTERPOLATE_5_BITS
(
a
, 
b
, 
d
è¨+ ( ( ( ()b - (ï ) * dè>> 5)

	)

367 
	#INTERPOLATE_4_BITS
(
a
, 
b
, 
d
è¨+ ( ( ( ()b - (ï ) * dè>> 4)

	)

370 
	#INTERPOLATE_CUBE
(
r
,
g
,
b
, 
cube
, 
DOCALC
) \

371 
	`DOCALC
Ğ(DOCALCĞ(DOCALCĞ
cube
[0], cube[4], (
r
))), \

372 (
	`DOCALC
Ğ
cube
[2], cube[6], (
r
))), (
g
))), \

373 (
	`DOCALC
Ğ(DOCALCĞ
cube
[1], cube[5], (
r
))), \

374 (
	`DOCALC
Ğ
cube
[3], cube[7], (
r
))), (
g
))), \

375 (
b
))

	)

377 
	gCŞÜM©ch”
::
IÁ”pŞ©e


379 cÚ¡ 
ušt32_t
 *
m­
,

380 
BYTE
 
	gr
,

381 
BYTE
 
	gg
,

382 
BYTE
 
	gb
,

383 
BYTE
 *
	gbÏckout
,

384 
BYTE
 *
	gcyªout
,

385 
BYTE
 *
	gmag’out
,

386 
BYTE
 *
	gy–lowout


389 
	gcube_loÿtiÚ
[] = {0, 1, 9, 10, 81, 82, 90, 91 };

390 cÚ¡ 
ušt32_t
 *
	g¡¬t
;

392 
BYTE
 
	gcyª
[8], 
	gmag’
[8],
	gy–low
[8],
	gbÏck
[8];

393 
	g¡¬t
 = (cÚ¡ 
ušt32_t
 *)

394 (((
r
 & 0xE0) << 1) + ((r & 0xE0) >> 1) + (r >> 5) +

395 ((
g
 & 0xE0è>> 2è+ (g >> 5è+ (
b
 >> 5è+ 
m­
);

397 
ušt32_t
 
	gcV®ue
;

398 
	gj
 = 0; j < 8; j++)

400 
	gcV®ue
 = *(
¡¬t
 + 
cube_loÿtiÚ
[
j
]);

401 
	gcyª
[
j
] = 
G‘CyªV®ue
 (
cV®ue
);

402 
	gmag’
[
j
] = 
G‘Mag’V®ue
 (
cV®ue
);

403 
	gy–low
[
j
] = 
G‘Y–lowV®ue
 (
cV®ue
);

404 
	gbÏck
[
j
] = 
G‘BÏckV®ue
 (
cV®ue
);

408 
BYTE
 
	gdiff_»d
 = 
r
 & 0x1f;

409 
BYTE
 
	gdiff_g»’
 = 
g
 & 0x1f;

410 
BYTE
 
	gdiff_blue
 = 
b
 & 0x1f;

412 *
	gcyªout
 = 
INTERPOLATE_CUBE
(
diff_»d
,
diff_g»’
,
diff_blue
, 
cyª
, 
INTERPOLATE_5_BITS
 );

413 *
	gmag’out
 = 
INTERPOLATE_CUBE
(
diff_»d
,
diff_g»’
,
diff_blue
, 
mag’
, 
INTERPOLATE_5_BITS
 );

414 *
	gy–lowout
 = 
INTERPOLATE_CUBE
(
diff_»d
,
diff_g»’
,
diff_blue
, 
y–low
, 
INTERPOLATE_5_BITS
 );

415 *
	gbÏckout
 = 
INTERPOLATE_CUBE
(
diff_»d
,
diff_g»’
,
diff_blue
, 
bÏck
, 
INTERPOLATE_5_BITS
 );

418 
	gCŞÜM©ch”
::
IÁ”pŞ©e


420 cÚ¡ *
m­
,

421 
BYTE
 
	gr
,

422 
BYTE
 
	gg
,

423 
BYTE
 
	gb
,

424 
BYTE
 *
	gbÏckout
,

425 
BYTE
 *
	gcyªout
,

426 
BYTE
 *
	gmag’out
,

427 
BYTE
 *
	gy–lowout


430 
BYTE
 
	gcyª
[8], 
	gmag’
[8],
	gy–low
[8],
	gbÏck
[8];

433 
	gcube_loÿtiÚ
[] = {0, 4, 68, 72, 1156, 1160, 1224, 1228};

434 cÚ¡ 
BYTE
 *
	g¡¬t
;

436 
BYTE
 *
	gnode_±r
;

438 
	g¡¬t
 = (const *)

439 ((((
r
 & 0xF0) << 4) + ((r & 0xF0) << 1) + (r >> 4) +

440 ((
g
 & 0xF0)è+ (g >> 4è+ (
b
 >> 4)è* 4 + 
m­
);

443 
	gj
 = 0; j < 8; ++j )

445 
	gnode_±r
 = (
BYTE
 *è(
¡¬t
 + 
cube_loÿtiÚ
[
j
]);

446 
	gbÏck
[
j
] = *
node_±r
++;

447 
	gcyª
[
j
] = *
node_±r
++;

448 
	gmag’
[
j
] = *
node_±r
++;

449 
	gy–low
[
j
] = *
node_±r
;

454 
BYTE
 
	gdiff_»d
 = 
r
 & 0x0f;

455 
BYTE
 
	gdiff_g»’
 = 
g
 & 0x0f;

456 
BYTE
 
	gdiff_blue
 = 
b
 & 0x0f;

458 *
	gcyªout
 = 
INTERPOLATE_CUBE
(
diff_»d
,
diff_g»’
,
diff_blue
, 
cyª
, 
INTERPOLATE_4_BITS
 );

459 *
	gmag’out
 = 
INTERPOLATE_CUBE
(
diff_»d
,
diff_g»’
,
diff_blue
, 
mag’
, 
INTERPOLATE_4_BITS
 );

460 *
	gy–lowout
 = 
INTERPOLATE_CUBE
(
diff_»d
,
diff_g»’
,
diff_blue
, 
y–low
, 
INTERPOLATE_4_BITS
 );

461 *
	gbÏckout
 = 
INTERPOLATE_CUBE
(
diff_»d
,
diff_g»’
,
diff_blue
, 
bÏck
, 
INTERPOLATE_4_BITS
 );

	@prnt/hpcups/ColorMatcher.h

31 #iâdeà
COLORMATCHER_H


32 
	#COLORMATCHER_H


	)

34 
	#TESTMODE
 0

	)

35 
	#MAP17CUBE
 1

	)

36 
	#OCT_MASK1
 0x10

	)

37 
	#OCT_MASK2
 0x8

	)

38 
	#OCT_MASK3
 0x4

	)

39 
	#OCT_MASK4
 0x2

	)

40 
	#OCT_MASK5
 0x1

	)

42 şas 
	cCŞÜM©ch”
 : 
public
 
ProûssÜ


44 
public
:

45 
CŞÜM©ch”
(
CŞÜM­
 
cm
, 
DyeCouÁ
,

46 
iIÅutWidth
);

47 
	mvœtu®
 ~
CŞÜM©ch”
();

49 
boŞ
 
Proûss
(
RASTERDATA
* 
IÅutRa¡”
=
NULL
);

50 
Flush
();

51 
DRIVER_ERROR
 
	mcÚ¡ruùÜ_”rÜ
;

52 
Re¡¬t
();

55 
G‘MaxOuutWidth
();

56 
boŞ
 
NextOuutRa¡”
(
RASTERDATA
 &
Ãxt_¿¡”
);

58 
	mCŞÜPÏÃCouÁ
;

59 
	mIÅutWidth
;

60 
	mS¹PÏÃ
;

61 
	mEndPÏÃ
;

62 
	mResBoo¡
;

64 
DRIVER_ERROR
 
MakeG¿yM­
(cÚ¡ 
ušt32_t
 *
cŞÜm­
, ušt32_t* 
g¿ym­
);

66 
	m´iv©e
:

67 
F»eBufãrs
();

68 
CŞÜM©ch
(
width
, cÚ¡ 
ušt32_t
 *
m­
,

69 *
rgb
, *
k¶ªe
,

70 *
ıÏÃ
, *
m¶ªe
,

71 *
y¶ªe
);

72 
IÁ”pŞ©e
(cÚ¡ 
ušt32_t
 *
m­
,

73 
r
,
g
,
b
,

74 *
bÏckout
, *
cyªout
,

75 *
mag’out
, *
y–lowout
);

77 
CŞÜM©ch
(
width
, cÚ¡ *
m­
,

78 *
rgb
, *
k¶ªe
,

79 *
ıÏÃ
, *
m¶ªe
,

80 *
y¶ªe
);

81 
IÁ”pŞ©e
(cÚ¡ *
m­
,

82 
r
,
g
,
b
,

83 *
bÏckout
, *
cyªout
,

84 *
mag’out
, *
y–lowout
);

87 
šlše
 
	$G‘Y–lowV®ue
(
ušt32_t
 
cmyk
)

88 { Ğ(()((
cmyk
)>>24) & 0xFF) ); }

90 
šlše
 
	$G‘Mag’V®ue
(
ušt32_t
 
cmyk
)

91 { Ğ(()((
cmyk
)>>16è& 0xFFè); 
	}
}

93 
šlše
 
	$G‘CyªV®ue
(
ušt32_t
 
cmyk
)

94 { Ğ(()((()(
cmyk
))>>8è& 0xFFè); 
	}
}

96 
šlše
 
	$G‘BÏckV®ue
(
ušt32_t
 
cmyk
)

97 { Ğ(()(
cmyk
è& 0xFFè); 
	}
}

99 
boŞ
 
	$FÜw¬d16Pix–sNÚWh™e
(
BYTE
 *
šputPŒ
)

103 
i
=0; i < 16; i++)

105 ià((*
šputPŒ
++)!=0)

106  
Œue
;

109  
çl£
;

110 
	}
}

112 
boŞ
 
	$Backw¬d16Pix–sNÚWh™e
(
BYTE
 *
šputPŒ
)

116 
i
=0; i < 16; i++)

118 ià((*
šputPŒ
--)!=0)

119  
Œue
;

122  
çl£
;

123 
	}
}

126 * 
	gCÚtÚe
;

128 
CŞÜM­
 
	gcm­
;

132 
PÏÃCouÁ
();

134 
boŞ
 
	g¡¬‹d
;

	@prnt/hpcups/CommonDefinitions.h

33 #iâdeà
COMMON_DEFINITIONS_H


34 
	#COMMON_DEFINITIONS_H


	)

36 
	~<¡dio.h
>

37 
	~<š‰y³s.h
>

38 
	~<¡dšt.h
>

40 
	~<fú.h
>

41 
	~<sys/¡©.h
>

42 
	~<cups/cups.h
>

43 
	~<cups/¿¡”.h
>

44 
	~<¡d¬g.h
>

45 
	~<¡dio.h
>

46 
	~<¡dlib.h
>

47 
	~<¡ršg.h
>

48 
	~<sy¦og.h
>

49 
	~<as£¹.h
>

50 
	~<time.h
>

51 
	~<sys/timeb.h
>

52 
	~<¡ršg.h
>

54 #iâdeà
_GNU_SOURCE


55 
	#_GNU_SOURCE


	)

58 
	#BASIC_LOG
 1

	)

59 
	#SAVE_OUT_FILE
 2

	)

60 
	#SAVE_INPUT_RASTERS
 4

	)

61 
	#SAVE_OUT_FILE_IN_BACKEND
 8

	)

62 
	#DONT_SEND_TO_BACKEND
 16

	)

63 
	#DONT_SEND_TO_PRINTER
 32

	)

65 
	#MAX_COLORTYPE
 2

	)

66 
	#NUMBER_PLANES
 3

	)

68 
	#ASSERT
 
as£¹


	)

70 
	#_STRINGIZE
(
x
è#x

	)

71 
	#STRINGIZE
(
x
è
	`_STRINGIZE
(x)

	)

73 
	#dbglog
(
¬gs
...è{
	`sy¦og
(
LOG_DEBUG
, 
__FILE__
 " " 
	`STRINGIZE
(
__LINE__
) ": "‡rgs); \

74 
	`årštf
(
¡d”r
, 
__FILE__
 " " 
	`STRINGIZE
(
__LINE__
è": " 
¬gs
);}

	)

77 
	tBYTE
;

79 #iâdeà
ABS


80 
	#ABS
(
x
èĞ((x)<0è? -(xè: (xè)

	)

83 #iâdeà
MIN


84 
	#MIN
(
a
,
b
è((×)>=(b))?(b):×))

	)

87 #iâdeà
MAX


88 
	#MAX
(
a
,
b
è((×)<=(b))?(b):×))

	)

91 #ifdeà
APDK_LITTLE_ENDIAN


92 
	#G‘Red
(
x
è(((x >> 16è& 0x0FF))

	)

93 
	#G‘G»’
(
x
è(((x >> 8è& 0x0FF))

	)

94 
	#G‘Blue
(
x
è((x & 0x0FF))

	)

96 
	#G‘Red
(
x
è(((x >> 24è& 0x0FF))

	)

97 
	#G‘G»’
(
x
è(((x >> 16è& 0x0FF))

	)

98 
	#G‘Blue
(
x
è(((x >> 8è& 0x0FF))

	)

101 #ifdeà
BLACK_PEN


102 #undeà
BLACK_PEN


105 #ifdeà
NO_ERROR


106 #undeà
NO_ERROR


109 
	#HIBYTE
(
sV¬
è(
BYTE
è((sV¬ & 0xFF00è>> 8)

	)

110 
	#LOBYTE
(
sV¬
è(
BYTE
è((sV¬ & 0x00FF))

	)

111 #iâdeà
LOWORD


112 
	#LOWORD
(
l
è((èÖ))

	)

115 #iâdeà
HIWORD


116 
	#HIWORD
(
l
è((è(((
ušt32_t
èÖè>> 16è& 0xFFFF))

	)

119 
	#PCL_BUFFER_SIZE
 10000

	)

121 
	tUIÁ16
;

122 
	tUIÁ32
;

123 
	tUCh¬
;

124 
	tIÁ16
;

125 
	tIÁ32
;

127 
	sRASTERDATA


129 
	m¿¡”size
[
MAX_COLORTYPE
];

130 
BYTE
 *
	m¿¡”d©a
[
MAX_COLORTYPE
];

131 } 
	tRASTERDATA
;

133 cÚ¡ 
	gMAXCOLORDEPTH
 = 3;

135 cÚ¡ 
	gMAXCOLORPLANES
 = 6;

137 cÚ¡ 
	gMAXCOLORROWS
 = 2;

139 
	eHALFTONING_ALGORITHM


141 
	mFED
,

142 
	mMATRIX


154 
	mNO_ERROR
 = 0x00,

155 
	mJOB_CANCELED
 = 0x01,

156 
	mSYSTEM_ERROR
 = 0x02,

157 
	mALLOCMEM_ERROR
 = 0x03,

158 
	mNO_PRINTER_SELECTED
 = 0x04,

159 
	mINDEX_OUT_OF_RANGE
 = 0x05,

160 
	mILLEGAL_RESOLUTION
 = 0x06,

161 
	mNULL_POINTER
 = 0x07,

162 
	mMISSING_PENS
 = 0x08,

166 
	mUNSUPPORTED_PRINTER
 = 0x10,

167 
	mUNSUPPORTED_PEN
 = 0x11,

168 
	mGRAPHICS_UNSUPPORTED
 = 0x13,

169 
	mILLEGAL_COORDS
 = 0x15,

170 
	mBAD_INPUT_WIDTH
 = 0x18,

171 
	mOUTPUTWIDTH_EXCEEDS_PAGEWIDTH
 = 0x19,

172 
	mUNSUPPORTED_PRINTMODE
 = 0x19,

175 
	mIO_ERROR
 = 0x20,

176 
	mBAD_DEVICE_ID
 = 0x21,

177 
	mCONTINUE_FROM_BLOCK
 = 0x22,

180 
	mPLUGIN_LIBRARY_MISSING
 = 0x30,

184 
	mWARN_MODE_MISMATCH
 = -1,

185 
	mWARN_DUPLEX
 = -2,

186 
	mWARN_LOW_INK_BOTH_PENS
= -3,

187 
	mWARN_LOW_INK_BLACK
 = -4,

188 
	mWARN_LOW_INK_COLOR
 = -5,

190 
	mWARN_LOW_INK_PHOTO
 = -10,

191 
	mWARN_LOW_INK_GREY
 = -11,

192 
	mWARN_LOW_INK_BLACK_PHOTO
 = -12,

193 
	mWARN_LOW_INK_COLOR_PHOTO
 = -13,

194 
	mWARN_LOW_INK_GREY_PHOTO
 = -14,

195 
	mWARN_LOW_INK_COLOR_GREY
 = -15,

196 
	mWARN_LOW_INK_COLOR_GREY_PHOTO
 = -16,

197 
	mWARN_LOW_INK_COLOR_BLACK_PHOTO
 = -17,

198 
	mWARN_LOW_INK_CYAN
 = -18,

199 
	mWARN_LOW_INK_MAGENTA
 = -19,

200 
	mWARN_LOW_INK_YELLOW
 = -20,

201 
	mWARN_LOW_INK_MULTIPLE_PENS
 = - 21,

202 
	mWARN_ILLEGAL_PAPERSIZE
 = -8,

203 
	mILLEGAL_PAPERSIZE
 = -8,

204 
	mWARN_INVALID_MEDIA_SOURCE
 = -9,

206 
	meC»©e_Th»ad_E¼Ü
 = 128

207 } 
	tDRIVER_ERROR
;

209 
	eDUPLEXMODE


211 
	mDUPLEXMODE_NONE
,

212 
	mDUPLEXMODE_BOOK
,

213 
	mDUPLEXMODE_TABLET


216 
	eENDIAN_TYPE


218 
	mLITTLEENDIAN
,

219 
	mBIGENDIAN


223 
	#PLANE_K
 0

	)

224 
	#PLANE_C
 1

	)

225 
	#PLANE_M
 2

	)

226 
	#PLANE_Y
 3

	)

227 
	#Clight
 4

	)

228 
	#Mlight
 5

	)

229 
	#kWh™e
 0x00FFFFFE

	)

231 
	#K
 0

	)

232 
	#C
 1

	)

233 
	#M
 2

	)

234 
	#Y
 3

	)

235 
	#Clight
 4

	)

236 
	#Mlight
 5

	)

237 
	#RANDSEED
 77

	)

243 
ušt32_t
 
	tDWORD
;

244 
	tWORD
;

247 
	mZJT_START_DOC
,

248 
	mZJT_END_DOC
,

249 
	mZJT_START_PAGE
,

250 
	mZJT_END_PAGE
,

251 
	mZJT_JBIG_BIH
,

252 
	mZJT_JBIG_HID
,

253 
	mZJT_END_JBIG
,

254 
	mZJT_SIGNATURE
,

255 
	mZJT_RAW_IMAGE
,

256 
	mZJT_START_PLANE
,

257 
	mZJT_END_PLANE
,

258 
	mZJT_PAUSE
,

259 
	mZJT_BITMAP


260 } 
	tCHUNK_TYPE
;

264  
	mZJI_PAGECOUNT
,

265  
	mZJI_DMCOLLATE
,

266  
	mZJI_DMDUPLEX
,

268  
	mZJI_DMPAPER
,

269  
	mZJI_DMCOPIES
,

270  
	mZJI_DMDEFAULTSOURCE
,

271  
	mZJI_DMMEDIATYPE
,

272  
	mZJI_NBIE
,

273  
	mZJI_RESOLUTION_X
,

274  
	mZJI_RESOLUTION_Y
,

275  
	mZJI_OFFSET_X
,

276  
	mZJI_OFFSET_Y
,

277  
	mZJI_RASTER_X
,

278  
	mZJI_RASTER_Y
,

280  
	mZJI_COLLATE
,

281  
	mZJI_QUANTITY
,

283  
	mZJI_VIDEO_BPP
,

284  
	mZJI_VIDEO_X
,

285  
	mZJI_VIDEO_Y
,

286  
	mZJI_INTERLACE
,

287  
	mZJI_PLANE
,

288  
	mZJI_PALETTE
,

290  
	mZJI_RET
,

291  
	mZJI_TONER_SAVE
,

293  
	mZJI_MEDIA_SIZE_X
,

294  
	mZJI_MEDIA_SIZE_Y
,

295  
	mZJI_MEDIA_SIZE_UNITS
,

297  
	mZJI_CHROMATIC
,

299  
	mZJI_PAD
 = 99,

301  
	mZJI_PROMPT
,

303  
	mZJI_BITMAP_TYPE
,

304  
	mZJI_ENCODING_DATA
,

305  
	mZJI_END_PLANE
,

307  
	mZJI_BITMAP_PIXELS
,

308  
	mZJI_BITMAP_LINES
,

309  
	mZJI_BITMAP_BPP
,

310  
	mZJI_BITMAP_STRIDE
,

312 } 
	tZJ_ITEM
;

316 
	mRET_OFF
 = 0,

317 
	mRET_ON
,

318 
	mRET_AUTO
,

319 
	mRET_LIGHT
,

320 
	mRET_MEDIUM
,

321 
	mRET_DARK


322 } 
	tRET_VALUE
;

326 
	mZJIT_UINT32
 = 1,

327 
	mZJIT_INT32
,

328 
	mZJIT_STRING
,

329 
	mZJIT_BYTELUT


330 } 
	tCHUNK_ITEM_TYPE
;

333 
	#CERRCHECK
 ià(
cÚ¡ruùÜ_”rÜ
 !ğ
NO_ERROR
è{
	`dbglog
("CERRCHECK fœed\n"); ;}

	)

334 
	#ERRCHECK
 ià(
”r
 !ğ
NO_ERROR
è{
	`dbglog
("ERRCHECK fœed\n"); ƒ¼;}

	)

335 
	#NEWCHECK
(
x
èià(x==
NULL
è 
ALLOCMEM_ERROR
;

	)

336 
	#CNEWCHECK
(
x
èià(x==
NULL
è{ 
cÚ¡ruùÜ_”rÜ
=
ALLOCMEM_ERROR
; ; }

	)

338 
	#CUSTOM_MEDIA_SIZE
 101

	)

340 
	#EVENT_PRINT_FAILED_MISSING_PLUGIN
 502

	)

341 
	eCOLORTYPE


343 
	mCOLORTYPE_COLOR
 = 0,

344 
	mCOLORTYPE_BLACK
 = 1,

345 
	mCOLORTYPE_BOTH
 = 2

348 
	sCŞÜM­_s


350 
ušt32_t
 *
	mulM­1
;

351 
ušt32_t
 *
	mulM­2
;

352 *
	mulM­3
;

353 } 
	tCŞÜM­
;

355 
	eCOMPRESS_MODE


357 
	mCOMPRESS_MODE0
 = 0,

358 
	mCOMPRESS_MODE2
 = 2,

359 
	mCOMPRESS_MODE9
 = 9,

360 
	mCOMPRESS_MODE_AUTO
 = 10,

361 
	mCOMPRESS_MODE_JPEG
 = 11,

362 
	mCOMPRESS_MODE_LJ
 = 12,

363 
	mCOMPRESS_MODE_GRAFIT
 = 16

366 
	eCOMPRESSOR_TYPE


368 
	mCOMPRESSOR_JPEG_QUICKCONNECT
,

369 
	mCOMPRESSOR_JPEG_JETREADY
,

370 
	mCOMPRESSOR_TAOS


373 cÚ¡ 
	gQTABLE_SIZE
 = 64;

375 
	sQTabËInfo_s


377 
DWORD
 
	mqbË0
[
QTABLE_SIZE
];

378 
DWORD
 
	mqbË1
[
QTABLE_SIZE
];

379 
DWORD
 
	mqbË2
[
QTABLE_SIZE
];

380 
	mqFaùÜ
;

381 } 
	tQTabËInfo
;

383 
	sPrštMode_s


385 cÚ¡ *
	mÇme
;

387 
	mResŞutiÚX
[
MAXCOLORPLANES
];

388 
	mResŞutiÚY
[
MAXCOLORPLANES
];

390 
	mCŞÜD•th
[
MAXCOLORPLANES
];

391 
	mdyeCouÁ
;

393 
HALFTONING_ALGORITHM
 
	meHT
;

395 
CŞÜM­
 
	mcm­
;

397 
	mBa£ResX
,
	mBa£ResY
;

398 
boŞ
 
	mMixedRes
;

400 cÚ¡ * 
	mBÏckFEDTabË
;

401 cÚ¡ * 
	mCŞÜFEDTabË
;

402 } 
	tPrštMode
;

406 cÚ¡ *
	m´š‹r_¶©fÜm_Çme
;

407 
PrštMode
 *
	m´št_modes
;

408 
	mcouÁ
;

409 } 
	tPrštModeTabË
;

411 
	sQu®™yA‰ribu‹s_s


413 
	mmedŸ_ty³
;

414 
	mmedŸ_subty³
;

415 
	m´št_qu®™y
;

416 
	mhb¶1_´št_qu®™y
[32];

417 
	mhÜizÚl_»sŞutiÚ
;

418 
	mv”tiÿl_»sŞutiÚ
;

419 
	maùu®_v”tiÿl_»sŞutiÚ
;

420 
	m´št_mode_Çme
[32];

421 } 
	tQu®™yA‰ribu‹s
;

423 
	sMedŸA‰ribu‹s_s


425 
	mpş_id
;

426 
	mphysiÿl_width
;

427 
	mphysiÿl_height
;

428 
	m´šbË_width
;

429 
	m´šbË_height
;

430 
	m´šbË_¡¬t_x
;

431 
	m´šbË_¡¬t_y
;

432 
	mhÜizÚl_ov”¥¿y
;

433 
	mv”tiÿl_ov”¥¿y
;

434 
	mËá_ov”¥¿y
;

435 
	mtİ_ov”¥¿y
;

436 
	mPageSizeName
[64];

437 
	mMedŸTy³Name
[64];

438 } 
	tMedŸA‰ribu‹s
;

440 
	sJobA‰ribu‹s_s


442 
	mmedŸ_sourû
;

443 
	mcŞÜ_mode
;

444 
DUPLEXMODE
 
	me_du¶ex_mode
;

445 
	m´št_bÜd”Ëss
;

446 
	mkrgb_mode
;

447 
	mmech_off£t
;

448 
Qu®™yA‰ribu‹s
 
	mqu®™y_©Œibu‹s
;

449 
MedŸA‰ribu‹s
 
	mmedŸ_©Œibu‹s
;

450 
	mjob_id
;

451 
	m·ge_Üd”
;

452 
	mtÙ®_·ges
;

453 
	mjob_t™Ë
[128];

454 
	mu£r_Çme
[32];

455 
	mho¡_Çme
[32];

456 
	mdomaš_Çme
[32];

457 
	mos_Çme
[160];

458 
	mdriv”_v”siÚ
[32];

459 
	mdriv”_Çme
[128];

460 
	m´š‹r_Çme
[160];

461 
	mjob_¡¬t_time
[32];

462 
	muuid
[64];

463 
	m´š‹r_¶©fÜm
[32];

464 
	m´š‹r_Ïnguage
[32];

465 
	mš‹g”_v®ues
[16];

466 
	m´š‹r_¶©fÜm_v”siÚ
;

467 
	m´e_´oûss_¿¡”
;

468 
	mHPSPDCÏss
;

469 } 
	tJobA‰ribu‹s
;

	@prnt/hpcups/Compressor.cpp

30 
	~"Com´essÜ.h
"

32 
	gCom´essÜ
::
	$Com´essÜ
 (
Ra¡”Size
, 
boŞ
 
u££ed
è: 
	`S“dRow
(
NULL
), 
	`U£S“dRow
(u££ed), 
	`šputsize
(Ra¡”Size), 
	$£eded
(
çl£
)

34 
cÚ¡ruùÜ_”rÜ
 = 
NO_ERROR
;

35 
iRa¡”sR—dy
 = 0;

37 
Üigš®KD©a
 = (
BYTE
 *è
Ãw
 BYTE[
Ra¡”Size
+1];

39 
	`CNEWCHECK
(
Üigš®KD©a
);

41 ià(!
U£S“dRow
)

44 
S“dRow
 = (
BYTE
 *è
Ãw
 BYTE[
Ra¡”Size
];

45 
	`CNEWCHECK
(
S“dRow
);

46 
	}
}

48 
	gCom´essÜ
::~
	$Com´essÜ
()

50 ià(
com´essBuf
)

52 
d–‘e
 [] 
com´essBuf
;

54 ià(
S“dRow
)

56 
d–‘e
 [] 
S“dRow
;

58 ià(
Üigš®KD©a
)

60 
d–‘e
 [] 
Üigš®KD©a
;

62 
	}
}

64 
	gCom´essÜ
::
	$G‘MaxOuutWidth
()

66 ià(
com´es£dsize
 != 0)

68  
com´es£dsize
;

72  
¿¡”
.
¿¡”size
[
COLORTYPE_COLOR
];

74 
	}
}

	@prnt/hpcups/Compressor.h

31 #iâdeà
COMPRESSOR_H


32 
	#COMPRESSOR_H


	)

34 
	~"ProûssÜ.h
"

35 
	~"CommÚDefš™iÚs.h
"

37 şas 
	cCom´essÜ
 : 
public
 
ProûssÜ


39 
public
:

40 
Com´essÜ
(
Ra¡”Size
, 
boŞ
 
u££ed
);

41 
	mvœtu®
 ~
Com´essÜ
();

42 
vœtu®
 
boŞ
 
Proûss
(
RASTERDATA
* 
IÅutRa¡”
=
NULL
)=0;

43 
vœtu®
 
	$Flush
() { }

44 
	`G‘MaxOuutWidth
();

45 
vœtu®
 
boŞ
 
	`NextOuutRa¡”
(
RASTERDATA
& 
Ãxt_¿¡”
)=0;

46 
	$S‘S“dRow
(
BYTE
* 
£ed
è{ 
S“dRow
 = s“d; 
	}
}

47 
DRIVER_ERROR
 
	gcÚ¡ruùÜ_”rÜ
;

50 
BYTE
* 
	gcom´essBuf
;

51 
BYTE
* 
	gS“dRow
;

52 
boŞ
 
	gU£S“dRow
;

53 
BYTE
* 
	gÜigš®KD©a
;

54 
	gcom´es£dsize
;

55 
	gšputsize
;

56 
boŞ
 
	g£eded
;

	@prnt/hpcups/Encapsulator.cpp

30 
	~"CommÚDefš™iÚs.h
"

31 
	~"EnÿpsuÏtÜ.h
"

32 
	~"Prš‹rCommªds.h
"

34 
	gEnÿpsuÏtÜ
::
	$EnÿpsuÏtÜ
()

36 
·ge_numb”
 = 0;

37 
pş_bufãr
 = 
NULL
;

38 
cur_pş_bufãr_size
 = 0;

39 
m_pJA
 = 
NULL
;

40 
m_pMA
 = 
NULL
;

41 
m_pQA
 = 
NULL
;

42 
	}
}

43 
	gEnÿpsuÏtÜ
::~
	$EnÿpsuÏtÜ
()

45 ià(
pş_bufãr
) {

46 
d–‘e
 [] 
pş_bufãr
;

48 
	}
}

50 
DRIVER_ERROR
 
	gEnÿpsuÏtÜ
::
	$S¹Job
(
Sy¡emS”viûs
 *
pSy¡emS”viûs
, 
JobA‰ribu‹s
 *
pJA
)

52 
DRIVER_ERROR
 
”r
 = 
NO_ERROR
;

54 
m_pSy¡emS”viûs
 = 
pSy¡emS”viûs
;

56 
m_pJA
 = 
pJA
;

57 
m_pMA
 = &
pJA
->
medŸ_©Œibu‹s
;

58 
m_pQA
 = &
pJA
->
qu®™y_©Œibu‹s
;

60 
cur_pş_bufãr_size
 = 
PCL_BUFFER_SIZE
;

61 
pş_bufãr
 = 
Ãw
 
BYTE
[
cur_pş_bufãr_size
 + 2];

62 ià(
pş_bufãr
 =ğ
NULL
) {

63  
ALLOCMEM_ERROR
;

65 
	`mem£t
(
pş_bufãr
, 0, 
cur_pş_bufãr_size
);

66 
cur_pş_bufãr_±r
 = 
pş_bufãr
;

68 
”r
 = 
NO_ERROR
;

70 
tm
 *
t
;

71 
time_t
 
lÚg_time
;

72 
	`time
(&
lÚg_time
);

73 
t
 = 
	`loÿÉime
(&
lÚg_time
);

75 
	`addToH—d”
(
Re£t
, (Reset));

76 
	`addToH—d”
(
UEL
, (UEL));

81 #iâdeà
UNITTESTING


82 ià(
	`jobA‰rPJLAÎowed
())

84 
	`addToH—d”
("@PJL SET STRINGCODESET=UTF8\012");

85 
	`addToH—d”
("@PJL COMMENT=\"Job S¹ Time: %s\"\012", 
m_pJA
->
job_¡¬t_time
);

86 
	`addToH—d”
("@PJL JOBNAME=\"%s\"\012", 
m_pJA
->
job_t™Ë
);

87 
	`addToH—d”
("@PJL SET JOBNAME=\"%s\"\012", 
m_pJA
->
job_t™Ë
);

88 
	`addToH—d”
("@PJL COMMENT=\"%s; %s; %s; %s\"\012",

89 
m_pJA
->
´š‹r_Çme
, m_pJA->
os_Çme
, m_pJA->
driv”_Çme
, m_pJA->
driv”_v”siÚ
);

90 
	`addToH—d”
("@PJL COMMENT=\"Username: %s; App Filename: %s; %d-%d-%d\"\012",

91 
m_pJA
->
u£r_Çme
, m_pJA->
job_t™Ë
, 
t
->
tm_mÚ
 + 1,->
tm_mday
,->
tm_y—r
 + 1900);

92 
	`addToH—d”
("@PJL SET JOBATTR=\"JobAcù1=%s\"\012", 
m_pJA
->
u£r_Çme
);

93 
	`addToH—d”
("@PJL SET JOBATTR=\"JobAcù2=%s\"\012", 
m_pJA
->
ho¡_Çme
);

94 
	`addToH—d”
("@PJL SET JOBATTR=\"JobAcù3=%s\"\012", 
m_pJA
->
domaš_Çme
);

95 
	`addToH—d”
("@PJL SET JOBATTR=\"JobAcct4=%4d%02d%02d%02d%02d%02d\"\012",

96 
t
->
tm_y—r
 + 1900,->
tm_mÚ
 + 1,->
tm_mday
,->
tm_hour
,->
tm_mš
,->
tm_£c
);

97 
	`addToH—d”
("@PJL SET JOBATTR=\"JobAcù5=%s\"\012", 
m_pJA
->
uuid
);

100 
	`addToH—d”
("@PJL SET TIMESTAMP=%4d%02d%02d%02d%02d%02d\012",

101 
t
->
tm_y—r
 + 1900,->
tm_mÚ
 + 1,->
tm_mday
,->
tm_hour
,->
tm_mš
,->
tm_£c
);

102 
	`addToH—d”
("@PJL SET JOBATTR=\"JobAcct6=Spooler Subsystem App\"\012");

103 
	`addToH—d”
("@PJL SET JOBATTR=\"JobAcù7=\"%s\"\012", 
m_pJA
->
job_t™Ë
);

104 
	`addToH—d”
("@PJL SET JOBATTR=\"JobAcù8=\"%s\"\012", 
m_pJA
->
u£r_Çme
);

105 
	`addToH—d”
("@PJL SET JOBATTR=\"JobAcct9=(null)\"\012");

107 
	`addToH—d”
("@PJL SET USERNAME=\"%s\"\012", 
m_pJA
->
u£r_Çme
);

112 
	`addJobS‘tšgs
();

114  
”r
;

115 
	}
}

117 
DRIVER_ERROR
 
	gEnÿpsuÏtÜ
::
	$S’d
(cÚ¡ 
BYTE
 *
pBufãr
, 
Ëngth
)

119 
DRIVER_ERROR
 
”r
;

121 ià(
pş_bufãr
 =ğ
NULL
) {

122  
	`£ndBufãr
(
pBufãr
, 
Ëngth
);

127 ià(
cur_pş_bufãr_±r
 + 
Ëngth
 > (
pş_bufãr
 + 
cur_pş_bufãr_size
)) {

128 
”r
 = 
	`£ndBufãr
(
¡©ic_ÿ¡
<cÚ¡ 
BYTE
 *>(
pş_bufãr
), (
cur_pş_bufãr_±r
 -…cl_buffer));

129 ià(
”r
 !ğ
NO_ERROR
)

130  
”r
;

131 
cur_pş_bufãr_±r
 = 
pş_bufãr
;

134 ià(
Ëngth
 < 
cur_pş_bufãr_size
) {

135 
	`memıy
(
cur_pş_bufãr_±r
, 
pBufãr
, 
Ëngth
);

136 
cur_pş_bufãr_±r
 +ğ
Ëngth
;

139 
”r
 = 
	`£ndBufãr
(
pBufãr
, 
Ëngth
);

141  
NO_ERROR
;

142 
	}
}

144 
	gEnÿpsuÏtÜ
::
	$addToH—d”
(cÚ¡ 
BYTE
 *
commªd_¡ršg
, 
Ëngth
)

146 
	`memıy
(
cur_pş_bufãr_±r
, 
commªd_¡ršg
, 
Ëngth
);

147 
cur_pş_bufãr_±r
 +ğ
Ëngth
;

148 
	}
}

150 
	gEnÿpsuÏtÜ
::
	$addToH—d”
(cÚ¡ *
fmt
, ...)

152 
va_li¡
 
¬gs
;

153 
n
;

154 
	`va_¡¬t
(
¬gs
, 
fmt
);

155 
size
 = 
cur_pş_bufãr_size
 - (
cur_pş_bufãr_±r
 - 
pş_bufãr
);

157 
n
 = 
	`v¢´štf
((*è
cur_pş_bufãr_±r
, 
size
 - 1, 
fmt
, 
¬gs
);

158 
cur_pş_bufãr_±r
 +ğ
n
;

159 
	`va_’d
(
¬gs
);

160 
	}
}

162 
DRIVER_ERROR
 
	gEnÿpsuÏtÜ
::
	$£ndBufãr
(cÚ¡ 
BYTE
 *
pBufãr
, 
Ëngth
)

164 
DRIVER_ERROR
 
”r
;

165 ià(
Ëngth
 == 0) {

166  
NO_ERROR
;

168 
”r
 = 
m_pSy¡emS”viûs
->
	`S’d
(
pBufãr
, 
Ëngth
);

169  
”r
;

170 
	}
}

172 
DRIVER_ERROR
 
	gEnÿpsuÏtÜ
::
	$CËªup
()

174 
DRIVER_ERROR
 
”r
 = 
NO_ERROR
;

175 ià(
pş_bufãr
 && 
cur_pş_bufãr_±r
 -…cl_buffer > 0)

177 
”r
 = 
	`£ndBufãr
(
¡©ic_ÿ¡
<cÚ¡ 
BYTE
 *>(
pş_bufãr
), (
cur_pş_bufãr_±r
 -…cl_buffer));

179 
cur_pş_bufãr_±r
 = 
pş_bufãr
;

180  
”r
;

181 
	}
}

183 
DRIVER_ERROR
 
	gEnÿpsuÏtÜ
::
	$FÜmF“d
()

185 
DRIVER_ERROR
 
”r
;

186 
”r
 = 
this
->
	`S’d
((cÚ¡ 
BYTE
 *) "\x1B*rC\x0C", 5);

187 ià(
”r
 =ğ
NO_ERROR
) {

188  
	`CËªup
();

190  
”r
;

191 
	}
}

193 
DRIVER_ERROR
 
	gEnÿpsuÏtÜ
::
	$S’dCAPy
(
iOff£t
)

195 
DRIVER_ERROR
 
”r
 = 
NO_ERROR
;

196 
¡r
[12];

197 
	`¥rštf
(
¡r
, "\x1b*b%dY", 
iOff£t
);

198 
”r
 = 
this
->
	`S’d
 ((cÚ¡ 
BYTE
 *è
¡r
, 
	`¡¾’
(str));

199  
”r
;

200 
	}
}

202 
DRIVER_ERROR
 
	gEnÿpsuÏtÜ
::
	$EndJob
()

204 
DRIVER_ERROR
 
”r
 = 
NO_ERROR
;

205 
”r
 = 
m_pSy¡emS”viûs
->
	`S’d
(
Re£t
, (Reset));

206 ià(
”r
 =ğ
NO_ERROR
)

207 
”r
 = 
m_pSy¡emS”viûs
->
	`S’d
(
UEL
, (UEL));

208  
”r
;

209 
	}
}

211 
	gEnÿpsuÏtÜ
::
	$CªûlJob
()

213 
BYTE
 
bufãr
[4098];

214 
	`mem£t
(
bufãr
, 0x0, (buffer));

215 
	`memıy
(
bufãr
+4087, "\x1B%-12345X", 9);

219 
m_pSy¡emS”viûs
->
	`S’d
((cÚ¡ 
BYTE
 *è
bufãr
, 4096);

220 
	}
}

224 
	gEnÿpsuÏtÜ
::
	$£ndJobH—d”
()

226 
szSŒ
[256];

227 
tİ_m¬gš
 = 0;

232 
	`addToH—d”
("\033&l%dh%dm%da%ds8c0o0E\033*o%dM", 
m_pJA
->
medŸ_sourû
, 
m_pQA
->
medŸ_ty³
,

233 
m_pMA
->
pş_id
, 
m_pJA
->
e_du¶ex_mode
, 
m_pQA
->
´št_qu®™y
);

235 
	`addToH—d”
("\033&u%dD\033*t%dR\033*r%dS", 
m_pQA
->
hÜizÚl_»sŞutiÚ
, m_pQA->
v”tiÿl_»sŞutiÚ
, 
m_pMA
->
´šbË_width
);

241 ià(
m_pMA
->
pş_id
 =ğ
CUSTOM_MEDIA_SIZE
) {

242 
sWidth
, 
sHeight
;

243 
BYTE
 
b1
, 
b2
;

244 
sWidth
 = 
¡©ic_ÿ¡
<>(
m_pMA
->
physiÿl_width
);

245 
sHeight
 = 
¡©ic_ÿ¡
<>(
m_pMA
->
physiÿl_height
);

246 
	`memıy
 (
szSŒ
, "\x1B*o5W\x0E\x05\x00\x00\x00\x1B*o5W\x0E\x06\x00\x00\x00", 20);

247 
b1
 = (
BYTE
è((
sWidth
 & 0xFF00) >> 8);

248 
b2
 = (
BYTE
è(
sWidth
 & 0xFF);

249 
szSŒ
[8] = 
b1
;

250 
szSŒ
[9] = 
b2
;

251 
b1
 = (
BYTE
è((
sHeight
 & 0xFF00) >> 8);

252 
b2
 = (
BYTE
è(
sHeight
 & 0xFF);

253 
szSŒ
[18] = 
b1
;

254 
szSŒ
[19] = 
b2
;

255 
	`addToH—d”
((cÚ¡ 
BYTE
 *è
szSŒ
, 20);

258 cÚ¡ 
BYTE
 *
pg¿fMode
 = 
g¿fMode2
;

259 ià(
m_pJA
->
cŞÜ_mode
 == 0)

261 
	`cÚfigu»Ra¡”D©a
();

262 
pg¿fMode
 = 
g¿fMode3
;

265 
	`addToH—d”
((cÚ¡ 
BYTE
 *è
g¿fS¹
, (grafStart));

266 
	`addToH—d”
((cÚ¡ 
BYTE
 *è
pg¿fMode
, 5);

267 
	`addToH—d”
((cÚ¡ 
BYTE
 *è
£edSame
, (seedSame));

269 
tİ_m¬gš
 = 
m_pMA
->
´šbË_¡¬t_y
 - ((
m_pJA
->
mech_off£t
 * 
m_pQA
->
aùu®_v”tiÿl_»sŞutiÚ
)/1000);

270 
Ëá_m¬gš
 = 0;

271 ià(
m_pJA
->
š‹g”_v®ues
[1] > 0)

273 
Ëá_m¬gš
 = ((
m_pJA
->
š‹g”_v®ues
[1] * 
m_pQA
->
hÜizÚl_»sŞutiÚ
è/ 100 - 
m_pMA
->
´šbË_width
) / 2;

275 
	`addToH—d”
("\x1b*p%dx%dY", 
Ëá_m¬gš
, 
tİ_m¬gš
);

278 
	}
}

281 
DRIVER_ERROR
 
	gEnÿpsuÏtÜ
::
	$´eProûssRa¡”D©a
(
cups_¿¡”_t
 **
cups_¿¡”
, 
cups_·ge_h—d”2_t
* 
fœ¡·ge_cups_h—d”
, * 
pSw­edPagesFeName
)

283 
	`dbglog
 ("DEBUG: Encapsulator::preProcessRasterData.............. \n");

284  
NO_ERROR
;

285 
	}
}

	@prnt/hpcups/Encapsulator.h

31 #iâdeà
ENCAPSULATOR_H


32 
	#ENCAPSULATOR_H


	)

34 
	~"CommÚDefš™iÚs.h
"

35 
	~"Sy¡emS”viûs.h
"

36 
	~"P–še.h
"

38 şas 
	cEnÿpsuÏtÜ


40 
	mpublic
:

41 
EnÿpsuÏtÜ
();

42 
	mvœtu®
 ~
EnÿpsuÏtÜ
();

43 
vœtu®
 
DRIVER_ERROR
 
S¹Job
 (
Sy¡emS”viûs
 *
pSy¡emS”viûs
, 
JobA‰ribu‹s
 *
pJA
);

44 
vœtu®
 
DRIVER_ERROR
 
EndJob
 ();

45 
vœtu®
 
DRIVER_ERROR
 
FÜmF“d
 ();

46 
vœtu®
 
DRIVER_ERROR
 
S’dCAPy
 (
iOff£t
);

47 
vœtu®
 
DRIVER_ERROR
 
EnÿpsuÏ‹
 (
RASTERDATA
 *
IÅutRa¡”
, 
boŞ
 
bLa¡PÏÃ
) = 0;

48 
vœtu®
 
DRIVER_ERROR
 
S’d
(cÚ¡ 
BYTE
 *
pBufãr
, 
Ëngth
);

49 
vœtu®
 
DRIVER_ERROR
 
S¹Page
(
JobA‰ribu‹s
 *
pJA
) = 0;

50 
vœtu®
 
DRIVER_ERROR
 
CËªup
();

51 
vœtu®
 
DRIVER_ERROR
 
CÚfigu»
(
P–še
 **
p–še
) = 0;

52 
vœtu®
 
boŞ
 
	$CªSkRa¡”s
(è{ 
Œue
;}

53 
vœtu®
 
	$S‘La¡Bªd
(è{
	}
}

54 
vœtu®
 
boŞ
 
	$UÅackB™s
(è{ 
Œue
;
	}
}

55 
vœtu®
 
CªûlJob
();

56 
vœtu®
 
DRIVER_ERROR
 
´eProûssRa¡”D©a
(
cups_¿¡”_t
 **
cups_¿¡”
, 
cups_·ge_h—d”2_t
* 
fœ¡·ge_cups_h—d”
, * 
pSw­edPagesFeName
);

58 
	g´Ùeùed
:

59 
addToH—d”
(cÚ¡ 
BYTE
 *
commªd_¡ršg
, 
Ëngth
);

60 
addToH—d”
(cÚ¡ *
fmt
, ...);

61 
DRIVER_ERROR
 
£ndBufãr
(cÚ¡ 
BYTE
 *
pBufãr
, 
Ëngth
);

62 
vœtu®
 
DRIVER_ERROR
 
	$addJobS‘tšgs
()

64 
cur_pş_bufãr_±r
 +ğ
	`¥rštf
((*ècur_pş_bufãr_±r, "@PJL ENTER LANGUAGE=%s\012", 
m_szLªguage
);

65  
NO_ERROR
;

66 
	}
}

67 
vœtu®
 
DRIVER_ERROR
 
	$æushPrš‹rBufãr
()

69  
m_pSy¡emS”viûs
->
	`S’d
((cÚ¡ 
BYTE
 *è
pş_bufãr
, 10000);

70 
	}
}

71 
vœtu®
 
boŞ
 
	$jobA‰rPJLAÎowed
(è{ 
çl£
;
	}
}

72 
vœtu®
 
boŞ
 
	$ÃedPJLH—d”s
(
JobA‰ribu‹s
 *
pJA
)

74  
Œue
;

75 
	}
}

76 
vœtu®
 
	$cÚfigu»Ra¡”D©a
(è{
	}
}

77 
£ndJobH—d”
();

79 
Sy¡emS”viûs
 *
	gm_pSy¡emS”viûs
;

80 
	g·ge_numb”
;

81 
	gcur_pş_bufãr_size
;

82 
BYTE
 *
	gpş_bufãr
;

83 
BYTE
 *
	gcur_pş_bufãr_±r
;

84 
	gm_szLªguage
[16];

86 
JobA‰ribu‹s
 *
	gm_pJA
;

87 
MedŸA‰ribu‹s
 *
	gm_pMA
;

88 
Qu®™yA‰ribu‹s
 *
	gm_pQA
;

	@prnt/hpcups/EncapsulatorFactory.cpp

31 
	~"CommÚDefš™iÚs.h
"

32 
	~"EnÿpsuÏtÜFaùÜy.h
"

33 
	~"EnÿpsuÏtÜ.h
"

34 
	~"Hb¶1.h
"

35 
	~"Pş3.h
"

36 
	~"Pş3Gui.h
"

37 
	~"Pş3Gui2.h
"

38 
	~"LJMÚo.h
"

39 
	~"LJCŞÜ.h
"

40 
	~"LJFa¡Ra¡”.h
"

41 
	~"LJZjSŒ—m.h
"

42 
	~"LJZxSŒ—m.h
"

43 
	~"QuickCÚÃù.h
"

44 
	~"LJJ‘R—dy.h
"

45 
	~"Lid.h
"

46 
	~<¡ršg.h
>

48 
EnÿpsuÏtÜ
 *
	gEnÿpsuÏtÜFaùÜy
::
	$G‘EnÿpsuÏtÜ
 (*
’ÿp_‹ch
)

50 ià(
’ÿp_‹ch
 =ğ
NULL
) {

51  
NULL
;

54 ià(!
	`¡rcmp
 (
’ÿp_‹ch
, "hbpl1"))

56  
Ãw
 
	`Hb¶1
();

59 ià(!
	`¡rcmp
 (
’ÿp_‹ch
, "pcl3"))

61  
Ãw
 
	`Pş3
();

63 ià(!
	`¡rcmp
 (
’ÿp_‹ch
, "pcl3gui"))

65  
Ãw
 
	`Pş3Gui
();

67 ià(!
	`¡rcmp
 (
’ÿp_‹ch
, "pcl3gui2"))

69  
Ãw
 
	`Pş3Gui2
();

71 ià(!
	`¡rcmp
 (
’ÿp_‹ch
, "ljmono"))

73  
Ãw
 
	`LJMÚo
();

75 ià(!
	`¡rcmp
 (
’ÿp_‹ch
, "ljcolor"))

77  
Ãw
 
	`LJCŞÜ
();

79 ià(!
	`¡rcmp
 (
’ÿp_‹ch
, "ljfastraster"))

81  
Ãw
 
	`LJFa¡Ra¡”
();

83 ià(!
	`¡rcmp
 (
’ÿp_‹ch
, "ljzjstream"))

85  
Ãw
 
	`LJZjSŒ—m
();

87 ià(!
	`¡rcmp
 (
’ÿp_‹ch
, "ljzxstream"))

89  
Ãw
 
	`LJZxSŒ—m
();

91 ià(!
	`¡rcmp
 (
’ÿp_‹ch
, "quickconnect"))

93  
Ãw
 
	`QuickCÚÃù
();

95 ià(!
	`¡rcmp
 (
’ÿp_‹ch
, "ljjetready"))

97  
Ãw
 
	`LJJ‘R—dy
();

99 ià(!
	`¡rcmp
 (
’ÿp_‹ch
, "lidil"))

101  
Ãw
 
	`Lid
();

103  
NULL
;

104 
	}
}

	@prnt/hpcups/EncapsulatorFactory.h

31 #iâdeà
ENCAPSULATORFACTORY_H


32 
	#ENCAPSULATORFACTORY_H


	)

34 
	~"CommÚDefš™iÚs.h
"

35 
	~"P–še.h
"

36 
	~"EnÿpsuÏtÜ.h
"

38 şas 
	cEnÿpsuÏtÜFaùÜy


40 
	mpublic
:

41 
EnÿpsuÏtÜ
 *
G‘EnÿpsuÏtÜ
 (*
’ÿp_‹ch
);

	@prnt/hpcups/ErnieFilter.cpp

50 
	~"Eº›F‹r.h
"

53 #ià
defšed
(
__APPLE__
è|| defšed(
__lšux
è|| defšed(
__GLIBC__
è|| defšed(
__N‘BSD__
)

54 
	~<m©h.h
>

58 #ià
kG©h”Sts
 == 1

59 
blockSts
[];

62 #ià((
kMemWr™esO±imize
 != 1) && (kMemWritesOptimize != 0))

66 
šlše
 
Av”ageNRound
(
boŞ
 
roundG»’Down
, &
rFš®
, &
r0
, &
r1
, &
gFš®
, &
g0
, &
g1
, &
bFš®
, &
b0
, &
b1
);

67 
šlše
 
	$Av”ageNRound
(
boŞ
 
roundG»’Down
, &
rFš®
, &
r0
, &
r1
, &
gFš®
, &
g0
, &
g1
, &
bFš®
, &
b0
, &
b1
)

70 ià(
roundG»’Down
)

72 
rFš®
 = (
r0
 + 
r1
 + 1) / 2;

73 
gFš®
 = (
g0
 + 
g1
) / 2;

74 
bFš®
 = (
b0
 + 
b1
 + 1) / 2;

78 
rFš®
 = (
r0
 + 
r1
) / 2;

79 
gFš®
 = (
g0
 + 
g1
 + 1) / 2;

80 
bFš®
 = (
b0
 + 
b1
) / 2;

82 
	}
}

88 
	gEº›F‹r
::
	$F‹r1RawRow
(*
cu¼PŒ
, 
rowWidthInPix–s
, *
æagsPŒ
)

90 
	`ASSERT
(
cu¼PŒ
);

91 
	`ASSERT
(
rowWidthInPix–s
 > 0);

93 
R0
, 
G0
, 
B0
, 
R1
, 
G1
, 
B1
, 
Ï¡R
, 
Ï¡G
, 
Ï¡B
;

94 cÚ¡ 
maxE¼ÜFÜFourPix–s
 = 
m_max_”rÜ_fÜ_two_pix–s
 / 2;

98 
ušt32_t
 
cu¼Pix–
, 
Ï¡Pix–
;

99 
boŞ
 
Ï¡PaœAv”aged
 = 
çl£
;

100 
boŞ
 
Ï¡2by2Av”aged
 = 
çl£
;

103 
pix–Num
 = 0;…ix–Num < 
rowWidthInPix–s
;…ixelNum++)

105 ià((
pix–Num
 & 0x03) == 0x00)

107 
Ï¡2by2Av”aged
 = 
çl£
;

110 
cu¼Pix–
 = 
	`g‘4Pix–
(
cu¼PŒ
);

112 
æagsPŒ
[0] = (
e11n
|
e11s
);

114 ià(
	`isWh™e
(
cu¼Pix–
))

116 
æagsPŒ
[0] = 
eDÚe
;

117 #ià
kG©h”Sts
 == 1

118 
blockSts
[
esWh™eFound
]++;

123 ià(
æagsPŒ
[0] =ğ(
e11n
|
e11s
))

125 
R1
 = 
	`G‘Red
(
cu¼Pix–
);

126 
G1
 = 
	`G‘G»’
(
cu¼Pix–
);

127 
B1
 = 
	`G‘Blue
(
cu¼Pix–
);

130 ià(
	`isOdd
(
pix–Num
))

133 
Ï¡Pix–
 = 
	`g‘4Pix–
(
cu¼PŒ
,-1);

134 
Ï¡R
 = 
	`G‘Red
(
Ï¡Pix–
);

135 
Ï¡G
 = 
	`G‘G»’
(
Ï¡Pix–
);

136 
Ï¡B
 = 
	`G‘Blue
(
Ï¡Pix–
);

137 ià((
m_max_”rÜ_fÜ_two_pix–s
 >ğ3è&& (
	`NewD–E
(
Ï¡R
, 
R1
, 
Ï¡G
, 
G1
, 
Ï¡B
, 
B1
, m_max_error_for_two_pixels)))

143 
didNÙBud4by1
 = 
Œue
;

144 #ià
kG©h”Sts
 == 1

145 
blockSts
[
es21nw
]++;

147 
	`Av”ageNRound
(
	`isOdd
(
pix–Num
), 
Ï¡R
,†a¡R, 
R1
, 
Ï¡G
,†a¡G, 
G1
, 
Ï¡B
,†a¡B, 
B1
);

148 ià((
pix–Num
 >ğ3è&& (
æagsPŒ
[-3] & 
e21nw
))

151 
	`ASSERT
(!((
æagsPŒ
[-3] | fÏgsPŒ[-2] | fÏgsPŒ[-1] | fÏgsPŒ[0]è& 
eTheRe¡
));

153 
Ï¡Pix–
 = 
	`g‘4Pix–
(
cu¼PŒ
,-3);

154 
R0
 = 
	`G‘Red
(
Ï¡Pix–
);

155 
G0
 = 
	`G‘G»’
(
Ï¡Pix–
);

156 
B0
 = 
	`G‘Blue
(
Ï¡Pix–
);

157 ià((
maxE¼ÜFÜFourPix–s
 >ğ3è&& (
	`NewD–E
(
Ï¡R
, 
R0
, 
Ï¡G
, 
G0
, 
Ï¡B
, 
B0
, maxErrorForFourPixels)))

163 #ià
kG©h”Sts
 == 1

164 
blockSts
[
es41ni
]++;

166 
didNÙBud4by1
 = 
çl£
;

167 
	`Av”ageNRound
((
pix–Num
 & 0x04)=ğ0x04, 
Ï¡R
,†a¡R, 
R0
, 
Ï¡G
,†a¡G, 
G0
, 
Ï¡B
,†a¡B, 
B0
);

169 if(
m_eEndŸn
 =ğ
LITTLEENDIAN
)

170 
cu¼Pix–
 = (
Ï¡R
<<16è+ (
Ï¡G
<<8è+ 
Ï¡B
;

171 if(
m_eEndŸn
 =ğ
BIGENDIAN
)

172 
cu¼Pix–
 = (
Ï¡R
<<24è+ (
Ï¡G
<<16è+ (
Ï¡B
<<8);

174 #ià
kMemWr™esO±imize
 == 0

175 
	`put4Pix–
(
cu¼PŒ
, -3, 
cu¼Pix–
);

176 
	`put4Pix–
(
cu¼PŒ
, -2, 
cu¼Pix–
);

177 
	`put4Pix–
(
cu¼PŒ
, -1, 
cu¼Pix–
);

178 
	`put4Pix–
(
cu¼PŒ
, 0, 
cu¼Pix–
);

180 
	`put4Pix–
(
cu¼PŒ
, -3, 
cu¼Pix–
);

182 
æagsPŒ
[-3] = (æagsPŒ[-3] & ~
eNÜths
è| 
e41ni
;

183 
æagsPŒ
[-2] = (æagsPŒ[-2] & ~
eNÜths
è| 
e41n
;

184 
æagsPŒ
[-1] = (æagsPŒ[-1] & ~
eNÜths
è| 
e41n
;

185 
æagsPŒ
[0] = (æagsPŒ[0] & ~
eNÜths
è| 
e41n
;

189 ià(
didNÙBud4by1
)

191 
	`ASSERT
(!((
æagsPŒ
[-1] | fÏgsPŒ[0]è& 
eTheRe¡
));

193 if(
m_eEndŸn
 =ğ
LITTLEENDIAN
)

194 
cu¼Pix–
 = (
Ï¡R
<<16è+ (
Ï¡G
<<8è+ 
Ï¡B
;

195 if(
m_eEndŸn
 =ğ
BIGENDIAN
)

196 
cu¼Pix–
 = (
Ï¡R
<<24è+ (
Ï¡G
<<16è+ (
Ï¡B
<<8);

198 #ià
kMemWr™esO±imize
 == 0

199 
	`put4Pix–
(
cu¼PŒ
, -1, 
cu¼Pix–
);

200 
	`put4Pix–
(
cu¼PŒ
, 0, 
cu¼Pix–
);

202 
	`put4Pix–
(
cu¼PŒ
, -1, 
cu¼Pix–
);

204 
æagsPŒ
[-1] = (æagsPŒ[-1] & ~
eNÜths
è| 
e21nw
;

205 
æagsPŒ
[0] = (æagsPŒ[0] & ~
eNÜths
è| 
e21Ã
;

212 
Ï¡PaœAv”aged
 = 
çl£
;

215 
cu¼PŒ
 +ğ
eBufã»dPix–WidthInBy‹s
;

216 
æagsPŒ
++;

218 
	}
}

225 
	gEº›F‹r
::
	$F‹r2RawRows
(*
cu¼PŒ
, *
upPŒ
, 
rowWidthInPix–s
, *
æagsPŒ
)

227 
	`ASSERT
(
cu¼PŒ
);

228 
	`ASSERT
(
upPŒ
);

229 
	`ASSERT
(
rowWidthInPix–s
 > 0);

231 
R0
, 
G0
, 
B0
, 
R1
, 
G1
, 
B1
, 
Ï¡R
, 
Ï¡G
, 
Ï¡B
;

232 cÚ¡ 
maxE¼ÜFÜFourPix–s
 = 
m_max_”rÜ_fÜ_two_pix–s
 / 2;

233 cÚ¡ 
maxE¼ÜFÜEightPix–s
 = 
maxE¼ÜFÜFourPix–s
 / 2;

236 
ušt32_t
 
cu¼Pix–
, 
upPix–
, 
Ï¡Pix–
;

237 
boŞ
 
Ï¡PaœAv”aged
 = 
çl£
;

238 
boŞ
 
Ï¡2by2Av”aged
 = 
çl£
;

240 
pix–Num
 = 0;…ix–Num < 
rowWidthInPix–s
;…ixelNum++)

242 ià((
pix–Num
 & 0x03) == 0x00)

244 
Ï¡2by2Av”aged
 = 
çl£
;

247 
upPix–
 = 
	`g‘4Pix–
(
upPŒ
);

248 
cu¼Pix–
 = 
	`g‘4Pix–
(
cu¼PŒ
);

250 
æagsPŒ
[0] = (
e11n
|
e11s
);

252 ià(
	`isWh™e
(
upPix–
è&& isWh™e(
cu¼Pix–
))

254 
æagsPŒ
[0] = 
eDÚe
;

255 #ià
kG©h”Sts
 == 1

256 
blockSts
[
esWh™eFound
]++;

263 ià(
æagsPŒ
[0] =ğ(
e11n
|
e11s
))

265 
R1
 = 
	`G‘Red
(
cu¼Pix–
);

266 
G1
 = 
	`G‘G»’
(
cu¼Pix–
);

267 
B1
 = 
	`G‘Blue
(
cu¼Pix–
);

269 
R0
 = 
	`G‘Red
(
upPix–
);

270 
G0
 = 
	`G‘G»’
(
upPix–
);

271 
B0
 = 
	`G‘Blue
(
upPix–
);

273 ià((
m_max_”rÜ_fÜ_two_pix–s
 >ğ3è&& (
	`NewD–E
(
R0
, 
R1
, 
G0
, 
G1
, 
B0
, 
B1
, m_max_error_for_two_pixels)))

280 
	`ASSERT
(
æagsPŒ
[0] =ğ(
e11n
|
e11s
));

281 
æagsPŒ
[0] = 
e12
;

282 #ià
kG©h”Sts
 == 1

283 
blockSts
[
es12
]++;

285 
R1
 = 
	`G‘Red
(
cu¼Pix–
);

286 
G1
 = 
	`G‘G»’
(
cu¼Pix–
);

287 
B1
 = 
	`G‘Blue
(
cu¼Pix–
);

289 
R0
 = 
	`G‘Red
(
upPix–
);

290 
G0
 = 
	`G‘G»’
(
upPix–
);

291 
B0
 = 
	`G‘Blue
(
upPix–
);

293 
	`Av”ageNRound
(
	`isOdd
(
pix–Num
), 
R1
, R1, 
R0
, 
G1
, G1, 
G0
, 
B1
, B1, 
B0
);

296 ià(
	`isOdd
(
pix–Num
))

298 ià(
Ï¡PaœAv”aged
)

301 ià((
maxE¼ÜFÜFourPix–s
 >ğ3è&& (
	`NewD–E
(
Ï¡R
, 
R1
, 
Ï¡G
, 
G1
,
Ï¡B
, 
B1
, maxErrorForFourPixels)))

308 
	`ASSERT
(
æagsPŒ
[-1] =ğ
e12
);

309 
didNÙBud4by2
 = 
Œue
;

310 #ià
kG©h”Sts
 == 1

311 
blockSts
[
es22w
]++;

313 
æagsPŒ
[-1] = 
e22w
;

314 
æagsPŒ
[0] = 
e22e
;

316 
	`Av”ageNRound
((
pix–Num
 & 0x02è=ğ0x02, 
R1
, R1, 
Ï¡R
, 
G1
, G1, 
Ï¡G
, 
B1
, B1, 
Ï¡B
);

318 ià((
pix–Num
 & 0x03) == 0x03)

320 ià(
Ï¡2by2Av”aged
)

328 
Ï¡Pix–
 = 
	`g‘4Pix–
(
upPŒ
, -3);

329 
Ï¡R
 = 
	`G‘Red
(
Ï¡Pix–
);

330 
Ï¡G
 = 
	`G‘G»’
(
Ï¡Pix–
);

331 
Ï¡B
 = 
	`G‘Blue
(
Ï¡Pix–
);

332 ià((
maxE¼ÜFÜEightPix–s
 >ğ3è&& (
	`NewD–E
(
Ï¡R
, 
R1
, 
Ï¡G
, 
G1
,
Ï¡B
, 
B1
, maxErrorForEightPixels)))

341 #ià
kG©h”Sts
 == 1

342 
blockSts
[
es42i
]++;

344 
didNÙBud4by2
 = 
çl£
;

346 
æagsPŒ
[-3] = 
e42i
;

347 
æagsPŒ
[-2] = fÏgsPŒ[-1] = fÏgsPŒ[0] = 
e42
;

349 
	`Av”ageNRound
((
pix–Num
 & 0x04è=ğ0x04, 
R1
, R1, 
Ï¡R
, 
G1
, G1, 
Ï¡G
, 
B1
, B1, 
Ï¡B
);

351 if(
m_eEndŸn
 =ğ
LITTLEENDIAN
)

352 
cu¼Pix–
 = (
R1
<<16è+ (
G1
<<8è+ 
B1
;

353 if(
m_eEndŸn
 =ğ
BIGENDIAN
)

354 
cu¼Pix–
 = (
R1
<<24è+ (
G1
<<16è+ (
B1
<<8);

356 #ià
kMemWr™esO±imize
 == 0

357 
	`put4Pix–
(
upPŒ
, -3, 
cu¼Pix–
);

358 
	`put4Pix–
(
upPŒ
, -2, 
cu¼Pix–
);

359 
	`put4Pix–
(
upPŒ
, -1, 
cu¼Pix–
);

360 
	`put4Pix–
(
upPŒ
, 0, 
cu¼Pix–
);

361 
	`put4Pix–
(
cu¼PŒ
, -3, 
cu¼Pix–
);

362 
	`put4Pix–
(
cu¼PŒ
, -2, 
cu¼Pix–
);

363 
	`put4Pix–
(
cu¼PŒ
, -1, 
cu¼Pix–
);

364 
	`put4Pix–
(
cu¼PŒ
, 0, 
cu¼Pix–
);

366 
	`put4Pix–
(
upPŒ
, -3, 
cu¼Pix–
);

371 ià(
didNÙBud4by2
)

379 
Ï¡2by2Av”aged
 = 
Œue
;

381 if(
m_eEndŸn
 =ğ
LITTLEENDIAN
)

382 
cu¼Pix–
 = (
R1
<<16è+ (
G1
<<8è+ 
B1
;

383 if(
m_eEndŸn
 =ğ
BIGENDIAN
)

384 
cu¼Pix–
 = (
R1
<<24è+ (
G1
<<16è+ (
B1
<<8);

386 #ià
kMemWr™esO±imize
 == 0

387 
	`put4Pix–
(
upPŒ
, -1, 
cu¼Pix–
);

388 
	`put4Pix–
(
upPŒ
, 0, 
cu¼Pix–
);

389 
	`put4Pix–
(
cu¼PŒ
, -1, 
cu¼Pix–
);

390 
	`put4Pix–
(
cu¼PŒ
, 0, 
cu¼Pix–
);

392 
	`put4Pix–
(
upPŒ
, -1, 
cu¼Pix–
);

404 
Ï¡2by2Av”aged
 = 
Œue
;

406 if(
m_eEndŸn
 =ğ
LITTLEENDIAN
)

407 
cu¼Pix–
 = (
R1
<<16è+ (
G1
<<8è+ 
B1
;

408 if(
m_eEndŸn
 =ğ
BIGENDIAN
)

409 
cu¼Pix–
 = (
R1
<<24è+ (
G1
<<16è+ (
B1
<<8);

411 #ià
kMemWr™esO±imize
 == 0

412 
	`put4Pix–
(
upPŒ
, -1, 
cu¼Pix–
);

413 
	`put4Pix–
(
upPŒ
, 0, 
cu¼Pix–
);

414 
	`put4Pix–
(
cu¼PŒ
, -1, 
cu¼Pix–
);

415 
	`put4Pix–
(
cu¼PŒ
, 0, 
cu¼Pix–
);

417 
	`put4Pix–
(
upPŒ
, -1, 
cu¼Pix–
);

429 
Ï¡2by2Av”aged
 = 
çl£
;

431 if(
m_eEndŸn
 =ğ
LITTLEENDIAN
)

432 
cu¼Pix–
 = (
R1
<<16è+ (
G1
<<8è+ 
B1
;

433 if(
m_eEndŸn
 =ğ
BIGENDIAN
)

434 
cu¼Pix–
 = (
R1
<<24è+ (
G1
<<16è+ (
B1
<<8);

436 #ià
kMemWr™esO±imize
 == 0

437 
	`put4Pix–
(
upPŒ
, 0, 
cu¼Pix–
);

438 
	`put4Pix–
(
cu¼PŒ
, 0, 
cu¼Pix–
);

440 
	`put4Pix–
(
upPŒ
,0, 
cu¼Pix–
);

443 
Ï¡R
 = 
R1
;

444 
Ï¡G
 = 
G1
;

445 
Ï¡B
 = 
B1
;

446 
Ï¡PaœAv”aged
 = 
Œue
;

455 
Ï¡2by2Av”aged
 = 
çl£
;

456 
Ï¡PaœAv”aged
 = 
Œue
;

457 
Ï¡R
 = 
R1
;

458 
Ï¡G
 = 
G1
;

459 
Ï¡B
 = 
B1
;

461 if(
m_eEndŸn
 =ğ
LITTLEENDIAN
)

462 
cu¼Pix–
 = (
R1
<<16è+ (
G1
<<8è+ 
B1
;

463 if(
m_eEndŸn
 =ğ
BIGENDIAN
)

464 
cu¼Pix–
 = (
R1
<<24è+ (
G1
<<16è+ (
B1
<<8);

466 #ià
kMemWr™esO±imize
 == 0

467 
	`put4Pix–
(
upPŒ
, 0, 
cu¼Pix–
);

468 
	`put4Pix–
(
cu¼PŒ
, 0, 
cu¼Pix–
);

470 
	`put4Pix–
(
upPŒ
, 0, 
cu¼Pix–
);

482 
Ï¡PaœAv”aged
 = 
Œue
;

483 
Ï¡R
 = 
R1
;

484 
Ï¡G
 = 
G1
;

485 
Ï¡B
 = 
B1
;

487 if(
m_eEndŸn
 =ğ
LITTLEENDIAN
)

488 
cu¼Pix–
 = (
R1
<<16è+ (
G1
<<8è+ 
B1
;

489 if(
m_eEndŸn
 =ğ
BIGENDIAN
)

490 
cu¼Pix–
 = (
R1
<<24è+ (
G1
<<16è+ (
B1
<<8);

492 #ià
kMemWr™esO±imize
 == 0

493 
	`put4Pix–
(
upPŒ
, 0, 
cu¼Pix–
);

494 
	`put4Pix–
(
cu¼PŒ
, 0, 
cu¼Pix–
);

496 
	`put4Pix–
(
upPŒ
, 0, 
cu¼Pix–
);

500 ià(
Ï¡PaœAv”aged
)

510 
Ï¡PaœAv”aged
 = 
çl£
;

518 ià(
	`isOdd
(
pix–Num
))

521 
Ï¡Pix–
 = 
	`g‘4Pix–
(
upPŒ
,-1);

522 
Ï¡R
 = 
	`G‘Red
(
Ï¡Pix–
);

523 
Ï¡G
 = 
	`G‘G»’
(
Ï¡Pix–
);

524 
Ï¡B
 = 
	`G‘Blue
(
Ï¡Pix–
);

525 ià(((
m_max_”rÜ_fÜ_two_pix–s
 >ğ3)è&& (
	`NewD–E
(
Ï¡R
, 
R0
, 
Ï¡G
, 
G0
,
Ï¡B
, 
B0
, m_max_error_for_two_pixels)))

531 #ià
kG©h”Sts
 == 1

532 
blockSts
[
es21nw
]++;

534 
didNÙBud4by1
 = 
Œue
;

536 
	`Av”ageNRound
(
	`isOdd
(
pix–Num
), 
Ï¡R
,†a¡R, 
R0
, 
Ï¡G
,†a¡G, 
G0
, 
Ï¡B
,†a¡B, 
B0
);

538 ià((
pix–Num
 >ğ3è&& (
æagsPŒ
[-3] & 
e21nw
))

540 
	`ASSERT
(!((
æagsPŒ
[-3] | fÏgsPŒ[-2] | fÏgsPŒ[-1] | fÏgsPŒ[0]è& 
eTheRe¡
));

543 
Ï¡Pix–
 = 
	`g‘4Pix–
(
upPŒ
,-3);

544 
R0
 = 
	`G‘Red
(
Ï¡Pix–
);

545 
G0
 = 
	`G‘G»’
(
Ï¡Pix–
);

546 
B0
 = 
	`G‘Blue
(
Ï¡Pix–
);

547 iàĞ(
maxE¼ÜFÜFourPix–s
 >ğ3è&& (
	`NewD–E
(
Ï¡R
, 
R0
, 
Ï¡G
, 
G0
,
Ï¡B
, 
B0
, maxErrorForFourPixels)))

553 #ià
kG©h”Sts
 == 1

554 
blockSts
[
es41ni
]++;

556 
didNÙBud4by1
 = 
çl£
;

557 
	`Av”ageNRound
((
pix–Num
 & 0x04)=ğ0x04, 
Ï¡R
,†a¡R, 
R0
, 
Ï¡G
,†a¡G, 
G0
, 
Ï¡B
,†a¡B, 
B0
);

559 if(
m_eEndŸn
 =ğ
LITTLEENDIAN
)

560 
cu¼Pix–
 = (
Ï¡R
<<16è+ (
Ï¡G
<<8è+ 
Ï¡B
;

561 if(
m_eEndŸn
 =ğ
BIGENDIAN
)

562 
cu¼Pix–
 = (
Ï¡R
<<24è+ (
Ï¡G
<<16è+ (
Ï¡B
<<8);

564 #ià
kMemWr™esO±imize
 == 0

565 
	`put4Pix–
(
upPŒ
, -3, 
cu¼Pix–
);

566 
	`put4Pix–
(
upPŒ
, -2, 
cu¼Pix–
);

567 
	`put4Pix–
(
upPŒ
, -1, 
cu¼Pix–
);

568 
	`put4Pix–
(
upPŒ
, 0, 
cu¼Pix–
);

570 
	`put4Pix–
(
upPŒ
, -3, 
cu¼Pix–
);

573 
	`ASSERT
(!((
æagsPŒ
[-3] | fÏgsPŒ[-2] | fÏgsPŒ[-1] | fÏgsPŒ[0]è& 
eTheRe¡
));

575 
æagsPŒ
[-3] = (æagsPŒ[-3] & ~
eNÜths
è| 
e41ni
;

576 
æagsPŒ
[-2] = (æagsPŒ[-2] & ~
eNÜths
è| 
e41n
;

577 
æagsPŒ
[-1] = (æagsPŒ[-1] & ~
eNÜths
è| 
e41n
;

578 
æagsPŒ
[0] = (æagsPŒ[0] & ~
eNÜths
è| 
e41n
;

582 ià(
didNÙBud4by1
)

584 if(
m_eEndŸn
 =ğ
LITTLEENDIAN
)

585 
cu¼Pix–
 = (
Ï¡R
<<16è+ (
Ï¡G
<<8è+ 
Ï¡B
;

586 if(
m_eEndŸn
 =ğ
BIGENDIAN
)

587 
cu¼Pix–
 = (
Ï¡R
<<24è+ (
Ï¡G
<<16è+ (
Ï¡B
<<8);

589 #ià
kMemWr™esO±imize
 == 0

590 
	`put4Pix–
(
upPŒ
, -1, 
cu¼Pix–
);

591 
	`put4Pix–
(
upPŒ
, 0, 
cu¼Pix–
);

593 
	`put4Pix–
(
upPŒ
, -1, 
cu¼Pix–
);

595 
	`ASSERT
(!((
æagsPŒ
[-1] | fÏgsPŒ[0]è& 
eTheRe¡
));

596 
æagsPŒ
[-1] = (æagsPŒ[-1] & ~
eNÜths
è| 
e21nw
;

597 
æagsPŒ
[0] = (æagsPŒ[0] & ~
eNÜths
è| 
e21Ã
;

602 
Ï¡Pix–
 = 
	`g‘4Pix–
(
cu¼PŒ
,-1);

603 
Ï¡R
 = 
	`G‘Red
(
Ï¡Pix–
);

604 
Ï¡G
 = 
	`G‘G»’
(
Ï¡Pix–
);

605 
Ï¡B
 = 
	`G‘Blue
(
Ï¡Pix–
);

606 ià((
m_max_”rÜ_fÜ_two_pix–s
 >ğ3è&& (
	`NewD–E
(
Ï¡R
, 
R1
, 
Ï¡G
, 
G1
, 
Ï¡B
, 
B1
, m_max_error_for_two_pixels)))

612 
didNÙBud4by1
 = 
Œue
;

613 #ià
kG©h”Sts
 == 1

614 
blockSts
[
es21sw
]++;

616 
	`Av”ageNRound
(
	`isOdd
(
pix–Num
), 
Ï¡R
,†a¡R, 
R1
, 
Ï¡G
,†a¡G, 
G1
, 
Ï¡B
,†a¡B, 
B1
);

617 ià((
pix–Num
 >ğ3è&& (
æagsPŒ
[-3] & 
e21sw
))

620 
	`ASSERT
(!((
æagsPŒ
[-3] | fÏgsPŒ[-2] | fÏgsPŒ[-1] | fÏgsPŒ[0]è& 
eTheRe¡
));

622 
Ï¡Pix–
 = 
	`g‘4Pix–
(
cu¼PŒ
,-3);

623 
R0
 = 
	`G‘Red
(
Ï¡Pix–
);

624 
G0
 = 
	`G‘G»’
(
Ï¡Pix–
);

625 
B0
 = 
	`G‘Blue
(
Ï¡Pix–
);

626 ià((
maxE¼ÜFÜFourPix–s
 >ğ3è&& (
	`NewD–E
(
Ï¡R
, 
R0
, 
Ï¡G
, 
G0
, 
Ï¡B
, 
B0
, maxErrorForFourPixels)))

632 #ià
kG©h”Sts
 == 1

633 
blockSts
[
es41si
]++;

635 
didNÙBud4by1
 = 
çl£
;

636 
	`Av”ageNRound
((
pix–Num
 & 0x04)=ğ0x04, 
Ï¡R
,†a¡R, 
R0
, 
Ï¡G
,†a¡G, 
G0
, 
Ï¡B
,†a¡B, 
B0
);

638 if(
m_eEndŸn
 =ğ
LITTLEENDIAN
)

639 
cu¼Pix–
 = (
Ï¡R
<<16è+ (
Ï¡G
<<8è+ 
Ï¡B
;

640 if(
m_eEndŸn
 =ğ
BIGENDIAN
)

641 
cu¼Pix–
 = (
Ï¡R
<<24è+ (
Ï¡G
<<16è+ (
Ï¡B
<<8);

643 #ià
kMemWr™esO±imize
 == 0

644 
	`put4Pix–
(
cu¼PŒ
, -3, 
cu¼Pix–
);

645 
	`put4Pix–
(
cu¼PŒ
, -2, 
cu¼Pix–
);

646 
	`put4Pix–
(
cu¼PŒ
, -1, 
cu¼Pix–
);

647 
	`put4Pix–
(
cu¼PŒ
, 0, 
cu¼Pix–
);

649 
	`put4Pix–
(
cu¼PŒ
, -3, 
cu¼Pix–
);

651 
æagsPŒ
[-3] = (æagsPŒ[-3] & ~
eSouths
è| 
e41si
;

652 
æagsPŒ
[-2] = (æagsPŒ[-2] & ~
eSouths
è| 
e41s
;

653 
æagsPŒ
[-1] = (æagsPŒ[-1] & ~
eSouths
è| 
e41s
;

654 
æagsPŒ
[0] = (æagsPŒ[0] & ~
eSouths
è| 
e41s
;

658 ià(
didNÙBud4by1
)

660 
	`ASSERT
(!((
æagsPŒ
[-1] | fÏgsPŒ[0]è& 
eTheRe¡
));

662 if(
m_eEndŸn
 =ğ
LITTLEENDIAN
)

663 
cu¼Pix–
 = (
Ï¡R
<<16è+ (
Ï¡G
<<8è+ 
Ï¡B
;

664 if(
m_eEndŸn
 =ğ
BIGENDIAN
)

665 
cu¼Pix–
 = (
Ï¡R
<<24è+ (
Ï¡G
<<16è+ (
Ï¡B
<<8);

667 #ià
kMemWr™esO±imize
 == 0

668 
	`put4Pix–
(
cu¼PŒ
, -1, 
cu¼Pix–
);

669 
	`put4Pix–
(
cu¼PŒ
, 0, 
cu¼Pix–
);

671 
	`put4Pix–
(
cu¼PŒ
, -1, 
cu¼Pix–
);

674 
æagsPŒ
[-1] = (æagsPŒ[-1] & ~
eSouths
è| 
e21sw
;

675 
æagsPŒ
[0] = (æagsPŒ[0] & ~
eSouths
è| 
e21£
;

683 
Ï¡PaœAv”aged
 = 
çl£
;

686 
upPŒ
 +ğ
eBufã»dPix–WidthInBy‹s
;

687 
cu¼PŒ
 +ğ
eBufã»dPix–WidthInBy‹s
;

688 
æagsPŒ
++;

690 
	}
}

700 
	gEº›F‹r
::
	$F‹r2PaœsOfF‹»dRows
(*
row1PŒ
, *
row2PŒ
, *
row3PŒ
, *
row4PŒ
)

702 cÚ¡ 
maxE¼ÜFÜFourPix–s
 = 
m_max_”rÜ_fÜ_two_pix–s
 / 2;

703 cÚ¡ 
maxE¼ÜFÜEightPix–s
 = 
maxE¼ÜFÜFourPix–s
 / 2;

704 cÚ¡ 
maxE¼ÜFÜSix‹’Pix–s
 = 
maxE¼ÜFÜEightPix–s
 / 2;

705 cÚ¡ 
maxE¼ÜFÜThœtyTwoPix–s
 = 
maxE¼ÜFÜSix‹’Pix–s
 / 2;

707 
pix–Num
 = 0;…ix–Num < (
m_row_width_š_pix–s
-3);)

709 
cu¼Pix–
, 
upPix–
;

710 
R0
, 
G0
, 
B0
, 
R1
, 
G1
, 
B1
;

712 ià((
m_pix–_f‹»d_æags
[0][
pix–Num
] & 
e42i
) && (m_pixel_filtered_flags[1][pixelNum] &ƒ42i))

723 
	`ASSERT
(
m_pix–_f‹»d_æags
[0][
pix–Num
] =ğ
e42i
 && m_pix–_f‹»d_æags[0][pix–Num+1] =ğ
e42
 && m_pixel_filtered_flags[0][pixelNum+2] ==ƒ42 && m_pixel_filtered_flags[0][pixelNum+3] ==ƒ42);

724 
	`ASSERT
(
m_pix–_f‹»d_æags
[1][
pix–Num
] =ğ
e42i
 && m_pix–_f‹»d_æags[1][pix–Num+1] =ğ
e42
 && m_pixel_filtered_flags[1][pixelNum+2] ==ƒ42 && m_pixel_filtered_flags[1][pixelNum+3] ==ƒ42);

726 
upPix–
 = 
	`g‘4Pix–
(
row1PŒ
);

727 
cu¼Pix–
 = 
	`g‘4Pix–
(
row3PŒ
);

729 
R1
 = 
	`G‘Red
(
cu¼Pix–
);

730 
G1
 = 
	`G‘G»’
(
cu¼Pix–
);

731 
B1
 = 
	`G‘Blue
(
cu¼Pix–
);

733 
R0
 = 
	`G‘Red
(
upPix–
);

734 
G0
 = 
	`G‘G»’
(
upPix–
);

735 
B0
 = 
	`G‘Blue
(
upPix–
);

737 if((
maxE¼ÜFÜSix‹’Pix–s
 >ğ3è&&(
	`NewD–E
(
R1
, 
R0
, 
G1
, 
G0
, 
B1
, 
B0
, maxErrorForSixteenPixels)))

746 #ià
kG©h”Sts
 == 1

747 
blockSts
[
es44ni
]++;

749 
	`Av”ageNRound
((
pix–Num
 & 0x04è=ğ0x04, 
R1
, R1, 
R0
, 
G1
, G1, 
G0
, 
B1
, B1, 
B0
);

751 if(
m_eEndŸn
 =ğ
LITTLEENDIAN
)

752 
cu¼Pix–
 = (
R1
<<16è+ (
G1
<<8è+ 
B1
;

753 if(
m_eEndŸn
 =ğ
BIGENDIAN
)

754 
cu¼Pix–
 = (
R1
<<24è+ (
G1
<<16è+ (
B1
<<8);

756 #ià
kMemWr™esO±imize
 == 0

757 
	`put4Pix–
(
row1PŒ
, 0, 
cu¼Pix–
);

758 
	`put4Pix–
(
row1PŒ
, 1, 
cu¼Pix–
);

759 
	`put4Pix–
(
row1PŒ
, 2, 
cu¼Pix–
);

760 
	`put4Pix–
(
row1PŒ
, 3, 
cu¼Pix–
);

761 
	`put4Pix–
(
row2PŒ
, 0, 
cu¼Pix–
);

762 
	`put4Pix–
(
row2PŒ
, 1, 
cu¼Pix–
);

763 
	`put4Pix–
(
row2PŒ
, 2, 
cu¼Pix–
);

764 
	`put4Pix–
(
row2PŒ
, 3, 
cu¼Pix–
);

765 
	`put4Pix–
(
row3PŒ
, 0, 
cu¼Pix–
);

766 
	`put4Pix–
(
row3PŒ
, 1, 
cu¼Pix–
);

767 
	`put4Pix–
(
row3PŒ
, 2, 
cu¼Pix–
);

768 
	`put4Pix–
(
row3PŒ
, 3, 
cu¼Pix–
);

769 
	`put4Pix–
(
row4PŒ
, 0, 
cu¼Pix–
);

770 
	`put4Pix–
(
row4PŒ
, 1, 
cu¼Pix–
);

771 
	`put4Pix–
(
row4PŒ
, 2, 
cu¼Pix–
);

772 
	`put4Pix–
(
row4PŒ
, 3, 
cu¼Pix–
);

774 
	`put4Pix–
(
row1PŒ
, 0, 
cu¼Pix–
);

776 
row1PŒ
 +ğ4*
eBufã»dPix–WidthInBy‹s
;

777 
row2PŒ
 +ğ4*
eBufã»dPix–WidthInBy‹s
;

778 
row3PŒ
 +ğ4*
eBufã»dPix–WidthInBy‹s
;

779 
row4PŒ
 +ğ4*
eBufã»dPix–WidthInBy‹s
;

781 
m_pix–_f‹»d_æags
[0][
pix–Num
] = 
e44ni
;

782 
m_pix–_f‹»d_æags
[0][
pix–Num
+1] = m_pix–_f‹»d_æags[0][pix–Num+2] = m_pix–_f‹»d_æags[0][pix–Num+3] = 
e44n
;

783 
m_pix–_f‹»d_æags
[1][
pix–Num
] = 
e44si
;

784 
m_pix–_f‹»d_æags
[1][
pix–Num
+1] = m_pix–_f‹»d_æags[1][pix–Num+2] = m_pix–_f‹»d_æags[1][pix–Num+3] = 
e44s
;

786 ià((
pix–Num
 >ğ4è&& (
m_pix–_f‹»d_æags
[1][pix–Num-4] & 
e44si
))

795 
	`ASSERT
(
m_pix–_f‹»d_æags
[0][
pix–Num
-4] =ğ
e44ni
 && m_pix–_f‹»d_æags[0][pix–Num-3] =ğ
e44n
 && m_pixel_filtered_flags[0][pixelNum-2] ==ƒ44n && m_pixel_filtered_flags[0][pixelNum-1] ==ƒ44n);

796 
	`ASSERT
(
m_pix–_f‹»d_æags
[1][
pix–Num
-4] =ğ
e44si
 && m_pix–_f‹»d_æags[1][pix–Num-3] =ğ
e44s
 && m_pixel_filtered_flags[1][pixelNum-2] ==ƒ44s && m_pixel_filtered_flags[1][pixelNum-1] ==ƒ44s);

798 
upPix–
 = 
	`g‘4Pix–
(
row1PŒ
, -8);

800 
R0
 = 
	`G‘Red
(
upPix–
);

801 
G0
 = 
	`G‘G»’
(
upPix–
);

802 
B0
 = 
	`G‘Blue
(
upPix–
);

804 ifĞ(
maxE¼ÜFÜThœtyTwoPix–s
 >ğ3è&& (
	`NewD–E
(
R1
, 
R0
, 
G1
, 
G0
, 
B1
, 
B0
, maxErrorForThirtyTwoPixels)))

813 #ià
kG©h”Sts
 == 1

814 
blockSts
[
es84ni
]++;

816 
	`Av”ageNRound
((
pix–Num
 & 0x08è=ğ0x08, 
R1
, R1, 
R0
, 
G1
, G1, 
G0
, 
B1
, B1, 
B0
);

817 if(
m_eEndŸn
 =ğ
LITTLEENDIAN
)

818 
cu¼Pix–
 = (
R1
<<16è+ (
G1
<<8è+ 
B1
;

819 if(
m_eEndŸn
 =ğ
BIGENDIAN
)

820 
cu¼Pix–
 = (
R1
<<24è+ (
G1
<<16è+ (
B1
<<8);

822 #ià
kMemWr™esO±imize
 == 0

823 
	`put4Pix–
(
row1PŒ
, -8, 
cu¼Pix–
);

824 
	`put4Pix–
(
row1PŒ
, -7, 
cu¼Pix–
);

825 
	`put4Pix–
(
row1PŒ
, -6, 
cu¼Pix–
);

826 
	`put4Pix–
(
row1PŒ
, -5, 
cu¼Pix–
);

827 
	`put4Pix–
(
row1PŒ
, -4, 
cu¼Pix–
);

828 
	`put4Pix–
(
row1PŒ
, -3, 
cu¼Pix–
);

829 
	`put4Pix–
(
row1PŒ
, -2, 
cu¼Pix–
);

830 
	`put4Pix–
(
row1PŒ
, -1, 
cu¼Pix–
);

831 
	`put4Pix–
(
row2PŒ
, -8, 
cu¼Pix–
);

832 
	`put4Pix–
(
row2PŒ
, -7, 
cu¼Pix–
);

833 
	`put4Pix–
(
row2PŒ
, -6, 
cu¼Pix–
);

834 
	`put4Pix–
(
row2PŒ
, -5, 
cu¼Pix–
);

835 
	`put4Pix–
(
row2PŒ
, -4, 
cu¼Pix–
);

836 
	`put4Pix–
(
row2PŒ
, -3, 
cu¼Pix–
);

837 
	`put4Pix–
(
row2PŒ
, -2, 
cu¼Pix–
);

838 
	`put4Pix–
(
row2PŒ
, -1, 
cu¼Pix–
);

839 
	`put4Pix–
(
row3PŒ
, -8, 
cu¼Pix–
);

840 
	`put4Pix–
(
row3PŒ
, -7, 
cu¼Pix–
);

841 
	`put4Pix–
(
row3PŒ
, -6, 
cu¼Pix–
);

842 
	`put4Pix–
(
row3PŒ
, -5, 
cu¼Pix–
);

843 
	`put4Pix–
(
row3PŒ
, -4, 
cu¼Pix–
);

844 
	`put4Pix–
(
row3PŒ
, -3, 
cu¼Pix–
);

845 
	`put4Pix–
(
row3PŒ
, -2, 
cu¼Pix–
);

846 
	`put4Pix–
(
row3PŒ
, -1, 
cu¼Pix–
);

847 
	`put4Pix–
(
row4PŒ
, -8, 
cu¼Pix–
);

848 
	`put4Pix–
(
row4PŒ
, -7, 
cu¼Pix–
);

849 
	`put4Pix–
(
row4PŒ
, -6, 
cu¼Pix–
);

850 
	`put4Pix–
(
row4PŒ
, -5, 
cu¼Pix–
);

851 
	`put4Pix–
(
row4PŒ
, -4, 
cu¼Pix–
);

852 
	`put4Pix–
(
row4PŒ
, -3, 
cu¼Pix–
);

853 
	`put4Pix–
(
row4PŒ
, -2, 
cu¼Pix–
);

854 
	`put4Pix–
(
row4PŒ
, -1, 
cu¼Pix–
);

856 
	`put4Pix–
(
row1PŒ
, -8, 
cu¼Pix–
);

858 
m_pix–_f‹»d_æags
[0][
pix–Num
-4] = 
e84ni
;

859 
m_pix–_f‹»d_æags
[0][
pix–Num
-3] = m_pix–_f‹»d_æags[0][pix–Num-2] = m_pix–_f‹»d_æags[0][pix–Num-1] = m_pix–_f‹»d_æags[0][pix–Num] = m_pix–_f‹»d_æags[0][pix–Num+1] = m_pix–_f‹»d_æags[0][pix–Num+2] = m_pix–_f‹»d_æags[0][pix–Num+3] = 
e84n
;

860 
m_pix–_f‹»d_æags
[1][
pix–Num
-4] = 
e84si
;

861 
m_pix–_f‹»d_æags
[1][
pix–Num
-3] = m_pix–_f‹»d_æags[1][pix–Num-2] = m_pix–_f‹»d_æags[1][pix–Num-1] = m_pix–_f‹»d_æags[1][pix–Num] = m_pix–_f‹»d_æags[1][pix–Num+1] = m_pix–_f‹»d_æags[1][pix–Num+2] = m_pix–_f‹»d_æags[1][pix–Num+3] = 
e84s
;

867 
row1PŒ
 +ğ4*
eBufã»dPix–WidthInBy‹s
;

868 
row2PŒ
 +ğ4*
eBufã»dPix–WidthInBy‹s
;

869 
row3PŒ
 +ğ4*
eBufã»dPix–WidthInBy‹s
;

870 
row4PŒ
 +ğ4*
eBufã»dPix–WidthInBy‹s
;

872 
pix–Num
 += 4;

874 ià((
m_pix–_f‹»d_æags
[0][
pix–Num
] & 
e22w
) && (m_pixel_filtered_flags[1][pixelNum] &ƒ22w))

885 
	`ASSERT
(
m_pix–_f‹»d_æags
[0][
pix–Num
] =ğ
e22w
 && m_pix–_f‹»d_æags[0][pix–Num+1] =ğ
e22e
);

886 
	`ASSERT
(
m_pix–_f‹»d_æags
[1][
pix–Num
] =ğ
e22w
 && m_pix–_f‹»d_æags[1][pix–Num+1] =ğ
e22e
);

888 
upPix–
 = 
	`g‘4Pix–
(
row1PŒ
);

889 
cu¼Pix–
 = 
	`g‘4Pix–
(
row3PŒ
);

891 
R1
 = 
	`G‘Red
(
cu¼Pix–
);

892 
G1
 = 
	`G‘G»’
(
cu¼Pix–
);

893 
B1
 = 
	`G‘Blue
(
cu¼Pix–
);

895 
R0
 = 
	`G‘Red
(
upPix–
);

896 
G0
 = 
	`G‘G»’
(
upPix–
);

897 
B0
 = 
	`G‘Blue
(
upPix–
);

899 ià((
maxE¼ÜFÜEightPix–s
 >ğ3è&& (
	`NewD–E
(
R1
, 
R0
, 
G1
, 
G0
, 
B1
, 
B0
, maxErrorForEightPixels)))

908 #ià
kG©h”Sts
 == 1

909 
blockSts
[
es24nw
]++;

911 
	`Av”ageNRound
((
pix–Num
 & 0x02è=ğ0x02, 
R1
, R1, 
R0
, 
G1
, G1, 
G0
, 
B1
, B1, 
B0
);

913 if(
m_eEndŸn
 =ğ
LITTLEENDIAN
)

914 
cu¼Pix–
 = (
R1
<<16è+ (
G1
<<8è+ 
B1
;

915 if(
m_eEndŸn
 =ğ
BIGENDIAN
)

916 
cu¼Pix–
 = (
R1
<<24è+ (
G1
<<16è+ (
B1
<<8);

918 #ià
kMemWr™esO±imize
 == 0

919 
	`put4Pix–
(
row1PŒ
, 0, 
cu¼Pix–
);

920 
	`put4Pix–
(
row1PŒ
, 1, 
cu¼Pix–
);

921 
	`put4Pix–
(
row2PŒ
, 0, 
cu¼Pix–
);

922 
	`put4Pix–
(
row2PŒ
, 1, 
cu¼Pix–
);

923 
	`put4Pix–
(
row3PŒ
, 0, 
cu¼Pix–
);

924 
	`put4Pix–
(
row3PŒ
, 1, 
cu¼Pix–
);

925 
	`put4Pix–
(
row4PŒ
, 0, 
cu¼Pix–
);

926 
	`put4Pix–
(
row4PŒ
, 1, 
cu¼Pix–
);

928 
	`put4Pix–
(
row1PŒ
, 0, 
cu¼Pix–
);

930 
row1PŒ
 +ğ2*
eBufã»dPix–WidthInBy‹s
;

931 
row2PŒ
 +ğ2*
eBufã»dPix–WidthInBy‹s
;

932 
row3PŒ
 +ğ2*
eBufã»dPix–WidthInBy‹s
;

933 
row4PŒ
 +ğ2*
eBufã»dPix–WidthInBy‹s
;

935 
m_pix–_f‹»d_æags
[0][
pix–Num
] = 
e24nw
;

936 
m_pix–_f‹»d_æags
[0][
pix–Num
+1] = 
e24Ã
;

937 
m_pix–_f‹»d_æags
[1][
pix–Num
] = 
e24sw
;

938 
m_pix–_f‹»d_æags
[1][
pix–Num
+1] = 
e24£
;

942 
row1PŒ
 +ğ2*
eBufã»dPix–WidthInBy‹s
;

943 
row2PŒ
 +ğ2*
eBufã»dPix–WidthInBy‹s
;

944 
row3PŒ
 +ğ2*
eBufã»dPix–WidthInBy‹s
;

945 
row4PŒ
 +ğ2*
eBufã»dPix–WidthInBy‹s
;

947 
pix–Num
 += 2;

949 ià((
m_pix–_f‹»d_æags
[0][
pix–Num
] & 
e12
) && (m_pixel_filtered_flags[1][pixelNum] &ƒ12))

960 
	`ASSERT
(
m_pix–_f‹»d_æags
[0][
pix–Num
] =ğ
e12
);

961 
	`ASSERT
(
m_pix–_f‹»d_æags
[1][
pix–Num
] =ğ
e12
);

963 
upPix–
 = 
	`g‘4Pix–
(
row1PŒ
);

964 
cu¼Pix–
 = 
	`g‘4Pix–
(
row3PŒ
);

966 
R1
 = 
	`G‘Red
(
cu¼Pix–
);

967 
G1
 = 
	`G‘G»’
(
cu¼Pix–
);

968 
B1
 = 
	`G‘Blue
(
cu¼Pix–
);

970 
R0
 = 
	`G‘Red
(
upPix–
);

971 
G0
 = 
	`G‘G»’
(
upPix–
);

972 
B0
 = 
	`G‘Blue
(
upPix–
);

974 ià((
maxE¼ÜFÜFourPix–s
 >ğ3è&& (
	`NewD–E
(
R1
, 
R0
, 
G1
, 
G0
, 
B1
, 
B0
, maxErrorForFourPixels)))

983 #ià
kG©h”Sts
 == 1

984 
blockSts
[
es14n
]++;

986 
	`Av”ageNRound
((
pix–Num
 & 0x01è=ğ0x01, 
R1
, R1, 
R0
, 
G1
, G1, 
G0
, 
B1
, B1, 
B0
);

988 if(
m_eEndŸn
 =ğ
LITTLEENDIAN
)

989 
cu¼Pix–
 = (
R1
<<16è+ (
G1
<<8è+ 
B1
;

990 if(
m_eEndŸn
 =ğ
BIGENDIAN
)

991 
cu¼Pix–
 = (
R1
<<24è+ (
G1
<<16è+ (
B1
<<8);

993 #ià
kMemWr™esO±imize
 == 0

994 
	`put4Pix–
(
row1PŒ
, 0, 
cu¼Pix–
);

995 
	`put4Pix–
(
row2PŒ
, 0, 
cu¼Pix–
);

996 
	`put4Pix–
(
row3PŒ
, 0, 
cu¼Pix–
);

997 
	`put4Pix–
(
row4PŒ
, 0, 
cu¼Pix–
);

999 
	`put4Pix–
(
row1PŒ
, 0, 
cu¼Pix–
);

1001 
m_pix–_f‹»d_æags
[0][
pix–Num
] = 
e14n
;

1002 
m_pix–_f‹»d_æags
[1][
pix–Num
] = 
e14s
;

1005 
row1PŒ
 +ğ
eBufã»dPix–WidthInBy‹s
;

1006 
row2PŒ
 +ğ
eBufã»dPix–WidthInBy‹s
;

1007 
row3PŒ
 +ğ
eBufã»dPix–WidthInBy‹s
;

1008 
row4PŒ
 +ğ
eBufã»dPix–WidthInBy‹s
;

1010 
pix–Num
++;

1012 ià((
m_pix–_f‹»d_æags
[0][
pix–Num
] & 
e41si
)

1013 && (
m_pix–_f‹»d_æags
[1][
pix–Num
] & 
e41ni
))

1023 
upPix–
 = 
	`g‘4Pix–
(
row2PŒ
);

1024 
cu¼Pix–
 = 
	`g‘4Pix–
(
row3PŒ
);

1026 
R1
 = 
	`G‘Red
(
cu¼Pix–
);

1027 
G1
 = 
	`G‘G»’
(
cu¼Pix–
);

1028 
B1
 = 
	`G‘Blue
(
cu¼Pix–
);

1030 
R0
 = 
	`G‘Red
(
upPix–
);

1031 
G0
 = 
	`G‘G»’
(
upPix–
);

1032 
B0
 = 
	`G‘Blue
(
upPix–
);

1035 ià((
maxE¼ÜFÜEightPix–s
 >ğ3è&& (
	`NewD–E
(
R1
, 
R0
, 
G1
, 
G0
, 
B1
, 
B0
, maxErrorForEightPixels)))

1043 #ià
kG©h”Sts
 == 1

1044 
blockSts
[
es42w
]++;

1046 
	`Av”ageNRound
((
pix–Num
 & 0x04è=ğ0x04, 
R1
, R1, 
R0
, 
G1
, G1, 
G0
, 
B1
, B1, 
B0
);

1048 if(
m_eEndŸn
 =ğ
LITTLEENDIAN
)

1049 
cu¼Pix–
 = (
R1
<<16è+ (
G1
<<8è+ 
B1
;

1050 if(
m_eEndŸn
 =ğ
BIGENDIAN
)

1051 
cu¼Pix–
 = (
R1
<<24è+ (
G1
<<16è+ (
B1
<<8);

1054 
	`put4Pix–
(
row2PŒ
, 0, 
cu¼Pix–
);

1055 
	`put4Pix–
(
row2PŒ
, 1, 
cu¼Pix–
);

1056 
	`put4Pix–
(
row2PŒ
, 2, 
cu¼Pix–
);

1057 
	`put4Pix–
(
row2PŒ
, 3, 
cu¼Pix–
);

1058 
	`put4Pix–
(
row3PŒ
, 0, 
cu¼Pix–
);

1059 
	`put4Pix–
(
row3PŒ
, 1, 
cu¼Pix–
);

1060 
	`put4Pix–
(
row3PŒ
, 2, 
cu¼Pix–
);

1061 
	`put4Pix–
(
row3PŒ
, 3, 
cu¼Pix–
);

1063 
m_pix–_f‹»d_æags
[0][
pix–Num
] = m_pix–_f‹»d_æags[0][pix–Num] & ~
e41si
;

1064 
m_pix–_f‹»d_æags
[0][
pix–Num
+1] = m_pix–_f‹»d_æags[0][pix–Num+1] & ~
e41s
;

1065 
m_pix–_f‹»d_æags
[0][
pix–Num
+2] = m_pix–_f‹»d_æags[0][pix–Num+1] & ~
e41s
;

1066 
m_pix–_f‹»d_æags
[0][
pix–Num
+3] = m_pix–_f‹»d_æags[0][pix–Num+1] & ~
e41s
;

1068 
m_pix–_f‹»d_æags
[1][
pix–Num
] = m_pix–_f‹»d_æags[1][pix–Num] & ~
e41ni
;

1069 
m_pix–_f‹»d_æags
[1][
pix–Num
+1] = m_pix–_f‹»d_æags[1][pix–Num+1] & ~
e41n
;

1070 
m_pix–_f‹»d_æags
[1][
pix–Num
+2] = m_pix–_f‹»d_æags[1][pix–Num+1] & ~
e41n
;

1071 
m_pix–_f‹»d_æags
[1][
pix–Num
+3] = m_pix–_f‹»d_æags[1][pix–Num+1] & ~
e41n
;

1073 
pix–Num
 += 4;

1075 
row1PŒ
 +ğ4*
eBufã»dPix–WidthInBy‹s
;

1076 
row2PŒ
 +ğ4*
eBufã»dPix–WidthInBy‹s
;

1077 
row3PŒ
 +ğ4*
eBufã»dPix–WidthInBy‹s
;

1078 
row4PŒ
 +ğ4*
eBufã»dPix–WidthInBy‹s
;

1080 ià((
m_pix–_f‹»d_æags
[0][
pix–Num
] & 
e21sw
)

1081 && (
m_pix–_f‹»d_æags
[1][
pix–Num
] & 
e21nw
))

1090 
	`ASSERT
(!((
m_pix–_f‹»d_æags
[0][
pix–Num
] & 
e11s
) | (m_pixel_filtered_flags[0][pixelNum+1] &ƒ11s)));

1091 
	`ASSERT
(!((
m_pix–_f‹»d_æags
[1][
pix–Num
] & 
e11n
) | (m_pixel_filtered_flags[1][pixelNum+1] &ƒ11n)));

1093 
upPix–
 = 
	`g‘4Pix–
(
row2PŒ
);

1094 
cu¼Pix–
 = 
	`g‘4Pix–
(
row3PŒ
);

1096 
R1
 = 
	`G‘Red
(
cu¼Pix–
);

1097 
G1
 = 
	`G‘G»’
(
cu¼Pix–
);

1098 
B1
 = 
	`G‘Blue
(
cu¼Pix–
);

1100 
R0
 = 
	`G‘Red
(
upPix–
);

1101 
G0
 = 
	`G‘G»’
(
upPix–
);

1102 
B0
 = 
	`G‘Blue
(
upPix–
);

1104 ià((
maxE¼ÜFÜFourPix–s
 >ğ3è&& (
	`NewD–E
(
R1
, 
R0
, 
G1
, 
G0
, 
B1
, 
B0
, maxErrorForFourPixels)))

1111 #ià
kG©h”Sts
 == 1

1112 
blockSts
[
es22w
]++;

1114 
	`Av”ageNRound
((
pix–Num
 & 0x02è=ğ0x02, 
R1
, R1, 
R0
, 
G1
, G1, 
G0
, 
B1
, B1, 
B0
);

1116 if(
m_eEndŸn
 =ğ
LITTLEENDIAN
)

1117 
cu¼Pix–
 = (
R1
<<16è+ (
G1
<<8è+ 
B1
;

1118 if(
m_eEndŸn
 =ğ
BIGENDIAN
)

1119 
cu¼Pix–
 = (
R1
<<24è+ (
G1
<<16è+ (
B1
<<8);

1122 
	`put4Pix–
(
row2PŒ
, 0, 
cu¼Pix–
);

1123 
	`put4Pix–
(
row2PŒ
, 1, 
cu¼Pix–
);

1124 
	`put4Pix–
(
row3PŒ
, 0, 
cu¼Pix–
);

1125 
	`put4Pix–
(
row3PŒ
, 1, 
cu¼Pix–
);

1127 
m_pix–_f‹»d_æags
[0][
pix–Num
] = m_pix–_f‹»d_æags[0][pix–Num] & ~
e21sw
;

1128 
m_pix–_f‹»d_æags
[0][
pix–Num
+1] = m_pix–_f‹»d_æags[0][pix–Num+1] & ~
e21£
;

1130 
m_pix–_f‹»d_æags
[1][
pix–Num
] = m_pix–_f‹»d_æags[1][pix–Num] & ~
e21nw
;

1131 
m_pix–_f‹»d_æags
[1][
pix–Num
+1] = m_pix–_f‹»d_æags[1][pix–Num+1] & ~
e21Ã
;

1134 
pix–Num
 += 2;

1136 
row1PŒ
 +ğ2*
eBufã»dPix–WidthInBy‹s
;

1137 
row2PŒ
 +ğ2*
eBufã»dPix–WidthInBy‹s
;

1138 
row3PŒ
 +ğ2*
eBufã»dPix–WidthInBy‹s
;

1139 
row4PŒ
 +ğ2*
eBufã»dPix–WidthInBy‹s
;

1141 ià((
m_pix–_f‹»d_æags
[0][
pix–Num
] & 
e11s
)

1142 && (
m_pix–_f‹»d_æags
[1][
pix–Num
] & 
e11n
))

1152 
upPix–
 = 
	`g‘4Pix–
(
row2PŒ
);

1153 
cu¼Pix–
 = 
	`g‘4Pix–
(
row3PŒ
);

1155 
R1
 = 
	`G‘Red
(
cu¼Pix–
);

1156 
G1
 = 
	`G‘G»’
(
cu¼Pix–
);

1157 
B1
 = 
	`G‘Blue
(
cu¼Pix–
);

1159 
R0
 = 
	`G‘Red
(
upPix–
);

1160 
G0
 = 
	`G‘G»’
(
upPix–
);

1161 
B0
 = 
	`G‘Blue
(
upPix–
);

1163 ià((
m_max_”rÜ_fÜ_two_pix–s
 >ğ3è&& (
	`NewD–E
(
R1
, 
R0
, 
G1
, 
G0
, 
B1
, 
B0
, m_max_error_for_two_pixels)))

1170 #ià
kG©h”Sts
 == 1

1171 
blockSts
[
es12w
]++;

1173 
	`Av”ageNRound
(
	`isOdd
(
pix–Num
), 
R1
, R1, 
R0
, 
G1
, G1, 
G0
, 
B1
, B1, 
B0
);

1175 if(
m_eEndŸn
 =ğ
LITTLEENDIAN
)

1176 
cu¼Pix–
 = (
R1
<<16è+ (
G1
<<8è+ 
B1
;

1177 if(
m_eEndŸn
 =ğ
BIGENDIAN
)

1178 
cu¼Pix–
 = (
R1
<<24è+ (
G1
<<16è+ (
B1
<<8);

1181 
	`put4Pix–
(
row2PŒ
, 0, 
cu¼Pix–
);

1182 
	`put4Pix–
(
row3PŒ
, 0, 
cu¼Pix–
);

1184 
m_pix–_f‹»d_æags
[0][
pix–Num
] = m_pix–_f‹»d_æags[0][pix–Num] & ~
e11s
;

1186 
m_pix–_f‹»d_æags
[1][
pix–Num
] = m_pix–_f‹»d_æags[1][pix–Num] & ~
e11n
;

1189 
pix–Num
 += 1;

1191 
row1PŒ
 +ğ
eBufã»dPix–WidthInBy‹s
;

1192 
row2PŒ
 +ğ
eBufã»dPix–WidthInBy‹s
;

1193 
row3PŒ
 +ğ
eBufã»dPix–WidthInBy‹s
;

1194 
row4PŒ
 +ğ
eBufã»dPix–WidthInBy‹s
;

1198 
pix–Num
 += 1;

1200 
row1PŒ
 +ğ
eBufã»dPix–WidthInBy‹s
;

1201 
row2PŒ
 +ğ
eBufã»dPix–WidthInBy‹s
;

1202 
row3PŒ
 +ğ
eBufã»dPix–WidthInBy‹s
;

1203 
row4PŒ
 +ğ
eBufã»dPix–WidthInBy‹s
;

1206 
	}
}

1215 
	gEº›F‹r
::
	$F‹r3F‹»dRows
(*
row1PŒ
, *
row2PŒ
, *
row3PŒ
)

1217 cÚ¡ 
maxE¼ÜFÜFourPix–s
 = 
m_max_”rÜ_fÜ_two_pix–s
 / 2;

1218 cÚ¡ 
maxE¼ÜFÜEightPix–s
 = 
maxE¼ÜFÜFourPix–s
 / 2;

1222 
pix–Num
 = 0;…ix–Num < (
m_row_width_š_pix–s
-3);)

1225 
ušt32_t
 
cu¼Pix–
, 
upPix–
;

1226 
R0
, 
G0
, 
B0
, 
R1
, 
G1
, 
B1
;

1228 ià((
m_pix–_f‹»d_æags
[0][
pix–Num
] & 
e41si
)

1229 && (
m_pix–_f‹»d_æags
[1][
pix–Num
] & 
e41ni
))

1238 
	`ASSERT
(!((
m_pix–_f‹»d_æags
[0][
pix–Num
] & 
e11s
) | (m_pixel_filtered_flags[0][pixelNum+1] &ƒ11s)));

1239 
	`ASSERT
(!((
m_pix–_f‹»d_æags
[1][
pix–Num
] & 
e11n
) | (m_pixel_filtered_flags[1][pixelNum+1] &ƒ11n)));

1241 
upPix–
 = 
	`g‘4Pix–
(
row2PŒ
);

1242 
cu¼Pix–
 = 
	`g‘4Pix–
(
row3PŒ
);

1244 
R1
 = 
	`G‘Red
(
cu¼Pix–
);

1245 
G1
 = 
	`G‘G»’
(
cu¼Pix–
);

1246 
B1
 = 
	`G‘Blue
(
cu¼Pix–
);

1248 
R0
 = 
	`G‘Red
(
upPix–
);

1249 
G0
 = 
	`G‘G»’
(
upPix–
);

1250 
B0
 = 
	`G‘Blue
(
upPix–
);

1253 ià((
maxE¼ÜFÜEightPix–s
 >ğ3è&& (
	`NewD–E
(
R1
, 
R0
, 
G1
, 
G0
, 
B1
, 
B0
, maxErrorForEightPixels)))

1261 #ià
kG©h”Sts
 == 1

1262 
blockSts
[
es42w
]++;

1264 
	`Av”ageNRound
((
pix–Num
 & 0x04è=ğ0x04, 
R1
, R1, 
R0
, 
G1
, G1, 
G0
, 
B1
, B1, 
B0
);

1266 if(
m_eEndŸn
 =ğ
LITTLEENDIAN
)

1267 
cu¼Pix–
 = (
R1
<<16è+ (
G1
<<8è+ 
B1
;

1268 if(
m_eEndŸn
 =ğ
BIGENDIAN
)

1269 
cu¼Pix–
 = (
R1
<<24è+ (
G1
<<16è+ (
B1
<<8);

1272 
	`put4Pix–
(
row2PŒ
, 0, 
cu¼Pix–
);

1273 
	`put4Pix–
(
row2PŒ
, 1, 
cu¼Pix–
);

1274 
	`put4Pix–
(
row2PŒ
, 2, 
cu¼Pix–
);

1275 
	`put4Pix–
(
row2PŒ
, 3, 
cu¼Pix–
);

1276 
	`put4Pix–
(
row3PŒ
, 0, 
cu¼Pix–
);

1277 
	`put4Pix–
(
row3PŒ
, 1, 
cu¼Pix–
);

1278 
	`put4Pix–
(
row3PŒ
, 2, 
cu¼Pix–
);

1279 
	`put4Pix–
(
row3PŒ
, 3, 
cu¼Pix–
);

1281 
m_pix–_f‹»d_æags
[0][
pix–Num
] = m_pix–_f‹»d_æags[0][pix–Num] & ~
e41si
;

1282 
m_pix–_f‹»d_æags
[0][
pix–Num
+1] = m_pix–_f‹»d_æags[0][pix–Num+1] & ~
e41s
;

1283 
m_pix–_f‹»d_æags
[0][
pix–Num
+2] = m_pix–_f‹»d_æags[0][pix–Num+1] & ~
e41s
;

1284 
m_pix–_f‹»d_æags
[0][
pix–Num
+3] = m_pix–_f‹»d_æags[0][pix–Num+1] & ~
e41s
;

1286 
m_pix–_f‹»d_æags
[1][
pix–Num
] = m_pix–_f‹»d_æags[1][pix–Num] & ~
e41ni
;

1287 
m_pix–_f‹»d_æags
[1][
pix–Num
+1] = m_pix–_f‹»d_æags[1][pix–Num+1] & ~
e41n
;

1288 
m_pix–_f‹»d_æags
[1][
pix–Num
+2] = m_pix–_f‹»d_æags[1][pix–Num+1] & ~
e41n
;

1289 
m_pix–_f‹»d_æags
[1][
pix–Num
+3] = m_pix–_f‹»d_æags[1][pix–Num+1] & ~
e41n
;

1291 
pix–Num
 += 4;

1293 
row1PŒ
 +ğ4*
eBufã»dPix–WidthInBy‹s
;

1294 
row2PŒ
 +ğ4*
eBufã»dPix–WidthInBy‹s
;

1295 
row3PŒ
 +ğ4*
eBufã»dPix–WidthInBy‹s
;

1297 ià((
m_pix–_f‹»d_æags
[0][
pix–Num
] & 
e21sw
)

1298 && (
m_pix–_f‹»d_æags
[1][
pix–Num
] & 
e21nw
))

1307 
	`ASSERT
(!((
m_pix–_f‹»d_æags
[0][
pix–Num
] & 
e11s
) | (m_pixel_filtered_flags[0][pixelNum+1] &ƒ11s)));

1308 
	`ASSERT
(!((
m_pix–_f‹»d_æags
[1][
pix–Num
] & 
e11n
) | (m_pixel_filtered_flags[1][pixelNum+1] &ƒ11n)));

1310 
upPix–
 = 
	`g‘4Pix–
(
row2PŒ
);

1311 
cu¼Pix–
 = 
	`g‘4Pix–
(
row3PŒ
);

1313 
R1
 = 
	`G‘Red
(
cu¼Pix–
);

1314 
G1
 = 
	`G‘G»’
(
cu¼Pix–
);

1315 
B1
 = 
	`G‘Blue
(
cu¼Pix–
);

1317 
R0
 = 
	`G‘Red
(
upPix–
);

1318 
G0
 = 
	`G‘G»’
(
upPix–
);

1319 
B0
 = 
	`G‘Blue
(
upPix–
);

1321 ià((
maxE¼ÜFÜFourPix–s
 >ğ3è&& (
	`NewD–E
(
R1
, 
R0
, 
G1
, 
G0
, 
B1
, 
B0
, maxErrorForFourPixels)))

1328 #ià
kG©h”Sts
 == 1

1329 
blockSts
[
es22w
]++;

1331 
	`Av”ageNRound
((
pix–Num
 & 0x02è=ğ0x02, 
R1
, R1, 
R0
, 
G1
, G1, 
G0
, 
B1
, B1, 
B0
);

1333 if(
m_eEndŸn
 =ğ
LITTLEENDIAN
)

1334 
cu¼Pix–
 = (
R1
<<16è+ (
G1
<<8è+ 
B1
;

1335 if(
m_eEndŸn
 =ğ
BIGENDIAN
)

1336 
cu¼Pix–
 = (
R1
<<24è+ (
G1
<<16è+ (
B1
<<8);

1339 
	`put4Pix–
(
row2PŒ
, 0, 
cu¼Pix–
);

1340 
	`put4Pix–
(
row2PŒ
, 1, 
cu¼Pix–
);

1341 
	`put4Pix–
(
row3PŒ
, 0, 
cu¼Pix–
);

1342 
	`put4Pix–
(
row3PŒ
, 1, 
cu¼Pix–
);

1344 
m_pix–_f‹»d_æags
[0][
pix–Num
] = m_pix–_f‹»d_æags[0][pix–Num] & ~
e21sw
;

1345 
m_pix–_f‹»d_æags
[0][
pix–Num
+1] = m_pix–_f‹»d_æags[0][pix–Num+1] & ~
e21£
;

1347 
m_pix–_f‹»d_æags
[1][
pix–Num
] = m_pix–_f‹»d_æags[1][pix–Num] & ~
e21nw
;

1348 
m_pix–_f‹»d_æags
[1][
pix–Num
+1] = m_pix–_f‹»d_æags[1][pix–Num+1] & ~
e21Ã
;

1351 
pix–Num
 += 2;

1353 
row1PŒ
 +ğ2*
eBufã»dPix–WidthInBy‹s
;

1354 
row2PŒ
 +ğ2*
eBufã»dPix–WidthInBy‹s
;

1355 
row3PŒ
 +ğ2*
eBufã»dPix–WidthInBy‹s
;

1357 ià((
m_pix–_f‹»d_æags
[0][
pix–Num
] & 
e11s
)

1358 && (
m_pix–_f‹»d_æags
[1][
pix–Num
] & 
e11n
))

1368 
upPix–
 = 
	`g‘4Pix–
(
row2PŒ
);

1369 
cu¼Pix–
 = 
	`g‘4Pix–
(
row3PŒ
);

1371 
R1
 = 
	`G‘Red
(
cu¼Pix–
);

1372 
G1
 = 
	`G‘G»’
(
cu¼Pix–
);

1373 
B1
 = 
	`G‘Blue
(
cu¼Pix–
);

1375 
R0
 = 
	`G‘Red
(
upPix–
);

1376 
G0
 = 
	`G‘G»’
(
upPix–
);

1377 
B0
 = 
	`G‘Blue
(
upPix–
);

1379 ià((
m_max_”rÜ_fÜ_two_pix–s
 >ğ3è&& (
	`NewD–E
(
R1
, 
R0
, 
G1
, 
G0
, 
B1
, 
B0
, m_max_error_for_two_pixels)))

1386 #ià
kG©h”Sts
 == 1

1387 
blockSts
[
es12w
]++;

1389 
	`Av”ageNRound
(
	`isOdd
(
pix–Num
), 
R1
, R1, 
R0
, 
G1
, G1, 
G0
, 
B1
, B1, 
B0
);

1391 if(
m_eEndŸn
 =ğ
LITTLEENDIAN
)

1392 
cu¼Pix–
 = (
R1
<<16è+ (
G1
<<8è+ 
B1
;

1393 if(
m_eEndŸn
 =ğ
BIGENDIAN
)

1394 
cu¼Pix–
 = (
R1
<<24è+ (
G1
<<16è+ (
B1
<<8);

1397 
	`put4Pix–
(
row2PŒ
, 0, 
cu¼Pix–
);

1398 
	`put4Pix–
(
row3PŒ
, 0, 
cu¼Pix–
);

1400 
m_pix–_f‹»d_æags
[0][
pix–Num
] = m_pix–_f‹»d_æags[0][pix–Num] & ~
e11s
;

1402 
m_pix–_f‹»d_æags
[1][
pix–Num
] = m_pix–_f‹»d_æags[1][pix–Num] & ~
e11n
;

1405 
pix–Num
 += 1;

1407 
row1PŒ
 +ğ
eBufã»dPix–WidthInBy‹s
;

1408 
row2PŒ
 +ğ
eBufã»dPix–WidthInBy‹s
;

1409 
row3PŒ
 +ğ
eBufã»dPix–WidthInBy‹s
;

1413 
pix–Num
 += 1;

1415 
row1PŒ
 +ğ
eBufã»dPix–WidthInBy‹s
;

1416 
row2PŒ
 +ğ
eBufã»dPix–WidthInBy‹s
;

1417 
row3PŒ
 +ğ
eBufã»dPix–WidthInBy‹s
;

1420 
	}
}

1422 
	#NEWTEST
 
Œue


	)

1424 
šlše
 
boŞ
 
	gEº›F‹r
::
	$NewD–E
(
dr0
, 
dr1
, 
dg0
, 
dg1
, 
db0
, 
db1
, 
tŞ”ªû
)

1426 
Y0
, 
Y1
, 
dY
, 
Cr0
, 
Cr1
, 
Cb0
, 
Cb1
, 
dCr
, 
dCb
;

1430 
Y0
 = 5*
dr0
 + 9*
dg0
 + 2*
db0
;

1431 
Y1
 = 5*
dr1
 + 9*
dg1
 + 2*
db1
;

1433 
dY
 = 
	`ABS
(
Y0
 - 
Y1
) >> 4;

1435 if(
dY
 > 
tŞ”ªû
) {

1436  
çl£
;

1440 
Cr0
 = (
dr0
 << 4è- 
Y0
;

1441 
Cr1
 = (
dr1
 << 4è- 
Y1
;

1442 
dCr
 = 
	`ABS
(
Cr0
 - 
Cr1
) >> 5;

1443 if(
dCr
 > 
tŞ”ªû
)

1445  
çl£
;

1449 
Cb0
 = (
db0
 << 4è- 
Y0
;

1450 
Cb1
 = (
db1
 << 4è- 
Y1
;

1451 
dCb
 = 
	`ABS
(
Cb0
 - 
Cb1
) >> 6;

1452 if(
dCb
 > 
tŞ”ªû
)

1454  
çl£
;

1458  
Œue
;

1459 
	}
}

1461 
	gEº›F‹r
::
	$Eº›F‹r
(
rowWidthInPix–s
, 
pix–Ty³s
 
pix–Ty³
, 
maxE¼ÜFÜTwoPix–s
)

1463 
šdex
;

1464 
m_šput_by‹s_³r_pix–
 = 3;

1465 
	`ASSERT
(
rowWidthInPix–s
 > 0);

1466 
	`ASSERT
(
pix–Ty³
 =ğ
eBGRPix–D©a
);

1470 
s
;

1471 
c
[2];

1472 } 
uEndŸn
;

1473 
uEndŸn
.
s
 = 0x0A0B;

1474 
m_eEndŸn
 = 
LITTLEENDIAN
;

1475 ià(
uEndŸn
.
c
[0] == 0x0A)

1476 
m_eEndŸn
 = 
BIGENDIAN
;

1478 
m_š‹º®_by‹s_³r_pix–
 = 4;

1480 
m_pix–_off£ts_šdex
 = 0;

1481 
m_row_width_š_pix–s
 = 
rowWidthInPix–s
;

1482 
m_row_width_š_by‹s
 = 
m_row_width_š_pix–s
*
m_š‹º®_by‹s_³r_pix–
;

1483 
m_max_”rÜ_fÜ_two_pix–s
 = 
maxE¼ÜFÜTwoPix–s
;

1485 
šdex
 = 0; index < 4; index++)

1487 
m_row_bufs
[
šdex
] = 
Ãw
 
ušt32_t
[
rowWidthInPix–s
];

1488 
	`ASSERT
(
m_row_bufs
[
šdex
]);

1490 
m_row_±rs
[
šdex
] = 
Ãw
 [
rowWidthInPix–s
*
m_šput_by‹s_³r_pix–
];

1491 
	`ASSERT
(
m_row_±rs
[
šdex
]);

1493 
m_bÏck_row_±rs
[
šdex
] = 
Ãw
 
BYTE
[
rowWidthInPix–s
*
m_šput_by‹s_³r_pix–
];

1494 
	`ASSERT
(
m_bÏck_row_±rs
[
šdex
]);

1496 
m_bÏck_¿¡”_sizes
[
šdex
] = 0;

1499 
šdex
 = 0; index < 2; index++)

1501 
m_pix–_f‹»d_æags
[
šdex
] = 
Ãw
 [
rowWidthInPix–s
];

1502 
	`ASSERT
(
m_pix–_f‹»d_æags
[
šdex
]);

1508 
maxCom´essiÚBufSize
 = 
m_row_width_š_by‹s
 + 1 + (()
	`û
((è
	`MAX
((
rowWidthInPix–s
-2)/255, 0)));

1510 
m_com´essiÚ_out_buf
 = 
Ãw
 [
maxCom´essiÚBufSize
];

1511 
	`ASSERT
(
m_com´essiÚ_out_buf
);

1513 
m_bufã»d_row_couÁ
 = 0;

1515 
m_pix–_off£ts
[0] = 0;

1516 
m_pix–_off£ts
[1] = 5;

1517 
m_pix–_off£ts
[2] = 2;

1518 
m_pix–_off£ts
[3] = 7;

1519 
m_pix–_off£ts
[4] = 1;

1520 
m_pix–_off£ts
[5] = 4;

1521 
m_pix–_off£ts
[6] = 6;

1522 
m_pix–_off£ts
[7] = 3;

1524 
m_row_šdex
 = 0;

1525 
	}
}

1528 
	gEº›F‹r
::~
	$Eº›F‹r
()

1531 
šdex
;

1533 
šdex
 = 0; index < 4; index++)

1535 
d–‘e
 [] 
m_row_bufs
[
šdex
];

1536 
d–‘e
 [] 
m_row_±rs
[
šdex
];

1537 
d–‘e
 [] 
m_bÏck_row_±rs
[
šdex
];

1540 
šdex
 = 0; index < 2; index++)

1542 
d–‘e
 [] 
m_pix–_f‹»d_æags
[
šdex
];

1545 
d–‘e
 [] 
m_com´essiÚ_out_buf
;

1546 
	}
}

1548 
	gEº›F‹r
::
	$wr™eBufã»dRows
()

1550 
pix–Index
 = 0;

1554 ifĞ1 =ğ
m_bufã»d_row_couÁ
)

1557 
off£t2
 = 
m_pix–_off£ts
[
m_pix–_off£ts_šdex
];

1559 
	`F‹r1RawRow
Ğ(*)(
m_row_bufs
[0] + 
off£t2
),

1560 
m_row_width_š_pix–s
 - 
m_pix–_off£ts
[
m_pix–_off£ts_šdex
],

1561 
m_pix–_f‹»d_æags
[0] + 
m_pix–_off£ts
[
m_pix–_off£ts_šdex
]);

1564 *
rowPŒ
 = 
m_row_±rs
[0];

1565 
	`ASSERT
(
rowPŒ
);

1566 
pix–Index
 = 0;

1569 
	`memıy
(
rowPŒ
, &
m_row_bufs
[0][
pix–Index
], 3);

1570 
rowPŒ
 += 3;

1571 } ++
pix–Index
 < 
m_row_width_š_pix–s
);

1577 ià(2 =ğ
m_bufã»d_row_couÁ
)

1580 
k
;

1581 
k
 = 0; k < 2; k++)

1583 *
rowPŒ
 = 
m_row_±rs
[
k
];

1584 
	`ASSERT
(
rowPŒ
);

1585 
pix–Index
 = 0;

1588 
	`memıy
(
rowPŒ
, &
m_row_bufs
[
k
][
pix–Index
], 3);

1589 
rowPŒ
 += 3;

1590 } ++
pix–Index
 < 
m_row_width_š_pix–s
);

1599 ià(3 =ğ
m_bufã»d_row_couÁ
)

1602 
off£t2
 = 
m_pix–_off£ts
[
m_pix–_off£ts_šdex
];

1604 
	`F‹r1RawRow
Ğ(*)(
m_row_bufs
[2] + 
off£t2
),

1605 
m_row_width_š_pix–s
 - 
m_pix–_off£ts
[
m_pix–_off£ts_šdex
],

1606 
m_pix–_f‹»d_æags
[1] + 
m_pix–_off£ts
[
m_pix–_off£ts_šdex
]);

1609 
	`F‹r3F‹»dRows
Ğ(*)
m_row_bufs
[0],

1610 (*)
m_row_bufs
[1],

1611 (*)
m_row_bufs
[2]);

1613 
k
;

1614 
k
 = 0; k < 3; k++)

1616 *
rowPŒ
 = 
m_row_±rs
[
k
];

1617 
	`ASSERT
(
rowPŒ
);

1618 
pix–Index
 = 0;

1621 
	`memıy
(
rowPŒ
, &
m_row_bufs
[
k
][
pix–Index
], 3);

1622 
rowPŒ
 += 3;

1623 } ++
pix–Index
 < 
m_row_width_š_pix–s
);

1626 
	}
}

1628 
	gEº›F‹r
::
	$subm™RowToF‹r
(*
rowPŒ
)

1630 
	`memıy
(
m_row_±rs
[
m_bufã»d_row_couÁ
], 
rowPŒ
, 
m_row_width_š_pix–s
*
m_šput_by‹s_³r_pix–
);

1632 
pix–Index
 = 0;

1633 
ušt32_t
 *
RowPŒDe¡
 = 
m_row_bufs
[
m_bufã»d_row_couÁ
];

1634 
BYTE
 
by‹1
 = 0;

1635 
BYTE
 
by‹2
 = 0;

1636 
BYTE
 
by‹3
 = 0;

1639 
by‹1
 = *
rowPŒ
++;

1640 
by‹2
 = *
rowPŒ
++;

1641 
by‹3
 = *
rowPŒ
++;

1642 if(
m_eEndŸn
 =ğ
LITTLEENDIAN
)

1643 
RowPŒDe¡
[
pix–Index
] = ((
by‹3
 << 16è| (
by‹2
 << 8è| (
by‹1
)) & 0x00FFFFFF;

1644 if(
m_eEndŸn
 =ğ
BIGENDIAN
)

1645 
RowPŒDe¡
[
pix–Index
] = ((
by‹1
 << 24è| (
by‹2
 << 16è| (
by‹3
 << 8)) & 0xFFFFFF00;

1646 } ++
pix–Index
 < 
m_row_width_š_pix–s
);

1648 
m_bufã»d_row_couÁ
++;

1650 
iRa¡”sR—dy
=0;

1651 
iRa¡”sD–iv”ed
=0;

1656 ià(2 =ğ
m_bufã»d_row_couÁ
)

1658 
off£t2
 = 
m_pix–_off£ts
[
m_pix–_off£ts_šdex
];

1660 
	`F‹r2RawRows
Ğ(*)(
m_row_bufs
[1] + 
off£t2
),

1661 (*)(
m_row_bufs
[0] + 
off£t2
),

1662 
m_row_width_š_pix–s
 - 
m_pix–_off£ts
[
m_pix–_off£ts_šdex
],

1663 
m_pix–_f‹»d_æags
[0] + 
m_pix–_off£ts
[
m_pix–_off£ts_šdex
]);

1666 ià(4 =ğ
m_bufã»d_row_couÁ
)

1668 
off£t4
 = 
m_pix–_off£ts
[
m_pix–_off£ts_šdex
];

1669 
	`F‹r2RawRows
Ğ(*)(
m_row_bufs
[3] + 
off£t4
),

1670 (*)(
m_row_bufs
[2] + 
off£t4
),

1671 
m_row_width_š_pix–s
 - 
m_pix–_off£ts
[
m_pix–_off£ts_šdex
],

1672 
m_pix–_f‹»d_æags
[1] + 
m_pix–_off£ts
[
m_pix–_off£ts_šdex
]);

1674 
	`F‹r2PaœsOfF‹»dRows
Ğ(*)
m_row_bufs
[0],

1675 (*)
m_row_bufs
[1],

1676 (*)
m_row_bufs
[2],

1677 (*)
m_row_bufs
[3]);

1679 #ià
kMemWr™esO±imize
 == 1

1682 
	`Wr™eBlockPix–s
();

1685 
m_pix–_off£ts_šdex
 = (m_pixel_offsets_index + 1) % 8;

1687 
k
;

1688 
k
 = 0; k < 
m_pix–_off£ts
[
m_pix–_off£ts_šdex
]; k++)

1690 
m_pix–_f‹»d_æags
[0][
k
] = 
eDÚe
;

1691 
m_pix–_f‹»d_æags
[1][
k
] = 
eDÚe
;

1695 
k
 = 0; k < 4; k++)

1697 *
rowPŒ
 = 
m_row_±rs
[
k
];

1698 
	`ASSERT
(
rowPŒ
);

1699 
pix–Index
 = 0;

1702 
	`memıy
(
rowPŒ
, &
m_row_bufs
[
k
][
pix–Index
], 
m_šput_by‹s_³r_pix–
);

1703 
rowPŒ
 +ğ
m_šput_by‹s_³r_pix–
;

1704 } ++
pix–Index
 < 
m_row_width_š_pix–s
);

1707 
m_bufã»d_row_couÁ
 = 0;

1708 
iRa¡”sR—dy
 = 4;

1710 
	}
}

1712 #ià
kMemWr™esO±imize
 == 1

1718 
	gEº›F‹r
::
	$Wr™eBlockPix–s
()

1720 *
row1PŒ
 = (*)
m_row_bufs
[0];

1721 *
row2PŒ
 = (*)
m_row_bufs
[1];

1722 *
row3PŒ
 = (*)
m_row_bufs
[2];

1723 *
row4PŒ
 = (*)
m_row_bufs
[3];

1725 
æagS‘
 = 0; flagSet <= 1; flagSet++)

1727 *
æagsPŒ
 = 
m_pix–_f‹»d_æags
[0];

1728 *
rowA
 = (*)
m_row_bufs
[0];

1729 *
rowB
 = (*)
m_row_bufs
[1];

1731 ià(
æagS‘
 == 1)

1733 
æagsPŒ
 = 
m_pix–_f‹»d_æags
[1];

1734 
rowA
 = (*)
m_row_bufs
[2];

1735 
rowB
 = (*)
m_row_bufs
[3];

1738 
rowIndex
 = 0;„owIndex < 
m_row_width_š_pix–s
;)

1740 
cu¼’tFÏgs
 = 
æagsPŒ
[
rowIndex
];

1742 #iâdeà
NDEBUG


1743 
numb”OfB™sS‘
 = 0;

1744 
cu¼’tFÏgsCİy
 = 
cu¼’tFÏgs
 & 
eTİLeáOfBlocks
;

1745 
cu¼’tFÏgsCİy
)

1747 ià(
cu¼’tFÏgsCİy
 & 1è
numb”OfB™sS‘
++;

1748 
cu¼’tFÏgsCİy
 >>= 1;

1750 
	`ASSERT
Ğ(
numb”OfB™sS‘
 <= 1) ||

1751 ((
numb”OfB™sS‘
 == 2) &&

1752 (((
cu¼’tFÏgs
 & 
eTİLeáOfBlocks
è& ~(
e21nw
|
e21sw
|
e41ni
|
e41si
))==0)));

1755 ià(
cu¼’tFÏgs
 & 
eTİLeáOfBlocks
)

1758 
ušt32_t
 
pix–
;

1765 ià(
cu¼’tFÏgs
 & 
e22w
)

1767 
pix–
 = 
	`g‘4Pix–
(
rowA
, 
rowIndex
);

1769 
	`put4Pix–
(
rowB
, 
rowIndex
, 
pix–
);

1770 
rowIndex
 += 1;

1771 
	`put4Pix–
(
rowA
, 
rowIndex
, 
pix–
);

1772 
	`put4Pix–
(
rowB
, 
rowIndex
, 
pix–
);

1774 
rowIndex
 += 1;

1778 ià(
cu¼’tFÏgs
 & 
e12
)

1780 
	`put4Pix–
(
rowB
, 
rowIndex
, 
	`g‘4Pix–
(
rowA
,„owIndex));

1782 
rowIndex
 += 1;

1786 ià(
cu¼’tFÏgs
 & 
e42i
)

1788 
pix–
 = 
	`g‘4Pix–
(
rowA
, 
rowIndex
);

1790 
	`put4Pix–
(
rowB
, 
rowIndex
, 
pix–
);

1792 
rowIndex
 += 1;

1793 
	`put4Pix–
(
rowA
, 
rowIndex
, 
pix–
);

1794 
	`put4Pix–
(
rowB
, 
rowIndex
, 
pix–
);

1796 
rowIndex
 += 1;

1797 
	`put4Pix–
(
rowB
, 
rowIndex
, 
pix–
);

1798 
	`put4Pix–
(
rowA
, 
rowIndex
, 
pix–
);

1800 
rowIndex
 += 1;

1801 
	`put4Pix–
(
rowA
, 
rowIndex
, 
pix–
);

1802 
	`put4Pix–
(
rowB
, 
rowIndex
, 
pix–
);

1804 
rowIndex
 += 1;

1808 ià(
cu¼’tFÏgs
 & 
e84ni
)

1810 
pix–
 = 
	`g‘4Pix–
(
rowA
, 
rowIndex
);

1812 
	`put4Pix–
(
row2PŒ
, 
rowIndex
, 
pix–
);

1813 
	`put4Pix–
(
row3PŒ
, 
rowIndex
, 
pix–
);

1814 
	`put4Pix–
(
row4PŒ
, 
rowIndex
, 
pix–
);

1816 
rowIndex
 += 1;

1817 
	`put4Pix–
(
row1PŒ
, 
rowIndex
, 
pix–
);

1818 
	`put4Pix–
(
row2PŒ
, 
rowIndex
, 
pix–
);

1819 
	`put4Pix–
(
row3PŒ
, 
rowIndex
, 
pix–
);

1820 
	`put4Pix–
(
row4PŒ
, 
rowIndex
, 
pix–
);

1822 
rowIndex
 += 1;

1823 
	`put4Pix–
(
row1PŒ
, 
rowIndex
, 
pix–
);

1824 
	`put4Pix–
(
row2PŒ
, 
rowIndex
, 
pix–
);

1825 
	`put4Pix–
(
row3PŒ
, 
rowIndex
, 
pix–
);

1826 
	`put4Pix–
(
row4PŒ
, 
rowIndex
, 
pix–
);

1828 
rowIndex
 += 1;

1829 
	`put4Pix–
(
row1PŒ
, 
rowIndex
, 
pix–
);

1830 
	`put4Pix–
(
row2PŒ
, 
rowIndex
, 
pix–
);

1831 
	`put4Pix–
(
row3PŒ
, 
rowIndex
, 
pix–
);

1832 
	`put4Pix–
(
row4PŒ
, 
rowIndex
, 
pix–
);

1834 
rowIndex
 += 1;

1835 
	`put4Pix–
(
row1PŒ
, 
rowIndex
, 
pix–
);

1836 
	`put4Pix–
(
row2PŒ
, 
rowIndex
, 
pix–
);

1837 
	`put4Pix–
(
row3PŒ
, 
rowIndex
, 
pix–
);

1838 
	`put4Pix–
(
row4PŒ
, 
rowIndex
, 
pix–
);

1840 
rowIndex
 += 1;

1841 
	`put4Pix–
(
row1PŒ
, 
rowIndex
, 
pix–
);

1842 
	`put4Pix–
(
row2PŒ
, 
rowIndex
, 
pix–
);

1843 
	`put4Pix–
(
row3PŒ
, 
rowIndex
, 
pix–
);

1844 
	`put4Pix–
(
row4PŒ
, 
rowIndex
, 
pix–
);

1846 
rowIndex
 += 1;

1847 
	`put4Pix–
(
row1PŒ
, 
rowIndex
, 
pix–
);

1848 
	`put4Pix–
(
row2PŒ
, 
rowIndex
, 
pix–
);

1849 
	`put4Pix–
(
row3PŒ
, 
rowIndex
, 
pix–
);

1850 
	`put4Pix–
(
row4PŒ
, 
rowIndex
, 
pix–
);

1852 
rowIndex
 += 1;

1853 
	`put4Pix–
(
row1PŒ
, 
rowIndex
, 
pix–
);

1854 
	`put4Pix–
(
row2PŒ
, 
rowIndex
, 
pix–
);

1855 
	`put4Pix–
(
row3PŒ
, 
rowIndex
, 
pix–
);

1856 
	`put4Pix–
(
row4PŒ
, 
rowIndex
, 
pix–
);

1858 
rowIndex
 += 1;

1863 ià(
cu¼’tFÏgs
 & 
e24nw
)

1865 
pix–
 = 
	`g‘4Pix–
(
row1PŒ
, 
rowIndex
);

1867 
	`put4Pix–
(
row2PŒ
, 
rowIndex
, 
pix–
);

1868 
	`put4Pix–
(
row3PŒ
, 
rowIndex
, 
pix–
);

1869 
	`put4Pix–
(
row4PŒ
, 
rowIndex
, 
pix–
);

1871 
rowIndex
 += 1;

1872 
	`put4Pix–
(
row1PŒ
, 
rowIndex
, 
pix–
);

1873 
	`put4Pix–
(
row2PŒ
, 
rowIndex
, 
pix–
);

1874 
	`put4Pix–
(
row3PŒ
, 
rowIndex
, 
pix–
);

1875 
	`put4Pix–
(
row4PŒ
, 
rowIndex
, 
pix–
);

1877 
rowIndex
 += 1;

1881 ià(
cu¼’tFÏgs
 & 
e44ni
)

1883 
pix–
 = 
	`g‘4Pix–
(
row1PŒ
, 
rowIndex
);

1885 
	`put4Pix–
(
row2PŒ
, 
rowIndex
, 
pix–
);

1886 
	`put4Pix–
(
row3PŒ
, 
rowIndex
, 
pix–
);

1887 
	`put4Pix–
(
row4PŒ
, 
rowIndex
, 
pix–
);

1889 
rowIndex
 += 1;

1890 
	`put4Pix–
(
row1PŒ
, 
rowIndex
, 
pix–
);

1891 
	`put4Pix–
(
row2PŒ
, 
rowIndex
, 
pix–
);

1892 
	`put4Pix–
(
row3PŒ
, 
rowIndex
, 
pix–
);

1893 
	`put4Pix–
(
row4PŒ
, 
rowIndex
, 
pix–
);

1895 
rowIndex
 += 1;

1896 
	`put4Pix–
(
row1PŒ
, 
rowIndex
, 
pix–
);

1897 
	`put4Pix–
(
row2PŒ
, 
rowIndex
, 
pix–
);

1898 
	`put4Pix–
(
row3PŒ
, 
rowIndex
, 
pix–
);

1899 
	`put4Pix–
(
row4PŒ
, 
rowIndex
, 
pix–
);

1901 
rowIndex
 += 1;

1902 
	`put4Pix–
(
row1PŒ
, 
rowIndex
, 
pix–
);

1903 
	`put4Pix–
(
row2PŒ
, 
rowIndex
, 
pix–
);

1904 
	`put4Pix–
(
row3PŒ
, 
rowIndex
, 
pix–
);

1905 
	`put4Pix–
(
row4PŒ
, 
rowIndex
, 
pix–
);

1907 
rowIndex
 += 1;

1911 ià(
cu¼’tFÏgs
 & 
e14n
)

1913 
pix–
 = 
	`g‘4Pix–
(
row1PŒ
, 
rowIndex
);

1915 
	`put4Pix–
(
row2PŒ
, 
rowIndex
, 
pix–
);

1916 
	`put4Pix–
(
row3PŒ
, 
rowIndex
, 
pix–
);

1917 
	`put4Pix–
(
row4PŒ
, 
rowIndex
, 
pix–
);

1919 
rowIndex
 += 1;

1923 ià(
cu¼’tFÏgs
 & 
e21nw
)

1925 
	`put4Pix–
(
rowA
, 
rowIndex
+1, 
	`g‘4Pix–
(rowA,„owIndex));

1927 ià(!(
cu¼’tFÏgs
 & (
e21sw
|
e41si
)))

1929 
rowIndex
 += 2;

1934 ià(
cu¼’tFÏgs
 & 
e41ni
)

1936 
pix–
 = 
	`g‘4Pix–
(
rowA
, 
rowIndex
);

1938 
	`put4Pix–
(
rowA
, 
rowIndex
+1, 
pix–
);

1939 
	`put4Pix–
(
rowA
, 
rowIndex
+2, 
pix–
);

1940 
	`put4Pix–
(
rowA
, 
rowIndex
+3, 
pix–
);

1942 ià(!(
cu¼’tFÏgs
 & (
e21sw
|
e41si
)))

1944 
rowIndex
 += 2;

1949 ià(
cu¼’tFÏgs
 & 
e21sw
)

1951 
	`put4Pix–
(
rowB
, 
rowIndex
+1, 
	`g‘4Pix–
(rowB,„owIndex));

1953 
rowIndex
 += 2;

1957 ià(
cu¼’tFÏgs
 & 
e41si
)

1959 
pix–
 = 
	`g‘4Pix–
(
rowB
, 
rowIndex
);

1961 
	`put4Pix–
(
rowB
, 
rowIndex
+1, 
pix–
);

1962 
	`put4Pix–
(
rowB
, 
rowIndex
+2, 
pix–
);

1963 
	`put4Pix–
(
rowB
, 
rowIndex
+3, 
pix–
);

1965 
rowIndex
 += 2;

1969 
rowIndex
 += 1;

1972 
	}
}

1976 
boŞ
 
	gEº›F‹r
::
	$Proûss
 (
RASTERDATA
* 
ImageD©a
)

1978 iàĞ
ImageD©a
 =ğ
NULL
 ||

1979 (
ImageD©a
->
¿¡”d©a
[
COLORTYPE_COLOR
] =ğ
NULL
 && ImageD©a->¿¡”d©a[
COLORTYPE_BLACK
] == NULL))

1981  
çl£
;

1983 ià(
ImageD©a
->
¿¡”d©a
[
COLORTYPE_BLACK
])

1985 
	`memıy
(
m_bÏck_row_±rs
[
m_row_šdex
], 
ImageD©a
->
¿¡”d©a
[
COLORTYPE_BLACK
],

1986 (
ImageD©a
->
¿¡”size
[
COLORTYPE_BLACK
] + 7) / 8);

1988 
m_bÏck_¿¡”_sizes
[
m_row_šdex
++] = 
ImageD©a
->
¿¡”size
[
COLORTYPE_BLACK
];

1990 ià(
m_row_šdex
 == 4)

1991 
m_row_šdex
 = 0;

1992 ià(
ImageD©a
->
¿¡”d©a
[
COLORTYPE_COLOR
])

1994 
	`subm™RowToF‹r
(
ImageD©a
->
¿¡”d©a
[
COLORTYPE_COLOR
]);

1997  (
m_bufã»d_row_couÁ
 == 0);

1999 
iRa¡”sR—dy
 = 1;

2000  
Œue
;

2001 
	}
}

2003 
boŞ
 
	gEº›F‹r
::
	$NextOuutRa¡”
(
RASTERDATA
& 
Ãxt_¿¡”
)

2005 ià(
iRa¡”sR—dy
 == 0){

2006  
çl£
;

2009 
Ãxt_¿¡”
.
¿¡”size
[
COLORTYPE_COLOR
] = 
m_row_width_š_pix–s
 * 
m_šput_by‹s_³r_pix–
;

2010 
Ãxt_¿¡”
.
¿¡”d©a
[
COLORTYPE_COLOR
] = 
m_row_±rs
[
iRa¡”sD–iv”ed
];

2011 
Ãxt_¿¡”
.
¿¡”size
[
COLORTYPE_BLACK
] = 
m_bÏck_¿¡”_sizes
[
iRa¡”sD–iv”ed
];

2012 iàĞ
m_bÏck_¿¡”_sizes
[
iRa¡”sD–iv”ed
] > 0 ){

2013 
Ãxt_¿¡”
.
¿¡”d©a
[
COLORTYPE_BLACK
] = 
m_bÏck_row_±rs
[
iRa¡”sD–iv”ed
];

2015 
Ãxt_¿¡”
.
¿¡”d©a
[
COLORTYPE_BLACK
] = 
NULL
;

2017 
iRa¡”sR—dy
--;

2018 
iRa¡”sD–iv”ed
++;

2019 ià(
iRa¡”sD–iv”ed
 == 4) iRastersDelivered = 0;

2020  
Œue
;

2021 
	}
}

2023 
	gEº›F‹r
::
	$G‘MaxOuutWidth
()

2025  
m_row_width_š_pix–s
 * 
m_šput_by‹s_³r_pix–
;

2026 
	}
}

2028 
	gEº›F‹r
::
	$Flush
()

2030 
	`wr™eBufã»dRows
();

2031 
iRa¡”sD–iv”ed
=0;

2032 
m_pix–_off£ts_šdex
 = 0;

2033 
iRa¡”sR—dy
 = 
m_bufã»d_row_couÁ
;

2034 
m_bufã»d_row_couÁ
 = 0;

2035 
m_row_šdex
 = 0;

2036 
	}
}

	@prnt/hpcups/ErnieFilter.h

38 #iâdeà
ERNIEFILTER_H


39 
	#ERNIEFILTER_H


	)

41 
	~"CommÚDefš™iÚs.h
"

42 
	~"ProûssÜ.h
"

53 
	#kG©h”Sts
 0

	)

54 
	#kDecom´essSts
 0

	)

56 
	eeBlockTy³


58 
	meDÚe
 = 0x0,

59 
	me11n
 = 0x00000001,

60 
	me11s
 = 0x00000002,

61 
	me12
 = 0x00000004,

62 
	me14n
 = 0x00000008,

63 
	me14s
 = 0x00000010,

64 
	me21nw
 = 0x00000020,

65 
	me21Ã
 = 0x00000040,

66 
	me21sw
 = 0x00000080,

67 
	me21£
 = 0x00000100,

68 
	me22w
 = 0x00000200,

69 
	me22e
 = 0x00000400,

70 
	me24nw
 = 0x00000800,

71 
	me24Ã
 = 0x00001000,

72 
	me24sw
 = 0x00002000,

73 
	me24£
 = 0x00004000,

74 
	me41ni
 = 0x00008000,

75 
	me41n
 = 0x00010000,

76 
	me41si
 = 0x00020000,

77 
	me41s
 = 0x00040000,

78 
	me42i
 = 0x00080000,

79 
	me42
 = 0x00100000,

80 
	me44ni
 = 0x00200000,

81 
	me44n
 = 0x00400000,

82 
	me44si
 = 0x00800000,

83 
	me44s
 = 0x01000000,

84 
	me84ni
 = 0x02000000,

85 
	me84n
 = 0x04000000,

86 
	me84si
 = 0x08000000,

87 
	me84s
 = 0x10000000,

89 
	meNÜths
 = 
e11n
 | 
e21nw
 | 
e21Ã
 | 
e41ni
 | 
e41n
,

90 
	meSouths
 = 
e11s
 | 
e21sw
 | 
e21£
 | 
e41si
 | 
e41s
,

91 
	meTheRe¡
 = ~(
eNÜths
|
eSouths
),

93 
	meTİLeáOfBlocks
 = 
e12
 | 
e14n
 | 
e21nw
 | 
e21sw
 | 
e22w
 | 
e24nw
 | 
e41ni
 | 
e41si
 | 
e42i
 | 
e44ni
 | 
e84ni


96 
	#isOdd
(
x
è(x & 0x01)

	)

97 
	#isWh™e
(
x
è(((xè& 
kWh™e
è=ğkWh™e)

	)

99 
	#kMemWr™esO±imize
 1

100 

	)

105 #ià
kG©h”Sts
 == 1

111 
	eSti¡icBlocks


113 
	mes11n
 = 0,

114 
	mes11s
,

115 
	mes12
,

116 
	mes14n
,

117 
	mes14s
,

118 
	mes21nw
,

119 
	mes21Ã
,

120 
	mes21sw
,

121 
	mes21£
,

122 
	mes22w
,

123 
	mes22e
,

124 
	mes24nw
,

125 
	mes24Ã
,

126 
	mes24sw
,

127 
	mes24£
,

128 
	mes41ni
,

129 
	mes41n
,

130 
	mes41si
,

131 
	mes41s
,

132 
	mes42i
,

133 
	mes42
,

134 
	mes44ni
,

135 
	mes44n
,

136 
	mes44si
,

137 
	mes44s
,

138 
	mes84ni
,

139 
	mes84n
,

140 
	mes84si
,

141 
	mes84s
,

143 
	mesDÚeSt
,

144 
	mesWh™eFound
,

146 
	meLa¡Av”agšgFÏgPos™iÚ


151 
	epix–Ty³s


153 
	meBGRPix–D©a
 = 0

156 şas 
	cEº›F‹r
 : 
public
 
ProûssÜ


158 
public
:

159 
Eº›F‹r
(
rowWidthInPix–s
, 
pix–Ty³s
 
pix–Ty³
, 
maxE¼ÜFÜTwoPix–s
);

160 
	mvœtu®
 ~
Eº›F‹r
();

163 
boŞ
 
Proûss
(
RASTERDATA
* 
IÅutRa¡”
=
NULL
);

164 
Flush
();

165 
G‘MaxOuutWidth
();

166 
boŞ
 
NextOuutRa¡”
(
RASTERDATA
& 
Ãxt_¿¡”
);

169 
	m´iv©e
:

170 
ušt32_t
 *
m_row_bufs
[4];

171 *
	mm_row_±rs
[4];

172 
BYTE
 *
	mm_bÏck_row_±rs
[4];

173 
	mm_bÏck_¿¡”_sizes
[4];

174 *
	mm_com´essiÚ_out_buf
;

175 *
	mm_pix–_f‹»d_æags
[2];

177 
	mm_bufã»d_row_couÁ
;

178 
	mm_pix–_off£ts
[8];

179 
	mm_pix–_off£ts_šdex
;

180 
	mm_row_width_š_pix–s
;

181 
	mm_row_width_š_by‹s
;

182 
	mm_š‹º®_by‹s_³r_pix–
;

183 
	mm_šput_by‹s_³r_pix–
;

184 
	mm_max_”rÜ_fÜ_two_pix–s
;

185 
	mm_row_šdex
;

187 
subm™RowToF‹r
(*
rowPŒ
);

188 
wr™eBufã»dRows
();

189 
F‹r1RawRow
(*
cu¼PŒ
, 
rowWidthInPix–s
, *
æagsPŒ
);

190 
F‹r2RawRows
(*
cu¼PŒ
, *
upPŒ
, 
rowWidthInPix–s
, *
æagsPŒ
);

191 
F‹r2PaœsOfF‹»dRows
(*
row1PŒ
, *
row2PŒ
, *
row3PŒ
, *
row4PŒ
);

192 
F‹r3F‹»dRows
(*
row1PŒ
, *
row2PŒ
, *
row3PŒ
);

193 
šlše
 
D–E
(
dr0
, 
dr1
, 
dg0
, 
dg1
, 
db0
, 
db1
);

194 
šlše
 
boŞ
 
NewD–E
(
dr0
, 
dr1
, 
dg0
, 
dg1
, 
db0
, 
db1
, 
tŞ”ªû
);

195 
šlše
 
G¿dD–E
(
dr
, 
dg
, 
db
);

197 #ià
kMemWr™esO±imize
 == 1

198 
Wr™eBlockPix–s
();

203 
	meBufã»dPix–WidthInBy‹s
 = 4

206 
ENDIAN_TYPE
 
	gm_eEndŸn
;

208 
šlše
 
ušt32_t
 
	$g‘4Pix–
(*
pixAdd»ss
)

210 #ifdeà
APDK_LITTLE_ENDIAN


211  (((*)
pixAdd»ss
)[0]è& 
kWh™e
;

213  (((*)
pixAdd»ss
)[0]) & 0xFFFFFF00;

215 
	}
}

217 
šlše
 
ušt32_t
 
	$g‘4Pix–
(*
pixAdd»ss
, 
pix–Off£t
)

219 #ifdeà
APDK_LITTLE_ENDIAN


220  *(((*)
pixAdd»ss
)+
pix–Off£t
è& 
kWh™e
;

222  *(((*)
pixAdd»ss
)+
pix–Off£t
) & 0xFFFFFF00;

224 
	}
}

226 
šlše
 
	$put4Pix–
(*
pixAdd»ss
, 
pix–Off£t
, 
ušt32_t
 
pix–
)

228 #ifdeà
APDK_LITTLE_ENDIAN


229 *(((*)
pixAdd»ss
)+
pix–Off£t
èğ
pix–
 & 
kWh™e
;

231 *(((*)
pixAdd»ss
)+
pix–Off£t
èğ
pix–
 & 0xFFFFFF00;

233 
	}
}

	@prnt/hpcups/HPCupsFilter.cpp

33 
	~"HPCupsF‹r.h
"

34 
	~"ImageProûssÜ.h
"

36 
	~<sigÇl.h
>

37 
	~<sys/wa™.h
>

38 
	~<sys/ut¢ame.h
>

39 
	~<time.h
>

40 
	~"uts.h
"

42 
	#HP_FILE_VERSION_STR
 "03.09.08.0"

	)

44 
HPCupsF‹r
 
	gf‹r
;

47 #iâdeà
UNITTESTING


48 
	$maš
 (
¬gc
, *
¬gv
[])

50 
	`İ’log
("hpcups", 
LOG_PID
, 
LOG_DAEMON
);

52 ià(
¬gc
 < 6 ||‡rgc > 7) {

53 
	`dbglog
("ERROR: % job-id u£¸t™Ë cİ› İtiÚ [fe]\n", *
¬gv
);

54  
JOB_CANCELED
;

57  
f‹r
.
	`S¹PrštJob
(
¬gc
, 
¬gv
);

58 
	}
}

61 
	$HPCªûlJob
(
sig
)

63 
f‹r
.
	`CªûlJob
();

64 
	`ex™
(0);

65 
	}
}

67 
	gHPCupsF‹r
::
	$C»©eBMPH—d”
 (
width
, 
height
, 
¶ªes
, 
bµ
)

69 
	`mem£t
 (&
this
->
bmfh
, 0, 14);

70 
	`mem£t
 (&
this
->
bmih
, 0, 40);

71 
bmfh
.
bfOffB™s
 = 54;

72 
bmfh
.
bfTy³
 = 0x4d42;

73 
bmfh
.
bfRe£rved1
 = 0;

74 
bmfh
.
bfRe£rved2
 = 0;

75 
bmih
.
biSize
 = 
DBITMAPINFOHEADER
;

76 
bmih
.
biWidth
 = 
width
;

77 
bmih
.
biHeight
 = -
height
;

78 
bmih
.
biPÏÃs
 = 1;

79 
bmih
.
biB™CouÁ
 = 
¶ªes
 * 
bµ
;

80 
bmih
.
biCom´essiÚ
 = 0;

81 
bmih
.
biSizeImage
 = 
width
 * 
height
 * 
¶ªes
 * 
bµ
 / 8;

82 
bmih
.
biCÌImpÜÁ
 = 0;

83 
bmih
.
biCÌU£d
 = (
¶ªes
 == 3) ? 0 : 2;

84 
bmih
.
biXP–sP”M‘”
 = 0;

85 
bmih
.
biYP–sP”M‘”
 = 0;

87 
bmfh
.
bfOffB™s
 +ğ
bmih
.
biCÌU£d
 * 4;

88 
bmfh
.
bfSize
 = 
bmih
.
biSizeImage
 + bmfh.
bfOffB™s
;

89 
	}
}

91 
	gHPCupsF‹r
::
	$Wr™eBMPH—d”
 (
FILE
 *
å
, 
width
, 
height
, 
eRa¡”Ty³
 
¿¡”_ty³
)

93 ià(
å
 =ğ
NULL
)

96 ià(
¿¡”_ty³
 =ğ
BLACK_RASTER
) {

97 
	`Wr™eKBMPH—d”
 (
å
, 
width
, 
height
);

99 
	`Wr™eCBMPH—d”
 (
å
, 
width
, 
height
);

101 
	}
}

103 
	gHPCupsF‹r
::
	$Wr™eCBMPH—d”
 (
FILE
 *
å
, 
width
, 
height
)

105 ià(
å
 =ğ
NULL
)

108 
adj_c_width
 = 
width
;

109 ià(
width
 % 4)

111 
adj_c_width
 = (
width
 / 4 + 1) * 4;

113 
cŞÜ_¿¡”
 = 
Ãw
 
BYTE
[
adj_c_width
 * 3];

114 
	`mem£t
 (
cŞÜ_¿¡”
, 0xFF, 
adj_c_width
 * 3);

115 
	`C»©eBMPH—d”
(
adj_c_width
, 
height
, 3, 8);

116 
	`fwr™e
 (&
this
->
bmfh
.
bfTy³
, 1,  (), 
å
);

117 
	`fwr™e
 (&
this
->
bmfh
.
bfSize
, 1,  (), 
å
);

118 
	`fwr™e
 (&
this
->
bmfh
.
bfRe£rved1
, 1,  (), 
å
);

119 
	`fwr™e
 (&
this
->
bmfh
.
bfRe£rved2
, 1,  (), 
å
);

120 
	`fwr™e
 (&
this
->
bmfh
.
bfOffB™s
, 1,  (), 
å
);

121 
	`fwr™e
 (&
this
->
bmih
, 1, 
DBITMAPINFOHEADER
, 
å
);

122 
	}
}

124 
	gHPCupsF‹r
::
	$Wr™eKBMPH—d”
(
FILE
 *
å
, 
width
, 
height
)

126 
BYTE
 
cm­
[8];

128 ià(
å
 =ğ
NULL
)

131 
adj_k_width
 = 
width
;

132 ià(
width
 % 32)

134 
adj_k_width
 = (
width
 / 32 + 1) * 32;

137 
	`C»©eBMPH—d”
(
adj_k_width
, 
height
, 1, 1);

138 
adj_k_width
 /= 8;

139 
bÏck_¿¡”
 = 
Ãw
 
BYTE
[
adj_k_width
];

140 
	`mem£t
 (
bÏck_¿¡”
, 0, 
adj_k_width
);

142 
	`fwr™e
 (&
this
->
bmfh
.
bfTy³
, 1,  (), 
å
);

143 
	`fwr™e
 (&
this
->
bmfh
.
bfSize
, 1,  (), 
å
);

144 
	`fwr™e
 (&
this
->
bmfh
.
bfRe£rved1
, 1,  (), 
å
);

145 
	`fwr™e
 (&
this
->
bmfh
.
bfRe£rved2
, 1,  (), 
å
);

146 
	`fwr™e
 (&
this
->
bmfh
.
bfOffB™s
, 1,  (), 
å
);

147 
	`fwr™e
 (&
this
->
bmih
, 1, 
DBITMAPINFOHEADER
, 
å
);

148 
	`mem£t
(
cm­
, 0, (cmap));

149 
cm­
[0] = cmap[1] = cmap[2] = cmap[3] = 255;

150 
	`fwr™e
(
cm­
, 1, (cm­), 
å
);

151 
	}
}

153 
	gHPCupsF‹r
::
	$Wr™eBMPRa¡”
 (
FILE
 *
å
, 
BYTE
 *
¿¡”
, 
width
, 
eRa¡”Ty³
 
¿¡”_ty³
)

155 ià(
å
 =ğ
NULL
)

158 ià(
¿¡”_ty³
 =ğ
BLACK_RASTER
) {

159  
	`Wr™eKBMPRa¡”
 (
å
, 
¿¡”
, 
width
);

161  
	`Wr™eCBMPRa¡”
 (
å
, 
¿¡”
, 
width
);

163 
	}
}

165 
	gHPCupsF‹r
::
	$Wr™eCBMPRa¡”
 (
FILE
 *
å
, 
BYTE
 *
pbyrgb
, 
width
)

167 ià(
å
 =ğ
NULL
)

171 
i
;

172 
BYTE
 *
p
 = 
pbyrgb
;

173 
BYTE
 *
q
 = 
cŞÜ_¿¡”
;

174 ià(
pbyrgb
 =ğ
NULL
) {

175 
	`mem£t
 (
cŞÜ_¿¡”
, 0xFF, 
adj_c_width
 * 3);

177 
i
 = 0; i < 
width
; i++) {

178 
q
[0] = 
p
[2];

179 
q
[1] = 
p
[1];

180 
q
[2] = 
p
[0];

181 
p
 += 3;

182 
q
 += 3;

186 
	`fwr™e
 (
cŞÜ_¿¡”
, 1, 
adj_c_width
 * 3, 
å
);

187 
	}
}

189 
	gHPCupsF‹r
::
	$Wr™eKBMPRa¡”
 (
FILE
 *
å
, 
BYTE
 *
pbyk
, 
width
)

191 ià(
å
 =ğ
NULL
)

194 ià(
pbyk
 =ğ
NULL
) {

195 
	`mem£t
 (
bÏck_¿¡”
, 0, 
adj_k_width
);

197 
	`memıy
 (
bÏck_¿¡”
, 
pbyk
, 
width
);

200 
	`fwr™e
 (
bÏck_¿¡”
, 1, 
adj_k_width
, 
å
);

201 
	}
}

203 
	gHPCupsF‹r
::
	$HPCupsF‹r
(è: 
	$m_pPrš‹rBufãr
(
NULL
)

205 
	`£tbuf
 (
¡d”r
, 
NULL
);

207 
adj_c_width
 = 0;

208 
adj_k_width
 = 0;

209 
bÏck_¿¡”
 = 
NULL
;

210 
cŞÜ_¿¡”
 = 
NULL
;

211 
	}
}

213 
	gHPCupsF‹r
::~
	$HPCupsF‹r
()

215 
	}
}

217 
HPCupsF‹r
::
	$şo£F‹r
 ()

220 
m_Job
.
	`CËªup
();

221 
	`ş—nup
();

222 
	}
}

224 
	gHPCupsF‹r
::
	$ş—nup
()

226 ià(
m_pPrš‹rBufãr
) {

227 
d–‘e
 [] 
m_pPrš‹rBufãr
;

228 
m_pPrš‹rBufãr
 = 
NULL
;

231 if(
m_µd
){

232 
	`µdClo£
(
m_µd
);

233 
m_µd
 = 
NULL
;

235 ià(
m_pSys
)

237 
d–‘e
 
m_pSys
;

238 
m_pSys
 = 
NULL
;

240 
	}
}

242 
	gHPCupsF‹r
::
	$CªûlJob
()

244 
m_Job
.
	`CªûlJob
();

245 
	`ş—nup
();

246 
	}
}

248 
DRIVER_ERROR
 
	gHPCupsF‹r
::
	$¡¬tPage
 (
cups_·ge_h—d”2_t
 *
cups_h—d”
)

250 
DRIVER_ERROR
 
”r
 = 
NO_ERROR
;

251 
µd_©Œ_t
 *
©Œ
;

252 
xov”¥¿y
 = 120;

253 
yov”¥¿y
 = 60;

258 ià(
cups_h—d”
->
HWResŞutiÚ
[0] == 100 && cups_header->HWResolution[1] == 100)

266 
	`dbglog
("ERROR: Unsupported„esolution\n");

267  
JOB_CANCELED
;

272 ià(((
©Œ
 = 
	`µdFšdA‰r
(
m_µd
, "HPXOv”S´ay", 
NULL
)) != NULL) &&

273 (
©Œ
 &&‡‰r->
v®ue
 !ğ
NULL
)) {

274 
xov”¥¿y
 = 
	`©oi
(
©Œ
->
v®ue
);

276 ià(((
©Œ
 = 
	`µdFšdA‰r
(
m_µd
, "HPYOv”S´ay", 
NULL
)) != NULL) &&

277 (
©Œ
 &&‡‰r->
v®ue
 !ğ
NULL
)) {

278 
yov”¥¿y
 = 
	`©oi
(
©Œ
->
v®ue
);

281 ià(
m_iLogLev–
 & 
BASIC_LOG
) {

282 
	`´štCupsH—d”Info
(
cups_h—d”
);

285 
m_JA
.
qu®™y_©Œibu‹s
.
medŸ_ty³
 = 
cups_h—d”
->
cupsMedŸTy³
;

286 
m_JA
.
qu®™y_©Œibu‹s
.
´št_qu®™y
 = 
	`©oi
(
cups_h—d”
->
OuutTy³
);

287 
m_JA
.
qu®™y_©Œibu‹s
.
hÜizÚl_»sŞutiÚ
 = 
cups_h—d”
->
HWResŞutiÚ
[0];

288 
m_JA
.
qu®™y_©Œibu‹s
.
v”tiÿl_»sŞutiÚ
 = 
cups_h—d”
->
HWResŞutiÚ
[1];

289 
m_JA
.
qu®™y_©Œibu‹s
.
aùu®_v”tiÿl_»sŞutiÚ
 = 
cups_h—d”
->
HWResŞutiÚ
[1];

292 *
p
;

293 ià((
p
 = 
	`¡r¡r
 (
cups_h—d”
->
OuutTy³
, "_"))) {

294 
x
 = 0, 
y
 = 0;

295 
p
++;

296 
x
 = 
	`©oi
(
p
);

297 *
p
 && *p != 'x')

298 
p
++;

299 ià(*
p
 && *p == 'x') {

300 
p
++;

301 
y
 = 
	`©oi
(
p
);

304 ià(
y
 != 0) {

305 
m_JA
.
qu®™y_©Œibu‹s
.
aùu®_v”tiÿl_»sŞutiÚ
 = 
y
;

308 
m_JA
.
cŞÜ_mode
 = 
cups_h—d”
->
cupsRowS‹p
;

309 
m_JA
.
medŸ_sourû
 = 
cups_h—d”
->
MedŸPos™iÚ
;

311 
m_JA
.
´št_bÜd”Ëss
 = (
cups_h—d”
->
ImagšgBoundšgBox
[0] =ğ0è? 
Œue
 : 
çl£
;

312 ià(
cups_h—d”
->
Du¶ex
) {

313 
m_JA
.
e_du¶ex_mode
 = (
cups_h—d”
->
TumbË
 =ğ0è? 
DUPLEXMODE_BOOK
 : 
DUPLEXMODE_TABLET
;

316 
m_JA
.
e_du¶ex_mode
 = 
DUPLEXMODE_NONE
;

318 
m_JA
.
krgb_mode
 = (
cups_h—d”
->
cupsCŞÜS·û
 =ğ
CUPS_CSPACE_RGBW
è? 
Œue
 : 
çl£
;

335 
hÜz_»s
 = 
cups_h—d”
->
HWResŞutiÚ
[0];

336 
v”t_»s
 = 
cups_h—d”
->
HWResŞutiÚ
[1];

337 
m_JA
.
medŸ_©Œibu‹s
.
pş_id
 = 
cups_h—d”
->
cupsIÁeg”
[0];

338 
m_JA
.
medŸ_©Œibu‹s
.
´šbË_¡¬t_x
 = (
cups_h—d”
->
M¬gšs
[0] * 
hÜz_»s
) / 72;

339 
m_JA
.
medŸ_©Œibu‹s
.
´šbË_¡¬t_y
 = ((
cups_h—d”
->
PageSize
[1] - cups_h—d”->
ImagšgBoundšgBox
[3]è* 
v”t_»s
) / 72;

340 
m_JA
.
medŸ_©Œibu‹s
.
hÜizÚl_ov”¥¿y
 = (
xov”¥¿y
 * 
hÜz_»s
) / 1000;

341 
m_JA
.
medŸ_©Œibu‹s
.
v”tiÿl_ov”¥¿y
 = (
yov”¥¿y
 * 
v”t_»s
) / 1000;

347 
m_JA
.
medŸ_©Œibu‹s
.
Ëá_ov”¥¿y
 = 
cups_h—d”
->
cupsR—l
[0] ? (cups_h—d”->cupsR—l[0] * 
hÜz_»s
è: m_JA.medŸ_©Œibu‹s.
hÜizÚl_ov”¥¿y
 / 2;

348 
m_JA
.
medŸ_©Œibu‹s
.
tİ_ov”¥¿y
 = 
cups_h—d”
->
cupsR—l
[1] ? (cups_h—d”->cupsR—l[1] * 
v”t_»s
è: m_JA.medŸ_©Œibu‹s.
v”tiÿl_ov”¥¿y
 / 2;

350 ià(((
©Œ
 = 
	`µdFšdA‰r
(
m_µd
, "HPMechOff£t", 
NULL
)) != NULL) &&

351 (
©Œ
 &&‡‰r->
v®ue
 !ğ
NULL
)) {

352 
m_JA
.
mech_off£t
 = 
	`©oi
(
©Œ
->
v®ue
);

355 if(
cups_h—d”
->
PageSize
[0] > 612)

358 ià(((
©Œ
 = 
	`µdFšdA‰r
(
m_µd
, "HPMechOff£tBSize", 
NULL
)è!ğNULLè&& (©Œ &&‡‰r->
v®ue
 != NULL))

360 
m_JA
.
mech_off£t
 = 
	`©oi
(
©Œ
->
v®ue
);

366 ià(((
©Œ
 = 
	`µdFšdA‰r
(
m_µd
, "hpPrš‹rPÏtfÜm", 
NULL
)è!ğNULLè&& (©Œ->
v®ue
 != NULL)) {

368 
	`¡ºıy
(
m_JA
.
´š‹r_¶©fÜm
, 
©Œ
->
v®ue
, (m_JA.printer_platform)-1);

370 ià(
m_iLogLev–
 & 
BASIC_LOG
) {

371 
	`dbglog
("HPCUPS: found Prš‹¸PÏtfÜm, iˆi - %s\n", 
©Œ
->
v®ue
);

374 ià(
	`¡rcmp
(
m_JA
.
´š‹r_¶©fÜm
, "ljzjscolor") == 0) {

375 ià(((
©Œ
 = 
	`µdFšdA‰r
(
m_µd
, "hpLJZjsCŞÜV”siÚ", 
NULL
)) != NULL) &&

376 (
©Œ
->
v®ue
 !ğ
NULL
))

378 
m_JA
.
´š‹r_¶©fÜm_v”siÚ
 = 
	`©oi
(
©Œ
->
v®ue
);

384 ià(((
©Œ
 = 
	`µdFšdA‰r
(
m_µd
, "hpRev”£Ra¡”Pages", 
NULL
)) != NULL) &&

385 (
©Œ
->
v®ue
 !ğ
NULL
))

387 
m_JA
.
´e_´oûss_¿¡”
 = 
	`©oi
(
©Œ
->
v®ue
);

390 ià(((
©Œ
 = 
	`µdFšdA‰r
(
m_µd
, "HPSPDCÏss", 
NULL
)) == NULL) ||

391 (
©Œ
 &&‡‰r->
v®ue
 =ğ
NULL
))

393 
m_JA
.
HPSPDCÏss
 = 0;

397 
m_JA
.
HPSPDCÏss
 = 
	`©oi
(
©Œ
->
v®ue
);

403 ià(((
©Œ
 = 
	`µdFšdA‰r
(
m_µd
, "hpPrš‹rLªguage", 
NULL
)) == NULL) ||

404 (
©Œ
 &&‡‰r->
v®ue
 =ğ
NULL
))

406 
	`dbglog
("DEBUG: Bad PPD - hpPrinterLanguage‚ot found\n");

407 
	`µdClo£
(
m_µd
);

408 
m_µd
 = 
NULL
;

409  
SYSTEM_ERROR
;

411 
	`¡ºıy
(
m_JA
.
´š‹r_Ïnguage
, 
©Œ
->
v®ue
, (m_JA.printer_language)-1);

413 ià(
	`¡rcmp
(
m_JA
.
´š‹r_Ïnguage
, "hbpl1") == 0) {

414 
m_JA
.
medŸ_©Œibu‹s
.
physiÿl_width
 = 
cups_h—d”
->
PageSize
[0];

415 
m_JA
.
medŸ_©Œibu‹s
.
physiÿl_height
 = 
cups_h—d”
->
PageSize
[1];

416 
m_JA
.
medŸ_©Œibu‹s
.
´šbË_width
 = ((
cups_h—d”
->
ImagšgBoundšgBox
[2]-cups_h—d”->ImagšgBoundšgBox[0]è* 
hÜz_»s
) / 72;

417 
m_JA
.
medŸ_©Œibu‹s
.
´šbË_height
 = ((
cups_h—d”
->
ImagšgBoundšgBox
[3]-cups_h—d”->ImagšgBoundšgBox[1]è* 
v”t_»s
) / 72;

418 
	`¡ºıy
(
m_JA
.
medŸ_©Œibu‹s
.
PageSizeName
, &
cups_h—d”
->
cupsSŒšg
[0][0], (m_JA.media_attributes.PageSizeName));

419 
	`¡ºıy
(
m_JA
.
medŸ_©Œibu‹s
.
MedŸTy³Name
, 
cups_h—d”
->
MedŸTy³
, (m_JA.media_attributes.MediaTypeName));

420 
	`¡ºıy
(
m_JA
.
qu®™y_©Œibu‹s
.
hb¶1_´št_qu®™y
, 
cups_h—d”
->
OuutTy³
, (m_JA.quality_attributes.hbpl1_print_quality));

421 
m_JA
.
cŞÜ_mode
 = 
cups_h—d”
->
cupsRowS‹p
;

424 
m_JA
.
medŸ_©Œibu‹s
.
physiÿl_width
 = (
cups_h—d”
->
PageSize
[0] * 
hÜz_»s
) / 72;

425 
m_JA
.
medŸ_©Œibu‹s
.
physiÿl_height
 = (
cups_h—d”
->
PageSize
[1] * 
v”t_»s
) / 72;

426 
m_JA
.
medŸ_©Œibu‹s
.
´šbË_width
 = 
cups_h—d”
->
cupsWidth
;

427 
m_JA
.
medŸ_©Œibu‹s
.
´šbË_height
 = 
cups_h—d”
->
cupsHeight
;

430 ià(
m_iLogLev–
 & 
BASIC_LOG
) {

431 
	`dbglog
("HPCUPS: found Prš‹¸Lªguage, iˆi - %s\n", 
©Œ
->
v®ue
);

436 
ut¢ame
 
uts_Çme
;

437 
	`uÇme
(&
uts_Çme
);

438 
	`¡ºıy
(
m_JA
.
job_t™Ë
, 
m_¬gv
[3], (m_JA.job_title)-1);

439 
	`¡ºıy
(
m_JA
.
u£r_Çme
, 
m_¬gv
[2], (m_JA.user_name)-1);

440 
	`¡ºıy
(
m_JA
.
ho¡_Çme
, 
uts_Çme
.
nod’ame
, (m_JA.host_name)-1);

441 
	`¡ºıy
(
m_JA
.
os_Çme
, 
uts_Çme
.
sy¢ame
, (m_JA.os_name)-1);

442 
	`g‘domašÇme
(
m_JA
.
domaš_Çme
, (m_JA.domain_name) - 1);

443 
i
 = 
	`¡¾’
(
m_¬gv
[0]) - 1;

444 
i
 >ğ0 && 
m_¬gv
[0][i] != '/') {

445 
i
--;

447 
	`¢´štf
(
m_JA
.
driv”_Çme
, (m_JA.driv”_Çme), "%s; %s", &
m_¬gv
[0][
i
+1], 
HP_FILE_VERSION_STR
);

448 *
±r
 = 
	`g‘’v
("DEVICE_URI");

449 
i
 = 0;

450 ià(
±r
) {

451 *
±r
) {

452 ià(*
±r
 == '%') {

453 
±r
 += 3;

454 
m_JA
.
´š‹r_Çme
[
i
++] = ' ';

456 
m_JA
.
´š‹r_Çme
[
i
++] = *
±r
++;

460 
¡ršg
 
¡rPrš‹rURI
="" , 
¡rPrš‹rName
= "";

461 if(!
	`IsChromeOs
()){

462 ià(
	`g‘’v
("DEVICE_URI"))

463 
m_DBusComm
.
	`š™DBusComm
(
DBUS_PATH
,
DBUS_INTERFACE
, 
	`g‘’v
("DEVICE_URI"), 
m_JA
.
´š‹r_Çme
);

466 
±r
 = 
	`¡r¡r
(
m_¬gv
[5], "job-uuid");

467 ià(
±r
) {

468 
	`¡ºıy
(
m_JA
.
uuid
, 
±r
 + 
	`¡¾’
("job-uuid=urn:uuid:"), (m_JA.uuid)-1);

471 
i
 = 0; i < 16; i++)

472 
m_JA
.
š‹g”_v®ues
[
i
] = 
cups_h—d”
->
cupsIÁeg”
[i];

474 ià(
cups_h—d”
->
cupsSŒšg
[0]) {

475 
	`¡ºıy
(
m_JA
.
qu®™y_©Œibu‹s
.
´št_mode_Çme
, &
cups_h—d”
->
cupsSŒšg
[0][0],

476 (
m_JA
.
qu®™y_©Œibu‹s
.
´št_mode_Çme
)-1);

479 
EnÿpsuÏtÜ
 *
’ÿp_š‹rçû
 = 
EnÿpsuÏtÜFaùÜy
::
	`G‘EnÿpsuÏtÜ
(
m_JA
.
´š‹r_Ïnguage
);

481 ià((
”r
 = 
m_Job
.
	`In™
(
m_pSys
, &
m_JA
, 
’ÿp_š‹rçû
)è!ğ
NO_ERROR
)

483 ià(
”r
 =ğ
PLUGIN_LIBRARY_MISSING
)

485 
	`åuts
 ("STATE: +h¶.¶ugš-”rÜ\n", 
¡d”r
);

487 
m_DBusComm
.
	`£ndEv’t
(
EVENT_PRINT_FAILED_MISSING_PLUGIN
, "Plugš missšg", 
m_JA
.
job_id
, m_JA.
u£r_Çme
);

490 
	`dbglog
 ("m_Job in™Ÿliz©iÚ faed w™hƒ¼Ü = %d\n", 
”r
);

491 
	`µdClo£
(
m_µd
);

492 
m_µd
 = 
NULL
;

493  
”r
;

496 ià(
m_iLogLev–
 & 
BASIC_LOG
) {

497 
	`dbglog
("HPCUPS:„eturning NO_ERROR from startPage\n");

500 
m_pPrš‹rBufãr
 = 
Ãw
 
BYTE
[
cups_h—d”
->
cupsWidth
 * 4 + 32];

502  
NO_ERROR
;

503 
	}
}

505 
	gHPCupsF‹r
::
	$S¹PrštJob
(
¬gc
, *
¬gv
[])

507 
fd
 = 0;

508 
cups_¿¡”_t
 *
cups_¿¡”
;

509 
”r
 = 0;

511 
	`mem£t
(&
m_JA
, 0, (
JobA‰ribu‹s
));

512 
tm
 *
t
;

513 
timev®
 
tv
;

514 
time_t
 
lÚg_time
;

515 
	`time
(&
lÚg_time
);

516 
t
 = 
	`loÿÉime
(&
lÚg_time
);

517 
	`g‘timeofday
(&
tv
, 
NULL
);

518 
	`¡ºıy
(
m_JA
.
job_¡¬t_time
, 
	`asùime
(
t
), (m_JA.job_start_time)-1);

519 
	`¢´štf
(
m_JA
.
job_¡¬t_time
+19, (m_JA.job_¡¬t_timeè- 20, ":%ld %d", 
tv
.
tv_u£c
/1000, 
t
->
tm_y—r
 + 1900);

521 #ifdeà
UNITTESTING


522 
	`mem£t
(
m_JA
.
job_¡¬t_time
,0,(m_JA.job_start_time));

523 
	`¢´štf
(
m_JA
.
job_¡¬t_time
, (m_JA.job_start_time),"Mon Dec 9 17:48:58:586 2013" );

526 
m_iLogLev–
 = 
	`g‘HPLogLev–
();

527 
m_JA
.
job_id
 = 
	`©oi
(
¬gv
[1]);

528 
	`¡ºıy
(
m_JA
.
u£r_Çme
,
¬gv
[2],(m_JA.user_name)-1);

530 
m_µd
 = 
	`µdO³nFe
(
	`g‘’v
("PPD"));

531 ià(
m_µd
 =ğ
NULL
) {

532 
	`dbglog
("DEBUG:…pdO³nFçed fÜ %s\n", 
	`g‘’v
("PPD"));

533  
SYSTEM_ERROR
;

536 
m_¬gv
 = 
¬gv
;

537 ià(
m_iLogLev–
 & 
BASIC_LOG
) {

538 
i
 = 0; i < 
¬gc
; i++) {

539 
	`dbglog
("¬gv[%d] = %s\n", 
i
, 
¬gv
[i]);

543 ià(
¬gc
 == 7)

545 ià(
m_iLogLev–
 & 
BASIC_LOG
)

547 
	`dbglog
("PagSŒ—m D©¨Name: %s\n", 
¬gv
[6] );

549 ià((
fd
 = 
	`İ’
 (
¬gv
[6], 
O_RDONLY
)) == -1)

551 
	`³¼Ü
("ERROR: Unableo open„aster file - ");

556 
m_pSys
 = 
Ãw
 
	`Sy¡emS”viûs
(
m_iLogLev–
, 
m_JA
.
job_id
, m_JA.
u£r_Çme
);

564 
	`sigÇl
(
SIGTERM
, 
HPCªûlJob
);

566 
cups_¿¡”
 = 
	`cupsRa¡”O³n
(
fd
, 
CUPS_RASTER_READ
);

568 ià(
cups_¿¡”
 =ğ
NULL
) {

569 
	`dbglog
("cupsRa¡”O³Àçed, fd = %d\n", 
fd
);

570 ià(
fd
 != 0) {

571 
	`şo£
(
fd
);

573 
	`şo£F‹r
();

577 ià((
”r
 = 
	`´oûssRa¡”D©a
(
cups_¿¡”
))) {

578 ià(
fd
 != 0) {

579 
	`şo£
(
fd
);

582 ià(
m_iLogLev–
 & 
BASIC_LOG
)

583 
	`dbglog
("HPCUPS:…roûssRa¡”D©¨»tuºed %d, c®lšg clo£F‹r()\n", 
”r
);

585 
	`şo£F‹r
();

586 
	`cupsRa¡”Clo£
(
cups_¿¡”
);

590 ià(
fd
 != 0) {

591 
	`şo£
(
fd
);

594 ià(
m_iLogLev–
 & 
BASIC_LOG
)

595 
	`dbglog
("HPCUPS: StartPrintJobƒnd of job, calling closeFilter()\n");

597 
	`şo£F‹r
();

598 
	`cupsRa¡”Clo£
(
cups_¿¡”
);

601 
	}
}

603 
boŞ
 
	gHPCupsF‹r
::
	$isBÏnkRa¡”
(
BYTE
 *
šput_¿¡”
, 
cups_·ge_h—d”2_t
 *
h—d”
)

605 
Ëngth_š_by‹s
 = ()
h—d”
->
cupsBy‹sP”Lše
;

606 ià(
šput_¿¡”
 =ğ
NULL
) {

607  
Œue
;

610 if(
h—d”
->
cupsCŞÜS·û
 =ğ
CUPS_CSPACE_K
){

611 ià(*
šput_¿¡”
 == 0x00 &&

612 !(
	`memcmp
(
šput_¿¡”
 + 1, iÅut_¿¡”, 
Ëngth_š_by‹s
 - 1))) {

613  
Œue
;

616 ià(*
šput_¿¡”
 == 0xFF &&

617 !(
	`memcmp
(
šput_¿¡”
 + 1, iÅut_¿¡”, 
Ëngth_š_by‹s
 - 1))) {

618  
Œue
;

621  
çl£
;

622 
	}
}

625 
	gHPCupsF‹r
::
	$´oûssRa¡”D©a
(
cups_¿¡”_t
 *
cups_¿¡”
)

627 
FILE
 *
kå
 = 
NULL
;

628 
FILE
 *
cå
 = 
NULL
;

629 
BYTE
 *
kRa¡”
 = 
NULL
;

630 
BYTE
 *
rgbRa¡”
 = 
NULL
;

631 
cu¼’t_·ge_numb”
 = 0;

632 
cups_·ge_h—d”2_t
 
cups_h—d”
;

633 
DRIVER_ERROR
 
”r
;

634 
»t_¡©us
 = 0;

636 
hpP»Proûs£dRa¡”Fe
[
MAX_FILE_PATH_LEN
];

639 
	`¥rštf
(
hpP»Proûs£dRa¡”Fe
, "%s/hp_%s_cups_Sw­edPagesXXXXXX",
CUPS_TMP_DIR
, 
m_JA
.
u£r_Çme
);

640 
image_´oûssÜ_t
* 
imageProûssÜ
 = 
	`imageProûssÜC»©e
();

642 
	`cupsRa¡”R—dH—d”2
(
cups_¿¡”
, &
cups_h—d”
))

645 
IMAGE_PROCESSOR_ERROR
 
»suÉ
 = 
	`imageProûssÜS¹Page
(
imageProûssÜ
, &
cups_h—d”
);

646 ià(
»suÉ
 !ğ
IPE_SUCCESS
){

647 
	`dbglog
("DEBUG: imageProûssÜS¹Pagçed„esuÉ = %d\n", 
»suÉ
);

650 
cu¼’t_·ge_numb”
++;

652 ià(
cu¼’t_·ge_numb”
 == 1) {

654 ià(
	`¡¬tPage
(&
cups_h—d”
è!ğ
NO_ERROR
) {

655  
JOB_CANCELED
;

658 ià(
m_JA
.
´e_´oûss_¿¡”
) {

661 
”r
 = 
m_Job
.
	`´eProûssRa¡”D©a
(&
cups_¿¡”
, &
cups_h—d”
, 
hpP»Proûs£dRa¡”Fe
);

662 ià(
”r
 !ğ
NO_ERROR
) {

663 ià(
m_iLogLev–
 & 
BASIC_LOG
) {

664 
	`dbglog
 ("DEBUG: Job::S¹Pagçed w™hƒ¼ = %d\n", 
”r
);

666 
»t_¡©us
 = 
JOB_CANCELED
;

671 ià(
cups_h—d”
.
cupsCŞÜS·û
 =ğ
CUPS_CSPACE_RGBW
) {

672 
rgbRa¡”
 = 
Ãw
 
BYTE
[
cups_h—d”
.
cupsWidth
 * 3];

673 ià(
rgbRa¡”
 =ğ
NULL
) {

674  
ALLOCMEM_ERROR
;

676 
kRa¡”
 = 
Ãw
 
BYTE
[
cups_h—d”
.
cupsWidth
];

677 ià(
kRa¡”
 =ğ
NULL
) {

678 
d–‘e
 [] 
rgbRa¡”
;

679  
ALLOCMEM_ERROR
;

681 
	`mem£t
 (
kRa¡”
, 0, 
cups_h—d”
.
cupsWidth
);

682 
	`mem£t
 (
rgbRa¡”
, 0xFF, 
cups_h—d”
.
cupsWidth
 * 3);

686 ià(
cups_h—d”
.
cupsCŞÜS·û
 =ğ
CUPS_CSPACE_K
) {

687 
kRa¡”
 = 
m_pPrš‹rBufãr
;

688 
rgbRa¡”
 = 
NULL
;

690 ià(
cups_h—d”
.
cupsCŞÜS·û
 !ğ
CUPS_CSPACE_RGBW
) {

691 
rgbRa¡”
 = 
m_pPrš‹rBufãr
;

692 
kRa¡”
 = 
NULL
;

695 
BYTE
 *
cŞÜ_¿¡”
 = 
NULL
;

696 
BYTE
 *
bÏck_¿¡”
 = 
NULL
;

698 
”r
 = 
m_Job
.
	`S¹Page
(&
m_JA
);

699 ià(
”r
 !ğ
NO_ERROR
) {

700 ià(
m_iLogLev–
 & 
BASIC_LOG
) {

701 
	`dbglog
 ("DEBUG: Job::S¹Pagçed w™hƒ¼ = %d\n", 
”r
);

703 
»t_¡©us
 = 
JOB_CANCELED
;

708 ià(
m_iLogLev–
 & 
SAVE_INPUT_RASTERS
)

710 
szFeName
[
MAX_FILE_PATH_LEN
];

711 
	`mem£t
(
szFeName
, 0, (szFileName));

713 ià(
cups_h—d”
.
cupsCŞÜS·û
 =ğ
CUPS_CSPACE_RGBW
 ||

714 
cups_h—d”
.
cupsCŞÜS·û
 =ğ
CUPS_CSPACE_RGB
)

717 
	`¢´štf
 (
szFeName
, (szFeName), "%s/hpcups_%s_c_bmp_%d_XXXXXX", 
CUPS_TMP_DIR
, 
m_JA
.
u£r_Çme
, 
cu¼’t_·ge_numb”
);

718 
	`ü—‹TempFe
(
szFeName
, &
cå
);

719 ià(
cå
)

721 
	`chmod
 (
szFeName
, 
S_IRUSR
 | 
S_IWUSR
 | 
S_IRGRP
 | 
S_IWGRP
 | 
S_IROTH
);

725 ià(
cups_h—d”
.
cupsCŞÜS·û
 =ğ
CUPS_CSPACE_RGBW
 ||

726 
cups_h—d”
.
cupsCŞÜS·û
 =ğ
CUPS_CSPACE_K
)

728 
	`¢´štf
 (
szFeName
, (szFeName), "%s/hpcups_%s_k_bmp_%d_XXXXXX", 
CUPS_TMP_DIR
, 
m_JA
.
u£r_Çme
, 
cu¼’t_·ge_numb”
);

729 
	`ü—‹TempFe
(
szFeName
, &
kå
);

730 ià(
kå
)

732 
	`chmod
 (
szFeName
, 
S_IRUSR
 | 
S_IWUSR
 | 
S_IRGRP
 | 
S_IWGRP
 | 
S_IROTH
);

736 
	`Wr™eBMPH—d”
 (
cå
, 
cups_h—d”
.
cupsWidth
, cups_h—d”.
cupsHeight
, 
COLOR_RASTER
);

737 
	`Wr™eBMPH—d”
 (
kå
, 
cups_h—d”
.
cupsWidth
, cups_h—d”.
cupsHeight
, 
BLACK_RASTER
);

740 
	`årštf
(
¡d”r
, "PAGE: %d %s\r\n", 
cu¼’t_·ge_numb”
, 
m_¬gv
[4]);

742 
boŞ
 
is_ljmÚo
 = 
	`¡rcmp
(
m_JA
.
´š‹r_Ïnguage
, "ljmono");

743 
y
 = 0; y < (è
cups_h—d”
.
cupsHeight
; y++) {

744 
	`cupsRa¡”R—dPix–s
 (
cups_¿¡”
, 
m_pPrš‹rBufãr
, 
cups_h—d”
.
cupsBy‹sP”Lše
);

745 
cŞÜ_¿¡”
 = 
rgbRa¡”
;

746 
bÏck_¿¡”
 = 
kRa¡”
;

748 
»suÉ
 = 
	`imageProûssÜProûssLše
(
imageProûssÜ
, 
m_pPrš‹rBufãr
, 
cups_h—d”
.
cupsBy‹sP”Lše
);

749 ià(
»suÉ
 !ğ
IPE_SUCCESS
){

750 
	`dbglog
("DEBUG: imageProûssÜProûssLšçed„esuÉ = %d\n", 
»suÉ
);

754 ià((
y
 =ğ0è&& !
is_ljmÚo
) {

759 *
m_pPrš‹rBufãr
 = 0x01;

760 
	`dbglog
("First„aster data…lane..\n" );

763 ià(
this
->
	`isBÏnkRa¡”
((
BYTE
 *è
m_pPrš‹rBufãr
, &
cups_h—d”
)) {

764 
cŞÜ_¿¡”
 = 
NULL
;

765 
bÏck_¿¡”
 = 
NULL
;

768 
	`exŒaùBÏckPix–s
(&
cups_h—d”
, 
bÏck_¿¡”
, 
cŞÜ_¿¡”
);

771 
”r
 = 
m_Job
.
	`S’dRa¡”s
 (
bÏck_¿¡”
, 
cŞÜ_¿¡”
);

772 ià(
”r
 !ğ
NO_ERROR
) {

776 ià(
m_iLogLev–
 & 
SAVE_INPUT_RASTERS
)

778 
	`Wr™eBMPRa¡”
 (
cå
, 
cŞÜ_¿¡”
, 
cups_h—d”
.
cupsWidth
, 
COLOR_RASTER
);

779 
	`Wr™eBMPRa¡”
 (
kå
, 
bÏck_¿¡”
, 
cups_h—d”
.
cupsWidth
/8, 
BLACK_RASTER
);

783 
»suÉ
 = 
	`imageProûssÜEndPage
(
imageProûssÜ
);

784 ià(
»suÉ
 !ğ
IPE_SUCCESS
){

785 
	`dbglog
("DEBUG: imageProûssÜEndPagçed„esuÉ = %d\n", 
»suÉ
);

789 
m_Job
.
	`NewPage
();

790 ià(
”r
 !ğ
NO_ERROR
) {

796 ià(
cups_h—d”
.
cupsCŞÜS·û
 =ğ
CUPS_CSPACE_RGBW
) {

797 
d–‘e
 [] 
kRa¡”
;

798 
d–‘e
 [] 
rgbRa¡”
;

799 
kRa¡”
 = 
NULL
;

800 
rgbRa¡”
 = 
NULL
;

803 
	`imageProûssÜDe¡roy
(
imageProûssÜ
);

805 
	`uÆšk
(
hpP»Proûs£dRa¡”Fe
);

806  
»t_¡©us
;

807 
	}
}

809 
	gHPCupsF‹r
::
	$exŒaùBÏckPix–s
(
cups_·ge_h—d”2_t
 *
cups_h—d”
, 
BYTE
 *
kRa¡”
, BYTE *
rgbRa¡”
)

816 
BYTE
 
pix–_v®ue
[8] = {

820 ià(
rgbRa¡”
 =ğ
NULL
) {

824 ià(
cups_h—d”
->
cupsCŞÜS·û
 =ğ
CUPS_CSPACE_RGBW
) {

825 
k
 = 0;

826 
BYTE
 *
pIn
 = 
m_pPrš‹rBufãr
;

827 
BYTE
 
kV®
 = 0;

828 
BYTE
 
wh™e
=0;

829 
BYTE
 *
rgb
 = 
rgbRa¡”
;

830 
BYTE
 *
bÏck
 = 
kRa¡”
;

831 
	`mem£t
 (
kRa¡”
, 0, 
cups_h—d”
->
cupsWidth
);

834 
i
 = 0; i < 
cups_h—d”
->
cupsWidth
; i++) {

835 
rgb
[0] = *
pIn
++;

836 
rgb
[1] = *
pIn
++;

837 
rgb
[2] = *
pIn
++;

838 
wh™e
 = *
pIn
++;

840 if(
wh™e
 == 0)

844 
kV®
 |ğ
pix–_v®ue
[
k
];

845 
rgb
[0] = 0xFF;

846 
rgb
[1] = 0xFF;

847 
rgb
[2] = 0xFF;

849 if(
wh™e
 == 0xFF)

851 
kV®
 |= 0;

855 
ü
,
cg
,
cb
;

856 
ü
 = 
rgb
[0] - ()(255 - 
wh™e
);

857 
rgb
[0] = 
ü
 >= 0 ? cr : 0;

859 
cg
 = 
rgb
[1] - ()(255 - 
wh™e
);

860 
rgb
[1] = 
cg
 >= 0 ? cg : 0;

862 
cb
 = 
rgb
[2] - ()(255 - 
wh™e
);

863 
rgb
[2] = 
cb
 >= 0 ? cb : 0;

866 
rgb
 += 3;

867 ià(
k
 == 7) {

868 *
bÏck
++ = 
kV®
;

869 
kV®
 = 0;

870 
k
 = 0;

873 
k
++;

876 *
bÏck
 = 
kV®
;

879 
	}
}

881 
	gHPCupsF‹r
::
	$´štCupsH—d”Info
(
cups_·ge_h—d”2_t
 *
h—d”
)

884 
	`dbglog
 ("DEBUG: startPage...\n");

885 
	`dbglog
 ("DEBUG: MedŸCÏs ğ\"%s\"\n", 
h—d”
->
MedŸCÏss
);

886 
	`dbglog
 ("DEBUG: MedŸCŞÜ = \"%s\"\n", 
h—d”
->
MedŸCŞÜ
);

887 
	`dbglog
 ("DEBUG: MedŸTy³ = \"%s\"\n", 
h—d”
->
MedŸTy³
);

888 
	`dbglog
 ("DEBUG: OuutTy³ = \"%s\"\n", 
h—d”
->
OuutTy³
);

889 
	`dbglog
 ("DEBUG: AdvªûDi¡ªû = %d\n", 
h—d”
->
AdvªûDi¡ªû
);

890 
	`dbglog
 ("DEBUG: AdvªûMedŸ = %d\n", 
h—d”
->
AdvªûMedŸ
);

891 
	`dbglog
 ("DEBUG: CŞÏ‹ = %d\n", 
h—d”
->
CŞÏ‹
);

892 
	`dbglog
 ("DEBUG: CutMedŸ = %d\n", 
h—d”
->
CutMedŸ
);

893 
	`dbglog
 ("DEBUG: Du¶ex = %d\n", 
h—d”
->
Du¶ex
);

894 
	`dbglog
 ("DEBUG: HWResŞutiÚ = [ %d %d ]\n", 
h—d”
->
HWResŞutiÚ
[0], header->HWResolution[1]);

895 
	`dbglog
 ("DEBUG: ImagingBoundingBox = [ %d %d %d %d ]\n",

896 
h—d”
->
ImagšgBoundšgBox
[0], header->ImagingBoundingBox[1],

897 
h—d”
->
ImagšgBoundšgBox
[2], header->ImagingBoundingBox[3]);

898 
	`dbglog
 ("DEBUG: In£¹Sh“ˆğ%d\n", 
h—d”
->
In£¹Sh“t
);

899 
	`dbglog
 ("DEBUG: Jog = %d\n", 
h—d”
->
Jog
);

900 
	`dbglog
 ("DEBUG: L—dšgEdgğ%d\n", 
h—d”
->
L—dšgEdge
);

901 
	`dbglog
 ("DEBUG: M¬gš ğ[ %d %d ]\n", 
h—d”
->
M¬gšs
[0], header->Margins[1]);

902 
	`dbglog
 ("DEBUG: Mªu®F“d = %d\n", 
h—d”
->
Mªu®F“d
);

903 
	`dbglog
 ("DEBUG: MedŸPos™iÚ = %d\n", 
h—d”
->
MedŸPos™iÚ
);

904 
	`dbglog
 ("DEBUG: MedŸWeighˆğ%d\n", 
h—d”
->
MedŸWeight
);

905 
	`dbglog
 ("DEBUG: MœrÜPršˆğ%d\n", 
h—d”
->
MœrÜPršt
);

906 
	`dbglog
 ("DEBUG: Neg©ivePršˆğ%d\n", 
h—d”
->
Neg©ivePršt
);

907 
	`dbglog
 ("DEBUG: NumCİ› ğ%d\n", 
h—d”
->
NumCİ›s
);

908 
	`dbglog
 ("DEBUG: Or›Á©iÚ = %d\n", 
h—d”
->
Or›Á©iÚ
);

909 
	`dbglog
 ("DEBUG: OuutFaûU°ğ%d\n", 
h—d”
->
OuutFaûUp
);

910 
	`dbglog
 ("DEBUG: PageSizğ[ %d %d ]\n", 
h—d”
->
PageSize
[0], header->PageSize[1]);

911 
	`dbglog
 ("DEBUG: S•¬©iÚ ğ%d\n", 
h—d”
->
S•¬©iÚs
);

912 
	`dbglog
 ("DEBUG: T¿ySw™ch = %d\n", 
h—d”
->
T¿ySw™ch
);

913 
	`dbglog
 ("DEBUG: TumbË = %d\n", 
h—d”
->
TumbË
);

914 
	`dbglog
 ("DEBUG: cupsWidth = %d\n", 
h—d”
->
cupsWidth
);

915 
	`dbglog
 ("DEBUG: cupsHeighˆğ%d\n", 
h—d”
->
cupsHeight
);

916 
	`dbglog
 ("DEBUG: cupsMedŸTy³ = %d\n", 
h—d”
->
cupsMedŸTy³
);

917 
	`dbglog
 ("DEBUG: cupsRowS‹°ğ%d\n", 
h—d”
->
cupsRowS‹p
);

918 
	`dbglog
 ("DEBUG: cupsB™sP”CŞÜ = %d\n", 
h—d”
->
cupsB™sP”CŞÜ
);

919 
	`dbglog
 ("DEBUG: cupsB™sP”Pix– = %d\n", 
h—d”
->
cupsB™sP”Pix–
);

920 
	`dbglog
 ("DEBUG: cupsBy‹sP”Lšğ%d\n", 
h—d”
->
cupsBy‹sP”Lše
);

921 
	`dbglog
 ("DEBUG: cupsCŞÜOrd” = %d\n", 
h—d”
->
cupsCŞÜOrd”
);

922 
	`dbglog
 ("DEBUG: cupsCŞÜS·û = %d\n", 
h—d”
->
cupsCŞÜS·û
);

923 
	`dbglog
 ("DEBUG: cupsRowS‹°ğ%d\n", 
h—d”
->
cupsRowS‹p
);

924 
	`dbglog
 ("DEBUG: cupsCom´essiÚ = %d\n", 
h—d”
->
cupsCom´essiÚ
);

925 
	`dbglog
 ("DEBUG: cupsPageSizeNamğ%s\n", 
h—d”
->
cupsPageSizeName
);

926 
	`dbglog
 ("DEBUG: cupsIÁeg”0 = %d\n", 
h—d”
->
cupsIÁeg”
[0]);

927 
	`dbglog
 ("DEBUG: cupsIÁeg”1 = %d\n", 
h—d”
->
cupsIÁeg”
[1]);

928 
	`dbglog
 ("DEBUG: cupsIÁeg”2 = %d\n", 
h—d”
->
cupsIÁeg”
[2]);

929 
	`dbglog
 ("DEBUG: cupsSŒšg0 = %s\n", 
h—d”
->
cupsSŒšg
[0]);

930 
	`dbglog
 ("DEBUG: cupsR—l0 = %f\n", 
h—d”
->
cupsR—l
[0]);

931 
	`dbglog
 ("DEBUG: cupsR—l1 = %f\n", 
h—d”
->
cupsR—l
[1]);

932 
	}
}

	@prnt/hpcups/HPCupsFilter.h

31 #iâdeà
HP_CUPSFILTER_H


32 
	#HP_CUPSFILTER_H


	)

34 
	~"CommÚDefš™iÚs.h
"

35 
	~"Sy¡emS”viûs.h
"

36 
	~"Com´essÜ.h
"

37 
	~"Job.h
"

38 
	~<cups/µd.h
>

39 
	~"dbuscomm.h
"

41 
	#DBITMAPFILEHEADER
 14

	)

42 
	#DBITMAPINFOHEADER
 40

	)

44 
	eeRa¡”Ty³


46 
	mBLACK_RASTER
,

47 
	mCOLOR_RASTER


52 
	mbfTy³
;

53 
	mbfSize
;

54 
	mbfRe£rved1
;

55 
	mbfRe£rved2
;

56 
	mbfOffB™s
;

57 } 
	tBITMAPFILEHEADER
;

61 
	mbiSize
;

62 
	mbiWidth
;

63 
	mbiHeight
;

64 
	mbiPÏÃs
;

65 
	mbiB™CouÁ
;

66 
	mbiCom´essiÚ
;

67 
	mbiSizeImage
;

68 
	mbiXP–sP”M‘”
;

69 
	mbiYP–sP”M‘”
;

70 
	mbiCÌU£d
;

71 
	mbiCÌImpÜÁ
;

72 } 
	tBITMAPINFOHEADER
;

74 şas 
	cHPCupsF‹r


76 
	mpublic
:

78 
HPCupsF‹r
();

79 ~
HPCupsF‹r
();

80 
S¹PrštJob
(
¬gc
, *
¬gv
[]);

81 
CªûlJob
();

82 
RemoveStus
();

84 
Wr™eBMPH—d”
 (
FILE
 *
å
, 
width
, 
height
, 
eRa¡”Ty³
 
¿¡”_ty³
);

85 
Wr™eBMPRa¡”
 (
FILE
 *
å
, 
BYTE
 *
¿¡”
, 
width
, 
eRa¡”Ty³
 
¿¡”_ty³
);

87 
	m´iv©e
:

89 
BYTE
 *
m_pPrš‹rBufãr
;

90 
Job
 
	mm_Job
;

91 
Sy¡emS”viûs
 *
	mm_pSys
;

92 
	mchd_pid
;

93 **
	mm_¬gv
;

94 
JobA‰ribu‹s
 
	mm_JA
;

95 
µd_fe_t
 *
	mm_µd
;

96 
DBusCommuniÿtÜ
 
	mm_DBusComm
;

98 
	m´iv©e
:

99 
şo£F‹r
();

100 
ş—nup
();

102 
DRIVER_ERROR
 
¡¬tPage
 (
cups_·ge_h—d”2_t
 *
h—d”
);

103 
´oûssRa¡”D©a
(
cups_¿¡”_t
 *
cups_¿¡”
);

104 
exŒaùBÏckPix–s
(
cups_·ge_h—d”2_t
 *
cups_h—d”
,

105 
BYTE
 *
kRa¡”
, BYTE *
rgbRa¡”
);

106 
´štCupsH—d”Info
(
cups_·ge_h—d”2_t
 *
h—d”
);

107 
boŞ
 
isBÏnkRa¡”
(
BYTE
 *
šput_¿¡”
, 
cups_·ge_h—d”2_t
 *
h—d”
);

108 
	mm_iLogLev–
;

110 
C»©eBMPH—d”
(
width
, 
height
, 
¶ªes
, 
bµ
);

111 
Wr™eCBMPH—d”
 (
FILE
 *
å
, 
width
, 
height
);

112 
Wr™eKBMPH—d”
 (
FILE
 *
å
, 
width
, 
height
);

113 
Wr™eCBMPRa¡”
 (
FILE
 *
å
, 
BYTE
 *
rgb_¿¡”
, 
width
);

114 
Wr™eKBMPRa¡”
 (
FILE
 *
å
, 
BYTE
 *
k_¿¡”
, 
width
);

115 
	madj_c_width
;

116 
	madj_k_width
;

117 
BYTE
 *
	mbÏck_¿¡”
;

118 
BYTE
 *
	mcŞÜ_¿¡”
;

119 
BITMAPFILEHEADER
 
	mbmfh
;

120 
BITMAPINFOHEADER
 
	mbmih
;

122 #ifdeà
UNITTESTING


123 
ä›nd
 
şass
 
	mTe¡HPCupsF‹r
;

	@prnt/hpcups/Halftoner.cpp

62 
	~"CommÚDefš™iÚs.h
"

63 
	~"ProûssÜ.h
"

64 
	~"H®áÚ”.h
"

66 
	gH®áÚ”
::
H®áÚ”


68 
PrštMode
* 
pPM
,

69 
	giIÅutWidth
,

70 
	giNumRows
[],

71 
	gHiResFaùÜ
,

72 
boŞ
 
	gm©rixba£d


73 è: 
CŞÜPÏÃCouÁ
(
pPM
->
dyeCouÁ
),

74 
IÅutWidth
(
iIÅutWidth
),

75 
ResBoo¡
(
HiResFaùÜ
),

76 
nNextRa¡”
(0),

77 
fBÏckFEDResPŒ
(
pPM
->
BÏckFEDTabË
),

78 
fCŞÜFEDResPŒ
(
pPM
->
CŞÜFEDTabË
),

79 
iCŞÜ
(0),

80 
iRow
(0),

81 
iPÏÃ
(0),

82 
‹mpBufãr
(
NULL
),

83 
‹mpBufãr2
(
NULL
),

84 
hŞd_¿ndom
(0),

85 
	$u£m©rix
(
m©rixba£d
)

87 
i
;

88 
j
,
k
,
PÏÃSize
;

89 
Üigš®KD©a
 = 
NULL
;

91 
S¹PÏÃ
 = 
K
;

93 ià(
CŞÜPÏÃCouÁ
 == 3)

95 
S¹PÏÃ
=
C
;

96 
NumRows
[
K
] = 
CŞÜD•th
[K] = 
OuutWidth
[K] = 0;

99 
EndPÏÃ
=
Y
;

100 ià(
CŞÜPÏÃCouÁ
 == 6)

102 
EndPÏÃ
 = 
Mlight
;

104 ià(
CŞÜPÏÃCouÁ
 == 1)

106 
EndPÏÃ
 = 
K
;

109 
Adju¡edIÅutWidth
 = 
IÅutWidth
;

110 ià(
Adju¡edIÅutWidth
 % 8)

112 
Adju¡edIÅutWidth
 += 8 - (AdjustedInputWidth % 8);

116 
i
 = 
S¹PÏÃ
; i < (
CŞÜPÏÃCouÁ
 + StartPlane); i++)

118 
CŞÜD•th
[
i
]ğ
pPM
->ColorDepth[i];

119 
NumRows
[
i
]=
iNumRows
[i];

121 
OuutWidth
[
i
] = 
Adju¡edIÅutWidth
 * 
NumRows
[i] * 
ResBoo¡
;

123 ;
i
 < ()
MAXCOLORPLANES
; i++)

125 
NumRows
[
i
] = 
CŞÜD•th
[i] = 
OuutWidth
[i] = 0;

128 
oddb™s
 = 
Adju¡edIÅutWidth
 - 
IÅutWidth
;

130 
i
=0; i <ğ
Mlight
; i++)

132 
E¼Buff
[
i
]=
NULL
;

135 
i
 = 
S¹PÏÃ
; i <ğ
EndPÏÃ
; i++)

137 
E¼Buff
[
i
] = (*è
Ãw
 [((
OuutWidth
[i] + 2) * ())];

138 ià(
E¼Buff
[
i
] =ğ
NULL
)

140 
MemÜyE¼Ü
;

144 ià(
OuutWidth
[
K
] > 
Adju¡edIÅutWidth
)

147 
‹mpBufãr
 = (
BYTE
*è
Ãw
 BYTE[(
OuutWidth
[
K
])];

148 ià(
‹mpBufãr
 =ğ
NULL
)

150 
MemÜyE¼Ü
;

152 ià(
EndPÏÃ
 > 
Y
)

154 
‹mpBufãr2
 = (
BYTE
*è
Ãw
 BYTE[(
OuutWidth
[
K
])];

155 ià(
‹mpBufãr2
 =ğ
NULL
)

157 
MemÜyE¼Ü
;

162 
	`Re¡¬t
();

165 
i
 = 0; i < ()
MAXCOLORPLANES
; i++)

167 
j
 = 0; j < 
MAXCOLORROWS
; j++)

169 
k
 = 0; k < 
MAXCOLORDEPTH
; k++)

171 
CŞÜPÏÃ
[
i
][
j
][
k
] = 
NULL
;

176 
i
=
S¹PÏÃ
; i < (
CŞÜPÏÃCouÁ
+StartPlane); i++)

178 
j
=0; j < 
NumRows
[
i
]; j++)

180 
k
=0; k < 
CŞÜD•th
[
i
]; k++)

182 
PÏÃSize
ğ
OuutWidth
[
i
]/8 +

183 ((
OuutWidth
[
i
] % 8)!=0);

184 
CŞÜPÏÃ
[
i
][
j
][
k
] = (
BYTE
*è
Ãw
 BYTE[(
PÏÃSize
)];

185 ià(
CŞÜPÏÃ
[
i
][
j
] =ğ
NULL
)

187 
MemÜyE¼Ü
;

189 
	`mem£t
(
CŞÜPÏÃ
[
i
][
j
][
k
], 0, 
PÏÃSize
);

194 
PÏÃSize
 = (
OuutWidth
[0] + 7) / 8;

195 ià(
PÏÃSize
 > 0)

197 
Üigš®KD©a
 = (
BYTE
*è
Ãw
 BYTE[(
PÏÃSize
)];

198 ià(
Üigš®KD©a
 =ğ
NULL
)

200 
MemÜyE¼Ü
;

202 
	`mem£t
(
Üigš®KD©a
, 0, 
PÏÃSize
);

206 
MemÜyE¼Ü
:

208 
	`F»eBufãrs
();

210 
i
=0; i < 
CŞÜPÏÃCouÁ
; i++)

212 
j
=0; j < 
NumRows
[
i
]; j++)

214 
k
=0; k < 
CŞÜD•th
[
i
]; k++)

216 ià(
CŞÜPÏÃ
[
i
][
j
][
k
])

218 
d–‘e
 [] (
CŞÜPÏÃ
[
i
][
j
][
k
]);

223 ià(
Üigš®KD©a
)

225 
d–‘e
 [] (
Üigš®KD©a
);

228 
	}
}

231 
	gH®áÚ”
::~
	$H®áÚ”
()

233 
	`F»eBufãrs
();

235 
i
=0; i < 
MAXCOLORPLANES
; i++)

237 
j
=0; j < 
NumRows
[
i
]; j++)

239 
k
=0; k < 
CŞÜD•th
[
i
]; k++)

241 ià(
CŞÜPÏÃ
[
i
][
j
][
k
])

243 
d–‘e
 [] (
CŞÜPÏÃ
[
i
][
j
][
k
]);

248 ià(
Üigš®KD©a
)

250 
d–‘e
 [] (
Üigš®KD©a
);

252 
	}
}

255 
	gH®áÚ”
::
	$Re¡¬t
()

257 
nNextRa¡”
 = 0;

259 
i
 = 
S¹PÏÃ
; i <ğ
EndPÏÃ
; i++)

261 
	`mem£t
(
E¼Buff
[
i
], 0, (
OuutWidth
[i]+2) * ());

264 
¡¬‹d
 = 
çl£
;

265 
	}
}

268 
	gH®áÚ”
::
	$Flush
()

270 ià(!
¡¬‹d
)

274 
	`Re¡¬t
();

275 
	}
}

278 
	gH®áÚ”
::
	$F»eBufãrs
()

280 
i
 = 
S¹PÏÃ
; i <ğ
EndPÏÃ
; i++)

282 
d–‘e
 [] (
E¼Buff
[
i
]);

284 ià(
‹mpBufãr
)

286 
d–‘e
 [] (
‹mpBufãr
);

288 ià(
‹mpBufãr2
)

290 
d–‘e
 [] (
‹mpBufãr2
);

292 
	}
}

296 
	gH®áÚ”
::
	$Pix–MuÉly
(* 
bufãr
, 
width
, 
çùÜ
)

298 ià(
çùÜ
 == 1)

303 
j
 = ()(
width
-1); j >= 0; j--)

305 
iOff£t
 = 
j
 * 
çùÜ
;

306 
k
 = 0; k < 
çùÜ
; k++)

308 
bufãr
[
iOff£t
 + 
k
] = bufãr[
j
];

312 
	}
}

314 
	gH®áÚ”
::
	$g‘OuutWidth
()

318 
cŞÜ¶ªe
, 
tmp
;

320 
¿¡”d
 = 
iRa¡”sD–iv”ed
;

322 ià(
¿¡”d
 > 0)

324 
¿¡”d
--;

327 
tmp
 = ()(
NumRows
[0]*
CŞÜD•th
[0]);

328 ià(
¿¡”d
 < 
tmp
)

330 
cŞÜ¶ªe
 = 0;

336 
cŞÜ¶ªe
 = 1;

339 
‹mp
 = (
OuutWidth
[
cŞÜ¶ªe
] + 7) / 8;

340  
‹mp
;

341 
	}
}

343 
boŞ
 
	gH®áÚ”
::
	$NextOuutRa¡”
(
RASTERDATA
 &
Ãxt_¿¡”
)

345 ià(
iRa¡”sR—dy
 == 0)

347  
çl£
;

350 ià(
iCŞÜ
 =ğ(
CŞÜPÏÃCouÁ
+
S¹PÏÃ
))

352  
çl£
;

355 ià(
iPÏÃ
 =ğ
CŞÜD•th
[
iCŞÜ
])

357 
iPÏÃ
 = 0;

358 
iRow
++;

359  
	`NextOuutRa¡”
(
Ãxt_¿¡”
);

362 ià(
iRow
 =ğ
NumRows
[
iCŞÜ
])

364 
iRow
 = 0;

365 
iCŞÜ
++;

366  
	`NextOuutRa¡”
(
Ãxt_¿¡”
);

369 
iRa¡”sD–iv”ed
++;

370 
iRa¡”sR—dy
--;

371 
Ãxt_¿¡”
.
¿¡”d©a
[
COLORTYPE_COLOR
] = 
CŞÜPÏÃ
[
iCŞÜ
][
iRow
][
iPÏÃ
++];

372 
Ãxt_¿¡”
.
¿¡”size
[
COLORTYPE_COLOR
] = 
	`g‘OuutWidth
();

373 
Ãxt_¿¡”
.
¿¡”d©a
[
COLORTYPE_BLACK
] = 
¿¡”
.rasterdata[COLORTYPE_BLACK];

374 
Ãxt_¿¡”
.
¿¡”size
[
COLORTYPE_BLACK
] = 0;

375  
Œue
;

376 
	}
}

379 
boŞ
 
	gH®áÚ”
::
	$La¡PÏÃ
()

381  ((
iCŞÜ
 =ğ(
CŞÜPÏÃCouÁ
+
S¹PÏÃ
-1)) &&

382 (
iRow
 =ğ()(
NumRows
[
iCŞÜ
] - 1)) &&

383 (
iPÏÃ
 =ğ
CŞÜD•th
[
iCŞÜ
])

385 
	}
}

388 
boŞ
 
	gH®áÚ”
::
	$Fœ¡PÏÃ
()

390  ((
iCŞÜ
 =ğ
S¹PÏÃ
) &&

391 (
iRow
 == 0) &&

392 (
iPÏÃ
 == 1)

394 
	}
}

396 
	gH®áÚ”
::
	$G‘MaxOuutWidth
()

400 ià(
my¶ªe
 =ğ
COLORTYPE_COLOR
)

402 
max
=0;

403 
i
=
S¹PÏÃ
; i <ğ
EndPÏÃ
; i++)

405 ià(
OuutWidth
[
i
] > 
max
)

407 
max
 = 
OuutWidth
[
i
];

410  (
max
 / 8) + ((max % 8)!=0);

416 
	}
}

419 
	gH®áÚ”
::
	$PÏÃCouÁ
()

421 
couÁ
=0;

423 
i
 = 0; i < 
MAXCOLORPLANES
; i++)

425 
couÁ
 +ğ
NumRows
[
i
] * 
CŞÜD•th
[i];

428  
couÁ
;

429 
	}
}

432 
	gH®áÚ”
::
	$CËªOddB™s
(
iCŞÜ
, 
iRow
)

434 
šdex
 = (
OuutWidth
[
iCŞÜ
]/8)-1;

436 
i
=0; i < 
CŞÜD•th
[
iCŞÜ
]; i++)

438 
BYTE
 
Ï¡by‹0
 = 
CŞÜPÏÃ
[
iCŞÜ
][
iRow
][
i
][
šdex
];

439 
Ï¡by‹0
 =†a¡by‹0 >> 
oddb™s
;

440 
Ï¡by‹0
 =†a¡by‹0 << 
oddb™s
;

441 
CŞÜPÏÃ
[
iCŞÜ
][
iRow
][
i
][
šdex
] = 
Ï¡by‹0
;

443 
	}
}

446 
Bay”M©rix
[];

448 
boŞ
 
	gH®áÚ”
::
Proûss


450 
RASTERDATA
* 
pbyIÅutKRGBRa¡”


453 
i
;

454 
	gj
, 
	gk
;

455 ià((
	gpbyIÅutKRGBRa¡”
 =ğ
NULL
) ||

456 (
pbyIÅutKRGBRa¡”
 &&…byIÅutKRGBRa¡”->
¿¡”d©a
[
COLORTYPE_COLOR
]==
NULL
 &&…byIÅutKRGBRa¡”->¿¡”d©a[
COLORTYPE_BLACK
]==NULL))

458 
Re¡¬t
();

459  
	gçl£
;

461 
	g¡¬‹d
=
Œue
;

463 
	gi
=
S¹PÏÃ
; i < (
	gCŞÜPÏÃCouÁ
+
	gS¹PÏÃ
); i++)

465 
	gj
=0; j < 
	gNumRows
[
i
]; j++)

467 
	gk
=0; k < 
	gCŞÜD•th
[
i
]; k++)

469 
	gPÏÃSize
ğ(
OuutWidth
[
i
] + 7) / 8;

470 
mem£t
(
CŞÜPÏÃ
[
i
][
j
][
k
], 0, 
PÏÃSize
);

474 ià(
	gpbyIÅutKRGBRa¡”
->
	g¿¡”d©a
[
COLORTYPE_COLOR
])

477 ++
	gnNextRa¡”
;

478 iàĞ-1 =ğ
nNextRa¡”
 )

479 
nNextRa¡”
 = 0;

481 
	gfRa¡”Odd
 = ( 1 & 
nNextRa¡”
 ) ? 0 : 1;

483 
BYTE
* 
	gšput
;

484 
	gnumpix
;

486 
	gi
=
S¹PÏÃ
; i <ğ
EndPÏÃ
; i++)

488 ià(
	gOuutWidth
[
i
] > 
	gAdju¡edIÅutWidth
)

490 
mem£t
(
‹mpBufãr
, 0, 
OuutWidth
[
i
]);

492 
memıy
(
‹mpBufãr
,
pbyIÅutKRGBRa¡”
->
¿¡”d©a
[
COLORTYPE_COLOR
],
IÅutWidth
);

493 
	gçùÜ
 = 
NumRows
[
i
] * 
ResBoo¡
;

494 
Pix–MuÉly
(
‹mpBufãr
, 
IÅutWidth
, 
çùÜ
);

495 
	gšput
=
‹mpBufãr
;

496 
	gnumpix
 = 
OuutWidth
[
i
];

500 
	gšput
=
pbyIÅutKRGBRa¡”
->
¿¡”d©a
[
COLORTYPE_COLOR
];

501 
	gnumpix
 = 
Adju¡edIÅutWidth
;

504 
	gfD™h”P¬ms
[
i
].
	gfNumPix
 = 
numpix
;

505 
	gfD™h”P¬ms
[
i
].
	gfIÅut
 = 
šput
;

506 
	gfD™h”P¬ms
[
i
].
	gfE¼
 = 
E¼Buff
[i];

507 
	gfD™h”P¬ms
[
i
].
	gfE¼
++;

508 
	gfD™h”P¬ms
[
i
].
	gfSymm‘ricFÏg
 = 
Œue
;

509 ià(
	gi
 =ğ
K
)

510 
fD™h”P¬ms
[
i
].
fFEDResPŒ
 = 
fBÏckFEDResPŒ
;

512 
	gfD™h”P¬ms
[
i
].
	gfFEDResPŒ
 = 
fCŞÜFEDResPŒ
;

513 
	gfD™h”P¬ms
[
i
].
	gfRa¡”Ev’OrOdd
 = 
fRa¡”Odd
;

514 
	gfD™h”P¬ms
[
i
].
	gfHife
 = 
CŞÜD•th
[i]>1;

517 ià(
	gu£m©rix
)

519 
	gfD™h”P¬ms
[
i
].
	gfSqu“zeOff£t
=0;

520 
	gfD™h”P¬ms
[
i
].
	gfM©rixRowSize
 = 
Bay”M©rix
[1];

521 
BYTE
 
	gcŞÜšdex
 = 
i
 + 2;

522 ià(
	gi
>=
Y
)

523 
cŞÜšdex
 = 4;

524 
BYTE
 
	gd™h”off£t
 = 
Bay”M©rix
[
cŞÜšdex
];

525 
BYTE
 
	gm©rixrowsize
 = 
Bay”M©rix
[1];

526 
	gfD™h”P¬ms
[
i
].
	gfD™h”C–lOff£t
 = 
d™h”off£t
;

527 
BYTE
 * 
	gm©rix±r
 = (BYTE *)(

528 (((
d™h”off£t
 + 
nNextRa¡”
è% 
m©rixrowsize
) * matrixrowsize)

529 + 5 + 
Bay”M©rix
);

531 
	gfD™h”P¬ms
[
i
].
	gfM©rixV1
 = 
m©rix±r
;

536 
	gj
=0; j < 
	gNumRows
[
i
]; j++)

538 
	gfD™h”P¬ms
[
i
].
	gfOuut1
 = 
CŞÜPÏÃ
[i][
j
][0];

539 
	gfD™h”P¬ms
[
i
].
	gfOuut2
 = 
CŞÜPÏÃ
[i][
j
][1];

541 ià(
	gu£m©rix
)

543 
mem£t
(
fD™h”P¬ms
[
i
].
fOuut1
, 0, 
OuutWidth
[i]/8);

544 ià(
	gfD™h”P¬ms
[
i
].
	gfOuut2
)

545 
mem£t
(
fD™h”P¬ms
[
i
].
fOuut2
, 0, 
OuutWidth
[i]/8);

546 
HTMATRIXHI_KCMY
((
THTD™h”P¬msPŒ
è
fD™h”P¬ms
, 
i
);

548 
HTEDiffO³n
 ((
THTD™h”P¬msPŒ
è
fD™h”P¬ms
, 
i
);

552 
CËªOddB™s
(
i
,
j
);

555 
	gpbyIÅutKRGBRa¡”
->
	g¿¡”d©a
[
COLORTYPE_COLOR
] +ğ
IÅutWidth
;

560 ià(
	gpbyIÅutKRGBRa¡”
->
	g¿¡”d©a
[
COLORTYPE_BLACK
])

562 
	gçùÜ
 = 1;

563 ià(
	gOuutWidth
[
K
] > 
	gAdju¡edIÅutWidth
)

565 
mem£t
(
‹mpBufãr
, 0, 
OuutWidth
[
K
]);

566 
memıy
(
‹mpBufãr
,
pbyIÅutKRGBRa¡”
->
¿¡”d©a
[
COLORTYPE_BLACK
],pbyIÅutKRGBRa¡”->
¿¡”size
[COLORTYPE_BLACK]);

568 
	gçùÜ
 = 
NumRows
[
K
] * 
ResBoo¡
;

569 
Pix–MuÉly
(
‹mpBufãr
, 
pbyIÅutKRGBRa¡”
->
¿¡”size
[
COLORTYPE_BLACK
], 
çùÜ
);

573 
mem£t
(
Üigš®KD©a
, 0, (
pbyIÅutKRGBRa¡”
->
¿¡”size
[
COLORTYPE_BLACK
] * 
çùÜ
 +7)/8);

574 
	gcurB™
 = 0x80, 
	gcurBy‹
 = 0;

575 
	gi
=0; i<
	gpbyIÅutKRGBRa¡”
->
	g¿¡”size
[
COLORTYPE_BLACK
] * 
	gçùÜ
; i++)

577 ià(
	gOuutWidth
[
K
] > 
	gAdju¡edIÅutWidth
)

579 ià(
	g‹mpBufãr
[
i
])

581 
	gÜigš®KD©a
[
curBy‹
] |ğ
curB™
;

586 ià(
	gpbyIÅutKRGBRa¡”
->
	g¿¡”d©a
[
COLORTYPE_BLACK
][
i
])

588 
	gÜigš®KD©a
[
curBy‹
] |ğ
curB™
;

591 ià(
	gcurB™
 == 0x01)

593 
curBy‹
++;

594 
	gcurB™
 = 0x80;

598 
	gcurB™
 = 
curB™
 >> 1;

601 
	gj
=0; j < 
	gNumRows
[
K
]; j++)

603 
	gk
 = 0; k < (
	gpbyIÅutKRGBRa¡”
->
	g¿¡”size
[
COLORTYPE_BLACK
] * 
	gçùÜ
 +7)/8; k++)

604 ià(
	gCŞÜPÏÃ
[
K
][
j
][0])

605 
	gCŞÜPÏÃ
[
K
][
j
][0][
k
] |ğ
Üigš®KD©a
[k];

606 ià(
	gCŞÜPÏÃ
[
K
][
j
][1])

607 
	gCŞÜPÏÃ
[
K
][
j
][1][
k
] |ğ
Üigš®KD©a
[k];

611 
	giCŞÜ
 = 
S¹PÏÃ
;

612 
	giRow
 = 
iPÏÃ
 = 0;

613 
	giRa¡”sR—dy
 = 
PÏÃCouÁ
();

614 
	giRa¡”sD–iv”ed
 = 0;

615  
	gŒue
;

619 
	gH®áÚ”
::
HTEDiffO³n


621 
THTD™h”P¬msPŒ
 
d™h”P¬msPŒ
,

622 
	gcouÁ


627 
	gd™h”P¬ms
 = 
d™h”P¬msPŒ
+
couÁ
;

628 
	g”rPŒ
 = 
d™h”P¬ms
->
fE¼
;

629 
	gnumLoİ
 = 
d™h”P¬ms
->
fNumPix
;

630 
	gšputPŒ
 = 
d™h”P¬ms
->
fIÅut
;

631 
	gãdResTbl
 = 
d™h”P¬ms
->
fFEDResPŒ
;

632 
	gsymm‘ricFÏg
 = 
d™h”P¬ms
->
fSymm‘ricFÏg
;

633 
	gdoNext8Pix–s
 = 
Œue
;

634 
	ghife
 = 
d™h”P¬ms
->
fHife
;

635 
	gouutPŒ1
 = 
d™h”P¬ms
->
fOuut1
;

637 ià(
	ghife
)

639 
	gouutPŒ1
 = 
d™h”P¬ms
->
fOuut1
;

640 
	gouutPŒ2
 = 
d™h”P¬ms
->
fOuut2
;

641 
	gouutPŒ3
 = 
d™h”P¬ms
->
fOuut3
;

644 
	gdiffusiÚE¼ÜPŒ
 = 
”rPŒ
;

646 
	g¿¡”By‹1
 = 0;

647 
	g¿¡”By‹2
 = 0;

648 
	g¿¡”By‹3
 = 0;

650 ifĞ
	gd™h”P¬ms
->
	gfRa¡”Ev’OrOdd
 == 1 )

652 
tmpShÜtStÜe
 = *
diffusiÚE¼ÜPŒ
;

654 *
	gdiffusiÚE¼ÜPŒ
 = 0;

656 
	gpix–CouÁ
 = 
numLoİ
 + 8; (pixelCount -= 8) > 0; )

658 ià(
	gpix–CouÁ
 > 16)

660 
	gdoNext8Pix–s
 = 
FÜw¬d16Pix–sNÚWh™e
(
šputPŒ
);

664 
	gdoNext8Pix–s
 = 
Œue
;

667 ià(
	gdoNext8Pix–s
)

669 
	gthV®ue
 = 
HPRªd
();

670 
FORWARD_FED
Ğ
thV®ue
, 0x80 );

671 
	gthV®ue
 = 
HPRªd
();

672 
FORWARD_FED
Ğ
thV®ue
, 0x40 );

673 
	gthV®ue
 = 
HPRªd
();

674 
FORWARD_FED
Ğ
thV®ue
, 0x20 );

675 
	gthV®ue
 = 
HPRªd
();

676 
FORWARD_FED
Ğ
thV®ue
, 0x10 );

677 
	gthV®ue
 = 
HPRªd
();

678 
FORWARD_FED
Ğ
thV®ue
, 0x08 );

679 
	gthV®ue
 = 
HPRªd
();

680 
FORWARD_FED
Ğ
thV®ue
, 0x04 );

681 
	gthV®ue
 = 
HPRªd
();

682 
FORWARD_FED
Ğ
thV®ue
, 0x02 );

683 
	gthV®ue
 = 
HPRªd
();

684 
FORWARD_FED
Ğ
thV®ue
, 0x01 );

686 *
	gouutPŒ1
++ = 
¿¡”By‹1
;

687 
	g¿¡”By‹1
 = 0;

689 ià(
	ghife
)

691 *
	gouutPŒ2
++ = 
¿¡”By‹2
;

692 
	g¿¡”By‹2
 = 0;

697 
	gšputPŒ
 += 8;

698 *
	gouutPŒ1
++ = 0;

699 ià(
	ghife
)

701 *
	gouutPŒ2
++ = 0;

703 *
	gdiffusiÚE¼ÜPŒ
++ = 0;

704 *
	gdiffusiÚE¼ÜPŒ
++ = 0;

705 *
	gdiffusiÚE¼ÜPŒ
++ = 0;

706 *
	gdiffusiÚE¼ÜPŒ
++ = 0;

707 *
	gdiffusiÚE¼ÜPŒ
++ = 0;

708 *
	gdiffusiÚE¼ÜPŒ
++ = 0;

709 *
	gdiffusiÚE¼ÜPŒ
++ = 0;

710 *
	gdiffusiÚE¼ÜPŒ
++ = 0;

711 
	g¿¡”By‹1
 = 0;

712 
	g¿¡”By‹2
 = 0;

713 
	gtmpShÜtStÜe
 = 0;

719 
	g¿¡”By‹1
 = 0;

720 
	g¿¡”By‹2
 = 0;

721 
	gšputPŒ
 +ğĞ
numLoİ
-1 );

722 
	gouutPŒ1
 +ğĞ
numLoİ
/8 - 1 );

723 
	gouutPŒ2
 +ğĞ
numLoİ
/8 - 1 );

724 
	gdiffusiÚE¼ÜPŒ
 +ğĞ
numLoİ
-1 );

726 
	gtmpShÜtStÜe
 = *
diffusiÚE¼ÜPŒ
;

728 *
	gdiffusiÚE¼ÜPŒ
 = 0;

730 
	gpix–CouÁ
 = 
numLoİ
 + 8; (pixelCount -= 8) > 0; )

732 ià(
	gpix–CouÁ
 > 16)

734 
	gdoNext8Pix–s
 = 
Backw¬d16Pix–sNÚWh™e
(
šputPŒ
);

738 
	gdoNext8Pix–s
 = 
Œue
;

741 ià(
	gdoNext8Pix–s
)

743 
	gthV®ue
 = 
HPRªd
();

744 
BACKWARD_FED
Ğ
thV®ue
, 0x01 );

745 
	gthV®ue
 = 
HPRªd
();

746 
BACKWARD_FED
Ğ
thV®ue
, 0x02 );

747 
	gthV®ue
 = 
HPRªd
();

748 
BACKWARD_FED
Ğ
thV®ue
, 0x04 );

749 
	gthV®ue
 = 
HPRªd
();

750 
BACKWARD_FED
Ğ
thV®ue
, 0x08 );

751 
	gthV®ue
 = 
HPRªd
();

752 
BACKWARD_FED
Ğ
thV®ue
, 0x10 );

753 
	gthV®ue
 = 
HPRªd
();

754 
BACKWARD_FED
Ğ
thV®ue
, 0x20 );

755 
	gthV®ue
 = 
HPRªd
();

756 
BACKWARD_FED
Ğ
thV®ue
, 0x40 );

757 
	gthV®ue
 = 
HPRªd
();

758 
BACKWARD_FED
Ğ
thV®ue
, 0x80 );

760 *
	gouutPŒ1
-- = 
¿¡”By‹1
;

761 
	g¿¡”By‹1
 = 0;

763 ià(
	ghife
)

765 *
	gouutPŒ2
-- = 
¿¡”By‹2
;

766 
	g¿¡”By‹2
 = 0;

771 
	gšputPŒ
 -= 8;

772 *
	gouutPŒ1
-- = 0;

773 ià(
	ghife
)

775 *
	gouutPŒ2
-- = 0;

777 *
	gdiffusiÚE¼ÜPŒ
-- = 0;

778 *
	gdiffusiÚE¼ÜPŒ
-- = 0;

779 *
	gdiffusiÚE¼ÜPŒ
-- = 0;

780 *
	gdiffusiÚE¼ÜPŒ
-- = 0;

781 *
	gdiffusiÚE¼ÜPŒ
-- = 0;

782 *
	gdiffusiÚE¼ÜPŒ
-- = 0;

783 *
	gdiffusiÚE¼ÜPŒ
-- = 0;

784 *
	gdiffusiÚE¼ÜPŒ
-- = 0;

785 
	g¿¡”By‹1
 = 0;

786 
	g¿¡”By‹2
 = 0;

787 
	gtmpShÜtStÜe
 = 0;

794 
	gH®áÚ”
::
FORWARD_FED


796 
th»shŞdV®ue
,

797 
	gb™Mask


800 
	gtÚe
 = (*
šputPŒ
++ );

801 
	gãdResPŒ
 = 
ãdResTbl
 + (
tÚe
 << 2);

802 
	gËv–
 = *
ãdResPŒ
++;

803 ià(
	gtÚe
 != 0)

805 
tÚe
 = ( 
tmpShÜtStÜe
 + ()(*
ãdResPŒ
++) );

806 ià(
	gtÚe
 >ğ
th»shŞdV®ue
)

808 
tÚe
 -= 255;

809 
	gËv–
++;

811 
	gËv–
)

816 
¿¡”By‹1
 |ğ
b™Mask
;

819 
¿¡”By‹2
 |ğ
b™Mask
;

822 
¿¡”By‹2
 |ğ
b™Mask
; 
	g¿¡”By‹1
 |= bitMask;

825 
¿¡”By‹3
 |ğ
b™Mask
;

828 
¿¡”By‹3
 |ğ
b™Mask
; 
	g¿¡”By‹1
 |= bitMask;

831 
¿¡”By‹3
 |ğ
b™Mask
; 
	g¿¡”By‹2
 |= bitMask;

834 
¿¡”By‹3
 |ğ
b™Mask
; 
	g¿¡”By‹2
 |ğb™Mask; 
	g¿¡”By‹1
 |= bitMask;

840 
	gtÚe
 = 
tmpShÜtStÜe
;

842 *
	gdiffusiÚE¼ÜPŒ
++ = 
tÚe
 >> 1;

843 
	gtmpShÜtStÜe
 = *
diffusiÚE¼ÜPŒ
 + (
tÚe
 - (tone >> 1));

847 
	gH®áÚ”
::
BACKWARD_FED


849 
th»shŞdV®ue
,

850 
	gb™Mask


853 
	gtÚe
 = (*
šputPŒ
-- );

854 
	gãdResPŒ
 = 
ãdResTbl
 + (
tÚe
 << 2);

855 
	gËv–
 = *
ãdResPŒ
++;

856 ià(
	gtÚe
 != 0)

858 
tÚe
 = ( 
tmpShÜtStÜe
 + ()(*
ãdResPŒ
++) );

859 ià(
	gtÚe
 >ğ
th»shŞdV®ue
)

861 
tÚe
 -= 255;

862 
	gËv–
++;

864 
	gËv–
)

869 
¿¡”By‹1
 |ğ
b™Mask
;

872 
¿¡”By‹2
 |ğ
b™Mask
;

875 
¿¡”By‹2
 |ğ
b™Mask
; 
	g¿¡”By‹1
 |= bitMask;

878 
¿¡”By‹3
 |ğ
b™Mask
;

881 
¿¡”By‹3
 |ğ
b™Mask
; 
	g¿¡”By‹1
 |= bitMask;

884 
¿¡”By‹3
 |ğ
b™Mask
; 
	g¿¡”By‹2
 |= bitMask;

887 
¿¡”By‹3
 |ğ
b™Mask
; 
	g¿¡”By‹2
 |ğb™Mask; 
	g¿¡”By‹1
 |= bitMask;

893 
	gtÚe
 = 
tmpShÜtStÜe
;

895 *
	gdiffusiÚE¼ÜPŒ
-- = 
tÚe
 >> 1;

896 
	gtmpShÜtStÜe
 = *
diffusiÚE¼ÜPŒ
 + (
tÚe
 - (tone >> 1));

900 
	#D™h”4Lev–HiFe
(
m©rix
,
b™Mask
)\

902 
tÚe
 = (*
šputPŒ
++ );\

903 
ãdResPŒ
 = 
ãdResTbl
 + (
tÚe
 << 2);\

904 
Ëv–
 = *
ãdResPŒ
++;\

905 ià(*(
ãdResPŒ
è>ğ(
BYTE
)
m©rix
 )\

907 
Ëv–
++;\

909 
Ëv–
)\

914 
¿¡”By‹1
 |ğ
b™Mask
;\

917 
¿¡”By‹2
 |ğ
b™Mask
;\

920 
¿¡”By‹2
 |ğ
b™Mask
; 
¿¡”By‹1
 |= bitMask;\

923 
¿¡”By‹3
 |ğ
b™Mask
;\

926 
¿¡”By‹3
 |ğ
b™Mask
; 
¿¡”By‹1
 |= bitMask;\

929 
¿¡”By‹3
 |ğ
b™Mask
; 
¿¡”By‹2
 |= bitMask;\

932 
¿¡”By‹3
 |ğ
b™Mask
; 
¿¡”By‹2
 |ğb™Mask; 
¿¡”By‹1
 |= bitMask;\

935 }

	)

960 
DRIVER_ERROR
 
	gH®áÚ”
::
	$HTMATRIXHI_KCMY
 (
THTD™h”P¬msPŒ
 
d™h”P¬msPŒ
,

961 
couÁ
)

963 
THTD™h”P¬msPŒ
 
d™h”P¬ms
 = 
d™h”P¬msPŒ
+
couÁ
;

964 
BYTE
 
tÚe
;

965 
BYTE
 
¿¡”By‹1
,
¿¡”By‹2
, 
¿¡”By‹3
;

966 
BYTE
 
Ëv–
;

967 
pix–CouÁ
;

969 
numLoİ
 = 
d™h”P¬ms
->
fNumPix
;

970 
BYTE
 * 
šputPŒ
 = 
d™h”P¬ms
->
fIÅut
;

971 
BYTE
 * 
ouutPŒ1
;

972 
BYTE
 * 
ouutPŒ2
;

973 
BYTE
 * 
ouutPŒ3
;

975 
BYTE
 * 
ãdResTbl
 = (BYTE * )
d™h”P¬ms
->
fFEDResPŒ
;

976 
BYTE
 * 
ãdResPŒ
;

978 
BYTE
 * 
m©rixV
 = 
d™h”P¬ms
->
fM©rixV1
;

979 
BYTE
 * 
m©rixH
;

980 
šdex
;

981 
m©rixRowSize
 = 
d™h”P¬ms
->
fM©rixRowSize
;

983 
¿¡”By‹1
 = 0;

984 
¿¡”By‹2
 = 0;

985 
¿¡”By‹3
 = 0;

987 
ouutPŒ1
 = 
d™h”P¬ms
->
fOuut1
;

988 
ouutPŒ2
 = 
d™h”P¬ms
->
fOuut2
;

989 
ouutPŒ3
 = 
d™h”P¬ms
->
fOuut3
;

991 ià(!
d™h”P¬ms
->
fSymm‘ricFÏg
)

992  
SYSTEM_ERROR
;

994 
šdex
 = (
d™h”P¬ms
->
fD™h”C–lOff£t
 + d™h”P¬ms->
fSqu“zeOff£t
è% (
m©rixRowSize
);

995 
m©rixH
 = 
m©rixV
 + 
šdex
;

997 
pix–CouÁ
 = 
numLoİ
 + 8; (pixelCount -= 8) > 0; )

1001 iàĞ
šdex
 =ğ
m©rixRowSize
 )

1003 
m©rixH
 = 
m©rixV
;

1004 
šdex
 = 0;

1007 
	`D™h”4Lev–HiFe
(*
m©rixH
,0x80);

1008 
m©rixH
++;

1009 
	`D™h”4Lev–HiFe
(*
m©rixH
,0x40);

1010 
m©rixH
++;

1011 
	`D™h”4Lev–HiFe
(*
m©rixH
,0x20);

1012 
m©rixH
++;

1013 
	`D™h”4Lev–HiFe
(*
m©rixH
,0x10);

1014 
m©rixH
++;

1015 
	`D™h”4Lev–HiFe
(*
m©rixH
,0x08);

1016 
m©rixH
++;

1017 
	`D™h”4Lev–HiFe
(*
m©rixH
,0x04);

1018 
m©rixH
++;

1019 
	`D™h”4Lev–HiFe
(*
m©rixH
,0x02);

1020 
m©rixH
++;

1021 
	`D™h”4Lev–HiFe
(*
m©rixH
,0x01);

1022 
m©rixH
++;

1024 *
ouutPŒ1
++ |ğ
¿¡”By‹1
;

1025 ià(
ouutPŒ2
)

1026 *
ouutPŒ2
++ |ğ
¿¡”By‹2
;

1027 
¿¡”By‹1
 = 0;

1028 
¿¡”By‹2
 = 0;

1030 
šdex
 += 8;

1032  
NO_ERROR
;

1033 
	}
}

1035 
	gBay”M©rix
[] =

	@prnt/hpcups/Halftoner.h

32 #iâdeà
HALFTONER_H


33 
	#HALFTONER_H


	)

41 şas 
	cH®áÚ”
 : 
public
 
ProûssÜ


43 
public
:

44 
H®áÚ”
(
PrštMode
* 
pPM
,

45 
iIÅutWidth
,

46 
iNumRows
[],

47 
HiResFaùÜ
,

48 
boŞ
 
m©rixba£d


50 
	mvœtu®
 ~
H®áÚ”
();

52 
boŞ
 
Proûss
(
RASTERDATA
* 
pbyIÅutKRGBRa¡”
);

53 
Flush
();

54 
Re¡¬t
();

57 
G‘MaxOuutWidth
();

58 
boŞ
 
NextOuutRa¡”
(
RASTERDATA
 &
Ãxt_¿¡”
);

59 
boŞ
 
La¡PÏÃ
();

60 
boŞ
 
Fœ¡PÏÃ
();

61 
	$PÏÃSize
()

62 {  
OuutWidth
[
iCŞÜ
] / 8 + (OutputWidth[iColor] % 8); }

64 
CŞÜPÏÃCouÁ
;

65 
IÅutWidth
;

66 
OuutWidth
[
MAXCOLORPLANES
];

67 
CŞÜD•th
[
MAXCOLORPLANES
];

69 
NumRows
[
MAXCOLORPLANES
];

73 
BYTE
* 
CŞÜPÏÃ
[
MAXCOLORPLANES
][
MAXCOLORROWS
][
MAXCOLORDEPTH
];

75 
S¹PÏÃ
;

76 
EndPÏÃ
;

77 
ResBoo¡
;

79 
´iv©e
:

80 
	`IÁ”pŞ©e
(cÚ¡ 
ušt32_t
 *
¡¬t
,cÚ¡ 
i
,

81 
r
,
g
,
b
,

82 *
bÏckout
, *
cyªout
,

83 *
mag’out
, *
y–lowout
, 
boŞ
);

84 
	`F»eBufãrs
();

86 
boŞ
 
	$FÜw¬d16Pix–sNÚWh™e
(
BYTE
 * 
šputPŒ
)

90 
i
=0; i < 16; i++)

92 ià((*
šputPŒ
++) != 0)

94  
Œue
;

97  
çl£
;

98 
	}
}

100 
boŞ
 
	$Backw¬d16Pix–sNÚWh™e
(
BYTE
 * 
šputPŒ
)

104 
i
=0; i < 16; i++)

106 ià((*
šputPŒ
--) !=0 )

108  
Œue
;

111  
çl£
;

112 
	}
}

113 
g‘OuutWidth
();

115 * 
	gE¼Buff
[6];

117 
	gnNextRa¡”
;

119 
	gfRa¡”Odd
;

120 cÚ¡ * 
	gfBÏckFEDResPŒ
;

121 cÚ¡ * 
	gfCŞÜFEDResPŒ
;

123 
	gAdju¡edIÅutWidth
;

124 
Pix–MuÉly
(* 
bufãr
, 
width
, 
çùÜ
);

126 
	giCŞÜ
, 
	giRow
, 
	giPÏÃ
;

127 
PÏÃCouÁ
();

129 
boŞ
 
	g¡¬‹d
;

131 
BYTE
* 
	g‹mpBufãr
;

132 
BYTE
* 
	g‹mpBufãr2
;

133 
BYTE
* 
	gÜigš®KD©a
;

134 
	goddb™s
;

135 
CËªOddB™s
(
iCŞÜ
, 
iRow
);

137 
ušt32_t
 
	ghŞd_¿ndom
;

138 
šlše
 
BYTE
 
	$RªdomNumb”
()

140 
hŞd_¿ndom
 = (hold_random * 214013) + 2531011;

141  (
BYTE
)((
hŞd_¿ndom
 >> 16) & 0xFF);

142 
	}
}

145 
	sTHTD™h”P¬ms


147 
	gfNumPix
;

148 
BYTE
 * 
	gfIÅut
;

149 
BYTE
 * 
	gfOuut1
;

150 
BYTE
 * 
	gfOuut2
;

151 
BYTE
 * 
	gfOuut3
;

153 cÚ¡ 
BYTE
 * 
	gfFEDResPŒ
;

155 * 
	gfE¼
;

156 
	gfRa¡”Ev’OrOdd
;

158 
boŞ
 
	gfSymm‘ricFÏg
;

160 
boŞ
 
	gfHife
;

162 
	gfM©rixRowSize
;

163 
BYTE
 * 
	gfM©rixV1
;

164 
	gfD™h”C–lOff£t
;

165 
	gfSqu“zeOff£t
;

167 * 
	gfWeightTabËPŒ
;

168 
	gfOff£tPick
;

169 
boŞ
 
	gfV”tiÿlExpFÏg
;

170 } 
	tTHTD™h”P¬ms
, *
	tTHTD™h”P¬msPŒ
;

172 
boŞ
 
	gu£m©rix
;

174 
DRIVER_ERROR
 
HTMATRIXHI_KCMY
(
THTD™h”P¬msPŒ
 
d™h”P¬msPŒ
, 
couÁ
);

176 
BYTE
 
	$HPRªd
()

177 { 
BYTE
 
b
=
	`RªdomNumb”
(è% 74; b+ğ5;  b; 
	}
}

180 
HTEDiffO³n
 (
THTD™h”P¬msPŒ
 
d™h”P¬msPŒ
,

181 
couÁ
);

183 
THTD™h”P¬ms
 
	gfD™h”P¬ms
[6];

185 
THTD™h”P¬msPŒ
 
	gd™h”P¬ms
;

186 
	gtÚe
;

187 *
	gdiffusiÚE¼ÜPŒ
;

188 
	gtmpShÜtStÜe
;

189 
BYTE
 
	g¿¡”By‹1
, 
	g¿¡”By‹2
, 
	g¿¡”By‹3
;

190 
BYTE
 
	gËv–
;

191 
	gpix–CouÁ
;

192 
	gthV®ue
;

194 *
	g”rPŒ
;

195 
	gnumLoİ
;

197 
BYTE
 *
	gšputPŒ
;

198 
BYTE
 *
	gouutPŒ1
;

199 
BYTE
 *
	gouutPŒ2
;

200 
BYTE
 *
	gouutPŒ3
;

202 cÚ¡ 
BYTE
 *
	gãdResTbl
;

203 cÚ¡ 
BYTE
 *
	gãdResPŒ
;

205 
boŞ
 
	gsymm‘ricFÏg
;

207 
boŞ
 
	gdoNext8Pix–s
;

209 
boŞ
 
	ghife
;

211 
BACKWARD_FED
(
th»shŞdV®ue
, 
b™Mask
);

212 
FORWARD_FED
(
th»shŞdV®ue
, 
b™Mask
);

	@prnt/hpcups/Hbpl1.cpp

36 
	~<dlfú.h
>

37 
	~"Hb¶1.h
"

38 
	~"uts.h
"

39 
	#ZJC_BAND_HEIGHT
 100

	)

40 
	#ON
 1

	)

41 
	#OFF
 0

	)

42 
	#COLOR
 0

	)

43 
	#BLACKONLY
 1

	)

44 
	#GRAYSCALE
 2

	)

46 
	gHb¶1W¿µ”
* (*
	gåŒ_ü—‹
)(
Hb¶1
* cÚ¡ 
	gm_Hb¶1
);

47 (*
åŒ_de¡roy
)(
Hb¶1W¿µ”
*);

48 
Hb¶1
::
	$Hb¶1
 (è: 
	$EnÿpsuÏtÜ
 ()

50 
	`mem£t
(&
m_PM
, 0, (m_PM));

51 
	`¡rıy
(
m_szLªguage
, "HBPL1");

52 
	`dbglog
("Hb¶1 cÚ¡ruùÜ : m_szLªguagğ%s", 
m_szLªguage
);

53 
m_numSÿnLšes
 = -1;

54 
m_nSÿnLšeCouÁ
 = 0;

55 
m_nSŒSize
 = 0;

56 
m_nSŒHeight
 = 
HBPL1_DEFAULT_STRIP_HEIGHT
;

57 
m_nBªdCouÁ
 = 0;

58 
m_pbySŒD©a
 = 
NULL
;

59 
m_š™
 = 
çl£
;

60 
m_CŞÜMode
 = 
COLORTYPE_BOTH
;

61 
m_CŞÜTheme
 = 
NONE
;

75 
m_pHb¶1W¿µ”
 = 
Ãw
 
	`Hb¶1W¿µ”
(
this
);

76 if(
m_pHb¶1W¿µ”
 =ğ
NULL
)

77 
m_š™
 = 
çl£
;

79 
m_š™
 = 
Œue
;

80 
	}
}

82 
	gHb¶1
::~
	$Hb¶1
()

84 ià(
m_pbySŒD©a
)

86 
d–‘e
 [] 
m_pbySŒD©a
;

87 
m_pbySŒD©a
 = 
NULL
;

91 if(
m_š™
)

93 if(
åŒ_de¡roy
)

94 
	`åŒ_de¡roy
Ğ
m_pHb¶1W¿µ”
 );

99 
	}
}

102 
DRIVER_ERROR
 
	gHb¶1
::
	$addJobS‘tšgs
()

104 
DRIVER_ERROR
 
”r
 = 
NO_ERROR
;

105  
”r
;

106 
	}
}

109 
DRIVER_ERROR
 
	gHb¶1
::
	$CÚfigu»
(
P–še
 **
p–še
)

111 
DRIVER_ERROR
 
”r
 = 
NO_ERROR
;

112  
”r
;

113 
	}
}

115 
DRIVER_ERROR
 
	gHb¶1
::
	$S¹Job
(
Sy¡emS”viûs
 *
pSy¡emS”viûs
, 
JobA‰ribu‹s
 *
pJA
)

117 
DRIVER_ERROR
 
”r
 = 
NO_ERROR
;

119 ià(!
m_š™
)

121  
PLUGIN_LIBRARY_MISSING
;

124 
	`memıy
(&
m_JA
, 
pJA
,(m_JA));

125 
m_nSÿnLšeSize
 = 
m_JA
.
medŸ_©Œibu‹s
.
´šbË_width
;

126 
m_nSŒSize
 = 
m_nSÿnLšeSize
 * 3 * 
m_nSŒHeight
;

127 
m_numSŒs
 = 
m_JA
.
medŸ_©Œibu‹s
.
´šbË_height
/
m_nSŒHeight
;

128 
m_EcÚomode
 = (
m_JA
.
š‹g”_v®ues
[2] =ğ
ON
è? 
Œue
 : 
çl£
;

129 
m_CŞÜTheme
 = (
COLORTHEME
)
m_JA
.
š‹g”_v®ues
[5];

130 
m_PrštšG¿ysÿË
 = 
m_JA
.
š‹g”_v®ues
[3];

131 
m_pSy¡emS”viûs
 = 
pSy¡emS”viûs
;

132 
”r
 = 
m_pHb¶1W¿µ”
->
	`S¹Job
((**)&
m_pOutBufãr
, &
m_OutBuffSize
);

133 
”r
 = 
	`£ndBufãr
(
¡©ic_ÿ¡
<cÚ¡ 
BYTE
 *>(
m_pOutBufãr
), 
m_OutBuffSize
);

134 
m_pHb¶1W¿µ”
->
	`F»eBufãr
(
m_pOutBufãr
, 
m_OutBuffSize
);

136 ià(
m_PrštšG¿ysÿË
 =ğ
ON
){

137 
m_CŞÜMode
 = 
COLORTYPE_BOTH
;

138 } if(
m_JA
.
cŞÜ_mode
 =ğ
COLOR
){

139 
m_CŞÜMode
 = 
COLORTYPE_COLOR
;

140 } if(
m_JA
.
cŞÜ_mode
 =ğ
BLACKONLY
){

141 
m_CŞÜMode
 = 
COLORTYPE_BLACK
;

143 
m_CŞÜMode
 = 
COLORTYPE_BOTH
;

145  
”r
;

146 
	}
}

149 
DRIVER_ERROR
 
	gHb¶1
::
	$EndJob
()

151 
DRIVER_ERROR
 
”r
 = 
NO_ERROR
;

153 ià(!
m_š™
)

155  
PLUGIN_LIBRARY_MISSING
;

158 
”r
 = 
m_pHb¶1W¿µ”
->
	`EndJob
((**)&
m_pOutBufãr
, &
m_OutBuffSize
);

159 
”r
 = 
	`£ndBufãr
(
¡©ic_ÿ¡
<cÚ¡ 
BYTE
 *>(
m_pOutBufãr
), 
m_OutBuffSize
);

160 
m_pHb¶1W¿µ”
->
	`F»eBufãr
(
m_pOutBufãr
, 
m_OutBuffSize
);

161  
”r
;

162 
	}
}

165 
DRIVER_ERROR
 
	gHb¶1
::
	$S¹Page
 (
JobA‰ribu‹s
 *
pJA
)

167 
DRIVER_ERROR
 
”r
 = 
NO_ERROR
;

169 
”r
 = 
m_pHb¶1W¿µ”
->
	`S¹Page
((**)&
m_pOutBufãr
, &
m_OutBuffSize
);

170 
”r
 = 
	`£ndBufãr
(
¡©ic_ÿ¡
<cÚ¡ 
BYTE
 *>(
m_pOutBufãr
), 
m_OutBuffSize
);

171 
m_pHb¶1W¿µ”
->
	`F»eBufãr
(
m_pOutBufãr
, 
m_OutBuffSize
);

172  
”r
;

173 
	}
}

178 
DRIVER_ERROR
 
	gHb¶1
::
	$£ndBÏnkBªds
()

180 
DRIVER_ERROR
 
”r
 = 
NO_ERROR
;

181  
”r
;

182 
	}
}

184 
DRIVER_ERROR
 
	gHb¶1
::
	$FÜmF“d
 ()

187 ià(0 !ğ
m_numSÿnLšes
 && 
m_pbySŒD©a
 && 0 !ğ
m_nSŒSize
)

189 ++
m_nBªdCouÁ
;

190 
m_pHb¶1W¿µ”
->
	`EnÿpsuÏ‹
(
m_pbySŒD©a
, 
m_nSŒSize
, 
m_nSŒHeight
, (**)&
m_pOutBufãr
, &
m_OutBuffSize
);

191 
	`£ndBufãr
(
m_pOutBufãr
, 
m_OutBuffSize
);

192 
	`mem£t
(
m_pbySŒD©a
,0xFF,
m_nSŒSize
);

195 
m_nBªdCouÁ
 < 
m_numSŒs
)

197 ++
m_nBªdCouÁ
;

198 
m_pHb¶1W¿µ”
->
	`EnÿpsuÏ‹
(
m_pbySŒD©a
, 
m_nSŒSize
, 
m_nSŒHeight
, (**)&
m_pOutBufãr
, &
m_OutBuffSize
);

199 
	`£ndBufãr
(
m_pOutBufãr
, 
m_OutBuffSize
);

202 
m_pHb¶1W¿µ”
->
	`EndPage
((**)&
m_pOutBufãr
, &
m_OutBuffSize
);

203 
	`£ndBufãr
(
m_pOutBufãr
, 
m_OutBuffSize
);

204 
m_pHb¶1W¿µ”
->
	`F»eBufãr
(
m_pOutBufãr
,
m_OutBuffSize
);

205 
m_nBªdCouÁ
 = 0;

207  
NO_ERROR
;

209 
	}
}

212 
DRIVER_ERROR
 
	gHb¶1
::
	$EnÿpsuÏ‹
 (
RASTERDATA
 *
IÅutRa¡”
, 
boŞ
 
bLa¡PÏÃ
)

214 
DRIVER_ERROR
 
”r
 = 
NO_ERROR
;

216 ++
m_nSÿnLšeCouÁ
;

218 iàĞ
m_numSÿnLšes
 == -1)

220 if(()
m_JA
.
medŸ_©Œibu‹s
.
´šbË_height
 % 
m_nSŒHeight
)

221 
m_numSŒs
++;

222 
”r
 = 
m_pHb¶1W¿µ”
->
	`In™SŒBufãr
(
m_nSÿnLšeSize
 * 3 * 
m_nSŒHeight
);

225 ià(
m_numSÿnLšes
 < 
m_nSŒHeight
 && 
m_pbySŒD©a
)

227 
	`memıy
((
BYTE
*)&(
m_pbySŒD©a
[
m_numSÿnLšes
 * 
m_nSÿnLšeSize
 * 3]),
IÅutRa¡”
->
¿¡”d©a
[
COLORTYPE_COLOR
],IÅutRa¡”->
¿¡”size
[COLORTYPE_COLOR]);

228 
m_numSÿnLšes
++;

231 ià(
m_numSÿnLšes
 >ğ
m_nSŒHeight
 && 
m_pbySŒD©a
)

233 ++
m_nBªdCouÁ
;

234 
m_pHb¶1W¿µ”
->
	`EnÿpsuÏ‹
(
m_pbySŒD©a
, 
m_nSŒSize
, 
m_nSŒHeight
, (**)&
m_pOutBufãr
, &
m_OutBuffSize
);

235 
	`mem£t
(
m_pbySŒD©a
,0xFF,
m_nSŒSize
);

236 
m_numSÿnLšes
 = 0;

237 
”r
 = 
	`£ndBufãr
(
¡©ic_ÿ¡
<cÚ¡ 
BYTE
 *>(
m_pOutBufãr
), 
m_OutBuffSize
);

238 
m_pHb¶1W¿µ”
->
	`F»eBufãr
(
m_pOutBufãr
, 
m_OutBuffSize
);

241  
”r
;

242 
	}
}

	@prnt/hpcups/Hbpl1.h

34 #iâdeà
HBPL1_H


35 
	#HBPL1_H


	)

36 
	~"CommÚDefš™iÚs.h
"

37 
	~"P–še.h
"

38 
	~"EnÿpsuÏtÜ.h
"

39 
	~"CŞÜM©ch”.h
"

40 
	~"H®áÚ”.h
"

41 
	~"»sourûs.h
"

42 
	~"CŞÜM­s.h
"

43 
	~"Prš‹rCommªds.h
"

44 
	~"Uts.h
"

45 
	~"Hb¶1_W¿µ”.h
"

46 
	#HBPL1_DEFAULT_STRIP_HEIGHT
 128

	)

48 
şass
 
	gHb¶1W¿µ”
;

50 
	eCOLORTHEME


52 
	mNONE
 = 0,

53 
	mDEFAULTSRGB
 = 1,

54 
	mPHOTOSRGB
 = 2,

55 
	mADOBERGB
 = 3,

56 
	mVIVIDSRGB
 = 4

59 şas 
	cHb¶1
 : 
public
 
EnÿpsuÏtÜ


62 
ä›nd
 
şass
 
Hb¶1W¿µ”
;

64 
	mpublic
:

65 
Hb¶1
 ();

66 ~
Hb¶1
 ();

67 
DRIVER_ERROR
 
EnÿpsuÏ‹
 (
RASTERDATA
 *
IÅutRa¡”
, 
boŞ
 
bLa¡PÏÃ
);

68 
DRIVER_ERROR
 
S¹Page
(
JobA‰ribu‹s
 *
pJA
);

69 
DRIVER_ERROR
 
S¹Job
(
Sy¡emS”viûs
*, 
JobA‰ribu‹s
*);

70 
DRIVER_ERROR
 
CÚfigu»
(
P–še
 **
p–še
);

71 
DRIVER_ERROR
 
FÜmF“d
();

72 
DRIVER_ERROR
 
EndJob
();

73 
DRIVER_ERROR
 
	$S’dCAPy
(
iOff£t
è{ 
NO_ERROR
;}

74 
boŞ
 
	$CªSkRa¡”s
(è{ 
çl£
;
	}
}

76 
	g´Ùeùed
:

77 
DRIVER_ERROR
 
	$æushPrš‹rBufãr
(è{ 
NO_ERROR
;
	}
}

78 
vœtu®
 
DRIVER_ERROR
 
addJobS‘tšgs
();

80 
	g´iv©e
:

81 
DRIVER_ERROR
 
EndPage
 ();

82 
DRIVER_ERROR
 
£ndBÏnkBªds
();

83 
PrštMode
 
	gm_PM
;

84 
	gm_iCurRa¡”
;

85 
	gm_iPÏÃNumb”
;

86 
	gm_iBµ
;

87 
	gm_iPÏÃs
;

88 
	gm_nSŒSize
;

89 
	gm_nSŒHeight
;

90 
	gm_nBªdCouÁ
;

91 
	gm_numSÿnLšes
;

92 
	gm_nSÿnLšeCouÁ
;

93 
	gm_nSÿnLšeSize
;

94 
	gm_numSŒs
;

95 
BYTE
 *
	gm_pbySŒD©a
;

96 
BYTE
 *
	gm_pOutBufãr
;

97 
	gm_OutBuffSize
;

98 
JobA‰ribu‹s
 
	gm_JA
;

99 *
	gm_hHPLibHªdË
;

100 
boŞ
 
	gm_š™
;

101 
boŞ
 
	gm_EcÚomode
;

102 
boŞ
 
	gm_PrštšG¿ysÿË
;

103 
COLORTHEME
 
	gm_CŞÜTheme
;

104 
COLORTYPE
 
	gm_CŞÜMode
;

105 
Hb¶1W¿µ”
 *
	gm_pHb¶1W¿µ”
;

	@prnt/hpcups/Hbpl1_Wrapper.cpp

19 
	~"Hb¶1.h
"

20 
	~"PCLmG’”©Ü.h
"

22 "C" 
Hb¶1W¿µ”
* 
	$ü—‹_objeù
(
Hb¶1
* cÚ¡ 
m_Hb¶1
)

24  
Ãw
 
	`Hb¶1W¿µ”
(
m_Hb¶1
);

25 
	}
}

27 "C" 
	$de¡roy_objeù
Ğ
Hb¶1W¿µ”
* 
objeù
 )

29 if(
objeù
)

30 
d–‘e
 
objeù
;

31 
	}
}

33 
PCLmG’”©Ü
 *
m_pPCLmG’”©Ü
;

36 
	gHb¶1W¿µ”
::
	$Hb¶1W¿µ”
(
Hb¶1
* cÚ¡ 
m_Hb¶1
)

38 
o_Hb¶1
 = 
m_Hb¶1
;

39 
o_Hb¶1
->
m_pbySŒD©a
 = 
NULL
;

41 
m_pPCLmG’”©Ü
 = 
Ãw
 
	`PCLmG’”©Ü
();

42 
	}
}

44 
	gHb¶1W¿µ”
::~
	$Hb¶1W¿µ”
()

46 
d–‘e
 
m_pPCLmG’”©Ü
;

47 
	}
}

50 
DRIVER_ERROR
 
	gHb¶1W¿µ”
::
	$In™SŒBufãr
(
NoOfBy‹s
)

52 
DRIVER_ERROR
 
”r
 = 
NO_ERROR
;

53 
o_Hb¶1
->
m_nSŒSize
 = 
NoOfBy‹s
;

55 
o_Hb¶1
->
m_pbySŒD©a
 = 
Ãw
 
BYTE
[o_Hb¶1->
m_nSŒSize
];

56 if(
NULL
 =ğ
o_Hb¶1
->
m_pbySŒD©a
)

58 
”r
 = 
SYSTEM_ERROR
;

60 
	`mem£t
(
o_Hb¶1
->
m_pbySŒD©a
,0xFF,o_Hb¶1->
m_nSŒSize
);

61 
o_Hb¶1
->
m_numSÿnLšes
 = 0;

62  
”r
;

63 
	}
}

66 
	gHb¶1W¿µ”
::
	$F»eSŒBufãr
()

68 if(
o_Hb¶1
->
m_pbySŒD©a
)

70 
d–‘e
 [] 
o_Hb¶1
->
m_pbySŒD©a
;

71 
o_Hb¶1
->
m_pbySŒD©a
 = 
NULL
;

73 
o_Hb¶1
->
m_nSŒSize
 = 0;

74 
o_Hb¶1
->
m_numSÿnLšes
 = -1;

75 
	}
}

78 
DRIVER_ERROR
 
	gHb¶1W¿µ”
::
	$S¹Job
(**
pOutBufãr
, *
pOutBufãrSize
)

80 
DRIVER_ERROR
 
”r
 = 
NO_ERROR
;

82 
m_pPCLmG’”©Ü
->
	`S¹Job
(
pOutBufãr
,
pOutBufãrSize
,
çl£
);

83  
”r
;

84 
	}
}

87 
DRIVER_ERROR
 
	gHb¶1W¿µ”
::
	$EndJob
(**
pOutBufãr
, *
pOutBufãrSize
)

89 
DRIVER_ERROR
 
”r
 = 
NO_ERROR
;

91 
m_pPCLmG’”©Ü
->
	`EndJob
(
pOutBufãr
,
pOutBufãrSize
);

92  
”r
;

93 
	}
}

96 
DRIVER_ERROR
 
	gHb¶1W¿µ”
::
	$S¹Page
(**
pOutBufãr
, *
pOutBufãrSize
)

98 
DRIVER_ERROR
 
”r
 = 
NO_ERROR
;

99 
PCLmPageS‘up
 
PCLmPageCÚ‹Á
;

100 
PCLmSU£rS‘tšgsTy³
 
PCLmSS‘tšgs
;

101 
PCLmSS‘up
 
PCLmSCÚ‹Á
;

102 
PCLmSCÚ‹Á
.
PCLmPageCÚ‹Á
 = &PCLmPageContent;

103 
PCLmSCÚ‹Á
.
PCLmSU£rS‘tšgs
 = &
PCLmSS‘tšgs
;

104 
PCLmPageCÚ‹Á
.
medŸHeight
 = 
o_Hb¶1
->
m_JA
.
medŸ_©Œibu‹s
.
physiÿl_height
;

105 
PCLmPageCÚ‹Á
.
medŸWidth
 = 
o_Hb¶1
->
m_JA
.
medŸ_©Œibu‹s
.
physiÿl_width
;

106 
PCLmPageCÚ‹Á
.
medŸWidthOff£t
 = 
o_Hb¶1
->
m_JA
.
medŸ_©Œibu‹s
.
´šbË_¡¬t_x
;

107 
PCLmPageCÚ‹Á
.
medŸHeightOff£t
 = 
o_Hb¶1
->
m_JA
.
medŸ_©Œibu‹s
.
´šbË_¡¬t_y
;

108 
PCLmPageCÚ‹Á
.
sourûWidth
 = 
o_Hb¶1
->
m_JA
.
medŸ_©Œibu‹s
.
´šbË_width
;

109 
PCLmPageCÚ‹Á
.
sourûHeight
 = 
o_Hb¶1
->
m_JA
.
medŸ_©Œibu‹s
.
´šbË_height
;

110 
PCLmPageCÚ‹Á
.
¡rHeight
 = 
o_Hb¶1
->
m_nSŒHeight
;

111 
PCLmPageCÚ‹Á
.
compTy³Reque¡ed
 = 
com´essFÏ‹
;

112 
	`¡ºıy
(
PCLmPageCÚ‹Á
.
medŸSizeName
, 
o_Hb¶1
->
m_JA
.
medŸ_©Œibu‹s
.
PageSizeName
, (PCLmPageContent.mediaSizeName)-1);

113 
	`¡ºıy
(
PCLmSS‘tšgs
.
u£rMedŸTy³
, 
o_Hb¶1
->
m_JA
.
medŸ_©Œibu‹s
.
MedŸTy³Name
, (PCLmSSettings.userMediaType)-1);

114 
PCLmSS‘tšgs
.
u£rIÅutBš
 = (
jobIÅutBš
)
o_Hb¶1
->
m_JA
.
medŸ_sourû
;

115 
PCLmSS‘tšgs
.
jobid
 = 
o_Hb¶1
->
m_JA
.
job_id
;

116 
	`¡ºıy
(
PCLmSS‘tšgs
.
u£r_Çme
, 
o_Hb¶1
->
m_JA
.user_name, (PCLmSSettings.user_name)-1);

117 
	`¡ºıy
(
PCLmSS‘tšgs
.
d©‘ime
, 
o_Hb¶1
->
m_JA
.
job_¡¬t_time
, (PCLmSSettings.datetime));

119 
o_Hb¶1
->
m_CŞÜMode
)

121 
COLORTYPE_COLOR
: 
PCLmPageCÚ‹Á
.
d¡CŞÜS·ûS³fiÿtiÚ
 = 
deviûRGB
;

122 
PCLmPageCÚ‹Á
.
compTy³Reque¡ed
 = 
com´essFÏ‹
;

124 
COLORTYPE_BLACK
: 
PCLmPageCÚ‹Á
.
d¡CŞÜS·ûS³fiÿtiÚ
 = 
bÏckÚly
;

125 
PCLmPageCÚ‹Á
.
compTy³Reque¡ed
 = 
com´essFÏ‹
;

127 : 
PCLmPageCÚ‹Á
.
d¡CŞÜS·ûS³fiÿtiÚ
 = 
g¿ySÿË
;

128 
PCLmPageCÚ‹Á
.
compTy³Reque¡ed
 = 
com´essRLE
;

131 
o_Hb¶1
->
m_JA
.
qu®™y_©Œibu‹s
.
hÜizÚl_»sŞutiÚ
)

134 
PCLmPageCÚ‹Á
.
de¡š©iÚResŞutiÚ
 = 
»s300
;

137 
PCLmPageCÚ‹Á
.
de¡š©iÚResŞutiÚ
 = 
»s1200
;

140 
PCLmPageCÚ‹Á
.
de¡š©iÚResŞutiÚ
 = 
»s600
;

143 
o_Hb¶1
->
m_CŞÜTheme
)

145 
DEFAULTSRGB
 : 
PCLmSS‘tšgs
.
cŞÜTheme
 = 
deçuÉ_cŞÜtheme
; ;

146 
PHOTOSRGB
 : 
PCLmSS‘tšgs
.
cŞÜTheme
 = 
phÙosRGB
; ;

147 
ADOBERGB
 : 
PCLmSS‘tšgs
.
cŞÜTheme
 = 
phÙoAdobeRGB
; ;

148 
VIVIDSRGB
 : 
PCLmSS‘tšgs
.
cŞÜTheme
 = 
vividsRGB
; ;

149  : 
PCLmSS‘tšgs
.
cŞÜTheme
 = 
nÚe
;

153 
PCLmSS‘tšgs
.
u£rOuutBš
 = 
tİ_ouut
;

156 
PCLmSS‘tšgs
.
u£rCİ›s
 = 1;

161 
	`¡ºıy
(
PCLmSS‘tšgs
.
u£rDocum’tName
,
o_Hb¶1
->
m_JA
.
job_t™Ë
,(PCLmSSettings.userDocumentName));

165 ià(
o_Hb¶1
->
m_EcÚomode
)

166 
	`¡ºıy
(
PCLmSS‘tšgs
.
u£rPageQu®™y
, "draft", (PCLmSSettings.userPageQuality)-1);

168 
	`¡ºıy
(
PCLmSS‘tšgs
.
u£rPageQu®™y
, 
o_Hb¶1
->
m_JA
.
qu®™y_©Œibu‹s
.
hb¶1_´št_qu®™y
, (PCLmSSettings.userPageQuality)-1);

171 
PCLmSS‘tšgs
.
u£rOr›Á©iÚ
 = 
pÜŒa™Or›Á©iÚ
;

174 
PCLmPageCÚ‹Á
.
du¶exDi¥os™iÚ
 = 
sim¶ex
;

176 
m_pPCLmG’”©Ü
->
	`S¹Page
(&
PCLmSCÚ‹Á
,
Œue
,
pOutBufãr
,
pOutBufãrSize
);

179  
”r
;

180 
	}
}

183 
DRIVER_ERROR
 
	gHb¶1W¿µ”
::
	$EndPage
(**
pOutBufãr
, *
pOutBufãrSize
)

185 
DRIVER_ERROR
 
”r
 = 
NO_ERROR
;

186 
m_pPCLmG’”©Ü
->
	`EndPage
(
pOutBufãr
, 
pOutBufãrSize
);

187  
”r
;

188 
	}
}

191 
DRIVER_ERROR
 
	gHb¶1W¿µ”
::
	$FÜmF“d
()

193  
NO_ERROR
;

194 
	}
}

196 
DRIVER_ERROR
 
	gHb¶1W¿µ”
::
	$EnÿpsuÏ‹
 (*
pInBufãr
, 
šBufãrSize
, 
numLšes
, **
pOutBufãr
, *
pOutBufãrSize
)

198 
DRIVER_ERROR
 
”r
 = 
NO_ERROR
;

199 
m_pPCLmG’”©Ü
->
	`EnÿpsuÏ‹
(
pInBufãr
, 
šBufãrSize
, 
numLšes
, 
pOutBufãr
, 
pOutBufãrSize
);

200  
”r
;

201 
	}
}

203 
DRIVER_ERROR
 
	gHb¶1W¿µ”
::
	$SkLšes
 (
iSkLšes
)

205 
DRIVER_ERROR
 
”r
 = 
NO_ERROR
;

206  
”r
;

207 
	}
}

209 
	gHb¶1W¿µ”
::
	$F»eBufãr
 (*
pBufãr
, 
bufSize
)

211 ià(
bufSize
 >= 0)

213 
m_pPCLmG’”©Ü
->
	`F»eBufãr
(
pBufãr
);

217 
	}
}

	@prnt/hpcups/Hbpl1_Wrapper.h

35 #iâdeà
HBPL1_WRAPPER_H


36 
	#HBPL1_WRAPPER_H


	)

37 
	~"CommÚDefš™iÚs.h
"

38 
	~"Hb¶1.h
"

41 
şass
 
	gHb¶1
;

43 şas 
	cHb¶1W¿µ”


45 
ä›nd
 
şass
 
	mHb¶1
;

46 
	mpublic
:

47 
Hb¶1W¿µ”
(
Hb¶1
* cÚ¡ 
m_Hb¶1
);

48 ~
Hb¶1W¿µ”
 ();

50 
vœtu®
 
DRIVER_ERROR
 
S¹Job
(**
pOutBufãr
, *
iOutBufãrSize
);

51 
vœtu®
 
DRIVER_ERROR
 
EndJob
(**
pOutBUfãr
, *
iOutBifãrSize
);

52 
vœtu®
 
DRIVER_ERROR
 
S¹Page
(**
pOutBufãr
, *
iOutBufãrSize
);

53 
vœtu®
 
DRIVER_ERROR
 
EndPage
(**
pOutBufãr
, *
iOutBufãrSize
);

54 
vœtu®
 
DRIVER_ERROR
 
EnÿpsuÏ‹
(*
pInBufãr
, 
šBufãrSize
, 
numLšes
, **
pOutBufãr
, *
iOutBufãrSize
);

55 
vœtu®
 
DRIVER_ERROR
 
SkLšes
(
iSkLšes
);

56 
vœtu®
 
F»eBufãr
(*, );

57 
vœtu®
 
DRIVER_ERROR
 
FÜmF“d
();

59 
	m´iv©e
:

60 
vœtu®
 
DRIVER_ERROR
 
In™SŒBufãr
(
NoOfBy‹s
);

61 
vœtu®
 
F»eSŒBufãr
();

62 
Hb¶1
 *
	mo_Hb¶1
;

	@prnt/hpcups/ImageProcessor.h

1 #iâdeà
IMAGE_PROCESSOR_H


2 
	#IMAGE_PROCESSOR_H


	)

4 
	~<cups/¿¡”.h
>

6 #ifdeà
__ılu¥lus


10 
	tBYTE
;

12 
_image_´oûssÜ_hªdË
 
	timage_´oûssÜ_t
;

17 
IPE_SUCCESS
 = 0x00,

18 
IPE_CANCEL
 = 0x01,

19 
IPE_GENERAL_ERROR
 = 0x02,

20 
IPE_MEM_ERROR
 = 0x03,

21 
IPE_NULL_PTR
 = 0x04,

24 
IPE_LIBRARY_MISSING
 = 0x30,

26 } 
	tIMAGE_PROCESSOR_ERROR
;

28 
image_´oûssÜ_t
* 
imageProûssÜC»©e
();

29 
imageProûssÜDe¡roy
(
image_´oûssÜ_t
*);

30 
IMAGE_PROCESSOR_ERROR
 
imageProûssÜS¹Page
 (
image_´oûssÜ_t
*, 
cups_·ge_h—d”2_t
* 
cups_h—d”
);

31 
IMAGE_PROCESSOR_ERROR
 
imageProûssÜProûssLše
(
image_´oûssÜ_t
*, 
BYTE
* 
pLšeBufãr
, 
bufãrSize
);

32 
IMAGE_PROCESSOR_ERROR
 
imageProûssÜEndPage
 (
image_´oûssÜ_t
*);

34 #ifdeà
__ılu¥lus


	@prnt/hpcups/Job.cpp

31 
	~"Job.h
"

33 
	gJob
::
	$Job
() :

34 
	`m_pSys
(
NULL
),

35 
	`m_pP–še
(
NULL
),

36 
	`m_pEnÿp
(
NULL
),

37 
	`skcouÁ
(0),

38 
	`m_pBÏnkRa¡”
(
NULL
),

39 
	`m_pBÏckRa¡”
(
NULL
),

40 
	`m_bD©aS’t
(
çl£
),

41 
	`m_iRa¡”
(0),

42 
	$m_iBÏnks
(0)

44 
	}
}

46 
DRIVER_ERROR
 
	gJob
::
	$In™
(
Sy¡emS”viûs
 *
pSy¡emS”viûs
, 
JobA‰ribu‹s
 *
job_©Œs
, 
EnÿpsuÏtÜ
 *
’ÿp_štf
)

48 
DRIVER_ERROR
 
”r
 = 
NO_ERROR
;

50 ià(
’ÿp_štf
 =ğ
NULL
) {

51  
NO_PRINTER_SELECTED
;

54 
m_pEnÿp
 = 
’ÿp_štf
;

55 
m_pSys
 = 
pSy¡emS”viûs
;

58 
	`memıy
(&
m_job_©Œibu‹s
, 
job_©Œs
, (m_job_attributes));

60 
”r
 = 
m_pEnÿp
->
	`S¹Job
(
m_pSys
, &
m_job_©Œibu‹s
);

62 ià(
”r
 =ğ
NO_ERROR
)

63 
”r
 = 
	`CÚfigu»
();

66 ià(
”r
 =ğ
NO_ERROR
)

67 
”r
 = 
	`£tBÏnkRa¡”
();

68  
”r
;

69 
	}
}

75 
DRIVER_ERROR
 
	gJob
::
	$S¹Page
(
JobA‰ribu‹s
 *
job_©Œs
)

78 ià(
job_©Œs
) {

79 
	`memıy
(&
m_job_©Œibu‹s
, 
job_©Œs
, (m_job_attributes));

81  
m_pEnÿp
->
	`S¹Page
(&
m_job_©Œibu‹s
);

82 
	}
}

84 
DRIVER_ERROR
 
	gJob
::
	$CËªup
()

88 
DRIVER_ERROR
 
”r
 = 
NO_ERROR
;

95 ià(
m_pEnÿp
) {

96 
”r
 = 
m_pEnÿp
->
	`CËªup
();

99 ià(
”r
 !ğ
NO_ERROR
) {

100  
”r
;

103 ià(
m_bD©aS’t
 || 
”r
 !ğ
NO_ERROR
) {

104 
	`NewPage
();

108 ià(
m_pEnÿp
) {

109 
m_pEnÿp
->
	`EndJob
();

111  
NO_ERROR
;

112 
	}
}

114 
	gJob
::
	$CªûlJob
()

116 ià(
m_pEnÿp
)

117 
m_pEnÿp
->
	`CªûlJob
();

118 
	}
}

120 
	gJob
::~
	$Job
()

122 ià(
m_pBÏckRa¡”
) {

123 
d–‘e
 [] 
m_pBÏckRa¡”
;

126 ià(
m_pBÏnkRa¡”
) {

127 
d–‘e
 [] 
m_pBÏnkRa¡”
;

130 
P–še
 *
p
;

131 
P–še
 *
p2
;

132 
p
 = 
m_pP–še
;

133 
p
)

135 
p2
 = 
p
;

136 
p
 =…->
Ãxt
;

137 
d–‘e
 
p2
->
Exec
;

138 
d–‘e
 
p2
;

141 ià(
m_pEnÿp
) {

142 
d–‘e
 
m_pEnÿp
;

145 
	}
}

147 
	gJob
::
	$uÅackB™s
(
BYTE
 *
BÏckImageD©a
)

150 
b™æag
[] = {0x80, 0x40, 0x20, 0x10, 0x08, 0x04, 0x02, 0x01};

151 
width
 = (
m_job_©Œibu‹s
.
medŸ_©Œibu‹s
.
´šbË_width
 + 7) / 8;

152 
i
 = 0; i < 
width
; i++)

154 
j
 = 0; j < 8; j++)

156 ià(
BÏckImageD©a
[
i
] & 
b™æag
[
j
])

157 
m_pBÏckRa¡”
[
i
*8+
j
] = 1;

160 
	}
}

162 
DRIVER_ERROR
 
	gJob
::
	$S’dRa¡”s
(
BYTE
* 
BÏckImageD©a
, BYTE* 
CŞÜImageD©a
)

164 
DRIVER_ERROR
 
”r
 = 
NO_ERROR
;

165 ià(
m_pP–še
 =ğ
NULL
) {

166  
SYSTEM_ERROR
;

169 ià(
BÏckImageD©a
 =ğ
NULL
 && 
CŞÜImageD©a
 == NULL) {

170 ià(
m_pEnÿp
->
	`CªSkRa¡”s
()) {

171 
skcouÁ
++;

172  
NO_ERROR
;

174 
CŞÜImageD©a
 = 
m_pBÏnkRa¡”
;

177 ià(
skcouÁ
 > 0) {

178 
m_pP–še
->
	`Flush
();

179 
”r
 = 
m_pEnÿp
->
	`S’dCAPy
(
skcouÁ
);

180 
skcouÁ
 = 0;

182 
m_bD©aS’t
 = 
Œue
;

184 ià(
BÏckImageD©a
 || 
CŞÜImageD©a
)

186 ià(
BÏckImageD©a
)

188 ià(
m_pEnÿp
->
	`UÅackB™s
())

190 
”r
 = 
	`£tBÏckRa¡”
();

191 
ERRCHECK
;

192 
	`uÅackB™s
(
BÏckImageD©a
);

193 
BÏckImageD©a
 = 
m_pBÏckRa¡”
;

195 
m_pP–še
->
Exec
->
¿¡”
.
¿¡”size
[
COLORTYPE_BLACK
] = 
m_job_©Œibu‹s
.
medŸ_©Œibu‹s
.
´šbË_width
;

196 
m_pP–še
->
Exec
->
¿¡”
.
¿¡”d©a
[
COLORTYPE_BLACK
] = 
BÏckImageD©a
;

200 
m_pP–še
->
Exec
->
¿¡”
.
¿¡”size
[
COLORTYPE_BLACK
] = 0;

201 
m_pP–še
->
Exec
->
¿¡”
.
¿¡”d©a
[
COLORTYPE_BLACK
] = 
NULL
;

203 ià(
CŞÜImageD©a
)

205 
m_pP–še
->
Exec
->
¿¡”
.
¿¡”size
[
COLORTYPE_COLOR
] = 
m_job_©Œibu‹s
.
medŸ_©Œibu‹s
.
´šbË_width
 * 3;

206 
m_pP–še
->
Exec
->
¿¡”
.
¿¡”d©a
[
COLORTYPE_COLOR
] = 
CŞÜImageD©a
;

210 
m_pP–še
->
Exec
->
¿¡”
.
¿¡”size
[
COLORTYPE_COLOR
] = 0;

211 
m_pP–še
->
Exec
->
¿¡”
.
¿¡”d©a
[
COLORTYPE_COLOR
] = 
NULL
;

213 
”r
 = 
m_pP–še
->
	`Execu‹
(&(m_pP–še->
Exec
->
¿¡”
));

216  
”r
;

217 
	}
}

219 
DRIVER_ERROR
 
	gJob
::
	$NewPage
()

221 
DRIVER_ERROR
 
”r
;

222 
m_pEnÿp
->
	`S‘La¡Bªd
();

224 ià(!
m_bD©aS’t
 && 
skcouÁ
 > 0) {

225 
skcouÁ
 = 0;

226 
	`S’dRa¡”s
(
NULL
, 
m_pBÏnkRa¡”
);

228 
m_pP–še
->
	`Flush
();

229 
”r
 = 
m_pEnÿp
->
	`FÜmF“d
();

230 
ERRCHECK
;

233 
m_bD©aS’t
 = 
çl£
;

234 
skcouÁ
 = 0;

236  
NO_ERROR
;

237 
	}
}

239 
DRIVER_ERROR
 
	gJob
::
	$CÚfigu»
()

242 
DRIVER_ERROR
 
”r
 = 
NO_ERROR
;

243 
P–še
 *
p
;

245 
p
 = 
NULL
;

248 
”r
 = 
m_pEnÿp
->
	`CÚfigu»
(&
m_pP–še
);

249 ià(
”r
 !ğ
NO_ERROR
)

251  
”r
;

256 
Ra¡”S’d”
 *
pS’d”
;

257 
pS’d”
 = 
Ãw
 
	`Ra¡”S’d”
(
m_pEnÿp
);

259 
p
 = 
Ãw
 
	`P–še
(
pS’d”
);

261 ià(
m_pP–še
) {

262 
m_pP–še
->
	`AddPha£
(
p
);

265 
m_pP–še
 = 
p
;

267  
NO_ERROR
;

268 
	}
}

270 
DRIVER_ERROR
 
	gJob
::
	$£tBÏckRa¡”
()

272 ià(!
m_pBÏckRa¡”
) {

273 
m_pBÏckRa¡”
 = 
Ãw
 
BYTE
[
m_job_©Œibu‹s
.
medŸ_©Œibu‹s
.
´šbË_width
];

274 
	`NEWCHECK
(
m_pBÏckRa¡”
);

276 
	`mem£t
(
m_pBÏckRa¡”
, 0, 
m_job_©Œibu‹s
.
medŸ_©Œibu‹s
.
´šbË_width
);

278  
NO_ERROR
;

279 
	}
}

281 
DRIVER_ERROR
 
	gJob
::
	$£tBÏnkRa¡”
()

283 ià(
m_pBÏnkRa¡”
) {

284 
d–‘e
 
m_pBÏnkRa¡”
;

286 
size_t
 
size
 = 
m_job_©Œibu‹s
.
medŸ_©Œibu‹s
.
´šbË_width
 * 3;

287 
m_pBÏnkRa¡”
 = 
Ãw
 
BYTE
[
size
];

288 
	`NEWCHECK
(
m_pBÏnkRa¡”
);

289 
	`mem£t
(
m_pBÏnkRa¡”
, 0xFF, 
size
);

290  
NO_ERROR
;

291 
	}
}

293 
DRIVER_ERROR
 
	gJob
::
	$´eProûssRa¡”D©a
(
cups_¿¡”_t
 **
µcups_¿¡”
, 
cups_·ge_h—d”2_t
* 
fœ¡·ge_cups_h—d”
, * 
pP»Proûs£dRa¡”Fe
)

295 
	`dbglog
 ("DEBUG: Job::preProcessRasterData.............. \n");

296  
m_pEnÿp
->
	`´eProûssRa¡”D©a
(
µcups_¿¡”
, 
fœ¡·ge_cups_h—d”
, 
pP»Proûs£dRa¡”Fe
);

297 
	}
}

	@prnt/hpcups/Job.h

31 #iâdeà
JOB_H


32 
	#JOB_H


	)

34 
	~"EnÿpsuÏtÜ.h
"

35 
	~"P–še.h
"

36 
	~"ProûssÜ.h
"

37 
	~"EnÿpsuÏtÜFaùÜy.h
"

38 
	~"Mode9.h
"

39 
	~"Mode10.h
"

40 
	~"Ra¡”S’d”.h
"

41 şas 
	cJob


43 
	mpublic
:

44 
Job
();

46 
DRIVER_ERROR
 
In™
(
Sy¡emS”viûs
 *
pSy¡emS”viûs
, 
JobA‰ribu‹s
 *
job_©Œs
, 
EnÿpsuÏtÜ
 *
’ÿp_štf
);

47 
DRIVER_ERROR
 
CËªup
();

48 
	mvœtu®
 ~
Job
();

49 
DRIVER_ERROR
 
S’dRa¡”s
(
BYTE
* 
BÏckImageD©a
=(BYTE*)
NULL
, BYTE* 
CŞÜImageD©a
=(BYTE*)NULL);

50 
DRIVER_ERROR
 
NewPage
();

51 
DRIVER_ERROR
 
S¹Page
(
JobA‰ribu‹s
 *
job_©Œs
);

52 
DRIVER_ERROR
 
´eProûssRa¡”D©a
(
cups_¿¡”_t
 **
cups_¿¡”
, 
cups_·ge_h—d”2_t
* 
fœ¡·ge_cups_h—d”
, * 
pP»Proûs£dRa¡”Fe
);

53 
CªûlJob
();

54 
	m´iv©e
:

56 
uÅackB™s
(
BYTE
 *
BÏckImageD©a
);

57 
JobA‰ribu‹s
 
	mm_job_©Œibu‹s
;

58 
Sy¡emS”viûs
 *
	mm_pSys
;

59 
P–še
 *
	mm_pP–še
;

60 
EnÿpsuÏtÜ
 *
	mm_pEnÿp
;

61 
	mskcouÁ
;

62 
BYTE
* 
	mm_pBÏnkRa¡”
;

63 
BYTE
* 
	mm_pBÏckRa¡”
;

64 
boŞ
 
	mm_bD©aS’t
;

65 
DRIVER_ERROR
 
CÚfigu»
();

66 
DRIVER_ERROR
 
£tBÏnkRa¡”
();

67 
DRIVER_ERROR
 
£tBÏckRa¡”
();

68 
	mm_iRa¡”
;

69 
	mm_iBªdNum
;

70 
	mm_iBÏnks
;

71 
	mm_»sŞutiÚ_¿tio
;

72 
	mm_row_numb”
;

	@prnt/hpcups/LJColor.cpp

31 
	~"CommÚDefš™iÚs.h
"

32 
	~"LJCŞÜ.h
"

33 
	~"CŞÜM©ch”.h
"

34 
	~"H®áÚ”.h
"

35 
	~"Mode2.h
"

36 
	~"Mode3.h
"

37 
	~"»sourûs.h
"

38 
	~"CŞÜM­s.h
"

39 
	~"Prš‹rCommªds.h
"

41 
	gLJCŞÜ
::
	$LJCŞÜ
(è: 
	$EnÿpsuÏtÜ
()

43 
	`mem£t
(&
m_PM
, 0, (m_PM));

44 
	`¡rıy
(
m_szLªguage
, "PCL");

45 
	}
}

47 
	gLJCŞÜ
::~
	$LJCŞÜ
()

49 
	}
}

51 
DRIVER_ERROR
 
LJCŞÜ
::
	$addJobS‘tšgs
()

53 
cur_pş_bufãr_±r
 +ğ
	`¥rštf
((*) cur_pcl_buffer_ptr,

54 "@PJL SET PAGEPROTECT=AUTO\012@PJL SET RESOLUTION=%d\012@PJL SET DENSITY=5\012", 
m_pQA
->
hÜizÚl_»sŞutiÚ
);

55 ià(
m_pQA
->
´št_qu®™y
 == -1)

57 
cur_pş_bufãr_±r
 +ğ
	`¥rštf
((*) cur_pcl_buffer_ptr,

60 ià(
m_pJA
->
e_du¶ex_mode
 !ğ
DUPLEXMODE_NONE
)

62 
cur_pş_bufãr_±r
 +ğ
	`¥rštf
((*) cur_pcl_buffer_ptr,

64 (
m_pJA
->
e_du¶ex_mode
 =ğ
DUPLEXMODE_BOOK
) ? "LONGEDGE" :

69 
	`addToH—d”
("@PJL SET DUPLEX=OFF\012", 19);

71 
cur_pş_bufãr_±r
 +ğ
	`¥rštf
((*) cur_pcl_buffer_ptr, "@PJL ENTER LANGUAGE=PCL\012");

72 
	`£ndJobH—d”
();

73 
DRIVER_ERROR
 
”r
 = 
	`CËªup
();

74  
”r
;

75 
	}
}

77 
DRIVER_ERROR
 
	gLJCŞÜ
::
	$CÚfigu»
(
P–še
 **
p–še
)

79 
P–še
 *
p
 = 
NULL
;

80 
P–še
 *
h—d
;

81 
width
;

82 
h—d
 = *
p–še
;

83 
width
 = 
m_pMA
->
´šbË_width
;

93 
m_PM
.
Ba£ResX
 = 
m_pQA
->
hÜizÚl_»sŞutiÚ
;

94 
m_PM
.
Ba£ResY
 = 
m_pQA
->
v”tiÿl_»sŞutiÚ
;

95 ià(
m_pJA
->
cŞÜ_mode
 != 0)

97 
CŞÜM©ch”
 *
pCŞÜM©ch”
;

98 
Mode2
 *
pMode2
;

99 
iRows
[
MAXCOLORPLANES
];

100 
uiResBoo¡
;

101 
m_PM
.
dyeCouÁ
 = 1;

102 
m_PM
.
CŞÜD•th
[0] = 1;

103 
m_PM
.
cm­
.
ulM­1
 = 
ulM­DJ600_CCM_K
;

104 
m_PM
.
eHT
 = 
FED
;

105 
m_PM
.
BÏckFEDTabË
 = 
HTBš¬y_İ’
;

106 
m_PM
.
CŞÜFEDTabË
 = 
HTBš¬y_İ’
;

107 
m_PM
.
MixedRes
 = 
çl£
;

109 
i
 = 0; i < 
MAXCOLORPLANES
; i++)

111 
m_PM
.
ResŞutiÚX
[
i
] = 
m_pQA
->
hÜizÚl_»sŞutiÚ
;

112 
m_PM
.
ResŞutiÚY
[
i
] = 
m_pQA
->
v”tiÿl_»sŞutiÚ
;

113 
iRows
[
i
] = 
m_PM
.
ResŞutiÚX
[i] / m_PM.
Ba£ResX
;

115 
uiResBoo¡
 = 
m_PM
.
Ba£ResX
 / m_PM.
Ba£ResY
;

116 ià(
uiResBoo¡
 == 0)

117 
uiResBoo¡
 = 1;

119 
pCŞÜM©ch”
 = 
Ãw
 
	`CŞÜM©ch”
(
m_PM
.
cm­
, m_PM.
dyeCouÁ
, 
width
);

120 
h—d
 = 
Ãw
 
	`P–še
(
pCŞÜM©ch”
);

121 
m_pH®áÚ”
 = 
Ãw
 
	`H®áÚ”
 (&
m_PM
, 
width
, 
iRows
, 
uiResBoo¡
, m_PM.
eHT
 =ğ
MATRIX
);

122 
p
 = 
Ãw
 
	`P–še
(
m_pH®áÚ”
);

123 
h—d
->
	`AddPha£
(
p
);

124 
pMode2
 = 
Ãw
 
	`Mode2
(
width
);

125 
p
 = 
Ãw
 
	`P–še
(
pMode2
);

126 
h—d
->
	`AddPha£
(
p
);

127 
pMode2
->
my¶ªe
 = 
COLORTYPE_COLOR
;

131 
m_pMode3
 = 
Ãw
 
	`Mode3
(
width
 * 3);

132 
h—d
 = 
Ãw
 
	`P–še
(
m_pMode3
);

133 
m_pMode3
->
my¶ªe
 = 
COLORTYPE_COLOR
;

136 *
p–še
 = 
h—d
;

137  
NO_ERROR
;

138 
	}
}

140 
DRIVER_ERROR
 
	gLJCŞÜ
::
	$S¹Page
(
JobA‰ribu‹s
 *
pJA
)

142 
m_pJA
 = 
pJA
;

143 
m_pMA
 = &
pJA
->
medŸ_©Œibu‹s
;

144 
m_pQA
 = &
pJA
->
qu®™y_©Œibu‹s
;

145 
·ge_numb”
++;

146  
NO_ERROR
;

147 
	}
}

149 
DRIVER_ERROR
 
	gLJCŞÜ
::
	$FÜmF“d
()

151 
DRIVER_ERROR
 
”r
;

152 
”r
 = 
	`CËªup
();

153 
”r
 = 
m_pSy¡emS”viûs
->
	`S’d
((cÚ¡ 
BYTE
 *) "\x0C", 1);

154  
”r
;

155 
	}
}

157 
DRIVER_ERROR
 
	gLJCŞÜ
::
	$EndJob
()

159 
DRIVER_ERROR
 
”r
 = 
NO_ERROR
;

160 
”r
 = 
	`CËªup
();

161 
”r
 = 
m_pSy¡emS”viûs
->
	`S’d
((cÚ¡ 
BYTE
 *) "\x1B*rC", 4);

162 
”r
 = 
m_pSy¡emS”viûs
->
	`S’d
(
Re£t
, (Reset));

163 ià(
”r
 =ğ
NO_ERROR
)

164 
”r
 = 
m_pSy¡emS”viûs
->
	`S’d
(
UEL
, (UEL));

165  
”r
;

166 
	}
}

168 
DRIVER_ERROR
 
	gLJCŞÜ
::
	$EnÿpsuÏ‹
(
RASTERDATA
 *
IÅutRa¡”
, 
boŞ
 
bLa¡PÏÃ
)

170 
DRIVER_ERROR
 
”r
 = 
NO_ERROR
;

171 
tmpSŒ
[16];

172 
iL’
;

173 
m_iYPos
++;

174 
iL’
 = 
	`¥rštf
 (
tmpSŒ
, "\x1b*b%uW", 
IÅutRa¡”
->
¿¡”size
[
COLORTYPE_COLOR
]);

175 
”r
 = 
this
->
	`S’d
((cÚ¡ 
BYTE
 *è
tmpSŒ
, 
iL’
);

176 ià(
”r
 =ğ
NO_ERROR
 && 
IÅutRa¡”
->
¿¡”size
[
COLORTYPE_COLOR
] > 0)

178 
”r
 = 
this
->
	`S’d
(
IÅutRa¡”
->
¿¡”d©a
[
COLORTYPE_COLOR
],

179 
IÅutRa¡”
->
¿¡”size
[
COLORTYPE_COLOR
]);

188 ià(
m_pJA
->
cŞÜ_mode
 == 0 &&

189 
m_pQA
->
hÜizÚl_»sŞutiÚ
 >= 600 &&

190 
m_iYPos
 % 1200 == 0)

193 
m_pMode3
->
	`Flush
();

194 
”r
 = 
this
->
	`S’d
 ((cÚ¡ 
BYTE
 *) "\033*rC\033*r1A\033*b3M", 14);

197  
”r
;

198 
	}
}

200 
	gLJCŞÜ
::
	$cÚfigu»Ra¡”D©a
()

211 
	`addToH—d”
 ((cÚ¡ 
BYTE
 *) "\033*v6W\00\03\010\010\010\010", 11);

216 
	`addToH—d”
 ((cÚ¡ 
BYTE
 *) "\033*t18J", 6);

225 
	`addToH—d”
 ((cÚ¡ 
BYTE
 *) "\033*o3W\06\04\06", 8);

230 
	`addToH—d”
 ((cÚ¡ 
BYTE
 *) "\033*v255A\033*v255B\033*v255C\033*v0I", 26);

231 
	`addToH—d”
 ((cÚ¡ 
BYTE
 *) "\033*v255A\033*v0B\033*v0C\033*v6I", 22);

232 
	`addToH—d”
 ((cÚ¡ 
BYTE
 *) "\033*v0A\033*v255B\033*v0C\033*v5I", 22);

233 
	`addToH—d”
 ((cÚ¡ 
BYTE
 *) "\033*v0A\033*v0B\033*v255C\033*v3I", 22);

234 
	`addToH—d”
 ((cÚ¡ 
BYTE
 *) "\033*v255A\033*v255B\033*v0C\033*v4I", 24);

235 
	`addToH—d”
 ((cÚ¡ 
BYTE
 *) "\033*v255A\033*v0B\033*v255C\033*v2I", 24);

236 
	`addToH—d”
 ((cÚ¡ 
BYTE
 *) "\033*v0A\033*v255B\033*v255C\033*v1I", 24);

237 
	`addToH—d”
 ((cÚ¡ 
BYTE
 *) "\033*v0A\033*v0B\033*v0C\033*v7I", 20);

241 
	`addToH—d”
 ((cÚ¡ 
BYTE
 *) "\033*v7S", 5);

242 
	}
}

	@prnt/hpcups/LJColor.h

31 #iâdeà
LJCOLOR_H


32 
	#LJCOLOR_H


	)

34 
	~"CommÚDefš™iÚs.h
"

35 
	~"P–še.h
"

36 
	~"EnÿpsuÏtÜ.h
"

38 
şass
 
	gH®áÚ”
;

39 
şass
 
	gMode3
;

41 şas 
	cLJCŞÜ
: 
public
 
EnÿpsuÏtÜ


43 
public
:

44 
LJCŞÜ
();

45 ~
LJCŞÜ
();

46 
DRIVER_ERROR
 
EnÿpsuÏ‹
 (
RASTERDATA
 *
IÅutRa¡”
, 
boŞ
 
bLa¡PÏÃ
);

47 
DRIVER_ERROR
 
S¹Page
(
JobA‰ribu‹s
 *
pJA
);

48 
DRIVER_ERROR
 
CÚfigu»
(
P–še
 **
p–še
);

49 
DRIVER_ERROR
 
EndJob
();

50 
DRIVER_ERROR
 
FÜmF“d
();

51 
boŞ
 
	$CªSkRa¡”s
(è{ 
çl£
;}

52 
´Ùeùed
:

53 
vœtu®
 
DRIVER_ERROR
 
	`addJobS‘tšgs
();

54 
	`cÚfigu»Ra¡”D©a
();

55 
DRIVER_ERROR
 
	$æushPrš‹rBufãr
(è{ 
NO_ERROR
;
	}
}

56 
	g´iv©e
:

57 
PrštMode
 
m_PM
;

58 
H®áÚ”
 *
	gm_pH®áÚ”
;

59 
Mode3
 *
	gm_pMode3
;

60 
	gm_iYPos
;

	@prnt/hpcups/LJFastRaster.cpp

31 
	~"CommÚDefš™iÚs.h
"

32 
	~"LJFa¡Ra¡”.h
"

33 
	~"CŞÜM©ch”.h
"

34 
	~"H®áÚ”.h
"

35 
	~"ModeD–Plus.h
"

36 
	~"»sourûs.h
"

37 
	~"CŞÜM­s.h
"

38 
	~"Prš‹rCommªds.h
"

40 
	gLJFa¡Ra¡”
::
	$LJFa¡Ra¡”
(è: 
	$EnÿpsuÏtÜ
()

42 
	`mem£t
(&
m_PM
, 0, (m_PM));

43 
	`¡rıy
(
m_szLªguage
, "PCLXL");

44 
m_pModeD–Plus
 = 
NULL
;

45 
	}
}

47 
	gLJFa¡Ra¡”
::~
	$LJFa¡Ra¡”
()

49 
	}
}

51 
DRIVER_ERROR
 
LJFa¡Ra¡”
::
	$addJobS‘tšgs
()

53 
cur_pş_bufãr_±r
 +ğ
	`¥rštf
((*) cur_pcl_buffer_ptr,

55 
cur_pş_bufãr_±r
 +ğ
	`¥rštf
((*) cur_pcl_buffer_ptr,

57 ià(
m_pQA
->
´št_qu®™y
 == -1)

59 
cur_pş_bufãr_±r
 +ğ
	`¥rštf
((*) cur_pcl_buffer_ptr,

62 
	`addToH—d”
("%s", "@PJL ENTER LANGUAGE=PCLXL\012) HP-PCL XL;2;0;Comment\012");

63 
	`addToH—d”
(
FRBegšSessiÚ
, (FRBeginSession));

64 
	`addToH—d”
(
FRVUExŠ3
, (FRVUExtn3));

65 
	`addToH—d”
(
FRV’dÜUniq
, (FRVendorUniq));

66 
	`addToH—d”
(
FRO³nD©aSourû
, (FROpenDataSource));

67  
NO_ERROR
;

68 
	}
}

70 
DRIVER_ERROR
 
	gLJFa¡Ra¡”
::
	$CÚfigu»
(
P–še
 **
p–še
)

72 
DRIVER_ERROR
 
”r
 = 
NO_ERROR
;

73 
P–še
 *
p
 = 
NULL
;

74 
P–še
 *
h—d
;

75 
width
;

76 
CŞÜM©ch”
 *
pCŞÜM©ch”
;

77 
H®áÚ”
 *
pH®áÚ”
;

78 
iRows
[
MAXCOLORPLANES
];

79 
uiResBoo¡
;

80 
h—d
 = *
p–še
;

87 
m_PM
.
dyeCouÁ
 = 1;

88 
m_PM
.
CŞÜD•th
[0] = 1;

89 
m_PM
.
cm­
.
ulM­1
 = 
ulM­DJ600_CCM_K
;

90 
m_PM
.
Ba£ResX
 = 
m_pQA
->
hÜizÚl_»sŞutiÚ
;

91 
m_PM
.
Ba£ResY
 = 
m_pQA
->
v”tiÿl_»sŞutiÚ
;

92 
m_PM
.
eHT
 = 
FED
;

93 
m_PM
.
BÏckFEDTabË
 = 
HTBš¬y_İ’
;

94 
m_PM
.
CŞÜFEDTabË
 = 
HTBš¬y_İ’
;

95 
m_PM
.
MixedRes
 = 
çl£
;

97 
i
 = 0; i < 
MAXCOLORPLANES
; i++)

99 
m_PM
.
ResŞutiÚX
[
i
] = 
m_pQA
->
hÜizÚl_»sŞutiÚ
;

100 
m_PM
.
ResŞutiÚY
[
i
] = 
m_pQA
->
v”tiÿl_»sŞutiÚ
;

101 
iRows
[
i
] = 
m_PM
.
ResŞutiÚX
[i] / m_PM.
Ba£ResX
;

103 
uiResBoo¡
 = 
m_PM
.
Ba£ResX
 / m_PM.
Ba£ResY
;

104 ià(
uiResBoo¡
 == 0)

105 
uiResBoo¡
 = 1;

107 
width
 = 
m_pMA
->
´šbË_width
;

109 
pCŞÜM©ch”
 = 
Ãw
 
	`CŞÜM©ch”
(
m_PM
.
cm­
, m_PM.
dyeCouÁ
, 
width
);

110 
h—d
 = 
Ãw
 
	`P–še
(
pCŞÜM©ch”
);

111 
pH®áÚ”
 = 
Ãw
 
	`H®áÚ”
 (&
m_PM
, 
width
, 
iRows
, 
uiResBoo¡
, m_PM.
eHT
 =ğ
MATRIX
);

112 
p
 = 
Ãw
 
	`P–še
(
pH®áÚ”
);

113 
h—d
->
	`AddPha£
(
p
);

114 
m_pModeD–Plus
 = 
Ãw
 
	`ModeD–Plus
(
width
);

115 
p
 = 
Ãw
 
	`P–še
(
m_pModeD–Plus
);

116 
h—d
->
	`AddPha£
(
p
);

117 
m_pModeD–Plus
->
my¶ªe
 = 
COLORTYPE_COLOR
;

118 
”r
 = 
m_pModeD–Plus
->
	`In™
();

120 *
p–še
 = 
h—d
;

121  
”r
;

122 
	}
}

124 
DRIVER_ERROR
 
	gLJFa¡Ra¡”
::
	$S¹Page
(
JobA‰ribu‹s
 *
pJA
)

126 
DRIVER_ERROR
 
”r
 = 
NO_ERROR
;

127 
·ge_numb”
++;

129 
m_pJA
 = 
pJA
;

130 
m_pMA
 = &
pJA
->
medŸ_©Œibu‹s
;

131 
m_pQA
 = &
pJA
->
qu®™y_©Œibu‹s
;

133 
m_pModeD–Plus
->
	`NewPage
();

143 
	`addToH—d”
(
FRF“dOr›Á©iÚ
, (FRFeedOrientation));

147 ià(
m_pMA
->
pş_id
 == 96)

149 
BYTE
 
szCu¡omSize
[16];

152 
fV®ue
;

153 
ušt32_t
 
uiV®ue
;

154 } 
LJFUniÚ
;

155 
ušt32_t
 
uiXsize
;

156 
ušt32_t
 
uiYsize
;

157 
k
 = 0;

158 
LJFUniÚ
.
fV®ue
 = (è
m_pMA
->
physiÿl_width
 / 
m_pQA
->
hÜizÚl_»sŞutiÚ
;

159 
uiXsize
 = 
LJFUniÚ
.
uiV®ue
;

160 
LJFUniÚ
.
fV®ue
 = (è
m_pMA
->
physiÿl_height
 / 
m_pQA
->
hÜizÚl_»sŞutiÚ
;

161 
uiYsize
 = 
LJFUniÚ
.
uiV®ue
;

162 
szCu¡omSize
[
k
++] = 0xD5;

163 
szCu¡omSize
[
k
++] = (
BYTE
è(
uiXsize
 & 0x000000FF);

164 
szCu¡omSize
[
k
++] = (
BYTE
è((
uiXsize
 & 0x0000FF00) >> 8);

165 
szCu¡omSize
[
k
++] = (
BYTE
è((
uiXsize
 & 0x00FF0000) >> 16);

166 
szCu¡omSize
[
k
++] = (
BYTE
è((
uiXsize
 & 0xFF000000) >> 24);

167 
szCu¡omSize
[
k
++] = (
BYTE
è(
uiYsize
 & 0x000000FF);

168 
szCu¡omSize
[
k
++] = (
BYTE
è((
uiYsize
 & 0x0000FF00) >> 8);

169 
szCu¡omSize
[
k
++] = (
BYTE
è((
uiYsize
 & 0x00FF0000) >> 16);

170 
szCu¡omSize
[
k
++] = (
BYTE
è((
uiYsize
 & 0xFF000000) >> 24);

171 
szCu¡omSize
[
k
++] = 0xF8;

172 
szCu¡omSize
[
k
++] = 0x2F;

173 
	`addToH—d”
(
szCu¡omSize
, 
k
);

174 
	`addToH—d”
(
FRCu¡omMedŸSize
, (FRCustomMediaSize));

178 
	`memıy
(
cur_pş_bufãr_±r
, 
FRP­”Size
, (FRPaperSize));

179 
cur_pş_bufãr_±r
[1] = (
BYTE
è
m_pMA
->
pş_id
;

180 
cur_pş_bufãr_±r
 +ğ(
FRP­”Size
);

183 
	`addToH—d”
(
FRBegšPage
, (FRBeginPage));

184 
”r
 = 
	`CËªup
();

185  
”r
;

186 
	}
}

188 
DRIVER_ERROR
 
	gLJFa¡Ra¡”
::
	$S’dCAPy
(
iOff£t
)

190  
NO_ERROR
;

191 
	}
}

193 
DRIVER_ERROR
 
	gLJFa¡Ra¡”
::
	$FÜmF“d
()

195  
	`£ndBufãr
(
FREndPage
, (FREndPage));

196 
	}
}

198 
DRIVER_ERROR
 
	gLJFa¡Ra¡”
::
	$EndJob
()

200 
DRIVER_ERROR
 
”r
;

201 
	`addToH—d”
(
FRClo£D©aSourû
, (FRCloseDataSource));

202 
	`addToH—d”
(
FREndSessiÚ
, (FREndSession));

203 
	`addToH—d”
((cÚ¡ 
BYTE
 *è
PJLEx™
, 
	`¡¾’
(PJLExit));

204 
”r
 = 
	`CËªup
();

205  
”r
;

206 
	}
}

208 
	#FAST_RASTER_HEADERSIZE
 25

	)

212 
	meD–32
,

213 
	meD–Plus
 = 24,

214 
	meFX
 = 18,

215 
	meRAW
 = 2

216 } 
	tCom´essiÚM‘hod
;

220 
	#BASE_ADDRESS
 0

	)

221 
	#PAGE_NUM_ADDRESS
 1

	)

222 
	#RESOLUTION_ADDRESS_HI
 2

	)

223 
	#RESOLUTION_ADDRESS_LO
 3

	)

224 
	#COMPRESSION_ADDRESS_HI
 4

	)

225 
	#COMPRESSION_ADDRESS_LO
 5

	)

226 
	#COLOR_PLANE_SPECIFIER_ADDRESS
 6

	)

227 
	#COMPRESSION_RATIO
 7

	)

228 
	#PRODUCT_ID
 8

	)

229 
	#IMAGE_SIZE_ADDRESS_HIWORD_HI
 12

	)

230 
	#IMAGE_SIZE_ADDRESS_HIWORD_LO
 13

	)

231 
	#IMAGE_SIZE_ADDRESS_LOWORD_HI
 14

	)

232 
	#IMAGE_SIZE_ADDRESS_LOWORD_LO
 15

	)

233 
	#IMAGE_WIDTH_ADDRESS_HI
 16

	)

234 
	#IMAGE_WIDTH_ADDRESS_LO
 17

	)

235 
	#IMAGE_HEIGTH_ADDRESS_HI
 18

	)

236 
	#IMAGE_HEIGTH_ADDRESS_LO
 19

	)

237 
	#ABS_X_ADDRESS_HI
 20

	)

238 
	#ABS_X_ADDRESS_LO
 21

	)

239 
	#ABS_Y_ADDRESS_HI
 22

	)

240 
	#ABS_Y_ADDRESS_LO
 23

	)

241 
	#BIT_DEPTH_ADDRESS
 24

	)

243 
	#eK
 3

	)

244 
DRIVER_ERROR
 
	gLJFa¡Ra¡”
::
	$EnÿpsuÏ‹
 (
RASTERDATA
 *
IÅutRa¡”
, 
boŞ
 
bLa¡PÏÃ
)

246 
BYTE
 
»s
[64];

247 
DRIVER_ERROR
 
”r
 = 
NO_ERROR
;

250 
pucH—d”
[
FAST_RASTER_HEADERSIZE
];

251 
lImageWidth
 = ((
m_pMA
->
´šbË_width
 + 7) / 8) * 8;

252 
lResŞutiÚ
 = 600;

253 
lBlockOff£t
 = ((
m_pModeD–Plus
->
	`G‘Cu¼’tRa¡”Row
() + 127) / 128) * 128 - 128;

254 
lB™D•th
 = 1;

255 
lBlockHeight
 = 
m_pModeD–Plus
->
	`G‘Cu¼’tBlockHeight
();

257 
wTemp
 = 
	`LOWORD
 (
lBlockOff£t
);

258 
BYTE
 
byHIBy‹
 = 0;

259 
BYTE
 
byLOBy‹
 = 0;

261 
	`mem£t
 (
pucH—d”
, 0, 
FAST_RASTER_HEADERSIZE
);

263 
pucH—d”
[
ABS_X_ADDRESS_HI
] = 0;

264 
pucH—d”
[
ABS_X_ADDRESS_LO
] = 0;

265 
pucH—d”
[
ABS_Y_ADDRESS_HI
] = 
	`HIBYTE
 (
wTemp
);

266 
pucH—d”
[
ABS_Y_ADDRESS_LO
] = 
	`LOBYTE
 (
wTemp
);

268 
pucH—d”
[
BASE_ADDRESS
] = 0;

269 
pucH—d”
[
PAGE_NUM_ADDRESS
] = 1;

271 
wTemp
 = (è(
lResŞutiÚ
 );

272 
byHIBy‹
 = 
	`HIBYTE
 (
wTemp
);

273 
byLOBy‹
 = 
	`LOBYTE
 (
wTemp
);

274 
pucH—d”
[
RESOLUTION_ADDRESS_HI
] = 
byHIBy‹
;

275 
pucH—d”
[
RESOLUTION_ADDRESS_LO
] = 
byLOBy‹
;

277 
wTemp
 = 
m_pModeD–Plus
->
	`IsCom´es£d
(è? (è
eD–Plus
 : (è
eRAW
;

278 
byHIBy‹
 = 
	`HIBYTE
 (
wTemp
);

279 
byLOBy‹
 = 
	`LOBYTE
 (
wTemp
);

280 
pucH—d”
[
COMPRESSION_ADDRESS_HI
] = 
byHIBy‹
;

281 
pucH—d”
[
COMPRESSION_ADDRESS_LO
] = 
byLOBy‹
;

283 
pucH—d”
[
COLOR_PLANE_SPECIFIER_ADDRESS
] = (
BYTE
è
eK
;

284 
pucH—d”
[
COMPRESSION_RATIO
] = (
BYTE
è
m_pModeD–Plus
->
	`G‘FR©io
();

285 
wTemp
 = 
	`HIWORD
 (
IÅutRa¡”
->
¿¡”size
[
COLORTYPE_COLOR
]);

286 
byHIBy‹
 = 
	`HIBYTE
 (
wTemp
);

287 
byLOBy‹
 = 
	`LOBYTE
 (
wTemp
);

288 
pucH—d”
[
IMAGE_SIZE_ADDRESS_HIWORD_HI
] = 
byHIBy‹
;

289 
pucH—d”
[
IMAGE_SIZE_ADDRESS_HIWORD_LO
] = 
byLOBy‹
;

291 
wTemp
 = 
	`LOWORD
 (
IÅutRa¡”
->
¿¡”size
[
COLORTYPE_COLOR
]);

292 
byHIBy‹
 = 
	`HIBYTE
 (
wTemp
);

293 
byLOBy‹
 = 
	`LOBYTE
 (
wTemp
);

294 
pucH—d”
[
IMAGE_SIZE_ADDRESS_LOWORD_HI
] = 
byHIBy‹
;

295 
pucH—d”
[
IMAGE_SIZE_ADDRESS_LOWORD_LO
] = 
byLOBy‹
;

297 
wTemp
 = 
	`LOWORD
 (
lImageWidth
 * 8);

298 
byHIBy‹
 = 
	`HIBYTE
 (
wTemp
);

299 
byLOBy‹
 = 
	`LOBYTE
 (
wTemp
);

301 
pucH—d”
[
IMAGE_WIDTH_ADDRESS_HI
] = 
byHIBy‹
;

302 
pucH—d”
[
IMAGE_WIDTH_ADDRESS_LO
] = 
byLOBy‹
;

304 
wTemp
 = 
	`LOWORD
 (
lBlockHeight
);

305 
byHIBy‹
 = 
	`HIBYTE
 (
wTemp
);

306 
byLOBy‹
 = 
	`LOBYTE
 (
wTemp
);

307 
pucH—d”
[
IMAGE_HEIGTH_ADDRESS_HI
] = 
byHIBy‹
;

308 
pucH—d”
[
IMAGE_HEIGTH_ADDRESS_LO
] = 
byLOBy‹
;

310 
wTemp
 = 
	`LOWORD
 (
lB™D•th
);

311 
pucH—d”
[
BIT_DEPTH_ADDRESS
] = 
	`LOBYTE
 (
wTemp
);

313 
ulVUD©aL’gth
 = ()(
IÅutRa¡”
->
¿¡”size
[
COLORTYPE_COLOR
] + 
FAST_RASTER_HEADERSIZE
);

315 
”r
 = 
this
->
	`S’d
 (
FREÁ”FRMode
, (FREnterFRMode));

316 
ERRCHECK
;

317 
»s
[0] = (
BYTE
è(
ulVUD©aL’gth
 & 0xFF);

318 
»s
[1] = (
BYTE
è((
ulVUD©aL’gth
 & 0x0000FF00) >> 8);

319 
»s
[2] = (
BYTE
è((
ulVUD©aL’gth
 & 0x00FF0000) >> 16);

320 
»s
[3] = (
BYTE
è((
ulVUD©aL’gth
 & 0xFF000000) >> 24);

321 
»s
[4] = 0xF8;

322 
»s
[5] = 0x92;

323 
»s
[6] = 0x46;

324 
”r
 = 
this
->
	`S’d
 (
»s
, 7);

325 
ERRCHECK
;

328 
”r
 = 
this
->
	`S’d
 (
pucH—d”
, 
FAST_RASTER_HEADERSIZE
);

329 
”r
 = 
	`CËªup
();

330 ià(
”r
 =ğ
NO_ERROR
)

331 
”r
 = 
	`£ndBufãr
 ((cÚ¡ 
BYTE
 *è
IÅutRa¡”
->
¿¡”d©a
[
COLORTYPE_COLOR
],

332 
IÅutRa¡”
->
¿¡”size
[
COLORTYPE_COLOR
]);

333  
”r
;

334 
	}
}

	@prnt/hpcups/LJFastRaster.h

31 #iâdeà
LJFASTRASTER_H


32 
	#LJFASTRASTER_H


	)

34 
	~"CommÚDefš™iÚs.h
"

35 
	~"P–še.h
"

36 
	~"EnÿpsuÏtÜ.h
"

37 
	~"ModeD–Plus.h
"

39 
şass
 
	gH®áÚ”
;

41 şas 
	cLJFa¡Ra¡”
: 
public
 
EnÿpsuÏtÜ


43 
public
:

44 
LJFa¡Ra¡”
();

45 ~
LJFa¡Ra¡”
();

46 
DRIVER_ERROR
 
EnÿpsuÏ‹
 (
RASTERDATA
 *
IÅutRa¡”
, 
boŞ
 
bLa¡PÏÃ
);

47 
DRIVER_ERROR
 
S¹Page
(
JobA‰ribu‹s
 *
pJA
);

48 
DRIVER_ERROR
 
CÚfigu»
(
P–še
 **
p–še
);

49 
DRIVER_ERROR
 
EndJob
();

50 
DRIVER_ERROR
 
FÜmF“d
();

51 
DRIVER_ERROR
 
S’dCAPy
(
iOff£t
);

52 
boŞ
 
	$CªSkRa¡”s
(è{ 
çl£
;}

53 
	$CªûlJob
(è{
	}
}

54 
	$S‘La¡Bªd
()

56 
m_pModeD–Plus
->
	`S‘La¡Bªd
();

57 
	}
}

58 
	g´Ùeùed
:

59 
vœtu®
 
DRIVER_ERROR
 
addJobS‘tšgs
();

60 
DRIVER_ERROR
 
	$æushPrš‹rBufãr
(è{ 
NO_ERROR
;
	}
}

61 
	g´iv©e
:

62 
PrštMode
 
m_PM
;

63 
ModeD–Plus
 *
	gm_pModeD–Plus
;

	@prnt/hpcups/LJJetReady.cpp

31 
	~"EnÿpsuÏtÜ.h
"

32 
	~"ModeJ³g.h
"

33 
	~"LJJ‘R—dy.h
"

34 
	~"Prš‹rCommªds.h
"

36 
	#MOJAVE_STRIP_HEIGHT
 128

	)

38 
	gLJJ‘R—dy
::
	$LJJ‘R—dy
(è: 
	$EnÿpsuÏtÜ
()

40 
m_eCom´essMode
 = 
COMPRESS_MODE_JPEG
;

41 
	`mem£t
(&
m_QTabËInfo
, 0, (m_QTableInfo));

42 
	}
}

44 
	gLJJ‘R—dy
::~
	$LJJ‘R—dy
()

46 
	}
}

48 
DRIVER_ERROR
 
LJJ‘R—dy
::
	$addJobS‘tšgs
()

50 
DRIVER_ERROR
 
”r
;

51 
	`addToH—d”
("@PJL SET STRINGCODESET=UTF8\012");

52 
	`addToH—d”
("@PJL SET COPIES=1\012");

53 ià(
m_pJA
->
cŞÜ_mode
 != 0)

55 
	`addToH—d”
("@PJL SET PLANESINUSE=1\012");

57 ià(
m_pJA
->
e_du¶ex_mode
 !ğ
DUPLEXMODE_NONE
)

59 
	`addToH—d”
("@PJL SET DUPLEX=ON\012@PJL SET BINDING=%s\012",

60 
m_pJA
->
e_du¶ex_mode
 =ğ
DUPLEXMODE_BOOK
 ? "LONGEDGE" : "SHORTEDGE");

62 
	`addToH—d”
("@PJL SET RESOLUTION=600\012");

63 
	`addToH—d”
("@PJL SET TIMEOUT=90\012");

64 
	`addToH—d”
("@PJL ENTER LANGUAGE=PCLXL\012");

65 
	`addToH—d”
(") HP-PCL XL;3;0;Comment, PCL-XL JetReady generator\012");

66 
	`addToH—d”
(
JRBegšSessiÚSeq
, () (JRBeginSessionSeq));

67 
”r
 = 
	`CËªup
();

68  
”r
;

69 
	}
}

71 
DRIVER_ERROR
 
	gLJJ‘R—dy
::
	$CÚfigu»
(
P–še
 **
p–še
)

73 
P–še
 *
h—d
;

74 
ModeJ³g
 *
pModeJ³g
;

75 
pModeJ³g
 = 
Ãw
 
	`ModeJ³g
(((
m_pMA
->
´šbË_width
 + 31) / 32) * 32);

76 ià(
pModeJ³g
 =ğ
NULL
)

78  
ALLOCMEM_ERROR
;

81 
m_eCom´essMode
 = 
m_pQA
->
´št_qu®™y
 =ğ1 ? 
COMPRESS_MODE_LJ
 : 
COMPRESS_MODE_JPEG
;

82 
pModeJ³g
->
my¶ªe
 = 
COLORTYPE_COLOR
;

83 
m_QTabËInfo
.
qFaùÜ
 = 6;

84 
pModeJ³g
->
	`In™
(
m_pJA
->
cŞÜ_mode
, 
MOJAVE_STRIP_HEIGHT
, &
m_eCom´essMode
, &
m_QTabËInfo
);

85 
h—d
 = 
Ãw
 
	`P–še
(
pModeJ³g
);

86 *
p–še
 = 
h—d
;

87  
NO_ERROR
;

88 
	}
}

90 
DRIVER_ERROR
 
	gLJJ‘R—dy
::
	$S¹Page
(
JobA‰ribu‹s
 *
pJA
)

92 
DRIVER_ERROR
 
”r
;

93 
BYTE
 
JRP­”SizeSeq
[] = {0xC0, 0x00, 0xF8, 0x25};

94 
BYTE
 
szCu¡omSize
[16];

95 
m_iSŒHeight
 = 0;

96 ià(
m_eCom´essMode
 !ğ
COMPRESS_MODE_LJ
)

97 
m_bS’dQTabË
 = 
Œue
;

98 
	`addToH—d”
((cÚ¡ 
BYTE
 *è
JRF“dOr›Á©iÚSeq
, (JRFeedOrientationSeq));

99 ià(
pJA
->
medŸ_©Œibu‹s
.
pş_id
 == 96)

104 
fV®ue
;

105 
ušt32_t
 
uiV®ue
;

106 } 
JRCu¡omP­”Size
;

107 
ušt32_t
 
uiXsize
;

108 
ušt32_t
 
uiYsize
;

109 
k
 = 0;

112 
JRCu¡omP­”Size
.
fV®ue
 = (è
pJA
->
medŸ_©Œibu‹s
.
physiÿl_width
 / (èpJA->
qu®™y_©Œibu‹s
.
hÜizÚl_»sŞutiÚ
;

113 
uiXsize
 = 
JRCu¡omP­”Size
.
uiV®ue
;

114 
JRCu¡omP­”Size
.
fV®ue
 = (è
pJA
->
medŸ_©Œibu‹s
.
physiÿl_height
 / (èpJA->
qu®™y_©Œibu‹s
.
v”tiÿl_»sŞutiÚ
;;

115 
uiYsize
 = 
JRCu¡omP­”Size
.
uiV®ue
;

116 
szCu¡omSize
[
k
++] = 0xD5;

117 
szCu¡omSize
[
k
++] = (
BYTE
è(
uiXsize
 & 0x000000FF);

118 
szCu¡omSize
[
k
++] = (
BYTE
è((
uiXsize
 & 0x0000FF00) >> 8);

119 
szCu¡omSize
[
k
++] = (
BYTE
è((
uiXsize
 & 0x00FF0000) >> 16);

120 
szCu¡omSize
[
k
++] = (
BYTE
è((
uiXsize
 & 0xFF000000) >> 24);

121 
szCu¡omSize
[
k
++] = (
BYTE
è(
uiYsize
 & 0x000000FF);

122 
szCu¡omSize
[
k
++] = (
BYTE
è((
uiYsize
 & 0x0000FF00) >> 8);

123 
szCu¡omSize
[
k
++] = (
BYTE
è((
uiYsize
 & 0x00FF0000) >> 16);

124 
szCu¡omSize
[
k
++] = (
BYTE
è((
uiYsize
 & 0xFF000000) >> 24);

125 
	`addToH—d”
((cÚ¡ 
BYTE
 *è
szCu¡omSize
, 
k
);

126 
	`addToH—d”
(
JRCu¡omP­”SizeSeq
, (JRCustomPaperSizeSeq));

130 
JRP­”SizeSeq
[1] = 
pJA
->
medŸ_©Œibu‹s
.
pş_id
;

131 
	`addToH—d”
((cÚ¡ 
BYTE
 *è
JRP­”SizeSeq
, (JRPaperSizeSeq));

133 
BYTE
 
szPršbËA»aSeq
[] = {0xD1, 0x00, 0x00, 0x00, 0x00, 0xF8, 0x74};

134 
iWidth
 = 
pJA
->
medŸ_©Œibu‹s
.
´šbË_width
;

135 
iHeight
 = 
pJA
->
medŸ_©Œibu‹s
.
´šbË_height
;

138 ià(
iWidth
 < 1600)

140 
iWidth
 = 1600;

143 
iWidth
 = ((iWidth + 31) / 32) * 32;

144 
iHeight
 = ((iHeighˆ+ (
MOJAVE_STRIP_HEIGHT
 - 1)) / MOJAVE_STRIP_HEIGHT) * MOJAVE_STRIP_HEIGHT;

145 
szPršbËA»aSeq
[1] = (
BYTE
è(
iWidth
 & 0xFF);

146 
szPršbËA»aSeq
[2] = (
BYTE
è((
iWidth
 >> 8) & 0xFF);

147 
szPršbËA»aSeq
[3] = (
BYTE
è(
iHeight
 & 0xFF);

148 
szPršbËA»aSeq
[4] = (
BYTE
è((
iHeight
 >> 8) & 0xFF);

149 
	`addToH—d”
((cÚ¡ 
BYTE
 *è
szPršbËA»aSeq
, (szPrintableAreaSeq));

151 
	`addToH—d”
(
JRBegšPageSeq
, (JRBeginPageSeq));

154 
BYTE
 
szCŞÜModeSeq
[] = {0xC0, 0x06, 0xF8, 0x03, 0x6A};

155 
szCŞÜModeSeq
[1] +ğ
pJA
->
cŞÜ_mode
;

156 
	`addToH—d”
((cÚ¡ 
BYTE
 *è
szCŞÜModeSeq
, (szColorModeSeq));

157 
”r
 = 
	`CËªup
();

159 
BYTE
 
szSŒ
[16];

160 
	`addToH—d”
(
JRBegšImageSeq
, (JRBeginImageSeq));

161 
szSŒ
[0] = (
BYTE
è(
iWidth
 & 0xFF);

162 
szSŒ
[1] = (
BYTE
è((
iWidth
 & 0xFF00) >> 8);

163 
szSŒ
[2] = 0xF8;

164 
szSŒ
[3] = 0x6C;

165 
szSŒ
[4] = 0xC1;

166 
szSŒ
[5] = (
BYTE
è(
iHeight
 & 0xFF);

167 
szSŒ
[6] = (
BYTE
è((
iHeight
 & 0xFF00) >> 8);

168 
szSŒ
[7] = 0xF8;

169 
szSŒ
[8] = 0x6B;

170 
szSŒ
[9] = 0xC1;

171 
	`addToH—d”
((cÚ¡ 
BYTE
 *è
szSŒ
, 10);

172 
uiSŒCouÁ
 = 
iHeight
 / 
MOJAVE_STRIP_HEIGHT
;

173 
szSŒ
[0] = (
BYTE
è(
uiSŒCouÁ
 & 0xFF);

174 
szSŒ
[1] = (
BYTE
è((
uiSŒCouÁ
 & 0xFF00) >> 8);

175 
szSŒ
[2] = 0xF8;

176 
szSŒ
[3] = 0x93;

177 
szSŒ
[4] = 0xC1;

178 
	`addToH—d”
((cÚ¡ 
BYTE
 *è
szSŒ
, 5);

179 cÚ¡ 
BYTE
 
szSŒHeightSeq
[] = {0x80, 0x00, 0xF8, 0x94};

180 
	`addToH—d”
(
szSŒHeightSeq
, (szStripHeightSeq));

181 
szSŒ
[0] = 0xC0;

182 
szSŒ
[1] = 0x00;

183 
szSŒ
[2] = 0xF8;

184 
szSŒ
[3] = 0x97;

185 ià(
m_pJA
->
cŞÜ_mode
 == 0)

187 
szSŒ
[1] = 0x04;

189 
	`addToH—d”
((cÚ¡ 
BYTE
 *è
szSŒ
, 4);

191 
	`addToH—d”
(
JRICESeq
, (JRICESeq));

192 
	`addToH—d”
(
JRVueV”siÚTagSeq
, (JRVueVersionTagSeq));

193 
BYTE
 
szD©aL’gthSeq
[] = {0xC2, 0x38, 0x03, 0x00, 0x00, 0xF8, 0x92, 0x46};

194 ià(
m_eCom´essMode
 =ğ
COMPRESS_MODE_LJ
)

196 
szD©aL’gthSeq
[1] = 0;

197 
szD©aL’gthSeq
[2] = 0;

199 
	`addToH—d”
(
szD©aL’gthSeq
, (szDataLengthSeq));

200 
”r
 = 
	`CËªup
();

201  
”r
;

202 
	}
}

204 
DRIVER_ERROR
 
	gLJJ‘R—dy
::
	$FÜmF“d
()

206 
DRIVER_ERROR
 
”r
;

207 
	`addToH—d”
(
JRVueExŠ3Seq
, (JRVueExtn3Seq));

208 
	`addToH—d”
(
JRVueV”siÚTagSeq
, (JRVueVersionTagSeq));

209 
	`addToH—d”
(
JRV’dÜUniqueSeq
, (JRVendorUniqueSeq));

210 
	`addToH—d”
(
JREndPageSeq
, (JREndPageSeq));

211 
”r
 = 
	`CËªup
();

212  
”r
;

213 
	}
}

215 
DRIVER_ERROR
 
	gLJJ‘R—dy
::
	$EndJob
()

217 
DRIVER_ERROR
 
”r
;

218 
	`addToH—d”
(
JREndSessiÚSeq
, (JREndSessionSeq));

219 
	`addToH—d”
((cÚ¡ 
BYTE
 *è
PJLEx™
, 
	`¡¾’
(PJLExit));

220 
”r
 = 
	`CËªup
();

221  
”r
;

222 
	}
}

224 
DRIVER_ERROR
 
	gLJJ‘R—dy
::
	$EnÿpsuÏ‹
(
RASTERDATA
 *
IÅutRa¡”
, 
boŞ
 
bLa¡PÏÃ
)

226 
DRIVER_ERROR
 
”r
;

227 
iJ³gH—d”Size
 = 623;

228 
ulVuD©aL’gth
;

229 
BYTE
 *
pD©aPŒ
;

231 ià(
m_eCom´essMode
 !ğ
COMPRESS_MODE_LJ
)

233 
”r
 = 
	`£ndJPEGH—d”Info
(
IÅutRa¡”
);

236 ià(
m_pJA
->
cŞÜ_mode
 !ğ0 || 
m_eCom´essMode
 =ğ
COMPRESS_MODE_LJ
)

237 
iJ³gH—d”Size
 = 0;

239 ià(
IÅutRa¡”
->
¿¡”d©a
[
COLORTYPE_COLOR
] =ğ
NULL
)

241  
NO_ERROR
;

244 
ulVuD©aL’gth
 = 
IÅutRa¡”
->
¿¡”size
[
COLORTYPE_COLOR
] - 
iJ³gH—d”Size
;

245 
pD©aPŒ
 = 
IÅutRa¡”
->
¿¡”d©a
[
COLORTYPE_COLOR
] + 
iJ³gH—d”Size
;

246 
BYTE
 
szSŒ
[16];

247 
szSŒ
[0] = 
m_iSŒHeight
 & 0xFF;

248 
szSŒ
[1] = (
m_iSŒHeight
 & 0xFF00) >> 8;

249 
m_iSŒHeight
 +ğ
MOJAVE_STRIP_HEIGHT
;

250 
	`addToH—d”
(
JRR—dImageSeq
, (JRReadImageSeq));

251 
	`addToH—d”
(
szSŒ
, 2);

252 
	`addToH—d”
(
JRSŒHeightSeq
, (JRStripHeightSeq));

253 
	`addToH—d”
(
JRTextObjeùTy³Seq
, (JRTextObjectTypeSeq));

254 
	`addToH—d”
(
JRVueV”siÚTagSeq
, (JRVueVersionTagSeq));

255 
i
 = 0;

256 
szSŒ
[
i
++] = 0xC2;

257 
ulVuD©aL’gth
 += 6;

258 
szSŒ
[
i
++] = (
BYTE
è(
ulVuD©aL’gth
 & 0xFF);

259 
szSŒ
[
i
++] = (
BYTE
è((
ulVuD©aL’gth
 & 0x0000FF00) >> 8);

260 
szSŒ
[
i
++] = (
BYTE
è((
ulVuD©aL’gth
 & 0x00FF0000) >> 16);

261 
szSŒ
[
i
++] = (
BYTE
è((
ulVuD©aL’gth
 & 0xFF000000) >> 24);

262 
szSŒ
[
i
++] = 0xF8;

263 
szSŒ
[
i
++] = 0x92;

264 
szSŒ
[
i
++] = 0x46;

265 ià(
m_eCom´essMode
 =ğ
COMPRESS_MODE_LJ
)

266 
szSŒ
[
i
++] = 0x11;

268 
szSŒ
[
i
++] = 0x21;

269 
szSŒ
[
i
++] = 0x90;

270 
ulVuD©aL’gth
 -= 6;

271 
szSŒ
[
i
++] = (
BYTE
è(
ulVuD©aL’gth
 & 0xFF);

272 
szSŒ
[
i
++] = (
BYTE
è((
ulVuD©aL’gth
 & 0x0000FF00) >> 8);

273 
szSŒ
[
i
++] = (
BYTE
è((
ulVuD©aL’gth
 & 0x00FF0000) >> 16);

274 
szSŒ
[
i
++] = (
BYTE
è((
ulVuD©aL’gth
 & 0xFF000000) >> 24);

275 
	`addToH—d”
((cÚ¡ 
BYTE
 *è
szSŒ
, 
i
);

276 
”r
 = 
	`CËªup
();

277 ià(
”r
 =ğ
NO_ERROR
)

278 
”r
 = 
	`£ndBufãr
((cÚ¡ 
BYTE
 *è
pD©aPŒ
, 
ulVuD©aL’gth
);

279  
”r
;

280 
	}
}

282 
	gLJJ‘R—dy
::
	$addQTabË
(
DWORD
 *
qbË
)

284 
i
 = 0; i < 
QTABLE_SIZE
; i++)

286 *
cur_pş_bufãr_±r
++ = (
BYTE
è(
qbË
[
i
] & 0xFF);

287 *
cur_pş_bufãr_±r
++ = (
BYTE
è((
qbË
[
i
] >> 8) & 0xFF);

288 *
cur_pş_bufãr_±r
++ = 0;

289 *
cur_pş_bufãr_±r
++ = 0;

291 
	}
}

293 
DRIVER_ERROR
 
	gLJJ‘R—dy
::
	$£ndJPEGH—d”Info
(
RASTERDATA
 *
IÅutRa¡”
)

295 
DRIVER_ERROR
 
”r
;

296 ià(!
m_bS’dQTabË
)

298  
NO_ERROR
;

302 
s
;

303 
BYTE
 
c
[2];

304 } 
’dŸÂess
;

305 
’dŸÂess
.
s
 = 0x0A0B;

306 
”r
 = 
	`£ndBufãr
(
JRQTSeq
, (JRQTSeq));

307 ià(
’dŸÂess
.
c
[0] == 0x0B)

309 
”r
 = 
	`£ndBufãr
((cÚ¡ 
BYTE
 *è&
m_QTabËInfo
, (
DWORD
è* 
QTABLE_SIZE
 * 3);

313 
	`addQTabË
(
m_QTabËInfo
.
qbË0
);

314 
	`addQTabË
(
m_QTabËInfo
.
qbË1
);

315 
	`addQTabË
(
m_QTabËInfo
.
qbË2
);

316 
”r
 = 
	`CËªup
();

318 
m_bS’dQTabË
 = 
çl£
;

319 
	`addToH—d”
(
JRCRSeq
, (JRCRSeq));

320 
BYTE
 
szCR3Seq
[] = {0x00, 0x00, 0x00, 0x00};

321 ià(
m_pJA
->
cŞÜ_mode
 != 0)

323 
	`addToH—d”
(
JRCR1GSeq
, (JRCR1GSeq));

327 
	`addToH—d”
(
JRCR1CSeq
, (JRCR1CSeq));

328 
szCR3Seq
[0] = 0x01;

330 
	`addToH—d”
(
szCR3Seq
, (szCR3Seq));

331 
i
 = 0; i < 9; i++)

333 
	`addToH—d”
(
JRSCSeq
[
i
], 4);

335 
”r
 = 
	`CËªup
();

336  
”r
;

337 
	}
}

	@prnt/hpcups/LJJetReady.h

31 #iâdeà
LJJETREADY_H


32 
	#LJJETREADY_H


	)

34 
	~"CommÚDefš™iÚs.h
"

35 
	~"P–še.h
"

36 
	~"EnÿpsuÏtÜ.h
"

38 
şass
 
	gH®áÚ”
;

40 şas 
	cLJJ‘R—dy
: 
public
 
EnÿpsuÏtÜ


42 
public
:

43 
LJJ‘R—dy
();

44 ~
LJJ‘R—dy
();

45 
DRIVER_ERROR
 
EnÿpsuÏ‹
 (
RASTERDATA
 *
IÅutRa¡”
, 
boŞ
 
bLa¡PÏÃ
);

46 
DRIVER_ERROR
 
S¹Page
(
JobA‰ribu‹s
 *
pJA
);

47 
DRIVER_ERROR
 
CÚfigu»
(
P–še
 **
p–še
);

48 
DRIVER_ERROR
 
FÜmF“d
 ();

49 
DRIVER_ERROR
 
	$S’dCAPy
 (
iOff£t
è{ 
NO_ERROR
;}

50 
DRIVER_ERROR
 
	`EndJob
();

51 
boŞ
 
	$CªSkRa¡”s
(è{ 
çl£
;
	}
}

52 
boŞ
 
	$UÅackB™s
(è{ 
çl£
;
	}
}

53 
	$CªûlJob
(è{
	}
}

54 
	g´Ùeùed
:

55 
vœtu®
 
DRIVER_ERROR
 
addJobS‘tšgs
();

56 
vœtu®
 
DRIVER_ERROR
 
	$æushPrš‹rBufãr
(è{ 
NO_ERROR
;
	}
}

57 
	g´iv©e
:

58 
addQTabË
(
DWORD
 *
qbË
);

59 
DRIVER_ERROR
 
£ndJPEGH—d”Info
(
RASTERDATA
 *
IÅutRa¡”
);

60 
boŞ
 
	gm_bS’dQTabË
;

61 
	gm_iSŒHeight
;

62 
COMPRESS_MODE
 
	gm_eCom´essMode
;

63 
QTabËInfo
 
	gm_QTabËInfo
;

	@prnt/hpcups/LJMono.cpp

31 
	~"CommÚDefš™iÚs.h
"

32 
	~"LJMÚo.h
"

33 
	~"CŞÜM©ch”.h
"

34 
	~"H®áÚ”.h
"

35 
	~"Mode2.h
"

36 
	~"»sourûs.h
"

37 
	~"CŞÜM­s.h
"

38 
	~"Prš‹rCommªds.h
"

40 
	gLJMÚo
::
	$LJMÚo
(è: 
	$EnÿpsuÏtÜ
()

42 
	`mem£t
(&
m_PM
, 0, (m_PM));

43 
	`¡rıy
(
m_szLªguage
, "PCL");

44 
	}
}

46 
	gLJMÚo
::~
	$LJMÚo
()

48 
	}
}

50 
DRIVER_ERROR
 
LJMÚo
::
	$addJobS‘tšgs
()

52 
cur_pş_bufãr_±r
 +ğ
	`¥rštf
((*) cur_pcl_buffer_ptr,

53 "@PJL SET PAGEPROTECT=AUTO\012@PJL SET RESOLUTION=%d\012@PJL SET DENSITY=5\012", 
m_pQA
->
hÜizÚl_»sŞutiÚ
);

54 ià(
m_pQA
->
´št_qu®™y
 == -1)

56 
cur_pş_bufãr_±r
 +ğ
	`¥rštf
((*) cur_pcl_buffer_ptr,

59 ià(
m_pJA
->
e_du¶ex_mode
 !ğ
DUPLEXMODE_NONE
)

61 
cur_pş_bufãr_±r
 +ğ
	`¥rštf
((*) cur_pcl_buffer_ptr,

63 (
m_pJA
->
e_du¶ex_mode
 =ğ
DUPLEXMODE_BOOK
) ? "LONGEDGE" :

68 
	`addToH—d”
("@PJL SET DUPLEX=OFF\012", 19);

70 
cur_pş_bufãr_±r
 +ğ
	`¥rštf
((*ècur_pş_bufãr_±r, "@PJL ENTER LANGUAGE=%s\012", 
m_szLªguage
);

71 
	`£ndJobH—d”
();

72 
DRIVER_ERROR
 
”r
 = 
	`CËªup
();

73  
”r
;

74 
	}
}

76 
DRIVER_ERROR
 
	gLJMÚo
::
	$CÚfigu»
(
P–še
 **
p–še
)

78 
P–še
 *
p
 = 
NULL
;

79 
P–še
 *
h—d
;

80 
width
;

81 
CŞÜM©ch”
 *
pCŞÜM©ch”
;

82 
Mode2
 *
pMode2
;

83 
iRows
[
MAXCOLORPLANES
];

84 
uiResBoo¡
;

85 
h—d
 = *
p–še
;

92 
m_PM
.
dyeCouÁ
 = 1;

93 
m_PM
.
CŞÜD•th
[0] = 1;

94 
m_PM
.
cm­
.
ulM­1
 = 
ulM­DJ600_CCM_K
;

95 
m_PM
.
Ba£ResX
 = 
m_pQA
->
hÜizÚl_»sŞutiÚ
;

96 
m_PM
.
Ba£ResY
 = 
m_pQA
->
v”tiÿl_»sŞutiÚ
;

97 
m_PM
.
eHT
 = 
FED
;

98 
m_PM
.
BÏckFEDTabË
 = 
HTBš¬y_İ’
;

99 
m_PM
.
CŞÜFEDTabË
 = 
HTBš¬y_İ’
;

100 
m_PM
.
MixedRes
 = 
çl£
;

102 
i
 = 0; i < 
MAXCOLORPLANES
; i++)

104 
m_PM
.
ResŞutiÚX
[
i
] = 
m_pQA
->
hÜizÚl_»sŞutiÚ
;

105 
m_PM
.
ResŞutiÚY
[
i
] = 
m_pQA
->
v”tiÿl_»sŞutiÚ
;

106 
iRows
[
i
] = 
m_PM
.
ResŞutiÚX
[i] / m_PM.
Ba£ResX
;

108 
uiResBoo¡
 = 
m_PM
.
Ba£ResX
 / m_PM.
Ba£ResY
;

109 ià(
uiResBoo¡
 == 0)

110 
uiResBoo¡
 = 1;

112 
width
 = 
m_pMA
->
´šbË_width
;

115 
pCŞÜM©ch”
 = 
Ãw
 
	`CŞÜM©ch”
(
m_PM
.
cm­
, m_PM.
dyeCouÁ
, 
width
);

116 
h—d
 = 
Ãw
 
	`P–še
(
pCŞÜM©ch”
);

117 
m_pH®áÚ”
 = 
Ãw
 
	`H®áÚ”
 (&
m_PM
, 
width
, 
iRows
, 
uiResBoo¡
, m_PM.
eHT
 =ğ
MATRIX
);

118 
p
 = 
Ãw
 
	`P–še
(
m_pH®áÚ”
);

119 
h—d
->
	`AddPha£
(
p
);

120 
pMode2
 = 
Ãw
 
	`Mode2
(
width
);

121 
p
 = 
Ãw
 
	`P–še
(
pMode2
);

122 
h—d
->
	`AddPha£
(
p
);

123 
pMode2
->
my¶ªe
 = 
COLORTYPE_COLOR
;

125 *
p–še
 = 
h—d
;

126  
NO_ERROR
;

127 
	}
}

129 
DRIVER_ERROR
 
	gLJMÚo
::
	$S¹Page
(
JobA‰ribu‹s
 *
pJA
)

131 
m_pJA
 = 
pJA
;

132 
m_pMA
 = &
pJA
->
medŸ_©Œibu‹s
;

133 
m_pQA
 = &
pJA
->
qu®™y_©Œibu‹s
;

134 
·ge_numb”
++;

135  
NO_ERROR
;

136 
	}
}

138 
DRIVER_ERROR
 
	gLJMÚo
::
	$FÜmF“d
()

140 
DRIVER_ERROR
 
”r
;

141 
”r
 = 
	`CËªup
();

142 
”r
 = 
m_pSy¡emS”viûs
->
	`S’d
((cÚ¡ 
BYTE
 *) "\x0C", 1);

143  
”r
;

144 
	}
}

146 
DRIVER_ERROR
 
	gLJMÚo
::
	$EndJob
()

148 
DRIVER_ERROR
 
”r
 = 
NO_ERROR
;

149 
”r
 = 
	`CËªup
();

150 
”r
 = 
m_pSy¡emS”viûs
->
	`S’d
((cÚ¡ 
BYTE
 *) "\x1B*rC", 4);

151 
”r
 = 
m_pSy¡emS”viûs
->
	`S’d
(
Re£t
, (Reset));

152 ià(
”r
 =ğ
NO_ERROR
)

153 
”r
 = 
m_pSy¡emS”viûs
->
	`S’d
(
UEL
, (UEL));

154  
”r
;

155 
	}
}

157 
DRIVER_ERROR
 
	gLJMÚo
::
	$EnÿpsuÏ‹
(
RASTERDATA
 *
IÅutRa¡”
, 
boŞ
 
bLa¡PÏÃ
)

159 
DRIVER_ERROR
 
”r
 = 
NO_ERROR
;

160 
tmpSŒ
[16];

161 
iL’
;

162 
BYTE
 
c
 = 
m_pH®áÚ”
->
	`La¡PÏÃ
() ? 'W' : 'V';

163 
iL’
 = 
	`¥rštf
 (
tmpSŒ
, "\x1b*b%u%c", 
IÅutRa¡”
->
¿¡”size
[
COLORTYPE_COLOR
], 
c
);

164 
”r
 = 
this
->
	`S’d
((cÚ¡ 
BYTE
 *è
tmpSŒ
, 
iL’
);

165 ià(
”r
 =ğ
NO_ERROR
 && 
IÅutRa¡”
->
¿¡”size
[
COLORTYPE_COLOR
] > 0)

167 
”r
 = 
this
->
	`S’d
(
IÅutRa¡”
->
¿¡”d©a
[
COLORTYPE_COLOR
],

168 
IÅutRa¡”
->
¿¡”size
[
COLORTYPE_COLOR
]);

170  
”r
;

171 
	}
}

	@prnt/hpcups/LJMono.h

31 #iâdeà
LJMONO_H


32 
	#LJMONO_H


	)

34 
	~"CommÚDefš™iÚs.h
"

35 
	~"P–še.h
"

36 
	~"EnÿpsuÏtÜ.h
"

38 
şass
 
	gH®áÚ”
;

40 şas 
	cLJMÚo
: 
public
 
EnÿpsuÏtÜ


42 
public
:

43 
LJMÚo
();

44 ~
LJMÚo
();

45 
DRIVER_ERROR
 
EnÿpsuÏ‹
 (
RASTERDATA
 *
IÅutRa¡”
, 
boŞ
 
bLa¡PÏÃ
);

46 
DRIVER_ERROR
 
S¹Page
(
JobA‰ribu‹s
 *
pJA
);

47 
DRIVER_ERROR
 
CÚfigu»
(
P–še
 **
p–še
);

48 
DRIVER_ERROR
 
EndJob
();

49 
DRIVER_ERROR
 
FÜmF“d
();

50 
	m´Ùeùed
:

51 
vœtu®
 
DRIVER_ERROR
 
addJobS‘tšgs
();

52 
DRIVER_ERROR
 
	$æushPrš‹rBufãr
(è{ 
NO_ERROR
;}

53 
´iv©e
:

54 
H®áÚ”
 *
m_pH®áÚ”
;

55 
PrštMode
 
m_PM
;

56 
	}
};

	@prnt/hpcups/LJZjStream.cpp

33 
	~"CommÚDefš™iÚs.h
"

34 
	~"P–še.h
"

35 
	~"EnÿpsuÏtÜ.h
"

36 
	~"CŞÜM©ch”.h
"

37 
	~"H®áÚ”.h
"

38 
	~"ModeJbig.h
"

39 
	~"»sourûs.h
"

40 
	~"CŞÜM­s.h
"

41 
	~"Prš‹rCommªds.h
"

42 
	~"LJZjSŒ—m.h
"

43 
	~"Uts.h
"

44 
	~"hpjbig_w¿µ”.h
"

45 
	~"uts.h
"

47 
	#ZJC_BAND_HEIGHT
 100

	)

49 
	gLJZjSŒ—m
::
	$LJZjSŒ—m
 (è: 
	$EnÿpsuÏtÜ
 ()

51 
	`mem£t
(&
m_PM
, 0, (m_PM));

52 
	`¡rıy
(
m_szLªguage
, "ZJS");

53 
m_pModeJbig
 = 
NULL
;

54 
m_bNÙS’t
 = 
Œue
;

55 
	}
}

57 
	gLJZjSŒ—m
::~
	$LJZjSŒ—m
()

59 
	}
}

61 
DRIVER_ERROR
 
LJZjSŒ—m
::
	$addJobS‘tšgs
()

63 
BYTE
 
cI‹ms
[3] = {
ZJI_DMCOLLATE
, 
ZJI_PAGECOUNT
, 
ZJI_DMDUPLEX
};

64 
nI‹ms
 = 0;

65 
	`addToH—d”
("%s", "@PJL ENTER LANGUAGE=ZJS\x0AJZJZ");

66 
BYTE
 *
p
 = 
cur_pş_bufãr_±r
;

68 ià(
m_pJA
->
e_du¶ex_mode
 =ğ
DUPLEXMODE_NONE
)

70 
p
[3] = 52;

71 
p
[7] = 
ZJT_START_DOC
;

72 
p
[11] = 3;

73 
p
[13] = 36 ;

74 
nI‹ms
 = 3;

78 
p
[3] = 28;

79 
p
[7] = 
ZJT_START_DOC
;

80 
p
[11] = 1;

81 
p
[13] = 12;

82 
nI‹ms
 = 1;

85 
p
[14] = 'Z';

86 
p
[15] = 'Z';

87 
i
 = 16;

88 
j
 = 0; j < 
nI‹ms
; j++)

90 
p
[
i
 + 3] = 12;

91 
p
[
i
 + 5] = 
cI‹ms
[
j
];

92 
p
[
i
 + 6] = 
ZJIT_UINT32
;

93 
p
[
i
 + 11] = 
j
 / 2;

94 
i
 += 12;

96 
cur_pş_bufãr_±r
 +ğ
i
;

97 
DRIVER_ERROR
 
”r
 = 
	`CËªup
();

98  
”r
;

99 
	}
}

101 
DRIVER_ERROR
 
	gLJZjSŒ—m
::
	$CÚfigu»
(
P–še
 **
p–še
)

103 
DRIVER_ERROR
 
”r
;

104 
P–še
 *
p
 = 
NULL
;

105 
P–še
 *
h—d
;

106 
width
;

107 
CŞÜM©ch”
 *
pCŞÜM©ch”
;

108 
H®áÚ”
 *
pH®áÚ”
;

109 
iRows
[
MAXCOLORPLANES
];

110 
uiResBoo¡
;

111 
h—d
 = *
p–še
;

118 
m_PM
.
Ba£ResX
 = 
m_pQA
->
hÜizÚl_»sŞutiÚ
;

119 
m_PM
.
Ba£ResY
 = 
m_pQA
->
v”tiÿl_»sŞutiÚ
;

120 
m_PM
.
eHT
 = 
FED
;

121 
m_PM
.
MixedRes
 = 
çl£
;

122 
m_PM
.
BÏckFEDTabË
 = 
HTBš¬y_İ’
;

123 ià(
m_pJA
->
cŞÜ_mode
 == 0)

125 
m_PM
.
cm­
.
ulM­1
 = 
NULL
;

126 
m_PM
.
cm­
.
ulM­2
 = 
NULL
;

127 
m_PM
.
cm­
.
ulM­3
 = 
ucM­DJ4100_KCMY_PhÙo_Be¡A_12x12x1
;

128 
m_PM
.
dyeCouÁ
 = 4;

129 
m_PM
.
CŞÜFEDTabË
 = 
HT1200x1200x1PhÙoBe¡_İ’
;

133 
m_PM
.
cm­
.
ulM­1
 = 
ulM­DJ600_CCM_K
;

134 
m_PM
.
dyeCouÁ
 = 1;

135 
m_PM
.
CŞÜFEDTabË
 = 
HTBš¬y_İ’
;

138 
i
 = 0; i < 
MAXCOLORPLANES
; i++)

140 
m_PM
.
CŞÜD•th
[
i
] = 1;

141 
m_PM
.
ResŞutiÚX
[
i
] = 
m_pQA
->
hÜizÚl_»sŞutiÚ
;

142 
m_PM
.
ResŞutiÚY
[
i
] = 
m_pQA
->
v”tiÿl_»sŞutiÚ
;

143 
iRows
[
i
] = 
m_PM
.
ResŞutiÚX
[i] / m_PM.
Ba£ResX
;

146 
uiResBoo¡
 = 
m_PM
.
Ba£ResX
 / m_PM.
Ba£ResY
;

147 ià(
uiResBoo¡
 == 0)

148 
uiResBoo¡
 = 1;

150 
width
 = 
m_pMA
->
´šbË_width
;

152 
pCŞÜM©ch”
 = 
Ãw
 
	`CŞÜM©ch”
(
m_PM
.
cm­
, m_PM.
dyeCouÁ
, 
width
);

153 
h—d
 = 
Ãw
 
	`P–še
(
pCŞÜM©ch”
);

154 
pH®áÚ”
 = 
Ãw
 
	`H®áÚ”
 (&
m_PM
, 
width
, 
iRows
, 
uiResBoo¡
, m_PM.
eHT
 =ğ
MATRIX
);

155 
p
 = 
Ãw
 
	`P–še
(
pH®áÚ”
);

156 
h—d
->
	`AddPha£
(
p
);

157 
m_pModeJbig
 = 
Ãw
 
	`ModeJbig
(
width
);

158 
p
 = 
Ãw
 
	`P–še
(
m_pModeJbig
);

159 
h—d
->
	`AddPha£
(
p
);

160 
m_pModeJbig
->
my¶ªe
 = 
COLORTYPE_COLOR
;

162 
m_iPÏÃs
 = 1;

163 
m_iBµ
 = 1;

164 
height
 = 
m_pMA
->
´šbË_height
;

165 
ZJPLATFORM
 
ezj_¶©fÜm
 = 
ZJSTREAM
;

166 ià(!
	`¡rcmp
(
m_pJA
->
´š‹r_¶©fÜm
, "ljzjscolor"))

168 
m_iBµ
 = 2;

169 
ezj_¶©fÜm
 = 
ZJCOLOR
;

170 ià(
m_pJA
->
cŞÜ_mode
 == 0)

172 
m_iPÏÃs
 = 4;

174 
height
 = 
ZJC_BAND_HEIGHT
;

176 if(
m_pJA
->
´š‹r_¶©fÜm_v”siÚ
 == 2)

178 
height
 = 
m_pMA
->
´šbË_height
;

179 
ezj_¶©fÜm
 = 
ZJCOLOR2
;

182 
”r
 = 
m_pModeJbig
->
	`In™
(
height
, 
m_iPÏÃs
, 
m_iBµ
, 
ezj_¶©fÜm
);

184 *
p–še
 = 
h—d
;

185  
”r
;

186 
	}
}

188 
DRIVER_ERROR
 
	gLJZjSŒ—m
::
	$S¹Page_ljzjcŞÜ2
 (
JobA‰ribu‹s
 *
pJA
)

190 
DWORD
 
dwNumI‹ms
 = 13;

191 
BYTE
 
szSŒ
[16 + 12 * 13];

192 
i
=0;

194 
i
 = 
	`S’dChunkH—d”
 (
szSŒ
, 16 + 
dwNumI‹ms
 * 12, 
ZJT_START_PAGE
, dwNumItems);

195 
i
 +ğ
	`S’dI‹m
 (
szSŒ
+i, 
ZJIT_UINT32
, 
ZJI_PLANE
, 
m_iPÏÃs
);

196 
i
 +ğ
	`S’dI‹m
 (
szSŒ
+i, 
ZJIT_UINT32
, 
ZJI_DMPAPER
, 
m_pMA
->
pş_id
);

197 
i
 +ğ
	`S’dI‹m
 (
szSŒ
+i, 
ZJIT_UINT32
, 
ZJI_DMCOPIES
, 1);

198 
i
 +ğ
	`S’dI‹m
 (
szSŒ
+i, 
ZJIT_UINT32
, 
ZJI_DMDEFAULTSOURCE
, 
m_pJA
->
medŸ_sourû
);

199 
i
 +ğ
	`S’dI‹m
 (
szSŒ
+i, 
ZJIT_UINT32
, 
ZJI_DMMEDIATYPE
, 
m_pQA
->
medŸ_ty³
);

200 
i
 +ğ
	`S’dI‹m
 (
szSŒ
+i, 
ZJIT_UINT32
, 
ZJI_NBIE
, 
m_iPÏÃs
);

201 
i
 +ğ
	`S’dI‹m
 (
szSŒ
+i, 
ZJIT_UINT32
, 
ZJI_RESOLUTION_X
, 
m_pQA
->
hÜizÚl_»sŞutiÚ
);

202 
i
 +ğ
	`S’dI‹m
 (
szSŒ
+i, 
ZJIT_UINT32
, 
ZJI_RESOLUTION_Y
, 
m_pQA
->
v”tiÿl_»sŞutiÚ
);

203 
i
 +ğ
	`S’dI‹m
 (
szSŒ
+i, 
ZJIT_UINT32
, 
ZJI_RASTER_X
, (((
m_pMA
->
´šbË_width
 + 31è/ 32è* 32è* 
m_iBµ
);

204 
i
 +ğ
	`S’dI‹m
 (
szSŒ
+i, 
ZJIT_UINT32
, 
ZJI_RASTER_Y
, 
m_pMA
->
´šbË_height
);

205 
i
 +ğ
	`S’dI‹m
 (
szSŒ
+i, 
ZJIT_UINT32
, 
ZJI_VIDEO_BPP
, 
m_iBµ
);

206 
i
 +ğ
	`S’dI‹m
 (
szSŒ
+i, 
ZJIT_UINT32
, 
ZJI_VIDEO_X
, (((
m_pMA
->
´šbË_width
 + 31) / 32) * 32));

207 
i
 +ğ
	`S’dI‹m
 (
szSŒ
+i, 
ZJIT_UINT32
, 
ZJI_VIDEO_Y
, 
m_pMA
->
´šbË_height
);

208  
	`S’d
 ((cÚ¡ 
BYTE
 *è
szSŒ
, 
i
);

209 
	}
}

211 
DRIVER_ERROR
 
	gLJZjSŒ—m
::
	$S¹Page
 (
JobA‰ribu‹s
 *
pJA
)

213 
DRIVER_ERROR
 
”r
 = 
NO_ERROR
;

214 
DWORD
 
dwNumI‹ms
 = 15;

215 
BYTE
 
szSŒ
[16 + 16 * 12];

216 
i
;

217 
width
;

219 
m_iPÏÃNumb”
 = 0;

220 
m_iCurRa¡”
 = 0;

221 if((
	`¡rcmp
(
m_pJA
->
´š‹r_¶©fÜm
, "ljzjscŞÜ"è=ğ0è&& (m_pJA->
´š‹r_¶©fÜm_v”siÚ
 == 2))

223  
	`S¹Page_ljzjcŞÜ2
(
pJA
);

227 ià(
m_pJA
->
e_du¶ex_mode
 =ğ
DUPLEXMODE_NONE
)

229 
dwNumI‹ms
 = 14;

233 
dwNumI‹ms
 = 15;

236 
width
 = ((
m_pMA
->
´šbË_width
 + 31) / 32) * 32;

237 ià(
m_pJA
->
cŞÜ_mode
 == 0)

238 
dwNumI‹ms
++;

240 
i
 = 0;

241 
i
 +ğ
	`S’dChunkH—d”
 (
szSŒ
, 16 + 
dwNumI‹ms
 * 12, 
ZJT_START_PAGE
, dwNumItems);

242 ià(
m_pJA
->
cŞÜ_mode
 == 0)

244 
i
 +ğ
	`S’dI‹m
 (
szSŒ
+i, 
ZJIT_UINT32
, 
ZJI_PLANE
, 
m_iPÏÃs
);

247 
i
 +ğ
	`S’dI‹m
 (
szSŒ
+i, 
ZJIT_UINT32
, 
ZJI_DMCOPIES
, 1);

250 ià(
m_pJA
->
e_du¶ex_mode
 !ğ
DUPLEXMODE_NONE
)

253 ià(
m_pJA
->
e_du¶ex_mode
 =ğ
DUPLEXMODE_BOOK
)

255 
i
 +ğ
	`S’dI‹m
 (
szSŒ
+i, 
ZJIT_UINT32
, 
ZJI_DMDUPLEX
, 2);

260 
i
 +ğ
	`S’dI‹m
 (
szSŒ
+i, 
ZJIT_UINT32
, 
ZJI_DMDUPLEX
, 3);

264 
i
 +ğ
	`S’dI‹m
 (
szSŒ
+i, 
ZJIT_UINT32
, 
ZJI_DMMEDIATYPE
, 
m_pQA
->
medŸ_ty³
);

265 
i
 +ğ
	`S’dI‹m
 (
szSŒ
+i, 
ZJIT_UINT32
, 
ZJI_DMPAPER
, 
m_pMA
->
pş_id
);

266 
i
 +ğ
	`S’dI‹m
 (
szSŒ
+i, 
ZJIT_UINT32
, 
ZJI_DMDEFAULTSOURCE
, 
m_pJA
->
medŸ_sourû
);

267 
i
 +ğ
	`S’dI‹m
 (
szSŒ
+i, 
ZJIT_UINT32
, 
ZJI_NBIE
, 
m_iPÏÃs
);

268 
i
 +ğ
	`S’dI‹m
 (
szSŒ
+i, 
ZJIT_UINT32
, 
ZJI_RESOLUTION_X
, 
m_pQA
->
hÜizÚl_»sŞutiÚ
);

269 
i
 +ğ
	`S’dI‹m
 (
szSŒ
+i, 
ZJIT_UINT32
, 
ZJI_RESOLUTION_Y
, 
m_pQA
->
v”tiÿl_»sŞutiÚ
);

270 
i
 +ğ
	`S’dI‹m
 (
szSŒ
+i, 
ZJIT_UINT32
, 
ZJI_RASTER_X
, 
width
 * 
m_iBµ
);

271 
i
 +ğ
	`S’dI‹m
 (
szSŒ
+i, 
ZJIT_UINT32
, 
ZJI_RASTER_Y
, 
m_pMA
->
´šbË_height
);

272 
i
 +ğ
	`S’dI‹m
 (
szSŒ
+i, 
ZJIT_UINT32
, 
ZJI_VIDEO_BPP
, 
m_iBµ
);

273 
i
 +ğ
	`S’dI‹m
 (
szSŒ
+i, 
ZJIT_UINT32
, 
ZJI_VIDEO_X
, 
width
);

274 
i
 +ğ
	`S’dI‹m
 (
szSŒ
+i, 
ZJIT_UINT32
, 
ZJI_VIDEO_Y
, 
m_pMA
->
´šbË_height
);

275 
i
 +ğ
	`S’dI‹m
 (
szSŒ
+i, 
ZJIT_UINT32
, 
ZJI_RET
, 
RET_ON
);

276 
i
 +ğ
	`S’dI‹m
 (
szSŒ
+i, 
ZJIT_UINT32
, 
ZJI_TONER_SAVE
, (
m_pQA
->
´št_qu®™y
 == -1) ? 1 : 0);

278 
”r
 = 
	`£ndBufãr
 ((cÚ¡ 
BYTE
 *è
szSŒ
, 
i
);

279  
”r
;

280 
	}
}

282 
DRIVER_ERROR
 
	gLJZjSŒ—m
::
	$£ndBÏnkBªds
()

284 ià(
	`¡rcmp
(
m_pJA
->
´š‹r_¶©fÜm
, "ljzjscolor"))

286  
NO_ERROR
;

288 if(
m_pJA
->
´š‹r_¶©fÜm_v”siÚ
 == 2)

290  
NO_ERROR
;

292 
DRIVER_ERROR
 
”r
 = 
NO_ERROR
;

293 
»maššg_¿¡”s
 = 
m_pMA
->
´šbË_height
 - 
m_iCurRa¡”
;

294 
num_¶ªes
 = (
m_pJA
->
cŞÜ_mode
 == 0) ? 4 : 1;

295 ià(
»maššg_¿¡”s
 <= 0)

297  
NO_ERROR
;

300 
RASTERDATA
 
¿¡”_d©a
;

301 ià(
»maššg_¿¡”s
 < 
ZJC_BAND_HEIGHT
)

303 
	`mem£t
(&
¿¡”_d©a
, 0, (raster_data));

304 
m_pModeJbig
->
	`S‘BªdHeight
(
»maššg_¿¡”s
);

305 
k
 = 0; k < 
num_¶ªes
; k++)

307 
m_pModeJbig
->
	`Flush
();

308 
m_pModeJbig
->
	`NextOuutRa¡”
(
¿¡”_d©a
);

309 
”r
 = 
	`EnÿpsuÏ‹
(&
¿¡”_d©a
, 
Œue
);

310 ià(
”r
 !ğ
NO_ERROR
)

311  
”r
;

313 
m_pModeJbig
->
	`S‘BªdHeight
(
ZJC_BAND_HEIGHT
);

314  
”r
;

317 
	`mem£t
(&
¿¡”_d©a
, 0, (raster_data));

318 
m_pModeJbig
->
	`Proûss
(&
¿¡”_d©a
);

319 
m_pModeJbig
->
	`Flush
();

320 
m_pModeJbig
->
	`NextOuutRa¡”
(
¿¡”_d©a
);

321 
»maššg_¿¡”s
 > 0)

323 
k
 = 0; k < 
num_¶ªes
; k++)

325 
”r
 = 
	`EnÿpsuÏ‹
(&
¿¡”_d©a
, 
Œue
);

326 ià(
”r
 !ğ
NO_ERROR
)

328  
”r
;

331 
»maššg_¿¡”s
 -ğ
ZJC_BAND_HEIGHT
;

333 ià(
»maššg_¿¡”s
 <= 0)

335  
NO_ERROR
;

338 
	`mem£t
(&
¿¡”_d©a
, 0, (raster_data));

339 
m_pModeJbig
->
	`S‘BªdHeight
(
»maššg_¿¡”s
);

340 
m_pModeJbig
->
	`Proûss
(&
¿¡”_d©a
);

341 
m_pModeJbig
->
	`Flush
();

342 
m_pModeJbig
->
	`NextOuutRa¡”
(
¿¡”_d©a
);

343 
k
 = 0; k < 
num_¶ªes
; k++)

345 
”r
 = 
	`EnÿpsuÏ‹
(&
¿¡”_d©a
, 
Œue
);

347 
m_pModeJbig
->
	`S‘BªdHeight
(
ZJC_BAND_HEIGHT
);

349  
”r
;

350 
	}
}

352 
DRIVER_ERROR
 
	gLJZjSŒ—m
::
	$FÜmF“d
 ()

354 
DRIVER_ERROR
 
”r
 = 
NO_ERROR
;

355 
BYTE
 
szSŒ
[128];

356 
size
 = 16;

358 
”r
 = 
	`£ndBÏnkBªds
();

359 ià(
”r
 !ğ
NO_ERROR
)

360  
”r
;

362 if(((
	`¡rcmp
(
m_pJA
->
´š‹r_¶©fÜm
, "ljzjscŞÜ"è=ğ0è&& (m_pJA->
´š‹r_¶©fÜm_v”siÚ
 == 2)) == 0)

364 
	`S’dChunkH—d”
 (
szSŒ
, 16, 
ZJT_END_PAGE
, 0);

367 ià(!
	`¡rcmp
(
m_pJA
->
´š‹r_¶©fÜm
, "ljzjscolor"))

369 
i
 = 0;

370 
iCŞ
 = (
m_pJA
->
cŞÜ_mode
 == 0) ? 1 : 0;

372 
	`mem£t
(
szSŒ
, 0, (szStr));

373 
i
 = 
	`S’dChunkH—d”
 (
szSŒ
, 112, 
ZJT_END_PAGE
, 8);

374 
j
 = 0; j < 8; j++)

376 
i
 +ğ
	`S’dI‹m
 (
szSŒ
+i, 
ZJIT_UINT32
, 0x8200+
j
, (j % 4 =ğ3è? 1 : 
iCŞ
);

378 
size
 = 112;

379 if(
m_pJA
->
´š‹r_¶©fÜm_v”siÚ
 == 2)

381  
	`S’d
 ((cÚ¡ 
BYTE
 *è
szSŒ
, 
size
);

385 
”r
 = 
	`£ndBufãr
 ((cÚ¡ 
BYTE
 *è
szSŒ
, 
size
);

387  
”r
;

388 
	}
}

390 
DRIVER_ERROR
 
	gLJZjSŒ—m
::
	$EndJob
()

392 
BYTE
 
szSŒ
[16];

393 
	`mem£t
(
szSŒ
, 0, (szStr));

394 
szSŒ
[3] = 16;

395 
szSŒ
[7] = 
ZJT_END_DOC
;

396 
szSŒ
[14] = 'Z';

397 
szSŒ
[15] = 'Z';

398  
this
->
	`£ndBufãr
((cÚ¡ 
BYTE
 *è
szSŒ
, 16);

399 
	}
}

401 
DRIVER_ERROR
 
	gLJZjSŒ—m
::
	$EnÿpsuÏ‹
 (
RASTERDATA
 *
¿¡”
, 
boŞ
 
bLa¡PÏÃ
)

403 ià(
¿¡”
->
¿¡”d©a
[
COLORTYPE_COLOR
] =ğ
NULL
 ||„a¡”->
¿¡”size
[COLORTYPE_COLOR] == 0)

405  
NO_ERROR
;

407 ià(!
	`¡rcmp
(
m_pJA
->
´š‹r_¶©fÜm
, "ljzjscolor"))

409  
	`’ÿpsuÏ‹CŞÜ
(
¿¡”
);

412 
DRIVER_ERROR
 
”r
 = 
NO_ERROR
;

413 
BYTE
 
szSŒ
[36];

414 
i
 = 0;

415 
iTÙ®Size
 = 
¿¡”
->
¿¡”size
[
COLORTYPE_COLOR
];

419 
i
 = 
	`S’dChunkH—d”
 (
szSŒ
, 36, 
ZJT_JBIG_BIH
, 0);

421 
	`memıy
 (
szSŒ
 + 16, 
¿¡”
->
¿¡”d©a
[
COLORTYPE_COLOR
], 20);

422 
”r
 = 
	`£ndBufãr
 ((cÚ¡ 
BYTE
 *è
szSŒ
, 36);

423 
ERRCHECK
;

425 
iTÙ®Size
 -= 20;

426 
iPadCouÁ
 = 0;

427 ià(
iTÙ®Size
 % 16)

429 
iPadCouÁ
 = ((
iTÙ®Size
 / 16 + 1) * 16) - iTotalSize;

431 
dwTÙ®
 = 
iTÙ®Size
;

432 
BYTE
 *
p
 = 
¿¡”
->
¿¡”d©a
[
COLORTYPE_COLOR
] + 20;

433 
i
 = 
dwTÙ®
 / 65536;

435 
j
 = 0; j < 
i
; j++)

437 
	`S’dChunkH—d”
 (
szSŒ
, 16 + 65536, 
ZJT_JBIG_HID
, 0);

438 
”r
 = 
	`£ndBufãr
 ((cÚ¡ 
BYTE
 *è
szSŒ
, 16);

439 
ERRCHECK
;

440 
”r
 = 
	`£ndBufãr
 ((cÚ¡ 
BYTE
 *è
p
, 65536);

441 
ERRCHECK
;

442 
dwTÙ®
 -= 65536;

443 
p
 += 65536;

445 
i
 = 
	`S’dChunkH—d”
 (
szSŒ
, 16 + 
dwTÙ®
 + 
iPadCouÁ
, 
ZJT_JBIG_HID
, 0);

446 
”r
 = 
	`£ndBufãr
 ((cÚ¡ 
BYTE
 *è
szSŒ
, 16);

447 
ERRCHECK
;

448 
”r
 = 
	`£ndBufãr
 ((cÚ¡ 
BYTE
 *è
p
, 
dwTÙ®
);

449 
ERRCHECK
;

450 ià(
iPadCouÁ
 != 0)

452 
	`mem£t
 (
szSŒ
, 0, 
iPadCouÁ
);

453 
”r
 = 
	`£ndBufãr
 ((cÚ¡ 
BYTE
 *è
szSŒ
, 
iPadCouÁ
);

455 
i
 = 
	`S’dChunkH—d”
 (
szSŒ
, 16, 
ZJT_END_JBIG
, 0);

456 ià(
”r
 =ğ
NO_ERROR
)

457 
”r
 = 
	`£ndBufãr
 ((cÚ¡ 
BYTE
 *è
szSŒ
, 16);

458 
”r
 = 
	`CËªup
();

459  
”r
;

460 
	}
}

462 
DRIVER_ERROR
 
	gLJZjSŒ—m
::
	$’ÿpsuÏ‹CŞÜ2
 (
RASTERDATA
 *
¿¡”
)

464 
DRIVER_ERROR
 
”r
 = 
NO_ERROR
;

465 
BYTE
 
szSŒ
[256];

466 
i
 = 0;

467 
¶ªe
[] = {3, 2, 1, 4};

469 ià(
m_pJA
->
cŞÜ_mode
 == 0)

471 
i
 = 
	`S’dChunkH—d”
 (
szSŒ
, 28, 
ZJT_START_PLANE
, 1);

472 
i
 +ğ
	`S’dI‹m
 (
szSŒ
+i, 
ZJIT_UINT32
, 
ZJI_PLANE
, 
¶ªe
[
m_iPÏÃNumb”
]);

473 
”r
 = 
	`S’d
 ((cÚ¡ 
BYTE
 *è
szSŒ
, 
i
);

476 
i
=0;

477 
i
 +ğ
	`S’dChunkH—d”
 (
szSŒ
+i, 36, 
ZJT_JBIG_BIH
, 0);

478 
”r
 = 
	`S’d
 ((cÚ¡ 
BYTE
 *è
szSŒ
, 
i
);

479 
”r
 = 
	`S’d
 ((cÚ¡ 
BYTE
 *è
¿¡”
->
¿¡”d©a
[
COLORTYPE_COLOR
], 20);

481 
BYTE
 *
p
 = 
¿¡”
->
¿¡”d©a
[
COLORTYPE_COLOR
] + 20;

483 
DWORD
 
dwTÙ®Size
 = 
¿¡”
->
¿¡”size
[
COLORTYPE_COLOR
];

484 
dwTÙ®Size
 -= 20;

485 
iPadCouÁ
 = 0;

487 
i
 = 0;

488 ià(
dwTÙ®Size
 % 4)

490 
iPadCouÁ
 = ((
dwTÙ®Size
 / 4 + 1) * 4) - dwTotalSize;

493 
DWORD
 
dwMaxChunkSize
 = 0x10000;

494 
DWORD
 
dwCu¼’tChunkSize
 = 0;

495 
boŞ
 
bLa¡Chunk
 = 
çl£
;

497 
DWORD
 
dwLoİCouÁ
 = 0; dwLoİCouÁ < 
dwTÙ®Size
 ; dwLoİCouÁ +=
dwMaxChunkSize
)

499 
	`mem£t
 (
szSŒ
, 0, (szStr));

500 
dwCu¼’tChunkSize
 = 
dwMaxChunkSize
;

502 if(
dwLoİCouÁ
 + 
dwCu¼’tChunkSize
 > 
dwTÙ®Size
)

504 
dwCu¼’tChunkSize
 = 
dwTÙ®Size
 - (
dwLoİCouÁ
);

505 
bLa¡Chunk
 = 
Œue
;

507 ià(!
bLa¡Chunk
)

509 
i
 = 
	`S’dChunkH—d”
 (
szSŒ
, 
dwCu¼’tChunkSize
 + 16, 
ZJT_JBIG_HID
, 0);

513 
i
 = 
	`S’dChunkH—d”
 (
szSŒ
, 
dwCu¼’tChunkSize
 + 16 + 
iPadCouÁ
, 
ZJT_JBIG_HID
, 0);

515 
”r
 = 
	`S’d
 ((cÚ¡ 
BYTE
 *è
szSŒ
, 
i
);

516 
”r
 = 
	`S’d
 ((cÚ¡ 
BYTE
 *è
p
, 
dwCu¼’tChunkSize
);

517 
p
 +ğ
dwCu¼’tChunkSize
;

519 if(
iPadCouÁ
 != 0)

521 
	`mem£t
 (
szSŒ
, 0, 
iPadCouÁ
);

522 
”r
 = 
	`S’d
 ((cÚ¡ 
BYTE
 *è
szSŒ
, 
iPadCouÁ
);

525 
i
=0;

526 
	`mem£t
 (
szSŒ
, 0, (szStr));

527 
i
 = 
	`S’dChunkH—d”
 (
szSŒ
, 16, 
ZJT_END_JBIG
, 0);

528 ià(
m_pJA
->
cŞÜ_mode
 == 0)

530 
i
 +ğ
	`S’dChunkH—d”
 (
szSŒ
+i, 28, 
ZJT_END_PLANE
, 1);

531 
i
 +ğ
	`S’dI‹m
 (
szSŒ
+i, 
ZJIT_UINT32
, 
ZJI_PLANE
, 
¶ªe
[
m_iPÏÃNumb”
]);

533 
”r
 = 
	`S’d
 ((cÚ¡ 
BYTE
 *è
szSŒ
, 
i
);

535 ià(
m_pJA
->
cŞÜ_mode
 == 0)

537 
m_iPÏÃNumb”
++;

538 ià(
m_iPÏÃNumb”
 == 4) m_iPlaneNumber = 0;

540  
”r
;

541 
	}
}

543 
DRIVER_ERROR
 
	gLJZjSŒ—m
::
	$’ÿpsuÏ‹CŞÜ
 (
RASTERDATA
 *
¿¡”
)

545 
boŞ
 
bLa¡SŒide
 = 
Œue
;

546 
kEnd
 = 2;

547 
DRIVER_ERROR
 
”r
 = 
NO_ERROR
;

548 
BYTE
 
szSŒ
[256];

549 
i
 = 0;

551 ià(
m_pJA
->
´š‹r_¶©fÜm_v”siÚ
 == 2)

553  
	`’ÿpsuÏ‹CŞÜ2
(
¿¡”
);

556 
HPLJZjsJbgEncSt
 *
£
 = (HPLJZjsJbgEncSˆ*è(
¿¡”
->
¿¡”d©a
[
COLORTYPE_COLOR
] +„a¡”->
¿¡”size
[COLORTYPE_COLOR]);

558 ià(
m_pJA
->
cŞÜ_mode
 == 0)

560 
kEnd
 = 5;

562 ià(
m_iPÏÃNumb”
 =ğ0 || 
m_pJA
->
cŞÜ_mode
 != 0)

563 
m_iCurRa¡”
 +ğ
£
->
yd
;

564 ià(
m_iCurRa¡”
 < 
m_pMA
->
´šbË_height
)

566 
bLa¡SŒide
 = 
çl£
;

575 ià(
m_iPÏÃNumb”
 =ğ0 && 
m_bNÙS’t
)

577 
m_bNÙS’t
 = 
çl£
;

578 
i
 = 0;

579 
k
 = 1; k < 
kEnd
; k++)

581 
i
 = 
	`S’dChunkH—d”
 (
szSŒ
, 132, 
ZJT_BITMAP
, 8);

582 
szSŒ
[13] += 20;

583 
i
 +ğ
	`S’dI‹m
 (
szSŒ
+i, 
ZJIT_UINT32
, 
ZJI_BITMAP_TYPE
, 1);

584 
i
 +ğ
	`S’dI‹m
 (
szSŒ
+i, 
ZJIT_UINT32
, 
ZJI_BITMAP_PIXELS
, 
£
->
xd
);

585 
i
 +ğ
	`S’dI‹m
 (
szSŒ
+i, 
ZJIT_UINT32
, 
ZJI_BITMAP_STRIDE
, 
£
->
xd
);

586 
i
 +ğ
	`S’dI‹m
 (
szSŒ
+i, 
ZJIT_UINT32
, 
ZJI_BITMAP_LINES
, 
£
->
yd
);

587 
i
 +ğ
	`S’dI‹m
 (
szSŒ
+i, 
ZJIT_UINT32
, 
ZJI_BITMAP_BPP
, 1);

588 
i
 +ğ
	`S’dI‹m
 (
szSŒ
+i, 
ZJIT_UINT32
, 
ZJI_VIDEO_BPP
, 
m_iBµ
);

589 
i
 +ğ
	`S’dI‹m
 (
szSŒ
+i, 
ZJIT_UINT32
, 
ZJI_PLANE
,

590 (
m_pJA
->
cŞÜ_mode
 =ğ0è? 
k
 : 4);

591 
i
 +ğ
	`S’dI‹mExŒa
 (
szSŒ
+i, 
ZJIT_BYTELUT
, 
ZJI_ENCODING_DATA
, 20, 20);

592 
szSŒ
[
i
++] = 
£
->
dl
;

593 
szSŒ
[
i
++] = 
£
->
d
;

594 
szSŒ
[
i
++] = 
£
->
¶ªes
;

595 
szSŒ
[
i
++] = 0;

596 
j
 = 3; j >= 0; j--)

598 
szSŒ
[
i
] = (
BYTE
è((
£
->
xd
 >> (8 * 
j
)) & 0xFF);

599 
szSŒ
[4+
i
] = (
BYTE
è((
£
->
yd
 >> (8 * 
j
)) & 0xFF);

600 
szSŒ
[8+
i
] = (
BYTE
è((
£
->
l0
 >> (8 * 
j
)) & 0xFF);

601 
i
++;

603 
i
 += 8;

605 
szSŒ
[
i
++] = 
£
->
mx
;

606 
szSŒ
[
i
++] = 
£
->
my
;

607 
szSŒ
[
i
++] = 
£
->
Üd”
;

608 
szSŒ
[
i
++] = 
£
->
İtiÚs
;

609 
”r
 = 
	`£ndBufãr
 ((cÚ¡ 
BYTE
 *è
szSŒ
, 132);

610 
ERRCHECK
;

614 
BYTE
 *
p
 = 
¿¡”
->
¿¡”d©a
[
COLORTYPE_COLOR
] + 20;

615 
dwNumI‹ms
;

616 
dwSize
;

618 
DWORD
 
dwTÙ®Size
 = 
¿¡”
->
¿¡”size
[
COLORTYPE_COLOR
];

619 
dwTÙ®Size
 -= 20;

620 
iPadCouÁ
 = 0;

622 
i
 = 0;

623 ià(
dwTÙ®Size
 % 4)

625 
iPadCouÁ
 = ((
dwTÙ®Size
 / 4 + 1) * 4) - dwTotalSize;

628 
dwSize
 = 16 + 
dwTÙ®Size
 + 
iPadCouÁ
;

629 
dwNumI‹ms
 = 1;

630 ià(
bLa¡SŒide
)

632 
dwNumI‹ms
 = 3;

633 
m_bNÙS’t
 = 
Œue
;

635 
dwSize
 +ğ(
dwNumI‹ms
 * 12);

636 
i
 = 
	`S’dChunkH—d”
 (
szSŒ
, 
dwSize
, 
ZJT_BITMAP
, 
dwNumI‹ms
);

637 
i
 +ğ
	`S’dI‹m
 (
szSŒ
+i, 
ZJIT_UINT32
, 
ZJI_PLANE
, (
kEnd
 =ğ5è? 
m_iPÏÃNumb”
+1 : 4);

638 ià(
bLa¡SŒide
)

640 
i
 +ğ
	`S’dI‹m
 (
szSŒ
+i, 
ZJIT_UINT32
, 
ZJI_BITMAP_LINES
, 
£
->
yd
);

641 
i
 +ğ
	`S’dI‹m
 (
szSŒ
+i, 
ZJIT_UINT32
, 
ZJI_END_PLANE
, 
bLa¡SŒide
);

643 
”r
 = 
	`£ndBufãr
 ((cÚ¡ 
BYTE
 *è
szSŒ
, 
i
);

644 
ERRCHECK
;

646 
”r
 = 
	`£ndBufãr
 ((cÚ¡ 
BYTE
 *è
p
, 
dwTÙ®Size
);

647 
ERRCHECK
;

648 ià(
iPadCouÁ
 != 0)

650 
	`mem£t
 (
szSŒ
, 0, 
iPadCouÁ
);

651 
”r
 = 
	`£ndBufãr
 ((cÚ¡ 
BYTE
 *è
szSŒ
, 
iPadCouÁ
);

654 ià(
m_pJA
->
cŞÜ_mode
 == 0)

656 
m_iPÏÃNumb”
++;

657 ià(
m_iPÏÃNumb”
 == 4)

659 
m_iPÏÃNumb”
 = 0;

662  
”r
;

663 
	}
}

666 
DRIVER_ERROR
 
	gLJZjSŒ—m
::
	$´eProûssRa¡”D©a
(
cups_¿¡”_t
 **
µcups_¿¡”
, 
cups_·ge_h—d”2_t
* 
fœ¡·ge_cups_h—d”
, * 
pSw­edPagesFeName
)

668 
cu¼’t_·ge_numb”
 = 0;

669 
fdEv’
 = -1;

670 
fdOdd
 = -1;

671 
fdSw­ed
 = -1;

672 
loİúŒ
 = 0;

673 
DRIVER_ERROR
 
driv”_”rÜ
 = 
NO_ERROR
;

674 
cups_·ge_h—d”2_t
 
cups_h—d”
={0,};

675 
cups_¿¡”_t
 *
sw­ed_·ges_¿¡”
=
NULL
;

676 
cups_¿¡”_t
 *
ev’_·ges_¿¡”
=
NULL
;

677 
cups_¿¡”_t
 *
odd_·ges_¿¡”
 = 
NULL
;

678 
BYTE
* 
pPageD©aBufãr
 = 
NULL
;

679 
hpEv’PagesFe
[
MAX_FILE_PATH_LEN
]={0,};

680 
hpOddPagesFe
[
MAX_FILE_PATH_LEN
]={0,};

681 
	`¢´štf
(
hpEv’PagesFe
, (hpEv’PagesFe), "%s/hp_%s_cups_Ev’PagesXXXXXX",
CUPS_TMP_DIR
, 
m_pJA
->
u£r_Çme
);

682 
	`¢´štf
(
hpOddPagesFe
, (hpOddPagesFe), "%s/hp_%s_cups_OddPagesXXXXXX", 
CUPS_TMP_DIR
, 
m_pJA
->
u£r_Çme
);

684 ià(1 !ğ
m_pJA
->
´e_´oûss_¿¡”
 || !
fœ¡·ge_cups_h—d”
->
Du¶ex
){

685  
NO_ERROR
;

688 
	`dbglog
 ("DEBUG: Getting Swaped Pages Raster.....\n");

690 
	`memıy
(&
cups_h—d”
, 
fœ¡·ge_cups_h—d”
, (
cups_·ge_h—d”2_t
));

693 
fdEv’
 = 
	`mk¡emp
 (
hpEv’PagesFe
);

694 
fdOdd
 = 
	`mk¡emp
 (
hpOddPagesFe
);

695 
fdSw­ed
 = 
	`mk¡emp
 (
pSw­edPagesFeName
);

696 ià(
fdEv’
 < 0 || 
fdOdd
 < 0 || 
fdSw­ed
 < 0){

697 
	`dbglog
 ("ERROR: Unableo openemp output files for writing\n");

698 
driv”_”rÜ
 = 
SYSTEM_ERROR
;

699 
bugout
;

702 
ev’_·ges_¿¡”
 = 
	`cupsRa¡”O³n
(
fdEv’
, 
CUPS_RASTER_WRITE
);

703 
odd_·ges_¿¡”
 = 
	`cupsRa¡”O³n
(
fdOdd
, 
CUPS_RASTER_WRITE
);

704 ià(
ev’_·ges_¿¡”
 =ğ
NULL
 || 
odd_·ges_¿¡”
 == NULL) {

705 
	`dbglog
("cupsRasterOpen failed forƒven_pages_raster or odd_pages_raster\n");

706 
driv”_”rÜ
 = 
NULL_POINTER
;

707 
bugout
;

710 
pPageD©aBufãr
 = 
Ãw
 
BYTE
[
cups_h—d”
.
cupsBy‹sP”Lše
+1];

711 ià(
pPageD©aBufãr
 =ğ
NULL
) {

712 
driv”_”rÜ
 = 
ALLOCMEM_ERROR
;

713 
bugout
;

719 
cu¼’t_·ge_numb”
++;

720 if(
cu¼’t_·ge_numb”
 % 2) {

721 
	`cupsRa¡”Wr™eH—d”2
(
odd_·ges_¿¡”
, &
cups_h—d”
);

724 
	`cupsRa¡”Wr™eH—d”2
(
ev’_·ges_¿¡”
, &
cups_h—d”
);

728 
y
 = 0; y < (è
cups_h—d”
.
cupsHeight
; y++) {

729 
	`cupsRa¡”R—dPix–s
 (*
µcups_¿¡”
, 
pPageD©aBufãr
, 
cups_h—d”
.
cupsBy‹sP”Lše
);

730 if(
cu¼’t_·ge_numb”
 % 2) {

731 
	`cupsRa¡”Wr™ePix–s
 (
odd_·ges_¿¡”
, 
pPageD©aBufãr
, 
cups_h—d”
.
cupsBy‹sP”Lše
);

734 
	`cupsRa¡”Wr™ePix–s
 (
ev’_·ges_¿¡”
, 
pPageD©aBufãr
, 
cups_h—d”
.
cupsBy‹sP”Lše
);

738 } 
	`cupsRa¡”R—dH—d”2
(*
µcups_¿¡”
, &
cups_h—d”
));

740 
	`cupsRa¡”Clo£
(
ev’_·ges_¿¡”
);

741 
	`cupsRa¡”Clo£
(
odd_·ges_¿¡”
);

744 ià((
fdEv’
 = 
	`İ’
 (
hpEv’PagesFe
, 
O_RDONLY
)) == -1) {

745 
	`³¼Ü
("ERROR: Unableo openƒvenpage„aster file for„eading.");

746 
driv”_”rÜ
 = 
SYSTEM_ERROR
;

747 
bugout
;

750 ià((
fdOdd
 = 
	`İ’
 (
hpOddPagesFe
, 
O_RDONLY
)) == -1){

751 
	`³¼Ü
("ERROR: Unableo open odd…age„aster file for writing. ");

752 
driv”_”rÜ
 = 
SYSTEM_ERROR
;

753 
bugout
;

755 
ev’_·ges_¿¡”
 = 
	`cupsRa¡”O³n
(
fdEv’
, 
CUPS_RASTER_READ
);

756 
odd_·ges_¿¡”
 = 
	`cupsRa¡”O³n
(
fdOdd
, 
CUPS_RASTER_READ
);

757 
sw­ed_·ges_¿¡”
 = 
	`cupsRa¡”O³n
(
fdSw­ed
, 
CUPS_RASTER_WRITE
);

759 ià(
sw­ed_·ges_¿¡”
 =ğ
NULL
 || 
ev’_·ges_¿¡”
 =ğNULL || 
odd_·ges_¿¡”
 == NULL) {

760 
	`dbglog
("cupsRasterOpen failed forƒven_pages_raster or odd_pages_raster or swaped_pages_raster\n");

761 
driv”_”rÜ
 = 
NULL_POINTER
;

762 
bugout
;

766 
loİúŒ
 = 
cu¼’t_·ge_numb”
 / 2;

767 
loİúŒ
--) {

768 if(
	`cupsRa¡”R—dH—d”2
(
ev’_·ges_¿¡”
, &
cups_h—d”
)){

769 
	`cupsRa¡”Wr™eH—d”2
(
sw­ed_·ges_¿¡”
, &
cups_h—d”
);

772 
y
 = 0; y < (è
cups_h—d”
.
cupsHeight
; y++){

773 
	`cupsRa¡”R—dPix–s
 (
ev’_·ges_¿¡”
, 
pPageD©aBufãr
, 
cups_h—d”
.
cupsBy‹sP”Lše
);

774 
	`cupsRa¡”Wr™ePix–s
 (
sw­ed_·ges_¿¡”
, 
pPageD©aBufãr
, 
cups_h—d”
.
cupsBy‹sP”Lše
);

778 if(
	`cupsRa¡”R—dH—d”2
(
odd_·ges_¿¡”
, &
cups_h—d”
)){

779 
	`cupsRa¡”Wr™eH—d”2
(
sw­ed_·ges_¿¡”
, &
cups_h—d”
);

782 
y
 = 0; y < (è
cups_h—d”
.
cupsHeight
; y++) {

783 
	`cupsRa¡”R—dPix–s
 (
odd_·ges_¿¡”
, 
pPageD©aBufãr
, 
cups_h—d”
.
cupsBy‹sP”Lše
);

784 
	`cupsRa¡”Wr™ePix–s
 (
sw­ed_·ges_¿¡”
, 
pPageD©aBufãr
, 
cups_h—d”
.
cupsBy‹sP”Lše
);

791 if(
cu¼’t_·ge_numb”
%2 == 1){

792 
	`cupsRa¡”R—dH—d”2
(
odd_·ges_¿¡”
, &
cups_h—d”
);

793 
	`cupsRa¡”Wr™eH—d”2
(
sw­ed_·ges_¿¡”
, &
cups_h—d”
);

796 
y
 = 0; y < (è
cups_h—d”
.
cupsHeight
; y++){

797 
	`cupsRa¡”R—dPix–s
 (
odd_·ges_¿¡”
, 
pPageD©aBufãr
, 
cups_h—d”
.
cupsBy‹sP”Lše
);

798 
	`cupsRa¡”Wr™ePix–s
 (
sw­ed_·ges_¿¡”
, 
pPageD©aBufãr
, 
cups_h—d”
.
cupsBy‹sP”Lše
);

802 
	`cupsRa¡”Clo£
(
ev’_·ges_¿¡”
);

803 
	`cupsRa¡”Clo£
(
odd_·ges_¿¡”
);

804 
	`cupsRa¡”Clo£
(
sw­ed_·ges_¿¡”
);

806 if(
pPageD©aBufãr
){

807 
d–‘e
 [] 
pPageD©aBufãr
;

808 
pPageD©aBufãr
 = 
NULL
;

812 ià((
fdSw­ed
 = 
	`İ’
 (
pSw­edPagesFeName
, 
O_RDONLY
)) == -1){

813 
	`³¼Ü
("ERROR: Unableo open swaped…ages„aster file - ");

814 
driv”_”rÜ
 = 
SYSTEM_ERROR
;

815 
bugout
;

818 *
µcups_¿¡”
 = 
	`cupsRa¡”O³n
(
fdSw­ed
, 
CUPS_RASTER_READ
);

819 
	`cupsRa¡”R—dH—d”2
(*
µcups_¿¡”
, &
cups_h—d”
);

820 
	`memıy
(
fœ¡·ge_cups_h—d”
, &
cups_h—d”
, (
cups_·ge_h—d”2_t
));

821 
	`uÆšk
(
hpEv’PagesFe
);

822 
	`uÆšk
(
hpOddPagesFe
);

824  
NO_ERROR
;

826 
bugout
:

827 
	`dbglog
 ("DEBUG:Something went wrong while creating swaped…ages„aster..\n");

828 ià(
fdEv’
 > 2)

829 
	`şo£
(
fdEv’
);

830 ià(
fdOdd
 > 2)

831 
	`şo£
(
fdOdd
);

832 ià(
fdSw­ed
 > 2)

833 
	`şo£
(
fdSw­ed
);

836 if(
pPageD©aBufãr
){

837 
d–‘e
 [] 
pPageD©aBufãr
;

840 
	`uÆšk
(
hpEv’PagesFe
);

841 
	`uÆšk
(
hpOddPagesFe
);

842  
driv”_”rÜ
;

843 
	}
}

	@prnt/hpcups/LJZjStream.h

34 #iâdeà
LJZJSTREAM_H


35 
	#LJZJSTREAM_H


	)

37 
	~"ModeJbig.h
"

39 şas 
	cLJZjSŒ—m
 : 
public
 
EnÿpsuÏtÜ


41 
public
:

42 
LJZjSŒ—m
 ();

43 ~
LJZjSŒ—m
 ();

44 
DRIVER_ERROR
 
EnÿpsuÏ‹
 (
RASTERDATA
 *
IÅutRa¡”
, 
boŞ
 
bLa¡PÏÃ
);

45 
DRIVER_ERROR
 
S¹Page
(
JobA‰ribu‹s
 *
pJA
);

46 
DRIVER_ERROR
 
S¹Page_ljzjcŞÜ2
(
JobA‰ribu‹s
 *
pJA
);

47 
DRIVER_ERROR
 
CÚfigu»
(
P–še
 **
p–še
);

48 
DRIVER_ERROR
 
FÜmF“d
();

49 
DRIVER_ERROR
 
EndJob
();

50 
DRIVER_ERROR
 
	$S’dCAPy
(
iOff£t
è{ 
NO_ERROR
;}

51 
DRIVER_ERROR
 
	`´eProûssRa¡”D©a
(
cups_¿¡”_t
 **
cups_¿¡”
, 
cups_·ge_h—d”2_t
* 
fœ¡·ge_cups_h—d”
, * 
pSw­edPagesFeName
);

52 
boŞ
 
	$CªSkRa¡”s
(è{ 
çl£
;
	}
}

54 
	g´Ùeùed
:

55 
DRIVER_ERROR
 
	$æushPrš‹rBufãr
(è{ 
NO_ERROR
;
	}
}

56 
vœtu®
 
DRIVER_ERROR
 
addJobS‘tšgs
();

57 
	g´iv©e
:

58 
DRIVER_ERROR
 
’ÿpsuÏ‹CŞÜ
(
RASTERDATA
 *
šput
);

59 
DRIVER_ERROR
 
’ÿpsuÏ‹CŞÜ2
(
RASTERDATA
 *
šput
);

60 
DRIVER_ERROR
 
EndPage
 ();

61 
DRIVER_ERROR
 
£ndBÏnkBªds
();

62 
PrštMode
 
	gm_PM
;

63 
ModeJbig
 *
	gm_pModeJbig
;

64 
boŞ
 
	gm_bNÙS’t
;

65 
	gm_iCurRa¡”
;

66 
	gm_iPÏÃNumb”
;

67 
	gm_iBµ
;

68 
	gm_iPÏÃs
;

	@prnt/hpcups/LJZxStream.cpp

31 
	~"CommÚDefš™iÚs.h
"

32 
	~"P–še.h
"

33 
	~"EnÿpsuÏtÜ.h
"

34 
	~"CŞÜM©ch”.h
"

35 
	~"H®áÚ”.h
"

36 
	~"ModeJbig.h
"

37 
	~"»sourûs.h
"

38 
	~"CŞÜM­s.h
"

39 
	~"Prš‹rCommªds.h
"

40 
	~"LJZxSŒ—m.h
"

41 
	~"Uts.h
"

42 
	~"hpjbig_w¿µ”.h
"

44 
	gLJZxSŒ—m
::
	$LJZxSŒ—m
 (è: 
	$EnÿpsuÏtÜ
 ()

46 
	`mem£t
(&
m_PM
, 0, (m_PM));

47 
	`¡rıy
(
m_szLªguage
, "ZJS");

48 
m_pModeJbig
 = 
NULL
;

49 
	}
}

51 
	gLJZxSŒ—m
::~
	$LJZxSŒ—m
()

53 
	}
}

55 
DRIVER_ERROR
 
LJZxSŒ—m
::
	$addJobS‘tšgs
()

57 
szSŒ
[256];

58 
	`¡rıy
 (
szSŒ
, "\x1B\x25-12345X@PJL JOB\x0D\x0A");

59 
	`¡rıy
 (
szSŒ
+
	`¡¾’
 (szStr), "@PJL SET JAMRECOVERY=OFF\x0D\x0A");

60 
	`¡rıy
 (
szSŒ
+
	`¡¾’
 (szStr), "@PJL SET DENSITY=3\x0D\x0A");

61 
	`¡rıy
 (
szSŒ
+
	`¡¾’
 (szStr), "@PJL SET RET=MEDIUM\x0D\x0A");

62 
	`¡rıy
 (
szSŒ
+
	`¡¾’
 (szStr), "@PJL SET ECONOMODE=");

63 ià(
m_pQA
->
´št_qu®™y
 == -1)

65 
	`¡rıy
 (
szSŒ
+
	`¡¾’
 (szStr), "ON\x0D\x0A");

69 
	`¡rıy
 (
szSŒ
+
	`¡¾’
 (szStr), "OFF\x0D\x0A");

71 
	`addToH—d”
 ((cÚ¡ 
BYTE
 *è
szSŒ
, 
	`¡¾’
 (szStr));

73 
	`¡rıy
 (
szSŒ
, "\x1B\x25-12345X,XQX");

74 
	`addToH—d”
 ((cÚ¡ 
BYTE
 *è
szSŒ
, 
	`¡¾’
 (szStr));

75 
	`mem£t
 (
szSŒ
, 0x0, 92);

76 
szSŒ
[3] = 0x01;

77 
szSŒ
[7] = 0x07;

78 
i
 = 8;

79 
i
 +ğ
	`S’dIÁI‹m
 ((
BYTE
 *è
szSŒ
+i, 0x80000000, 0x04, 0x54);

80 
i
 +ğ
	`S’dIÁI‹m
 ((
BYTE
 *è
szSŒ
+i, 0x10000005, 0x04, 0x01);

81 
i
 +ğ
	`S’dIÁI‹m
 ((
BYTE
 *è
szSŒ
+i, 0x10000001, 0x04, 0x00);

82 
i
 +ğ
	`S’dIÁI‹m
 ((
BYTE
 *è
szSŒ
+i, 0x10000002, 0x04, 0x00);

83 
i
 +ğ
	`S’dIÁI‹m
 ((
BYTE
 *è
szSŒ
+i, 0x10000000, 0x04, 0x00);

84 
i
 +ğ
	`S’dIÁI‹m
 ((
BYTE
 *è
szSŒ
+i, 0x10000003, 0x04, 0x01);

85 
i
 +ğ
	`S’dIÁI‹m
 ((
BYTE
 *è
szSŒ
+i, 0x80000001, 0x04, 0xDEADBEEF);

86 
	`addToH—d”
 ((cÚ¡ 
BYTE
 *è
szSŒ
, 
i
);

87 
DRIVER_ERROR
 
”r
 = 
	`CËªup
();

88  
”r
;

89 
	}
}

91 
DRIVER_ERROR
 
	gLJZxSŒ—m
::
	$CÚfigu»
(
P–še
 **
p–še
)

93 
DRIVER_ERROR
 
”r
;

94 
P–še
 *
p
 = 
NULL
;

95 
P–še
 *
h—d
;

96 
width
;

97 
CŞÜM©ch”
 *
pCŞÜM©ch”
;

98 
H®áÚ”
 *
pH®áÚ”
;

99 
iRows
[
MAXCOLORPLANES
];

100 
uiResBoo¡
;

101 
h—d
 = *
p–še
;

108 
m_PM
.
dyeCouÁ
 = 1;

109 
m_PM
.
CŞÜD•th
[0] = 1;

110 
m_PM
.
cm­
.
ulM­1
 = 
ulM­DJ600_CCM_K
;

111 
m_PM
.
Ba£ResX
 = 
m_pQA
->
hÜizÚl_»sŞutiÚ
;

112 
m_PM
.
Ba£ResY
 = 
m_pQA
->
v”tiÿl_»sŞutiÚ
;

113 
m_PM
.
eHT
 = 
FED
;

114 
m_PM
.
BÏckFEDTabË
 = 
HTBš¬y_İ’
;

115 
m_PM
.
CŞÜFEDTabË
 = 
HTBš¬y_İ’
;

116 
m_PM
.
MixedRes
 = 
çl£
;

118 
i
 = 0; i < 
MAXCOLORPLANES
; i++)

120 
m_PM
.
ResŞutiÚX
[
i
] = 
m_pQA
->
hÜizÚl_»sŞutiÚ
;

121 
m_PM
.
ResŞutiÚY
[
i
] = 
m_pQA
->
v”tiÿl_»sŞutiÚ
;

122 
iRows
[
i
] = 
m_PM
.
ResŞutiÚX
[i] / m_PM.
Ba£ResX
;

124 
uiResBoo¡
 = 
m_PM
.
Ba£ResX
 / m_PM.
Ba£ResY
;

125 ià(
uiResBoo¡
 == 0)

126 
uiResBoo¡
 = 1;

128 
width
 = 
m_pMA
->
´šbË_width
;

130 
pCŞÜM©ch”
 = 
Ãw
 
	`CŞÜM©ch”
(
m_PM
.
cm­
, m_PM.
dyeCouÁ
, 
width
);

131 
h—d
 = 
Ãw
 
	`P–še
(
pCŞÜM©ch”
);

132 
pH®áÚ”
 = 
Ãw
 
	`H®áÚ”
 (&
m_PM
, 
width
, 
iRows
, 
uiResBoo¡
, m_PM.
eHT
 =ğ
MATRIX
);

133 
p
 = 
Ãw
 
	`P–še
(
pH®áÚ”
);

134 
h—d
->
	`AddPha£
(
p
);

135 
m_pModeJbig
 = 
Ãw
 
	`ModeJbig
(
width
);

136 
p
 = 
Ãw
 
	`P–še
(
m_pModeJbig
);

137 
h—d
->
	`AddPha£
(
p
);

138 
m_pModeJbig
->
my¶ªe
 = 
COLORTYPE_COLOR
;

139 
”r
 = 
m_pModeJbig
->
	`In™
(
m_pMA
->
´šbË_height
, 1, 2, 
ZXSTREAM
);

141 *
p–še
 = 
h—d
;

142  
”r
;

143 
	}
}

145 
DRIVER_ERROR
 
	gLJZxSŒ—m
::
	$S¹Page
 (
JobA‰ribu‹s
 *
pJA
)

147 
DRIVER_ERROR
 
”r
;

148 
BYTE
 
szSŒ
[256];

149 
i
;

150 
iOuutResŞutiÚ
 = 
m_pJA
->
š‹g”_v®ues
[1];

151 
width
;

153 
width
 = ((
m_pMA
->
´šbË_width
 + 31) / 32) * 32;

154 ià(
m_pQA
->
´št_qu®™y
 == 0)

155 
iOuutResŞutiÚ
 = 
m_pQA
->
v”tiÿl_»sŞutiÚ
;

156 
	`mem£t
 (
szSŒ
, 0x0,  (szStr));

157 
szSŒ
[3] = 0x03;

158 
szSŒ
[7] = 0x0F;

159 
”r
 = 
	`£ndBufãr
 ((cÚ¡ 
BYTE
 *è
szSŒ
, 8);

160 
i
 = 0;

161 
i
 +ğ
	`S’dIÁI‹m
 (
szSŒ
+i, 0x80000000, 0x04, 0xB4);

162 
i
 +ğ
	`S’dIÁI‹m
 (
szSŒ
+i, 0x20000005, 0x04, 0x01);

163 
i
 +ğ
	`S’dIÁI‹m
 (
szSŒ
+i, 0x20000006, 0x04, 0x07);

164 
i
 +ğ
	`S’dIÁI‹m
 (
szSŒ
+i, 0x20000000, 0x04, 0x01);

165 
i
 +ğ
	`S’dIÁI‹m
 (
szSŒ
+i, 0x20000007, 0x04, 0x01);

166 
i
 +ğ
	`S’dIÁI‹m
 (
szSŒ
+i, 0x20000008, 0x04, 
m_pQA
->
hÜizÚl_»sŞutiÚ
);

167 
i
 +ğ
	`S’dIÁI‹m
 (
szSŒ
+i, 0x20000009, 0x04, 
iOuutResŞutiÚ
);

168 
i
 +ğ
	`S’dIÁI‹m
 (
szSŒ
+i, 0x2000000D, 0x04, 
width
 * 2);

169 
i
 +ğ
	`S’dIÁI‹m
 (
szSŒ
+i, 0x2000000E, 0x04, 
m_pMA
->
´šbË_height
);

170 
i
 +ğ
	`S’dIÁI‹m
 (
szSŒ
+i, 0x2000000A, 0x04, 2);

171 
i
 +ğ
	`S’dIÁI‹m
 (
szSŒ
+i, 0x2000000F, 0x04, 
width
);

172 
i
 +ğ
	`S’dIÁI‹m
 (
szSŒ
+i, 0x20000010, 0x04, 
m_pMA
->
´šbË_height
);

173 
i
 +ğ
	`S’dIÁI‹m
 (
szSŒ
+i, 0x20000011, 0x04, 0x01);

174 
i
 +ğ
	`S’dIÁI‹m
 (
szSŒ
+i, 0x20000001, 0x04, 
m_pMA
->
pş_id
);

175 
i
 +ğ
	`S’dIÁI‹m
 (
szSŒ
+i, 0x80000001, 0x04, 0xDEADBEEF);

176 
”r
 = 
	`£ndBufãr
 ((cÚ¡ 
BYTE
 *è
szSŒ
, 
i
);

177  
”r
;

178 
	}
}

180 
DRIVER_ERROR
 
	gLJZxSŒ—m
::
	$FÜmF“d
 ()

182 
BYTE
 
szSŒ
[16];

183 
	`mem£t
(
szSŒ
, 0, (szStr));

184 
szSŒ
[3] = 0x06;

185 
szSŒ
[11] = 0x04;

186  
	`£ndBufãr
 ((cÚ¡ 
BYTE
 *è
szSŒ
, 16);

187 
	}
}

189 
DRIVER_ERROR
 
	gLJZxSŒ—m
::
	$EndJob
()

191 
szSŒ
[64];

192 
	`mem£t
(
szSŒ
, 0, (szStr));

193 
szSŒ
[3] = 2;

194 
	`¡rıy
 (
szSŒ
+8, "\x1B\x25-12345X@PJL EOJ\x0D\x0A\x1B\x25-12345X");

195  
this
->
	`£ndBufãr
((cÚ¡ 
BYTE
 *è
szSŒ
, 8 + 
	`¡¾’
(szStr+8));

196 
	}
}

198 
DRIVER_ERROR
 
	gLJZxSŒ—m
::
	$EnÿpsuÏ‹
 (
RASTERDATA
 *
¿¡”
, 
boŞ
 
bLa¡PÏÃ
)

200 
DRIVER_ERROR
 
”r
 = 
NO_ERROR
;

201 
BYTE
 
szSŒ
[128];

202 
i
 = 0;

203 
HPLJZjsJbgEncSt
 *
£
 = (HPLJZjsJbgEncSˆ*è(
¿¡”
->
¿¡”d©a
[
COLORTYPE_COLOR
] +„a¡”->
¿¡”size
[COLORTYPE_COLOR]);

209 
	`mem£t
 (
szSŒ
, 0x0, 128);

210 
szSŒ
[3] = 0x05;

211 
szSŒ
[7] = 0x04;

212 
i
 = 8;

213 
i
 +ğ
	`S’dIÁI‹m
 (
szSŒ
+i, 0x80000000, 0x04, 0x40);

214 
i
 +ğ
	`S’dIÁI‹m
 (
szSŒ
+i, 0x40000000, 0x04, 0x00);

215 
i
 +ğ
	`S’dIÁI‹m
 (
szSŒ
+i, 0x40000002, 0x14, 0x00);

216 
i
 -= 4;

217 
szSŒ
[
i
++] = 
£
->
dl
;

218 
szSŒ
[
i
++] = 
£
->
d
;

219 
szSŒ
[
i
++] = 
£
->
¶ªes
;

220 
szSŒ
[
i
++] = 0;

221 
j
 = 3; j >= 0; j--)

223 
szSŒ
[
i
] = (
BYTE
è((
£
->
xd
 >> (8 * 
j
)) & 0xFF);

224 
szSŒ
[4+
i
] = (
BYTE
è((
£
->
yd
 >> (8 * 
j
)) & 0xFF);

225 
szSŒ
[8+
i
] = (
BYTE
è((
£
->
l0
 >> (8 * 
j
)) & 0xFF);

226 
i
++;

228 
i
 = 56;

229 
szSŒ
[
i
++] = 
£
->
mx
;

230 
szSŒ
[
i
++] = 
£
->
my
;

231 
szSŒ
[
i
++] = 
£
->
Üd”
;

232 
szSŒ
[
i
++] = 
£
->
İtiÚs
;

233 
i
 +ğ
	`S’dIÁI‹m
 (
szSŒ
+i, 0x80000001, 0x04, 0xDEADBEEF);

235 
BYTE
 *
p
 = 
¿¡”
->
¿¡”d©a
[
COLORTYPE_COLOR
] + 20;

236 
iD©aSize
 = 
¿¡”
->
¿¡”size
[
COLORTYPE_COLOR
] - 20;

237 
szTmpSŒ
[32];

238 
	`mem£t
 (
szTmpSŒ
, 0x0, 32);

239 
szTmpSŒ
[3] = 0x07;

240 
szTmpSŒ
[5] = 0x01;

241 
szTmpSŒ
[19] = 0x06;

242 
szTmpSŒ
[27] = 0x04;

243 
iD©aSize
 > 65536)

245 
”r
 = 
	`£ndBufãr
 ((cÚ¡ 
BYTE
 *è
szSŒ
, 
i
);

246 
ERRCHECK
;

247 
”r
 = 
	`£ndBufãr
 ((cÚ¡ 
BYTE
 *è
szTmpSŒ
, 8);

248 
ERRCHECK
;

249 
”r
 = 
	`£ndBufãr
 ((cÚ¡ 
BYTE
 *è
p
, 65536);

250 
ERRCHECK
;

251 
iD©aSize
 -= 65536;

252 
p
 += 65536;

255 ià(
iD©aSize
 > 0)

257 
”r
 = 
	`£ndBufãr
 ((cÚ¡ 
BYTE
 *è
szSŒ
, 
i
);

258 
ERRCHECK
;

259 
szTmpSŒ
[5] = (è((
iD©aSize
 >> 16) & 0xFF);

260 
szTmpSŒ
[6] = (è((
iD©aSize
 >> 8) & 0xFF);

261 
szTmpSŒ
[7] = (è(
iD©aSize
 & 0xFF);

262 
”r
 = 
	`£ndBufãr
 ((cÚ¡ 
BYTE
 *è
szTmpSŒ
, 8);

263 
ERRCHECK
;

264 
”r
 = 
	`£ndBufãr
 ((cÚ¡ 
BYTE
 *è
p
, 
iD©aSize
);

265 
ERRCHECK
;

269  
”r
;

270 
	}
}

	@prnt/hpcups/LJZxStream.h

32 #iâdeà
LJZXSTREAM_H


33 
	#LJZXSTREAM_H


	)

35 
	~"ModeJbig.h
"

37 şas 
	cLJZxSŒ—m
 : 
public
 
EnÿpsuÏtÜ


39 
public
:

40 
LJZxSŒ—m
 ();

41 ~
LJZxSŒ—m
 ();

42 
DRIVER_ERROR
 
EnÿpsuÏ‹
 (
RASTERDATA
 *
IÅutRa¡”
, 
boŞ
 
bLa¡PÏÃ
);

43 
DRIVER_ERROR
 
S¹Page
(
JobA‰ribu‹s
 *
pJA
);

44 
DRIVER_ERROR
 
CÚfigu»
(
P–še
 **
p–še
);

45 
DRIVER_ERROR
 
FÜmF“d
();

46 
DRIVER_ERROR
 
EndJob
();

47 
DRIVER_ERROR
 
	$S’dCAPy
(
iOff£t
è{ 
NO_ERROR
;}

48 
boŞ
 
	$CªSkRa¡”s
(è{ 
çl£
;
	}
}

49 
	$S‘La¡Bªd
()

51 
m_pModeJbig
->
	`S‘La¡Bªd
();

52 
	}
}

54 
	g´Ùeùed
:

55 
DRIVER_ERROR
 
	$æushPrš‹rBufãr
(è{ 
NO_ERROR
;
	}
}

56 
vœtu®
 
DRIVER_ERROR
 
addJobS‘tšgs
();

57 
	g´iv©e
:

58 
DRIVER_ERROR
 
EndPage
 ();

59 
PrštMode
 
	gm_PM
;

60 
ModeJbig
 *
	gm_pModeJbig
;

	@prnt/hpcups/Lidil.cpp

31 
	~"CommÚDefš™iÚs.h
"

32 
	~"EnÿpsuÏtÜ.h
"

33 
	~"LidCom´ess.h
"

34 
	~"Lid.h
"

35 
	~"CŞÜM©ch”.h
"

36 
	~"H®áÚ”.h
"

37 
	~"»sourûs.h
"

38 
	~"CŞÜM­s.h
"

39 
	~"LidPrštModes.h
"

40 
	~"Prš‹rCommªds.h
"

44 
IÁ32
 
	mšt_v®ue
;

45 
	mch¬_v®
[4];

46 } 
	tIÁ32By‹s
;

50 
IÁ16
 
	mšt_v®ue
;

51 
	mch¬_v®
[2];

52 } 
	tIÁ16By‹s
;

54 
	gLid
::
	$Lid
(è: 
	$EnÿpsuÏtÜ
()

56 
m_pPM
 = 
NULL
;

57 
m_lid_v”siÚ
 = 1;

58 
m_iBy‹sP”Swšg
 = 2;

59 
m_iCŞÜP’ResŞutiÚ
 = 300;

60 
m_iBÏckP’ResŞutiÚ
 = 1200;

61 
m_iNumBÏckNozzËs
 = 400;

62 
m_cPrštDœeùiÚ
 = 
PRNDRN_LEFTTORIGHT
;

63 
m_Sw©hD©a
 = 
NULL
;

64 
m_sRefCouÁ
 = 6;

65 
m_iBÏnkRa¡”s
 = 0;

66 
m_iRa¡”CouÁ
 = 0;

67 
m_iNextRa¡”
 = 0;

68 
m_iNextCŞÜ
 = 0;

69 
m_iB™D•th
 = 1;

70 
m_bBidœeùiÚ®PrštšgOn
 = 
Œue
;

71 
m_cKtoCV”tAlign
 = 12;

72 
m_cPtoCV”tAlign
 = 6;

73 
m_pLidCom´ess
 = 
NULL
;

74 
m_szCom´essBuf
 = 
NULL
;

75 
IÁ16By‹s
 
v®
;

76 
v®
.
št_v®ue
 = 0x0102;

77 ià(
v®
.
ch¬_v®
[0] == 0x01)

78 
m_bL™eEndŸn
 = 
çl£
;

80 
m_bL™eEndŸn
 = 
Œue
;

81 
	}
}

83 
	gLid
::~
	$Lid
()

85 ià(
m_pLidCom´ess
)

86 
d–‘e
 
m_pLidCom´ess
;

87 ià(
m_Sw©hD©a
)

88 
d–‘e
 [] 
m_Sw©hD©a
;

89 ià(
m_szCom´essBuf
)

90 
d–‘e
 [] 
m_szCom´essBuf
;

91 
	}
}

93 
DRIVER_ERROR
 
	gLid
::
	$CÚfigu»
(
P–še
 **
p–še
)

95 
P–še
 *
p
 = 
NULL
;

96 
P–še
 *
h—d
;

97 
width
;

98 
CŞÜM©ch”
 *
pCŞÜM©ch”
;

99 
iRows
[
MAXCOLORPLANES
];

100 
uiResBoo¡
;

101 
h—d
 = *
p–še
;

103 ià(
m_pPM
->
Ba£ResX
 !ğ
m_pQA
->
hÜizÚl_»sŞutiÚ
 ||

104 
m_pPM
->
Ba£ResY
 !ğ
m_pQA
->
v”tiÿl_»sŞutiÚ
)

106 
	`dbglog
("Requested„esolution‚ot supported with„equested…rintmode\n");

107  
UNSUPPORTED_PRINTMODE
;

110 
i
 = 0; i < 
MAXCOLORPLANES
; i++)

112 
iRows
[
i
] = 
m_pPM
->
ResŞutiÚX
[i] / m_pPM->
Ba£ResX
;

114 
uiResBoo¡
 = 
m_pPM
->
Ba£ResX
 / m_pPM->
Ba£ResY
;

115 ià(
uiResBoo¡
 == 0)

116 
uiResBoo¡
 = 1;

118 
width
 = 
m_pMA
->
´šbË_width
;

120 
pCŞÜM©ch”
 = 
Ãw
 
	`CŞÜM©ch”
(
m_pPM
->
cm­
, m_pPM->
dyeCouÁ
, 
width
);

121 
h—d
 = 
Ãw
 
	`P–še
(
pCŞÜM©ch”
);

122 
H®áÚ”
 *
pH®áÚ”
;

123 
pH®áÚ”
 = 
Ãw
 
	`H®áÚ”
 (
m_pPM
, 
width
, 
iRows
, 
uiResBoo¡
, m_pPM->
eHT
 =ğ
MATRIX
);

124 
p
 = 
Ãw
 
	`P–še
(
pH®áÚ”
);

125 
h—d
->
	`AddPha£
(
p
);

127 *
p–še
 = 
h—d
;

128  
NO_ERROR
;

129 
	}
}

131 
DRIVER_ERROR
 
	gLid
::
	$S¹Job
(
Sy¡emS”viûs
 *
pSy¡emS”viûs
, 
JobA‰ribu‹s
 *
pJA
)

133 
DRIVER_ERROR
 
”r
 = 
NO_ERROR
;

134 
m_pSy¡emS”viûs
 = 
pSy¡emS”viûs
;

136 
m_pJA
 = 
pJA
;

137 
m_pMA
 = &
pJA
->
medŸ_©Œibu‹s
;

138 
m_pQA
 = &
pJA
->
qu®™y_©Œibu‹s
;

140 ià(!
	`¡rcmp
(
m_pJA
->
´š‹r_¶©fÜm
, "dj4100"))

142 
m_lid_v”siÚ
 = 2;

143 
m_iBy‹sP”Swšg
 = 4;

144 
m_iCŞÜP’ResŞutiÚ
 = 600;

146 ià(!
	`¡rcmp
(
m_pJA
->
´š‹r_¶©fÜm
, "dj2600"))

148 
m_lid_v”siÚ
 = 2;

149 
m_iBy‹sP”Swšg
 = 4;

150 
m_iCŞÜP’ResŞutiÚ
 = 600;

151 
m_iBÏckP’ResŞutiÚ
 = 600;

152 
m_iNumBÏckNozzËs
 = 336;

154 ià(
m_pQA
->
´št_qu®™y
 =ğ
BEST_QUALITY
 && m_pQA->
medŸ_ty³
 =ğ
MEDIATYPE_PHOTO
)

156 
m_iB™D•th
 = 2;

158 
cur_pş_bufãr_size
 = 
PCL_BUFFER_SIZE
;

159 
pş_bufãr
 = 
Ãw
 
BYTE
[
cur_pş_bufãr_size
 + 2];

160 ià(
pş_bufãr
 =ğ
NULL
)

162  
ALLOCMEM_ERROR
;

164 
	`mem£t
(
pş_bufãr
, 0, 
cur_pş_bufãr_size
);

165 
cur_pş_bufãr_±r
 = 
pş_bufãr
;

167 ià(!
	`£ËùPrštMode
())

169 
	`dbglog
("£ËùPrštModçed, PrštModÇmğ%s\n", 
m_pQA
->
´št_mode_Çme
);

170  
UNSUPPORTED_PRINTMODE
;

174 ià(
m_pPM
->
Ba£ResX
 !ğ
m_pQA
->
hÜizÚl_»sŞutiÚ
 ||

175 
m_pPM
->
Ba£ResY
 !ğ
m_pQA
->
v”tiÿl_»sŞutiÚ
)

177 
	`dbglog
("Requested„esolution‚ot supported with„equested…rintmode\n");

178 
	`dbglog
(" m_pPM->Ba£ResX = %d\n",
m_pPM
->
Ba£ResX
);

179 
	`dbglog
(" m_pPM->Ba£ResY = %d\n",
m_pPM
->
Ba£ResY
);

180 
	`dbglog
(" m_pQA->hÜizÚl_»sŞutiÚ = %d\n",
m_pQA
->
hÜizÚl_»sŞutiÚ
);

181 
	`dbglog
(" m_pQA->v”tiÿl_»sŞutiÚ = %d\n",
m_pQA
->
v”tiÿl_»sŞutiÚ
);

182  
UNSUPPORTED_PRINTMODE
;

185 
m_iV”tPo¢
 = (
m_pMA
->
´šbË_¡¬t_y
 * 
DEVUNITS_XBOW
è/ 
m_pQA
->
v”tiÿl_»sŞutiÚ
;

186 
m_iLeáM¬gš
 = (
m_pMA
->
´šbË_¡¬t_x
 * 
DEVUNITS_XBOW
è/ 
m_pQA
->
v”tiÿl_»sŞutiÚ
;

187 ià(
m_pJA
->
´št_bÜd”Ëss
)

189 
m_iV”tPo¢
 = (-
m_pMA
->
v”tiÿl_ov”¥¿y
 * 
DEVUNITS_XBOW
è/ (2 * 
m_pQA
->
v”tiÿl_»sŞutiÚ
);

190 
m_iLeáM¬gš
 = (-
m_pMA
->
hÜizÚl_ov”¥¿y
 * 
DEVUNITS_XBOW
è/ (2 * 
m_pQA
->
hÜizÚl_»sŞutiÚ
);

193 
”r
 = 
	`®loÿ‹Sw©hBufãrs
();

194 ià(
”r
 !ğ
NO_ERROR
)

196 
	`dbglog
("®loÿ‹Sw©hBufãr çed,ƒ¼ = %d\n", 
”r
);

197  
”r
;

200 
	`addToH—d”
(
LdlSync
, (LdlSync));

201 
cur_pş_bufãr_±r
[
SYNC_CMD_OPT_SIZE
] = 
FRAME_SYN
;

202 
”r
 = 
m_pSy¡emS”viûs
->
	`S’d
(
pş_bufãr
, 
SYNCSIZE
);

203 
cur_pş_bufãr_±r
 = 
pş_bufãr
;

204 
	`addToH—d”
(
LdlSyncCom¶‘e
, (LdlSyncComplete));

205 
	`addToH—d”
(
LdlRe£t
, (LdlReset));

206 
UIÁ16
 
mem_Ãeded
 = 
SIZEOF_LDLHDR
 + 
SIZEOF_LDL_JOB_CMDOPT
 + 
SIZEOF_LDLTERM
;

207 ià(
m_lid_v”siÚ
 == 2)

209 
mem_Ãeded
 += 4;

211 
	`flLidH—d”
(
NULL
, 
eLDLS¹Job
, 
mem_Ãeded
);

212 *
cur_pş_bufãr_±r
++ = 
OPERATION_STJOB
;

213 
	`addIÁ32
(
m_pJA
->
job_id
);

214 ià(
m_lid_v”siÚ
 == 2)

215 
	`addIÁ32
(0);

216 *
cur_pş_bufãr_±r
++ = 
FRAME_SYN
;

217 
”r
 = 
	`CËªup
();

220  
”r
;

221 
	}
}

223 
DRIVER_ERROR
 
	gLid
::
	$EndJob
()

225 
DRIVER_ERROR
 
”r
 = 
NO_ERROR
;

226 
UIÁ16
 
mem_Ãeded
 = 
SIZEOF_LDLHDR
 + 
SIZEOF_LDL_JOB_CMDOPT
 + 
SIZEOF_LDLTERM
;

227 
	`CËªup
();

228 
	`mem£t
(
pş_bufãr
, 0, 
cur_pş_bufãr_size
);

229 
	`flLidH—d”
(
NULL
, 
eLDLEndJob
, 
mem_Ãeded
);

230 *
cur_pş_bufãr_±r
++ = 
OPERATION_ENDJOB
;

231 
	`addIÁ32
(
m_pJA
->
job_id
);

232 *
cur_pş_bufãr_±r
++ = 
FRAME_SYN
;

233 
	`addToH—d”
(
LdlSync
, (LdlSync));

234 
cur_pş_bufãr_±r
 +ğ
SYNC_CMD_OPT_SIZE
;

235 *
cur_pş_bufãr_±r
++ = 
FRAME_SYN
;

236 
cur_pş_bufãr_±r
 = 
pş_bufãr
 + 
SYNCSIZE
 + 
mem_Ãeded
;

237 
	`addToH—d”
(
LdlSyncCom¶‘e
, (LdlSyncComplete));

238 
	`addToH—d”
(
LdlRe£t
, (LdlReset));

239 
”r
 = 
	`CËªup
();

240  
”r
;

241 
	}
}

243 
	gLid
::
	$CªûlJob
()

245 
UIÁ16
 
mem_Ãeded
 = 
SIZEOF_LDLHDR
 + 
SIZEOF_LDL_JOB_CMDOPT


246 + 
SIZEOF_LDLTERM
;

247 
	`flLidH—d”
 (
NULL
, 
eLDLCÚŒŞ
, 
mem_Ãeded
);

248 
	`addIÁ32
 (
m_pJA
->
job_id
);

249 *
cur_pş_bufãr_±r
++ = 
OPERATION_CANCJOB
;

250 *
cur_pş_bufãr_±r
++ = 
FRAME_SYN
;

251 
	`CËªup
();

252 
	}
}

254 
DRIVER_ERROR
 
	gLid
::
	$S¹Page
(
JobA‰ribu‹s
 *
pJA
)

256 
DRIVER_ERROR
 
”r
 = 
NO_ERROR
;

257 
m_pJA
 = 
pJA
;

258 
m_pMA
 = &
pJA
->
medŸ_©Œibu‹s
;

259 
m_pQA
 = &
pJA
->
qu®™y_©Œibu‹s
;

260 
UIÁ32
 
mem_Ãeded
 = 
SIZEOF_LDLHDR
 + 
SIZEOF_LDL_LDPAGE_CMDOPT


261 + 
SIZEOF_LDL_LDPAGE_OPTFLDS


262 + 
SIZEOF_LDLTERM
;

264 
	`mem£t
 (
cur_pş_bufãr_±r
, 0, 
mem_Ãeded
);

266 
	`flLidH—d”
 (
NULL
, 
eLDLLßdPage
, (
UIÁ16
è
mem_Ãeded
);

267 *
cur_pş_bufãr_±r
++ = 
m_pQA
->
medŸ_ty³
;;

268 *
cur_pş_bufãr_±r
++ = 
MEDIASRC_MAINTRAY
;

269 *
cur_pş_bufãr_±r
++ = 
MEDIADEST_MAINBIN
;

270 *
cur_pş_bufãr_±r
++ = 
m_pQA
->
´št_qu®™y
;

271 *
cur_pş_bufãr_±r
++ = 
SPECLOAD_NONE
;

273 
	`addIÁ32
((
IÁ32
è(
m_pMA
->
physiÿl_width
 * 
DEVUNITS_XBOW
 / 
m_pQA
->
hÜizÚl_»sŞutiÚ
));

274 
	`addIÁ32
((
IÁ32
è(
m_pMA
->
physiÿl_height
 * 
DEVUNITS_XBOW
 / 
m_pQA
->
v”tiÿl_»sŞutiÚ
));

276 
	`addIÁ32
(
MEDIALD_SPEED
|
NEED_TO_SERVICE_PERIOD
|
MINTIME_BTW_SWEEP
);

279 *
cur_pş_bufãr_±r
++ = 4;

280 *
cur_pş_bufãr_±r
++ = 0;

281 
	`addIÁ16
 (200);

283 *
cur_pş_bufãr_±r
++ = 
FRAME_SYN
;

284 
”r
 = 
	`CËªup
 ();

285  
”r
;

286 
	}
}

288 
DRIVER_ERROR
 
	gLid
::
	$S’dCAPy
(
iOff£t
)

290 
DRIVER_ERROR
 
”r
 = 
NO_ERROR
;

292 ià(
m_iRa¡”CouÁ
 == 0)

294 
m_iBÏnkRa¡”s
 +ğ
iOff£t
;

295  
”r
;

298 
iCouÁ
 = 
m_pPM
->
dyeCouÁ
 * 
m_iB™D•th
;

299 ià(
m_iB™D•th
 =ğ2 && 
m_pPM
->
dyeCouÁ
 != 6)

300 
iCouÁ
++;

302 
RASTERDATA
 
¿¡”d©a
;

303 
	`mem£t
(&
¿¡”d©a
, 0, (rasterdata));

304 
iOff£t
 > 0)

306 
i
 = 0; i < 
iCouÁ
; i++)

308 
”r
 = 
	`EnÿpsuÏ‹
 (&
¿¡”d©a
, 0);

309 
ERRCHECK
;

311 
iOff£t
--;

313  
”r
;

314 
	}
}

316 
DRIVER_ERROR
 
	gLid
::
	$FÜmF“d
()

318 
DRIVER_ERROR
 
”r
 = 
NO_ERROR
;

319 
icouÁ
 = 0;

320 
iCurNumRa¡”s
 = 
m_iRa¡”CouÁ
;

321 ià((
m_pQA
->
´št_qu®™y
 =ğ
DRAFT_QUALITY
 || m_pQA->
v”tiÿl_»sŞutiÚ
 =ğ300è&& 
m_iRa¡”CouÁ
)

322 
icouÁ
 = 1;

323 ià(
m_pQA
->
´št_qu®™y
 !ğ
DRAFT_QUALITY
)

325 
icouÁ
 = 4 * 
m_iB™D•th
;

326 
iCurNumRa¡”s
 = 
m_sSw©hHeight
 * 
m_pPM
->
dyeCouÁ
;

329 
i
, 
j
, 
n
;

330 
n
 = 
m_sSw©hHeight
 / (4 * 
m_iB™D•th
);

332 
n
 =‚ * (
m_cPassNumb”
 + 1è- 
m_iNextRa¡”
;

333 
i
 = 0; i < (è
m_pPM
->
dyeCouÁ
; i++)

335 
j
 = 0; j < 
n
; j++)

336 
	`mem£t
 (
m_Sw©hD©a
[
i
][
m_iNextRa¡”
+
j
], 0, 
m_iImageWidth
 * 
m_iB™D•th
);

338 
m_iNextRa¡”
 +ğ
n
;

339 
n
 = 
m_sSw©hHeight
 / (4 * 
m_iB™D•th
);

341 
icouÁ
)

343 
m_iRa¡”CouÁ
 = 
iCurNumRa¡”s
;

344 
”r
 = 
	`´oûssSw©h
 ();

345 ià(
”r
 !ğ
NO_ERROR
)

347 
icouÁ
--;

348 ià(
m_iNextRa¡”
 >ğ
m_sSw©hHeight
)

349 
m_iNextRa¡”
 = 0;

350 
i
 = 0; i < (è
m_pPM
->
dyeCouÁ
; i++)

352 
j
 = 0; j < 
n
; j++)

353 
	`mem£t
 (
m_Sw©hD©a
[
i
][
m_iNextRa¡”
+
j
], 0, 
m_iImageWidth
 * 
m_iB™D•th
);

355 
m_iNextRa¡”
 +ğ
n
;

358 
UIÁ16
 
mem_Ãeded
 = 
SIZEOF_LDLHDR


359 + 
SIZEOF_LDL_EJPAGE_CMDOPT


360 + 
SIZEOF_LDL_EJPAGE_OPTFLDS


361 + 
SIZEOF_LDLTERM
;

363 
	`flLidH—d”
(
NULL
, 
eLDLEjeùPage
, 
mem_Ãeded
);

365 
	`addIÁ32
 (
MEDIA_EJSPEED
);

367 *
cur_pş_bufãr_±r
++ = 15;

368 *
cur_pş_bufãr_±r
++ = 
FRAME_SYN
;

369 if(
”r
 =ğ
NO_ERROR
)

371 
”r
 = 
	`CËªup
();

374 
m_sRefCouÁ
 = 6;

375 
m_iBÏnkRa¡”s
 = 0;

376 
m_iV”tPo¢
 = (
m_pMA
->
´šbË_¡¬t_y
 * 
DEVUNITS_XBOW
è/ 
m_pQA
->
v”tiÿl_»sŞutiÚ
;

377 
m_iRa¡”CouÁ
 = 0;

378 
m_iNextRa¡”
 = 0;

379 
m_iNextCŞÜ
 = 0;

381 ià(
m_pJA
->
´št_bÜd”Ëss
)

383 
m_iV”tPo¢
 = (è(-
m_pMA
->
v”tiÿl_ov”¥¿y
 * 
DEVUNITS_XBOW
è/ (2 * 
m_pQA
->
v”tiÿl_»sŞutiÚ
);

386 ià(
m_pQA
->
´št_qu®™y
 !ğ
DRAFT_QUALITY
)

387 
m_iRa¡”CouÁ
 = (
m_sSw©hHeight
 - m_sSw©hHeighˆ/ 4è* 
m_pPM
->
dyeCouÁ
;

389 ià(
m_pQA
->
´št_qu®™y
 =ğ
DRAFT_QUALITY
 && m_pQA->
v”tiÿl_»sŞutiÚ
 != 300)

391 
m_iRa¡”CouÁ
 = (
m_sSw©hHeight
 - m_sSw©hHeighˆ/ (4*
m_iB™D•th
)è* 
m_pPM
->
dyeCouÁ
;

392 
m_iV”tPo¢
 -ğ(((
m_sSw©hHeight
 - m_sSw©hHeighˆ/ (4*
m_iB™D•th
)è* 600 / 
m_pQA
->
v”tiÿl_»sŞutiÚ
è* 
DEVUNITS_XBOW
 / 600);

394 
m_cPassNumb”
 = 0;

396 ià(
m_pJA
->
´št_bÜd”Ëss
)

398 ià(
m_iV”tPo¢
 < -850) m_iVertPosn = -850;

402 ià(
m_iV”tPo¢
 < -600) m_iVertPosn = -600;

404 ià(
m_iB™D•th
 == 2)

405 
m_iV”tPo¢
 += 6;

407 
i
 = 0; i < (è
m_pPM
->
dyeCouÁ
; i++)

409 
j
 = 0; j < 
m_sSw©hHeight
; j++)

411 
	`mem£t
 (
m_Sw©hD©a
[
i
][
j
], 0, 
m_iImageWidth
);

415  
”r
;

416 
	}
}

418 
DRIVER_ERROR
 
	gLid
::
	$EnÿpsuÏ‹
(
RASTERDATA
 *
IÅutRa¡”
, 
boŞ
 
bLa¡PÏÃ
)

420 
DRIVER_ERROR
 
”r
 = 
NO_ERROR
;

421 
iPÏÃNum
 = 0;

422 ià(
m_iB™D•th
 == 2)

424 ià(
m_pPM
->
dyeCouÁ
 != 6)

426 ià(
m_cPÏÃNumb”
 == 0)

428 
m_cPÏÃNumb”
++;

429  
NO_ERROR
;

432 
iCPÏÃ
;

433 ià(
m_pPM
->
dyeCouÁ
 == 6)

435 
iPÏÃNum
 = 
m_cPÏÃNumb”
 % 2;

439 
iPÏÃNum
 = (
m_cPÏÃNumb”
 + 1) % 2;

441 
iRowNum
 = (
m_iRa¡”CouÁ
 / 6è* 2 + 
iPÏÃNum
;

442 
iRowNum
 = 
m_iNextRa¡”
;

443 ià(
m_pPM
->
dyeCouÁ
 == 6)

445 
iCPÏÃ
 = 
m_cPÏÃNumb”
 / 2;

449 
iCPÏÃ
 = (
m_cPÏÃNumb”
 - 1) / 2;

451 ià(
iPÏÃNum
 == 0)

453 ià(!
IÅutRa¡”
->
¿¡”d©a
[
COLORTYPE_COLOR
])

455 
m_bP»vRowWasBÏnk
 = 
Œue
;

456 
	`mem£t
 (
m_Sw©hD©a
[
iCPÏÃ
][
iRowNum
], 0, 
m_iImageWidth
 * 2);

460 
m_bP»vRowWasBÏnk
 = 
çl£
;

461 
	`memıy
 (
m_Sw©hD©a
[
iCPÏÃ
][
iRowNum
], 
IÅutRa¡”
->
¿¡”d©a
[
COLORTYPE_COLOR
], IÅutRa¡”->
¿¡”size
[COLORTYPE_COLOR]);

464 ià(
m_pPM
->
dyeCouÁ
 == 6)

466 
m_cPÏÃNumb”
 = (m_cPlaneNumber + 1) % 12;

470 
m_cPÏÃNumb”
 = (m_cPlaneNumber + 1) % 8;

473 ià(
iPÏÃNum
 == 1)

475 ià(
IÅutRa¡”
->
¿¡”d©a
[
COLORTYPE_COLOR
] || !
m_bP»vRowWasBÏnk
)

477 
	`­¶yShšgËMask
(
iCPÏÃ
, 
IÅutRa¡”
->
¿¡”d©a
[
COLORTYPE_COLOR
]);

481 
	`mem£t
 (
m_Sw©hD©a
[
iCPÏÃ
][
m_iNextRa¡”
+1], 0, 
m_iImageWidth
 * 2);

484 ià(
m_pPM
->
dyeCouÁ
 == 6)

486 
m_cPÏÃNumb”
 = m_cPlaneNumber % 12;

490 
m_cPÏÃNumb”
 = m_cPlaneNumber % 7;

496 ià(
IÅutRa¡”
->
¿¡”d©a
[
COLORTYPE_COLOR
] =ğ
NULL
)

497 
	`mem£t
 (
m_Sw©hD©a
[
m_iNextCŞÜ
][
m_iNextRa¡”
], 0, 
m_iImageWidth
);

499 
	`memıy
 (
m_Sw©hD©a
[
m_iNextCŞÜ
][
m_iNextRa¡”
], 
IÅutRa¡”
->
¿¡”d©a
[
COLORTYPE_COLOR
], 
m_iImageWidth
);

501 
m_iRa¡”CouÁ
++;

502 ià(
m_iB™D•th
 =ğ1 || (m_iB™D•th =ğ2 && 
iPÏÃNum
 == 1))

503 
m_iNextCŞÜ
++;

504 ià(
m_iNextCŞÜ
 =ğ(è
m_pPM
->
dyeCouÁ
)

506 
m_iNextCŞÜ
 = 0;

507 ià(
m_iB™D•th
 == 2)

508 
m_iNextRa¡”
 += 2;

510 
m_iNextRa¡”
++;

512 ià(
m_iRa¡”CouÁ
 < (è(
m_sSw©hHeight
 * 
m_pPM
->
dyeCouÁ
))

513  
NO_ERROR
;

515 
”r
 = 
	`´oûssSw©h
 ();

517 ià(
m_iNextRa¡”
 >ğ
m_sSw©hHeight
)

519 
m_iNextRa¡”
 = 0;

521  
”r
;

522 
	}
}

524 
	gLid
::
	$flLidH—d”
(*
pLidHdr
, 
Commªd
, 
UIÁ16
 
CmdL’
, UIÁ16 
D©aL’
)

526 
	`mem£t
(
cur_pş_bufãr_±r
, 0, 
SIZEOF_LDLHDR
);

527 *
cur_pş_bufãr_±r
++ = 
FRAME_SYN
;

528 
	`addIÁ16
(
CmdL’
);

529 
cur_pş_bufãr_±r
 += 2;

530 *
cur_pş_bufãr_±r
++ = (
BYTE
è
Commªd
;

531 
	`addIÁ16
(
m_sRefCouÁ
++);

532 
	`addIÁ16
(
D©aL’
);

533 
	}
}

535 
	gLid
::
	$addIÁ32
(
IÁ32
 
iV®
)

537 
IÁ32By‹s
 
v®
;

538 
v®
.
št_v®ue
 = 
iV®
;

539 ià(
m_bL™eEndŸn
)

541 
i
 = 3; i > -1; i--)

542 *
cur_pş_bufãr_±r
++ = 
v®
.
ch¬_v®
[
i
];

546 
	`memıy
(
cur_pş_bufãr_±r
, 
v®
.
ch¬_v®
, 4);

547 
cur_pş_bufãr_±r
 += 4;

549 
	}
}

551 
	gLid
::
	$addIÁ16
(
IÁ16
 
iV®
)

553 
IÁ16By‹s
 
v®
;

554 
v®
.
št_v®ue
 = 
iV®
;

555 ià(
m_bL™eEndŸn
)

557 *
cur_pş_bufãr_±r
++ = 
v®
.
ch¬_v®
[1];

558 *
cur_pş_bufãr_±r
++ = 
v®
.
ch¬_v®
[0];

562 
	`memıy
(
cur_pş_bufãr_±r
, 
v®
.
ch¬_v®
, 2);

563 
cur_pş_bufãr_±r
 += 2;

565 
	}
}

568 
boŞ
 
	gLid
::
	$£ËùPrštMode
(
šdex
)

570 
PrštMode
 *
p
 = 
lid_´št_modes_bË
[
šdex
].
´št_modes
;

571 
iPMIndex
 = 0;

573 ià(!
	`¡rcmp
(
m_pJA
->
´š‹r_¶©fÜm
, "dj4100") || (!strcmp(m_pJA->printer_platform, "dj2600")))

577 
iPMIndex
 = 
PQ_C¬Œidge_M­_V”Trim
[
m_pJA
->
š‹g”_v®ues
[2]][m_pJA->integer_values[1]];

581 
iPMIndex
 = 
PQ_C¬Œidge_M­
[
m_pJA
->
š‹g”_v®ues
[2]][m_pJA->integer_values[1]];

586 
	`dbglog
("Cu³IÁeg”1 = [%d]\n",
m_pJA
->
š‹g”_v®ues
[1]);

587 
	`dbglog
("Cu³IÁeg”2 = [%d]\n",
m_pJA
->
š‹g”_v®ues
[2]);

588 
	`dbglog
("PrštModIndex = [%d]\n",
iPMIndex
);

590 ifĞ-1 =ğ
iPMIndex
)

592 
	`dbglog
("Unsupported Cartridge‡nd Print Quality combination..\n");

593  
çl£
;

596 
i
 = 0; i < 
lid_´št_modes_bË
[
šdex
].
couÁ
; i++, 
p
++)

598 ià(
i
 =ğ
iPMIndex
)

600 
	`dbglog
("PršˆModğ[%s]\n",
p
->
Çme
);

601 
m_pPM
 = 
p
;

602  
Œue
;

605  
çl£
;

606 
	}
}

624 
boŞ
 
	gLid
::
	$£ËùPrštMode
()

626 ià(
m_pJA
->
´š‹r_¶©fÜm
[0] == 0)

628 
	`dbglog
("printer_platform is undefined\n");

629  
çl£
;

631 
i
 = 0; i < (
lid_´št_modes_bË
) / (lidil_print_modes_table[0]); i++)

633 ià(!
	`¡rcmp
(
m_pJA
->
´š‹r_¶©fÜm
, 
lid_´št_modes_bË
[
i
].
´š‹r_¶©fÜm_Çme
))

635  
	`£ËùPrštMode
(
i
);

638 
	`dbglog
("UnsuµÜ‹d…rš‹r_¶©fÜm: %s\n", 
m_pJA
->
´š‹r_¶©fÜm
);

639  
çl£
;

640 
	}
}

642 
DRIVER_ERROR
 
	gLid
::
	$lßdSw“pD©a
 (
BYTE
 *
imaged©a
, 
imagesize
)

644 
UIÁ16
 
mem_Ãeded
 = 
SIZEOF_LDLHDR
 + 
SIZEOF_LDL_LDSWPDATA_CMDOPT


645 + 
SIZEOF_LDLTERM
;

646 
cur_pş_bufãr_±r
 = 
pş_bufãr
;

647 
	`mem£t
 (
pş_bufãr
, 0, 
mem_Ãeded
);

648 ià(
mem_Ãeded
 < 
LDLPACKET_MINSIZE
)

650 
	`mem£t
(
pş_bufãr
 + 
mem_Ãeded
-1, 0xFF, 
LDLPACKET_MINSIZE
 - mem_needed);

651 
mem_Ãeded
 = 
LDLPACKET_MINSIZE
;

654 
BYTE
 *
com´es£d_d©­Œ
 = 
imaged©a
;

655 
UIÁ16
 
com´es£d_size
 = 
imagesize
;

657 ià(
m_pLidCom´ess
)

659 
m_pLidCom´ess
->
	`In™
 ((
UIÁ16
 *è(
imaged©a
+16), 
imagesize
);

660 
m_pLidCom´ess
->
	`Com´essD©a
 ();

661 
m_pLidCom´ess
->
	`G‘F¿meInfo
 (&
com´es£d_d©­Œ
, &
com´es£d_size
);

664 
	`flLidH—d”
 (
NULL
, 
eLDLLßdSw“pD©a
, 
mem_Ãeded
, 
com´es£d_size
);

665 
	`addIÁ16
 (
imagesize
);

666 
pş_bufãr
[15] = 
FRAME_SYN
;

668 
	`memıy
 (
com´es£d_d©­Œ
, 
pş_bufãr
, 16);

669 
cur_pş_bufãr_±r
 = 
pş_bufãr
;

670  (
	`£ndBufãr
 ((cÚ¡ 
BYTE
 *è
com´es£d_d©­Œ
, 
com´es£d_size
+16));

671 
	}
}

673 
DRIVER_ERROR
 
	gLid
::
	$´štSw“p
 (
UIÁ32
 
Sw“pSize
,

674 
boŞ
 
CŞÜP»£Á
,

675 
boŞ
 
BÏckP»£Á
,

676 
boŞ
 
PhÙoP»£Á
,

677 
IÁ32
 
V”tiÿlPos™iÚ
,

678 
IÁ32
 
LeáEdge
,

679 
IÁ32
 
RightEdge
,

680 
PrštDœeùiÚ
,

681 
IÁ16
 
sFœ¡NozzË
,

682 
IÁ16
 
sLa¡NozzË
)

684 
DRIVER_ERROR
 
”r
;

686 
UIÁ16
 
cŞÜcouÁ
 = 0;

687 
UIÁ32
 
uiAfãùedCŞÜs
 = 0;

688 ià(
CŞÜP»£Á
 =ğ
Œue
è
cŞÜcouÁ
 += 3;

689 ià(
BÏckP»£Á
 =ğ
Œue
è
cŞÜcouÁ
++;

690 ià(
PhÙoP»£Á
 =ğ
Œue
)

692 ià(
CŞÜP»£Á
 =ğ
çl£
)

693 
cŞÜcouÁ
++;

695 
cŞÜcouÁ
+=3;

698 
UIÁ16
 
mem_Ãeded
;

699 ià(
m_lid_v”siÚ
 == 1)

701 
mem_Ãeded
 = 
SIZEOF_LDLHDR


702 + 
SIZEOF_LDL_PRTSWP_CMDOPT


703 + 
SIZEOF_LDL_PRTSWP_OPTFLDS


704 + 
SIZEOF_LDL_PRTSWP_COLROPT
 * 
cŞÜcouÁ


705 + 
SIZEOF_LDLTERM
;

707 ià(
cŞÜcouÁ
 != 0)

708 
mem_Ãeded
 +ğ
SIZEOF_LDL_COLROPT_ACTIVECOLR
;

712 
mem_Ãeded
 = 
SIZEOF_LDLHDR


713 + 
SIZEOF_LDL_PRTSWP_CMDOPT
 + 7

714 + 
SIZEOF_LDL_PRTSWP_OPTFLDS


715 + 
SIZEOF_LDL_PRTSWP_COLROPT
 + 4

716 + 
SIZEOF_LDLTERM
;

719 
	`mem£t
 (
pş_bufãr
, 0, 
mem_Ãeded
);

720 
cur_pş_bufãr_±r
 = 
pş_bufãr
;

722 
	`flLidH—d”
 (
NULL
, 
eLDLPrštSw“p
, 
mem_Ãeded
);

723 ià(
m_lid_v”siÚ
 == 2)

725 *
cur_pş_bufãr_±r
++ = 1;

727 
	`addIÁ32
 (
Sw“pSize
);

728 
	`addIÁ32
 (
V”tiÿlPos™iÚ
);

729 
	`addIÁ32
 (
m_iLeáM¬gš
);

730 ià(
m_lid_v”siÚ
 == 1)

733 *
cur_pş_bufãr_±r
++ = 
SWINGFMT_UNCOMPRSS
;

738 *
cur_pş_bufãr_±r
++ = 1;

740 *
cur_pş_bufãr_±r
++ = 
PrštDœeùiÚ
;

741 ià(
m_lid_v”siÚ
 == 2)

743 
	`addIÁ32
 (0);

745 
	`addIÁ32
 (
IPS_CARRSPEED
|
IPS_INIPRNSPEED
|
ACCURATEPOSN_NEEDED
);

747 ià(
m_pQA
->
´št_qu®™y
 =ğ
BEST_QUALITY
 && m_pQA->
medŸ_ty³
 =ğ
MEDIATYPE_PHOTO
)

748 *
cur_pş_bufãr_±r
++ = 12;

750 *
cur_pş_bufãr_±r
++ = 25;

751 *
cur_pş_bufãr_±r
++ = 4;

752 *
cur_pş_bufãr_±r
++ = 1;

753 ià(
m_lid_v”siÚ
 == 2)

755 *
cur_pş_bufãr_±r
++ = 1;

759 ià(
cŞÜcouÁ
 == 0)

761 *
cur_pş_bufãr_±r
++ = 
NO_ACTIVE_COLORS
;

762 *
cur_pş_bufãr_±r
++ = 
FRAME_SYN
;

764 
”r
 = 
	`CËªup
();

765  
”r
;

770 
UIÁ16
 
cŞ½»£Á
 = 0;

771 
UIÁ16
 
cŞr_found
=0;

772 
UIÁ16
 
cŞÜmask
 = 0x01;

773 
UIÁ16
 
off£t
 = 
eLDLBÏck
;

774 
UIÁ16
 
iD©aRes
;

775 
UIÁ16
 
iPrštRes
;

776 
uiAfãùedCŞÜs
 = 
off£t
;

777 ià(
BÏckP»£Á
 =ğ
Œue
)

779 
uiAfãùedCŞÜs
 = 0x1;

781 if(
BÏckP»£Á
 =ğ
çl£
 && 
PhÙoP»£Á
 == false)

783 
off£t
 = 
eLDLCyª
;

784 
cŞÜmask
=0x02;

785 
uiAfãùedCŞÜs
 |= 0x0000000e;

787 ià(
BÏckP»£Á
 =ğ
çl£
 && 
PhÙoP»£Á
 =ğ
Œue
)

789 ià(
CŞÜP»£Á
 =ğ
Œue
)

791 
off£t
 = 
eLDLCyª
;

792 
cŞÜmask
=0x02;

793 
uiAfãùedCŞÜs
 |= 0x0000007e;

797 
off£t
 = 
eLDLLoBÏck
;

798 
cŞÜmask
=0x40;

799 
uiAfãùedCŞÜs
 |= 0x00000070;

803 
aùv_cŞr_šdex
 = 
cur_pş_bufãr_±r
 - 
pş_bufãr
;

804 
iCŞÜRes
 = 300;

805 ià(
m_lid_v”siÚ
 == 1)

807 
cur_pş_bufãr_±r
 += 2;

811 
iCŞÜRes
 = 600;

813 
UIÁ16
 
i
 = 
off£t
; 
cŞr_found
 < 
cŞÜcouÁ
 && i < 
eLDLMaxCŞÜ
; i++)

815 
cŞr_found
++;

816 
cŞ½»£Á
 = cŞ½»£Á | 
cŞÜmask
;

818 ià(
m_lid_v”siÚ
 == 2)

820 
	`addIÁ32
 (
uiAfãùedCŞÜs
);

822 
	`addIÁ32
 (
LeáEdge
);

823 
	`addIÁ32
 (
RightEdge
);

824 
	`addIÁ32
 (
LeáEdge
);

825 
	`addIÁ32
 (
RightEdge
);

827 ià((
i
 =ğ0 && 
m_lid_v”siÚ
 =ğ1è|| (
BÏckP»£Á
 && m_lidil_version == 2))

829 
iD©aRes
 = 600;

830 
iPrštRes
 = 
m_iBÏckP’ResŞutiÚ
;

834 
iD©aRes
 = 
iCŞÜRes
;

835 
iPrštRes
 = 
iCŞÜRes
;

837 
	`addIÁ16
 (
iD©aRes
);

838 
	`addIÁ16
 (
iPrštRes
);

840 ià(
m_lid_v”siÚ
 == 2)

842 
	`addIÁ16
 (
m_pQA
->
hÜizÚl_»sŞutiÚ
 * 
m_iB™D•th
);

846 
	`addIÁ16
 (
m_pQA
->
hÜizÚl_»sŞutiÚ
);

849 ià(
m_pQA
->
hÜizÚl_»sŞutiÚ
 == 300)

851 
	`addIÁ16
 (600);

855 ià(
m_lid_v”siÚ
 == 2)

857 
	`addIÁ16
 (
m_pQA
->
hÜizÚl_»sŞutiÚ
 * 
m_iB™D•th
);

861 
	`addIÁ16
 (
m_pQA
->
hÜizÚl_»sŞutiÚ
);

864 
	`addIÁ16
 (
sFœ¡NozzË
);

865 ià(
sLa¡NozzË
 == 0)

867 
iTmp
 = 
m_iRa¡”CouÁ
 / 
m_pPM
->
dyeCouÁ
;;

868 ià(
m_lid_v”siÚ
 == 2)

870 
	`addIÁ16
 (
sFœ¡NozzË
 - 1 + ((
iTmp
 * 
iPrštRes
è/ (
m_pQA
->
v”tiÿl_»sŞutiÚ
 * 
m_iB™D•th
)));

874 
	`addIÁ16
 (
sFœ¡NozzË
 - 1 + ((
iTmp
 * 
iPrštRes
è/ (
m_pQA
->
v”tiÿl_»sŞutiÚ
)));

879 
	`addIÁ16
 (
sLa¡NozzË
);

882 *
cur_pş_bufãr_±r
++ = 0;

883 
cŞÜmask
 = colormask << 1;

884 ià(
m_lid_v”siÚ
 == 2)

890 ià(
m_lid_v”siÚ
 == 1)

892 
BYTE
 *
tmp
 = 
cur_pş_bufãr_±r
;

893 
cur_pş_bufãr_±r
 = 
pş_bufãr
 + 
aùv_cŞr_šdex
;

894 
	`addIÁ16
 (
cŞ½»£Á
);

895 
cur_pş_bufãr_±r
 = 
tmp
;

898 ià(
m_lid_v”siÚ
 == 2)

900 *
cur_pş_bufãr_±r
++ = 0;

902 *
cur_pş_bufãr_±r
++ = 
FRAME_SYN
;

905 
”r
 = 
	`CËªup
();

906  
”r
;

907 
	}
}

909 
DRIVER_ERROR
 
	gLid
::
	$®loÿ‹Sw©hBufãrs
()

911 
size
 = 
m_pMA
->
´šbË_width
;

912 
size
 = (size + 7) / 8;

913 
m_iImageWidth
 = 
size
;

914 
m_ldlCom´essD©a
 = 
NULL
;

915 ià(
m_lid_v”siÚ
 == 1)

920 ià(
m_iB™D•th
 == 2)

922 
size
 *= 2;

925 
iCom´essBufSize
 = (
m_iBy‹sP”Swšg
 / 2è* 
LDL_MAX_IMAGE_SIZE
+20;

926 
m_szCom´essBuf
 = 
Ãw
 
BYTE
[
iCom´essBufSize
];

927 ià(
m_szCom´essBuf
 =ğ
NULL
)

928  
ALLOCMEM_ERROR
;

929 
	`mem£t
 (
m_szCom´essBuf
, 0, 
iCom´essBufSize
);

931 
BYTE
 *
p
 = 
NULL
;

932 
iSw©hBuffSize
;

934 
m_sSw©hHeight
 = 
SWATH_HEIGHT
;

941 
iAdjHeight
 = (
m_iNumBÏckNozzËs
 / 32) * 8;

942 ià(
m_pPM
->
dyeCouÁ
 == 1)

944 
m_sSw©hHeight
 = m_sSwathHeight * 4;

945 ià((è(
m_sSw©hHeight
 * 1200 / 
m_pQA
->
v”tiÿl_»sŞutiÚ
è> 
m_iNumBÏckNozzËs
)

946 
m_sSw©hHeight
 = 
m_pQA
->
v”tiÿl_»sŞutiÚ
 / 3;

948 ià(
m_pQA
->
´št_qu®™y
 !ğ
DRAFT_QUALITY
 && m_pQA->
v”tiÿl_»sŞutiÚ
 > 300 && 
m_pPM
->
dyeCouÁ
 > 1 && 
m_iB™D•th
 == 1)

950 
m_sSw©hHeight
 = (m_sSwathHeight / 4) * 4 * 2;

951 ià(
m_sSw©hHeight
 > 200)

952 
m_sSw©hHeight
 = 200;

954 ià(
m_iB™D•th
 == 2)

955 
m_sSw©hHeight
 = 
iAdjHeight
 * 4;

957 ià(
m_pQA
->
´št_qu®™y
 =ğ
NORMAL_QUALITY
)

958 
m_sSw©hHeight
 = 
iAdjHeight
 * 2;

960 ià(
m_pQA
->
´št_qu®™y
 =ğ
DRAFT_QUALITY
 && 
m_pPM
->
dyeCouÁ
 != 1)

962 
m_sSw©hHeight
 *ğ
m_iBy‹sP”Swšg
 / 2;

965 
iSw©hBuffSize
 = 
m_pPM
->
dyeCouÁ
 *  (
BYTE
 *) +

966 
m_pPM
->
dyeCouÁ
 * 
m_sSw©hHeight
 *  (
BYTE
 *) +

967 
size
 * 
m_pPM
->
dyeCouÁ
 * 
m_sSw©hHeight
;

968 ià((
p
 = 
Ãw
 
BYTE
[
iSw©hBuffSize
]è=ğ
NULL
)

970  
ALLOCMEM_ERROR
;

973 
i
;

974 
m_Sw©hD©a
 = (
BYTE
 ***è
p
;

975 
i
 = 0; i < (è
m_pPM
->
dyeCouÁ
; i++)

976 
m_Sw©hD©a
[
i
] = (
BYTE
 **è(
p
 +  (BYTE *è* 
m_pPM
->
dyeCouÁ
 + i * 
m_sSw©hHeight
 *  (BYTE *));

978 
i
 = 0; i < (è
m_pPM
->
dyeCouÁ
; i++)

980 
p
 = (
BYTE
 *è
m_Sw©hD©a
 +  (BYTE *è* 
m_pPM
->
dyeCouÁ
 +

981 
m_pPM
->
dyeCouÁ
 * 
m_sSw©hHeight
 *  (
BYTE
 *) +

982 
size
 * 
m_sSw©hHeight
 * 
i
;

983 
j
 = 0; j < 
m_sSw©hHeight
; j++)

985 
	`mem£t
 (
p
, 0, 
size
);

986 
m_Sw©hD©a
[
i
][
j
] = 
p
;

987 
p
 =… + 
size
;

991 ià(
m_pQA
->
´št_qu®™y
 !ğ
DRAFT_QUALITY
 && m_pQA->
v”tiÿl_»sŞutiÚ
 != 300)

993 
m_iRa¡”CouÁ
 = (
m_sSw©hHeight
 - m_sSw©hHeighˆ/ (4*
m_iB™D•th
)è* 
m_pPM
->
dyeCouÁ
;

994 
m_iV”tPo¢
 -ğ(((
m_sSw©hHeight
 - m_sSw©hHeighˆ/ (4*
m_iB™D•th
)è* 600 / 
m_pQA
->
v”tiÿl_»sŞutiÚ
è* 
DEVUNITS_XBOW
 / 600);

996 
m_cPassNumb”
 = 0;

998 ià(
m_pJA
->
´št_bÜd”Ëss
)

1000 ià(
m_iV”tPo¢
 < -850) m_iVertPosn = -850;

1004 ià(
m_iV”tPo¢
 < -600) m_iVertPosn = -600;

1006 ià(
m_iB™D•th
 == 2)

1007 
m_iV”tPo¢
 += 6;

1008  
NO_ERROR
;

1009 
	}
}

1011 
	gLid
::
	$g‘Sw©hWidth
 (
iS¹
, 
iLa¡
, 
iWidth
)

1013 
k
;

1014 
i
, 
j
;

1015 
i
 = 
iWidth
 - 1; i > -1; i--)

1017 
j
 = 
iS¹
; j < 
iLa¡
; j++)

1019 
k
 = 
m_iRa¡”CouÁ
 / 
m_pPM
->
dyeCouÁ
-1; k >= 0; k--)

1022 ià(
m_Sw©hD©a
[
j
][
k
][
i
])

1024  (
i
+1);

1031 
	}
}

1033 
DRIVER_ERROR
 
	gLid
::
	$´oûssSw©h
()

1035 
DRIVER_ERROR
 
”r
 = 
NO_ERROR
;

1036 
IÁ16
 
sCurSw©hHeight
 = 
m_iRa¡”CouÁ
 / 
m_pPM
->
dyeCouÁ
;

1037 
m_iV”tPo¢
 +ğ((
m_iBÏnkRa¡”s
è* 600 / 
m_pQA
->
v”tiÿl_»sŞutiÚ
è* 
DEVUNITS_XBOW
 / 600;

1038 
m_iBÏnkRa¡”s
 = 0;

1040 
boŞ
 
bCŞÜP»£Á
 = 
Œue
;

1041 
boŞ
 
bBÏckP»£Á
 = 
Œue
;

1042 
boŞ
 
bPhÙoP»£Á
 = 
Œue
;

1043 
sCŞÜSize
 = 0;

1044 
LeáEdge
 = 0;

1045 
BYTE
 
c§vMask
;

1047 ià(
m_pPM
->
dyeCouÁ
 == 1)

1049 
bCŞÜP»£Á
 = 
çl£
;

1050 
bPhÙoP»£Á
 = 
çl£
;

1052 ià(
m_pPM
->
dyeCouÁ
 == 3)

1054 
bBÏckP»£Á
 = 
çl£
;

1055 
bPhÙoP»£Á
 = 
çl£
;

1057 ià(
m_pPM
->
dyeCouÁ
 == 6)

1059 
bBÏckP»£Á
 = 
çl£
;

1061 ià(
m_pPM
->
dyeCouÁ
 == 4)

1063 
bPhÙoP»£Á
 = 
çl£
;

1066 ià(!
m_bBidœeùiÚ®PrštšgOn
)

1067 
m_cPrštDœeùiÚ
 = 
PRNDRN_LEFTTORIGHT
;

1069 
iS¹Ra¡”
 = 
m_cPassNumb”
 % (2 * 
m_iB™D•th
);

1070 
BYTE
 
mask
 = 0xFF;

1072 ià(
m_lid_v”siÚ
 == 2)

1074 
iS¹Ra¡”
 = 0;

1077 ià(
m_pQA
->
´št_qu®™y
 !ğ
DRAFT_QUALITY
 && m_pQA->
v”tiÿl_»sŞutiÚ
 != 300)

1079 ià((
m_cPassNumb”
 % (4 * 
m_iB™D•th
)) < (2 * m_iBitDepth))

1080 
mask
 = 0xAA;

1082 
mask
 = 0x55;

1084 
c§vMask
 = 
mask
;

1090 ià(
m_sRefCouÁ
 > 64000)

1091 
m_sRefCouÁ
 = 6;

1097 
”r
 = 
	`´oûssPhÙoSw©h
(
bPhÙoP»£Á
, 
bCŞÜP»£Á
, 
mask
);

1098 ià(
”r
 !ğ
NO_ERROR
)

1099  
”r
;

1105 
”r
 = 
	`´oûssCŞÜSw©h
(
bPhÙoP»£Á
, 
bCŞÜP»£Á
, 
bBÏckP»£Á
, &
sCŞÜSize
, 
mask
);

1106 ià(
”r
 !ğ
NO_ERROR
)

1107  
”r
;

1112 
”r
 = 
	`´oûssBÏckSw©h
(
bBÏckP»£Á
, 
bCŞÜP»£Á
, 
sCŞÜSize
, 
LeáEdge
, 
c§vMask
);

1114 
m_iRa¡”CouÁ
 = 0;

1116 ià(
m_pQA
->
´št_qu®™y
 !ğ
DRAFT_QUALITY
 && m_pQA->
v”tiÿl_»sŞutiÚ
 != 300)

1118 
m_cPassNumb”
 = (m_cPassNumb” + 1è% (4 * 
m_iB™D•th
);

1119 
m_iV”tPo¢
 +ğ((((
sCurSw©hHeight
/(4 * 
m_iB™D•th
))è* 600 / 
m_pQA
->
v”tiÿl_»sŞutiÚ
è* 
DEVUNITS_XBOW
 / 600) / m_iBitDepth;

1120 ià(
m_iB™D•th
 == 1)

1122 ià(
m_cPassNumb”
 % 2)

1123 
m_iV”tPo¢
 += 4;

1125 
m_iV”tPo¢
 -= 4;

1129 
m_iV”tPo¢
 -= 2;

1130 ià((
m_cPassNumb”
 % 4) == 0)

1131 
m_iV”tPo¢
 +ğ(
DEVUNITS_XBOW
 / 
m_iCŞÜP’ResŞutiÚ
);

1133 
m_iRa¡”CouÁ
 = (
sCurSw©hHeight
 - sCurSw©hHeighˆ/ (4 * 
m_iB™D•th
)è* 
m_pPM
->
dyeCouÁ
;

1137 
m_iV”tPo¢
 +ğ((
sCurSw©hHeight
 * 4 * 600è/ 
m_pQA
->
v”tiÿl_»sŞutiÚ
);

1141  
”r
;

1142 
	}
}

1144 
DRIVER_ERROR
 
	gLid
::
	$´oûssPhÙoSw©h
(
boŞ
 
bPhÙoP»£Á
,

1145 
boŞ
 
bCŞÜP»£Á
,

1146 
BYTE
 
mask
)

1148 ià(!
bPhÙoP»£Á
)

1150  
NO_ERROR
;

1153 
BYTE
 
c§vMask
 = 
mask
;

1154 
iOff£t
 = 0;

1155 
i
;

1156 
j
;

1157 
n
;

1158 
couÁ
;

1159 
size
;

1160 
¡¬t
;

1161 
DRIVER_ERROR
 
”r
 = 
NO_ERROR
;

1162 
sCurSw©hHeight
 = 
m_iRa¡”CouÁ
 / 
m_pPM
->
dyeCouÁ
;

1163 
uiSw©hSize
;

1164 
LeáEdge
 = 0;

1165 
RightEdge
;

1166 
iS¹Ra¡”
 = 0;

1167 
d–
;

1168 
iCŞÜs
 = 1;

1169 
La¡CŞÜ
 = 1;

1170 
S¹CŞÜ
 = 0;

1171 
width
 = 
m_iImageWidth
;

1172 ià(
bCŞÜP»£Á
)

1174 
iCŞÜs
 = 6;

1175 
La¡CŞÜ
 = 6;

1176 
S¹CŞÜ
 = 0;

1177 ià(
m_lid_v”siÚ
 != 1)

1179 
width
 *ğ
m_iB™D•th
;

1182 
size
 = 
	`g‘Sw©hWidth
 (
S¹CŞÜ
, 
La¡CŞÜ
, 
width
);

1183 ià(
size
 == 0)

1184  
NO_ERROR
;

1186 ià(
size
 % 
m_iBy‹sP”Swšg
)

1187 
size
 = ((size/
m_iBy‹sP”Swšg
) + 1) * m_iBytesPerSwing;

1188 ià(
m_lid_v”siÚ
 == 1)

1190 
RightEdge
 = 
LeáEdge
 + (
size
 * 8 * 600 / 
m_pQA
->
hÜizÚl_»sŞutiÚ
 - 1 * (600 / m_pQA->
v”tiÿl_»sŞutiÚ
)) *

1191 (
DEVUNITS_XBOW
 / 600);

1195 
RightEdge
 = 
LeáEdge
 + (
size
 * 8 * 600 / 
m_pQA
->
hÜizÚl_»sŞutiÚ
 - 1 * (600 / m_pQA->
v”tiÿl_»sŞutiÚ
)) *

1196 (
DEVUNITS_XBOW
 / (600 * 
m_iB™D•th
));

1198 
IÁ16
 
sLa¡NozzË
;

1199 
IÁ16
 
sFœ¡NozzË
 = 1;

1200 
uSw“pSize
;

1201 
jD–
 = 
m_pQA
->
v”tiÿl_»sŞutiÚ
 / 
m_iCŞÜP’ResŞutiÚ
;

1202 
jD–
 *ğ
m_iB™D•th
;

1204 
uiSw©hSize
 = 
size
 * 
iCŞÜs
 * 
sCurSw©hHeight
 / 
jD–
;

1206 
uSw“pSize
 = 
sCurSw©hHeight
 * 
m_iBy‹sP”Swšg
 / 
jD–
;

1207 
n
 = 
LDL_MAX_IMAGE_SIZE
 / (
uSw“pSize
);

1208 
couÁ
 = 0;

1210 ià(
m_iB™D•th
 == 2)

1211 
iS¹Ra¡”
 = (4 - (iStartRaster+1)) % 4;

1213 ià(
m_lid_v”siÚ
 == 2)

1215 
iS¹Ra¡”
 = 0;

1218 
sLa¡NozzË
 = 
sFœ¡NozzË
 - 1 + 
sCurSw©hHeight
 / 
jD–
;

1220 
BYTE
 *
cb
 = 
m_szCom´essBuf
 + 16;

1221 
	`mem£t
 (
m_szCom´essBuf
, 0x0, 
LDL_MAX_IMAGE_SIZE
 * (
m_iBy‹sP”Swšg
 / 2));

1224 
ib
 = 0;

1226 ià(
m_pQA
->
v”tiÿl_»sŞutiÚ
 > 300 && m_pQA->
´št_qu®™y
 !ğ
DRAFT_QUALITY
)

1228 
iOff£t
 = (
sCurSw©hHeight
 / (4 * 
m_iB™D•th
));

1229 
iOff£t
 = iOff£ˆ+ iOff£ˆ* ((
m_cPassNumb”
è% (4 * 
m_iB™D•th
));

1232 
BYTE
 
cV”tAlign
 = 0;

1234 ià(
bCŞÜP»£Á
)

1236 
cV”tAlign
 = 
m_cPtoCV”tAlign
;

1239 
ib
 = 0; ib < (è
m_iB™D•th
; ib++)

1241 ià(
m_cPrštDœeùiÚ
 =ğ
PRNDRN_RIGHTTOLEFT
)

1243 
¡¬t
 = 
size
 - 
m_iBy‹sP”Swšg
;

1244 
d–
 = -
m_iBy‹sP”Swšg
;

1248 
¡¬t
 = 0;

1249 
d–
 = 
m_iBy‹sP”Swšg
;

1252 
”r
 = 
	`´štSw“p
 (
uiSw©hSize
, 
bCŞÜP»£Á
, 
çl£
, 
bPhÙoP»£Á
,

1253 
m_iV”tPo¢
+
cV”tAlign
, 
LeáEdge
, 
RightEdge
, 
m_cPrštDœeùiÚ
,

1254 
sFœ¡NozzË
, 
sLa¡NozzË
);

1255 
ERRCHECK
;

1257 
i
 = 
¡¬t
 + 
ib
 * 
m_iImageWidth
;

1258 
l
 = 0;† < 
size
;† +ğ
m_iBy‹sP”Swšg
)

1260 
k
 = 
S¹CŞÜ
+1; k < 
La¡CŞÜ
; k++)

1262 
mask
 = 
c§vMask
;

1263 
j
 = 
iOff£t
 + 
iS¹Ra¡”
; j < 
sCurSw©hHeight
; j +ğ
jD–
)

1265 
is
 = 0; i < 
m_iBy‹sP”Swšg
; is++)

1267 *
cb
++ = 
m_Sw©hD©a
[
k
][
j
][
i
+
is
] & 
mask
;

1269 
mask
 = ~mask;

1271 
j
 = 
iS¹Ra¡”
; j < 
iOff£t
; j +ğ
jD–
)

1273 
is
 = 0; i < 
m_iBy‹sP”Swšg
; is++)

1275 *
cb
++ = 
m_Sw©hD©a
[
k
][
j
][
i
+
is
] & 
mask
;

1277 
mask
 = ~mask;

1280 
couÁ
++;

1281 ià(
couÁ
 =ğ
n
)

1283 
”r
 = 
	`lßdSw“pD©a
 (
m_szCom´essBuf
, (è(
cb
 - m_szCompressBuf-16));

1284 
	`mem£t
 (
m_szCom´essBuf
, 0, 
LDL_MAX_IMAGE_SIZE
 * (
m_iBy‹sP”Swšg
 / 2));

1285 
cb
 = 
m_szCom´essBuf
+16;

1286 
couÁ
 = 0;

1287 
ERRCHECK
;

1290 
mask
 = 
c§vMask
;

1291 
j
 = 
iOff£t
 + 
iS¹Ra¡”
; j < 
sCurSw©hHeight
; j +ğ
jD–
)

1293 
is
 = 0; i < 
m_iBy‹sP”Swšg
; is++)

1295 *
cb
++ = 
m_Sw©hD©a
[0][
j
][
i
 + 
is
] & 
mask
;

1297 
mask
 = ~mask;

1299 
j
 = 
iS¹Ra¡”
; j < 
iOff£t
; j +ğ
jD–
)

1301 
is
 = 0; i < 
m_iBy‹sP”Swšg
; is++)

1303 *
cb
++ = 
m_Sw©hD©a
[0][
j
][
i
 + 
is
] & 
mask
;

1305 
mask
 = ~mask;

1308 
couÁ
++;

1309 ià(
couÁ
 =ğ
n
)

1311 
”r
 = 
	`lßdSw“pD©a
 (
m_szCom´essBuf
, (è(
cb
 - m_szCompressBuf-16));

1312 
	`mem£t
 (
m_szCom´essBuf
, 0, 
LDL_MAX_IMAGE_SIZE
 * (
m_iBy‹sP”Swšg
 / 2));

1313 
cb
 = 
m_szCom´essBuf
+16;

1314 
couÁ
 = 0;

1315 
ERRCHECK
;

1317 
i
 = i + 
d–
;

1319 ià(
couÁ
 != 0)

1321 
”r
 = 
	`lßdSw“pD©a
 (
m_szCom´essBuf
, (è(
cb
 - m_szCompressBuf-16));

1322 
	`mem£t
 (
m_szCom´essBuf
, 0, 
LDL_MAX_IMAGE_SIZE
 * (
m_iBy‹sP”Swšg
 / 2));

1323 
cb
 = 
m_szCom´essBuf
+16;

1324 
couÁ
 = 0;

1325 
ERRCHECK
;

1328 ià(
m_bBidœeùiÚ®PrštšgOn
)

1329 
m_cPrštDœeùiÚ
 = (m_cPrintDirection + 1) % 2;

1331 ià(
m_lid_v”siÚ
 == 2)

1335 
LeáEdge
 += 2;

1336 
RightEdge
 += 2;

1339  
”r
;

1340 
	}
}

1342 
DRIVER_ERROR
 
	gLid
::
	$´oûssCŞÜSw©h
(
boŞ
 
bPhÙoP»£Á
,

1343 
boŞ
 
bCŞÜP»£Á
,

1344 
boŞ
 
bBÏckP»£Á
,

1345 *
sCŞÜSize
,

1346 
BYTE
 
mask
)

1348 
BYTE
 
c§vMask
 = 
mask
;

1349 
iS¹Ra¡”
 = 0;

1350 
LeáEdge
 = 0;

1351 
RightEdge
;

1352 
¡¬t
;

1353 
size
;

1354 
d–
;

1355 
i
;

1356 
j
;

1357 
n
;

1358 
couÁ
;

1359 
iOff£t
 = 0;

1360 
DRIVER_ERROR
 
”r
 = 
NO_ERROR
;

1361 
sCurSw©hHeight
 = 
m_iRa¡”CouÁ
 / 
m_pPM
->
dyeCouÁ
;

1362 
uiSw©hSize
;

1363 ià(
bPhÙoP»£Á
 || !
bCŞÜP»£Á
)

1365  
NO_ERROR
;

1368 
iCŞÜs
 = 3;

1369 
La¡CŞÜ
 = 4;

1370 
S¹CŞÜ
 = 1;

1371 ià(!
bBÏckP»£Á
)

1373 
S¹CŞÜ
 = 0;

1374 
La¡CŞÜ
 = 3;

1376 ià(
m_lid_v”siÚ
 == 1)

1379 
size
 = 
	`g‘Sw©hWidth
 (
S¹CŞÜ
, 
La¡CŞÜ
, 
m_iImageWidth
 );

1383 
size
 = 
	`g‘Sw©hWidth
 (
S¹CŞÜ
, 
La¡CŞÜ
, 
m_iImageWidth
 * 
m_iB™D•th
);

1385 *
sCŞÜSize
 = 
size
;

1386 ià(
size
 == 0)

1388  
NO_ERROR
;

1391 ià(
size
 % 
m_iBy‹sP”Swšg
)

1392 
size
 = ((siz/ 
m_iBy‹sP”Swšg
) + 1) * m_iBytesPerSwing;

1394 ià(
m_lid_v”siÚ
 == 1)

1396 
RightEdge
 = 
LeáEdge
 + (
size
 * 8 * 600 / 
m_pQA
->
hÜizÚl_»sŞutiÚ
 - 1 * (600 / m_pQA->
v”tiÿl_»sŞutiÚ
)) *

1397 (
DEVUNITS_XBOW
 / 600);

1401 
RightEdge
 = 
LeáEdge
 + (
size
 * 8 * 600 / 
m_pQA
->
hÜizÚl_»sŞutiÚ
 - 1 * (600 / m_pQA->
v”tiÿl_»sŞutiÚ
)) *

1402 (
DEVUNITS_XBOW
 / (600 * 
m_iB™D•th
));

1404 
IÁ16
 
sLa¡NozzË
;

1405 
IÁ16
 
sFœ¡NozzË
 = 1;

1406 
uSw“pSize
;

1407 
jD–
 = 
m_pQA
->
v”tiÿl_»sŞutiÚ
 / 
m_iCŞÜP’ResŞutiÚ
;

1408 
jD–
 *ğ
m_iB™D•th
;

1410 
uiSw©hSize
 = 
size
 * 
iCŞÜs
 * 
sCurSw©hHeight
 / 
jD–
;

1412 
uSw“pSize
 = 
sCurSw©hHeight
 * 
m_iBy‹sP”Swšg
 / 
jD–
;

1413 
n
 = 
LDL_MAX_IMAGE_SIZE
 / (
uSw“pSize
);

1414 
couÁ
 = 0;

1416 ià(
m_iB™D•th
 == 2)

1418 
iS¹Ra¡”
 = (4 - (iStartRaster+1)) % 4;

1419 ià(
m_lid_v”siÚ
 == 2)

1421 
iS¹Ra¡”
 = 
m_cPassNumb”
 % (
m_iB™D•th
);

1425 
sLa¡NozzË
 = 
sFœ¡NozzË
 - 1 + 
sCurSw©hHeight
 / 
jD–
;

1427 
BYTE
 *
cb
 = 
m_szCom´essBuf
 + 16;

1428 
	`mem£t
 (
m_szCom´essBuf
, 0x0, 
LDL_MAX_IMAGE_SIZE
 * (
m_iBy‹sP”Swšg
 / 2));

1431 
ib
 = 0;

1433 ià(
m_pQA
->
v”tiÿl_»sŞutiÚ
 > 300 && m_pQA->
´št_qu®™y
 !ğ
DRAFT_QUALITY
)

1435 
iOff£t
 = (
sCurSw©hHeight
 / (4 * 
m_iB™D•th
));

1436 
iOff£t
 = iOff£ˆ+ iOff£ˆ* ((
m_cPassNumb”
è% (4 * 
m_iB™D•th
));

1439 
ib
 = 0; ib < (è
m_iB™D•th
; ib++)

1441 ià(
m_cPrštDœeùiÚ
 =ğ
PRNDRN_RIGHTTOLEFT
)

1443 
¡¬t
 = 
size
 - 
m_iBy‹sP”Swšg
;

1444 
d–
 = -
m_iBy‹sP”Swšg
;

1448 
¡¬t
 = 0;

1449 
d–
 = 
m_iBy‹sP”Swšg
;

1451 
”r
 = 
	`´štSw“p
 (
uiSw©hSize
, 
bCŞÜP»£Á
, 
çl£
, false,

1452 
m_iV”tPo¢
, 
LeáEdge
, 
RightEdge
, 
m_cPrštDœeùiÚ
,

1453 
sFœ¡NozzË
, 
sLa¡NozzË
);

1454 
ERRCHECK
;

1456 
i
 = 
¡¬t
 + 
ib
 * 
m_iImageWidth
;

1457 
l
 = 0;† < 
size
;† +ğ
m_iBy‹sP”Swšg
)

1459 
k
 = 
S¹CŞÜ
; k < 
La¡CŞÜ
; k++)

1461 
mask
 = 
c§vMask
;

1462 
j
 = 
iOff£t
 + 
iS¹Ra¡”
; j < 
sCurSw©hHeight
; j +ğ
jD–
)

1464 
is
 = 0; i < 
m_iBy‹sP”Swšg
; is++)

1466 *
cb
++ = 
m_Sw©hD©a
[
k
][
j
][
i
 + 
is
] & 
mask
;

1468 
mask
 = ~mask;

1470 
j
 = 
iS¹Ra¡”
; j < 
iOff£t
; j +ğ
jD–
)

1472 
is
 = 0; i < 
m_iBy‹sP”Swšg
; is++)

1474 *
cb
++ = 
m_Sw©hD©a
[
k
][
j
][
i
 + 
is
] & 
mask
;

1476 
mask
 = ~mask;

1479 
couÁ
++;

1480 ià(
couÁ
 =ğ
n
)

1482 
”r
 = 
	`lßdSw“pD©a
 (
m_szCom´essBuf
, (è(
cb
 - m_szCompressBuf-16));

1483 
	`mem£t
 (
m_szCom´essBuf
, 0, 
LDL_MAX_IMAGE_SIZE
 * (
m_iBy‹sP”Swšg
 / 2));

1485 
cb
 = 
m_szCom´essBuf
+16;

1486 
couÁ
 = 0;

1487 
ERRCHECK
;

1491 
i
 = i + 
d–
;

1494 ià(
couÁ
 != 0)

1496 
”r
 = 
	`lßdSw“pD©a
 (
m_szCom´essBuf
, (è(
cb
 - m_szCompressBuf-16));

1497 
	`mem£t
 (
m_szCom´essBuf
, 0, 
LDL_MAX_IMAGE_SIZE
 * (
m_iBy‹sP”Swšg
 / 2));

1499 
cb
 = 
m_szCom´essBuf
+16;

1500 
couÁ
 = 0;

1501 
ERRCHECK
;

1504 
LeáEdge
 += 2;

1505 
RightEdge
 += 2;

1507 ià(
m_bBidœeùiÚ®PrštšgOn
)

1508 
m_cPrštDœeùiÚ
 = (m_cPrintDirection + 1) % 2;

1509 ià(
m_lid_v”siÚ
 == 2)

1515  
”r
;

1516 
	}
}

1518 
DRIVER_ERROR
 
	gLid
::
	$´oûssBÏckSw©h
(
boŞ
 
bBÏckP»£Á
,

1519 
boŞ
 
bCŞÜP»£Á
,

1520 
sCŞÜSize
,

1521 
LeáEdge
,

1522 
BYTE
 
mask
)

1524 
IÁ32
 
RightEdge
;

1525 
¡¬t
;

1526 
d–
;

1527 
i
;

1528 
j
;

1529 
n
;

1530 
couÁ
;

1531 
iOff£t
 = 0;

1532 
DRIVER_ERROR
 
”r
 = 
NO_ERROR
;

1533 
sCurSw©hHeight
 = 
m_iRa¡”CouÁ
 / 
m_pPM
->
dyeCouÁ
;

1534 
uiSw©hSize
;

1536 ià(!
bBÏckP»£Á
)

1538  
NO_ERROR
;

1540 
size
 = 
	`g‘Sw©hWidth
 (0, 1, 
m_iImageWidth
);

1541 ià(
size
 == 0)

1542  
NO_ERROR
;

1544 ià(
size
 % 
m_iBy‹sP”Swšg
)

1545 
size
 = ((size/
m_iBy‹sP”Swšg
) + 1) * m_iBytesPerSwing;

1547 
RightEdge
 = 
LeáEdge
 + (
size
 * 8 * 600 / 
m_pQA
->
hÜizÚl_»sŞutiÚ
 - 1 * (600 / m_pQA->
v”tiÿl_»sŞutiÚ
)è* 
DEVUNITS_XBOW
/600;

1548 ià(
m_iB™D•th
 !ğ2 && ((
m_cPassNumb”
 % 2è=ğ0 || 
m_pQA
->
´št_qu®™y
 =ğ
DRAFT_QUALITY
))

1550 
IÁ16
 
sLa¡NozzË
 = 0;

1551 
IÁ16
 
sFœ¡NozzË
 = 1;

1553 
xD–
 = 0;

1554 
BYTE
 
cV”tAlign
 = 0;

1556 ià(
bCŞÜP»£Á
)

1558 
cV”tAlign
 = 
m_cKtoCV”tAlign
;

1561 ià(
bCŞÜP»£Á
 && 
sCŞÜSize
 && 
m_bBidœeùiÚ®PrštšgOn
)

1562 
m_cPrštDœeùiÚ
 = 
PRNDRN_RIGHTTOLEFT
;

1563 ià(
m_cPrštDœeùiÚ
 =ğ
PRNDRN_RIGHTTOLEFT
)

1565 
¡¬t
 = 
size
 - 
m_iBy‹sP”Swšg
;

1566 
d–
 = -
m_iBy‹sP”Swšg
;

1570 
¡¬t
 = 0;

1571 
d–
 = 
m_iBy‹sP”Swšg
;

1573 ià(
m_pQA
->
v”tiÿl_»sŞutiÚ
 == 300)

1574 
xD–
 = 
m_iBy‹sP”Swšg
;

1575 
uiSw©hSize
 = ((
size
/
m_iBy‹sP”Swšg
è* 
sCurSw©hHeight
 * m_iBy‹sP”Swšg * (600 * 
m_iB™D•th
)/ 
m_pQA
->
v”tiÿl_»sŞutiÚ
);

1577 ià(
m_lid_v”siÚ
 =ğ2 && 
m_pPM
->
dyeCouÁ
 != 1)

1579 
sFœ¡NozzË
 = 9;

1582 
”r
 = 
	`´štSw“p
 (
uiSw©hSize
, 
çl£
, 
bBÏckP»£Á
, false,

1583 (
m_iV”tPo¢
 + 
cV”tAlign
), 
LeáEdge
, 
RightEdge
, 
m_cPrštDœeùiÚ
, 
sFœ¡NozzË
, 
sLa¡NozzË
);

1584 
ERRCHECK
;

1586 
i
 = 
¡¬t
;

1587 
BYTE
 *
cb
 = 
m_szCom´essBuf
+16;

1588 
	`mem£t
 (
m_szCom´essBuf
, 0x0, 
LDL_MAX_IMAGE_SIZE
 * (
m_iBy‹sP”Swšg
 / 2));

1590 
n
 = 
LDL_MAX_IMAGE_SIZE
 / (
sCurSw©hHeight
 * 
m_iBy‹sP”Swšg
 * 600 / 
m_pQA
->
v”tiÿl_»sŞutiÚ
);

1591 
couÁ
 = 0;

1592 
iOff£t
 = 0;

1593 ià(
m_pQA
->
v”tiÿl_»sŞutiÚ
 > 300 && m_pQA->
´št_qu®™y
 !ğ
DRAFT_QUALITY
)

1595 
iOff£t
 = 
sCurSw©hHeight
 / 4;

1596 
iOff£t
 = iOff£ˆ+ iOff£ˆ* (
m_cPassNumb”
 % 4);

1599 
l
 = 0;† < 
size
;† +ğ
m_iBy‹sP”Swšg
)

1601 
j
 = 
iOff£t
; j < 
sCurSw©hHeight
; j++)

1603 
is
 = 0; i < 
m_iBy‹sP”Swšg
; is++)

1605 *
cb
++ = 
m_Sw©hD©a
[0][
j
][
i
 + 
is
] & 
mask
;

1607 
cb
 +ğ
xD–
;

1609 
j
 = 0; j < 
iOff£t
; j++)

1611 
is
 = 0; i < 
m_iBy‹sP”Swšg
; is++)

1613 *
cb
++ = 
m_Sw©hD©a
[0][
j
][
i
 + 
is
] & 
mask
;

1615 
cb
 +ğ
xD–
;

1618 
couÁ
++;

1619 ià(
couÁ
 =ğ
n
)

1621 
”r
 = 
	`lßdSw“pD©a
 (
m_szCom´essBuf
, (è(
cb
 - m_szCompressBuf-16));

1622 
	`mem£t
 (
m_szCom´essBuf
, 0, 
LDL_MAX_IMAGE_SIZE
 * (
m_iBy‹sP”Swšg
 / 2));

1624 
cb
 = 
m_szCom´essBuf
+16;

1625 
couÁ
 = 0;

1626 
ERRCHECK
;

1628 
i
 = i + 
d–
;

1630 ià(
couÁ
 != 0)

1632 
”r
 = 
	`lßdSw“pD©a
 (
m_szCom´essBuf
, (è(
cb
 - m_szCompressBuf-16));

1633 
	`mem£t
 (
m_szCom´essBuf
, 0, 
LDL_MAX_IMAGE_SIZE
 * (
m_iBy‹sP”Swšg
 / 2));

1635 
cb
 = 
m_szCom´essBuf
+16;

1636 
couÁ
 = 0;

1637 
ERRCHECK
;

1640 ià(
m_bBidœeùiÚ®PrštšgOn
)

1641 
m_cPrštDœeùiÚ
 = (m_cPrintDirection + 1) % 2;

1643  
”r
;

1644 
	}
}

1646 
boŞ
 
	gLid
::
	$isBÏnkRa¡”
(
BYTE
 *
¿¡”
, 
width
)

1648 ià(*
¿¡”
 =ğ0 && !
	`memcmp
Ôa¡”+1,„a¡”, 
width
-1))

1649  
Œue
;

1650  
çl£
;

1651 
	}
}

1653 
	gLid
::
	$­¶yShšgËMask
(
iCPÏÃ
, 
BYTE
 *
šput
)

1656 
BYTE
 
cby‹1
, 
cby‹2
;

1657 
BYTE
 
c1
, 
c2
;

1658 
j
 = 0;

1659 
BYTE
 
r1b1
 = 0;

1660 
BYTE
 
r1b2
 = 0;

1661 
BYTE
 
r2b1
 = 0;

1662 
BYTE
 
r2b2
 = 0;

1663 
BYTE
 
b™mask
[8] = {0x80, 0x40, 0x20, 0x10, 0x08, 0x04, 0x02, 0x01};

1666 
iNextB™Pos
 = 
m_iImageWidth
;

1667 
iJInüem’t
 = 1;

1668 ià(
m_lid_v”siÚ
 == 2)

1670 
iNextB™Pos
 = 1;

1671 
iJInüem’t
 = 2;

1675 
	`memıy
 (
m_szCom´essBuf
, 
m_Sw©hD©a
[
iCPÏÃ
][
m_iNextRa¡”
], 
m_iImageWidth
);

1677 
BYTE
 
¿nd_bË
[4][4] = {{0, 3, 1, 2},

1682 
BYTE
 
¹1
, 
¹2
;

1683 
¹1
 = 
m_iNextRa¡”
 % 4;

1685 
i
 = 0; i < 
m_iImageWidth
; i++)

1687 
cby‹2
 = 
m_szCom´essBuf
[
i
];

1688 
cby‹1
 = (
šput
 =ğ
NULL
è? 0 : iÅut[
i
];

1692 
r1b1
 = 0;

1693 
r1b2
 = 0;

1694 
r2b1
 = 0;

1695 
r2b2
 = 0;

1697 
ib™
 = 0; ibit < 8; ibit++)

1699 
c1
 = (
cby‹1
 & 
b™mask
[
ib™
]) ? 1 : 0;

1700 
c2
 = (
cby‹2
 & 
b™mask
[
ib™
]) ? 1 : 0;

1701 
c1
 = 2 * c1 + 
c2
;

1703 
¹2
 = (
i
 + 
ib™
) % 4;

1704 
¹2
 = 
¿nd_bË
[
¹1
][rt2];

1706 ià(
c1
 == 2)

1708 ià(
¹2
 == 0)

1710 
r1b1
 =„1b1 | (0xfà& (
cby‹1
 & 
b™mask
[
ib™
]));

1711 
r2b2
 =„2b2 | (0xfà& 
b™mask
[
ib™
]);

1713 ià(
¹2
 == 1)

1715 
r1b2
 =„1b2 | (0xfà& 
b™mask
[
ib™
]);

1716 
r2b1
 =„2b1 | (0xfà& 
b™mask
[
ib™
]);

1719 ià(
¹2
 == 2)

1721 
r1b1
 =„1b1 | (0xfà& 
b™mask
[
ib™
]);

1722 
r2b1
 =„2b1 | (0xfà& 
b™mask
[
ib™
]);

1724 ià(
¹2
 == 3)

1726 
r1b2
 =„1b2 | (0xfà& 
b™mask
[
ib™
]);

1727 
r2b2
 =„2b2 | (0xfà& 
b™mask
[
ib™
]);

1731 ià(
c1
 == 1)

1733 ià(
¹2
 == 0)

1734 
r1b1
 =„1b1 | (0xfà& 
b™mask
[
ib™
]);

1735 ià(
¹2
 == 1)

1736 
r1b2
 =„1b2 | (0xfà& 
b™mask
[
ib™
]);

1737 ià(
¹2
 == 2)

1738 
r2b1
 =„2b1 | (0xfà& 
b™mask
[
ib™
]);

1740 
r2b2
 =„2b2 | (0xfà& 
b™mask
[
ib™
]);

1743 ià(
c1
 == 3)

1745 
r1b1
 =„1b1 | (0xfà& 
b™mask
[
ib™
]);

1746 
r1b2
 =„1b2 | (0xfà& 
b™mask
[
ib™
]);

1747 
r2b1
 =„2b1 | (0xfà& 
b™mask
[
ib™
]);

1748 
r2b2
 =„2b2 | (0xfà& 
b™mask
[
ib™
]);

1751 
m_Sw©hD©a
[
iCPÏÃ
][
m_iNextRa¡”
][
j
] = 
r1b1
;

1752 
m_Sw©hD©a
[
iCPÏÃ
][
m_iNextRa¡”
][
j
+
iNextB™Pos
] = 
r1b2
;

1753 
m_Sw©hD©a
[
iCPÏÃ
][
m_iNextRa¡”
+1][
j
] = 
r2b1
;

1754 
m_Sw©hD©a
[
iCPÏÃ
][
m_iNextRa¡”
+1][
j
+
iNextB™Pos
] = 
r2b2
;

1756 
j
 +ğ
iJInüem’t
;

1758 
	}
}

	@prnt/hpcups/Lidil.h

31 #iâdeà
LIDIL_H


32 
	#LIDIL_H


	)

34 
şass
 
	gLidCom´ess
;

36 
	#SWATH_HEIGHT
 100

	)

37 
	#DEVUNITS_XBOW
 2400

	)

39 cÚ¡ 
	gCANCELSIZE
 = 16;

40 cÚ¡ 
	gSYNCSIZE
 = 2304;

41 cÚ¡ 
	gSYNC_CMD_OPT_SIZE
 = 245;

45 
	meLDLS¹Job
 = 0,

46 
	meLDLEndJob
 = 0,

47 
	meLDLLßdPage
 = 1,

48 
	meLDLEjeùPage
 = 2,

49 
	meLDLPrštSw“p
 = 3,

50 
	meLDLLßdSw“pD©a
 = 4,

51 
	meLDLQu”yPrš‹r
 = 5,

52 
	meLDLComm’ts
 = 7,

53 
	meLDLHªdËP’
 = 8,

54 
	meLDLCÚŒŞ
 = 12,

55 
	meLDLD©aSŒ—mV”siÚ
 = 12

56 } 
	tLDLCMD
;

60 
	meLDLUnknownCŞÜ
 = -1,

61 
	meLDLBÏck
,

62 
	meLDLCyª
,

63 
	meLDLMag’
,

64 
	meLDLY–low
,

65 
	meLDLLoCyª
,

66 
	meLDLLoMag’
,

67 
	meLDLLoBÏck
,

68 
	meLDLMaxCŞÜ


69 } 
	tCOLORENUM
;

72 
	#LDLPACKET_MINSIZE
 16

73 
	#FRAME_SYN
 '$'

74 
	#OPTIMIZED_DELAYLIMIT
 0

76 

	)

77 
	#LDL_MAX_IMAGE_SIZE
 2048

	)

79 
	#SIZEOF_LDLHDR
 10

	)

80 
	#SIZEOF_LDLTERM
 1

	)

81 
	#SIZEOF_LDL_JOB_CMDOPT
 5

	)

84 
	#OPERATION_STJOB
 0

	)

85 
	#OPERATION_ENDJOB
 1

	)

86 
	#OPERATION_CANCJOB
 2

	)

88 
	#SIZEOF_LDL_LDPAGE_CMDOPT
 17

	)

91 
	#MEDIATYPE_PLAIN
 0

92 
	#MEDIATYPE_PHOTO
 3

	)

94 
	#MEDIASRC_MAINTRAY
 0

95 
	#MEDIADEST_MAINBIN
 0

96 

	)

97 
	#DRAFT_QUALITY
 -1

98 
	#NORMAL_QUALITY
 0

	)

99 
	#BEST_QUALITY
 1

	)

100 
	#MAXDPI_QIALITY
 2

	)

102 
	#SPECLOAD_NONE
 0

103 
	#SPECLOAD_ENVELOPE
 1

	)

105 
	#MEDIALD_SPEED
 0x00000001

106 
	#NEED_TO_SERVICE_PERIOD
 0x00000002

	)

107 
	#MINTIME_BTW_SWEEP
 0x00000004

	)

109 
	#DEVUNITS_XBOW
 2400

110 
	#SIZEOF_LDL_LDPAGE_OPTFLDS
 4

	)

111 
	#SIZEOF_LDL_COLROPT_ACTIVECOLR
 2

	)

112 
	#NO_ACTIVE_COLORS
 0

	)

113 
	#SIZEOF_LDL_EJPAGE_CMDOPT
 4

	)

114 
	#MEDIA_EJSPEED
 1

115 
	#SIZEOF_LDL_EJPAGE_OPTFLDS
 1

	)

116 
	#SIZEOF_LDL_PRTSWP_CMDOPT
 18

	)

117 
	#SWINGFMT_UNCOMPRSS
 0

118 
	#PRNDRN_LEFTTORIGHT
 0

119 
	#PRNDRN_RIGHTTOLEFT
 1

	)

121 
	#IPS_CARRSPEED
 0x00000001

122 
	#IPS_INIPRNSPEED
 0x00000002

	)

123 
	#IPS_MEDIASPEED
 0x00000004

	)

124 
	#PAPER_ACCURACY
 0x00000008

	)

125 
	#ACCURATEPOSN_NEEDED
 0x00000010

	)

126 
	#DRYTIME
 0x00000020

127 

	)

128 
	#SIZEOF_LDL_PRTSWP_OPTFLDS
 3

	)

129 
	#SIZEOF_LDL_PRTSWP_COLROPT
 29

	)

130 
	#SIZEOF_LDL_LDSWPDATA_CMDOPT
 2

	)

132 
	#OPERATION_CONTINUE
 2

	)

133 
	#DATASTREAMVERSION
 3

	)

134 
	#OPERATION_SPIT_PEN
 2

	)

136 şas 
	cLid
: 
public
 
EnÿpsuÏtÜ


138 
public
:

139 
Lid
();

140 ~
Lid
();

141 
DRIVER_ERROR
 
EnÿpsuÏ‹
 (
RASTERDATA
 *
IÅutRa¡”
, 
boŞ
 
bLa¡PÏÃ
);

142 
DRIVER_ERROR
 
S¹Job
(
Sy¡emS”viûs
 *
pSy¡emS”viûs
, 
JobA‰ribu‹s
 *
pJA
);

143 
DRIVER_ERROR
 
EndJob
();

144 
DRIVER_ERROR
 
S¹Page
(
JobA‰ribu‹s
 *
pJA
);

145 
DRIVER_ERROR
 
FÜmF“d
();

146 
DRIVER_ERROR
 
CÚfigu»
(
P–še
 **
p–še
);

147 
DRIVER_ERROR
 
S’dCAPy
 (
iOff£t
);

148 
CªûlJob
();

149 
	m´Ùeùed
:

150 
DRIVER_ERROR
 
	$addJobS‘tšgs
(è{ 
NO_ERROR
;}

151 
DRIVER_ERROR
 
	$æushPrš‹rBufãr
(è{ 
NO_ERROR
;
	}
}

152 
	g´iv©e
:

153 
boŞ
 
£ËùPrštMode
();

154 
boŞ
 
£ËùPrštMode
(
šdex
);

155 
DRIVER_ERROR
 
®loÿ‹Sw©hBufãrs
();

156 
addIÁ32
(
IÁ32
 
iV®
);

157 
addIÁ16
(
IÁ16
 
iV®
);

158 
flLidH—d”
(*
pLidHdr
, 
Commªd
, 
UIÁ16
 
CmdL’
, UIÁ16 
D©aL’
 = 0);

159 
g‘Sw©hWidth
 (
iS¹
, 
iLa¡
, 
iWidth
);

160 
DRIVER_ERROR
 
´oûssSw©h
();

161 
DRIVER_ERROR
 
´oûssBÏckSw©h
(
boŞ
 
bBÏckP»£Á
, boŞ 
bCŞÜP»£Á
, 
sCŞÜSize
, 
LeáEdge
, 
BYTE
 
mask
);

162 
DRIVER_ERROR
 
´oûssCŞÜSw©h
(
boŞ
 
bPhÙoP»£Á
, boŞ 
bCŞÜP»£Á
, boŞ 
bBÏckP»£Á
, *
sCŞÜSize
, 
BYTE
 
mask
);

163 
DRIVER_ERROR
 
´oûssPhÙoSw©h
(
boŞ
 
bPhÙoP»£Á
, boŞ 
bCŞÜP»£Á
, 
BYTE
 
mask
);

164 
boŞ
 
isBÏnkRa¡”
(
BYTE
 *
¿¡”
, 
width
);

165 
­¶yShšgËMask
(
iCPÏÃ
, 
BYTE
 *
šput
);

166 
DRIVER_ERROR
 
lßdSw“pD©a
 (
BYTE
 *
imaged©a
, 
imagesize
);

167 
DRIVER_ERROR
 
´štSw“p
 (
UIÁ32
 
Sw“pSize
,

168 
boŞ
 
CŞÜP»£Á
,

169 
boŞ
 
BÏckP»£Á
,

170 
boŞ
 
PhÙoP»£Á
,

171 
IÁ32
 
V”tiÿlPos™iÚ
,

172 
IÁ32
 
LeáEdge
,

173 
IÁ32
 
RightEdge
,

174 
PrštDœeùiÚ
,

175 
IÁ16
 
sFœ¡NozzË
,

176 
IÁ16
 
sLa¡NozzË
);

178 
PrštMode
 *
	gm_pPM
;

179 
boŞ
 
	gm_bBidœeùiÚ®PrštšgOn
;

180 
boŞ
 
	gm_bP»vRowWasBÏnk
;

181 
boŞ
 
	gm_bL™eEndŸn
;

182 
	gm_cPassNumb”
;

183 
	gm_cPrštDœeùiÚ
;

184 
	gm_cKtoCV”tAlign
;

185 
	gm_cPtoCV”tAlign
;

186 
	gm_cPÏÃNumb”
;

187 
UIÁ16
 
	gm_sSw©hHeight
;

188 
UIÁ16
 
	gm_sRefCouÁ
;

189 
	gm_iB™D•th
;

190 
	gm_iNextRa¡”
;

191 
	gm_iBÏnkRa¡”s
;

192 
	gm_iV”tPo¢
;

193 
	gm_iImageWidth
;

194 
	gm_iRa¡”CouÁ
;

195 
	gm_lid_v”siÚ
;

196 
	gm_iBy‹sP”Swšg
;

197 
	gm_iCŞÜP’ResŞutiÚ
;

198 
	gm_iBÏckP’ResŞutiÚ
;

199 
	gm_iNumBÏckNozzËs
;

200 
	gm_iNextCŞÜ
;

201 
	gm_iLeáM¬gš
;

202 
BYTE
 *
	gm_ldlCom´essD©a
;

203 
BYTE
 *
	gm_szCom´essBuf
;

204 
BYTE
 ***
	gm_Sw©hD©a
;

205 
LidCom´ess
 *
	gm_pLidCom´ess
;

	@prnt/hpcups/LidilCompress.cpp

31 
	~"CommÚDefš™iÚs.h
"

32 
	~"LidCom´ess.h
"

34 
UIÁ16
 
	gLidCom´ess
::
	$FlushImage
 ()

36 
UIÁ16
 
commªd
;

37 
UIÁ16
 
wsize
;

38 
UIÁ16
 
bsize
;

39 
UIÁ16
 *
äom_±r
;

40 
šdex
;

42 
wsize
 = 
m_image_út
;

43 
bsize
 = 0;

45 ià(
wsize
)

47 
äom_±r
 = 
m_image_±r
;

49 
commªd
 = 
FILL_IMAGE_CMD
 | (
wsize
-1);

51 
šdex
 = 0;

52 *
m_out_±r
++ = 
commªd
;

53 
UIÁ16
 
i
 = 0; i < 
wsize
; i++)

55 *
m_out_±r
++ = *
äom_±r
++;

57 
bsize
 = ((
m_image_út
+1) * 2);

58 
m_out_út
 +ğ
bsize
;

60 
m_image_út
 = 0;

63  
bsize
;

64 
	}
}

66 
UIÁ16
 
	gLidCom´ess
::
	$FlushCİy
 (
UIÁ16
 
v®ue
)

68 
UIÁ16
 
commªd
;

69 
UIÁ16
 
size
;

71 
size
 = 
m_cİy_út
;

72 ià(
size
)

74 
UIÁ16
 *
uP
 = 
m_out_±r
++;

75 
size
 = 2;

76 ià(
v®ue
 == 0)

78 
commªd
 = 
FILL_0000_CMD
 | (
m_cİy_út
-1);

80 ià(
v®ue
 == 0xFFFF)

82 
commªd
 = 
FILL_FFFF_CMD
 | (
m_cİy_út
-1);

86 
commªd
 = 
FILL_NEXT_CMD
 | (
m_cİy_út
-1);

87 *
m_out_±r
++ = 
v®ue
;

88 
size
 = 4;

91 *
uP
 = 
commªd
;

92 
m_out_út
 +ğ
size
;

93 
m_cİy_út
 = 0;

95  
size
;

96 
	}
}

98 
	gLidCom´ess
::
	$Com´essD©a
 (
IÁ16
 
com´essiÚmode
)

100 
IÁ16
 
i
;

101 
UIÁ16
 *
š_±r
;

102 
UIÁ16
 
š
;

103 
UIÁ16
 
Ï¡
=0;

104 
UIÁ16
 
cİy_™em
;

105 
UIÁ16
 
d©a_Ëngth
;

107 
LDLCOMPMODE
 
mode
 = 
IN_NOT
;

110 
m_out_út
 = 0;

111 
m_image_út
 = 0;

112 
m_cİy_út
 = 0;

114 
m_out_±r
 = &
m_out_¬¿y
[8];

115 
d©a_Ëngth
 = 
m_d©a_Ëngth
;

117 ià((
d©a_Ëngth
 & 1) != 0)

122 
cİy_™em
 = 0;

123 
š_±r
 = &
m_¿w_d©a
[0];

125 
i
=0; i<
d©a_Ëngth
; i+=2)

127 
š
 = *
š_±r
;

129 
mode
)

131 
IN_NOT
:

134 
Ï¡
 = 
š
;

135 
m_image_±r
 = 
š_±r
;

136 
m_image_út
 = 1;

137 
mode
 = 
IN_FIRST
;

141 
IN_FIRST
:

143 #ià
ALLOW_FILL_NEXT_CMD


144 ià(
Ï¡
 =ğ
š
)

146 ià((
Ï¡
 =ğ
š
) && ((in==0xFFFF) || (in == 0)) )

149 
mode
 = 
IN_COPY
;

150 
m_cİy_út
 = 2;

151 
m_image_út
 = 0;

152 
cİy_™em
 = 
š
;

156 
mode
 = 
IN_IMAGE
;

157 
m_image_út
++;

158 
Ï¡
 = 
š
;

163 
IN_COPY
:

165 ià(
Ï¡
 =ğ
š
)

167 
m_cİy_út
++;

175 
UIÁ16
 
cİy_couÁ
 = 
m_cİy_út
;

177 ià(
cİy_couÁ
 <ğ
m_run_Ëngth
)

179 ià(
m_image_út
 == 0)

182 
m_image_±r
 = 
š_±r
 - 
cİy_couÁ
;

184 
m_image_út
 +ğ(1+
cİy_couÁ
);

185 
m_cİy_út
 = 0;

191 (è
	`FlushImage
 ();

193 (è
	`FlushCİy
 (
cİy_™em
);

195 
m_image_±r
 = 
š_±r
;

196 
m_image_út
 = 1;

198 
mode
 = 
IN_IMAGE
;

199 
Ï¡
 = 
š
;

204 
IN_IMAGE
:

206 #ià
ALLOW_FILL_NEXT_CMD


207 ià(
Ï¡
 =ğ
š
)

209 ià((
Ï¡
 =ğ
š
) && ((in==0xFFFF) || (in == 0)) )

212 
m_image_út
--;

214 
mode
 = 
IN_COPY
;

215 
cİy_™em
 = 
š
;

216 
m_cİy_út
 = 2;

220 
Ï¡
 = 
š
;

221 
m_image_út
++;

231 
š_±r
++;

236 
mode
)

238 
IN_COPY
:

241 (è
	`FlushImage
 ();

243 (è
	`FlushCİy
 (
cİy_™em
);

246 
IN_IMAGE
:

247 
IN_FIRST
:

249 (è
	`FlushImage
 ();

256 ià(
m_out_út
 > 2048+16)

261 
	}
}

263 
boŞ
 
	gLidCom´ess
::
	$G‘F¿meInfo
 (
BYTE
 **
outd©a
, 
UIÁ16
 *
d©a_size
)

265 *
outd©a
 = (*è&
m_out_¬¿y
[0];

266 *
d©a_size
 = 
m_out_út
;

267 (
Œue
);

268 
	}
}

270 
boŞ
 
	gLidCom´ess
::
	$In™
 (
UIÁ16
 *
d©a
, UIÁ16 
d©asize
)

272 
m_image_±r
 = 
d©a
;

273 
m_¿w_d©a
 = 
d©a
;

274 
m_d©a_Ëngth
 = 
d©asize
;

276 
m_run_Ëngth
 = 
MAX_RUNLENGTH
;

278 (
Œue
);

279 
	}
}

	@prnt/hpcups/LidilCompress.h

31 #iâdeà
LIDIL_COMPRESS_H


32 
	#LIDIL_COMPRESS_H


	)

34 
	#ALLOW_FILL_NEXT_CMD
 1

	)

36 
	#FILL_0000_CMD
 0x1000

	)

37 
	#FILL_FFFF_CMD
 0x2000

	)

38 
	#FILL_NEXT_CMD
 0x3000

	)

39 
	#FILL_IMAGE_CMD
 0x4000

	)

40 
	#FILL_ODD_CMD
 0x5000

	)

41 
	#FILL_EVEN_CMD
 0x6000

	)

43 
	#MAX_HEADER_FRAME_SIZE
 512

	)

44 
	#MAX_DATA_FRAME_SIZE
 6048

	)

45 
	#MAX_RUNLENGTH
 5

	)

49 
	mIN_NOT
,

50 
	mIN_FIRST
,

51 
	mIN_IMAGE
,

52 
	mIN_COPY


53 } 
	tLDLCOMPMODE
;

55 şas 
	cLidCom´ess


57 
	mpublic
:

58 
	$LidCom´ess
 (
boŞ
 
bL™eEndŸn
è: 
	$m_bL™eEndŸn
(
bL™eEndŸn
) {}

59 ~
	$LidCom´ess
 (è{
	}
}

60 
boŞ
 
In™
(
UIÁ16
 *
d©a
, UIÁ16 
d©asize
);

61 
boŞ
 
G‘F¿meInfo
(
BYTE
 **
outd©a
, 
UIÁ16
 *
d©asize
);

62 
Com´essD©a
(
IÁ16
 
com´essmode
 = 1);

63 
UIÁ16
 
FlushCİy
(UIÁ16 
v®ue
);

64 
UIÁ16
 
FlushImage
();

65 
	g´iv©e
:

66 
UIÁ16
 *
m_out_±r
;

67 
UIÁ16
 *
	gm_image_±r
;

68 
UIÁ16
 
	gm_out_út
;

69 
UIÁ16
 
	gm_image_út
;

70 
UIÁ16
 
	gm_cİy_út
;

71 
UIÁ16
 
	gm_out_¬¿y
[2048+16];

72 
UIÁ16
 *
	gm_¿w_d©a
;

73 
UIÁ16
 
	gm_run_Ëngth
;

74 
UIÁ16
 
	gm_d©a_Ëngth
;

75 
boŞ
 
	gm_bL™eEndŸn
;

	@prnt/hpcups/LidilPrintModes.h

1 
	~"CommÚDefš™iÚs.h
"

2 
	~"dj3320PrštModes.h
"

3 
	~"dj4100PrštModes.h
"

8 
	gPQ_C¬Œidge_M­
[][5]={

21 
	gPQ_C¬Œidge_M­_V”Trim
[][5]={

39 
	gPQ_C¬Œidge_M­
[][5]={

55 
PrštModeTabË
 
	glid_´št_modes_bË
 [] =

57 {"dj3320", 
dj3320PrštModes
, (dj3320PrštModes)/(
PrštMode
)},

58 {"dj3600", 
dj3320PrštModes
, (dj3320PrštModes)/(
PrštMode
)},

59 {"dj4100", 
dj4100PrštModes
, (dj4100PrštModes)/(
PrštMode
)},

60 {"dj2600", 
dj4100PrštModes
, (dj4100PrštModes)/(
PrštMode
)}

	@prnt/hpcups/Mode10.cpp

31 
	~"Mode10.h
"

33 
	gMode10
::
	$Mode10
 (
PÏÃSize
è: 
	$Com´essÜ
 (
PÏÃSize
, 
Œue
)

35 ià(
cÚ¡ruùÜ_”rÜ
 !ğ
NO_ERROR
)

42 
s
;

43 
c
[2];

44 } 
uEndŸn
;

45 
uEndŸn
.
s
 = 0x0A0B;

46 
m_eEndŸn
 = 
LITTLEENDIAN
;

47 ià(
uEndŸn
.
c
[0] == 0x0A)

48 
m_eEndŸn
 = 
BIGENDIAN
;

51 
com´essBuf
 = 
Ãw
 
BYTE
[(
PÏÃSize
 + PlaneSize/2)];

52 ià(
com´essBuf
 =ğ
NULL
)

53 
cÚ¡ruùÜ_”rÜ
 = 
ALLOCMEM_ERROR
;

55 
	`mem£t
 (
S“dRow
, 0xFF, 
PÏÃSize
);

56 
	}
}

58 
	gMode10
::~
	$Mode10
()

59 { 
	}
}

61 
Mode10
::
	$Flush
 ()

63 ià(!
£eded
)

67 
com´es£dsize
 = 0;

68 
iRa¡”sR—dy
 = 0;

69 
£eded
 = 
çl£
;

70 
	`mem£t
 (
S“dRow
, 0xFF, 
šputsize
);

71 
	}
}

73 
šlše
 
ušt32_t
 
	gMode10
::
	$g‘3Pix–
 (
BYTE
 *
pixAdd»ss
, 
pix–Off£t
)

75 
pixAdd»ss
 +ğ((
pix–Off£t
 << 1) +…ixelOffset);

77 
BYTE
 
r
 = *(
pixAdd»ss
);

78 
BYTE
 
g
 = *(
pixAdd»ss
 + 1);

79 
BYTE
 
b
 = *(
pixAdd»ss
 + 2);

81  (
kWh™e
 & ((
r
 << 16è| (
g
 << 8è| (
b
)));

83 
	}
}

85 
	gMode10
::
	$put3Pix–
 (
BYTE
 *
pixAdd»ss
, 
pix–Off£t
, 
ušt32_t
 
pix–
)

87 
pixAdd»ss
 +ğ((
pix–Off£t
 << 1) +…ixelOffset);

89 
‹mp
 = (
pix–
 & 
kWh™e
);

91 *(
pixAdd»ss
èğ((
‹mp
 >> 16) & 0x000000FF);

92 *(
pixAdd»ss
 + 1èğ((
‹mp
 >> 8) & 0x000000FF);

93 *(
pixAdd»ss
 + 2èğ(
‹mp
 & 0x000000FF);

95 
	}
}

98 
	gMode10
::
	$ShÜtD–
 (
ušt32_t
 
Ï¡Pix–
, ušt32_ˆ
Ï¡Uµ”Pix–
)

100 
dr
, 
dg
, 
db
;

101 
»suÉ
;

103 
dr
 = 
	`G‘Red
 (
Ï¡Pix–
è- G‘Red (
Ï¡Uµ”Pix–
);

104 
dg
 = 
	`G‘G»’
 (
Ï¡Pix–
è- G‘G»’ (
Ï¡Uµ”Pix–
);

105 
db
 = 
	`G‘Blue
 (
Ï¡Pix–
è- G‘Blu(
Ï¡Uµ”Pix–
);

107 ià((
dr
 <ğ15è&& (d¸>ğ-16è&& (
dg
 <ğ15è&& (dg >ğ-16è&& (
db
 <= 30) && (db >= -32))

109 
»suÉ
 = ((
dr
 << 10è& 0x007C00è| (((
dg
 << 5è& 0x0003E0è| ((
db
 >> 1) & 0x01F) | 0x8000);

113 
»suÉ
 = 0;

116  (è
»suÉ
;

117 
	}
}

119 
boŞ
 
	gMode10
::
	$Proûss
 (
RASTERDATA
 *
šput
)

130 ià(
šput
 =ğ
NULL
 ||

131 (
šput
->
¿¡”d©a
[
COLORTYPE_COLOR
] =ğ
NULL
 && iÅut->¿¡”d©a[
COLORTYPE_BLACK
] == NULL))

133 
	`Flush
 ();

134  
çl£
;

137 ià(
my¶ªe
 =ğ
COLORTYPE_BLACK
 || 
šput
->
¿¡”d©a
[
COLORTYPE_COLOR
]==
NULL
)

139 
iRa¡”sR—dy
 = 1;

140 
com´es£dsize
 = 0;

141  
Œue
;

143 
Üigš®size
 = 
šput
->
¿¡”size
[
my¶ªe
];

144 
size
 = 
šput
->
¿¡”size
[
my¶ªe
];

146 *
£edRowPŒ
 = (*è
S“dRow
;

148 *
com´es£dD©aPŒ
 = 
com´essBuf
;

149 *
curRowPŒ
 = (*è
šput
->
¿¡”d©a
[
my¶ªe
];

150 
rowWidthInBy‹s
 = 
size
;

151 
	`ASSERT
(
curRowPŒ
);

152 
	`ASSERT
(
£edRowPŒ
);

153 
	`ASSERT
(
com´es£dD©aPŒ
);

154 
	`ASSERT
(
rowWidthInBy‹s
 >ğ
BYTES_PER_PIXEL
);

155 
	`ASSERT
((
rowWidthInBy‹s
 % 
BYTES_PER_PIXEL
) == 0);

157 *
com´es£dD©aS¹
 = 
com´es£dD©aPŒ
;

158 
Ï¡Pix–
 = (
rowWidthInBy‹s
 / 
BYTES_PER_PIXEL
) - 1;

161 
ušt32_t
 
»®La¡Pix–
 = 
	`g‘Pix–
(
curRowPŒ
, 
Ï¡Pix–
);

163 
ušt32_t
 
ÃwLa¡Pix–
 = 
»®La¡Pix–
;

164 (
	`g‘Pix–
 (
curRowPŒ
, 
Ï¡Pix–
 - 1è=ğ
ÃwLa¡Pix–
) ||

165 (
	`g‘Pix–
 (
£edRowPŒ
, 
Ï¡Pix–
è=ğ
ÃwLa¡Pix–
))

167 
	`putPix–
 (
curRowPŒ
, 
Ï¡Pix–
, 
ÃwLa¡Pix–
 += 0x100);

169 
curPix–
 = 0;

170 
£edRowPix–CİyCouÁ
;

171 
ÿchedCŞÜ
 = 
kWh™e
;

175 
CMDBy‹
 = 0;

176 
»¶aûm’tCouÁ
;

179 
£edRowPix–CİyCouÁ
 = 
curPix–
;

180 
	`g‘Pix–
 (
£edRowPŒ
, 
curPix–
è=ğg‘Pix– (
curRowPŒ
, curPixel))

182 
curPix–
++;

185 
£edRowPix–CİyCouÁ
 = 
curPix–
 - seedRowPixelCopyCount;

186 
	`ASSERT
 (
curPix–
 <ğ
Ï¡Pix–
);

188 
pix–Sourû
 = 0;

190 ià(
curPix–
 =ğ
Ï¡Pix–
)

192 
	`putPix–
(
curRowPŒ
, 
Ï¡Pix–
, 
»®La¡Pix–
);

194 ià(
	`g‘Pix–
(
£edRowPŒ
, 
curPix–
è=ğ
»®La¡Pix–
)

196 
mode10¹n
;

201 
CMDBy‹
 = 
eL™”®
;

202 
pix–Sourû
 = 
“NewPix–
;

203 
»¶aûm’tCouÁ
 = 1;

204 
curPix–
++;

209 
	`ASSERT
(
curPix–
 < 
Ï¡Pix–
);

211 
»¶aûm’tCouÁ
 = 
curPix–
;

212 
ušt32_t
 
RLERun
 = 
	`g‘Pix–
 (
curRowPŒ
, 
curPix–
);

214 
curPix–
++;

215 
RLERun
 =ğ
	`g‘Pix–
 (
curRowPŒ
, 
curPix–
))

217 
curPix–
++;

219 
curPix–
--;

220 
»¶aûm’tCouÁ
 = 
curPix–
 -„eplacementCount;

221 
	`ASSERT
(
»¶aûm’tCouÁ
 >= 0);

223 ià(
»¶aûm’tCouÁ
 > 0)

225 
curPix–
++;

226 
»¶aûm’tCouÁ
++;

228 ià(
ÿchedCŞÜ
 =ğ
RLERun
)

230 
pix–Sourû
 = 
“CachedCŞÜ
;

232 ià(
	`g‘Pix–
 (
£edRowPŒ
, 
curPix–
-
»¶aûm’tCouÁ
 + 1è=ğ
RLERun
)

234 
pix–Sourû
 = 
“NEPix–
;

236 ià((
curPix–
-
»¶aûm’tCouÁ
 > 0) &&

237 (
	`g‘Pix–
 (
curRowPŒ
, 
curPix–
-
»¶aûm’tCouÁ
 - 1è=ğ
RLERun
))

239 
pix–Sourû
 = 
“WPix–
;

243 
pix–Sourû
 = 
“NewPix–
;

244 
ÿchedCŞÜ
 = 
RLERun
;

247 
CMDBy‹
 = 
eRLE
;

251 ià(
curPix–
 =ğ
Ï¡Pix–
)

253 
	`ASSERT
(
»¶aûm’tCouÁ
 > 0);

255 ià(
»®La¡Pix–
 =ğ
RLERun
)

257 
	`putPix–
 (
curRowPŒ
, 
Ï¡Pix–
, 
»®La¡Pix–
);

258 
»¶aûm’tCouÁ
++;

259 
curPix–
++;

263 ià(0 =ğ
»¶aûm’tCouÁ
)

265 
ušt32_t
 
‹mpPix–
 = 
	`g‘Pix–
 (
curRowPŒ
, 
curPix–
);

267 
	`ASSERT
(
‹mpPix–
 !ğ
	`g‘Pix–
 (
curRowPŒ
, 
curPix–
 + 1));

268 
	`ASSERT
(
‹mpPix–
 !ğ
	`g‘Pix–
 (
£edRowPŒ
, 
curPix–
));

270 
CMDBy‹
 = 
eL™”®
;

272 ià(
ÿchedCŞÜ
 =ğ
‹mpPix–
)

274 
pix–Sourû
 = 
“CachedCŞÜ
;

277 ià(
	`g‘Pix–
 (
£edRowPŒ
, 
curPix–
 + 1è=ğ
‹mpPix–
)

279 
pix–Sourû
 = 
“NEPix–
;

282 ià((
curPix–
 > 0è&& (
	`g‘Pix–
 (
curRowPŒ
, curPix–-1è=ğ
‹mpPix–
))

284 
pix–Sourû
 = 
“WPix–
;

290 
pix–Sourû
 = 
“NewPix–
;

291 
ÿchedCŞÜ
 = 
‹mpPix–
;

294 
»¶aûm’tCouÁ
 = 
curPix–
;

295 
ušt32_t
 
ÿchePix–
;

296 
ušt32_t
 
ÃxtPix–
 = 
	`g‘Pix–
 (
curRowPŒ
, 
curPix–
+1);

299 ià(++
curPix–
 =ğ
Ï¡Pix–
)

301 
	`putPix–
 (
curRowPŒ
, 
Ï¡Pix–
, 
»®La¡Pix–
);

302 
curPix–
++;

305 
ÿchePix–
 = 
ÃxtPix–
;

307 (
ÿchePix–
 !ğ(
ÃxtPix–
 = 
	`g‘Pix–
 (
curRowPŒ
, 
curPix–
+1))) &&

308 (
ÿchePix–
 !ğ
	`g‘Pix–
 (
£edRowPŒ
, 
curPix–
)));

310 
»¶aûm’tCouÁ
 = 
curPix–
 -„eplacementCount;

312 
	`ASSERT
(
»¶aûm’tCouÁ
 > 0);

319 ià(
eL™”®
 =ğ
CMDBy‹
)

321 
	`ASSERT
(
»¶aûm’tCouÁ
 >= 1);

323 
»¶aûm’tCouÁ
 -= 1;

325 
CMDBy‹
 |ğ
pix–Sourû
;

326 
CMDBy‹
 |ğ
	`MIN
(3, 
£edRowPix–CİyCouÁ
) << 3;

327 
CMDBy‹
 |ğ
	`MIN
(7, 
»¶aûm’tCouÁ
);

329 *
com´es£dD©aPŒ
++ = 
CMDBy‹
;

331 ià(
£edRowPix–CİyCouÁ
 >= 3)

333 
	`ouutVLIBy‹sCÚ£cutiv–y
 (
£edRowPix–CİyCouÁ
 - 3, 
com´es£dD©aPŒ
);

336 
»¶aûm’tCouÁ
 += 1;

338 
tÙ®R•Ïûm’tCouÁ
 = 
»¶aûm’tCouÁ
;

339 
upw¬dPix–CouÁ
 = 1;

341 ià(
“NewPix–
 !ğ
pix–Sourû
)

343 
»¶aûm’tCouÁ
 -= 1;

344 
upw¬dPix–CouÁ
 = 2;

347  ; 
upw¬dPix–CouÁ
 <ğ
tÙ®R•Ïûm’tCouÁ
; upwardPixelCount++)

349 
	`ASSERT
(
tÙ®R•Ïûm’tCouÁ
 >ğ
upw¬dPix–CouÁ
);

351 
com´es£dPix–
 = 
	`ShÜtD–
 (
	`g‘Pix–
 (
curRowPŒ
, 
curPix–
 - 
»¶aûm’tCouÁ
),

352 
	`g‘Pix–
 (
£edRowPŒ
, 
curPix–
 - 
»¶aûm’tCouÁ
));

353 ià(
com´es£dPix–
)

355 *
com´es£dD©aPŒ
++ = 
com´es£dPix–
 >> 8;

356 *
com´es£dD©aPŒ
++ = ()
com´es£dPix–
;

361 
ušt32_t
 
uncom´es£dPix–
 = 
	`g‘Pix–
 (
curRowPŒ
, 
curPix–
 - 
»¶aûm’tCouÁ
);

363 
uncom´es£dPix–
 >>= 1;

365 *
com´es£dD©aPŒ
++ = (
BYTE
è(
uncom´es£dPix–
 >> 16);

366 *
com´es£dD©aPŒ
++ = (
BYTE
è(
uncom´es£dPix–
 >> 8);

367 *
com´es£dD©aPŒ
++ = (
BYTE
è(
uncom´es£dPix–
);

371 ià(((
upw¬dPix–CouÁ
-8) % 255) == 0)

373 *
com´es£dD©aPŒ
++ = 
	`MIN
(255, 
tÙ®R•Ïûm’tCouÁ
 - 
upw¬dPix–CouÁ
);

376 
»¶aûm’tCouÁ
--;

381 
	`ASSERT
(
»¶aûm’tCouÁ
 >= 2);

383 
»¶aûm’tCouÁ
 -= 2;

385 
CMDBy‹
 |ğ
pix–Sourû
;

386 
CMDBy‹
 |ğ
	`MIN
(3, 
£edRowPix–CİyCouÁ
) << 3;

387 
CMDBy‹
 |ğ
	`MIN
(7, 
»¶aûm’tCouÁ
);

389 *
com´es£dD©aPŒ
++ = 
CMDBy‹
;

391 ià(
£edRowPix–CİyCouÁ
 >= 3)

393 
	`ouutVLIBy‹sCÚ£cutiv–y
 (
£edRowPix–CİyCouÁ
 - 3, 
com´es£dD©aPŒ
);

396 
»¶aûm’tCouÁ
 += 2;

398 ià(
“NewPix–
 =ğ
pix–Sourû
)

400 
com´es£dPix–
 = 
	`ShÜtD–
(
	`g‘Pix–
 (
curRowPŒ
, 
curPix–
 - 
»¶aûm’tCouÁ
),

401 
	`g‘Pix–
 (
£edRowPŒ
, 
curPix–
 - 
»¶aûm’tCouÁ
));

402 ià(
com´es£dPix–
)

404 *
com´es£dD©aPŒ
++ = 
com´es£dPix–
 >> 8;

405 *
com´es£dD©aPŒ
++ = (è
com´es£dPix–
;

409 
ušt32_t
 
uncom´es£dPix–
 = 
	`g‘Pix–
 (
curRowPŒ
, 
curPix–
 - 
»¶aûm’tCouÁ
);

411 
uncom´es£dPix–
 >>= 1;

413 *
com´es£dD©aPŒ
++ = (
BYTE
è(
uncom´es£dPix–
 >> 16);

414 *
com´es£dD©aPŒ
++ = (
BYTE
è(
uncom´es£dPix–
 >> 8);

415 *
com´es£dD©aPŒ
++ = (
BYTE
è(
uncom´es£dPix–
);

419 ià(
»¶aûm’tCouÁ
 - 2 >ğ7è
	`ouutVLIBy‹sCÚ£cutiv–y
 (»¶aûm’tCouÁ - (7+2), 
com´es£dD©aPŒ
);

421 } 
curPix–
 <ğ
Ï¡Pix–
);

422 
mode10¹n
:

423 
size
 = 
¡©ic_ÿ¡
<>(
com´es£dD©aPŒ
 - 
com´es£dD©aS¹
);

424 
com´es£dsize
 = 
size
;

425 
	`memıy
 (
S“dRow
, 
šput
->
¿¡”d©a
[
my¶ªe
], 
Üigš®size
);

426 
£eded
 = 
Œue
;

427 
iRa¡”sR—dy
 = 1;

428  
Œue
;

429 
	}
}

431 
boŞ
 
	gMode10
::
	$NextOuutRa¡”
 (
RASTERDATA
& 
Ãxt_¿¡”
)

433 ià(
iRa¡”sR—dy
 == 0)

435  
çl£
;

438 ià(
my¶ªe
 =ğ
COLORTYPE_COLOR
 && 
com´es£dsize
 != 0)

440 
Ãxt_¿¡”
.
¿¡”size
[
COLORTYPE_COLOR
] = 
com´es£dsize
;

441 
Ãxt_¿¡”
.
¿¡”d©a
[
COLORTYPE_COLOR
] = 
com´essBuf
;

445 
Ãxt_¿¡”
.
¿¡”size
[
COLORTYPE_COLOR
] = 0;

446 
Ãxt_¿¡”
.
¿¡”d©a
[
COLORTYPE_COLOR
] = 
¿¡”
.rasterdata[COLORTYPE_COLOR];

449 
Ãxt_¿¡”
.
¿¡”size
[
COLORTYPE_BLACK
] = 
¿¡”
.rastersize[COLORTYPE_BLACK];

450 
Ãxt_¿¡”
.
¿¡”d©a
[
COLORTYPE_BLACK
] = 
¿¡”
.rasterdata[COLORTYPE_BLACK];

452 
iRa¡”sR—dy
 = 0;

453  
Œue
;

454 
	}
}

	@prnt/hpcups/Mode10.h

31 #iâdeà
MODE10_H


32 
	#MODE10_H


	)

34 
	~"CommÚDefš™iÚs.h
"

35 
	~"ProûssÜ.h
"

36 
	~"Com´essÜ.h
"

40 
	#kB”tDecom´essPix–Size
 3

	)

43 
	#kTy³Mask
 0x80

	)

44 
	#kTy³ShiáAmouÁ
 7

	)

46 
	#kCacheL™”®B™sMask
 0x60

	)

47 
	#kCacheL™”®B™sShiáAmouÁ
 5

	)

49 
	#kCacheB™sMask
 0x60

	)

50 
	#kCacheB™sShiáAmouÁ
 5

	)

52 
	#kRoffMask
 0x18

	)

53 
	#kRoffShiáAmouÁ
 3

	)

55 
	#kR•Ïû_couÁMask
 0x07

	)

58 #ià((
kTy³Mask
 | 
kCacheL™”®B™sMask
 | 
kRoffMask
 | 
kR•Ïû_couÁMask
) != 255)

62 #ià((
kTy³Mask
 | 
kCacheB™sMask
 | 
kRoffMask
 | 
kR•Ïû_couÁMask
) != 255)

68 
	meL™”®
 = 0,

69 
	meRLE
 = 0x80

74 
	m“NewPix–
 = 0x0,

75 
	m“WPix–
 = 0x20,

76 
	m“NEPix–
 = 0x40,

77 
	m“CachedCŞÜ
 = 0x60

82 
	meNewCŞÜ
 = 0x0,

83 
	meWe¡CŞÜ
 = 0x1,

84 
	meNÜthEa¡CŞÜ
 = 0x2,

85 
	meCachedCŞÜ
 = 0x3

89 
	#M10_MAX_OFFSET0
 2

	)

90 
	#M10_MAX_COUNT0
 6

	)

91 
	#M10_COUNT_START0
 1

	)

94 
	#M10_MAX_OFFSET1
 2

	)

95 
	#M10_MAX_COUNT1
 6

	)

96 
	#M10_COUNT_START1
 2

	)

98 
	#g‘Pix–
 
g‘3Pix–


	)

99 
	#putPix–
 
put3Pix–


	)

100 
	#BYTES_PER_PIXEL
 3

	)

102 şas 
	cMode10
 : 
public
 
Com´essÜ


104 
public
:

105 
Mode10
 (
Ra¡”Size
);

106 
	mvœtu®
 ~
Mode10
 ();

109 
boŞ
 
Proûss
 (
RASTERDATA
 *
šput
);

110 
boŞ
 
NextOuutRa¡”
 (
RASTERDATA
& 
Ãxt_¿¡”
);

111 
Flush
 ();

113 
	m´iv©e
:

114 
šlše
 
ušt32_t
 
	$g‘4Pix–
 (*
pixAdd»ss
, 
boŞ
 
bPršt
 = 
çl£
)

116 ià(
m_eEndŸn
 =ğ
LITTLEENDIAN
)

117  (((*)
pixAdd»ss
)[0]è& 
kWh™e
;

119  (((*)
pixAdd»ss
)[0]) & 0xFFFFFF00;

123 
šlše
 
ušt32_t
 
	$g‘4Pix–
 (*
pixAdd»ss
, 
pix–Off£t
)

125 ià(
m_eEndŸn
 =ğ
LITTLEENDIAN
)

126  ((*)
pixAdd»ss
)[
pix–Off£t
] & 
kWh™e
;

128  ((*)
pixAdd»ss
)[
pix–Off£t
] & 0xFFFFFF00;

129 
	}
}

132 
šlše
 
	$put4Pix–
 (*
pixAdd»ss
, 
pix–Off£t
, 
ušt32_t
 
pix–
)

134 ià(
m_eEndŸn
 =ğ
LITTLEENDIAN
)

135 (((*)
pixAdd»ss
)[
pix–Off£t
] = 
pix–
 & 
kWh™e
);

137 (((*)
pixAdd»ss
)[
pix–Off£t
] = 
pix–
 & 0xFFFFFF00);

138 
	}
}

141 
šlše
 
	$ouutVLIBy‹sCÚ£cutiv–y
 (
numb”
, *&
com´es£dD©aPŒ
)

145 *
com´es£dD©aPŒ
++ = 
	`MIN
(
numb”
, 255);

146 ià(255 =ğ
numb”
)

148 *
com´es£dD©aPŒ
++ = 0;

150 
numb”
 -ğ
	`MIN
(number,255);

151 } 
numb”
);

152 
	}
}

155 
put3Pix–
 (
BYTE
* 
pixAdd»ss
, 
pix–Off£t
, 
ušt32_t
 
pix–
);

156 
šlše
 
ušt32_t
 
g‘3Pix–
 (
BYTE
* 
pixAdd»ss
, 
pix–Off£t
);

157 
ShÜtD–
 (
ušt32_t
 
Ï¡Pix–
, ušt32_ˆ
Ï¡Uµ”Pix–
);

158 
ENDIAN_TYPE
 
	gm_eEndŸn
;

	@prnt/hpcups/Mode2.cpp

31 
	~"CommÚDefš™iÚs.h
"

32 
	~"Com´essÜ.h
"

33 
	~"P–še.h
"

34 
	~"Mode2.h
"

36 
	gMode2
::
	$Mode2
 (
Ra¡”Size
)

37 : 
	$Com´essÜ
 (
Ra¡”Size
, 
çl£
)

39 
com´essBuf
 = (
BYTE
 *è
Ãw
 BYTE[
Ra¡”Size
];

40 ià(
com´essBuf
 =ğ
NULL
)

41 
cÚ¡ruùÜ_”rÜ
 = 
ALLOCMEM_ERROR
;

42 
	}
}

44 
	gMode2
::~
	$Mode2
()

45 { 
	}
}

47 
boŞ
 
Mode2
::
	$Proûss
 (
RASTERDATA
* 
šput
)

49 
BYTE
* 
pD¡
 = 
com´essBuf
;

50 
nd¡couÁ
 = 0;

52 ià(
šput
==
NULL
 ||

53 (
my¶ªe
 =ğ
COLORTYPE_COLOR
 && 
šput
->
¿¡”d©a
[COLORTYPE_COLOR] =ğ
NULL
) ||

54 (
my¶ªe
 =ğ
COLORTYPE_BLACK
 && 
šput
->
¿¡”d©a
[COLORTYPE_BLACK] =ğ
NULL
))

56 
com´es£dsize
=0;

58 
iRa¡”sR—dy
=0;

59  
çl£
;

62 
size
 = 
šput
->
¿¡”size
[
my¶ªe
];

64 
ni
 = 0;‚˜< 
size
;)

66 iàĞ
ni
 + 1 < 
size
 && 
šput
->
¿¡”d©a
[
my¶ªe
][‚i ] == input->rasterdata[myplane][‚i + 1 ] )

68 
Ä•—tcouÁ
;

69  
ni
 +ğ2, 
Ä•—tcouÁ
 = 1;‚˜< 
size
 &&‚repeatcount < 127; ++ni, ++nrepeatcount )

71 iàĞ
šput
->
¿¡”d©a
[
my¶ªe
][ 
ni
 ] != input->rasterdata[myplane][‚i - 1 ] )

76 
tm´•—t
 = 0 - 
Ä•—tcouÁ
;

77 
BYTE
 
Œunc
 = (BYTEè
tm´•—t
;

78 
pD¡
[ 
nd¡couÁ
++ ] = 
Œunc
;

79 
pD¡
[ 
nd¡couÁ
++ ] = 
šput
->
¿¡”d©a
[
my¶ªe
][ 
ni
 - 1 ];

83 
Æ™”®couÁ
;

84 
nfœ¡
 = 
ni
;

85  ++
ni
, 
Æ™”®couÁ
 = 0;‚˜< 
size
 &&‚literalcount < 127; ++ni, ++nliteralcount )

87 iàĞ
šput
->
¿¡”d©a
[
my¶ªe
][ 
ni
 ] == input->rasterdata[myplane][‚i - 1 ] )

89 --
ni
;

90 --
Æ™”®couÁ
;

94 
pD¡
[ 
nd¡couÁ
++ ] = (
BYTE
è
Æ™”®couÁ
;

95  
nj
 = 0;‚j <ğ
Æ™”®couÁ
; ++nj )

97 
pD¡
[ 
nd¡couÁ
++ ] = 
šput
->
¿¡”d©a
[
my¶ªe
][ 
nfœ¡
++ ];

102 
size
 = 
nd¡couÁ
;

103 
com´es£dsize
 = 
size
;

104 
iRa¡”sR—dy
 = 1;

105  
Œue
;

106 
	}
}

108 
boŞ
 
	gMode2
::
	$NextOuutRa¡”
(
RASTERDATA
& 
Ãxt_¿¡”
)

110 ià(
iRa¡”sR—dy
==0){

111  
çl£
;

113 ià(
my¶ªe
 =ğ
COLORTYPE_COLOR
 && 
com´es£dsize
 != 0)

115 
Ãxt_¿¡”
.
¿¡”size
[
COLORTYPE_COLOR
] = 
com´es£dsize
;

116 
Ãxt_¿¡”
.
¿¡”d©a
[
COLORTYPE_COLOR
] = 
com´essBuf
;

120 
Ãxt_¿¡”
.
¿¡”size
[
COLORTYPE_COLOR
] = 0;

121 
Ãxt_¿¡”
.
¿¡”d©a
[
COLORTYPE_COLOR
] = 
¿¡”
.rasterdata[COLORTYPE_COLOR];

124 ià(
my¶ªe
 =ğ
COLORTYPE_BLACK
 && 
com´es£dsize
 != 0)

126 
Ãxt_¿¡”
.
¿¡”size
[
COLORTYPE_BLACK
] = 
com´es£dsize
;

127 
Ãxt_¿¡”
.
¿¡”d©a
[
COLORTYPE_BLACK
] = 
com´essBuf
;

131 
Ãxt_¿¡”
.
¿¡”size
[
COLORTYPE_BLACK
] = 0;

132 
Ãxt_¿¡”
.
¿¡”d©a
[
COLORTYPE_BLACK
] = 
¿¡”
.rasterdata[COLORTYPE_BLACK];

135 
iRa¡”sR—dy
=0;

136  
Œue
;

137 
	}
}

	@prnt/hpcups/Mode2.h

31 #iâdeà
MODE2_H


32 
	#MODE2_H


	)

34 
	~"CommÚDefš™iÚs.h
"

35 
	~"ProûssÜ.h
"

36 
	~"Com´essÜ.h
"

38 şas 
	cMode2
 : 
public
 
Com´essÜ


40 
public
:

41 
Mode2
(
Ra¡”Size
);

42 
	mvœtu®
 ~
Mode2
();

43 
boŞ
 
Proûss
(
RASTERDATA
 *
šput
);

44 
boŞ
 
NextOuutRa¡”
(
RASTERDATA
& 
Ãxt_¿¡”
);

	@prnt/hpcups/Mode3.cpp

31 
	~"CommÚDefš™iÚs.h
"

32 
	~"Com´essÜ.h
"

33 
	~"P–še.h
"

34 
	~"Mode3.h
"

36 
	gMode3
::
	$Mode3
 (
Ra¡”Size
è: 
	$Com´essÜ
 (
Ra¡”Size
, 
Œue
)

41 
com´essBuf
 = 
Ãw
 
BYTE
[
Ra¡”Size
 + RasterSize/2];

42 ià(
com´essBuf
 =ğ
NULL
)

43 
cÚ¡ruùÜ_”rÜ
 = 
ALLOCMEM_ERROR
;

45 
	`mem£t
 (
S“dRow
, 0x0, 
šputsize
);

46 
	}
}

48 
	gMode3
::~
	$Mode3
 ()

50 
	}
}

52 
Mode3
::
	$Flush
 ()

54 ià(!
£eded
)

56 
com´es£dsize
 = 0;

57 
iRa¡”sR—dy
 = 0;

58 
£eded
 = 
çl£
;

59 
	`mem£t
 (
S“dRow
, 0x0, 
šputsize
);

60 
	}
}

62 
boŞ
 
	gMode3
::
	$Proûss
 (
RASTERDATA
 *
šput
)

64 ià(
šput
==
NULL
 ||

65 (
my¶ªe
 =ğ
COLORTYPE_COLOR
 && 
šput
->
¿¡”d©a
[COLORTYPE_COLOR] =ğ
NULL
) ||

66 (
my¶ªe
 =ğ
COLORTYPE_BLACK
 && 
šput
->
¿¡”d©a
[COLORTYPE_BLACK] =ğ
NULL
))

68 
	`Flush
();

69  
çl£
;

73 
£eded
 = 
Œue
;

76 
uOrgSize
 = 
šput
->
¿¡”size
[
my¶ªe
];

77 
size
 = 
šput
->
¿¡”size
[
my¶ªe
];

78 
uOff£t
;

80 
BYTE
 *
pszS±r
 = 
S“dRow
;

81 
BYTE
 *
pszInPŒ
 = 
šput
->
¿¡”d©a
[
my¶ªe
];

82 
BYTE
 *
pszCurPŒ
;

83 
BYTE
 
ucBy‹CouÁ
;

84 
BYTE
 *
pszOutPŒ
 = 
com´essBuf
;

86 
size
 > 0)

88 
uOff£t
 = 0;

90 ià(
£eded
)

92 (*
pszS±r
 =ğ*
pszInPŒ
è&& (
uOff£t
 < 
size
))

94 
pszS±r
++;

95 
pszInPŒ
++;

96 
uOff£t
++;

100 ià(
uOff£t
 >ğ
size
)

105 
size
 -ğ
uOff£t
;

107 
pszCurPŒ
 = 
pszInPŒ
;

108 
ucBy‹CouÁ
 = 1;

109 
pszS±r
++;

110 
pszInPŒ
++;

111 (*
pszS±r
 !ğ*
pszInPŒ
è&& 
ucBy‹CouÁ
 < 
size
 && ucByteCount < 8)

113 
pszS±r
++;

114 
pszInPŒ
++;

115 
ucBy‹CouÁ
++;

117 
ucBy‹CouÁ
--;

118 ià(
uOff£t
 < 31)

120 *
pszOutPŒ
++ = ((
ucBy‹CouÁ
 << 5è| 
uOff£t
);

124 
uOff£t
 -= 31;

125 *
pszOutPŒ
++ = ((
ucBy‹CouÁ
 << 5) | 31);

127 
uOff£t
 >= 255)

129 *
pszOutPŒ
++ = 255;

130 
uOff£t
 -= 255;

132 *
pszOutPŒ
++ = 
uOff£t
;

134 
ucBy‹CouÁ
++;

135 
size
 -ğ(
ucBy‹CouÁ
);

136 
	`memıy
 (
pszOutPŒ
, 
pszCurPŒ
, 
ucBy‹CouÁ
);

137 
pszOutPŒ
 +ğ
ucBy‹CouÁ
;

140 
com´es£dsize
 = 
pszOutPŒ
 - 
com´essBuf
;

141 
	`memıy
 (
S“dRow
, 
šput
->
¿¡”d©a
[
my¶ªe
], 
uOrgSize
);

142 
£eded
 = 
Œue
;

143 
iRa¡”sR—dy
 = 1;

144  
Œue
;

145 
	}
}

147 
boŞ
 
	gMode3
::
	$NextOuutRa¡”
 (
RASTERDATA
& 
Ãxt_¿¡”
)

149 ià(
iRa¡”sR—dy
 == 0)

151  
çl£
;

154 ià(
my¶ªe
 =ğ
COLORTYPE_COLOR
 && 
com´es£dsize
 != 0)

156 
Ãxt_¿¡”
.
¿¡”size
[
COLORTYPE_COLOR
] = 
com´es£dsize
;

157 
Ãxt_¿¡”
.
¿¡”d©a
[
COLORTYPE_COLOR
] = 
com´essBuf
;

161 
Ãxt_¿¡”
.
¿¡”size
[
COLORTYPE_COLOR
] = 0;

162 
Ãxt_¿¡”
.
¿¡”d©a
[
COLORTYPE_COLOR
] = 
¿¡”
.rasterdata[COLORTYPE_COLOR];

165 
Ãxt_¿¡”
.
¿¡”size
[
COLORTYPE_BLACK
] = 
¿¡”
.rastersize[COLORTYPE_BLACK];

166 
Ãxt_¿¡”
.
¿¡”d©a
[
COLORTYPE_BLACK
] = 
¿¡”
.rasterdata[COLORTYPE_BLACK];

168 
iRa¡”sR—dy
 = 0;

169  
Œue
;

170 
	}
}

	@prnt/hpcups/Mode3.h

31 #iâdeà
MODE3_H


32 
	#MODE3_H


	)

34 
	~"CommÚDefš™iÚs.h
"

35 
	~"ProûssÜ.h
"

36 
	~"Com´essÜ.h
"

38 şas 
	cMode3
 : 
public
 
Com´essÜ


40 
public
:

41 
Mode3
(
Ra¡”Size
);

42 
	mvœtu®
 ~
Mode3
();

43 
Flush
();

44 
boŞ
 
Proûss
(
RASTERDATA
 *
šput
);

45 
boŞ
 
NextOuutRa¡”
(
RASTERDATA
& 
Ãxt_¿¡”
);

	@prnt/hpcups/Mode9.cpp

31 
	~"Mode9.h
"

32 
	~"P–še.h
"

33 
	gMode9
::
	$Mode9
 (
Ra¡”Size
, 
boŞ
 
bPackedB™s
)

34 : 
	$Com´essÜ
(
Ra¡”Size
, 
Œue
)

36 ià(
cÚ¡ruùÜ_”rÜ
 !ğ
NO_ERROR
)

40 
com´essBuf
 = (
BYTE
*è
Ãw
 BYTE[
Ra¡”Size
 * 2];

41 ià(
com´essBuf
 =ğ
NULL
)

42 
cÚ¡ruùÜ_”rÜ
=
ALLOCMEM_ERROR
;

44 
	`mem£t
(
com´essBuf
, 0, 
Ra¡”Size
 * 2);

45 
	`mem£t
(
S“dRow
,0,
Ra¡”Size
);

47 
Re£tS“dRow
 = 
çl£
;

48 
m_bPackedB™s
 = 
bPackedB™s
;

49 
	}
}

51 
	gMode9
::~
	$Mode9
()

52 { 
	}
}

57 
comch¬
;

60 #ià
defšed
(
APDK_LITTLE_ENDIAN
è|| defšed(
LITTLE_ENDIAN_HW
)

61 
	m»¶aû_couÁ
:3;

62 
	mroff
:4;

63 
	mty³
:1;

65 
	mty³
:1;

66 
	mroff
:4;

67 
	m»¶aû_couÁ
:3;

69 } 
	mb™f0
;

72 #ià
defšed
(
APDK_LITTLE_ENDIAN
è|| defšed(
LITTLE_ENDIAN_HW
)

73 
	m»¶aû_couÁ
:5;

74 
	mroff
:2;

75 
	mty³
:1;

77 
	mty³
:1;

78 
	mroff
:2;

79 
	m»¶aû_couÁ
:5;

81 } 
	mb™f1
;

82 } 
	tMode9_comty³
;

84 #iâdeà
MIN


85 
	#MIN
(
a
,
b
è((×)>=(b))?(b):×))

	)

88 
	#kPCLMode9
 9

	)

90 
	#MAX_OFFSET0
 14

	)

91 
	#OFFSET_START0
 0

	)

92 
	#MAX_COUNT0
 6

	)

93 
	#COUNT_START0
 1

	)

95 
	#MAX_OFFSET1
 2

	)

96 
	#OFFSET_START1
 0

	)

97 
	#MAX_COUNT1
 30

	)

98 
	#COUNT_START1
 2

	)

103 
	gMode9
::
	$Flush
()

105 ià(!
£eded
)

108 
com´es£dsize
=0;

109 
iRa¡”sR—dy
=0;

110 
£eded
 = 
çl£
;

111 
	`mem£t
 (
S“dRow
, 0, 
šputsize
);

112 
	}
}

114 
boŞ
 
	gMode9
::
	$Proûss
(
RASTERDATA
* 
šput
)

119 ià(
šput
==
NULL
 ||

120 (
šput
->
¿¡”d©a
[
COLORTYPE_COLOR
]==
NULL
 && iÅut->¿¡”d©a[
COLORTYPE_BLACK
]==NULL))

122 
	`Flush
();

123  
çl£
;

126 
£eded
 = 
Œue
;

128 ià(!
Re£tS“dRow
 && 
šput
->
¿¡”d©a
[
my¶ªe
] == 0)

130 
com´es£dsize
=0;

131 
iRa¡”sR—dy
=1;

132  
Œue
;

135 
	`mem£t
(
com´essBuf
, 0, 
šputsize
 * 2);

137 
Üigš®size
=
šput
->
¿¡”size
[
my¶ªe
];

138 
size
=
šput
->
¿¡”size
[
my¶ªe
];

139 
Ïy”
;

142 ià(
my¶ªe
 =ğ
COLORTYPE_BLACK
)

144 ià(
šput
->
¿¡”d©a
[
my¶ªe
] == 0)

146 
	`mem£t
(
Üigš®KD©a
, 0, 
šputsize
+1);

147 
size
 = 
Üigš®size
 = 
šputsize
;

151 
size
 = 
Üigš®size
 = (
šput
->
¿¡”size
[
my¶ªe
]+7)/8;

152 
	`mem£t
(
Üigš®KD©a
, 0, 
size
);

154 
	`memıy
(
Üigš®KD©a
, 
šput
->
¿¡”d©a
[
my¶ªe
], 
size
);

155 ià(!
m_bPackedB™s
)

157 
curB™
 = 0x80, 
curBy‹
 = 0;

158 
i
=0; i<
šput
->
¿¡”size
[
my¶ªe
]; i++)

160 ià(
šput
->
¿¡”d©a
[
my¶ªe
][
i
])

162 
Üigš®KD©a
[
curBy‹
] |ğ
curB™
;

164 ià(
curB™
 == 0x01)

166 
curBy‹
++;

167 
curB™
 = 0x80;

171 
curB™
 = curBit >> 1;

175 
Re£tS“dRow
 = 
Œue
;

178 ià((
mypha£
è&& (mypha£->
´ev
))

180 
Ïy”
 = 
mypha£
->
´ev
->
Exec
->
iRa¡”sD–iv”ed
;

182 
Ïy”
 = 1;

184 ià(
my¶ªe
 =ğ
COLORTYPE_BLACK
)

186 
Ïy”
 = 1;

189 
Ïy”
--;

190 *
¥Œ
 = (*)(&
S“dRow
[
size
*
Ïy”
]);

192 
BYTE
 *
ÅŒ
;

193 ià(
my¶ªe
 =ğ
COLORTYPE_BLACK
)

195 
ÅŒ
 = 
Üigš®KD©a
;

199 
ÅŒ
 = 
šput
->
¿¡”d©a
[
my¶ªe
];

201 
BYTE
 *
‹mpPŒ
;

202 
Ï¡_by‹
;

203 
off£t
,
by‹_couÁ
,
»m_couÁ
;

204 
Mode9_comty³
 
commªd
;

205 * 
de¡
ğ(*è
com´essBuf
;

206 *
d±r
=
de¡
;

208  
size
 > 0 )

210 
off£t
 = 0;

212 ià(
£eded
)

215 (
off£t
 < 
size
è&& (*
¥Œ
++ =ğ*
ÅŒ
++))

217 
off£t
++;

219 
¥Œ
--;

220 
ÅŒ
--;

223 iàĞ
off£t
 >ğ
size
 )

224 
ba
;

226 
size
 -ğ
off£t
;

228 ià((*
ÅŒ
 !ğÅŒ[1]è|| (
size
 < 2))

230 
commªd
.
b™f0
.
ty³
 = 0;

231 
Ï¡_by‹
 = *
ÅŒ
++;

232 
¥Œ
++;

233 
by‹_couÁ
 = 1;

243 (*
¥Œ
++ !ğ*
ÅŒ
è&& (
Ï¡_by‹
 !ğ*ÅŒè&& (
by‹_couÁ
 < 
size
))

245 
by‹_couÁ
++;

246 
Ï¡_by‹
 = *
ÅŒ
++;

248 
¥Œ
--;

252 ià((
by‹_couÁ
 < 
size
è&& (
Ï¡_by‹
 =ğ()*
ÅŒ
))

254 
ÅŒ
--;

255 
¥Œ
--;

256 
by‹_couÁ
--;

259 
size
 -ğ
by‹_couÁ
;

264 ià(
off£t
 > (
MAX_OFFSET0
+
OFFSET_START0
))

265 
commªd
.
b™f0
.
roff
 = 
MAX_OFFSET0
+1;

267 
commªd
.
b™f0
.
roff
 = 
off£t
-
OFFSET_START0
;

269 ià(
by‹_couÁ
 > (
MAX_COUNT0
+
COUNT_START0
))

270 
commªd
.
b™f0
.
»¶aû_couÁ
 = 
MAX_COUNT0
+1;

272 
commªd
.
b™f0
.
»¶aû_couÁ
 = 
by‹_couÁ
-
COUNT_START0
;

274 *
d±r
++ = 
commªd
.
comch¬
;

276 ià(
off£t
 > (
MAX_OFFSET0
+
OFFSET_START0
))

278 
off£t
 -ğ(
MAX_OFFSET0
+
OFFSET_START0
+1);

279 ià(
off£t
 == 0)

281 *
d±r
++ = 0;

285  
off£t
 )

287 *
d±r
++ = 
	`MIN
 ( 
off£t
, 255 );

289 iàĞ
off£t
 == 255 )

290 *
d±r
++ = 0;

292 
off£t
 -ğ
	`MIN
 ( offset, 255 );

297 ià(
by‹_couÁ
 > (
MAX_COUNT0
+
COUNT_START0
))

299 
»m_couÁ
 = 
by‹_couÁ
 - (
MAX_COUNT0
+
COUNT_START0
+1);

300 ià(
»m_couÁ
 == 0)

301 *
d±r
++ = 0;

304  
»m_couÁ
 )

306 *
d±r
++ = 
	`MIN
 ( 
»m_couÁ
, 255 );

308 iàĞ
»m_couÁ
 == 255 )

309 *
d±r
++ = 0;

311 
»m_couÁ
 -ğ
	`MIN
 („em_count, 255 );

318 
‹mpPŒ
 = 
ÅŒ
 - 
by‹_couÁ
;

319 ;
by‹_couÁ
;byte_count--)

321 *
d±r
++ = *
‹mpPŒ
++;

327 
commªd
.
b™f1
.
ty³
 = 1;

328 
ÅŒ
++;

329 
Ï¡_by‹
 = *
ÅŒ
++;

330 
by‹_couÁ
 = 2;

332 (
Ï¡_by‹
 =ğ*
ÅŒ
++è&& (
by‹_couÁ
 < 
size
))

334 
by‹_couÁ
++;

336 
ÅŒ
--;

337 
¥Œ
 +ğ
by‹_couÁ
;

338 
size
 -ğ
by‹_couÁ
;

340 ià(
off£t
 > (
MAX_OFFSET1
+
OFFSET_START1
))

341 
commªd
.
b™f1
.
roff
 = 
MAX_OFFSET1
+1;

343 
commªd
.
b™f1
.
roff
 = 
off£t
-
OFFSET_START1
;

345 ià(
by‹_couÁ
 > (
MAX_COUNT1
+
COUNT_START1
))

346 
commªd
.
b™f1
.
»¶aû_couÁ
 = 
MAX_COUNT1
+1;

348 
commªd
.
b™f1
.
»¶aû_couÁ
 = 
by‹_couÁ
-
COUNT_START1
;

350 *
d±r
++ = 
commªd
.
comch¬
;

352 ià(
off£t
 > (
MAX_OFFSET1
+
OFFSET_START1
))

354 
off£t
 -ğ(
MAX_OFFSET1
+
OFFSET_START1
+1);

355 ià(
off£t
 == 0)

357 *
d±r
++ = 0;

361  
off£t
 )

363 *
d±r
++ = 
	`MIN
 ( 
off£t
, 255 );

365 iàĞ
off£t
 == 255 )

366 *
d±r
++ = 0;

368 
off£t
 -ğ
	`MIN
 ( offset, 255 );

373 ià(
by‹_couÁ
 > (
MAX_COUNT1
+
COUNT_START1
))

375 
»m_couÁ
 = 
by‹_couÁ
 - (
MAX_COUNT1
+
COUNT_START1
+1);

376 ià(
»m_couÁ
 == 0)

377 *
d±r
++ = 0;

380  
»m_couÁ
 )

382 *
d±r
++ = 
	`MIN
 ( 
»m_couÁ
, 255 );

384 iàĞ
»m_couÁ
 == 255 )

385 *
d±r
++ = 0;

387 
»m_couÁ
 -ğ
	`MIN
 („em_count, 255 );

392 *
d±r
++ = 
Ï¡_by‹
;

396 
ba
:

397 
size
 = 
¡©ic_ÿ¡
<>((
d±r
 - 
de¡
));

398 
com´es£dsize
 = 
size
;

399 ià(
my¶ªe
 =ğ
COLORTYPE_BLACK
)

401 
	`memıy
(&(
S“dRow
[
Ïy”
*
Üigš®size
]), 
Üigš®KD©a
, originalsize);

405 
	`memıy
(&(
S“dRow
[
Ïy”
*
Üigš®size
]), 
šput
->
¿¡”d©a
[
my¶ªe
], originalsize);

407 
£eded
 = 
Œue
;

408 
iRa¡”sR—dy
=1;

410  
Œue
;

411 
	}
}

413 
boŞ
 
	gMode9
::
	$NextOuutRa¡”
(
RASTERDATA
& 
Ãxt_¿¡”
)

416 ià(
iRa¡”sR—dy
==0){

417  
çl£
;

419 
iRa¡”sR—dy
=0;

420 ià(
my¶ªe
 =ğ
COLORTYPE_BLACK
)

422 ià(
com´es£dsize
 != 0)

424 
Ãxt_¿¡”
.
¿¡”size
[
COLORTYPE_BLACK
] = 
com´es£dsize
;

425 
Ãxt_¿¡”
.
¿¡”d©a
[
COLORTYPE_BLACK
] = 
com´essBuf
;

429 
Ãxt_¿¡”
.
¿¡”size
[
COLORTYPE_BLACK
] = 0;

430 
Ãxt_¿¡”
.
¿¡”d©a
[
COLORTYPE_BLACK
] = 
¿¡”
.rasterdata[COLORTYPE_BLACK];

432 
Ãxt_¿¡”
.
¿¡”size
[
COLORTYPE_COLOR
] = 
¿¡”
.rastersize[COLORTYPE_COLOR];

433 
Ãxt_¿¡”
.
¿¡”d©a
[
COLORTYPE_COLOR
] = 
¿¡”
.rasterdata[COLORTYPE_COLOR];

434  
Œue
;

437 ià(
my¶ªe
 =ğ
COLORTYPE_COLOR
)

439 ià(
com´es£dsize
 != 0)

441 
Ãxt_¿¡”
.
¿¡”size
[
COLORTYPE_COLOR
] = 
com´es£dsize
;

442 
Ãxt_¿¡”
.
¿¡”d©a
[
COLORTYPE_COLOR
] = 
com´essBuf
;

446 
Ãxt_¿¡”
.
¿¡”size
[
COLORTYPE_COLOR
] = 0;

447 
Ãxt_¿¡”
.
¿¡”d©a
[
COLORTYPE_COLOR
] = 
¿¡”
.rasterdata[COLORTYPE_COLOR];

449 
Ãxt_¿¡”
.
¿¡”size
[
COLORTYPE_BLACK
] = 
¿¡”
.rastersize[COLORTYPE_BLACK];

450 
Ãxt_¿¡”
.
¿¡”d©a
[
COLORTYPE_BLACK
] = 
¿¡”
.rasterdata[COLORTYPE_BLACK];

453  
Œue
;

454 
	}
}

	@prnt/hpcups/Mode9.h

31 #iâdeà
MODE9_H


32 
	#MODE9_H


	)

34 
	~"CommÚDefš™iÚs.h
"

35 
	~"ProûssÜ.h
"

36 
	~"Com´essÜ.h
"

38 şas 
	cMode9
 : 
public
 
Com´essÜ


40 
public
:

41 
Mode9
(
Ra¡”Size
, 
boŞ
 
bPackedB™s
 = 
Œue
);

42 
	mvœtu®
 ~
Mode9
();

43 
boŞ
 
Proûss
(
RASTERDATA
* 
šput
);

44 
boŞ
 
NextOuutRa¡”
 (
RASTERDATA
& 
Ãxt_¿¡”
);

45 
Flush
();

46 
boŞ
 
	mRe£tS“dRow
;

47 
boŞ
 
	mm_bPackedB™s
;

	@prnt/hpcups/ModeDeltaPlus.cpp

31 
	~"ModeD–Plus.h
"

33 
	gModeD–Plus
::
ModeD–Plus


35 
PÏÃSize


37 
Com´essÜ
(
PÏÃSize
, 
Œue
),

38 
pbyIÅutImageBufãr
 (
NULL
),

39 
pbyS“dRow
 (
NULL
),

40 
	$m_bLa¡Bªd
(
çl£
)

42 
šputsize
 = 
PÏÃSize
;

43 
šputsize
 = ((inputsize + 7) / 8) * 8;

44 
m_lCu¼CDRa¡”Row
 = 0;

45 
m_lPrš‹rRa¡”Row
 = 0;

46 
iRa¡”sR—dy
 = 0;

47 
m_bCom´es£d
 = 
çl£
;

48 
m_com´es£dsize
 = 0;

49 
m_fR©io
 = 0;

50 
	}
}

52 
DRIVER_ERROR
 
	gModeD–Plus
::
	$In™
()

55 
com´essBuf
 = 
Ãw
 
BYTE
[2 * 
INDY_STRIP_HEIGHT
 * 
šputsize
];

56 ià(
com´essBuf
 =ğ
NULL
)

58  
ALLOCMEM_ERROR
;

60 
	`mem£t
 (
com´essBuf
, 0x00, 2 * 
INDY_STRIP_HEIGHT
 * 
šputsize
);

62 
pbyIÅutImageBufãr
 = 
Ãw
 
BYTE
[
INDY_STRIP_HEIGHT
 * 
šputsize
];

63 ià(
pbyIÅutImageBufãr
 =ğ
NULL
)

64  
ALLOCMEM_ERROR
;

65 
	`mem£t
(
pbyIÅutImageBufãr
, 0x00, 
INDY_STRIP_HEIGHT
 * 
šputsize
);

67 
pbyS“dRow
 = 
Ãw
 
BYTE
[
šputsize
];

68 ià(
pbyS“dRow
 =ğ
NULL
)

70  
ALLOCMEM_ERROR
;

72 
	`mem£t
 (
pbyS“dRow
, 0, 
šputsize
 *  (
BYTE
));

73  
NO_ERROR
;

74 
	}
}

76 
	gModeD–Plus
::~
	$ModeD–Plus
 ()

78 ià(
pbyIÅutImageBufãr
)

80 
d–‘e
 [] 
pbyIÅutImageBufãr
;

81 
pbyIÅutImageBufãr
 = 
NULL
;

83 ià(
pbyS“dRow
)

85 
d–‘e
 [] 
pbyS“dRow
;

86 
pbyS“dRow
 = 
NULL
;

89 
	}
}

95 
	#ROW_LIMIT
 7040

	)

106 
	#LITERAL_LIMIT
 511

	)

109 
	#LTEST_W
 
cŞ
 > 0

	)

110 
	#LVAL_W
(
cŞ
è
cur_row
[cŞ-1]

	)

111 
	#LTEST_NW
 
cŞ
 > 0

	)

112 
	#LVAL_NW
(
cŞ
è
£edrow
[cŞ-1]

	)

113 
	#LTEST_WW
 
cŞ
 > 1

	)

114 
	#LVAL_WW
(
cŞ
è
cur_row
[cŞ-2]

	)

115 
	#LTEST_NWW
 
cŞ
 > 1

	)

116 
	#LVAL_NWW
(
cŞ
è
£edrow
[cŞ-2]

	)

117 
	#LTEST_NE
 (
cŞ
+1è< 
row_width


	)

118 
	#LVAL_NE
(
cŞ
è
£edrow
[cŞ+1]

	)

119 
	#LTEST_NEWCOL
 1

	)

120 
	#LVAL_NEWCOL
(
cŞ
è
Ãw_cŞÜ


	)

121 
	#LTEST_CACHE
 1

	)

122 
	#LVAL_CACHE
(
cŞ
è
ÿche


	)

124 
	#LOC1TEST
 
LTEST_NE


	)

125 
	#LOC1VAL
(
cŞ
è
	`LVAL_NE
(cŞ)

	)

126 
	#LOC2TEST
 
LTEST_NW


	)

127 
	#LOC2VAL
(
cŞ
è
	`LVAL_NW
(cŞ)

	)

128 
	#LOC3TEST
 
LTEST_NEWCOL


	)

129 
	#LOC3VAL
(
cŞ
è
	`LVAL_NEWCOL
(cŞ)

	)

131 
	#check
(
cÚd™iÚ
èià(!(cÚd™iÚ)è 0

	)

133 
	#wr™e_comp_by‹
(
v®
) \

134 
	`check
(
ouŒ
 < 
·¡outmem
); \

135 *
ouŒ
++ = (
BYTE
è
v®
;

	)

137 
	#»ad_by‹
(
v®
) \

138 
	`check
(
šmem
 < 
·¡šmem
); \

139 
v®
 = *
šmem
++;

	)

141 
	#’code_couÁ
(
couÁ
, 
ov”
, 
mem
) \

142 ià(
couÁ
 >ğ
ov”
) \

144 
couÁ
 -ğ
ov”
; \

145 ià(
couÁ
 <ğ(
ušt32_t
) 253) \

147 
	`check
(
mem
 < 
·¡outmem
); \

148 *
mem
++ = (
BYTE
è
couÁ
; \

150 ià(
couÁ
 <ğ(
ušt32_t
) (254 + 255) ) \

152 
	`check
((
mem
+1è< 
·¡outmem
); \

153 
	`check
Ğ
couÁ
 >= 254 ); \

154 
	`check
Ğ(
couÁ
 - 254) <= 255 ); \

155 *
mem
++ = (
BYTE
) 0xFE; \

156 *
mem
++ = (
BYTE
è(
couÁ
 - 254); \

160 
	`check
((
mem
+2è< 
·¡outmem
); \

161 
	`check
Ğ
couÁ
 >= 255 ); \

162 
	`check
Ğ(
couÁ
 - 255) <= 65535 ); \

163 
couÁ
 -= 255; \

164 *
mem
++ = (
BYTE
) 0xFF; \

165 *
mem
++ = (
BYTE
è(
couÁ
 >> 8); \

166 *
mem
++ = (
BYTE
è(
couÁ
 & 0xFF); \

168 }

	)

169 
	#decode_couÁ
(
couÁ
, 
ov”
) \

170 ià(
couÁ
 >ğ
ov”
) \

172 
	`»ad_by‹
(
šv®
); \

173 
couÁ
 +ğ(
ušt32_t
è
šv®
; \

174 ià(
šv®
 =ğ(
BYTE
) 0xFE) \

176 
	`»ad_by‹
(
šv®
); \

177 
couÁ
 +ğ(
ušt32_t
è
šv®
; \

179 ià(
šv®
 =ğ(
BYTE
) 0xFF) \

181 
	`»ad_by‹
(
šv®
); \

182 
couÁ
 +ğ(((
ušt32_t
è
šv®
) << 8); \

183 
	`»ad_by‹
(
šv®
); \

184 
couÁ
 +ğ(
ušt32_t
è
šv®
; \

186 }

	)

188 
	#by‹s_fÜ_couÁ
(
couÁ
, 
ov”
) \

189 Ğ(
couÁ
 >ğ255è? 3 : (couÁ >ğ
ov”
è? 1 : 0 )

	)

193 
	#memut_th»sh
 15

	)

195 
BYTE
* 
	gModeD–Plus
::
	$’code_h—d”
(
BYTE
* 
ouŒ
, cÚ¡ BYTE* 
·¡outmem
, 
ušt32_t
 
i¤un
, ušt32_ˆ
loÿtiÚ
, ušt32_ˆ
£edrow_couÁ
, ušt32_ˆ
run_couÁ
, cÚ¡ BYTE 
Ãw_cŞÜ
)

197 
ušt32_t
 
by‹
;

199 
	`check
 (
loÿtiÚ
 < 4);

200 
	`check
Ğ(
i¤un
 == 0) || (isrun == 1) );

203 
by‹
 = (
i¤un
 << 7è| (
loÿtiÚ
 << 5);

206 ià(
£edrow_couÁ
 > 2)

207 
by‹
 |= (0x03 << 3);

209 
by‹
 |ğ(
£edrow_couÁ
 << 3);

211 ià(
run_couÁ
 > 6)

212 
by‹
 |= 0x07;

214 
by‹
 |ğ
run_couÁ
;

217 
	`wr™e_comp_by‹
(
by‹
);

220 
	`’code_couÁ
Ğ
£edrow_couÁ
, 3, 
ouŒ
 );

223 ià(
loÿtiÚ
 == 0)

225 
	`wr™e_comp_by‹
Ğ
Ãw_cŞÜ
 );

229 
	`’code_couÁ
Ğ
run_couÁ
, 7, 
ouŒ
 );

231  
ouŒ
;

232 
	}
}

237 
boŞ
 
	gModeD–Plus
::
	$com´ess
 (
BYTE
 *
outmem
,

238 
ušt32_t
 *
ou’
,

239 cÚ¡ 
BYTE
 *
šmem
,

240 cÚ¡ 
ušt32_t
 
row_width
,

241 cÚ¡ 
ušt32_t
 
šheight
,

242 
ušt32_t
 
hÜz_ht_di¡
)

244 
BYTE
 *
ouŒ
 = 
outmem
;

245 
ušt32_t
 
cŞ
;

246 cÚ¡ 
BYTE
 *
£edrow
;

247 
ušt32_t
 
£edrow_couÁ
 = 0;

248 
ušt32_t
 
loÿtiÚ
 = 0;

249 
BYTE
 
Ãw_cŞÜ
 = (BYTE) 0xFF;

250 cÚ¡ 
BYTE
 *
cur_row
;

251 
ušt32_t
 
row
;

252 cÚ¡ 
BYTE
 *
·¡outmem
 = 
outmem
 + *
ou’
;

253 
ušt32_t
 
do_wÜd_cİ›s
;

255 ià(
hÜz_ht_di¡
 > 32)

257  
çl£
;

259 ià(
hÜz_ht_di¡
 < 1)

261 
hÜz_ht_di¡
 = 1;

264 
£edrow
 = 
pbyS“dRow
;

265 
do_wÜd_cİ›s
 = ((
row_width
 % 4) == 0);

267 
row
 = 0;„ow < 
šheight
;„ow++)

269 
cur_row
 = 
šmem
 + (
row
 * 
row_width
);

271 
cŞ
 = 0;

272 
cŞ
 < 
row_width
)

275 
£edrow_couÁ
 = 0;

276 ià(
do_wÜd_cİ›s
)

279 ((
cŞ
 & 3) != 0) &&

280 (
cŞ
 < 
row_width
) &&

281 (
cur_row
[
cŞ
] =ğ
£edrow
[col]))

283 
£edrow_couÁ
++;

284 
cŞ
++;

286 iàĞ(
cŞ
 & 3) == 0)

288 ((
cŞ
+3è< 
row_width
) &&

289 *((cÚ¡ 
ušt32_t
*è(
cur_row
 + 
cŞ
)è=ğ*((cÚ¡ ušt32_t*è(
£edrow
 + col)))

291 
£edrow_couÁ
 += 4;

292 
cŞ
 += 4;

296 (
cŞ
 < 
row_width
è&& (
cur_row
[cŞ] =ğ
£edrow
[col]))

298 
£edrow_couÁ
++;

299 
cŞ
++;

303 ià(
cŞ
 =ğ
row_width
)

306 
ouŒ
 = 
	`’code_h—d”
(ouŒ, 
·¡outmem
, 1 , 1 , 
£edrow_couÁ
, 0 , (
BYTE
) 0 );

310 
	`check
(
cŞ
 < 
row_width
);

313 iàĞ(
LOC1TEST
è&& (
cur_row
[
cŞ
] =ğ
	`LOC1VAL
(col)) )

314 
loÿtiÚ
 = 1;

315 iàĞ(
LOC2TEST
è&& (
cur_row
[
cŞ
] =ğ
	`LOC2VAL
(col)) )

316 
loÿtiÚ
 = 2;

317 iàĞ(
LOC3TEST
è&& (
cur_row
[
cŞ
] =ğ
	`LOC3VAL
(col)) )

318 
loÿtiÚ
 = 3;

321 
loÿtiÚ
 = 0;

322 
Ãw_cŞÜ
 = 
cur_row
[
cŞ
];

328 ((
cŞ
+1è< 
row_width
)

330 ((
cŞ
+1è>ğ
hÜz_ht_di¡
)

332 (
cur_row
[
cŞ
+1-
hÜz_ht_di¡
] == cur_row[col+1])

336 
ušt32_t
 
run_couÁ
 = 0;

337 
cŞ
++;

338  ((
cŞ
+1è< 
row_width
è&& (
cur_row
[cŞ+1-
hÜz_ht_di¡
] == cur_row[col+1]) )

340 
run_couÁ
++;

341 
cŞ
++;

343 
cŞ
++;

344 
ouŒ
 = 
	`’code_h—d”
(ouŒ, 
·¡outmem
, 1 , 
loÿtiÚ
, 
£edrow_couÁ
, 
run_couÁ
, 
Ãw_cŞÜ
);

351 
ušt32_t
 
»¶aûm’t_couÁ
 = 0;

352 cÚ¡ 
BYTE
* 
by‹_¬¿y
 = 
cur_row
 + 
cŞ
 + 1;

353 
ušt32_t
 
i
;

354 
cŞ
++;

360  (
cŞ
+1è< 
row_width
 )

371 (
cur_row
[
cŞ
] =ğ
£edrow
[col])

376 (
cur_row
[
cŞ
+1] =ğ
£edrow
[col+1])

381 (
cur_row
[
cŞ
+1] =ğ
	`LVAL_NW
(col+1))

383 (
cur_row
[
cŞ
+1] =ğ
	`LVAL_NEWCOL
(col+1))

387 ((
cŞ
+2è< 
row_width
)

392 ((
cŞ
 + 2è>ğ
hÜz_ht_di¡
) &&

393 (
cur_row
[
cŞ
+2-
hÜz_ht_di¡
] == cur_row[col+2])

397 (
cur_row
[
cŞ
+1] =ğ
	`LVAL_NE
(col+1))

405 (
cur_row
[
cŞ
] !ğ
£edrow
[col])

407 ((
cŞ
 + 1è>ğ
hÜz_ht_di¡
)

409 (
cur_row
[
cŞ
+1-
hÜz_ht_di¡
] == cur_row[col+1])

414 ((
cŞ
+2è< 
row_width
)

416 ((
cŞ
 + 2è>ğ
hÜz_ht_di¡
)

418 (
cur_row
[
cŞ
+2-
hÜz_ht_di¡
] == cur_row[col+2])

422 (
cur_row
[
cŞ
] =ğ
	`LVAL_NE
(col))

424 (
cur_row
[
cŞ
] =ğ
	`LVAL_NW
(col))

426 (
cur_row
[
cŞ
] =ğ
	`LVAL_NEWCOL
(col))

433 ià(
»¶aûm’t_couÁ
 >ğ
LITERAL_LIMIT
)

437 
»¶aûm’t_couÁ
++;

438 
cŞ
++;

442 iàĞ(
cŞ
+1è=ğ
row_width
 ) {

443 
»¶aûm’t_couÁ
++;

444 
cŞ
++;

447 
ouŒ
 = 
	`’code_h—d”
(ouŒ, 
·¡outmem
, 0 , 
loÿtiÚ
, 
£edrow_couÁ
, 
»¶aûm’t_couÁ
, 
Ãw_cŞÜ
);

459 ià(
»¶aûm’t_couÁ
 > 0)

462 ià(
»¶aûm’t_couÁ
 > 
memut_th»sh
)

464 
	`check
Ğ(
ouŒ
 + 
»¶aûm’t_couÁ
è<ğ
·¡outmem
 );

465 
	`memıy
(
ouŒ
, 
by‹_¬¿y
, (
size_t
è
»¶aûm’t_couÁ
);

466 
ouŒ
 +ğ
»¶aûm’t_couÁ
;

470 
i
 = 0; i < 
»¶aûm’t_couÁ
; i++)

472 
	`wr™e_comp_by‹
Ğ
by‹_¬¿y
[
i
] );

481 
£edrow
 = 
cur_row
;

485 
	`check
Ğ
ouŒ
 <ğ
·¡outmem
 );

486 ià(
ouŒ
 > 
·¡outmem
)

489 *
ou’
 = 0;

493 *
ou’
 = (
ušt32_t
è(
ouŒ
 - 
outmem
);

496 
	}
}

499 
boŞ
 
	gModeD–Plus
::
Proûss


501 
RASTERDATA
* 
šput


504 ià(
šput
==
NULL
 ||

505 (
šput
->
¿¡”d©a
[
COLORTYPE_COLOR
]==
NULL
 && iÅut->¿¡”d©a[
COLORTYPE_BLACK
]==NULL))

507  
çl£
;

509 ià(
	gšput
->
	g¿¡”d©a
[
COLORTYPE_COLOR
])

511 ià(
	gm_lCu¼CDRa¡”Row
 < 
	gINDY_STRIP_HEIGHT
 )

514 
memıy
(
pbyIÅutImageBufãr
 + 
m_lCu¼CDRa¡”Row
 * 
šputsize
, 
šput
->
¿¡”d©a
[
COLORTYPE_COLOR
], iÅut->
¿¡”size
[COLORTYPE_COLOR]);

515 
	gm_lCu¼CDRa¡”Row
 ++;

517 ià(
	gm_lCu¼CDRa¡”Row
 =ğ
INDY_STRIP_HEIGHT
 || 
m_bLa¡Bªd
)

519 
m_com´es£dsize
 = 2 * 
šputsize
 * 
INDY_STRIP_HEIGHT
;

520 
boŞ
 
	gbR‘
 = 
com´ess
 (
com´essBuf
,

521 &
m_com´es£dsize
,

522 
pbyIÅutImageBufãr
,

523 
šputsize
,

524 
m_lCu¼CDRa¡”Row
,

527 ià(!
	gbR‘
)

529 
memıy
 (
com´essBuf
, 
pbyIÅutImageBufãr
, 
šputsize
 * 
INDY_STRIP_HEIGHT
);

530 
	gm_com´es£dsize
 = 
šputsize
 * 
INDY_STRIP_HEIGHT
;

534 
	gm_bCom´es£d
 = 
Œue
;

537 
mem£t
(
pbyIÅutImageBufãr
, 0x00, 
šputsize
 * 
INDY_STRIP_HEIGHT
);

539 
	gm_lPrš‹rRa¡”Row
 +ğ
m_lCu¼CDRa¡”Row
;

540 
	gm_lCu¼BlockHeight
 = 
m_lCu¼CDRa¡”Row
;

541 
	gm_lCu¼CDRa¡”Row
 = 0;

542 
	giRa¡”sR—dy
 = 1;

543 
	gm_bLa¡Bªd
 = 
çl£
;

547  
	gçl£
;

550  
	gŒue
;

553 
boŞ
 
	gModeD–Plus
::
	$NextOuutRa¡”
(
RASTERDATA
 &
Ãxt_¿¡”
)

555 ià(
iRa¡”sR—dy
==0)

556  
çl£
;

558 
Ãxt_¿¡”
.
¿¡”size
[
COLORTYPE_COLOR
] = 
m_com´es£dsize
;

559 ià(
m_com´es£dsize
 > 0)

561 
Ãxt_¿¡”
.
¿¡”d©a
[
COLORTYPE_COLOR
] = 
com´essBuf
;

563 
Ãxt_¿¡”
.
¿¡”size
[
COLORTYPE_BLACK
] = 0;

564 
Ãxt_¿¡”
.
¿¡”d©a
[
COLORTYPE_BLACK
] = 
NULL
;

565 
iRa¡”sR—dy
=0;

566  
Œue
;

567 
	}
}

	@prnt/hpcups/ModeDeltaPlus.h

31 #iâdeà
MODE_DELTAPLUS_H


32 
	#MODE_DELTAPLUS_H


	)

34 
	~"CommÚDefš™iÚs.h
"

35 
	~"ProûssÜ.h
"

36 
	~"Com´essÜ.h
"

38 
	#INDY_STRIP_HEIGHT
 128

	)

40 şas 
	cModeD–Plus
 : 
public
 
Com´essÜ


42 
public
:

43 
ModeD–Plus
(
Ra¡”Size
);

44 
	mvœtu®
 ~
ModeD–Plus
();

45 
DRIVER_ERROR
 
In™
();

46 
boŞ
 
Proûss
(
RASTERDATA
 *
šput
);

47 
boŞ
 
NextOuutRa¡”
(
RASTERDATA
 &
Ãxt_¿¡”
);

48 
boŞ
 
	$IsCom´es£d
()

50  
m_bCom´es£d
;

52 
BYTE
 
	$G‘FR©io
()

54  (
BYTE
è(
m_fR©io
 + 0.5);

55 
	}
}

56 
	$G‘Cu¼’tRa¡”Row
()

58  
m_lPrš‹rRa¡”Row
;

59 
	}
}

60 
	$G‘Cu¼’tBlockHeight
()

62  
m_lCu¼BlockHeight
;

63 
	}
}

64 
	$NewPage
()

66 
m_lPrš‹rRa¡”Row
 = 0;

67 
m_bLa¡Bªd
 = 
çl£
;

68 
	}
}

69 
	$S‘La¡Bªd
()

71 
m_bLa¡Bªd
 = 
Œue
;

72 
	}
}

74 
	g´iv©e
:

75 
boŞ
 
com´ess
(
BYTE
 *
outmem
, 
ušt32_t
 *
ou’
, cÚ¡ BYTE *
šmem
,

76 cÚ¡ 
ušt32_t
 
row_width
, cÚ¡ ušt32_ˆ
šheight
,

77 
ušt32_t
 
hÜz_ht_di¡
);

79 
BYTE
 *
’code_h—d”
(BYTE *
ouŒ
, cÚ¡ BYTE *
·¡outmem
, 
ušt32_t
 
i¤un
,

80 
ušt32_t
 
loÿtiÚ
, ušt32_ˆ
£edrow_couÁ
, ušt32_ˆ
run_couÁ
,

81 cÚ¡ 
BYTE
 
Ãw_cŞÜ
);

83 
BYTE
 *
	gpbyIÅutImageBufãr
;

85 
	gm_lCu¼CDRa¡”Row
;

86 
	gm_lCu¼BlockHeight
;

87 
	gm_lPrš‹rRa¡”Row
;

89 
ušt32_t
 
	gm_com´es£dsize
;

90 
boŞ
 
	gm_bCom´es£d
;

91 
	gm_fR©io
;

92 
BYTE
 *
	gpbyS“dRow
;

93 
boŞ
 
	gm_bLa¡Bªd
;

	@prnt/hpcups/ModeJbig.cpp

33 
	~"CommÚDefš™iÚs.h
"

34 
	~"Com´essÜ.h
"

35 
	~"P–še.h
"

36 
	~"ModeJbig.h
"

37 
	~"hpjbig_w¿µ”.h
"

38 
	~<dlfú.h
>

39 
	~"Uts.h
"

40 
	~"uts.h
"

44 (*
HPLJJBGCom´ess
è(
iWidth
, 
iHeight
, **
pBuff
,

45 
HPLJZjcBuff
 *
pOutBuff
, 
HPLJZjsJbgEncSt
 *
pJbgEncSt
);

46 (*
HPLJSoIn™
è(
iFÏg
);

49 cÚ¡ 
BYTE
 
ModeJbig
::
szBy‹1
[256] =

74 cÚ¡ 
BYTE
 
	gModeJbig
::
szBy‹2
[256] =

101 
	gModeJbig
::
	$ModeJbig
 (
Ra¡”Size
è: 
	$Com´essÜ
 (
Ra¡”Size
, 
çl£
)

103 
m_hHPLibHªdË
 = 0;

104 
m_pszIÅutRa¡”D©a
 = 0;

105 
m_iWidth
 = ((
Ra¡”Size
 + 31) / 32) * 4;

106 
m_iPÏÃNumb”
 = 0;

107 
m_iCu¼’tPÏÃ
 = 0;

108 
m_bLa¡Bªd
 = 
çl£
;

109 
i
 = 0; i < 4; i++)

111 
m_iCurRa¡”P”PÏÃ
[
i
] = 0;

114 
m_iP
[0] = 0;

115 
	}
}

117 
	gModeJbig
::~
	$ModeJbig
()

119 
	`uÆßd_lib¿ry
(
m_hHPLibHªdË
);

121 ià(
m_pszIÅutRa¡”D©a
)

123 
d–‘e
 [] 
m_pszIÅutRa¡”D©a
;

125 
	}
}

127 
DRIVER_ERROR
 
	gModeJbig
::
	$In™
(
iLa¡Ra¡”
, 
iPÏÃs
, 
iBPP
, 
ZJPLATFORM
 
zj_¶©fÜm
)

129 
m_iLa¡Ra¡”
 = 
iLa¡Ra¡”
;

130 
m_iOrgHeight
 = 
iLa¡Ra¡”
;

131 
m_iPÏÃs
 = 
iPÏÃs
;

132 
m_iBPP
 = 
iBPP
;

133 
m_ezj_¶©fÜm
 = 
zj_¶©fÜm
;

135 
m_hHPLibHªdË
 = 
	`lßd_¶ugš_lib¿ry
(
UTILS_PRINT_PLUGIN_LIBRARY
, 
PRNT_PLUGIN_LJ
);

136 ià(
m_hHPLibHªdË
)

138 
	`dË¼Ü
 ();

139 *(**è(&
HPLJJBGCom´ess
èğ
	`g‘_lib¿ry_symbŞ
(
m_hHPLibHªdË
, "hp_encode_bits_to_jbig");

140 *(**è(&
HPLJSoIn™
èğ
	`g‘_lib¿ry_symbŞ
(
m_hHPLibHªdË
, "hp_init_lib");

148  
PLUGIN_LIBRARY_MISSING
;

151 ià(
iPÏÃs
 == 4)

153 
m_iP
[0] = 3;

154 
m_iP
[1] = 0;

155 
m_iP
[2] = 1;

156 
m_iP
[3] = 2;

157 if(
zj_¶©fÜm
 =ğ
ZJCOLOR2
)

159 
m_iP
[1] = 2;

160 
m_iP
[3] = 0;

164 
bufãr_size
 = 
m_iWidth
 * 
m_iLa¡Ra¡”
 * 
m_iPÏÃs
 * 
m_iBPP
;

165 
m_pszIÅutRa¡”D©a
 = 
Ãw
 
BYTE
[
bufãr_size
];

166 ià(
m_pszIÅutRa¡”D©a
 =ğ
NULL
)

168  
ALLOCMEM_ERROR
;

170 
com´essBuf
 = 
Ãw
 
BYTE
[
m_iWidth
 * 
m_iLa¡Ra¡”
 * 
m_iBPP
];

171 ià(
com´essBuf
 =ğ
NULL
)

173  
ALLOCMEM_ERROR
;

175 
m_pszCurPŒ
 = 
m_pszIÅutRa¡”D©a
;

176 
	`mem£t
(
m_pszCurPŒ
, 0, 
bufãr_size
);

177  
NO_ERROR
;

178 
	}
}

180 
	gModeJbig
::
	$Flush
()

182 ià(
m_iCurRa¡”P”PÏÃ
[
m_iPÏÃNumb”
] > 0)

184 
height
 = 
m_iLa¡Ra¡”
;

185 
m_iLa¡Ra¡”
 = 
m_iCurRa¡”P”PÏÃ
[
m_iPÏÃNumb”
];

186 ià(
m_iPÏÃs
 == 1) {

187 
	`com´ess
();

188 
m_iLa¡Ra¡”
 = 
height
;

190 
iRa¡”sR—dy
 = 1;

192 
	}
}

194 
boŞ
 
	gModeJbig
::
	$Proûss
 (
RASTERDATA
* 
šput
)

196 ià(
šput
==
NULL
)

198 
com´es£dsize
 = 0;

199 
iRa¡”sR—dy
 = 0;

200  
çl£
;

203 
boŞ
 
bResuÉ
 = 
çl£
;

204 
m_ezj_¶©fÜm
)

206 
ZJSTREAM
:

207 
bResuÉ
 = 
	`´oûssZJSŒ—m
(
šput
);

209 
ZXSTREAM
:

210 
bResuÉ
 = 
	`´oûssZXSŒ—m
(
šput
);

212 
ZJCOLOR
:

213 
ZJCOLOR2
:

214 ià(
m_iPÏÃs
 == 1)

216 
bResuÉ
 = 
	`´oûssZXSŒ—m
(
šput
);

219 
bResuÉ
 = 
	`´oûssZJCŞÜ
(
šput
);

222 ià(
iRa¡”sR—dy
)

224 
m_iCurRa¡”P”PÏÃ
[
m_iPÏÃNumb”
] = 0;

225 
m_pszCurPŒ
 = 
m_pszIÅutRa¡”D©a
;

227  
bResuÉ
;

228 
	}
}

230 
boŞ
 
	gModeJbig
::
	$´oûssZJSŒ—m
(
RASTERDATA
 *
šput
)

232 ià(
šput
->
¿¡”d©a
[
COLORTYPE_COLOR
])

234 
	`memıy
(
m_pszCurPŒ
, 
šput
->
¿¡”d©a
[
COLORTYPE_COLOR
],

235 
šput
->
¿¡”size
[
COLORTYPE_COLOR
]);

238 
m_iCurRa¡”P”PÏÃ
[0]++;

239 
m_pszCurPŒ
 +ğ
m_iWidth
;

241 ià(
m_iCurRa¡”P”PÏÃ
[0] =ğ
m_iLa¡Ra¡”
)

243 
	`com´ess
();

244 
iRa¡”sR—dy
 = 1;

245  
Œue
;

247  
çl£
;

248 
	}
}

250 
boŞ
 
	gModeJbig
::
	$´oûssZXSŒ—m
(
RASTERDATA
 *
šput
)

252 ià(
šput
->
¿¡”d©a
[
COLORTYPE_COLOR
])

254 
i
 = 0; i < 
šput
->
¿¡”size
[
COLORTYPE_COLOR
]; i++)

256 
m_pszCurPŒ
[
i
*
m_iBPP
] = 
szBy‹1
[
šput
->
¿¡”d©a
[
COLORTYPE_COLOR
][i]];

257 
m_pszCurPŒ
[
i
*
m_iBPP
+1] = 
szBy‹2
[
šput
->
¿¡”d©a
[
COLORTYPE_COLOR
][i]];

258 
m_pszCurPŒ
[
i
*
m_iBPP
] |= (m_pszCurPtr[i*m_iBPP] >> 1);

259 
m_pszCurPŒ
[
i
*
m_iBPP
+1] |= (m_pszCurPtr[i*m_iBPP+1] >> 1);

263 
m_iCurRa¡”P”PÏÃ
[0]++;

264 
m_pszCurPŒ
 +ğ
m_iWidth
 * 
m_iBPP
;

265 ià(
m_iCurRa¡”P”PÏÃ
[0] =ğ
m_iLa¡Ra¡”
)

267 
	`com´ess
();

268 
iRa¡”sR—dy
 = 1;

269  
Œue
;

271  
çl£
;

272 
	}
}

273 
boŞ
 
	gModeJbig
::
	$´oûssZJCŞÜ
(
RASTERDATA
 *
šput
)

275 
BYTE
 *
p
 = 
m_pszCurPŒ
 + (
m_iP
[
m_iPÏÃNumb”
] * 
m_iWidth
 * 
m_iBPP
è* 
m_iLa¡Ra¡”
;

276 ià(
šput
->
¿¡”d©a
[
COLORTYPE_COLOR
])

278 
i
 = 0; i < 
šput
->
¿¡”size
[
COLORTYPE_COLOR
]; i++)

280 
p
[
i
*
m_iBPP
] = 
szBy‹1
[
šput
->
¿¡”d©a
[
COLORTYPE_COLOR
][i]];

281 
p
[
i
*
m_iBPP
+1] = 
szBy‹2
[
šput
->
¿¡”d©a
[
COLORTYPE_COLOR
][i]];

282 
p
[
i
*
m_iBPP
] |= (p[i*m_iBPP] >> 1);

283 
p
[
i
*
m_iBPP
+1] |= (p[i*m_iBPP+1] >> 1);

287 
m_iCurRa¡”P”PÏÃ
[
m_iPÏÃNumb”
]++;

288 ià(
m_iCurRa¡”P”PÏÃ
[
m_iPÏÃNumb”
] =ğ
m_iLa¡Ra¡”
 && m_iPlaneNumber == 3)

290 
iRa¡”sR—dy
 = 1;

291 
m_pszCurPŒ
 = 
m_pszIÅutRa¡”D©a
;

292 
m_iPÏÃNumb”
 = 0;

293  
Œue
;

295 
m_iPÏÃNumb”
++;

296 ià(
m_iPÏÃNumb”
 == 4)

298 
m_pszCurPŒ
 +ğ
m_iBPP
 * 
m_iWidth
;

299 
m_iPÏÃNumb”
 = 0;

301  
çl£
;

302 
	}
}

304 
boŞ
 
	gModeJbig
::
	$NextOuutRa¡”
(
RASTERDATA
& 
Ãxt_¿¡”
)

306 ià(
iRa¡”sR—dy
 == 0)

308  
çl£
;

311 ià(
m_iPÏÃs
 == 4)

313 
	`com´ess
(
m_iCu¼’tPÏÃ
++);

315 
Ãxt_¿¡”
.
¿¡”size
[
COLORTYPE_COLOR
] = 
com´es£dsize
;

316 
Ãxt_¿¡”
.
¿¡”d©a
[
COLORTYPE_COLOR
] = 
com´essBuf
;

317 
Ãxt_¿¡”
.
¿¡”size
[
COLORTYPE_BLACK
] = 0;

318 
Ãxt_¿¡”
.
¿¡”d©a
[
COLORTYPE_BLACK
] = 
NULL
;

320 ià(
m_iPÏÃs
 =ğ1 || (
m_iCu¼’tPÏÃ
 == 4))

322 
iRa¡”sR—dy
 = 0;

323 
m_iCu¼’tPÏÃ
 = 0;

324 
m_iLa¡Ra¡”
 = 
m_iOrgHeight
;

326  
Œue
;

327 
	}
}

329 
	gModeJbig
::
	$com´ess
 (
¶ªe_numb”
)

331 
HPLJZjcBuff
 
myBufãr
;

333 
HPLJZjsJbgEncSt
 
£
;

334 
myBufãr
.
pszCom´es£dD©a
 = 
com´essBuf
;

335 
myBufãr
.
dwTÙ®Size
 = 0;

336 
BYTE
 *
p
 = 
m_pszIÅutRa¡”D©a
 + (
m_iWidth
 * 
m_iBPP
 * 
m_iLa¡Ra¡”
 * 
¶ªe_numb”
);

338 
	`mem£t
 (
myBufãr
.
pszCom´es£dD©a
, 0, 
m_iWidth
 * 
m_iLa¡Ra¡”
 * 
m_iBPP
);

339 
	`HPLJJBGCom´ess
 (
m_iWidth
 * 8 * 
m_iBPP
, 
m_iLa¡Ra¡”
, &
p
, &
myBufãr
, &
£
);

341 
com´es£dsize
 = 
myBufãr
.
dwTÙ®Size
;

342 
	`memıy
(
com´essBuf
+
com´es£dsize
, &
£
, (se));

343 
iRa¡”sR—dy
 = 1;

344 
m_iCurRa¡”P”PÏÃ
[
¶ªe_numb”
] = 0;

345 
m_pszCurPŒ
 = 
m_pszIÅutRa¡”D©a
;

346 
bufãr_size
 = 
m_iWidth
 * 
m_iLa¡Ra¡”
 * 
m_iBPP
;

347 
	`mem£t
(
p
, 0, 
bufãr_size
);

349 
	}
}

	@prnt/hpcups/ModeJbig.h

33 #iâdeà
MODE_JBIG_H


34 
	#MODE_JBIG_H


	)

36 
	~"CommÚDefš™iÚs.h
"

37 
	~"ProûssÜ.h
"

38 
	~"Com´essÜ.h
"

40 
	#INDY_STRIP_HEIGHT
 128

	)

43 
	mZJSTREAM
,

44 
	mZXSTREAM
,

45 
	mZJCOLOR
,

46 
	mZJCOLOR2


47 } 
	tZJPLATFORM
;

49 şas 
	cModeJbig
 : 
public
 
Com´essÜ


51 
public
:

52 
ModeJbig
(
Ra¡”Size
);

53 
	mvœtu®
 ~
ModeJbig
();

54 
boŞ
 
Proûss
(
RASTERDATA
 *
šput
);

55 
boŞ
 
NextOuutRa¡”
(
RASTERDATA
 &
Ãxt_¿¡”
);

56 
DRIVER_ERROR
 
In™
(
height
, 
num_¶ªes
, 
bµ
, 
ZJPLATFORM
 
ezj_¶©fÜm
);

57 
	$NewPage
()

59 
m_pszCurPŒ
 = 
m_pszIÅutRa¡”D©a
;

60 ià(
m_pszCurPŒ
)

61 
	`mem£t
 (
m_pszCurPŒ
, 0, (
m_iWidth
 * 
m_iLa¡Ra¡”
 * 
m_iPÏÃs
 * 
m_iBPP
));

63 
	`Flush
();

64 
	$S‘BªdHeight
(
height
)

66 
m_iLa¡Ra¡”
 = 
height
;

67 
	}
}

68 
	$S‘La¡Bªd
()

70 
m_bLa¡Bªd
 = 
Œue
;

71 
	}
}

73 
	g´iv©e
:

74 
com´ess
(
¶ªe_numb”
 = 0);

75 
boŞ
 
´oûssZJSŒ—m
(
RASTERDATA
 *
šput
);

76 
boŞ
 
´oûssZXSŒ—m
(
RASTERDATA
 *
šput
);

77 
boŞ
 
´oûssZJCŞÜ
(
RASTERDATA
 *
šput
);

79 cÚ¡ 
BYTE
 
	gszBy‹1
[256];

80 cÚ¡ 
BYTE
 
	gszBy‹2
[256];

82 *
	gm_hHPLibHªdË
;

83 
	gm_iWidth
;

84 
	gm_iLa¡Ra¡”
;

85 
	gm_iOrgHeight
;

86 
BYTE
 *
	gm_pszCurPŒ
;

87 
BYTE
 *
	gm_pszIÅutRa¡”D©a
;

88 
	gm_iPÏÃs
;

89 
	gm_iBPP
;

90 
boŞ
 
	gm_bLa¡Bªd
;

91 
ZJPLATFORM
 
	gm_ezj_¶©fÜm
;

92 
	gm_iP
[4];

93 
	gm_iCurRa¡”P”PÏÃ
[4];

94 
	gm_iPÏÃNumb”
;

95 
	gm_iCu¼’tPÏÃ
;

	@prnt/hpcups/ModeJpeg.cpp

31 
	~"CommÚDefš™iÚs.h
"

32 
	~<£tjmp.h
>

33 
	~"ModeJ³g.h
"

34 
	~<dlfú.h
>

35 
	~"Uts.h
"

36 
	~"uts.h
"

38 
	#MAX_JPEG_FILE_SIZE
 2097152

39 

	)

42 (*
HPLJJRCom´ess
è(
BYTE
 *
pCom´es£dD©a
,

43 
ušt32_t
 *
pCom´es£dD©aL’
,

44 
BYTE
 *
IÅutD©a
,

45 cÚ¡ 
ušt32_t
 
uiLogiÿlImageWidth
,

46 cÚ¡ 
ušt32_t
 
uiLogiÿlImageHeight
);

49 
ModeJ³g
::
	$ModeJ³g
(
¿¡”_width
è: 
	$Com´essÜ
 (
¿¡”_width
, 
çl£
)

51 
m_eCom´essÜ
 = 
COMPRESSOR_JPEG_QUICKCONNECT
;

52 
m_iCŞÜMode
 = 0;

53 
m_max_fe_size
 = 
MAX_JPEG_FILE_SIZE
;;

54 
com´es£dsize
 = 0;

55 
m_iRowWidth
 = (è
¿¡”_width
 * 3;

56 
m_iRowNumb”
 = 0;

57 
m_iBªdHeight
 = 0;

58 
m_uiG¿ysÿËOff£t
 = 0;

59 
m_pbyIÅutBufãr
 = 
NULL
;

60 
m_hHPLibHªdË
 = 
NULL
;

61 
com´essBuf
 = 
NULL
;

64 ià(
Üigš®KD©a
)

66 
d–‘e
 [] 
Üigš®KD©a
;

67 
Üigš®KD©a
 = 
NULL
;

69 
	}
}

71 
DRIVER_ERROR
 
ModeJ³g
::
	$In™
(
max_fe_size
, 
·ge_height
)

73 
bufãr_size
 = 
m_iRowWidth
 * (
·ge_height
 + 2);

74 
m_pbyIÅutBufãr
 = 
Ãw
 
BYTE
[
bufãr_size
];

75 ià(
m_pbyIÅutBufãr
 =ğ
NULL
)

77  
ALLOCMEM_ERROR
;

79 ià(
max_fe_size
 > 0)

81 
m_max_fe_size
 = (è
max_fe_size
;

83 
com´essBuf
 = 
Ãw
 
BYTE
[
m_max_fe_size
];

84 ià(
com´essBuf
 =ğ
NULL
)

86  
ALLOCMEM_ERROR
;

88 
m_iBªdHeight
 = 
·ge_height
;

89  
NO_ERROR
;

90 
	}
}

92 
DRIVER_ERROR
 
ModeJ³g
::
	$In™
(
cŞÜ_mode
, 
bªd_height
, 
COMPRESS_MODE
 *
eCom´essMode
, 
QTabËInfo
 *
qbË_šfo
)

94 
DRIVER_ERROR
 
”r
;

95 
m_iCŞÜMode
 = 
cŞÜ_mode
;

96 
m_pQTabËInfo
 = 
qbË_šfo
;

97 
buf_size
 = 
bªd_height
 * 
m_iRowWidth
;

98 
”r
 = 
	`In™
(
buf_size
, 
bªd_height
);

99 ià(
”r
 !ğ
NO_ERROR
)

101  
”r
;

105 
m_eCom´essÜ
 = 
COMPRESSOR_JPEG_JETREADY
;

106 ià(*
eCom´essMode
 =ğ
COMPRESS_MODE_LJ
)

108 
m_hHPLibHªdË
 = 
	`lßd_¶ugš_lib¿ry
(
UTILS_PRINT_PLUGIN_LIBRARY
, 
PRNT_PLUGIN_LJ
);

109 ià(
m_hHPLibHªdË
)

111 
	`dË¼Ü
 ();

112 *(**è(&
HPLJJRCom´ess
èğ
	`g‘_lib¿ry_symbŞ
(
m_hHPLibHªdË
, "HPJetReadyCompress");

113 ià(
HPLJJRCom´ess
 =ğ
NULL
)

115 
	`uÆßd_lib¿ry
(
m_hHPLibHªdË
);

116 
m_hHPLibHªdË
 = 
NULL
;

117 *
eCom´essMode
 = 
COMPRESS_MODE_JPEG
;

121 
m_eCom´essÜ
 = 
COMPRESSOR_TAOS
;

125  
”r
;

126 
	}
}

128 
ModeJ³g
::~
	$ModeJ³g
()

130 
	`uÆßd_lib¿ry
(
m_hHPLibHªdË
);

131 ià(
m_pbyIÅutBufãr
)

133 
d–‘e
 [] 
m_pbyIÅutBufãr
;

135 
	}
}

137 
ModeJ³g
::
	$Flush
()

139 ià(
m_iRowNumb”
 > 0)

141 
	`com´ess
();

143 
	}
}

145 
	#RGBTOGRAY
(
rgb
è(
BYTE
è(Ôgb[0] * 30 +„gb[1] * 59 +„gb[2] * 11è/ 100)

	)

146 
ModeJ³g
::
	$rgbToG¿y
(
BYTE
 *
rgbD©a
, 
iNumBy‹s
)

148 ià(
m_eCom´essÜ
 =ğ
COMPRESSOR_TAOS
)

150 
BYTE
 *
p
 = 
m_pbyIÅutBufãr
 + (
m_iRowNumb”
 * 
m_iRowWidth
);

151 
i
 = 0; i < 
iNumBy‹s
; i +ğ3, 
rgbD©a
 += 3)

153 *
p
++ = 
	`RGBTOGRAY
(
rgbD©a
);

154 *
p
++ = 0;

155 *
p
++ - 0;

159 
BYTE
 *
p
 = 
m_pbyIÅutBufãr
 + (
m_iRowNumb”
 * 
m_iRowWidth
 / 3);

160 
i
 = 0; i < 
iNumBy‹s
; i +ğ3, 
rgbD©a
 += 3)

162 *
p
++ = 255 - 
	`RGBTOGRAY
(
rgbD©a
);

164 
	}
}

166 
boŞ
 
ModeJ³g
::
	$Proûss
(
RASTERDATA
 *
šput
)

168 ià(
šput
 =ğ
NULL
)

170  
çl£
;

172 ià(
šput
->
¿¡”d©a
[
COLORTYPE_COLOR
])

174 ià(
m_iCŞÜMode
 == 0)

176 
	`memıy
(
m_pbyIÅutBufãr
 + (
m_iRowNumb”
 * 
m_iRowWidth
), 
šput
->
¿¡”d©a
[
COLORTYPE_COLOR
],

177 
šput
->
¿¡”size
[
COLORTYPE_COLOR
]);

181 
	`rgbToG¿y
(
šput
->
¿¡”d©a
[
COLORTYPE_COLOR
], iÅut->
¿¡”size
[COLORTYPE_COLOR]);

184 
m_iRowNumb”
++;

185 ià(
m_iRowNumb”
 =ğ
m_iBªdHeight
)

187 
	`com´ess
();

188  
Œue
;

190  
çl£
;

191 
	}
}

193 
boŞ
 
ModeJ³g
::
	$NextOuutRa¡”
 (
RASTERDATA
 &
Ãxt_¿¡”
)

195 ià(
iRa¡”sR—dy
 == 0)

197  
çl£
;

199 ià(
my¶ªe
 =ğ
COLORTYPE_COLOR
 && 
com´es£dsize
 != 0)

201 
Ãxt_¿¡”
.
¿¡”size
[
COLORTYPE_COLOR
] = 
com´es£dsize
 - 
m_uiG¿ysÿËOff£t
;

202 
Ãxt_¿¡”
.
¿¡”d©a
[
COLORTYPE_COLOR
] = 
com´essBuf
 + 
m_uiG¿ysÿËOff£t
;

206 
Ãxt_¿¡”
.
¿¡”size
[
COLORTYPE_COLOR
] = 0;

207 
Ãxt_¿¡”
.
¿¡”d©a
[
COLORTYPE_COLOR
] = 
NULL
;

209 
Ãxt_¿¡”
.
¿¡”size
[
COLORTYPE_BLACK
] = 0;

210 
Ãxt_¿¡”
.
¿¡”d©a
[
COLORTYPE_BLACK
] = 
NULL
;

212 
iRa¡”sR—dy
 = 0;

213 
m_uiG¿ysÿËOff£t
 = 0;

214  
Œue
;

215 
	}
}

217 
	$ouut_bufãr_ÿÎback
 (
JOCTET
 *
outbuf
, 
BYTE
 *
bufãr
, 
size
)

219 
ModeJ³g
 *
pModeJ³g
 = (ModeJ³g *è
outbuf
;

220 
pModeJ³g
->
	`StÜeJ³gD©a
 (
bufãr
, 
size
);

221 
	}
}

223 
ModeJ³g
::
	$StÜeJ³gD©a
 (
BYTE
 *
bufãr
, 
iSize
)

225 
com´es£dsize
 +ğ
iSize
;

226 ià(
com´es£dsize
 < 
m_max_fe_size
)

228 
	`memıy
 (
com´essBuf
 + 
com´es£dsize
 - 
iSize
, 
bufãr
, iSize);

232 
com´es£dsize
 = 
m_max_fe_size
 + 1;

234 
	}
}

240 
	$HPJ³g_”rÜ
 (
j_commÚ_±r
 
cšfo
)

243 
	}
}

247 
j³g_bufãr_de¡
 (
j_com´ess_±r
 
cšfo
, 
JOCTET
* 
outbuff
, * 
æush_ouut_bufãr_ÿÎback
);

248 
hp_rgb_ycc_£tup
 (
iFÏg
);

251 
ModeJ³g
::
	$com´ess
 ()

253 
m_eCom´essÜ
)

255 
COMPRESSOR_JPEG_QUICKCONNECT
:

257 
	`j³gCom´essFÜQuickCÚÃù
();

260 
COMPRESSOR_JPEG_JETREADY
:

262 
	`j³gCom´essFÜJ‘R—dy
();

265 
COMPRESSOR_TAOS
:

267 
	`osCom´essFÜJ‘R—dy
();

271 
m_iRowNumb”
 = 0;

272 
iRa¡”sR—dy
 = 1;

273 
	`mem£t
(
m_pbyIÅutBufãr
, 0xFF, 
m_iRowWidth
 * 
m_iBªdHeight
);

274 
	}
}

276 
ModeJ³g
::
	$j³gCom´essFÜQuickCÚÃù
()

278 
BYTE
 *
p
;

279 
iQu®™y
 = 100;

286 
j³g_com´ess_¡ruù
 
cšfo
;

287 
j³g_”rÜ_mgr
 
j”r
;

288 
jmp_buf
 
£tjmp_bufãr
;

290 
boŞ
 
bRedo
;

294 
	`hp_rgb_ycc_£tup
 (0);

297 
bRedo
 = 0;

298 
com´es£dsize
 = 0;

299 
	`mem£t
 (
com´essBuf
, 0xFF, 
m_max_fe_size
);

300 
p
 = 
m_pbyIÅutBufãr
;

302 
cšfo
.
”r
 = 
	`j³g_¡d_”rÜ
 (&
j”r
);

303 
j”r
.
”rÜ_ex™
 = 
HPJ³g_”rÜ
;

304 ià(
	`£tjmp
 (
£tjmp_bufãr
))

306 
	`j³g_de¡roy_com´ess
 (&
cšfo
);

310 
	`j³g_ü—‹_com´ess
 (&
cšfo
);

311 
cšfo
.
š_cŞÜ_¥aû
 = 
JCS_RGB
;

312 
	`j³g_£t_deçuÉs
 (&
cšfo
);

313 
cšfo
.
image_width
 = 
m_iRowWidth
 / 3;

314 
cšfo
.
image_height
 = 
m_iRowNumb”
;

315 
cšfo
.
šput_compÚ’ts
 = 3;

316 
cšfo
.
d©a_´ecisiÚ
 = 8;

317 
	`j³g_£t_qu®™y
 (&
cšfo
, 
iQu®™y
, 
TRUE
);

318 
	`j³g_bufãr_de¡
 (&
cšfo
, (
JOCTET
 *è
this
, (*è(
ouut_bufãr_ÿÎback
));

319 
	`j³g_¡¬t_com´ess
 (&
cšfo
, 
TRUE
);

320 
JSAMPROW
 
pRowA¼ay
[1];

321 
i
 = 0; i < 
m_iRowNumb”
; i++)

323 
pRowA¼ay
[0] = (
JSAMPROW
è
p
;

324 
	`j³g_wr™e_sÿÆšes
 (&
cšfo
, 
pRowA¼ay
, 1);

325 
p
 +ğ(
m_iRowWidth
);

326 ià(
com´es£dsize
 > 
m_max_fe_size
)

328 
com´es£dsize
 = 0;

329 
bRedo
 = 1;

332 
	`j³g_fšish_com´ess
 (&
cšfo
);

333 
	`j³g_de¡roy_com´ess
 (&
cšfo
);

334 
iQu®™y
 -= 10;

335 ià(
iQu®™y
 == 0)

337 
com´es£dsize
 = 0;

340 } 
bRedo
);

342 
	}
}

344 
ModeJ³g
::
	$j³gCom´essFÜJ‘R—dy
()

346 
j³g_com´ess_¡ruù
 
cšfo
;

347 
j³g_”rÜ_mgr
 
j”r
;

348 
jmp_buf
 
£tjmp_bufãr
;

352 
	`hp_rgb_ycc_£tup
 (1);

354 
com´es£dsize
 = 0;

355 
	`mem£t
 (
com´essBuf
, 0xFF, 
m_max_fe_size
);

357 
cšfo
.
”r
 = 
	`j³g_¡d_”rÜ
 (&
j”r
);

358 
j”r
.
”rÜ_ex™
 = 
HPJ³g_”rÜ
;

359 ià(
	`£tjmp
 (
£tjmp_bufãr
))

361 
	`j³g_de¡roy_com´ess
 (&
cšfo
);

365 
	`j³g_ü—‹_com´ess
 (&
cšfo
);

366 
cšfo
.
š_cŞÜ_¥aû
 = (
m_iCŞÜMode
 =ğ0è? 
JCS_RGB
 : 
JCS_GRAYSCALE
;

367 
	`j³g_£t_deçuÉs
 (&
cšfo
);

368 
cšfo
.
image_width
 = 
m_iRowWidth
 / 3;

369 
cšfo
.
image_height
 = 
m_iBªdHeight
;

370 
cšfo
.
šput_compÚ’ts
 = (
m_iCŞÜMode
 == 0) ? 3 : 1;

371 
cšfo
.
d©a_´ecisiÚ
 = 8;

375 
mojave_quªt_bË1
[64] = {

403 
i
 = 0; i < 3; i++)

407 
	`j³g_add_quªt_bË
(&
cšfo
, 
i
, 
mojave_quªt_bË1
, 0, 
FALSE
 );

413 
j
 = 1; j < 64; j++)

415 
cšfo
.
quªt_tbl_±rs
[
i
]->
quªtv®
[
j
] = (
UINT16
)((
mojave_quªt_bË1
[j] * 
m_pQTabËInfo
->
qFaùÜ
) & 0xFF);

426 
cšfo
.
quªt_tbl_±rs
[
i
]->
quªtv®
[0] = (
UINT16
)
mojave_quªt_bË1
[0];

433 
dTemp
 = 
mojave_quªt_bË1
[1] * (1 + 0.25 * (
m_pQTabËInfo
->
qFaùÜ
 - 1)) + 0.5;

434 
cšfo
.
quªt_tbl_±rs
[
i
]->
quªtv®
[1] = (
UINT16
)
dTemp
 & 0xFF;

436 
dTemp
 = 
mojave_quªt_bË1
[8] * (1 + 0.25 * (
m_pQTabËInfo
->
qFaùÜ
 - 1)) + 0.5;

437 
cšfo
.
quªt_tbl_±rs
[
i
]->
quªtv®
[8] = (
UINT16
)
dTemp
 & 0xFF;

442 
dTemp
 = 
mojave_quªt_bË1
[16] * (1 + 0.50 * (
m_pQTabËInfo
->
qFaùÜ
 - 1)) + 0.5;

443 
cšfo
.
quªt_tbl_±rs
[
i
]->
quªtv®
[16] = (
UINT16
)
dTemp
 & 0xFF;

445 
dTemp
 = 
mojave_quªt_bË1
[9] * (1 + 0.50 * (
m_pQTabËInfo
->
qFaùÜ
 - 1)) + 0.5;

446 
cšfo
.
quªt_tbl_±rs
[
i
]->
quªtv®
[9] = (
UINT16
)
dTemp
 & 0xFF;

448 
dTemp
 = 
mojave_quªt_bË1
[2] * (1 + 0.50 * (
m_pQTabËInfo
->
qFaùÜ
 - 1)) + 0.5;

449 
cšfo
.
quªt_tbl_±rs
[
i
]->
quªtv®
[2] = (
UINT16
)
dTemp
 & 0xFF;

454 
cšfo
.
comp_šfo
[0].
h_§mp_çùÜ
 = 1;

455 
cšfo
.
comp_šfo
[0].
v_§mp_çùÜ
 = 1;

457 
	`j³g_bufãr_de¡
 (&
cšfo
, (
JOCTET
 *è
this
, (*è(
ouut_bufãr_ÿÎback
));

459 
row_width
 = 
m_iRowWidth
;

460 ià(
m_iCŞÜMode
 != 0)

462 
row_width
 = 
m_iRowWidth
 / 3;

463 
cšfo
.
wr™e_JFIF_h—d”
 = 
FALSE
;

464 
cšfo
.
wr™e_Adobe_m¬k”
 = 
FALSE
;

465 
	`j³g_suµ»ss_bËs
(&
cšfo
, 
TRUE
);

468 
	`j³g_¡¬t_com´ess
 (&
cšfo
, 
TRUE
);

469 
JSAMPROW
 
pRowA¼ay
[1];

470 
BYTE
 *
pSÿnLše
 = 
m_pbyIÅutBufãr
;

471 
i
;

472 
i
 = 0; i < 
m_iBªdHeight
; i++)

474 
pRowA¼ay
[0] = (
JSAMPROW
è
pSÿnLše
;

475 
	`j³g_wr™e_sÿÆšes
 (&
cšfo
, 
pRowA¼ay
, 1);

476 
pSÿnLše
 +ğ(
row_width
);

478 
	`j³g_fšish_com´ess
 (&
cšfo
);

482 ià(
cšfo
.
quªt_tbl_±rs
[0] !ğ
NULL
)

485 
i
 = 0; i < 
QTABLE_SIZE
; i++)

487 
m_pQTabËInfo
->
qbË0
[
i
] = 
cšfo
.
quªt_tbl_±rs
[0]->
quªtv®
[i];

490 ià(
cšfo
.
quªt_tbl_±rs
[1] !ğ
NULL
)

493 
i
 = 0; i < 
QTABLE_SIZE
; i++)

495 
m_pQTabËInfo
->
qbË1
[
i
] = 
cšfo
.
quªt_tbl_±rs
[1]->
quªtv®
[i];

498 ià(
cšfo
.
quªt_tbl_±rs
[2] !ğ
NULL
)

501 
i
 = 0; i < 
QTABLE_SIZE
; i++)

503 
m_pQTabËInfo
->
qbË2
[
i
] = 
cšfo
.
quªt_tbl_±rs
[2]->
quªtv®
[i];

506 
	`j³g_de¡roy_com´ess
 (&
cšfo
);

507 ià(
m_iCŞÜMode
 != 0)

509 
l
 = 0;

510 
l
 < 
com´es£dsize
)

512 ià(
com´essBuf
[
l
] == 0xFF && compressBuf[l+1] == 0xDA)

514 
l
++;

516 ià(
l
 !ğ
com´es£dsize
)

518 
m_uiG¿ysÿËOff£t
 = 
l
 + 10;

521 
	}
}

523 
ModeJ³g
::
	$osCom´essFÜJ‘R—dy
()

525 
iR‘
;

526 
bufSize
 = 
m_max_fe_size
;

527 
iR‘
 = 
	`HPLJJRCom´ess
(
com´essBuf
, (
ušt32_t
 *è&
bufSize
, 
m_pbyIÅutBufãr
, 
m_iRowWidth
 / 3, 
m_iBªdHeight
);

528 
com´es£dsize
 = (
iR‘
 < 0è? 0 : 
bufSize
;

529 
	}
}

	@prnt/hpcups/ModeJpeg.h

31 #iâdeà
MODE_JPEG_H


32 
	#MODE_JPEG_H


	)

34 
	#HAVE_UNSIGNED_SHORT


	)

35 
	~"ProûssÜ.h
"

36 
	~"Com´essÜ.h
"

39 
	~"j³glib.h
"

42 şas 
	cModeJ³g
 : 
public
 
Com´essÜ


44 
public
:

45 
ModeJ³g
 (
Ra¡”Size
);

46 ~
ModeJ³g
();

47 
boŞ
 
Proûss
 (
RASTERDATA
 *
šput
);

48 
boŞ
 
NextOuutRa¡”
 (
RASTERDATA
& 
Ãxt_¿¡”
);

49 
Flush
 ();

50 
DRIVER_ERROR
 
In™
(
max_fe_size
, 
·ge_height
);

51 
DRIVER_ERROR
 
In™
(
cŞÜ_mode
, 
·ge_height
, 
COMPRESS_MODE
 *
eCom´essMode
, 
QTabËInfo
 *
qTabËInfo
);

52 
StÜeJ³gD©a
(
BYTE
 *
bufãr
, 
size
);

53 
´iv©e
:

54 
com´ess
();

55 
j³gCom´essFÜQuickCÚÃù
();

56 
j³gCom´essFÜJ‘R—dy
();

57 
osCom´essFÜJ‘R—dy
();

58 
rgbToG¿y
(
BYTE
 *
rgbD©a
, 
iNumBy‹s
);

59 
m_iRowWidth
;

60 
m_iRowNumb”
;

61 
m_iBªdHeight
;

62 
m_iCŞÜMode
;

63 
m_uiG¿ysÿËOff£t
;

64 
COMPRESSOR_TYPE
 
m_eCom´essÜ
;

65 
m_max_fe_size
;

66 
BYTE
 *
m_pbyIÅutBufãr
;

67 
QTabËInfo
 *
m_pQTabËInfo
;

68 *
m_hHPLibHªdË
;

	@prnt/hpcups/PCLmGenerator.h

13 #iâdeà
_PCLM_GENERATOR


14 
	#_PCLM_GENERATOR


	)

15 
	#SUPPORT_WHITE_STRIPS


	)

17 
	~"commÚ_defšes.h
"

19 cÚ¡ 
	gOUT_STR_SIZE
 = 256;

23 
	msim¶ex
,

24 
	mdu¶ex_lÚgEdge
,

25 
	mdu¶ex_shÜtEdge


26 } 
	tdu¶exDi¥os™iÚEnum
;

30 
	mjob_İ’
,

31 
	mjob_şo£d
,

32 
	mjob_”rÜed


33 } 
	tjobS‹Enum
;

37 
	mdeviûRGB
,

38 
	madobeRGB
,

39 
	mg¿ySÿË
,

40 
	mbÏckÚly


41 } 
	tcŞÜS·ûDi¥os™iÚ
;

45 
	mdeçuÉ_cŞÜtheme
,

46 
	mvividsRGB
,

47 
	mphÙosRGB
,

48 
	mphÙoAdobeRGB
,

49 
	mnÚe


50 }
	tcŞÜThemes
;

54 
	mdebugOn
,

55 
	mdebugOff


56 } 
	tdebugDi¥os™iÚ
;

60 
	mcom´essRLE
,

61 
	mcom´essDCT
,

62 
	mcom´essFÏ‹
,

63 
	mcom´essDeçuÉ
,

64 
	mcom´essNÚe


65 } 
	tcom´essiÚDi¥os™iÚ
;

69 
	mpÜŒa™Or›Á©iÚ
,

70 
	mÏndsÿ³Or›Á©iÚ


71 } 
	tmedŸOr›Á©iÚDi¥os™iÚ
;

75 
	m»s300
,

76 
	m»s600
,

77 
	m»s1200


78 } 
	t»nd”ResŞutiÚ
;

82 
	mtİ_Ëá
,

83 
	mbÙtom_right


84 } 
	t·geOrigšTy³
;

88 
	mcŞÜ_cÚ‹Á
,

89 
	mg¿y_cÚ‹Á
,

90 
	munknown_cÚ‹Á


91 } 
	t·geCrom©icCÚ‹Á
;

95 
	md¿á
,

96 
	mnÜm®
,

97 
	mbe¡
,

98 } 
	t·geOuutQu®™y
;

102 
	m®‹º©e
 = 0,

103 
	m®‹º©e_rŞl
 = 1,

104 
	mauto_£Ëù
 = 2,

105 
	mbÙtom
 = 3,

106 
	mûÁ”
 = 4 ,

107 
	mdisc
 = 5,

108 
	m’v–İe
 =6 ,

109 
	mhagaki
 = 7,

110 
	mÏrge_ÿ·c™y
 = 8,

111 
	mËá
 = 9,

112 
	mmaš_Œay
 = 10,

113 
	mmaš_rŞl
 = 11,

114 
	mmªu®
 = 12,

115 
	mmiddË
 = 13,

116 
	mphÙo
 = 14,

117 
	m»¬
 = 15,

118 
	mright
 = 16,

119 
	mside
 = 17,

120 
	mtİ
 = 18,

121 
	mŒay_1
 = 19,

122 
	mŒay_2
 =20,

123 
	mŒay_3
 = 21,

124 
	mŒay_4
 =22,

125 
	mŒay_5
 = 23,

126 
	mŒay_N
 = 24,

127 } 
	tjobIÅutBš
;

131 
	mtİ_ouut
,

132 
	mmiddË_ouut
,

133 
	mbÙtom_ouut
,

134 
	mside_ouut
,

135 
	mûÁ”_ouut
,

136 
	m»¬_ouut
,

137 
	mçû_up
,

138 
	mçû_down
,

139 
	mÏrge_ÿ·c™y_ouut
,

140 
	m¡ack”_N
,

141 
	mmabox_N
,

142 
	mŒay_1_ouut
,

143 
	mŒay_2_ouut
,

144 
	mŒay_3_ouut
,

145 
	mŒay_4_ouut
,

146 } 
	tjobOuutBš
;

150 
	mu£rPageQu®™y
[32];

151 
medŸOr›Á©iÚDi¥os™iÚ
 
	mu£rOr›Á©iÚ
;

152 
	mu£rMedŸTy³
[256];

153 
jobIÅutBš
 
	mu£rIÅutBš
;

154 
	mu£rCİ›s
;

155 
	mu£rDocum’tName
[256];

156 
jobOuutBš
 
	mu£rOuutBš
;

157 
cŞÜThemes
 
	mcŞÜTheme
;

158 
	md©‘ime
[256];

159 
	mjobid
;

160 
	mu£r_Çme
[32];

161 } 
	tPCLmSU£rS‘tšgsTy³
;

165 
	mmedŸSizeName
[256];

167 
	mş›ÁLoÿË
 [256];

168 
	mmedŸHeight
;

169 
	mmedŸWidth
;

170 
	msourûHeight
;

171 
	msourûWidth
;

172 
	mmedŸWidthOff£t
;

173 
	mmedŸHeightOff£t
;

174 
·geCrom©icCÚ‹Á
 
	mcŞÜCÚ‹Á
;

175 
·geOrigšTy³
 
	m·geOrigš
;

176 
com´essiÚDi¥os™iÚ
 
	mcompTy³Reque¡ed
;

177 
cŞÜS·ûDi¥os™iÚ
 
	m¤cCŞÜS·ûS³fiÿtiÚ
;

178 
cŞÜS·ûDi¥os™iÚ
 
	md¡CŞÜS·ûS³fiÿtiÚ
;

179 
	m¡rHeight
;

180 
»nd”ResŞutiÚ
 
	mde¡š©iÚResŞutiÚ
;

182 
du¶exDi¥os™iÚEnum
 
	mdu¶exDi¥os™iÚ
;

183 
	msÿËFaùÜ
;

184 
boŞ
 
	mg’ExŒaPage
;

185 
boŞ
 
	mmœrÜBackside
;

186 } 
	tPCLmPageS‘up
;

190 
PCLmPageS‘up
 *
	mPCLmPageCÚ‹Á
;

191 
PCLmSU£rS‘tšgsTy³
 *
	mPCLmSU£rS‘tšgs
;

192 } 
	tPCLmSS‘up
;

196 
	msucûss
=0,

197 
	mg’”icFau»
=-1,

198 
	mÿÎAgaš
=1

199 } 
	tPCLmG’”©Ü_»tuºTy³
;

201 şas 
	cPCLmG’”©Ü


203 
	mpublic
:

205 
PCLmG’”©Ü
();

206 ~
PCLmG’”©Ü
();

208 #ifdeà
STANDALONE


209 
S¹Job
 (**
pOutBufãr
, *
iOutBufãrSize
, 
boŞ
 
debug
);

211 
S¹Job
 (**
pOutBufãr
, *
iOutBufãrSize
);

213 
EndJob
 (**
pOutBUfãr
, *
iOutBifãrSize
);

214 
S¹Page
 (
PCLmPageS‘up
 *
PCLmPageCÚ‹Á
, **
pOutBufãr
, *
iOutBufãrSize
);

215 
S¹Page
 (
PCLmSS‘up
 *
PCLmSPageCÚ‹Á
, 
boŞ
 
g’”©ePCLmS
, **
pOutBufãr
, *
iOutBufãrSize
);

216 
EndPage
 (**
pOutBufãr
, *
iOutBufãrSize
);

217 
EnÿpsuÏ‹
 (*
pInBufãr
, 
šBufãrSize
, 
numLšes
, **
pOutBufãr
, *
iOutBufãrSize
);

218 
SkLšes
 (
iSkLšes
);

219 
F»eBufãr
 (*
pBufãr
);

221 
	m´iv©e
:

222 
boŞ
 
cŞÜCÚv”tSourû
(
cŞÜS·ûDi¥os™iÚ
 
¤cCS
, cŞÜS·ûDi¥os™iÚ 
d¡CS
, 
uby‹
 *
¡r
, 
sšt32
 
¡rWidth
, sšt32 
¡rHeight
);

223 
wr™ePDFG¿mm¬Page
(
imageWidth
, 
imageHeight
, 
numSŒs
, 
cŞÜS·ûDi¥os™iÚ
 
de¡CŞÜS·û
);

224 
wr™ePDFG¿mm¬H—d”
();

225 
šjeùRLESŒ
(
uby‹
 *
RLEBufãr
, 
numBy‹s
, 
imageWidth
, 
imageHeight
, 
cŞÜS·ûDi¥os™iÚ
 
de¡CŞÜS·û
, 
boŞ
);

226 
šjeùLZSŒ
(
uby‹
 *
LZBufãr
, 
numBy‹s
, 
imageWidth
, 
imageHeight
, 
cŞÜS·ûDi¥os™iÚ
 
de¡CŞÜS·û
, 
boŞ
);

227 
šjeùJPEG
(*
j³g_Buff
, 
imageWidth
, 
imageHeight
, 
numCompBy‹s
, 
cŞÜS·ûDi¥os™iÚ
 
de¡CŞÜS·û
, 
boŞ
);

228 
š™OutBuff
(*
buff
, 
sšt32
 
size
);

229 
wr™eSŒ2OutBuff
(*
¡r
);

230 
wr™e2Buff
(
uby‹
 *
buff
, 
buffSize
);

231 
¡©OuutFeSize
();

232 
wr™ePDFG¿mm¬T¿”
(
imageWidth
, 
imageHeight
);

233 
boŞ
 
šjeùAdobeRGBCS
();

234 
boŞ
 
addKids
(
sšt32
 
kidObj
);

235 
boŞ
 
addXRef
(
sšt32
 
xRefObj
);

236 
”rÜOutAndCËªUp
();

237 
CËªup
();

238 
wr™eJobTick‘
();

239 #ifdeà
SUPPORT_WHITE_STRIPS


240 
boŞ
 
isWh™eSŒ
(*, );

242 * 
g‘IÅutBšSŒšg
(
jobIÅutBš
 
bš
);

243 * 
g‘OuutBš
(
jobOuutBš
 
bš
);

244 * 
g‘Or›Á©iÚSŒšg
(
medŸOr›Á©iÚDi¥os™iÚ
 
Or›Á©iÚ
);

245 * 
g‘Du¶exSŒšg
(
du¶exDi¥os™iÚEnum
 
du¶ex
);

246 * 
g‘CŞÜThemesSŒšg
(
cŞÜThemes
 
cŞÜtheme
);

248 
sšt32
 
	mcu¼SŒHeight
;

249 
	mcu¼MedŸName
[256];

250 
du¶exDi¥os™iÚEnum
 
	mcu¼Du¶exDi¥os™iÚ
;

251 
cŞÜS·ûDi¥os™iÚ
 
	mcu¼CŞÜS·ûDi¥os™iÚ
;

252 
debugDi¥os™iÚ
 
	mcu¼DebugDi¥os™iÚ
;

253 
com´essiÚDi¥os™iÚ
 
	mcu¼Com´essiÚDi¥os™iÚ
;

254 
medŸOr›Á©iÚDi¥os™iÚ
 
	mcu¼MedŸOr›Á©iÚDi¥os™iÚ
;

255 
»nd”ResŞutiÚ
 
	mcu¼R’d”ResŞutiÚ
;

256 
	mcu¼R’d”ResŞutiÚIÁeg”
;

257 *
	m®loÿ‹dOuutBufãr
;

258 *
	mËáov”SÿÆšeBufãr
;

260 
	mmedŸWidth
;

261 
	mmedŸHeight
;

262 
	mmedŸWidthInPix–s
;

263 
	mmedŸHeightInPix–s
;

264 
cŞÜS·ûDi¥os™iÚ
 
	mde¡CŞÜS·û
;

265 
cŞÜS·ûDi¥os™iÚ
 
	msourûCŞÜS·û
;

266 
	msÿËFaùÜ
;

267 
boŞ
 
	mg’ExŒaPage
;

268 
jobS‹Enum
 
	mjobO³n
;

269 
	mcu¼SourûWidth
;

270 
	mcu¼SourûHeight
;

271 
	m¤cNumCompÚ’ts
;

272 
	md¡NumCompÚ’ts
;

273 
	mnumLeáov”SÿÆšes
;

274 
uby‹
 *
	msü©chBufãr
;

275 
	m·geCouÁ
;

276 
boŞ
 
	m»v”£Ord”
;

277 
	moutBuffSize
;

278 
	mcu¼OutBuffSize
;

279 
	mtÙ®By‹sWr™‹nToPCLmFe
;

280 
	mtÙ®By‹sWr™‹nToCu¼Buff
;

281 *
	moutBuffPŒ
;

282 *
	mcu¼BuffPŒ
;

283 
sšt32
 
	mcu¼ResŞutiÚ
;

284 
	mSTANDARD_SCALE
;

285 
sšt32
 
	mDebugIt
;

286 
sšt32
 
	mDebugIt2
;

287 
sšt32
 
	mobjCouÁ”
;

289 
sšt32
 
	myPos™iÚ
;

290 
sšt32
 
	mšfoObj
;

291 
sšt32
 
	m·geOrigš
;

292 
sšt32
 *
	mKidsA¼ay
;

293 
sšt32
 
	mnumKids
;

295 
sšt32
 *
	mxRefTabË
;

296 
sšt32
 
	mxRefIndex
;

297 
sšt32
 
	mxRefS¹
;

298 
	mpOutSŒ
[
OUT_STR_SIZE
];

299 
boŞ
 
	madobeRGBCS_fœ¡Time
;

300 
boŞ
 
	mmœrÜBackside
;

301 
sšt32
 
	mtİM¬gšInPix
;

302 
sšt32
 
	mËáM¬gšInPix
;

303 
boŞ
 
	mfœ¡SŒ
;

304 
sšt32
 
	mnumFuÎInjeùedSŒs
;

305 
sšt32
 
	mnumFuÎSÿÆšesToInjeù
;

306 
sšt32
 
	mnumP¬tŸlSÿÆšesToInjeù
;

308 
PCLmSU£rS‘tšgsTy³
 *
	mm_pPCLmSS‘tšgs
;

309 
	m»tuºSŒ
[256];

	@prnt/hpcups/Pcl3.cpp

31 
	~"CommÚDefš™iÚs.h
"

32 
	~"Pş3.h
"

33 
	~"CŞÜM©ch”.h
"

34 
	~"H®áÚ”.h
"

35 
	~"Mode9.h
"

36 
	~"»sourûs.h
"

37 
	~"CŞÜM­s.h
"

38 
	~"Prš‹rCommªds.h
"

39 
	~"Pş3PrštModes.h
"

41 
	gPş3
::
	$Pş3
(è: 
	$EnÿpsuÏtÜ
()

43 
m_pPM
 = 
NULL
;

44 
	`¡rıy
(
m_szLªguage
, "PCL3");

45 
	}
}

47 
	gPş3
::~
	$Pş3
()

49 
	}
}

51 
DRIVER_ERROR
 
Pş3
::
	$CÚfigu»
(
P–še
 **
p–še
)

53 
P–še
 *
p
 = 
NULL
;

54 
P–še
 *
h—d
;

55 
width
;

56 
CŞÜM©ch”
 *
pCŞÜM©ch”
;

57 
Mode9
 *
pMode9
;

58 
iRows
[
MAXCOLORPLANES
];

59 
uiResBoo¡
;

60 
h—d
 = *
p–še
;

67 ià(!
	`£ËùPrštMode
())

69 
	`dbglog
("£ËùPrštModçed, PrštModÇmğ%s\n", 
m_pQA
->
´št_mode_Çme
);

70  
UNSUPPORTED_PRINTMODE
;

72 ià(
m_pPM
->
Ba£ResX
 !ğ
m_pQA
->
hÜizÚl_»sŞutiÚ
 ||

73 
m_pPM
->
Ba£ResY
 !ğ
m_pQA
->
v”tiÿl_»sŞutiÚ
)

75 
	`dbglog
("Requested„esolution‚ot supported with„equested…rintmode\n");

76  
UNSUPPORTED_PRINTMODE
;

79 
i
 = 0; i < 
MAXCOLORPLANES
; i++)

81 
iRows
[
i
] = 
m_pPM
->
ResŞutiÚX
[i] / m_pPM->
Ba£ResX
;

83 
uiResBoo¡
 = 
m_pPM
->
Ba£ResX
 / m_pPM->
Ba£ResY
;

84 ià(
uiResBoo¡
 == 0)

85 
uiResBoo¡
 = 1;

87 
width
 = 
m_pMA
->
´šbË_width
;

90 
pCŞÜM©ch”
 = 
Ãw
 
	`CŞÜM©ch”
(
m_pPM
->
cm­
, m_pPM->
dyeCouÁ
, 
width
);

91 
h—d
 = 
Ãw
 
	`P–še
(
pCŞÜM©ch”
);

92 
m_pH®áÚ”
 = 
Ãw
 
	`H®áÚ”
 (
m_pPM
, 
width
, 
iRows
, 
uiResBoo¡
, m_pPM->
eHT
 =ğ
MATRIX
);

93 
p
 = 
Ãw
 
	`P–še
(
m_pH®áÚ”
);

94 
h—d
->
	`AddPha£
(
p
);

95 
pMode9
 = 
Ãw
 
	`Mode9
(
width
, 
çl£
);

96 
p
 = 
Ãw
 
	`P–še
(
pMode9
);

97 
h—d
->
	`AddPha£
(
p
);

98 
pMode9
->
my¶ªe
 = 
COLORTYPE_COLOR
;

100 *
p–še
 = 
h—d
;

101  
NO_ERROR
;

102 
	}
}

104 
DRIVER_ERROR
 
	gPş3
::
	$S¹Page
(
JobA‰ribu‹s
 *
pJA
)

106 
DRIVER_ERROR
 
”r
 = 
NO_ERROR
;

107 
szSŒ
[256];

108 
tİ_m¬gš
 = 0;

109 
·ge_numb”
++;

113 
m_pJA
 = 
pJA
;

114 
m_pMA
 = &
pJA
->
medŸ_©Œibu‹s
;

115 
m_pQA
 = &
pJA
->
qu®™y_©Œibu‹s
;

119 
	`¥rštf
(
szSŒ
, "\033&l%dH\033&l%dM\033&l%dA\033*o%dM", 
m_pJA
->
medŸ_sourû
, 
m_pQA
->
medŸ_ty³
,

120 
m_pMA
->
pş_id
, 
m_pQA
->
´št_qu®™y
);

124 
i
 = 
	`¡¾’
(
szSŒ
);

125 
	`memıy
(
szSŒ
+
i
, 
MedŸSubty³Seq
, (MediaSubtypeSeq));

126 
i
 +ğ(
MedŸSubty³Seq
);

127 
szSŒ
[
i
++] = (è(
m_pQA
->
medŸ_subty³
 & 0xFFFF) >> 8;

128 
szSŒ
[
i
++] = (è
m_pQA
->
medŸ_subty³
 & 0xFF;

129 
	`addToH—d”
((cÚ¡ 
BYTE
 *è
szSŒ
, 
i
);

131 
	`cÚfigu»Ra¡”D©a
();

133 
	`addToH—d”
("\033&u%dD\033*t%dR", 
m_pPM
->
Ba£ResX
, m_pPM->
Ba£ResY
);

136 
width
 = 
m_pMA
->
´šbË_width
;

137 
	`addToH—d”
("\033*r%dS", 
width
);

143 ià(
m_pMA
->
pş_id
 =ğ
CUSTOM_MEDIA_SIZE
) {

144 
sWidth
, 
sHeight
;

145 
BYTE
 
b1
, 
b2
;

146 
sWidth
 = 
¡©ic_ÿ¡
<>(
m_pMA
->
physiÿl_width
);

147 
sHeight
 = 
¡©ic_ÿ¡
<>(
m_pMA
->
physiÿl_height
);

148 
	`memıy
 (
szSŒ
, "\x1B*o5W\x0E\x05\x00\x00\x00\x1B*o5W\x0E\x06\x00\x00\x00", 20);

149 
b1
 = (
BYTE
è((
sWidth
 & 0xFF00) >> 8);

150 
b2
 = (
BYTE
è(
sWidth
 & 0xFF);

151 
szSŒ
[8] = 
b1
;

152 
szSŒ
[9] = 
b2
;

153 
b1
 = (
BYTE
è((
sHeight
 & 0xFF00) >> 8);

154 
b2
 = (
BYTE
è(
sHeight
 & 0xFF);

155 
szSŒ
[18] = 
b1
;

156 
szSŒ
[19] = 
b2
;

157 
	`addToH—d”
((cÚ¡ 
BYTE
 *è
szSŒ
, 20);

160 ià(
m_pPM
->
dyeCouÁ
 != 3)

162 
	`addToH—d”
((cÚ¡ 
BYTE
 *è
bÏck_exŒaù_off
, (black_extract_off));

165 
	`addToH—d”
("\x1B&l0L", 5);

175 
tİ_m¬gš
 = 
m_pMA
->
´šbË_¡¬t_y
 - ((
m_pJA
->
mech_off£t
 * 
m_pQA
->
aùu®_v”tiÿl_»sŞutiÚ
)/1000);

176 
tİ_m¬gš
 = (tİ_m¬gš * 48è/ 
m_pQA
->
aùu®_v”tiÿl_»sŞutiÚ
;

177 
	`addToH—d”
("\x1B&l48D", 6);

178 
	`addToH—d”
("\x1B&l%dE", 
tİ_m¬gš
);

179 
	`addToH—d”
((cÚ¡ 
BYTE
 *è
g¿fS¹
, (grafStart));

180 
	`addToH—d”
((cÚ¡ 
BYTE
 *è
g¿fMode9
, (grafMode9));

181 
	`addToH—d”
((cÚ¡ 
BYTE
 *è
£edSame
, (seedSame));

183 
	`addToH—d”
("\x1b*p0Y", 5);

186 
	`addToH—d”
((cÚ¡ 
BYTE
 *) "\033&l-2H", 6);

188 
”r
 = 
	`CËªup
();

189  
”r
;

190 
	}
}

192 
DRIVER_ERROR
 
	gPş3
::
	$EnÿpsuÏ‹
(
RASTERDATA
 *
IÅutRa¡”
, 
boŞ
 
bLa¡PÏÃ
)

194 
DRIVER_ERROR
 
”r
 = 
NO_ERROR
;

195 
tmpSŒ
[16];

196 
iL’
;

197 
BYTE
 
c
 = 
m_pH®áÚ”
->
	`La¡PÏÃ
() ? 'W' : 'V';

198 
iL’
 = 
	`¥rštf
 (
tmpSŒ
, "\x1b*b%u%c", 
IÅutRa¡”
->
¿¡”size
[
COLORTYPE_COLOR
], 
c
);

199 
”r
 = 
this
->
	`S’d
((cÚ¡ 
BYTE
 *è
tmpSŒ
, 
iL’
);

200 ià(
”r
 =ğ
NO_ERROR
 && 
IÅutRa¡”
->
¿¡”size
[
COLORTYPE_COLOR
] > 0)

202 
”r
 = 
this
->
	`S’d
(
IÅutRa¡”
->
¿¡”d©a
[
COLORTYPE_COLOR
],

203 
IÅutRa¡”
->
¿¡”size
[
COLORTYPE_COLOR
]);

205  
”r
;

206 
	}
}

208 
	gPş3
::
	$cŞÜLev–s
(
cŞÜ_¶ªe
)

210 
b™_d•th
 = 
m_pPM
->
CŞÜD•th
[
cŞÜ_¶ªe
];

211 
Ëv–s
 = 1;

212 
i
 = 0; i < 
b™_d•th
; i++)

214 
Ëv–s
 *= 2;

216  
Ëv–s
;

217 
	}
}

219 
	gPş3
::
	$cÚfigu»Ra¡”D©a
()

221 ià(
m_pPM
 =ğ
NULL
)

223 
	`dbglog
("configureRasterData: m_pPM is NULL\n");

226 
BYTE
 *
p
 = 
cur_pş_bufãr_±r
;

228 *
p
++ = 0x1b;

229 *
p
++ = '*';

230 *
p
++ = 'g';

231 
p
 +ğ
	`¥rštf
((*èp, "%d", 
m_pPM
->
dyeCouÁ
 * 
MAXCOLORPLANES
 + 2);

232 *
p
++ = 'W';

233 *
p
++ = 2;

234 *
p
++ = 
m_pPM
->
dyeCouÁ
;

235 
¡¬t
 = 
K
;

236 ià(
m_pPM
->
dyeCouÁ
 == 3)

237 
¡¬t
 = 
C
;

239 
d•th
;

240 
cŞÜ
 = 
¡¬t
; cŞÜ < (¡¬ˆ+ 
m_pPM
->
dyeCouÁ
); color++)

242 *
p
++ = 
m_pPM
->
ResŞutiÚX
[
cŞÜ
] / 256;

243 *
p
++ = 
m_pPM
->
ResŞutiÚX
[
cŞÜ
] % 256;

244 *
p
++ = 
m_pPM
->
ResŞutiÚY
[
cŞÜ
] / 256;

245 *
p
++ = 
m_pPM
->
ResŞutiÚY
[
cŞÜ
] % 256;

246 
d•th
 = 
	`cŞÜLev–s
(
cŞÜ
);

247 *
p
++ = 
d•th
 / 256;

248 *
p
++ = 
d•th
 % 256;

251 
cur_pş_bufãr_±r
 = 
p
;

252 
	}
}

254 
boŞ
 
	gPş3
::
	$£ËùPrštMode
()

256 ià(
m_pJA
->
´š‹r_¶©fÜm
[0] == 0)

258 
	`dbglog
("printer_platform is undefined\n");

259  
çl£
;

261 
i
 = 0; i < (
pş3_´št_modes_bË
) / (pcl3_print_modes_table[0]); i++)

263 ià(!
	`¡rcmp
(
m_pJA
->
´š‹r_¶©fÜm
, 
pş3_´št_modes_bË
[
i
].
´š‹r_¶©fÜm_Çme
))

265  
	`£ËùPrštMode
(
i
);

268 
	`dbglog
("UnsuµÜ‹d…rš‹r_¶©fÜm: %s\n", 
m_pJA
->
´š‹r_¶©fÜm
);

269  
çl£
;

270 
	}
}

272 
boŞ
 
	gPş3
::
	$£ËùPrštMode
(
šdex
)

274 
PrštMode
 *
p
 = 
pş3_´št_modes_bË
[
šdex
].
´št_modes
;

275 
i
 = 0; i < 
pş3_´št_modes_bË
[
šdex
].
couÁ
; i++, 
p
++)

277 ià(!
	`¡rcmp
(
m_pJA
->
qu®™y_©Œibu‹s
.
´št_mode_Çme
, 
p
->
Çme
))

279 
m_pPM
 = 
p
;

280  
Œue
;

283  
çl£
;

284 
	}
}

	@prnt/hpcups/Pcl3.h

31 #iâdeà
PCL3_H


32 
	#PCL3_H


	)

34 
	~"CommÚDefš™iÚs.h
"

35 
	~"P–še.h
"

36 
	~"EnÿpsuÏtÜ.h
"

38 
şass
 
	gH®áÚ”
;

40 şas 
	cPş3
: 
public
 
EnÿpsuÏtÜ


42 
public
:

43 
Pş3
();

44 ~
Pş3
();

45 
DRIVER_ERROR
 
EnÿpsuÏ‹
 (
RASTERDATA
 *
IÅutRa¡”
, 
boŞ
 
bLa¡PÏÃ
);

46 
DRIVER_ERROR
 
S¹Page
(
JobA‰ribu‹s
 *
pJA
);

47 
DRIVER_ERROR
 
CÚfigu»
(
P–še
 **
p–še
);

48 
boŞ
 
	$UÅackB™s
(è{ 
Œue
;}

49 
´Ùeùed
:

50 
DRIVER_ERROR
 
	$addJobS‘tšgs
(è{ 
NO_ERROR
;
	}
}

51 
	g´iv©e
:

52 
boŞ
 
£ËùPrštMode
();

53 
boŞ
 
£ËùPrštMode
(
šdex
);

54 
cŞÜLev–s
(
cŞÜ_¶ªe
);

55 
cÚfigu»Ra¡”D©a
 ();

57 
PrštMode
 *
	gm_pPM
;

58 
H®áÚ”
 *
	gm_pH®áÚ”
;

	@prnt/hpcups/Pcl3Gui.cpp

31 
	~"CommÚDefš™iÚs.h
"

32 
	~"Pş3Gui.h
"

33 
	~"CŞÜM©ch”.h
"

34 
	~"H®áÚ”.h
"

35 
	~"Mode2.h
"

36 
	~"»sourûs.h
"

37 
	~"CŞÜM­s.h
"

38 
	~"Prš‹rCommªds.h
"

39 
	~"Pş3GuiPrštModes.h
"

41 
	gPş3Gui
::
	$Pş3Gui
(è: 
	$EnÿpsuÏtÜ
()

43 
m_pPM
 = 
NULL
;

44 
	`¡rıy
(
m_szLªguage
, "PCL3GUI");

45 
	}
}

47 
	gPş3Gui
::~
	$Pş3Gui
()

49 
	}
}

51 
DRIVER_ERROR
 
Pş3Gui
::
	$CÚfigu»
(
P–še
 **
p–še
)

53 
P–še
 *
p
 = 
NULL
;

54 
P–še
 *
h—d
;

55 
width
;

56 
CŞÜM©ch”
 *
pCŞÜM©ch”
;

57 
Mode2
 *
pMode2
;

58 
iRows
[
MAXCOLORPLANES
];

59 
uiResBoo¡
;

60 
h—d
 = *
p–še
;

67 ià(!
	`£ËùPrštMode
())

69 
	`dbglog
("£ËùPrštModçed, PrštModÇmğ%s", 
m_pQA
->
´št_mode_Çme
);

70  
UNSUPPORTED_PRINTMODE
;

72 ià(
m_pPM
->
Ba£ResX
 !ğ
m_pQA
->
hÜizÚl_»sŞutiÚ
 ||

73 
m_pPM
->
Ba£ResY
 !ğ
m_pQA
->
v”tiÿl_»sŞutiÚ
)

75 
	`dbglog
("Requested„esolution‚ot supported with„equested…rintmode");

76  
UNSUPPORTED_PRINTMODE
;

79 
i
 = 0; i < 
MAXCOLORPLANES
; i++)

81 
iRows
[
i
] = 
m_pPM
->
ResŞutiÚX
[i] / m_pPM->
Ba£ResX
;

83 
uiResBoo¡
 = 
m_pPM
->
Ba£ResX
 / m_pPM->
Ba£ResY
;

84 ià(
uiResBoo¡
 == 0)

85 
uiResBoo¡
 = 1;

87 
width
 = 
m_pMA
->
´šbË_width
;

90 
pCŞÜM©ch”
 = 
Ãw
 
	`CŞÜM©ch”
(
m_pPM
->
cm­
, m_pPM->
dyeCouÁ
, 
width
);

91 
h—d
 = 
Ãw
 
	`P–še
(
pCŞÜM©ch”
);

93 
m_pH®áÚ”
 = 
Ãw
 
	`H®áÚ”
 (
m_pPM
, 
width
, 
iRows
, 
uiResBoo¡
, m_pPM->
eHT
 =ğ
MATRIX
);

94 
p
 = 
Ãw
 
	`P–še
(
m_pH®áÚ”
);

95 
h—d
->
	`AddPha£
(
p
);

97 
pMode2
 = 
Ãw
 
	`Mode2
(
width
);

98 
p
 = 
Ãw
 
	`P–še
(
pMode2
);

99 
h—d
->
	`AddPha£
(
p
);

100 
pMode2
->
my¶ªe
 = 
COLORTYPE_COLOR
;

102 *
p–še
 = 
h—d
;

103  
NO_ERROR
;

104 
	}
}

106 
DRIVER_ERROR
 
	gPş3Gui
::
	$S¹Page
(
JobA‰ribu‹s
 *
pJA
)

108 
DRIVER_ERROR
 
”r
 = 
NO_ERROR
;

109 
szSŒ
[256];

110 
tİ_m¬gš
 = 0;

111 
·ge_numb”
++;

115 
m_pJA
 = 
pJA
;

116 
m_pMA
 = &
pJA
->
medŸ_©Œibu‹s
;

117 
m_pQA
 = &
pJA
->
qu®™y_©Œibu‹s
;

121 
	`¥rštf
(
szSŒ
, "\033&l%dH\033&l%dM\033&l%dA\033*o%dM", 
m_pJA
->
medŸ_sourû
, 
m_pQA
->
medŸ_ty³
,

122 
m_pMA
->
pş_id
, 
m_pQA
->
´št_qu®™y
);

126 
i
 = 
	`¡¾’
(
szSŒ
);

127 
	`memıy
(
szSŒ
+
i
, 
MedŸSubty³Seq
, (MediaSubtypeSeq));

128 
i
 +ğ(
MedŸSubty³Seq
);

129 
szSŒ
[
i
++] = (è(
m_pQA
->
medŸ_subty³
 & 0xFFFF) >> 8;

130 
szSŒ
[
i
++] = (è
m_pQA
->
medŸ_subty³
 & 0xFF;

131 
	`addToH—d”
((cÚ¡ 
BYTE
 *è
szSŒ
, 
i
);

133 ià(
m_pJA
->
e_du¶ex_mode
 !ğ
DUPLEXMODE_NONE
) {

134 
	`addToH—d”
((cÚ¡ 
BYTE
 *è
EÇbËDu¶ex
, (EnableDuplex));

137 
	`cÚfigu»Ra¡”D©a
();

139 ià(
m_pJA
->
cŞÜ_mode
 != 0) {

141 
	`addToH—d”
((cÚ¡ 
BYTE
 *è
G¿ysÿËSeq
, 9);

142 *
cur_pş_bufãr_±r
++ = (
BYTE
è
m_pJA
->
cŞÜ_mode
;

145 ià(!
m_pPM
->
MixedRes
)

147 
	`¥rštf
(
szSŒ
,"\033&u%dD", 
m_pPM
->
Ba£ResX
);

148 
	`addToH—d”
((cÚ¡ 
BYTE
 *è
szSŒ
, 
	`¡¾’
(szStr));

149 
	`¥rštf
(
szSŒ
,"\033*t%dR", 
m_pPM
->
Ba£ResY
);

150 
	`addToH—d”
((cÚ¡ 
BYTE
 *è
szSŒ
, 
	`¡¾’
(szStr));

154 
width
 = 
m_pMA
->
´šbË_width
;

155 
	`¥rštf
(
szSŒ
, "\033*r%dS", 
width
);

156 
	`addToH—d”
((cÚ¡ 
BYTE
 *è
szSŒ
, 
	`¡¾’
(szStr));

162 ià(
m_pMA
->
pş_id
 =ğ
CUSTOM_MEDIA_SIZE
) {

163 
sWidth
, 
sHeight
;

164 
BYTE
 
b1
, 
b2
;

165 
sWidth
 = 
¡©ic_ÿ¡
<>(
m_pMA
->
physiÿl_width
);

166 
sHeight
 = 
¡©ic_ÿ¡
<>(
m_pMA
->
physiÿl_height
);

167 
	`memıy
 (
szSŒ
, "\x1B*o5W\x0E\x05\x00\x00\x00\x1B*o5W\x0E\x06\x00\x00\x00", 20);

168 
b1
 = (
BYTE
è((
sWidth
 & 0xFF00) >> 8);

169 
b2
 = (
BYTE
è(
sWidth
 & 0xFF);

170 
szSŒ
[8] = 
b1
;

171 
szSŒ
[9] = 
b2
;

172 
b1
 = (
BYTE
è((
sHeight
 & 0xFF00) >> 8);

173 
b2
 = (
BYTE
è(
sHeight
 & 0xFF);

174 
szSŒ
[18] = 
b1
;

175 
szSŒ
[19] = 
b2
;

176 
	`addToH—d”
((cÚ¡ 
BYTE
 *è
szSŒ
, 20);

179 
	`addToH—d”
((cÚ¡ 
BYTE
 *è
g¿fS¹
, (grafStart));

180 
	`addToH—d”
((cÚ¡ 
BYTE
 *è
g¿fMode2
, (grafMode2));

181 
	`addToH—d”
((cÚ¡ 
BYTE
 *è
£edSame
, (seedSame));

183 
tİ_m¬gš
 = 
m_pMA
->
´šbË_¡¬t_y
 - ((
m_pJA
->
mech_off£t
 * 
m_pQA
->
aùu®_v”tiÿl_»sŞutiÚ
)/1000);

184 
	`¥rštf
(
szSŒ
, "\x1b*p%dY", 
tİ_m¬gš
);

185 
	`addToH—d”
((cÚ¡ 
BYTE
 *è
szSŒ
, 
	`¡¾’
(szStr));

188 
	`addToH—d”
((cÚ¡ 
BYTE
 *) "\033&l-2H", 6);

190 
”r
 = 
	`£ndBufãr
(
¡©ic_ÿ¡
<cÚ¡ 
BYTE
 *>(
pş_bufãr
), (
cur_pş_bufãr_±r
 -…cl_buffer));

191 
cur_pş_bufãr_±r
 = 
pş_bufãr
;

192  
”r
;

193 
	}
}

195 
DRIVER_ERROR
 
	gPş3Gui
::
	$EnÿpsuÏ‹
(
RASTERDATA
 *
IÅutRa¡”
, 
boŞ
 
bLa¡PÏÃ
)

197 
DRIVER_ERROR
 
”r
 = 
NO_ERROR
;

198 
tmpSŒ
[16];

199 
iL’
;

200 
BYTE
 
c
 = 
m_pH®áÚ”
->
	`La¡PÏÃ
() ? 'W' : 'V';

202 
iL’
 = 
	`¥rštf
 (
tmpSŒ
, "\x1b*b%u%c", 
IÅutRa¡”
->
¿¡”size
[
COLORTYPE_COLOR
], 
c
);

203 
”r
 = 
this
->
	`S’d
((cÚ¡ 
BYTE
 *è
tmpSŒ
, 
iL’
);

204 ià(
”r
 =ğ
NO_ERROR
 && 
IÅutRa¡”
->
¿¡”size
[
COLORTYPE_COLOR
] > 0)

206 
”r
 = 
this
->
	`S’d
(
IÅutRa¡”
->
¿¡”d©a
[
COLORTYPE_COLOR
],

207 
IÅutRa¡”
->
¿¡”size
[
COLORTYPE_COLOR
]);

209  
”r
;

210 
	}
}

212 
	gPş3Gui
::
	$cŞÜLev–s
(
cŞÜ_¶ªe
)

214 
b™_d•th
 = 
m_pPM
->
CŞÜD•th
[
cŞÜ_¶ªe
];

215 
Ëv–s
 = 1;

216 
i
 = 0; i < 
b™_d•th
; i++)

218 
Ëv–s
 *= 2;

220  
Ëv–s
;

221 
	}
}

223 
	gPş3Gui
::
	$cÚfigu»Ra¡”D©a
()

225 ià(
m_pPM
 =ğ
NULL
)

227 
	`dbglog
("configureRasterData: m_pPM is NULL");

230 
BYTE
 *
p
 = 
cur_pş_bufãr_±r
;

232 *
p
++ = 0x1b;

233 *
p
++ = '*';

234 *
p
++ = 'g';

235 
p
 +ğ
	`¥rštf
((*èp, "%d", 
m_pPM
->
dyeCouÁ
 * 
MAXCOLORPLANES
 + 2);

236 *
p
++ = 'W';

237 *
p
++ = 2;

238 *
p
++ = 
m_pPM
->
dyeCouÁ
;

239 
¡¬t
 = 
K
;

240 ià(
m_pPM
->
dyeCouÁ
 == 3)

241 
¡¬t
 = 
C
;

243 
d•th
;

244 
cŞÜ
 = 
¡¬t
; cŞÜ < (¡¬ˆ+ 
m_pPM
->
dyeCouÁ
); color++)

246 *
p
++ = 
m_pPM
->
ResŞutiÚX
[
cŞÜ
] / 256;

247 *
p
++ = 
m_pPM
->
ResŞutiÚX
[
cŞÜ
] % 256;

248 *
p
++ = 
m_pPM
->
ResŞutiÚY
[
cŞÜ
] / 256;

249 *
p
++ = 
m_pPM
->
ResŞutiÚY
[
cŞÜ
] % 256;

250 
d•th
 = 
	`cŞÜLev–s
(
cŞÜ
);

251 *
p
++ = 
d•th
 / 256;

252 *
p
++ = 
d•th
 % 256;

255 
cur_pş_bufãr_±r
 = 
p
;

256 
	}
}

258 
boŞ
 
	gPş3Gui
::
	$£ËùPrštMode
()

260 ià(
m_pJA
->
´š‹r_¶©fÜm
[0] == 0)

262 
	`dbglog
("printer_platform is undefined");

263  
çl£
;

265 
i
 = 0; i < (
pş3_gui_´št_modes_bË
) / (pcl3_gui_print_modes_table[0]); i++)

267 ià(!
	`¡rcmp
(
m_pJA
->
´š‹r_¶©fÜm
, 
pş3_gui_´št_modes_bË
[
i
].
´š‹r_¶©fÜm_Çme
))

269  
	`£ËùPrštMode
(
i
);

272 
	`dbglog
("UnsuµÜ‹d…rš‹r_¶©fÜm: %s", 
m_pJA
->
´š‹r_¶©fÜm
);

273  
çl£
;

274 
	}
}

276 
boŞ
 
	gPş3Gui
::
	$£ËùPrštMode
(
šdex
)

278 
PrštMode
 *
p
 = 
pş3_gui_´št_modes_bË
[
šdex
].
´št_modes
;

279 
i
 = 0; i < 
pş3_gui_´št_modes_bË
[
šdex
].
couÁ
; i++, 
p
++)

281 ià(!
	`¡rcmp
(
m_pJA
->
qu®™y_©Œibu‹s
.
´št_mode_Çme
, 
p
->
Çme
))

283 
m_pPM
 = 
p
;

284  
Œue
;

287  
çl£
;

288 
	}
}

	@prnt/hpcups/Pcl3Gui.h

31 #iâdeà
PCL3GUI_H


32 
	#PCL3GUI_H


	)

34 
	~"CommÚDefš™iÚs.h
"

35 
	~"P–še.h
"

36 
	~"EnÿpsuÏtÜ.h
"

38 
şass
 
	gH®áÚ”
;

40 şas 
	cPş3Gui
: 
public
 
EnÿpsuÏtÜ


42 
public
:

43 
Pş3Gui
();

44 ~
Pş3Gui
();

45 
DRIVER_ERROR
 
EnÿpsuÏ‹
 (
RASTERDATA
 *
IÅutRa¡”
, 
boŞ
 
bLa¡PÏÃ
);

46 
DRIVER_ERROR
 
S¹Page
(
JobA‰ribu‹s
 *
pJA
);

47 
DRIVER_ERROR
 
CÚfigu»
(
P–še
 **
p–še
);

48 
	m´Ùeùed
:

49 
boŞ
 
	$ÃedPJLH—d”s
(
JobA‰ribu‹s
 *
pJA
)

51 ià(!
	`¡rcmp
(
m_pJA
->
´š‹r_¶©fÜm
, "dj970"))

53  
çl£
;

55  
Œue
;

57 
	`cÚfigu»Ra¡”D©a
 ();

58 
´iv©e
:

59 
boŞ
 
	`£ËùPrštMode
();

60 
boŞ
 
	`£ËùPrštMode
(
šdex
);

61 
	`cŞÜLev–s
(
cŞÜ_¶ªe
);

63 
PrštMode
 *
m_pPM
;

64 
H®áÚ”
 *
m_pH®áÚ”
;

65 
	}
};

	@prnt/hpcups/Pcl3Gui2.cpp

31 
	~"CommÚDefš™iÚs.h
"

32 
	~"Pş3Gui2.h
"

33 
	~"Eº›F‹r.h
"

34 
	~"Mode10.h
"

35 
	~"Mode9.h
"

36 
	~"Prš‹rCommªds.h
"

38 
	gPş3Gui2
::
	$Pş3Gui2
(è: 
	$EnÿpsuÏtÜ
()

40 
¥“d_mech_’abËd
 = 
Œue
;

41 
m_run_”n›_f‹r
 = 
Œue
;

42 
üd_ty³
 = 
eCrd_bÙh
;

43 
	`¡rıy
(
m_szLªguage
, "PCL3GUI");

44 
	}
}

46 
	gPş3Gui2
::~
	$Pş3Gui2
()

48 
	}
}

50 
DRIVER_ERROR
 
Pş3Gui2
::
	$CÚfigu»
(
P–še
 **
p–še
)

52 
P–še
 *
p
 = 
NULL
;

53 
P–še
 *
h—d
;

54 
width
;

55 
h—d
 = *
p–še
;

56 ià(
m_pJA
->
e_du¶ex_mode
 !ğ
DUPLEXMODE_NONE
 ||

57 
m_pJA
->
tÙ®_·ges
 < 3) {

58 
¥“d_mech_’abËd
 = 
çl£
;

61 
width
 = 
m_pMA
->
´šbË_width
;;

62 ià(
m_run_”n›_f‹r
) {

63 
Eº›F‹r
 *
pEº›
;

66 
th»shŞd
 = ((
m_pQA
->
hÜizÚl_»sŞutiÚ
 * 876) / 10000) - 2;

68 
pEº›
 = 
Ãw
 
	`Eº›F‹r
 (
width
, 
eBGRPix–D©a
, 
th»shŞd
);

69 
p
 = 
Ãw
 
	`P–še
 (
pEº›
);

70 ià(
h—d
) {

71 
h—d
->
	`AddPha£
 (
p
);

74 
h—d
 = 
p
;

78 ià(
üd_ty³
 !ğ
eCrd_bÏck_Úly
) {

79 
Mode10
 *
pMode10
;

80 
pMode10
 = 
Ãw
 
	`Mode10
 (
width
 * 3);

81 
pMode10
->
my¶ªe
 = 
COLORTYPE_COLOR
;

83 
p
 = 
Ãw
 
	`P–še
 (
pMode10
);

84 ià(
h—d
) {

85 
h—d
->
	`AddPha£
 (
p
);

88 
h—d
 = 
p
;

92 
width
 = (width + 7) / 8;

94 ià(
width
 > 0 && 
üd_ty³
 !ğ
eCrd_cŞÜ_Úly
) {

95 
Mode9
 *
pMode9
;

97 
pMode9
 = 
Ãw
 
	`Mode9
 (
width
);

98 
pMode9
->
my¶ªe
 = 
COLORTYPE_BLACK
;

99 
p
 = 
Ãw
 
	`P–še
 (
pMode9
);

100 ià(
h—d
) {

101 
h—d
->
	`AddPha£
 (
p
);

104 
h—d
 = 
p
;

107 *
p–še
 = 
h—d
;

108  
NO_ERROR
;

109 
	}
}

111 
DRIVER_ERROR
 
	gPş3Gui2
::
	$S¹Page
(
JobA‰ribu‹s
 *
pJA
)

113 
DRIVER_ERROR
 
”r
 = 
NO_ERROR
;

114 
szSŒ
[256];

115 
tİ_m¬gš
 = 0;

116 
un™_of_m—su»
 = 300;

117 
·ge_numb”
++;

121 
m_pJA
 = 
pJA
;

122 
m_pMA
 = &
pJA
->
medŸ_©Œibu‹s
;

123 
m_pQA
 = &
pJA
->
qu®™y_©Œibu‹s
;

127 
	`¥rštf
(
szSŒ
, "\033&l%dH\033&l%dM\033&l%dA\033*o%dM", 
m_pJA
->
medŸ_sourû
, 
m_pQA
->
medŸ_ty³
,

128 
m_pMA
->
pş_id
, 
m_pQA
->
´št_qu®™y
);

132 
i
 = 
	`¡¾’
(
szSŒ
);

133 
	`memıy
(
szSŒ
+
i
, 
MedŸSubty³Seq
, (MediaSubtypeSeq));

134 
i
 +ğ(
MedŸSubty³Seq
);

135 
szSŒ
[
i
++] = (è(
m_pQA
->
medŸ_subty³
 & 0xFFFF) >> 8;

136 
szSŒ
[
i
++] = (è
m_pQA
->
medŸ_subty³
 & 0xFF;

137 
	`addToH—d”
((cÚ¡ 
BYTE
 *è
szSŒ
, 
i
);

139 ià(
m_pJA
->
e_du¶ex_mode
 !ğ
DUPLEXMODE_NONE
) {

140 
	`addToH—d”
((cÚ¡ 
BYTE
 *è
EÇbËDu¶ex
, (EnableDuplex));

141 
¥“d_mech_’abËd
 = 
çl£
;

144 
	`cÚfigu»Ra¡”D©a
();

146 ià(
m_pJA
->
cŞÜ_mode
 != 0) {

148 
	`addToH—d”
((cÚ¡ 
BYTE
 *è
G¿ysÿËSeq
, 9);

149 *
cur_pş_bufãr_±r
++ = (
BYTE
è
m_pJA
->
cŞÜ_mode
;

152 
un™_of_m—su»
 = (
m_pQA
->
hÜizÚl_»sŞutiÚ
 < m_pQA->
aùu®_v”tiÿl_»sŞutiÚ
) ? m_pQA->horizontal_resolution : m_pQA->actual_vertical_resolution;

153 
	`¥rštf
(
szSŒ
,"\033&u%dD", 
un™_of_m—su»
);

154 
	`addToH—d”
((cÚ¡ 
BYTE
 *è
szSŒ
, 
	`¡¾’
(szStr));

157 
	`¥rštf
(
szSŒ
,"\033*t%dR", 
m_pQA
->
aùu®_v”tiÿl_»sŞutiÚ
);

158 
	`addToH—d”
((cÚ¡ 
BYTE
 *è
szSŒ
, 
	`¡¾’
(szStr));

161 
width
 = 
m_pMA
->
´šbË_width
;

162 
	`¥rštf
(
szSŒ
, "\033*r%dS", 
width
);

163 
	`addToH—d”
((cÚ¡ 
BYTE
 *è
szSŒ
, 
	`¡¾’
(szStr));

169 ià(
m_pMA
->
pş_id
 =ğ
CUSTOM_MEDIA_SIZE
) {

170 
sWidth
, 
sHeight
;

171 
BYTE
 
b1
, 
b2
;

172 
sWidth
 = 
¡©ic_ÿ¡
<>(
m_pMA
->
physiÿl_width
);

173 
sHeight
 = 
¡©ic_ÿ¡
<>(
m_pMA
->
physiÿl_height
);

174 
	`memıy
 (
szSŒ
, "\x1B*o5W\x0E\x05\x00\x00\x00\x1B*o5W\x0E\x06\x00\x00\x00", 20);

175 
b1
 = (
BYTE
è((
sWidth
 & 0xFF00) >> 8);

176 
b2
 = (
BYTE
è(
sWidth
 & 0xFF);

177 
szSŒ
[8] = 
b1
;

178 
szSŒ
[9] = 
b2
;

179 
b1
 = (
BYTE
è((
sHeight
 & 0xFF00) >> 8);

180 
b2
 = (
BYTE
è(
sHeight
 & 0xFF);

181 
szSŒ
[18] = 
b1
;

182 
szSŒ
[19] = 
b2
;

183 
	`addToH—d”
((cÚ¡ 
BYTE
 *è
szSŒ
, 20);

186 ià(
m_pJA
->
´št_bÜd”Ëss
) {

187 
BYTE
 
cBuf
[4];

190 ià(
m_pJA
->
HPSPDCÏss
 == 1)

192 
BYTE
 
TİOv”S´aySeq
[] = {0x1b, 0x2A, 0x6F, 0x35, 0x57, 0x0E, 0x0D, 0x00, 0x00, 0x01};

195 
	`addToH—d”
((cÚ¡ 
BYTE
 *è
TİOv”S´aySeq
, (TopOverSpraySeq));

199 
BYTE
 
TİOv”S´aySeq
[] = {0x1b, 0x2A, 0x6F, 0x35, 0x57, 0x0E, 0x02, 0x00};

202 
BYTE
 
LeáOv”S´aySeq
[] = {0x1b, 0x2A, 0x6F, 0x35, 0x57, 0x0E, 0x01, 0x00};

205 
cBuf
[1] = (
m_pMA
->
tİ_ov”¥¿y
) & 0xFF;

206 
cBuf
[0] = (
m_pMA
->
tİ_ov”¥¿y
) >> 8;

208 
	`addToH—d”
((cÚ¡ 
BYTE
 *è
TİOv”S´aySeq
, (TopOverSpraySeq));

209 
	`addToH—d”
((cÚ¡ 
BYTE
 *è
cBuf
, 2);

211 
cBuf
[1] = (
m_pMA
->
Ëá_ov”¥¿y
) & 0xFF;

212 
cBuf
[0] = (
m_pMA
->
Ëá_ov”¥¿y
) >> 8;

214 
	`addToH—d”
((cÚ¡ 
BYTE
 *è
LeáOv”S´aySeq
, (LeftOverSpraySeq));

215 
	`addToH—d”
((cÚ¡ 
BYTE
 *è
cBuf
, 2);

220 
	`addToH—d”
((cÚ¡ 
BYTE
 *) "\033&l-2H", 6);

223 
”r
 = 
	`£ndBufãr
(
¡©ic_ÿ¡
<cÚ¡ 
BYTE
 *>(
pş_bufãr
), (
cur_pş_bufãr_±r
 -…cl_buffer));

224 
cur_pş_bufãr_±r
 = 
pş_bufãr
;

228 ià(
¥“d_mech_’abËd
) {

229 
	`addToH—d”
(
¥“d_mech_cmd
,  (speed_mech_cmd));

230 *
cur_pş_bufãr_±r
++ = (
BYTE
è((
m_pJA
->
tÙ®_·ges
 & 0x0000FF00) >> 8);

231 *
cur_pş_bufãr_±r
++ = (
BYTE
è((
m_pJA
->
tÙ®_·ges
 & 0x000000FF));

232 ià(
·ge_numb”
 < 
m_pJA
->
tÙ®_·ges
) {

233 
	`addToH—d”
(
¥“d_mech_cÚtšue
,  (speed_mech_continue));

236 
	`addToH—d”
(
¥“d_mech_’d
,  (speed_mech_end));

240 
	`addToH—d”
((cÚ¡ 
BYTE
 *è
g¿fS¹
, (grafStart));

242 ià(!
m_pJA
->
´št_bÜd”Ëss
) {

243 
tİ_m¬gš
 = 
m_pMA
->
´šbË_¡¬t_y
 - ((
m_pJA
->
mech_off£t
 * 
m_pQA
->
aùu®_v”tiÿl_»sŞutiÚ
)/1000);

245 
	`addToH—d”
("\x1b*p%dY", 
tİ_m¬gš
);

246  
”r
;

247 
	}
}

249 
DRIVER_ERROR
 
	gPş3Gui2
::
	$EnÿpsuÏ‹
(
RASTERDATA
 *
IÅutRa¡”
, 
boŞ
 
bLa¡PÏÃ
)

251 
DRIVER_ERROR
 
”r
;

252 ià(
üd_ty³
 !ğ
eCrd_cŞÜ_Úly
) {

253 
”r
 = 
	`’ÿpsuÏ‹Ra¡”
(
IÅutRa¡”
->
¿¡”d©a
[
COLORTYPE_BLACK
], IÅutRa¡”->
¿¡”size
[COLORTYPE_BLACK], COLORTYPE_BLACK);

255 ià(
üd_ty³
 !ğ
eCrd_bÏck_Úly
) {

256 
”r
 = 
	`’ÿpsuÏ‹Ra¡”
(
IÅutRa¡”
->
¿¡”d©a
[
COLORTYPE_COLOR
], IÅutRa¡”->
¿¡”size
[COLORTYPE_COLOR], COLORTYPE_COLOR);

258  
”r
;

259 
	}
}

261 
DRIVER_ERROR
 
	gPş3Gui2
::
	$’ÿpsuÏ‹Ra¡”
(
BYTE
 *
¿¡”
, 
Ëngth
, 
COLORTYPE
 
c_ty³
)

263 
DRIVER_ERROR
 
”r
;

264 
sü©ch
[20];

265 
sü©chL’
;

266 
c
 = 'W';

267 ià(
üd_ty³
 =ğ
eCrd_cŞÜ_Úly
) {

268  
NO_ERROR
;

270 ià(
c_ty³
 =ğ
COLORTYPE_BLACK
 && 
üd_ty³
 =ğ
eCrd_bÙh
) {

271 
c
 = 'V';

273 
sü©chL’
 = 
	`¥rštf
(
sü©ch
, "\033*b%u%c", 
Ëngth
, 
c
);

274 
”r
 = 
this
->
	`S’d
((cÚ¡ 
BYTE
*è
sü©ch
, 
sü©chL’
);

275 ià(
”r
 =ğ
NO_ERROR
 && 
Ëngth
 > 0)

277 
”r
 = 
this
->
	`S’d
(
¿¡”
, 
Ëngth
);

279  
”r
;

280 
	}
}

282 
	gPş3Gui2
::
	$cÚfigu»Ra¡”D©a
()

284 
i
;

285 *
p
;

286 
£qu’ûs
[3][64];

287 
£q_sizes
[] = {(
üd_£qu’û_k
), (
üd_£qu’û_cŞÜ
),

288 (
üd_£qu’û_bÙh
)};

289 
	`memıy
(
£qu’ûs
[0], 
üd_£qu’û_k
, 
£q_sizes
[0]);

290 
	`memıy
(
£qu’ûs
[1], 
üd_£qu’û_cŞÜ
, 
£q_sizes
[1]);

291 
	`memıy
(
£qu’ûs
[2], 
üd_£qu’û_bÙh
, 
£q_sizes
[2]);

294 
i
 = 0; i < 3; i++) {

295 
p
 = 
£qu’ûs
[
i
] + 10;

296 *
p
++ = 
m_pQA
->
hÜizÚl_»sŞutiÚ
 / 256;

297 *
p
++ = 
m_pQA
->
hÜizÚl_»sŞutiÚ
 % 256;

298 *
p
++ = 
m_pQA
->
v”tiÿl_»sŞutiÚ
 / 256;

299 *
p
++ = 
m_pQA
->
v”tiÿl_»sŞutiÚ
 % 256;

301 
p
 = &
£qu’ûs
[2][18];

302 *
p
++ = 
m_pQA
->
hÜizÚl_»sŞutiÚ
 / 256;

303 *
p
++ = 
m_pQA
->
hÜizÚl_»sŞutiÚ
 % 256;

304 *
p
++ = 
m_pQA
->
v”tiÿl_»sŞutiÚ
 / 256;

305 *
p
++ = 
m_pQA
->
v”tiÿl_»sŞutiÚ
 % 256;

307 
	`memıy
(
cur_pş_bufãr_±r
, 
£qu’ûs
[
üd_ty³
], 
£q_sizes
[crd_type]);

308 
cur_pş_bufãr_±r
 +ğ
£q_sizes
[
üd_ty³
];

310 
	}
}

	@prnt/hpcups/Pcl3Gui2.h

31 #iâdeà
PCL3GUI2_H


32 
	#PCL3GUI2_H


	)

34 
	~"CommÚDefš™iÚs.h
"

35 
	~"P–še.h
"

36 
	~"EnÿpsuÏtÜ.h
"

40 
	meCrd_bÏck_Úly
,

41 
	meCrd_cŞÜ_Úly
,

42 
	meCrd_bÙh


43 } 
	teCrdTy³
;

45 şas 
	cPş3Gui2
: 
public
 
EnÿpsuÏtÜ


47 
public
:

48 
Pş3Gui2
();

49 ~
Pş3Gui2
();

50 
DRIVER_ERROR
 
EnÿpsuÏ‹
 (
RASTERDATA
 *
IÅutRa¡”
, 
boŞ
 
bLa¡PÏÃ
);

51 
DRIVER_ERROR
 
S¹Page
(
JobA‰ribu‹s
 *
pJA
);

52 
DRIVER_ERROR
 
CÚfigu»
(
P–še
 **
p–še
);

53 
boŞ
 
	$UÅackB™s
(è{ 
çl£
;}

55 
´Ùeùed
:

56 
vœtu®
 
boŞ
 
	$jobA‰rPJLAÎowed
(è{ 
Œue
;
	}
}

57 
cÚfigu»Ra¡”D©a
 ();

58 
	g´iv©e
:

60 
DRIVER_ERROR
 
’ÿpsuÏ‹Ra¡”
(
BYTE
 *
šput_¿¡”
, 
num_by‹s
, 
COLORTYPE
 
c_ty³
);

61 
boŞ
 
	g¥“d_mech_’abËd
;

62 
	g·ge_numb”
;

63 
boŞ
 
	gm_run_”n›_f‹r
;

64 
eCrdTy³
 
	güd_ty³
;

	@prnt/hpcups/Pcl3GuiPrintModes.h

1 
	~"CommÚDefš™iÚs.h
"

2 
	~"dj890PrštModes.h
"

3 
	~"dj895PrštModes.h
"

4 
	~"dj8x5PrštModes.h
"

5 
	~"dj970PrštModes.h
"

7 
PrštModeTabË
 
	gpş3_gui_´št_modes_bË
 [] =

9 {"dj890", 
dj890PrštModes
, (dj890PrštModes)/(
PrštMode
)},

10 {"dj895", 
dj895PrštModes
, (dj895PrštModes)/(
PrštMode
)},

11 {"dj8x5", 
dj8x5PrštModes
, (dj8x5PrštModes)/(
PrštMode
)},

12 {"dj970", 
dj970PrštModes
, (dj970PrštModes)/(
PrštMode
)}

	@prnt/hpcups/Pcl3PrintModes.h

1 
	~"CommÚDefš™iÚs.h
"

2 
	~"dj400PrštModes.h
"

3 
	~"dj540PrštModes.h
"

4 
	~"dj600PrštModes.h
"

5 
	~"dj630PrštModes.h
"

6 
	~"dj690PrštModes.h
"

7 
	~"­PrštModes.h
"

8 
	~"dj850PrštModes.h
"

10 
PrštModeTabË
 
	gpş3_´št_modes_bË
 [] =

12 {"dj400", 
dj400PrštModes
, (dj400PrštModes)/(
PrštMode
)},

13 {"dj540", 
dj540PrštModes
, (dj540PrštModes)/(
PrštMode
)},

14 {"dj600", 
dj600PrštModes
, (dj600PrštModes)/(
PrštMode
)},

15 {"dj630", 
dj630PrštModes
, (dj630PrštModes)/(
PrštMode
)},

16 {"dj690", 
dj690PrštModes
, (dj690PrštModes)/(
PrštMode
)},

17 {"­Şlo2xxx", 
­PrštModes
, ×pPrštModes)/(
PrštMode
)},

18 {"dj850", 
dj850PrštModes
, (dj850PrštModes)/(
PrštMode
)}

	@prnt/hpcups/Pipeline.cpp

37 
	~"P–še.h
"

38 
boŞ
 
	gP–še
::
	$NextOuutRa¡”
(
RASTERDATA
& 
Ãxt_¿¡”
)

40  
Exec
->
	`NextOuutRa¡”
(
Ãxt_¿¡”
);

41 
	}
}

42 
	gP–še
::
	$G‘MaxOuutWidth
()

44  
Exec
->
	`G‘MaxOuutWidth
();

45 
	}
}

49 
	gP–še
::
	$P–še
 (
ProûssÜ
 *
E
) :

50 
	`Ãxt
(
NULL
),

51 
	$´ev
(
NULL
) {

52 
Exec
 = 
E
;

53 
Exec
->
mypha£
 = 
this
;

54 
	}
}

56 
	gP–še
::
	$AddPha£
 (
P–še
 *
Ãwp
) {

57 
P–še
 *
p
 = 
this
;

58 
p
->
Ãxt
) {

59 
p
 =…->
Ãxt
;

61 
p
->
Ãxt
 = 
Ãwp
;

62 
Ãwp
->
´ev
 = 
p
;

63 
	}
}

65 
	gP–še
::~
	$P–še
 ()

67 
	}
}

70 
boŞ
 
P–še
::
	$Proûss
 (
RASTERDATA
 *
¿¡”
)

72  
Exec
->
	`Proûss
 (
¿¡”
);

73 
	}
}

76 
DRIVER_ERROR
 
	gP–še
::
	$Execu‹
 (
RASTERDATA
 *
IÅutRa¡”
)

78 
”r
 = 
NO_ERROR
;

79 ià(
	`Proûss
 (
IÅutRa¡”
)

80 && (
”r
 =ğ
NO_ERROR
)) {

81 ià(
Ãxt
) {

82  
	`NextOuutRa¡”
Ğ
Ãxt
->
Exec
->
¿¡”
 ) ) {

83 
”r
 = 
Ãxt
->
	`Execu‹
(&Òext->
Exec
->
¿¡”
));

84 
ERRCHECK
;

88  
”r
;

89 
	}
}

92 
DRIVER_ERROR
 
	gP–še
::
	$Flush
 ()

94 
”r
 = 
NO_ERROR
;

96 
Exec
->
	`Flush
 ();

98 ià(
Ãxt
 && (
”r
 =ğ
NO_ERROR
)) {

99  
	`NextOuutRa¡”
Ğ
Ãxt
->
Exec
->
¿¡”
 ) ) {

100 
”r
 = 
Ãxt
->
	`Execu‹
(&Òext->
Exec
->
¿¡”
));

101 
ERRCHECK
;

104 
”r
 = 
Ãxt
->
	`Flush
 ();

106  
”r
;

107 
	}
}

	@prnt/hpcups/Pipeline.h

31 #iâdeà
PIPELINE_H


32 
	#PIPELINE_H


	)

34 
	~"CommÚDefš™iÚs.h
"

35 
	~"ProûssÜ.h
"

37 
şass
 
	gProûssÜ
;

39 şas 
	cP–še


41 
	mpublic
:

42 
P–še
(
ProûssÜ
* 
E
);

43 
	mvœtu®
 ~
P–še
();

45 
AddPha£
(
P–še
* 
p
);

46 
DRIVER_ERROR
 
Execu‹
(
RASTERDATA
* 
IÅutRa¡”
=
NULL
);

47 
DRIVER_ERROR
 
Flush
();

48 
boŞ
 
Proûss
(
RASTERDATA
* 
IÅutRa¡”
=
NULL
);

49 
boŞ
 
NextOuutRa¡”
(
RASTERDATA
& 
Ãxt_¿¡”
);

50 
G‘MaxOuutWidth
();

52 
P–še
* 
	mÃxt
;

53 
P–še
* 
	m´ev
;

55 
ProûssÜ
* 
	mExec
;

57 
DRIVER_ERROR
 
	m”r
;

	@prnt/hpcups/PrinterCommands.h

31 #iâdeà
PRINTER_COMMANDS_H


32 
	#PRINTER_COMMANDS_H


	)

34 cÚ¡ 
BYTE
 
	gUEL
[] = {0x1b, '%', '-','1','2','3','4','5','X' };

35 cÚ¡ 
BYTE
 
	gEÁ”Lªguage
[] = {'@','P','J','L',' ','E','N','T','E','R',' ',

37 cÚ¡ 
BYTE
 
	gRe£t
[] = {0x1b,'E'};

38 cÚ¡ 
	gPJLEx™
[] = "\x1b%-12345X@PJL EOJ\012\x1b%-12345X";

39 cÚ¡ 
BYTE
 
	gg¿fS¹
[5] = {0x1b, '*', 'r', '1', 'A'};

40 cÚ¡ 
BYTE
 
	gg¿fMode2
[5] = {0x1b, '*', 'b', '2', 'M'};

41 cÚ¡ 
BYTE
 
	gg¿fMode3
[5] = {0x1b, '*', 'b', '3', 'M'};

42 cÚ¡ 
BYTE
 
	gg¿fMode9
[5] = {0x1b, '*', 'b', '9', 'M'};

43 cÚ¡ 
BYTE
 
	g£edSame
[5] = {0x1b, '*', 'b', '0', 'S'};

44 cÚ¡ 
BYTE
 
	gG¿ysÿËSeq
[10] = {0x1b, '*', 'o', '5', 'W', 0x0B, 0x01, 0x00, 0x00, 0x02};

45 cÚ¡ 
BYTE
 
	gMedŸSubty³Seq
[8] = {0x1b, 0x2A, 0x6F, 0x35, 0x57, 0x0D, 0x03, 0x00};

47 cÚ¡ 
BYTE
 
	gEÇbËDu¶ex
[5] = {0x1b,'&','l', '2', 'S'};

48 cÚ¡ 
BYTE
 
	gExŒaDryTime
[21] = {0x1b, '&', 'b', '1', '6', 'W', 'P', 'M', 'L', ' ',

51 cÚ¡ 
BYTE
 
	güd_£qu’û_k
[18] = {0x1b, 0x2a, 0x67, 0x31, 0x32, 0x57, 0x06, 0x1F, 0x00, 0x01,

56 cÚ¡ 
BYTE
 
	güd_£qu’û_cŞÜ
[18] = {0x1b, 0x2a, 0x67, 0x31, 0x32, 0x57, 0x06, 0x07, 0x00, 0x01,

61 cÚ¡ 
BYTE
 
	güd_£qu’û_bÙh
[26] = {0x1b, 0x2a, 0x67, 0x32, 0x30, 0x57, 0x06, 0x1F, 0x00, 0x02,

67 cÚ¡ 
BYTE
 
	g¥“d_mech_cmd
[8] = {0x1B, '*', 'o', '5', 'W', 0x0D, 0x02, 0x00};

68 cÚ¡ 
BYTE
 
	g¥“d_mech_’d
[10] = {0x1B, '*', 'o', '5', 'W', 0x0D, 0x05, 0x00, 0x00, 0x01};

69 cÚ¡ 
BYTE
 
	g¥“d_mech_cÚtšue
[10] = {0x1B, '*', 'o', '5', 'W', 0x0D, 0x05, 0x00, 0x00, 0x00};

70 cÚ¡ 
BYTE
 
	gbÏck_exŒaù_off
[10] = {0x1B, '*', 'o', '5', 'W', 0x04, 0xC, 0, 0, 0};

71 cÚ¡ 
BYTE
 
	gFRBegšSessiÚ
[] = {0xC0, 0x00, 0xF8, 0x86, 0xC0, 0x03, 0xF8, 0x8F, 0xD1, 0x58,

73 cÚ¡ 
BYTE
 
	gFRF“dOr›Á©iÚ
[] = {0xC0, 0x00 , 0xF8, 0x28 };

75 cÚ¡ 
BYTE
 
	gFRP­”Size
[] = {0xC0, 0x00 ,0xF8, 0x25};

77 cÚ¡ 
BYTE
 
	gFRCu¡omMedŸSize
[] = {0xC0, 0x00, 0xF8, 0x30};

78 cÚ¡ 
BYTE
 
	gFRMedSourû
[] = {0xC0, 0x00 ,0xF8, 0x26};

80 cÚ¡ 
BYTE
 
	gFRMedDe¡š©iÚ
[] = {0xC0, 0x00 ,0xF8 , 0x24};

82 cÚ¡ 
BYTE
 
	gFRBegšPage
[] = {0x43, 0xD3, 0x00, 0x00, 0x00, 0x00, 0xF8, 0x2A, 0x75, 0xC0, 0x07,

85 cÚ¡ 
BYTE
 
	gFRBegšImage
[] = {0xC2, 0x00, 0x40, 0x70, 0x68, 0xF8, 0x91, 0xC1};

87 cÚ¡ 
BYTE
 
	gFRVUv”Tag
[] = {0xC2, 0x00, 0x00, 0x04, 0x00 , 0xF8, 0x95};

89 cÚ¡ 
BYTE
 
	gFRD©aL’gth
[] = {0xC2, 0x86, 0x0A, 0x00, 0x00, 0xF8, 0x92};

91 cÚ¡ 
BYTE
 
	gFRV’dÜUniq
[] = {0x46};

92 cÚ¡ 
BYTE
 
	gFRVUExŠ3
[] = {0xC2, 0x11, 0x20, 0x70, 0x68 ,0xF8, 0x91};

94 cÚ¡ 
BYTE
 
	gFRO³nD©aSourû
[] = {0xC0, 0x00, 0xF8, 0x88, 0xC0, 0x01, 0xF8, 0x82, 0x48};

95 cÚ¡ 
BYTE
 
	gFREÁ”FRMode
[] = {0xC2, 0x06, 0x20, 0x70,0x68, 0xF8, 0x91, 0xC2};

96 cÚ¡ 
BYTE
 
	gFREndPage
[] = {0x44};

97 cÚ¡ 
BYTE
 
	gFREndSessiÚ
[] = {0x42};

98 cÚ¡ 
BYTE
 
	gFRClo£D©aSourû
[] = {0x49};

100 cÚ¡ 
BYTE
 
	gJRBegšSessiÚSeq
[] = {0xC0, 0x00, 0xF8, 0x86, 0xC0, 0x03, 0xF8, 0x8F, 0xD1, 0x58,

102 cÚ¡ 
BYTE
 
	gJRF“dOr›Á©iÚSeq
[] = {0xC0, 0x00, 0xF8, 0x28 };

104 cÚ¡ 
BYTE
 
	gJRP­”SizeSeq
[] = {0xC0, 0x00, 0xF8, 0x25};

106 cÚ¡ 
BYTE
 
	gJRCu¡omP­”SizeSeq
[] = {0xF8, 0x2F, 0xC0, 0x00, 0xF8, 0x30};

107 cÚ¡ 
BYTE
 
	gJRMedŸSourûSeq
[] = {0xC0, 0x00, 0xF8, 0x26};

109 cÚ¡ 
BYTE
 
	gJRMedŸDe¡š©iÚSeq
[] = {0xC0, 0x00, 0xF8, 0x24};

111 cÚ¡ 
BYTE
 
	gJRBegšPageSeq
[] = {0x43, 0xD3, 0x64, 0x00, 0x64, 0x00, 0xF8, 0x2A, 0x75, 0xD3,

113 cÚ¡ 
BYTE
 
	gJRBegšImageSeq
[] = {0xC2, 0x00, 0x40, 0x70, 0x68, 0xF8, 0x91, 0xC1};

114 cÚ¡ 
BYTE
 
	gJRR—dImageSeq
[] = {0xC2, 0x01, 0x40, 0x70, 0x68, 0xF8, 0x91, 0xC1};

115 cÚ¡ 
BYTE
 
	gJRSŒHeightSeq
[] = {0xF8, 0x6D, 0xC1, 0x80, 0x00, 0xF8, 0x63};

116 cÚ¡ 
BYTE
 
	gJRTextObjeùTy³Seq
[] = {0xC0, 0x00, 0xF8, 0x96};

118 cÚ¡ 
BYTE
 
	gJRICESeq
[] = {0xC0, 0x00, 0xF8, 0x98};

120 cÚ¡ 
BYTE
 
	gJRVueV”siÚTagSeq
[] = {0xC2, 0x00, 0x00, 0x04, 0x00 , 0xF8, 0x95};

122 cÚ¡ 
BYTE
 
	gJRD©aL’gthSeq
[] = {0xC2, 0x86, 0x0A, 0x00, 0x00, 0xF8, 0x92};

124 cÚ¡ 
BYTE
 
	gJRV’dÜUniqueSeq
[] = {0x46};

125 cÚ¡ 
BYTE
 
	gJRVueExŠ3Seq
[] = {0xC2, 0x02, 0x40, 0x70, 0x68, 0xF8, 0x91 };

127 cÚ¡ 
BYTE
 
	gJREndPageSeq
[] = {0x44};

128 cÚ¡ 
BYTE
 
	gJREndSessiÚSeq
[] = {0x42};

130 cÚ¡ 
BYTE
 
	gJRQTSeq
[] = {0x00, 0x80, 0x00, 0x03, 0x00, 0x00};

131 cÚ¡ 
BYTE
 
	gJRCRSeq
[] = {0x01, 0x80, 0x2C, 0x00, 0x00, 0x00};

132 cÚ¡ 
BYTE
 
	gJRCR1GSeq
[] = {0x05, 0xE0, 0x00, 0x00};

133 cÚ¡ 
BYTE
 
	gJRCR1CSeq
[] = {0x01, 0xE0, 0x14, 0x66};

135 cÚ¡ 
BYTE
 
	gJRSCSeq
[][4] =

166 cÚ¡ 
BYTE
 
	gLdlRe£t
[] = {0x24, 0x00, 0x10, 0x00, 0x06, 0x00, 0x00, 0x00,

168 cÚ¡ 
BYTE
 
	gLdlSync
[] = {0x24, 0x01, 0x00, 0x00, 0x07, 0x00, 0x00, 0x00,

170 cÚ¡ 
BYTE
 
	gLdlSyncCom¶‘e
[] = {0x24, 0x00, 0x10, 0x00, 0x08, 0x00, 0x00, 0x00,

172 cÚ¡ 
BYTE
 
	gLdlCÚtšue
[] = {0x24, 0x00, 0x10, 0x00, 0x00, 0x0C, 0x00, 0x00,

174 cÚ¡ 
BYTE
 
	gLdlP»·»ToCªûl
[] = {0x24, 0x00, 0x10, 0x00, 0x00, 0x0C, 0x00, 0x00,

	@prnt/hpcups/Processor.cpp

31 
	~"ProûssÜ.h
"

33 
	gProûssÜ
::
	$ProûssÜ
(è: 
	`iRa¡”sR—dy
(0), 
	`iRa¡”sD–iv”ed
(0), 
	`mypha£
(
NULL
), 
	$my¶ªe
(
COLORTYPE_BOTH
)

35 
i
 = 
COLORTYPE_COLOR
; i < 
MAX_COLORTYPE
; i++)

37 
¿¡”
.
¿¡”d©a
[
i
] = 
NULL
;

38 
¿¡”
.
¿¡”size
[
i
] = 0;

40 
	}
}

43 
	gProûssÜ
::~
	$ProûssÜ
()

46 
	}
}

	@prnt/hpcups/Processor.h

31 #iâdeà
PROCESSOR_H


32 
	#PROCESSOR_H


	)

34 
	~"CommÚDefš™iÚs.h
"

35 
şass
 
	gP–še
;

36 şas 
	cProûssÜ


38 
	mpublic
:

39 
ProûssÜ
();

40 
	mvœtu®
 ~
ProûssÜ
();

42 
vœtu®
 
boŞ
 
Proûss
(
RASTERDATA
 *
IÅutRa¡”
=
NULL
)=0;

43 
vœtu®
 
Flush
()=0;

44 
vœtu®
 
boŞ
 
NextOuutRa¡”
(
RASTERDATA
& 
Ãxt_¿¡”
)=0;

45 
vœtu®
 
G‘MaxOuutWidth
() = 0;

47 
	miRa¡”sR—dy
, 
	miRa¡”sD–iv”ed
;

48 
P–še
* 
	mmypha£
;

49 
COLORTYPE
 
	mmy¶ªe
;

50 
RASTERDATA
 
	m¿¡”
;

	@prnt/hpcups/QuickConnect.cpp

31 
	~"EnÿpsuÏtÜ.h
"

32 
	~"QuickCÚÃù.h
"

33 
	~"ModeJ³g.h
"

35 
	gQuickCÚÃù
::
	$QuickCÚÃù
(è: 
	$EnÿpsuÏtÜ
()

37 
	}
}

39 
QuickCÚÃù
::~
	$QuickCÚÃù
()

41 
	}
}

43 
DRIVER_ERROR
 
QuickCÚÃù
::
	$S¹Job
(
Sy¡emS”viûs
 *
pSy¡emS”viûs
, 
JobA‰ribu‹s
 *
pJA
)

45 
m_pSy¡emS”viûs
 = 
pSy¡emS”viûs
;

46 
m_pJA
 = 
pJA
;

47 
m_pMA
 = &
pJA
->
medŸ_©Œibu‹s
;

48 
m_pQA
 = &
pJA
->
qu®™y_©Œibu‹s
;

49  
NO_ERROR
;

50 
	}
}

52 
DRIVER_ERROR
 
	gQuickCÚÃù
::
	$CÚfigu»
(
P–še
 **
p–še
)

54 
P–še
 *
h—d
;

55 
ModeJ³g
 *
pModeJ³g
;

56 
pModeJ³g
 = 
Ãw
 
	`ModeJ³g
(
m_pMA
->
´šbË_width
);

57 ià(
pModeJ³g
 =ğ
NULL
)

59  
ALLOCMEM_ERROR
;

63 
pModeJ³g
->
my¶ªe
 = 
COLORTYPE_COLOR
;

64 
pModeJ³g
->
	`In™
(
m_pJA
->
š‹g”_v®ues
[1], 
m_pMA
->
´šbË_height
);

65 
h—d
 = 
Ãw
 
	`P–še
(
pModeJ³g
);

66 *
p–še
 = 
h—d
;

67  
NO_ERROR
;

68 
	}
}

70 
DRIVER_ERROR
 
	gQuickCÚÃù
::
	$S¹Page
(
JobA‰ribu‹s
 *
pJA
)

72 
szSŒ
[632];

73 
DRIVER_ERROR
 
”r
;

74 cÚ¡ *
szPJLH—d”
 = "\x1B\x45\x1B%-12345X@PJL ENTER LANGUAGE=PHOTOJPEG\012";

75 
	`mem£t
(
szSŒ
, 0, 600);

76 
”r
 = 
m_pSy¡emS”viûs
->
	`S’d
((cÚ¡ 
BYTE
 *è
szSŒ
, 600);

77 
	`¥rštf
(
szSŒ
, "%s@PJL SET COPIES=%d\012@PJL SET JOBID=%d\012", 
szPJLH—d”
, 1, 
m_pJA
->
job_id
);

78 
	`¥rštf
(
szSŒ
+
	`¡¾’
(szStr),

80 
m_pMA
->
pş_id
, 
m_pQA
->
medŸ_ty³
, m_pQA->
´št_qu®™y
, 
m_pJA
->
š‹g”_v®ues
[2]);

81 
”r
 = 
m_pSy¡emS”viûs
->
	`S’d
((cÚ¡ 
BYTE
 *è
szSŒ
, 
	`¡¾’
(szStr));

82  
”r
;

83 
	}
}

85 
DRIVER_ERROR
 
	gQuickCÚÃù
::
	$EnÿpsuÏ‹
(
RASTERDATA
 *
IÅutRa¡”
, 
boŞ
 
bLa¡PÏÃ
)

87 
DRIVER_ERROR
 
”r
;

88 cÚ¡ *
szPJLEndJob
 = "\x1B\x45\x1B%-12345X";

89 
h—d”_size
 = 0;

90 ià(
IÅutRa¡”
->
¿¡”d©a
[
COLORTYPE_COLOR
] =ğ
NULL
)

92  
NO_ERROR
;

95 
”r
 = 
	`£ndExifH—d”
(
IÅutRa¡”
->
¿¡”d©a
[
COLORTYPE_COLOR
], &
h—d”_size
);

96 ià(
”r
 !ğ
NO_ERROR
)

98  
”r
;

100 
”r
 = 
m_pSy¡emS”viûs
->
	`S’d
((cÚ¡ 
BYTE
 *è
IÅutRa¡”
->
¿¡”d©a
[
COLORTYPE_COLOR
] + 
h—d”_size
,

101 
IÅutRa¡”
->
¿¡”size
[
COLORTYPE_COLOR
] - 
h—d”_size
);

102 ià(
”r
 =ğ
NO_ERROR
)

104 
”r
 = 
m_pSy¡emS”viûs
->
	`S’d
((cÚ¡ 
BYTE
 *è
szPJLEndJob
, 
	`¡¾’
(szPJLEndJob));

106  
”r
;

107 
	}
}

109 
DRIVER_ERROR
 
	gQuickCÚÃù
::
	$£ndExifH—d”
(
BYTE
 *
j³g_bufãr
, *
h—d”_size
)

111 
DRIVER_ERROR
 
”r
;

112 
BYTE
 *
pBufãr
 = 
j³g_bufãr
;

131 
Aµ2
[] = {"\xFF\xE2\x00\x23\x48\x50\x51\x43\x00\x00\x01\x00\x02"};

132 
szAµ2M¬k”s
[2][12];

133 
iNumTags
 = 0;

134 
iO±s
[2];

138 
iO±s
[0] = 
m_pJA
->
š‹g”_v®ues
[4];

139 
iO±s
[1] = 
m_pJA
->
š‹g”_v®ues
[3];

141 
skey
;

142 
szTag
[] = {"\x00\x01\x00\x03\x00\x00\x00\x01\x00\x00\x00\x01"};

143 
iV®
;

145 
skey
 = 1; skey <= 2; skey++)

147 
szTag
[0] = (
BYTE
è((
skey
 & 0xFF) >> 8);

148 
szTag
[1] = (
BYTE
è(
skey
 & 0xFF);

150 
iV®
 = 
iO±s
[
skey
];

151 
szTag
[8] = (
BYTE
è((
iV®
 >> 24) & 0xFF);

152 
szTag
[9] = (
BYTE
è((
iV®
 >> 16) & 0xFF);

153 
szTag
[10] = (
BYTE
è((
iV®
 >> 8) & 0xFF);

154 
szTag
[11] = (
BYTE
è(
iV®
 & 0xFF);

155 
	`memıy
 (
szAµ2M¬k”s
[
iNumTags
], 
szTag
, 12);

156 
iNumTags
++;

158 
skey
 = (è
iNumTags
 * 12 + 11;

159 
Aµ2
[2] = (
BYTE
è((
skey
 >> 8) & 0xFF);

160 
Aµ2
[3] = (
BYTE
è(
skey
 & 0xFF);

161 
Aµ2
[11] = (
BYTE
è((
iNumTags
 >> 8) & 0xFF);

162 
Aµ2
[12] = (
BYTE
è(
iNumTags
 & 0xFF);

181 
sJFIFH—d”Size
 = ((((è
pBufãr
[4]) << 8) |…Buffer[5]) + 4;

182 
”r
 = 
m_pSy¡emS”viûs
->
	`S’d
 ((cÚ¡ 
BYTE
 *è
pBufãr
, 
sJFIFH—d”Size
);

183 ià(
”r
 !ğ
NO_ERROR
)

185  
”r
;

188 *
h—d”_size
 = 
sJFIFH—d”Size
;

190 ià(
iNumTags
 != 0)

192 
”r
 = 
m_pSy¡emS”viûs
->
	`S’d
 ((cÚ¡ 
BYTE
 *è
Aµ2
, 13);

193 
i
 = 0; i < 
iNumTags
; i++)

195 
”r
 = 
m_pSy¡emS”viûs
->
	`S’d
 ((cÚ¡ 
BYTE
 *è
szAµ2M¬k”s
[
i
], 12);

198  
”r
;

199 
	}
}

	@prnt/hpcups/QuickConnect.h

31 #iâdeà
QUICK_CONNECT_H


32 
	#QUICK_CONNECT_H


	)

34 şas 
	cQuickCÚÃù
: 
public
 
EnÿpsuÏtÜ


36 
public
:

37 
QuickCÚÃù
();

38 ~
QuickCÚÃù
();

39 
DRIVER_ERROR
 
EnÿpsuÏ‹
(
RASTERDATA
 *
IÅutRa¡”
, 
boŞ
 
bLa¡PÏÃ
);

40 
DRIVER_ERROR
 
S¹Job
(
Sy¡emS”viûs
 *
pSy¡emS”viûs
, 
JobA‰ribu‹s
 *
pJA
);

41 
DRIVER_ERROR
 
S¹Page
(
JobA‰ribu‹s
 *
pJA
);

42 
DRIVER_ERROR
 
CÚfigu»
(
P–še
 **
p–še
);

43 
DRIVER_ERROR
 
	$S’dCAPy
(
iOff£t
è{ 
NO_ERROR
;}

44 
DRIVER_ERROR
 
	$FÜmF“d
(è{ 
NO_ERROR
;
	}
}

45 
DRIVER_ERROR
 
	$EndJob
(è{ 
NO_ERROR
;
	}
}

46 
DRIVER_ERROR
 
	$CËªup
(è{ 
NO_ERROR
;
	}
}

47 
boŞ
 
	$CªSkRa¡”s
(è{ 
çl£
;
	}
}

48 
	g´Ùeùed
:

49 
boŞ
 
	$ÃedPJLH—d”s
(
JobA‰ribu‹s
 *
pJA
)

51  
çl£
;

52 
	}
}

53 
DRIVER_ERROR
 
	$addJobS‘tšgs
(è{ 
NO_ERROR
;
	}
}

54 
DRIVER_ERROR
 
	$æushPrš‹rBufãr
(è{ 
NO_ERROR
;
	}
}

55 
	g´iv©e
:

56 
DRIVER_ERROR
 
£ndExifH—d”
(
BYTE
 *
j³g_d©a
, *
h—d”_size
);

	@prnt/hpcups/RasterSender.cpp

31 
	~"Ra¡”S’d”.h
"

32 
	~"P–še.h
"

34 
	gRa¡”S’d”
::
	$Ra¡”S’d”
 (
EnÿpsuÏtÜ
 *
pEnÿp
)

36 
’ÿp
 = 
pEnÿp
;

37 
	}
}

39 
	gRa¡”S’d”
::~
	$Ra¡”S’d”
()

41 
	}
}

44 
boŞ
 
Ra¡”S’d”
::
	$Proûss
 (
RASTERDATA
* 
IÅutRa¡”
)

46 
DRIVER_ERROR
 
”r
 = 
NO_ERROR
;

47 
boŞ
 
bOuut
 = 
çl£
;

48 
”r
 = 
’ÿp
->
	`EnÿpsuÏ‹
 (
IÅutRa¡”
, 
Œue
);

49 ià(
”r
 =ğ
NO_ERROR
)

50 
bOuut
 = 
Œue
;

51 
mypha£
->
”r
 =ƒrr;

52  
bOuut
;

53 
	}
}

	@prnt/hpcups/RasterSender.h

31 #iâdeà
RASTERSENDER_H


32 
	#RASTERSENDER_H


	)

34 
	~"CommÚDefš™iÚs.h
"

35 
	~"ProûssÜ.h
"

36 
	~"EnÿpsuÏtÜ.h
"

38 şas 
	cRa¡”S’d”
 : 
public
 
ProûssÜ


40 
public
:

42 
Ra¡”S’d”
 (
EnÿpsuÏtÜ
 *
pEnÿp
);

44 ~
Ra¡”S’d”
();

47 
boŞ
 
Proûss
(
RASTERDATA
* 
IÅutRa¡”
=
NULL
);

48 
	$Flush
() { };

49 
boŞ
 
	$NextOuutRa¡”
(
RASTERDATA
& 
Ãxt_¿¡”
è{  
çl£
; 
	}
}

50 
	$G‘MaxOuutWidth
(è{  0; 
	}
}

51 
	g´iv©e
:

52 
EnÿpsuÏtÜ
 *
’ÿp
;

	@prnt/hpcups/RunLenEncoding.cpp

1 
	~"commÚ_defšes.h
"

2 
	~"RunL’Encodšg.h
"

3 
	~<š‰y³s.h
>

9 
	$HPRunL’_Encode
(
uby‹
 *
š
, uby‹ *
out
, 
šL’gth
)

19 
uby‹
 *
imgPŒ
=
š
;

20 
uby‹
 *
’dPŒ
=
š
+
šL’gth
;

21 
uby‹
 *
ÜigOut
=
out
;

22 
uby‹
 
c
;

23 
sšt32
 
út
=0;

25 
ušt64_t
 
ËnLeá
;

27 (
imgPŒ
+1)<
’dPŒ
)

29 
ËnLeá
=
’dPŒ
-
imgPŒ
;

30 
c
=*
imgPŒ
++;

31 
út
=1;

34 
út
<
ËnLeá
 && *
imgPŒ
==
c
)

36 if(
imgPŒ
>
’dPŒ
)

38 
út
++;

39 
imgPŒ
++;

48 if(
út
>1)

51 
út
>128)

53 *
out
++=129;

54 *
out
++=
c
;

55 
út
-=128;

58 if(
út
)

60 *
out
++=(257-
út
);

61 *
out
++=
c
;

70 
uby‹
 *
¡¬t
, *
p
;

71 
sšt32
 
i
;

72 
¡¬t
=(
imgPŒ
-1);

75 
út
=1,
p
=
¡¬t
;(
imgPŒ
<
’dPŒ
) ;p++,imgPtr++,cnt++)

76 if(*
p
==*
imgPŒ
)

78 if(!((
imgPŒ
)==
’dPŒ
è&& (
út
 != 1))

79 
imgPŒ
--;

80 
út
--;

83 
út
>128)

85 *
out
++=127;

86 
i
=0;i<128;i++)

87 *
out
++=*
¡¬t
++;

88 
út
-=128;

91 *
out
++=
út
-1;

92 
i
=0;i<
út
;i++)

93 *
out
++=*
¡¬t
++;

97 *
out
++=128;

99 (()(
out
-
ÜigOut
));

100 
	}
}

	@prnt/hpcups/RunLenEncoding.h

11 #iâdeà
_RLE_H_


12 
	#_RLE_H_


	)

15 
HPRunL’_Encode
(
uby‹
 *
šFe
, uby‹ *
outFe
, 
de¡Size
);

	@prnt/hpcups/Scaler.cpp

31 
	~"CommÚDefš™iÚs.h
"

32 
	~"ProûssÜ.h
"

33 
	~"SÿËr.h
"

35 
	#MAX_OUTPUT_RASTERS
 32

	)

37 
	gSÿËr
::
	$SÿËr
(
šputwidth
, 
num”©Ü
,

38 
d’omš©Ü
, 
boŞ
 
bVIP
, 
By‹sP”Pix–
,

39 
iNumInks
)

42 
iIÅutWidth
 = 
šputwidth
;

43 
row»mašd”
 = 
»mašd”
;

44 
NumInks
 = 
iNumInks
;

45 
v
 = 
bVIP
;

47 
SÿËFaùÜ
ğ()
num”©Ü
 / ()
d’omš©Ü
;

48 ià(
SÿËFaùÜ
 > ()
MAX_OUTPUT_RASTERS
)

50 
cÚ¡ruùÜ_”rÜ
 = 
INDEX_OUT_OF_RANGE
;

53 
çùÜ
 = ()
SÿËFaùÜ
;

54 
»m
 = 
SÿËFaùÜ
 - ()
çùÜ
;

55 
»m
 *= 1000;

56 
»mašd”
 = ()
»m
;

58 
iOuutWidth
 = (è((()
iIÅutWidth
 / ()
d’omš©Ü
) *

59 ()
num”©Ü
);

60 
iOuutWidth
++;

62 ià(
num”©Ü
 =ğ
d’omš©Ü
)

63 
sÿlšg
 = 
çl£
;

64 
sÿlšg
 = 
Œue
;

69 
SÿËBound
 = (
SÿËFaùÜ
);

70 ià(
SÿËFaùÜ
 > (è
SÿËBound
)

71 
SÿËBound
++;

74 
RSBuffSize
 = (è((()(
By‹sP”Pix–
*
iOuutWidth
)è* 
SÿËBound
 );

75 
pOuutBufãr
[
COLORTYPE_COLOR
] = (
BYTE
 *è
Ãw
 BYTE[
RSBuffSize
];

76 ià(
pOuutBufãr
[
COLORTYPE_COLOR
] =ğ
NULL
)

78 
cÚ¡ruùÜ_”rÜ
 = 
ALLOCMEM_ERROR
;

81 
BÏckBuffSize
 = (è(((è(
iOuutWidth
)è* 
SÿËBound
 );

82 
pOuutBufãr
[
COLORTYPE_BLACK
] = (
BYTE
*è
Ãw
 BYTE[
BÏckBuffSize
];

83 ià(
pOuutBufãr
[
COLORTYPE_BLACK
] =ğ
NULL
)

85 
cÚ¡ruùÜ_”rÜ
 = 
ALLOCMEM_ERROR
;

89 ià(
SÿËFaùÜ
 < 2.0)

90 
R•liÿ‹OÆy
 = 
Œue
;

92 
R•liÿ‹OÆy
 = 
çl£
;

94 ià(
SÿËFaùÜ
 > (è
çùÜ
)

95 
äaùiÚ®
 = 
Œue
;

96 
äaùiÚ®
 = 
çl£
;

97 
	}
}

99 
	gSÿËr
::~
	$SÿËr
 ()

101 
i
 = 
COLORTYPE_COLOR
; i < 
MAX_COLORTYPE
; i++)

103 ià(
pOuutBufãr
[
i
])

105 
d–‘e
 [] 
pOuutBufãr
[
i
];

106 
pOuutBufãr
[
i
] = 
NULL
;

109 
	}
}

111 
	gSÿËr
::
	$G‘MaxOuutWidth
()

113 ià(
my¶ªe
 =ğ
COLORTYPE_COLOR
)

115  (
iOuutWidth
-1)*
NUMBER_PLANES
;

119  (
iOuutWidth
-1);

121 
	}
}

123 
boŞ
 
	gSÿËr
::
	$Proûss
(
RASTERDATA
* 
¿¡”_š
)

125 
iRa¡”sD–iv”ed
=0;

127 ià(
¿¡”_š
 =ğ
NULL
 || (¿¡”_š->
¿¡”d©a
[
COLORTYPE_COLOR
] =ğNULL &&„a¡”_š->¿¡”d©a[
COLORTYPE_BLACK
] == NULL))

129 
row»mašd”
=
»mašd”
;

130  
çl£
;

133 ià(!
sÿlšg
)

136 
i
 = 
COLORTYPE_COLOR
; i < 
MAX_COLORTYPE
; i++)

138 ià(
¿¡”_š
->
¿¡”d©a
[
i
])

140 
	`memıy
(
pOuutBufãr
[
i
], 
¿¡”_š
->
¿¡”d©a
[i],„a¡”_š->
¿¡”size
[i]);

143 
iRa¡”sR—dy
 = 1;

144  
Œue
;

147 ià(
my¶ªe
 =ğ
COLORTYPE_COLOR
)

149 ià(
¿¡”_š
->
¿¡”d©a
[
COLORTYPE_BLACK
])

151 
	`memıy
(
pOuutBufãr
[
COLORTYPE_BLACK
], 
¿¡”_š
->
¿¡”d©a
[COLORTYPE_BLACK],„a¡”_š->
¿¡”size
[COLORTYPE_BLACK]);

155 ià(
my¶ªe
 =ğ
COLORTYPE_BLACK
)

157 ià(
¿¡”_š
->
¿¡”d©a
[
COLORTYPE_COLOR
])

159 
	`memıy
(
pOuutBufãr
[
COLORTYPE_COLOR
], 
¿¡”_š
->
¿¡”d©a
[COLORTYPE_COLOR],„a¡”_š->
¿¡”size
[COLORTYPE_COLOR]);

164 
içùÜ
 = (è(è
SÿËFaùÜ
;

165 
rg±r
=0;

166 
sourû±r
=0;

167 
»m
 = 
»mašd”
;

169 ià(
my¶ªe
 =ğ
COLORTYPE_COLOR
 || my¶ª=ğ
COLORTYPE_BOTH
)

171 ià(
¿¡”_š
->
¿¡”d©a
[
COLORTYPE_COLOR
])

173 ià(
v
)

175 
width
 = 
iIÅutWidth
*3;

176 
i
=0; i < 
width
; i += 3)

178 
çùÜ
 = 
içùÜ
;

179 ià(
»m
 >= 1000)

181 
çùÜ
++;

182 
»m
 -= 1000;

184 
j
=0; j < 
çùÜ
; j++)

186 
pOuutBufãr
[
COLORTYPE_COLOR
][
rg±r
++] = 
¿¡”_š
->
¿¡”d©a
[COLORTYPE_COLOR][
i
];

187 
pOuutBufãr
[
COLORTYPE_COLOR
][
rg±r
++] = 
¿¡”_š
->
¿¡”d©a
[COLORTYPE_COLOR][
i
+1];

188 
pOuutBufãr
[
COLORTYPE_COLOR
][
rg±r
++] = 
¿¡”_š
->
¿¡”d©a
[COLORTYPE_COLOR][
i
+2];

190 
»m
 +ğ
»mašd”
;

195 
i
=0; i < 
NumInks
; i++)

197 
¶ªecouÁ
=0;

198 
¤c
=0;

199 (
¶ªecouÁ
 < 
iOuutWidth
-1è&& (
¤c
 < 
iIÅutWidth
))

201 
çùÜ
 = 
içùÜ
;

202 ià(
»m
 >= 1000)

204 
çùÜ
++;

205 
»m
 -= 1000;

207 
j
=0; (j < 
çùÜ
è&& (
¶ªecouÁ
 < 
iOuutWidth
-1); j++)

209 
pOuutBufãr
[
COLORTYPE_COLOR
][
rg±r
++] = 
¿¡”_š
->
¿¡”d©a
[COLORTYPE_COLOR][
sourû±r
];

210 
¶ªecouÁ
++;

212 
»m
 +ğ
»mašd”
;

213 
sourû±r
++; 
¤c
++;

215 
¶ªecouÁ
 < 
iOuutWidth
-1)

217 
pOuutBufãr
[
COLORTYPE_COLOR
][
rg±r
++] = 
¿¡”_š
->
¿¡”d©a
[COLORTYPE_COLOR][
sourû±r
-1];

218 
¶ªecouÁ
++;

225 
içùÜ
 = (è(è
SÿËFaùÜ
;

226 
rg±r
=0;

227 
sourû±r
=0;

228 
»m
 = 
»mašd”
;

230 ià(
my¶ªe
 =ğ
COLORTYPE_BLACK
 || my¶ª=ğ
COLORTYPE_BOTH
)

232 ià(
¿¡”_š
->
¿¡”d©a
[
COLORTYPE_BLACK
])

236 
¶ªecouÁ
=0;

237 
¤c
=0;

238 (
¶ªecouÁ
 < 
iOuutWidth
-1è&& (
¤c
 < 
iIÅutWidth
))

240 
çùÜ
 = 
içùÜ
;

241 ià(
»m
 >= 1000)

243 
çùÜ
++;

244 
»m
 -= 1000;

246 
j
=0; (j < 
çùÜ
è&& (
¶ªecouÁ
 < 
iOuutWidth
-1); j++)

248 
pOuutBufãr
[
COLORTYPE_BLACK
][
rg±r
++] = 
¿¡”_š
->
¿¡”d©a
[COLORTYPE_BLACK][
sourû±r
];

249 
¶ªecouÁ
++;

251 
»m
 +ğ
»mašd”
;

252 
sourû±r
++; 
¤c
++;

254 
¶ªecouÁ
 < 
iOuutWidth
-1)

256 
pOuutBufãr
[
COLORTYPE_BLACK
][
rg±r
++] = 
¿¡”_š
->
¿¡”d©a
[COLORTYPE_BLACK][
sourû±r
-1];

257 
¶ªecouÁ
++;

262 
çùÜ
 = 
içùÜ
;

263 ià(
row»mašd”
 >= 1000)

265 
çùÜ
++;

266 
row»mašd”
 -= 1000;

268 ià(
my¶ªe
 =ğ
COLORTYPE_BLACK
 && 
¿¡”_š
->
¿¡”d©a
[
COLORTYPE_COLOR
])

269 
iRa¡”sR—dy
 = 1;

271 
iRa¡”sR—dy
=
çùÜ
;

272 
iRa¡”sD–iv”ed
=0;

273 
row»mašd”
 +ğ
»mašd”
;

274  
Œue
;

275 
	}
}

277 
boŞ
 
	gSÿËr
::
	$NextOuutRa¡”
(
RASTERDATA
 &
Ãxt_¿¡”
)

279 ià(
iRa¡”sR—dy
 == 0)

280  
çl£
;

282 ià(
my¶ªe
 =ğ
COLORTYPE_BLACK
)

284 ià(
¿¡”
.
¿¡”d©a
[
COLORTYPE_BLACK
] =ğ
NULL
)

285 
iRa¡”sR—dy
 = 1;

287 ià(
my¶ªe
 =ğ
COLORTYPE_COLOR
)

289 
iRa¡”sR—dy
--;

290 
iRa¡”sD–iv”ed
++;

292 
boŞ
 
bv®
 = 
çl£
;

293 ià(
¿¡”
.
¿¡”size
[
COLORTYPE_BLACK
] > 0)

295 
Ãxt_¿¡”
.
¿¡”size
[
COLORTYPE_BLACK
] = 
¿¡”
.rastersize[COLORTYPE_BLACK];

296 
Ãxt_¿¡”
.
¿¡”d©a
[
COLORTYPE_BLACK
] = 
pOuutBufãr
[COLORTYPE_BLACK];

297 
bv®
 = 
Œue
;

301 
Ãxt_¿¡”
.
¿¡”size
[
COLORTYPE_BLACK
] = 0;

302 
Ãxt_¿¡”
.
¿¡”d©a
[
COLORTYPE_BLACK
] = 
NULL
;

304 ià(
¿¡”
.
¿¡”size
[
COLORTYPE_COLOR
] > 0)

306 
Ãxt_¿¡”
.
¿¡”size
[
COLORTYPE_COLOR
] = 
¿¡”
.rastersize[COLORTYPE_COLOR];

307 
Ãxt_¿¡”
.
¿¡”d©a
[
COLORTYPE_COLOR
] = 
pOuutBufãr
[COLORTYPE_COLOR];

308 
bv®
 = 
Œue
;

312 
Ãxt_¿¡”
.
¿¡”size
[
COLORTYPE_COLOR
] = 0;

313 
Ãxt_¿¡”
.
¿¡”d©a
[
COLORTYPE_COLOR
] = 
NULL
;

315  
bv®
;

316 
	}
}

	@prnt/hpcups/Scaler.h

2 #iâdeà
SCALER_H


3 
	#SCALER_H


	)

5 
	~"CommÚDefš™iÚs.h
"

6 
	~"ProûssÜ.h
"

8 şas 
	cSÿËr
 : 
public
 
ProûssÜ


10 
public
:

11 
SÿËr
(
šputwidth
, 
num”©Ü
,

12 
d’omš©Ü
, 
boŞ
 
bVIP
, 
By‹sP”Pix–
,

13 
iNumInks
);

14 
	mvœtu®
 ~
SÿËr
();

15 
boŞ
 
Proûss
(
RASTERDATA
* 
IÅutRa¡”
);

16 
vœtu®
 
	$Flush
(è{ 
	`Proûss
(
NULL
); }

18 
SÿËFaùÜ
;

19 
»mašd”
;

21 
	`G‘MaxOuutWidth
();

22 
boŞ
 
	`NextOuutRa¡”
(
RASTERDATA
 &
Ãxt_¿¡”
);

24 
´iv©e
:

26 
boŞ
 
sÿlšg
;

27 
boŞ
 
R•liÿ‹OÆy
;

29 
iOuutWidth
;

30 
iIÅutWidth
;

31 
BYTE
 *
pOuutBufãr
[
MAX_COLORTYPE
];

32 
boŞ
 
äaùiÚ®
;

33 
row»mašd”
;

34 
NumInks
;

35 
boŞ
 
v
;

36 
DRIVER_ERROR
 
cÚ¡ruùÜ_”rÜ
;

37 
	}
};

	@prnt/hpcups/SystemServices.cpp

31 
	~"CommÚDefš™iÚs.h
"

32 
	~"Sy¡emS”viûs.h
"

33 
	~"uts.h
"

35 
	gSy¡emS”viûs
::
	$Sy¡emS”viûs
(
iLogLev–
, 
job_id
, * 
u£r_Çme
è: 
	$m_iLogLev–
(
iLogLev–
)

37 
m_å
 = 
NULL
;

38 ià(
iLogLev–
 & 
SAVE_OUT_FILE
)

40 
âame
[
MAX_FILE_PATH_LEN
];

41 
	`¥rštf
(
âame
, "%s/hpcups_%s_out_job%d_XXXXXX",
CUPS_TMP_DIR
, 
u£r_Çme
, 
job_id
);

42 
	`ü—‹TempFe
(
âame
, &
m_å
);

43 ià(
m_å
)

45 
	`chmod
(
âame
, 
S_IRUSR
 | 
S_IWUSR
 | 
S_IRGRP
 | 
S_IWGRP
 | 
S_IROTH
);

48 
	}
}

50 
	gSy¡emS”viûs
::~
	$Sy¡emS”viûs
()

52 ià(
m_å
)

54 
	`fşo£
 (
m_å
);

56 
	}
}

58 
DRIVER_ERROR
 
	gSy¡emS”viûs
::
	$S’d
(cÚ¡ 
BYTE
 *
pD©a
, 
iL’gth
)

60 ià(
m_å
)

62 
	`fwr™e
 (
pD©a
, 1, 
iL’gth
, 
m_å
);

65 iàĞ!(
m_iLogLev–
 & 
DONT_SEND_TO_BACKEND
) )

67 
	`wr™e
 (
STDOUT_FILENO
, 
pD©a
, 
iL’gth
);

70  
NO_ERROR
;

71 
	}
}

	@prnt/hpcups/SystemServices.h

31 #iâdeà
SYSTEM_SERVICES_H


32 
	#SYSTEM_SERVICES_H


	)

34 şas 
	cSy¡emS”viûs


36 
	mpublic
:

37 
Sy¡emS”viûs
(
iLogLev–
, 
job_id
, * 
u£r_Çme
);

38 ~
Sy¡emS”viûs
();

39 
DRIVER_ERROR
 
S’d
(cÚ¡ 
BYTE
 *
pD©a
, 
iL’gth
);

40 
	m´iv©e
:

41 
m_iLogLev–
;

42 
FILE
 *
	mm_å
;

	@prnt/hpcups/Utils.cpp

31 
	~"CommÚDefš™iÚs.h
"

32 
	~"uts.h
"

34 
	$S’dChunkH—d”
 (
BYTE
 *
szSŒ
, 
DWORD
 
dwSize
, DWORD 
dwChunkTy³
, DWORD 
dwNumI‹ms
)

36 
j
 = 3, 
i
 = 0; j >= 0; j--)

38 
szSŒ
[
i
] = (
BYTE
è((
dwSize
 >> (8 * (
j
))) & 0xFF);

39 
szSŒ
[4+
i
] = (
BYTE
è((
dwChunkTy³
 >> (8 * (
j
))) & 0xFF);

40 
szSŒ
[8+
i
] = (
BYTE
è((
dwNumI‹ms
 >> (8 * (
j
))) & 0xFF);

41 
i
++;

44 
szSŒ
[12] = (
BYTE
è(((
dwNumI‹ms
 * 12) & 0xFF00) >> 8);

45 
szSŒ
[13] = (
BYTE
è(((
dwNumI‹ms
 * 12) & 0x00FF));

47 
szSŒ
[14] = 'Z';

48 
szSŒ
[15] = 'Z';

50 
	}
}

52 
	$S’dI‹mExŒa
 (
BYTE
 *
szSŒ
, BYTE 
cTy³
, 
WORD
 
wI‹m
, 
DWORD
 
dwV®ue
, DWORD 
dwExŒa
)

54 
i
, 
j
;

55 
dwExŒa
 += 12;

56 
j
 = 3, 
i
 = 0; j >= 0; j--)

58 
szSŒ
[
i
++] = (
BYTE
è((
dwExŒa
 >> (8 * (
j
))) & 0xFF);

60 
szSŒ
[
i
++] = (
BYTE
è((
wI‹m
 & 0xFF00) >> 8);

61 
szSŒ
[
i
++] = (
BYTE
è((
wI‹m
 & 0x00FF));

62 
szSŒ
[
i
++] = (
BYTE
è
cTy³
;

63 
szSŒ
[
i
++] = 0;

64 
j
 = 3; j >= 0; j--)

66 
szSŒ
[
i
++] = (
BYTE
è((
dwV®ue
 >> (8 * (
j
))) & 0xFF);

68  
i
;

69 
	}
}

71 
	$S’dI‹m
 (
BYTE
 *
szSŒ
, BYTE 
cTy³
, 
WORD
 
wI‹m
, 
DWORD
 
dwV®ue
)

73  
	`S’dI‹mExŒa
 (
szSŒ
, 
cTy³
, 
wI‹m
, 
dwV®ue
, 0);

74 
	}
}

76 
	$S’dIÁI‹m
 (
BYTE
 *
szSŒ
, 
iI‹m
, 
iI‹mTy³
, 
iI‹mV®ue
)

78 
i
 = 0;

79 
j
;

80 
j
 = 3; j >= 0; j--)

82 
szSŒ
[
i
++] = (
BYTE
è((
iI‹m
 >> (8 * (
j
))) & 0xFF);

84 
j
 = 3; j >= 0; j--)

86 
szSŒ
[
i
++] = (
BYTE
è((
iI‹mTy³
 >> (8 * (
j
))) & 0xFF);

88 
j
 = 3; j >= 0; j--)

90 
szSŒ
[
i
++] = (
BYTE
è((
iI‹mV®ue
 >> (8 * (
j
))) & 0xFF);

92  
i
;

93 
	}
}

	@prnt/hpcups/Utils.h

31 
S’dChunkH—d”
 (
BYTE
 *
szSŒ
, 
DWORD
 
dwSize
, DWORD 
dwChunkTy³
, DWORD 
dwNumI‹ms
);

32 
S’dI‹m
 (
BYTE
 *
szSŒ
, BYTE 
cTy³
, 
WORD
 
wI‹m
, 
DWORD
 
dwV®ue
);

33 
S’dI‹mExŒa
 (
BYTE
 *
szSŒ
, BYTE 
cTy³
, 
WORD
 
wI‹m
, 
DWORD
 
dwV®ue
, DWORD 
dwExŒa
);

34 
S’dIÁI‹m
 (
BYTE
 *
szSŒ
, 
iI‹m
, 
iI‹mTy³
, 
iI‹mV®ue
);

	@prnt/hpcups/apPrintModes.h

1 
PrštMode
 
	g­PrštModes
[] =

7 {1, 1, 1, 1, 1, 1}, 4, 
FED
,

8 {
ulM­DJ660_CCM_KCMY
, 
NULL
, NULL},

9 300, 300, 
çl£
, 
HTBš¬y_İ’
, HTBinary_open

15 {1, 1, 1, 1, 1, 1}, 3, 
FED
,

16 {
ulM­DJ600_CCM_CMY
, 
NULL
, NULL},

17 300, 300, 
çl£
, 
HTBš¬y_İ’
, HTBinary_open

23 {1, 1, 1, 1, 1, 1}, 6, 
FED
,

24 {
ulM­DJ690_CMYK
, 
ulM­DJ690_ClMlxx
, 
NULL
},

25 600, 600, 
çl£
, 
HTBš¬y_İ’
, HTBinary_open

31 {1, 1, 1, 1, 1, 1}, 1, 
FED
,

32 {
ulM­DJ600_CCM_K
, 
NULL
, NULL},

33 300, 300, 
çl£
, 
HTBš¬y_İ’
, HTBinary_open

39 {1, 1, 1, 1, 1, 1}, 1, 
FED
,

40 {
ulM­DJ600_CCM_K
, 
NULL
, NULL},

41 300, 300, 
çl£
, 
HTBš¬y_İ’
, HTBinary_open

47 {1, 1, 1, 1, 1, 1}, 4, 
MATRIX
,

48 {
ulM­DJ660_CCM_KCMY
, 
NULL
, NULL},

49 300, 300, 
çl£
, 
HTBš¬y_İ’
, HTBinary_open

55 {1, 1, 1, 1, 1, 1}, 3, 
FED
,

56 {
ulM­DJ600_CCM_CMY
, 
NULL
, NULL},

57 300, 300, 
çl£
, 
HTBš¬y_İ’
, HTBinary_open

63 {1, 1, 1, 1, 1, 1}, 1, 
FED
,

64 {
ulM­DJ600_CCM_K
, 
NULL
, NULL},

65 600, 600, 
Œue
, 
HTBš¬y_İ’
, HTBinary_open

	@prnt/hpcups/common_defines.h

1 #iâdeà
PCLM_COMMON_DEFINES


2 
	#PCLM_COMMON_DEFINES


	)

4 
	#PCLM_V”
 0.93

	)

5 
	#STANDALONE


	)

22 
	tuby‹
;

23 sigÃd 
	tsby‹
;

24 
	tušt8
;

25 
	tušt16
;

26 sigÃd 
	tsšt16
;

27 
	tušt32
;

28 sigÃd 
	tsšt32
;

29 
	tæßt32
;

30 
	tæßt64
;

34 
	mRGB
,

35 
	mAdobeRGB
,

36 
	mGRAY
,

37 
	munknown


38 } 
	tcŞÜS·ûEnum
;

42 
	mj³g
,

43 
	mzlib
,

44 
	m¾e


45 } 
	tcompTy³Enum
;

	@prnt/hpcups/dbuscomm.cpp

32 
	~"dbuscomm.h
"

34 
	gDBusCommuniÿtÜ
::
	$DBusCommuniÿtÜ
()

36 
m_¡rPrš‹rURI
 = "";

37 
m_¡rPrš‹rName
 = "";

38 #ifdeà
HAVE_DBUS


39 
m_DbusCÚnPŒ
 = 
NULL
;

41 
	}
}

48 
boŞ
 
	gDBusCommuniÿtÜ
::
	$š™DBusComm
(
¡ršg
 
¡rDbusP©h
 ,¡ršg 
¡rIÁ”çûName
 ,

49 
¡ršg
 
¡rPrš‹rURI
 , sŒšg 
¡rPrš‹rName
 , 
iJobId
 , sŒšg 
¡rU£r
 )

51 #ifdeà
HAVE_DBUS


52 
DBusE¼Ü
 
objE¼Ü
;

53 
DBusE¼Ü
 * 
pDBusE¼Ü
=&
objE¼Ü
;

55 
m_¡rPrš‹rURI
 = 
¡rPrš‹rURI
;

56 
m_¡rPrš‹rName
 = 
¡rPrš‹rName
;

57 
m_¡rDbusIÁ”çû
 = 
¡rIÁ”çûName
;

58 
m_¡rDbusP©h
 = 
¡rDbusP©h
;

59 
m_¡rU£r
 = 
¡rU£r
;

60 
m_iJobId
 = 
iJobId
;

62 
	`dbus_”rÜ_š™
(
pDBusE¼Ü
);

63 
m_DbusCÚnPŒ
 = 
	`dbus_bus_g‘
(
DBUS_BUS_SYSTEM
, 
pDBusE¼Ü
);

64 if(
	`dbus_”rÜ_is_£t
(
pDBusE¼Ü
))

66 
	`dbglog
("E¼Ü: dBu CÚÃùiÚ E¼Ü (%s)!\n", 
pDBusE¼Ü
->
mes§ge
);

67 
	`dbus_”rÜ_ä“
(
pDBusE¼Ü
);

70 if(
m_DbusCÚnPŒ
 =ğ
NULL
)

72 
	`dbglog
("E¼Ü: dBu CÚÃùiÚ E¼Ü (%s)!\n", 
pDBusE¼Ü
->
mes§ge
);

73  
çl£
;

76  
Œue
;

77 
	}
}

79 
boŞ
 
	gDBusCommuniÿtÜ
::
	$£ndEv’t
(
¡ršg
 
¡rDbusP©h
,¡ršg 
¡rIÁ”çûName
, sŒšg 
¡rDeviûURI
, sŒšg 
¡rPrš‹rName
, 
iEv’t
,

80 
¡ršg
 
¡rT™Ë
 , 
iJobId
 , sŒšg 
¡rU£r
 )

82 #ifdeà
HAVE_DBUS


84 if(
NULL
 =ğ
m_DbusCÚnPŒ
 )

86 
	`dbglog
("Error: dBus connection…tr is NULL.\n");

87  
çl£
;

89 if(
Œue
 =ğ
¡rDbusP©h
.
	`em±y
(è||ru=ğ
¡rIÁ”çûName
.em±y(è|| 0 =ğ
iEv’t
)

91 
	`dbglog
("Error: dBus service Name can't beƒmpty. DBus Path(%s) DBus Interface (%s) Event(%d)!\n",

92 
¡rDbusP©h
.
	`c_¡r
(), 
¡rIÁ”çûName
.c_¡r(), 
iEv’t
);

93  
çl£
;

95 
DBusMes§ge
 * 
msg
 = 
	`dbus_mes§ge_Ãw_sigÇl
(
¡rDbusP©h
.
	`c_¡r
(), 
¡rIÁ”çûName
.c_str(), "Event");

96 ià(
NULL
 =ğ
msg
)

98 
	`dbglog
("E¼Ü: dBu dbus_mes§ge_Ãw_sigÇÈ»tuºedƒ¼Ü. DBu IÁ”çû (%sèEv’t(%d)!\n", 
¡rIÁ”çûName
.
	`c_¡r
(), 
iEv’t
);

99  
çl£
;

102 ià(
NULL
 =ğ
msg
)

104 
	`dbglog
("dbus message is NULL!\n");

105  
çl£
;

107 cÚ¡ * 
¡URI
=
¡rDeviûURI
.
	`c_¡r
();

108 cÚ¡ * 
¡PRNTNM
=
¡rPrš‹rName
.
	`c_¡r
();

109 cÚ¡ * 
¡USR
=
¡rU£r
.
	`c_¡r
();

110 cÚ¡ * 
¡T
=
¡rT™Ë
.
	`c_¡r
();

112 
	`dbus_mes§ge_­³nd_¬gs
(
msg
,

113 
DBUS_TYPE_STRING
, &
¡URI
,

114 
DBUS_TYPE_STRING
, &
¡PRNTNM
,

115 
DBUS_TYPE_UINT32
, &
iEv’t
,

116 
DBUS_TYPE_STRING
, &
¡USR
,

117 
DBUS_TYPE_UINT32
, &
iJobId
,

118 
DBUS_TYPE_STRING
, &
¡T
,

119 
DBUS_TYPE_INVALID
);

121 ià(!
	`dbus_cÚÃùiÚ_£nd
(
m_DbusCÚnPŒ
 , 
msg
, 
NULL
))

123 
	`dbglog
("dbus message send failed!\n");

124  
çl£
;

127 
	`dbus_cÚÃùiÚ_æush
(
m_DbusCÚnPŒ
 );

128 
	`dbus_mes§ge_uÄef
(
msg
);

131  
Œue
;

133 
	}
}

135 
boŞ
 
	gDBusCommuniÿtÜ
::
	$£ndEv’t
(
iEv’t
, 
¡ršg
 
¡rT™Ë
 , 
iJobId
 ,¡ršg 
¡rU£r
 )

137  
	`£ndEv’t
(
m_¡rDbusP©h
, 
m_¡rDbusIÁ”çû
, 
m_¡rPrš‹rURI
, 
m_¡rPrš‹rName
, 
iEv’t
, 
¡rT™Ë
, 
iJobId
,
¡rU£r
);

138 
	}
}

140 
	gDBusCommuniÿtÜ
::~
	$DBusCommuniÿtÜ
()

143 
	}
}

	@prnt/hpcups/dbuscomm.h

31 #iâdeà
__DBUSCOMM_H__


32 
	#__DBUSCOMM_H__


	)

34 
	~<¡ršg
>

35 
	~"CommÚDefš™iÚs.h
"

36 
	~"hpmud.h
"

37 
	~<pwd.h
>

39 #ifdeà
HAVE_DBUS


40 
	~<dbus/dbus.h
>

41 
	#DBUS_INTERFACE
 "com.h¶.StusS”viû"

	)

42 
	#DBUS_PATH
 "/"

	)

44 
	#DBUS_INTERFACE
 ""

	)

45 
	#DBUS_PATH
 ""

	)

49 
usšg
 
Çme¥aû
 
	g¡d
;

57 şas 
	cDBusCommuniÿtÜ


59 
	m´iv©e
:

60 
¡ršg
 
m_¡rPrš‹rURI
;

61 
¡ršg
 
	mm_¡rPrš‹rName
;

62 #ifdeà
HAVE_DBUS


63 
DBusCÚÃùiÚ
 *
	mm_DbusCÚnPŒ
;

65 
¡ršg
 
	mm_¡rDbusIÁ”çû
;

66 
¡ršg
 
	mm_¡rDbusP©h
;

67 
¡ršg
 
	mm_¡rU£r
;

68 
	mm_iJobId
;

71 
	mpublic
:

72 
DBusCommuniÿtÜ
();

73 
boŞ
 
š™DBusComm
(
¡ršg
 
¡rDbusP©h
="",¡ršg 
¡rIÁ”çûName
="", sŒšg 
¡rPrš‹rURI
="", sŒšg 
¡rPrš‹rName
 = "",
iJobId
=0, sŒšg 
¡rU£r
="");

74 
boŞ
 
£ndEv’t
(
iEv’t
, 
¡ršg
 
¡rT™Ë
="", 
iJobId
=0, sŒšg 
¡rU£r
="");

75 
boŞ
 
£ndEv’t
(
¡ršg
 
¡rDbusP©h
,¡ršg 
¡rIÁ”çûName
, sŒšg 
¡rPrš‹rURI
, sŒšg 
¡rPrš‹rName
, 
ev’t
, sŒšg 
¡rT™Ë
="",
iJobId
=0, sŒšg 
¡rU£r
="");

76 ~
DBusCommuniÿtÜ
();

	@prnt/hpcups/dj3320ColorMaps.cpp

31 
	~"CommÚDefš™iÚs.h
"

34 
ušt32_t
 
	gulM­DJ3320_K_3x3x1
[] =

162 
ušt32_t
 
	gulM­DJ3320_K_6x6x1
[] =

290 
ušt32_t
 
	gulM­DJ3320_CMY_3x3x1
[ 9 * 9 * 9 ] =

418 
ušt32_t
 
	gulM­DJ3320_KCMY_3x3x1
[ 9 * 9 * 9 ] =

546 
ušt32_t
 
	gulM­DJ3320_CMY_6x6x1
[ 9 * 9 * 9 ] =

674 
ušt32_t
 
	gulM­DJ3320_KCMY_6x6x1
[ 9 * 9 * 9 ] =

	@prnt/hpcups/dj3320PrintModes.h

1 
PrštMode
 
	gdj3320PrštModes
[] =

8 {1, 1, 1, 1, 1, 1}, 4, 
FED
,

9 {
ulM­DJ3320_KCMY_3x3x1
, 
NULL
, NULL},

10 300, 300, 
çl£
, 
HTBš¬y_İ’
, HTBinary_open

17 {1, 1, 1, 1, 1, 1}, 4, 
FED
,

18 {
ulM­DJ3320_KCMY_6x6x1
, 
NULL
, NULL},

19 600, 600, 
çl£
, 
HTBš¬y_İ’
, HTBinary_open

26 {1, 2, 2, 2, 2, 2}, 4, 
FED
,

27 {
ulM­DJ970_Gossim”_NÜm®_KCMY
, 
NULL
, NULL},

28 600, 600, 
çl£
, 
HTBš¬y_İ’
, 
HT600x6004Ëv–970_İ’


35 {1, 1, 1, 1, 1, 1}, 3, 
FED
,

36 {
ulM­DJ3320_CMY_3x3x1
, 
NULL
, NULL},

37 300, 300, 
çl£
, 
HTBš¬y_İ’
, HTBinary_open

44 {1, 1, 1, 1, 1, 1}, 3, 
FED
,

45 {
ulM­DJ3320_CMY_6x6x1
, 
NULL
, NULL},

46 600, 600, 
çl£
, 
HTBš¬y_İ’
, HTBinary_open

53 {1, 1, 1, 1, 1, 1}, 1, 
FED
,

54 {
ulM­DJ3320_K_3x3x1
, 
NULL
, NULL},

55 300, 300, 
çl£
, 
HTBš¬y_İ’
, HTBinary_open

62 {1, 1, 1, 1, 1, 1}, 1, 
FED
,

63 {
ulM­DJ3320_K_6x6x1
, 
NULL
, NULL},

64 600, 600, 
çl£
, 
HTBš¬y_İ’
, HTBinary_open

71 {1, 1, 1, 1, 1, 1}, 1, 
FED
,

72 {
ulM­DJ3320_K_6x6x1
, 
ulM­DJ3600_ClMlxx_6x6x1
, 
NULL
},

73 600, 600, 
çl£
, 
HTBš¬y_İ’
, HTBinary_open

80 {1, 1, 1, 1, 1, 1}, 6, 
FED
,

81 {
ulM­DJ3320_KCMY_3x3x1
, 
ulM­DJ3600_ClMlxx_3x3x1
, 
NULL
},

82 300, 300, 
çl£
, 
HTBš¬y_İ’
, HTBinary_open

89 {1, 1, 1, 1, 1, 1}, 6, 
FED
,

90 {
ulM­DJ3320_K_6x6x1
, 
ulM­DJ3600_ClMlxx_6x6x1
, 
NULL
},

91 600, 600, 
çl£
, 
HTBš¬y_İ’
, HTBinary_open

98 {2, 2, 2, 2, 2, 2}, 6, 
FED
,

99 {
ulM­DJ3600_KCMY_6x6x2
, 
ulM­DJ3600_ClMlxx_6x6x2
, 
NULL
},

100 600, 600, 
çl£
, 
HTBš¬y_İ’
, HTBinary_open

	@prnt/hpcups/dj3600ColorMaps.cpp

31 
	~"CommÚDefš™iÚs.h
"

35 
ušt32_t
 
	gulM­DJ3600_KCMY_6x6x1
[ 9 * 9 * 9 ] =

163 
ušt32_t
 
	gulM­DJ3600_ClMlxx_6x6x1
[ 9 * 9 * 9 ] =

292 
ušt32_t
 
	gulM­DJ3600_KCMY_6x6x2
[ 9 * 9 * 9 ] =

420 
ušt32_t
 
	gulM­DJ3600_ClMlxx_6x6x2
[ 9 * 9 * 9 ] =

549 
ušt32_t
 
	gulM­DJ3600_KCMY_3x3x1
[ 9 * 9 * 9 ] =

677 
ušt32_t
 
	gulM­DJ3600_ClMlxx_3x3x1
[ 9 * 9 * 9 ] =

	@prnt/hpcups/dj400ColorMaps.cpp

31 
	~"CommÚDefš™iÚs.h
"

33 
ušt32_t
 
	gulM­DJ400_K
[ 9 * 9 * 9 ]=

118 
	gulM­DJ400_CMY
[ 9 * 9 * 9 ]=

	@prnt/hpcups/dj400PrintModes.h

1 
PrštMode
 
	gdj400PrštModes
[] =

7 {1, 1, 1, 1, 1, 1}, 3, 
FED
,

8 {
ulM­DJ400_CMY
, 
NULL
, NULL},

9 300, 300, 
çl£
, 
HTBš¬y_İ’
, HTBinary_open

15 {1, 1, 1, 1, 1, 1}, 1, 
FED
,

16 {
ulM­DJ400_K
, 
NULL
, NULL},

17 300, 300, 
çl£
, 
HTBš¬y_İ’
, HTBinary_open

	@prnt/hpcups/dj4100ColorMaps.cpp

31 
	~"CommÚDefš™iÚs.h
"

36 
	gucM­DJ4100_KCMY_6x6x1
[] =

743 
	gucM­DJ4100_KCMY_PhÙo_Be¡V_12x12x1
[] =

1450 
	gucM­DJ4100_KCMY_PhÙo_Be¡A_12x12x1
[] =

2157 
	gucM­DJ4100_KCMY_Be¡A_12x12x1
[] =

2864 
	gucM­DJ4100_KCMY_Be¡S_12x12x1
[] =

	@prnt/hpcups/dj4100PrintModes.h

1 
PrštMode
 
	gdj4100PrštModes
[] =

8 {1, 1, 1, 1, 1, 1}, 4, 
FED
,

9 {
ulM­DJ3320_KCMY_3x3x1
, 
NULL
, NULL},

10 600, 600, 
çl£
, 
HTBš¬y_İ’
, HTBinary_open

17 {1, 1, 1, 1, 1, 1}, 4, 
FED
,

18 {
NULL
, NULL, 
ucM­DJ4100_KCMY_6x6x1
},

19 600, 600, 
çl£
, 
HTBš¬y_İ’
, HTBinary_open

26 {1, 2, 2, 2, 2, 2}, 4, 
FED
,

27 {
NULL
, NULL, 
ucM­DJ4100_KCMY_PhÙo_Be¡A_12x12x1
},

28 600, 600, 
çl£
, 
HTBš¬y_İ’
, 
HT1200x1200x1PhÙoBe¡_İ’


35 {1, 1, 1, 1, 1, 1}, 3, 
FED
,

36 {
ulM­DJ3320_CMY_3x3x1
, 
NULL
, NULL},

37 600, 600, 
çl£
, 
HTBš¬y_İ’
, HTBinary_open

44 {1, 1, 1, 1, 1, 1}, 3, 
FED
,

45 {
ulM­DJ3320_CMY_6x6x1
, 
NULL
, NULL},

46 600, 600, 
çl£
, 
HTBš¬y_İ’
, HTBinary_open

53 {1, 1, 1, 1, 1, 1}, 1, 
FED
,

54 {
ulM­DJ3320_K_3x3x1
, 
NULL
, NULL},

55 600, 600, 
çl£
, 
HTBš¬y_İ’
, HTBinary_open

62 {1, 1, 1, 1, 1, 1}, 1, 
FED
,

63 {
ulM­DJ3320_K_6x6x1
, 
NULL
, NULL},

64 600, 600, 
çl£
, 
HTBš¬y_İ’
, HTBinary_open

71 {1, 1, 1, 1, 1, 1}, 1, 
FED
,

72 {
ulM­DJ3320_K_6x6x1
, 
ulM­DJ3600_ClMlxx_6x6x1
, 
NULL
},

73 600, 600, 
çl£
, 
HTBš¬y_İ’
, HTBinary_open

80 {1, 1, 1, 1, 1, 1}, 6, 
FED
,

81 {
ulM­DJ3320_KCMY_3x3x1
, 
ulM­DJ3600_ClMlxx_3x3x1
, 
NULL
},

82 600, 600, 
çl£
, 
HTBš¬y_İ’
, HTBinary_open

89 {1, 1, 1, 1, 1, 1}, 6, 
FED
,

90 {
ulM­DJ3320_K_6x6x1
, 
ulM­DJ3600_ClMlxx_6x6x1
, 
NULL
},

91 600, 600, 
çl£
, 
HTBš¬y_İ’
, HTBinary_open

98 {2, 2, 2, 2, 2, 2}, 6, 
FED
,

99 {
ulM­DJ3600_KCMY_6x6x2
, 
ulM­DJ3600_ClMlxx_6x6x2
, 
NULL
},

100 600, 600, 
çl£
, 
HTBš¬y_İ’
, HTBinary_open

	@prnt/hpcups/dj540PrintModes.h

1 
PrštMode
 
	gdj540PrštModes
[] =

7 {1, 1, 1, 1, 1, 1}, 3, 
FED
,

8 {
ulM­DJ600_CCM_CMY
, 
NULL
, NULL},

9 300, 300, 
çl£
, 
HTBš¬y_İ’
, HTBinary_open

15 {1, 1, 1, 1, 1, 1}, 1, 
FED
,

16 {
ulM­DJ600_CCM_K
, 
NULL
, NULL},

17 300, 300, 
çl£
, 
HTBš¬y_İ’
, HTBinary_open

23 {1, 1, 1, 1, 1, 1}, 3, 
FED
,

24 {
ulM­DJ600_CCM_CMY
, 
NULL
, NULL},

25 300, 300, 
çl£
, 
HTBš¬y_İ’
, HTBinary_open

31 {1, 1, 1, 1, 1, 1}, 1, 
FED
,

32 {
ulM­DJ600_CCM_K
, 
NULL
, NULL},

33 300, 300, 
çl£
, 
HTBš¬y_İ’
, HTBinary_open

	@prnt/hpcups/dj600ColorMaps.cpp

32 
	~"CommÚDefš™iÚs.h
"

34 
ušt32_t
 
	gulM­DJ600_CCM_K
[ 9 * 9 * 9 ]=

119 
ušt32_t
 
	gulM­DJ600_CCM_CMY
[ 9 * 9 * 9 ]=

205 
ušt32_t
 
	gulM­DJ660_CCM_KCMY
[ 9 * 9 * 9 ]=

290 
ušt32_t
 
	gulM­DJ690_CMYK
[ 9 * 9 * 9 ]=

416 
ušt32_t
 
	gulM­DJ690_ClMlxx
[ 9 * 9 * 9 ]=

	@prnt/hpcups/dj600PrintModes.h

1 
PrštMode
 
	gdj600PrštModes
[] =

7 {1, 1, 1, 1, 1, 1}, 3, 
FED
,

8 {
ulM­DJ600_CCM_CMY
, 
NULL
, NULL},

9 300, 300, 
çl£
, 
HTBš¬y_İ’
, HTBinary_open

15 {1, 1, 1, 1, 1, 1}, 1, 
FED
,

16 {
ulM­DJ600_CCM_K
, 
NULL
, NULL},

17 300, 300, 
çl£
, 
HTBš¬y_İ’
, HTBinary_open

23 {1, 1, 1, 1, 1, 1}, 3, 
FED
,

24 {
ulM­DJ600_CCM_CMY
, 
NULL
, NULL},

25 300, 300, 
çl£
, 
HTBš¬y_İ’
, HTBinary_open

31 {1, 1, 1, 1, 1, 1}, 1, 
FED
,

32 {
ulM­DJ600_CCM_K
, 
NULL
, NULL},

33 300, 300, 
çl£
, 
HTBš¬y_İ’
, HTBinary_open

39 {1, 1, 1, 1, 1, 1}, 1, 
FED
,

40 {
ulM­DJ600_CCM_K
, 
NULL
, NULL},

41 600, 600, 
çl£
, 
HTBš¬y_İ’
, HTBinary_open

	@prnt/hpcups/dj630PrintModes.h

1 
PrštMode
 
	gdj630PrštModes
[] =

7 {1, 1, 1, 1, 1, 1}, 4, 
MATRIX
,

8 {
ulM­DJ660_CCM_KCMY
, 
NULL
, NULL},

9 300, 300, 
çl£
, 
HTBš¬y_İ’
, HTBinary_open

15 {1, 1, 1, 1, 1, 1}, 3, 
MATRIX
,

16 {
ulM­DJ660_CCM_KCMY
, 
NULL
, NULL},

17 300, 300, 
çl£
, 
HTBš¬y_İ’
, HTBinary_open

23 {1, 1, 1, 1, 1, 1}, 1, 
FED
,

24 {
ulM­DJ600_CCM_K
, 
NULL
, NULL},

25 300, 300, 
çl£
, 
HTBš¬y_İ’
, HTBinary_open

31 {1, 1, 1, 1, 1, 1}, 1, 
FED
,

32 {
ulM­DJ600_CCM_K
, 
NULL
, NULL},

33 300, 300, 
Œue
, 
HTBš¬y_İ’
, HTBinary_open

39 {1, 1, 1, 1, 1, 1}, 3, 
FED
,

40 {
ulM­DJ600_CCM_CMY
, 
NULL
, NULL},

41 300, 300, 
çl£
, 
HTBš¬y_İ’
, HTBinary_open

47 {1, 1, 1, 1, 1, 1}, 1, 
FED
,

48 {
ulM­DJ600_CCM_K
, 
NULL
, NULL},

49 300, 300, 
çl£
, 
HTBš¬y_İ’
, HTBinary_open

55 {1, 1, 1, 1, 1, 1}, 4, 
FED
,

56 {
ulM­DJ660_CCM_KCMY
, 
NULL
, NULL},

57 300, 300, 
çl£
, 
HTBš¬y_İ’
, HTBinary_open

63 {1, 1, 1, 1, 1, 1}, 6, 
FED
,

64 {
ulM­DJ690_CMYK
, 
ulM­DJ690_ClMlxx
, 
NULL
},

65 600, 600, 
çl£
, 
HTBš¬y_İ’
, HTBinary_open

	@prnt/hpcups/dj690PrintModes.h

1 
PrštMode
 
	gdj690PrštModes
[] =

7 {1, 1, 1, 1, 1, 1}, 4, 
MATRIX
,

8 {
ulM­DJ660_CCM_KCMY
, 
NULL
, NULL},

9 300, 300, 
çl£
, 
HTBš¬y_İ’
, HTBinary_open

15 {1, 1, 1, 1, 1, 1}, 1, 
FED
,

16 {
ulM­DJ600_CCM_K
, 
NULL
, NULL},

17 300, 300, 
çl£
, 
HTBš¬y_İ’
, HTBinary_open

23 {1, 1, 1, 1, 1, 1}, 4, 
FED
,

24 {
ulM­DJ660_CCM_KCMY
, 
NULL
, NULL},

25 300, 300, 
çl£
, 
HTBš¬y_İ’
, HTBinary_open

31 {1, 1, 1, 1, 1, 1}, 1, 
FED
,

32 {
ulM­DJ600_CCM_K
, 
NULL
, NULL},

33 300, 300, 
çl£
, 
HTBš¬y_İ’
, HTBinary_open

39 {1, 1, 1, 1, 1, 1}, 1, 
FED
,

40 {
ulM­DJ600_CCM_K
, 
NULL
, NULL},

41 600, 600, 
çl£
, 
HTBš¬y_İ’
, HTBinary_open

47 {1, 1, 1, 1, 1, 1}, 6, 
FED
,

48 {
ulM­DJ690_CMYK
, 
ulM­DJ690_ClMlxx
, 
NULL
},

49 600, 600, 
çl£
, 
HTBš¬y_İ’
, HTBinary_open

	@prnt/hpcups/dj850PrintModes.h

1 
PrštMode
 
	gdj850PrštModes
[] =

7 {1, 1, 1, 1, 1, 1}, 4, 
FED
,

8 {
ulM­DJ850_NÜm®_KCMY
, 
NULL
, NULL},

9 300, 300, 
çl£
, 
HTBš¬y_İ’
, HTBinary_open

15 {1, 1, 1, 1, 1, 1}, 1, 
FED
,

16 {
ulM­DJ600_CCM_K
, 
NULL
, NULL},

17 300, 300, 
çl£
, 
HTBš¬y_İ’
, HTBinary_open

23 {1, 2, 2, 2, 2, 2}, 4, 
FED
,

24 {
ulM­DJ850_NÜm®_KCMY
, 
NULL
, NULL},

25 300, 300, 
Œue
, 
HTBš¬y_İ’
, 
HT300x3004Ëv–_İ’


31 {1, 1, 1, 1, 1, 1}, 1, 
FED
,

32 {
ulM­GRAY_K_6x6x1
, 
NULL
, NULL},

33 300, 300, 
Œue
, 
HTBš¬y_İ’
, HTBinary_open

	@prnt/hpcups/dj890PrintModes.h

1 
PrštMode
 
	gdj890PrštModes
[] =

7 {1, 1, 1, 1, 1, 1}, 4, 
FED
,

8 {
ulM­DJ895_Bš¬y_KCMY
, 
NULL
, NULL},

9 300, 300, 
çl£
, 
HTBš¬y_İ’
, HTBinary_open

15 {1, 1, 1, 1, 1, 1}, 1, 
FED
,

16 {
ulM­DJ600_CCM_K
, 
NULL
, NULL},

17 300, 300, 
çl£
, 
HTBš¬y_İ’
, HTBinary_open

23 {1, 1, 1, 1, 1, 1}, 4, 
FED
,

24 {
ulM­DJ895_KCMY
, 
NULL
, NULL},

25 300, 300, 
Œue
, 
HTBš¬y_İ’
, 
HT300x3004Ëv–_İ’


31 {1, 1, 1, 1, 1, 1}, 1, 
FED
,

32 {
ulM­GRAY_K_6x6x1
, 
NULL
, NULL},

33 300, 300, 
Œue
, 
HTBš¬y_İ’
, HTBinary_open

	@prnt/hpcups/dj895PrintModes.h

1 
PrštMode
 
	gdj895PrštModes
[] =

7 {1, 1, 1, 1, 1, 1}, 4, 
FED
,

8 {
ulM­DJ895_Bš¬y_KCMY
, 
NULL
, NULL},

9 300, 300, 
çl£
, 
HTBš¬y_İ’
, HTBinary_open

15 {1, 1, 1, 1, 1, 1}, 1, 
FED
,

16 {
ulM­DJ600_CCM_K
, 
NULL
, NULL},

17 300, 300, 
çl£
, 
HTBš¬y_İ’
, HTBinary_open

23 {1, 1, 1, 1, 1, 1}, 4, 
FED
,

24 {
ulM­DJ895_KCMY
, 
NULL
, NULL},

25 300, 300, 
Œue
, 
HTBš¬y_İ’
, 
HT300x3004Ëv–_İ’


31 {1, 1, 1, 1, 1, 1}, 1, 
FED
,

32 {
ulM­GRAY_K_6x6x1
, 
NULL
, NULL},

33 300, 300, 
Œue
, 
HTBš¬y_İ’
, HTBinary_open

39 {1, 2, 2, 2, 2, 2}, 4, 
FED
,

40 {
ulM­DJ895_HB_KCMY
, 
NULL
, NULL},

41 600, 600, 
çl£
, 
HTBš¬y_İ’
, 
HT600x6004Ëv–895_İ’


	@prnt/hpcups/dj8x5PrintModes.h

2 
PrštMode
 
	gdj8x5PrštModes
[] =

8 {1, 1, 1, 1, 1, 1}, 4, 
FED
,

9 {
ulM­DJ895_Bš¬y_KCMY
, 
NULL
, NULL},

10 300, 300, 
çl£
, 
HTBš¬y_İ’
, HTBinary_open

16 {1, 1, 1, 1, 1, 1}, 1, 
FED
,

17 {
ulM­DJ600_CCM_K
, 
NULL
, NULL},

18 300, 300, 
çl£
, 
HTBš¬y_İ’
, HTBinary_open

24 {1, 1, 1, 1, 1, 1}, 4, 
FED
,

25 {
ulM­DJ895_KCMY
, 
NULL
, NULL},

26 300, 300, 
Œue
, 
HTBš¬y_İ’
, 
HT300x3004Ëv–_İ’


32 {1, 1, 1, 1, 1, 1}, 1, 
FED
,

33 {
ulM­GRAY_K_6x6x1
, 
NULL
, NULL},

34 300, 300, 
çl£
, 
HTBš¬y_İ’
, HTBinary_open

40 {1, 2, 2, 2, 2, 2}, 3, 
FED
,

41 {
ulM­DJ8x5PÏšNÜm®
, 
NULL
, NULL},

42 300, 300, 
Œue
, 
HTBš¬y_İ’
, 
HT300x3004Ëv–_İ’


48 {1, 2, 2, 2, 2, 2}, 4, 
FED
,

49 {
ulM­DJ895_HB_KCMY
, 
NULL
, NULL},

50 300, 300, 
çl£
, 
HTBš¬y_İ’
, 
HT600x6004Ëv–895_İ’


56 {1, 2, 2, 2, 2, 2}, 3, 
FED
,

57 {
ulM­DJ895_HB_KCMY
, 
NULL
, NULL},

58 300, 300, 
çl£
, 
HTBš¬y_İ’
, 
HT600x6004Ëv–895_İ’


64 {1, 1, 1, 1, 1, 1}, 3, 
FED
,

65 {
ulM­DJ8x5D¿á
, 
NULL
, NULL},

66 300, 300, 
çl£
, 
HTBš¬y_İ’
, HTBinary_open

	@prnt/hpcups/dj8xxColorMaps.cpp

31 
	~"CommÚDefš™iÚs.h
"

33 
ušt32_t
 
	gulM­DJ850_NÜm®_KCMY
[ 9*9*9 ]=

159 
ušt32_t
 
	gulM­DJ895_HB_KCMY
[ 9*9*9 ]=

285 
ušt32_t
 
	gulM­DJ895_Bš¬y_KCMY
[ 9*9*9 ]=

411 
ušt32_t
 
	gulM­DJ895_KCMY
[ 9*9*9 ]=

496 
ušt32_t
 
	gulM­DJ8x5D¿á
[ 9 * 9 * 9 ] =

622 
ušt32_t
 
	gulM­DJ8x5PÏšNÜm®
[9 * 9 * 9] =

	@prnt/hpcups/dj970ColorMaps.cpp

31 
	~"CommÚDefš™iÚs.h
"

35 
ušt32_t
 
	gulM­GRAY_K_6x6x1
[] =

120 
ušt32_t
 
	gulM­DJ970_KCMY
[ 9*9*9 ]=

246 
ušt32_t
 
	gulM­DJ970_KCMY_3x3x2
[ 9*9*9 ]=

372 
ušt32_t
 
	gulM­DJ970_Gossim”_NÜm®_KCMY
[ 9*9*9 ]=

498 
ušt32_t
 
	gulM­DJ970_D¿á_KCMY
[ 9*9*9 ]=

	@prnt/hpcups/dj970PrintModes.h

1 
PrštMode
 
	gdj970PrštModes
[] =

7 {1, 1, 1, 1, 1, 1}, 4, 
FED
,

8 {
ulM­DJ970_D¿á_KCMY
, 
NULL
, NULL},

9 300, 300, 
çl£
, 
HTBš¬y_İ’
, HTBinary_open

15 {1, 1, 1, 1, 1, 1}, 1, 
FED
,

16 {
ulM­DJ600_CCM_K
, 
NULL
, NULL},

17 300, 300, 
çl£
, 
HTBš¬y_İ’
, HTBinary_open

23 {1, 2, 2, 2, 2, 2}, 4, 
FED
,

24 {
ulM­DJ970_KCMY_3x3x2
, 
NULL
, NULL},

25 300, 300, 
Œue
, 
HTBš¬y_İ’
, 
HT300x3004Ëv–970_İ’


31 {1, 1, 1, 1, 1, 1}, 1, 
FED
,

32 {
ulM­GRAY_K_6x6x1
, 
NULL
, NULL},

33 600, 600, 
çl£
, 
HTBš¬y_İ’
, HTBinary_open

39 {1, 2, 2, 2, 2, 2}, 4, 
FED
,

40 {
ulM­DJ970_KCMY
, 
NULL
, NULL},

41 600, 600, 
çl£
, 
HTBš¬y_İ’
, 
HT600x600x4_P»s970_İ’


47 {1, 2, 2, 2, 2, 2}, 4, 
FED
,

48 {
ulM­DJ970_Gossim”_NÜm®_KCMY
, 
NULL
, NULL},

49 600, 600, 
çl£
, 
HTBš¬y_İ’
, 
HT600x6004Ëv–970_İ’


55 {1, 1, 1, 1, 1, 1}, 4, 
FED
,

56 {
ulM­DJ970_Gossim”_NÜm®_KCMY
, 
NULL
, NULL},

57 1200, 1200, 
çl£
, 
HTBš¬y_İ’
, 
HT1200x1200x1_PhÙoP»s970_İ’


	@prnt/hpcups/flate_colorspace.h

1 #iâdeà
FLATE_COLORSPACE_H


2 
	#FLATE_COLORSPACE_H


	)

4 cÚ¡ 
	gADOBE_RGB_SIZE
 = 284;

6 
	gæ©eBufãr
[
ADOBE_RGB_SIZE
] = {

	@prnt/hpcups/genJPEGStrips.cpp

7 
	~<¡dio.h
>

9 
	~<¡dlib.h
>

10 
	~"commÚ_defšes.h
"

11 
	~"PCLmG’”©Ü.h
"

22 
	~"j³glib.h
"

29 
	~<£tjmp.h
>

31 
	~<m®loc.h
>

32 
	~<memÜy.h
>

63 
image_width
;

64 
	gimage_height
;

65 
	gimage_numCompÚ’ts
;

68 
	gDebugIt
 = 
çl£
;

69 
	gDebugIt2
 = 
çl£
;

71 *
	gmyImageBufãr
=
NULL
;

73 
j³g_decom´ess_¡ruù
 
	tcšfoCom´essTy³
;

76 
	$put_sÿÆše_som•Ïû
(
cšfoCom´essTy³
 *
cšfo
, *
bufãr
, 
physiÿlWidth
)

78 *
de¡Bufãr
;

80 if(
myImageBufãr
==
NULL
)

82 
width
 =
cšfo
->
image_width
;

83 
height
 =
cšfo
->
image_height
;

84 
numCompÚ’ts
 =()
cšfo
->
num_compÚ’ts
;

85 
®locSize
 =
width
*
height
*
numCompÚ’ts
;

87 
	`´štf
("Image Stats\n");

88 
	`´štf
(" ImageWidth=%d\n",
width
);

89 
	`´štf
(" ImageHeight=%d\n",
height
);

90 
	`´štf
(" ImageNumCompÚ’ts=%d\n",
numCompÚ’ts
);

94 
myImageBufãr
=(*)
	`m®loc
(
®locSize
*2);

100 if(!
myImageBufãr
)

102 
	`´štf
("Could‚ot‡llocateƒnough memory for source JPEG file;ƒxiting\n");

103 
	`ex™
(-1);

105 
	`mem£t
(
myImageBufãr
,0x0,
®locSize
);

107 
image_width
=
width
;

108 
image_height
=
height
;

109 
image_numCompÚ’ts
=
numCompÚ’ts
;

110 
de¡Bufãr
=
myImageBufãr
;

112 
	`memıy
(
de¡Bufãr
,
bufãr
,
physiÿlWidth
);

113 
de¡Bufãr
+=
physiÿlWidth
;

115 
	}
}

121 
	$š™_bufãr
(
j³g_com´ess_¡ruù
* 
cšfo
)

122 {
	}
}

126 
boŞ—n
 
	$em±y_bufãr
(
j³g_com´ess_¡ruù
* 
cšfo
) {

127  
TRUE
;

128 
	}
}

131 
	$‹rm_bufãr
(
j³g_com´ess_¡ruù
* 
cšfo
)

132 {
	}
}

134 
	$GLOBAL
()

135 
	$wr™e_JPEG_Buff
 (
uby‹
 * 
buffPŒ
, 
qu®™y
, 
image_width
, 
image_height
, 
JSAMPLE
 *
imageBufãr
, 
»sŞutiÚ
, 
cŞÜS·ûDi¥os™iÚ
 
de¡CS
, *
numCompBy‹s
)

144 
j³g_com´ess_¡ruù
 
cšfo
;

145 
j³g_de¡š©iÚ_mgr
 
dmgr
;

155 
j³g_”rÜ_mgr
 
j”r
;

157 
JSAMPROW
 
row_poš‹r
[1];

158 
row_¡ride
;

162 
dmgr
.
š™_de¡š©iÚ
 = 
š™_bufãr
;

163 
dmgr
.
em±y_ouut_bufãr
 = 
em±y_bufãr
;

164 
dmgr
.
‹rm_de¡š©iÚ
 = 
‹rm_bufãr
;

165 
dmgr
.
Ãxt_ouut_by‹
 = (
JOCTET
 *)
buffPŒ
;

166 
dmgr
.
ä“_š_bufãr
 = 
image_width
 * 
image_height
 * 3;

175 
cšfo
.
”r
 = 
	`j³g_¡d_”rÜ
(&
j”r
);

177 
	`j³g_ü—‹_com´ess
(&
cšfo
);

179 
cšfo
.
de¡
 = &
dmgr
;

189 
cšfo
.
image_width
 = image_width;

190 
cšfo
.
image_height
 = image_height;

191 
cšfo
.
šput_compÚ’ts
 = 3;

192 
cšfo
.
š_cŞÜ_¥aû
 = 
JCS_RGB
;

194 if(
de¡CS
==
deviûRGB
 || de¡CS==
adobeRGB
)

196 
cšfo
.
š_cŞÜ_¥aû
 = 
JCS_RGB
;

197 
cšfo
.
j³g_cŞÜ_¥aû
 = 
JCS_RGB
;

198 
cšfo
.
šput_compÚ’ts
 = 3;

202 
cšfo
.
š_cŞÜ_¥aû
 = 
JCS_GRAYSCALE
;

203 
cšfo
.
j³g_cŞÜ_¥aû
 = 
JCS_GRAYSCALE
;

204 
cšfo
.
šput_compÚ’ts
 = 1;

210 
	`j³g_£t_deçuÉs
(&
cšfo
);

213 ià(
de¡CS
==
deviûRGB
 || de¡CS==
adobeRGB
)

215 
	`j³g_£t_cŞÜ¥aû
 (&
cšfo
,
JCS_RGB
);

221 
	`j³g_£t_qu®™y
(&
cšfo
, 
qu®™y
, 
TRUE
 );

224 
cšfo
.
d’s™y_un™
=1;

225 
cšfo
.
X_d’s™y
=(
UINT16
)
»sŞutiÚ
;

226 
cšfo
.
Y_d’s™y
=(
UINT16
)
»sŞutiÚ
;

231 
cšfo
.
MCUs_³r_row
 =
image_width
;

232 
cšfo
.
MCU_rows_š_sÿn
=
image_height
;

235 
cšfo
.
MCUs_³r_row
 =
image_width
;

237 
cšfo
.
MCU_rows_š_sÿn
=
image_height
;

241 if(
DebugIt2
)

243 
	`´štf
("cinfo:\n");

244 
	`´štf
(" width=%d\n",
cšfo
.
image_width
);

245 
	`´štf
(" height=%d\n",
cšfo
.
image_height
);

246 
	`´štf
(" iÅut_compÚ’ts=%d\n",
cšfo
.
šput_compÚ’ts
);

247 
	`´štf
(" iÅut_š_cŞÜ_¥aû=%d\n",
cšfo
.
š_cŞÜ_¥aû
);

248 
	`´štf
(" iÅut_out_cŞÜ_¥aû=%d\n",
cšfo
.
j³g_cŞÜ_¥aû
);

249 
	`´štf
("‚um_compÚ’ts=%d\n",
cšfo
.
num_compÚ’ts
);

251 
	`´štf
(" X_d’s™y=%d\n",
cšfo
.
X_d’s™y
);

252 
	`´štf
(" Y_d’s™y=%d\n",
cšfo
.
Y_d’s™y
);

253 
	`´štf
(" MCUs_³r_row=%d\n",
cšfo
.
MCUs_³r_row
);

254 
	`´štf
(" MCUs_rows_š_sÿn=%d\n",
cšfo
.
MCU_rows_š_sÿn
);

262 
	`j³g_¡¬t_com´ess
(&
cšfo
, 
TRUE
);

272 
row_¡ride
 = 
image_width
 * 
cšfo
.
šput_compÚ’ts
;

274 
cšfo
.
Ãxt_sÿÆše
 < cšfo.
image_height
) {

280 
row_poš‹r
[0] = & 
imageBufãr
[
cšfo
.
Ãxt_sÿÆše
 * 
row_¡ride
];

291 (è
	`j³g_wr™e_sÿÆšes
(&
cšfo
, 
row_poš‹r
, 1);

296 
	`j³g_fšish_com´ess
(&
cšfo
);

301 
	`j³g_de¡roy_com´ess
(&
cšfo
);

303 *
numCompBy‹s
=()(
cšfo
.
de¡
->
Ãxt_ouut_by‹
 - 
buffPŒ
);

306 
	}
}

309 
	$GLOBAL
()

310 
	$wr™e_JPEG_fe
 (* 
f’ame
, 
qu®™y
, 
image_width
, 
image_height
, 
JSAMPLE
 *
imageBufãr
, 
»sŞutiÚ
, 
cŞÜS·ûEnum
 
de¡CS
)

318 
j³g_com´ess_¡ruù
 
cšfo
;

328 
j³g_”rÜ_mgr
 
j”r
;

330 
FILE
 * 
outfe
;

331 
JSAMPROW
 
row_poš‹r
[1];

332 
row_¡ride
;

341 
cšfo
.
”r
 = 
	`j³g_¡d_”rÜ
(&
j”r
);

343 
	`j³g_ü—‹_com´ess
(&
cšfo
);

353 ià((
outfe
 = 
	`fİ’
(
f’ame
, "wb")è=ğ
NULL
) {

354 
	`årštf
(
¡d”r
, "ÿn'ˆİ’ %s\n", 
f’ame
);

355 
	`ex™
(1);

357 
	`j³g_¡dio_de¡
(&
cšfo
, 
outfe
);

364 
cšfo
.
image_width
 = image_width;

365 
cšfo
.
image_height
 = image_height;

366 
cšfo
.
šput_compÚ’ts
 = 3;

367 
cšfo
.
š_cŞÜ_¥aû
 = 
JCS_RGB
;

369 if(
de¡CS
==
RGB
)

370 
cšfo
.
š_cŞÜ_¥aû
 = 
JCS_RGB
;

372 
cšfo
.
š_cŞÜ_¥aû
 = 
JCS_GRAYSCALE
;

374 if(
de¡CS
==
RGB
)

376 
cšfo
.
š_cŞÜ_¥aû
 = 
JCS_RGB
;

377 
cšfo
.
j³g_cŞÜ_¥aû
 = 
JCS_RGB
;

378 
cšfo
.
šput_compÚ’ts
=3;

382 
cšfo
.
š_cŞÜ_¥aû
 = 
JCS_RGB
;

383 
cšfo
.
j³g_cŞÜ_¥aû
 = 
JCS_GRAYSCALE
;

384 
cšfo
.
šput_compÚ’ts
=3;

390 
	`j³g_£t_deçuÉs
(&
cšfo
);

393 if(
DebugIt
)

395 
	`´štf
("cinfo:\n");

396 
	`´štf
(" width=%d\n",
cšfo
.
image_width
);

397 
	`´štf
(" height=%d\n",
cšfo
.
image_height
);

398 
	`´štf
(" iÅut_compÚ’ts=%d\n",
cšfo
.
šput_compÚ’ts
);

399 
	`´štf
(" iÅut_š_cŞÜ_¥aû=%d\n",
cšfo
.
š_cŞÜ_¥aû
);

400 
	`´štf
(" iÅut_out_cŞÜ_¥aû=%d\n",
cšfo
.
j³g_cŞÜ_¥aû
);

401 
	`´štf
("‚um_compÚ’ts=%d\n",
cšfo
.
num_compÚ’ts
);

408 
	`j³g_£t_qu®™y
(&
cšfo
, 
qu®™y
, 
TRUE
 );

411 
cšfo
.
X_d’s™y
=(
UINT16
)
»sŞutiÚ
;

412 
cšfo
.
Y_d’s™y
=(
UINT16
)
»sŞutiÚ
;

415 
cšfo
.
MCUs_³r_row
 =16;

416 
cšfo
.
MCU_rows_š_sÿn
=16;

423 
	`j³g_¡¬t_com´ess
(&
cšfo
, 
TRUE
);

433 
row_¡ride
 = 
image_width
 * 3;

435 
cšfo
.
Ãxt_sÿÆše
 < cšfo.
image_height
) {

441 
row_poš‹r
[0] = & 
imageBufãr
[
cšfo
.
Ãxt_sÿÆše
 * 
row_¡ride
];

442 (è
	`j³g_wr™e_sÿÆšes
(&
cšfo
, 
row_poš‹r
, 1);

447 
	`j³g_fšish_com´ess
(&
cšfo
);

449 
	`fşo£
(
outfe
);

454 
	`j³g_de¡roy_com´ess
(&
cšfo
);

457 
	}
}

531 
	smy_”rÜ_mgr
 {

532 
j³g_”rÜ_mgr
 
	mpub
;

534 
jmp_buf
 
	m£tjmp_bufãr
;

537 
my_”rÜ_mgr
 * 
	tmy_”rÜ_±r
;

543 
	$METHODDEF
()

544 
	$my_”rÜ_ex™
 (
j_commÚ_±r
 
cšfo
)

547 
my_”rÜ_±r
 
my”r
 = (my_”rÜ_±rè
cšfo
->
”r
;

551 (*
cšfo
->
”r
->
ouut_mes§ge
) (cinfo);

554 
	`lÚgjmp
(
my”r
->
£tjmp_bufãr
, 1);

555 
	}
}

564 
cŞÜS·ûEnum
 
sourûCŞÜS·û
;

566 
	$GLOBAL
()

567 
	$»ad_JPEG_fe
 (* 
f’ame
)

572 
j³g_decom´ess_¡ruù
 
cšfo
;

579 
my_”rÜ_mgr
 
j”r
;

581 
FILE
 * 
šfe
;

582 
JSAMPARRAY
 
bufãr
;

583 
row_¡ride
;

591 ià((
šfe
 = 
	`fİ’
(
f’ame
, "rb")è=ğ
NULL
) {

592 
	`årštf
(
¡d”r
, "ÿn'ˆİ’ %s\n", 
f’ame
);

599 
cšfo
.
”r
 = 
	`j³g_¡d_”rÜ
(&
j”r
.
pub
);

600 
j”r
.
pub
.
”rÜ_ex™
 = 
my_”rÜ_ex™
;

602 ià(
	`£tjmp
(
j”r
.
£tjmp_bufãr
)) {

606 
	`j³g_de¡roy_decom´ess
(&
cšfo
);

607 
	`fşo£
(
šfe
);

611 
	`j³g_ü—‹_decom´ess
(&
cšfo
);

615 
	`j³g_¡dio_¤c
(&
cšfo
, 
šfe
);

619 (è
	`j³g_»ad_h—d”
(&
cšfo
, 
TRUE
);

634 (è
	`j³g_¡¬t_decom´ess
(&
cšfo
);

636 if(
DebugIt2
)

638 
	`´štf
("Source Image Stats\n");

639 
	`´štf
(" Width=%d\n",
cšfo
.
image_width
);

640 
	`´štf
(" height=%d\n",
cšfo
.
image_height
);

641 
	`´štf
("‚um_compÚ’ts=%d\n",
cšfo
.
num_compÚ’ts
);

642 if(
cšfo
.
out_cŞÜ_¥aû
==
JCS_RGB
)

644 
sourûCŞÜS·û
=
RGB
;

645 
	`´štf
(" JPEG color space==RGB\n");

647 if(
cšfo
.
out_cŞÜ_¥aû
==
JCS_GRAYSCALE
)

649 
sourûCŞÜS·û
=
GRAY
;

650 
	`´štf
(" JPEG color space==RGB\n");

654 
sourûCŞÜS·û
=
unknown
;

655 
	`´štf
(" JPEG color space==RGB\n");

669 
row_¡ride
 = 
cšfo
.
ouut_width
 * cšfo.
ouut_compÚ’ts
;

671 
bufãr
 = (*
cšfo
.
mem
->
®loc_§¼ay
)

672 ((
j_commÚ_±r
è&
cšfo
, 
JPOOL_IMAGE
, 
row_¡ride
, 1);

680 
cšfo
.
ouut_sÿÆše
 < cšfo.
ouut_height
) {

685 (è
	`j³g_»ad_sÿÆšes
(&
cšfo
, 
bufãr
, 1);

687 
	`put_sÿÆše_som•Ïû
(&
cšfo
, (*)
bufãr
[0], 
row_¡ride
);

692 (è
	`j³g_fšish_decom´ess
(&
cšfo
);

700 
	`j³g_de¡roy_decom´ess
(&
cšfo
);

707 
	`fşo£
(
šfe
);

715 
	}
}

	@prnt/hpcups/genPCLm.cpp

119 
	#STAND_ALLONE


	)

121 
	~"PCLmG’”©Ü.h
"

122 
	~"CommÚDefš™iÚs.h
"

123 
	~"../../commÚ/uts.h
"

124 
	~<¡dio.h
>

125 
	~<¡dlib.h
>

126 
	~<¡ršg.h
>

127 
	~<fú.h
>

128 
	~<as£¹.h
>

129 
	~<m©h.h
>

130 
	~<zlib.h
>

135 
	~"j³glib.h
"

137 
	~"RunL’Encodšg.h
"

139 
	~"commÚ_defšes.h
"

140 
	~"g’PCLm.h
"

141 
	~"ùy³.h
"

143 
	~"æ©e_cŞÜ¥aû.h
"

148 
debugIt
 = 0;

150 
	#STRIP_HEIGHT
 16

	)

151 
	#JPEG_QUALITY
 100

	)

153 
	#XREF_SIZE
 10000

	)

154 
	#TEMP_BUFF_SIZE
 100000

	)

155 
	#DEFAULT_OUTBUFF_SIZE
 64*5120*3

	)

157 
	#STANDARD_SCALE_FOR_PDF
 72.0

	)

159 
	#KID_STRING_SIZE
 1000

	)

161 
	#CATALOG_OBJ_NUMBER
 1

	)

162 
	#PAGES_OBJ_NUMBER
 2

	)

171 
	#rgb_2_g¿y
(
r
,
g
,
b
è(
uby‹
)(0.299*(ì+0.587*()g+0.114*()b)

	)

174 
boŞ—n
 
wr™eOuutFe
(
numBy‹s
, 
uby‹
 *
±r
, *
u£r_Çme
);

189 
uby‹
 *
	$shiáSŒByLeáM¬gš
(
uby‹
 *
±rToSŒ
,
sšt32
 
cu¼SourûWidth
,sšt32 
cu¼SŒHeight
, sšt32 
numLšesThisC®l
,

190 
sšt32
 
cu¼MedŸWidth
, sšt32 
ËáM¬gš
, 
cŞÜS·ûDi¥os™iÚ
 
de¡CŞÜS·û
)

192 
uby‹
 *
äomPŒ
=
±rToSŒ
, *
toPŒ
, *
ÃwSŒ
;

193 
sšt32
 
sÿnLšeWidth
;

195 
	`as£¹
(
cu¼SourûWidth
+(2*
ËáM¬gš
)<=
cu¼MedŸWidth
);

199 if(
de¡CŞÜS·û
==
g¿ySÿË
)

201 
sÿnLšeWidth
=
cu¼MedŸWidth
;

203 
ÃwSŒ
=(
uby‹
*)
	`m®loc
(
sÿnLšeWidth
*
cu¼SŒHeight
);

204 
	`mem£t
(
ÃwSŒ
,0xff,
sÿnLšeWidth
*
cu¼SŒHeight
);

206 
i
=0;i<
numLšesThisC®l
;i++)

208 
toPŒ
=
ÃwSŒ
+
ËáM¬gš
+(
i
*
cu¼MedŸWidth
);

209 
äomPŒ
=
±rToSŒ
+(
i
*
cu¼SourûWidth
);

210 
	`memıy
(
toPŒ
,
äomPŒ
,
cu¼SourûWidth
);

216 
sÿnLšeWidth
=
cu¼MedŸWidth
*3;

217 
sšt32
 
¤cSÿÆšeWidth
=
cu¼SourûWidth
*3;

218 
sšt32
 
shiáAmouÁ
=
ËáM¬gš
*3;

219 
ÃwSŒ
=(
uby‹
*)
	`m®loc
(
sÿnLšeWidth
*
cu¼SŒHeight
);

220 
	`mem£t
(
ÃwSŒ
,0xff,
sÿnLšeWidth
*
cu¼SŒHeight
);

221 
i
=0;i<
numLšesThisC®l
;i++)

223 
toPŒ
=
ÃwSŒ
+
shiáAmouÁ
+(
i
*
sÿnLšeWidth
);

224 
äomPŒ
=
±rToSŒ
+(
i
*
¤cSÿÆšeWidth
);

225 
	`memıy
(
toPŒ
,
äomPŒ
,
¤cSÿÆšeWidth
);

230 (
ÃwSŒ
);

231 
	}
}

233 #ifdeà
SUPPORT_WHITE_STRIPS


234 
boŞ
 
	gPCLmG’”©Ü
::
	$isWh™eSŒ
(*
pInBufãr
, 
šBufãrSize
)

236 
ušt32
 *
±r
=(ušt32*)
pInBufãr
;

237 
i
=0;i<
šBufãrSize
/4;i++,
±r
++)

239 if(*
±r
!=0xffffffff)

240 (
çl£
);

242 (
Œue
);

243 
	}
}

247 
	gPCLmG’”©Ü
::
	$CËªup
()

249 if(
®loÿ‹dOuutBufãr
)

251 
	`ä“
(
®loÿ‹dOuutBufãr
);

252 
®loÿ‹dOuutBufãr
 = 
NULL
;

253 
cu¼OutBuffSize
 = 0;

256 if(
Ëáov”SÿÆšeBufãr
)

258 
	`ä“
(
Ëáov”SÿÆšeBufãr
);

259 
Ëáov”SÿÆšeBufãr
=
NULL
;

261 if(
sü©chBufãr
)

263 
	`ä“
(
sü©chBufãr
);

264 
sü©chBufãr
 = 
NULL
;

266 if(
xRefTabË
)

268 
	`ä“
(
xRefTabË
);

269 
xRefTabË
=
NULL
;

271 if(
KidsA¼ay
)

273 
	`ä“
(
KidsA¼ay
);

274 
KidsA¼ay
=
NULL
;

276 
	}
}

278 
	gPCLmG’”©Ü
::
	$”rÜOutAndCËªUp
()

280 
	`CËªup
();

281 
jobO³n
=
job_”rÜed
;

282 (
g’”icFau»
);

283 
	}
}

285 
boŞ
 
	gPCLmG’”©Ü
::
	$addXRef
(
sšt32
 
xRefObj
)

287 
	#XREF_ARRAY_SIZE
 100

	)

288 
sšt32
 *
tmpxRefTabË
 = 
NULL
;

289 if(!
xRefTabË
)

291 
xRefTabË
=(
sšt32
*)
	`m®loc
(
XREF_ARRAY_SIZE
*(sint32));

292 
	`as£¹
(
xRefTabË
);

293 if(
NULL
 =ğ
xRefTabË
)

295  
çl£
;

297 
xRefTabË
[0]=0;

298 
xRefIndex
++;

301 
xRefTabË
[
xRefIndex
]=
xRefObj
;

302 
xRefIndex
++;

304 if(!(
xRefIndex
%
XREF_ARRAY_SIZE
))

306 
tmpxRefTabË
=(
sšt32
*)
	`»®loc
(
xRefTabË
,(((
xRefIndex
+
XREF_ARRAY_SIZE
)*(sint32))));

307 ifĞ
NULL
 !ğ
tmpxRefTabË
)

309 
xRefTabË
 = 
tmpxRefTabË
;

314 (
Œue
);

315 
	}
}

318 
boŞ
 
	gPCLmG’”©Ü
::
	$addKids
(
sšt32
 
kidObj
)

320 
	#KID_ARRAY_SIZE
 20

	)

321 
sšt32
 *
tmpKidsA¼ay
 = 
NULL
;

322 if(!
KidsA¼ay
)

324 
KidsA¼ay
=(
sšt32
*)
	`m®loc
(
KID_ARRAY_SIZE
*(sint32));

325 
	`as£¹
(
KidsA¼ay
);

326 if(
NULL
 =ğ
KidsA¼ay
)

328  
çl£
;

332 
KidsA¼ay
[
numKids
]=
kidObj
;

333 
numKids
++;

335 if(!(
numKids
%
KID_ARRAY_SIZE
))

337 
tmpKidsA¼ay
=(
sšt32
*)
	`»®loc
(
KidsA¼ay
,((
numKids
+
KID_ARRAY_SIZE
)*(sint32)));

338 ifĞ
NULL
 !ğ
tmpKidsA¼ay
)

340 
KidsA¼ay
 = 
tmpKidsA¼ay
;

343 (
Œue
);

344 
	}
}

346 
boŞ—n
 
	$wr™eOuutFe
(
numBy‹s
, 
uby‹
 *
±r
, *
u£r_Çme
)

348 
FILE
 *
ouutFe
;

349 
outFeName
[
MAX_FILE_PATH_LEN
];

350 
feCÁr
=0;

353  
TRUE
;

354 
	`¢´štf
(
outFeName
,(outFeName),"%s/hp_%s_cups_outfe_%04d",
CUPS_TMP_DIR
, 
u£r_Çme
, 
feCÁr
);

356 
feCÁr
++;

359 ià(!(
ouutFe
 = 
	`fİ’
 (
outFeName
, "w")))

361 
	`dbglog
 ("Could‚ot openhe output file out.\n");

362 
	`ex™
 (-1);

365 
	`fwr™e
(
±r
,
numBy‹s
,1,
ouutFe
);

366 
	`fşo£
(
ouutFe
);

367 (
TRUE
);

368 
	}
}

370 
	gPCLmG’”©Ü
::
	$š™OutBuff
(*
buff
, 
sšt32
 
size
)

372 
cu¼BuffPŒ
=
outBuffPŒ
=
buff
;

373 
outBuffSize
=
size
;

374 
tÙ®By‹sWr™‹nToCu¼Buff
=0;

375 
	`mem£t
(
buff
,0,
size
);

376 
	}
}

379 
	gPCLmG’”©Ü
::
	$wr™eSŒ2OutBuff
(*
¡r
)

381 
sšt32
 
¡rSize
=
	`¡¾’
(
¡r
);

383 *
maxSize
=
cu¼BuffPŒ
+
¡rSize
;

384 
	`as£¹
(
maxSize
-
outBuffPŒ
 < 
outBuffSize
);

385 
	`memıy
(
cu¼BuffPŒ
,
¡r
,
¡rSize
);

386 
cu¼BuffPŒ
+=
¡rSize
;

387 
tÙ®By‹sWr™‹nToCu¼Buff
+=
¡rSize
;

388 
tÙ®By‹sWr™‹nToPCLmFe
+=
¡rSize
;

389 
	}
}

391 
	gPCLmG’”©Ü
::
	$wr™e2Buff
(
uby‹
 *
buff
, 
buffSize
)

393 *
maxSize
=
cu¼BuffPŒ
+
buffSize
;

394 
	`as£¹
(
maxSize
-
outBuffPŒ
 < 
outBuffSize
);

395 
	`memıy
(
cu¼BuffPŒ
,
buff
,
buffSize
);

396 
cu¼BuffPŒ
+=
buffSize
;

397 
tÙ®By‹sWr™‹nToCu¼Buff
+=
buffSize
;

398 
tÙ®By‹sWr™‹nToPCLmFe
+=
buffSize
;

399 
	}
}

401 
	gPCLmG’”©Ü
::
	$¡©OuutFeSize
()

403 
	`addXRef
(
tÙ®By‹sWr™‹nToPCLmFe
);

405 
	}
}

407 
	gPCLmG’”©Ü
::
	$wr™ePDFG¿mm¬T¿”
(
imageWidth
, 
imageHeight
)

409 
i
;

410 
KidsSŒšg
[
KID_STRING_SIZE
];

411 if(
DebugIt2
)

413 
	`dbglog
("imageWidth=%d\n",
imageWidth
);

414 
	`dbglog
("imageHeight=%d\n",
imageHeight
);

417 
	`¢´štf
(
pOutSŒ
,
OUT_STR_SIZE
,"%%============ğPCLm: FeBody: Objeù 1 - C©®og\n"); 
	`wr™eSŒ2OutBuff
(pOutStr);

418 
	`¡©OuutFeSize
();

419 
	`¢´štf
(
pOutSŒ
,
OUT_STR_SIZE
,"%d 0 obj\n", 
CATALOG_OBJ_NUMBER
); 
	`wr™eSŒ2OutBuff
(pOutStr);

420 
	`¢´štf
(
pOutSŒ
,
OUT_STR_SIZE
,"<<\n"); 
	`wr™eSŒ2OutBuff
(pOutStr);

421 
	`¢´štf
(
pOutSŒ
,
OUT_STR_SIZE
,"/Ty³ /C©®og\n"); 
	`wr™eSŒ2OutBuff
(pOutStr);

422 
	`¢´štf
(
pOutSŒ
,
OUT_STR_SIZE
,"/Page %d 0 R\n",
PAGES_OBJ_NUMBER
); 
	`wr™eSŒ2OutBuff
(pOutStr);

423 
	`¢´štf
(
pOutSŒ
,
OUT_STR_SIZE
,">>\n"); 
	`wr™eSŒ2OutBuff
(pOutStr);

424 
	`¢´štf
(
pOutSŒ
,
OUT_STR_SIZE
,"’dobj\n"); 
	`wr™eSŒ2OutBuff
(pOutStr);

426 
	`¢´štf
(
pOutSŒ
,
OUT_STR_SIZE
,"%%============ğPCLm: FeBody: Objeù 2 -…agŒ“ \n"); 
	`wr™eSŒ2OutBuff
(pOutStr);

427 
	`¡©OuutFeSize
();

428 
	`¢´štf
(
pOutSŒ
,
OUT_STR_SIZE
,"%d 0 obj\n", 
PAGES_OBJ_NUMBER
); 
	`wr™eSŒ2OutBuff
(pOutStr);

429 
	`¢´štf
(
pOutSŒ
,
OUT_STR_SIZE
,"<<\n"); 
	`wr™eSŒ2OutBuff
(pOutStr);

430 
	`¢´štf
(
pOutSŒ
,
OUT_STR_SIZE
,"/CouÁ %d\n",
numKids
); 
	`wr™eSŒ2OutBuff
(pOutStr);

433 
	`¢´štf
(
KidsSŒšg
,
KID_STRING_SIZE
,"/Kid [ ");
	`wr™eSŒ2OutBuff
(KidsString);

434 
i
=0;i<
numKids
 && 
KidsA¼ay
;i++)

437 
	`¢´štf
(
KidsSŒšg
,
KID_STRING_SIZE
,"%d 0 R ",
KidsA¼ay
[
i
]);

438 
	`wr™eSŒ2OutBuff
(
KidsSŒšg
);

441 
	`¢´štf
(
KidsSŒšg
,
KID_STRING_SIZE
,"]\n");

442 
	`wr™eSŒ2OutBuff
(
KidsSŒšg
);

445 
	`¢´štf
(
pOutSŒ
,
OUT_STR_SIZE
,"/Ty³ /Pages\n"); 
	`wr™eSŒ2OutBuff
(pOutStr);

446 
	`¢´štf
(
pOutSŒ
,
OUT_STR_SIZE
,">>\n"); 
	`wr™eSŒ2OutBuff
(pOutStr);

447 
	`¢´štf
(
pOutSŒ
,
OUT_STR_SIZE
,"’dobj\n"); 
	`wr™eSŒ2OutBuff
(pOutStr);

449 
	`¢´štf
(
pOutSŒ
,
OUT_STR_SIZE
,"%%============ğPCLm: cross-»ã»nû seùiÚ: objeù 0, 6ƒÁr›s\n"); 
	`wr™eSŒ2OutBuff
(pOutStr);

450 
	`¡©OuutFeSize
();

451 
xRefS¹
=
xRefIndex
-1;

452 
šfoObj
=
xRefIndex
;

454 
	`¢´štf
(
pOutSŒ
,
OUT_STR_SIZE
,"x»f\n"); 
	`wr™eSŒ2OutBuff
(pOutStr);

455 
	`¢´štf
(
pOutSŒ
,
OUT_STR_SIZE
,"0 %d\n",1); 
	`wr™eSŒ2OutBuff
(pOutStr);

457 
	`¢´štf
(
pOutSŒ
,
OUT_STR_SIZE
,"0000000000 65535 f\n"); 
	`wr™eSŒ2OutBuff
(pOutStr);

458 
	`¢´štf
(
pOutSŒ
,
OUT_STR_SIZE
,"%d %d\n",
PAGES_OBJ_NUMBER
+1,
xRefIndex
-4); 
	`wr™eSŒ2OutBuff
(pOutStr);

459 
i
=1;i<
xRefIndex
-3 && 
xRefTabË
;i++)

461 
	`¢´štf
(
pOutSŒ
,
OUT_STR_SIZE
,"%010d %05d‚\n",
xRefTabË
[
i
],0); 
	`wr™eSŒ2OutBuff
(pOutStr);

464 #ifdeà
PIECEINFO_SUPPORTED


466 
	`¢´štf
(
pOutSŒ
,
OUT_STR_SIZE
,"9996 0 obj\n"); 
	`wr™eSŒ2OutBuff
(pOutStr);

467 
	`¢´štf
(
pOutSŒ
,
OUT_STR_SIZE
,"<</HPDefše1 1\n"); 
	`wr™eSŒ2OutBuff
(pOutStr);

468 
	`¢´štf
(
pOutSŒ
,
OUT_STR_SIZE
,"/Priv©9997 0 R>>\n"); 
	`wr™eSŒ2OutBuff
(pOutStr);

469 
	`¢´štf
(
pOutSŒ
,
OUT_STR_SIZE
,"9997 0 obj\n"); 
	`wr™eSŒ2OutBuff
(pOutStr);

474 
	`¢´štf
(
pOutSŒ
,
OUT_STR_SIZE
,"%d 2\n",
CATALOG_OBJ_NUMBER
); 
	`wr™eSŒ2OutBuff
(pOutStr);

475 if(
xRefTabË
)

477 
	`¢´štf
(
pOutSŒ
,
OUT_STR_SIZE
,"%010d %05d‚\n",
xRefTabË
[
xRefIndex
-3],0); 
	`wr™eSŒ2OutBuff
(pOutStr);

478 
	`¢´štf
(
pOutSŒ
,
OUT_STR_SIZE
,"%010d %05d‚\n",
xRefTabË
[
xRefIndex
-2],0); 
	`wr™eSŒ2OutBuff
(pOutStr);

481 
	`¢´štf
(
pOutSŒ
,
OUT_STR_SIZE
,"%%============ğPCLm: FT¿”\n"); 
	`wr™eSŒ2OutBuff
(pOutStr);

482 
	`¢´štf
(
pOutSŒ
,
OUT_STR_SIZE
,"Œa”\n"); 
	`wr™eSŒ2OutBuff
(pOutStr);

483 
	`¢´štf
(
pOutSŒ
,
OUT_STR_SIZE
,"<<\n"); 
	`wr™eSŒ2OutBuff
(pOutStr);

485 
	`¢´štf
(
pOutSŒ
,
OUT_STR_SIZE
,"/Siz%d\n", 
xRefIndex
-1); 
	`wr™eSŒ2OutBuff
(pOutStr);

486 
	`¢´štf
(
pOutSŒ
,
OUT_STR_SIZE
,"/RoÙ %d 0 R\n",
CATALOG_OBJ_NUMBER
); 
	`wr™eSŒ2OutBuff
(pOutStr);

487 
	`¢´štf
(
pOutSŒ
,
OUT_STR_SIZE
,">>\n"); 
	`wr™eSŒ2OutBuff
(pOutStr);

488 
	`¢´štf
(
pOutSŒ
,
OUT_STR_SIZE
,"¡¬tx»f\n"); 
	`wr™eSŒ2OutBuff
(pOutStr);

489 if(
xRefTabË
)

491 
	`¢´štf
(
pOutSŒ
,
OUT_STR_SIZE
,"%d\n",
xRefTabË
[
xRefS¹
]); 
	`wr™eSŒ2OutBuff
(pOutStr);

493 
	`¢´štf
(
pOutSŒ
,
OUT_STR_SIZE
,"%%%%EOF\n"); 
	`wr™eSŒ2OutBuff
(pOutStr);

494 
	}
}

496 
boŞ
 
	gPCLmG’”©Ü
::
	$šjeùAdobeRGBCS
()

498 if(
adobeRGBCS_fœ¡Time
)

501 
	`¢´štf
(
pOutSŒ
,
OUT_STR_SIZE
,"%%============ğPCLm: ICC Profe\n"); 
	`wr™eSŒ2OutBuff
(pOutStr);

502 
	`¡©OuutFeSize
();

503 
	`¢´štf
(
pOutSŒ
,
OUT_STR_SIZE
,"%d 0 obj\n", 
objCouÁ”
); objCouÁ”++; 
	`wr™eSŒ2OutBuff
(pOutStr);

504 
	`¢´štf
(
pOutSŒ
,
OUT_STR_SIZE
,"[/ICCBa£d %d 0 R]\n",
objCouÁ”
); 
	`wr™eSŒ2OutBuff
(pOutStr);

506 
	`¢´štf
(
pOutSŒ
,
OUT_STR_SIZE
,"’dobj\n"); 
	`wr™eSŒ2OutBuff
(pOutStr);

507 
	`¡©OuutFeSize
();

508 
	`¢´štf
(
pOutSŒ
,
OUT_STR_SIZE
,"%d 0 obj\n", 
objCouÁ”
); objCouÁ”++; 
	`wr™eSŒ2OutBuff
(pOutStr);

509 
	`¢´štf
(
pOutSŒ
,
OUT_STR_SIZE
,"<<\n"); 
	`wr™eSŒ2OutBuff
(pOutStr);

510 
	`¢´štf
(
pOutSŒ
,
OUT_STR_SIZE
,"/N 3\n"); 
	`wr™eSŒ2OutBuff
(pOutStr);

511 
	`¢´štf
(
pOutSŒ
,
OUT_STR_SIZE
,"/AÉ”Ç‹ /DeviûRGB\n"); 
	`wr™eSŒ2OutBuff
(pOutStr);

512 
	`¢´štf
(
pOutSŒ
,
OUT_STR_SIZE
,"/L’gth %u\n",
ADOBE_RGB_SIZE
+1); 
	`wr™eSŒ2OutBuff
(pOutStr);

513 
	`¢´štf
(
pOutSŒ
,
OUT_STR_SIZE
,"/F‹¸/FÏ‹Decode\n"); 
	`wr™eSŒ2OutBuff
(pOutStr);

514 
	`¢´štf
(
pOutSŒ
,
OUT_STR_SIZE
,">>\n"); 
	`wr™eSŒ2OutBuff
(pOutStr);

515 
	`¢´štf
(
pOutSŒ
,
OUT_STR_SIZE
,"¡»am\n"); 
	`wr™eSŒ2OutBuff
(pOutStr);

517 
	`wr™e2Buff
(
æ©eBufãr
,
ADOBE_RGB_SIZE
);

519 
	`¢´štf
(
pOutSŒ
,
OUT_STR_SIZE
,"\Ãnd¡»am\n"); 
	`wr™eSŒ2OutBuff
(pOutStr);

520 
	`¢´štf
(
pOutSŒ
,
OUT_STR_SIZE
,"’dobj\n"); 
	`wr™eSŒ2OutBuff
(pOutStr);

523 
adobeRGBCS_fœ¡Time
=
çl£
;

524 (
Œue
);

525 
	}
}

533 
boŞ
 
	gPCLmG’”©Ü
::
	$cŞÜCÚv”tSourû
(
cŞÜS·ûDi¥os™iÚ
 
¤cCS
, cŞÜS·ûDi¥os™iÚ 
d¡CS
, 
uby‹
 *
¡r
, 
sšt32
 
¡rWidth
, sšt32 
¡rHeight
)

535 if(
¤cCS
==
deviûRGB
 && 
d¡CS
==
g¿ySÿË
)

538 
uby‹
 *
¤cPŒ
=
¡r
;

539 
uby‹
 *
d¡PŒ
=
¡r
;

540 
h
=0;h<
¡rHeight
;h++)

542 
w
=0;w<
¡rWidth
;w++,
d¡PŒ
++,
¤cPŒ
+=3)

545 *
d¡PŒ
=(
uby‹
)
	`rgb_2_g¿y
(*
¤cPŒ
,*(srcPtr+1),*(srcPtr+2));

548 
d¡NumCompÚ’ts
=1;

553 
	`as£¹
(1);

556 (
Œue
);

557 
	}
}

559 
	gPCLmG’”©Ü
::
	$šjeùRLESŒ
(
uby‹
 *
RLEBufãr
, 
numBy‹s
, 
imageWidth
, 
imageHeight
, 
cŞÜS·ûDi¥os™iÚ
 
de¡CŞÜS·û
, 
boŞ
 
wh™eSŒ
)

562 
¡rL’gth
;

563 
¡r
[512];

564 
feSŒ
[25];

565 
¡rCouÁ
=0;

567 if(
DebugIt2
)

569 
	`dbglog
("Injecting RLE compression stream into PDF\n");

570 
	`dbglog
("‚umBy‹s=%d, imageWidth=%d, imageHeight=%d\n",
numBy‹s
,
imageWidth
,
imageHeight
);

572 
	`¢´štf
(
feSŒ
,25,"¾eFe.%d",
¡rCouÁ
);

573 
¡rCouÁ
++;

574 
	`wr™e2Buff
(
RLEBufãr
,
numBy‹s
);

577 if(
de¡CŞÜS·û
==
adobeRGB
)

579 
	`šjeùAdobeRGBCS
();

583 
	`¢´štf
(
pOutSŒ
,
OUT_STR_SIZE
,"%%============ğPCLm: FeBody: SŒ SŒ—m: RLE Imag\n"); 
	`wr™eSŒ2OutBuff
(pOutStr);

584 
	`¡©OuutFeSize
();

585 
	`¢´štf
(
pOutSŒ
,
OUT_STR_SIZE
,"%d 0 obj\n", 
objCouÁ”
); objCouÁ”++; 
	`wr™eSŒ2OutBuff
(pOutStr);

586 
	`¢´štf
(
pOutSŒ
,
OUT_STR_SIZE
,"<<\n"); 
	`wr™eSŒ2OutBuff
(pOutStr);

587 
	`¢´štf
(
pOutSŒ
,
OUT_STR_SIZE
,"/Width %d\n", 
imageWidth
); 
	`wr™eSŒ2OutBuff
(pOutStr);

588 if(
de¡CŞÜS·û
==
deviûRGB
)

590 
	`¢´štf
(
pOutSŒ
,
OUT_STR_SIZE
,"/CŞÜS·û /DeviûRGB\n"); 
	`wr™eSŒ2OutBuff
(pOutStr);

592 if(
de¡CŞÜS·û
==
adobeRGB
)

594 
	`¢´štf
(
pOutSŒ
,
OUT_STR_SIZE
,"/CŞÜS·û 5 0 R\n"); 
	`wr™eSŒ2OutBuff
(pOutStr);

596 if(
de¡CŞÜS·û
==
bÏckÚly
)

598 
	`¢´štf
(
pOutSŒ
,
OUT_STR_SIZE
,"/CŞÜS·û /DeviûRGB\n"); 
	`wr™eSŒ2OutBuff
(pOutStr);

602 
	`¢´štf
(
pOutSŒ
,
OUT_STR_SIZE
,"/CŞÜS·û /DeviûG¿y\n"); 
	`wr™eSŒ2OutBuff
(pOutStr);

604 
	`¢´štf
(
pOutSŒ
,
OUT_STR_SIZE
,"/Heighˆ%d\n", 
imageHeight
); 
	`wr™eSŒ2OutBuff
(pOutStr);

605 
	`¢´štf
(
pOutSŒ
,
OUT_STR_SIZE
,"/F‹¸/RunL’gthDecode\n"); 
	`wr™eSŒ2OutBuff
(pOutStr);

606 
	`¢´štf
(
pOutSŒ
,
OUT_STR_SIZE
,"/Subty³ /Image\n"); 
	`wr™eSŒ2OutBuff
(pOutStr);

607 
	`¢´štf
(
pOutSŒ
,
OUT_STR_SIZE
,"/L’gth %d\n",
numBy‹s
); 
	`wr™eSŒ2OutBuff
(pOutStr);

608 
	`¢´štf
(
pOutSŒ
,
OUT_STR_SIZE
,"/Ty³ /XObjeù\n"); 
	`wr™eSŒ2OutBuff
(pOutStr);

609 
	`¢´štf
(
pOutSŒ
,
OUT_STR_SIZE
,"/B™sP”CompÚ’ˆ8\n"); 
	`wr™eSŒ2OutBuff
(pOutStr);

610 #ifdeà
SUPPORT_WHITE_STRIPS


611 if(
wh™eSŒ
)

613 
	`¢´štf
(
pOutSŒ
,
OUT_STR_SIZE
,"/Nam/Wh™eSŒ\n"); 
	`wr™eSŒ2OutBuff
(pOutStr);

617 
	`¢´štf
(
pOutSŒ
,
OUT_STR_SIZE
,"/Nam/CŞÜSŒ\n"); 
	`wr™eSŒ2OutBuff
(pOutStr);

621 
	`¢´štf
(
pOutSŒ
,
OUT_STR_SIZE
,">>\n"); 
	`wr™eSŒ2OutBuff
(pOutStr);

622 
	`¢´štf
(
pOutSŒ
,
OUT_STR_SIZE
,"¡»am\n"); 
	`wr™eSŒ2OutBuff
(pOutStr);

625 
	`wr™e2Buff
(
RLEBufãr
,
numBy‹s
);

626 
	`¢´štf
(
pOutSŒ
,
OUT_STR_SIZE
,"\Ãnd¡»am\n"); 
	`wr™eSŒ2OutBuff
(pOutStr);

627 
	`¢´štf
(
pOutSŒ
,
OUT_STR_SIZE
,"’dobj\n"); 
	`wr™eSŒ2OutBuff
(pOutStr);

630 
	`¢´štf
(
pOutSŒ
,
OUT_STR_SIZE
,"%%============ğPCLm: Objeù - ImagT¿nsfÜm©iÚ \n"); 
	`wr™eSŒ2OutBuff
(pOutStr);

631 
	`¡©OuutFeSize
();

632 
	`¢´štf
(
pOutSŒ
,
OUT_STR_SIZE
,"%d 0 obj\n", 
objCouÁ”
); objCouÁ”++; 
	`wr™eSŒ2OutBuff
(pOutStr);

633 
	`¢´štf
(
pOutSŒ
,
OUT_STR_SIZE
,"<<\n"); 
	`wr™eSŒ2OutBuff
(pOutStr);

635 
	`¢´štf
(
¡r
,512,"q /image Do Q\n");

636 
¡rL’gth
=
	`¡¾’
(
¡r
);

638 
	`¢´štf
(
pOutSŒ
,
OUT_STR_SIZE
,"/L’gth %d\n",
¡rL’gth
); 
	`wr™eSŒ2OutBuff
(pOutStr);

639 
	`¢´štf
(
pOutSŒ
,
OUT_STR_SIZE
,">>\n"); 
	`wr™eSŒ2OutBuff
(pOutStr);

640 
	`¢´štf
(
pOutSŒ
,
OUT_STR_SIZE
,"¡»am\n"); 
	`wr™eSŒ2OutBuff
(pOutStr);

641 
	`¢´štf
(
pOutSŒ
,
OUT_STR_SIZE
,"%s",
¡r
); 
	`wr™eSŒ2OutBuff
(pOutStr);

642 
	`¢´štf
(
pOutSŒ
,
OUT_STR_SIZE
,"’d¡»am\n"); 
	`wr™eSŒ2OutBuff
(pOutStr);

643 
	`¢´štf
(
pOutSŒ
,
OUT_STR_SIZE
,"’dobj\n"); 
	`wr™eSŒ2OutBuff
(pOutStr);

646 
	}
}

648 
	gPCLmG’”©Ü
::
	$šjeùLZSŒ
(
uby‹
 *
LZBufãr
, 
numBy‹s
, 
imageWidth
, 
imageHeight
, 
cŞÜS·ûDi¥os™iÚ
 
de¡CŞÜS·û
, 
boŞ
 
wh™eSŒ
)

651 
¡rL’gth
;

652 
¡r
[512];

654 if(
DebugIt2
)

656 
	`dbglog
("Injecting LZ compression stream into PDF\n");

657 
	`dbglog
("‚umBy‹s=%d, imageWidth=%d, imageHeight=%d\n",
numBy‹s
,
imageWidth
,
imageHeight
);

660 if(
de¡CŞÜS·û
==
adobeRGB
)

662 
	`šjeùAdobeRGBCS
();

666 
	`¢´štf
(
pOutSŒ
,
OUT_STR_SIZE
,"%%============ğPCLm: FeBody: SŒ SŒ—m: zlib Imag\n"); 
	`wr™eSŒ2OutBuff
(pOutStr);

667 
	`¡©OuutFeSize
();

668 
	`¢´štf
(
pOutSŒ
,
OUT_STR_SIZE
,"%d 0 obj\n", 
objCouÁ”
); objCouÁ”++; 
	`wr™eSŒ2OutBuff
(pOutStr);

669 
	`¢´štf
(
pOutSŒ
,
OUT_STR_SIZE
,"<<\n"); 
	`wr™eSŒ2OutBuff
(pOutStr);

670 
	`¢´štf
(
pOutSŒ
,
OUT_STR_SIZE
,"/Width %d\n", 
imageWidth
); 
	`wr™eSŒ2OutBuff
(pOutStr);

671 if(
de¡CŞÜS·û
==
deviûRGB
)

673 
	`¢´štf
(
pOutSŒ
,
OUT_STR_SIZE
,"/CŞÜS·û /DeviûRGB\n"); 
	`wr™eSŒ2OutBuff
(pOutStr);

675 if(
de¡CŞÜS·û
==
adobeRGB
)

677 
	`¢´štf
(
pOutSŒ
,
OUT_STR_SIZE
,"/CŞÜS·û 5 0 R\n"); 
	`wr™eSŒ2OutBuff
(pOutStr);

679 if(
de¡CŞÜS·û
==
bÏckÚly
)

681 
	`¢´štf
(
pOutSŒ
,
OUT_STR_SIZE
,"/CŞÜS·û /DeviûRGB\n"); 
	`wr™eSŒ2OutBuff
(pOutStr);

685 
	`¢´štf
(
pOutSŒ
,
OUT_STR_SIZE
,"/CŞÜS·û /DeviûG¿y\n"); 
	`wr™eSŒ2OutBuff
(pOutStr);

687 
	`¢´štf
(
pOutSŒ
,
OUT_STR_SIZE
,"/Heighˆ%d\n", 
imageHeight
); 
	`wr™eSŒ2OutBuff
(pOutStr);

688 
	`¢´štf
(
pOutSŒ
,
OUT_STR_SIZE
,"/F‹¸/FÏ‹Decode\n"); 
	`wr™eSŒ2OutBuff
(pOutStr);

689 
	`¢´štf
(
pOutSŒ
,
OUT_STR_SIZE
,"/Subty³ /Image\n"); 
	`wr™eSŒ2OutBuff
(pOutStr);

690 
	`¢´štf
(
pOutSŒ
,
OUT_STR_SIZE
,"/L’gth %d\n",
numBy‹s
); 
	`wr™eSŒ2OutBuff
(pOutStr);

691 
	`¢´štf
(
pOutSŒ
,
OUT_STR_SIZE
,"/Ty³ /XObjeù\n"); 
	`wr™eSŒ2OutBuff
(pOutStr);

692 
	`¢´štf
(
pOutSŒ
,
OUT_STR_SIZE
,"/B™sP”CompÚ’ˆ8\n"); 
	`wr™eSŒ2OutBuff
(pOutStr);

693 #ifdeà
SUPPORT_WHITE_STRIPS


694 if(
wh™eSŒ
)

696 
	`¢´štf
(
pOutSŒ
,
OUT_STR_SIZE
,"/Nam/Wh™eSŒ\n"); 
	`wr™eSŒ2OutBuff
(pOutStr);

700 
	`¢´štf
(
pOutSŒ
,
OUT_STR_SIZE
,"/Nam/CŞÜSŒ\n"); 
	`wr™eSŒ2OutBuff
(pOutStr);

704 
	`¢´štf
(
pOutSŒ
,
OUT_STR_SIZE
,">>\n"); 
	`wr™eSŒ2OutBuff
(pOutStr);

705 
	`¢´štf
(
pOutSŒ
,
OUT_STR_SIZE
,"¡»am\n"); 
	`wr™eSŒ2OutBuff
(pOutStr);

708 
	`wr™e2Buff
(
LZBufãr
,
numBy‹s
);

709 
	`¢´štf
(
pOutSŒ
,
OUT_STR_SIZE
,"\Ãnd¡»am\n"); 
	`wr™eSŒ2OutBuff
(pOutStr);

710 
	`¢´štf
(
pOutSŒ
,
OUT_STR_SIZE
,"’dobj\n"); 
	`wr™eSŒ2OutBuff
(pOutStr);

713 
	`¢´štf
(
pOutSŒ
,
OUT_STR_SIZE
,"%%============ğPCLm: Objeù - ImagT¿nsfÜm©iÚ \n"); 
	`wr™eSŒ2OutBuff
(pOutStr);

714 
	`¡©OuutFeSize
();

715 
	`¢´štf
(
pOutSŒ
,
OUT_STR_SIZE
,"%d 0 obj\n", 
objCouÁ”
); objCouÁ”++; 
	`wr™eSŒ2OutBuff
(pOutStr);

716 
	`¢´štf
(
pOutSŒ
,
OUT_STR_SIZE
,"<<\n"); 
	`wr™eSŒ2OutBuff
(pOutStr);

718 
	`¢´štf
(
¡r
,512,"q /image Do Q\n");

719 
¡rL’gth
=
	`¡¾’
(
¡r
);

721 
	`¢´štf
(
pOutSŒ
,
OUT_STR_SIZE
,"/L’gth %d\n",
¡rL’gth
); 
	`wr™eSŒ2OutBuff
(pOutStr);

722 
	`¢´štf
(
pOutSŒ
,
OUT_STR_SIZE
,">>\n"); 
	`wr™eSŒ2OutBuff
(pOutStr);

723 
	`¢´štf
(
pOutSŒ
,
OUT_STR_SIZE
,"¡»am\n"); 
	`wr™eSŒ2OutBuff
(pOutStr);

724 
	`¢´štf
(
pOutSŒ
,
OUT_STR_SIZE
,"%s",
¡r
); 
	`wr™eSŒ2OutBuff
(pOutStr);

725 
	`¢´štf
(
pOutSŒ
,
OUT_STR_SIZE
,"’d¡»am\n"); 
	`wr™eSŒ2OutBuff
(pOutStr);

726 
	`¢´štf
(
pOutSŒ
,
OUT_STR_SIZE
,"’dobj\n"); 
	`wr™eSŒ2OutBuff
(pOutStr);

729 
	}
}

731 
	gPCLmG’”©Ü
::
	$šjeùJPEG
(*
j³g_Buff
, 
imageWidth
, 
imageHeight
, 
numCompBy‹s
, 
cŞÜS·ûDi¥os™iÚ
 
de¡CŞÜS·û
, 
boŞ
 
wh™eSŒ
)

734 
¡rL’gth
;

735 
¡r
[512];

737 if(
DebugIt2
)

739 
	`dbglog
("Injecting jpegBuff into PDF\n");

742 
yPos™iÚ
+=
imageHeight
;

744 if(
de¡CŞÜS·û
==
adobeRGB
)

746 
	`šjeùAdobeRGBCS
();

750 
	`¢´štf
(
pOutSŒ
,
OUT_STR_SIZE
,"%%============ğPCLm: FeBody: SŒ SŒ—m: j³g Imag\n"); 
	`wr™eSŒ2OutBuff
(pOutStr);

751 
	`¡©OuutFeSize
();

752 
	`¢´štf
(
pOutSŒ
,
OUT_STR_SIZE
,"%d 0 obj\n", 
objCouÁ”
); objCouÁ”++; 
	`wr™eSŒ2OutBuff
(pOutStr);

753 
	`¢´štf
(
pOutSŒ
,
OUT_STR_SIZE
,"<<\n"); 
	`wr™eSŒ2OutBuff
(pOutStr);

754 
	`¢´štf
(
pOutSŒ
,
OUT_STR_SIZE
,"/Width %d\n", 
imageWidth
); 
	`wr™eSŒ2OutBuff
(pOutStr);

755 if(
de¡CŞÜS·û
==
deviûRGB
)

757 
	`¢´štf
(
pOutSŒ
,
OUT_STR_SIZE
,"/CŞÜS·û /DeviûRGB\n"); 
	`wr™eSŒ2OutBuff
(pOutStr);

759 if(
de¡CŞÜS·û
==
adobeRGB
)

761 
	`¢´štf
(
pOutSŒ
,
OUT_STR_SIZE
,"/CŞÜS·û 5 0 R\n"); 
	`wr™eSŒ2OutBuff
(pOutStr);

763 if(
de¡CŞÜS·û
==
bÏckÚly
)

765 
	`¢´štf
(
pOutSŒ
,
OUT_STR_SIZE
,"/CŞÜS·û /DeviûRGB\n"); 
	`wr™eSŒ2OutBuff
(pOutStr);

769 
	`¢´štf
(
pOutSŒ
,
OUT_STR_SIZE
,"/CŞÜS·û /DeviûG¿y\n"); 
	`wr™eSŒ2OutBuff
(pOutStr);

771 
	`¢´štf
(
pOutSŒ
,
OUT_STR_SIZE
,"/Heighˆ%d\n", 
imageHeight
); 
	`wr™eSŒ2OutBuff
(pOutStr);

772 
	`¢´štf
(
pOutSŒ
,
OUT_STR_SIZE
,"/F‹¸/DCTDecode\n"); 
	`wr™eSŒ2OutBuff
(pOutStr);

773 
	`¢´štf
(
pOutSŒ
,
OUT_STR_SIZE
,"/Subty³ /Image\n"); 
	`wr™eSŒ2OutBuff
(pOutStr);

774 
	`¢´štf
(
pOutSŒ
,
OUT_STR_SIZE
,"/L’gth %d\n",
numCompBy‹s
); 
	`wr™eSŒ2OutBuff
(pOutStr);

775 
	`¢´štf
(
pOutSŒ
,
OUT_STR_SIZE
,"/Ty³ /XObjeù\n"); 
	`wr™eSŒ2OutBuff
(pOutStr);

776 
	`¢´štf
(
pOutSŒ
,
OUT_STR_SIZE
,"/B™sP”CompÚ’ˆ8\n"); 
	`wr™eSŒ2OutBuff
(pOutStr);

777 #ifdeà
SUPPORT_WHITE_STRIPS


778 if(
wh™eSŒ
)

780 
	`¢´štf
(
pOutSŒ
,
OUT_STR_SIZE
,"/Nam/Wh™eSŒ\n"); 
	`wr™eSŒ2OutBuff
(pOutStr);

784 
	`¢´štf
(
pOutSŒ
,
OUT_STR_SIZE
,"/Nam/CŞÜSŒ\n"); 
	`wr™eSŒ2OutBuff
(pOutStr);

787 
	`¢´štf
(
pOutSŒ
,
OUT_STR_SIZE
,">>\n"); 
	`wr™eSŒ2OutBuff
(pOutStr);

788 
	`¢´štf
(
pOutSŒ
,
OUT_STR_SIZE
,"¡»am\n"); 
	`wr™eSŒ2OutBuff
(pOutStr);

801 
	`wr™e2Buff
((
uby‹
*)
j³g_Buff
,
numCompBy‹s
);

802 
	`¢´štf
(
pOutSŒ
,
OUT_STR_SIZE
,"\Ãnd¡»am\n"); 
	`wr™eSŒ2OutBuff
(pOutStr);

803 
	`¢´štf
(
pOutSŒ
,
OUT_STR_SIZE
,"’dobj\n"); 
	`wr™eSŒ2OutBuff
(pOutStr);

805 
	`¢´štf
(
¡r
,512,"q /image Do Q\n");

806 
¡rL’gth
=
	`¡¾’
(
¡r
);

809 
	`¢´štf
(
pOutSŒ
,
OUT_STR_SIZE
,"%%============ğPCLm: Objeù - ImagT¿nsfÜm©iÚ \n"); 
	`wr™eSŒ2OutBuff
(pOutStr);

810 
	`¡©OuutFeSize
();

811 
	`¢´štf
(
pOutSŒ
,
OUT_STR_SIZE
,"%d 0 obj\n", 
objCouÁ”
); objCouÁ”++; 
	`wr™eSŒ2OutBuff
(pOutStr);

812 
	`¢´štf
(
pOutSŒ
,
OUT_STR_SIZE
,"<<\n"); 
	`wr™eSŒ2OutBuff
(pOutStr);

813 
	`¢´štf
(
pOutSŒ
,
OUT_STR_SIZE
,"/L’gth %d\n",
¡rL’gth
); 
	`wr™eSŒ2OutBuff
(pOutStr);

814 
	`¢´štf
(
pOutSŒ
,
OUT_STR_SIZE
,">>\n"); 
	`wr™eSŒ2OutBuff
(pOutStr);

815 
	`¢´štf
(
pOutSŒ
,
OUT_STR_SIZE
,"¡»am\n"); 
	`wr™eSŒ2OutBuff
(pOutStr);

816 
	`¢´štf
(
pOutSŒ
,
OUT_STR_SIZE
,"%s",
¡r
); 
	`wr™eSŒ2OutBuff
(pOutStr);

817 
	`¢´štf
(
pOutSŒ
,
OUT_STR_SIZE
,"’d¡»am\n"); 
	`wr™eSŒ2OutBuff
(pOutStr);

818 
	`¢´štf
(
pOutSŒ
,
OUT_STR_SIZE
,"’dobj\n"); 
	`wr™eSŒ2OutBuff
(pOutStr);

821 
	}
}

824 
	$wr™eSŒ2Buff
(*
bufãr
,*
¡r
)

826 
buffSize
;

827 *
buffPos
;

829 
buffSize
=
	`¡¾’
(
bufãr
)+¡¾’(
¡r
);

830 if(
buffSize
>
TEMP_BUFF_SIZE
)

831 
	`as£¹
(0);

833 
buffSize
=
	`¡¾’
(
bufãr
);

834 
buffPos
=
bufãr
+
buffSize
;

835 
	`¢´štf
(
buffPos
,
TEMP_BUFF_SIZE
 - 
buffSize
,"%s",
¡r
);

837 
buffSize
=
	`¡¾’
(
bufãr
);

838 if(
buffSize
>
TEMP_BUFF_SIZE
)

840 
	`dbglog
("‹mpBufàsizexûeded: buffSize=%d\n",
buffSize
);

841 
	`as£¹
(0);

843 
	}
}

855 
	gPCLmG’”©Ü
::
	$wr™ePDFG¿mm¬Page
(
imageWidth
, 
imageHeight
, 
numSŒs
, 
cŞÜS·ûDi¥os™iÚ
 
de¡CŞÜS·û
)

857 
i
, 
imageRef
=
objCouÁ”
+2, 
buffSize
;

858 
yAnchÜ
;

859 
¡r
[512];

860 *
‹mpBufãr
 = 
NULL
;

861 
¡¬tImageIndex
=0;

862 
numLšesLeá
 = 0;

864 if(
de¡CŞÜS·û
==
adobeRGB
 && 1 =ğ
·geCouÁ
)

866 
imageRef
+=2;

869 
‹mpBufãr
=(*)
	`m®loc
(
TEMP_BUFF_SIZE
);

870 
	`as£¹
(
‹mpBufãr
);

872 ià(
NULL
 =ğ
‹mpBufãr
)

876 if(
DebugIt2
)

877 
	`dbglog
("AÎoÿ‹d %d by‹ fÜempBufãr\n",
TEMP_BUFF_SIZE
);

878 
	`mem£t
(
‹mpBufãr
,0x0,
TEMP_BUFF_SIZE
);

880 
	`¢´štf
(
pOutSŒ
,
OUT_STR_SIZE
,"%%============ğPCLm: FeBody: Objeù 3 -…agobjeù\n"); 
	`wr™eSŒ2OutBuff
(pOutStr);

881 
	`¡©OuutFeSize
();

882 
	`¢´štf
(
pOutSŒ
,
OUT_STR_SIZE
,"%d 0 obj\n", 
objCouÁ”
); 
	`wr™eSŒ2OutBuff
(pOutStr);

883 
	`addKids
(
objCouÁ”
);

884 
objCouÁ”
++;

885 
	`¢´štf
(
pOutSŒ
,
OUT_STR_SIZE
,"<<\n"); 
	`wr™eSŒ2OutBuff
(pOutStr);

886 
	`¢´štf
(
pOutSŒ
,
OUT_STR_SIZE
,"/Ty³ /Page\n"); 
	`wr™eSŒ2OutBuff
(pOutStr);

887 
	`¢´štf
(
pOutSŒ
,
OUT_STR_SIZE
,"/P¬’ˆ%d 0 R\n",
PAGES_OBJ_NUMBER
); 
	`wr™eSŒ2OutBuff
(pOutStr);

888 
	`¢´štf
(
pOutSŒ
,
OUT_STR_SIZE
,"/Resourû <<\n"); 
	`wr™eSŒ2OutBuff
(pOutStr);

890 
	`¢´štf
(
pOutSŒ
,
OUT_STR_SIZE
,"/XObjeù <<\n"); 
	`wr™eSŒ2OutBuff
(pOutStr);

892 if(
tİM¬gšInPix
)

894 
i
=0;i<
numFuÎInjeùedSŒs
;i++,
¡¬tImageIndex
++)

896 
	`¢´štf
(
¡r
,512,"/Image%d %d 0 R\n",
¡¬tImageIndex
,
imageRef
);

897 
	`¢´štf
(
pOutSŒ
,
OUT_STR_SIZE
,"%s",
¡r
); 
	`wr™eSŒ2OutBuff
(pOutStr);

898 
imageRef
+=2;

900 if(
numP¬tŸlSÿÆšesToInjeù
)

902 
	`¢´štf
(
¡r
,512,"/Image%d %d 0 R\n",
¡¬tImageIndex
,
imageRef
);

903 
	`¢´štf
(
pOutSŒ
,
OUT_STR_SIZE
,"%s",
¡r
); 
	`wr™eSŒ2OutBuff
(pOutStr);

904 
imageRef
+=2;

905 
¡¬tImageIndex
++;

909 
i
=
¡¬tImageIndex
;i<
numSŒs
+startImageIndex;i++)

911 
	`¢´štf
(
¡r
,512,"/Image%d %d 0 R\n",
i
,
imageRef
);

913 
	`¢´štf
(
pOutSŒ
,
OUT_STR_SIZE
,"%s",
¡r
); 
	`wr™eSŒ2OutBuff
(pOutStr);

914 
imageRef
+=2;

916 
	`¢´štf
(
pOutSŒ
,
OUT_STR_SIZE
,">>\n"); 
	`wr™eSŒ2OutBuff
(pOutStr);

917 
	`¢´štf
(
pOutSŒ
,
OUT_STR_SIZE
,">>\n"); 
	`wr™eSŒ2OutBuff
(pOutStr);

918 if(
cu¼MedŸOr›Á©iÚDi¥os™iÚ
==
Ïndsÿ³Or›Á©iÚ
)

920 
·geOrigš
=
medŸWidth
;

921 
	`¢´štf
(
pOutSŒ
,
OUT_STR_SIZE
,"/MedŸBox [ 0 0 %d %d ]\n", 
medŸHeight
, 
medŸWidth
); 
	`wr™eSŒ2OutBuff
(pOutStr);

925 
·geOrigš
=
medŸHeight
;

926 
	`¢´štf
(
pOutSŒ
,
OUT_STR_SIZE
,"/MedŸBox [ 0 0 %d %d ]\n", 
medŸWidth
, 
medŸHeight
); 
	`wr™eSŒ2OutBuff
(pOutStr);

928 
	`¢´štf
(
pOutSŒ
,
OUT_STR_SIZE
,"/CÚ‹Á [ %d 0 R ]\n",
objCouÁ”
); 
	`wr™eSŒ2OutBuff
(pOutStr);

929 #ifdeà
PIECEINFO_SUPPORTED


930 
	`¢´štf
(
pOutSŒ
,
OUT_STR_SIZE
,"/P›ûInfØ<</HPAdd™iÚ %d 0 R >> \n",9997); 
	`wr™eSŒ2OutBuff
(pOutStr);

932 
	`¢´štf
(
pOutSŒ
,
OUT_STR_SIZE
,">>\n"); 
	`wr™eSŒ2OutBuff
(pOutStr);

933 
	`¢´štf
(
pOutSŒ
,
OUT_STR_SIZE
,"’dobj\n"); 
	`wr™eSŒ2OutBuff
(pOutStr);

936 if(
»v”£Ord”
)

938 
yAnchÜ
=0;

942 
yAnchÜ
=()((
·geOrigš
*
STANDARD_SCALE
)+0.99);

946 
	`¢´štf
(
pOutSŒ
,
OUT_STR_SIZE
,"%%ImagT¿nsfÜm©iÚ M©rix: width, skewX, skewY, height, xAnchÜ, yAnchÜ\n"); 
	`wr™eSŒ2OutBuff
(pOutStr);

947 
	`¢´štf
(
¡r
,512,"%à0 0 %à0 0 cm\n",
STANDARD_SCALE_FOR_PDF
/
cu¼R’d”ResŞutiÚIÁeg”
,STANDARD_SCALE_FOR_PDF/currRenderResolutionInteger);

948 
	`wr™eSŒ2Buff
(
‹mpBufãr
,
¡r
);

950 
¡¬tImageIndex
=0;

951 if(
tİM¬gšInPix
)

953 
i
=0;i<
numFuÎInjeùedSŒs
;i++)

955 if(
»v”£Ord”
)

956 
yAnchÜ
+=
numFuÎSÿÆšesToInjeù
;

958 
yAnchÜ
-=
numFuÎSÿÆšesToInjeù
;

960 
	`¢´štf
(
¡r
,512,"/P <</MCID 0>> BDC q\n");

961 
	`wr™eSŒ2Buff
(
‹mpBufãr
,
¡r
);

963 
	`¢´štf
(
¡r
,512,"%%Image Transformation Matrix: width, skewX, skewY, height, xAnchor, yAnchor\n");

964 
	`wr™eSŒ2Buff
(
‹mpBufãr
,
¡r
);

966 
	`¢´štf
(
¡r
,512,"%d 0 0 %d 0 %d cm\n",
imageWidth
*
sÿËFaùÜ
,
numFuÎSÿÆšesToInjeù
*sÿËFaùÜ,
yAnchÜ
*scaleFactor);

967 
	`wr™eSŒ2Buff
(
‹mpBufãr
,
¡r
);

969 
	`¢´štf
(
¡r
,512,"/Image%d DØQ\n",
¡¬tImageIndex
);

970 
	`wr™eSŒ2Buff
(
‹mpBufãr
,
¡r
);

972 
¡¬tImageIndex
++;

974 if(
numP¬tŸlSÿÆšesToInjeù
)

976 if(
»v”£Ord”
)

977 
yAnchÜ
+=
numP¬tŸlSÿÆšesToInjeù
;

979 
yAnchÜ
-=
numP¬tŸlSÿÆšesToInjeù
;

981 
	`¢´štf
(
¡r
,512,"/P <</MCID 0>> BDC q\n");

982 
	`wr™eSŒ2Buff
(
‹mpBufãr
,
¡r
);

984 
	`¢´štf
(
¡r
,512,"%%Image Transformation Matrix: width, skewX, skewY, height, xAnchor, yAnchor\n");

985 
	`wr™eSŒ2Buff
(
‹mpBufãr
,
¡r
);

987 
	`¢´štf
(
¡r
,512,"%d 0 0 %d 0 %d cm\n",
imageWidth
*
sÿËFaùÜ
,
numP¬tŸlSÿÆšesToInjeù
*sÿËFaùÜ,
yAnchÜ
*scaleFactor);

988 
	`wr™eSŒ2Buff
(
‹mpBufãr
,
¡r
);

990 
	`¢´štf
(
¡r
,512,"/Image%d DØQ\n",
¡¬tImageIndex
);

991 
	`wr™eSŒ2Buff
(
‹mpBufãr
,
¡r
);

993 
¡¬tImageIndex
++;

997 
i
=
¡¬tImageIndex
;i<
numSŒs
+startImageIndex;i++)

1000 if(
i
 =ğ(
numSŒs
+
¡¬tImageIndex
-1))

1002 
numLšesLeá
 = 
cu¼SourûHeight
 - ((
numSŒs
-1è* 
cu¼SŒHeight
);

1004 if(
»v”£Ord”
)

1005 
yAnchÜ
+=
numLšesLeá
;

1007 
yAnchÜ
-=
numLšesLeá
;

1011 if(
»v”£Ord”
)

1012 
yAnchÜ
+=
cu¼SŒHeight
;

1014 
yAnchÜ
-=
cu¼SŒHeight
;

1017 
	`¢´štf
(
¡r
,512,"/P <</MCID 0>> BDC q\n");

1018 
	`wr™eSŒ2Buff
(
‹mpBufãr
,
¡r
);

1020 
	`¢´štf
(
¡r
,512,"%%Image Transformation Matrix: width, skewX, skewY, height, xAnchor, yAnchor\n");

1021 
	`wr™eSŒ2Buff
(
‹mpBufãr
,
¡r
);

1023 if(
i
 =ğ(
numSŒs
+
¡¬tImageIndex
-1))

1025 
	`¢´štf
(
¡r
,512,"%d 0 0 %d 0 %d cm\n",
imageWidth
*
sÿËFaùÜ
,
numLšesLeá
*sÿËFaùÜ,
yAnchÜ
*scaleFactor);

1026 
	`wr™eSŒ2Buff
(
‹mpBufãr
,
¡r
);

1028 if(
yAnchÜ
<0)

1030 
sšt32
 
ÃwH
=
cu¼SŒHeight
+
yAnchÜ
;

1031 
	`¢´štf
(
¡r
,512,"%d 0 0 %d 0 %d cm\n",
imageWidth
*
sÿËFaùÜ
,
ÃwH
*scaleFactor,0*scaleFactor);

1032 
	`wr™eSŒ2Buff
(
‹mpBufãr
,
¡r
);

1036 
	`¢´štf
(
¡r
,512,"%d 0 0 %d 0 %d cm\n",
imageWidth
*
sÿËFaùÜ
,
cu¼SŒHeight
*sÿËFaùÜ,
yAnchÜ
*scaleFactor);

1037 
	`wr™eSŒ2Buff
(
‹mpBufãr
,
¡r
);

1040 
	`¢´štf
(
¡r
,512,"/Image%d DØQ\n",
i
);

1041 
	`wr™eSŒ2Buff
(
‹mpBufãr
,
¡r
);

1046 
buffSize
=
	`¡¾’
(
‹mpBufãr
);

1048 
	`¢´štf
(
pOutSŒ
,
OUT_STR_SIZE
,"%%============ğPCLm: FeBody: PagCÚ‹Á SŒ—m objeù\n"); 
	`wr™eSŒ2OutBuff
(pOutStr);

1049 
	`¡©OuutFeSize
();

1050 
	`¢´štf
(
pOutSŒ
,
OUT_STR_SIZE
,"%d 0 obj\n",
objCouÁ”
); 
	`wr™eSŒ2OutBuff
(pOutStr);

1051 
	`¢´štf
(
pOutSŒ
,
OUT_STR_SIZE
,"<<\n"); 
	`wr™eSŒ2OutBuff
(pOutStr);

1053 
	`¢´štf
(
pOutSŒ
,
OUT_STR_SIZE
,"/L’gth %d\n",
buffSize
); 
	`wr™eSŒ2OutBuff
(pOutStr);

1054 
	`¢´štf
(
pOutSŒ
,
OUT_STR_SIZE
,">>\n"); 
	`wr™eSŒ2OutBuff
(pOutStr);

1055 
	`¢´štf
(
pOutSŒ
,
OUT_STR_SIZE
,"¡»am\n"); 
	`wr™eSŒ2OutBuff
(pOutStr);

1058 
	`wr™e2Buff
((
uby‹
*)
‹mpBufãr
,
buffSize
);

1060 
	`¢´štf
(
pOutSŒ
,
OUT_STR_SIZE
,"’d¡»am\n"); 
	`wr™eSŒ2OutBuff
(pOutStr);

1061 
	`¢´štf
(
pOutSŒ
,
OUT_STR_SIZE
,"’dobj\n"); 
	`wr™eSŒ2OutBuff
(pOutStr);

1062 
objCouÁ”
++;

1063 if(
‹mpBufãr
)

1065 
	`ä“
(
‹mpBufãr
);

1066 
‹mpBufãr
=
NULL
;

1068 
	}
}

1077 
boŞ—n
 
	$´•ImageFÜBacksideDu¶ex
(
uby‹
 *
imagePŒ
, 
sšt32
 
imageHeight
, sšt32 
imageWidth
, sšt32 
numCompÚ’ts
)

1079 
sšt32
 
numBy‹s
=
imageHeight
*
imageWidth
*
numCompÚ’ts
;

1080 
uby‹
 *
h—d
, *

, 
t0
, 
t1
, 
t2
;

1082 if(
numCompÚ’ts
==3)

1084 
h—d
=
imagePŒ
,

=imagePŒ+
numBy‹s
-1;tail>head;)

1086 
t0
=*
h—d
;

1087 
t1
=*(
h—d
+1);

1088 
t2
=*(
h—d
+2);

1090 *
h—d
ğ*(

-2);

1091 *(
h—d
+1)=*(

-1);

1092 *(
h—d
+2)=*(

-0);

1093 *

ğ
t2
;

1094 *(

-1)=
t1
;

1095 *(

-2)=
t0
;

1097 
h—d
+=3;

1098 

-=3;

1103 
h—d
=
imagePŒ
,

=imagePŒ+
numBy‹s
;tail>head;)

1105 
t0
=*
h—d
;

1106 *
h—d
=*

;

1107 *

=
t0
;

1108 
h—d
++;

1109 

--;

1113 (
TRUE
);

1114 
	}
}

1116 * 
	gPCLmG’”©Ü
::
	$g‘IÅutBšSŒšg
(
jobIÅutBš
 
bš
)

1118 
	`mem£t
(
»tuºSŒ
,0,(returnStr));

1119 
bš
)

1121 
®‹º©e
: 
	`¡ºıy
(
»tuºSŒ
,"alternate", (returnStr)); ;

1122 
®‹º©e_rŞl
: 
	`¡ºıy
(
»tuºSŒ
,"alternate_roll", (returnStr)); ;

1123 
auto_£Ëù
: 
	`¡ºıy
(
»tuºSŒ
,"auto_select", (returnStr)); ;

1124 
bÙtom
: 
	`¡ºıy
(
»tuºSŒ
,"bottom", (returnStr)); ;

1125 
ûÁ”
: 
	`¡ºıy
(
»tuºSŒ
,"center", (returnStr)); ;

1126 
disc
: 
	`¡ºıy
(
»tuºSŒ
,"disc", (returnStr)); ;

1127 
’v–İe
: 
	`¡ºıy
(
»tuºSŒ
,"envelope", (returnStr)); ;

1128 
hagaki
: 
	`¡ºıy
(
»tuºSŒ
,"hagaki", (returnStr)); ;

1129 
Ïrge_ÿ·c™y
: 
	`¡ºıy
(
»tuºSŒ
,"large_capacity", (returnStr)); ;

1130 
Ëá
: 
	`¡ºıy
(
»tuºSŒ
,"left", (returnStr)); ;

1131 
maš_Œay
: 
	`¡ºıy
(
»tuºSŒ
,"main_tray", (returnStr)); ;

1132 
maš_rŞl
: 
	`¡ºıy
(
»tuºSŒ
,"main_roll", (returnStr)); ;

1133 
mªu®
: 
	`¡ºıy
(
»tuºSŒ
,"manual", (returnStr)); ;

1134 
middË
: 
	`¡ºıy
(
»tuºSŒ
,"middle", (returnStr)); ;

1135 
phÙo
: 
	`¡ºıy
(
»tuºSŒ
,"photo", (returnStr)); ;

1136 
»¬
: 
	`¡ºıy
(
»tuºSŒ
,"rear", (returnStr)); ;

1137 
right
: 
	`¡ºıy
(
»tuºSŒ
,"right", (returnStr)); ;

1138 
side
: 
	`¡ºıy
(
»tuºSŒ
,"side", (returnStr)); ;

1139 
tİ
: 
	`¡ºıy
(
»tuºSŒ
,"top", (returnStr)); ;

1140 
Œay_1
: 
	`¡ºıy
(
»tuºSŒ
,"tray_1", (returnStr)); ;

1141 
Œay_2
: 
	`¡ºıy
(
»tuºSŒ
,"tray_2", (returnStr)); ;

1142 
Œay_3
: 
	`¡ºıy
(
»tuºSŒ
,"tray_3", (returnStr)); ;

1143 
Œay_4
: 
	`¡ºıy
(
»tuºSŒ
,"tray_4", (returnStr)); ;

1144 
Œay_5
: 
	`¡ºıy
(
»tuºSŒ
,"tray_5", (returnStr)); ;

1145 
Œay_N
: 
	`¡ºıy
(
»tuºSŒ
,"tray_N", (returnStr)); ;

1146 : 
	`¡ºıy
(
»tuºSŒ
,"auto_select", (returnStr)); ;

1148 (
»tuºSŒ
);

1149 
	}
}

1151 * 
	gPCLmG’”©Ü
::
	$g‘OuutBš
(
jobOuutBš
 
bš
)

1153 
	`mem£t
(
»tuºSŒ
,0,(returnStr));

1154 
bš
)

1156 
tİ_ouut
: 
	`¡ºıy
(
»tuºSŒ
,"top_output", (returnStr)); ;

1157 
middË_ouut
: 
	`¡ºıy
(
»tuºSŒ
,"middle_output", (returnStr)); ;

1158 
bÙtom_ouut
: 
	`¡ºıy
(
»tuºSŒ
,"bottom_output", (returnStr)); ;

1159 
side_ouut
: 
	`¡ºıy
(
»tuºSŒ
,"side_output", (returnStr)); ;

1160 
ûÁ”_ouut
: 
	`¡ºıy
(
»tuºSŒ
,"center_output", (returnStr)); ;

1161 
»¬_ouut
: 
	`¡ºıy
(
»tuºSŒ
,"rear_output", (returnStr)); ;

1162 
çû_up
: 
	`¡ºıy
(
»tuºSŒ
,"face_up", (returnStr)); ;

1163 
çû_down
: 
	`¡ºıy
(
»tuºSŒ
,"face_down", (returnStr)); ;

1164 
Ïrge_ÿ·c™y_ouut
: 
	`¡ºıy
(
»tuºSŒ
,"large_capacity_output", (returnStr)); ;

1165 
¡ack”_N
: 
	`¡ºıy
(
»tuºSŒ
,"stacker_N", (returnStr)); ;

1166 
mabox_N
: 
	`¡ºıy
(
»tuºSŒ
,"mailbox_N", (returnStr)); ;

1167 
Œay_1_ouut
: 
	`¡ºıy
(
»tuºSŒ
,"tray_1_output", (returnStr)); ;

1168 
Œay_2_ouut
: 
	`¡ºıy
(
»tuºSŒ
,"tray_2_output", (returnStr)); ;

1169 
Œay_3_ouut
: 
	`¡ºıy
(
»tuºSŒ
,"tray_3_output", (returnStr)); ;

1170 
Œay_4_ouut
: 
	`¡ºıy
(
»tuºSŒ
,"tray_4_output", (returnStr)); ;

1171 : 
	`¡ºıy
(
»tuºSŒ
,"top_output", (returnStr)); ;

1173 (
»tuºSŒ
);

1174 
	}
}

1175 * 
	gPCLmG’”©Ü
::
	$g‘Or›Á©iÚSŒšg
(
medŸOr›Á©iÚDi¥os™iÚ
 
Or›Á©iÚ
)

1177 
	`mem£t
(
»tuºSŒ
,0,(returnStr));

1178 
Or›Á©iÚ
)

1180 
pÜŒa™Or›Á©iÚ
:

1181 
	`¡ºıy
(
»tuºSŒ
,"portrait",(returnStr));

1184 
Ïndsÿ³Or›Á©iÚ
:

1185 
	`¡ºıy
(
»tuºSŒ
,"landscape",(returnStr));

1189 
	`as£¹
(0);

1192 (
»tuºSŒ
);

1193 
	}
}

1194 * 
	gPCLmG’”©Ü
::
	$g‘Du¶exSŒšg
(
du¶exDi¥os™iÚEnum
 
du¶ex
)

1196 
	`mem£t
(
»tuºSŒ
,0,(returnStr));

1197 
du¶ex
)

1199 
sim¶ex
:

1200 
	`¡ºıy
(
»tuºSŒ
,"one-sided",(returnStr));

1202 
du¶ex_shÜtEdge
:

1203 
	`¡ºıy
(
»tuºSŒ
,"two-sided-short-edge",(returnStr));

1206 
du¶ex_lÚgEdge
:

1207 
	`¡ºıy
(
»tuºSŒ
,"two-sided-long-edge",(returnStr));

1211 
	`as£¹
(0);

1214 (
»tuºSŒ
);

1215 
	}
}

1217 * 
	gPCLmG’”©Ü
::
	$g‘CŞÜThemesSŒšg
(
cŞÜThemes
 
cŞÜtheme
)

1219 
	`mem£t
(
»tuºSŒ
,0,(returnStr));

1220 
cŞÜtheme
)

1222 
deçuÉ_cŞÜtheme
: 
	`¡ºıy
(
»tuºSŒ
,"auto",(returnStr));;

1223 
vividsRGB
: 
	`¡ºıy
(
»tuºSŒ
,"saturation",(returnStr));;

1224 
phÙosRGB
: 
	`¡ºıy
(
»tuºSŒ
,"perception",(returnStr));;

1225 
phÙoAdobeRGB
: 
	`¡ºıy
(
»tuºSŒ
,"perception",(returnStr));;

1226 : 
	`¡ºıy
(
»tuºSŒ
,"none",(returnStr));;

1228  (
»tuºSŒ
);

1229 
	}
}

1232 
	gPCLmG’”©Ü
::
	$wr™eJobTick‘
()

1235 
šputBš
[256];

1236 
ouutBš
[256];

1237 
Ü›Á©iÚ
[256];

1238 
du¶ex
[256];

1239 
cŞÜthemes
[256];

1240 
	`¡ºıy
(
cŞÜthemes
,
	`g‘CŞÜThemesSŒšg
(
m_pPCLmSS‘tšgs
->
cŞÜTheme
),256);

1241 
	`¡ºıy
(
šputBš
,
	`g‘IÅutBšSŒšg
(
m_pPCLmSS‘tšgs
->
u£rIÅutBš
),256);

1242 
	`¡ºıy
(
ouutBš
,
	`g‘OuutBš
(
m_pPCLmSS‘tšgs
->
u£rOuutBš
),256);

1243 
	`¡ºıy
(
Ü›Á©iÚ
,
	`g‘Or›Á©iÚSŒšg
(
m_pPCLmSS‘tšgs
->
u£rOr›Á©iÚ
),256);

1244 
	`¡ºıy
(
du¶ex
,
	`g‘Du¶exSŒšg
(
cu¼Du¶exDi¥os™iÚ
),256);

1246 
	`¢´štf
(
pOutSŒ
,
OUT_STR_SIZE
,"%% g’PCLm (V”: %f)\n",
PCLM_V”
); 
	`wr™eSŒ2OutBuff
(pOutStr);

1247 
	`¢´štf
(
pOutSŒ
,
OUT_STR_SIZE
,"%%============ğJob Tick‘ =============\n"); 
	`wr™eSŒ2OutBuff
(pOutStr);

1248 
	`¢´štf
(
pOutSŒ
,
OUT_STR_SIZE
,"%% PCLmS-Job-Tick‘\n"); 
	`wr™eSŒ2OutBuff
(pOutStr);

1249 
	`¢´štf
(
pOutSŒ
,
OUT_STR_SIZE
,"%% job-tick‘-v”siÚ: 0.1\n"); 
	`wr™eSŒ2OutBuff
(pOutStr);

1250 
	`¢´štf
(
pOutSŒ
,
OUT_STR_SIZE
,"%%ƒpş-v”siÚ: 1.01\n"); 
	`wr™eSŒ2OutBuff
(pOutStr);

1251 
	`¢´štf
(
pOutSŒ
,
OUT_STR_SIZE
,"%% JobSeùiÚ\n"); 
	`wr™eSŒ2OutBuff
(pOutStr);

1252 
	`¢´štf
(
pOutSŒ
,
OUT_STR_SIZE
,"%% job-id: %d\n",
m_pPCLmSS‘tšgs
->
jobid
); 
	`wr™eSŒ2OutBuff
(pOutStr);

1253 
	`¢´štf
(
pOutSŒ
,
OUT_STR_SIZE
,"%% job-¡¬t-time: %s\n",
m_pPCLmSS‘tšgs
->
d©‘ime
); 
	`wr™eSŒ2OutBuff
(pOutStr);

1254 
	`¢´štf
(
pOutSŒ
,
OUT_STR_SIZE
,"%% MedŸHªdlšgSeùiÚ\n"); 
	`wr™eSŒ2OutBuff
(pOutStr);

1255 
	`¢´štf
(
pOutSŒ
,
OUT_STR_SIZE
,"%% medŸ-size-Çme: %s\n",
cu¼MedŸName
); 
	`wr™eSŒ2OutBuff
(pOutStr);

1256 
	`¢´štf
(
pOutSŒ
,
OUT_STR_SIZE
,"%% medŸ-ty³: %s\n",
m_pPCLmSS‘tšgs
->
u£rMedŸTy³
); 
	`wr™eSŒ2OutBuff
(pOutStr);

1257 
	`¢´štf
(
pOutSŒ
,
OUT_STR_SIZE
,"%% medŸ-sourû: %s\n",
šputBš
); 
	`wr™eSŒ2OutBuff
(pOutStr);

1258 
	`¢´štf
(
pOutSŒ
,
OUT_STR_SIZE
,"%% sides: %s\n",
du¶ex
); 
	`wr™eSŒ2OutBuff
(pOutStr);

1260 
	`¢´štf
(
pOutSŒ
,
OUT_STR_SIZE
,"%% ouut-bš: %s\n",
ouutBš
); 
	`wr™eSŒ2OutBuff
(pOutStr);

1261 
	`¢´štf
(
pOutSŒ
,
OUT_STR_SIZE
,"%% R’d”šgSeùiÚ\n"); 
	`wr™eSŒ2OutBuff
(pOutStr);

1262 if(
cu¼Com´essiÚDi¥os™iÚ
==
com´essDCT
)

1264 
	`¢´štf
(
pOutSŒ
,
OUT_STR_SIZE
,"%%…şm-com´essiÚ-m‘hod: JPEG\n"); 
	`wr™eSŒ2OutBuff
(pOutStr);

1266 if(
cu¼Com´essiÚDi¥os™iÚ
==
com´essFÏ‹
)

1268 
	`¢´štf
(
pOutSŒ
,
OUT_STR_SIZE
,"%%…şm-com´essiÚ-m‘hod: FLATE\n"); 
	`wr™eSŒ2OutBuff
(pOutStr);

1272 
	`¢´štf
(
pOutSŒ
,
OUT_STR_SIZE
,"%%…şm-com´essiÚ-m‘hod: RLE\n"); 
	`wr™eSŒ2OutBuff
(pOutStr);

1274 
	`¢´štf
(
pOutSŒ
,
OUT_STR_SIZE
,"%% sŒ-height: %d\n",
cu¼SŒHeight
); 
	`wr™eSŒ2OutBuff
(pOutStr);

1276 if(
de¡CŞÜS·û
==
deviûRGB
)

1278 
	`¢´štf
(
pOutSŒ
,
OUT_STR_SIZE
,"%%…ršt-cŞÜ-mode: cŞÜ\n"); 
	`wr™eSŒ2OutBuff
(pOutStr);

1280 if(
de¡CŞÜS·û
==
adobeRGB
)

1282 
	`¢´štf
(
pOutSŒ
,
OUT_STR_SIZE
,"%%…ršt-cŞÜ-mode: cŞÜ\n"); 
	`wr™eSŒ2OutBuff
(pOutStr);

1284 if(
de¡CŞÜS·û
==
g¿ySÿË
)

1286 
	`¢´štf
(
pOutSŒ
,
OUT_STR_SIZE
,"%%…ršt-cŞÜ-mode: mÚochrome\n"); 
	`wr™eSŒ2OutBuff
(pOutStr);

1288 if(
de¡CŞÜS·û
==
bÏckÚly
)

1290 
	`¢´štf
(
pOutSŒ
,
OUT_STR_SIZE
,"%%…ršt-cŞÜ-mode: cŞÜ\n"); 
	`wr™eSŒ2OutBuff
(pOutStr);

1292 
	`¢´štf
(
pOutSŒ
,
OUT_STR_SIZE
,"%%…ršt-»nd”šg-š‹Á: %s\n",
cŞÜthemes
); 
	`wr™eSŒ2OutBuff
(pOutStr);

1293 
	`¢´štf
(
pOutSŒ
,
OUT_STR_SIZE
,"%%…ršt-qu®™y: %s\n",
m_pPCLmSS‘tšgs
->
u£rPageQu®™y
); 
	`wr™eSŒ2OutBuff
(pOutStr);

1294 
	`¢´štf
(
pOutSŒ
,
OUT_STR_SIZE
,"%%…rš‹r-»sŞutiÚ: %d\n",
cu¼R’d”ResŞutiÚIÁeg”
); 
	`wr™eSŒ2OutBuff
(pOutStr);

1296 
	`¢´štf
(
pOutSŒ
,
OUT_STR_SIZE
,"%% or›Á©iÚ-»que¡ed: %d\n",
m_pPCLmSS‘tšgs
->
u£rOr›Á©iÚ
); 
	`wr™eSŒ2OutBuff
(pOutStr);

1297 
	`¢´štf
(
pOutSŒ
,
OUT_STR_SIZE
,"%% cİ›s: %d\n",
m_pPCLmSS‘tšgs
->
u£rCİ›s
); 
	`wr™eSŒ2OutBuff
(pOutStr);

1298 
	`¢´štf
(
pOutSŒ
,
OUT_STR_SIZE
,"%%…şm-¿¡”-back-side: xxx\n"); 
	`wr™eSŒ2OutBuff
(pOutStr);

1299 if(
cu¼R’d”ResŞutiÚIÁeg”
)

1301 
	`¢´štf
(
pOutSŒ
,
OUT_STR_SIZE
,"%% m¬gšs-´e-­¶›d: TRUE\n"); 
	`wr™eSŒ2OutBuff
(pOutStr);

1305 
	`¢´štf
(
pOutSŒ
,
OUT_STR_SIZE
,"%% m¬gšs-´e-­¶›d: FALSE\n"); 
	`wr™eSŒ2OutBuff
(pOutStr);

1307 
	`¢´štf
(
pOutSŒ
,
OUT_STR_SIZE
,"%% PCLmS-Job-Tick‘-End\n"); 
	`wr™eSŒ2OutBuff
(pOutStr);

1308 
	}
}

1310 
	gPCLmG’”©Ü
::
	$wr™ePDFG¿mm¬H—d”
()

1313 
	`¢´štf
(
pOutSŒ
,
OUT_STR_SIZE
,"%%PDF-1.7\n"); 
	`wr™eSŒ2OutBuff
(pOutStr);

1314 
	`¢´štf
(
pOutSŒ
,
OUT_STR_SIZE
,"%%PCLm 1.0\n"); 
	`wr™eSŒ2OutBuff
(pOutStr);

1315 
	}
}

1323 
	gPCLmG’”©Ü
::
	$PCLmG’”©Ü
()

1325 
	`¡ºıy
(
cu¼MedŸName
,"na_letter_8.5x11in",256);

1326 
cu¼Du¶exDi¥os™iÚ
=
sim¶ex
;

1327 
cu¼CŞÜS·ûDi¥os™iÚ
=
deviûRGB
;

1328 
cu¼DebugDi¥os™iÚ
=
debugOff
;

1329 
cu¼Com´essiÚDi¥os™iÚ
=
com´essDCT
;

1330 
cu¼MedŸOr›Á©iÚDi¥os™iÚ
=
pÜŒa™Or›Á©iÚ
;

1331 
cu¼R’d”ResŞutiÚ
=
»s600
;

1332 
cu¼SŒHeight
=
STRIP_HEIGHT
;

1335 
medŸWidthInPix–s
=0;

1336 
medŸHeightInPix–s
=0;

1337 
medŸWidth
=612;

1338 
medŸHeight
=792;

1339 
de¡CŞÜS·û
=
deviûRGB
;

1340 
sourûCŞÜS·û
=
deviûRGB
;

1341 
sÿËFaùÜ
=1;

1342 
g’ExŒaPage
=
çl£
;

1343 
jobO³n
=
job_şo£d
;

1344 
cu¼SourûWidth
 = 5100;

1345 
cu¼SourûHeight
 = 6600;

1346 
¤cNumCompÚ’ts
 = 3;

1347 
d¡NumCompÚ’ts
 = 3;

1348 
numLeáov”SÿÆšes
 = 0;

1349 
sü©chBufãr
=
NULL
;

1350 
·geCouÁ
=0;

1351 
»v”£Ord”
 = 
çl£
;

1352 
outBuffSize
 = 0;

1353 
cu¼OutBuffSize
 = 0;

1355 
cu¼R’d”ResŞutiÚIÁeg”
=600;

1356 
cu¼ResŞutiÚ
 = 600;

1357 
STANDARD_SCALE
=()
cu¼R’d”ResŞutiÚIÁeg”
/()
STANDARD_SCALE_FOR_PDF
;

1358 
yPos™iÚ
=0;

1359 
šfoObj
=0;

1360 
·geOrigš
 = 0;

1361 
numKids
=0;

1363 
xRefIndex
=0;

1364 
xRefS¹
 = 0;

1366 
DebugIt
=0;

1367 
DebugIt2
=0;

1369 
objCouÁ”
=
PAGES_OBJ_NUMBER
+1;

1370 
tÙ®By‹sWr™‹nToPCLmFe
=0;

1371 
tÙ®By‹sWr™‹nToCu¼Buff
 = 0;

1374 
xRefTabË
=
NULL
;

1375 
KidsA¼ay
=
NULL
;

1378 
®loÿ‹dOuutBufãr
=
NULL
;

1381 
Ëáov”SÿÆšeBufãr
=
NULL
;

1383 
adobeRGBCS_fœ¡Time
=
Œue
;

1384 
mœrÜBackside
=
çl£
;

1386 
tİM¬gšInPix
=0;

1387 
ËáM¬gšInPix
=0;

1389 
m_pPCLmSS‘tšgs
 = 
NULL
;

1391 
outBuffPŒ
 = 
NULL
;

1392 
cu¼BuffPŒ
 = 
NULL
;

1393 
	`mem£t
(
pOutSŒ
,0,
OUT_STR_SIZE
);

1394 
fœ¡SŒ
 = 
Œue
;

1395 
numFuÎInjeùedSŒs
 = 0;

1396 
numFuÎSÿÆšesToInjeù
 = 0;

1397 
numP¬tŸlSÿÆšesToInjeù
 = 0;

1398 
	`mem£t
(
»tuºSŒ
,0,(returnStr));

1399 
	}
}

1407 
	gPCLmG’”©Ü
::~
	$PCLmG’”©Ü
()

1409 
	`CËªup
();

1410 
	}
}

1418 #ifdeà
STANDALONE


1419 
	gPCLmG’”©Ü
::
	$S¹Job
(**
pOutBufãr
, *
iOutBufãrSize
, 
boŞ
 
debug
)

1421 
PCLmG’”©Ü
::
	$S¹Job
(**
pOutBufãr
, *
iOutBufãrSize
)

1424 
DebugIt
=
debug
;

1425 
DebugIt2
=
debug
;

1427 if(
DebugIt
)

1428 
	`dbglog
("genPCLm::StartJob\n");

1432 
outBuffSize
=
DEFAULT_OUTBUFF_SIZE
;

1433 *
iOutBufãrSize
=
outBuffSize
;

1434 *
pOutBufãr
=(
uby‹
*)
	`m®loc
(
outBuffSize
*10);

1436 if(
NULL
 =ğ*
pOutBufãr
)

1438 (
	`”rÜOutAndCËªUp
());

1441 
cu¼OutBuffSize
=
outBuffSize
*10;

1442 if(
DebugIt2
)

1443 
	`dbglog
("AÎoÿ‹d %d fÜ myOutBufãrSize\n",
outBuffSize
);

1444 
®loÿ‹dOuutBufãr
=*
pOutBufãr
;

1445 
	`š™OutBuff
((*)*
pOutBufãr
,
cu¼OutBuffSize
);

1446 
	`wr™ePDFG¿mm¬H—d”
();

1447 *
iOutBufãrSize
=
tÙ®By‹sWr™‹nToCu¼Buff
;

1448 
jobO³n
=
job_İ’
;

1450 (
sucûss
);

1451 
	}
}

1459 
	gPCLmG’”©Ü
::
	$EndJob
(**
pOutBufãr
, *
iOutBufãrSize
)

1463 if(
DebugIt
)

1464 
	`dbglog
("genPCLm::EndJob\n");

1465 if(
NULL
==
®loÿ‹dOuutBufãr
)

1467 (
	`”rÜOutAndCËªUp
());

1469 *
pOutBufãr
 = 
®loÿ‹dOuutBufãr
;

1471 
	`š™OutBuff
((*)*
pOutBufãr
,
outBuffSize
);

1474 
	`wr™ePDFG¿mm¬T¿”
(
cu¼SourûWidth
, 
cu¼SourûHeight
);

1481 *
iOutBufãrSize
=
tÙ®By‹sWr™‹nToCu¼Buff
;

1483 
jobO³n
=
job_şo£d
;

1485 if(
xRefTabË
)

1487 
	`ä“
(
xRefTabË
);

1488 
xRefTabË
=
NULL
;

1490 if(
KidsA¼ay
)

1492 
	`ä“
(
KidsA¼ay
);

1493 
KidsA¼ay
=
NULL
;

1496 (
sucûss
);

1497 
	}
}

1505 
	gPCLmG’”©Ü
::
	$S¹Page
(
PCLmSS‘up
 *
PCLmSPageCÚ‹Á
, 
boŞ
 
g’”©ePCLmS
, **
pOutBufãr
, *
iOutBufãrSize
)

1507 
m_pPCLmSS‘tšgs
=
PCLmSPageCÚ‹Á
->
PCLmSU£rS‘tšgs
;

1508 (
	`S¹Page
(
PCLmSPageCÚ‹Á
->
PCLmPageCÚ‹Á
,
pOutBufãr
,
iOutBufãrSize
));

1509 
	}
}

1517 
	gPCLmG’”©Ü
::
	$S¹Page
(
PCLmPageS‘up
 *
PCLmPageCÚ‹Á
, **
pOutBufãr
, *
iOutBufãrSize
)

1519 
numImageSŒs
;

1521 
cu¼R’d”ResŞutiÚ
=
PCLmPageCÚ‹Á
->
de¡š©iÚResŞutiÚ
;

1523 *
pOutBufãr
 = 
®loÿ‹dOuutBufãr
;

1525 if(
cu¼R’d”ResŞutiÚ
==
»s300
)

1526 
cu¼R’d”ResŞutiÚIÁeg”
=300;

1527 if(
cu¼R’d”ResŞutiÚ
==
»s600
)

1528 
cu¼R’d”ResŞutiÚIÁeg”
=600;

1529 if(
cu¼R’d”ResŞutiÚ
==
»s1200
)

1530 
cu¼R’d”ResŞutiÚIÁeg”
=1200;

1532 
	`as£¹
(0);

1535 
STANDARD_SCALE
=()
cu¼R’d”ResŞutiÚIÁeg”
/()
STANDARD_SCALE_FOR_PDF
;

1539 
cu¼SourûWidth
=()(
PCLmPageCÚ‹Á
->
sourûWidth
+0.50);

1540 
cu¼SourûHeight
=()(
PCLmPageCÚ‹Á
->
sourûHeight
+0.50);

1543 
medŸWidth
=()(
PCLmPageCÚ‹Á
->mediaWidth + 0.50);

1544 
medŸHeight
=()(
PCLmPageCÚ‹Á
->mediaHeight + 0.50);

1545 
medŸWidthInPix–s
 =()(((
PCLmPageCÚ‹Á
->
medŸWidth
/
STANDARD_SCALE_FOR_PDF
)*
cu¼R’d”ResŞutiÚIÁeg”
)+0.50);

1546 
medŸHeightInPix–s
=()(((
PCLmPageCÚ‹Á
->
medŸHeight
/
STANDARD_SCALE_FOR_PDF
)*
cu¼R’d”ResŞutiÚIÁeg”
)+0.50);

1547 
tİM¬gšInPix
=()(
PCLmPageCÚ‹Á
->
medŸHeightOff£t
+0.50);

1548 
ËáM¬gšInPix
=()(
PCLmPageCÚ‹Á
->
medŸWidthOff£t
+0.50);

1549 
cu¼Com´essiÚDi¥os™iÚ
=
PCLmPageCÚ‹Á
->
compTy³Reque¡ed
;

1551 if(
DebugIt
)

1553 
	`dbglog
("genPCLm::StartPage\n");

1554 
	`dbglog
(" medŸName=%s\n", 
PCLmPageCÚ‹Á
->
medŸSizeName
);

1555 
	`dbglog
(" cl›ÁLoÿË=%s\n",
PCLmPageCÚ‹Á
->
medŸSizeName
);

1556 
	`dbglog
(" medŸHeight=%f\n", 
PCLmPageCÚ‹Á
->
medŸHeight
);

1557 
	`dbglog
(" medŸWidth=%f\n", 
PCLmPageCÚ‹Á
->
medŸWidth
);

1558 
	`dbglog
("İM¬gš=%d\n", 
tİM¬gšInPix
);

1559 
	`dbglog
("†eáM¬gš=%d\n", 
ËáM¬gšInPix
);

1561 
	`dbglog
("İLeáM¬gš=%f,%f\n",
PCLmPageCÚ‹Á
->
medŸWidthOff£t
,PCLmPageCÚ‹Á->
medŸHeightOff£t
);

1562 
	`dbglog
(" sourûHeight=%f\n",
PCLmPageCÚ‹Á
->
sourûHeight
);

1563 
	`dbglog
(" sourûWidth=%f\n", 
PCLmPageCÚ‹Á
->
sourûWidth
);

1564 
	`dbglog
(" sŒHeight=%d\n", 
PCLmPageCÚ‹Á
->
¡rHeight
);

1565 
	`dbglog
(" sÿËFaùÜ=%d\n", 
PCLmPageCÚ‹Á
->
sÿËFaùÜ
);

1566 
	`dbglog
(" g’ExŒaPage=%d\n",
PCLmPageCÚ‹Á
->
g’ExŒaPage
);

1568 if(
PCLmPageCÚ‹Á
->
cŞÜCÚ‹Á
==
cŞÜ_cÚ‹Á
){

1569 
	`dbglog
(" colorContent=color_content\n");

1571 if(
PCLmPageCÚ‹Á
->
cŞÜCÚ‹Á
==
g¿y_cÚ‹Á
){

1572 
	`dbglog
(" colorContent=gray_content\n");

1575 
	`dbglog
(" colorContent=unknown_content\n");

1578 if(
PCLmPageCÚ‹Á
->
·geOrigš
==
tİ_Ëá
){

1579 
	`dbglog
("…ageOrigin=top_left\n");

1582 
	`dbglog
("…ageOrigin=bottom_right\n");

1584 if(
PCLmPageCÚ‹Á
->
compTy³Reque¡ed
==
com´essRLE
){

1585 
	`dbglog
("compTypeRequested=RLE\n");

1587 if(
PCLmPageCÚ‹Á
->
compTy³Reque¡ed
==
com´essDCT
){

1588 
	`dbglog
("compTypeRequested=DCT\n");

1590 if(
PCLmPageCÚ‹Á
->
compTy³Reque¡ed
==
com´essFÏ‹
){

1591 
	`dbglog
("compTypeRequested=Flate\n");

1593 if(
PCLmPageCÚ‹Á
->
compTy³Reque¡ed
==
com´essDeçuÉ
){

1594 
	`dbglog
("compTypeRequested=Flate\n");

1596 if(
PCLmPageCÚ‹Á
->
compTy³Reque¡ed
==
com´essNÚe
){

1597 
	`dbglog
("compTypeRequested=None\n");

1600 if(
PCLmPageCÚ‹Á
->
d¡CŞÜS·ûS³fiÿtiÚ
==
deviûRGB
){

1601 
	`dbglog
("colorSpaceSpefication=deviceRGB\n");

1603 if(
PCLmPageCÚ‹Á
->
d¡CŞÜS·ûS³fiÿtiÚ
==
adobeRGB
){

1604 
	`dbglog
("colorSpaceSpefication=adobeRGB\n");

1606 if(
PCLmPageCÚ‹Á
->
d¡CŞÜS·ûS³fiÿtiÚ
==
g¿ySÿË
){

1607 
	`dbglog
("colorSpaceSpefication=grayScale\n");

1610 
	`dbglog
("colorSpaceSpefication=blackonly\n");

1614 if(
PCLmPageCÚ‹Á
->
de¡š©iÚResŞutiÚ
==
»s300
){

1615 
	`dbglog
("destinationResolution Requested=300 DPI\n");

1617 if(
PCLmPageCÚ‹Á
->
de¡š©iÚResŞutiÚ
==
»s600
){

1618 
	`dbglog
("destinationResolution Requested=600 DPI\n");

1620 if(
PCLmPageCÚ‹Á
->
de¡š©iÚResŞutiÚ
==
»s1200
){

1621 
	`dbglog
("destinationResolution Requested=1200 DPI\n");

1624 if(
PCLmPageCÚ‹Á
->
du¶exDi¥os™iÚ
==
sim¶ex
){

1625 
	`dbglog
("duplex disposition=Simplex\n");

1627 if(
PCLmPageCÚ‹Á
->
du¶exDi¥os™iÚ
==
du¶ex_lÚgEdge
){

1628 
	`dbglog
("duplex disposition=Duplex_longEdge\n");

1630 if(
PCLmPageCÚ‹Á
->
du¶exDi¥os™iÚ
==
du¶ex_shÜtEdge
){

1631 
	`dbglog
("duplex disposition=Duplex_shortEdge\n");

1637 if(
	`¡¾’
(
PCLmPageCÚ‹Á
->
medŸSizeName
))

1638 
	`¡ºıy
(
cu¼MedŸName
,
PCLmPageCÚ‹Á
->
medŸSizeName
,256);

1640 
cu¼SŒHeight
=
PCLmPageCÚ‹Á
->
¡rHeight
;

1641 if(!
cu¼SŒHeight
)

1643 
numImageSŒs
=1;

1644 
cu¼SŒHeight
=
cu¼SourûHeight
;

1648 
numImageSŒsR—l
=
	`û
(()
cu¼SourûHeight
/()
cu¼SŒHeight
);

1649 
numImageSŒs
=()
numImageSŒsR—l
;

1654 if(
PCLmPageCÚ‹Á
->
¤cCŞÜS·ûS³fiÿtiÚ
==
g¿ySÿË
)

1655 
¤cNumCompÚ’ts
=1;

1657 
¤cNumCompÚ’ts
=3;

1659 if(
PCLmPageCÚ‹Á
->
d¡CŞÜS·ûS³fiÿtiÚ
==
g¿ySÿË
)

1660 
d¡NumCompÚ’ts
=1;

1662 
d¡NumCompÚ’ts
=3;

1664 
cu¼Du¶exDi¥os™iÚ
=
PCLmPageCÚ‹Á
->
du¶exDi¥os™iÚ
;

1666 
de¡CŞÜS·û
=
PCLmPageCÚ‹Á
->
d¡CŞÜS·ûS³fiÿtiÚ
;

1669 
tmp_outBuffSize
=
medŸWidthInPix–s
*
cu¼SŒHeight
*
d¡NumCompÚ’ts
;

1671 if(
tmp_outBuffSize
>
cu¼OutBuffSize
)

1673 *
pOutBufãr
=
	`»®loc
(*pOutBufãr,
tmp_outBuffSize
);

1675 if(*
pOutBufãr
==
NULL
)

1677  
	`”rÜOutAndCËªUp
();

1680 
outBuffSize
=
cu¼OutBuffSize
=
tmp_outBuffSize
;

1681 
®loÿ‹dOuutBufãr
=*
pOutBufãr
;

1682 if(
NULL
 =ğ
®loÿ‹dOuutBufãr
)

1684  (
	`”rÜOutAndCËªUp
());

1690 
	`š™OutBuff
((*)*
pOutBufãr
,
outBuffSize
);

1692 if(
DebugIt2
)

1693 
	`dbglog
("AÎoÿ‹d %d fÜ myOutBufãrSize\n",
outBuffSize
);

1697 if(
DebugIt
)

1698 
	`dbglog
("numImageSŒs=%d\n",
numImageSŒs
);

1700 
·geCouÁ
++;

1703 if(
cu¼Du¶exDi¥os™iÚ
==
du¶ex_lÚgEdge
 && !(
·geCouÁ
%2))

1705 if(
DebugIt2
)

1706 
	`dbglog
("genPCLm.cpp: setting„everseOrder\n");

1707 
»v”£Ord”
=
Œue
;

1710 
»v”£Ord”
=
çl£
;

1713 if(
tİM¬gšInPix
)

1715 if(
tİM¬gšInPix
<=
cu¼SŒHeight
)

1717 
numFuÎInjeùedSŒs
=1;

1718 
numFuÎSÿÆšesToInjeù
=
tİM¬gšInPix
;

1719 
numP¬tŸlSÿÆšesToInjeù
=0;

1723 
numFuÎInjeùedSŒs
=
tİM¬gšInPix
/
cu¼SŒHeight
;

1724 
numFuÎSÿÆšesToInjeù
=
cu¼SŒHeight
;

1725 
numP¬tŸlSÿÆšesToInjeù
=
tİM¬gšInPix
 - (
numFuÎInjeùedSŒs
*
cu¼SŒHeight
);

1729 
	`wr™eJobTick‘
();

1730 
	`wr™ePDFG¿mm¬Page
(
medŸWidthInPix–s
, 
medŸHeightInPix–s
, 
numImageSŒs
, 
de¡CŞÜS·û
);

1731 *
iOutBufãrSize
=
tÙ®By‹sWr™‹nToCu¼Buff
;

1733 if(!
sü©chBufãr
)

1737 
sü©chBufãr
=(
uby‹
*)
	`m®loc
(
cu¼SŒHeight
*
medŸWidthInPix–s
*
¤cNumCompÚ’ts
*2);

1738 if(!
sü©chBufãr
)

1739 (
	`”rÜOutAndCËªUp
());

1744 
mœrÜBackside
=
PCLmPageCÚ‹Á
->mirrorBackside;

1745 
fœ¡SŒ
=
Œue
;

1747 (
sucûss
);

1748 
	}
}

1756 
	gPCLmG’”©Ü
::
	$EndPage
(**
pOutBufãr
, *
iOutBufãrSize
)

1758 *
pOutBufãr
 = 
®loÿ‹dOuutBufãr
;

1759 
	`š™OutBuff
((*)*
pOutBufãr
,
outBuffSize
);

1760 *
iOutBufãrSize
=
tÙ®By‹sWr™‹nToCu¼Buff
;

1764 if(
sü©chBufãr
)

1766 
	`ä“
(
sü©chBufãr
);

1767 
sü©chBufãr
=
NULL
;

1770 (
sucûss
);

1771 
	}
}

1779 
	gPCLmG’”©Ü
::
	$SkLšes
(
iSkLšes
)

1781 (
sucûss
);

1782 
	}
}

1790 
	gPCLmG’”©Ü
::
	$EnÿpsuÏ‹
(*
pInBufãr
, 
šBufãrSize
, 
thisHeight
, **
pOutBufãr
, *
iOutBufãrSize
)

1792 
»suÉ
=0, 
numCompBy‹s
;

1793 
sÿÆšeWidth
=
medŸWidthInPix–s
*
¤cNumCompÚ’ts
;

1794 
compSize
;

1796 
numLšesThisC®l
=
thisHeight
;

1799 *
loÿlInBufãr
;

1800 
uby‹
 *
ÃwSŒPŒ
=
NULL
;

1809 if(
Ëáov”SÿÆšeBufãr
)

1811 
uby‹
 *
wh”eA»We
;

1812 
sšt32
 
sÿÆšesThisTime
;

1816 
tmpBufãr
=
	`m®loc
(
sÿÆšeWidth
*
cu¼SŒHeight
);

1817 if(!
tmpBufãr
)

1818 (
	`”rÜOutAndCËªUp
());

1821 
	`memıy
(
tmpBufãr
,
Ëáov”SÿÆšeBufãr
,
sÿÆšeWidth
*
numLeáov”SÿÆšes
);

1823 
wh”eA»We
=(
uby‹
*)
tmpBufãr
+(
sÿÆšeWidth
*
numLeáov”SÿÆšes
);

1825 
sÿÆšesThisTime
=
cu¼SŒHeight
-
numLeáov”SÿÆšes
;

1828 
	`memıy
(
wh”eA»We
,
pInBufãr
,
sÿÆšesThisTime
*
sÿÆšeWidth
);

1831 if(
DebugIt
)

1832 
	`dbglog
("Leáov” sÿÆšes:‚umLšesThisC®l=%d, cu¼SŒHeight=%d\n",
numLšesThisC®l
,
cu¼SŒHeight
);

1833 
numLeáov”SÿÆšes
=
thisHeight
-
sÿÆšesThisTime
;

1834 
	`as£¹
(
Ëáov”SÿÆšeBufãr
);

1835 
wh”eA»We
=(
uby‹
*)
pInBufãr
+(
sÿÆšeWidth
*
numLeáov”SÿÆšes
);

1836 
	`memıy
(
Ëáov”SÿÆšeBufãr
,
wh”eA»We
,
sÿÆšeWidth
*
numLeáov”SÿÆšes
);

1837 
numLšesThisC®l
=
thisHeight
=
cu¼SŒHeight
;

1839 
§vedInBufãrPŒ
=
pInBufãr
;

1840 
loÿlInBufãr
=
tmpBufãr
;

1844 
loÿlInBufãr
=
pInBufãr
;

1848 if(
thisHeight
 > 
cu¼SŒHeight
)

1850  (()(
g’”icFau»
));

1853 
uby‹
 *
±r
;

1854 if(
DebugIt
)

1855 
	`dbglog
("Leáov” sÿÆšes:‚umLšesThisC®l=%d, cu¼SŒHeight=%d\n",
numLšesThisC®l
,
cu¼SŒHeight
);

1856 
numLeáov”SÿÆšes
=
thisHeight
-
cu¼SŒHeight
;

1857 
Ëáov”SÿÆšeBufãr
=
	`m®loc
(
sÿÆšeWidth
*
numLeáov”SÿÆšes
);

1858 if(!
Ëáov”SÿÆšeBufãr
)

1859 (
	`”rÜOutAndCËªUp
());

1860 
±r
=(
uby‹
 *)
loÿlInBufãr
+
sÿÆšeWidth
*
numLeáov”SÿÆšes
;

1861 
	`memıy
(
Ëáov”SÿÆšeBufãr
,
±r
,
sÿÆšeWidth
*
numLeáov”SÿÆšes
);

1862 
thisHeight
=
cu¼SŒHeight
;

1866 if(
NULL
 =ğ
®loÿ‹dOuutBufãr
)

1868  (
	`”rÜOutAndCËªUp
());

1870 *
pOutBufãr
 = 
®loÿ‹dOuutBufãr
;

1871 
	`š™OutBuff
((*)*
pOutBufãr
,
outBuffSize
);

1873 if(
cu¼Du¶exDi¥os™iÚ
==
du¶ex_lÚgEdge
 && !(
·geCouÁ
%2))

1875 if(
mœrÜBackside
)

1876 
	`´•ImageFÜBacksideDu¶ex
((
uby‹
*)
loÿlInBufãr
, 
numLšesThisC®l
, 
cu¼SourûWidth
, 
¤cNumCompÚ’ts
);

1879 if((
de¡CŞÜS·û
==
g¿ySÿË
è&& (
sourûCŞÜS·û
==
deviûRGB
 || sourûCŞÜS·û==
adobeRGB
))

1881 
	`cŞÜCÚv”tSourû
(
sourûCŞÜS·û
, 
g¿ySÿË
, (
uby‹
*)
loÿlInBufãr
, 
cu¼SourûWidth
, 
numLšesThisC®l
);

1883 
sÿÆšeWidth
 = 
medŸWidthInPix–s
 * 
d¡NumCompÚ’ts
;

1886 if(
ËáM¬gšInPix
)

1888 
ÃwSŒPŒ
=
	`shiáSŒByLeáM¬gš
((
uby‹
*)
loÿlInBufãr
, 
cu¼SourûWidth
, 
cu¼SŒHeight
, 
numLšesThisC®l
, 
medŸWidthInPix–s
, 
ËáM¬gšInPix
, 
de¡CŞÜS·û
);

1890 if(
sourûCŞÜS·û
==
g¿ySÿË
)

1891 
	`wr™eOuutFe
(
cu¼SŒHeight
*
medŸWidthInPix–s
,(
uby‹
*)
ÃwSŒPŒ
, 
m_pPCLmSS‘tšgs
->
u£r_Çme
);

1893 
	`wr™eOuutFe
(3*
cu¼SŒHeight
*
medŸWidthInPix–s
,(
uby‹
*)
ÃwSŒPŒ
, 
m_pPCLmSS‘tšgs
->
u£r_Çme
);

1897 #ifdeà
SUPPORT_WHITE_STRIPS


1898 
boŞ
 
wh™eSŒ
=
	`isWh™eSŒ
(
pInBufãr
, 
thisHeight
*
cu¼SourûWidth
*
¤cNumCompÚ’ts
);

1899 if(
DebugIt2
)

1901 if(
wh™eSŒ
){

1902 
	`dbglog
("Found white strip\n");

1905 
	`dbglog
("Found‚on-white strip\n");

1909 
boŞ
 
wh™eSŒ
=
çl£
;

1912 if(
cu¼Com´essiÚDi¥os™iÚ
==
com´essDCT
)

1914 if(
fœ¡SŒ
 && 
tİM¬gšInPix
)

1916 
uby‹
 
wh™ePt
=0xff;

1918 
uby‹
 *
tmpSŒ
=(uby‹*)
	`m®loc
(
sÿÆšeWidth
*
tİM¬gšInPix
);

1919 
	`mem£t
(
tmpSŒ
,
wh™ePt
,
sÿÆšeWidth
*
tİM¬gšInPix
);

1922 
sšt32
 
¡rCÁr
=0; sŒCÁr<
numFuÎInjeùedSŒs
;stripCntr++)

1924 
	`wr™e_JPEG_Buff
 (
sü©chBufãr
, 
JPEG_QUALITY
, 
medŸWidthInPix–s
, (
sšt32
)
numFuÎSÿÆšesToInjeù
, (
JSAMPLE
*)
tmpSŒ
, 
cu¼R’d”ResŞutiÚIÁeg”
, 
de¡CŞÜS·û
, &
numCompBy‹s
);

1925 
	`šjeùJPEG
((*)
sü©chBufãr
, 
medŸWidthInPix–s
, (
sšt32
)
numFuÎSÿÆšesToInjeù
, 
numCompBy‹s
, 
de¡CŞÜS·û
, 
Œue
 );

1928 if(
numP¬tŸlSÿÆšesToInjeù
)

1931 
	`wr™e_JPEG_Buff
 (
sü©chBufãr
, 
JPEG_QUALITY
, 
medŸWidthInPix–s
, 
numP¬tŸlSÿÆšesToInjeù
, (
JSAMPLE
*)
tmpSŒ
, 
cu¼R’d”ResŞutiÚIÁeg”
, 
de¡CŞÜS·û
, &
numCompBy‹s
);

1932 
	`šjeùJPEG
((*)
sü©chBufãr
, 
medŸWidthInPix–s
, 
numP¬tŸlSÿÆšesToInjeù
, 
numCompBy‹s
, 
de¡CŞÜS·û
, 
Œue
 );

1935 
	`ä“
(
tmpSŒ
);

1936 
fœ¡SŒ
=
çl£
;

1947 if(
numLšesThisC®l
<
cu¼SŒHeight
)

1949 
sšt32
 
numLeáov”By‹s
=(
cu¼SŒHeight
-
numLšesThisC®l
)*
cu¼SourûWidth
*3;

1950 
sšt32
 
numImagedBy‹s
 =
numLšesThisC®l
*
cu¼SourûWidth
*3;

1952 
	`mem£t
((
uby‹
*)
loÿlInBufãr
+
numImagedBy‹s
, 0xff, 
numLeáov”By‹s
);

1955 if(
ÃwSŒPŒ
)

1957 
	`wr™e_JPEG_Buff
 (
sü©chBufãr
, 
JPEG_QUALITY
, 
medŸWidthInPix–s
, 
cu¼SŒHeight
, (
JSAMPLE
*)
ÃwSŒPŒ
, 
cu¼R’d”ResŞutiÚIÁeg”
, 
de¡CŞÜS·û
, &
numCompBy‹s
);

1958 
	`ä“
(
ÃwSŒPŒ
);

1959 
ÃwSŒPŒ
 = 
NULL
;

1962 
	`wr™e_JPEG_Buff
 (
sü©chBufãr
, 
JPEG_QUALITY
, 
medŸWidthInPix–s
, 
cu¼SŒHeight
, (
JSAMPLE
*)
loÿlInBufãr
, 
cu¼R’d”ResŞutiÚIÁeg”
, 
de¡CŞÜS·û
, &
numCompBy‹s
);

1964 if(
DebugIt2
)

1965 
	`wr™eOuutFe
(
numCompBy‹s
, 
sü©chBufãr
, 
m_pPCLmSS‘tšgs
->
u£r_Çme
);

1966 
	`šjeùJPEG
((*)
sü©chBufãr
, 
medŸWidthInPix–s
, 
cu¼SŒHeight
, 
numCompBy‹s
, 
de¡CŞÜS·û
, 
wh™eSŒ
 );

1969 if(
ÃwSŒPŒ
)

1971 
	`wr™e_JPEG_Buff
 (
sü©chBufãr
, 
JPEG_QUALITY
, 
medŸWidthInPix–s
, 
numLšesThisC®l
, (
JSAMPLE
*)
ÃwSŒPŒ
, 
cu¼R’d”ResŞutiÚIÁeg”
, 
de¡CŞÜS·û
, &
numCompBy‹s
);

1972 
	`ä“
(
ÃwSŒPŒ
);

1973 
ÃwSŒPŒ
 = 
NULL
;

1976 
	`wr™e_JPEG_Buff
 (
sü©chBufãr
, 
JPEG_QUALITY
, 
medŸWidthInPix–s
, 
numLšesThisC®l
, (
JSAMPLE
*)
loÿlInBufãr
, 
cu¼R’d”ResŞutiÚIÁeg”
, 
de¡CŞÜS·û
, &
numCompBy‹s
);

1977 if(
DebugIt2
)

1978 
	`wr™eOuutFe
(
numCompBy‹s
, 
sü©chBufãr
, 
m_pPCLmSS‘tšgs
->
u£r_Çme
);

1979 
	`šjeùJPEG
((*)
sü©chBufãr
, 
medŸWidthInPix–s
, 
numLšesThisC®l
, 
numCompBy‹s
, 
de¡CŞÜS·û
, 
wh™eSŒ
 );

1982 if(
cu¼Com´essiÚDi¥os™iÚ
==
com´essFÏ‹
)

1984 
ušt32
 
Ën
=
numLšesThisC®l
*
sÿÆšeWidth
;

1985 
uLÚgf
 
de¡Size
=
Ën
;

1987 if(
fœ¡SŒ
 && 
tİM¬gšInPix
)

1989 
uby‹
 
wh™ePt
=0xff;

1992 
uby‹
 *
tmpSŒ
=(uby‹*)
	`m®loc
(
sÿÆšeWidth
*
tİM¬gšInPix
);

1993 
uLÚgf
 
tmpDe¡Size
=
de¡Size
;

1994 
	`mem£t
(
tmpSŒ
,
wh™ePt
,
sÿÆšeWidth
*
tİM¬gšInPix
);

1996 
sšt32
 
¡rCÁr
=0; sŒCÁr<
numFuÎInjeùedSŒs
;stripCntr++)

1998 
»suÉ
=
	`com´ess
((
By‹f
*)
sü©chBufãr
,&
tmpDe¡Size
, (cÚ¡ By‹f*)
tmpSŒ
, 
sÿÆšeWidth
*
numFuÎSÿÆšesToInjeù
);

1999 
	`šjeùLZSŒ
((
uby‹
*)
sü©chBufãr
, 
tmpDe¡Size
, 
medŸWidthInPix–s
, 
numFuÎSÿÆšesToInjeù
, 
de¡CŞÜS·û
, 
Œue
 );

2001 if(
numP¬tŸlSÿÆšesToInjeù
)

2003 
»suÉ
=
	`com´ess
((
By‹f
*)
sü©chBufãr
,&
tmpDe¡Size
, (cÚ¡ By‹f*)
tmpSŒ
, 
sÿÆšeWidth
*
numP¬tŸlSÿÆšesToInjeù
);

2004 
	`šjeùLZSŒ
((
uby‹
*)
sü©chBufãr
, 
tmpDe¡Size
, 
medŸWidthInPix–s
, 
numP¬tŸlSÿÆšesToInjeù
, 
de¡CŞÜS·û
, 
Œue
 );

2006 
	`ä“
(
tmpSŒ
);

2007 
fœ¡SŒ
=
çl£
;

2010 if(
ÃwSŒPŒ
)

2012 
»suÉ
=
	`com´ess
((
By‹f
*)
sü©chBufãr
,&
de¡Size
,(cÚ¡ By‹f*)
ÃwSŒPŒ
,
sÿÆšeWidth
*
numLšesThisC®l
);

2013 if(
DebugIt2
)

2014 
	`wr™eOuutFe
(
de¡Size
, 
sü©chBufãr
, 
m_pPCLmSS‘tšgs
->
u£r_Çme
);

2015 if(
DebugIt2
)

2017 
	`dbglog
("AÎoÿ‹d zlib de¡ bufã¸oàsiz%d\n",
numLšesThisC®l
*
sÿÆšeWidth
);

2018 
	`dbglog
("zlib com´essiÚ„‘uº„esuÉ=%d, compSize=%d\n",
»suÉ
,()
de¡Size
);

2020 
	`ä“
(
ÃwSŒPŒ
);

2021 
ÃwSŒPŒ
 = 
NULL
;

2025 
»suÉ
=
	`com´ess
((
By‹f
*)
sü©chBufãr
, &
de¡Size
, (cÚ¡ By‹f*)
loÿlInBufãr
, 
sÿÆšeWidth
*
numLšesThisC®l
);

2026 if(
DebugIt2
)

2027 
	`wr™eOuutFe
(
de¡Size
, 
sü©chBufãr
, 
m_pPCLmSS‘tšgs
->
u£r_Çme
);

2028 if(
DebugIt2
)

2030 
	`dbglog
("AÎoÿ‹d zlib de¡ bufã¸oàsiz%d\n",
numLšesThisC®l
*
sÿÆšeWidth
);

2031 
	`dbglog
("zlib com´essiÚ„‘uº„esuÉ=%d, compSize=%d\n",
»suÉ
,()
de¡Size
);

2034 
	`šjeùLZSŒ
(
sü©chBufãr
,
de¡Size
, 
medŸWidthInPix–s
, 
numLšesThisC®l
, 
de¡CŞÜS·û
, 
wh™eSŒ
);

2037 if(
cu¼Com´essiÚDi¥os™iÚ
==
com´essRLE
)

2039 if(
fœ¡SŒ
 && 
tİM¬gšInPix
)

2041 
uby‹
 
wh™ePt
=0xff;

2045 
uby‹
 *
tmpSŒ
=(uby‹*)
	`m®loc
(
sÿÆšeWidth
*
tİM¬gšInPix
);

2046 
	`mem£t
(
tmpSŒ
,
wh™ePt
,
sÿÆšeWidth
*
tİM¬gšInPix
);

2048 
sšt32
 
¡rCÁr
=0; sŒCÁr<
numFuÎInjeùedSŒs
;stripCntr++)

2050 
compSize
=
	`HPRunL’_Encode
((
uby‹
*)
tmpSŒ
, 
sü©chBufãr
, 
sÿÆšeWidth
*
numFuÎSÿÆšesToInjeù
);

2051 
	`šjeùRLESŒ
((
uby‹
*)
sü©chBufãr
, 
compSize
, 
medŸWidthInPix–s
, 
numFuÎSÿÆšesToInjeù
, 
de¡CŞÜS·û
, 
Œue
 );

2054 if(
numP¬tŸlSÿÆšesToInjeù
)

2056 
compSize
=
	`HPRunL’_Encode
((
uby‹
*)
tmpSŒ
, 
sü©chBufãr
, 
sÿÆšeWidth
*
numP¬tŸlSÿÆšesToInjeù
);

2057 
	`šjeùRLESŒ
((
uby‹
*)
sü©chBufãr
, 
compSize
, 
medŸWidthInPix–s
, 
numP¬tŸlSÿÆšesToInjeù
, 
de¡CŞÜS·û
, 
Œue
 );

2060 
	`ä“
(
tmpSŒ
);

2061 
fœ¡SŒ
=
çl£
;

2064 if(
ÃwSŒPŒ
)

2066 
compSize
=
	`HPRunL’_Encode
((
uby‹
*)
ÃwSŒPŒ
, 
sü©chBufãr
, 
sÿÆšeWidth
*
numLšesThisC®l
);

2067 
	`ä“
(
ÃwSŒPŒ
);

2068 
ÃwSŒPŒ
 = 
NULL
;

2071 
compSize
=
	`HPRunL’_Encode
((
uby‹
*)
loÿlInBufãr
, 
sü©chBufãr
, 
sÿÆšeWidth
*
numLšesThisC®l
);

2073 if(
DebugIt2
)

2075 
	`dbglog
("AÎoÿ‹d„Ë de¡ bufã¸oàsiz%d\n",
numLšesThisC®l
*
sÿÆšeWidth
);

2076 
	`dbglog
("¾com´essiÚ„‘uº size=%d=%d\n",
»suÉ
,()
compSize
);

2078 
	`šjeùRLESŒ
(
sü©chBufãr
, 
compSize
, 
medŸWidthInPix–s
, 
numLšesThisC®l
, 
de¡CŞÜS·û
, 
wh™eSŒ
);

2081 
	`as£¹
(0);

2083 *
iOutBufãrSize
=
tÙ®By‹sWr™‹nToCu¼Buff
;

2091 if(
ÃwSŒPŒ
)

2093 
	`ä“
(
ÃwSŒPŒ
);

2094 
ÃwSŒPŒ
 = 
NULL
;

2096 (
sucûss
);

2097 
	}
}

2105 
	gPCLmG’”©Ü
::
	$F»eBufãr
(*
pBufãr
)

2107 if(
jobO³n
==
job_şo£d
 && 
pBufãr
)

2110 if(
pBufãr
 =ğ
®loÿ‹dOuutBufãr
)

2112 
®loÿ‹dOuutBufãr
 = 
NULL
;

2114 
	`ä“
(
pBufãr
);

2116 
pBufãr
=
NULL
;

2117 
	}
}

	@prnt/hpcups/genPCLm.h

16 
	~<j³glib.h
>

18 
»ad_JPEG_fe
 (* 
f’ame
);

21 #ifdeà
OLDWAY


24 
	mdeviûRGB
,

25 
	madobeRGB
,

26 
	mg¿ySÿË
,

27 } 
	tcŞÜS·ûDi¥os™iÚ
;

31 
wr™e_JPEG_Buff
 (
uby‹
 * 
outBuff
, 
qu®™y
, 
image_width
, 
image_height
, 
JSAMPLE
 *
imageBufãr
, 
»sŞutiÚ
, 
cŞÜS·ûDi¥os™iÚ
, *
numCompBy‹s
);

35 
image_width
;

36 
image_height
;

37 
image_numCompÚ’ts
;

38 
JSAMPLE
 * 
image_bufãr
;

39 *
myImageBufãr
;

40 
LZWEncodeFe
(*
šBuff
, 
šBuffSize
, *
outFe
) ;

	@prnt/hpcups/hpjbig_wrapper.h

33 *
	mpszCom´es£dD©a
;

34 
	mdwTÙ®Size
;

35 } 
	tHPLJZjcBuff
;

39 
	mxd
;

40 
	myd
;

41 
	ml0
;

42 
	mmx
;

43 
	mmy
;

44 
	mÜd”
;

45 
	m¶ªes
;

46 
	mdl
;

47 
	md
;

48 
	mİtiÚs
;

49 } 
	tHPLJZjsJbgEncSt
;

	@prnt/hpcups/jccolor.c

11 
	#JPEG_INTERNALS


	)

12 
	~"jšşude.h
"

13 
	~"j³glib.h
"

20 
j³g_cŞÜ_cÚv”‹r
 
	mpub
;

23 
INT32
 * 
	mrgb_ycc_b
;

24 } 
	tmy_cŞÜ_cÚv”‹r
;

26 
my_cŞÜ_cÚv”‹r
 * 
	tmy_ccÚv”t_±r
;

69 
	#SCALEBITS
 16

	)

70 
	#CBCR_OFFSET
 ((
INT32
è
CENTERJSAMPLE
 << 
SCALEBITS
)

	)

71 
	#ONE_HALF
 ((
INT32
è1 << (
SCALEBITS
-1))

	)

72 
	#FIX
(
x
è((
INT32
è((xè* (1L<<
SCALEBITS
è+ 0.5))

	)

80 
	giU£MojaveCsc
 = 1;

82 
	gR_Y_OFF
;

83 
	gG_Y_OFF
;

84 
	gB_Y_OFF
;

85 
	gR_CB_OFF
;

86 
	gG_CB_OFF
;

87 
	gB_CB_OFF
;

88 
	gR_CR_OFF
;

89 
	gG_CR_OFF
;

90 
	gB_CR_OFF
;

91 
	gTABLE_SIZE
;

93 
	$hp_rgb_ycc_£tup
 (
iFÏg
)

95 
iU£MojaveCsc
 = 
iFÏg
;

96 ià(
iU£MojaveCsc
)

98 
R_Y_OFF
 = 0;

99 
G_Y_OFF
 = (1*(
MAXJSAMPLE
+1));

100 
B_Y_OFF
 = (2*(
MAXJSAMPLE
+1));

101 
R_CB_OFF
 = 
R_Y_OFF
;

102 
G_CB_OFF
 = (3*(
MAXJSAMPLE
+1));

103 
B_CB_OFF
 = 
G_Y_OFF
;

104 
R_CR_OFF
 = 
R_Y_OFF
;

105 
G_CR_OFF
 = 
G_Y_OFF
;

106 
B_CR_OFF
 = 
G_CB_OFF
;

107 
TABLE_SIZE
 = (4*(
MAXJSAMPLE
+1));

111 
R_Y_OFF
 = 0;

112 
G_Y_OFF
 = (1*(
MAXJSAMPLE
+1));

113 
B_Y_OFF
ğ(2*(
MAXJSAMPLE
+1));

114 
R_CB_OFF
ğ(3*(
MAXJSAMPLE
+1));

115 
G_CB_OFF
ğ(4*(
MAXJSAMPLE
+1));

116 
B_CB_OFF
ğ(5*(
MAXJSAMPLE
+1));

117 
R_CR_OFF
ğ
B_CB_OFF
;

118 
G_CR_OFF
ğ(6*(
MAXJSAMPLE
+1));

119 
B_CR_OFF
ğ(7*(
MAXJSAMPLE
+1));

120 
TABLE_SIZE
 =(8*(
MAXJSAMPLE
+1));

122 
	}
}

128 
	$METHODDEF
()

129 
	$rgb_ycc_¡¬t
 (
j_com´ess_±r
 
cšfo
)

131 
my_ccÚv”t_±r
 
ccÚv”t
 = (my_ccÚv”t_±rè
cšfo
->cconvert;

132 
INT32
 * 
rgb_ycc_b
;

133 
INT32
 
i
;

136 
ccÚv”t
->
rgb_ycc_b
 =„gb_ycc_b = (
INT32
 *)

137 (*
cšfo
->
mem
->
®loc_sm®l
è((
j_commÚ_±r
ècšfo, 
JPOOL_IMAGE
,

138 (
TABLE_SIZE
 * 
	`SIZEOF
(
INT32
)));

140 
i
 = 0; i <ğ
MAXJSAMPLE
; i++)

142 ià(
iU£MojaveCsc
)

144 
rgb_ycc_b
[
i
+
R_Y_OFF
] = 
	`FIX
(0.50000) * i;

145 
rgb_ycc_b
[
i
+
G_Y_OFF
] = 
	`FIX
(0.00000) * i;

146 
rgb_ycc_b
[
i
+
B_Y_OFF
] = 
	`FIX
(0.00000è* i + 
ONE_HALF
;

150 
rgb_ycc_b
[
i
+
G_CB_OFF
] = (-
	`FIX
(0.50000)è* i + 
CBCR_OFFSET
 + 
ONE_HALF
-1;

170 
rgb_ycc_b
[
i
+
R_Y_OFF
] = 
	`FIX
(0.29900) * i;

171 
rgb_ycc_b
[
i
+
G_Y_OFF
] = 
	`FIX
(0.58700) * i;

172 
rgb_ycc_b
[
i
+
B_Y_OFF
] = 
	`FIX
(0.11400è* i + 
ONE_HALF
;

173 
rgb_ycc_b
[
i
+
R_CB_OFF
] = (-
	`FIX
(0.16874)) * i;

174 
rgb_ycc_b
[
i
+
G_CB_OFF
] = (-
	`FIX
(0.33126)) * i;

179 
rgb_ycc_b
[
i
+
B_CB_OFF
] = 
	`FIX
(0.50000è* i + 
CBCR_OFFSET
 + 
ONE_HALF
-1;

183 
rgb_ycc_b
[
i
+
G_CR_OFF
] = (-
	`FIX
(0.41869)) * i;

184 
rgb_ycc_b
[
i
+
B_CR_OFF
] = (-
	`FIX
(0.08131)) * i;

187 
	}
}

202 
	$METHODDEF
()

203 
	$rgb_ycc_cÚv”t
 (
j_com´ess_±r
 
cšfo
,

204 
JSAMPARRAY
 
šput_buf
, 
JSAMPIMAGE
 
ouut_buf
,

205 
JDIMENSION
 
ouut_row
, 
num_rows
)

207 
my_ccÚv”t_±r
 
ccÚv”t
 = (my_ccÚv”t_±rè
cšfo
->cconvert;

208 
r
, 
g
, 
b
;

209 
INT32
 * 
ùab
 = 
ccÚv”t
->
rgb_ycc_b
;

210 
JSAMPROW
 
š±r
;

211 
JSAMPROW
 
ouŒ0
, 
ouŒ1
, 
ouŒ2
;

212 
JDIMENSION
 
cŞ
;

213 
JDIMENSION
 
num_cŞs
 = 
cšfo
->
image_width
;

215 --
num_rows
 >= 0) {

216 
š±r
 = *
šput_buf
++;

217 
ouŒ0
 = 
ouut_buf
[0][
ouut_row
];

218 
ouŒ1
 = 
ouut_buf
[1][
ouut_row
];

219 
ouŒ2
 = 
ouut_buf
[2][
ouut_row
];

220 
ouut_row
++;

221 
cŞ
 = 0; cŞ < 
num_cŞs
; col++) {

222 
r
 = 
	`GETJSAMPLE
(
š±r
[
RGB_RED
]);

223 
g
 = 
	`GETJSAMPLE
(
š±r
[
RGB_GREEN
]);

224 
b
 = 
	`GETJSAMPLE
(
š±r
[
RGB_BLUE
]);

225 
š±r
 +ğ
RGB_PIXELSIZE
;

232 
ouŒ0
[
cŞ
] = (
JSAMPLE
)

233 ((
ùab
[
r
+
R_Y_OFF
] + cb[
g
+
G_Y_OFF
] + cb[
b
+
B_Y_OFF
])

234 >> 
SCALEBITS
);

236 
ouŒ1
[
cŞ
] = (
JSAMPLE
)

237 ((
ùab
[
r
+
R_CB_OFF
] + cb[
g
+
G_CB_OFF
] + cb[
b
+
B_CB_OFF
])

238 >> 
SCALEBITS
);

240 
ouŒ2
[
cŞ
] = (
JSAMPLE
)

241 ((
ùab
[
r
+
R_CR_OFF
] + cb[
g
+
G_CR_OFF
] + cb[
b
+
B_CR_OFF
])

242 >> 
SCALEBITS
);

245 
	}
}

258 
	$METHODDEF
()

259 
	$rgb_g¿y_cÚv”t
 (
j_com´ess_±r
 
cšfo
,

260 
JSAMPARRAY
 
šput_buf
, 
JSAMPIMAGE
 
ouut_buf
,

261 
JDIMENSION
 
ouut_row
, 
num_rows
)

263 
my_ccÚv”t_±r
 
ccÚv”t
 = (my_ccÚv”t_±rè
cšfo
->cconvert;

264 
r
, 
g
, 
b
;

265 
INT32
 * 
ùab
 = 
ccÚv”t
->
rgb_ycc_b
;

266 
JSAMPROW
 
š±r
;

267 
JSAMPROW
 
ouŒ
;

268 
JDIMENSION
 
cŞ
;

269 
JDIMENSION
 
num_cŞs
 = 
cšfo
->
image_width
;

271 --
num_rows
 >= 0) {

272 
š±r
 = *
šput_buf
++;

273 
ouŒ
 = 
ouut_buf
[0][
ouut_row
];

274 
ouut_row
++;

275 
cŞ
 = 0; cŞ < 
num_cŞs
; col++) {

276 
r
 = 
	`GETJSAMPLE
(
š±r
[
RGB_RED
]);

277 
g
 = 
	`GETJSAMPLE
(
š±r
[
RGB_GREEN
]);

278 
b
 = 
	`GETJSAMPLE
(
š±r
[
RGB_BLUE
]);

279 
š±r
 +ğ
RGB_PIXELSIZE
;

281 
ouŒ
[
cŞ
] = (
JSAMPLE
)

282 ((
ùab
[
r
+
R_Y_OFF
] + cb[
g
+
G_Y_OFF
] + cb[
b
+
B_Y_OFF
])

283 >> 
SCALEBITS
);

286 
	}
}

297 
	$METHODDEF
()

298 
	$cmyk_ycck_cÚv”t
 (
j_com´ess_±r
 
cšfo
,

299 
JSAMPARRAY
 
šput_buf
, 
JSAMPIMAGE
 
ouut_buf
,

300 
JDIMENSION
 
ouut_row
, 
num_rows
)

302 
my_ccÚv”t_±r
 
ccÚv”t
 = (my_ccÚv”t_±rè
cšfo
->cconvert;

303 
r
, 
g
, 
b
;

304 
INT32
 * 
ùab
 = 
ccÚv”t
->
rgb_ycc_b
;

305 
JSAMPROW
 
š±r
;

306 
JSAMPROW
 
ouŒ0
, 
ouŒ1
, 
ouŒ2
, 
ouŒ3
;

307 
JDIMENSION
 
cŞ
;

308 
JDIMENSION
 
num_cŞs
 = 
cšfo
->
image_width
;

310 --
num_rows
 >= 0) {

311 
š±r
 = *
šput_buf
++;

312 
ouŒ0
 = 
ouut_buf
[0][
ouut_row
];

313 
ouŒ1
 = 
ouut_buf
[1][
ouut_row
];

314 
ouŒ2
 = 
ouut_buf
[2][
ouut_row
];

315 
ouŒ3
 = 
ouut_buf
[3][
ouut_row
];

316 
ouut_row
++;

317 
cŞ
 = 0; cŞ < 
num_cŞs
; col++) {

318 
r
 = 
MAXJSAMPLE
 - 
	`GETJSAMPLE
(
š±r
[0]);

319 
g
 = 
MAXJSAMPLE
 - 
	`GETJSAMPLE
(
š±r
[1]);

320 
b
 = 
MAXJSAMPLE
 - 
	`GETJSAMPLE
(
š±r
[2]);

322 
ouŒ3
[
cŞ
] = 
š±r
[3];

323 
š±r
 += 4;

330 
ouŒ0
[
cŞ
] = (
JSAMPLE
)

331 ((
ùab
[
r
+
R_Y_OFF
] + cb[
g
+
G_Y_OFF
] + cb[
b
+
B_Y_OFF
])

332 >> 
SCALEBITS
);

334 
ouŒ1
[
cŞ
] = (
JSAMPLE
)

335 ((
ùab
[
r
+
R_CB_OFF
] + cb[
g
+
G_CB_OFF
] + cb[
b
+
B_CB_OFF
])

336 >> 
SCALEBITS
);

338 
ouŒ2
[
cŞ
] = (
JSAMPLE
)

339 ((
ùab
[
r
+
R_CR_OFF
] + cb[
g
+
G_CR_OFF
] + cb[
b
+
B_CR_OFF
])

340 >> 
SCALEBITS
);

343 
	}
}

352 
	$METHODDEF
()

353 
	$g¿ysÿË_cÚv”t
 (
j_com´ess_±r
 
cšfo
,

354 
JSAMPARRAY
 
šput_buf
, 
JSAMPIMAGE
 
ouut_buf
,

355 
JDIMENSION
 
ouut_row
, 
num_rows
)

357 
JSAMPROW
 
š±r
;

358 
JSAMPROW
 
ouŒ
;

359 
JDIMENSION
 
cŞ
;

360 
JDIMENSION
 
num_cŞs
 = 
cšfo
->
image_width
;

361 
š¡ride
 = 
cšfo
->
šput_compÚ’ts
;

363 --
num_rows
 >= 0) {

364 
š±r
 = *
šput_buf
++;

365 
ouŒ
 = 
ouut_buf
[0][
ouut_row
];

366 
ouut_row
++;

367 
cŞ
 = 0; cŞ < 
num_cŞs
; col++) {

368 
ouŒ
[
cŞ
] = 
š±r
[0];

369 
š±r
 +ğ
š¡ride
;

372 
	}
}

381 
	$METHODDEF
()

382 
	$nuÎ_cÚv”t
 (
j_com´ess_±r
 
cšfo
,

383 
JSAMPARRAY
 
šput_buf
, 
JSAMPIMAGE
 
ouut_buf
,

384 
JDIMENSION
 
ouut_row
, 
num_rows
)

386 
JSAMPROW
 
š±r
;

387 
JSAMPROW
 
ouŒ
;

388 
JDIMENSION
 
cŞ
;

389 
ci
;

390 
nc
 = 
cšfo
->
num_compÚ’ts
;

391 
JDIMENSION
 
num_cŞs
 = 
cšfo
->
image_width
;

393 --
num_rows
 >= 0) {

395 
ci
 = 0; c˜< 
nc
; ci++) {

396 
š±r
 = *
šput_buf
;

397 
ouŒ
 = 
ouut_buf
[
ci
][
ouut_row
];

398 
cŞ
 = 0; cŞ < 
num_cŞs
; col++) {

399 
ouŒ
[
cŞ
] = 
š±r
[
ci
];

400 
š±r
 +ğ
nc
;

403 
šput_buf
++;

404 
ouut_row
++;

406 
	}
}

413 
	$METHODDEF
()

414 
	$nuÎ_m‘hod
 (
j_com´ess_±r
 
cšfo
)

417 
	}
}

424 
	$GLOBAL
()

425 
	$jš™_cŞÜ_cÚv”‹r
 (
j_com´ess_±r
 
cšfo
)

427 
my_ccÚv”t_±r
 
ccÚv”t
;

429 
ccÚv”t
 = (
my_ccÚv”t_±r
)

430 (*
cšfo
->
mem
->
®loc_sm®l
è((
j_commÚ_±r
ècšfo, 
JPOOL_IMAGE
,

431 
	`SIZEOF
(
my_cŞÜ_cÚv”‹r
));

432 
cšfo
->
ccÚv”t
 = (
j³g_cŞÜ_cÚv”‹r
 *) cconvert;

434 
ccÚv”t
->
pub
.
¡¬t_·ss
 = 
nuÎ_m‘hod
;

437 
cšfo
->
š_cŞÜ_¥aû
) {

438 
JCS_GRAYSCALE
:

439 ià(
cšfo
->
šput_compÚ’ts
 != 1)

440 
	`ERREXIT
(
cšfo
, 
JERR_BAD_IN_COLORSPACE
);

443 
JCS_RGB
:

444 #ià
RGB_PIXELSIZE
 != 3

445 ià(
cšfo
->
šput_compÚ’ts
 !ğ
RGB_PIXELSIZE
)

446 
	`ERREXIT
(
cšfo
, 
JERR_BAD_IN_COLORSPACE
);

450 
JCS_YCbCr
:

451 ià(
cšfo
->
šput_compÚ’ts
 != 3)

452 
	`ERREXIT
(
cšfo
, 
JERR_BAD_IN_COLORSPACE
);

455 
JCS_CMYK
:

456 
JCS_YCCK
:

457 ià(
cšfo
->
šput_compÚ’ts
 != 4)

458 
	`ERREXIT
(
cšfo
, 
JERR_BAD_IN_COLORSPACE
);

462 ià(
cšfo
->
šput_compÚ’ts
 < 1)

463 
	`ERREXIT
(
cšfo
, 
JERR_BAD_IN_COLORSPACE
);

468 
cšfo
->
j³g_cŞÜ_¥aû
) {

469 
JCS_GRAYSCALE
:

470 ià(
cšfo
->
num_compÚ’ts
 != 1)

471 
	`ERREXIT
(
cšfo
, 
JERR_BAD_J_COLORSPACE
);

472 ià(
cšfo
->
š_cŞÜ_¥aû
 =ğ
JCS_GRAYSCALE
)

473 
ccÚv”t
->
pub
.
cŞÜ_cÚv”t
 = 
g¿ysÿË_cÚv”t
;

474 ià(
cšfo
->
š_cŞÜ_¥aû
 =ğ
JCS_RGB
) {

475 
ccÚv”t
->
pub
.
¡¬t_·ss
 = 
rgb_ycc_¡¬t
;

476 
ccÚv”t
->
pub
.
cŞÜ_cÚv”t
 = 
rgb_g¿y_cÚv”t
;

477 } ià(
cšfo
->
š_cŞÜ_¥aû
 =ğ
JCS_YCbCr
)

478 
ccÚv”t
->
pub
.
cŞÜ_cÚv”t
 = 
g¿ysÿË_cÚv”t
;

480 
	`ERREXIT
(
cšfo
, 
JERR_CONVERSION_NOTIMPL
);

483 
JCS_RGB
:

484 ià(
cšfo
->
num_compÚ’ts
 != 3)

485 
	`ERREXIT
(
cšfo
, 
JERR_BAD_J_COLORSPACE
);

486 ià(
cšfo
->
š_cŞÜ_¥aû
 =ğ
JCS_RGB
 && 
RGB_PIXELSIZE
 == 3)

487 
ccÚv”t
->
pub
.
cŞÜ_cÚv”t
 = 
nuÎ_cÚv”t
;

489 
	`ERREXIT
(
cšfo
, 
JERR_CONVERSION_NOTIMPL
);

492 
JCS_YCbCr
:

493 ià(
cšfo
->
num_compÚ’ts
 != 3)

494 
	`ERREXIT
(
cšfo
, 
JERR_BAD_J_COLORSPACE
);

495 ià(
cšfo
->
š_cŞÜ_¥aû
 =ğ
JCS_RGB
) {

496 
ccÚv”t
->
pub
.
¡¬t_·ss
 = 
rgb_ycc_¡¬t
;

497 
ccÚv”t
->
pub
.
cŞÜ_cÚv”t
 = 
rgb_ycc_cÚv”t
;

498 } ià(
cšfo
->
š_cŞÜ_¥aû
 =ğ
JCS_YCbCr
)

499 
ccÚv”t
->
pub
.
cŞÜ_cÚv”t
 = 
nuÎ_cÚv”t
;

501 
	`ERREXIT
(
cšfo
, 
JERR_CONVERSION_NOTIMPL
);

504 
JCS_CMYK
:

505 ià(
cšfo
->
num_compÚ’ts
 != 4)

506 
	`ERREXIT
(
cšfo
, 
JERR_BAD_J_COLORSPACE
);

507 ià(
cšfo
->
š_cŞÜ_¥aû
 =ğ
JCS_CMYK
)

508 
ccÚv”t
->
pub
.
cŞÜ_cÚv”t
 = 
nuÎ_cÚv”t
;

510 
	`ERREXIT
(
cšfo
, 
JERR_CONVERSION_NOTIMPL
);

513 
JCS_YCCK
:

514 ià(
cšfo
->
num_compÚ’ts
 != 4)

515 
	`ERREXIT
(
cšfo
, 
JERR_BAD_J_COLORSPACE
);

516 ià(
cšfo
->
š_cŞÜ_¥aû
 =ğ
JCS_CMYK
) {

517 
ccÚv”t
->
pub
.
¡¬t_·ss
 = 
rgb_ycc_¡¬t
;

518 
ccÚv”t
->
pub
.
cŞÜ_cÚv”t
 = 
cmyk_ycck_cÚv”t
;

519 } ià(
cšfo
->
š_cŞÜ_¥aû
 =ğ
JCS_YCCK
)

520 
ccÚv”t
->
pub
.
cŞÜ_cÚv”t
 = 
nuÎ_cÚv”t
;

522 
	`ERREXIT
(
cšfo
, 
JERR_CONVERSION_NOTIMPL
);

526 ià(
cšfo
->
j³g_cŞÜ_¥aû
 !ğcšfo->
š_cŞÜ_¥aû
 ||

527 
cšfo
->
num_compÚ’ts
 !ğcšfo->
šput_compÚ’ts
)

528 
	`ERREXIT
(
cšfo
, 
JERR_CONVERSION_NOTIMPL
);

529 
ccÚv”t
->
pub
.
cŞÜ_cÚv”t
 = 
nuÎ_cÚv”t
;

532 
	}
}

	@prnt/hpcups/jdatadbf.c

13 
	~"jšşude.h
"

14 
	~"j³glib.h
"

15 
	~"j”rÜ.h
"

18 #iâdeà
JMETHOD


19 
	#JMETHOD
(
ty³
,
m‘hodÇme
,
¬gli¡
è
	`ty³
 (*m‘hodÇmeè()

	)

25 
j³g_de¡š©iÚ_mgr
 
	mpub
;

27 
JOCTET
 * 
	moutbuff
;

28 
JOCTET
 * 
	mbufãr
;

29 
UINT16
 
	msize_outbuff
;

30 
JMETHOD
 (, 
æush_ouut_bufãr_ÿÎback
, (
JOCTET
 *
outbuf
, JOCTET* 
bufãr
, 
size_t
 
size
));

31 } 
	tmy_de¡š©iÚ_mgr
;

33 
my_de¡š©iÚ_mgr
 * 
	tmy_de¡_±r
;

35 
	#OUTPUT_BUF_SIZE
 4096

	)

43 
	$METHODDEF
()

44 
	$š™_de¡š©iÚ
 (
j_com´ess_±r
 
cšfo
)

46 
my_de¡_±r
 
de¡
 = (my_de¡_±rè
cšfo
->dest;

49 
de¡
->
bufãr
 = (
JOCTET
 *)

50 (*
cšfo
->
mem
->
®loc_sm®l
è((
j_commÚ_±r
ècšfo, 
JPOOL_IMAGE
,

51 
OUTPUT_BUF_SIZE
 * 
	`SIZEOF
(
JOCTET
));

53 
de¡
->
pub
.
Ãxt_ouut_by‹
 = de¡->
bufãr
;

54 
de¡
->
pub
.
ä“_š_bufãr
 = 
OUTPUT_BUF_SIZE
;

55 
	}
}

81 
	$METHODDEF
(
boŞ—n
)

82 
	$em±y_ouut_bufãr
 (
j_com´ess_±r
 
cšfo
)

84 
my_de¡_±r
 
de¡
 = (my_de¡_±rè
cšfo
->dest;

95 (*
de¡
->
æush_ouut_bufãr_ÿÎback
)(de¡->
outbuff
, de¡->
bufãr
, 
OUTPUT_BUF_SIZE
);

98 
de¡
->
pub
.
Ãxt_ouut_by‹
 = de¡->
bufãr
;

99 
de¡
->
pub
.
ä“_š_bufãr
 = 
OUTPUT_BUF_SIZE
;

101  
TRUE
;

102 
	}
}

114 
	$METHODDEF
()

115 
	$‹rm_de¡š©iÚ
 (
j_com´ess_±r
 
cšfo
)

117 
my_de¡_±r
 
de¡
 = (my_de¡_±rè
cšfo
->dest;

118 
size_t
 
d©acouÁ
 = 
OUTPUT_BUF_SIZE
 - 
de¡
->
pub
.
ä“_š_bufãr
;

121 ià(
d©acouÁ
 > 0) {

131 (*
de¡
->
æush_ouut_bufãr_ÿÎback
)(de¡->
outbuff
, de¡->
bufãr
, 
d©acouÁ
);

133 
	}
}

142 
	$GLOBAL
()

143 
	$j³g_bufãr_de¡
 (
j_com´ess_±r
 
cšfo
, 
JOCTET
* 
outbuff
, * 
æush_ouut_bufãr_ÿÎback
)

145 
my_de¡_±r
 
de¡
;

153 ià(
cšfo
->
de¡
 =ğ
NULL
) {

154 
cšfo
->
de¡
 = (
j³g_de¡š©iÚ_mgr
 *)

155 (*
cšfo
->
mem
->
®loc_sm®l
è((
j_commÚ_±r
ècšfo, 
JPOOL_PERMANENT
,

156 
	`SIZEOF
(
my_de¡š©iÚ_mgr
));

159 
de¡
 = (
my_de¡_±r
è
cšfo
->dest;

160 
de¡
->
pub
.
š™_de¡š©iÚ
 = init_destination;

161 
de¡
->
pub
.
em±y_ouut_bufãr
 =ƒmpty_output_buffer;

162 
de¡
->
pub
.
‹rm_de¡š©iÚ
 =erm_destination;

164 
de¡
->
outbuff
 = outbuff;

165 
de¡
->
size_outbuff
 = 0;

166 
de¡
->
æush_ouut_bufãr_ÿÎback
 = flush_output_buffer_callback;

168 
	}
}

170 
	$GLOBAL
()

171 
	$j³g_bufãr_size_de¡
 (
j_com´ess_±r
 
cšfo
)

173 
my_de¡_±r
 
de¡
 = (my_de¡_±rè
cšfo
->dest;

175  
de¡
->
size_outbuff
;

176 
	}
}

	@prnt/hpcups/jinclude.h

20 
	~"jcÚfig.h
"

21 
	#JCONFIG_INCLUDED


	)

34 #ifdeà
HAVE_STDDEF_H


35 
	~<¡ddef.h
>

38 #ifdeà
HAVE_STDLIB_H


39 
	~<¡dlib.h
>

42 #ifdeà
NEED_SYS_TYPES_H


43 
	~<sys/ty³s.h
>

46 
	~<¡dio.h
>

58 #ifdeà
NEED_BSD_STRINGS


60 
	~<¡ršgs.h
>

61 
	#MEMZERO
(
rg‘
,
size
è
	`bz”o
((*)Ñ¬g‘), (
size_t
)(size))

	)

62 
	#MEMCOPY
(
de¡
,
¤c
,
size
è
	`bcİy
((cÚ¡ *)(¤c), (*)(de¡), (
size_t
)(size))

	)

66 
	~<¡ršg.h
>

67 
	#MEMZERO
(
rg‘
,
size
è
	`mem£t
((*)Ñ¬g‘), 0, (
size_t
)(size))

	)

68 
	#MEMCOPY
(
de¡
,
¤c
,
size
è
	`memıy
((*)(de¡), (cÚ¡ *)(¤c), (
size_t
)(size))

	)

80 
	#SIZEOF
(
objeù
è((
size_t
è(objeù))

	)

88 
	#JFREAD
(
fe
,
buf
,
sizeofbuf
) \

89 ((
size_t
è
	`ä—d
((*è(
buf
), (size_tè1, (size_tè(
sizeofbuf
), (
fe
)))

	)

90 
	#JFWRITE
(
fe
,
buf
,
sizeofbuf
) \

91 ((
size_t
è
	`fwr™e
((cÚ¡ *è(
buf
), (size_tè1, (size_tè(
sizeofbuf
), (
fe
)))

	)

	@prnt/hpcups/resources.h

31 
HTBš¬y_İ’
[1024];

32 
HT300x3004Ëv–_İ’
[1024];

33 
HT600x6004Ëv–895_İ’
[1024];

35 
HTBš¬y_´İ
[1024];

36 
HT300x3004Ëv–_´İ
[1024];

37 
HT600x6004Ëv–895_´İ
[1024];

39 
HT600x6004Ëv–970_İ’
[1024];

40 
HT600x6004Ëv–970_´İ
[1024];

42 
HT600x6004Ëv–3600_İ’
[1024];

44 
HT1200x1200x1_PhÙoP»s970_İ’
[1024];

45 
HT600x600x4_P»s970_İ’
[1024];

47 
HT300x3004Ëv–970_İ’
[1024];

48 
HT1200x1200x1PhÙoBe¡_İ’
[1024];

50 
BYTE
 *
G‘HT12x12x1_4100_PhÙo_Be¡
 ();

	@prnt/hpijs/PrinterProperties.cpp

28 
	~"h—d”.h
"

30 
	~"Prš‹rPrİ”t›s.h
"

31 
	~"mod–s.h
"

33 
	gPÏtfÜmS”viûs
::
	$PÏtfÜmS”viûs
 (è: 
	$Sy¡emS”viûs
 ()

35 
	}
}

37 
PÏtfÜmS”viûs
::~
	$PÏtfÜmS”viûs
 ()

39 
	}
}

41 
PÏtfÜmS”viûs
::
	$pow”
 (
x
, 
y
)

43  (
	`pow
 (
x
, 
y
));

44 
	}
}

46 
BYTE
 * 
	gPÏtfÜmS”viûs
::
	$AÎocMem
 (
iMemSize
)

48  (
BYTE
 *è
	`m®loc
 (
iMemSize
);

49 
	}
}

51 
	gPÏtfÜmS”viûs
::
	$F»eMem
 (
BYTE
 *
pMem
)

53 
	`ä“
 (
pMem
);

54 
	}
}

56 
DWORD
 
	gPÏtfÜmS”viûs
::
	$G‘Sy¡emTickCouÁ
 ()

59 
	}
}

61 
DRIVER_ERROR
 
	gPÏtfÜmS”viûs
::
	$BusyWa™
 (
DWORD
 
m£c
)

63  
NO_ERROR
;

64 
	}
}

66 
	gPÏtfÜmS”viûs
::
	$Di¥ÏyPrš‹rStus
 (
DISPLAY_STATUS
 
ePrš‹rStus
)

68 
	}
}

70 
DRIVER_ERROR
 
PÏtfÜmS”viûs
::
	$R—dDeviûID
 (
BYTE
 *
¡rID
, 
iSize
)

72 
DRIVER_ERROR
 
eResuÉ
 = 
IO_ERROR
;

73  
eResuÉ
;

74 
	}
}

76 
BOOL
 
	gPÏtfÜmS”viûs
::
	$G‘StusInfo
 (
BYTE
 *
bStReg
)

78 
BOOL
 
bStus
 = 
FALSE
;

79  
bStus
;

80 
	}
}

82 
DRIVER_ERROR
 
	gPÏtfÜmS”viûs
::
	$FromDeviû
 (
BYTE
 *
pR—dBuff
, 
DWORD
 *
wR—dCouÁ
)

84  
NO_ERROR
;

85 
	}
}

87 
DRIVER_ERROR
 
	gPÏtfÜmS”viûs
::
	$ToDeviû
 (cÚ¡ 
BYTE
 *
pBufãr
, 
DWORD
 *
dwCouÁ
)

89 *
dwCouÁ
 = 0;

90  
NO_ERROR
;

91 
	}
}

93 
BOOL
 
	$C»©ePrš‹rPrİ”t›s
 ()

95 
pSys
 = 
Ãw
 
	`PÏtfÜmS”viûs
 ();

96 
pSys
->
IOMode
.
bDevID
 = 
FALSE
;

97 
pSys
->
IOMode
.
bStus
 = 
FALSE
;

98 
pPC
 = 
Ãw
 
	`PrštCÚ‹xt
 (
pSys
);

99 
iLa¡Prš‹r
 = 
MAX_PRINTER_TYPE
;

100  
TRUE
;

101 
	}
}

103 
	$G‘Prš‹rPrİ”t›s
 (
Prš‹rPrİ”t›s
 *
pPrš‹rPrİ”t›s
)

105 
BOOL
 
bResuÉ
 = 
TRUE
;

106 
i
;

107 
DRIVER_ERROR
 
”r
;

108 ià(
pPrš‹rPrİ”t›s
 =ğ
NULL
)

110  
FALSE
;

112 ià(
pSys
 =ğ
NULL
)

114 
bResuÉ
 = 
	`C»©ePrš‹rPrİ”t›s
 ();

115 ià(
bResuÉ
 =ğ
FALSE
)

117  (è
bResuÉ
;

123 
iCu¼’tPrš‹r
++;

124 ià(
iCu¼’tPrš‹r
 =ğ
iLa¡Prš‹r
)

126 ià(
pPC
)

128 
d–‘e
 
pPC
;

130 ià(
pSys
)

132 
d–‘e
 
pSys
;

134  
FALSE
;

136 
”r
 = 
pPC
->
	`S–eùDeviû
 ((
PRINTER_TYPE
è
iCu¼’tPrš‹r
);

137 ià(
”r
 !ğ
NO_ERROR
)

139 ià(
iCu¼’tPrš‹r
 < 
iLa¡Prš‹r
)

143 
d–‘e
 
pPC
;

144 
d–‘e
 
pSys
;

145  
FALSE
;

147 
	`¡rıy
 (
pPrš‹rPrİ”t›s
->
szCÏssName
, 
Mod–Name
[
iCu¼’tPrš‹r
]);

148 
i
 = 0; i < (è( (
P­”SizeInfoD©a
è/  (
P­”SizeInfo
)); i++)

150 
”r
 = 
pPC
->
	`S‘P­”Size
 (
P­”SizeInfoD©a
[
i
].
iP­”Size
, 0);

151 ià(
”r
 =ğ
WARN_ILLEGAL_PAPERSIZE
)

155 
	`¡rıy
 (
pPrš‹rPrİ”t›s
->
szP­”Size
, 
P­”SizeInfoD©a
[
i
].
szName
);

156 
pPrš‹rPrİ”t›s
->
fPhysiÿlWidth
 = 
pPC
->
	`PhysiÿlPageSizeX
 ();

157 
pPrš‹rPrİ”t›s
->
fPhysiÿlHeight
 = 
pPC
->
	`PhysiÿlPageSizeY
 ();

158 
pPrš‹rPrİ”t›s
->
fPršbËWidth
 = 
pPC
->
	`PršbËWidth
 ();

159 
pPrš‹rPrİ”t›s
->
fPršbËHeight
 = 
pPC
->
	`PršbËHeight
 ();

160 
pPrš‹rPrİ”t›s
->
fTİLeáX
 = 
pPC
->
	`PršbËS¹X
 ();

161 
pPrš‹rPrİ”t›s
->
fTİLeáY
 = 
pPC
->
	`PršbËS¹Y
 ();

163 
	`årštf
 (
¡dout
, "%s,%s,%.4f,%.4f,%.4f,%.4f,%.4f,%.4f\n",

164 
pPrš‹rPrİ”t›s
->
szCÏssName
,

165 
pPrš‹rPrİ”t›s
->
szP­”Size
,

166 
pPrš‹rPrİ”t›s
->
fPhysiÿlWidth
,

167 
pPrš‹rPrİ”t›s
->
fPhysiÿlHeight
,

168 
pPrš‹rPrİ”t›s
->
fTİLeáX
,

169 
pPrš‹rPrİ”t›s
->
fTİLeáY
,

170 
pPrš‹rPrİ”t›s
->
fPršbËWidth
,

171 
pPrš‹rPrİ”t›s
->
fPršbËHeight
);

175 
	}
}

177 
	$maš
 ()

179 
Prš‹rPrİ”t›s
 
pPrPrİ
;

180 
	`G‘Prš‹rPrİ”t›s
 (&
pPrPrİ
);

182 
	}
}

	@prnt/hpijs/PrinterProperties.h

28 
	~<¡dio.h
>

30 
	~"hµršpi.h
"

32 
APDK_USING_NAMESPACE


34 şas 
	cPÏtfÜmS”viûs
 : 
public
 
Sy¡emS”viûs


36 
public
:

37 
PÏtfÜmS”viûs
 ();

38 ~
PÏtfÜmS”viûs
 ();

39 
Di¥ÏyPrš‹rStus
 (
DISPLAY_STATUS
 
ePrš‹rStus
);

40 
DRIVER_ERROR
 
BusyWa™
 (
DWORD
 
m£c
);

41 
DRIVER_ERROR
 
R—dDeviûID
 (
BYTE
 *
¡rID
, 
iSize
);

42 
BYTE
 *
AÎocMem
 (
iMemSize
);

43 
F»eMem
 (
BYTE
* 
pMem
);

44 
BOOL
 
G‘StusInfo
 (
BYTE
 *
bStReg
);

45 
DRIVER_ERROR
 
ToDeviû
 (cÚ¡ 
BYTE
 *
pBufãr
, 
DWORD
 *
dwCouÁ
);

46 
DRIVER_ERROR
 
FromDeviû
 (
BYTE
 *
pR—dBuff
, 
DWORD
 *
wR—dCouÁ
);

47 
DWORD
 
G‘Sy¡emTickCouÁ
 ();

48 
pow”
 (
x
, 
y
);

53 
PAPER_SIZE
 
	miP­”Size
;

54 cÚ¡ *
	mszName
;

55 } 
	tP­”SizeInfo
;

57 
P­”SizeInfo
 
	gP­”SizeInfoD©a
[] =

59 {
LETTER
, "Letter"},

60 {
LEGAL
, "Legal"},

61 {
EXECUTIVE
, "Executive"},

62 {
A3
, "A3"},

63 {
A4
, "A4"},

64 {
A5
, "A5"},

65 {
A6
, "A6"},

66 {
PHOTO_SIZE
, "Photo"},

67 {
PHOTO_5x7
, "5x7"},

68 {
B4
, "B4"},

69 {
B5
, "B5"},

70 {
OUFUKU
, "Oufuku-Hagaki"},

71 {
HAGAKI
, "Hagaki"},

72 {
SUPERB_SIZE
, "Super B"},

73 {
FLSA
, "Flsa"},

74 {
ENVELOPE_NO_10
, "Number 10 Envelope"},

75 {
ENVELOPE_A2
, "A2 Envelope"},

76 {
ENVELOPE_C6
, "C6 Envelope"},

77 {
ENVELOPE_DL
, "DL Envelope"},

78 {
ENVELOPE_JPN3
, "Japanese Envelope #3"},

79 {
ENVELOPE_JPN4
, "Japanese Envelope #4"}

84 
	mszCÏssName
[16];

85 
	mszP­”Size
[32];

86 
	mfPhysiÿlWidth
;

87 
	mfPhysiÿlHeight
;

88 
	mfPršbËWidth
;

89 
	mfPršbËHeight
;

90 
	mfTİLeáX
;

91 
	mfTİLeáY
;

92 } 
	tPrš‹rPrİ”t›s
;

94 
PÏtfÜmS”viûs
 *
	gpSys
 = 
NULL
;

95 
PrštCÚ‹xt
 *
	gpPC
 = 
NULL
;

96 
BOOL
 
C»©ePrš‹rPrİ”t›s
 ();

97 
	giCu¼’tPrš‹r
 = 
UNSUPPORTED
;

98 
	giPrš‹rCÏs£s
[
MAX_PRINTER_TYPE
];

99 
	giLa¡Prš‹r
 = 0;

102 *
	gszP­”SizeNames
[] =

	@prnt/hpijs/apollo21xx.cpp

31 #ifdeà
APDK_APOLLO21XX


33 
	~"h—d”.h
"

34 
	~"­Şlo2xxx.h
"

35 
	~"­Şlo21xx.h
"

36 
	~"´š‹½roxy.h
"

38 
APDK_BEGIN_NAMESPACE


43 
	gApŞlo21xx
::
	$ApŞlo21xx
(
Sy¡emS”viûs
* 
pSS
, 
BOOL
 
´Ùo
)

44 : 
	$ApŞlo2xxx
(
pSS
,
´Ùo
)

47 
eP’
=
COLOR_PEN
;

49 
PrštMode
* 
pm
 = 
pMode
[
DEFAULTMODE_INDEX
];

50 
pMode
[
DEFAULTMODE_INDEX
] =…Mode[
SPECIALMODE_INDEX
];

51 
pMode
[
SPECIALMODE_INDEX
] = 
pm
;

52 
	}
}

54 
DRIVER_ERROR
 
	gApŞlo21xx
::
	$P¬£P’Info
(
PEN_TYPE
& 
eP’
, 
BOOL
 
Qu”yPrš‹r
)

58 
eP’
=
COLOR_PEN
;

59  
NO_ERROR
;

60 
	}
}

62 
	gH—d”21xx
::
	$H—d”21xx
(
Prš‹r
* 
p
,
PrštCÚ‹xt
* 
pc
)

63 : 
	$H—d”
(
p
,
pc
)

64 { 
	}
}

66 
H—d”
* 
	gApŞlo21xx
::
	$S–eùH—d”
(
PrštCÚ‹xt
* 
pc
)

68  
Ãw
 
	`H—d”21xx
(
this
,
pc
);

69 
	}
}

71 
DRIVER_ERROR
 
	gH—d”21xx
::
	$S’d
()

72 { 
DRIVER_ERROR
 
”r
;

74 
	`S¹S’d
();

79 
”r
 = 
thePrš‹r
->
	`S’d
((cÚ¡ 
BYTE
*)
BÏckExŒaùOff
,

80 (
BÏckExŒaùOff
));

81 
ERRCHECK
;

83 
”r
 = 
	`CÚfigu»Ra¡”D©a
();

84 
ERRCHECK
;

86 ià(
ResŞutiÚY
[0] == 600)

88 
uom
[10];

89 
	`¥rštf
(
uom
,"%c%c%c%d%c",
ESC
,'&','u',
thePrštMode
->
ResŞutiÚY
[
K
],'D');

90 
”r
=
thePrš‹r
->
	`S’d
((cÚ¡ 
BYTE
*)
uom
, 7 );

91 
ERRCHECK
;

94 
”r
=
	`G¿phics
();

96  
”r
;

97 
	}
}

99 
	gAPDK_END_NAMESPACE


	@prnt/hpijs/apollo21xx.h

32 #iâdeà
APDK_APOLLO21xx_H


33 
	#APDK_APOLLO21xx_H


	)

35 
APDK_BEGIN_NAMESPACE


40 şas 
	cApŞlo21xx
 : 
public
 
ApŞlo2xxx


42 
public
:

43 
ApŞlo21xx
(
Sy¡emS”viûs
* 
pSS
, 
BOOL
 
´Ùo
=
FALSE
);

44 
H—d”
* 
S–eùH—d”
(
PrštCÚ‹xt
* 
pc
);

45 
vœtu®
 
DRIVER_ERROR
 
P¬£P’Info
(
PEN_TYPE
& 
eP’
, 
BOOL
 
Qu”yPrš‹r
=
TRUE
);

49 #ifdeà
APDK_APOLLO21XX


53 şas 
	cApŞlo21xxProxy
 : 
public
 
Prš‹rProxy


55 
public
:

56 
	$ApŞlo21xxProxy
(è: 
	`Prš‹rProxy
(

59 è{
m_iPrš‹rTy³
 = 
eAP21xx
;}

60 
šlše
 
Prš‹r
* 
	$C»©ePrš‹r
(
Sy¡emS”viûs
* 
pSS
ècÚ¡ {  
Ãw
 
	`ApŞlo21xx
ÕSS); 
	}
}

61 
šlše
 
PRINTER_TYPE
 
	$G‘Prš‹rTy³
(ècÚ¡ {  
eAP21xx
;
	}
}

62 
šlše
 
	$G‘Mod–B™
(ècÚ¡ {  0x2000;
	}
}

66 
	gAPDK_END_NAMESPACE


	@prnt/hpijs/apollo2560.cpp

32 #ifdeà
APDK_APOLLO2560


34 
	~"h—d”.h
"

35 
	~"­Şlo2xxx.h
"

36 
	~"­Şlo2560.h
"

37 
	~"´š‹½roxy.h
"

39 
APDK_BEGIN_NAMESPACE


41 
	gApŞlo2560
::
	$ApŞlo2560
(
Sy¡emS”viûs
* 
pSS
, 
BOOL
 
´Ùo
)

42 : 
	$ApŞlo2xxx
(
pSS
,
´Ùo
)

46 
PrštMode
* 
pm
 = 
pMode
[
DEFAULTMODE_INDEX
];

47 
pMode
[
DEFAULTMODE_INDEX
] =…Mode[
SPECIALMODE_INDEX
];

48 
pMode
[
SPECIALMODE_INDEX
] = 
pm
;

49 
	}
}

51 
	gAPDK_END_NAMESPACE


	@prnt/hpijs/apollo2560.h

32 #iâdeà
APDK_APOLLO2560_H


33 
	#APDK_APOLLO2560_H


	)

35 
APDK_BEGIN_NAMESPACE


40 şas 
	cApŞlo2560
 : 
public
 
ApŞlo2xxx


42 
public
:

43 
ApŞlo2560
(
Sy¡emS”viûs
* 
pSS
, 
BOOL
 
´Ùo
=
FALSE
);

47 #ifdeà
APDK_APOLLO2560


51 şas 
	cApŞlo2560Proxy
 : 
public
 
Prš‹rProxy


53 
public
:

54 
	$ApŞlo2560Proxy
(è: 
	`Prš‹rProxy
(

57 è{
m_iPrš‹rTy³
 = 
eAP2560
;}

58 
šlše
 
Prš‹r
* 
	$C»©ePrš‹r
(
Sy¡emS”viûs
* 
pSS
ècÚ¡ {  
Ãw
 
	`ApŞlo2560
ÕSS); 
	}
}

59 
šlše
 
PRINTER_TYPE
 
	$G‘Prš‹rTy³
(ècÚ¡ {  
eAP2560
;
	}
}

60 
šlše
 
	$G‘Mod–B™
(ècÚ¡ {  0x1000;
	}
}

64 
	gAPDK_END_NAMESPACE


	@prnt/hpijs/apollo2xxx.cpp

32 #ifdeà
APDK_APOLLO2XXX


34 
	~"h—d”.h
"

35 
	~"­Şlo2xxx.h
"

36 
	~"´š‹½roxy.h
"

38 
APDK_BEGIN_NAMESPACE


40 
ušt32_t
 
ulM­DJ690_CMYK
[ 9 * 9 * 9 ];

41 
ušt32_t
 
ulM­DJ690_ClMlxx
[ 9 * 9 * 9 ];

42 
ušt32_t
 
ulM­DJ660_CCM_KCMY
[ 9 * 9 * 9 ];

43 
ušt32_t
 
ulM­DJ600_CCM_K
[ 9 * 9 * 9 ];

44 
ušt32_t
 
ulM­DJ600_CCM_CMY
[ 9 * 9 * 9 ];

46 
	gApŞlo2xxx
::
	$ApŞlo2xxx
(
Sy¡emS”viûs
* 
pSS
, 
BOOL
 
´Ùo
)

47 : 
	$Prš‹r
(
pSS
, 
NUM_DJ6XX_FONTS
,
´Ùo
)

50 ià((!
´Ùo
è&& (
IOMode
.
bDevID
))

52 
cÚ¡ruùÜ_”rÜ
 = 
	`V”ifyP’Info
();

53 
CERRCHECK
;

55 
eP’
=
BOTH_PENS
;

57 
CMYM­
 = 
ulM­DJ600_CCM_CMY
;

59 
pMode
[
DEFAULTMODE_INDEX
] = 
Ãw
 
	`PrštMode
(
ulM­DJ660_CCM_KCMY
);

60 
pMode
[
SPECIALMODE_INDEX
] = 
Ãw
 
	`Mode2xxxCŞÜ
();

61 
pMode
[
SPECIALMODE_INDEX
+1] = 
Ãw
 
	`Mode2xxxPhÙo
();

62 
pMode
[
GRAYMODE_INDEX
] = 
Ãw
 
	`G¿yMode2xxx
();

63 #ifdeà
APDK_EXTENDED_MEDIASIZE


64 
pMode
[
SPECIALMODE_INDEX
+2] = 
Ãw
 
	`Mode2xxxD¿áG¿yK
();

65 
pMode
[
SPECIALMODE_INDEX
+3] = 
Ãw
 
	`Mode2xxxD¿áCŞÜKCMY
();

66 
pMode
[
SPECIALMODE_INDEX
+4] = 
Ãw
 
	`Mode2xxxD¿áCŞÜCMY
();

67 
pMode
[
SPECIALMODE_INDEX
+5] = 
Ãw
 
	`Mode2xxxBe¡G¿yK
();

68 
ModeCouÁ
=8;

70 
ModeCouÁ
 = 4;

73 
	`DBG1
("AP2xxx created\n");

75 
	}
}

77 
DRIVER_ERROR
 
	gApŞlo2xxx
::
	$V”ifyP’Info
()

79 
DRIVER_ERROR
 
”r
=
NO_ERROR
;

81 if(
IOMode
.
bDevID
 =ğ
FALSE
)

82  
”r
;

84 
”r
 = 
	`P¬£P’Info
(
eP’
);

85 
ERRCHECK
;

88 ià(
eP’
 =ğ
BOTH_PENS
 ||ƒP’ =ğ
MDL_BOTH
 ||ƒP’ =ğ
COLOR_PEN
 ||ƒP’ =ğ
BLACK_PEN
)

89  
NO_ERROR
;

91 
	`DBG1
("Apollo2xxx::VerifyPenInfo():ƒPen is‚ot BOTH_PENS, MDL_BOTH, COLOR_PEN, or BLACK_PEN\n");

95  (
eP’
 !ğ
BOTH_PENS
è&& (eP’ !ğ
MDL_BOTH
è&& (eP’ !ğ
COLOR_PEN
è&& (eP’ !ğ
BLACK_PEN
))

97 
	`DBG1
("Apollo2xxx::VerifyPenInfo(): in while†oop\n");

99 
eP’
)

101 
MDL_PEN
:

103 
pSS
->
	`Di¥ÏyPrš‹rStus
(
DISPLAY_NO_COLOR_PEN
);

105 
NO_PEN
:

108 
pSS
->
	`Di¥ÏyPrš‹rStus
(
DISPLAY_NO_PENS
);

112 ià(
pSS
->
	`BusyWa™
(500è=ğ
JOB_CANCELED
)

113  
JOB_CANCELED
;

115 
”r
 = 
	`P¬£P’Info
(
eP’
);

116 
ERRCHECK
;

119 
pSS
->
	`Di¥ÏyPrš‹rStus
(
DISPLAY_PRINTING
);

121  
NO_ERROR
;

123 
	}
}

125 
DRIVER_ERROR
 
	gApŞlo2xxx
::
	$P¬£P’Info
(
PEN_TYPE
& 
eP’
, 
BOOL
 
Qu”yPrš‹r
)

127 * 
¡r
;

128 
DRIVER_ERROR
 
”r
 = 
	`S‘P’Info
(
¡r
, 
Qu”yPrš‹r
);

129 
ERRCHECK
;

131 ià(*
¡r
 != '$')

133  
BAD_DEVICE_ID
;

136 
¡r
++;

138 
PEN_TYPE
 
‹mp_³n1
;

140 
¡r
[0])

143 'M': 
‹mp_³n1
 = 
MDL_PEN
; ;

144 'C': 
‹mp_³n1
 = 
BLACK_PEN
; ;

145 : 
‹mp_³n1
 = 
NO_PEN
; ;

150 
i
 = 2;

151 
i
 < 
DevIDBuffSize
 && 
¡r
[i]!='$') i++;

153 ià(
i
 =ğ
DevIDBuffSize
)

155  
BAD_DEVICE_ID
;

158 
i
++;

160 if(
¡r
[
i
]=='R')

163 ià(
‹mp_³n1
 =ğ
BLACK_PEN
)

164 
eP’
 = 
BOTH_PENS
;

167 ià(
‹mp_³n1
 =ğ
MDL_PEN
)

168 
eP’
 = 
MDL_BOTH
;

170 
eP’
 = 
COLOR_PEN
;

174 
eP’
 = 
‹mp_³n1
;

176  
NO_ERROR
;

177 
	}
}

180 
	gMode2xxxPhÙo
::
	$Mode2xxxPhÙo
()

182 : 
	$PrštMode
(
ulM­DJ690_CMYK
,
ulM­DJ690_ClMlxx
)

184 
dyeCouÁ
=6;

185 
medium
 = 
medŸS³cŸl
;

186 
theQu®™y
 = 
qu®™yNÜm®
;

188 
pmQu®™y
=
QUALITY_BEST
;

189 
pmMedŸTy³
=
MEDIA_PREMIUM
;

192 
Ba£ResX
 = 600;

193 
i
=0; i < 6; i++)

194 
ResŞutiÚX
[
i
]=600;

196 
Com·tibËP’s
[0] = 
MDL_BOTH
;

200 
	}
}

202 
	gMode2xxxCŞÜ
::
	$Mode2xxxCŞÜ
()

203 : 
	$PrštMode
(
ulM­DJ600_CCM_CMY
)

205 
dyeCouÁ
=3;

206 
Com·tibËP’s
[0] = 
COLOR_PEN
;

209 
	}
}

211 
	gG¿yMode2xxx
::
	$G¿yMode2xxx
()

213 : 
	$PrštMode
Ğ
ulM­DJ600_CCM_K
 )

215 
Com·tibËP’s
[1] = 
MDL_BOTH
;

217 
pmCŞÜ
=
GREY_K
;

218 
dyeCouÁ
=1;

220 
	}
}

222 #ifdeà
APDK_EXTENDED_MEDIASIZE


223 
	gMode2xxxD¿áCŞÜKCMY
::
	$Mode2xxxD¿áCŞÜKCMY
()

224 : 
	$PrštMode
Ğ
ulM­DJ660_CCM_KCMY
 )

226 
theQu®™y
 = 
qu®™yD¿á
;

227 
CÚfig
.
eHT
 = 
MATRIX
;

228 
pmQu®™y
 = 
QUALITY_DRAFT
;

229 
	}
}

231 
	gMode2xxxD¿áG¿yK
::
	$Mode2xxxD¿áG¿yK
()

232 : 
	$PrštMode
(
ulM­DJ600_CCM_K
)

234 
Com·tibËP’s
[1] = 
MDL_BOTH
;

235 
pmCŞÜ
=
GREY_K
;

236 
dyeCouÁ
=1;

237 
theQu®™y
 = 
qu®™yD¿á
;

238 
pmQu®™y
 = 
QUALITY_DRAFT
;

239 
	}
}

241 
	gMode2xxxD¿áCŞÜCMY
::
	$Mode2xxxD¿áCŞÜCMY
()

242 : 
	$PrštMode
Ğ
ulM­DJ600_CCM_CMY
 )

244 
dyeCouÁ
=3;

245 
Com·tibËP’s
[0] = 
COLOR_PEN
;

246 
theQu®™y
 = 
qu®™yD¿á
;

247 
pmQu®™y
 = 
QUALITY_DRAFT
;

248 
	}
}

250 
	gMode2xxxBe¡G¿yK
::
	$Mode2xxxBe¡G¿yK
()

251 : 
	$G¿yMode
(
ulM­DJ600_CCM_K
)

253 
theQu®™y
 = 
qu®™yP»£Á©iÚ
;

254 
pmQu®™y
 = 
QUALITY_BEST
;

255 
Ba£ResX
 = 
Ba£ResY
 = 600;

256 
ResŞutiÚX
[0] = 
ResŞutiÚY
[0] = 600;

257 
	}
}

260 
	gH—d”2xxx
::
	$H—d”2xxx
(
Prš‹r
* 
p
,
PrštCÚ‹xt
* 
pc
)

261 : 
	$H—d”
(
p
,
pc
)

262 { 
	}
}

265 
H—d”
* 
	gApŞlo2xxx
::
	$S–eùH—d”
(
PrštCÚ‹xt
* 
pc
)

267  
Ãw
 
	`H—d”2xxx
(
this
,
pc
);

268 
	}
}

270 
DRIVER_ERROR
 
	gH—d”2xxx
::
	$S’d
()

271 { 
DRIVER_ERROR
 
”r
;

273 
	`S¹S’d
();

279 ià(
thePrštMode
->
dyeCouÁ
 != 3)

281 
”r
 = 
thePrš‹r
->
	`S’d
((cÚ¡ 
BYTE
*)
BÏckExŒaùOff
,

282 (
BÏckExŒaùOff
));

283 
ERRCHECK
;

286 
”r
 = 
	`CÚfigu»Ra¡”D©a
();

287 
ERRCHECK
;

289 ià(
ResŞutiÚY
[0] == 600)

291 
uom
[10];

292 
	`¥rštf
(
uom
,"%c%c%c%d%c",
ESC
,'&','u',
thePrštMode
->
ResŞutiÚY
[
K
],'D');

293 
”r
=
thePrš‹r
->
	`S’d
((cÚ¡ 
BYTE
*)
uom
, 7 );

294 
ERRCHECK
;

297 
”r
=
	`G¿phics
();

299  
”r
;

300 
	}
}

302 
	gAPDK_END_NAMESPACE


	@prnt/hpijs/apollo2xxx.h

32 #iâdeà
APDK_APOLLO2xxx_H


33 
	#APDK_APOLLO2xxx_H


	)

35 
APDK_BEGIN_NAMESPACE


39 şas 
	cApŞlo2xxx
 : 
public
 
Prš‹r


41 
public
:

42 
ApŞlo2xxx
(
Sy¡emS”viûs
* 
pSS
, 
BOOL
 
´Ùo
=
FALSE
);

44 
H—d”
* 
S–eùH—d”
(
PrštCÚ‹xt
* 
pc
);

45 
vœtu®
 
DRIVER_ERROR
 
V”ifyP’Info
();

46 
vœtu®
 
DRIVER_ERROR
 
P¬£P’Info
(
PEN_TYPE
& 
eP’
, 
BOOL
 
Qu”yPrš‹r
=
TRUE
);

47 
vœtu®
 
BOOL
 
	$G‘M¬gšs
 (
PAPER_SIZE
 
ps
, *
fM¬gšs
)

49 ià(
ps
 =ğ
A4
)

50 
fM¬gšs
[0] = () 0.135;

52 
fM¬gšs
[0] = () 0.25;

53 
fM¬gšs
[1] = fMargins[0];

54 
fM¬gšs
[2] = () 0.125;

55 
fM¬gšs
[3] = () 0.67;

56  
TRUE
;

59 #ifdeà
APDK_HP_UX


60 
´Ùeùed
:

61 
vœtu®
 
ApŞlo2xxx
 & 
İ”©Ü
 = (
Prš‹r
 &
rhs
)

63  *
this
;

64 
	}
}

70 şas 
	cMode2xxxPhÙo
 : 
public
 
PrštMode


72 
public
:

73 
Mode2xxxPhÙo
();

77 şas 
	cMode2xxxCŞÜ
 : 
public
 
PrštMode


79 
public
:

80 
Mode2xxxCŞÜ
();

85 şas 
	cG¿yMode2xxx
 : 
public
 
PrštMode


87 
public
:

88 
G¿yMode2xxx
();

91 #ifdeà
APDK_EXTENDED_MEDIASIZE


92 şas 
	cMode2xxxD¿áG¿yK
 : 
public
 
PrštMode


94 
public
:

95 
Mode2xxxD¿áG¿yK
();

98 şas 
	cMode2xxxD¿áCŞÜKCMY
 : 
public
 
PrštMode


100 
public
:

101 
Mode2xxxD¿áCŞÜKCMY
();

104 şas 
	cMode2xxxD¿áCŞÜCMY
 : 
public
 
PrštMode


106 
public
:

107 
Mode2xxxD¿áCŞÜCMY
();

110 şas 
	cMode2xxxBe¡G¿yK
 : 
public
 
G¿yMode


112 
public
:

113 
Mode2xxxBe¡G¿yK
();

117 #ifdeà
APDK_APOLLO2XXX


121 şas 
	cApŞlo2xxxProxy
 : 
public
 
Prš‹rProxy


123 
public
:

124 
	$ApŞlo2xxxProxy
(è: 
	`Prš‹rProxy
(

127 è{
m_iPrš‹rTy³
 = 
eAP2xxx
;}

128 
šlše
 
Prš‹r
* 
	$C»©ePrš‹r
(
Sy¡emS”viûs
* 
pSS
ècÚ¡ {  
Ãw
 
	`ApŞlo2xxx
ÕSS); 
	}
}

129 
šlše
 
PRINTER_TYPE
 
	$G‘Prš‹rTy³
(ècÚ¡ {  
eAP2xxx
;
	}
}

130 
šlše
 
	$G‘Mod–B™
(ècÚ¡ {  0x4000;
	}
}

134 
	gAPDK_END_NAMESPACE


	@prnt/hpijs/breaks_open.cpp

31 
	~"cÚfig.h
"

32 
	~"»sourûs.h
"

34 
APDK_BEGIN_NAMESPACE


36 cÚ¡ 
	gHTBš¬y_İ’
[1024]=

296 cÚ¡ 
	gHT300x3004Ëv–_İ’
[1024]=

556 cÚ¡ 
	gHT600x6004Ëv–895_İ’
[1024]=

816 cÚ¡ 
	gHT300x3004Ëv–970_İ’
[1024]=

1077 cÚ¡ 
	gHT600x6004Ëv–970_İ’
[1024]=

1338 cÚ¡ 
	gHT600x6004Ëv–3600_İ’
[1024]=

1598 #ifdeà
APDK_EXTENDED_MEDIASIZE


1601 cÚ¡ 
	gHT1200x1200x1_PhÙoP»s970_İ’
[1024]=

1862 cÚ¡ 
	gHT600x600x4_P»s970_İ’
[1024]=

2123 #ifdeà
APDK_DJ3320


2124 cÚ¡ 
	gHT1200x1200x1PhÙoBe¡_İ’
[1024] =

2386 
	gAPDK_END_NAMESPACE


	@prnt/hpijs/bug.h

33 #iâdeà
_BUG_H


34 
	#_BUG_H


	)

36 #iâdeà
_GNU_SOURCE


37 
	#_GNU_SOURCE


	)

40 
	#ADDITIONAL_LOG
 1

	)

41 
	#SAVE_PCL_FILE
 2

	)

42 
	#SAVE_INPUT_RASTERS
 4

	)

43 
	#SEND_TO_PRINTER
 8

	)

45 
	~<sy¦og.h
>

46 
	~<¡dio.h
>

48 
	#_STRINGIZE
(
x
è#x

	)

49 
	#STRINGIZE
(
x
è
	`_STRINGIZE
(x)

	)

51 
	#BUG
(
¬gs
...è{
	`sy¦og
(
LOG_ERR
, 
__FILE__
 " " 
	`STRINGIZE
(
__LINE__
) ": "‡rgs); \

52 
	`årštf
(
¡d”r
, 
__FILE__
 " " 
	`STRINGIZE
(
__LINE__
è": " 
¬gs
);}

	)

54 
	#DBG_DUMP
(
d©a
, 
size
è
	`sysdump
((d©a), (size))

	)

56 
	#DBG6
(
¬gs
...è
	`DBG
(6, 
__FILE__
 " " 
	`STRINGIZE
(
__LINE__
è": "‡rgs)

	)

57 
	#DBG8
(
¬gs
...è
	`DBG
(8, 
__FILE__
 " " 
	`STRINGIZE
(
__LINE__
è": "‡rgs)

	)

58 
	#DBG_SZ
(
¬gs
...è
	`DBG
(6,‡rgs)

	)

60 
	#DBG6
(
¬gs
...è
	`sy¦og
(
LOG_INFO
, 
__FILE__
 " " 
	`STRINGIZE
(
__LINE__
è": "‡rgs)

	)

61 
	#DBG8
(
¬gs
...è
	`sy¦og
(
LOG_INFO
, 
__FILE__
 " " 
	`STRINGIZE
(
__LINE__
è": "‡rgs)

	)

62 
	#DBG_SZ
(
¬gs
...è
	`sy¦og
(
LOG_INFO
,‡rgs)

	)

	@prnt/hpijs/capture.cpp

32 #ifdeà
APDK_CAPTURE


33 
	~"h—d”.h
"

34 
	~"süt.h
"

36 
APDK_BEGIN_NAMESPACE


42 
	gPrštCÚ‹xt
::
	$C­tu»_PrštCÚ‹xt
(
IÅutPix–sP”Row
,

43 
OuutPix–sP”Row
,

44 
PAPER_SIZE
 
ps
,

45 
IO_MODE
 
IOMode
)

48 ià(! 
pSS
->
C­turšg
)

51 
Sü‹r
 *
pS
 = 
pSS
->
pSü‹r
;

53 
pS
->
	`PutDebugTok’
(
tokPrštCÚ‹xt
);

54 
pS
->
	`PutDebugIÁ
(
IÅutPix–sP”Row
);

55 
pS
->
	`PutDebugIÁ
(
OuutPix–sP”Row
);

56 
pS
->
	`PutDebugBy‹
(
ps
);

57 
pS
->
	`PutDebugBy‹
(
IOMode
.
bDevID
);

58 
pS
->
	`PutDebugBy‹
(
IOMode
.
bStus
);

59 ià(!
IOMode
.
bDevID
)

63 
pS
->
	`PutDebugSŒšg
((cÚ¡ *)
pSS
->
¡rMod–
,
	`¡¾’
(pSS->strModel));

64 
pS
->
	`PutDebugSŒšg
((cÚ¡ *)
pSS
->
¡rP’s
,
	`¡¾’
(pSS->strPens));

66 
	}
}

69 
	gPrštCÚ‹xt
::
	$C­tu»_R—lizeFÚt
(cÚ¡ 
±r
,

70 cÚ¡ 
šdex
,

71 cÚ¡ 
BYTE
 
bSize
,

72 cÚ¡ 
TEXTCOLOR
 
eCŞÜ
,

73 cÚ¡ 
BOOL
 
bBŞd
,

74 cÚ¡ 
BOOL
 
bIlic
,

75 cÚ¡ 
BOOL
 
bUnd”lše
)

78 ià(! 
pSS
->
C­turšg
)

81 
Sü‹r
 *
pS
 = 
pSS
->
pSü‹r
;

83 
pS
->
	`PutDebugTok’
(
tokR—lizeFÚt
);

84 
pS
->
	`PutDebugIÁ
(
±r
);

85 
pS
->
	`PutDebugBy‹
(
šdex
);

86 
pS
->
	`PutDebugBy‹
(
bSize
);

87 
pS
->
	`PutDebugBy‹
(
eCŞÜ
);

88 
pS
->
	`PutDebugBy‹
(
bBŞd
);

89 
pS
->
	`PutDebugBy‹
(
bIlic
);

90 
pS
->
	`PutDebugBy‹
(
bUnd”lše
);

92 
	}
}

94 
	gPrštCÚ‹xt
::
	$C­tu»_S‘Pix–sP”Row
(
IÅutPix–sP”Row
,

95 
OuutPix–sP”Row
)

98 ià(! 
pSS
->
C­turšg
)

101 
Sü‹r
 *
pS
 = 
pSS
->
pSü‹r
;

103 
pS
->
	`PutDebugTok’
(
tokS‘Pix–sP”Row
);

104 
pS
->
	`PutDebugIÁ
(
IÅutPix–sP”Row
);

105 
pS
->
	`PutDebugIÁ
(
OuutPix–sP”Row
);

106 
	}
}

108 
	gPrštCÚ‹xt
::
	$C­tu»_S‘IÅutResŞutiÚ
(
Res
)

111 ià(! 
pSS
->
C­turšg
)

114 
Sü‹r
 *
pS
 = 
pSS
->
pSü‹r
;

116 
pS
->
	`PutDebugTok’
(
tokS‘Res
);

117 
pS
->
	`PutDebugIÁ
(
Res
);

119 
	}
}

122 
	gPrštCÚ‹xt
::
	$C­tu»_S–eùDeviû
(cÚ¡ 
PRINTER_TYPE
 
Mod–
)

125 ià(! 
pSS
->
C­turšg
)

128 
Sü‹r
 *
pS
 = 
pSS
->
pSü‹r
;

130 
pS
->
	`PutDebugTok’
(
tokS–eùDeviû
);

131 
pS
->
	`PutDebugBy‹
(
Mod–
);

133 
	}
}

136 
	gPrštCÚ‹xt
::
	$C­tu»_S–eùDeviû
(cÚ¡ * 
szDevIdSŒšg
)

138 ià(! 
pSS
->
C­turšg
)

141 
Sü‹r
 *
pS
 = 
pSS
->
pSü‹r
;

143 
pS
->
	`PutDebugTok’
(
tokS–eùDeviû
);

144 
pS
->
	`PutDebugSŒšg
(
szDevIdSŒšg
, 
	`¡¾’
(szDevIdString));

145 
	}
}

148 
	gPrštCÚ‹xt
::
	$C­tu»_S–eùPrštMode
(
mod’um
)

151 ià(! 
pSS
->
C­turšg
)

154 
Sü‹r
 *
pS
 = 
pSS
->
pSü‹r
;

156 
pS
->
	`PutDebugTok’
(
tokS–eùPrštMode
);

157 
pS
->
	`PutDebugBy‹
(
mod’um
);

158 
	}
}

160 
	gPrštCÚ‹xt
::
	$C­tu»_S‘P­”Size
(
PAPER_SIZE
 
ps
, 
BOOL
 
bFuÎBËed
)

163 ià(! 
pSS
->
C­turšg
)

166 
Sü‹r
 *
pS
 = 
pSS
->
pSü‹r
;

168 
pS
->
	`PutDebugTok’
(
tokS‘P­”Size
);

169 
pS
->
	`PutDebugBy‹
(
ps
);

170 
pS
->
	`PutDebugBy‹
 (
bFuÎBËed
);

171 
	}
}

176 
	gJob
::
	$C­tu»_Job
(
PrštCÚ‹xt
* 
pPC
)

179 ià(! 
thePrštCÚ‹xt
->
pSS
->
C­turšg
)

182 
Sü‹r
 *
pS
 = 
thePrštCÚ‹xt
->
pSS
->
pSü‹r
;

184 
pS
->
	`PutDebugTok’
(
tokJob
);

186 
	}
}

188 
	gJob
::
	$C­tu»_S’dRa¡”s
(
BYTE
* 
BÏckImageD©a
, BYTE* 
CŞÜImageD©a
)

191 ià(! 
thePrštCÚ‹xt
->
pSS
->
C­turšg
)

194 
Sü‹r
 *
pS
 = 
thePrštCÚ‹xt
->
pSS
->
pSü‹r
;

196 
pS
->
	`PutDebugTok’
(
tokS’dRa¡”s
);

197 
Ën
=0;

198 ià(
BÏckImageD©a
 !ğ
NULL
)

199 
Ën
ğ(
thePrštCÚ‹xt
->
IÅutWidth
/8) + (thePrintContext->InputWidth%8);

200 
pS
->
	`PutDebugSŒ—m
(
BÏckImageD©a
, 
Ën
);

201 
Ën
 = 0;

202 ià(
CŞÜImageD©a
 !ğ
NULL
)

203 
Ën
ğ
thePrštCÚ‹xt
->
OuutWidth
*3;

204 
pS
->
	`PutDebugSŒ—m
(
CŞÜImageD©a
, 
Ën
);

206 
	}
}

208 #ià
defšed
(
APDK_FONTS_NEEDED
)

209 
	gJob
::
	$C­tu»_TextOut
(cÚ¡ * 
pTextSŒšg
,

210 
iL’SŒšg
,

211 cÚ¡ 
FÚt
& 
fÚt
,

212 
iAbsX
,

213 
iAbsY
)

215 
Sy¡emS”viûs
* 
pSS
 = 
thePrštCÚ‹xt
->pSS;

217 ià(! 
pSS
->
C­turšg
)

220 
Sü‹r
 *
pS
 = 
pSS
->
pSü‹r
;

222 
pS
->
	`PutDebugTok’
(
tokTextOut
);

223 
pS
->
	`PutDebugIÁ
(()&
fÚt
);

224 
pS
->
	`PutDebugSŒšg
(
pTextSŒšg
,
iL’SŒšg
);

225 
pS
->
	`PutDebugIÁ
(
iAbsX
);

226 
pS
->
	`PutDebugIÁ
(
iAbsY
);

227 
	}
}

230 
	gJob
::
	$C­tu»_NewPage
()

232 
Sy¡emS”viûs
* 
pSS
 = 
thePrštCÚ‹xt
->pSS;

233 ià(! 
pSS
->
C­turšg
)

236 
Sü‹r
 *
pS
 = 
pSS
->
pSü‹r
;

238 
pS
->
	`PutDebugTok’
(
tokNewPage
);

240 
	}
}

243 
	gJob
::
	$C­tu»_dJob
()

245 
Sy¡emS”viûs
* 
pSS
 = 
thePrštCÚ‹xt
->pSS;

246 ià(! 
pSS
->
C­turšg
)

249 
Sü‹r
 *
pS
 = 
pSS
->
pSü‹r
;

251 
pS
->
	`PutDebugTok’
(
tokdJob
);

253 
	}
}

255 #ià
defšed
(
APDK_FONTS_NEEDED
)

256 
	gFÚt
::
	$C­tu»_dFÚt
(cÚ¡ 
±r
)

259 ià(
š‹º®
)

261 ià(! 
pSS
->
C­turšg
)

264 
Sü‹r
 *
pS
 = 
pSS
->
pSü‹r
;

266 
pS
->
	`PutDebugTok’
(
tokdFÚt
);

267 
pS
->
	`PutDebugIÁ
(
±r
);

268 
	}
}

271 
	gPrštCÚ‹xt
::
	$C­tu»_dPrštCÚ‹xt
()

274 ià(! 
pSS
->
C­turšg
)

277 
Sü‹r
 *
pS
 = 
pSS
->
pSü‹r
;

279 
pS
->
	`PutDebugTok’
(
tokdPrštCÚ‹xt
);

281 
	}
}

283 
	gAPDK_END_NAMESPACE


	@prnt/hpijs/colormatch.cpp

31 
	~"h—d”.h
"

32 
	~"h±y³s.h
"

33 
	~"cŞÜm©ch.h
"

35 
APDK_BEGIN_NAMESPACE


37 
	gCŞÜM©ch”
::
CŞÜM©ch”


39 
Sy¡emS”viûs
* 
pSys
,

40 
CŞÜM­
 
	gcm
,

41 
	gDyeCouÁ
,

42 
	giIÅutWidth


43 è: 
CŞÜPÏÃCouÁ
(
DyeCouÁ
),

44 
IÅutWidth
(
iIÅutWidth
),

45 
pSS
(
pSys
),

46 
	$cm­
(
cm
)

48 
cÚ¡ruùÜ_”rÜ
 = 
NO_ERROR
;

49 
	`ASSERT
(
cm­
.
ulM­1
 !ğ
NULL
 || cm­.
ulM­3
 != NULL);

51 
S¹PÏÃ
 = 
K
;

53 ià(
CŞÜPÏÃCouÁ
 == 3)

55 
S¹PÏÃ
 = 
C
;

58 
EndPÏÃ
 = 
Y
;

59 ià(
CŞÜPÏÃCouÁ
 == 6)

61 
EndPÏÃ
 = 
Mlight
;

63 ià(
CŞÜPÏÃCouÁ
 == 1)

65 
EndPÏÃ
 = 
K
;

68 
CÚtÚe
 = (
BYTE
*)
pSS
->
	`AÎocMem
(
IÅutWidth
*
CŞÜPÏÃCouÁ
);

69 ià(
CÚtÚe
 =ğ
NULL
)

71 
MemÜyE¼Ü
;

74 
	`Re¡¬t
();

78 
MemÜyE¼Ü
:

79 
cÚ¡ruùÜ_”rÜ
=
ALLOCMEM_ERROR
;

81 
	`F»eBufãrs
();

83 
	}
}

85 
	gCŞÜM©ch”
::~
	$CŞÜM©ch”
()

87 
	`DBG1
("destroying ColorMatcher \n");

89 
	`F»eBufãrs
();

90 
	}
}

93 
	gCŞÜM©ch”
::
	$Re¡¬t
()

96 
	`mem£t
(
CÚtÚe
, 0, 
IÅutWidth
*
CŞÜPÏÃCouÁ
);

98 
¡¬‹d
 = 
FALSE
;

99 
	}
}

101 
	gCŞÜM©ch”
::
	$Flush
()

104 ià(!
¡¬‹d
)

108 
	`Re¡¬t
();

109 
	}
}

111 
	gCŞÜM©ch”
::
	$F»eBufãrs
()

113 
pSS
->
	`F»eMemÜy
(
CÚtÚe
);

114 
	}
}

117 
BYTE
* 
	gCŞÜM©ch”
::
	$NextOuutRa¡”
(
COLORTYPE
 
¿¡”cŞÜ
)

119 ià(
iRa¡”sR—dy
 == 0)

121  
NULL
;

124 ià(
¿¡”cŞÜ
 =ğ
COLORTYPE_COLOR
)

126 
iRa¡”sR—dy
--; 
iRa¡”sD–iv”ed
++;

129 ià(
¿¡”cŞÜ
 =ğ
COLORTYPE_COLOR
)

131 ià(
¿¡”
.
¿¡”d©a
[
¿¡”cŞÜ
] =ğ
NULL
)

132  
NULL
;

134  
CÚtÚe
;

138  
¿¡”
.
¿¡”d©a
[
¿¡”cŞÜ
];

140 
	}
}

143 
	gCŞÜM©ch”
::
	$G‘OuutWidth
(
COLORTYPE
 
¿¡”cŞÜ
)

145 ià(
¿¡”cŞÜ
 =ğ
COLORTYPE_COLOR
)

147 ià(
¿¡”
.
¿¡”d©a
[
¿¡”cŞÜ
] =ğ
NULL
)

150  
IÅutWidth
*
CŞÜPÏÃCouÁ
;

154  
¿¡”
.
¿¡”size
[
¿¡”cŞÜ
];

156 
	}
}

159 
	gCŞÜM©ch”
::
	$G‘MaxOuutWidth
(
COLORTYPE
 
¿¡”cŞÜ
)

161 ià(
¿¡”cŞÜ
 =ğ
COLORTYPE_COLOR
)

163 ià(
¿¡”
.
¿¡”d©a
[
¿¡”cŞÜ
] =ğ
NULL
)

166  
IÅutWidth
*
CŞÜPÏÃCouÁ
;

170  
¿¡”
.
¿¡”size
[
¿¡”cŞÜ
];

172 
	}
}

177 
	gCŞÜM©ch”
::
CŞÜM©ch


179 
width
,

180 cÚ¡ 
ušt32_t
 *
	gm­
,

181 *
	grgb
,

182 *
	gk¶ªe
,

183 *
	gıÏÃ
,

184 *
	gm¶ªe
,

185 *
	gy¶ªe


188 
ušt32_t
 
	g´ev_»d
 = 255, 
	g´ev_g»’
 = 255, 
	g´ev_blue
 = 255;

189 
BYTE
 
	gbcyª
, 
	gbmag’
, 
	gby–low
, 
	gbbÏck
;

191 
ušt32_t
 
	gr
;

192 
ušt32_t
 
	gg
;

193 
ušt32_t
 
	gb
;

195 
	gi
 = 0; i < 
	gwidth
; i++)

197 
	gr
 = *
rgb
++;

198 
	gg
 = *
rgb
++;

199 
	gb
 = *
rgb
++;

201 if(
	gi
 =ğ0 || ( (
´ev_»d
 !ğ
r
è|| (
´ev_g»’
 !ğ
g
è|| (
´ev_blue
 !ğ
b
) ))

203 
´ev_»d
 = 
r
;

204 
	g´ev_g»’
 = 
g
;

205 
	g´ev_blue
 = 
b
;

207 
IÁ”pŞ©e
(
m­
, (
BYTE
)
r
, (BYTE)
g
,(BYTE)
b
, &
bbÏck
, &
bcyª
, &
bmag’
, &
by–low
);

209 ià(
	gk¶ªe
)

210 *(
	gk¶ªe
 + 
	gi
èğ
bbÏck
;

211 ià(
	gıÏÃ
)

212 *(
	gıÏÃ
 + 
	gi
èğ
bcyª
;

213 ià(
	gm¶ªe
)

214 *(
	gm¶ªe
 + 
	gi
èğ
bmag’
;

215 ià(
	gy¶ªe
)

216 *(
	gy¶ªe
 + 
	gi
èğ
by–low
;

222 #ifdeà
APDK_DJ3320


223 
	gCŞÜM©ch”
::
CŞÜM©ch


225 
width
,

226 cÚ¡ *
	gm­
,

227 *
	grgb
,

228 *
	gk¶ªe
,

229 *
	gıÏÃ
,

230 *
	gm¶ªe
,

231 *
	gy¶ªe


234 
BYTE
 
	g´ev_»d
 = 255, 
	g´ev_g»’
 = 255, 
	g´ev_blue
 = 255;

235 
BYTE
 
	gbcyª
, 
	gbmag’
, 
	gby–low
, 
	gbbÏck
;

237 
BYTE
 
	gr
;

238 
BYTE
 
	gg
;

239 
BYTE
 
	gb
;

241 
	gi
 = 0; i < 
	gwidth
; i++)

243 
	gr
 = *
rgb
++;

244 
	gg
 = *
rgb
++;

245 
	gb
 = *
rgb
++;

246 if(
	gi
 =ğ0 || ( (
´ev_»d
 !ğ
r
è|| (
´ev_g»’
 !ğ
g
è|| (
´ev_blue
 !ğ
b
) ))

248 
´ev_»d
 = 
r
;

249 
	g´ev_g»’
 = 
g
;

250 
	g´ev_blue
 = 
b
;

252 
IÁ”pŞ©e
(
m­
, (
BYTE
)
r
, (BYTE)
g
,(BYTE)
b
, &
bbÏck
, &
bcyª
, &
bmag’
, &
by–low
);

254 ià(
	gk¶ªe
)

255 *(
	gk¶ªe
 + 
	gi
èğ
bbÏck
;

256 ià(
	gıÏÃ
)

257 *(
	gıÏÃ
 + 
	gi
èğ
bcyª
;

258 ià(
	gm¶ªe
)

259 *(
	gm¶ªe
 + 
	gi
èğ
bmag’
;

260 ià(
	gy¶ªe
)

261 *(
	gy¶ªe
 + 
	gi
èğ
by–low
;

268 
ušt32_t
 
	$Packed
(
k
,
c
,
m
,
y
)

270 
ušt32_t
 
p
 = 
y
;

271 
p
 =… << 8;

272 
p
 +ğ
m
;

273 
p
 =… << 8;

274 
p
 +ğ
c
;

275 
p
 =… << 8;

276 
p
 +ğ
k
;

277  
p
;

278 
	}
}

281 
DRIVER_ERROR
 
	gCŞÜM©ch”
::
	$MakeG¿yM­
(cÚ¡ 
ušt32_t
 *
cŞÜm­
, ušt32_t* 
g¿ym­
)

283 
ul_M­PŒ
;

284 
r
 = 0;„ < 9;„++)

286 
ul_RedM­PŒ
 = 
r
 * 9 * 9;

287 
g
 = 0; g < 9; g++)

289 
ul_G»’M­PŒ
 = 
g
 * 9;

290 
b
 = 0; b < 9; b++)

292 
m­±r
 = 
b
 + (
g
 * 9è+ (
r
 * 9 * 9);

293 
ul_M­PŒ
 = 
b
 + 
ul_G»’M­PŒ
 + 
ul_RedM­PŒ
;

294 
	`ASSERT
(
m­±r
 =ğ
ul_M­PŒ
);

296 
ŞdR
 = 
r
 * 255 >> 3;

297 
ŞdG
 = 
g
 * 255 >> 3;

298 
ŞdB
 = 
b
 * 255 >> 3;

301 
g¿y
 = ((30 * 
ŞdR
 + 59 * 
ŞdG
 + 11 * 
ŞdB
 + 50) / 100);

303 
ušt32_t
 *
¡¬t
;

304 
¡¬t
 = (
ušt32_t
 *)

305 Ğ((
g¿y
 & 0xE0) <<1) + ((gray & 0xE0)>>1) + (gray>>5) +

306 ((
g¿y
 & 0xE0è>>2è+ (g¿y>>5è+ (g¿y>>5è+ 
cŞÜm­
);

308 
BYTE
 
k
,
c
,
m
,
y
;

309 
	`IÁ”pŞ©e
(
¡¬t
, 
g¿y
, g¿y, g¿y, &
k
, &
c
, &
m
, &
y
);

313 *(
g¿ym­
 + 
m­±r
èğ
	`Packed
(
k
, 
c
, 
m
, 
y
);

317  
NO_ERROR
;

318 
	}
}

321 
BOOL
 
	gCŞÜM©ch”
::
	$Proûss
(
RASTERDATA
* 
pbyIÅutKRGBRa¡”
)

323 ià(
pbyIÅutKRGBRa¡”
 =ğ
NULL
 || (pbyIÅutKRGBRa¡”->
¿¡”d©a
[
COLORTYPE_BLACK
] =ğNULL &&…byIÅutKRGBRa¡”->¿¡”d©a[
COLORTYPE_COLOR
] == NULL))

325 
	`Re¡¬t
();

326  
FALSE
;

328 
¡¬‹d
=
TRUE
;

330 ià(
pbyIÅutKRGBRa¡”
->
¿¡”d©a
[
COLORTYPE_COLOR
])

332 
BYTE
* 
buff1
 = 
NULL
;

333 
BYTE
* 
buff2
 = 
NULL
;

334 
BYTE
* 
buff3
 = 
NULL
;

335 
BYTE
* 
buff4
 = 
NULL
;

337 ià(
S¹PÏÃ
==
K
)

339 
buff1
 = 
CÚtÚe
;

340 ià(
EndPÏÃ
>
K
)

342 
buff2
 = 
buff1
 + 
IÅutWidth
;

343 
buff3
 = 
buff2
 + 
IÅutWidth
;

344 
buff4
 = 
buff3
 + 
IÅutWidth
;

349 
buff2
 = 
CÚtÚe
;

350 
buff3
 = 
buff2
 + 
IÅutWidth
;

351 
buff4
 = 
buff3
 + 
IÅutWidth
;

354 #ifdeà
APDK_DJ3320


355 ià(
cm­
.
ulM­3
)

357 
	`CŞÜM©ch
Ğ
IÅutWidth
,

358 
cm­
.
ulM­3
,

359 
pbyIÅutKRGBRa¡”
->
¿¡”d©a
[
COLORTYPE_COLOR
],

360 
buff1
,

361 
buff2
,

362 
buff3
,

363 
buff4


367 ià(
cm­
.
ulM­1
)

370 
	`CŞÜM©ch
Ğ
IÅutWidth
,

371 
cm­
.
ulM­1
,

372 
pbyIÅutKRGBRa¡”
->
¿¡”d©a
[
COLORTYPE_COLOR
],

373 
buff1
,

374 
buff2
,

375 
buff3
,

376 
buff4


380 ià(
EndPÏÃ
 > 
Y
 && 
cm­
.
ulM­2
)

382 
BYTE
* 
buff5
 = 
buff4
 + 
IÅutWidth
;

383 
BYTE
* 
buff6
 = 
buff5
 + 
IÅutWidth
;

385 
	`CŞÜM©ch
Ğ
IÅutWidth
,

386 
cm­
.
ulM­2
,

387 
pbyIÅutKRGBRa¡”
->
¿¡”d©a
[
COLORTYPE_COLOR
],

388 
NULL
,

389 
buff5
,
buff6
,

390 
NULL


395 
iRa¡”sR—dy
 = 1;

396 
iRa¡”sD–iv”ed
 = 0;

397  
TRUE
;

398 
	}
}

400 
	gAPDK_END_NAMESPACE


	@prnt/hpijs/colormatch.h

32 #iâdeà
APDK_COLORMATCH_H


33 
	#APDK_COLORMATCH_H


	)

35 
	#TESTMODE
 0

	)

36 
	#MAP17CUBE
 1

	)

37 
	#OCT_MASK1
 0x10

	)

38 
	#OCT_MASK2
 0x8

	)

39 
	#OCT_MASK3
 0x4

	)

40 
	#OCT_MASK4
 0x2

	)

41 
	#OCT_MASK5
 0x1

	)

43 
APDK_BEGIN_NAMESPACE


48 şas 
	cCŞÜM©ch”
 : 
public
 
ProûssÜ


50 
public
:

51 
CŞÜM©ch”
(
Sy¡emS”viûs
* 
pSys
,

52 
CŞÜM­
 
cm
,
DyeCouÁ
,

53 
iIÅutWidth
);

54 
	mvœtu®
 ~
CŞÜM©ch”
();

57 
vœtu®
 
BOOL
 
Proûss
(
RASTERDATA
* 
IÅutRa¡”
=
NULL
);

58 
vœtu®
 
Flush
();

60 
DRIVER_ERROR
 
	mcÚ¡ruùÜ_”rÜ
;

62 
vœtu®
 
Re¡¬t
();

65 
G‘OuutWidth
(
COLORTYPE
 
¿¡”cŞÜ
);

66 
G‘MaxOuutWidth
(
COLORTYPE
 
¿¡”cŞÜ
);

67 
BYTE
* 
NextOuutRa¡”
(
COLORTYPE
 
¿¡”cŞÜ
);

69 
	mCŞÜPÏÃCouÁ
;

70 
	mIÅutWidth
;

71 
	mS¹PÏÃ
;

72 
	mEndPÏÃ
;

73 
	mResBoo¡
;

75 
DRIVER_ERROR
 
MakeG¿yM­
(cÚ¡ 
ušt32_t
 *
cŞÜm­
, ušt32_t* 
g¿ym­
);

77 
	m´Ùeùed
:

79 
Sy¡emS”viûs
* 
pSS
;

81 
F»eBufãrs
();

82 
CŞÜM©ch
Ğ
width
, cÚ¡ 
ušt32_t
 *
m­
, *
rgb
,

83 *
k¶ªe
, *
ıÏÃ
, *
m¶ªe
,

84 *
y¶ªe
 );

86 
vœtu®
 
IÁ”pŞ©e
(cÚ¡ 
ušt32_t
 *
m­
,

87 
r
,
g
,
b
,

88 *
bÏckout
, *
cyªout
,

89 *
mag’out
, *
y–lowout
)=0;

91 #ifdeà
APDK_DJ3320


92 
CŞÜM©ch
Ğ
width
, cÚ¡ *
m­
, *
rgb
,

93 *
k¶ªe
, *
ıÏÃ
, *
m¶ªe
,

94 *
y¶ªe
 );

96 
vœtu®
 
IÁ”pŞ©e
(cÚ¡ *
m­
,

97 
r
,
g
,
b
,

98 *
bÏckout
, *
cyªout
,

99 *
mag’out
, *
y–lowout
)=0;

103 
šlše
 
	$G‘Y–lowV®ue
(
ušt32_t
 
cmyk
)

104 { Ğ(()((
cmyk
)>>24) & 0xFF) ); }

106 
šlše
 
	$G‘Mag’V®ue
(
ušt32_t
 
cmyk
)

107 { Ğ(()((
cmyk
)>>16è& 0xFFè); 
	}
}

109 
šlše
 
	$G‘CyªV®ue
(
ušt32_t
 
cmyk
)

110 { Ğ(()((()(
cmyk
))>>8è& 0xFFè); 
	}
}

112 
šlše
 
	$G‘BÏckV®ue
(
ušt32_t
 
cmyk
)

113 { Ğ(()(
cmyk
è& 0xFFè); 
	}
}

115 
HPBoŞ
 
	$FÜw¬d16Pix–sNÚWh™e
(
HPBy‹PŒ
 
šputPŒ
)

119 
i
=0; i < 16; i++)

121 ià((*
šputPŒ
++)!=0)

122  
TRUE
;

125  
FALSE
;

126 
	}
}

128 
HPBoŞ
 
	$Backw¬d16Pix–sNÚWh™e
(
HPBy‹PŒ
 
šputPŒ
)

132 
i
=0; i < 16; i++)

134 ià((*
šputPŒ
--)!=0)

135  
TRUE
;

138  
FALSE
;

139 
	}
}

142 * 
	gCÚtÚe
;

144 
CŞÜM­
 
	gcm­
;

148 
PÏÃCouÁ
();

150 
BOOL
 
	g¡¬‹d
;

154 
	gAPDK_END_NAMESPACE


	@prnt/hpijs/colormatcher_open.cpp

31 
	~"h—d”.h
"

32 
	~"h±y³s.h
"

33 
	~"cŞÜm©ch.h
"

35 
	~"cŞÜm©ch”_İ’.h
"

36 
	#INTERPOLATE_5_BITS
(
a
, 
b
, 
d
è¨+ ( ( ( ()b - (ï ) * dè>> 5)

	)

37 
	#INTERPOLATE_4_BITS
(
a
, 
b
, 
d
è¨+ ( ( ( ()b - (ï ) * dè>> 4)

	)

40 
	#INTERPOLATE_CUBE
(
r
,
g
,
b
, 
cube
, 
DOCALC
) \

41 
	`DOCALC
Ğ(DOCALCĞ(DOCALCĞ
cube
[0], cube[4], (
r
))), \

42 (
	`DOCALC
Ğ
cube
[2], cube[6], (
r
))), (
g
))), \

43 (
	`DOCALC
Ğ(DOCALCĞ
cube
[1], cube[5], (
r
))), \

44 (
	`DOCALC
Ğ
cube
[3], cube[7], (
r
))), (
g
))), \

45 (
b
))

	)

47 
APDK_BEGIN_NAMESPACE


49 
	gCŞÜM©ch”_O³n
::
CŞÜM©ch”_O³n


51 
Sy¡emS”viûs
* 
pSys
,

52 
CŞÜM­
 
	gcm
,

53 
	gDyeCouÁ
,

54 
	giIÅutWidth


55 è: 
	$CŞÜM©ch”
(
pSys
,
cm
, 
DyeCouÁ
,
iIÅutWidth
)

56 { 
	}
}

58 
	gCŞÜM©ch”_O³n
::~
	$CŞÜM©ch”_O³n
()

59 { 
	}
}

85 
CŞÜM©ch”_O³n
::
IÁ”pŞ©e


87 cÚ¡ 
ušt32_t
 *
m­
,

88 
BYTE
 
	gr
,

89 
BYTE
 
	gg
,

90 
BYTE
 
	gb
,

91 
BYTE
 *
	gbÏckout
,

92 
BYTE
 *
	gcyªout
,

93 
BYTE
 *
	gmag’out
,

94 
BYTE
 *
	gy–lowout


97 
	gcube_loÿtiÚ
[] = {0, 1, 9, 10, 81, 82, 90, 91 };

98 cÚ¡ 
ušt32_t
 *
	g¡¬t
;

100 #ifdeà 
_WIN32_WCE


101 
	gcyª
[8], 
	gmag’
[8],
	gy–low
[8],
	gbÏck
[8];

103 
BYTE
 
	gcyª
[8], 
	gmag’
[8],
	gy–low
[8],
	gbÏck
[8];

105 
	g¡¬t
 = (cÚ¡ 
ušt32_t
 *)

106 (((
r
 & 0xE0) << 1) + ((r & 0xE0) >> 1) + (r >> 5) +

107 ((
g
 & 0xE0è>> 2è+ (g >> 5è+ (
b
 >> 5è+ 
m­
);

109 
ušt32_t
 
	gcV®ue
;

110 
	gj
 = 0; j < 8; j++)

112 
	gcV®ue
 = *(
¡¬t
 + 
cube_loÿtiÚ
[
j
]);

113 
	gcyª
[
j
] = 
G‘CyªV®ue
 (
cV®ue
);

114 
	gmag’
[
j
] = 
G‘Mag’V®ue
 (
cV®ue
);

115 
	gy–low
[
j
] = 
G‘Y–lowV®ue
 (
cV®ue
);

116 
	gbÏck
[
j
] = 
G‘BÏckV®ue
 (
cV®ue
);

120 
BYTE
 
	gdiff_»d
 = 
r
 & 0x1f;

121 
BYTE
 
	gdiff_g»’
 = 
g
 & 0x1f;

122 
BYTE
 
	gdiff_blue
 = 
b
 & 0x1f;

124 *
	gcyªout
 = 
INTERPOLATE_CUBE
(
diff_»d
,
diff_g»’
,
diff_blue
, 
cyª
, 
INTERPOLATE_5_BITS
 );

125 *
	gmag’out
 = 
INTERPOLATE_CUBE
(
diff_»d
,
diff_g»’
,
diff_blue
, 
mag’
, 
INTERPOLATE_5_BITS
 );

126 *
	gy–lowout
 = 
INTERPOLATE_CUBE
(
diff_»d
,
diff_g»’
,
diff_blue
, 
y–low
, 
INTERPOLATE_5_BITS
 );

127 *
	gbÏckout
 = 
INTERPOLATE_CUBE
(
diff_»d
,
diff_g»’
,
diff_blue
, 
bÏck
, 
INTERPOLATE_5_BITS
 );

130 #ifdeà
APDK_DJ3320


132 
	gCŞÜM©ch”_O³n
::
IÁ”pŞ©e


134 cÚ¡ *
m­
,

135 
BYTE
 
	gr
,

136 
BYTE
 
	gg
,

137 
BYTE
 
	gb
,

138 
BYTE
 *
	gbÏckout
,

139 
BYTE
 *
	gcyªout
,

140 
BYTE
 *
	gmag’out
,

141 
BYTE
 *
	gy–lowout


144 #ifdeà 
_WIN32_WCE


145 
	gcyª
[8], 
	gmag’
[8],
	gy–low
[8],
	gbÏck
[8];

147 
BYTE
 
	gcyª
[8], 
	gmag’
[8],
	gy–low
[8],
	gbÏck
[8];

151 
	gcube_loÿtiÚ
[] = {0, 4, 68, 72, 1156, 1160, 1224, 1228};

152 cÚ¡ 
BYTE
 *
	g¡¬t
;

154 
BYTE
 *
	gnode_±r
;

156 
	g¡¬t
 = (const *)

157 ((((
r
 & 0xF0) << 4) + ((r & 0xF0) << 1) + (r >> 4) +

158 ((
g
 & 0xF0)è+ (g >> 4è+ (
b
 >> 4)è* 4 + 
m­
);

161 
	gj
 = 0; j < 8; ++j )

163 
	gnode_±r
 = (
BYTE
 *è(
¡¬t
 + 
cube_loÿtiÚ
[
j
]);

164 
	gbÏck
[
j
] = *
node_±r
++;

165 
	gcyª
[
j
] = *
node_±r
++;

166 
	gmag’
[
j
] = *
node_±r
++;

167 
	gy–low
[
j
] = *
node_±r
;

172 
BYTE
 
	gdiff_»d
 = 
r
 & 0x0f;

173 
BYTE
 
	gdiff_g»’
 = 
g
 & 0x0f;

174 
BYTE
 
	gdiff_blue
 = 
b
 & 0x0f;

176 *
	gcyªout
 = 
INTERPOLATE_CUBE
(
diff_»d
,
diff_g»’
,
diff_blue
, 
cyª
, 
INTERPOLATE_4_BITS
 );

177 *
	gmag’out
 = 
INTERPOLATE_CUBE
(
diff_»d
,
diff_g»’
,
diff_blue
, 
mag’
, 
INTERPOLATE_4_BITS
 );

178 *
	gy–lowout
 = 
INTERPOLATE_CUBE
(
diff_»d
,
diff_g»’
,
diff_blue
, 
y–low
, 
INTERPOLATE_4_BITS
 );

179 *
	gbÏckout
 = 
INTERPOLATE_CUBE
(
diff_»d
,
diff_g»’
,
diff_blue
, 
bÏck
, 
INTERPOLATE_4_BITS
 );

184 
	gAPDK_END_NAMESPACE


	@prnt/hpijs/colormatcher_open.h

32 #iâdeà
APDK_COLORMATCHER_OPEN_H


33 
	#APDK_COLORMATCHER_OPEN_H


	)

35 
APDK_BEGIN_NAMESPACE


37 şas 
	cCŞÜM©ch”_O³n
 : 
public
 
CŞÜM©ch”


39 
public
:

40 
CŞÜM©ch”_O³n
(
Sy¡emS”viûs
* 
pSys
,

41 
CŞÜM­
 
cm
,
DyeCouÁ
,

42 
iIÅutWidth
);

43 
	mvœtu®
 ~
CŞÜM©ch”_O³n
();

45 
	m´Ùeùed
:

47 
IÁ”pŞ©e
(cÚ¡ 
ušt32_t
 *
m­
,

48 
r
,
g
,
b
,

49 *
bÏckout
, *
cyªout
,

50 *
mag’out
, *
y–lowout
);

52 
IÁ”pŞ©e
(cÚ¡ *
m­
,

53 
r
,
g
,
b
,

54 *
bÏckout
, *
cyªout
,

55 *
mag’out
, *
y–lowout
);

60 
	gAPDK_END_NAMESPACE


	@prnt/hpijs/compression.cpp

32 
	~"h—d”.h
"

34 
APDK_BEGIN_NAMESPACE


36 
	gCom´essÜ
::
	$Com´essÜ
(
Sy¡emS”viûs
* 
pSys
, 
Ra¡”Size
, 
BOOL
 
u££ed
)

37 : 
	`pSS
(
pSys
), 
	`S“dRow
(
NULL
), 
	`U£S“dRow
(
u££ed
), 
	`šputsize
(
Ra¡”Size
), 
	$£eded
(
FALSE
)

39 
cÚ¡ruùÜ_”rÜ
=
NO_ERROR
;

40 
iRa¡”sR—dy
=0;

42 
Üigš®KD©a
=
pSS
->
	`AÎocMem
(
Ra¡”Size
);

43 
	`CNEWCHECK
(
Üigš®KD©a
);

45 ià(!
U£S“dRow
)

48 
S“dRow
=
pSS
->
	`AÎocMem
(
Ra¡”Size
);

49 
	`CNEWCHECK
(
S“dRow
);

50 
	}
}

52 
	gCom´essÜ
::~
	$Com´essÜ
()

54 ià(
com´essBuf
)

55 
pSS
->
	`F»eMem
 (
com´essBuf
);

56 ià(
S“dRow
)

57 
pSS
->
	`F»eMem
 (
S“dRow
);

58 ià(
Üigš®KD©a
)

59 
pSS
->
	`F»eMem
 (
Üigš®KD©a
);

60 
	}
}

62 
	gCom´essÜ
::
	$G‘OuutWidth
(
COLORTYPE
 
cŞÜ
)

65 ià(
my¶ªe
 =ğ
cŞÜ
)

67  
com´es£dsize
;

71  
¿¡”
.
¿¡”size
[
cŞÜ
];

73 
	}
}

76 
BYTE
* 
	gCom´essÜ
::
	$NextOuutRa¡”
(
COLORTYPE
 
cŞÜ
)

79 ià(
iRa¡”sR—dy
==0)

80  (
BYTE
*)
NULL
;

81 ià(
cŞÜ
 =ğ
COLORTYPE_COLOR
)

83 
iRa¡”sR—dy
=0;

85 ià(
my¶ªe
 =ğ
cŞÜ
)

87 ià(
¿¡”
.
¿¡”d©a
[
cŞÜ
] =ğ
NULL
)

88 ià(
com´es£dsize
 !ğ0 && 
my¶ªe
 =ğ
COLORTYPE_BLACK
)

89  
com´essBuf
;

91  
NULL
;

93  
com´essBuf
;

97  
¿¡”
.
¿¡”d©a
[
cŞÜ
];

99 
	}
}

101 
	gMode9
::
	$Mode9
 (
Sy¡emS”viûs
* 
pSys
,
Ra¡”Size
, 
BOOL
 
bVIPPrš‹r
)

102 : 
	$Com´essÜ
(
pSys
,
Ra¡”Size
, 
TRUE
)

104 ià(
cÚ¡ruùÜ_”rÜ
 !ğ
NO_ERROR
)

108 
com´essBuf
 = (
BYTE
*)
pSS
->
	`AÎocMem
(
Ra¡”Size
 * 2);

109 ià(
com´essBuf
 =ğ
NULL
)

110 
cÚ¡ruùÜ_”rÜ
=
ALLOCMEM_ERROR
;

112 
	`mem£t
(
com´essBuf
, 0, 
Ra¡”Size
 * 2);

113 
	`mem£t
(
S“dRow
,0,
Ra¡”Size
);

115 
Re£tS“dRow
 = 
FALSE
;

116 
m_bVIPPrš‹r
 = 
bVIPPrš‹r
;

117 
	}
}

119 
	gMode9
::~
	$Mode9
()

120 { 
	}
}

125 
comch¬
;

128 #ià
defšed
(
APDK_LITTLE_ENDIAN
è|| defšed(
LITTLE_ENDIAN_HW
)

129 
	m»¶aû_couÁ
:3;

130 
	mroff
:4;

131 
	mty³
:1;

133 
	mty³
:1;

134 
	mroff
:4;

135 
	m»¶aû_couÁ
:3;

137 } 
	mb™f0
;

140 #ià
defšed
(
APDK_LITTLE_ENDIAN
è|| defšed(
LITTLE_ENDIAN_HW
)

141 
	m»¶aû_couÁ
:5;

142 
	mroff
:2;

143 
	mty³
:1;

145 
	mty³
:1;

146 
	mroff
:2;

147 
	m»¶aû_couÁ
:5;

149 } 
	mb™f1
;

150 } 
	tMode9_comty³
;

152 #iâdeà
MIN


153 
	#MIN
(
a
,
b
è((×)>=(b))?(b):×))

	)

156 
	#kPCLMode9
 9

	)

158 
	#MAX_OFFSET0
 14

	)

159 
	#OFFSET_START0
 0

	)

160 
	#MAX_COUNT0
 6

	)

161 
	#COUNT_START0
 1

	)

163 
	#MAX_OFFSET1
 2

	)

164 
	#OFFSET_START1
 0

	)

165 
	#MAX_COUNT1
 30

	)

166 
	#COUNT_START1
 2

	)

171 
	gMode9
::
	$Flush
()

173 ià(!
£eded
)

176 
com´es£dsize
=0;

178 
iRa¡”sR—dy
=0;

179 
£eded
=
FALSE
;

180 
	}
}

182 
BOOL
 
	gMode9
::
	$Proûss
(
RASTERDATA
* 
šput
)

187 ià(
šput
==
NULL
 ||

188 (
šput
->
¿¡”d©a
[
COLORTYPE_COLOR
]==
NULL
 && iÅut->¿¡”d©a[
COLORTYPE_BLACK
]==NULL))

190 
	`Flush
();

191  
FALSE
;

193 
£eded
 = 
TRUE
;

195 ià(!
Re£tS“dRow
 && 
šput
->
¿¡”d©a
[
my¶ªe
] == 0)

197 
com´es£dsize
=0;

198 
iRa¡”sR—dy
=1;

199  
TRUE
;

202 
	`mem£t
(
com´essBuf
, 0, 
šputsize
 * 2);

204 
Üigš®size
=
šput
->
¿¡”size
[
my¶ªe
];

205 
size
=
šput
->
¿¡”size
[
my¶ªe
];

206 
Ïy”
;

209 ià(
my¶ªe
 =ğ
COLORTYPE_BLACK
)

211 ià(
šput
->
¿¡”d©a
[
my¶ªe
] == 0)

213 
	`mem£t
(
Üigš®KD©a
, 0, 
šputsize
);

214 
size
 = 
Üigš®size
 = 
šputsize
;

218 
size
 = 
Üigš®size
 = (
šput
->
¿¡”size
[
my¶ªe
]+7)/8;

219 
	`mem£t
(
Üigš®KD©a
, 0, 
size
);

221 
curB™
 = 0x80, 
curBy‹
 = 0;

222 
i
=0; i<
šput
->
¿¡”size
[
my¶ªe
]; i++)

224 ià(
šput
->
¿¡”d©a
[
my¶ªe
][
i
])

226 
Üigš®KD©a
[
curBy‹
] |ğ
curB™
;

228 ià(
curB™
 == 0x01)

230 
curBy‹
++;

231 
curB™
 = 0x80;

235 
curB™
 = curBit >> 1;

238 
Re£tS“dRow
 = 
TRUE
;

241 ià((
mypha£
è&& (mypha£->
´ev
))

243 
Ïy”
 = 
mypha£
->
´ev
->
Exec
->
iRa¡”sD–iv”ed
;

245 
Ïy”
 = 1;

247 ià(
my¶ªe
 =ğ
COLORTYPE_BLACK
)

249 
Ïy”
 = 1;

252 
Ïy”
--;

253 *
¥Œ
 = (*)(&
S“dRow
[
size
*
Ïy”
]);

255 
BYTE
 *
ÅŒ
;

256 ià(
my¶ªe
 =ğ
COLORTYPE_BLACK
)

258 
ÅŒ
 = 
Üigš®KD©a
;

262 
ÅŒ
 = 
šput
->
¿¡”d©a
[
my¶ªe
];

264 
BYTE
 *
‹mpPŒ
;

265 
Ï¡_by‹
;

266 
off£t
,
by‹_couÁ
,
»m_couÁ
;

267 
Mode9_comty³
 
commªd
;

268 * 
de¡
ğ(*è
com´essBuf
;

269 *
d±r
=
de¡
;

271  
size
 > 0 )

273 
off£t
 = 0;

281 ià(
£eded
 && !
m_bVIPPrš‹r
)

284 (*
¥Œ
++ =ğ*
ÅŒ
++è&& (
off£t
 < 
size
) )

286 
off£t
++;

288 
¥Œ
--;

289 
ÅŒ
--;

292 iàĞ
off£t
 >ğ
size
 )

293 
ba
;

295 
size
 -ğ
off£t
;

297 ià((*
ÅŒ
 !ğÅŒ[1]è|| (
size
 < 2))

299 
commªd
.
b™f0
.
ty³
 = 0;

300 
Ï¡_by‹
 = *
ÅŒ
++;

301 
¥Œ
++;

302 
by‹_couÁ
 = 1;

312 (*
¥Œ
++ !ğ*
ÅŒ
è&& (
Ï¡_by‹
 !ğ*ÅŒè&& (
by‹_couÁ
 < 
size
))

314 
by‹_couÁ
++;

315 
Ï¡_by‹
 = *
ÅŒ
++;

317 
¥Œ
--;

321 ià((
by‹_couÁ
 < 
size
è&& (
Ï¡_by‹
 =ğ()*
ÅŒ
))

323 
ÅŒ
--;

324 
¥Œ
--;

325 
by‹_couÁ
--;

328 
size
 -ğ
by‹_couÁ
;

333 ià(
off£t
 > (
MAX_OFFSET0
+
OFFSET_START0
))

334 
commªd
.
b™f0
.
roff
 = 
MAX_OFFSET0
+1;

336 
commªd
.
b™f0
.
roff
 = 
off£t
-
OFFSET_START0
;

338 ià(
by‹_couÁ
 > (
MAX_COUNT0
+
COUNT_START0
))

339 
commªd
.
b™f0
.
»¶aû_couÁ
 = 
MAX_COUNT0
+1;

341 
commªd
.
b™f0
.
»¶aû_couÁ
 = 
by‹_couÁ
-
COUNT_START0
;

343 *
d±r
++ = 
commªd
.
comch¬
;

345 ià(
off£t
 > (
MAX_OFFSET0
+
OFFSET_START0
))

347 
off£t
 -ğ(
MAX_OFFSET0
+
OFFSET_START0
+1);

348 ià(
off£t
 == 0)

350 *
d±r
++ = 0;

354  
off£t
 )

356 *
d±r
++ = 
	`MIN
 ( 
off£t
, 255 );

358 iàĞ
off£t
 == 255 )

359 *
d±r
++ = 0;

361 
off£t
 -ğ
	`MIN
 ( offset, 255 );

366 ià(
by‹_couÁ
 > (
MAX_COUNT0
+
COUNT_START0
))

368 
»m_couÁ
 = 
by‹_couÁ
 - (
MAX_COUNT0
+
COUNT_START0
+1);

369 ià(
»m_couÁ
 == 0)

370 *
d±r
++ = 0;

373  
»m_couÁ
 )

375 *
d±r
++ = 
	`MIN
 ( 
»m_couÁ
, 255 );

377 iàĞ
»m_couÁ
 == 255 )

378 *
d±r
++ = 0;

380 
»m_couÁ
 -ğ
	`MIN
 („em_count, 255 );

387 
‹mpPŒ
 = 
ÅŒ
 - 
by‹_couÁ
;

388 ;
by‹_couÁ
;byte_count--)

390 *
d±r
++ = *
‹mpPŒ
++;

396 
commªd
.
b™f1
.
ty³
 = 1;

397 
ÅŒ
++;

398 
Ï¡_by‹
 = *
ÅŒ
++;

399 
by‹_couÁ
 = 2;

401 (
Ï¡_by‹
 =ğ*
ÅŒ
++è&& (
by‹_couÁ
 < 
size
))

403 
by‹_couÁ
++;

405 
ÅŒ
--;

406 
¥Œ
 +ğ
by‹_couÁ
;

407 
size
 -ğ
by‹_couÁ
;

409 ià(
off£t
 > (
MAX_OFFSET1
+
OFFSET_START1
))

410 
commªd
.
b™f1
.
roff
 = 
MAX_OFFSET1
+1;

412 
commªd
.
b™f1
.
roff
 = 
off£t
-
OFFSET_START1
;

414 ià(
by‹_couÁ
 > (
MAX_COUNT1
+
COUNT_START1
))

415 
commªd
.
b™f1
.
»¶aû_couÁ
 = 
MAX_COUNT1
+1;

417 
commªd
.
b™f1
.
»¶aû_couÁ
 = 
by‹_couÁ
-
COUNT_START1
;

419 *
d±r
++ = 
commªd
.
comch¬
;

421 ià(
off£t
 > (
MAX_OFFSET1
+
OFFSET_START1
))

423 
off£t
 -ğ(
MAX_OFFSET1
+
OFFSET_START1
+1);

424 ià(
off£t
 == 0)

426 *
d±r
++ = 0;

430  
off£t
 )

432 *
d±r
++ = 
	`MIN
 ( 
off£t
, 255 );

434 iàĞ
off£t
 == 255 )

435 *
d±r
++ = 0;

437 
off£t
 -ğ
	`MIN
 ( offset, 255 );

442 ià(
by‹_couÁ
 > (
MAX_COUNT1
+
COUNT_START1
))

444 
»m_couÁ
 = 
by‹_couÁ
 - (
MAX_COUNT1
+
COUNT_START1
+1);

445 ià(
»m_couÁ
 == 0)

446 *
d±r
++ = 0;

449  
»m_couÁ
 )

451 *
d±r
++ = 
	`MIN
 ( 
»m_couÁ
, 255 );

453 iàĞ
»m_couÁ
 == 255 )

454 *
d±r
++ = 0;

456 
»m_couÁ
 -ğ
	`MIN
 („em_count, 255 );

461 *
d±r
++ = 
Ï¡_by‹
;

465 
ba
:

466 
size
 = ( 
d±r
 - 
de¡
 );

467 
com´es£dsize
 = 
size
;

468 ià(
my¶ªe
 =ğ
COLORTYPE_BLACK
)

470 
	`memıy
(&(
S“dRow
[
Ïy”
*
Üigš®size
]), 
Üigš®KD©a
, originalsize);

474 
	`memıy
(&(
S“dRow
[
Ïy”
*
Üigš®size
]), 
šput
->
¿¡”d©a
[
my¶ªe
], originalsize);

476 
£eded
 = 
TRUE
;

477 
iRa¡”sR—dy
=1;

479  
TRUE
;

480 
	}
}

486 #ià
defšed
(
APDK_DJ8xx
)|| defšed(
APDK_DJ9xx
è|| defšed(
APDK_LJMONO
è|| defšed(
APDK_LJCOLOR
)

489 
	gMode2
::
	$Mode2
 (
Sy¡emS”viûs
* 
pSys
, 
Ra¡”Size
)

490 : 
	$Com´essÜ
 (
pSys
, 
Ra¡”Size
, 
FALSE
)

492 
com´essBuf
 = (
BYTE
*)
pSS
->
	`AÎocMem
(
Ra¡”Size
 );

493 ià(
com´essBuf
 =ğ
NULL
)

494 
cÚ¡ruùÜ_”rÜ
=
ALLOCMEM_ERROR
;

495 
	}
}

497 
	gMode2
::~
	$Mode2
()

498 { 
	}
}

500 
BOOL
 
Mode2
::
	$Proûss
 (
RASTERDATA
* 
šput
)

503 
BYTE
* 
pD¡
 = 
com´essBuf
;

504 
nd¡couÁ
 = 0;

506 ià(
šput
==
NULL
 ||

507 (
my¶ªe
 =ğ
COLORTYPE_COLOR
 && 
šput
->
¿¡”d©a
[COLORTYPE_COLOR] =ğ
NULL
) ||

508 (
my¶ªe
 =ğ
COLORTYPE_BLACK
 && 
šput
->
¿¡”d©a
[COLORTYPE_BLACK] =ğ
NULL
))

510 
com´es£dsize
=0;

512 
iRa¡”sR—dy
=0;

513  
FALSE
;

516 
size
 = 
šput
->
¿¡”size
[
my¶ªe
];

517 
ni
 = 0;‚˜< 
size
;)

519 iàĞ
ni
 + 1 < 
size
 && 
šput
->
¿¡”d©a
[
my¶ªe
][‚i ] == input->rasterdata[myplane][‚i + 1 ] )

521 
Ä•—tcouÁ
;

522  
ni
 +ğ2, 
Ä•—tcouÁ
 = 1;‚˜< 
size
 &&‚repeatcount < 127; ++ni, ++nrepeatcount )

524 iàĞ
šput
->
¿¡”d©a
[
my¶ªe
][ 
ni
 ] != input->rasterdata[myplane][‚i - 1 ] )

529 
tm´•—t
 = 0 - 
Ä•—tcouÁ
;

530 
BYTE
 
Œunc
 = (BYTEè
tm´•—t
;

531 
pD¡
[ 
nd¡couÁ
++ ] = 
Œunc
;

532 
pD¡
[ 
nd¡couÁ
++ ] = 
šput
->
¿¡”d©a
[
my¶ªe
][ 
ni
 - 1 ];

536 
Æ™”®couÁ
;

537 
nfœ¡
 = 
ni
;

538  ++
ni
, 
Æ™”®couÁ
 = 0;‚˜< 
size
 &&‚literalcount < 127; ++ni, ++nliteralcount )

540 iàĞ
šput
->
¿¡”d©a
[
my¶ªe
][ 
ni
 ] == input->rasterdata[myplane][‚i - 1 ] )

542 --
ni
;

543 --
Æ™”®couÁ
;

547 
pD¡
[ 
nd¡couÁ
++ ] = (
BYTE
è
Æ™”®couÁ
;

548  
nj
 = 0;‚j <ğ
Æ™”®couÁ
; ++nj )

550 
pD¡
[ 
nd¡couÁ
++ ] = 
šput
->
¿¡”d©a
[
my¶ªe
][ 
nfœ¡
++ ];

555 
size
 = 
nd¡couÁ
;

556 
com´es£dsize
 = 
size
;

557 
iRa¡”sR—dy
 = 1;

558  
TRUE
;

559 
	}
}

562 #ifdeà
APDK_LJCOLOR


568 
	gMode3
::
	$Mode3
 (
Sy¡emS”viûs
* 
pSys
, 
Prš‹r
 *
pPrš‹r
, 
Ra¡”Size
)

569 : 
	$Com´essÜ
 (
pSys
, 
Ra¡”Size
, 
TRUE
)

574 
com´essBuf
 = (
BYTE
*)
pSS
->
	`AÎocMem
(
Ra¡”Size
 + RasterSize/2);

575 ià(
com´essBuf
 =ğ
NULL
)

576 
cÚ¡ruùÜ_”rÜ
=
ALLOCMEM_ERROR
;

578 
	`mem£t
 (
S“dRow
, 0x0, 
šputsize
);

579 
m_pPrš‹r
 = 
pPrš‹r
;

580 
	}
}

582 
	gMode3
::~
	$Mode3
 ()

585 
	}
}

587 
Mode3
::
	$Flush
 ()

589 ià(!
£eded
)

591 
com´es£dsize
=0;

592 
iRa¡”sR—dy
 = 0;

593 
£eded
 = 
FALSE
;

594 
	`mem£t
 (
S“dRow
, 0x0, 
šputsize
);

595 
m_pPrš‹r
->
	`S’d
 ((cÚ¡ 
BYTE
 *) "\033*b0Y", 5);

597 
	}
}

599 
BOOL
 
	gMode3
::
	$Proûss
 (
RASTERDATA
 *
šput
)

601 ià(
šput
==
NULL
 ||

602 (
my¶ªe
 =ğ
COLORTYPE_COLOR
 && 
šput
->
¿¡”d©a
[COLORTYPE_COLOR] =ğ
NULL
) ||

603 (
my¶ªe
 =ğ
COLORTYPE_BLACK
 && 
šput
->
¿¡”d©a
[COLORTYPE_BLACK] =ğ
NULL
))

605 
	`Flush
();

606  
FALSE
;

610 
£eded
 = 
TRUE
;

613 
uOrgSize
 = 
šput
->
¿¡”size
[
my¶ªe
];

614 
size
 = 
šput
->
¿¡”size
[
my¶ªe
];

615 
uOff£t
;

617 
BYTE
 *
pszS±r
 = 
S“dRow
;

618 
BYTE
 *
pszInPŒ
 = 
šput
->
¿¡”d©a
[
my¶ªe
];

619 
BYTE
 *
pszCurPŒ
;

620 
BYTE
 
ucBy‹CouÁ
;

621 
BYTE
 *
pszOutPŒ
 = 
com´essBuf
;

623 
size
 > 0)

625 
uOff£t
 = 0;

627 ià(
£eded
)

629 (*
pszS±r
 =ğ*
pszInPŒ
è&& (
uOff£t
 < 
size
))

631 
pszS±r
++;

632 
pszInPŒ
++;

633 
uOff£t
++;

637 ià(
uOff£t
 >ğ
size
)

642 
size
 -ğ
uOff£t
;

644 
pszCurPŒ
 = 
pszInPŒ
;

645 
ucBy‹CouÁ
 = 1;

646 
pszS±r
++;

647 
pszInPŒ
++;

648 (*
pszS±r
 !ğ*
pszInPŒ
è&& 
ucBy‹CouÁ
 < 
size
 && ucByteCount < 8)

650 
pszS±r
++;

651 
pszInPŒ
++;

652 
ucBy‹CouÁ
++;

654 
ucBy‹CouÁ
--;

655 ià(
uOff£t
 < 31)

657 *
pszOutPŒ
++ = ((
ucBy‹CouÁ
 << 5è| 
uOff£t
);

661 
uOff£t
 -= 31;

662 *
pszOutPŒ
++ = ((
ucBy‹CouÁ
 << 5) | 31);

664 
uOff£t
 >= 255)

666 *
pszOutPŒ
++ = 255;

667 
uOff£t
 -= 255;

669 *
pszOutPŒ
++ = 
uOff£t
;

671 
ucBy‹CouÁ
++;

672 
size
 -ğ(
ucBy‹CouÁ
);

673 
	`memıy
 (
pszOutPŒ
, 
pszCurPŒ
, 
ucBy‹CouÁ
);

674 
pszOutPŒ
 +ğ
ucBy‹CouÁ
;

677 
com´es£dsize
 = 
pszOutPŒ
 - 
com´essBuf
;

678 
	`memıy
 (
S“dRow
, 
šput
->
¿¡”d©a
[
my¶ªe
], 
uOrgSize
);

679 
£eded
 = 
TRUE
;

680 
iRa¡”sR—dy
 = 1;

681  
TRUE
;

684 
	}
}

687 
	gAPDK_END_NAMESPACE


	@prnt/hpijs/compression.h

32 #iâdeà
APDK_COMPRESSION_H


33 
	#APDK_COMPRESSION_H


	)

35 
	gAPDK_BEGIN_NAMESPACE


37 
	#kU£OldB”t
 0

	)

40 
	#kB”tDecom´essPix–Size
 3

	)

43 
	#kTy³Mask
 0x80

	)

44 
	#kTy³ShiáAmouÁ
 7

	)

46 
	#kCacheL™”®B™sMask
 0x60

	)

47 
	#kCacheL™”®B™sShiáAmouÁ
 5

	)

49 
	#kCacheB™sMask
 0x60

	)

50 
	#kCacheB™sShiáAmouÁ
 5

	)

52 
	#kRoffMask
 0x18

	)

53 
	#kRoffShiáAmouÁ
 3

	)

55 
	#kR•Ïû_couÁMask
 0x07

	)

58 #ià((
kTy³Mask
 | 
kCacheL™”®B™sMask
 | 
kRoffMask
 | 
kR•Ïû_couÁMask
) != 255)

62 #ià((
kTy³Mask
 | 
kCacheB™sMask
 | 
kRoffMask
 | 
kR•Ïû_couÁMask
) != 255)

69 
	meL™”®
 = 0,

70 
	meRLE
 = 0x80

75 
	m“NewPix–
 = 0x0,

76 
	m“WPix–
 = 0x20,

77 
	m“NEPix–
 = 0x40,

78 
	m“CachedCŞÜ
 = 0x60,

83 
	meNewCŞÜ
 = 0x0,

84 
	meWe¡CŞÜ
 = 0x1,

85 
	meNÜthEa¡CŞÜ
 = 0x2,

86 
	meCachedCŞÜ
 = 0x3

91 
	#M10_MAX_OFFSET0
 2

	)

92 
	#M10_MAX_COUNT0
 6

	)

93 
	#M10_COUNT_START0
 1

	)

96 
	#M10_MAX_OFFSET1
 2

	)

97 
	#M10_MAX_COUNT1
 6

	)

98 
	#M10_COUNT_START1
 2

	)

101 
B”tCom´ess
(*
cu¼’tRow
, *
£ed
, *
de¡
, 
by‹CouÁ
, 
pix–SizeInBy‹s
);

102 
decodeD©aToPix–
(cÚ¡ *
com´es£dD©aPŒ
, *
CBI
, cÚ¡ *
£edRowPŒ
, cÚ¡ 
curPix–
, 
pix–SizeInBy‹s
);

103 
B”tUncom´ess
(cÚ¡ *
com´es£dD©aPŒ
,

104 *
£edRowPŒ
,

105 
numb”OfCom´es£dBy‹s
,

106 
pix–SizeInBy‹s
,

107 
rowWidthInBy‹s
,

108 *
fœ¡Pix–Th©Chªged
,

109 *
Ï¡Pix–Th©Chªged
);

117 
	gAPDK_END_NAMESPACE


	@prnt/hpijs/config.h

45 #iâdeà
APDK_CONFIG_H


46 
	#APDK_CONFIG_H


	)

48 #ifdeà
APDK_INTERNAL_CREATE_DOCUMENTATION


60 
	#APDK_CGTIMES


61 

	)

62 
	#APDK_COURIER


63 

	)

64 
	#APDK_LTRGOTHIC


65 

	)

66 
	#APDK_UNIVERS


67 

	)

75 
	#APDK_LITTLE_ENDIAN


	)

87 
	#APDK_AUTODUPLEX


	)

93 
	#APDK_EXTENDED_MEDIASIZE


	)

108 
	#APDK_OPTIMIZE_FOR_SPEED


	)

122 
	#APDK_VIP_COLORFILTERING


	)

134 
	#APDK_NO_NAMESPACE


	)

150 
	#APDK_HIGH_RES_MODES


	)

160 
	#APDK_BUFFER_SEND


	)

174 
	#APDK_CAPTURE


	)

197 
	#APDK_APOLLO2XXX


	)

202 
	#APDK_APOLLO21XX


	)

207 
	#APDK_APOLLO2560


	)

212 
	#APDK_DJ350


	)

229 
	#APDK_DJ600


	)

234 
	#APDK_DJ630


	)

239 
	#APDK_DJ6xx


	)

244 
	#APDK_DJ6xxPhÙo


	)

249 
	#APDK_DJ8xx


	)

255 
	#APDK_DJ8x5


	)

261 
	#APDK_DJ9xx


	)

270 
	#APDK_DJ9xxVIP


	)

278 
	#APDK_DJGENERICVIP


	)

284 
	#APDK_PSP100


	)

289 
	#APDK_LJMONO


	)

294 
	#APDK_LJCOLOR


	)

299 
	#APDK_LJJETREADY


	)

304 
	#APDK_LJFASTRASTER


	)

309 
	#APDK_LJZJS_MONO


	)

314 
	#APDK_PSCRIPT


	)

319 
	#APDK_DJ3320


	)

324 
	#APDK_DJ3600


	)

329 
	#APDK_LINUX


	)

336 
	#APDK_LDL_COMPRESS


	)

345 
	#APDK_HP_UX


	)

356 #ià!
defšed
(
APDK_DJ9xxVIP
è&& defšed(
APDK_VIP_COLORFILTERING
)

357 #undeà
APDK_VIP_COLORFILTERING


364 #ià
defšed
(
APDK_CGTIMES
è|| defšed(
APDK_COURIER
è|| defšed(
APDK_LTRGOTHIC
è|| defšed(
APDK_UNIVERS
)

365 
	#APDK_FONTS_NEEDED


	)

367 #undeà
APDK_FONTS_NEEDED


378 #ià!
defšed
(
APDK_NO_NAMESPACE
)

379 
	#APDK_NAMESPACE
 
­dk


	)

380 
	#APDK_BEGIN_NAMESPACE
 
Çme¥aû
 
APDK_NAMESPACE
 {

	)

381 
	#APDK_END_NAMESPACE
 }

382 
	#APDK_USING_NAMESPACE
 
usšg
 
Çme¥aû
 
APDK_NAMESPACE
;

	)

384 
	#APDK_NAMESPACE


	)

385 
	#APDK_BEGIN_NAMESPACE


	)

386 
	#APDK_END_NAMESPACE


	)

387 
	#APDK_USING_NAMESPACE


	)

	@prnt/hpijs/context.h

32 #iâdeà
APDK_PRINTCONTEXT_H


33 
	#APDK_PRINTCONTEXT_H


	)

35 
	#MEDIASIZE_PCL
 0

	)

38 
	mpş_id
;

39 
	mfPhysiÿlWidth
;

40 
	mfPhysiÿlHeight
;

41 
	mfPršbËWidth
;

42 
	mfPršbËHeight
;

43 
	mfPršbËS¹X
;

44 
	mfPršbËS¹Y
;

45 } 
	tMedŸA‰ribu‹s
;

48 
MedŸA‰ribu‹s
 
	mmedŸ_©Œibu‹s
;

49 } 
	tJobA‰ribu‹s
;

51 
	~"´š‹rçùÜy.h
"

53 
APDK_BEGIN_NAMESPACE


55 
şass
 
	gPrštMode
;

56 
şass
 
	gP–še
;

57 
şass
 
	gCom´essÜ
;

58 
şass
 
	gH—d”
;

59 
şass
 
	gPrš‹r
;

60 
şass
 
	gModeS‘
;

78 şas 
	cPrštCÚ‹xt


80 
ä›nd
 
şass
 
	mJob
;

81 
ä›nd
 
şass
 
	mH—d”
;

82 
ä›nd
 
şass
 
	mRa¡”S’d”
;

83 
ä›nd
 
şass
 
	mH—d”DJ990
;

84 
ä›nd
 
şass
 
	mH—d”895
;

85 
ä›nd
 
şass
 
	mTe¡”
;

86 
ä›nd
 
şass
 
	mH—d”850
;

87 
ä›nd
 
şass
 
	mLDLEnÿp
;

88 
	mpublic
:

89 
PrštCÚ‹xt
(
Sy¡emS”viûs
 *
pSysS”v
,

90 
IÅutPix–sP”Row
=0,

91 
OuutPix–sP”Row
=0,

92 
PAPER_SIZE
 
ps
 = 
LETTER
,

93 
QUALITY_MODE
 
eQu®™y
 = 
QUALITY_NORMAL
,

94 
MEDIATYPE
 
eMedŸ
 = 
MEDIA_PLAIN
,

95 
COLORMODE
 
eCŞÜMode
 = 
COLOR
,

96 
BOOL
 
bDeviûText
 = 
FALSE
);

98 
	mvœtu®
 ~
PrštCÚ‹xt
();

100 
DRIVER_ERROR
 
	mcÚ¡ruùÜ_”rÜ
;

103 
Flush
(
FlushSize
);

106 
DRIVER_ERROR
 
S–eùDeviû
(cÚ¡ 
PRINTER_TYPE
 
Mod–
);

107 
DRIVER_ERROR
 
S–eùDeviû
(cÚ¡ * 
szDeviûIDSŒšg
);

109 
G‘ModeCouÁ
();

110 
DRIVER_ERROR
 
S–eùPrštMode
(cÚ¡ 
šdex
);

111 
DRIVER_ERROR
 
S–eùPrštMode
(

112 
QUALITY_MODE
 
eQu®™y
 = 
QUALITY_NORMAL
,

113 
MEDIATYPE
 
eMedŸ
 = 
MEDIA_PLAIN
,

114 
COLORMODE
 
eCŞÜMode
 = 
COLOR
,

115 
BOOL
 
bDeviûText
 = 
FALSE


117 
DRIVER_ERROR
 
S‘P’S‘
(
PEN_TYPE
 
eP’
);

126 
Cu¼’tPrštMode
();

134 cÚ¡ *
	$G‘ModeName
 ()

139 
DRIVER_ERROR
 
	`G‘PrštModeS‘tšgs
(

140 
QUALITY_MODE
& 
eQu®™y
,

141 
MEDIATYPE
& 
eMedŸ
,

142 
COLORMODE
& 
eCŞÜMode
,

143 
BOOL
& 
bDeviûText


146 
PRINTER_TYPE
 
	`S–eùedDeviû
();

149 #ià
	$defšed
(
APDK_FONTS_NEEDED
)

150 
Reã»nûFÚt
* 
	`EnumFÚt
(& 
iCu¼Idx
);

152 
vœtu®
 
FÚt
* 
	`R—lizeFÚt
(cÚ¡ 
šdex
,cÚ¡ 
BYTE
 
bSize
,

153 cÚ¡ 
TEXTCOLOR
 
eCŞÜ
=
BLACK_TEXT
,

154 cÚ¡ 
BOOL
 
bBŞd
=
FALSE
,cÚ¡ BOOL 
bIlic
=FALSE,

155 cÚ¡ 
BOOL
 
bUnd”lše
=
FALSE
);

160 
PRINTER_TYPE
 
	$EnumDeviûs
(
FAMILY_HANDLE
& 
çmyHªdË
) const;

164 
DRIVER_ERROR
 
	`P”fÜmPrš‹rFunùiÚ
(
PRINTER_FUNC
 
eFunc
);

166 
DRIVER_ERROR
 
	`PagesPrš‹d
(& 
couÁ
);

169 
DRIVER_ERROR
 
	`S‘P­”Size
(
PAPER_SIZE
 
ps
, 
BOOL
 
bFuÎBËed
 = 
FALSE
);

171 
DRIVER_ERROR
 
	`S‘Pix–sP”Row
(
IÅutPix–sP”Row
,

172 
OuutPix–sP”Row
=0);

177 
BOOL
 
	$Prš‹rS–eùed
(è{  !(
thePrš‹r
==
NULL
); 
	}
}

180 
BOOL
 
Prš‹rFÚtsAvaabË
();

183 
BOOL
 
SuµÜtS•¬©eBÏck
();

186 
	$IÅutPix–sP”Row
(è{  
IÅutWidth
; 
	}
}

189 
	$OuutPix–sP”Row
(è{  
OuutWidth
; 
	}
}

192 
PAPER_SIZE
 
G‘P­”Size
();

195 
BOOL
 
PhÙoT¿yP»£Á
(BOOL 
bQu”yPrš‹r
);

199 
PHOTOTRAY_STATE
 
PhÙoT¿yEngaged
 (
BOOL
 
bQu”yPrš‹r
);

202 
BOOL
 
HagakiF“dP»£Á
(BOOL 
bQu”yPrš‹r
);

204 #ifdeà
APDK_AUTODUPLEX


207 
BOOL
 
HagakiF“dDu¶ex”P»£Á
(BOOL 
bQu”yPrš‹r
);

210 cÚ¡ * 
Prš‹rMod–
();

211 cÚ¡ * 
Prš‹¹y³ToSŒšg
(
PRINTER_TYPE
 
±
);

213 
EfãùiveResŞutiÚX
();

214 
EfãùiveResŞutiÚY
();

219 
PršbËWidth
();

220 
PršbËHeight
();

221 
PhysiÿlPageSizeX
();

222 
PhysiÿlPageSizeY
();

223 
PršbËS¹X
();

224 
PršbËS¹Y
();

227 
DRIVER_ERROR
 
S’dPrš‹rR—dyD©a
(
BYTE
* 
¡»am
, 
size
);

229 
DeviûRegi¡ry
* 
	gDR
;

231 
DRIVER_ERROR
 
S‘MedŸSourû
(
MedŸSourû
 
num
);

245 
MedŸSourû
 
	$G‘MedŸSourû
(è{  
m_MedŸSourû
; 
	}
}

247 
	$S‘MedŸSubty³
 (
iMedŸSubty³
)

249 
m_iMedŸSubty³
 = 
iMedŸSubty³
;

250 
	}
}

251 
	$G‘MedŸSubty³
 ()

253  
m_iMedŸSubty³
;

254 
	}
}

255 
	$S‘MechOff£t
 (
iMechOff£t
)

257 
m_iMechOff£t
 = 
iMechOff£t
;

258 
	}
}

263 #ifdeà
APDK_AUTODUPLEX


272 
BOOL
 
S–eùDu¶exPrštšg
 (
DUPLEXMODE
 
du¶exmode
);

275 
DUPLEXMODE
 
Qu”yDu¶exMode
 ();

282 
BOOL
 
RÙ©eImageFÜBackPage
 ();

285 #ifdeà
APDK_EXTENDED_MEDIASIZE


286 
BOOL
 
S‘Cu¡omSize
 (
width
, 
height
);

288 
G‘Cu¼’tDyeCouÁ
();

289 
PEN_TYPE
 
G‘DeçuÉP’S‘
();

290 
PEN_TYPE
 
G‘In¡®ËdP’s
();

292 
Re£tIOMode
 (
BOOL
 
bDevID
, BOOL 
bStus
);

295 
	$G‘CİyCouÁ
 ()

297  
m_iCİyCouÁ
;

298 
	}
}

305 
	$S‘CİyCouÁ
 (
iNumCİ›s
)

307 
m_iCİyCouÁ
 = 
iNumCİ›s
;

308 
	}
}

309 
DRIVER_ERROR
 
S‘Prš‹rHšt
 (
PRINTER_HINT
 
eHšt
, 
iV®ue
);

312 
BOOL
 
	$IsBÜd”Ëss
 (è{  
bDoFuÎBËed
; 
	}
}

323 
DRIVER_ERROR
 
S‘MedŸTy³
 (
MEDIATYPE
 
eMedŸTy³
);

324 
G‘JobA‰ribu‹s
 (
g‘Wh©
);

325 
S‘JobA‰ribu‹s
 (
JobA‰ribu‹s
 *
pJA
);

327 
	g´iv©e
:

329 
Sy¡emS”viûs
* 
pSS
;

330 
Prš‹r
* 
	gthePrš‹r
;

331 
PrštMode
* 
	gCu¼’tMode
;

334 
	gPageWidth
;

335 
	gIÅutWidth
;

336 
	gOuutWidth
;

337 
PAPER_SIZE
 
	gtheP­”Size
;

338 
BOOL
 
	gU£PageWidth
;

341 
	sP­”SizeM‘rics


344 
	gfPhysiÿlPageX
;

345 
	gfPhysiÿlPageY
;

346 
	gfPršbËPageX
;

347 
	gfPršbËPageY
;

348 
	gfPršbËS¹Y
;

350 cÚ¡ 
P­”SizeM‘rics
 
	gPSM
[
MAX_PAPER_SIZE
];

353 
´šbËwidth
();

354 
´šbËheight
();

355 
´š‹run™sY
();

357 
DRIVER_ERROR
 
Qu®™yS›ve
(
ModeS‘
*& 
Modes
, 
QUALITY_MODE
& 
eQu®™y
);

358 
DRIVER_ERROR
 
S‘CompG¿yMode
(
PrštMode
*& 
»sPM
);

359 
BOOL
 
ModeAg»esW™hH¬dw¬e
(BOOL 
Qu”yPrš‹r
);

361 
DRIVER_ERROR
 
£ix–¥”row
(
IÅutPix–sP”Row
,

362 
OuutPix–sP”Row
);

363 
DRIVER_ERROR
 
£Ëù´štmode
(cÚ¡ 
šdex
);

365 
BOOL
 
	gMadeCompG¿yMode
;

367 
BOOL
 
	gbDoFuÎBËed
;

368 
BOOL
 
	gIÅutIsPageWidth
;

372 
DRIVER_ERROR
 
S–eùDeçuÉMode
();

373 
GUITİM¬gš
();

380 
MEDIATYPE
 
	gm_mtReqMedŸTy³
;

381 
MEDIATYPE
 
	gm_eMedŸTy³
;

383 #ifdeà
APDK_AUTODUPLEX


384 
DUPLEXMODE
 
	gDu¶exMode
;

387 #ifdeà
APDK_EXTENDED_MEDIASIZE


388 
	gCu¡omWidth
;

389 
	gCu¡omHeight
;

392 
MedŸSourû
 
	gm_MedŸSourû
;

394 
JobA‰ribu‹s
 *
	gm_job_©Œibu‹s
;

396 #ifdeà
APDK_CAPTURE


397 
C­tu»_PrštCÚ‹xt
(
IÅutPix–sP”Row
, 
OuutPix–sP”Row
,

398 
PAPER_SIZE
 
ps
,
IO_MODE
 
IOMode
);

399 
C­tu»_S–eùDeviû
(cÚ¡ 
PRINTER_TYPE
 
Mod–
);

400 
C­tu»_S–eùDeviû
(cÚ¡ * 
szDevIdSŒšg
);

401 
C­tu»_S–eùPrštMode
(
mod’um
);

402 
C­tu»_S‘P­”Size
(
PAPER_SIZE
 
ps
, 
BOOL
 
bFuÎBËed
);

403 
C­tu»_R—lizeFÚt
(cÚ¡ 
±r
,cÚ¡ 
šdex
,cÚ¡ 
BYTE
 
bSize
,

404 cÚ¡ 
TEXTCOLOR
 
eCŞÜ
=
BLACK_TEXT
,

405 cÚ¡ 
BOOL
 
bBŞd
=
FALSE
,cÚ¡ BOOL 
bIlic
=FALSE,

406 cÚ¡ 
BOOL
 
bUnd”lše
=
FALSE
);

407 
C­tu»_S‘Pix–sP”Row
(
IÅutPix–sP”Row
,
OuutPix–sP”Row
);

408 
C­tu»_S‘IÅutResŞutiÚ
(
Res
);

409 
C­tu»_dPrštCÚ‹xt
();

413 
	gm_iCİyCouÁ
;

415 
	gm_iMedŸSubty³
;

416 
	gm_iMechOff£t
;

419 
	gAPDK_END_NAMESPACE


	@prnt/hpijs/context2.cpp

33 
	~"h—d”.h
"

34 
	~"pm£Ëù.h
"

35 
	~"´š‹rçùÜy.h
"

37 
	~"h®áÚ”.h
"

38 
	~"cŞÜm©ch.h
"

41 
APDK_BEGIN_NAMESPACE


42 
CŞÜM©ch”
* 
C»©e_CŞÜM©ch”


44 
Sy¡emS”viûs
* 
pSys
,

45 
CŞÜM­
 
cm
,

46 
DyeCouÁ
,

47 
iIÅutWidth


49 
APDK_END_NAMESPACE


51 
APDK_BEGIN_NAMESPACE


53 
PAPER_SIZE
 
MedŸSizeToP­”
(
MedŸSize
 
msize
);

54 
MedŸSize
 
P­”ToMedŸSize
(
PAPER_SIZE
 
psize
);

63 cÚ¡ 
	gPrštCÚ‹xt
::
P­”SizeM‘rics
 
PrštCÚ‹xt
::
PSM
[
MAX_PAPER_SIZE
] =

123 #ifdeà
APDK_EXTENDED_MEDIASIZE


204 #ifdeà
APDK_EXTENDED_MEDIASIZE


243 
	gPrštCÚ‹xt
::
PrštCÚ‹xt


245 
Sy¡emS”viûs
 * 
pSysS”v
,

246 
	gIÅutPix–sP”Row
,

247 
	gOuutPix–sP”Row
,

248 
PAPER_SIZE
 
	gps
,

249 
QUALITY_MODE
 
	geQu®™y
,

250 
MEDIATYPE
 
	geMedŸ
,

251 
COLORMODE
 
	geCŞÜMode
,

252 
BOOL
 
	gbDeviûText


254 
cÚ¡ruùÜ_”rÜ
(
NO_ERROR
),

255 
pSS
(
pSysS”v
),

256 
thePrš‹r
((
Prš‹r
*)
NULL
),

257 
Cu¼’tMode
((
PrštMode
*)
NULL
),

258 
IÅutWidth
(
IÅutPix–sP”Row
),

259 
OuutWidth
(
OuutPix–sP”Row
),

260 
theP­”Size
(
ps
),

261 
	$MadeCompG¿yMode
(
FALSE
)

262 #ifdeà
APDK_AUTODUPLEX


263 , 
	$Du¶exMode
(
DUPLEXMODE_NONE
)

265 #ifdeà
APDK_EXTENDED_MEDIASIZE


266 , 
	`Cu¡omWidth
(0.0),

267 
	$Cu¡omHeight
(0.0)

271 #ifdeà
APDK_CAPTURE


272 
	`C­tu»_PrštCÚ‹xt
(
IÅutPix–sP”Row
,
OuutPix–sP”Row
,
ps
,
pSS
->
IOMode
);

275 
DR
 = 
pSS
->DR;

277 
m_job_©Œibu‹s
 = 
NULL
;

278 
bDoFuÎBËed
 = 
FALSE
;

280 
U£PageWidth
 = (
OuutPix–sP”Row
 == 0);

281 
IÅutIsPageWidth
 = (
IÅutPix–sP”Row
 == 0);

283 
m_mtReqMedŸTy³
 = 
eMedŸ
;

285 
m_MedŸSourû
 = 
sourûT¿yAuto
;

287 
m_iCİyCouÁ
 = 1;

289 ià(!
pSS
->
IOMode
.
bDevID
)

298 iàĞ(
cÚ¡ruùÜ_”rÜ
 = 
DR
->
	`S–eùDeviû
(
pSS
->
¡rMod–
,&ÕSS->
VIPV”siÚ
),pSS->
¡rP’s
,pSS)è!ğ
NO_ERROR
)

300 ià(
cÚ¡ruùÜ_”rÜ
 =ğ
UNSUPPORTED_PRINTER
)

302 
pSS
->
	`Di¥ÏyPrš‹rStus
(
DISPLAY_PRINTER_NOT_SUPPORTED
);

304 
pSS
->
	`BusyWa™
(500è!ğ
JOB_CANCELED
)

311 
	`DBG1
("PrintContext -ƒrror in SelectDevice\n");

317 iàĞ(
cÚ¡ruùÜ_”rÜ
 = 
DR
->
	`In¡ªtŸ‹Prš‹r
(
thePrš‹r
,
pSS
)è!ğ
NO_ERROR
)

319 
	`DBG1
("PrintContext -ƒrror in InstantiatePrinter\n");

324 
pSS
->
	`Adju¡IO
(
thePrš‹r
->
IOMode
);

329 
PAPER_SIZE
 
mªd©ÜyPS
 = 
thePrš‹r
->
	`Mªd©ÜyP­”Size
();

330 ià(
mªd©ÜyPS
 !ğ
UNSUPPORTED_SIZE
)

332 ià((
PSM
[
mªd©ÜyPS
].
fPhysiÿlPageX
 < PSM[
theP­”Size
].fPhysicalPageX))

335 
theP­”Size
 = 
mªd©ÜyPS
;

340 
thePrš‹r
->
	`S‘PMIndiûs
();

342 
cÚ¡ruùÜ_”rÜ
 = 
	`S–eùPrštMode
(
eQu®™y
, 
eMedŸ
, 
eCŞÜMode
, 
bDeviûText
);

344 
CERRCHECK
;

346 
cÚ¡ruùÜ_”rÜ
 = 
thePrš‹r
->
	`CheckInkLev–
();

347 
	}
}

355 
	gPrštCÚ‹xt
::
	$Cu¼’tPrštMode
()

357 
	`ASSERT
(
Cu¼’tMode
);

358 ià(
Cu¼’tMode
 !ğ
NULL
)

360  
Cu¼’tMode
->
myIndex
;

366 
	}
}

392 
DRIVER_ERROR
 
	gPrštCÚ‹xt
::
	$S–eùDeçuÉMode
()

395 
DRIVER_ERROR
 
”r
 = 
	`S–eùPrštMode
 (
QUALITY_NORMAL
, 
MEDIA_PLAIN
, 
COLOR
, 
FALSE
);

396 ià(
”r
 =ğ
WARN_MODE_MISMATCH
)

398 
QUALITY_MODE
 
eq
;

399 
MEDIATYPE
 
em
;

400 
BOOL
 
bText
;

401 
COLORMODE
 
eCŞÜMode
 = 
COLOR
;

402 
	`G‘PrštModeS‘tšgs
 (
eq
, 
em
, 
eCŞÜMode
, 
bText
);

403 ià(
eCŞÜMode
 =ğ
GREY_K
)

404 
”r
 = 
NO_ERROR
;

406  
”r
;

407 
	}
}

418 
DRIVER_ERROR
 
	gPrštCÚ‹xt
::
S–eùPrštMode


420 
QUALITY_MODE
 
eQu®™y
,

421 
MEDIATYPE
 
	geMedŸ
,

422 
COLORMODE
 
	geCŞÜMode
,

423 
BOOL
 
	gbDeviûText


427 ià(
	gthePrš‹r
 =ğ
NULL
)

429  
NO_PRINTER_SELECTED
;

433 
ModeS‘
* 
	gModes
;

434 
ModeS‘
* 
	g‹mpModeS‘
;

435 
ModeS‘
* 
	gŞdModeS‘
;

438 
QUALITY_MODE
 
	g»que¡edQu®™y
 = 
eQu®™y
;

439 
MEDIATYPE
 
	g»que¡edMedŸ
 = 
eMedŸ
;

440 
COLORMODE
 
	g»que¡edCŞÜ
 = 
eCŞÜMode
;

441 
BOOL
 
	g»que¡edText
 = 
bDeviûText
;

443 
PEN_TYPE
 
	g³ns
;

444 
DRIVER_ERROR
 
	g”r
;

445 
PrštMode
* 
	gtmpPM
 = 
NULL
;

449 
	gm_mtReqMedŸTy³
 = 
eMedŸ
;

453 ià(
	gMadeCompG¿yMode
)

455 
	gpSS
->
F»eMem
((
BYTE
*)
Cu¼’tMode
->
cm­
.
ulM­1
);

456 
d–‘e
 
	gCu¼’tMode
;

457 
	gCu¼’tMode
 = 
NULL
;

458 
	gMadeCompG¿yMode
 = 
FALSE
;

462 
	gModes
 = 
Ãw
 
ModeS‘
;

463 
	gmc
 = 
thePrš‹r
->
G‘ModeCouÁ
();

464 
	gi
 = 0; i < 
	gmc
; i++)

466 ià(
	gModes
->
Aµ’d
(
thePrš‹r
->
G‘Mode
(
i
)))

468  
	gALLOCMEM_ERROR
;

472 
	g³ns
 = 
thePrš‹r
->
Aùu®P’s
();

474 ià(
	g³ns
 =ğ
NO_PEN
)

476 
thePrš‹r
->
S‘P’s
ÑhePrš‹r->
DeçuÉP’S‘
());

479 
	g‹mpModeS‘
 = 
Modes
->
P’Com·tibËSub£t
(
³ns
);

481 ià(
	g‹mpModeS‘
 =ğ
NULL
)

483  
ALLOCMEM_ERROR
;

486 ià(
	g‹mpModeS‘
->
IsEm±y
())

488 
d–‘e
 
	gModes
;

489 
d–‘e
 
	g‹mpModeS‘
;

490 
ASSERT
(0);

491  
	gSYSTEM_ERROR
;

495 
d–‘e
 
	gModes
;

496 
	gModes
 = 
‹mpModeS‘
;

500 ià(
	g³ns
 =ğ
BLACK_PEN
 || 
³ns
 =ğ
MDL_PEN
)

502 
eCŞÜMode
 = 
GREY_K
;

504 ià((
	g³ns
 =ğ
COLOR_PEN
è&& (
eCŞÜMode
 =ğ
GREY_K
))

506 
eCŞÜMode
 = 
GREY_CMY
;

509 
	g‹mpModeS‘
 = 
Modes
->
CŞÜCom·tibËSub£t
(
eCŞÜMode
);

511 ià(
	g‹mpModeS‘
 =ğ
NULL
)

513  
ALLOCMEM_ERROR
;

516 ià(
	g‹mpModeS‘
->
IsEm±y
())

518 
d–‘e
 
	g‹mpModeS‘
;

520 ià(
	geCŞÜMode
 =ğ
GREY_CMY
)

522 ià(
thePrš‹r
->
CMYM­
 !ğ
NULL
)

524 
”r
=
S‘CompG¿yMode
(
tmpPM
);

525 
	gERRCHECK
;

526 
	gModes
->
Aµ’d
(
tmpPM
);

529 ià(
	g³ns
 =ğ
BLACK_PEN
)

531 
eCŞÜMode
 = 
GREY_K
;

535 
	geCŞÜMode
 = 
COLOR
;

540  
	gSYSTEM_ERROR
;

542 
	g‹mpModeS‘
 = 
Modes
->
CŞÜCom·tibËSub£t
(
eCŞÜMode
);

544 ià(
	g‹mpModeS‘
 =ğ
NULL
)

546  
ALLOCMEM_ERROR
;

550 
d–‘e
 
	gModes
;

551 if(
	g‹mpModeS‘
->
IsEm±y
())

553 
d–‘e
 
	g‹mpModeS‘
;

554  
	gSYSTEM_ERROR
;

557 
	gModes
 = 
‹mpModeS‘
;

558 
	g‹mpModeS‘
 = 
NULL
;

567 ià(
	gbDeviûText
)

569 
	g‹mpModeS‘
 = 
Modes
->
FÚtC­abËSub£t
();

570 ià(
	g‹mpModeS‘
 =ğ
NULL
)

572  
ALLOCMEM_ERROR
;

575 ià(
	g‹mpModeS‘
->
IsEm±y
())

577 
d–‘e
 
	g‹mpModeS‘
;

578 
	g‹mpModeS‘
 = 
NULL
;

579 
	gbDeviûText
 = 
FALSE
;

583 
d–‘e
 
	gModes
;

584 
	gModes
 = 
‹mpModeS‘
;

585 
	g‹mpModeS‘
 = 
NULL
;

594 
	gŞdModeS‘
 = 
Ãw
 
ModeS‘
(
Modes
);

595 ià(
	gŞdModeS‘
 =ğ
NULL
)

597  
ALLOCMEM_ERROR
;

601 
	g”r
 = 
Qu®™yS›ve
(
Modes
, 
eQu®™y
);

602 
	gERRCHECK
;

608 
	g‹mpModeS‘
 = 
Modes
->
MedŸSub£t
(
eMedŸ
);

609 ià(
	g‹mpModeS‘
 =ğ
NULL
)

611  
ALLOCMEM_ERROR
;

613 ià(
	g‹mpModeS‘
->
IsEm±y
())

615 
d–‘e
 
	g‹mpModeS‘
;

617 
	g‹mpModeS‘
 = 
ŞdModeS‘
->
MedŸSub£t
(
eMedŸ
);

618 ià(
	g‹mpModeS‘
 =ğ
NULL
)

620  
ALLOCMEM_ERROR
;

622 ià(
	g‹mpModeS‘
->
IsEm±y
())

625 
d–‘e
 
	g‹mpModeS‘
;

626 
	geMedŸ
 = 
Modes
->
H—dPrštMode
()->
G‘MedŸTy³
();

630 
	geQu®™y
 = 
‹mpModeS‘
->
H—dPrštMode
()->
G‘Qu®™yMode
();

631 
d–‘e
 
	gModes
;

632 
	gModes
 = 
‹mpModeS‘
;

634 ià(
	gModes
->
Size
() > 1)

636 
	g”r
 = 
Qu®™yS›ve
(
Modes
,
eQu®™y
);

637 
	gERRCHECK
;

643 
d–‘e
 
	gModes
;

644 
	gModes
 = 
‹mpModeS‘
;

647 
d–‘e
 
	gŞdModeS‘
;

651 ià(
	gModes
->
Size
() != 1)

653 
ASSERT
(0);

654  
	gSYSTEM_ERROR
;

657 
	gCu¼’tMode
 = 
Modes
->
H—dPrštMode
();

658 ià(
	gCu¼’tMode
 =ğ
tmpPM
)

660 
MadeCompG¿yMode
=
TRUE
;

663 
d–‘e
 
	gModes
;

667 
	giRa¡”Width
 = 
IÅutIsPageWidth
 ? 0 : 
IÅutWidth
;

668 
	g”r
 = 
£ix–¥”row
(
iRa¡”Width
, 
OuutWidth
);

669 if(
	g”r
 !ğ
NO_ERROR
)

671  
”r
;

677 ià((
	g»que¡edCŞÜ
 !ğ
eCŞÜMode
) ||

678 (((
»que¡edMedŸ
 !ğ
eMedŸ
) ||

679 (
»que¡edQu®™y
 !ğ
eQu®™y
)è&& 
Cu¼’tMode
->
medium
 !ğ
medŸAuto
) ||

680 (
»que¡edText
 && !
bDeviûText
))

682  
WARN_MODE_MISMATCH
;

685  
	gNO_ERROR
;

699 
DRIVER_ERROR
 
	gPrštCÚ‹xt
::
G‘PrštModeS‘tšgs


701 
QUALITY_MODE
& 
eQu®™y
,

702 
	gMEDIATYPE
& 
	geMedŸ
,

703 
	gCOLORMODE
& 
	geCŞÜMode
,

704 
	gBOOL
& 
	gbDeviûText


707 ià(
	gCu¼’tMode
 =ğ
NULL
)

709  
SYSTEM_ERROR
;

713 
	gCu¼’tMode
->
G‘V®ues
(
eQu®™y
, 
eMedŸ
, 
eCŞÜMode
, 
bDeviûText
);

715  
	gNO_ERROR
;

723 
DRIVER_ERROR
 
	gPrštCÚ‹xt
::
S‘P’S‘


725 
PEN_TYPE
 
eP’


728 ià(
thePrš‹r
 =ğ
NULL
)

730  
NO_PRINTER_SELECTED
;

732  
	gthePrš‹r
->
S‘P’s
(
eP’
);

736 
BOOL
 
	gPrštCÚ‹xt
::
ModeAg»esW™hH¬dw¬e


738 
BOOL
 
Qu”yPrš‹r


742 
BOOL
 
ag»e
 = 
FALSE
;

743 
PEN_TYPE
 
	geP’
;

753 ià(
	gpSS
->
	gIOMode
.
	gbDevID
 =ğ
FALSE
)

755  
TRUE
;

758 ià(
	gthePrš‹r
->
P¬£P’Info
(
eP’
,
Qu”yPrš‹r
è=ğ
NO_ERROR
)

761 
i
 = 0; 
	gi
 < 
	gMAX_COMPATIBLE_PENS
; i++)

763 ià(
	geP’
 =ğ
Cu¼’tMode
->
Com·tibËP’s
[
i
])

765 
ag»e
 = 
TRUE
;

770  
	gag»e
;

774 
BOOL
 
	gPrštCÚ‹xt
::
PhÙoT¿yP»£Á


776 
BOOL
 
bQu”yPrš‹r


779 ià(
thePrš‹r
 =ğ
NULL
)

781  
FALSE
;

785  
	gthePrš‹r
->
PhÙoT¿yP»£Á
 (
bQu”yPrš‹r
);

793 
PHOTOTRAY_STATE
 
	gPrštCÚ‹xt
::
PhÙoT¿yEngaged


795 
BOOL
 
bQu”yPrš‹r


798 ià(
thePrš‹r
 =ğ
NULL
)

800  
DISENGAGED
;

804  
	gthePrš‹r
->
PhÙoT¿yEngaged
 (
bQu”yPrš‹r
);

810 
BOOL
 
	gPrštCÚ‹xt
::
	$HagakiF“dP»£Á
(
BOOL
 
bQu”yPrš‹r
)

812 ià(
thePrš‹r
 =ğ
NULL
)

814  
FALSE
;

818  
thePrš‹r
->
	`HagakiF“dP»£Á
(
bQu”yPrš‹r
);

820 
	}
}

822 #ifdeà
APDK_AUTODUPLEX


824 
BOOL
 
	gPrštCÚ‹xt
::
	$HagakiF“dDu¶ex”P»£Á
(
BOOL
 
bQu”yPrš‹r
)

826 ià(
thePrš‹r
 =ğ
NULL
)

828  
FALSE
;

832  
thePrš‹r
->
	`HagakiF“dDu¶ex”P»£Á
(
bQu”yPrš‹r
);

834 
	}
}

841 
	gPrštCÚ‹xt
::~
	$PrštCÚ‹xt
()

843 #ifdeà
APDK_CAPTURE


844 
	`C­tu»_dPrštCÚ‹xt
();

846 
	`DBG1
("deleting PrintContext\n");

848 ià(
thePrš‹r
)

850 
d–‘e
 
thePrš‹r
;

853 ià(
MadeCompG¿yMode
)

855 
pSS
->
	`F»eMem
((
BYTE
*)
Cu¼’tMode
->
cm­
.
ulM­1
);

856 
d–‘e
 
Cu¼’tMode
;

858 ià(
m_job_©Œibu‹s
)

860 
d–‘e
 [] 
m_job_©Œibu‹s
;

862 
	}
}

873 
	gPrštCÚ‹xt
::
	$PhysiÿlPageSizeX
()

875 ià(
m_job_©Œibu‹s
)

877  
m_job_©Œibu‹s
->
medŸ_©Œibu‹s
.
fPhysiÿlWidth
;

880 ià(
thePrš‹r
 =ğ
NULL
)

885 
xOv”S´ay
, 
yOv”S´ay
;

886 
FuÎbËedTy³
 
fbTy³
;

887 #ifdeà
APDK_EXTENDED_MEDIASIZE


888 
PhysiÿlPageX
 = (
theP­”Size
 =ğ
CUSTOM_SIZE
è? 
Cu¡omWidth
 : 
PSM
[theP­”Size].
fPhysiÿlPageX
;

890 
PhysiÿlPageX
 = 
PSM
[
theP­”Size
].
fPhysiÿlPageX
;

893 ià(
bDoFuÎBËed
 && (
thePrš‹r
->
	`FuÎBËedC­abË
 (
theP­”Size
, &
fbTy³
, &
xOv”S´ay
, &
yOv”S´ay
)))

895  (
PhysiÿlPageX
 + 
xOv”S´ay
);

898  
PhysiÿlPageX
;

899 
	}
}

903 
	gPrštCÚ‹xt
::
	$PhysiÿlPageSizeY
()

905 ià(
m_job_©Œibu‹s
)

907  
m_job_©Œibu‹s
->
medŸ_©Œibu‹s
.
fPhysiÿlHeight
;

910 ià(
thePrš‹r
 =ğ
NULL
)

915 
xOv”S´ay
, 
yOv”S´ay
;

916 
FuÎbËedTy³
 
fbTy³
;

918 #ifdeà
APDK_EXTENDED_MEDIASIZE


919 
PhysiÿlPageY
 = (
theP­”Size
 =ğ
CUSTOM_SIZE
è? 
Cu¡omHeight
 : 
PSM
[theP­”Size].
fPhysiÿlPageY
;

921 
PhysiÿlPageY
 = 
PSM
[
theP­”Size
].
fPhysiÿlPageY
;

924 ià(
bDoFuÎBËed
 && (
thePrš‹r
->
	`FuÎBËedC­abË
 (
theP­”Size
, &
fbTy³
, &
xOv”S´ay
, &
yOv”S´ay
)))

926  (
PhysiÿlPageY
 + 
yOv”S´ay
);

929  
PhysiÿlPageY
;

930 
	}
}

934 
	gPrštCÚ‹xt
::
	$PršbËWidth
()

937  
	`´šbËwidth
();

938 
	}
}

946 
	gPrštCÚ‹xt
::
	$´šbËwidth
()

949 ià(
m_job_©Œibu‹s
)

951  
m_job_©Œibu‹s
->
medŸ_©Œibu‹s
.
fPršbËWidth
;

954 ià(
thePrš‹r
 =ğ
NULL
)

959 
xOv”S´ay
, 
yOv”S´ay
;

960 
FuÎbËedTy³
 
fbTy³
;

962 #ifdeà
APDK_EXTENDED_MEDIASIZE


963 
PhysiÿlPageX
 = (
theP­”Size
 =ğ
CUSTOM_SIZE
è? 
Cu¡omWidth
 : 
PSM
[theP­”Size].
fPhysiÿlPageX
;

964 
PršbËPageX
 = (
theP­”Size
 =ğ
CUSTOM_SIZE
è? 
Cu¡omWidth
 - (è(0.25+0.25è: 
PSM
[theP­”Size].
fPršbËPageX
;

966 
PhysiÿlPageX
 = 
PSM
[
theP­”Size
].
fPhysiÿlPageX
;

967 
PršbËPageX
 = 
PSM
[
theP­”Size
].
fPršbËPageX
;

970 ià(
bDoFuÎBËed
 && (
thePrš‹r
->
	`FuÎBËedC­abË
 (
theP­”Size
, &
fbTy³
, &
xOv”S´ay
, &
yOv”S´ay
)))

972  (
PhysiÿlPageX
 + 
xOv”S´ay
);

975 
fM¬gšs
[4];

977 ià(!(
thePrš‹r
->
	`G‘M¬gšs
 (
theP­”Size
, 
fM¬gšs
)))

979  
PršbËPageX
;

981  (
PhysiÿlPageX
 - (
fM¬gšs
[0] + fMargins[1]));

982 
	}
}

986 
	gPrštCÚ‹xt
::
	$PršbËHeight
()

989  
	`´šbËheight
();

990 
	}
}

993 
	gPrštCÚ‹xt
::
	$´šbËheight
()

996 ià(
m_job_©Œibu‹s
)

998  
m_job_©Œibu‹s
->
medŸ_©Œibu‹s
.
fPršbËHeight
;

1001 ià(
thePrš‹r
 =ğ
NULL
)

1017 
xOv”S´ay
, 
yOv”S´ay
;

1018 
FuÎbËedTy³
 
fbTy³
;

1019 #ifdeà
APDK_EXTENDED_MEDIASIZE


1020 
PhysiÿlPageY
 = (
theP­”Size
 =ğ
CUSTOM_SIZE
è? 
Cu¡omHeight
 : 
PSM
[theP­”Size].
fPhysiÿlPageY
;

1021 
PršbËPageY
 = (
theP­”Size
 =ğ
CUSTOM_SIZE
è? 
Cu¡omHeight
 - (è(0.125+0.5è: 
PSM
[theP­”Size].
fPršbËPageY
;

1023 
PhysiÿlPageY
 = 
PSM
[
theP­”Size
].
fPhysiÿlPageY
;

1024 
PršbËPageY
 = 
PSM
[
theP­”Size
].
fPršbËPageY
;

1027 ià(
bDoFuÎBËed
 && (
thePrš‹r
->
	`FuÎBËedC­abË
 (
theP­”Size
, &
fbTy³
, &
xOv”S´ay
, &
yOv”S´ay
)))

1029 ià(
fbTy³
 =ğ
fuÎbËed3EdgeAÎMedŸ
 ||

1030 
fbTy³
 =ğ
fuÎbËed3EdgeNÚPhÙoMedŸ
 ||

1031 
fbTy³
 =ğ
fuÎbËed3EdgePhÙoMedŸ
)

1032  (
PhysiÿlPageY
 - () 0.5);

1033 ià(
fbTy³
 =ğ
fuÎbËed4EdgePhÙoMedŸ
 ||

1034 
fbTy³
 =ğ
fuÎbËed4EdgeNÚPhÙoMedŸ
 ||

1035 
fbTy³
 =ğ
fuÎbËed4EdgeAÎMedŸ
)

1036  (
PhysiÿlPageY
 + 
yOv”S´ay
);

1038  (
PhysiÿlPageY
 - () 0.5);

1051 
fM¬gšs
[4];

1053 ià(!(
thePrš‹r
->
	`G‘M¬gšs
 (
theP­”Size
, 
fM¬gšs
)))

1055  
PršbËPageY
;

1057  (
PhysiÿlPageY
 - (
fM¬gšs
[2] + fMargins[3]));

1058 
	}
}

1062 
	gPrštCÚ‹xt
::
	$PršbËS¹X
()

1064 ià(
m_job_©Œibu‹s
)

1066  
m_job_©Œibu‹s
->
medŸ_©Œibu‹s
.
fPršbËS¹X
;

1069 ià(
thePrš‹r
==
NULL
)

1074 
xOv”S´ay
, 
yOv”S´ay
;

1075 
FuÎbËedTy³
 
fbTy³
;

1076 ià(
bDoFuÎBËed
 && (
thePrš‹r
->
	`FuÎBËedC­abË
 (
theP­”Size
, &
fbTy³
, &
xOv”S´ay
, &
yOv”S´ay
)))

1081 
fM¬gšs
[4];

1083 ià((
thePrš‹r
->
	`G‘M¬gšs
 (
theP­”Size
, 
fM¬gšs
)))

1085  (
fM¬gšs
[0]);

1089 #ifdeà
APDK_EXTENDED_MEDIASIZE


1090 
physwidth
 = (
theP­”Size
 =ğ
CUSTOM_SIZE
è? 
Cu¡omWidth
 : 
PSM
[theP­”Size].
fPhysiÿlPageX
;

1092 
physwidth
 = 
PSM
[
theP­”Size
].
fPhysiÿlPageX
;

1094 
´šbË
 = 
	`´šbËwidth
 ();

1095  ((
physwidth
 - 
´šbË
) / ()2.0 );

1096 
	}
}

1100 
	gPrštCÚ‹xt
::
	$PršbËS¹Y
()

1102 ià(
m_job_©Œibu‹s
)

1104  
m_job_©Œibu‹s
->
medŸ_©Œibu‹s
.
fPršbËS¹Y
;

1107 ià(
thePrš‹r
 =ğ
NULL
)

1112 
xOv”S´ay
, 
yOv”S´ay
;

1113 
FuÎbËedTy³
 
fbTy³
;

1115 ià(
bDoFuÎBËed
 && (
thePrš‹r
->
	`FuÎBËedC­abË
 (
theP­”Size
, &
fbTy³
, &
xOv”S´ay
, &
yOv”S´ay
)))

1120 
fM¬gšs
[4];

1122 ià((
thePrš‹r
->
	`G‘M¬gšs
 (
theP­”Size
, 
fM¬gšs
)))

1124  (
fM¬gšs
[2]);

1127  
PSM
[ 
theP­”Size
 ].
fPršbËS¹Y
;

1128 
	}
}

1131 
	gPrštCÚ‹xt
::
	$´š‹run™sY
()

1134 ià(
thePrš‹r
 =ğ
NULL
)

1138  
Cu¼’tMode
->
ResŞutiÚY
[
C
];

1139 
	}
}

1145 
DRIVER_ERROR
 
	gPrštCÚ‹xt
::
P”fÜmPrš‹rFunùiÚ


1147 
PRINTER_FUNC
 
eFunc


1151 ià(
thePrš‹r
 =ğ
NULL
)

1153  
NO_PRINTER_SELECTED
;

1156 ià(
	geFunc
 =ğ
CLEAN_PEN
)

1158 
thePrš‹r
->
Flush
();

1159  
	gthePrš‹r
->
CËªP’
();

1162 
DBG1
("PerformPrinterFunction: Unknown function\n");

1163  
	gUNSUPPORTED_FUNCTION
;

1180 
PRINTER_TYPE
 
	gPrštCÚ‹xt
::
EnumDeviûs


1182 
FAMILY_HANDLE
& 
çmyHªdË


1185  
pPFI
->
EnumDeviûs
(
çmyHªdË
);

1188 
BOOL
 
	gPrštCÚ‹xt
::
	$Prš‹rFÚtsAvaabË
()

1190 #ià
	`defšed
(
APDK_FONTS_NEEDED
)

1191 ià(
thePrš‹r
 =ğ
NULL
)

1193  
SYSTEM_ERROR
;

1196 ià(
Cu¼’tMode
 =ğ
NULL
)

1198  
SYSTEM_ERROR
;

1200  
Cu¼’tMode
->
bFÚtC­abË
;

1202  
FALSE
;

1204 
	}
}

1210 
DRIVER_ERROR
 
	gPrštCÚ‹xt
::
S–eùDeviû


1212 cÚ¡ 
PRINTER_TYPE
 
Mod–


1215 #ifdeà
APDK_CAPTURE


1216 
C­tu»_S–eùDeviû
(
Mod–
);

1218 
DRIVER_ERROR
 
	g”r
;

1220 ià(
	gthePrš‹r
)

1222 
d–‘e
 
	gthePrš‹r
;

1223 
	gthePrš‹r
 = 
NULL
;

1226 
	g”r
 = 
DR
->
S–eùDeviû
(
Mod–
);

1227 
	gERRCHECK
;

1229 iàĞ(
	g”r
 = 
DR
->
In¡ªtŸ‹Prš‹r
(
thePrš‹r
,
pSS
)è!ğ
NO_ERROR
)

1231 
DBG1
("PrintContext -ƒrror in InstantiatePrinter\n");

1232  
	g”r
;

1235 cÚ¡ * 
	gmod–
;

1236 ià(
¡¾’
(
pSS
->
¡rMod–
) > 0)

1238 
	gmod–
 = 
pSS
->
¡rMod–
;

1242 
	gmod–
 = 
Prš‹¹y³ToSŒšg
(
Mod–
);

1245 
	gpSS
->
Adju¡IO
(
thePrš‹r
->
IOMode
, 
mod–
);

1247 
PAPER_SIZE
 
	gps
 = 
thePrš‹r
->
Mªd©ÜyP­”Size
();

1248 ià(
	gps
 !ğ
UNSUPPORTED_SIZE
)

1250 ià((
PSM
[
ps
].
fPhysiÿlPageX
 < PSM[
theP­”Size
].fPhysicalPageX))

1252 
theP­”Size
 = 
ps
;

1256 ià((
	g”r
 = 
S–eùDeçuÉMode
()è=ğ
NO_ERROR
)

1258 
iRa¡”Width
 = 
IÅutIsPageWidth
 ? 0 : 
IÅutWidth
;

1259 
	g”r
 = 
£ix–¥”row
(
iRa¡”Width
, 
OuutWidth
);

1263 
	gthePrš‹r
->
S‘PMIndiûs
();

1265  
	g”r
;

1279 
DRIVER_ERROR
 
	gPrštCÚ‹xt
::
S–eùDeviû


1281 cÚ¡ * 
szDeviûId


1284 
ASSERT
(
szDeviûId
);

1285 #ifdeà
APDK_CAPTURE


1286 
C­tu»_S–eùDeviû
(
szDeviûId
);

1289 
DRIVER_ERROR
 
	g”r
;

1291 ià(
	gthePrš‹r
)

1293 
d–‘e
 
	gthePrš‹r
;

1294 
	gthePrš‹r
 = 
NULL
;

1297 
FAMILY_HANDLE
 
	gçmyHªdË
 = 
pPFI
->
FšdDevIdM©ch
(
szDeviûId
);

1298 ià(
	gçmyHªdË
 =ğ
NULL
)

1300  
UNSUPPORTED_PRINTER
;

1302 if(0 =ğ
¡ºËn
((cÚ¡ *)
pSS
->
¡rDevID
, 
DevIDBuffSize
))

1304 
¡ºıy
((*)
pSS
->
¡rDevID
,
szDeviûId
,
DevIDBuffSize
);

1306 
	gthePrš‹r
 = 
pPFI
->
C»©ePrš‹r
 (
pSS
, 
çmyHªdË
);

1307 ià(
	gthePrš‹r
->
	gcÚ¡ruùÜ_”rÜ
 !ğ
NO_ERROR
)

1309  
thePrš‹r
->
cÚ¡ruùÜ_”rÜ
;

1312 cÚ¡ * 
	gmod–
 = 
pPFI
->
G‘FamyName
 (
çmyHªdË
);

1314 
	gpSS
->
Adju¡IO
 (
thePrš‹r
->
IOMode
, 
mod–
);

1316 
PAPER_SIZE
 
	gps
 = 
thePrš‹r
->
Mªd©ÜyP­”Size
 ();

1317 ià(
	gps
 !ğ
UNSUPPORTED_SIZE
)

1319 ià((
PSM
[
ps
].
fPhysiÿlPageX
 < PSM[
theP­”Size
].fPhysicalPageX))

1321 
theP­”Size
 = 
ps
;

1325 ià((
	g”r
 = 
S–eùDeçuÉMode
()è=ğ
NO_ERROR
)

1327 
iRa¡”Width
 = 
IÅutIsPageWidth
 ? 0 : 
IÅutWidth
;

1328 
	g”r
 = 
£ix–¥”row
(
iRa¡”Width
, 
OuutWidth
);

1332 
	gthePrš‹r
->
S‘PMIndiûs
();

1334  
	g”r
;

1339 
DRIVER_ERROR
 
	gPrštCÚ‹xt
::
£ix–¥”row


1341 
IÅutPix–sP”Row
,

1342 
	gOuutPix–sP”Row


1346 
	gba£»s
;

1347 
	g´štwidth
;

1349 ià(
	gCu¼’tMode
 =ğ
NULL
)

1351  
NO_ERROR
;

1354 
	gba£»s
 = 
Cu¼’tMode
->
Ba£ResX
;

1355 
	gResBoo¡
 = 
Cu¼’tMode
->
Ba£ResX
 / Cu¼’tMode->
Ba£ResY
;

1357 ià(
	gResBoo¡
 == 0)

1359 
ResBoo¡
 = 1;

1361 
	gba£»s
 /ğ
ResBoo¡
;

1363 
	g´štwidth
 = 
´šbËwidth
();

1365 
	gPageWidth
 = ()()(()
ba£»s
 * 
´štwidth
 + 0.5);

1367 ià(
	gIÅutPix–sP”Row
 == 0)

1369 ià(
U£PageWidth
)

1371 
IÅutPix–sP”Row
 = 
PageWidth
;

1375  
	gBAD_INPUT_WIDTH
;

1379 ià(
	gU£PageWidth
)

1381 
	gOuutPix–sP”Row
 = 
PageWidth
;

1384 ià(
	gOuutPix–sP”Row
 > 
	gPageWidth
)

1386  
	gOUTPUTWIDTH_EXCEEDS_PAGEWIDTH
;

1388 ià(
	gIÅutPix–sP”Row
 > 
	gOuutPix–sP”Row
)

1390  
	gUNSUPPORTED_SCALING
;

1394 
	gIÅutWidth
 = 
IÅutPix–sP”Row
;

1395 
	gOuutWidth
 = 
OuutPix–sP”Row
;

1401 
	giSÿËFaùÜ
 = (è(((è
OuutWidth
 / (è
IÅutWidth
) + 0.02);

1402 
	giDiff
 = 
OuutWidth
 - 
IÅutWidth
 * 
iSÿËFaùÜ
;

1403 ià(
	giDiff
 > 0 && iDifà< ((12 * (è
	gba£»s
) / 300))

1405 
	gOuutWidth
 = 
IÅutWidth
 * 
iSÿËFaùÜ
;

1406 ià(
	gOuutWidth
 > 
	gPageWidth
)

1408 
	gOuutWidth
 = 
PageWidth
;

1412  
	gNO_ERROR
;

1419 
DRIVER_ERROR
 
	gPrštCÚ‹xt
::
S‘Pix–sP”Row


1421 
IÅutPix–sP”Row
,

1422 
	gOuutPix–sP”Row


1426 #ifdeà
APDK_CAPTURE


1427 
C­tu»_S‘Pix–sP”Row
(
IÅutPix–sP”Row
, 
OuutPix–sP”Row
);

1429 ià(
	gthePrš‹r
 =ğ
NULL
)

1431  
NO_PRINTER_SELECTED
;

1434  
£ix–¥”row
(
IÅutPix–sP”Row
, 
OuutPix–sP”Row
);

1439 
	gPrštCÚ‹xt
::
	$EfãùiveResŞutiÚX
()

1441 ià(
Cu¼’tMode
 =ğ
NULL
)

1446  
Cu¼’tMode
->
Ba£ResX
;

1447 
	}
}

1451 
	gPrštCÚ‹xt
::
	$EfãùiveResŞutiÚY
()

1453 ià(
Cu¼’tMode
 =ğ
NULL
)

1458  
Cu¼’tMode
->
Ba£ResY
;

1459 
	}
}

1474 
	gPrštCÚ‹xt
::
	$G‘ModeCouÁ
()

1476 ià(
thePrš‹r
 =ğ
NULL
)

1481  
thePrš‹r
->
	`G‘ModeCouÁ
();

1482 
	}
}

1485 
DRIVER_ERROR
 
	gPrštCÚ‹xt
::
£Ëù´štmode


1487 cÚ¡ 
šdex


1490 
DRIVER_ERROR
 
”rÜ
 = 
NO_ERROR
;

1492 ià(
	gthePrš‹r
 =ğ
NULL
)

1494  
NO_PRINTER_SELECTED
;

1497 
	gcouÁ
 = 
G‘ModeCouÁ
();

1498 ià(
	gšdex
 > (
	gcouÁ
-1))

1500  
	gINDEX_OUT_OF_RANGE
;

1503 
	gCu¼’tMode
ğ
thePrš‹r
->
G‘Mode
(
šdex
);

1506 
	g”rÜ
 = 
£ix–¥”row
(
IÅutWidth
,
OuutWidth
);

1508 ià(
	g”rÜ
 !ğ
NO_ERROR
)

1511 
”rÜ
 = 
£ix–¥”row
(0,0);

1514 ià(
	g”rÜ
 > 
	gNO_ERROR
)

1516  
	g”rÜ
;

1519 ià(!
ModeAg»esW™hH¬dw¬e
(
FALSE
))

1521  
	gWARN_MODE_MISMATCH
;

1525  
	g”rÜ
;

1534 
DRIVER_ERROR
 
	gPrštCÚ‹xt
::
S–eùPrštMode


1536 cÚ¡ 
šdex


1539 #ifdeà
APDK_CAPTURE


1540 
C­tu»_S–eùPrštMode
(
šdex
);

1542  
£Ëù´štmode
(
šdex
);

1553 
DRIVER_ERROR
 
	gPrštCÚ‹xt
::
	$S‘P­”Size
 (
PAPER_SIZE
 
ps
, 
BOOL
 
bFuÎBËed
)

1555 #ifdeà
APDK_CAPTURE


1556 
	`C­tu»_S‘P­”Size
(
ps
, 
bFuÎBËed
);

1559 
DRIVER_ERROR
 
”r
;

1560 ià(
thePrš‹r
 =ğ
NULL
)

1562  
NO_PRINTER_SELECTED
;

1566 
PAPER_SIZE
 
psMªd©ÜyPS
;

1567 
DRIVER_ERROR
 
psE¼Ü
 = 
NO_ERROR
;

1568 ià((
psMªd©ÜyPS
 = 
thePrš‹r
->
	`Mªd©ÜyP­”Size
()è!ğ
UNSUPPORTED_SIZE
)

1570 #ifdeà
APDK_EXTENDED_MEDIASIZE


1571 
ReqPhysWidth
 = (
ps
 =ğ
CUSTOM_SIZE
è? 
Cu¡omWidth
 : 
PSM
[ps].
fPhysiÿlPageX
;

1573 
ReqPhysWidth
 = 
PSM
[
ps
].
fPhysiÿlPageX
;

1575 ià((
ReqPhysWidth
 > 
PSM
[
psMªd©ÜyPS
].
fPhysiÿlPageX
))

1589 
ps
 = 
psMªd©ÜyPS
;

1590 
psE¼Ü
 = 
WARN_ILLEGAL_PAPERSIZE
;

1594 
theP­”Size
 = 
ps
;

1596 
bDoFuÎBËed
 = 
bFuÎBËed
;

1598 
iRa¡”Width
 = 
IÅutIsPageWidth
 ? 0 : 
IÅutWidth
;

1599 
”r
 = 
	`£ix–¥”row
 (
iRa¡”Width
, 
OuutWidth
);

1605 ià(
”r
 =ğ
NO_ERROR
 && 
psE¼Ü
 != NO_ERROR)

1607  
WARN_ILLEGAL_PAPERSIZE
;

1614 ià(
”r
 =ğ
NO_ERROR
 && 
bFuÎBËed
)

1616 
x
;

1617 
FuÎbËedTy³
 
fbTy³
;

1621 ià(!(
thePrš‹r
->
	`FuÎBËedC­abË
 (
ps
, &
fbTy³
, &
x
, &x)))

1622  
WARN_FULL_BLEED_UNSUPPORTED
;

1625 ià(
fbTy³
 =ğ
fuÎbËedNÙSuµÜ‹d
)

1627  
WARN_FULL_BLEED_UNSUPPORTED
;

1629 ià(
fbTy³
 =ğ
fuÎbËed3EdgeAÎMedŸ
)

1631  
WARN_FULL_BLEED_3SIDES
;

1633 ià(
fbTy³
 =ğ
fuÎbËed3EdgeNÚPhÙoMedŸ
)

1635  
WARN_FULL_BLEED_3SIDES
;

1637 ià(
fbTy³
 =ğ
fuÎbËed3EdgePhÙoMedŸ
)

1639  
WARN_FULL_BLEED_3SIDES_PHOTOPAPER_ONLY
;

1641 ià(
fbTy³
 =ğ
fuÎbËed4EdgePhÙoMedŸ
)

1643  
WARN_FULL_BLEED_PHOTOPAPER_ONLY
;

1645 ià(
fbTy³
 =ğ
fuÎbËed4EdgeAÎMedŸ
)

1647  
NO_ERROR
;

1649 ià(
fbTy³
 =ğ
fuÎbËed4EdgeNÚPhÙoMedŸ
)

1651  
NO_ERROR
;

1655  
”r
;

1656 
	}
}

1659 
PAPER_SIZE
 
	gPrštCÚ‹xt
::
	$G‘P­”Size
()

1661  
theP­”Size
;

1662 
	}
}

1673 
PRINTER_TYPE
 
	gPrštCÚ‹xt
::
	$S–eùedDeviû
()

1675 ià(
thePrš‹r
 =ğ
NULL
)

1677  
UNSUPPORTED
;

1679  (
PRINTER_TYPE
)
DR
->
deviû
;

1680 
	}
}

1686 cÚ¡ * 
	gPrštCÚ‹xt
::
	$Prš‹rMod–
()

1688 ià((
pSS
 =ğ
NULL
è|| (
thePrš‹r
 == NULL))

1690  (cÚ¡ *)
NULL
;

1693  
pSS
->
¡rMod–
;

1694 
	}
}

1700 cÚ¡ * 
	gPrštCÚ‹xt
::
Prš‹¹y³ToSŒšg


1702 
PRINTER_TYPE
 
±


1705  
Mod–Name
[
±
];

1713 
DRIVER_ERROR
 
	gPrštCÚ‹xt
::
S’dPrš‹rR—dyD©a


1715 
BYTE
* 
¡»am
,

1716 
	gsize


1719 ià(
	g¡»am
 =ğ
NULL
)

1721  
NULL_POINTER
;

1724 ià(
	gthePrš‹r
 =ğ
NULL
)

1726  
NO_PRINTER_SELECTED
;

1729  
	gthePrš‹r
->
S’d
(
¡»am
, 
size
);

1737 
	gPrštCÚ‹xt
::
Flush


1739 
FlushSize


1742 if(
thePrš‹r
 !ğ
NULL
)

1744 
thePrš‹r
->
Flush
(
FlushSize
);

1755 
DRIVER_ERROR
 
	gPrštCÚ‹xt
::
PagesPrš‹d


1757 & 
couÁ


1760 ià(
thePrš‹r
 =ğ
NULL
)

1762  
NO_PRINTER_SELECTED
;

1765  
	gthePrš‹r
->
PagesPrš‹d
(
couÁ
);

1771 
BOOL
 
	gPrštCÚ‹xt
::
	$SuµÜtS•¬©eBÏck
()

1773 ià(
thePrš‹r
 =ğ
NULL
 || 
Cu¼’tMode
 == NULL)

1775  
FALSE
;

1779 ià(
Cu¼’tMode
->
dyeCouÁ
 == 3 || CurrentMode->dyeCount == 6)

1781  
FALSE
;

1785  
thePrš‹r
->
	`SuµÜtS•¬©eBÏck
 (
Cu¼’tMode
);

1788 
	}
}

1790 #ifdeà
APDK_AUTODUPLEX


1795 
BOOL
 
	gPrštCÚ‹xt
::
S–eùDu¶exPrštšg


1797 
DUPLEXMODE
 
du¶exmode


1800 ià(
thePrš‹r
 =ğ
NULL
 || 
Cu¼’tMode
 == NULL)

1802  
FALSE
;

1804 ià(!
	gCu¼’tMode
->
	gbDu¶exC­abË
)

1806  
	gFALSE
;

1808 
	gCu¼’tMode
->
S‘Du¶exMode
 (
du¶exmode
);

1809  
	gTRUE
;

1816 
DUPLEXMODE
 
	gPrštCÚ‹xt
::
	$Qu”yDu¶exMode
 ()

1818 ià(
thePrš‹r
 =ğ
NULL
 || 
Cu¼’tMode
 == NULL)

1820  
DUPLEXMODE_NONE
;

1822  
Cu¼’tMode
->
	`Qu”yDu¶exMode
 ();

1823 
	}
}

1829 
BOOL
 
	gPrštCÚ‹xt
::
	$RÙ©eImageFÜBackPage
 ()

1831 ià(
thePrš‹r
 =ğ
NULL
)

1832  
TRUE
;

1833  
thePrš‹r
->
	`RÙ©eImageFÜBackPage
 ();

1834 
	}
}

1838 #ifdeà
APDK_EXTENDED_MEDIASIZE


1843 
BOOL
 
	gPrštCÚ‹xt
::
	$S‘Cu¡omSize
 (
width
, 
height
)

1845 
Cu¡omWidth
=
width
;

1846 
Cu¡omHeight
=
height
;

1847  
NO_ERROR
;

1848 
	}
}

1853 
	gPrštCÚ‹xt
::
	$GUITİM¬gš
()

1861 #ifdeà
APDK_AUTODUPLEX


1862 ià(
Cu¼’tMode
->
	`Qu”yDu¶exMode
 (è!ğ
DUPLEXMODE_NONE
)

1864  138 * (
	`EfãùiveResŞutiÚY
() / 300);

1867  26 * (
	`EfãùiveResŞutiÚY
() / 300);

1868 
	}
}

1885 
DRIVER_ERROR
 
	gPrštCÚ‹xt
::
Qu®™yS›ve


1887 
ModeS‘
*& 
Modes
,

1888 
	gQUALITY_MODE
& 
	geQu®™y


1891 
ModeS‘
* 
	g‹mpModeS‘
 = 
Modes
->
Qu®™ySub£t
(
eQu®™y
);

1892 ià(
	g‹mpModeS‘
 =ğ
NULL
)

1894  
ALLOCMEM_ERROR
;

1897 ià(
	g‹mpModeS‘
->
IsEm±y
())

1899 
d–‘e
 
	g‹mpModeS‘
;

1900 
	geQu®™y
 = 
QUALITY_NORMAL
;

1901 
	g‹mpModeS‘
 = 
Modes
->
Qu®™ySub£t
(
eQu®™y
);

1903 ià(
	g‹mpModeS‘
 =ğ
NULL
)

1905  
ALLOCMEM_ERROR
;

1908 ià(
	g‹mpModeS‘
->
IsEm±y
())

1910 
d–‘e
 
	g‹mpModeS‘
;

1911 
	g‹mpModeS‘
 = 
Modes
->
H—d
();

1913 ià(
	g‹mpModeS‘
 =ğ
NULL
)

1915  
ALLOCMEM_ERROR
;

1918 ià(
	g‹mpModeS‘
->
IsEm±y
())

1920 
d–‘e
 
	g‹mpModeS‘
;

1921  
	gSYSTEM_ERROR
;

1924 
	geQu®™y
 = 
‹mpModeS‘
->
H—dPrštMode
()->
G‘Qu®™yMode
();

1928 
d–‘e
 
	gModes
;

1929 
	gModes
=
‹mpModeS‘
;

1930  
	gNO_ERROR
;

1934 
DRIVER_ERROR
 
	gPrštCÚ‹xt
::
S‘CompG¿yMode


1936 
PrštMode
*& 
»sPM


1939 
DRIVER_ERROR
 
”r
;

1940 
CŞÜM©ch”
* 
	gpCŞÜM©ch”
;

1941 
ušt32_t
* 
	gg¿ym­
 = (ušt32_t*)
pSS
->
AÎocMem
((uint32_t)*9*9*9);

1943 ià(
	gg¿ym­
==
NULL
)

1945  
ALLOCMEM_ERROR
;

1948 
CŞÜM­
 
	gcm
;

1949 
	gcm
.
	gulM­1
 = 
thePrš‹r
->
CMYM­
;

1951 ià(
	gcm
.
	gulM­1
==
NULL
)

1953  
SYSTEM_ERROR
;

1955 
	gcm
.
	gulM­2
 = 
NULL
;

1956 
	gcm
.
	gulM­3
 = 
NULL
;

1958 
PEN_TYPE
 
	g³n
 = 
thePrš‹r
->
Aùu®P’s
();

1959 
	gnumšks
;

1961 ià(
	g³n
 =ğ
COLOR_PEN
)

1963 
numšks
 = 3;

1967 
	gnumšks
 = 4;

1970 
	gpCŞÜM©ch”
 = 
C»©e_CŞÜM©ch”
(
pSS
, 
cm
,
numšks
, 
OuutWidth
);

1972 
	g”r
 = 
pCŞÜM©ch”
->
MakeG¿yM­
(
thePrš‹r
->
CMYM­
, 
g¿ym­
);

1973 
d–‘e
 
	gpCŞÜM©ch”
;

1974 
	gpCŞÜM©ch”
 = 
NULL
;

1976 
	gERRCHECK
;

1978 ià(
	g³n
 =ğ
COLOR_PEN
)

1980 
»sPM
 = 
Ãw
 
CMYG¿yMode
(
g¿ym­
);

1984 
	g»sPM
 = 
Ãw
 
KCMYG¿yMode
(
g¿ym­
);

1987 ià(
	g»sPM
 =ğ
NULL
)

1989  
ALLOCMEM_ERROR
;

1993 ià(
	g³n
 =ğ
COLOR_PEN
)

1995 
»sPM
->
bFÚtC­abË
 = 
FALSE
;

1999 
	g»sPM
->
	gmyIndex
 = 
thePrš‹r
->
G‘ModeCouÁ
();

2009 
PrštMode
 *
	gpPM
 = 
thePrš‹r
->
G‘Mode
 (
DEFAULTMODE_INDEX
);

2012 ià(
	gpPM
->
	gResŞutiÚX
[
K
] != 300)

2014 
»sPM
->
theQu®™y
 = 
qu®™yD¿á
;

2015 
	g»sPM
->
	gpmQu®™y
 = 
QUALITY_DRAFT
;

2023 
	g»sPM
->
	gCÚfig
.
	gbCom´ess
 = 
pPM
->
CÚfig
.
bCom´ess
;

2026 #ifdeà
APDK_AUTODUPLEX


2027 
	g»sPM
->
	gbDu¶exC­abË
 = 
thePrš‹r
->
bDu¶exC­abË
;

2030  
	gNO_ERROR
;

2046 
DRIVER_ERROR
 
	gPrštCÚ‹xt
::
S‘MedŸSourû


2048 
MedŸSourû
 
num


2051 ià((
num
 > 
sourûT¿yMax
è|| (num < 
sourûT¿yMš
))

2052  
WARN_INVALID_MEDIA_SOURCE
;

2053 
	gm_MedŸSourû
 = 
num
;

2055 ià(
	gthePrš‹r
 !ğ
NULL
)

2057 
BOOL
 
bQu”yHagakiT¿y
 = 
TRUE
;

2058 ià(
	gnum
 =ğ
sourûDu¶ex”NHagakiF“d
 && !
thePrš‹r
->
HagakiF“dP»£Á
(
bQu”yHagakiT¿y
))

2060 
m_MedŸSourû
 = 
sourûT¿yAuto
;

2063  
	gNO_ERROR
;

2066 
	gPrštCÚ‹xt
::
	$G‘Cu¼’tDyeCouÁ
()

2068  
Cu¼’tMode
->
dyeCouÁ
;

2069 
	}
}

2071 
PEN_TYPE
 
	gPrštCÚ‹xt
::
	$G‘DeçuÉP’S‘
()

2073 ià(
thePrš‹r
==
NULL
)

2074  
NO_PEN
;

2075  
thePrš‹r
->
	`DeçuÉP’S‘
();

2076 
	}
}

2078 
PEN_TYPE
 
	gPrštCÚ‹xt
::
	$G‘In¡®ËdP’s
()

2080 if(!
thePrš‹r
)

2081  
NO_PEN
;

2082  
thePrš‹r
->
eP’
;

2083 
	}
}

2085 
	gPrštCÚ‹xt
::
	$Re£tIOMode
 (
BOOL
 
bDevID
, BOOL 
bStus
)

2087 ià(
thePrš‹r
)

2089 
thePrš‹r
->
IOMode
.
bDevID
 = bDevID;

2090 
thePrš‹r
->
IOMode
.
bStus
 = bStatus;

2091 
thePrš‹r
->
bCheckFÜCªûlBu‰Ú
 = 
bDevID
;

2093 
	}
}

2095 
DRIVER_ERROR
 
	gPrštCÚ‹xt
::
	$S‘Prš‹rHšt
 (
PRINTER_HINT
 
eHšt
, 
iV®ue
)

2097 ià(
thePrš‹r
)

2099  
thePrš‹r
->
	`S‘Hšt
 (
eHšt
, 
iV®ue
);

2101  
NO_PRINTER_SELECTED
;

2102 
	}
}

2104 
DRIVER_ERROR
 
	gPrštCÚ‹xt
::
	$S‘MedŸTy³
 (
MEDIATYPE
 
eMedŸTy³
)

2106 ià(
Cu¼’tMode
 =ğ
NULL
)

2107  
NO_PRINTER_SELECTED
;

2108  
Cu¼’tMode
->
	`S‘MedŸTy³
 (
eMedŸTy³
);

2109 
	}
}

2111 
	gPrštCÚ‹xt
::
	$S‘JobA‰ribu‹s
 (
JobA‰ribu‹s
 *
pJA
)

2113 ià(
m_job_©Œibu‹s
 =ğ
NULL
)

2115 
m_job_©Œibu‹s
 = (
JobA‰ribu‹s
 *è
Ãw
 
BYTE
[ (JobAttributes)];

2117 ià(
m_job_©Œibu‹s
 =ğ
NULL
)

2122 
	`memıy
(
m_job_©Œibu‹s
, 
pJA
, (
JobA‰ribu‹s
));

2123 
IÅutWidth
 = (è(
pJA
->
medŸ_©Œibu‹s
.
fPršbËWidth
 * 
	`EfãùiveResŞutiÚX
 ());

2124 
OuutWidth
 = 
IÅutWidth
;

2128 
	}
}

2130 
	gPrštCÚ‹xt
::
	$G‘JobA‰ribu‹s
 (
g‘Wh©
)

2132 ià(
m_job_©Œibu‹s
 =ğ
NULL
)

2135 ià(
g‘Wh©
 =ğ
MEDIASIZE_PCL
)

2136  
m_job_©Œibu‹s
->
medŸ_©Œibu‹s
.
pş_id
;

2138 
	}
}

2140 
	gAPDK_END_NAMESPACE


	@prnt/hpijs/create_so.cpp

32 
	~"h—d”.h
"

33 
	~"sÿËr_İ’.h
"

35 
APDK_BEGIN_NAMESPACE


37 
SÿËr
* 
	gC»©e_SÿËr


39 
Sy¡emS”viûs
* 
	gpSys
,

40 
	gšputwidth
,

41 
	gnum”©Ü
,

42 
	gd’omš©Ü
,

43 
BOOL
 
	gv
,

44 
	giNumInks


47  
Ãw
 
SÿËr_O³n
(
pSys
,
šputwidth
,
num”©Ü
,
d’omš©Ü
,
v
,
iNumInks
);

50 
	gAPDK_END_NAMESPACE


	@prnt/hpijs/creator.cpp

32 
	~"h—d”.h
"

33 
	~"»sourûs.h
"

35 
	~"h±y³s.h
"

36 
	~"cŞÜm©ch.h
"

37 
	~"cŞÜm©ch”_İ’.h
"

38 
	~"h®áÚ”.h
"

39 
	~"h®áÚ”_İ’.h
"

41 
APDK_BEGIN_NAMESPACE


44 
CŞÜM©ch”
* 
	gC»©e_CŞÜM©ch”


46 
Sy¡emS”viûs
* 
	gpSys
,

47 
CŞÜM­
 
	gcm
,

48 
	gDyeCouÁ
,

49 
	giIÅutWidth


52  
Ãw
 
CŞÜM©ch”_O³n
(
pSys
,
cm
,
DyeCouÁ
,
iIÅutWidth
);

56 
H®áÚ”
* 
	gC»©e_H®áÚ”


58 
Sy¡emS”viûs
* 
	gpSys
,

59 
PrštMode
* 
	gpPM
,

60 
	giIÅutWidth
,

61 
	giNumRows
[],

62 
	gHiResFaùÜ
,

63 
BOOL
 
	gu£m©rix


66  
Ãw
 
H®áÚ”_O³n
(
pSys
,
pPM
,
iIÅutWidth
, 
iNumRows
,
HiResFaùÜ
,
u£m©rix
);

69 
BYTE
* 
	$G‘HT3x3_4
()

71  (
BYTE
*)
HT300x3004Ëv–_İ’
;

72 
	}
}

74 
BYTE
* 
	$G‘HT6x6_4
()

76  (
BYTE
*)
HT600x6004Ëv–895_İ’
;

77 
	}
}

79 
BYTE
* 
	$G‘HTBš¬y
()

81  (
BYTE
*)
HTBš¬y_İ’
;

82 
	}
}

84 
BYTE
* 
	$G‘HT6x6_4_970
()

86  (
BYTE
*)
HT600x6004Ëv–970_İ’
;

87 
	}
}

89 #ifdeà
APDK_DJ3320


90 
BYTE
 *
	$G‘HT12x12x1_4100_PhÙo_Be¡
 ()

92  (
BYTE
 *è
HT1200x1200x1PhÙoBe¡_İ’
;

93 
	}
}

97 
BOOL
 
	$Prİr›ryImagšg
()

99  
FALSE
;

100 
	}
}

102 
BOOL
 
	$Prİr›rySÿlšg
()

104  
FALSE
;

105 
	}
}

107 
	gAPDK_END_NAMESPACE


	@prnt/hpijs/debug.h

32 #iâdeà
DEBUG_H


33 
	#DEBUG_H


	)

35 
	~<as£¹.h
>

37 
	#NO_DEBUG
 0x00

	)

38 
	#DBG_ASSERT
 0x01

39 
	#DBG_LVL1
 0x02

40 
	#DBG_DFLT
 (
DBG_ASSERT
 | 
DBG_LVL1
)

41 
	#PUMP
 0x04

42 
	#HARNESS
 0x08

43 

	)

44 #iâdeà
ASSERT


48 
	#ASSERT
(
EXP
è
	`as£¹
(EXP)

	)

51 #iâdeà
DBG1


52 #ià
defšed
(
DEBUG
è&& (
DBG_MASK
 & 
DBG_LVL1
)

53 
	#DBG1
(
STUFF
è
	`´štf
(STUFF)

	)

55 
	#DBG1
(
_STUFF
è((0))

	)

59 #iâdeà
TRACE


60 #ià
defšed
(
DEBUG
è&& (
DBG_MASK
 & 
DBF_LVL1
)

61 
	#TRACE
 
´štf


	)

63 #ià
defšed
(
__GNUC__
)

64 
	#TRACE
(
¬gs
...è(()0)

	)

66 
	#TRACE
 1 ? 0 : 
´štf


	)

71 #ià
defšed
(
DEBUG
è&& (
DBG_MASK
 & 
PUMP
)

72 
	#USAGE_LOG


	)

73 
	#NULL_IO


	)

76 #ià
defšed
(
DEBUG
è&& (
DBG_MASK
 & 
HARNESS
)

77 
	#APDK_CAPTURE


	)

	@prnt/hpijs/dj3320.cpp

31 #ifdeà
APDK_DJ3320


33 
	~"h—d”.h
"

34 
	~"io_defs.h
"

35 
	~"dj3320.h
"

36 
	~"»sourûs.h
"

37 
	~"´š‹½roxy.h
"

39 
APDK_BEGIN_NAMESPACE


40 
BYTE
* 
G‘HT3x3_4
();

41 
BYTE
* 
G‘HT6x6_4_970
();

42 
APDK_END_NAMESPACE


44 
APDK_BEGIN_NAMESPACE


46 
ušt32_t
 
ulM­DJ3320_K_3x3x1
[9 * 9 * 9];

47 
ušt32_t
 
ulM­DJ3320_K_6x6x1
[9 * 9 * 9];

48 
ušt32_t
 
ulM­DJ3320_CMY_3x3x1
[9 * 9 * 9];

49 
ušt32_t
 
ulM­DJ3320_CMY_6x6x1
[9 * 9 * 9];

50 
ušt32_t
 
ulM­DJ3320_KCMY_3x3x1
[9 * 9 * 9];

51 
ušt32_t
 
ulM­DJ3320_KCMY_6x6x1
[9 * 9 * 9];

52 
ušt32_t
 
ulM­DJ970_Gossim”_NÜm®_KCMY
[ 9 * 9 * 9 ];

54 
ušt32_t
 
ulM­DJ3600_KCMY_6x6x1
[9 * 9 * 9];

55 
ušt32_t
 
ulM­DJ3600_ClMlxx_6x6x1
[9 * 9 * 9];

56 
ušt32_t
 
ulM­DJ3600_KCMY_6x6x2
[9 * 9 * 9];

57 
ušt32_t
 
ulM­DJ3600_ClMlxx_6x6x2
[9 * 9 * 9];

58 
ušt32_t
 
ulM­DJ3600_KCMY_3x3x1
[9 * 9 * 9];

59 
ušt32_t
 
ulM­DJ3600_ClMlxx_3x3x1
[9 * 9 * 9];

61 
AsciiHexToBš¬y
(
BYTE
* 
de¡
, * 
¤c
, 
couÁ
);

63 
	#NULL
 0

	)

68 
	gDJ3320
::
	$DJ3320
 (
Sy¡emS”viûs
* 
pSS
, 
BOOL
 
´Ùo
)

69 : 
	`Prš‹r
(
pSS
,
NUM_DJ6XX_FONTS
,
´Ùo
), 
	$m_dsCu¼’tStus
(
DISPLAY_PRINTING
)

72 
pLDLEnÿp
 = 
NULL
;

73 
m_iBy‹sP”Swšg
 = 2;

74 
m_iLdlV”siÚ
 = 1;

75 
m_iCŞÜP’ResŞutiÚ
 = 300;

76 
m_iBÏckP’ResŞutiÚ
 = 1200;

77 
m_iNumBÏckNozzËs
 = 400;

79 ià(
IOMode
.
bDevID
)

81 
bCheckFÜCªûlBu‰Ú
 = 
TRUE
;

82 
cÚ¡ruùÜ_”rÜ
 = 
	`V”ifyP’Info
 ();

83 
CERRCHECK
;

87 
eP’
 = 
BOTH_PENS
;

88 
CMYM­
 = 
ulM­DJ3320_CMY_3x3x1
;

89 
	`In™PrštModes
 ();

91 ià(
pS’dBufãr
)

93 
pSS
->
	`F»eMem
 (
pS’dBufãr
);

95 
pS’dBufãr
 = 
pSS
->
	`AÎocMem
 (
iBuffSize
);

96 
	`CNEWCHECK
 (
pS’dBufãr
);

97 
	}
}

99 
	gDJ3320
::
	$In™PrštModes
 ()

101 ià(
eP’
 =ğ
BLACK_PEN
 ||ƒP’ =ğ
MDL_PEN
)

103 
pMode
[
GRAYMODE_INDEX
] = 
Ãw
 
	`DJ3320KD¿áMode
 ();

104 
pMode
[
DEFAULTMODE_INDEX
] = 
Ãw
 
	`DJ3320G¿yMode
 (
eP’
);

105 
ModeCouÁ
 = 2;

107 ià(
eP’
 =ğ
BOTH_PENS
)

109 
pMode
[
GRAYMODE_INDEX
] = 
Ãw
 
	`DJ3320G¿yMode
 (
eP’
);

110 
pMode
[
DEFAULTMODE_INDEX
] = 
Ãw
 
	`DJ3320NÜm®Mode
 (
eP’
);

111 
pMode
[
SPECIALMODE_INDEX
] = 
Ãw
 
	`DJ3320PhÙoMode
 ();

112 
pMode
[
SPECIALMODE_INDEX
+1] = 
Ãw
 
	`DJ3320KD¿áMode
 ();

113 
pMode
[
SPECIALMODE_INDEX
+2] = 
Ãw
 
	`DJ3320D¿áMode
 (
eP’
);

114 
ModeCouÁ
 = 5;

116 ià(
eP’
 =ğ
MDL_BOTH
)

118 
pMode
[
GRAYMODE_INDEX
] = 
Ãw
 
	`DJ3320G¿yMode
 (
eP’
);

119 
pMode
[
DEFAULTMODE_INDEX
] = 
Ãw
 
	`DJ3600MDLNÜm®Mode
 ();

120 
pMode
[
SPECIALMODE_INDEX
] = 
Ãw
 
	`DJ3320KD¿áMode
 ();

121 
pMode
[
SPECIALMODE_INDEX
+1] = 
Ãw
 
	`DJ3600MDLD¿áMode
 ();

122 
pMode
[
SPECIALMODE_INDEX
+2] = 
Ãw
 
	`DJ3600MDLPhÙoMode
 ();

123 
ModeCouÁ
 = 5;

127 
pMode
[
DEFAULTMODE_INDEX
] = 
Ãw
 
	`DJ3320NÜm®Mode
 (
eP’
);

128 
pMode
[
SPECIALMODE_INDEX
] = 
Ãw
 
	`DJ3320PhÙoMode
 ();

129 
pMode
[
GRAYMODE_INDEX
] = 
Ãw
 
	`DJ3320D¿áMode
 (
eP’
);

130 
ModeCouÁ
 = 3;

132 
	}
}

134 
DRIVER_ERROR
 
	gDJ3320
::
	$S‘P’s
 (
PEN_TYPE
 
eNewP’
)

136 ià(
eNewP’
 =ğ
eP’
)

138  
NO_ERROR
;

140 
	`ASSERT
 (
eNewP’
 <ğ
MAX_PEN_TYPE
);

141 ià(
eNewP’
 > 
MAX_PEN_TYPE
)

143  
UNSUPPORTED_PEN
;

146 
i
 = 0; i < (è
ModeCouÁ
; i++)

148 ià(
pMode
[
i
])

150 
d–‘e
 
pMode
[
i
];

151 
pMode
[
i
] = 
NULL
;

154 
eP’
 = 
eNewP’
;

155 
	`In™PrštModes
 ();

156 
	`Adju¡ResŞutiÚ
 ();

158  
NO_ERROR
;

159 
	}
}

161 
	gDJ3320
::~
	$DJ3320
 ()

163 ià(
eP’
 =ğ
COLOR_PEN
 && 
pMode
[
GRAYMODE_INDEX
])

165 
d–‘e
 
pMode
[
GRAYMODE_INDEX
];

166 
pMode
[
GRAYMODE_INDEX
] = 
NULL
;

168 ià(
pLDLEnÿp
)

169 
d–‘e
 
pLDLEnÿp
;

170 ià(
pS’dBufãr
)

171 
pSS
->
	`F»eMem
 ((
BYTE
 *è
pS’dBufãr
);

172 
pS’dBufãr
 = 
NULL
;

173 
	}
}

175 
	gDJ3320G¿yMode
::
	$DJ3320G¿yMode
 (
PEN_TYPE
 
eP’
è: 
	$PrštMode
 (
ulM­DJ3320_K_6x6x1
)

177 ià(
eP’
 =ğ
MDL_BOTH
)

179 
cm­
.
ulM­2
 = 
ulM­DJ3600_ClMlxx_6x6x1
;

182 
CŞÜD•th
[
K
] = 1;

183 
dyeCouÁ
 = 1;

184 
pmCŞÜ
 = 
GREY_K
;

185 
Com·tibËP’s
[1] = 
BLACK_PEN
;

186 
Com·tibËP’s
[2] = 
MDL_BOTH
;

187 
Com·tibËP’s
[3] = 
MDL_PEN
;

189 
ResŞutiÚX
[0] = 600;

190 
ResŞutiÚY
[0] = 600;

192 
Ba£ResX
 = 600;

193 
Ba£ResY
 = 600;

195 
MixedRes
 = 
FALSE
;

196 
bFÚtC­abË
 = 
FALSE
;

197 
CÚfig
.
bCom´ess
 = 
FALSE
;

198 
	}
}

200 
	gDJ3320KD¿áMode
::
	$DJ3320KD¿áMode
 (è: 
	$G¿yMode
 (
ulM­DJ3320_K_3x3x1
)

202 
bFÚtC­abË
 = 
FALSE
;

203 
CÚfig
.
bCom´ess
 = 
FALSE
;

204 
theQu®™y
 = 
qu®™yD¿á
;

205 
pmQu®™y
 = 
QUALITY_DRAFT
;

206 
Com·tibËP’s
[2] = 
MDL_BOTH
;

207 
Com·tibËP’s
[3] = 
MDL_PEN
;

208 
	}
}

210 
	gDJ3320D¿áMode
::
	$DJ3320D¿áMode
 (
PEN_TYPE
 
eP’
)

211 : 
	$PrštMode
 (
ulM­DJ3320_KCMY_3x3x1
)

214 ià(
eP’
 =ğ
COLOR_PEN
)

216 
Com·tibËP’s
[1] = 
eP’
;

217 
cm­
.
ulM­1
 = 
ulM­DJ3320_CMY_3x3x1
;

218 
dyeCouÁ
 = 3;

221 
i
 = 0; i < 4; i++)

223 
CŞÜD•th
[
i
] = 1;

225 
ResŞutiÚX
[
i
] = 300;

226 
ResŞutiÚY
[
i
] = 300;

228 
MixedRes
 = 
FALSE
;

229 
Ba£ResX
 = 300;

230 
Ba£ResY
 = 300;

231 
bFÚtC­abË
 = 
FALSE
;

232 
pmQu®™y
 = 
QUALITY_DRAFT
;

233 
CÚfig
.
bCom´ess
 = 
FALSE
;

236 
	}
}

238 
	gDJ3320NÜm®Mode
::
	$DJ3320NÜm®Mode
 (
PEN_TYPE
 
eP’
)

239 : 
	$PrštMode
 (
ulM­DJ3320_KCMY_6x6x1
)

242 ià(
eP’
 =ğ
COLOR_PEN
)

244 
Com·tibËP’s
[1] = 
eP’
;

245 
cm­
.
ulM­1
 = 
ulM­DJ3320_CMY_6x6x1
;

246 
dyeCouÁ
 = 3;

249 
i
 = 0; i < 4; i++)

251 
CŞÜD•th
[
i
] = 1;

253 
ResŞutiÚX
[
i
] = 600;

254 
ResŞutiÚY
[
i
] = 600;

257 
Ba£ResX
 = 600;

258 
Ba£ResY
 = 600;

259 
MixedRes
 = 
FALSE
;

261 
bFÚtC­abË
 = 
FALSE
;

262 
CÚfig
.
bCom´ess
 = 
FALSE
;

265 
	}
}

267 
	gDJ3320PhÙoMode
::
	$DJ3320PhÙoMode
 ()

268 : 
	$PrštMode
 (
ulM­DJ970_Gossim”_NÜm®_KCMY
)

271 
i
 = 0; i < 4; i++)

273 
CŞÜD•th
[
i
] = 2;

275 
ResŞutiÚX
[
i
] = 600;

276 
ResŞutiÚY
[
i
] = 600;

278 
CŞÜD•th
[0] = 1;

279 
Com·tibËP’s
[1] = 
COLOR_PEN
;

281 
Ba£ResX
 = 600;

282 
Ba£ResY
 = 600;

283 
MixedRes
 = 
FALSE
;

285 
CŞÜFEDTabË
 = 
	`G‘HT6x6_4_970
 ();

287 
bFÚtC­abË
 = 
FALSE
;

289 
pmQu®™y
 = 
QUALITY_BEST
;

290 
pmMedŸTy³
 = 
MEDIA_PHOTO
;

292 
medium
 = 
medŸGlossy
;

293 
theQu®™y
 = 
qu®™yP»£Á©iÚ
;

295 
CÚfig
.
bCom´ess
 = 
FALSE
;

296 
	}
}

302 
	gDJ3600MDLNÜm®Mode
::
	$DJ3600MDLNÜm®Mode
()

303 : 
	$PrštMode
Ğ
ulM­DJ3600_KCMY_6x6x1
, 
ulM­DJ3600_ClMlxx_6x6x1
 )

305 
dyeCouÁ
=6;

306 
Com·tibËP’s
[0] = 
MDL_BOTH
;

308 
i
 = 0; i < 6; i++)

310 
CŞÜD•th
[
i
] = 1;

312 
ResŞutiÚX
[
i
] = 600;

313 
ResŞutiÚY
[
i
] = 600;

316 
Ba£ResX
 = 600;

317 
Ba£ResY
 = 600;

318 
MixedRes
 = 
FALSE
;

320 
bFÚtC­abË
 = 
FALSE
;

321 
CÚfig
.
bCom´ess
 = 
FALSE
;

322 
	}
}

327 
	gDJ3600MDLPhÙoMode
::
	$DJ3600MDLPhÙoMode
()

328 : 
	$PrštMode
Ğ
ulM­DJ3600_KCMY_6x6x2
, 
ulM­DJ3600_ClMlxx_6x6x2
 )

330 
dyeCouÁ
=6;

331 
Com·tibËP’s
[0] = 
MDL_BOTH
;

333 
i
 = 0; i < 6; i++)

335 
CŞÜD•th
[
i
] = 2;

337 
ResŞutiÚX
[
i
] = 600;

338 
ResŞutiÚY
[
i
] = 600;

341 
Ba£ResX
 = 600;

342 
Ba£ResY
 = 600;

343 
MixedRes
 = 
FALSE
;

346 
CŞÜFEDTabË
 = (
BYTE
*è
HT600x6004Ëv–3600_İ’
;

348 
bFÚtC­abË
 = 
FALSE
;

350 
pmQu®™y
 = 
QUALITY_BEST
;

351 
pmMedŸTy³
 = 
MEDIA_PHOTO
;

353 
medium
 = 
medŸGlossy
;

354 
theQu®™y
 = 
qu®™yP»£Á©iÚ
;

355 
CÚfig
.
bCom´ess
 = 
FALSE
;

356 
	}
}

361 
	gDJ3600MDLD¿áMode
::
	$DJ3600MDLD¿áMode
()

362 : 
	$PrštMode
Ğ
ulM­DJ3600_KCMY_3x3x1
, 
ulM­DJ3600_ClMlxx_3x3x1
 )

364 
dyeCouÁ
=6;

365 
Com·tibËP’s
[0] = 
MDL_BOTH
;

367 
i
 = 0; i < 6; i++)

369 
CŞÜD•th
[
i
] = 1;

371 
ResŞutiÚX
[
i
] = 300;

372 
ResŞutiÚY
[
i
] = 300;

375 
Ba£ResX
 = 300;

376 
Ba£ResY
 = 300;

377 
MixedRes
 = 
FALSE
;

379 
bFÚtC­abË
 = 
FALSE
;

380 
pmQu®™y
 = 
QUALITY_DRAFT
;

381 
CÚfig
.
bCom´ess
 = 
FALSE
;

382 
	}
}

384 
DRIVER_ERROR
 
	gDJ3320
::
	$EnÿpsuÏ‹
 (cÚ¡ 
RASTERDATA
 *
pRa¡”D©a
, 
BOOL
 
bLa¡PÏÃ
)

386  
pLDLEnÿp
->
	`EnÿpsuÏ‹
 (
pRa¡”D©a
->
¿¡”d©a
[
COLORTYPE_COLOR
],…Ra¡”D©a->
¿¡”size
[COLORTYPE_COLOR], 
bLa¡PÏÃ
);

387 
	}
}

389 
H—d”
* 
	gDJ3320
::
	$S–eùH—d”
(
PrštCÚ‹xt
* 
pc
)

391 
pLDLEnÿp
 = 
Ãw
 
	`LDLEnÿp
 (
this
, 
pSS
, 
pc
);

392 ià(
pLDLEnÿp
)

393 
pLDLEnÿp
->
	`AÎoÿ‹Sw©hBufãr
 ((
pc
->
	`OuutPix–sP”Row
 ()) / 8 + 2);

394 ià(
pLDLEnÿp
->
cÚ¡ruùÜ_”rÜ
 !ğ
NO_ERROR
)

395  
NULL
;

397  
Ãw
 
	`H—d”3320
 (
this
,
pc
);

398 
	}
}

404 
DISPLAY_STATUS
 
	gDJ3320
::
	$P¬£E¼Ü
 (
BYTE
 
byStusReg
)

406 
DRIVER_ERROR
 
”r
 = 
NO_ERROR
;

407 
BYTE
 
byDevIDBufãr
[
DevIDBuffSize
];

408 *
pcSŒ
 = 
NULL
;

409 
BYTE
 
byStus1
, 
byStus2
;

411 
	`mem£t
(
byDevIDBufãr
, 0, (byDevIDBuffer));

412 
byStus1
 = 
byStus2
 = 0;

414 ià(
IOMode
.
bDevID
)

418 
”r
 = 
pSS
->
	`G‘DeviûID
 (
byDevIDBufãr
, 
DevIDBuffSize
, 
TRUE
);

419 ià(
”r
)

422 
m_dsCu¼’tStus
 = 
DISPLAY_COMM_PROBLEM
;

423  
DISPLAY_COMM_PROBLEM
;

427 ià(
IOMode
.
bStus
)

429 if(
pLDLEnÿp
->
bNewStus
)

431 
pLDLEnÿp
->
bNewStus
 = 
FALSE
;

434 ià((
pcSŒ
 = (*è
	`¡r¡r
((cÚ¡ *)
pLDLEnÿp
->
byStusBuff
 + 10, "$S:")è=ğ
NULL
)

436 
m_dsCu¼’tStus
 = 
DISPLAY_COMM_PROBLEM
;

437  
DISPLAY_COMM_PROBLEM
;

441 
pcSŒ
 += 5;

442 
byStus1
 = *
pcSŒ
;

444 ià(
byStus1
 == '9')

446 
iTÙ®_SLOW_POLL_CouÁ
 = 0;

447 
m_dsCu¼’tStus
 = 
DISPLAY_TOP_COVER_OPEN
;

448  
DISPLAY_TOP_COVER_OPEN
;

452 
pcSŒ
 += 14;

453 
byStus1
 = *
pcSŒ
++;

454 
byStus2
 = *
pcSŒ
++;

458 ià((
byStus1
 =ğ'0'è&& (
byStus2
 == '5'))

461 
iTÙ®_SLOW_POLL_CouÁ
 = 0;

462 
m_dsCu¼’tStus
 = 
DISPLAY_PRINTING_CANCELED
;

463  
DISPLAY_PRINTING_CANCELED
;

465 ià((
byStus1
 =ğ'0'è&& (
byStus2
 == '9'))

468 
iTÙ®_SLOW_POLL_CouÁ
 = 0;

469 
m_dsCu¼’tStus
 = 
DISPLAY_OUT_OF_PAPER_NEED_CONTINUE
;

470  
DISPLAY_OUT_OF_PAPER_NEED_CONTINUE
;

472 ià((
byStus1
 =ğ'0'è&& (
byStus2
 == 'E'))

475 
iTÙ®_SLOW_POLL_CouÁ
 = 0;

476 
m_dsCu¼’tStus
 = 
DISPLAY_ERROR_TRAP
;

477  
DISPLAY_ERROR_TRAP
;

479 ià((
byStus1
 =ğ'0'è&& (
byStus2
 == 'F'))

482 
iTÙ®_SLOW_POLL_CouÁ
 = 0;

483 
m_dsCu¼’tStus
 = 
DISPLAY_ERROR_TRAP
;

484  
DISPLAY_ERROR_TRAP
;

486 ià((
byStus1
 =ğ'1'è&& (
byStus2
 == '0'))

489 
iTÙ®_SLOW_POLL_CouÁ
 = 0;

490 
m_dsCu¼’tStus
 = 
DISPLAY_ERROR_TRAP
;

491  
DISPLAY_ERROR_TRAP
;

495 
m_dsCu¼’tStus
 = 
DISPLAY_PRINTING
;

499 
”r
 = 
	`V”ifyP’Info
();

500 if(
”r
)

505  
DISPLAY_COMM_PROBLEM
;

512 
iTÙ®_SLOW_POLL_CouÁ
++;

516 if(
iTÙ®_SLOW_POLL_CouÁ
 >ğ
ERROR_WAIT
)

517  
DISPLAY_BUSY
;

519  
m_dsCu¼’tStus
;

520 
	}
}

526 
DRIVER_ERROR
 
	gDJ3320
::
	$S’d
 (cÚ¡ 
BYTE
* 
pWr™eBuff
, 
DWORD
 
dwWr™eCouÁ
)

528 
DRIVER_ERROR
 
”r
 = 
NO_ERROR
;

529 
DISPLAY_STATUS
 
eDi¥ÏyStus
 = 
DISPLAY_PRINTING
;

530 
DWORD
 
dwResidu®
 = 0;

531 
DWORD
 
dwP»vResidu®
 = 0;

532 cÚ¡ 
BYTE
 *
pWr™ePos
 = 
NULL
;

533 
BYTE
 
byPack‘Ty³
 = 0;

534 
BYTE
 
byCommªdNumb”
 = 0;

535 
BYTE
 
byCommªdNumb”Origš®
 = 0;

536 
BYTE
 
byC»d™Wa™CouÁ
 = 0;

537 
BYTE
 
byC»d™Wa™CouÁOrigš®
 = 0;

538 
BYTE
 
byIOWa™CouÁ
 = 0;

539 
BOOL
 
bUpd©eS‹
 = 
FALSE
;

540 
BOOL
 
bC»d™FÜCommªd
 = 
FALSE
;

541 
BOOL
 
bFlush
 = 
FALSE
;

542 
BOOL
 
bOrigš®Reque¡
 = 
TRUE
;

545 
BYTE
 
byStusReg
 = 0;

548 
DWORD
 
By‹sToWr™e
 = 
dwWr™eCouÁ
;

549 
DWORD
 
By‹sToWr™eOrigš®
 = 
dwWr™eCouÁ
;

550 cÚ¡ 
BYTE
 *
pWr™eBuffOrigš®
 = 
pWr™eBuff
;

551 cÚ¡ 
BYTE
 *
pBufãr
 = 
pWr™eBuff
;

552 
DWORD
 
dwWr™eCouÁOrigš®
 = 
dwWr™eCouÁ
;

553 
DWORD
 
dwS’dSize
 = 
dwWr™eCouÁ
;

556 
BOOL
 
bPrš‹rCªûlBu‰Ú
 = 
FALSE
;

557 
BOOL
 
bCªûlšg
 = 
FALSE
;

558 
BOOL
 
bCªûËd
 = 
FALSE
;

561 #ifdeà
NULL_IO


564  
NO_ERROR
;

568 ià(!
IOMode
.
bDevID
)

570  
pSS
->
	`ToDeviû
 (
pWr™eBuff
, &
dwS’dSize
);

573 ià(
E¼ÜT”mš©iÚS‹
)

576  
JOB_CANCELED
;

581 ià(!
EndJob
)

583 ià(
dwWr™eCouÁ
 == 0)

585  
NO_ERROR
;

589 
byPack‘Ty³
 = 
pWr™eBuff
[
PACKET_TYPE_BYTE
];

593 if(!
byPack‘Ty³
)

595 
byCommªdNumb”
 = 
pWr™eBuff
[
COMMAND_NUMBER_BYTE
];

596 
byCommªdNumb”Origš®
 = 
pWr™eBuff
[
COMMAND_NUMBER_BYTE
];

602 
bFlush
 = 
TRUE
;

609 if(!
bC»d™FÜCommªd
)

613 ià(!
byPack‘Ty³
)

616 ià(
pLDLEnÿp
->
piC»d™CouÁ
[
byCommªdNumb”
] > 0)

618 
pLDLEnÿp
->
piC»d™CouÁ
[
byCommªdNumb”
]--;

619 
bC»d™FÜCommªd
 = 
TRUE
;

620 
byC»d™Wa™CouÁ
 = 0;

624 
byC»d™Wa™CouÁ
++;

626 
bUpd©eS‹
 = 
pLDLEnÿp
->
	`Upd©eS‹
 (
FALSE
);

627 if(
bUpd©eS‹
)

629 
pSS
->
	`BusyWa™
(0);

631 ià(
pLDLEnÿp
->
piC»d™CouÁ
[
byCommªdNumb”
] > 0)

633 
pLDLEnÿp
->
piC»d™CouÁ
[
byCommªdNumb”
]--;

634 
bC»d™FÜCommªd
 = 
TRUE
;

635 
byC»d™Wa™CouÁ
 = 0;

643 
bC»d™FÜCommªd
 = 
TRUE
;

650 ià(
bC»d™FÜCommªd
 || 
bFlush
)

652 ià(
bC»d™FÜCommªd
)

656 ià((
By‹sToWr™e
 >ğ(
DWORD
è
iBuffSize
è&& (
iCu¼BuffSize
 == 0))

658 
pBufãr
 = 
pWr™eBuff
 + (
dwWr™eCouÁ
 - 
By‹sToWr™e
);

659 
dwS’dSize
 = 
By‹sToWr™e
;

660 
By‹sToWr™e
 = 0;

665 ià(
By‹sToWr™e
 <ğ(
DWORD
è
iBuffSize
 - 
iCu¼BuffSize
)

667 
	`memıy
 ((*è(
pS’dBufãr
 + 
iCu¼BuffSize
),

668 (*è(
pWr™eBuff
 + (
dwWr™eCouÁ
 - 
By‹sToWr™e
)),

669 
By‹sToWr™e
);

670 
iCu¼BuffSize
 +ğ
By‹sToWr™e
;

671 
By‹sToWr™e
 = 0;

675 
	`memıy
 ((*è(
pS’dBufãr
 + 
iCu¼BuffSize
),

676 (*è(
pWr™eBuff
 + (
dwWr™eCouÁ
 - 
By‹sToWr™e
)),

677 
iBuffSize
 - 
iCu¼BuffSize
);

678 
By‹sToWr™e
 -ğ(
iBuffSize
 - 
iCu¼BuffSize
);

679 
iCu¼BuffSize
 = 
iBuffSize
;

685 if(!
bOrigš®Reque¡
)

687 
bFlush
 = 
TRUE
;

694 ià((
EndJob
 =ğ
FALSE
è&& (
iCu¼BuffSize
 !ğ
iBuffSize
è&& (!
byPack‘Ty³
è&& (!
bFlush
) )

701 ià(
bFlush
)

703 
bFlush
 = 
FALSE
;

705 
pBufãr
 = 
pS’dBufãr
;

706 
dwS’dSize
 = 
iCu¼BuffSize
;

710 
dwResidu®
 = 
dwS’dSize
;

716 if(
bCheckFÜCªûlBu‰Ú
 && (
ulBy‹sS’tSšûCªûlCheck
 >ğ
CANCEL_BUTTON_CHECK_THRESHOLD
))

718 
ulBy‹sS’tSšûCªûlCheck
 = 0;

720 if(
	`P¬£E¼Ü
(
byStusReg
è=ğ
DISPLAY_PRINTING_CANCELED
)

721 
bPrš‹rCªûlBu‰Ú
 = 
TRUE
;

727 ià(
dwResidu®
 <= 0)

729  
NO_ERROR
;

733 
dwResidu®
 > 0)

736 
dwP»vResidu®
 = 
dwResidu®
;

738 
pWr™ePos
 = (cÚ¡ 
BYTE
 *è&(
pBufãr
[
dwS’dSize
 - 
dwResidu®
]);

739 
”r
 = 
pSS
->
	`ToDeviû
 (
pWr™ePos
, &
dwResidu®
);

741 if(
”r
)

743 
E¼ÜT”mš©iÚS‹
 = 
TRUE
;

744  
”r
;

748 ià(
dwResidu®
 == 0)

753 
”r
 = 
pSS
->
	`FlushIO
 ();

754 ià(
”r
)

756 
E¼ÜT”mš©iÚS‹
 = 
TRUE
;

757  
”r
;

761 if(!
bOrigš®Reque¡
 && !
bCªûËd
)

763 
pWr™eBuff
 = 
pWr™eBuffOrigš®
;

764 
dwWr™eCouÁ
 = 
dwWr™eCouÁOrigš®
;

765 
By‹sToWr™e
 = 
By‹sToWr™eOrigš®
;

766 
byCommªdNumb”
 = 
byCommªdNumb”Origš®
;

767 
bOrigš®Reque¡
 = 
TRUE
;

768 
bC»d™FÜCommªd
 = 
FALSE
;

769 
byC»d™Wa™CouÁ
 = 
byC»d™Wa™CouÁOrigš®
;

772 
pSS
->
	`BusyWa™
(500);

776 if(
bOrigš®Reque¡
)

778 
byIOWa™CouÁ
 = 0;

781 
iTÙ®_SLOW_POLL_CouÁ
 = 0;

788 ià(
dwP»vResidu®
 =ğ
dwResidu®
)

791 
byIOWa™CouÁ
++;

796 if(
bOrigš®Reque¡
)

797 
byIOWa™CouÁ
 = 0;

802 ià(
byIOWa™CouÁ
 >ğ
IO_WAIT
)

804 
E¼ÜT”mš©iÚS‹
 = 
TRUE
;

805 
pSS
->
	`Di¥ÏyPrš‹rStus
 (
DISPLAY_COMM_PROBLEM
);

806  
IO_ERROR
;

810 ià(
pSS
->
	`BusyWa™
 ((
DWORD
)0è=ğ
JOB_CANCELED
)

812 
pSS
->
	`Di¥ÏyPrš‹rStus
 (
DISPLAY_PRINTING_CANCELED
);

817 
iCu¼BuffSize
 = 0;

823 ià(
byC»d™Wa™CouÁ
 >ğ
CREDIT_WAIT
)

825 if(!
bOrigš®Reque¡
)

829 
E¼ÜT”mš©iÚS‹
 = 
TRUE
;

830  
JOB_CANCELED
;

833 ià(
iCu¼BuffSize
)

835 
bFlush
 = 
TRUE
;

840 
eDi¥ÏyStus
 = 
	`P¬£E¼Ü
(
byStusReg
);

850 
eDi¥ÏyStus
)

852 
DISPLAY_PRINTING_CANCELED
:

855 
pSS
->
	`Di¥ÏyPrš‹rStus
 (
eDi¥ÏyStus
);

856 
E¼ÜT”mš©iÚS‹
 = 
TRUE
;

860 
DISPLAY_ERROR_TRAP
:

861 
DISPLAY_COMM_PROBLEM
:

865 
E¼ÜT”mš©iÚS‹
 = 
TRUE
;

866 
pSS
->
	`Di¥ÏyPrš‹rStus
 (
eDi¥ÏyStus
);

870 
pSS
->
	`BusyWa™
 ((
DWORD
è500è!ğ
JOB_CANCELED
)

876  
IO_ERROR
;

878 
DISPLAY_TOP_COVER_OPEN
:

879 
pSS
->
	`Di¥ÏyPrš‹rStus
(
DISPLAY_TOP_COVER_OPEN
);

881 
”r
 = 
NO_ERROR
;

884 
eDi¥ÏyStus
 =ğ
DISPLAY_TOP_COVER_OPEN
 && !
”r
)

886 
”r
 = 
pSS
->
	`BusyWa™
((
DWORD
)500);

887 if(
”r
 =ğ
JOB_CANCELED
)

889 
E¼ÜT”mš©iÚS‹
 = 
TRUE
;

892 if(!
”r
)

894 
bUpd©eS‹
 = 
pLDLEnÿp
->
	`Upd©eS‹
(
FALSE
);

895 if(
bUpd©eS‹
)

897 
eDi¥ÏyStus
 = 
	`P¬£E¼Ü
(
byStusReg
);

901 if(
eDi¥ÏyStus
 =ğ
DISPLAY_PRINTING_CANCELED
)

903 
E¼ÜT”mš©iÚS‹
 = 
TRUE
;

904 
bPrš‹rCªûlBu‰Ú
 = 
TRUE
;

910 if(!
”r
 && !
bPrš‹rCªûlBu‰Ú
)

912 
pSS
->
	`Di¥ÏyPrš‹rStus
(
DISPLAY_PRINTING
);

915 if(
pSS
->
	`BusyWa™
((
DWORD
)1000è=ğ
JOB_CANCELED
)

917 
E¼ÜT”mš©iÚS‹
 = 
TRUE
;

923 
DISPLAY_OUT_OF_PAPER_NEED_CONTINUE
:

924 
pSS
->
	`Di¥ÏyPrš‹rStus
 (
DISPLAY_OUT_OF_PAPER_NEED_CONTINUE
);

926 
”r
 = 
NO_ERROR
;

930 
eDi¥ÏyStus
 =ğ
DISPLAY_OUT_OF_PAPER_NEED_CONTINUE
 && !
”r
)

932 
”r
 = 
pSS
->
	`BusyWa™
((
DWORD
)500);

934 ià(
”r
 =ğ
JOB_CANCELED
)

936 
E¼ÜT”mš©iÚS‹
 = 
TRUE
;

938 if(
”r
 =ğ
CONTINUE_FROM_BLOCK
)

941 
pWr™eBuff
 = 
byCÚtšue
;

942 
dwWr™eCouÁ
 = (
byCÚtšue
);

943 
By‹sToWr™e
 = (
byCÚtšue
);

944 
byCommªdNumb”
 = 
COMMAND_CONTINUE
;

945 
bOrigš®Reque¡
 = 
FALSE
;

946 
bC»d™FÜCommªd
 = 
FALSE
;

947 
byC»d™Wa™CouÁOrigš®
 = 
byC»d™Wa™CouÁ
;

948 
byC»d™Wa™CouÁ
 = 0;

952 
bUpd©eS‹
 = 
pLDLEnÿp
->
	`Upd©eS‹
(
FALSE
);

953 if(
bUpd©eS‹
)

955 
eDi¥ÏyStus
 = 
	`P¬£E¼Ü
(
byStusReg
);

959 if(
eDi¥ÏyStus
 =ğ
DISPLAY_PRINTING_CANCELED
)

961 
E¼ÜT”mš©iÚS‹
 = 
TRUE
;

962 
bPrš‹rCªûlBu‰Ú
 = 
TRUE
;

968 if(!
”r
 && !
bPrš‹rCªûlBu‰Ú
)

970 
pSS
->
	`Di¥ÏyPrš‹rStus
(
DISPLAY_PRINTING
);

975 
DISPLAY_BUSY
:

976 
pSS
->
	`Di¥ÏyPrš‹rStus
(
DISPLAY_BUSY
);

978 ià(
pSS
->
	`BusyWa™
 ((
DWORD
è5000è=ğ
JOB_CANCELED
)

980 
E¼ÜT”mš©iÚS‹
 = 
TRUE
;

987 
pSS
->
	`Di¥ÏyPrš‹rStus
 (
eDi¥ÏyStus
);

989 ià(
pSS
->
	`BusyWa™
 ((
DWORD
è500è=ğ
JOB_CANCELED
)

991 
E¼ÜT”mš©iÚS‹
 = 
TRUE
;

1000 ià(
pSS
->
	`BusyWa™
 ((
DWORD
)0è=ğ
JOB_CANCELED
 || 
bPrš‹rCªûlBu‰Ú
)

1002 
pSS
->
	`Di¥ÏyPrš‹rStus
(
DISPLAY_PRINTING_CANCELED
);

1019 ifĞ(
iCu¼BuffSize
 || (
By‹sToWr™e
 && 
bC»d™FÜCommªd
 && !
E¼ÜT”mš©iÚS‹
) ) &&

1020 !(
bCªûlšg
 || 
bCªûËd
) )

1022 
bFlush
 = 
TRUE
;

1024 if(!
bCªûlšg
)

1026 
pWr™eBuff
 = 
byP»·»ToCªûl
;

1027 
dwWr™eCouÁ
 = (
byP»·»ToCªûl
);

1028 
By‹sToWr™e
 = (
byP»·»ToCªûl
);

1029 
byCommªdNumb”
 = 
COMMAND_PREPARE_TO_CANCEL
;

1030 
bOrigš®Reque¡
 = 
FALSE
;

1031 
bC»d™FÜCommªd
 = 
FALSE
;

1032 
byC»d™Wa™CouÁ
 = 0;

1033 
bCªûlšg
 = 
TRUE
;

1035 if(!
bCªûËd
)

1039 if(
pWr™eBuff
 !ğ
byP»·»ToCªûl
)

1041 
pWr™eBuff
 = 
pLDLEnÿp
->
pbyCªûl
;

1042 
dwWr™eCouÁ
 = (
pLDLEnÿp
->
pbyCªûl
);

1043 
By‹sToWr™e
 = (
pLDLEnÿp
->
pbyCªûl
);

1044 
byCommªdNumb”
 = 
COMMAND_CANCEL
;

1045 
bOrigš®Reque¡
 = 
FALSE
;

1046 
bC»d™FÜCommªd
 = 
FALSE
;

1047 
byC»d™Wa™CouÁ
 = 0;

1048 
bCªûËd
 = 
TRUE
;

1052 } 
By‹sToWr™e
 > 0);

1054 ià(
bCªûËd
)

1057 
pSS
->
	`Di¥ÏyPrš‹rStus
(
DISPLAY_PRINTING_CANCELED
);

1058 
E¼ÜT”mš©iÚS‹
 = 
TRUE
;

1059  
JOB_CANCELED
;

1064 
pSS
->
	`Di¥ÏyPrš‹rStus
 (
DISPLAY_PRINTING
);

1065 ià(
bCheckFÜCªûlBu‰Ú
)

1067 
ulBy‹sS’tSšûCªûlCheck
 +ğ
dwWr™eCouÁ
;

1069  
NO_ERROR
;

1071 
	}
}

1073 
DRIVER_ERROR
 
	gDJ3320
::
	$P¬£P’Info
 (
PEN_TYPE
& 
eP’
, 
BOOL
 
Qu”yPrš‹r
)

1076 *
¡r
;

1077 
num_³ns
 = 0;

1079 
DRIVER_ERROR
 
”r
 = 
	`S‘P’Info
 (
¡r
, 
Qu”yPrš‹r
);

1080 
ERRCHECK
;

1083 ià((
¡r
[0] >= '0') && (str[0] <= '9'))

1085 
num_³ns
 = 
¡r
[0] - '0';

1087 ià((
¡r
[0] >= 'A') && (str[0] <= 'F'))

1089 
num_³ns
 = 10 + (
¡r
[0] - 'A');

1093  
BAD_DEVICE_ID
;

1096 ià((è
	`¡¾’
 (
¡r
è< (
num_³ns
 * 8))

1098  
BAD_DEVICE_ID
;

1101 *
p
 = 
¡r
 + 1;

1102 
BYTE
 
³nInfoB™s
[4];

1131 
eP’
 = 
NO_PEN
;

1133 
i
 = 0; i < 
num_³ns
; i++, 
p
 += 8)

1135 
	`AsciiHexToBš¬y
 (
³nInfoB™s
, 
p
, 8);

1136 ià((
³nInfoB™s
[1] & 0xf8) == 0xf8)

1140  
UNSUPPORTED_PEN
;

1142 ià((
³nInfoB™s
[0] & 0x80) != 0x80)

1146 
BYTE
 
³nCŞÜ
 = 
³nInfoB™s
[0] & 0x3F;

1147 
³nCŞÜ
)

1154 
eP’
 = 
BLACK_PEN
;

1158 ià(
eP’
 =ğ
BLACK_PEN
)

1160 
eP’
 = 
BOTH_PENS
;

1162 ià(
eP’
 =ğ
MDL_PEN
)

1164 
eP’
 = 
MDL_BOTH
;

1168 
eP’
 = 
COLOR_PEN
;

1173 ià(
eP’
 =ğ
BLACK_PEN
)

1175 
eP’
 = 
MDL_AND_BLACK_PENS
;

1177 ià(
eP’
 =ğ
COLOR_PEN
)

1179 
eP’
 = 
MDL_BOTH
;

1181 ià(
eP’
 =ğ
BOTH_PENS
)

1183 
eP’
 = 
MDL_BLACK_AND_COLOR_PENS
;

1187 
eP’
 = 
MDL_PEN
;

1196 ià(
eP’
 =ğ
BLACK_PEN
 ||ƒP’ =ğ
BOTH_PENS
)

1198 
eP’
 = 
BOTH_PENS
;

1202 
eP’
 = 
COLOR_PEN
;

1206 
eP’
 = 
UNKNOWN_PEN
;

1210  
NO_ERROR
;

1211 
	}
}

1213 
DRIVER_ERROR
 
	gDJ3320
::
	$V”ifyP’Info
()

1216 
DRIVER_ERROR
 
”r
 = 
NO_ERROR
;

1218 if(
IOMode
.
bDevID
 =ğ
FALSE
)

1219  
”r
;

1221 
eP’
 = 
NO_PEN
;

1223 
”r
 = 
	`P¬£P’Info
(
eP’
);

1224 
ERRCHECK
;

1226 
eP’
 =ğ
NO_PEN
)

1228 
”r
 = 
	`P¬£P’Info
 (
eP’
);

1229 
ERRCHECK
;

1230 ià(
eP’
 =ğ
NO_PEN
)

1232 
pSS
->
	`Di¥ÏyPrš‹rStus
 (
DISPLAY_NO_PENS
);

1233 ià(
pSS
->
	`BusyWa™
 (500è=ğ
JOB_CANCELED
)

1234  
JOB_CANCELED
;

1239 
pSS
->
	`Di¥ÏyPrš‹rStus
 (
DISPLAY_PRINTING
);

1241  
NO_ERROR
;

1242 
	}
}

1244 
DRIVER_ERROR
 
	gDJ3320
::
	$CheckInkLev–
()

1246 
DRIVER_ERROR
 
”r
;

1247 * 
pSŒ
;

1249 
BYTE
 
bDevIDBuff
[
DevIDBuffSize
];

1251 ià(!
IOMode
.
bDevID
)

1253  
NO_ERROR
;

1256 
”r
 = 
pSS
->
	`G‘DeviûID
(
bDevIDBuff
, 
DevIDBuffSize
, 
TRUE
);

1257 ià(
”r
!=
NO_ERROR
)

1259  
NO_ERROR
;

1262 iàĞ(
pSŒ
=(*)
	`¡r¡r
((cÚ¡ *)
bDevIDBuff
+2,";S:")è=ğ
NULL
 )

1264  
NO_ERROR
;

1267 
pSŒ
 += 21;

1268 
numP’s
 = 0;

1269 ià(*
pSŒ
 > '0' && *pStr < '9')

1271 
numP’s
 = *
pSŒ
 - '0';

1273 ià(*
pSŒ
 > 'A' && *pStr < 'F')

1275 
numP’s
 = *
pSŒ
 - 'A';

1277 ià(*
pSŒ
 > 'a' && *pStr < 'f')

1279 
numP’s
 = *
pSŒ
 - 'a';

1282 
pSŒ
++;

1284 
BYTE
 
³nInfoB™s
[4];

1285 
BYTE
 
bÏckšk
 = 0;

1286 
BYTE
 
cŞÜšk
 = 0;

1287 
BYTE
 
phÙošk
 = 0;

1288 
BYTE
 
g»yšk
 = 0;

1289 
i
 = 0; i < 
numP’s
; i++, 
pSŒ
 += 8)

1291 
	`AsciiHexToBš¬y
 (
³nInfoB™s
, 
pSŒ
, 8);

1293 ià((
³nInfoB™s
[0] & 0x80) != 0x80)

1297 
³nCŞÜ
 = 
³nInfoB™s
[0] & 0x3F;

1298 
³nCŞÜ
)

1301 
bÏckšk
 = 
³nInfoB™s
[1] & 0x7;

1304 
cŞÜšk
 = 
³nInfoB™s
[1] & 0x7;

1307 
phÙošk
 = 
³nInfoB™s
[1] & 0x7;

1310 
g»yšk
 = 
³nInfoB™s
[1] & 0x7;

1318 
cŞÜšk
 = 
³nInfoB™s
[1] & 0x7;

1324 ià(
bÏckšk
 < 2 && 
cŞÜšk
 < 2 && 
phÙošk
 < 2 && 
g»yšk
 < 2)

1326  
NO_ERROR
;

1328 ià(
bÏckšk
 > 1 && 
cŞÜšk
 > 1 && 
phÙošk
 > 1)

1330  
WARN_LOW_INK_COLOR_BLACK_PHOTO
;

1332 ià(
g»yšk
 > 1 && 
cŞÜšk
 > 1 && 
phÙošk
 > 1)

1334  
WARN_LOW_INK_COLOR_GREY_PHOTO
;

1336 ià(
bÏckšk
 > 1 && 
cŞÜšk
 > 1)

1338  
WARN_LOW_INK_BOTH_PENS
;

1340 ià(
bÏckšk
 > 1 && 
phÙošk
 > 1)

1342  
WARN_LOW_INK_BLACK_PHOTO
;

1344 ià(
g»yšk
 > 1 && 
cŞÜšk
 > 1)

1346  
WARN_LOW_INK_COLOR_GREY
;

1348 ià(
g»yšk
 > 1 && 
phÙošk
 > 1)

1350  
WARN_LOW_INK_GREY_PHOTO
;

1352 ià(
cŞÜšk
 > 1 && 
phÙošk
 > 1)

1354  
WARN_LOW_INK_COLOR_PHOTO
;

1356 ià(
bÏckšk
 > 1)

1358  
WARN_LOW_INK_BLACK
;

1360 ià(
cŞÜšk
 > 1)

1362  
WARN_LOW_INK_COLOR
;

1364 ià(
phÙošk
 > 1)

1366  
WARN_LOW_INK_PHOTO
;

1368 ià(
g»yšk
 > 1)

1370  
WARN_LOW_INK_GREY
;

1372 ià(
cŞÜšk
 > 1)

1374  
WARN_LOW_INK_COLOR
;

1378  
NO_ERROR
;

1380 
	}
}

1383 
DRIVER_ERROR
 
	gDJ3320
::
	$SkRa¡”s
 (
nBÏnkRa¡”s
)

1385  (
pLDLEnÿp
->
	`S‘V”tiÿlSk
 (
nBÏnkRa¡”s
));

1386 
	}
}

1388 
DRIVER_ERROR
 
	gDJ3320
::
	$CËªP’
()

1390  
pLDLEnÿp
->
	`CËªP’
 ();

1391 
	}
}

1393 
DRIVER_ERROR
 
	gDJ3320
::
	$Flush
 (
FlushSize
)

1395 
pLDLEnÿp
->
	`Flush
 ();

1396  
NO_ERROR
;

1397 
	}
}

1399 
	gH—d”3320
::
	$H—d”3320
 (
Prš‹r
* 
p
,
PrštCÚ‹xt
* 
pc
)

1400 : 
	$H—d”
(
p
,
pc
)

1403 
	}
}

1405 
DRIVER_ERROR
 
	gH—d”3320
::
	$FÜmF“d
 ()

1407  (((
DJ3320
 *è
thePrš‹r
)->
pLDLEnÿp
->
	`EndPage
 ());

1408 
	}
}

1410 
DRIVER_ERROR
 
	gH—d”3320
::
	$EndJob
()

1412 ((
DJ3320
 *è
thePrš‹r
)->
pLDLEnÿp
->
	`EndJob
 ();

1413  
NO_ERROR
;

1414 
	}
}

1416 
DRIVER_ERROR
 
	gH—d”3320
::
	$S’d
 ()

1419 
DJ3320
 *
pXBow
 = (DJ3320 *è
thePrš‹r
;

1421  (
pXBow
->
pLDLEnÿp
->
	`S¹Job
 ());

1423 
	}
}

1425 
DRIVER_ERROR
 
	gH—d”3320
::
	$S’dCAPy
 (
iAbsY
)

1427  
NO_ERROR
;

1428 
	}
}

1430 
	gLDLEnÿp
::
	$LDLEnÿp
 (
DJ3320
 *
pPrš‹r
, 
Sy¡emS”viûs
 *
pSys
, 
PrštCÚ‹xt
 *
pc
)

1433 
cÚ¡ruùÜ_”rÜ
 = 
NO_ERROR
;

1434 
piC»d™CouÁ
 = 
NULL
;

1435 
m_pSys
 = 
pSys
;

1436 
pPrš‹rXBow
 = 
pPrš‹r
;

1437 
m_iXResŞutiÚ
 = 
pc
->
	`EfãùiveResŞutiÚX
 ();

1438 
m_iYResŞutiÚ
 = 
pc
->
	`EfãùiveResŞutiÚY
 ();

1439 
m_±hisPC
 = 
pc
;

1440 
m_cPrštDœeùiÚ
 = 
PRNDRN_LEFTTORIGHT
;

1441 
m_Sw©hD©a
 = 
NULL
;

1442 
m_sRefCouÁ
 = 6;

1443 
m_iBÏnkRa¡”s
 = 0;

1444 
m_iRa¡”CouÁ
 = 0;

1445 
m_iV”tPo¢
 = (è(
m_±hisPC
->
	`PršbËS¹Y
 (è* 
DEVUNITS_XBOW
);

1446 
m_iNumCŞÜs
 = 4;

1447 
m_iLeáM¬gš
 = (è(
m_±hisPC
->
	`PršbËS¹X
 (è* 
DEVUNITS_XBOW
);

1450 
fXOv”S´ay
 = 0.0;

1451 
fYOv”S´ay
 = 0.0;

1452 
fLeáOv”S´ay
 = 0.0;

1453 
fTİOv”S´ay
 = 0.0;

1454 
FuÎbËedTy³
 
fbTy³
;

1455 ià(
m_±hisPC
->
bDoFuÎBËed
 &&

1456 
pPrš‹rXBow
->
	`FuÎBËedC­abË
 (
m_±hisPC
->
theP­”Size
,

1457 &
fbTy³
,

1458 &
fXOv”S´ay
, &
fYOv”S´ay
,

1459 &
fLeáOv”S´ay
, &
fTİOv”S´ay
))

1470 
m_iV”tPo¢
 = (è(-
fTİOv”S´ay
 * 
DEVUNITS_XBOW
);

1471 
m_iLeáM¬gš
 = (è(-
fLeáOv”S´ay
 * 
DEVUNITS_XBOW
);

1474 
m_bS¹PageNÙS’t
 = 
TRUE
;

1476 
m_iNextRa¡”
 = 0;

1477 
m_iNextCŞÜ
 = 0;

1479 
m_iB™D•th
 = 1;

1480 
m_cPÏÃNumb”
 = 0;

1481 
m_cPrštQu®™y
 = (
BYTE
è
QUALITY_NORMAL
;

1482 
m_cMedŸTy³
 = (
BYTE
è
MEDIA_PLAIN
;

1484 
BYTE
 
cm
 = 
COLOR
;

1485 
QUALITY_MODE
 
cqm
;

1486 
MEDIATYPE
 
cmt
;

1487 
COLORMODE
 
ccm
;

1488 
BOOL
 
cdt
;

1489 
DRIVER_ERROR
 
”r
 = 
m_±hisPC
->
	`G‘PrštModeS‘tšgs
 (
cqm
, 
cmt
, 
ccm
, 
cdt
);

1490 ià(
”r
 =ğ
NO_ERROR
)

1492 ià(
cqm
 =ğ
QUALITY_BEST
 && 
cmt
 =ğ
MEDIA_PHOTO
)

1493 
m_iB™D•th
 = 2;

1494 
m_cPrštQu®™y
 = (
BYTE
è
cqm
;

1495 
m_cMedŸTy³
 = (
BYTE
è
cmt
;

1496 
cm
 = (
BYTE
è
ccm
;

1499 ià(
pPrš‹rXBow
->
eP’
 =ğ
BLACK_PEN
 ||…Prš‹rXBow->eP’ =ğ
MDL_PEN
 || 
cm
 =ğ
GREY_K
)

1500 
m_iNumCŞÜs
 = 1;

1501 ià(
pPrš‹rXBow
->
eP’
 =ğ
COLOR_PEN
 || 
cm
 =ğ
GREY_CMY
)

1502 
m_iNumCŞÜs
 = 3;

1503 ià(
pPrš‹rXBow
->
eP’
 =ğ
BOTH_PENS
 && 
m_iB™D•th
 == 2)

1504 
m_iNumCŞÜs
 = 3;

1505 ià(
pPrš‹rXBow
->
eP’
 =ğ
MDL_BOTH
)

1506 
m_iNumCŞÜs
 = 6;

1508 
m_bBidœeùiÚ®PrštšgOn
 = 
TRUE
;

1510 
UIÁ16
 
mem_Ãeded
 = 
SIZEOF_LDLHDR


1511 + 
SIZEOF_LDL_PRTSWP_CMDOPT


1512 + 
SIZEOF_LDL_PRTSWP_OPTFLDS


1513 + 6 * 
SIZEOF_LDL_PRTSWP_COLROPT


1514 + 
SIZEOF_LDL_COLROPT_ACTIVECOLR


1515 + 
SIZEOF_LDLTERM
;

1516 
m_szCmdBuf
 = 
Ãw
 
BYTE
[
mem_Ãeded
];

1517 
	`CNEWCHECK
 (
m_szCmdBuf
);

1519 
m_bL™eEndŸn
 = 
TRUE
;

1523 
a
;

1524 
b
[2];

1525 }
c
;

1526 
c
.
a
 = 0x1234;

1527 ià(
c
.
b
[0] == 0x12)

1528 
m_bL™eEndŸn
 = 
FALSE
;

1531 
m_szCmdBuf
[0] = 
FRAME_SYN
;

1532 
m_szCmdBuf
[1] = 0;

1533 
m_szCmdBuf
[3] = 0;

1534 
m_szCmdBuf
[4] = 0;

1535 
m_szCmdBuf
[5] = 0;

1536 
m_szCmdBuf
[6] = 0;

1537 
m_szCmdBuf
[8] = 0;

1540 
bNewStus
 = 
FALSE
;

1541 
	`mem£t
(
byStusBuff
, 0, (byStatusBuff));

1543 
m_pbyPack‘Buff
 = 
NULL
;

1544 
m_pbyPack‘Buff
 = 
pSys
->
	`AÎocMem
 (
MAX_PACKET_READ_SIZE
);

1545 
	`CNEWCHECK
 (
m_pbyPack‘Buff
);

1547 
m_dwPack‘BuffSize
 = 
MAX_PACKET_READ_SIZE
;

1550 
pbySync
 = 
m_pSys
->
	`AÎocMem
(
SYNCSIZE
);

1551 
	`CNEWCHECK
(
pbySync
);

1553 
	`mem£t
(
pbySync
, 0, 
SYNCSIZE
);

1554 
	`memıy
(
pbySync
, 
bySync
, (bySync));

1555 
	`mem£t
((
pbySync
 + (
bySync
)), 0, 
SYNC_CMD_OPT_SIZE
);

1556 
pbySync
[(
bySync
è+ 
SYNC_CMD_OPT_SIZE
] = 
FRAME_SYN
;

1557 
	`mem£t
((
pbySync
 + (
bySync
è+ 
SYNC_CMD_OPT_SIZE
 + (
FRAME_SYN
)), 0, 
LDL_MAX_IMAGE_SIZE
);

1565 
BYTE
 
cV”tAlign
 = 0;

1566 ià(
pPrš‹rXBow
->
eP’
 =ğ
BOTH_PENS
)

1568 ià(
pSys
->
	`G‘V”tiÿlAlignm’tV®ue
(&
cV”tAlign
))

1570 
m_cKtoCV”tAlign
 = 
cV”tAlign
;

1574 
m_cKtoCV”tAlign
 = 12;

1577 ià(
pPrš‹rXBow
->
eP’
 =ğ
MDL_BOTH
)

1579 ià(
pSys
->
	`G‘V”tiÿlAlignm’tV®ue
(&
cV”tAlign
))

1581 
m_cPtoCV”tAlign
 = 
cV”tAlign
;

1585 
m_cPtoCV”tAlign
 = 6;

1590 
m_cKtoCV”tAlign
 = 12;

1591 
m_cPtoCV”tAlign
 = 6;

1593 
	}
}

1595 
	gLDLEnÿp
::
	$AÎoÿ‹Sw©hBufãr
 (
Ra¡”Size
)

1597 
size
 = 
Ra¡”Size
;

1598 
size
 = (size / 8 + 1) * 8;

1599 
m_iImageWidth
 = 
size
;

1601 
cÚ¡ruùÜ_”rÜ
 = 
NO_ERROR
;

1602 
m_ldlCom´essD©a
 = 
NULL
;

1604 #ifdeà 
APDK_LDL_COMPRESS


1605 ià(
pPrš‹rXBow
->
m_iLdlV”siÚ
 == 1)

1607 
m_ldlCom´essD©a
 = 
Ãw
 
comp_±rs_t
;

1611 ià(
m_iB™D•th
 == 2)

1613 
size
 *= 2;

1616 
iSwšgs
 = 
pPrš‹rXBow
->
m_iBy‹sP”Swšg
 / 2;

1617 
iCom´essBufSize
 = 
iSwšgs
 * 
LDL_MAX_IMAGE_SIZE
+20;

1618 
m_szCom´essBuf
 = 
Ãw
 
BYTE
[
iCom´essBufSize
];

1619 
	`CNEWCHECK
 (
iCom´essBufSize
);

1620 
	`mem£t
 (
m_szCom´essBuf
, 0, 
iCom´essBufSize
);

1622 
BYTE
 *
p
 = 
NULL
;

1623 
iSw©hBuffSize
;

1625 
m_sSw©hHeight
 = 
SWATH_HEIGHT
;

1632 
iAdjHeight
 = (
pPrš‹rXBow
->
m_iNumBÏckNozzËs
 / 32) * 8;

1633 ià(
pPrš‹rXBow
->
eP’
 =ğ
BLACK_PEN
)

1635 
m_sSw©hHeight
 = m_sSwathHeight * 4;

1636 ià(
m_sSw©hHeight
 * 1200 / 
m_iYResŞutiÚ
 > 
pPrš‹rXBow
->
m_iNumBÏckNozzËs
)

1637 
m_sSw©hHeight
 = 
m_iYResŞutiÚ
 / 3;

1639 ià(
m_cPrštQu®™y
 !ğ
QUALITY_DRAFT
 && 
m_iYResŞutiÚ
 > 300 && 
m_iNumCŞÜs
 > 1 && 
m_iB™D•th
 == 1)

1641 
m_sSw©hHeight
 = (m_sSwathHeight / 4) * 4 * 2;

1642 ià(
m_sSw©hHeight
 > 200)

1643 
m_sSw©hHeight
 = 200;

1646 ià(
m_iB™D•th
 == 2)

1647 
m_sSw©hHeight
 = 
iAdjHeight
 * 4;

1649 ià(
m_cPrštQu®™y
 =ğ
QUALITY_NORMAL
)

1650 
m_sSw©hHeight
 = 
iAdjHeight
 * 2;

1652 ià(
m_cPrštQu®™y
 =ğ
QUALITY_DRAFT
 && 
pPrš‹rXBow
->
eP’
 !ğ
BLACK_PEN
)

1654 
m_sSw©hHeight
 *ğ
iSwšgs
;

1657 
m_sSw©hHeight
 > 16)

1659 
iSw©hBuffSize
 = 
m_iNumCŞÜs
 *  (
BYTE
 *) +

1660 
m_iNumCŞÜs
 * 
m_sSw©hHeight
 *  (
BYTE
 *) +

1661 
size
 * 
m_iNumCŞÜs
 * 
m_sSw©hHeight
;

1662 ià((
p
 = 
m_pSys
->
	`AÎocMem
(
iSw©hBuffSize
)è=ğ
NULL
)

1664 
m_sSw©hHeight
 = (m_sSwathHeight / 16) * 8;

1669 ià(
m_sSw©hHeight
 < 16)

1671 
m_sSw©hHeight
 = 16;

1672 
iSw©hBuffSize
 = 
m_iNumCŞÜs
 *  (
BYTE
 *) +

1673 
m_iNumCŞÜs
 * 
m_sSw©hHeight
 *  (
BYTE
 *) +

1674 
size
 * 
m_iNumCŞÜs
 * 
m_sSw©hHeight
;

1675 
p
 = 
m_pSys
->
	`AÎocMem
(
iSw©hBuffSize
);

1676 
	`CNEWCHECK
 (
p
);

1679 
i
;

1680 
m_Sw©hD©a
 = (
BYTE
 ***è
p
;

1681 
i
 = 0; i < 
m_iNumCŞÜs
; i++)

1682 
m_Sw©hD©a
[
i
] = (
BYTE
 **è(
p
 +  (BYTE *è* 
m_iNumCŞÜs
 + i * 
m_sSw©hHeight
 *  (BYTE *));

1684 
i
 = 0; i < 
m_iNumCŞÜs
; i++)

1686 
p
 = (
BYTE
 *è
m_Sw©hD©a
 +  (BYTE *è* 
m_iNumCŞÜs
 +

1687 
m_iNumCŞÜs
 * 
m_sSw©hHeight
 *  (
BYTE
 *) +

1688 
size
 * 
m_sSw©hHeight
 * 
i
;

1689 
j
 = 0; j < 
m_sSw©hHeight
; j++)

1691 
	`mem£t
 (
p
, 0, 
size
);

1692 
m_Sw©hD©a
[
i
][
j
] = 
p
;

1693 
p
 =… + 
size
;

1697 ià(
m_cPrštQu®™y
 !ğ
QUALITY_DRAFT
 && 
m_iYResŞutiÚ
 != 300)

1699 
m_iRa¡”CouÁ
 = (
m_sSw©hHeight
 - m_sSw©hHeighˆ/ (4*
m_iB™D•th
)è* 
m_iNumCŞÜs
;

1700 
m_iV”tPo¢
 -ğ(((
m_sSw©hHeight
 - m_sSw©hHeighˆ/ (4*
m_iB™D•th
)è* 600 / 
m_iYResŞutiÚ
è* 
DEVUNITS_XBOW
 / 600);

1702 
m_cPassNumb”
 = 0;

1704 
fXOv”S´ay
 = 0.0;

1705 
fYOv”S´ay
 = 0.0;

1706 
fLeáOv”S´ay
 = 0.0;

1707 
fTİOv”S´ay
 = 0.0;

1708 
FuÎbËedTy³
 
fbTy³
;

1709 ià(
m_±hisPC
->
bDoFuÎBËed
 &&

1710 
pPrš‹rXBow
->
	`FuÎBËedC­abË
 (
m_±hisPC
->
theP­”Size
,

1711 &
fbTy³
,

1712 &
fXOv”S´ay
, &
fYOv”S´ay
,

1713 &
fLeáOv”S´ay
, &
fTİOv”S´ay
))

1715 ià(
m_iV”tPo¢
 < -850) m_iVertPosn = -850;

1719 ià(
m_iV”tPo¢
 < -600) m_iVertPosn = -600;

1721 ià(
m_iB™D•th
 == 2)

1722 
m_iV”tPo¢
 += 6;

1723 
	}
}

1725 
	gLDLEnÿp
::
	$G‘Sw©hWidth
 (
iS¹
, 
iLa¡
, 
iWidth
)

1727 
k
;

1728 
i
, 
j
;

1729 
i
 = 
iWidth
 - 1 ; i > -1; i--)

1731 
j
 = 
iS¹
; j < 
iLa¡
; j++)

1733 
k
 = 
m_iRa¡”CouÁ
 / 
m_iNumCŞÜs
-1; k >= 0; k--)

1736 ià(
m_Sw©hD©a
[
j
][
k
][
i
])

1738  (
i
+1);

1745 
	}
}

1747 
	gLDLEnÿp
::
	$Flush
 ()

1751 
	}
}

1753 
DRIVER_ERROR
 
LDLEnÿp
::
	$S‘V”tiÿlSk
 (
nBÏnkRa¡”s
)

1755 
DRIVER_ERROR
 
”r
 = 
NO_ERROR
;

1757 ià(
m_iRa¡”CouÁ
 == 0)

1759 
m_iBÏnkRa¡”s
 +ğ
nBÏnkRa¡”s
;

1760  
”r
;

1763 
iCouÁ
 = 
m_iNumCŞÜs
 * 
m_iB™D•th
;

1764 ià(
m_iB™D•th
 =ğ2 && 
m_iNumCŞÜs
 != 6)

1765 
iCouÁ
++;

1767 
nBÏnkRa¡”s
 > 0)

1769 
i
 = 0; i < 
iCouÁ
; i++)

1771 
”r
 = 
	`EnÿpsuÏ‹
 (
NULL
, 
m_iImageWidth
, 0);

1772 
ERRCHECK
;

1774 
nBÏnkRa¡”s
--;

1776  
”r
;

1777 
	}
}

1779 
BOOL
 
	gLDLEnÿp
::
	$IsBÏnkRa¡”
 (
BYTE
 *
¿¡”
, 
width
)

1781 
width
 > 0)

1783 ià(*
¿¡”
)

1784  
FALSE
;

1785 
width
--;

1787  
FALSE
;

1788 
	}
}

1790 
DRIVER_ERROR
 
	gLDLEnÿp
::
	$EnÿpsuÏ‹
 (cÚ¡ 
BYTE
 *
šput
, 
DWORD
 
size
, 
BOOL
 
bLa¡PÏÃ
)

1792 
DRIVER_ERROR
 
”r
 = 
NO_ERROR
;

1793 
iPÏÃNum
 = 0;

1794 ià(
size
 > (
DWORD
è
m_iImageWidth
)

1795 
size
 = 
m_iImageWidth
;

1796 ià(
m_iB™D•th
 == 2)

1798 ià(
m_iNumCŞÜs
 != 6)

1800 ià(
m_cPÏÃNumb”
 == 0)

1802 
m_cPÏÃNumb”
++;

1803  
NO_ERROR
;

1806 
iCPÏÃ
;

1807 ià(
m_iNumCŞÜs
 == 6)

1809 
iPÏÃNum
 = 
m_cPÏÃNumb”
 % 2;

1813 
iPÏÃNum
 = (
m_cPÏÃNumb”
 + 1) % 2;

1815 
iRowNum
 = (
m_iRa¡”CouÁ
 / 6è* 2 + 
iPÏÃNum
;

1816 
iRowNum
 = 
m_iNextRa¡”
;

1817 ià(
m_iNumCŞÜs
 == 6)

1819 
iCPÏÃ
 = 
m_cPÏÃNumb”
 / 2;

1823 
iCPÏÃ
 = (
m_cPÏÃNumb”
 - 1) / 2;

1825 ià(
iPÏÃNum
 == 0)

1827 ià(!
šput
)

1828 
	`mem£t
 (
m_Sw©hD©a
[
iCPÏÃ
][
iRowNum
], 0, 
m_iImageWidth
 * 2);

1830 
	`memıy
 (
m_Sw©hD©a
[
iCPÏÃ
][
iRowNum
], 
šput
, 
size
);

1832 ià(
m_iNumCŞÜs
 == 6)

1834 
m_cPÏÃNumb”
 = (m_cPlaneNumber + 1) % 12;

1838 
m_cPÏÃNumb”
 = (m_cPlaneNumber + 1) % 8;

1841 ià(
iPÏÃNum
 == 1)

1844 
BYTE
 
cby‹1
, 
cby‹2
;

1845 
BYTE
 
c1
, 
c2
;

1846 
j
 = 0;

1847 
BYTE
 
r1b1
 = 0;

1848 
BYTE
 
r1b2
 = 0;

1849 
BYTE
 
r2b1
 = 0;

1850 
BYTE
 
r2b2
 = 0;

1851 
BYTE
 
b™mask
[8] = {0x80, 0x40, 0x20, 0x10, 0x08, 0x04, 0x02, 0x01};

1854 
iNextB™Pos
 = 
m_iImageWidth
;

1855 
iJInüem’t
 = 1;

1856 ià(
pPrš‹rXBow
->
m_iLdlV”siÚ
 == 2)

1858 
iNextB™Pos
 = 1;

1859 
iJInüem’t
 = 2;

1862 
	`memıy
 (
m_szCom´essBuf
, 
m_Sw©hD©a
[
iCPÏÃ
][
m_iNextRa¡”
], 
size
);

1864 
BYTE
 
¿nd_bË
[4][4] = {{0, 3, 1, 2},

1869 
BYTE
 
¹1
, 
¹2
;

1870 
¹1
 = 
iRowNum
 % 4;

1872 
i
 = 0; i < 
size
; i++)

1874 
cby‹2
 = 
m_szCom´essBuf
[
i
];

1875 
cby‹1
 = (
šput
 =ğ
NULL
è? 0 : iÅut[
i
];

1879 
r1b1
 = 0;

1880 
r1b2
 = 0;

1881 
r2b1
 = 0;

1882 
r2b2
 = 0;

1884 
ib™
 = 0; ibit < 8; ibit++)

1886 
c1
 = (
cby‹1
 & 
b™mask
[
ib™
]) ? 1 : 0;

1887 
c2
 = (
cby‹2
 & 
b™mask
[
ib™
]) ? 1 : 0;

1888 
c1
 = 2 * c1 + 
c2
;

1890 
¹2
 = (
i
 + 
ib™
) % 4;

1891 
¹2
 = 
¿nd_bË
[
¹1
][rt2];

1893 ià(
c1
 == 2)

1895 ià(
¹2
 == 0)

1897 
r1b1
 =„1b1 | (0xfà& (
cby‹1
 & 
b™mask
[
ib™
]));

1898 
r2b2
 =„2b2 | (0xfà& 
b™mask
[
ib™
]);

1900 ià(
¹2
 == 1)

1902 
r1b2
 =„1b2 | (0xfà& 
b™mask
[
ib™
]);

1903 
r2b1
 =„2b1 | (0xfà& 
b™mask
[
ib™
]);

1906 ià(
¹2
 == 2)

1908 
r1b1
 =„1b1 | (0xfà& 
b™mask
[
ib™
]);

1909 
r2b1
 =„2b1 | (0xfà& 
b™mask
[
ib™
]);

1911 ià(
¹2
 == 3)

1913 
r1b2
 =„1b2 | (0xfà& 
b™mask
[
ib™
]);

1914 
r2b2
 =„2b2 | (0xfà& 
b™mask
[
ib™
]);

1918 ià(
c1
 == 1)

1920 ià(
¹2
 == 0)

1921 
r1b1
 =„1b1 | (0xfà& 
b™mask
[
ib™
]);

1922 ià(
¹2
 == 1)

1923 
r1b2
 =„1b2 | (0xfà& 
b™mask
[
ib™
]);

1924 ià(
¹2
 == 2)

1925 
r2b1
 =„2b1 | (0xfà& 
b™mask
[
ib™
]);

1927 
r2b2
 =„2b2 | (0xfà& 
b™mask
[
ib™
]);

1930 ià(
c1
 == 3)

1932 
r1b1
 =„1b1 | (0xfà& 
b™mask
[
ib™
]);

1933 
r1b2
 =„1b2 | (0xfà& 
b™mask
[
ib™
]);

1934 
r2b1
 =„2b1 | (0xfà& 
b™mask
[
ib™
]);

1935 
r2b2
 =„2b2 | (0xfà& 
b™mask
[
ib™
]);

1938 
m_Sw©hD©a
[
iCPÏÃ
][
m_iNextRa¡”
][
j
] = 
r1b1
;

1939 
m_Sw©hD©a
[
iCPÏÃ
][
m_iNextRa¡”
][
j
+
iNextB™Pos
] = 
r1b2
;

1940 
m_Sw©hD©a
[
iCPÏÃ
][
m_iNextRa¡”
+1][
j
] = 
r2b1
;

1941 
m_Sw©hD©a
[
iCPÏÃ
][
m_iNextRa¡”
+1][
j
+
iNextB™Pos
] = 
r2b2
;

1943 
j
 +ğ
iJInüem’t
;

1946 ià(
m_iNumCŞÜs
 == 6)

1948 
m_cPÏÃNumb”
 = m_cPlaneNumber % 12;

1952 
m_cPÏÃNumb”
 = m_cPlaneNumber % 7;

1958 ià(!
šput
 || 
size
 == 0)

1959 
	`mem£t
 (
m_Sw©hD©a
[
m_iNextCŞÜ
][
m_iNextRa¡”
], 0, 
m_iImageWidth
);

1961 
	`memıy
 (
m_Sw©hD©a
[
m_iNextCŞÜ
][
m_iNextRa¡”
], 
šput
, 
size
);

1963 
m_iRa¡”CouÁ
++;

1964 ià(
m_iB™D•th
 =ğ1 || (m_iB™D•th =ğ2 && 
iPÏÃNum
 == 1))

1965 
m_iNextCŞÜ
++;

1966 ià(
m_iNextCŞÜ
 =ğ
m_iNumCŞÜs
)

1968 
m_iNextCŞÜ
 = 0;

1969 ià(
m_iB™D•th
 == 2)

1970 
m_iNextRa¡”
 += 2;

1972 
m_iNextRa¡”
++;

1974 ià(
m_iRa¡”CouÁ
 < 
m_sSw©hHeight
 * 
m_iNumCŞÜs
)

1975  
NO_ERROR
;

1977 ià(
m_bS¹PageNÙS’t
)

1979 
”r
 = 
	`S¹Page
 ();

1980 ià(
”r
 !ğ
NO_ERROR
)

1981  
”r
;

1984 
”r
 = 
	`ProûssSw©h
 (
size
);

1986 ià(
m_iNextRa¡”
 >ğ
m_sSw©hHeight
)

1988 
m_iNextRa¡”
 = 0;

1990  
”r
;

1991 
	}
}

1993 
DRIVER_ERROR
 
	gLDLEnÿp
::
	$ProûssSw©h
 (
iCurRa¡”Size
)

1996 
DRIVER_ERROR
 
”r
 = 
NO_ERROR
;

1997 
¡¬t
 = 0;

1998 
size
 = 0;

1999 
IÁ32
 
iV”tPo¢
;

2000 
IÁ16
 
sCurSw©hHeight
 = 
m_iRa¡”CouÁ
 / 
m_iNumCŞÜs
;

2001 
IÁ32
 
LeáEdge
 = 0;

2002 
i
;

2003 
m_iV”tPo¢
 +ğ((
m_iBÏnkRa¡”s
è* 600 / 
m_iYResŞutiÚ
è* 
DEVUNITS_XBOW
 / 600;

2004 
m_iBÏnkRa¡”s
 = 0;

2006 
iV”tPo¢
 = 
m_iV”tPo¢
;

2008 
BOOL
 
bCŞÜP»£Á
 = 
TRUE
;

2009 
BOOL
 
bBÏckP»£Á
 = 
TRUE
;

2010 
BOOL
 
bPhÙoP»£Á
 = 
TRUE
;

2011 
sCŞÜSize
 = 0;

2013 
S¹CŞÜ
 = 0;

2014 
La¡CŞÜ
 = 1;

2015 
IÁ32
 
RightEdge
;

2016 
d–
 = 2;

2017 
iCŞÜs
 = 0;

2018 
UIÁ32
 
uiSw©hSize
 = 0;

2020 
iSwšgs
 = 
pPrš‹rXBow
->
m_iBy‹sP”Swšg
;

2022 ià(
m_iNumCŞÜs
 == 1)

2024 
bCŞÜP»£Á
 = 0;

2025 
bPhÙoP»£Á
 = 0;

2033 ià(
m_iNumCŞÜs
 == 3)

2035 
bBÏckP»£Á
 = 0;

2036 
bPhÙoP»£Á
 = 0;

2038 ià(
m_iNumCŞÜs
 == 6)

2040 
bBÏckP»£Á
 = 0;

2042 ià(
m_iNumCŞÜs
 == 4)

2044 
bPhÙoP»£Á
 = 0;

2047 ià(!
m_bBidœeùiÚ®PrštšgOn
)

2048 
m_cPrštDœeùiÚ
 = 
PRNDRN_LEFTTORIGHT
;

2050 
IÁ16
 
j
;

2051 
n
;

2052 
couÁ
;

2053 
iS¹Ra¡”
 = 
m_cPassNumb”
 % (2 * 
m_iB™D•th
);

2054 
BYTE
 
mask
 = 0xFF;

2056 ià(
pPrš‹rXBow
->
m_iLdlV”siÚ
 == 2)

2058 
iS¹Ra¡”
 = 0;

2061 ià(
m_cPrštQu®™y
 !ğ
QUALITY_DRAFT
 && 
m_iYResŞutiÚ
 != 300)

2063 ià((
m_cPassNumb”
 % (4 * 
m_iB™D•th
)) < (2 * m_iBitDepth))

2064 
mask
 = 0xAA;

2066 
mask
 = 0x55;

2073 
BYTE
 
c§vMask
 = 
mask
;

2075 
IÁ16
 
iOff£t
 = 0;

2077 ià(
m_sRefCouÁ
 > 64000)

2078 
m_sRefCouÁ
 = 6;

2080 ià(
bPhÙoP»£Á
)

2082 ià(
bCŞÜP»£Á
)

2084 
iCŞÜs
 = 6;

2085 
La¡CŞÜ
 = 6;

2086 
S¹CŞÜ
 = 0;

2087 ià(
pPrš‹rXBow
->
m_iLdlV”siÚ
 == 1)

2090 
size
 = 
	`G‘Sw©hWidth
 (
S¹CŞÜ
, 
La¡CŞÜ
, 
iCurRa¡”Size
 );

2094 
size
 = 
	`G‘Sw©hWidth
 (
S¹CŞÜ
, 
La¡CŞÜ
, 
iCurRa¡”Size
 * 
m_iB™D•th
);

2099 
iCŞÜs
 = 1;

2100 
La¡CŞÜ
 = 1;

2101 
S¹CŞÜ
 = 0;

2103 
size
 = 
	`G‘Sw©hWidth
 (
S¹CŞÜ
, 
La¡CŞÜ
, 
iCurRa¡”Size
 );

2107 ià(
bPhÙoP»£Á
 && 
size
)

2109 ià(
size
 % 
iSwšgs
)

2110 
size
 = ((size/
iSwšgs
) + 1) * iSwings;

2111 ià(
pPrš‹rXBow
->
m_iLdlV”siÚ
 == 1)

2113 
RightEdge
 = 
LeáEdge
 + (
size
 * 8 * 600 / 
m_iXResŞutiÚ
 - 1 * (600 / 
m_iYResŞutiÚ
)) *

2114 (
DEVUNITS_XBOW
 / 600);

2118 
RightEdge
 = 
LeáEdge
 + (
size
 * 8 * 600 / 
m_iXResŞutiÚ
 - 1 * (600 / 
m_iYResŞutiÚ
)) *

2119 (
DEVUNITS_XBOW
 / (600 * 
m_iB™D•th
));

2121 
IÁ16
 
sLa¡NozzË
;

2122 
IÁ16
 
sFœ¡NozzË
 = 1;

2123 
uSw“pSize
;

2124 
jD–
 = 
m_iYResŞutiÚ
 / 
pPrš‹rXBow
->
m_iCŞÜP’ResŞutiÚ
;

2125 
jD–
 *ğ
m_iB™D•th
;

2127 
uiSw©hSize
 = 
size
 * 
iCŞÜs
 * 
sCurSw©hHeight
 / 
jD–
;

2129 
uSw“pSize
 = 
sCurSw©hHeight
 * 
iSwšgs
 / 
jD–
;

2130 
n
 = 
LDL_MAX_IMAGE_SIZE
 / (
uSw“pSize
);

2131 
couÁ
 = 0;

2133 ià(
m_iB™D•th
 == 2)

2134 
iS¹Ra¡”
 = (4 - (iStartRaster+1)) % 4;

2136 ià(
pPrš‹rXBow
->
m_iLdlV”siÚ
 == 2)

2138 
iS¹Ra¡”
 = 0;

2141 
sLa¡NozzË
 = 
sFœ¡NozzË
 - 1 + 
sCurSw©hHeight
 / 
jD–
;

2143 
BYTE
 *
cb
 = 
m_szCom´essBuf
 + 16;

2144 
	`mem£t
 (
m_szCom´essBuf
, 0x0, 
LDL_MAX_IMAGE_SIZE
 * (
iSwšgs
 / 2));

2148 
ib
 = 0;

2150 ià(
m_iYResŞutiÚ
 > 300 && 
m_cPrštQu®™y
 !ğ
QUALITY_DRAFT
)

2152 
iOff£t
 = (
sCurSw©hHeight
 / (4 * 
m_iB™D•th
));

2153 
iOff£t
 = iOff£ˆ+ iOff£ˆ* ((
m_cPassNumb”
è% (4 * 
m_iB™D•th
));

2156 
BYTE
 
cV”tAlign
 = 0;

2158 ià(
bCŞÜP»£Á
)

2160 
cV”tAlign
 = 
m_cPtoCV”tAlign
;

2163 
ib
 = 0; ib < (è
m_iB™D•th
; ib++)

2165 ià(
m_cPrštDœeùiÚ
 =ğ
PRNDRN_RIGHTTOLEFT
)

2167 
¡¬t
 = 
size
 - 
iSwšgs
;

2168 
d–
 = -
iSwšgs
;

2172 
¡¬t
 = 0;

2173 
d–
 = 
iSwšgs
;

2176 
”r
 = 
	`PrštSw“p
 (
uiSw©hSize
, 
bCŞÜP»£Á
, 
FALSE
, 
bPhÙoP»£Á
,

2177 
iV”tPo¢
+
cV”tAlign
, 
LeáEdge
, 
RightEdge
, 
m_cPrštDœeùiÚ
,

2178 
sFœ¡NozzË
, 
sLa¡NozzË
);

2179 
ERRCHECK
;

2181 
i
 = 
¡¬t
 + 
ib
 * 
m_iImageWidth
;

2182 
l
 = 0;† < 
size
;† +ğ
iSwšgs
)

2184 
k
 = 
S¹CŞÜ
+1; k < 
La¡CŞÜ
; k++)

2186 
mask
 = 
c§vMask
;

2187 
j
 = 
iOff£t
 + 
iS¹Ra¡”
; j < 
sCurSw©hHeight
; j +ğ
jD–
)

2189 
is
 = 0; i < 
iSwšgs
; is++)

2191 *
cb
++ = 
m_Sw©hD©a
[
k
][
j
][
i
+
is
] & 
mask
;

2193 
mask
 = ~mask;

2195 
j
 = 
iS¹Ra¡”
; j < 
iOff£t
; j +ğ
jD–
)

2197 
is
 = 0; i < 
iSwšgs
; is++)

2199 *
cb
++ = 
m_Sw©hD©a
[
k
][
j
][
i
+
is
] & 
mask
;

2201 
mask
 = ~mask;

2204 
couÁ
++;

2205 ià(
couÁ
 =ğ
n
)

2207 
”r
 = 
	`LßdSw“pD©a
 (
m_szCom´essBuf
, (è(
cb
 - m_szCompressBuf-16));

2208 
	`mem£t
 (
m_szCom´essBuf
, 0, 
LDL_MAX_IMAGE_SIZE
 * (
iSwšgs
 / 2));

2209 
cb
 = 
m_szCom´essBuf
+16;

2210 
couÁ
 = 0;

2211 
ERRCHECK
;

2214 
mask
 = 
c§vMask
;

2215 
j
 = 
iOff£t
 + 
iS¹Ra¡”
; j < 
sCurSw©hHeight
; j +ğ
jD–
)

2217 
is
 = 0; i < 
iSwšgs
; is++)

2219 *
cb
++ = 
m_Sw©hD©a
[0][
j
][
i
 + 
is
] & 
mask
;

2221 
mask
 = ~mask;

2223 
j
 = 
iS¹Ra¡”
; j < 
iOff£t
; j +ğ
jD–
)

2225 
is
 = 0; i < 
iSwšgs
; is++)

2227 *
cb
++ = 
m_Sw©hD©a
[0][
j
][
i
 + 
is
] & 
mask
;

2229 
mask
 = ~mask;

2232 
couÁ
++;

2233 ià(
couÁ
 =ğ
n
)

2235 
”r
 = 
	`LßdSw“pD©a
 (
m_szCom´essBuf
, (è(
cb
 - m_szCompressBuf-16));

2236 
	`mem£t
 (
m_szCom´essBuf
, 0, 
LDL_MAX_IMAGE_SIZE
 * (
iSwšgs
 / 2));

2237 
cb
 = 
m_szCom´essBuf
+16;

2238 
couÁ
 = 0;

2239 
ERRCHECK
;

2241 
i
 = i + 
d–
;

2243 ià(
couÁ
 != 0)

2245 
”r
 = 
	`LßdSw“pD©a
 (
m_szCom´essBuf
, (è(
cb
 - m_szCompressBuf-16));

2246 
	`mem£t
 (
m_szCom´essBuf
, 0, 
LDL_MAX_IMAGE_SIZE
 * (
iSwšgs
 / 2));

2247 
cb
 = 
m_szCom´essBuf
+16;

2248 
couÁ
 = 0;

2249 
ERRCHECK
;

2252 ià(
m_bBidœeùiÚ®PrštšgOn
)

2253 
m_cPrštDœeùiÚ
 = (m_cPrintDirection + 1) % 2;

2255 ià(
pPrš‹rXBow
->
m_iLdlV”siÚ
 == 2)

2259 
LeáEdge
 += 2;

2260 
RightEdge
 += 2;

2269 ià(!
bPhÙoP»£Á
 && 
bCŞÜP»£Á
)

2271 
iCŞÜs
 = 3;

2272 
La¡CŞÜ
 = 4;

2273 
S¹CŞÜ
 = 1;

2274 ià(!
bBÏckP»£Á
)

2276 
S¹CŞÜ
 = 0;

2277 
La¡CŞÜ
 = 3;

2279 ià(
pPrš‹rXBow
->
m_iLdlV”siÚ
 == 1)

2282 
size
 = 
	`G‘Sw©hWidth
 (
S¹CŞÜ
, 
La¡CŞÜ
, 
iCurRa¡”Size
 );

2286 
size
 = 
	`G‘Sw©hWidth
 (
S¹CŞÜ
, 
La¡CŞÜ
, 
iCurRa¡”Size
 * 
m_iB™D•th
);

2288 
sCŞÜSize
 = 
size
;

2294 ià(!
bPhÙoP»£Á
 && 
bCŞÜP»£Á
 && 
size
)

2296 ià(
size
 % 
iSwšgs
)

2297 
size
 = ((siz/ 
iSwšgs
) + 1) * iSwings;

2299 ià(
pPrš‹rXBow
->
m_iLdlV”siÚ
 == 1)

2301 
RightEdge
 = 
LeáEdge
 + (
size
 * 8 * 600 / 
m_iXResŞutiÚ
 - 1 * (600 / 
m_iYResŞutiÚ
)) *

2302 (
DEVUNITS_XBOW
 / 600);

2306 
RightEdge
 = 
LeáEdge
 + (
size
 * 8 * 600 / 
m_iXResŞutiÚ
 - 1 * (600 / 
m_iYResŞutiÚ
)) *

2307 (
DEVUNITS_XBOW
 / (600 * 
m_iB™D•th
));

2309 
IÁ16
 
sLa¡NozzË
;

2310 
IÁ16
 
sFœ¡NozzË
 = 1;

2311 
uSw“pSize
;

2312 
jD–
 = 
m_iYResŞutiÚ
 / 
pPrš‹rXBow
->
m_iCŞÜP’ResŞutiÚ
;

2313 
jD–
 *ğ
m_iB™D•th
;

2315 
uiSw©hSize
 = 
size
 * 
iCŞÜs
 * 
sCurSw©hHeight
 / 
jD–
;

2317 
uSw“pSize
 = 
sCurSw©hHeight
 * 
iSwšgs
 / 
jD–
;

2318 
n
 = 
LDL_MAX_IMAGE_SIZE
 / (
uSw“pSize
);

2319 
couÁ
 = 0;

2321 ià(
m_iB™D•th
 == 2)

2323 
iS¹Ra¡”
 = (4 - (iStartRaster+1)) % 4;

2324 ià(
pPrš‹rXBow
->
m_iLdlV”siÚ
 == 2)

2326 
iS¹Ra¡”
 = 
m_cPassNumb”
 % (
m_iB™D•th
);

2330 
sLa¡NozzË
 = 
sFœ¡NozzË
 - 1 + 
sCurSw©hHeight
 / 
jD–
;

2332 
BYTE
 *
cb
 = 
m_szCom´essBuf
 + 16;

2333 
	`mem£t
 (
m_szCom´essBuf
, 0x0, 
LDL_MAX_IMAGE_SIZE
 * (
iSwšgs
 / 2));

2337 
ib
 = 0;

2339 ià(
m_iYResŞutiÚ
 > 300 && 
m_cPrštQu®™y
 !ğ
QUALITY_DRAFT
)

2341 
iOff£t
 = (
sCurSw©hHeight
 / (4 * 
m_iB™D•th
));

2342 
iOff£t
 = iOff£ˆ+ iOff£ˆ* ((
m_cPassNumb”
è% (4 * 
m_iB™D•th
));

2345 
ib
 = 0; ib < (è
m_iB™D•th
; ib++)

2347 ià(
m_cPrštDœeùiÚ
 =ğ
PRNDRN_RIGHTTOLEFT
)

2349 
¡¬t
 = 
size
 - 
iSwšgs
;

2350 
d–
 = -
iSwšgs
;

2354 
¡¬t
 = 0;

2355 
d–
 = 
iSwšgs
;

2357 
”r
 = 
	`PrštSw“p
 (
uiSw©hSize
, 
bCŞÜP»£Á
, 
FALSE
, FALSE,

2358 
iV”tPo¢
, 
LeáEdge
, 
RightEdge
, 
m_cPrštDœeùiÚ
,

2359 
sFœ¡NozzË
, 
sLa¡NozzË
);

2360 
ERRCHECK
;

2362 
i
 = 
¡¬t
 + 
ib
 * 
m_iImageWidth
;

2363 
l
 = 0;† < 
size
;† +ğ
iSwšgs
)

2365 
k
 = 
S¹CŞÜ
; k < 
La¡CŞÜ
; k++)

2367 
mask
 = 
c§vMask
;

2368 
j
 = 
iOff£t
 + 
iS¹Ra¡”
; j < 
sCurSw©hHeight
; j +ğ
jD–
)

2370 
is
 = 0; i < 
iSwšgs
; is++)

2372 *
cb
++ = 
m_Sw©hD©a
[
k
][
j
][
i
 + 
is
] & 
mask
;

2374 
mask
 = ~mask;

2376 
j
 = 
iS¹Ra¡”
; j < 
iOff£t
; j +ğ
jD–
)

2378 
is
 = 0; i < 
iSwšgs
; is++)

2380 *
cb
++ = 
m_Sw©hD©a
[
k
][
j
][
i
 + 
is
] & 
mask
;

2382 
mask
 = ~mask;

2385 
couÁ
++;

2386 ià(
couÁ
 =ğ
n
)

2388 
”r
 = 
	`LßdSw“pD©a
 (
m_szCom´essBuf
, (è(
cb
 - m_szCompressBuf-16));

2389 
	`mem£t
 (
m_szCom´essBuf
, 0, 
LDL_MAX_IMAGE_SIZE
 * (
iSwšgs
 / 2));

2391 
cb
 = 
m_szCom´essBuf
+16;

2392 
couÁ
 = 0;

2393 
ERRCHECK
;

2397 
i
 = i + 
d–
;

2400 ià(
couÁ
 != 0)

2402 
”r
 = 
	`LßdSw“pD©a
 (
m_szCom´essBuf
, (è(
cb
 - m_szCompressBuf-16));

2403 
	`mem£t
 (
m_szCom´essBuf
, 0, 
LDL_MAX_IMAGE_SIZE
 * (
iSwšgs
 / 2));

2405 
cb
 = 
m_szCom´essBuf
+16;

2406 
couÁ
 = 0;

2407 
ERRCHECK
;

2410 
LeáEdge
 += 2;

2411 
RightEdge
 += 2;

2413 ià(
m_bBidœeùiÚ®PrštšgOn
)

2414 
m_cPrštDœeùiÚ
 = (m_cPrintDirection + 1) % 2;

2415 ià(
pPrš‹rXBow
->
m_iLdlV”siÚ
 == 2)

2427 
size
 = 0;

2428 ià(
bBÏckP»£Á
)

2429 
size
 = 
	`G‘Sw©hWidth
 (0, 1, 
iCurRa¡”Size
);

2431 ià(
size
 % 
iSwšgs
)

2432 
size
 = ((size/
iSwšgs
) + 1) * iSwings;

2434 
RightEdge
 = 
LeáEdge
 + (
size
 * 8 * 600 / 
m_iXResŞutiÚ
 - 1 * (600 / 
m_iYResŞutiÚ
)è* 
DEVUNITS_XBOW
/600;

2436 ià(
bBÏckP»£Á
 && 
size
 && 
m_iB™D•th
 != 2 &&

2437 ((
m_cPassNumb”
 % 2è=ğ0 || 
m_cPrštQu®™y
 =ğ
QUALITY_DRAFT
))

2439 
IÁ16
 
sLa¡NozzË
 = 0;

2440 
IÁ16
 
sFœ¡NozzË
 = 1;

2442 
xD–
 = 0;

2443 
BYTE
 
cV”tAlign
 = 0;

2445 ià(
bCŞÜP»£Á
)

2447 
cV”tAlign
 = 
m_cKtoCV”tAlign
;

2450 ià(
bCŞÜP»£Á
 && 
sCŞÜSize
 && 
m_bBidœeùiÚ®PrštšgOn
)

2451 
m_cPrštDœeùiÚ
 = 
PRNDRN_RIGHTTOLEFT
;

2452 ià(
m_cPrštDœeùiÚ
 =ğ
PRNDRN_RIGHTTOLEFT
)

2454 
¡¬t
 = 
size
 - 
iSwšgs
;

2455 
d–
 = -
iSwšgs
;

2459 
¡¬t
 = 0;

2460 
d–
 = 
iSwšgs
;

2462 ià(
m_iYResŞutiÚ
 == 300)

2463 
xD–
 = 
iSwšgs
;

2464 
uiSw©hSize
 = ((
size
/
iSwšgs
è* 
sCurSw©hHeight
 * iSwšg * (600 * 
m_iB™D•th
)/ 
m_iYResŞutiÚ
);

2466 ià(
pPrš‹rXBow
->
m_iLdlV”siÚ
 =ğ2 && 
m_iNumCŞÜs
 != 1)

2468 
sFœ¡NozzË
 = 9;

2471 
”r
 = 
	`PrštSw“p
 (
uiSw©hSize
, 
FALSE
, 
bBÏckP»£Á
, FALSE,

2472 (
iV”tPo¢
 + 
cV”tAlign
), 
LeáEdge
, 
RightEdge
, 
m_cPrštDœeùiÚ
, 
sFœ¡NozzË
, 
sLa¡NozzË
);

2474 
ERRCHECK
;

2476 
i
 = 
¡¬t
;

2477 
BYTE
 *
cb
 = 
m_szCom´essBuf
+16;

2478 
	`mem£t
 (
m_szCom´essBuf
, 0x0, 
LDL_MAX_IMAGE_SIZE
 * (
iSwšgs
 / 2));

2480 
n
 = 
LDL_MAX_IMAGE_SIZE
 / (
sCurSw©hHeight
 * 
iSwšgs
 * 600 / 
m_iYResŞutiÚ
);

2481 
couÁ
 = 0;

2483 
iOff£t
 = 0;

2484 ià(
m_iYResŞutiÚ
 > 300 && 
m_cPrštQu®™y
 !ğ
QUALITY_DRAFT
)

2486 
iOff£t
 = 
sCurSw©hHeight
 / 4;

2487 
iOff£t
 = iOff£ˆ+ iOff£ˆ* (
m_cPassNumb”
 % 4);

2490 
l
 = 0;† < 
size
;† +ğ
iSwšgs
)

2492 
j
 = 
iOff£t
; j < 
sCurSw©hHeight
; j++)

2494 
is
 = 0; i < 
iSwšgs
; is++)

2496 *
cb
++ = 
m_Sw©hD©a
[0][
j
][
i
 + 
is
] & 
mask
;

2498 
cb
 +ğ
xD–
;

2500 
j
 = 0; j < 
iOff£t
; j++)

2502 
is
 = 0; i < 
iSwšgs
; is++)

2504 *
cb
++ = 
m_Sw©hD©a
[0][
j
][
i
 + 
is
] & 
mask
;

2506 
cb
 +ğ
xD–
;

2509 
couÁ
++;

2510 ià(
couÁ
 =ğ
n
)

2512 
”r
 = 
	`LßdSw“pD©a
 (
m_szCom´essBuf
, (è(
cb
 - m_szCompressBuf-16));

2513 
	`mem£t
 (
m_szCom´essBuf
, 0, 
LDL_MAX_IMAGE_SIZE
 * (
iSwšgs
 / 2));

2515 
cb
 = 
m_szCom´essBuf
+16;

2516 
couÁ
 = 0;

2517 
ERRCHECK
;

2519 
i
 = i + 
d–
;

2521 ià(
couÁ
 != 0)

2523 
”r
 = 
	`LßdSw“pD©a
 (
m_szCom´essBuf
, (è(
cb
 - m_szCompressBuf-16));

2524 
	`mem£t
 (
m_szCom´essBuf
, 0, 
LDL_MAX_IMAGE_SIZE
 * (
iSwšgs
 / 2));

2526 
cb
 = 
m_szCom´essBuf
+16;

2527 
couÁ
 = 0;

2528 
ERRCHECK
;

2531 ià(
m_bBidœeùiÚ®PrštšgOn
)

2532 
m_cPrštDœeùiÚ
 = (m_cPrintDirection + 1) % 2;

2535 
m_iRa¡”CouÁ
 = 0;

2537 ià(
m_cPrštQu®™y
 !ğ
QUALITY_DRAFT
 && 
m_iYResŞutiÚ
 != 300)

2539 
m_cPassNumb”
 = (m_cPassNumb” + 1è% (4 * 
m_iB™D•th
);

2540 
m_iV”tPo¢
 +ğ((((
sCurSw©hHeight
/(4 * 
m_iB™D•th
))è* 600 / 
m_iYResŞutiÚ
è* 
DEVUNITS_XBOW
 / 600) / m_iBitDepth;

2541 ià(
m_iB™D•th
 == 1)

2543 ià(
m_cPassNumb”
 % 2)

2544 
m_iV”tPo¢
 += 4;

2546 
m_iV”tPo¢
 -= 4;

2550 
m_iV”tPo¢
 -= 2;

2551 ià((
m_cPassNumb”
 % 4) == 0)

2552 
m_iV”tPo¢
 +ğ(
DEVUNITS_XBOW
 / 
pPrš‹rXBow
->
m_iCŞÜP’ResŞutiÚ
);

2554 
m_iRa¡”CouÁ
 = (
sCurSw©hHeight
 - sCurSw©hHeighˆ/ (4 * 
m_iB™D•th
)è* 
m_iNumCŞÜs
;

2558 
m_iV”tPo¢
 +ğ((
sCurSw©hHeight
 * 4 * 600è/ 
m_iYResŞutiÚ
);

2562  
”r
;

2563 
	}
}

2565 
	gLDLEnÿp
::
	$FlLidH—d”
 (*
pLidHdr
, 
Commªd
,

2566 
UIÁ16
 
CmdL’
, UIÁ16 
D©aL’
 = 0)

2569 
šdex
 = 1;

2570 
m_szCmdBuf
[0] = 
FRAME_SYN
;

2571 
	`WRITE16
 (
CmdL’
);

2572 
m_szCmdBuf
[5] = (
BYTE
è
Commªd
;

2573 
šdex
 = 6;

2574 
	`WRITE16
(
m_sRefCouÁ
++);

2575 
šdex
 = 8;

2576 
	`WRITE16
 (
D©aL’
);

2578 
	}
}

2580 
DRIVER_ERROR
 
	gLDLEnÿp
::
	$PrštSw“p
 (
UIÁ32
 
Sw“pSize
,

2581 
BOOL
 
CŞÜP»£Á
,

2582 
BOOL
 
BÏckP»£Á
,

2583 
BOOL
 
PhÙoP»£Á
,

2584 
IÁ32
 
V”tiÿlPos™iÚ
,

2585 
IÁ32
 
LeáEdge
,

2586 
IÁ32
 
RightEdge
,

2587 
PrštDœeùiÚ
,

2588 
IÁ16
 
sFœ¡NozzË
,

2589 
IÁ16
 
sLa¡NozzË
)

2592 
UIÁ16
 
cŞÜcouÁ
 = 0;

2593 
UIÁ32
 
uiAfãùedCŞÜs
 = 0;

2594 ià(
CŞÜP»£Á
 =ğ
TRUE
è
cŞÜcouÁ
 += 3;

2595 ià(
BÏckP»£Á
 =ğ
TRUE
è
cŞÜcouÁ
++;

2596 ià(
PhÙoP»£Á
 =ğ
TRUE
)

2598 ià(
CŞÜP»£Á
 =ğ
FALSE
)

2599 
cŞÜcouÁ
++;

2601 
cŞÜcouÁ
+=3;

2604 
UIÁ16
 
mem_Ãeded
;

2605 ià(
pPrš‹rXBow
->
m_iLdlV”siÚ
 == 1)

2607 
mem_Ãeded
 = 
SIZEOF_LDLHDR


2608 + 
SIZEOF_LDL_PRTSWP_CMDOPT


2609 + 
SIZEOF_LDL_PRTSWP_OPTFLDS


2610 + 
SIZEOF_LDL_PRTSWP_COLROPT
 * 
cŞÜcouÁ


2611 + 
SIZEOF_LDLTERM
;

2613 ià(
cŞÜcouÁ
 != 0)

2614 
mem_Ãeded
 +ğ
SIZEOF_LDL_COLROPT_ACTIVECOLR
;

2618 
mem_Ãeded
 = 
SIZEOF_LDLHDR


2619 + 
SIZEOF_LDL_PRTSWP_CMDOPT
 + 7

2620 + 
SIZEOF_LDL_PRTSWP_OPTFLDS


2621 + 
SIZEOF_LDL_PRTSWP_COLROPT
 + 4

2622 + 
SIZEOF_LDLTERM
;

2625 
	`mem£t
 (
m_szCmdBuf
, 0, 
mem_Ãeded
);

2627 
	`FlLidH—d”
 (
NULL
, 
eLDLPrštSw“p
, 
mem_Ãeded
);

2629 
šdex
 = 
SIZEOF_LDLHDR
;

2630 ià(
pPrš‹rXBow
->
m_iLdlV”siÚ
 == 2)

2632 
m_szCmdBuf
[
šdex
++] = 1;

2634 
	`WRITE32
 (
Sw“pSize
);

2635 
	`WRITE32
 (
V”tiÿlPos™iÚ
);

2636 
	`WRITE32
 (
m_iLeáM¬gš
);

2637 ià(
pPrš‹rXBow
->
m_iLdlV”siÚ
 == 1)

2640 
m_szCmdBuf
[
šdex
++] = 
SWINGFMT_UNCOMPRSS
;

2645 
m_szCmdBuf
[
šdex
++] = 1;

2647 
m_szCmdBuf
[
šdex
++] = 
PrštDœeùiÚ
;

2648 ià(
pPrš‹rXBow
->
m_iLdlV”siÚ
 == 2)

2650 
	`WRITE32
 (0);

2652 
	`WRITE32
 (
IPS_CARRSPEED
|
IPS_INIPRNSPEED
|
ACCURATEPOSN_NEEDED
);

2654 ià(
m_cPrštQu®™y
 =ğ
QUALITY_BEST
 && 
m_cMedŸTy³
 =ğ
MEDIA_PHOTO
)

2655 
m_szCmdBuf
[
šdex
++] = 12;

2657 
m_szCmdBuf
[
šdex
++] = 25;

2658 
m_szCmdBuf
[
šdex
++] = 4;

2659 
m_szCmdBuf
[
šdex
++] = 1;

2660 ià(
pPrš‹rXBow
->
m_iLdlV”siÚ
 == 2)

2662 
m_szCmdBuf
[
šdex
++] = 1;

2666 if(
cŞÜcouÁ
 == 0)

2668 
m_szCmdBuf
[
šdex
++] = 
NO_ACTIVE_COLORS
;

2669 
m_szCmdBuf
[
šdex
++] = 
FRAME_SYN
;

2670 
mem_Ãeded
 = 
šdex
;

2676 
UIÁ16
 
cŞ½»£Á
 = 0;

2677 
UIÁ16
 
cŞr_found
=0;

2678 
UIÁ16
 
cŞÜmask
 = 0x01;

2679 
UIÁ16
 
off£t
 = 
eLDLBÏck
;

2680 
UIÁ16
 
iD©aRes
;

2681 
UIÁ16
 
iPrštRes
;

2682 
uiAfãùedCŞÜs
 = 
off£t
;

2683 ià(
BÏckP»£Á
 =ğ
TRUE
)

2685 
uiAfãùedCŞÜs
 = 0x1;

2687 if(
BÏckP»£Á
 =ğ
FALSE
 && 
PhÙoP»£Á
 == FALSE)

2689 
off£t
 = 
eLDLCyª
;

2690 
cŞÜmask
=0x02;

2691 
uiAfãùedCŞÜs
 |= 0x0000000e;

2693 ià(
BÏckP»£Á
 =ğ
FALSE
 && 
PhÙoP»£Á
 =ğ
TRUE
)

2695 ià(
CŞÜP»£Á
 =ğ
TRUE
)

2697 
off£t
 = 
eLDLCyª
;

2698 
cŞÜmask
=0x02;

2699 
uiAfãùedCŞÜs
 |= 0x0000007e;

2703 
off£t
 = 
eLDLLoBÏck
;

2704 
cŞÜmask
=0x40;

2705 
uiAfãùedCŞÜs
 |= 0x00000070;

2709 
aùv_cŞr_šdex
 = 
šdex
;

2710 
iCŞÜRes
 = 300;

2711 ià(
pPrš‹rXBow
->
m_iLdlV”siÚ
 == 1)

2713 
šdex
 += 2;

2717 
iCŞÜRes
 = 600;

2719 
UIÁ16
 
i
 = 
off£t
; 
cŞr_found
 < 
cŞÜcouÁ
 && i < 
eLDLMaxCŞÜ
; i++)

2721 
cŞr_found
++;

2722 
cŞ½»£Á
 = cŞ½»£Á | 
cŞÜmask
;

2724 ià(
pPrš‹rXBow
->
m_iLdlV”siÚ
 == 2)

2726 
	`WRITE32
 (
uiAfãùedCŞÜs
);

2728 
	`WRITE32
 (
LeáEdge
);

2729 
	`WRITE32
 (
RightEdge
);

2730 
	`WRITE32
 (
LeáEdge
);

2731 
	`WRITE32
 (
RightEdge
);

2733 ià((
i
 =ğ0 && 
pPrš‹rXBow
->
m_iLdlV”siÚ
 =ğ1è|| (
BÏckP»£Á
 &&…PrinterXBow->m_iLdlVersion == 2))

2735 
iD©aRes
 = 600;

2736 
iPrštRes
 = 
pPrš‹rXBow
->
m_iBÏckP’ResŞutiÚ
;

2740 
iD©aRes
 = 
iCŞÜRes
;

2741 
iPrštRes
 = 
iCŞÜRes
;

2743 
	`WRITE16
 (
iD©aRes
);

2744 
	`WRITE16
 (
iPrštRes
);

2746 ià(
pPrš‹rXBow
->
m_iLdlV”siÚ
 == 2)

2748 
	`WRITE16
 (
m_iXResŞutiÚ
 * 
m_iB™D•th
);

2752 
	`WRITE16
 (
m_iXResŞutiÚ
);

2755 ià(
m_iXResŞutiÚ
 == 300)

2757 
	`WRITE16
 (600);

2761 ià(
pPrš‹rXBow
->
m_iLdlV”siÚ
 == 2)

2763 
	`WRITE16
 (
m_iXResŞutiÚ
 * 
m_iB™D•th
);

2767 
	`WRITE16
 (
m_iXResŞutiÚ
);

2770 
	`WRITE16
 (
sFœ¡NozzË
);

2771 ià(
sLa¡NozzË
 == 0)

2773 
iTmp
 = 
m_iRa¡”CouÁ
 / 
m_iNumCŞÜs
;

2774 ià(
pPrš‹rXBow
->
m_iLdlV”siÚ
 == 2)

2776 
	`WRITE16
 (
sFœ¡NozzË
 - 1 + ((
iTmp
 * 
iPrštRes
è/ (
m_iYResŞutiÚ
 * 
m_iB™D•th
)));

2780 
	`WRITE16
 (
sFœ¡NozzË
 - 1 + ((
iTmp
 * 
iPrštRes
è/ (
m_iYResŞutiÚ
)))

2785 
	`WRITE16
 (
sLa¡NozzË
);

2788 
m_szCmdBuf
[
šdex
++] = 0;

2789 
cŞÜmask
 = colormask << 1;

2790 ià(
pPrš‹rXBow
->
m_iLdlV”siÚ
 == 2)

2797 
mem_Ãeded
 = 
šdex
;

2798 ià(
pPrš‹rXBow
->
m_iLdlV”siÚ
 == 1)

2800 
šdex
 = 
aùv_cŞr_šdex
;

2801 
	`WRITE16
 (
cŞ½»£Á
);

2802 
šdex
 = 
mem_Ãeded
;

2805 ià(
pPrš‹rXBow
->
m_iLdlV”siÚ
 == 2)

2807 
m_szCmdBuf
[
šdex
++] = 0;

2809 
m_szCmdBuf
[
šdex
++] = 
FRAME_SYN
;

2810 
mem_Ãeded
 = 
šdex
;

2814  (
pPrš‹rXBow
->
	`S’d
 (
m_szCmdBuf
, (
DWORD
è
mem_Ãeded
));

2815 
	}
}

2818 
DRIVER_ERROR
 
	gLDLEnÿp
::
	$LßdSw“pD©a
 (
BYTE
 *
imaged©a
, 
imagesize
)

2820 
UIÁ16
 
mem_Ãeded
 = 
SIZEOF_LDLHDR
 + 
SIZEOF_LDL_LDSWPDATA_CMDOPT


2821 + 
SIZEOF_LDLTERM
;

2822 
UIÁ16
 
diff
=0;

2823 if(
mem_Ãeded
 < 
LDLPACKET_MINSIZE
)

2825 
diff
 = 
LDLPACKET_MINSIZE
 - 
mem_Ãeded
;

2826 
mem_Ãeded
 = 
LDLPACKET_MINSIZE
;

2828 
	`mem£t
 (
m_szCmdBuf
, 0, 
mem_Ãeded
);

2830 
BYTE
 *
com´es£d_d©­Œ
 = 
imaged©a
;

2831 
UIÁ16
 
com´es£d_size
 = 
imagesize
;

2833 #ifdeà 
APDK_LDL_COMPRESS


2834 ià(
m_ldlCom´essD©a
)

2836 
m_ldlCom´essD©a
->
	`In™
 ((
UIÁ16
 *è(
imaged©a
+16), 
imagesize
);

2837 
	`Com´essD©a
 ();

2838 
	`G‘F¿meInfo
 (&
com´es£d_d©­Œ
, &
com´es£d_size
);

2842 
	`FlLidH—d”
 (
NULL
, 
eLDLLßdSw“pD©a
, 
mem_Ãeded
, 
com´es£d_size
);

2844 
šdex
 = 
SIZEOF_LDLHDR
;

2845 
	`WRITE16
 (
imagesize
);

2847 if(
diff
)

2849 
	`mem£t
 (
m_szCmdBuf
+
šdex
, 0xFF, 
diff
);

2850 
šdex
 +ğ
diff
;

2852 
m_szCmdBuf
[
šdex
++] = 
FRAME_SYN
;

2854 
	`memıy
 (
com´es£d_d©­Œ
, 
m_szCmdBuf
, 16);

2855  (
pPrš‹rXBow
->
	`S’d
 (
com´es£d_d©­Œ
, (
DWORD
è
com´es£d_size
+16));

2856 
	}
}

2858 
	gLDLEnÿp
::~
	$LDLEnÿp
 ()

2860 ià(
m_Sw©hD©a
)

2863 
m_pSys
->
	`F»eMem
 ((
BYTE
 *è
m_Sw©hD©a
);

2864 ià(
m_szCmdBuf
)

2865 
d–‘e
 [] 
m_szCmdBuf
;

2866 ià(
m_szCom´essBuf
)

2867 
d–‘e
 [] 
m_szCom´essBuf
;

2868 ià(
piC»d™CouÁ
)

2869 
m_pSys
->
	`F»eMem
 ((
BYTE
 *è
piC»d™CouÁ
);

2870 ià(
m_pbyPack‘Buff
)

2871 
m_pSys
->
	`F»eMem
 ((
BYTE
 *è
m_pbyPack‘Buff
);

2872 ià(
pbySync
)

2873 
m_pSys
->
	`F»eMem
 ((
BYTE
 *è
pbySync
);

2874 #ifdeà 
APDK_LDL_COMPRESS


2875 ià(
m_ldlCom´essD©a
)

2877 
d–‘e
 
m_ldlCom´essD©a
;

2878 
m_ldlCom´essD©a
 = 
NULL
;

2881 
	}
}

2883 
DRIVER_ERROR
 
	gLDLEnÿp
::
	$S¹Job
 ()

2885 
DRIVER_ERROR
 
”r
 = 
NO_ERROR
;

2886 
BYTE
 *
pby
 = 
NULL
;

2887 
BYTE
 
by
 = 0;

2888 
BOOL
 
bC»d™In™Ÿlized
 = 
FALSE
;

2889 
WORD
 
wC»d™Wa™CouÁ
 = 0;

2892 
”r
 = 
pPrš‹rXBow
->
	`S’d
 (
pbySync
, (
DWORD
è
SYNCSIZE
);

2893 if(
”r
)

2895  
”r
;

2899 
”r
 = 
pPrš‹rXBow
->
	`S’d
 (
bySyncCom¶‘e
, (
DWORD
)  (bySyncComplete));

2900 if(
”r
)

2902  
”r
;

2906 
”r
 = 
pPrš‹rXBow
->
	`S’d
 (
byRe£tLIDIL
, (
DWORD
)  (byResetLIDIL));

2907 if(
”r
)

2909  
”r
;

2912 ià(
pPrš‹rXBow
->
IOMode
.
bDevID
)

2915 
”r
 = 
pPrš‹rXBow
->
	`S’d
 (
byEÇbËPacšg
, (
DWORD
)  (byEnablePacing));

2916 ià(
”r
)

2918  
”r
;

2921 !
bC»d™In™Ÿlized
 && 
wC»d™Wa™CouÁ
++ < 
CREDIT_WAIT
)

2923 
bC»d™In™Ÿlized
 = 
	`Upd©eS‹
 (
TRUE
);

2926 ià(!
bC»d™In™Ÿlized
)

2928  
SYSTEM_ERROR
;

2936 
”r
 = 
pPrš‹rXBow
->
	`S’d
 (
byEOCStusQu”y
, (
DWORD
)  (byEOCStatusQuery));

2937 ià(
”r
)

2939  
”r
;

2945 
	`memıy
 (
pbyCªûl
, 
byP»·»ToCªûl
,  (byPrepareToCancel));

2946 
pbyCªûl
[
COMMAND_NUMBER_BYTE
] = 0x00;

2947 
pbyCªûl
[
COMMAND_OPT_BYTE
] = 0x02;

2949 
pby
 = (
BYTE
*è&
pPrš‹rXBow
->
pLDLEnÿp
;

2950 if(
m_bL™eEndŸn
)

2953 
pby
 +ğ (
pPrš‹rXBow
->
pLDLEnÿp
) - 1;

2956 
by
 = 0; by < (
pPrš‹rXBow
->
pLDLEnÿp
); by++)

2958 if(
m_bL™eEndŸn
)

2959 
pbyCªûl
[
by
 + 
COMMAND_OPT_BYTE
 + 1] = *
pby
--;

2961 
pbyCªûl
[
by
 + 
COMMAND_OPT_BYTE
 + 1] = *
pby
++;

2971 
UIÁ16
 
mem_Ãeded
 = 
SIZEOF_LDLHDR
 + 
SIZEOF_LDL_JOB_CMDOPT
 + 
SIZEOF_LDLTERM
;

2972 ià(
pPrš‹rXBow
->
m_iLdlV”siÚ
 == 2)

2974 
mem_Ãeded
 += 4;

2977 
	`FlLidH—d”
 (
NULL
, 
eLDLS¹Job
, 
mem_Ãeded
);

2980 
šdex
 = 
SIZEOF_LDLHDR
;

2981 
m_szCmdBuf
[
šdex
++] = 
OPERATION_STJOB
;

2982 ià(
pPrš‹rXBow
->
IOMode
.
bDevID
)

2984 
	`WRITE32
 ((
UIÁ32
è
this
);

2988 
	`WRITE32
 ((
UIÁ32
) 0xbadfad);

2991 ià(
pPrš‹rXBow
->
m_iLdlV”siÚ
 == 2)

2993 
	`WRITE32
 (0);

2997 
m_szCmdBuf
[
šdex
++] = 
FRAME_SYN
;

3000 
”r
 = 
pPrš‹rXBow
->
	`S’d
 (
m_szCmdBuf
, (
DWORD
è
mem_Ãeded
);

3001 
ERRCHECK
;

3003 
”r
 = 
	`S¹Page
 ();

3004 
ERRCHECK
;

3013 ià(
m_bBidœeùiÚ®PrštšgOn
 || 
m_cPrštQu®™y
 =ğ
QUALITY_NORMAL
)

3014  
NO_ERROR
;

3016 
mem_Ãeded
 = 
SIZEOF_LDLHDR
 + 2 + 
SIZEOF_LDLTERM
;

3017 
	`mem£t
 (
m_szCmdBuf
, 0, 
LDLPACKET_MINSIZE
);

3018 
šdex
 = 
mem_Ãeded
; index < 
LDLPACKET_MINSIZE
; index++)

3019 
m_szCmdBuf
[
šdex
] = 0xFF;

3020 ià(
mem_Ãeded
 < 
LDLPACKET_MINSIZE
)

3021 
mem_Ãeded
 = 
LDLPACKET_MINSIZE
;

3022 
	`FlLidH—d”
 (
NULL
, 
eLDLQu”yPrš‹r
, 
mem_Ãeded
);

3023 
šdex
 = 
SIZEOF_LDLHDR
;

3024 
m_szCmdBuf
[
šdex
++] = 3;

3025 
m_szCmdBuf
[
šdex
++] = 0;

3026 
m_szCmdBuf
[
mem_Ãeded
-1] = 
FRAME_SYN
;

3027 
pPrš‹rXBow
->
	`S’d
 (
m_szCmdBuf
, (
DWORD
è
mem_Ãeded
);

3029 
šdex
 = 0;

3030 ià((
pSS
->
	`FromDeviû
 ((*è
m_szCmdBuf
, (
WORD
 *è&
šdex
)è=ğ
NO_ERROR
)

3033 
šdex
 = 
SIZEOF_LDLHDR
 + 1;

3035 
BYTE
 
bCŞÜ
 = 
m_szCmdBuf
[
šdex
] & 0x7F;

3036 ià((
bCŞÜ
 & 0x0F) == 0x0F ||

3037 (
bCŞÜ
 & 0x7E) == 0x7E)

3038 
m_bBidœeùiÚ®PrštšgOn
 = 
TRUE
;

3042  
”r
;

3043 
	}
}

3046 
DRIVER_ERROR
 
	gLDLEnÿp
::
	$EndJob
 ()

3048 
DRIVER_ERROR
 
”r
 = 
NO_ERROR
;

3050 
UIÁ16
 
mem_Ãeded
 = 
SIZEOF_LDLHDR
 + 
SIZEOF_LDL_JOB_CMDOPT
 + 
SIZEOF_LDLTERM
;

3052 
	`FlLidH—d”
 (
NULL
, 
eLDLEndJob
, 
mem_Ãeded
);

3054 
šdex
 = 
SIZEOF_LDLHDR
;

3055 
m_szCmdBuf
[
šdex
++] = 
OPERATION_ENDJOB
;

3056 ià(
pPrš‹rXBow
->
IOMode
.
bDevID
)

3058 
	`WRITE32
 ((
UIÁ32
è
this
);

3062 
	`WRITE32
 ((
UIÁ32
) 0xbadfad);

3065 
m_szCmdBuf
[
šdex
++] = 
FRAME_SYN
;

3067 
”r
 = 
pPrš‹rXBow
->
	`S’d
 (
m_szCmdBuf
, (
DWORD
è
mem_Ãeded
);

3068 if(
”r
)

3070  
”r
;

3074 
”r
 = 
pPrš‹rXBow
->
	`S’d
 (
pbySync
, 
SYNCSIZE
);

3075 if(
”r
)

3077  
”r
;

3081 
”r
 = 
pPrš‹rXBow
->
	`S’d
 (
bySyncCom¶‘e
, (
DWORD
)  (bySyncComplete));

3082 if(
”r
)

3084  
”r
;

3088 
”r
 = 
pPrš‹rXBow
->
	`S’d
 (
byRe£tLIDIL
, (
DWORD
)  (byResetLIDIL));

3089 if(
”r
)

3091  
”r
;

3094  
NO_ERROR
;

3095 
	}
}

3097 
DRIVER_ERROR
 
	gLDLEnÿp
::
	$S¹Page
 ()

3101 
UIÁ16
 
cŞÜcouÁ
 = 0;

3102 
UIÁ32
 
mem_Ãeded
 = 
SIZEOF_LDLHDR
 + 
SIZEOF_LDL_LDPAGE_CMDOPT


3103 + 
SIZEOF_LDL_LDPAGE_OPTFLDS


3104 + 
SIZEOF_LDLTERM
;

3106 
	`mem£t
 (
m_szCmdBuf
, 0, 
mem_Ãeded
);

3108 
	`FlLidH—d”
 (
NULL
, 
eLDLLßdPage
, (
UIÁ16
è
mem_Ãeded
);

3110 
medŸty³
 = 
MEDIATYPE_PLAIN
;

3111 
BYTE
 
qu®™y
 = (BYTEè
QUALITYLEVEL_NORMAL
;

3112 ià(
m_cPrštQu®™y
 =ğ
QUALITY_BEST
 && 
m_cMedŸTy³
 =ğ
MEDIA_PHOTO
)

3114 
medŸty³
 = 
MEDIATYPE_PHOTO
;

3115 
qu®™y
 = (
BYTE
è
QUALITYLEVEL_BEST
;

3117 ià(
m_cPrštQu®™y
 =ğ
QUALITY_DRAFT
)

3118 
qu®™y
 = (
BYTE
è
QUALITYLEVEL_DRAFT
;

3120 
šdex
 = 
SIZEOF_LDLHDR
;

3121 
m_szCmdBuf
[
šdex
++] = 
medŸty³
;

3122 
m_szCmdBuf
[
šdex
++] = 
MEDIASRC_MAINTRAY
;

3123 
m_szCmdBuf
[
šdex
++] = 
MEDIADEST_MAINBIN
;

3124 
m_szCmdBuf
[
šdex
++] = 
qu®™y
;

3125 
m_szCmdBuf
[
šdex
++] = 
SPECLOAD_NONE
;

3127 
IÁ32
 
iV®
;

3128 
iV®
 = (
IÁ32
è(
m_±hisPC
->
	`PhysiÿlPageSizeX
 () * 1000);

3129 
	`WRITE32
 ((
iV®
 * 
DEVUNITS_XBOW
) / 1000);

3130 
iV®
 = (
IÁ32
è(
m_±hisPC
->
	`PhysiÿlPageSizeY
 () * 1000);

3131 
	`WRITE32
 ((
iV®
 * 
DEVUNITS_XBOW
) / 1000);

3133 
	`WRITE32
 (
MEDIALD_SPEED
|
NEED_TO_SERVICE_PERIOD
|
MINTIME_BTW_SWEEP
);

3136 
m_szCmdBuf
[
šdex
++] = 4;

3137 
m_szCmdBuf
[
šdex
++] = 0;

3138 
	`WRITE16
 (200);

3140 ià(
cŞÜcouÁ
 == 0)

3142 
m_szCmdBuf
[
šdex
++] = 
FRAME_SYN
;

3145 
m_bS¹PageNÙS’t
 = 
FALSE
;

3147  (
pPrš‹rXBow
->
	`S’d
 (
m_szCmdBuf
, (
DWORD
è
mem_Ãeded
));

3148 
	}
}

3150 
DRIVER_ERROR
 
	gLDLEnÿp
::
	$CÚtšue
 ()

3153 
UIÁ16
 
mem_Ãeded
 = 
SIZEOF_LDLHDR
 + 1

3154 + 
SIZEOF_LDLTERM
;

3155 
šdex
;

3156 
	`mem£t
 (
m_szCmdBuf
, 0, 
LDLPACKET_MINSIZE
);

3157 
šdex
 = 
mem_Ãeded
; index < 
LDLPACKET_MINSIZE
; index++)

3158 
m_szCmdBuf
[
šdex
] = 0xFF;

3159 ià(
mem_Ãeded
 < 
LDLPACKET_MINSIZE
)

3160 
mem_Ãeded
 = 
LDLPACKET_MINSIZE
;

3161 
	`FlLidH—d”
 (
NULL
, 
eLDLCÚŒŞ
, 
mem_Ãeded
);

3162 
šdex
 = 
SIZEOF_LDLHDR
;

3163 
m_szCmdBuf
[
šdex
] = 
OPERATION_CONTINUE
;

3164 
m_szCmdBuf
[
mem_Ãeded
-1] = 
FRAME_SYN
;

3165  (
pPrš‹rXBow
->
	`S’d
 (
m_szCmdBuf
, (
DWORD
è
mem_Ãeded
));

3166 
	}
}

3168 
	gLDLEnÿp
::
	$Cªûl
 ()

3171 
UIÁ16
 
mem_Ãeded
 = 
SIZEOF_LDLHDR
 + 
SIZEOF_LDL_JOB_CMDOPT


3172 + 
SIZEOF_LDLTERM
;

3173 
šdex
;

3174 
	`mem£t
 (
m_szCmdBuf
, 0, 
LDLPACKET_MINSIZE
);

3175 
šdex
 = 
mem_Ãeded
; index < 
LDLPACKET_MINSIZE
; index++)

3176 
m_szCmdBuf
[
šdex
] = 0xFF;

3177 ià(
mem_Ãeded
 < 
LDLPACKET_MINSIZE
)

3178 
mem_Ãeded
 = 
LDLPACKET_MINSIZE
;

3179 
	`FlLidH—d”
 (
NULL
, 
eLDLCÚŒŞ
, 
mem_Ãeded
);

3180 
šdex
 = 
SIZEOF_LDLHDR
;

3181 
	`WRITE32
 ((
UIÁ32
è
this
);

3182 
m_szCmdBuf
[
šdex
] = 
OPERATION_CANCJOB
;

3183 
m_szCmdBuf
[
mem_Ãeded
-1] = 
FRAME_SYN
;

3184 
pPrš‹rXBow
->
	`S’d
 (
m_szCmdBuf
, (
DWORD
è
mem_Ãeded
);

3185 
	}
}

3187 
DRIVER_ERROR
 
	gLDLEnÿp
::
	$CËªP’
 ()

3190 
UIÁ16
 
mem_Ãeded
 = 
SIZEOF_LDLHDR
 + 1 + 2

3191 + 
SIZEOF_LDLTERM
;

3192 
šdex
;

3193 
sNumSp™s
 = 32;

3194 
	`mem£t
 (
m_szCmdBuf
, 0, 
LDLPACKET_MINSIZE
);

3195 
šdex
 = 
mem_Ãeded
; index < 
LDLPACKET_MINSIZE
; index++)

3196 
m_szCmdBuf
[
šdex
] = 0xFF;

3197 ià(
mem_Ãeded
 < 
LDLPACKET_MINSIZE
)

3198 
mem_Ãeded
 = 
LDLPACKET_MINSIZE
;

3199 
	`FlLidH—d”
 (
NULL
, 
eLDLHªdËP’
, 
mem_Ãeded
);

3200 
šdex
 = 
SIZEOF_LDLHDR
;

3201 
m_szCmdBuf
[
šdex
++] = 
OPERATION_SPIT_PEN
;

3202 
	`WRITE16
 (
sNumSp™s
);

3203 
m_szCmdBuf
[
mem_Ãeded
-1] = 
FRAME_SYN
;

3204 
pPrš‹rXBow
->
	`S’d
 (
m_szCmdBuf
, (
DWORD
è
mem_Ãeded
);

3206  
NO_ERROR
;

3207 
	}
}

3209 
DRIVER_ERROR
 
	gLDLEnÿp
::
	$EndPage
 ()

3212 
DRIVER_ERROR
 
”r
 = 
NO_ERROR
;

3213 
icouÁ
 = 0;

3214 
iCurNumRa¡”s
 = 
m_iRa¡”CouÁ
;

3215 ià((
m_cPrštQu®™y
 =ğ
QUALITY_DRAFT
 || 
m_iYResŞutiÚ
 =ğ300è&& 
m_iRa¡”CouÁ
)

3216 
icouÁ
 = 1;

3217 ià(
m_cPrštQu®™y
 !ğ
QUALITY_DRAFT
)

3219 
icouÁ
 = 4 * 
m_iB™D•th
;

3220 
iCurNumRa¡”s
 = 
m_sSw©hHeight
 * 
m_iNumCŞÜs
;

3223 
i
, 
j
, 
n
;

3224 
n
 = 
m_sSw©hHeight
 / (4 * 
m_iB™D•th
);

3226 
n
 =‚ * (
m_cPassNumb”
 + 1è- 
m_iNextRa¡”
;

3227 
i
 = 0; i < 
m_iNumCŞÜs
; i++)

3229 
j
 = 0; j < 
n
; j++)

3230 
	`mem£t
 (
m_Sw©hD©a
[
i
][
m_iNextRa¡”
+
j
], 0, 
m_iImageWidth
 * 
m_iB™D•th
);

3232 
m_iNextRa¡”
 +ğ
n
;

3233 
n
 = 
m_sSw©hHeight
 / (4 * 
m_iB™D•th
);

3235 
icouÁ
)

3237 
m_iRa¡”CouÁ
 = 
iCurNumRa¡”s
;

3238 
”r
 = 
	`ProûssSw©h
 (
m_iImageWidth
);

3239 ià(
”r
 !ğ
NO_ERROR
)

3241 
icouÁ
--;

3242 ià(
m_iNextRa¡”
 >ğ
m_sSw©hHeight
)

3243 
m_iNextRa¡”
 = 0;

3244 
i
 = 0; i < 
m_iNumCŞÜs
; i++)

3246 
j
 = 0; j < 
n
; j++)

3247 
	`mem£t
 (
m_Sw©hD©a
[
i
][
m_iNextRa¡”
+
j
], 0, 
m_iImageWidth
 * 
m_iB™D•th
);

3249 
m_iNextRa¡”
 +ğ
n
;

3252 
UIÁ16
 
mem_Ãeded
 = 
SIZEOF_LDLHDR


3253 + 
SIZEOF_LDL_EJPAGE_CMDOPT


3254 + 
SIZEOF_LDL_EJPAGE_OPTFLDS


3255 + 
SIZEOF_LDLTERM
;

3257 
	`mem£t
 (
m_szCmdBuf
, 0, 
mem_Ãeded
);

3258 
	`FlLidH—d”
(
NULL
, 
eLDLEjeùPage
, 
mem_Ãeded
);

3260 
šdex
 = 
SIZEOF_LDLHDR
;

3261 
	`WRITE32
 (
MEDIA_EJSPEED
);

3263 
m_szCmdBuf
[
šdex
++] = 15;

3264 
m_szCmdBuf
[
šdex
++] = 
FRAME_SYN
;

3266 if(
”r
 =ğ
NO_ERROR
)

3268 
”r
 = 
pPrš‹rXBow
->
	`S’d
 (
m_szCmdBuf
, (
DWORD
è
mem_Ãeded
);

3271 
m_sRefCouÁ
 = 6;

3272 
m_iBÏnkRa¡”s
 = 0;

3273 
m_iV”tPo¢
 = (è(
m_±hisPC
->
	`PršbËS¹Y
 (è* 
DEVUNITS_XBOW
);

3274 
m_iRa¡”CouÁ
 = 0;

3275 
m_iNextRa¡”
 = 0;

3276 
m_iNextCŞÜ
 = 0;

3278 
fXOv”S´ay
 = 0.0;

3279 
fYOv”S´ay
 = 0.0;

3280 
fLeáOv”S´ay
 = 0.0;

3281 
fTİOv”S´ay
 = 0.0;

3282 
FuÎbËedTy³
 
fbTy³
;

3283 ià(
m_±hisPC
->
bDoFuÎBËed
 &&

3284 
pPrš‹rXBow
->
	`FuÎBËedC­abË
 (
m_±hisPC
->
theP­”Size
,

3285 &
fbTy³
,

3286 &
fXOv”S´ay
, &
fYOv”S´ay
,

3287 &
fLeáOv”S´ay
, &
fTİOv”S´ay
))

3298 
m_iV”tPo¢
 = (è(-
fTİOv”S´ay
 * 
DEVUNITS_XBOW
);

3301 iàĞ
m_cPrštQu®™y
 !ğ
QUALITY_DRAFT
)

3302 
m_iRa¡”CouÁ
 = (
m_sSw©hHeight
 - m_sSw©hHeighˆ/ 4è* 
m_iNumCŞÜs
;

3304 
m_bS¹PageNÙS’t
 = 
TRUE
;

3306 ià(
m_cPrštQu®™y
 !ğ
QUALITY_DRAFT
 && 
m_iYResŞutiÚ
 != 300)

3308 
m_iRa¡”CouÁ
 = (
m_sSw©hHeight
 - m_sSw©hHeighˆ/ (4*
m_iB™D•th
)è* 
m_iNumCŞÜs
;

3309 
m_iV”tPo¢
 -ğ(((
m_sSw©hHeight
 - m_sSw©hHeighˆ/ (4*
m_iB™D•th
)è* 600 / 
m_iYResŞutiÚ
è* 
DEVUNITS_XBOW
 / 600);

3311 
m_cPassNumb”
 = 0;

3313 ià(
m_±hisPC
->
bDoFuÎBËed
 &&

3314 
pPrš‹rXBow
->
	`FuÎBËedC­abË
 (
m_±hisPC
->
theP­”Size
,

3315 &
fbTy³
,

3316 &
fXOv”S´ay
, &
fYOv”S´ay
,

3317 &
fLeáOv”S´ay
, &
fTİOv”S´ay
))

3319 ià(
m_iV”tPo¢
 < -850) m_iVertPosn = -850;

3323 ià(
m_iV”tPo¢
 < -600) m_iVertPosn = -600;

3325 ià(
m_iB™D•th
 == 2)

3326 
m_iV”tPo¢
 += 6;

3328 
i
 = 0; i < 
m_iNumCŞÜs
; i++)

3330 
j
 = 0; j < 
m_sSw©hHeight
; j++)

3332 
	`mem£t
 (
m_Sw©hD©a
[
i
][
j
], 0, 
m_iImageWidth
);

3336  (
”r
);

3337 
	}
}

3354 
BOOL
 
	gLDLEnÿp
::
	$G‘Pack‘s
(
DWORD
 &
dwBy‹sR—d
)

3356 
DRIVER_ERROR
 
”r
 = 
NO_ERROR
;

3357 
DWORD
 
dwR—dSize
 = 0;

3358 
WORD
 
wPack‘Wa™CouÁ
 = 0;

3359 
BYTE
 *
pbyPack‘Buff
 = 
NULL
;

3361 
dwBy‹sR—d
 = 0;

3363 if(
m_pbyPack‘Buff
)

3369 if(
m_dwPack‘BuffSize
 !ğ
MAX_PACKET_READ_SIZE
)

3371 
m_pSys
->
	`F»eMem
 ((
BYTE
 *è
m_pbyPack‘Buff
);

3372 
m_pbyPack‘Buff
 = 
NULL
;

3373 
m_dwPack‘BuffSize
 = 0;

3376 
	`mem£t
(
m_pbyPack‘Buff
, 0, 
MAX_PACKET_READ_SIZE
);

3380 !
dwBy‹sR—d
 && 
wPack‘Wa™CouÁ
++ < 
PACKET_WAIT
)

3382 if(
m_pSys
->
	`BusyWa™
((
DWORD
)100è=ğ
JOB_CANCELED
)

3384  
FALSE
;

3387 
dwR—dSize
 = 
MAX_PACKET_READ_SIZE
;

3394 if(
dwBy‹sR—d
 % 
MAX_PACKET_READ_SIZE
)

3400 
dwR—dSize
 = 
MAX_PACKET_READ_SIZE
;

3402 if(!
m_pbyPack‘Buff
)

3405 
m_pbyPack‘Buff
 = 
m_pSys
->
	`AÎocMem
(
MAX_PACKET_READ_SIZE
);

3406 if(!
m_pbyPack‘Buff
)

3408  
FALSE
;

3410 
	`mem£t
(
m_pbyPack‘Buff
, 0, 
MAX_PACKET_READ_SIZE
);

3411 
m_dwPack‘BuffSize
 = 
MAX_PACKET_READ_SIZE
;

3413 if(
dwBy‹sR—d
)

3420 
pbyPack‘Buff
 = 
m_pSys
->
	`AÎocMem
(
dwBy‹sR—d
 + 
MAX_PACKET_READ_SIZE
);

3421 if(!
pbyPack‘Buff
)

3423  
FALSE
;

3425 
m_dwPack‘BuffSize
 +ğ
MAX_PACKET_READ_SIZE
;

3426 
	`mem£t
(
pbyPack‘Buff
, 0, 
m_dwPack‘BuffSize
);

3428 
	`memıy
(
pbyPack‘Buff
, 
m_pbyPack‘Buff
, 
dwBy‹sR—d
);

3429 if(
m_pbyPack‘Buff
)

3431 
m_pSys
->
	`F»eMem
((
BYTE
 *)
m_pbyPack‘Buff
);

3432 
m_pbyPack‘Buff
 = 
NULL
;

3435 
m_pbyPack‘Buff
 = 
pbyPack‘Buff
;

3438 
”r
 = 
m_pSys
->
	`FromDeviû
((
m_pbyPack‘Buff
 + 
dwBy‹sR—d
), &
dwR—dSize
);

3439 if(
”r
)

3441  
FALSE
;

3443 
dwBy‹sR—d
 +ğ
dwR—dSize
;

3444 } !
”r
 && 
dwR—dSize
);

3447 if(!
dwBy‹sR—d
)

3450  
FALSE
;

3453  
TRUE
;

3454 
	}
}

3460 
BOOL
 
	gLDLEnÿp
::
	$Upd©eS‹
(
BOOL
 
bIn™Ÿlize
)

3463 
BOOL
 
bPack‘sReûived
 = 
FALSE
;

3464 
BOOL
 
bUpd©edS‹
 = 
FALSE
;

3465 
BYTE
 
byPack‘Ty³
 = 0;

3466 
BYTE
 
byCommªdNumb”
 = 0;

3467 
WORD
 
wCommªdL’gth
 = 0;

3468 
WORD
 
wD©aL’gth
 = 0;

3469 
WORD
 
wReã»nûNumb”
 = 0;

3470 
DWORD
 
dwBy‹sR—d
 = 0;

3471 
DWORD
 
dwBy‹sProûs£d
 = 0;

3472 
BYTE
 
by
 = 0;

3475 
bPack‘sReûived
 = 
	`G‘Pack‘s
(
dwBy‹sR—d
);

3476 if(!
bPack‘sReûived
)

3478  
FALSE
;

3481 
dwBy‹sProûs£d
 < 
dwBy‹sR—d
)

3483 if(
m_pbyPack‘Buff
[
dwBy‹sProûs£d
] != '$')

3485  
FALSE
;

3489 
byPack‘Ty³
 = 
m_pbyPack‘Buff
[
PACKET_TYPE_BYTE
 + 
dwBy‹sProûs£d
];

3490 
byCommªdNumb”
 = 
m_pbyPack‘Buff
[
COMMAND_NUMBER_BYTE
 + 
dwBy‹sProûs£d
];

3491 
wCommªdL’gth
 = (
m_pbyPack‘Buff
[
COMMAND_LENGTH_BYTE
 + 
dwBy‹sProûs£d
] << 8) |

3492 
m_pbyPack‘Buff
[
COMMAND_LENGTH_BYTE
 + 1 + 
dwBy‹sProûs£d
];

3493 
wD©aL’gth
 = (
m_pbyPack‘Buff
[
DATA_LENGTH_BYTE
 + 
dwBy‹sProûs£d
] << 8) |

3494 
m_pbyPack‘Buff
[
DATA_LENGTH_BYTE
 + 1 + 
dwBy‹sProûs£d
];

3495 
wReã»nûNumb”
 = (
m_pbyPack‘Buff
[
REFERENCE_NUMBER_BYTE
 + 
dwBy‹sProûs£d
] << 8) |

3496 
m_pbyPack‘Buff
[
REFERENCE_NUMBER_BYTE
 + 1 + 
dwBy‹sProûs£d
];

3509 
byPack‘Ty³
)

3511 
ABSOLUTE_CREDIT
:

3512 if(
bIn™Ÿlize
)

3516 
byNumb”OfCommªds
 = 
m_pbyPack‘Buff
[
NUMBER_OF_COMMANDS_BYTE
];

3518 if(
piC»d™CouÁ
)

3520 
m_pSys
->
	`F»eMem
((
BYTE
*)
piC»d™CouÁ
);

3522 
piC»d™CouÁ
 =

3523 (*)(
m_pSys
->
	`AÎocMem
((è* 
byNumb”OfCommªds
));

3524 if(!
piC»d™CouÁ
)

3526  
FALSE
;

3528 
	`mem£t
(
piC»d™CouÁ
, 0, ((è* 
byNumb”OfCommªds
));

3531 
by
 = 0; by < 
byNumb”OfCommªds
; by++)

3533 
piC»d™CouÁ
[
by
] = (
m_pbyPack‘Buff
[by * 2 + 
CREDIT_BYTE
 + 
dwBy‹sProûs£d
] << 8) |

3534 (
m_pbyPack‘Buff
[
by
 * 2 + 
CREDIT_BYTE
 + 1 + 
dwBy‹sProûs£d
]);

3537 
bUpd©edS‹
 = 
TRUE
;

3541 
INCREMENTAL_CREDIT
:

3542 if(
bIn™Ÿlize
)

3548 
by
 = 0; by < 
byNumb”OfCommªds
; by++)

3550 
piC»d™CouÁ
[
by
] +ğ(
m_pbyPack‘Buff
[by * 2 + 
CREDIT_BYTE
 + 
dwBy‹sProûs£d
] << 8) |

3551 (
m_pbyPack‘Buff
[
by
 * 2 + 
CREDIT_BYTE
 + 1 + 
dwBy‹sProûs£d
]);

3554 
bUpd©edS‹
 = 
TRUE
;

3582 
RESPONSE_AUTO
:

3583 if(
bIn™Ÿlize
)

3591 
wReã»nûNumb”
)

3593 
AUTO_RESPONSE_STATUS
:

3596 
	`memıy
(
byStusBuff
, (
m_pbyPack‘Buff
 + 
dwBy‹sProûs£d
),

3597 (
wCommªdL’gth
 + 
wD©aL’gth
));

3598 
bNewStus
 = 
TRUE
;

3599 
bUpd©edS‹
 = 
TRUE
;

3611 if(
bIn™Ÿlize
)

3621 
dwBy‹sProûs£d
 +ğ(
DWORD
)(
wCommªdL’gth
 + 
wD©aL’gth
);

3624  
bUpd©edS‹
;

3625 
	}
}

3627 #ifdeà 
APDK_LDL_COMPRESS


3639 
UIÁ16
 
	gLDLEnÿp
::
	$FlushImage
 ()

3641 
UIÁ16
 
commªd
;

3642 
UIÁ16
 
wsize
;

3643 
UIÁ16
 
bsize
;

3644 
UIÁ16
 *
äom_±r
;

3645 
šdex
;

3647 
wsize
 = 
m_ldlCom´essD©a
->
image_út
;

3648 
bsize
 = 0;

3650 ià(
wsize
)

3652 
äom_±r
 = 
m_ldlCom´essD©a
->
image_±r
;

3654 
commªd
 = 
FILL_IMAGE_CMD
 | (
wsize
-1);

3656 
šdex
 = 0;

3657 
	`WRITE16
(
commªd
);

3658 ià(
m_bL™eEndŸn
)

3660 *
m_ldlCom´essD©a
->
out_±r
++ = (((
UIÁ16
è
m_szCmdBuf
[1]) << 8) | m_szCmdBuf[0];

3664 *
m_ldlCom´essD©a
->
out_±r
++ = 
commªd
;

3670 
UIÁ16
 
i
 = 0; i < 
wsize
; i++)

3672 *
m_ldlCom´essD©a
->
out_±r
++ = *
äom_±r
++;

3674 
bsize
 = ((
m_ldlCom´essD©a
->
image_út
+1) * 2);

3675 
m_ldlCom´essD©a
->
out_út
 +ğ
bsize
;

3677 
m_ldlCom´essD©a
->
image_út
 = 0;

3680  
bsize
;

3681 
	}
}

3686 
UIÁ16
 
	gLDLEnÿp
::
	$FlushCİy
 (
UIÁ16
 
v®ue
)

3688 
UIÁ16
 
commªd
;

3689 
UIÁ16
 
size
;

3691 
šdex
;

3693 
size
 = 
m_ldlCom´essD©a
->
cİy_út
;

3695 ià(
size
)

3697 
UIÁ16
 *
uP
 = 
m_ldlCom´essD©a
->
out_±r
++;

3698 
size
 = 2;

3699 ià(
v®ue
 == 0)

3701 
commªd
 = 
FILL_0000_CMD
 | (
m_ldlCom´essD©a
->
cİy_út
-1);

3703 ià(
v®ue
 == 0xFFFF)

3705 
commªd
 = 
FILL_FFFF_CMD
 | (
m_ldlCom´essD©a
->
cİy_út
-1);

3709 
commªd
 = 
FILL_NEXT_CMD
 | (
m_ldlCom´essD©a
->
cİy_út
-1);

3712 *
m_ldlCom´essD©a
->
out_±r
++ = 
v®ue
;

3714 
size
 = 4;

3717 
šdex
 = 0;

3718 
	`WRITE16
(
commªd
);

3719 ià(
m_bL™eEndŸn
)

3721 *
uP
 = (((
UIÁ16
è
m_szCmdBuf
[1]) << 8) | m_szCmdBuf[0];

3725 *
uP
 = 
commªd
;

3728 
m_ldlCom´essD©a
->
out_út
 +ğ
size
;

3729 
m_ldlCom´essD©a
->
cİy_út
 = 0;

3731  
size
;

3732 
	}
}

3737 
	gLDLEnÿp
::
	$Com´essD©a
 (
IÁ16
 
com´essiÚmode
)

3739 
IÁ16
 
i
;

3740 
UIÁ16
 *
š_±r
;

3741 
UIÁ16
 
š
;

3742 
UIÁ16
 
Ï¡
=0;

3743 
UIÁ16
 
cİy_™em
;

3744 
UIÁ16
 
d©a_Ëngth
;

3746 
LDLCOMPMODE
 
mode
 = 
IN_NOT
;

3749 
m_ldlCom´essD©a
->
out_út
 = 0;

3750 
m_ldlCom´essD©a
->
image_út
 = 0;

3751 
m_ldlCom´essD©a
->
cİy_út
 = 0;

3753 
m_ldlCom´essD©a
->
out_±r
 = &m_ldlCom´essD©a->
out_¬¿y
[8];

3754 
d©a_Ëngth
 = 
m_ldlCom´essD©a
->data_length;

3756 ià((
d©a_Ëngth
 & 1) != 0)

3761 
cİy_™em
 = 0;

3762 
š_±r
 = &
m_ldlCom´essD©a
->
¿w_d©a
[0];

3764 
i
=0; i<
d©a_Ëngth
; i+=2)

3766 
š
 = *
š_±r
;

3768 
mode
)

3770 
IN_NOT
:

3773 
Ï¡
 = 
š
;

3774 
m_ldlCom´essD©a
->
image_±r
 = 
š_±r
;

3775 
m_ldlCom´essD©a
->
image_út
 = 1;

3776 
mode
 = 
IN_FIRST
;

3780 
IN_FIRST
:

3782 #ià
ALLOW_FILL_NEXT_CMD


3783 ià(
Ï¡
 =ğ
š
)

3785 ià((
Ï¡
 =ğ
š
) && ((in==0xFFFF) || (in == 0)) )

3788 
mode
 = 
IN_COPY
;

3789 
m_ldlCom´essD©a
->
cİy_út
 = 2;

3790 
m_ldlCom´essD©a
->
image_út
 = 0;

3791 
cİy_™em
 = 
š
;

3795 
mode
 = 
IN_IMAGE
;

3796 
m_ldlCom´essD©a
->
image_út
++;

3797 
Ï¡
 = 
š
;

3802 
IN_COPY
:

3804 ià(
Ï¡
 =ğ
š
)

3806 
m_ldlCom´essD©a
->
cİy_út
++;

3814 
UIÁ16
 
cİy_couÁ
 = 
m_ldlCom´essD©a
->
cİy_út
;

3816 ià(
cİy_couÁ
 <ğ
m_ldlCom´essD©a
->
run_Ëngth
)

3818 ià(
m_ldlCom´essD©a
->
image_út
 == 0)

3821 
m_ldlCom´essD©a
->
image_±r
 = 
š_±r
 - 
cİy_couÁ
;

3823 
m_ldlCom´essD©a
->
image_út
 +ğ(1+
cİy_couÁ
);

3824 
m_ldlCom´essD©a
->
cİy_út
 = 0;

3830 (è
	`FlushImage
 ();

3832 (è
	`FlushCİy
 (
cİy_™em
);

3834 
m_ldlCom´essD©a
->
image_±r
 = 
š_±r
;

3835 
m_ldlCom´essD©a
->
image_út
 = 1;

3837 
mode
 = 
IN_IMAGE
;

3838 
Ï¡
 = 
š
;

3843 
IN_IMAGE
:

3845 #ià
ALLOW_FILL_NEXT_CMD


3846 ià(
Ï¡
 =ğ
š
)

3848 ià((
Ï¡
 =ğ
š
) && ((in==0xFFFF) || (in == 0)) )

3851 
m_ldlCom´essD©a
->
image_út
--;

3853 
mode
 = 
IN_COPY
;

3854 
cİy_™em
 = 
š
;

3855 
m_ldlCom´essD©a
->
cİy_út
 = 2;

3859 
Ï¡
 = 
š
;

3860 
m_ldlCom´essD©a
->
image_út
++;

3870 
š_±r
++;

3875 
mode
)

3877 
IN_COPY
:

3880 (è
	`FlushImage
 ();

3882 (è
	`FlushCİy
 (
cİy_™em
);

3885 
IN_IMAGE
:

3886 
IN_FIRST
:

3888 (è
	`FlushImage
 ();

3895 ià(
m_ldlCom´essD©a
->
out_út
 > 2048+16)

3900 
	}
}

3905 
BOOL
 
	gLDLEnÿp
::
	$G‘F¿meInfo
 (
BYTE
 **
outd©a
, 
UIÁ16
 *
d©a_size
)

3907 *
outd©a
 = (*è&
m_ldlCom´essD©a
->
out_¬¿y
[0];

3908 *
d©a_size
 = 
m_ldlCom´essD©a
->
out_út
;

3909 (
TRUE
);

3910 
	}
}

3915 
BOOL
 
	gcomp_±rs_t
::
	$In™
 (
UIÁ16
 *
d©a
, UIÁ16 
d©asize
)

3917 
image_±r
 = 
d©a
;

3918 
¿w_d©a
 = 
d©a
;

3919 
d©a_Ëngth
 = 
d©asize
;

3921 
run_Ëngth
 = 
MAX_RUNLENGTH
;

3922 
di¥Ïy
 = 0;

3924 (
TRUE
);

3925 
	}
}

3928 
	gAPDK_END_NAMESPACE


	@prnt/hpijs/dj3320.h

35 #iâdeà
APDK_DJ3320_H


36 
	#APDK_DJ3320_H


	)

38 
	~"cÚfig.h
"

40 
	gAPDK_BEGIN_NAMESPACE


42 
	~"ldËnÿp.h
"

44 
şass
 
	gLDLEnÿp
;

46 şas 
	cDJ3320
 : 
public
 
Prš‹r


48 
public
:

49 
DJ3320
 (
Sy¡emS”viûs
* 
pSS
, 
BOOL
 
´Ùo
 = 
FALSE
);

51 
	mvœtu®
 ~
DJ3320
 ();

53 
H—d”
* 
S–eùH—d”
(
PrštCÚ‹xt
* 
pc
);

54 
vœtu®
 
DRIVER_ERROR
 
S’d
 (cÚ¡ 
BYTE
 *
pWr™eBuff
, 
DWORD
 
dwWr™eL’
);

56 #ifdeà
APDK_HP_UX


57 
vœtu®
 
DRIVER_ERROR
 
	$S’d
 (cÚ¡ 
BYTE
 *
pWr™eBuff
)

59  
	`S’d
 (
pWr™eBuff
, 
	`¡¾’
 ((const *)…WriteBuff));

63 
vœtu®
 
DRIVER_ERROR
 
	`EnÿpsuÏ‹
 (cÚ¡ 
RASTERDATA
 *
pRa¡”D©a
, 
BOOL
 
bLa¡PÏÃ
);

64 
DRIVER_ERROR
 
	`V”ifyP’Info
 ();

65 
vœtu®
 
DRIVER_ERROR
 
	`P¬£P’Info
 (
PEN_TYPE
& 
eP’
, 
BOOL
 
Qu”yPrš‹r
 = 
TRUE
);

66 
vœtu®
 
DRIVER_ERROR
 
	`SkRa¡”s
 (
nBÏnkRa¡”s
);

67 
vœtu®
 
DRIVER_ERROR
 
	`CËªP’
 ();

68 
vœtu®
 
DRIVER_ERROR
 
	`Flush
 (
FlushSize
);

69 
DRIVER_ERROR
 
	`S‘P’s
 (
PEN_TYPE
 
eNewP’
);

70 
vœtu®
 
DRIVER_ERROR
 
	`CheckInkLev–
();

72 
DISPLAY_STATUS
 
	`P¬£E¼Ü
 (
BYTE
 
byStusReg
);

74 
šlše
 
vœtu®
 
BOOL
 
	$SuµÜtS•¬©eBÏck
 (
PrštMode
 *
pCu¼’tMode
)

76 ià(
pCu¼’tMode
->
CŞÜD•th
[1] == 2)

78  
FALSE
;

80  
TRUE
;

81 
	}
}

84 
LDLEnÿp
 *
	gpLDLEnÿp
;

85 
	gm_iBy‹sP”Swšg
;

86 
	gm_iLdlV”siÚ
;

87 
	gm_iCŞÜP’ResŞutiÚ
;

88 
	gm_iBÏckP’ResŞutiÚ
;

89 
	gm_iNumBÏckNozzËs
;

91 
	g´Ùeùed
:

92 
DISPLAY_STATUS
 
m_dsCu¼’tStus
;

93 
vœtu®
 
In™PrštModes
 ();

94 
vœtu®
 
	$Adju¡ResŞutiÚ
 ()

97 
	}
}

99 #ifdeà
APDK_HP_UX


100 
	g´Ùeùed
:

101 
vœtu®
 
DJ3320
& 
İ”©Ü
 = (
Prš‹r
& 
rhs
)

103  *
this
;

109 şas 
	cDJ3320G¿yMode
 : 
public
 
PrštMode


111 
public
:

112 
DJ3320G¿yMode
 (
PEN_TYPE
 
eP’
);

115 şas 
	cDJ3320KD¿áMode
 : 
public
 
G¿yMode


117 
public
:

118 
DJ3320KD¿áMode
 ();

121 şas 
	cDJ3320D¿áMode
 : 
public
 
PrštMode


123 
public
:

124 
DJ3320D¿áMode
 (
PEN_TYPE
 
eP’
);

128 şas 
	cDJ3320NÜm®Mode
 : 
public
 
PrštMode


130 
public
:

131 
DJ3320NÜm®Mode
 (
PEN_TYPE
 
eP’
);

135 şas 
	cDJ3320PhÙoMode
 : 
public
 
PrštMode


137 
public
:

138 
DJ3320PhÙoMode
 ();

141 şas 
	cDJ3600MDLNÜm®Mode
 : 
public
 
PrštMode


143 
public
:

144 
DJ3600MDLNÜm®Mode
 ();

148 şas 
	cDJ3600MDLD¿áMode
 : 
public
 
PrštMode


150 
public
:

151 
DJ3600MDLD¿áMode
 ();

155 şas 
	cDJ3600MDLPhÙoMode
 : 
public
 
PrštMode


157 
public
:

158 
DJ3600MDLPhÙoMode
 ();

162 #ià
defšed
 (
APDK_DJ3320
)

167 şas 
	cDJ3320Proxy
 : 
public
 
Prš‹rProxy


169 
public
:

170 
	$DJ3320Proxy
(è: 
	`Prš‹rProxy
(

187 #ifdeà
APDK_MLC_PRINTER


200 è{
m_iPrš‹rTy³
 = 
eDJ3320
;}

201 
šlše
 
Prš‹r
* 
	$C»©ePrš‹r
(
Sy¡emS”viûs
* 
pSS
ècÚ¡ {  
Ãw
 
	`DJ3320
ÕSS); 
	}
}

202 
šlše
 
PRINTER_TYPE
 
	$G‘Prš‹rTy³
(ècÚ¡ {  
eDJ3320
;
	}
}

203 
šlše
 
	$G‘Mod–B™
(ècÚ¡ {  0x100;
	}
}

208 
	#SWATH_HEIGHT
 100

209 

	)

210 #ifdeà 
APDK_LDL_COMPRESS


217 
	#ALLOW_FILL_NEXT_CMD
 1

	)

219 
	#FILL_0000_CMD
 0x1000

	)

220 
	#FILL_FFFF_CMD
 0x2000

	)

221 
	#FILL_NEXT_CMD
 0x3000

	)

222 
	#FILL_IMAGE_CMD
 0x4000

	)

223 
	#FILL_ODD_CMD
 0x5000

	)

224 
	#FILL_EVEN_CMD
 0x6000

	)

226 
	#MAX_HEADER_FRAME_SIZE
 512

	)

227 
	#MAX_DATA_FRAME_SIZE
 6048

	)

228 
	#MAX_RUNLENGTH
 5

	)

232 
	mIN_NOT
,

233 
	mIN_FIRST
,

234 
	mIN_IMAGE
,

235 
	mIN_COPY


236 } 
	tLDLCOMPMODE
;

238 şas 
	ccomp_±rs_t


240 
	mpublic
:

241 
	$comp_±rs_t
 (
UIÁ16
 *
d©a
,UIÁ16 
d©asize
):
	`image_±r
(d©a),
	`¿w_d©a
(data),

242 
	$d©a_Ëngth
(
d©asize
){};

243 
	$comp_±rs_t
 (è{
	}
};

244 ~
	$comp_±rs_t
 (è{
	}
};

246 
	gpublic
:

247 
BOOL
 
In™
(
UIÁ16
 *
d©a
, UIÁ16 
d©asize
);

248 
UIÁ16
 *
	gout_±r
, *
	gimage_±r
;

249 
UIÁ16
 
	gout_út
, 
	gimage_út
, 
	gcİy_út
;

250 
UIÁ16
 
	gout_¬¿y
[2048+16];

251 
UIÁ16
 *
	g¿w_d©a
;

252 
UIÁ16
 
	gšput_size
;

254 
UIÁ16
 
	gcom´ess
;

255 
UIÁ16
 
	gdi¥Ïy
;

256 
UIÁ16
 
	grun_Ëngth
;

258 
UIÁ16
 
	gd©a_Ëngth
;

259 
UIÁ16
 
	gimage_by‹s
;

260 
UIÁ16
 
	gcommªd_numb”
;

261 
UIÁ16
 
	gd©a_ty³
;

265 şas 
	cLDLEnÿp


267 
	mpublic
:

268 
LDLEnÿp
 (
DJ3320
 *
pPrš‹r
, 
Sy¡emS”viûs
 *
pSys
, 
PrštCÚ‹xt
 *
pc
);

269 
DRIVER_ERROR
 
EnÿpsuÏ‹
 (cÚ¡ 
BYTE
* 
šput
, 
DWORD
 
size
, 
BOOL
 
bLa¡PÏÃ
);

270 ~
LDLEnÿp
 ();

272 
DRIVER_ERROR
 
S¹Job
 ();

273 
DRIVER_ERROR
 
EndPage
 ();

274 
DRIVER_ERROR
 
EndJob
 ();

275 
DRIVER_ERROR
 
CÚtšue
 ();

276 
DRIVER_ERROR
 
CËªP’
 ();

277 
Cªûl
 ();

278 
Flush
 ();

279 
DRIVER_ERROR
 
S‘V”tiÿlSk
 (
nBÏnkRa¡”s
);

280 
AÎoÿ‹Sw©hBufãr
 (
Ra¡”Size
);

282 
BOOL
 
Upd©eS‹
 (BOOL 
bIn™Ÿlize
);

284 
DJ3320
 *
	mpPrš‹rXBow
;

285 
DRIVER_ERROR
 
	mcÚ¡ruùÜ_”rÜ
;

287 *
	mpiC»d™CouÁ
;

288 
BYTE
 
	mbyNumb”OfCommªds
;

289 
BYTE
 
	mbyStusBuff
[
DevIDBuffSize
];

290 
BOOL
 
	mbNewStus
;

292 
BYTE
 
	mpbyCªûl
[
CANCELSIZE
];

293 
BYTE
 *
	mpbySync
;

295 
	m´iv©e
:

296 
DRIVER_ERROR
 
S¹Page
 ();

298 
Sy¡emS”viûs
 *
	mm_pSys
;

299 
	mm_iRa¡”CouÁ
;

300 
	mm_iImageWidth
;

301 
	mm_iXResŞutiÚ
;

302 
	mm_iYResŞutiÚ
;

303 
UIÁ16
 
	mm_sRefCouÁ
;

304 
	mm_iNumCŞÜs
;

305 
	mm_cPrštDœeùiÚ
;

306 
BYTE
 *
	mm_szCmdBuf
;

307 
BOOL
 
	mm_bL™eEndŸn
;

308 
PrštCÚ‹xt
 *
	mm_±hisPC
;

309 
BYTE
 ***
	mm_Sw©hD©a
;

310 
	mm_sSw©hHeight
;

311 
	mm_iBÏnkRa¡”s
;

312 
	mm_iV”tPo¢
;

313 
	mm_iLeáM¬gš
;

314 
BOOL
 
	mm_bBidœeùiÚ®PrštšgOn
;

315 
IÁ16
 
	mm_iB™D•th
;

316 
BYTE
 
	mm_cPassNumb”
;

317 
BYTE
 
	mm_cPÏÃNumb”
;

318 
BYTE
 
	mm_cPrštQu®™y
;

319 
BYTE
 
	mm_cMedŸTy³
;

320 
BYTE
 *
	mm_szCom´essBuf
;

321 
	mm_iNextRa¡”
;

322 
	mm_iNextCŞÜ
;

324 
BOOL
 
	mm_bS¹PageNÙS’t
;

326 
UIÁ16
 
	mm_uV®16
;

327 
UIÁ32
 
	mm_uV®32
;

328 
BYTE
 *
	mm_cBy‹
;

329 
BYTE
 *
	mm_pbyPack‘Buff
;

330 
DWORD
 
	mm_dwPack‘BuffSize
;

336 
BYTE
 
	mm_cKtoCV”tAlign
;

337 
BYTE
 
	mm_cPtoCV”tAlign
;

339 
DRIVER_ERROR
 
PrštSw“p
 (
UIÁ32
 
Sw“pSize
,

340 
BOOL
 
CŞÜP»£Á
,

341 
BOOL
 
BÏckP»£Á
,

342 
BOOL
 
PhÙoP»£Á
,

343 
IÁ32
 
V”tiÿlPos™iÚ
,

344 
IÁ32
 
LeáEdge
,

345 
IÁ32
 
RightEdge
,

346 
PrštDœeùiÚ
,

347 
IÁ16
 
sFœ¡NozzË
,

348 
IÁ16
 
sLa¡NozzË
 = 0);

349 
DRIVER_ERROR
 
LßdSw“pD©a
 (
BYTE
 *
d©aPŒ
, 
imagesize
);

350 
FlLidH—d”
 (*
pLidHdr
, 
Commªd
,

351 
UIÁ16
 
CmdL’
, UIÁ16 
D©aL’
);

352 
G‘Sw©hWidth
 (
iFœ¡
, 
iLa¡
, 
iWidth
);

353 
BOOL
 
IsBÏnkRa¡”
 (
BYTE
 *
šput
, 
iWidth
);

354 
DRIVER_ERROR
 
ProûssSw©h
 (
iCurRa¡”Width
);

356 
BOOL
 
G‘Pack‘s
 (
DWORD
 &
dwBy‹sR—d
);

358 #ifdeà 
APDK_LDL_COMPRESS


363 
BOOL
 
G‘F¿meInfo
 (
BYTE
 **
outd©a
, 
UIÁ16
 *
d©asize
);

364 
Com´essD©a
 (
IÁ16
 
com´essmode
 = 1);

366 
UIÁ16
 
FlushCİy
 (UIÁ16 
v®ue
);

367 
UIÁ16
 
FlushImage
 ();

369 
comp_±rs_t
 *
	mm_ldlCom´essD©a
;

374 
	#WRITE16
(
v®ue
) \

375 
m_uV®16
 = 
v®ue
; \

376 
m_cBy‹
 = (
BYTE
 *è&
m_uV®16
; \

377 ià(
m_bL™eEndŸn
) \

379 
m_szCmdBuf
[
šdex
++] = 
m_cBy‹
[1]; \

380 
m_szCmdBuf
[
šdex
++] = 
m_cBy‹
[0]; \

384 
	`memıy
 (
m_szCmdBuf
+
šdex
, 
m_cBy‹
, 2); \

385 
šdex
 += 2; \

386 }

	)

388 
	#WRITE32
(
v®ue
) \

389 
m_uV®32
 = 
v®ue
; \

390 
m_cBy‹
 = (
BYTE
 *è&
m_uV®32
; \

391 ià(
m_bL™eEndŸn
) \

393 
m_szCmdBuf
[
šdex
++] = 
m_cBy‹
[3]; \

394 
m_szCmdBuf
[
šdex
++] = 
m_cBy‹
[2]; \

395 
m_szCmdBuf
[
šdex
++] = 
m_cBy‹
[1]; \

396 
m_szCmdBuf
[
šdex
++] = 
m_cBy‹
[0]; \

400 
	`memıy
 (
m_szCmdBuf
+
šdex
, 
m_cBy‹
, 4); \

401 
šdex
 += 4; \

402 }

	)

404 
	gAPDK_END_NAMESPACE


	@prnt/hpijs/dj3320_cmap.cpp

32 #ifdeà
APDK_DJ3320


34 
	~"cÚfig.h
"

36 
	~"glob®_ty³s.h
"

38 
APDK_BEGIN_NAMESPACE


41 
ušt32_t
 
	gulM­DJ3320_K_3x3x1
[] =

169 
ušt32_t
 
	gulM­DJ3320_K_6x6x1
[] =

297 
ušt32_t
 
	gulM­DJ3320_CMY_3x3x1
[ 9 * 9 * 9 ] =

425 
ušt32_t
 
	gulM­DJ3320_KCMY_3x3x1
[ 9 * 9 * 9 ] =

553 
ušt32_t
 
	gulM­DJ3320_CMY_6x6x1
[ 9 * 9 * 9 ] =

681 
ušt32_t
 
	gulM­DJ3320_KCMY_6x6x1
[ 9 * 9 * 9 ] =

807 
	gAPDK_END_NAMESPACE


	@prnt/hpijs/dj350.cpp

32 #ifdeà
APDK_DJ350


34 
	~"h—d”.h
"

35 
	~"dj6xx.h
"

36 
	~"dj600.h
"

37 
	~"dj350.h
"

38 
	~"´š‹½roxy.h
"

40 
APDK_BEGIN_NAMESPACE


42 
ušt32_t
 
ulM­DJ600_CCM_CMY
[ 9 * 9 * 9 ];

43 
ušt32_t
 
ulM­DJ600_CCM_K
[ 9 * 9 * 9 ];

45 
	gDJ350
::
	$DJ350
(
Sy¡emS”viûs
* 
pSS
, 
numfÚts
, 
BOOL
 
´Ùo
)

46 : 
	$DJ600
 (
pSS
, 
´Ùo
)

48 
CMYM­
 = 
ulM­DJ600_CCM_CMY
;

52 #ifdeà
APDK_EXTENDED_MEDIASIZE


53 
ModeCouÁ
 = 5;

55 
ModeCouÁ
 = 2;

58 
	`DBG1
("DJ350 created\n");

59 
	}
}

62 
	gMode350KPhÙo
::
	$Mode350KPhÙo
 (
ušt32_t
 *
m­
)

63 : 
	$PrštMode
 (
m­
)

65 
theQu®™y
 = 
qu®™yP»£Á©iÚ
;

66 
dyeCouÁ
 = 1;

67 
Ba£ResX
 = 600;

68 
Ba£ResY
 = 600;

69 
ResŞutiÚX
[0] = 600;

70 
ResŞutiÚY
[0] = 600;

71 
Com·tibËP’s
[0] = 
BLACK_PEN
;

73 
MixedRes
 = 
FALSE
;

75 
	}
}

77 
	gMode350CPhÙo
::
	$Mode350CPhÙo
 (
ušt32_t
 *
m­
)

78 : 
	$PrštMode
 (
m­
)

80 
theQu®™y
 = 
qu®™yP»£Á©iÚ
;

81 
dyeCouÁ
 = 3;

83 
Com·tibËP’s
[0] = 
COLOR_PEN
;

85 
medium
 = 
medŸS³cŸl
;

88 
	}
}

91 
	gH—d”350
::
	$H—d”350
 (
Prš‹r
 *
p
, 
PrštCÚ‹xt
* 
pc
è: 
	$H—d”
 (
p
, 
pc
)

92 { 
	}
}

94 
DRIVER_ERROR
 
	gH—d”350
::
	$S’d
 ()

96 
DRIVER_ERROR
 
”r
;

98 
	`S¹S’d
 ();

100 ià(
dyeCouÁ
 =ğ3 || 
ResŞutiÚY
[0] == 600)

102 
”r
 = 
	`CÚfigu»Ra¡”D©a
 ();

103 
ERRCHECK
;

107 
”r
 = 
	`Sim¶e
 ();

108 
ERRCHECK
;

112 ià(
ResŞutiÚY
[0] == 600)

114 
uom
[10];

115 
	`¥rštf
(
uom
,"%c%c%c%d%c",
ESC
,'&','u',
thePrštMode
->
ResŞutiÚY
[
K
],'D');

116 
”r
=
thePrš‹r
->
	`S’d
((cÚ¡ 
BYTE
*)
uom
, 7 );

117 
ERRCHECK
;

121 
”r
 = 
	`G¿phics
();

123  
”r
;

124 
	}
}

126 
H—d”
* 
	gDJ350
::
	$S–eùH—d”
 (
PrštCÚ‹xt
 *
pc
)

128  
Ãw
 
	`H—d”350
 (
this
, 
pc
);

129 
	}
}

131 
	gAPDK_END_NAMESPACE


	@prnt/hpijs/dj350.h

32 #iâdeà
DJ350_H


33 
	#DJ350_H


	)

35 
APDK_BEGIN_NAMESPACE


42 şas 
	cDJ350
 : 
public
 
DJ600


44 
public
:

45 
DJ350
(
Sy¡emS”viûs
* 
pSS
,
numfÚts
=0, 
BOOL
 
´Ùo
=
FALSE
);

47 
vœtu®
 
H—d”
* 
S–eùH—d”
(
PrštCÚ‹xt
* 
pc
);

51 #ifdeà
APDK_DJ350


55 şas 
	cDJ350Proxy
 : 
public
 
Prš‹rProxy


57 
public
:

58 
	$DJ350Proxy
(è: 
	`Prš‹rProxy
(

61 #ifdeà
APDK_MLC_PRINTER


63 è{
m_iPrš‹rTy³
 = 
eDJ350
;}

64 
šlše
 
Prš‹r
* 
	$C»©ePrš‹r
(
Sy¡emS”viûs
* 
pSS
ècÚ¡ {  
Ãw
 
	`DJ350
ÕSS); 
	}
}

65 
šlše
 
PRINTER_TYPE
 
	$G‘Prš‹rTy³
(ècÚ¡ {  
eDJ350
;
	}
}

66 
šlše
 
	$G‘Mod–B™
(ècÚ¡ {  0x800;
	}
}

70 
	gAPDK_END_NAMESPACE


	@prnt/hpijs/dj3600.cpp

32 #ià
defšed
(
APDK_DJ3600
è&& defšed (
APDK_DJ3320
)

34 
	~"h—d”.h
"

35 
	~"dj3320.h
"

36 
	~"dj3600.h
"

37 
	~"´š‹½roxy.h
"

39 
APDK_BEGIN_NAMESPACE


41 
	gDJ3600
::
	$DJ3600
 (
Sy¡emS”viûs
* 
pSS
, 
BOOL
 
´Ùo
)

42 : 
	$DJ3320
 (
pSS
, 
´Ùo
)

44 
	}
}

57 
BOOL
 
	gDJ3600
::
	$FuÎBËedC­abË
 (
PAPER_SIZE
 
ps
, 
FuÎbËedTy³
 *
fbTy³
, *
xOv”S´ay
, *
yOv”S´ay
,

58 *
fLeáOv”S´ay
, *
fTİOv”S´ay
)

60 
BYTE
 
sDevIdSŒ
[
DevIDBuffSize
];

61 *
pSŒ
;

62 ià(
pSS
->
IOMode
.
bDevID
 && (pSS->
	`G‘DeviûID
 (
sDevIdSŒ
, 
DevIDBuffSize
, 
FALSE
)è=ğ
NO_ERROR
)

64 ià((
pSŒ
 = 
	`¡r¡r
 ((*è
sDevIdSŒ
, ";S:")))

66 
by‹13
 = 
pSŒ
[18];

67 
v®ue
 = (
by‹13
 >= '0' && byte13 <= '9') ? byte13 - '0' :

68 ((
by‹13
 >= 'A' && byte13 <= 'F') ? byte13 - 'A' + 10 :

69 ((
by‹13
 >= 'a' && byte13 <= 'f') ? byte13 - 'a' + 10 : -1));

70 
ps
)

72 
PHOTO_SIZE
:

73 
A6
:

74 
CARD_4x6
:

75 
OUFUKU
:

76 
HAGAKI
:

77 
A6_WITH_TEAR_OFF_TAB
:

79 *
xOv”S´ay
 = () 0.216;

80 *
yOv”S´ay
 = () 0.174;

82 ià(
fLeáOv”S´ay
)

83 *
fLeáOv”S´ay
 = () 0.098;

84 ià(
fTİOv”S´ay
)

85 *
fTİOv”S´ay
 = () 0.070;

87 ià(
ps
 =ğ
PHOTO_SIZE
 ||… =ğ
A6_WITH_TEAR_OFF_TAB
)

88 *
fbTy³
 = 
fuÎbËed4EdgeAÎMedŸ
;

89 ià((
v®ue
 != -1) && ((value & 0x03) == 0x03))

90 *
fbTy³
 = 
fuÎbËed4EdgeAÎMedŸ
;

91 ià((
v®ue
 != -1) && ((value & 0x01) == 0x01))

92 *
fbTy³
 = 
fuÎbËed4EdgePhÙoMedŸ
;

93 ià((
v®ue
 != -1) && ((value & 0x02) == 0x02))

94 *
fbTy³
 = 
fuÎbËed4EdgeNÚPhÙoMedŸ
;

96 *
fbTy³
 = 
fuÎbËed3EdgeAÎMedŸ
;

98  
TRUE
;

107 
ps
)

109 
PHOTO_SIZE
:

110 
A6
:

111 
CARD_4x6
:

112 
OUFUKU
:

113 
HAGAKI
:

114 
A6_WITH_TEAR_OFF_TAB
:

116 *
xOv”S´ay
 = () 0.216;

117 *
yOv”S´ay
 = () 0.174;

119 ià(
fLeáOv”S´ay
)

120 *
fLeáOv”S´ay
 = () 0.098;

121 ià(
fTİOv”S´ay
)

122 *
fTİOv”S´ay
 = () 0.070;

124 ià(
ps
 =ğ
PHOTO_SIZE
 ||… =ğ
A6_WITH_TEAR_OFF_TAB
)

125 *
fbTy³
 = 
fuÎbËed4EdgeAÎMedŸ
;

127 *
fbTy³
 = 
fuÎbËed3EdgeAÎMedŸ
;

129  
TRUE
;

135 *
xOv”S´ay
 = () 0;

136 *
yOv”S´ay
 = () 0;

137 ià(
fLeáOv”S´ay
)

138 *
fLeáOv”S´ay
 = () 0;

139 ià(
fTİOv”S´ay
)

140 *
fTİOv”S´ay
 = () 0;

141 *
fbTy³
 = 
fuÎbËedNÙSuµÜ‹d
;

142  
FALSE
;

143 
	}
}

146 
	gAPDK_END_NAMESPACE


	@prnt/hpijs/dj3600.h

32 #iâdeà
APDK_DJ3600_H


33 
	#APDK_DJ3600_H


	)

35 
APDK_BEGIN_NAMESPACE


42 şas 
	cDJ3600
 : 
public
 
DJ3320


44 
public
:

45 
DJ3600
 (
Sy¡emS”viûs
* 
pSS
, 
BOOL
 
´Ùo
 = 
FALSE
);

46 
vœtu®
 
BOOL
 
FuÎBËedC­abË
 (
PAPER_SIZE
 
ps
, 
FuÎbËedTy³
 *
fbTy³
, *
xOv”S´ay
, *
yOv”S´ay
,

47 *
fLeáOv”S´ay
, *
fTİOv”S´ay
);

51 #ià
defšed
(
APDK_DJ3600
è&& defšed (
APDK_DJ3320
)

55 şas 
	cDJ3600Proxy
 : 
public
 
Prš‹rProxy


57 
public
:

58 
	$DJ3600Proxy
(è: 
	`Prš‹rProxy
(

74 #ifdeà
APDK_MLC_PRINTER


82 è{
m_iPrš‹rTy³
 = 
eDJ3600
;}

83 
šlše
 
Prš‹r
* 
	$C»©ePrš‹r
(
Sy¡emS”viûs
* 
pSS
ècÚ¡ {  
Ãw
 
	`DJ3600
ÕSS); 
	}
}

84 
šlše
 
PRINTER_TYPE
 
	$G‘Prš‹rTy³
(ècÚ¡ {  
eDJ3600
;
	}
}

85 
šlše
 
	$G‘Mod–B™
(ècÚ¡ {  0x2;
	}
}

89 
	gAPDK_END_NAMESPACE


	@prnt/hpijs/dj3600_cmap.cpp

32 #ifdeà
APDK_DJ3600


34 
	~"cÚfig.h
"

36 
	~"glob®_ty³s.h
"

38 
APDK_BEGIN_NAMESPACE


42 
ušt32_t
 
	gulM­DJ3600_KCMY_6x6x1
[ 9 * 9 * 9 ] =

170 
ušt32_t
 
	gulM­DJ3600_ClMlxx_6x6x1
[ 9 * 9 * 9 ] =

299 
ušt32_t
 
	gulM­DJ3600_KCMY_6x6x2
[ 9 * 9 * 9 ] =

427 
ušt32_t
 
	gulM­DJ3600_ClMlxx_6x6x2
[ 9 * 9 * 9 ] =

556 
ušt32_t
 
	gulM­DJ3600_KCMY_3x3x1
[ 9 * 9 * 9 ] =

684 
ušt32_t
 
	gulM­DJ3600_ClMlxx_3x3x1
[ 9 * 9 * 9 ] =

809 
	gAPDK_END_NAMESPACE


	@prnt/hpijs/dj400.h

32 #iâdeà
APDK_DJ400_H


33 
	#APDK_DJ400_H


	)

35 
APDK_BEGIN_NAMESPACE


40 şas 
	cDJ400
 : 
public
 
Prš‹r


42 
public
:

43 
DJ400
(
Sy¡emS”viûs
* 
pSS
,
BOOL
 
´Ùo
=
FALSE
);

45 #ià
	$defšed
(
APDK_FONTS_NEEDED
)

46 
FÚt
* 
	`R—lizeFÚt
(cÚ¡ 
šdex
,cÚ¡ 
BYTE
 
bSize
,

47 cÚ¡ 
TEXTCOLOR
 
eCŞÜ
=
BLACK_TEXT
,

48 cÚ¡ 
BOOL
 
bBŞd
=
FALSE
,cÚ¡ BOOL 
bIlic
=FALSE,

49 cÚ¡ 
BOOL
 
bUnd”lše
=
FALSE
);

51 
H—d”
* 
	`S–eùH—d”
(
PrštCÚ‹xt
* 
pc
);

52 
DRIVER_ERROR
 
	`V”ifyP’Info
();

53 
vœtu®
 
DRIVER_ERROR
 
	`P¬£P’Info
(
PEN_TYPE
& 
eP’
, 
BOOL
 
Qu”yPrš‹r
=
TRUE
);

54 
BOOL
 
	`TİCov”O³n
(
BYTE
 
¡©us_»g
);

55 
DRIVER_ERROR
 
	`CËªP’
();

56 
vœtu®
 
DISPLAY_STATUS
 
	`P¬£E¼Ü
(
BYTE
 
¡©us_»g
);

57 
vœtu®
 
PEN_TYPE
 
	`DeçuÉP’S‘
();

58 
vœtu®
 
BOOL
 
	$G‘M¬gšs
 (
PAPER_SIZE
 
ps
, *
fM¬gšs
)

60 ià(
ps
 =ğ
A4
)

61 
fM¬gšs
[0] = () 0.135;

63 
fM¬gšs
[0] = () 0.25;

64 
fM¬gšs
[1] = fMargins[0];

65 
fM¬gšs
[2] = () 0.125;

66 
fM¬gšs
[3] = () 0.67;

67  
TRUE
;

70 
´Ùeùed
:

72 #ifdeà
APDK_HP_UX


73 
vœtu®
 
DJ400
& 
İ”©Ü
 = (
Prš‹r
& 
rhs
)

75  *
this
;

76 
	}
}

79 
vœtu®
 
DRIVER_ERROR
 
G‘C32Stus
(
BYTE
 *
pStusSŒšg
, *
pL’
);

80 
	gÏ¡_C32_¡©us
;

85 şas 
	cMode400
 : 
public
 
PrštMode


87 
public
:

88 
Mode400
();

92 #ifdeà
APDK_DJ400


97 şas 
	cDJ400Proxy
 : 
public
 
Prš‹rProxy


99 
public
:

100 
	$DJ400Proxy
(è: 
	`Prš‹rProxy
(

103 #ifdeà
APDK_MLC_PRINTER


105 è{
m_iPrš‹rTy³
 = 
eDJ400
;}

106 
šlše
 
Prš‹r
* 
	$C»©ePrš‹r
(
Sy¡emS”viûs
* 
pSS
ècÚ¡ {  
Ãw
 
	`DJ400
ÕSS); 
	}
}

107 
šlše
 
PRINTER_TYPE
 
	$G‘Prš‹rTy³
(ècÚ¡ {  
eDJ400
;
	}
}

108 
šlše
 
	$G‘Mod–B™
(ècÚ¡ {  0x800000;
	}
}

113 
	gAPDK_END_NAMESPACE


	@prnt/hpijs/dj4100.h

32 #iâdeà
APDK_DJ4100_H


33 
	#APDK_DJ4100_H


	)

34 #ià
defšed
(
APDK_DJ3600
è&& defšed (
APDK_DJ3320
)

36 
APDK_BEGIN_NAMESPACE


37 
ucM­DJ4100_KCMY_6x6x1
[];

38 
ucM­DJ4100_KCMY_PhÙo_Be¡V_12x12x1
[];

39 
ucM­DJ4100_KCMY_PhÙo_Be¡A_12x12x1
[];

40 
BYTE
 *
G‘HT12x12x1_4100_PhÙo_Be¡
 ();

46 şas 
	cDJ4100
 : 
public
 
DJ3600


48 
public
:

49 
	$DJ4100
 (
Sy¡emS”viûs
* 
pSS
, 
BOOL
 
´Ùo
 = 
FALSE
è: 
	$DJ3600
 (
pSS
, 
´Ùo
)

51 
m_iBy‹sP”Swšg
 = 4;

52 
m_iLdlV”siÚ
 = 2;

53 
m_iCŞÜP’ResŞutiÚ
 = 600;

54 
	`Adju¡ResŞutiÚ
 ();

55 ià(
eP’
 =ğ
BOTH_PENS
)

57 
pMode
[
DEFAULTMODE_INDEX
]->
cm­
.
ulM­1
 =

58 
pMode
[
DEFAULTMODE_INDEX
]->
cm­
.
ulM­2
 = 
NULL
;

59 
pMode
[
DEFAULTMODE_INDEX
]->
cm­
.
ulM­3
 = (*è
ucM­DJ4100_KCMY_6x6x1
;

61 
pMode
[
SPECIALMODE_INDEX
]->
cm­
.
ulM­1
 =

62 
pMode
[
SPECIALMODE_INDEX
]->
cm­
.
ulM­2
 = 
NULL
;

63 
pMode
[
SPECIALMODE_INDEX
]->
cm­
.
ulM­3
 = (*è
ucM­DJ4100_KCMY_PhÙo_Be¡A_12x12x1
;

64 
pMode
[
SPECIALMODE_INDEX
]->
CŞÜFEDTabË
 = 
	`G‘HT12x12x1_4100_PhÙo_Be¡
 ();

67 
vœtu®
 
	$Adju¡ResŞutiÚ
 ()

69 
i
 = 0; i < (è
ModeCouÁ
; i++)

71 ià(
pMode
[
i
] &&…Mode[i]->
ResŞutiÚX
[0] == 300)

73 
j
 = 0; j < 4; j++)

75 
pMode
[
i
]->
ResŞutiÚX
[
j
] =

76 
pMode
[
i
]->
ResŞutiÚY
[
j
] = 600;

78 
pMode
[
i
]->
Ba£ResX
 =

79 
pMode
[
i
]->
Ba£ResY
 = 600;

83 
	}
}

87 #ià
defšed
(
APDK_DJ3600
è&& defšed (
APDK_DJ3320
)

91 şas 
	cDJ4100Proxy
 : 
public
 
Prš‹rProxy


93 
public
:

94 
	$DJ4100Proxy
(è: 
	`Prš‹rProxy
(

104 è{
m_iPrš‹rTy³
 = 
eDJ4100
;}

105 
šlše
 
Prš‹r
* 
	$C»©ePrš‹r
(
Sy¡emS”viûs
* 
pSS
ècÚ¡ {  
Ãw
 
	`DJ4100
ÕSS); 
	}
}

106 
šlše
 
PRINTER_TYPE
 
	$G‘Prš‹rTy³
(ècÚ¡ {  
eDJ4100
;
	}
}

107 
šlše
 
	$G‘Mod–B™
(ècÚ¡ {  0x2;
	}
}

111 
	gAPDK_END_NAMESPACE


	@prnt/hpijs/dj4100_cmap.cpp

32 #ifdeà
APDK_DJ3600


34 
	~"cÚfig.h
"

36 
	~"glob®_ty³s.h
"

38 
APDK_BEGIN_NAMESPACE


42 
	gucM­DJ4100_KCMY_6x6x1
[] =

749 
	gucM­DJ4100_KCMY_PhÙo_Be¡V_12x12x1
[] =

1456 
	gucM­DJ4100_KCMY_PhÙo_Be¡A_12x12x1
[] =

2163 
	gucM­DJ4100_KCMY_Be¡A_12x12x1
[] =

2870 
	gucM­DJ4100_KCMY_Be¡S_12x12x1
[] =

3576 
	gAPDK_END_NAMESPACE


	@prnt/hpijs/dj540.cpp

32 #ifdeà
APDK_DJ540


34 
	~"h—d”.h
"

35 
	~"dj6xx.h
"

36 
	~"dj600.h
"

37 
	~"dj540.h
"

38 
	~"´š‹½roxy.h
"

40 
APDK_BEGIN_NAMESPACE


42 
ušt32_t
 
ulM­DJ600_CCM_K
[ 9 * 9 * 9 ];

43 
ušt32_t
 
ulM­DJ600_CCM_CMY
[ 9 * 9 * 9 ];

47 
	gDJ540
::
	$DJ540
(
Sy¡emS”viûs
* 
pSS
, 
BOOL
 
´Ùo
)

48 : 
	$DJ6XX
(
pSS
,
NUM_DJ6XX_FONTS
,
´Ùo
)

51 ià((!
´Ùo
è&& (
IOMode
.
bDevID
))

53 
cÚ¡ruùÜ_”rÜ
 = 
	`V”ifyP’Info
();

54 
CERRCHECK
;

58 
eP’
 = 
COLOR_PEN
;

61 
CMYM­
 = 
ulM­DJ600_CCM_CMY
;

62 
pMode
[
DEFAULTMODE_INDEX
] = 
Ãw
 
	`Mode600
();

63 
pMode
[
GRAYMODE_INDEX
] = 
Ãw
 
	`G¿yMode
(
ulM­DJ600_CCM_K
);

64 #ifdeà
APDK_EXTENDED_MEDIASIZE


65 
pMode
[
SPECIALMODE_INDEX
] = 
Ãw
 
	`Mode600D¿áG¿yK
();

66 
pMode
[
SPECIALMODE_INDEX
+1] = 
Ãw
 
	`Mode600D¿áCŞÜ
();

67 
ModeCouÁ
 = 4;

69 
ModeCouÁ
 = 2;

72 
	`DBG1
("DeskJet 540 created\n");

73 
	}
}

75 
PEN_TYPE
 
	gDJ540
::
	$DeçuÉP’S‘
()

77  
COLOR_PEN
;

78 
	}
}

80 
	gH—d”540
::
	$H—d”540
(
Prš‹r
* 
p
,
PrštCÚ‹xt
* 
pc
)

81 : 
	$H—d”
(
p
,
pc
)

82 { 
	}
}

84 
DRIVER_ERROR
 
	gH—d”540
::
	$S’d
()

88 { 
DRIVER_ERROR
 
”r
;

91 
”r
=
	`Modes
();

92 
ERRCHECK
;

94 
”r
=
	`M¬gšs
();

95 
ERRCHECK
;

97 
”r
=
	`Sim¶e
();

98 
ERRCHECK
;

100 
”r
=
	`G¿phics
();

102  
”r
;

103 
	}
}

105 
H—d”
* 
	gDJ540
::
	$S–eùH—d”
(
PrštCÚ‹xt
* 
pc
)

107  
Ãw
 
	`H—d”540
(
this
,
pc
);

108 
	}
}

110 
DRIVER_ERROR
 
	gDJ540
::
	$V”ifyP’Info
()

113 
DRIVER_ERROR
 
”r
 = 
NO_ERROR
;

115 if(
IOMode
.
bDevID
 =ğ
FALSE
)

116  
”r
;

118 
”r
 = 
	`P¬£P’Info
(
eP’
);

119 
ERRCHECK
;

121 if(
eP’
 =ğ
BLACK_PEN
 ||ƒP’ =ğ
COLOR_PEN
)

124  
NO_ERROR
;

129 
eP’
 !ğ
BLACK_PEN
 &&ƒP’ !ğ
COLOR_PEN
)

131 
pSS
->
	`Di¥ÏyPrš‹rStus
(
DISPLAY_NO_PEN_DJ600
);

133 if(
pSS
->
	`BusyWa™
(500è=ğ
JOB_CANCELED
)

135  
JOB_CANCELED
;

138 
”r
 = 
	`P¬£P’Info
(
eP’
);

139 
ERRCHECK
;

142 
pSS
->
	`Di¥ÏyPrš‹rStus
(
DISPLAY_PRINTING
);

149 ià(
pSS
->
	`BusyWa™
((
DWORD
)1000è=ğ
JOB_CANCELED
)

150  
JOB_CANCELED
;

152  
NO_ERROR
;

154 
	}
}

157 
DRIVER_ERROR
 
	gDJ540
::
	$P¬£P’Info
(
PEN_TYPE
& 
eP’
, 
BOOL
 
Qu”yPrš‹r
)

159 * 
c
;

160 
DRIVER_ERROR
 
”r
 = 
	`S‘P’Info
(
c
, 
Qu”yPrš‹r
);

161 
ERRCHECK
;

163 ià(*
c
 != '$')

165  
BAD_DEVICE_ID
;

168 
c
++;

172 if(
c
[0] == 'D')

174 
eP’
 = 
COLOR_PEN
;

176 if(
c
[0] == 'E')

178 
eP’
 = 
BLACK_PEN
;

182 
eP’
 = 
NO_PEN
;

185  
NO_ERROR
;

186 
	}
}

188 
	gAPDK_END_NAMESPACE


	@prnt/hpijs/dj540.h

32 #iâdeà
APDK_DJ540_H


33 
	#APDK_DJ540_H


	)

35 
APDK_BEGIN_NAMESPACE


40 şas 
	cDJ540
 : 
public
 
DJ6XX


42 
public
:

43 
DJ540
(
Sy¡emS”viûs
* 
pSS
, 
BOOL
 
´Ùo
=
FALSE
);

45 
H—d”
* 
S–eùH—d”
(
PrštCÚ‹xt
* 
pc
);

46 
DRIVER_ERROR
 
V”ifyP’Info
();

47 
vœtu®
 
DRIVER_ERROR
 
P¬£P’Info
(
PEN_TYPE
& 
eP’
, 
BOOL
 
Qu”yPrš‹r
=
TRUE
);

48 
vœtu®
 
PEN_TYPE
 
DeçuÉP’S‘
();

52 #ifdeà
APDK_DJ540


56 şas 
	cDJ540Proxy
 : 
public
 
Prš‹rProxy


58 
public
:

59 
	$DJ540Proxy
(è: 
	`Prš‹rProxy
(

62 #ifdeà
APDK_MLC_PRINTER


65 è{
m_iPrš‹rTy³
 = 
eDJ540
;}

66 
šlše
 
Prš‹r
* 
	$C»©ePrš‹r
(
Sy¡emS”viûs
* 
pSS
ècÚ¡ {  
Ãw
 
	`DJ540
ÕSS); 
	}
}

67 
šlše
 
PRINTER_TYPE
 
	$G‘Prš‹rTy³
(ècÚ¡ {  
eDJ540
;
	}
}

68 
šlše
 
	$G‘Mod–B™
(ècÚ¡ {  0x400000;
	}
}

72 
	gAPDK_END_NAMESPACE


	@prnt/hpijs/dj55xx.h

32 #iâdeà
APDK_DJ_55XX_H


33 
	#APDK_DJ_55XX_H


	)

35 
APDK_BEGIN_NAMESPACE


42 şas 
	cDJ55xx
 : 
public
 
DJG’”icVIP


44 
public
:

45 
	$DJ55xx
 (
Sy¡emS”viûs
* 
pSS
, 
BOOL
 
´Ùo
 = 
FALSE
è: 
	$DJG’”icVIP
 (
pSS
, 
´Ùo
)

48 
vœtu®
 
BOOL
 
	$G‘M¬gšs
 (
PAPER_SIZE
 
ps
, *
fM¬gšs
)

50  
FALSE
;

51 
	}
}

54 #ià
defšed
(
APDK_DJGENERICVIP
è&& defšed (
APDK_DJ9xxVIP
)

58 şas 
	cDJ55xxProxy
 : 
public
 
Prš‹rProxy


60 
public
:

61 
	$DJ55xxProxy
(è: 
	`Prš‹rProxy
(

73 è{
m_iPrš‹rTy³
 = 
eDJ55xx
;}

74 
šlše
 
Prš‹r
* 
	$C»©ePrš‹r
(
Sy¡emS”viûs
* 
pSS
ècÚ¡ {  
Ãw
 
	`DJ55xx
ÕSS); 
	}
}

75 
šlše
 
PRINTER_TYPE
 
	$G‘Prš‹rTy³
(ècÚ¡ {  
eDJ55xx
;
	}
}

76 
šlše
 
	$G‘Mod–B™
(ècÚ¡ {  0x200;
	}
}

80 
	gAPDK_END_NAMESPACE


	@prnt/hpijs/dj600.cpp

32 #ifdeà
APDK_DJ600


34 
	~"h—d”.h
"

35 
	~"dj6xx.h
"

36 
	~"dj600.h
"

37 
	~"´š‹½roxy.h
"

39 
APDK_BEGIN_NAMESPACE


41 
ušt32_t
 
ulM­DJ600_CCM_K
[ 9 * 9 * 9 ];

42 
ušt32_t
 
ulM­DJ600_CCM_CMY
[ 9 * 9 * 9 ];

47 
	gMode600
::
	$Mode600
()

48 : 
	$PrštMode
Ğ
ulM­DJ600_CCM_CMY
 )

50 
dyeCouÁ
=3;

51 
Com·tibËP’s
[0] = 
COLOR_PEN
;

52 
	}
}

54 #ifdeà
APDK_EXTENDED_MEDIASIZE


55 
	gMode600D¿áCŞÜ
::
	$Mode600D¿áCŞÜ
()

56 : 
	$PrštMode
Ğ
ulM­DJ600_CCM_CMY
 )

58 
dyeCouÁ
=3;

59 
Com·tibËP’s
[0] = 
COLOR_PEN
;

60 
theQu®™y
 = 
qu®™yD¿á
;

61 
pmQu®™y
 = 
QUALITY_DRAFT
;

62 
	}
}

64 
	gMode600D¿áG¿yK
::
	$Mode600D¿áG¿yK
()

65 : 
	$G¿yMode
(
ulM­DJ600_CCM_K
)

67 
theQu®™y
 = 
qu®™yD¿á
;

68 
pmQu®™y
 = 
QUALITY_DRAFT
;

69 
	}
}

71 
	gMode600Be¡G¿yK
::
	$Mode600Be¡G¿yK
()

72 : 
	$G¿yMode
(
ulM­DJ600_CCM_K
)

74 
theQu®™y
 = 
qu®™yP»£Á©iÚ
;

75 
pmQu®™y
 = 
QUALITY_BEST
;

76 
Ba£ResX
 = 600;

77 
ResŞutiÚX
[0] = 600;

78 #ifdeà
APDK_HIGH_RES_MODES


79 
Ba£ResY
 = 600;

80 
ResŞutiÚY
[0] = 600;

82 
Ba£ResY
 = 300;

83 
ResŞutiÚY
[0] = 300;

85 
	}
}

88 
	gDJ600
::
	$DJ600
(
Sy¡emS”viûs
* 
pSS
, 
BOOL
 
´Ùo
)

89 : 
	$DJ6XX
(
pSS
, 
NUM_DJ6XX_FONTS
,
´Ùo
)

91 ià((!
´Ùo
è&& (
IOMode
.
bDevID
))

93 
cÚ¡ruùÜ_”rÜ
 = 
	`V”ifyP’Info
();

94 
CERRCHECK
;

98 
eP’
=
COLOR_PEN
;

101 
CMYM­
 = 
ulM­DJ600_CCM_CMY
;

103 
pMode
[
DEFAULTMODE_INDEX
] = 
Ãw
 
	`Mode600
();

104 
pMode
[
GRAYMODE_INDEX
] = 
Ãw
 
	`G¿yMode
(
ulM­DJ600_CCM_K
);

105 #ifdeà
APDK_EXTENDED_MEDIASIZE


106 
pMode
[
SPECIALMODE_INDEX
] = 
Ãw
 
	`Mode600D¿áG¿yK
();

107 
pMode
[
SPECIALMODE_INDEX
+1] = 
Ãw
 
	`Mode600D¿áCŞÜ
();

108 
pMode
[
SPECIALMODE_INDEX
+2] = 
Ãw
 
	`Mode600Be¡G¿yK
();

111 
	`DBG1
("DeskJet 600 created\n");

112 
	}
}

114 
PEN_TYPE
 
	gDJ600
::
	$DeçuÉP’S‘
()

116  
COLOR_PEN
;

117 
	}
}

119 
	gH—d”600
::
	$H—d”600
(
Prš‹r
* 
p
,
PrštCÚ‹xt
* 
pc
)

120 : 
	$H—d”6XX
(
p
,
pc
)

121 { 
	}
}

123 
DRIVER_ERROR
 
	gH—d”600
::
	$S’d
()

125 { 
DRIVER_ERROR
 
”r
;

127 
	`S¹S’d
();

129 ià(
dyeCouÁ
==3)

131 
”r
 = 
	`CÚfigu»Ra¡”D©a
();

132 
ERRCHECK
;

136 
”r
=
	`Sim¶e
();

137 
ERRCHECK
;

140 
”r
=
	`G¿phics
();

142  
”r
;

143 
	}
}

145 
H—d”
* 
	gDJ600
::
	$S–eùH—d”
(
PrštCÚ‹xt
* 
pc
)

147  
Ãw
 
	`H—d”600
(
this
,
pc
);

148 
	}
}

150 
DRIVER_ERROR
 
	gDJ600
::
	$V”ifyP’Info
()

152 
DRIVER_ERROR
 
”r
=
NO_ERROR
;

154 if(
IOMode
.
bDevID
 =ğ
FALSE
)

155  
”r
;

157 
”r
 = 
	`P¬£P’Info
(
eP’
);

158 
ERRCHECK
;

160 ià(
eP’
 =ğ
BLACK_PEN
 ||ƒP’ =ğ
COLOR_PEN
)

163  
NO_ERROR
;

168 
eP’
 !ğ
BLACK_PEN
 &&ƒP’ !ğ
COLOR_PEN
)

170 
pSS
->
	`Di¥ÏyPrš‹rStus
(
DISPLAY_NO_PEN_DJ600
);

172 if(
pSS
->
	`BusyWa™
(500è=ğ
JOB_CANCELED
)

174  
JOB_CANCELED
;

177 
”r
 = 
	`P¬£P’Info
(
eP’
);

178 
ERRCHECK
;

181 
pSS
->
	`Di¥ÏyPrš‹rStus
(
DISPLAY_PRINTING
);

188 ià(
pSS
->
	`BusyWa™
((
DWORD
)1000è=ğ
JOB_CANCELED
)

189  
JOB_CANCELED
;

191  
NO_ERROR
;

193 
	}
}

195 
DRIVER_ERROR
 
	gDJ600
::
	$P¬£P’Info
(
PEN_TYPE
& 
eP’
, 
BOOL
 
Qu”yPrš‹r
)

197 * 
c
;

198 
DRIVER_ERROR
 
”r
 = 
	`S‘P’Info
(
c
, 
Qu”yPrš‹r
);

199 
ERRCHECK
;

201 ià(*
c
 != '$')

203  
BAD_DEVICE_ID
;

206 
c
++;

209 if(
c
[0] == 'R')

210 
eP’
 = 
COLOR_PEN
;

211 if(
c
[0] == 'C')

212 
eP’
 = 
BLACK_PEN
;

213 
eP’
 = 
NO_PEN
;

215  
NO_ERROR
;

216 
	}
}

218 
	gAPDK_END_NAMESPACE


	@prnt/hpijs/dj600.h

32 #iâdeà
APDK_DJ600_H


33 
	#APDK_DJ600_H


	)

35 
APDK_BEGIN_NAMESPACE


40 şas 
	cDJ600
 : 
public
 
DJ6XX


42 
public
:

43 
DJ600
(
Sy¡emS”viûs
* 
pSS
, 
BOOL
 
´Ùo
=
FALSE
);

45 
H—d”
* 
S–eùH—d”
(
PrštCÚ‹xt
* 
pc
) ;

46 
DRIVER_ERROR
 
V”ifyP’Info
();

47 
vœtu®
 
DRIVER_ERROR
 
P¬£P’Info
(
PEN_TYPE
& 
eP’
, 
BOOL
 
Qu”yPrš‹r
=
TRUE
);

48 
vœtu®
 
PEN_TYPE
 
DeçuÉP’S‘
();

53 şas 
	cMode600
 : 
public
 
PrštMode


55 
public
:

56 
Mode600
();

60 #ifdeà
APDK_EXTENDED_MEDIASIZE


61 şas 
	cMode600D¿áG¿yK
 : 
public
 
G¿yMode


63 
public
:

64 
Mode600D¿áG¿yK
();

67 şas 
	cMode600D¿áCŞÜ
 : 
public
 
PrštMode


69 
public
:

70 
Mode600D¿áCŞÜ
();

73 şas 
	cMode600Be¡G¿yK
 : 
public
 
G¿yMode


75 
public
:

76 
Mode600Be¡G¿yK
();

79 #ifdeà
APDK_DJ600


83 şas 
	cDJ600Proxy
 : 
public
 
Prš‹rProxy


85 
public
:

86 
	$DJ600Proxy
(è: 
	`Prš‹rProxy
(

89 #ifdeà
APDK_MLC_PRINTER


91 è{
m_iPrš‹rTy³
 = 
eDJ6xx
;}

92 
šlše
 
Prš‹r
* 
	$C»©ePrš‹r
(
Sy¡emS”viûs
* 
pSS
ècÚ¡ {  
Ãw
 
	`DJ600
ÕSS); 
	}
}

93 
šlše
 
PRINTER_TYPE
 
	$G‘Prš‹rTy³
(ècÚ¡ {  
eDJ6xx
;
	}
}

94 
šlše
 
	$G‘Mod–B™
(ècÚ¡ {  0x200000;
	}
}

98 
	gAPDK_END_NAMESPACE


	@prnt/hpijs/dj600_maps.cpp

33 
	~"cÚfig.h
"

34 
	~"glob®_ty³s.h
"

36 
APDK_BEGIN_NAMESPACE


38 
ušt32_t
 
	gulM­DJ600_CCM_K
[ 9 * 9 * 9 ]=

123 
ušt32_t
 
	gulM­DJ600_CCM_CMY
[ 9 * 9 * 9 ]=

209 
	gAPDK_END_NAMESPACE


	@prnt/hpijs/dj630.cpp

32 #ifdeà
APDK_DJ630


34 
	~"h—d”.h
"

35 
	~"dj630.h
"

36 
	~"´š‹½roxy.h
"

38 
APDK_BEGIN_NAMESPACE


40 
ušt32_t
 
ulM­DJ690_CMYK
[ 9 * 9 * 9 ];

41 
ušt32_t
 
ulM­DJ690_ClMlxx
[ 9 * 9 * 9 ];

42 
ušt32_t
 
ulM­DJ660_CCM_KCMY
[ 9 * 9 * 9 ];

43 
ušt32_t
 
ulM­DJ600_CCM_K
[ 9 * 9 * 9 ];

44 
ušt32_t
 
ulM­DJ600_CCM_CMY
[ 9 * 9 * 9 ];

47 
	gDJ630
::
	$DJ630
(
Sy¡emS”viûs
* 
pSS
, 
BOOL
 
´Ùo
)

48 : 
	$Prš‹r
(
pSS
, 
NUM_DJ6XX_FONTS
,
´Ùo
)

51 ià((!
´Ùo
è&& (
IOMode
.
bDevID
))

53 
cÚ¡ruùÜ_”rÜ
 = 
	`V”ifyP’Info
();

54 
CERRCHECK
;

58 
eP’
=
COLOR_PEN
;

61 
CMYM­
 = 
ulM­DJ600_CCM_CMY
;

63 
pMode
[
DEFAULTMODE_INDEX
] = 
Ãw
 
	`Mode630CŞÜ
();

64 
pMode
[
SPECIALMODE_INDEX
 + 0] = 
Ãw
 
	`PrštMode
(
ulM­DJ660_CCM_KCMY
);

65 
pMode
[
SPECIALMODE_INDEX
 + 1] = 
Ãw
 
	`Mode630PhÙo
();

66 
pMode
[
GRAYMODE_INDEX
] = 
Ãw
 
	`G¿yMode630
(
ulM­DJ600_CCM_K
);

67 #ifdeà
APDK_EXTENDED_MEDIASIZE


68 
pMode
[
SPECIALMODE_INDEX
+2] = 
Ãw
 
	`Mode630D¿áG¿yK
();

69 
pMode
[
SPECIALMODE_INDEX
+3] = 
Ãw
 
	`Mode630D¿áCŞÜKCMY
();

70 
pMode
[
SPECIALMODE_INDEX
+4] = 
Ãw
 
	`Mode630D¿áCŞÜCMY
();

71 
pMode
[
SPECIALMODE_INDEX
+5] = 
Ãw
 
	`Mode630Be¡G¿yK
();

72 
ModeCouÁ
=8;

74 
ModeCouÁ
 = 4;

77 
	`DBG1
("DJ630 created\n");

79 
	}
}

81 
PEN_TYPE
 
	gDJ630
::
	$DeçuÉP’S‘
()

83  
COLOR_PEN
;

84 
	}
}

86 
	gG¿yMode630
::
	$G¿yMode630
(
ušt32_t
 *
m­
)

87 : 
	$G¿yMode
(
m­
)

89 
Com·tibËP’s
[1] = 
BLACK_PEN
;

90 
Com·tibËP’s
[2] = 
MDL_BOTH
;

91 
	}
}

93 
DRIVER_ERROR
 
	gDJ630
::
	$V”ifyP’Info
()

96 
DRIVER_ERROR
 
”r
=
NO_ERROR
;

98 if(
IOMode
.
bDevID
 =ğ
FALSE
)

99  
”r
;

101 
”r
 = 
	`P¬£P’Info
(
eP’
);

102 
ERRCHECK
;

105 ià(
eP’
 =ğ
BOTH_PENS
 ||ƒP’ =ğ
MDL_BOTH
 ||ƒP’ =ğ
COLOR_PEN
)

106  
NO_ERROR
;

108 
	`DBG1
("DJ630::VerifyPenInfo():ƒPen is‚ot BOTH_PENS, MDL_BOTH, or COLOR_PEN\n");

112  (
eP’
 !ğ
BOTH_PENS
è&& (eP’ !ğ
MDL_BOTH
è&& (eP’ !ğ
COLOR_PEN
) )

114 
	`DBG1
("DJ630::VerifyPenInfo(): in while†oop\n");

116 
eP’
)

118 
MDL_PEN
:

119 
BLACK_PEN
:

121 
pSS
->
	`Di¥ÏyPrš‹rStus
(
DISPLAY_NO_COLOR_PEN
);

123 
NO_PEN
:

126 
pSS
->
	`Di¥ÏyPrš‹rStus
(
DISPLAY_NO_PENS
);

130 ià(
pSS
->
	`BusyWa™
(500è=ğ
JOB_CANCELED
)

131  
JOB_CANCELED
;

133 
”r
 = 
	`P¬£P’Info
(
eP’
);

134 
ERRCHECK
;

137 
pSS
->
	`Di¥ÏyPrš‹rStus
(
DISPLAY_PRINTING
);

139  
NO_ERROR
;

141 
	}
}

143 
DRIVER_ERROR
 
	gDJ630
::
	$P¬£P’Info
(
PEN_TYPE
& 
eP’
, 
BOOL
 
Qu”yPrš‹r
)

145 * 
¡r
;

146 
DRIVER_ERROR
 
”r
 = 
	`S‘P’Info
(
¡r
, 
Qu”yPrš‹r
);

147 
ERRCHECK
;

149 ià(*
¡r
 != '$')

151  
BAD_DEVICE_ID
;

154 
¡r
++;

156 
PEN_TYPE
 
‹mp_³n1
;

158 
¡r
[0])

161 'M': 
‹mp_³n1
 = 
MDL_PEN
; ;

162 'C': 
‹mp_³n1
 = 
BLACK_PEN
; ;

163 : 
‹mp_³n1
 = 
NO_PEN
; ;

168 
i
=2;

169 (
i
 < 
DevIDBuffSize
è&& 
¡r
[i]!='$') i++;

170 ià(
i
 =ğ
DevIDBuffSize
)

172  
BAD_DEVICE_ID
;

175 
i
++;

177 if(
¡r
[
i
]=='R')

180 ià(
‹mp_³n1
 =ğ
BLACK_PEN
)

181 
eP’
 = 
BOTH_PENS
;

184 ià(
‹mp_³n1
 =ğ
MDL_PEN
)

185 
eP’
 = 
MDL_BOTH
;

187 
eP’
 = 
COLOR_PEN
;

191 
eP’
 = 
‹mp_³n1
;

193  
NO_ERROR
;

194 
	}
}

197 
	gMode630PhÙo
::
	$Mode630PhÙo
()

199 : 
	$PrštMode
(
ulM­DJ690_CMYK
,
ulM­DJ690_ClMlxx
)

201 
dyeCouÁ
=6;

202 
medium
 = 
medŸS³cŸl
;

203 
theQu®™y
 = 
qu®™yNÜm®
;

206 
Ba£ResX
 = 600;

207 
i
=0; i < 6; i++)

208 
ResŞutiÚX
[
i
]=600;

210 
Com·tibËP’s
[0] = 
MDL_BOTH
;

212 
pmQu®™y
=
QUALITY_BEST
;

213 
pmMedŸTy³
=
MEDIA_PREMIUM
;

217 
	}
}

219 
	gMode630CŞÜ
::
	$Mode630CŞÜ
()

220 : 
	$PrštMode
(
ulM­DJ600_CCM_CMY
)

222 
dyeCouÁ
=3;

223 
Com·tibËP’s
[0] = 
COLOR_PEN
;

226 
	}
}

228 #ifdeà
APDK_EXTENDED_MEDIASIZE


229 
	gMode630D¿áCŞÜKCMY
::
	$Mode630D¿áCŞÜKCMY
()

230 : 
	$PrštMode
Ğ
ulM­DJ660_CCM_KCMY
 )

232 
theQu®™y
 = 
qu®™yD¿á
;

233 
CÚfig
.
eHT
 = 
MATRIX
;

234 
pmQu®™y
 = 
QUALITY_DRAFT
;

235 
	}
}

237 
	gMode630D¿áG¿yK
::
	$Mode630D¿áG¿yK
()

238 : 
	$G¿yMode
(
ulM­DJ600_CCM_K
)

240 
theQu®™y
 = 
qu®™yD¿á
;

241 
pmQu®™y
 = 
QUALITY_DRAFT
;

242 
	}
}

244 
	gMode630D¿áCŞÜCMY
::
	$Mode630D¿áCŞÜCMY
()

245 : 
	$PrštMode
Ğ
ulM­DJ600_CCM_CMY
 )

247 
dyeCouÁ
=3;

248 
Com·tibËP’s
[0] = 
COLOR_PEN
;

249 
theQu®™y
 = 
qu®™yD¿á
;

250 
pmQu®™y
 = 
QUALITY_DRAFT
;

251 
	}
}

253 
	gMode630Be¡G¿yK
::
	$Mode630Be¡G¿yK
()

254 : 
	$G¿yMode
(
ulM­DJ600_CCM_K
)

256 
theQu®™y
 = 
qu®™yP»£Á©iÚ
;

257 
pmQu®™y
 = 
QUALITY_BEST
;

258 
Ba£ResX
 = 600;

259 
ResŞutiÚX
[0] = 600;

260 #ifdeà
APDK_HIGH_RES_MODES


261 
Ba£ResY
 = 600;

262 
ResŞutiÚY
[0] = 600;

264 
Ba£ResY
 = 300;

265 
ResŞutiÚY
[0] = 300;

267 
	}
}

270 
	gH—d”630
::
	$H—d”630
(
Prš‹r
* 
p
,
PrštCÚ‹xt
* 
pc
)

271 : 
	$H—d”
(
p
,
pc
)

272 { 
	}
}

274 
H—d”
* 
	gDJ630
::
	$S–eùH—d”
(
PrštCÚ‹xt
* 
pc
)

276  
Ãw
 
	`H—d”630
(
this
,
pc
);

277 
	}
}

279 
DRIVER_ERROR
 
	gH—d”630
::
	$S’d
()

280 { 
DRIVER_ERROR
 
”r
;

282 
	`S¹S’d
();

287 ià(
thePrštMode
->
dyeCouÁ
 != 3)

289 
”r
 = 
thePrš‹r
->
	`S’d
((cÚ¡ 
BYTE
*)
BÏckExŒaùOff
,

290 (
BÏckExŒaùOff
));

291 
ERRCHECK
;

294 
”r
 = 
	`CÚfigu»Ra¡”D©a
();

295 
ERRCHECK
;

297 ià(
ResŞutiÚY
[0] == 600)

299 
uom
[10];

300 
	`¥rštf
(
uom
,"%c%c%c%d%c",
ESC
,'&','u',
thePrštMode
->
ResŞutiÚY
[
K
],'D');

301 
”r
=
thePrš‹r
->
	`S’d
((cÚ¡ 
BYTE
*)
uom
, 7 );

302 
ERRCHECK
;

305 
”r
=
	`G¿phics
();

307  
”r
;

308 
	}
}

310 
	gAPDK_END_NAMESPACE


	@prnt/hpijs/dj630.h

32 #iâdeà
APDK_DJ630_H


33 
	#APDK_DJ630_H


	)

35 
APDK_BEGIN_NAMESPACE


40 şas 
	cDJ630
 : 
public
 
Prš‹r


42 
public
:

43 
DJ630
(
Sy¡emS”viûs
* 
pSS
, 
BOOL
 
´Ùo
=
FALSE
);

45 
H—d”
* 
S–eùH—d”
(
PrštCÚ‹xt
* 
pc
);

46 
vœtu®
 
DRIVER_ERROR
 
V”ifyP’Info
();

47 
vœtu®
 
DRIVER_ERROR
 
P¬£P’Info
(
PEN_TYPE
& 
eP’
, 
BOOL
 
Qu”yPrš‹r
=
TRUE
);

48 
vœtu®
 
PEN_TYPE
 
DeçuÉP’S‘
();

49 
vœtu®
 
BOOL
 
	$G‘M¬gšs
 (
PAPER_SIZE
 
ps
, *
fM¬gšs
)

51 ià(
ps
 =ğ
A4
)

52 
fM¬gšs
[0] = () 0.135;

54 
fM¬gšs
[0] = () 0.25;

55 
fM¬gšs
[1] = fMargins[0];

56 
fM¬gšs
[2] = () 0.125;

57 
fM¬gšs
[3] = () 0.67;

58  
TRUE
;

61 #ifdeà
APDK_HP_UX


62 
´Ùeùed
:

63 
vœtu®
 
DJ630
& 
İ”©Ü
 = (
Prš‹r
& 
rhs
)

65  *
this
;

66 
	}
}

72 şas 
	cMode630PhÙo
 : 
public
 
PrštMode


74 
public
:

75 
Mode630PhÙo
();

79 şas 
	cMode630CŞÜ
 : 
public
 
PrštMode


81 
public
:

82 
Mode630CŞÜ
();

86 şas 
	cG¿yMode630
 : 
public
 
G¿yMode


88 
public
:

89 
G¿yMode630
(
ušt32_t
 *
m­
);

92 #ifdeà
APDK_EXTENDED_MEDIASIZE


93 şas 
	cMode630D¿áG¿yK
 : 
public
 
G¿yMode


95 
public
:

96 
Mode630D¿áG¿yK
();

99 şas 
	cMode630D¿áCŞÜKCMY
 : 
public
 
PrštMode


101 
public
:

102 
Mode630D¿áCŞÜKCMY
();

105 şas 
	cMode630D¿áCŞÜCMY
 : 
public
 
PrštMode


107 
public
:

108 
Mode630D¿áCŞÜCMY
();

111 şas 
	cMode630Be¡G¿yK
 : 
public
 
G¿yMode


113 
public
:

114 
Mode630Be¡G¿yK
();

118 #ifdeà
APDK_DJ630


122 şas 
	cDJ630Proxy
 : 
public
 
Prš‹rProxy


124 
public
:

125 
	$DJ630Proxy
(è: 
	`Prš‹rProxy
(

129 #ifdeà
APDK_MLC_PRINTER


131 è{
m_iPrš‹rTy³
 = 
eDJ630
;}

132 
šlše
 
Prš‹r
* 
	$C»©ePrš‹r
(
Sy¡emS”viûs
* 
pSS
ècÚ¡ {  
Ãw
 
	`DJ630
ÕSS); 
	}
}

133 
šlše
 
PRINTER_TYPE
 
	$G‘Prš‹rTy³
(ècÚ¡ {  
eDJ630
;
	}
}

134 
šlše
 
	$G‘Mod–B™
(ècÚ¡ {  0x8000;
	}
}

138 
	gAPDK_END_NAMESPACE


	@prnt/hpijs/dj660.cpp

32 #ifdeà
APDK_DJ6xx


34 
	~"h—d”.h
"

35 
	~"dj6xx.h
"

36 
	~"dj660.h
"

37 
	~"´š‹½roxy.h
"

39 
APDK_BEGIN_NAMESPACE


41 
ušt32_t
 
ulM­DJ660_CCM_KCMY
[ 9 * 9 * 9 ];

42 
ušt32_t
 
ulM­DJ600_CCM_K
[ 9 * 9 * 9 ];

43 
ušt32_t
 
ulM­DJ600_CCM_CMY
[ 9 * 9 * 9 ];

48 
	gDJ660
::
	$DJ660
(
Sy¡emS”viûs
* 
pSS
,
BOOL
 
´Ùo
)

49 : 
	$DJ6XX
(
pSS
,
NUM_DJ6XX_FONTS
,
´Ùo
)

52 
	`DBG1
("DJ660::VerifyPenInfo(): called\n");

54 ià((!
´Ùo
è&& (
IOMode
.
bDevID
))

56 
cÚ¡ruùÜ_”rÜ
 = 
	`V”ifyP’Info
();

57 
CERRCHECK
;

59 
eP’
=
BOTH_PENS
;

61 
pMode
[
DEFAULTMODE_INDEX
] = 
Ãw
 
	`PrštMode
Ğ
ulM­DJ660_CCM_KCMY
 );

62 
pMode
[
GRAYMODE_INDEX
] = 
Ãw
 
	`G¿yMode
(
ulM­DJ600_CCM_K
);

63 
pMode
[
SPECIALMODE_INDEX
] = 
Ãw
 
	`Mode660D¿á
();

64 #ifdeà
APDK_EXTENDED_MEDIASIZE


65 
pMode
[
SPECIALMODE_INDEX
+1] = 
Ãw
 
	`Mode660D¿áG¿yK
();

66 
pMode
[
SPECIALMODE_INDEX
+2] = 
Ãw
 
	`Mode660Be¡G¿yK
();

67 
ModeCouÁ
=5;

69 
ModeCouÁ
=3;

71 
CMYM­
 = 
ulM­DJ660_CCM_KCMY
;

74 
	`DBG1
("DJ 660 created\n");

75 
	}
}

77 
	gMode660D¿á
::
	$Mode660D¿á
()

78 : 
	$PrštMode
Ğ
ulM­DJ660_CCM_KCMY
 )

80 
theQu®™y
 = 
qu®™yD¿á
;

82 
CÚfig
.
eHT
 = 
MATRIX
;

84 
pmQu®™y
 = 
QUALITY_DRAFT
;

88 
	}
}

90 #ifdeà
APDK_EXTENDED_MEDIASIZE


91 
	gMode660D¿áG¿yK
::
	$Mode660D¿áG¿yK
()

92 : 
	$G¿yMode
(
ulM­DJ600_CCM_K
)

94 
theQu®™y
 = 
qu®™yD¿á
;

95 
pmQu®™y
 = 
QUALITY_DRAFT
;

96 
	}
}

98 
	gMode660Be¡G¿yK
::
	$Mode660Be¡G¿yK
()

99 : 
	$G¿yMode
(
ulM­DJ600_CCM_K
)

101 
theQu®™y
 = 
qu®™yP»£Á©iÚ
;

102 
pmQu®™y
 = 
QUALITY_BEST
;

103 
Ba£ResX
 = 600;

104 
ResŞutiÚX
[0] = 600;

105 #ifdeà
APDK_HIGH_RES_MODES


106 
Ba£ResY
 = 600;

107 
ResŞutiÚY
[0] = 600;

109 
Ba£ResY
 = 300;

110 
ResŞutiÚY
[0] = 300;

112 
	}
}

115 
H—d”
* 
	gDJ660
::
	$S–eùH—d”
(
PrštCÚ‹xt
* 
pc
)

117  
Ãw
 
	`H—d”6XX
(
this
,
pc
);

118 
	}
}

120 
DRIVER_ERROR
 
	gDJ660
::
	$V”ifyP’Info
()

123 
DRIVER_ERROR
 
”r
=
NO_ERROR
;

125 if(
IOMode
.
bDevID
 =ğ
FALSE
)

126  
”r
;

128 
”r
 = 
	`P¬£P’Info
(
eP’
);

129 
ERRCHECK
;

133 ià(
eP’
 =ğ
BOTH_PENS
)

134  
NO_ERROR
;

139  
eP’
 !ğ
BOTH_PENS
 )

142 
eP’
)

144 
MDL_BOTH
:

145 
MDL_PEN
:

147 
pSS
->
	`Di¥ÏyPrš‹rStus
(
DISPLAY_PHOTO_PEN_WARN
);

149 
BLACK_PEN
:

151 
pSS
->
	`Di¥ÏyPrš‹rStus
(
DISPLAY_NO_COLOR_PEN
);

153 
COLOR_PEN
:

155 
pSS
->
	`Di¥ÏyPrš‹rStus
(
DISPLAY_NO_BLACK_PEN
);

157 
NO_PEN
:

160 
pSS
->
	`Di¥ÏyPrš‹rStus
(
DISPLAY_NO_PENS
);

164 ià(
pSS
->
	`BusyWa™
(500è=ğ
JOB_CANCELED
)

165  
JOB_CANCELED
;

167 
”r
 = 
	`P¬£P’Info
(
eP’
);

168 
ERRCHECK
;

171 
pSS
->
	`Di¥ÏyPrš‹rStus
(
DISPLAY_PRINTING
);

173  
NO_ERROR
;

175 
	}
}

177 
DRIVER_ERROR
 
	gDJ660
::
	$P¬£P’Info
(
PEN_TYPE
& 
eP’
, 
BOOL
 
Qu”yPrš‹r
)

179 * 
¡r
;

180 
DRIVER_ERROR
 
”r
 = 
	`S‘P’Info
(
¡r
, 
Qu”yPrš‹r
);

181 
ERRCHECK
;

183 ià(*
¡r
 != '$')

185  
BAD_DEVICE_ID
;

188 
¡r
++;

190 
PEN_TYPE
 
‹mp_³n1
;

192 
¡r
[0])

195 'M': 
‹mp_³n1
 = 
MDL_PEN
; ;

196 'C': 
‹mp_³n1
 = 
BLACK_PEN
; ;

197 : 
‹mp_³n1
 = 
NO_PEN
; ;

202 
i
=2;

203 (
i
 < 
DevIDBuffSize
è&& 
¡r
[i]!='$') i++;

204 ià(
i
 =ğ
DevIDBuffSize
)

206  
BAD_DEVICE_ID
;

209 
i
++;

211 if(
¡r
[
i
]=='R')

214 ià(
‹mp_³n1
 =ğ
BLACK_PEN
)

215 
eP’
 = 
BOTH_PENS
;

218 ià(
‹mp_³n1
 =ğ
MDL_PEN
)

219 
eP’
 = 
MDL_BOTH
;

221 
eP’
 = 
COLOR_PEN
;

225 
eP’
 = 
‹mp_³n1
;

227  
NO_ERROR
;

228 
	}
}

230 
	gAPDK_END_NAMESPACE


	@prnt/hpijs/dj660.h

32 #iâdeà
APDK_DJ660_H


33 
	#APDK_DJ660_H


	)

35 
APDK_BEGIN_NAMESPACE


42 şas 
	cDJ660
 : 
public
 
DJ6XX


44 
public
:

45 
DJ660
(
Sy¡emS”viûs
* 
pSS
, 
BOOL
 
´Ùo
=
FALSE
);

47 
H—d”
* 
S–eùH—d”
(
PrštCÚ‹xt
* 
pc
);

48 
vœtu®
 
DRIVER_ERROR
 
V”ifyP’Info
();

49 
vœtu®
 
DRIVER_ERROR
 
P¬£P’Info
(
PEN_TYPE
& 
eP’
, 
BOOL
 
Qu”yPrš‹r
=
TRUE
);

54 şas 
	cMode660D¿á
 : 
public
 
PrštMode


56 
public
:

57 
Mode660D¿á
();

60 #ifdeà
APDK_EXTENDED_MEDIASIZE


61 şas 
	cMode660D¿áG¿yK
 : 
public
 
G¿yMode


63 
public
:

64 
Mode660D¿áG¿yK
();

67 şas 
	cMode660Be¡G¿yK
 : 
public
 
G¿yMode


69 
public
:

70 
Mode660Be¡G¿yK
();

74 #ifdeà
APDK_DJ6xx


78 şas 
	cDJ660Proxy
 : 
public
 
Prš‹rProxy


80 
public
:

81 
	$DJ660Proxy
(è: 
	`Prš‹rProxy
(

88 #ifdeà
APDK_MLC_PRINTER


94 è{
m_iPrš‹rTy³
 = 
eDJ6xx
;}

95 
šlše
 
Prš‹r
* 
	$C»©ePrš‹r
(
Sy¡emS”viûs
* 
pSS
ècÚ¡ {  
Ãw
 
	`DJ660
ÕSS); 
	}
}

96 
šlše
 
PRINTER_TYPE
 
	$G‘Prš‹rTy³
(ècÚ¡ {  
eDJ6xx
;
	}
}

97 
šlše
 
	$G‘Mod–B™
(ècÚ¡ {  0x100000;
	}
}

101 
	gAPDK_END_NAMESPACE


	@prnt/hpijs/dj660_maps.cpp

32 
	~"cÚfig.h
"

34 
	~"glob®_ty³s.h
"

36 
APDK_BEGIN_NAMESPACE


39 
ušt32_t
 
	gulM­DJ660_CCM_KCMY
[ 9 * 9 * 9 ]=

124 
	gAPDK_END_NAMESPACE


	@prnt/hpijs/dj690.cpp

32 #ifdeà
APDK_DJ6xxPhÙo


34 
	~"h—d”.h
"

35 
	~"dj690.h
"

36 
	~"´š‹½roxy.h
"

38 
APDK_BEGIN_NAMESPACE


40 
ušt32_t
 
ulM­DJ690_CMYK
[ 9 * 9 * 9 ];

41 
ušt32_t
 
ulM­DJ690_ClMlxx
[ 9 * 9 * 9 ];

42 
ušt32_t
 
ulM­DJ660_CCM_KCMY
[ 9 * 9 * 9 ];

43 
ušt32_t
 
ulM­DJ600_CCM_K
[ 9 * 9 * 9 ];

48 
	gMode690
::
	$Mode690
()

50 : 
	$PrštMode
Ğ
ulM­DJ690_CMYK
, 
ulM­DJ690_ClMlxx
 )

52 
dyeCouÁ
=6;

53 
medium
 = 
medŸS³cŸl
;

54 
theQu®™y
 = 
qu®™yP»£Á©iÚ
;

57 
Ba£ResX
 = 600;

58 
i
=0; i < 6; i++)

59 
ResŞutiÚX
[
i
]=600;

61 
Com·tibËP’s
[0] = 
MDL_BOTH
;

65 
pmQu®™y
 = 
QUALITY_BEST
;

66 
pmMedŸTy³
 = 
MEDIA_PREMIUM
;

68 
	}
}

70 
	gG¿yMode690
::
	$G¿yMode690
()

72 : 
	$PrštMode
Ğ
ulM­DJ600_CCM_K
 )

74 
Com·tibËP’s
[1] = 
MDL_BOTH
;

76 
dyeCouÁ
 = 1;

78 
pmCŞÜ
=
GREY_K
;

80 
	}
}

82 #ifdeà
APDK_EXTENDED_MEDIASIZE


83 
	gMode690D¿áCŞÜ
::
	$Mode690D¿áCŞÜ
()

84 : 
	$PrštMode
Ğ
ulM­DJ660_CCM_KCMY
 )

86 
theQu®™y
 = 
qu®™yD¿á
;

87 
CÚfig
.
eHT
 = 
MATRIX
;

88 
pmQu®™y
 = 
QUALITY_DRAFT
;

89 
	}
}

91 
	gMode690D¿áG¿yK
::
	$Mode690D¿áG¿yK
()

92 : 
	$G¿yMode
(
ulM­DJ600_CCM_K
)

94 
theQu®™y
 = 
qu®™yD¿á
;

95 
pmQu®™y
 = 
QUALITY_DRAFT
;

96 
	}
}

98 
	gMode690Be¡G¿yK
::
	$Mode690Be¡G¿yK
()

99 : 
	$G¿yMode
(
ulM­DJ600_CCM_K
)

101 
theQu®™y
 = 
qu®™yP»£Á©iÚ
;

102 
pmQu®™y
 = 
QUALITY_BEST
;

103 
Ba£ResX
 = 600;

104 
ResŞutiÚX
[0] = 600;

105 #ifdeà
APDK_HIGH_RES_MODES


106 
Ba£ResY
 = 600;

107 
ResŞutiÚY
[0] = 600;

109 
Ba£ResY
 = 300;

110 
ResŞutiÚY
[0] = 300;

112 
	}
}

115 
	gDJ6xxPhÙo
::
	$DJ6xxPhÙo
(
Sy¡emS”viûs
* 
pSS
, 
BOOL
 
´Ùo
)

116 : 
	$Prš‹r
(
pSS
, 
NUM_DJ6XX_FONTS
,
´Ùo
)

120 ià((!
´Ùo
è&& (
IOMode
.
bDevID
))

122 
cÚ¡ruùÜ_”rÜ
 = 
	`V”ifyP’Info
();

123 
CERRCHECK
;

127 
eP’
=
BOTH_PENS
;

130 
pMode
[
DEFAULTMODE_INDEX
] = 
Ãw
 
	`PrštMode
Ğ
ulM­DJ660_CCM_KCMY
 );

131 
pMode
[
GRAYMODE_INDEX
] = 
Ãw
 
	`G¿yMode690
();

132 
pMode
[
SPECIALMODE_INDEX
] = 
Ãw
 
	`Mode690
();

133 #ifdeà
APDK_EXTENDED_MEDIASIZE


134 
pMode
[
SPECIALMODE_INDEX
+1] = 
Ãw
 
	`Mode690D¿áG¿yK
();

135 
pMode
[
SPECIALMODE_INDEX
+2] = 
Ãw
 
	`Mode690D¿áCŞÜ
();

136 
pMode
[
SPECIALMODE_INDEX
+3] = 
Ãw
 
	`Mode690Be¡G¿yK
();

137 
ModeCouÁ
=6;

139 
ModeCouÁ
 = 3;

142 
CMYM­
 = 
ulM­DJ660_CCM_KCMY
;

144 
	`DBG1
("DJ6xxPhoto created\n");

146 
	}
}

149 
	gH—d”690
::
	$H—d”690
(
Prš‹r
* 
p
,
PrštCÚ‹xt
* 
pc
)

150 : 
	$H—d”
(
p
,
pc
)

151 { 
	}
}

153 
H—d”
* 
	gDJ6xxPhÙo
::
	$S–eùH—d”
(
PrštCÚ‹xt
* 
pc
)

155  
Ãw
 
	`H—d”690
(
this
, 
pc
);

156 
	}
}

158 
DRIVER_ERROR
 
	gH—d”690
::
	$S’d
()

159 { 
DRIVER_ERROR
 
”r
;

161 
	`S¹S’d
();

163 
”r
 = 
thePrš‹r
->
	`S’d
((cÚ¡ 
BYTE
*)
BÏckExŒaùOff
,

164 (
BÏckExŒaùOff
));

165 
ERRCHECK
;

167 
”r
 = 
	`CÚfigu»Ra¡”D©a
();

168 
ERRCHECK
;

170 ià(
ResŞutiÚY
[0] == 600)

172 
uom
[10];

173 
	`¥rštf
(
uom
,"%c%c%c%d%c",
ESC
,'&','u',
thePrštMode
->
ResŞutiÚY
[
K
],'D');

174 
”r
=
thePrš‹r
->
	`S’d
((cÚ¡ 
BYTE
*)
uom
, 7 );

175 
ERRCHECK
;

178 
”r
=
	`G¿phics
();

180  
”r
;

181 
	}
}

182 
DRIVER_ERROR
 
	gDJ6xxPhÙo
::
	$V”ifyP’Info
()

185 
DRIVER_ERROR
 
”r
=
NO_ERROR
;

187 if(
IOMode
.
bDevID
 =ğ
FALSE
)

188  
”r
;

190 
”r
 = 
	`P¬£P’Info
(
eP’
);

191 
ERRCHECK
;

194 ià(
eP’
 =ğ
BOTH_PENS
 ||ƒP’ =ğ
MDL_BOTH
)

195  
NO_ERROR
;

197 
	`DBG1
("DJ6xxPhoto::VerifyPenInfo():ƒPen is‚ot BOTH_PENS or MDL_BOTH\n");

202  (
eP’
 !ğ
BOTH_PENS
è&& (eP’ !ğ
MDL_BOTH
) )

204 
	`DBG1
("DJ6xxPhoto::VerifyPenInfo(): in while†oop\n");

206 
eP’
)

208 
MDL_PEN
:

209 
BLACK_PEN
:

211 
pSS
->
	`Di¥ÏyPrš‹rStus
(
DISPLAY_NO_COLOR_PEN
);

213 
COLOR_PEN
:

216 
pSS
->
	`Di¥ÏyPrš‹rStus
(
DISPLAY_NO_PEN_DJ600
);

218 
NO_PEN
:

221 
pSS
->
	`Di¥ÏyPrš‹rStus
(
DISPLAY_NO_PENS
);

225 ià(
pSS
->
	`BusyWa™
(500è=ğ
JOB_CANCELED
)

226  
JOB_CANCELED
;

228 
”r
 = 
	`P¬£P’Info
(
eP’
);

229 
ERRCHECK
;

232 
pSS
->
	`Di¥ÏyPrš‹rStus
(
DISPLAY_PRINTING
);

234  
NO_ERROR
;

236 
	}
}

238 
DRIVER_ERROR
 
	gDJ6xxPhÙo
::
	$P¬£P’Info
(
PEN_TYPE
& 
eP’
, 
BOOL
 
Qu”yPrš‹r
)

240 * 
¡r
;

241 
DRIVER_ERROR
 
”r
 = 
	`S‘P’Info
(
¡r
, 
Qu”yPrš‹r
);

242 
ERRCHECK
;

244 ià(*
¡r
 != '$')

246  
BAD_DEVICE_ID
;

249 
¡r
++;

251 
PEN_TYPE
 
‹mp_³n1
;

253 
¡r
[0])

256 'M': 
‹mp_³n1
 = 
MDL_PEN
; ;

257 'C': 
‹mp_³n1
 = 
BLACK_PEN
; ;

258 : 
‹mp_³n1
 = 
NO_PEN
; ;

263 
i
=2;

264 (
i
 < 
DevIDBuffSize
è&& 
¡r
[i]!='$') i++;

265 ià(
i
 =ğ
DevIDBuffSize
)

267  
BAD_DEVICE_ID
;

270 
i
++;

272 if(
¡r
[
i
]=='R')

275 ià(
‹mp_³n1
 =ğ
BLACK_PEN
)

276 
eP’
 = 
BOTH_PENS
;

279 ià(
‹mp_³n1
 =ğ
MDL_PEN
)

280 
eP’
 = 
MDL_BOTH
;

282 
eP’
 = 
COLOR_PEN
;

286 
eP’
 = 
‹mp_³n1
;

288  
NO_ERROR
;

289 
	}
}

291 
	gAPDK_END_NAMESPACE


	@prnt/hpijs/dj690.h

32 #iâdeà
APDK_DJ690_H


33 
	#APDK_DJ690_H


	)

35 
APDK_BEGIN_NAMESPACE


42 şas 
	cDJ6xxPhÙo
 : 
public
 
Prš‹r


44 
public
:

45 
DJ6xxPhÙo
(
Sy¡emS”viûs
* 
pSS
, 
BOOL
 
´Ùo
=
FALSE
);

47 
H—d”
* 
S–eùH—d”
(
PrštCÚ‹xt
* 
pc
);

48 
vœtu®
 
DRIVER_ERROR
 
V”ifyP’Info
();

49 
vœtu®
 
DRIVER_ERROR
 
P¬£P’Info
(
PEN_TYPE
& 
eP’
, 
BOOL
 
Qu”yPrš‹r
=
TRUE
);

50 
vœtu®
 
BOOL
 
	$G‘M¬gšs
 (
PAPER_SIZE
 
ps
, *
fM¬gšs
)

52 ià(
ps
 =ğ
A4
)

53 
fM¬gšs
[0] = () 0.135;

55 
fM¬gšs
[0] = () 0.25;

56 
fM¬gšs
[1] = fMargins[0];

57 
fM¬gšs
[2] = () 0.125;

58 
fM¬gšs
[3] = () 0.67;

59  
TRUE
;

62 
´Ùeùed
:

63 #ifdeà
APDK_HP_UX


64 
vœtu®
 
DJ6xxPhÙo
 & 
İ”©Ü
 = (
Prš‹r
& 
rhs
)

66  *
this
;

67 
	}
}

70 
BOOL
 
	gPhÙoP’OK
;

75 şas 
	cMode690
 : 
public
 
PrštMode


77 
public
:

78 
Mode690
();

82 şas 
	cG¿yMode690
 : 
public
 
PrštMode


84 
public
:

85 
G¿yMode690
();

88 #ifdeà
APDK_EXTENDED_MEDIASIZE


89 şas 
	cMode690D¿áG¿yK
 : 
public
 
G¿yMode


91 
public
:

92 
Mode690D¿áG¿yK
();

95 şas 
	cMode690D¿áCŞÜ
 : 
public
 
PrštMode


97 
public
:

98 
Mode690D¿áCŞÜ
();

101 şas 
	cMode690Be¡G¿yK
 : 
public
 
G¿yMode


103 
public
:

104 
Mode690Be¡G¿yK
();

108 #ifdeà
APDK_DJ6xxPhÙo


112 şas 
	cDJ6xxPhÙoProxy
 : 
public
 
Prš‹rProxy


114 
public
:

115 
	$DJ6xxPhÙoProxy
(è: 
	`Prš‹rProxy
(

120 #ifdeà
APDK_MLC_PRINTER


122 è{
m_iPrš‹rTy³
 = 
eDJ6xxPhÙo
;}

123 
šlše
 
Prš‹r
* 
	$C»©ePrš‹r
(
Sy¡emS”viûs
* 
pSS
ècÚ¡ {  
Ãw
 
	`DJ6xxPhÙo
ÕSS); 
	}
}

124 
šlše
 
PRINTER_TYPE
 
	$G‘Prš‹rTy³
(ècÚ¡ {  
eDJ6xxPhÙo
;
	}
}

125 
šlše
 
	$G‘Mod–B™
(ècÚ¡ {  0x80000;
	}
}

129 
	gAPDK_END_NAMESPACE


	@prnt/hpijs/dj690_maps.cpp

32 
	~"cÚfig.h
"

34 
	~"glob®_ty³s.h
"

36 
APDK_BEGIN_NAMESPACE


38 
ušt32_t
 
	gulM­DJ690_CMYK
[ 9 * 9 * 9 ]=

164 
ušt32_t
 
	gulM­DJ690_ClMlxx
[ 9 * 9 * 9 ]=

291 
	gAPDK_END_NAMESPACE


	@prnt/hpijs/dj6xx.cpp

32 #ià
defšed
(
APDK_DJ540
è|| defšed(
APDK_DJ600
è|| defšed(
APDK_DJ6xx
)

34 
	~"h—d”.h
"

35 
	~"dj6xx.h
"

39 
APDK_BEGIN_NAMESPACE


44 
	gDJ6XX
::
	$DJ6XX
(
Sy¡emS”viûs
* 
pSS
,

45 
numfÚts
, 
BOOL
 
´Ùo
)

46 : 
	$Prš‹r
(
pSS
, 
numfÚts
, 
´Ùo
)

48 
	`DBG1
("DJ6XX constructor called, colormap…ending\n");

49 
	}
}

53 
	gH—d”6XX
::
	$H—d”6XX
(
Prš‹r
* 
p
,
PrštCÚ‹xt
* 
pc
)

54 : 
	$H—d”
(
p
,
pc
)

55 { 
	}
}

57 
DRIVER_ERROR
 
	gH—d”6XX
::
	$S’d
()

58 { 
DRIVER_ERROR
 
”r
;

60 
	`S¹S’d
();

62 
”r
 = 
thePrš‹r
->
	`S’d
((cÚ¡ 
BYTE
*)
BÏckExŒaùOff
,

63 (
BÏckExŒaùOff
));

64 
ERRCHECK
;

66 
”r
 = 
	`CÚfigu»Ra¡”D©a
();

67 
ERRCHECK
;

69 ià(
ResŞutiÚY
[0] == 600)

71 
uom
[10];

72 
	`¥rštf
(
uom
,"%c%c%c%d%c",
ESC
,'&','u',
thePrštMode
->
ResŞutiÚY
[
K
],'D');

73 
”r
=
thePrš‹r
->
	`S’d
((cÚ¡ 
BYTE
*)
uom
, 7 );

74 
ERRCHECK
;

77 
”r
=
	`G¿phics
();

79  
”r
;

80 
	}
}

82 
	gAPDK_END_NAMESPACE


	@prnt/hpijs/dj6xx.h

32 #iâdeà
APDK_DJ6XX_H


33 
	#APDK_DJ6XX_H


	)

35 
APDK_BEGIN_NAMESPACE


40 şas 
	cDJ6XX
 : 
public
 
Prš‹r


42 
public
:

44 
DJ6XX
(
Sy¡emS”viûs
* 
pSS
, 
numfÚts
, 
BOOL
 
´Ùo
 = 
FALSE
);

45 
vœtu®
 
BOOL
 
	$G‘M¬gšs
 (
PAPER_SIZE
 
ps
, *
fM¬gšs
)

47 ià(
ps
 =ğ
A4
)

48 
fM¬gšs
[0] = () 0.135;

50 
fM¬gšs
[0] = () 0.25;

51 
fM¬gšs
[1] = fMargins[0];

52 
fM¬gšs
[2] = () 0.125;

53 
fM¬gšs
[3] = () 0.67;

55  
TRUE
;

58 #ifdeà
APDK_HP_UX


59 
´Ùeùed
:

60 
vœtu®
 
DJ6XX
 & 
İ”©Ü
 = (
Prš‹r
& 
rhs
)

62  *
this
;

63 
	}
}

92 
	gAPDK_END_NAMESPACE


	@prnt/hpijs/dj850.cpp

31 #ià
defšed
(
APDK_DJ850
)

33 
	~"h—d”.h
"

34 
	~"io_defs.h
"

35 
	~"dj850.h
"

36 
	~"´š‹½roxy.h
"

38 
APDK_BEGIN_NAMESPACE


39 
BYTE
* 
G‘HT3x3_4
();

40 
BYTE
* 
G‘HT6x6_4
();

41 
APDK_END_NAMESPACE


43 
APDK_BEGIN_NAMESPACE


45 
ušt32_t
 
ulM­DJ600_CCM_K
[ 9 * 9 * 9 ];

46 
ušt32_t
 
ulM­DJ850_NÜm®_KCMY
[9 * 9 * 9];

47 
ušt32_t
 
ulM­DJ600_CCM_K
[ 9 * 9 * 9 ];

48 
ušt32_t
 
ulM­GRAY_K_6x6x1
[9 * 9 * 9];

50 
	gDJ850Mode1
::
	$DJ850Mode1
()

51 : 
	$PrštMode
(
ulM­DJ850_NÜm®_KCMY
)

55 
CŞÜD•th
[
K
]=1;

57 
i
=1; i < 4; i++)

58 
CŞÜD•th
[
i
]=2;

60 
ResŞutiÚX
[
K
]=
ResŞutiÚY
[K]=600;

61 
MixedRes
 = 
TRUE
;

63 
CŞÜFEDTabË
 = 
	`G‘HT3x3_4
();

65 
	}
}

67 
	gDJ850Mode3
::
	$DJ850Mode3
()

68 : 
	$PrštMode
(
ulM­DJ850_NÜm®_KCMY
)

71 
theQu®™y
 = 
qu®™yD¿á
;

72 
pmQu®™y
 = 
QUALITY_DRAFT
;

73 
	}
}

75 
	gDJ850Mode4
::
	$DJ850Mode4
()

76 : 
	$G¿yMode
(
ulM­DJ600_CCM_K
)

79 
theQu®™y
 = 
qu®™yD¿á
;

80 
pmQu®™y
 = 
QUALITY_DRAFT
;

81 
	}
}

83 
	gDJ850Mode5
::
	$DJ850Mode5
()

84 : 
	$G¿yMode
(
ulM­GRAY_K_6x6x1
)

87 
Ba£ResX
 = 
Ba£ResY
 = 600;

88 
ResŞutiÚX
[
K
]=
ResŞutiÚY
[K]=600;

89 
	}
}

91 
	gDJ850
::
	$DJ850
(
Sy¡emS”viûs
* 
pSS
,

92 
numfÚts
, 
BOOL
 
´Ùo
)

93 : 
	$Prš‹r
(
pSS
, 
numfÚts
, 
´Ùo
)

95 ià((!
´Ùo
è&& (
IOMode
.
bDevID
))

97 
cÚ¡ruùÜ_”rÜ
 = 
	`V”ifyP’Info
();

98 
CERRCHECK
;

100 
eP’
=
BOTH_PENS
;

102 
pMode
[
GRAYMODE_INDEX
] = 
Ãw
 
	`DJ850Mode5
 ();

103 
pMode
[
DEFAULTMODE_INDEX
] = 
Ãw
 
	`DJ850Mode1
 ();

104 
pMode
[
SPECIALMODE_INDEX
] = 
Ãw
 
	`DJ850Mode3
 ();

105 
pMode
[
SPECIALMODE_INDEX
+1] = 
Ãw
 
	`DJ850Mode4
 ();

106 
ModeCouÁ
 = 4;

108 
CMYM­
 = 
ulM­DJ850_NÜm®_KCMY
;

110 
	`DBG1
("DJ850 created\n");

111 
	}
}

113 
	gH—d”850
::
	$H—d”850
(
Prš‹r
* 
p
,
PrštCÚ‹xt
* 
pc
)

114 : 
	$H—d”895
(
p
,
pc
)

115 { 
	}
}

117 
H—d”
* 
	gDJ850
::
	$S–eùH—d”
(
PrštCÚ‹xt
* 
pc
)

119  
Ãw
 
	`H—d”850
(
this
,
pc
);

120 
	}
}

122 
DRIVER_ERROR
 
	gH—d”850
::
	$S¹S’d
()

125 
DRIVER_ERROR
 
”r
;

127 
”r
 = 
thePrš‹r
->
	`S’d
((cÚ¡ 
BYTE
*)
Re£t
,(Reset));

128 
ERRCHECK
;

130 
”r
 = 
thePrš‹r
->
	`S’d
((cÚ¡ 
BYTE
*)
UEL
,(UEL));

131 
ERRCHECK
;

133 
”r
 = 
thePrš‹r
->
	`S’d
((cÚ¡ 
BYTE
*)
EÁ”Lªguage
,(EnterLanguage));

134 
ERRCHECK
;

136 ià(!
thePrš‹r
->
	`U£GUIMode
(
thePrštCÚ‹xt
->
Cu¼’tMode
))

137 
”r
 = 
thePrš‹r
->
	`S’d
((cÚ¡ 
BYTE
*)
PCL3
,(PCL3));

139 
”r
 = 
thePrš‹r
->
	`S’d
((cÚ¡ 
BYTE
*)
PCLGUI
,(PCLGUI));

140 
ERRCHECK
;

142 
”r
 = 
thePrš‹r
->
	`S’d
((cÚ¡ 
BYTE
*)&
LF
,1);

143 
ERRCHECK
;

145 
”r
=
	`Modes
();

146 
ERRCHECK
;

149 
”r
 = 
thePrš‹r
->
	`S’d
 ((cÚ¡ 
BYTE
 *) "\033&l-2H", 6);

150 
ERRCHECK
;

152 
uom
[10];

153 
	`¥rštf
(
uom
,"%c%c%c%d%c",
ESC
,'&','u',
thePrštCÚ‹xt
->
	`EfãùiveResŞutiÚY
(),'D');

154 
”r
=
thePrš‹r
->
	`S’d
((cÚ¡ 
BYTE
*)
uom
, 
	`¡¾’
 (uom));

155 
ERRCHECK
;

157 ià(!
thePrš‹r
->
	`U£GUIMode
(
thePrštCÚ‹xt
->
Cu¼’tMode
))

158 
”r
=
	`M¬gšs
();

162 
CAPy
 = 
thePrštCÚ‹xt
->
	`GUITİM¬gš
();

165  
”r
;

166 
	}
}

168 
DRIVER_ERROR
 
	gDJ850
::
	$V”ifyP’Info
()

171 
DRIVER_ERROR
 
”r
 = 
NO_ERROR
;

173 if(
IOMode
.
bDevID
 =ğ
FALSE
)

175  
”r
;

178 
”r
 = 
	`P¬£P’Info
(
eP’
);

180 
ERRCHECK
;

183 ià(
eP’
 =ğ
BOTH_PENS
)

185  
NO_ERROR
;

188  
eP’
 !ğ
BOTH_PENS
 )

191 
eP’
)

193 
BLACK_PEN
:

195 
pSS
->
	`Di¥ÏyPrš‹rStus
(
DISPLAY_NO_COLOR_PEN
);

197 
COLOR_PEN
:

199 
pSS
->
	`Di¥ÏyPrš‹rStus
(
DISPLAY_NO_BLACK_PEN
);

201 
NO_PEN
:

204 
pSS
->
	`Di¥ÏyPrš‹rStus
(
DISPLAY_NO_PENS
);

208 ià(
pSS
->
	`BusyWa™
(500è=ğ
JOB_CANCELED
)

210  
JOB_CANCELED
;

213 
”r
 = 
	`P¬£P’Info
(
eP’
);

214 
ERRCHECK
;

217 
pSS
->
	`Di¥ÏyPrš‹rStus
(
DISPLAY_PRINTING
);

219  
NO_ERROR
;

220 
	}
}

222 
DRIVER_ERROR
 
	gDJ850
::
	$P¬£P’Info
(
PEN_TYPE
& 
eP’
, 
BOOL
 
Qu”yPrš‹r
)

224 * 
¡r
;

225 
DRIVER_ERROR
 
”r
 = 
	`S‘P’Info
 (
¡r
, 
Qu”yPrš‹r
);

226 
ERRCHECK
;

228 ià(*
¡r
 != '$')

230  
BAD_DEVICE_ID
;

234 
PEN_TYPE
 
‹mp_³n1
;

236 
¡r
[1])

242 
‹mp_³n1
 = 
BLACK_PEN
;

245 'X':  
UNSUPPORTED_PEN
;

246 : 
‹mp_³n1
 = 
NO_PEN
; ;

251 
i
 = 2;

252 (
i
 < 
DevIDBuffSize
è&& 
¡r
[i] != '$') i++;

253 ià(
i
 =ğ
DevIDBuffSize
)

255  
BAD_DEVICE_ID
;

258 
i
++;

261 if(
¡r
[
i
] == 'M')

264 ià(
‹mp_³n1
 =ğ
BLACK_PEN
)

266 
eP’
 = 
BOTH_PENS
;

270 
eP’
 = 
COLOR_PEN
;

275 
eP’
 = 
‹mp_³n1
;

278  
NO_ERROR
;

279 
	}
}

282 
Com´essÜ
* 
	gDJ850
::
	$C»©eCom´essÜ
(
Ra¡”Size
)

284 
	`DBG1
("Compression = Mode2\n");

285  
Ãw
 
	`Mode2
(
pSS
,
Ra¡”Size
);

286 
	}
}

288 
BOOL
 
	gDJ850
::
	$U£GUIMode
(
PrštMode
* 
pPrštMode
)

290  (!
pPrštMode
->
bFÚtC­abË
);

291 
	}
}

326 
DISPLAY_STATUS
 
	gDJ850
::
	$P¬£E¼Ü
(
BYTE
 
¡©us_»g
)

328 
	`DBG1
("DJ850:…arsingƒrror info\n");

330 
DRIVER_ERROR
 
”r
 = 
NO_ERROR
;

331 
BYTE
 
DevIDBufãr
[
DevIDBuffSize
];

333 if(
IOMode
.
bDevID
)

337 
”r
 = 
pSS
->
	`G‘DeviûID
(
DevIDBufãr
, 
DevIDBuffSize
, 
TRUE
);

338 if(
”r
 !ğ
NO_ERROR
)

340  
DISPLAY_COMM_PROBLEM
;

342 iàĞ
	`TİCov”O³n
(
¡©us_»g
) )

344 
	`DBG1
("Top Cover Open\n");

345  
DISPLAY_TOP_COVER_OPEN
;

350 
”r
 = 
	`V”ifyP’Info
();

352 if(
”r
 !ğ
NO_ERROR
)

359  
DISPLAY_COMM_PROBLEM
;

363 ià(
IOMode
.
bStus
)

365 iàĞ
	`DEVICE_IS_OOP
(
¡©us_»g
) )

367 
	`DBG1
("Out Of Paper\n");

368  
DISPLAY_OUT_OF_PAPER
;

371 ià(
	`DEVICE_PAPER_JAMMED
(
¡©us_»g
))

373 
	`DBG1
("Paper Jammed\n");

374  
DISPLAY_PAPER_JAMMED
;

377 ià(
	`DEVICE_IO_TRAP
(
¡©us_»g
))

379 
	`DBG1
("IOrap\n");

380  
DISPLAY_ERROR_TRAP
;

386 ià(
pSS
->
	`Prš‹rIsAlive
())

388 
iTÙ®_SLOW_POLL_CouÁ
 +ğ
iMax_SLOW_POLL_CouÁ
;

389 #ià
	`defšed
(
DEBUG
è&& (
DBG_MASK
 & 
DBG_LVL1
)

390 
	`´štf
("iTÙ®_SLOW_POLL_CouÁ = %d\n",
iTÙ®_SLOW_POLL_CouÁ
);

398 ((
IOMode
.
bDevID
 =ğ
FALSE
è&& (
iTÙ®_SLOW_POLL_CouÁ
 >= 60)) ||

399 ((
IOMode
.
bDevID
 =ğ
TRUE
è&& (
iTÙ®_SLOW_POLL_CouÁ
 >= 120))

402  
DISPLAY_BUSY
;

406  
DISPLAY_PRINTING
;

411  
DISPLAY_COMM_PROBLEM
;

413 
	}
}

415 
	gAPDK_END_NAMESPACE


	@prnt/hpijs/dj850.h

32 #iâdeà
APDK_DJ850_H


33 
	#APDK_DJ850_H


	)

35 
APDK_BEGIN_NAMESPACE


42 şas 
	cDJ850
 : 
public
 
Prš‹r


44 
public
:

45 
DJ850
(
Sy¡emS”viûs
* 
pSS
,
numfÚts
=0, 
BOOL
 
´Ùo
=
FALSE
);

47 
vœtu®
 
H—d”
* 
S–eùH—d”
(
PrštCÚ‹xt
* 
pc
);

48 
vœtu®
 
DRIVER_ERROR
 
V”ifyP’Info
();

49 
vœtu®
 
DRIVER_ERROR
 
P¬£P’Info
(
PEN_TYPE
& 
eP’
, 
BOOL
 
Qu”yPrš‹r
=
TRUE
);

50 
vœtu®
 
DISPLAY_STATUS
 
P¬£E¼Ü
(
BYTE
 
¡©us_»g
);

52 
Com´essÜ
* 
C»©eCom´essÜ
(
Ra¡”Size
);

54 
vœtu®
 
BOOL
 
U£GUIMode
(
PrštMode
* 
pPrštMode
);

56 #ifdeà
APDK_HP_UX


57 
	m´Ùeùed
:

58 
vœtu®
 
DJ850
 & 
İ”©Ü
 = (
Prš‹r
& 
rhs
)

60  *
this
;

67 şas 
	cDJ850Mode1
 : 
public
 
PrštMode


69 
public
:

70 
DJ850Mode1
();

73 şas 
	cDJ850Mode3
 : 
public
 
PrštMode


75 
public
:

76 
DJ850Mode3
();

79 şas 
	cDJ850Mode4
 : 
public
 
G¿yMode


81 
public
:

82 
DJ850Mode4
();

85 şas 
	cDJ850Mode5
 : 
public
 
G¿yMode


87 
public
:

88 
DJ850Mode5
();

91 #ià
defšed
(
APDK_DJ850
)

95 şas 
	cDJ850Proxy
 : 
public
 
Prš‹rProxy


97 
public
:

98 
	$DJ850Proxy
(è: 
	`Prš‹rProxy
(

102 #ifdeà
APDK_MLC_PRINTER


105 è{
m_iPrš‹rTy³
 = 
eDJ850
;}

106 
šlše
 
Prš‹r
* 
	$C»©ePrš‹r
(
Sy¡emS”viûs
* 
pSS
ècÚ¡ {  
Ãw
 
	`DJ850
ÕSS); 
	}
}

107 
šlše
 
PRINTER_TYPE
 
	$G‘Prš‹rTy³
(ècÚ¡ {  
eDJ850
;
	}
}

108 
šlše
 
	$G‘Mod–B™
(ècÚ¡ {  0x8;
	}
}

112 
	gAPDK_END_NAMESPACE


	@prnt/hpijs/dj850_maps.cpp

31 
	~"cÚfig.h
"

33 
	~"glob®_ty³s.h
"

35 
APDK_BEGIN_NAMESPACE


37 
ušt32_t
 
	gulM­DJ850_NÜm®_KCMY
[ 9*9*9 ]=

163 
	gAPDK_END_NAMESPACE


	@prnt/hpijs/dj890.cpp

31 #ià
defšed
(
APDK_DJ890
)

33 
	~"h—d”.h
"

34 
	~"io_defs.h
"

35 
	~"dj8xx.h
"

36 
	~"dj890.h
"

37 
	~"´š‹½roxy.h
"

39 
APDK_BEGIN_NAMESPACE


41 
ušt32_t
 
ulM­DJ895_Bš¬y_KCMY
[ 9 * 9 * 9 ];

42 
ušt32_t
 
ulM­DJ600_CCM_K
[9 * 9 * 9 ];

44 
	gDJ890
::
	$DJ890
(
Sy¡emS”viûs
* 
pSS
,

45 
numfÚts
, 
BOOL
 
´Ùo
)

46 : 
	$DJ8xx
(
pSS
, 
numfÚts
, 
´Ùo
)

49 ià((!
´Ùo
è&& (
IOMode
.
bDevID
))

51 
cÚ¡ruùÜ_”rÜ
 = 
	`V”ifyP’Info
();

52 
CERRCHECK
;

54 
eP’
=
BOTH_PENS
;

56 #ifdeà
APDK_EXTENDED_MEDIASIZE


57 
pMode
[
GRAYMODE_INDEX
] = 
Ãw
 
	`DJ895Mode5
 ();

59 
pMode
[
GRAYMODE_INDEX
] = 
Ãw
 
	`G¿yMode
 (
ulM­DJ600_CCM_K
);

61 
pMode
[
DEFAULTMODE_INDEX
] = 
Ãw
 
	`DJ895Mode1
 ();

62 
pMode
[
SPECIALMODE_INDEX
] = 
Ãw
 
	`DJ895Mode3
 ();

63 
pMode
[
SPECIALMODE_INDEX
+1] = 
Ãw
 
	`DJ895Mode4
 ();

64 
ModeCouÁ
 = 4;

66 
CMYM­
 = 
ulM­DJ895_Bš¬y_KCMY
;

68 
	`DBG1
("DJ890 created\n");

69 
	}
}

71 
H—d”
* 
	gDJ890
::
	$S–eùH—d”
(
PrštCÚ‹xt
* 
pc
)

73  
Ãw
 
	`H—d”895
(
this
,
pc
);

74 
	}
}

76 
	gAPDK_END_NAMESPACE


	@prnt/hpijs/dj890.h

32 #iâdeà
APDK_DJ890_H


33 
	#APDK_DJ890_H


	)

35 
APDK_BEGIN_NAMESPACE


40 şas 
	cDJ890
 : 
public
 
DJ8xx


42 
public
:

43 
DJ890
(
Sy¡emS”viûs
* 
pSS
,
numfÚts
=0, 
BOOL
 
´Ùo
=
FALSE
);

44 
vœtu®
 
H—d”
 *
S–eùH—d”
 (
PrštCÚ‹xt
 *
pc
);

48 #ià
defšed
(
APDK_DJ890
)

52 şas 
	cDJ890Proxy
 : 
public
 
Prš‹rProxy


54 
public
:

55 
	$DJ890Proxy
(è: 
	`Prš‹rProxy
(

58 #ifdeà
APDK_MLC_PRINTER


61 è{
m_iPrš‹rTy³
 = 
eDJ890
;}

62 
šlše
 
Prš‹r
* 
	$C»©ePrš‹r
(
Sy¡emS”viûs
* 
pSS
ècÚ¡ {  
Ãw
 
	`DJ890
ÕSS); 
	}
}

63 
šlše
 
PRINTER_TYPE
 
	$G‘Prš‹rTy³
(ècÚ¡ {  
eDJ890
;
	}
}

64 
šlše
 
	$G‘Mod–B™
(ècÚ¡ {  0x4;
	}
}

68 
	gAPDK_END_NAMESPACE


	@prnt/hpijs/dj895_maps.cpp

32 
	~"cÚfig.h
"

34 
	~"glob®_ty³s.h
"

36 
APDK_BEGIN_NAMESPACE


38 
ušt32_t
 
	gulM­DJ895_KCMY
[ 9*9*9 ]=

123 
	gAPDK_END_NAMESPACE


	@prnt/hpijs/dj895_maps2.cpp

32 
	~"cÚfig.h
"

34 
	~"glob®_ty³s.h
"

36 
APDK_BEGIN_NAMESPACE


38 
ušt32_t
 
	gulM­DJ895_HB_KCMY
[ 9*9*9 ]=

164 
ušt32_t
 
	gulM­DJ895_Bš¬y_KCMY
[ 9*9*9 ]=

290 
	gAPDK_END_NAMESPACE


	@prnt/hpijs/dj8x5.cpp

32 #ià
defšed
(
APDK_DJ8xx
)|| defšed(
APDK_DJ9xx
)

34 #ifdeà
APDK_DJ8x5


35 
	~"h—d”.h
"

36 
	~"dj8xx.h
"

37 
	~"dj8x5.h
"

38 
	~"´š‹½roxy.h
"

40 
APDK_BEGIN_NAMESPACE


41 
BYTE
* 
G‘HT3x3_4
();

42 
BYTE
* 
G‘HT6x6_4
();

43 
APDK_END_NAMESPACE


45 
APDK_BEGIN_NAMESPACE


47 
ušt32_t
 
ulM­DJ8x5PÏšNÜm®
[ 9 * 9 * 9 ];

48 
ušt32_t
 
ulM­DJ895_HB_KCMY
[ 9 * 9 * 9 ];

49 
ušt32_t
 
ulM­DJ8x5D¿á
[ 9 * 9 * 9 ];

52 
	gDJ8x5Mode1
::
	$DJ8x5Mode1
()

53 : 
	$PrštMode
(
ulM­DJ8x5PÏšNÜm®
)

58 
CŞÜD•th
[
K
]=1;

60 
i
=1; i < 4; i++)

61 
CŞÜD•th
[
i
]=2;

63 
ResŞutiÚX
[
K
] =

64 
ResŞutiÚY
[
K
] = 600;

66 
MixedRes
 = 
TRUE
;

68 
CŞÜFEDTabË
 = 
	`G‘HT3x3_4
();

70 
bFÚtC­abË
 = 
FALSE
;

71 
dyeCouÁ
 = 3;

72 
Com·tibËP’s
[0] = 
COLOR_PEN
;

73 
	}
}

75 
	gDJ8x5Mode2
::
	$DJ8x5Mode2
()

76 : 
	$PrštMode
(
ulM­DJ895_HB_KCMY
)

79 
i
;

80 
CŞÜD•th
[
K
]=1;

82 
i
=1; i < 4; i++)

83 
CŞÜD•th
[
i
]=2;

85 
i
=0; i < 4; i++)

86 
ResŞutiÚX
[
i
]=
ResŞutiÚY
[i]=600;

88 
Ba£ResX
 = 
Ba£ResY
 = 600;

89 
MixedRes
 = 
FALSE
;

91 
medium
 = 
medŸGlossy
;

92 
theQu®™y
 = 
qu®™yP»£Á©iÚ
;

94 
CŞÜFEDTabË
 = 
	`G‘HT6x6_4
();

96 
bFÚtC­abË
 = 
FALSE
;

98 
dyeCouÁ
 = 3;

99 
Com·tibËP’s
[0] = 
COLOR_PEN
;

101 
pmQu®™y
 = 
QUALITY_BEST
;

102 
pmMedŸTy³
 = 
MEDIA_PHOTO
;

103 
	}
}

105 
	gDJ8x5Mode3
::
	$DJ8x5Mode3
()

106 : 
	$PrštMode
(
ulM­DJ8x5D¿á
)

110 
dyeCouÁ
 = 3;

111 
Com·tibËP’s
[0] = 
COLOR_PEN
;

112 
theQu®™y
 = 
qu®™yD¿á
;

113 
pmQu®™y
 = 
QUALITY_DRAFT
;

114 
	}
}

116 
	gDJ8x5
::
	$DJ8x5
 (
Sy¡emS”viûs
* 
pSS
, 
numfÚts
, 
BOOL
 
´Ùo
)

117 : 
	$DJ8xx
 (
pSS
, 
numfÚts
, 
TRUE
)

119 
CMYM­
 = 
ulM­DJ8x5D¿á
;

127 ià((!
´Ùo
è&& (
IOMode
.
bDevID
))

129 
cÚ¡ruùÜ_”rÜ
 = 
	`V”ifyP’Info
();

130 
CERRCHECK
;

134 
eP’
 = 
COLOR_PEN
;

139 
pMode
[5] = 
Ãw
 
	`DJ8x5Mode1
 ();

140 
pMode
[6] = 
Ãw
 
	`DJ8x5Mode2
 ();

141 
pMode
[7] = 
Ãw
 
	`DJ8x5Mode3
 ();

142 
ModeCouÁ
 = 8;

144 
	`DBG1
("DJ8x5 created\n");

145 
	}
}

147 
PEN_TYPE
 
	gDJ8x5
::
	$DeçuÉP’S‘
()

149  
COLOR_PEN
;

150 
	}
}

152 
DRIVER_ERROR
 
	gDJ8x5
::
	$V”ifyP’Info
 ()

155 
DRIVER_ERROR
 
”r
=
NO_ERROR
;

157 if(
IOMode
.
bDevID
 =ğ
FALSE
)

158  
”r
;

160 
”r
 = 
	`P¬£P’Info
 (
eP’
);

162 if(
”r
 =ğ
UNSUPPORTED_PEN
)

164 
	`DBG1
("DJ8x5::Needo do‡ POWER ONo get…enIDs\n");

166 ià(
pSS
->
	`BusyWa™
((
DWORD
)2000è=ğ
JOB_CANCELED
)

167  
JOB_CANCELED
;

169 
DWORD
 
Ëngth
= (
DJ895_Pow”_On
);

170 
”r
 = 
pSS
->
	`ToDeviû
 (
DJ895_Pow”_On
, &
Ëngth
);

171 
ERRCHECK
;

173 
”r
 = 
pSS
->
	`FlushIO
 ();

174 
ERRCHECK
;

177 ià(
pSS
->
	`BusyWa™
 ((
DWORD
è2500è=ğ
JOB_CANCELED
)

178  
JOB_CANCELED
;

180 
”r
 = 
	`P¬£P’Info
(
eP’
);

183 
ERRCHECK
;

186 ià(
eP’
 =ğ
BOTH_PENS
)

187  
NO_ERROR
;

189 
eP’
 =ğ
NO_PEN
)

191 
pSS
->
	`Di¥ÏyPrš‹rStus
(
DISPLAY_NO_PENS
);

193 ià(
pSS
->
	`BusyWa™
(500è=ğ
JOB_CANCELED
)

194  
JOB_CANCELED
;

196 
”r
 = 
	`P¬£P’Info
(
eP’
);

197 
ERRCHECK
;

200 
pSS
->
	`Di¥ÏyPrš‹rStus
(
DISPLAY_PRINTING
);

202  
NO_ERROR
;

203 
	}
}

205 
	gAPDK_END_NAMESPACE


	@prnt/hpijs/dj8x5.h

32 #iâdeà
APDK_DJ8X5_H


33 
	#APDK_DJ8X5_H


	)

35 
APDK_BEGIN_NAMESPACE


40 şas 
	cDJ8x5
 : 
public
 
DJ8xx


42 
public
:

43 
DJ8x5
 (
Sy¡emS”viûs
* 
pSS
,
numfÚts
=0, 
BOOL
 
´Ùo
=
FALSE
);

45 
vœtu®
 
DRIVER_ERROR
 
V”ifyP’Info
();

46 
vœtu®
 
PEN_TYPE
 
DeçuÉP’S‘
();

51 şas 
	cDJ8x5Mode1
 : 
public
 
PrštMode


53 
public
:

54 
DJ8x5Mode1
();

58 şas 
	cDJ8x5Mode2
 : 
public
 
PrštMode


60 
public
:

61 
DJ8x5Mode2
();

65 şas 
	cDJ8x5Mode3
 : 
public
 
PrštMode


67 
public
:

68 
DJ8x5Mode3
();

86 #ià
defšed
(
APDK_DJ8xx
)|| defšed(
APDK_DJ9xx
)

88 #ifdeà
APDK_DJ8x5


92 şas 
	cDJ8x5Proxy
 : 
public
 
Prš‹rProxy


94 
public
:

95 
	$DJ8x5Proxy
(è: 
	`Prš‹rProxy
(

99 #ifdeà
APDK_MLC_PRINTER


101 è{
m_iPrš‹rTy³
 = 
eDJ8x5
;}

102 
šlše
 
Prš‹r
* 
	$C»©ePrš‹r
(
Sy¡emS”viûs
* 
pSS
ècÚ¡ {  
Ãw
 
	`DJ8x5
ÕSS); 
	}
}

103 
šlše
 
PRINTER_TYPE
 
	$G‘Prš‹rTy³
(ècÚ¡ {  
eDJ8x5
;
	}
}

104 
šlše
 
	$G‘Mod–B™
(ècÚ¡ {  0x400;
	}
}

109 
	gAPDK_END_NAMESPACE


	@prnt/hpijs/dj8xx.cpp

32 #ià
defšed
(
APDK_DJ8xx
)|| defšed(
APDK_DJ9xx
)

34 
	~"h—d”.h
"

35 
	~"io_defs.h
"

36 
	~"dj8xx.h
"

37 
	~"´š‹½roxy.h
"

39 
APDK_BEGIN_NAMESPACE


40 
BYTE
* 
G‘HT3x3_4
();

41 
BYTE
* 
G‘HT6x6_4
();

42 
APDK_END_NAMESPACE


44 
APDK_BEGIN_NAMESPACE


46 
ušt32_t
 
ulM­DJ895_KCMY
[ 9 * 9 * 9 ];

47 
ušt32_t
 
ulM­DJ600_CCM_K
[ 9 * 9 * 9 ];

48 
ušt32_t
 
ulM­DJ895_HB_KCMY
[ 9 * 9 * 9 ];

49 
ušt32_t
 
ulM­DJ895_Bš¬y_KCMY
[ 9 * 9 * 9 ];

50 
ušt32_t
 
ulM­GRAY_K_6x6x1
[9 * 9 * 9];

52 
	gDJ895Mode1
::
	$DJ895Mode1
()

53 : 
	$PrštMode
(
ulM­DJ895_KCMY
)

58 
CŞÜD•th
[
K
]=1;

60 
i
=1; i < 4; i++)

61 
CŞÜD•th
[
i
]=2;

63 
ResŞutiÚX
[
K
]=
ResŞutiÚY
[K]=600;

65 
MixedRes
 = 
TRUE
;

67 
CŞÜFEDTabË
 = 
	`G‘HT3x3_4
();

69 
bFÚtC­abË
 = 
FALSE
;

70 
	}
}

72 
	gDJ895Mode2
::
	$DJ895Mode2
()

73 : 
	$PrštMode
(
ulM­DJ895_HB_KCMY
)

77 
i
;

78 
CŞÜD•th
[
K
]=1;

80 
i
=1; i < 4; i++)

81 
CŞÜD•th
[
i
]=2;

83 
i
=0; i < 4; i++)

84 
ResŞutiÚX
[
i
]=
ResŞutiÚY
[i]=600;

86 
Ba£ResX
 = 
Ba£ResY
 = 600;

87 
MixedRes
 = 
FALSE
;

89 
medium
 = 
medŸGlossy
;

90 
theQu®™y
 = 
qu®™yP»£Á©iÚ
;

92 
CŞÜFEDTabË
 = 
	`G‘HT6x6_4
();

94 
bFÚtC­abË
 = 
FALSE
;

98 
pmQu®™y
 = 
QUALITY_BEST
;

99 
pmMedŸTy³
 = 
MEDIA_PHOTO
;

100 
	}
}

102 
	gDJ895Mode3
::
	$DJ895Mode3
()

103 : 
	$PrštMode
(
ulM­DJ895_Bš¬y_KCMY
)

107 
theQu®™y
 = 
qu®™yD¿á
;

109 
pmQu®™y
 = 
QUALITY_DRAFT
;

110 
	}
}

112 
	gDJ895Mode4
::
	$DJ895Mode4
()

113 : 
	$G¿yMode
(
ulM­DJ600_CCM_K
)

116 
theQu®™y
 = 
qu®™yD¿á
;

117 
pmQu®™y
 = 
QUALITY_DRAFT
;

118 
	}
}

120 #ifdeà
APDK_EXTENDED_MEDIASIZE


121 
	gDJ895Mode5
::
	$DJ895Mode5
()

122 : 
	$G¿yMode
(
ulM­GRAY_K_6x6x1
)

125 
Ba£ResX
 = 
Ba£ResY
 = 600;

126 
ResŞutiÚX
[
K
]=
ResŞutiÚY
[K]=600;

127 
bFÚtC­abË
 = 
FALSE
;

128 
	}
}

131 
	gDJ8xx
::
	$DJ8xx
(
Sy¡emS”viûs
* 
pSS
,

132 
numfÚts
, 
BOOL
 
´Ùo
)

133 : 
	$Prš‹r
(
pSS
, 
numfÚts
, 
´Ùo
)

136 ià((!
´Ùo
è&& (
IOMode
.
bDevID
))

138 
cÚ¡ruùÜ_”rÜ
 = 
	`V”ifyP’Info
();

139 
CERRCHECK
;

141 
eP’
=
BOTH_PENS
;

143 #ifdeà
APDK_EXTENDED_MEDIASIZE


144 
pMode
[
GRAYMODE_INDEX
] = 
Ãw
 
	`DJ895Mode5
 ();

146 
pMode
[
GRAYMODE_INDEX
] = 
Ãw
 
	`G¿yMode
 (
ulM­DJ600_CCM_K
);

148 
pMode
[
DEFAULTMODE_INDEX
] = 
Ãw
 
	`DJ895Mode1
 ();

149 
pMode
[
SPECIALMODE_INDEX
] = 
Ãw
 
	`DJ895Mode2
 ();

150 
pMode
[
SPECIALMODE_INDEX
+1] = 
Ãw
 
	`DJ895Mode3
 ();

151 
pMode
[
SPECIALMODE_INDEX
+2] = 
Ãw
 
	`DJ895Mode4
 ();

152 
ModeCouÁ
 = 5;

154 
CMYM­
 = 
ulM­DJ895_Bš¬y_KCMY
;

156 
	`DBG1
("DJ8xx created\n");

157 
	}
}

160 
	gH—d”895
::
	$H—d”895
(
Prš‹r
* 
p
,
PrštCÚ‹xt
* 
pc
)

161 : 
	$H—d”
(
p
,
pc
)

162 { 
	}
}

164 
DRIVER_ERROR
 
	gH—d”895
::
	$S’d
()

165 { 
DRIVER_ERROR
 
”r
;

167 
	`S¹S’d
();

169 
”r
 = 
	`CÚfigu»Ra¡”D©a
();

170 
ERRCHECK
;

172 
”r
=
	`G¿phics
();

177  
”r
;

178 
	}
}

180 
DRIVER_ERROR
 
	gH—d”895
::
	$S¹S’d
()

183 
DRIVER_ERROR
 
”r
;

185 
”r
 = 
thePrš‹r
->
	`S’d
((cÚ¡ 
BYTE
*)
Re£t
,(Reset));

186 
ERRCHECK
;

188 
”r
 = 
thePrš‹r
->
	`S’d
((cÚ¡ 
BYTE
*)
UEL
,(UEL));

189 
ERRCHECK
;

191 
”r
 = 
thePrš‹r
->
	`S’d
((cÚ¡ 
BYTE
*)
EÁ”Lªguage
,(EnterLanguage));

192 
ERRCHECK
;

194 ià(!
thePrš‹r
->
	`U£GUIMode
(
thePrštCÚ‹xt
->
Cu¼’tMode
))

195 
”r
 = 
thePrš‹r
->
	`S’d
((cÚ¡ 
BYTE
*)
PCL3
,(PCL3));

197 
”r
 = 
thePrš‹r
->
	`S’d
((cÚ¡ 
BYTE
*)
PCLGUI
,(PCLGUI));

198 
ERRCHECK
;

200 
”r
 = 
thePrš‹r
->
	`S’d
((cÚ¡ 
BYTE
*)&
LF
,1);

201 
ERRCHECK
;

203 
”r
=
	`Modes
();

204 
ERRCHECK
;

207 
”r
 = 
thePrš‹r
->
	`S’d
 ((cÚ¡ 
BYTE
 *) "\033&l-2H", 6);

208 
ERRCHECK
;

210 
uom
[10];

211 
	`¥rštf
(
uom
,"%c%c%c%d%c",
ESC
,'&','u',
thePrštCÚ‹xt
->
	`EfãùiveResŞutiÚY
(),'D');

212 
”r
=
thePrš‹r
->
	`S’d
((cÚ¡ 
BYTE
*)
uom
, 
	`¡¾’
 (uom));

213 
ERRCHECK
;

215 ià(!
thePrš‹r
->
	`U£GUIMode
(
thePrštCÚ‹xt
->
Cu¼’tMode
))

216 
”r
=
	`M¬gšs
();

220 
CAPy
 = 
thePrštCÚ‹xt
->
	`GUITİM¬gš
();

223  
”r
;

224 
	}
}

226 
BYTE
 
EscAm¶Cİy
(BYTE *
de¡
, 
num
, 
’d
);

229 
DRIVER_ERROR
 
	gH—d”895
::
	$G¿phics
()

232 
DRIVER_ERROR
 
”rÜ
ğ
thePrš‹r
->
	`S’d
((cÚ¡ 
BYTE
*)
g¿fS¹
, (grafStart) );

233 ià(
”rÜ
!=
NO_ERROR
)

234  
”rÜ
;

236 ià(
thePrštMode
->
CÚfig
.
bCom´ess
)

238 
”rÜ
ğ
thePrš‹r
->
	`S’d
((cÚ¡ 
BYTE
*)
g¿fMode2
, (grafMode2) );

239 ià(
”rÜ
!=
NO_ERROR
)

240  
”rÜ
;

244 
”rÜ
ğ
thePrš‹r
->
	`S’d
((cÚ¡ 
BYTE
*)
g¿fMode0
, (grafMode0) );

246  
”rÜ
;

247 
	#GRAPHICSIZE
 ((
g¿fS¹
)+(
g¿fMode9
)+(
S“dSame
))

	)

248 
	}
}

251 
H—d”
* 
	gDJ8xx
::
	$S–eùH—d”
(
PrštCÚ‹xt
* 
pc
)

253  
Ãw
 
	`H—d”895
(
this
,
pc
);

254 
	}
}

256 
DRIVER_ERROR
 
	gDJ8xx
::
	$V”ifyP’Info
()

259 
DRIVER_ERROR
 
”r
 = 
NO_ERROR
;

261 if(
IOMode
.
bDevID
 =ğ
FALSE
)

263  
”r
;

266 
”r
 = 
	`P¬£P’Info
(
eP’
);

268 if(
”r
 =ğ
UNSUPPORTED_PEN
)

270 
	`DBG1
("DJ8xx::Needo do‡ POWER ONo get…enIDs\n");

273 ià(
pSS
->
	`BusyWa™
((
DWORD
)2000è=ğ
JOB_CANCELED
)

275  
JOB_CANCELED
;

278 
DWORD
 
Ëngth
 = (
DJ895_Pow”_On
);

279 
”r
 = 
pSS
->
	`ToDeviû
(
DJ895_Pow”_On
,&
Ëngth
);

280 
ERRCHECK
;

282 
”r
 = 
pSS
->
	`FlushIO
();

283 
ERRCHECK
;

286 ià(
pSS
->
	`BusyWa™
 ((
DWORD
è2500è=ğ
JOB_CANCELED
)

288  
JOB_CANCELED
;

291 
”r
 = 
	`P¬£P’Info
(
eP’
);

294 
ERRCHECK
;

297 ià(
eP’
 =ğ
BOTH_PENS
)

299  
NO_ERROR
;

302  
eP’
 !ğ
BOTH_PENS
 )

305 
eP’
)

307 
BLACK_PEN
:

309 
pSS
->
	`Di¥ÏyPrš‹rStus
(
DISPLAY_NO_COLOR_PEN
);

311 
COLOR_PEN
:

313 
pSS
->
	`Di¥ÏyPrš‹rStus
(
DISPLAY_NO_BLACK_PEN
);

315 
NO_PEN
:

318 
pSS
->
	`Di¥ÏyPrš‹rStus
(
DISPLAY_NO_PENS
);

322 ià(
pSS
->
	`BusyWa™
(500è=ğ
JOB_CANCELED
)

324  
JOB_CANCELED
;

327 
”r
 = 
	`P¬£P’Info
(
eP’
);

328 
ERRCHECK
;

331 
pSS
->
	`Di¥ÏyPrš‹rStus
(
DISPLAY_PRINTING
);

333  
NO_ERROR
;

334 
	}
}

336 
DRIVER_ERROR
 
	gDJ8xx
::
	$P¬£P’Info
(
PEN_TYPE
& 
eP’
, 
BOOL
 
Qu”yPrš‹r
)

338 * 
¡r
;

339 
DRIVER_ERROR
 
”r
 = 
	`S‘P’Info
 (
¡r
, 
Qu”yPrš‹r
);

340 
ERRCHECK
;

342 ià(*
¡r
 != '$')

344  
BAD_DEVICE_ID
;

348 
PEN_TYPE
 
‹mp_³n1
;

350 
¡r
[1])

356 
‹mp_³n1
 = 
BLACK_PEN
;

359 'X':  
UNSUPPORTED_PEN
;

360 : 
‹mp_³n1
 = 
NO_PEN
; ;

365 
i
 = 2;

366 (
i
 < 
DevIDBuffSize
è&& 
¡r
[i] != '$') i++;

367 ià(
i
 =ğ
DevIDBuffSize
)

369  
BAD_DEVICE_ID
;

372 
i
++;

378 if(
¡r
[
i
] != 'X' && str[i] != 'A' && str[i] != 'M')

381 ià(
‹mp_³n1
 =ğ
BLACK_PEN
)

383 
eP’
 = 
BOTH_PENS
;

387 
eP’
 = 
COLOR_PEN
;

392 
eP’
 = 
‹mp_³n1
;

395  
NO_ERROR
;

396 
	}
}

399 
Com´essÜ
* 
	gDJ8xx
::
	$C»©eCom´essÜ
(
Ra¡”Size
)

401 
	`DBG1
("Compression = Mode2\n");

402  
Ãw
 
	`Mode2
(
pSS
,
Ra¡”Size
);

403 
	}
}

405 
BOOL
 
	gDJ8xx
::
	$U£GUIMode
(
PrštMode
* 
pPrštMode
)

407  (!
pPrštMode
->
bFÚtC­abË
);

408 
	}
}

410 
DRIVER_ERROR
 
	gDJ8xx
::
	$CËªP’
()

412 cÚ¡ 
BYTE
 
DJ895_DŸg_Page
[] = {
ESC
, '%','P','u','i','f','p','.',

414 'u','d','w','.','q','u','i','t',';',
ESC
,'%','-','1','2','3','4','5','X' };

416 cÚ¡ 
BYTE
 
PEN_CLEAN_PML
[]={0x1B,0x45,0x1B,0x26,0x62,0x31,0x36,0x57,

421 
DWORD
 
Ëngth
 = (
DJ895_Pow”_On
);

422 
DRIVER_ERROR
 
E¼Ü
 = 
pSS
->
	`ToDeviû
(
DJ895_Pow”_On
,&
Ëngth
);

424 
pSS
->
	`BusyWa™
((
DWORD
)1000);

426 
Ëngth
 = (
PEN_CLEAN_PML
);

427 
E¼Ü
 = 
pSS
->
	`ToDeviû
(
PEN_CLEAN_PML
,&
Ëngth
);

429 
Ëngth
 = (
DJ895_DŸg_Page
);

430  
pSS
->
	`ToDeviû
(
DJ895_DŸg_Page
,&
Ëngth
);

431 
	}
}

468 
DISPLAY_STATUS
 
	gDJ8xx
::
	$P¬£E¼Ü
(
BYTE
 
¡©us_»g
)

470 
	`DBG1
("DJ8xx:…arsingƒrror info\n");

472 
DRIVER_ERROR
 
”r
 = 
NO_ERROR
;

473 
BYTE
 
DevIDBufãr
[
DevIDBuffSize
];

475 *
pSŒ
;

476 if(
IOMode
.
bDevID
)

480 
”r
 = 
pSS
->
	`G‘DeviûID
(
DevIDBufãr
, 
DevIDBuffSize
, 
TRUE
);

481 if(
”r
 !ğ
NO_ERROR
)

483  
DISPLAY_COMM_PROBLEM
;

485 iàĞ
	`TİCov”O³n
(
¡©us_»g
) )

487 
	`DBG1
("Top Cover Open\n");

488  
DISPLAY_TOP_COVER_OPEN
;

492 iàĞ(
pSŒ
=(*)
	`¡r¡r
((cÚ¡ *)
DevIDBufãr
+2,"VSTATUS:")è=ğ
NULL
 )

494  
DISPLAY_COMM_PROBLEM
;

497 
pSŒ
+=8;

499 ià(
	`¡r¡r
((*)
pSŒ
,"PAJM") || strstr((*)pStr,"PAPS"))

501  
DISPLAY_PAPER_JAMMED
;

505 ià(
	`¡r¡r
((*)
pSŒ
,"PWDN") || strstr((*)pStr,"OFFF"))

507  
DISPLAY_OFFLINE
;

513 
”r
 = 
	`V”ifyP’Info
();

515 if(
”r
 !ğ
NO_ERROR
)

522  
DISPLAY_COMM_PROBLEM
;

526 ià(
IOMode
.
bStus
)

528 iàĞ
	`DEVICE_IS_OOP
(
¡©us_»g
) )

530 
	`DBG1
("Out Of Paper\n");

531  
DISPLAY_OUT_OF_PAPER
;

534 ià(
	`DEVICE_PAPER_JAMMED
(
¡©us_»g
))

536 
	`DBG1
("Paper Jammed\n");

537  
DISPLAY_PAPER_JAMMED
;

540 ià(
	`DEVICE_IO_TRAP
(
¡©us_»g
))

542 
	`DBG1
("IOrap\n");

543  
DISPLAY_ERROR_TRAP
;

549 ià(
pSS
->
	`Prš‹rIsAlive
())

551 
iTÙ®_SLOW_POLL_CouÁ
 +ğ
iMax_SLOW_POLL_CouÁ
;

552 #ià
	`defšed
(
DEBUG
è&& (
DBG_MASK
 & 
DBG_LVL1
)

553 
	`´štf
("iTÙ®_SLOW_POLL_CouÁ = %d\n",
iTÙ®_SLOW_POLL_CouÁ
);

561 ((
IOMode
.
bDevID
 =ğ
FALSE
è&& (
iTÙ®_SLOW_POLL_CouÁ
 >= 60)) ||

562 ((
IOMode
.
bDevID
 =ğ
TRUE
è&& (
iTÙ®_SLOW_POLL_CouÁ
 >= 120))

565  
DISPLAY_BUSY
;

569  
DISPLAY_PRINTING
;

574  
DISPLAY_COMM_PROBLEM
;

576 
	}
}

578 
	gAPDK_END_NAMESPACE


	@prnt/hpijs/dj8xx.h

32 #iâdeà
APDK_DJ8XX_H


33 
	#APDK_DJ8XX_H


	)

35 
APDK_BEGIN_NAMESPACE


42 şas 
	cDJ8xx
 : 
public
 
Prš‹r


44 
public
:

45 
DJ8xx
(
Sy¡emS”viûs
* 
pSS
,
numfÚts
=0, 
BOOL
 
´Ùo
=
FALSE
);

47 
vœtu®
 
H—d”
* 
S–eùH—d”
(
PrštCÚ‹xt
* 
pc
);

48 
vœtu®
 
DRIVER_ERROR
 
V”ifyP’Info
();

49 
vœtu®
 
DRIVER_ERROR
 
P¬£P’Info
(
PEN_TYPE
& 
eP’
, 
BOOL
 
Qu”yPrš‹r
=
TRUE
);

50 
vœtu®
 
DISPLAY_STATUS
 
P¬£E¼Ü
(
BYTE
 
¡©us_»g
);

52 
Com´essÜ
* 
C»©eCom´essÜ
(
Ra¡”Size
);

54 
vœtu®
 
BOOL
 
U£GUIMode
(
PrštMode
* 
pPrštMode
);

55 
DRIVER_ERROR
 
CËªP’
();

57 #ifdeà
APDK_HP_UX


58 
	m´Ùeùed
:

59 
vœtu®
 
DJ8xx
 & 
İ”©Ü
 = (
Prš‹r
& 
rhs
)

61  *
this
;

68 şas 
	cDJ895Mode1
 : 
public
 
PrštMode


70 
public
:

71 
DJ895Mode1
();

75 şas 
	cDJ895Mode2
 : 
public
 
PrštMode


77 
public
:

78 
DJ895Mode2
();

82 şas 
	cDJ895Mode3
 : 
public
 
PrštMode


84 
public
:

85 
DJ895Mode3
();

88 şas 
	cDJ895Mode4
 : 
public
 
G¿yMode


90 
public
:

91 
DJ895Mode4
();

94 #ifdeà
APDK_EXTENDED_MEDIASIZE


96 şas 
	cDJ895Mode5
 : 
public
 
G¿yMode


98 
public
:

99 
DJ895Mode5
();

105 #ià
defšed
(
APDK_DJ8xx
)|| defšed(
APDK_DJ9xx
)

109 şas 
	cDJ8xxProxy
 : 
public
 
Prš‹rProxy


111 
public
:

112 
	$DJ8xxProxy
(è: 
	`Prš‹rProxy
(

119 #ifdeà
APDK_MLC_PRINTER


124 è{
m_iPrš‹rTy³
 = 
eDJ8xx
;}

125 
šlše
 
Prš‹r
* 
	$C»©ePrš‹r
(
Sy¡emS”viûs
* 
pSS
ècÚ¡ {  
Ãw
 
	`DJ8xx
ÕSS); 
	}
}

126 
šlše
 
PRINTER_TYPE
 
	$G‘Prš‹rTy³
(ècÚ¡ {  
eDJ8xx
;
	}
}

127 
šlše
 
	$G‘Mod–B™
(ècÚ¡ {  0x40000;
	}
}

131 
	gAPDK_END_NAMESPACE


	@prnt/hpijs/dj970_maps.cpp

32 
	~"cÚfig.h
"

34 
	~"glob®_ty³s.h
"

36 
	gAPDK_BEGIN_NAMESPACE


38 #ià
defšed
(
APDK_DJ9xx
)

42 
ušt32_t
 
	gulM­GRAY_K_6x6x1
[] =

128 
ušt32_t
 
	gulM­DJ970_KCMY
[ 9*9*9 ]=

254 
ušt32_t
 
	gulM­DJ970_KCMY_3x3x2
[ 9*9*9 ]=

380 
	gAPDK_END_NAMESPACE


	@prnt/hpijs/dj970_maps2.cpp

32 
	~"cÚfig.h
"

34 
	~"glob®_ty³s.h
"

36 
APDK_BEGIN_NAMESPACE


38 
ušt32_t
 
	gulM­DJ970_Gossim”_NÜm®_KCMY
[ 9*9*9 ]=

164 
	gAPDK_END_NAMESPACE


	@prnt/hpijs/dj970_maps3.cpp

32 
	~"cÚfig.h
"

34 
	~"glob®_ty³s.h
"

36 
APDK_BEGIN_NAMESPACE


38 
ušt32_t
 
	gulM­DJ970_D¿á_KCMY
[ 9*9*9 ]=

164 
	gAPDK_END_NAMESPACE


	@prnt/hpijs/dj9xx.cpp

32 #ià
APDK_DJ9xx


34 
	~"h—d”.h
"

35 
	~"io_defs.h
"

36 
	~"dj8xx.h
"

37 
	~"dj9xx.h
"

38 
	~"»sourûs.h
"

39 
	~"´š‹½roxy.h
"

41 
APDK_BEGIN_NAMESPACE


42 
BYTE
* 
G‘HT3x3_4
();

43 
BYTE
* 
G‘HT6x6_4_970
();

44 
APDK_END_NAMESPACE


46 
APDK_BEGIN_NAMESPACE


48 
ušt32_t
 
ulM­DJ970_KCMY
[ 9 * 9 * 9 ];

49 
ušt32_t
 
ulM­DJ970_KCMY_3x3x2
[ 9 * 9 * 9 ];

50 
ušt32_t
 
ulM­DJ970_Gossim”_NÜm®_KCMY
[ 9 * 9 * 9 ];

51 
ušt32_t
 
ulM­DJ600_CCM_K
[ 9 * 9 * 9 ];

52 
ušt32_t
 
ulM­GRAY_K_6x6x1
[9 * 9 * 9];

53 
ušt32_t
 
ulM­DJ970_D¿á_KCMY
[9 * 9 * 9];

55 
AsciiHexToBš¬y
(
BYTE
* 
de¡
, * 
¤c
, 
couÁ
);

57 
	gDJ9xx
::
	$DJ9xx
(
Sy¡emS”viûs
* 
pSS
, 
BOOL
 
´Ùo
)

58 : 
	$Prš‹r
(
pSS
,
NUM_DJ6XX_FONTS
,
´Ùo
)

60 ià(
IOMode
.
bDevID
)

62 
bCheckFÜCªûlBu‰Ú
 = 
TRUE
;

63 
cÚ¡ruùÜ_”rÜ
 = 
	`V”ifyP’Info
();

64 
CERRCHECK
;

66 
eP’
=
BOTH_PENS
;

69 
pMode
[
DEFAULTMODE_INDEX
] = 
Ãw
 
	`DJ970Mode1
();

70 
pMode
[
SPECIALMODE_INDEX
] = 
Ãw
 
	`DJ970Mode2
();

72 #ifdeà
APDK_AUTODUPLEX


78 
bDu¶exC­abË
 = 
TRUE
;

81 #ifdeà
APDK_EXTENDED_MEDIASIZE


82 
pMode
[
GRAYMODE_INDEX
] = 
Ãw
 
	`DJ970Mode3
 ();

83 
pMode
[
SPECIALMODE_INDEX
+1] = 
Ãw
 
	`DJ970Mode4
 ();

84 
pMode
[
SPECIALMODE_INDEX
+2] = 
Ãw
 
	`DJ970Mode5
 ();

85 
pMode
[
SPECIALMODE_INDEX
+3] = 
Ãw
 
	`DJ970ModeP»s
();

86 
pMode
[
SPECIALMODE_INDEX
+4] = 
Ãw
 
	`DJ970ModePhÙoP»s
();

87 
ModeCouÁ
=7;

89 
pMode
[
GRAYMODE_INDEX
] = 
Ãw
 
	`G¿yMode
 (
ulM­DJ600_CCM_K
);

90 
ModeCouÁ
=3;

93 
CMYM­
 = 
ulM­DJ970_KCMY
;

94 
	}
}

96 
	gDJ9xx
::~
	$DJ9xx
()

97 { 
	}
}

99 
DJ970Mode1
::
	$DJ970Mode1
()

100 : 
	$PrštMode
(
ulM­DJ970_KCMY_3x3x2
)

105 
CŞÜD•th
[
K
]=1;

107 
i
=1; i < 4; i++)

108 
CŞÜD•th
[
i
]=2;

110 
ResŞutiÚX
[
K
]=
ResŞutiÚY
[K]=600;

112 
MixedRes
 = 
TRUE
;

113 #ifdeà
APDK_AUTODUPLEX


114 
bDu¶exC­abË
 = 
TRUE
;

117 
CŞÜFEDTabË
 = (
BYTE
*è
HT300x3004Ëv–970_İ’
;

118 
	}
}

120 
	gDJ970Mode2
::
	$DJ970Mode2
()

121 : 
	$PrštMode
(
ulM­DJ970_Gossim”_NÜm®_KCMY
)

125 
i
;

126 
CŞÜD•th
[
K
]=1;

128 
i
=1; i < 4; i++)

129 
CŞÜD•th
[
i
]=2;

131 
i
=0; i < 4; i++)

132 
ResŞutiÚX
[
i
]=
ResŞutiÚY
[i]=600;

134 
Ba£ResX
 = 
Ba£ResY
 = 600;

135 
MixedRes
 = 
FALSE
;

137 
medium
 = 
medŸGlossy
;

139 
CŞÜFEDTabË
 = 
	`G‘HT6x6_4_970
();

142 
bFÚtC­abË
=
FALSE
;

143 #ifdeà
APDK_AUTODUPLEX


144 
bDu¶exC­abË
 = 
FALSE
;

147 
pmQu®™y
 = 
QUALITY_BEST
;

148 
pmMedŸTy³
 = 
MEDIA_PHOTO
;

149 
	}
}

151 #ifdeà
APDK_EXTENDED_MEDIASIZE


152 
	gDJ970Mode3
::
	$DJ970Mode3
 (è: 
	$G¿yMode
 (
ulM­DJ600_CCM_K
)

154 #ifdeà
APDK_AUTODUPLEX


155 
bDu¶exC­abË
 = 
TRUE
;

157 
pmQu®™y
 = 
QUALITY_DRAFT
;

158 
theQu®™y
 = 
qu®™yD¿á
;

159 
	}
}

161 
	gDJ970Mode4
::
	$DJ970Mode4
 (è: 
	$PrštMode
 (
ulM­GRAY_K_6x6x1
)

163 
bFÚtC­abË
 = 
FALSE
;

164 #ifdeà
APDK_AUTODUPLEX


165 
bDu¶exC­abË
 = 
TRUE
;

167 
ResŞutiÚX
[0] =

168 
ResŞutiÚY
[0] = 600;

169 
Ba£ResX
 = 600;

170 
Ba£ResY
 = 600;

171 
Com·tibËP’s
[1] = 
BLACK_PEN
;

172 
pmQu®™y
 = 
QUALITY_NORMAL
;

173 
theQu®™y
 = 
qu®™yNÜm®
;

174 
dyeCouÁ
 = 1;

175 
pmCŞÜ
 = 
GREY_K
;

176 
	}
}

178 
	gDJ970Mode5
::
	$DJ970Mode5
()

179 : 
	$PrštMode
(
ulM­DJ970_D¿á_KCMY
)

183 #ifdeà
APDK_AUTODUPLEX


184 
bDu¶exC­abË
 = 
TRUE
;

186 
pmQu®™y
 = 
QUALITY_DRAFT
;

187 
theQu®™y
 = 
qu®™yD¿á
;

188 
	}
}

192 
	gDJ970ModeP»s
::
	$DJ970ModeP»s
(è: 
	$PrštMode
(
ulM­DJ970_KCMY
)

196 
CŞÜD•th
[
K
]=1;

198 
CŞÜD•th
[
C
]=2;

199 
CŞÜD•th
[
M
]=2;

200 
CŞÜD•th
[
Y
]=2;

202 
ResŞutiÚX
[
K
]=
ResŞutiÚY
[K]=600;

203 
ResŞutiÚX
[
C
]=
ResŞutiÚY
[C]=600;

204 
ResŞutiÚX
[
M
]=
ResŞutiÚY
[M]=600;

205 
ResŞutiÚX
[
Y
]=
ResŞutiÚY
[Y]=600;

207 
Ba£ResX
 = 
Ba£ResY
 = 600;

208 
theQu®™y
 = 
qu®™yP»£Á©iÚ
;

211 
CŞÜFEDTabË
 = (
BYTE
*è
HT600x600x4_P»s970_İ’
;

213 #ifdeà
APDK_AUTODUPLEX


214 
bDu¶exC­abË
 = 
TRUE
;

216 
pmQu®™y
 = 
QUALITY_BEST
;

217 
	}
}

220 
	gDJ970ModePhÙoP»s
::
	$DJ970ModePhÙoP»s
()

221 : 
	$PrštMode
(
ulM­DJ970_Gossim”_NÜm®_KCMY
)

224 
CŞÜD•th
[
K
]=1;

225 
CŞÜD•th
[
C
]=1;

226 
CŞÜD•th
[
M
]=1;

227 
CŞÜD•th
[
Y
]=1;

229 
ResŞutiÚX
[
K
]=
ResŞutiÚY
[K]=1200;

230 
ResŞutiÚX
[
C
]=
ResŞutiÚY
[C]=1200;

231 
ResŞutiÚX
[
M
]=
ResŞutiÚY
[M]=1200;

232 
ResŞutiÚX
[
Y
]=
ResŞutiÚY
[Y]=1200;

234 
Ba£ResX
 = 
Ba£ResY
 = 1200;

236 
medium
 = 
medŸGlossy
;

237 
theQu®™y
 = 
qu®™yP»£Á©iÚ
;

240 
CŞÜFEDTabË
 = (
BYTE
*è
HT1200x1200x1_PhÙoP»s970_İ’
;

242 
bFÚtC­abË
=
FALSE
;

243 
pmQu®™y
 = 
QUALITY_HIGHRES_PHOTO
;

244 
pmMedŸTy³
 = 
MEDIA_PHOTO
;

245 
	}
}

248 
BOOL
 
	gDJ9xx
::
	$U£GUIMode
(
PrštMode
* 
pPrštMode
)

251 ià((!
pPrštMode
->
bFÚtC­abË
)

252 #ifdeà
APDK_AUTODUPLEX


253 || 
pPrštMode
->
	`Qu”yDu¶exMode
 ()

256  
TRUE
;

257  
FALSE
;

258 
	}
}

260 
Com´essÜ
* 
	gDJ9xx
::
	$C»©eCom´essÜ
(
Ra¡”Size
)

262  
Ãw
 
	`Mode2
(
pSS
,
Ra¡”Size
);

263 
	}
}

265 
	gH—d”900
::
	$H—d”900
(
Prš‹r
* 
p
,
PrštCÚ‹xt
* 
pc
)

266 : 
	$H—d”895
(
p
,
pc
)

267 { 
	}
}

269 
H—d”
* 
	gDJ9xx
::
	$S–eùH—d”
(
PrštCÚ‹xt
* 
pc
)

271  
Ãw
 
	`H—d”900
(
this
,
pc
);

272 
	}
}

274 
DRIVER_ERROR
 
	gH—d”900
::
	$S’d
()

276 
DRIVER_ERROR
 
”r
;

279 
	`S¹S’d
();

300 #ifdeà
APDK_AUTODUPLEX


301 ià(
thePrštCÚ‹xt
->
	`Qu”yDu¶exMode
 (è!ğ
DUPLEXMODE_NONE
)

302 
”r
 = 
thePrš‹r
->
	`S’d
 ((cÚ¡ 
BYTE
 *è
EÇbËDu¶ex
,  (EnableDuplex));

305 
”r
 = 
	`CÚfigu»Ra¡”D©a
();

306 
ERRCHECK
;

308 
”r
=
	`G¿phics
();

310  
”r
;

311 
	}
}

313 
BOOL
 
	gH—d”900
::
	$Du¶exEÇbËd
(
BYTE
* 
bDevIDBuff
)

315 * 
pSŒV¡©us
 = 
NULL
;

316 * 
pSŒDu¶ex
 = 
NULL
;

317 * 
pSŒSemicŞÚ
 = 
NULL
;

319 if((
pSŒV¡©us
 = 
	`¡r¡r
((*)
bDevIDBuff
 + 2,"VSTATUS:")))

320 
pSŒV¡©us
 += 8;

322  
FALSE
;

324 
pSŒDu¶ex
 = 
pSŒV¡©us
;

325 
pSŒSemicŞÚ
 = 
pSŒV¡©us
;

328 ià(!(
pSŒSemicŞÚ
 = 
	`¡r¡r
((*)
pSŒV¡©us
,";")))

329  
FALSE
;

331 iàĞ(
pSŒDu¶ex
 = 
	`¡r¡r
((*)
pSŒV¡©us
,"DP")) )

332 if(
pSŒDu¶ex
 < 
pSŒSemicŞÚ
)

333  
TRUE
;

334 iàĞ(
pSŒDu¶ex
 = 
	`¡r¡r
((*)
pSŒV¡©us
,"SM")) )

335 if(
pSŒDu¶ex
 < 
pSŒSemicŞÚ
)

336  
FALSE
;

338 
	`DBG1
("didn't find SM or DP!!\n");

339  
FALSE
;

340 
	}
}

343 
BYTE
 
	gDJ9xx
::
PhÙoT¿yStus


345 
BOOL
 
bQu”yPrš‹r


348 
DRIVER_ERROR
 
”r
;

349 * 
	gpSŒV¡©us
 = 
NULL
;

350 * 
	gpSŒPhÙoT¿y
 = 
NULL
;

351 * 
	gpSŒSemicŞÚ
 = 
NULL
;

353 
BYTE
 
	gbDevIDBuff
[
DevIDBuffSize
];

355 ià(!
	gIOMode
.
	gbDevID
)

357 
	gbQu”yPrš‹r
 = 
FALSE
;

360 
	g”r
=
pSS
->
G‘DeviûID
(
bDevIDBuff
, 
DevIDBuffSize
, 
bQu”yPrš‹r
);

361 ià(
	g”r
!=
NO_ERROR
)

366 if((
	gpSŒV¡©us
 = 
¡r¡r
((*)
bDevIDBuff
 + 2,"VSTATUS:")))

368 
	gpSŒV¡©us
 += 8;

375 
	gpSŒPhÙoT¿y
 = 
pSŒV¡©us
;

376 
	gpSŒSemicŞÚ
 = 
pSŒV¡©us
;

379 ià(!(
	gpSŒSemicŞÚ
 = 
¡r¡r
((*)
pSŒV¡©us
,";")))

384 iàĞ(
	gpSŒPhÙoT¿y
 = 
¡r¡r
((*)
pSŒV¡©us
,"PH")) )

386 if(
	gpSŒPhÙoT¿y
 < 
	gpSŒSemicŞÚ
)

391 iàĞ(
	gpSŒPhÙoT¿y
 = 
¡r¡r
((*)
pSŒV¡©us
,"NR")) )

393 if(
	gpSŒPhÙoT¿y
 < 
	gpSŒSemicŞÚ
)

399 
DBG1
("didn't find PH or NR!!\n");

403 
BOOL
 
	gDJ9xx
::
PhÙoT¿yP»£Á


405 
BOOL
 
bQu”yPrš‹r


409  ((
PhÙoT¿yStus
(
bQu”yPrš‹r
) & 8) == 8);

413 
PHOTOTRAY_STATE
 
	gDJ9xx
::
PhÙoT¿yEngaged


415 
BOOL
 
bQu”yPrš‹r


419  ((
PHOTOTRAY_STATE
è((
PhÙoT¿yStus
(
bQu”yPrš‹r
) & 9) == 9));

423 
PAPER_SIZE
 
	gDJ9xx
::
	$Mªd©ÜyP­”Size
()

425 ià(
	`PhÙoT¿yEngaged
 (
TRUE
))

427  
PHOTO_SIZE
;

431  
UNSUPPORTED_SIZE
;

433 
	}
}

436 
DISPLAY_STATUS
 
	gDJ9xx
::
	$P¬£E¼Ü
(
BYTE
 
¡©us_»g
)

438 
	`DBG1
("DJ9XX,…arsingƒrror info\n");

440 
DRIVER_ERROR
 
”r
 = 
NO_ERROR
;

441 
BYTE
 
DevIDBufãr
[
DevIDBuffSize
];

443 *
pSŒ
;

444 if(
IOMode
.
bDevID
)

448 
”r
 = 
pSS
->
	`G‘DeviûID
 (
DevIDBufãr
, 
DevIDBuffSize
, 
TRUE
);

449 if(
”r
 !ğ
NO_ERROR
)

452  
DISPLAY_COMM_PROBLEM
;

455 iàĞ(
pSŒ
=(*)
	`¡r¡r
((cÚ¡ *)
DevIDBufãr
+2,"VSTATUS:")è=ğ
NULL
 )

457  
DISPLAY_COMM_PROBLEM
;

460 
pSŒ
+=8;

463 ià(
	`¡r¡r
((*)
pSŒ
,"PAJM") || strstr((*)pStr,"PAPS"))

465  
DISPLAY_PAPER_JAMMED
;

469 ià(
	`¡r¡r
((*)
pSŒ
,"CARS"))

471  
DISPLAY_ERROR_TRAP
;

474 ià(
	`¡r¡r
((*)
pSŒ
,"OOPA"))

476 
	`DBG1
("Out of Paper [from Encoded DevID]\n");

477  
DISPLAY_OUT_OF_PAPER
;

481 ià(
	`¡r¡r
((*)
pSŒ
,"CNCL"))

483 
	`DBG1
("Printing Canceled [from Encoded DevID]\n");

484  
DISPLAY_PRINTING_CANCELED
;

487 iàĞ
	`TİCov”O³n
(
¡©us_»g
) )

489 
	`DBG1
("Top Cover Open\n");

490  
DISPLAY_TOP_COVER_OPEN
;

495 
”r
 = 
	`V”ifyP’Info
();

497 if(
”r
 !ğ
NO_ERROR
)

504  
DISPLAY_COMM_PROBLEM
;

508 ià(
IOMode
.
bStus
)

510 iàĞ
	`DEVICE_IS_OOP
(
¡©us_»g
) )

512 
	`DBG1
("Out Of Paper\n");

513  
DISPLAY_OUT_OF_PAPER
;

516 ià(
	`DEVICE_PAPER_JAMMED
(
¡©us_»g
))

518 
	`DBG1
("Paper Jammed\n");

519  
DISPLAY_PAPER_JAMMED
;

521 ià(
	`DEVICE_IO_TRAP
(
¡©us_»g
))

523 
	`DBG1
("IOrap\n");

524  
DISPLAY_ERROR_TRAP
;

530 ià(
pSS
->
	`Prš‹rIsAlive
())

532 
iTÙ®_SLOW_POLL_CouÁ
 +ğ
iMax_SLOW_POLL_CouÁ
;

533 #ià
	`defšed
(
DEBUG
è&& (
DBG_MASK
 & 
DBG_LVL1
)

534 
	`´štf
("iTÙ®_SLOW_POLL_CouÁ = %d\n",
iTÙ®_SLOW_POLL_CouÁ
);

542 ((
IOMode
.
bDevID
 =ğ
FALSE
è&& (
iTÙ®_SLOW_POLL_CouÁ
 >= 60)) ||

543 ((
IOMode
.
bDevID
 =ğ
TRUE
è&& (
iTÙ®_SLOW_POLL_CouÁ
 >= 120))

545  
DISPLAY_BUSY
;

546  
DISPLAY_PRINTING
;

549  
DISPLAY_COMM_PROBLEM
;

550 
	}
}

552 
DRIVER_ERROR
 
	gDJ9xx
::
	$V”ifyP’Info
()

555 
DRIVER_ERROR
 
”r
=
NO_ERROR
;

557 if(
IOMode
.
bDevID
 =ğ
FALSE
)

558  
”r
;

560 
”r
 = 
	`P¬£P’Info
(
eP’
);

562 if(
”r
 =ğ
UNSUPPORTED_PEN
)

564 
	`DBG1
("DJ9xx::Needo do‡ POWER ONo get…enIDs\n");

567 ià(
pSS
->
	`BusyWa™
((
DWORD
)2000è=ğ
JOB_CANCELED
)

568  
JOB_CANCELED
;

570 
DWORD
 
Ëngth
=(
DJ895_Pow”_On
);

571 
”r
 = 
pSS
->
	`ToDeviû
(
DJ895_Pow”_On
,&
Ëngth
);

572 
ERRCHECK
;

574 
”r
 = 
pSS
->
	`FlushIO
();

575 
ERRCHECK
;

578 ià(
pSS
->
	`BusyWa™
 ((
DWORD
è2500è=ğ
JOB_CANCELED
)

579  
JOB_CANCELED
;

581 
”r
 = 
	`P¬£P’Info
(
eP’
);

584 
ERRCHECK
;

587 ià(
eP’
 =ğ
BOTH_PENS
)

588  
NO_ERROR
;

590  
eP’
 !ğ
BOTH_PENS
 )

593 
eP’
)

595 
BLACK_PEN
:

597 
pSS
->
	`Di¥ÏyPrš‹rStus
(
DISPLAY_NO_COLOR_PEN
);

599 
COLOR_PEN
:

601 
pSS
->
	`Di¥ÏyPrš‹rStus
(
DISPLAY_NO_BLACK_PEN
);

603 
NO_PEN
:

606 
pSS
->
	`Di¥ÏyPrš‹rStus
(
DISPLAY_NO_PENS
);

610 ià(
pSS
->
	`BusyWa™
(500è=ğ
JOB_CANCELED
)

611  
JOB_CANCELED
;

613 
”r
 = 
	`P¬£P’Info
(
eP’
);

614 
ERRCHECK
;

617 
pSS
->
	`Di¥ÏyPrš‹rStus
(
DISPLAY_PRINTING
);

619  
NO_ERROR
;

621 
	}
}

623 
DRIVER_ERROR
 
	gDJ9xx
::
	$P¬£P’Info
(
PEN_TYPE
& 
eP’
, 
BOOL
 
Qu”yPrš‹r
)

625 *
¡r
;

626 
DRIVER_ERROR
 
”r
 = 
	`S‘P’Info
 (
¡r
, 
Qu”yPrš‹r
);

627 
ERRCHECK
;

629 ià(*
¡r
 != '$')

632 
num_³ns
 = 0;

633 
PEN_TYPE
 
‹mp_³n1
 = 
NO_PEN
;

634 
BYTE
 
³nInfoB™s
[4];

635 
iNumMissšgP’s
 = 0;

638 ià((
¡r
[0] >= '0') && (str[0] <= '9'))

640 
num_³ns
 = 
¡r
[0] - '0';

642 ià((
¡r
[0] >= 'A') && (str[0] <= 'F'))

644 
num_³ns
 = 10 + (
¡r
[0] - 'A');

648  
BAD_DEVICE_ID
;

651 ià((è
	`¡¾’
 (
¡r
è< (
num_³ns
 * 8))

653  
BAD_DEVICE_ID
;

658 ià(
pSS
->
	`G‘VIPV”siÚ
 () == 1)

660 ià(
num_³ns
 < 2)

662  
UNSUPPORTED_PEN
;

666 
	`AsciiHexToBš¬y
(
³nInfoB™s
, 
¡r
+1, 4);

667 
³nInfoB™s
[1] &= 0xf8;

669 ià((
³nInfoB™s
[0] == 0xc1) && (penInfoBits[1] == 0x10))

671 
‹mp_³n1
 = 
BLACK_PEN
;

673 ià(
³nInfoB™s
[0] == 0xc0)

675 
‹mp_³n1
 = 
NO_PEN
;

676 
iNumMissšgP’s
 = 1;

680  
UNSUPPORTED_PEN
;

684 
	`AsciiHexToBš¬y
(
³nInfoB™s
, 
¡r
+9, 4);

685 
³nInfoB™s
[1] &= 0xf8;

687 ià((
³nInfoB™s
[0] == 0xc2) && (penInfoBits[1] == 0x08))

689 ià(
‹mp_³n1
 =ğ
BLACK_PEN
)

691 
eP’
 = 
BOTH_PENS
;

695 
eP’
 = 
COLOR_PEN
;

698 ià(
³nInfoB™s
[0] == 0xc0)

700 
eP’
 = 
‹mp_³n1
;

701 
iNumMissšgP’s
 = 1;

705  
UNSUPPORTED_PEN
;

708  
NO_ERROR
;

713 ià(*(
¡r
 - 1) == '1' && *(str - 2) == '1')

715  
UNSUPPORTED_PEN
;

718 *
p
 = 
¡r
 + 1;

719 
BYTE
 
³nCŞÜ
;

721 
eP’
 = 
NO_PEN
;

723 
i
 = 0; i < 
num_³ns
; i++, 
p
 += 8)

725 
	`AsciiHexToBš¬y
 (
³nInfoB™s
, 
p
, 8);

727 ià((
³nInfoB™s
[1] & 0xf8) == 0xf8)

733  
UNSUPPORTED_PEN
;

736 ià((
³nInfoB™s
[0] & 0x80) != 0x80)

740 
³nCŞÜ
 = 
³nInfoB™s
[0] & 0x3F;

741 
³nCŞÜ
)

745 
iNumMissšgP’s
++;

749 
eP’
 = 
BLACK_PEN
;

753 ià(
eP’
 =ğ
BLACK_PEN
)

755 
eP’
 = 
BOTH_PENS
;

759 
eP’
 = 
COLOR_PEN
;

769 ià(
eP’
 =ğ
BLACK_PEN
 ||ƒP’ =ğ
BOTH_PENS
)

771 
eP’
 = 
BOTH_PENS
;

775 
eP’
 = 
COLOR_PEN
;

779 
eP’
 = 
UNKNOWN_PEN
;

782  
NO_ERROR
;

786 
PEN_TYPE
 
‹mp_³n1
;

788 
¡r
[1])

793 
‹mp_³n1
 = 
BLACK_PEN
;

795 'X':  
UNSUPPORTED_PEN
;

796 : 
‹mp_³n1
 = 
NO_PEN
; ;

801 
i
 = 2;

802 (
i
 < 
DevIDBuffSize
è&& 
¡r
[i]!='$') i++;

803 ià(
i
 =ğ
DevIDBuffSize
)

805  
BAD_DEVICE_ID
;

808 
i
++;

814 if(
¡r
[
i
]!='X' && str[i]!='A' && str[i]!='M')

817 ià(
‹mp_³n1
 =ğ
BLACK_PEN
)

818 
eP’
 = 
BOTH_PENS
;

821 
eP’
 = 
COLOR_PEN
;

825 
eP’
 = 
‹mp_³n1
;

827  
NO_ERROR
;

828 
	}
}

830 #ià
defšed
(
APDK_FONTS_NEEDED
)

831 
FÚt
* 
	gDJ9xx
::
	$R—lizeFÚt
(cÚ¡ 
šdex
,cÚ¡ 
BYTE
 
bSize
,

832 cÚ¡ 
TEXTCOLOR
 
eCŞÜ
,

833 cÚ¡ 
BOOL
 
bBŞd
,cÚ¡ BOOL 
bIlic
,

834 cÚ¡ 
BOOL
 
bUnd”lše
)

838  
Prš‹r
::
	`R—lizeFÚt
(
šdex
,
bSize
,
eCŞÜ
,
bBŞd
,
bIlic
,
bUnd”lše
);

839 
	}
}

842 
DRIVER_ERROR
 
	gDJ9xx
::
	$CËªP’
()

844 cÚ¡ 
BYTE
 
DJ970_U£r_Ouut_Page
[] = {
ESC
, '%','P','u','i','f','p','.',

846 'u','d','w','.','q','u','i','t',';',
ESC
,'%','-','1','2','3','4','5','X' };

848 
DWORD
 
Ëngth
 = (
PEN_CLEAN_PML
);

849 
DRIVER_ERROR
 
”r
 = 
pSS
->
	`ToDeviû
(
PEN_CLEAN_PML
, &
Ëngth
);

850 
ERRCHECK
;

854 
Ëngth
 = (
DJ970_U£r_Ouut_Page
);

855  
pSS
->
	`ToDeviû
(
DJ970_U£r_Ouut_Page
, &
Ëngth
);

856 
	}
}

858 
	gAPDK_END_NAMESPACE


	@prnt/hpijs/dj9xx.h

32 #iâdeà
APDK_DJ9XX_H


33 
	#APDK_DJ9XX_H


	)

35 
APDK_BEGIN_NAMESPACE


42 şas 
	cDJ9xx
 : 
public
 
Prš‹r


44 
public
:

45 
DJ9xx
(
Sy¡emS”viûs
* 
pSS
, 
BOOL
 
´Ùo
=
FALSE
);

47 
	mvœtu®
 ~
DJ9xx
();

49 
BOOL
 
U£GUIMode
(
PrštMode
* 
pPrštMode
);

50 
H—d”
* 
S–eùH—d”
(
PrštCÚ‹xt
* 
pc
);

51 
Com´essÜ
* 
C»©eCom´essÜ
(
Ra¡”Size
);

52 
DISPLAY_STATUS
 
P¬£E¼Ü
(
BYTE
 
¡©us_»g
);

53 
DRIVER_ERROR
 
V”ifyP’Info
();

55 #ià
	$defšed
(
APDK_FONTS_NEEDED
)

56 
FÚt
* 
	`R—lizeFÚt
(cÚ¡ 
šdex
,cÚ¡ 
BYTE
 
bSize
,

57 cÚ¡ 
TEXTCOLOR
 
eCŞÜ
=
BLACK_TEXT
,

58 cÚ¡ 
BOOL
 
bBŞd
=
FALSE
,cÚ¡ BOOL 
bIlic
=FALSE,

59 cÚ¡ 
BOOL
 
bUnd”lše
=
FALSE
);

62 
vœtu®
 
DRIVER_ERROR
 
	`P¬£P’Info
(
PEN_TYPE
& 
eP’
, 
BOOL
 
Qu”yPrš‹r
=
TRUE
);

64 
PAPER_SIZE
 
	`Mªd©ÜyP­”Size
();

66 
DRIVER_ERROR
 
	`CËªP’
();

68 
vœtu®
 
BOOL
 
	`PhÙoT¿yP»£Á
(BOOL 
bQu”yPrš‹r
);

70 
vœtu®
 
PHOTOTRAY_STATE
 
	`PhÙoT¿yEngaged
 (
BOOL
 
bQu”yPrš‹r
);

71 
šlše
 
vœtu®
 
BOOL
 
	$SuµÜtS•¬©eBÏck
 (
PrštMode
 *
pCu¼’tMode
)

73 ià(
pCu¼’tMode
->
medium
 !ğ
medŸPÏš
)

75  
FALSE
;

77  
TRUE
;

80 
´Ùeùed
:

82 #ifdeà
APDK_HP_UX


83 
vœtu®
 
DJ9xx
 & 
İ”©Ü
 = (
Prš‹r
& 
rhs
)

85  *
this
;

86 
	}
}

89 
vœtu®
 
BYTE
 
PhÙoT¿yStus
(
BOOL
 
bQu”yPrš‹r
);

94 şas 
	cDJ970Mode1
 : 
public
 
PrštMode


96 
public
:

97 
DJ970Mode1
();

101 şas 
	cDJ970Mode2
 : 
public
 
PrštMode


103 
public
:

104 
DJ970Mode2
();

108 #ifdeà
APDK_EXTENDED_MEDIASIZE


110 şas 
	cDJ970Mode3
 : 
public
 
G¿yMode


112 
public
:

113 
DJ970Mode3
 ();

116 şas 
	cDJ970Mode4
 : 
public
 
PrštMode


118 
public
:

119 
DJ970Mode4
 ();

122 şas 
	cDJ970Mode5
 : 
public
 
PrštMode


124 
public
:

125 
DJ970Mode5
 ();

128 şas 
	cDJ970ModeP»s
 : 
public
 
PrštMode


130 
public
:

131 
DJ970ModeP»s
();

135 şas 
	cDJ970ModePhÙoP»s
 : 
public
 
PrštMode


137 
public
:

138 
DJ970ModePhÙoP»s
();

144 #ifdeà
APDK_DJ9xx


148 şas 
	cDJ9xxProxy
 : 
public
 
Prš‹rProxy


150 
public
:

151 
	$DJ9xxProxy
(è: 
	`Prš‹rProxy
(

170 #ifdeà
APDK_MLC_PRINTER


179 è{
m_iPrš‹rTy³
 = 
eDJ9xx
;}

180 
šlše
 
Prš‹r
* 
	$C»©ePrš‹r
(
Sy¡emS”viûs
* 
pSS
ècÚ¡ {  
Ãw
 
	`DJ9xx
ÕSS); 
	}
}

181 
šlše
 
PRINTER_TYPE
 
	$G‘Prš‹rTy³
(ècÚ¡ {  
eDJ9xx
;
	}
}

182 
šlše
 
	$G‘Mod–B™
(ècÚ¡ {  0x20000;
	}
}

186 
	gAPDK_END_NAMESPACE


	@prnt/hpijs/dj9xxvip.cpp

32 #ifdeà
APDK_DJ9xxVIP


34 
	~"h—d”.h
"

35 
	~"io_defs.h
"

36 
	~"dj9xxv.h
"

37 
	~"´š‹½roxy.h
"

39 
	gAPDK_BEGIN_NAMESPACE


42 
	#OUR_PJL_JOBNAME
 "_PJL_pjl_PJL_pjl_"

43 
	#DRIVERWARE_JOBNAME
 "NEWDRIVERWARE"

44 

	)

45 
ušt32_t
 
ulM­DJ600_CCM_K
[ 9 * 9 * 9 ];

47 cÚ¡ 
	gG¿ysÿËSeq
[]ğ{
ESC
, '*', 'o', '5', 'W', 0x0B, 0x01, 0x00, 0x00, 0x02};

49 cÚ¡ 
BYTE
 
	gExŒaDryTime
[] = "\033&b16WPML \004\000\006\001\004\001\004\001\006\010\001";

51 
BYTE
 
EscAm¶Cİy
(BYTE *
de¡
, 
num
, 
’d
);

52 
AsciiHexToBš¬y
(
BYTE
* 
de¡
, * 
¤c
, 
couÁ
);

53 
MedŸTy³
 
MedŸTy³ToPş
 (
MEDIATYPE
 
eMedŸTy³
);

55 
	gDJ9xxVIP
::
DJ9xxVIP


57 
Sy¡emS”viûs
* 
pSS
,

58 
BOOL
 
	g´Ùo


60 
Prš‹r
(
pSS
, 
NUM_DJ6XX_FONTS
, 
´Ùo
),

61 
	$PCL3acû±sDriv”w¬e
(
TRUE
)

64 
m_bVIPPrš‹r
 = 
TRUE
;

66 ià(!
´Ùo
 && 
IOMode
.
bDevID
)

68 
bCheckFÜCªûlBu‰Ú
 = 
TRUE
;

69 
cÚ¡ruùÜ_”rÜ
 = 
	`V”ifyP’Info
();

70 
CERRCHECK
;

72 
eP’
 = 
BOTH_PENS
;

74 
PCL3acû±sDriv”w¬e
 = 
	`IsPCL3Driv”w¬eAvaabË
();

76 
ModeCouÁ
 = 0;

77 
pMode
[
ModeCouÁ
++] = 
Ãw
 
	`G¿yModeDJ990
(
ulM­DJ600_CCM_K
,
PCL3acû±sDriv”w¬e
);

78 
pMode
[
ModeCouÁ
++] = 
Ãw
 
	`DJ990Mode
();

79 
pMode
[
ModeCouÁ
++] = 
Ãw
 
	`DJ990CMYG¿yMode
();

81 #ifdeà
APDK_AUTODUPLEX


88 
bDu¶exC­abË
 = 
TRUE
;

91 #ifdeà
APDK_EXTENDED_MEDIASIZE


92 
pMode
[
ModeCouÁ
++] = 
Ãw
 
	`DJ990KG¿yMode
 ();

93 
pMode
[
ModeCouÁ
++] = 
Ãw
 
	`DJ9902400Mode
 ();

94 
pMode
[
ModeCouÁ
++] = 
Ãw
 
	`DJ990D¿áMode
 ();

96 
pMode
[
ModeCouÁ
++] = 
Ãw
 
	`DJ990Be¡Mode
 ();

97 
pMode
[
ModeCouÁ
++] = 
Ãw
 
	`DJ990PhÙoNÜm®Mode
 ();

99 
m_cExŒaDryTime
 = 0;

100 
m_iLeáOv”¥¿y
 = 0;

101 
m_iTİOv”¥¿y
 = 0;

102 
m_iRightOv”¥¿y
 = 0;

103 
m_iBÙtomOv”¥¿y
 = 0;

104 
	}
}

106 
	gG¿yModeDJ990
::
G¿yModeDJ990


108 
ušt32_t
 *
m­
,

109 
BOOL
 
	gPCL3OK


111 
	$G¿yMode
(
m­
)

113 #ià
	`defšed
(
APDK_VIP_COLORFILTERING
)

114 
CÚfig
.
bEº›
 = 
TRUE
;

117 
CÚfig
.
bCŞÜImage
=
FALSE
;

119 ià(!
PCL3OK
)

121 
bFÚtC­abË
 = 
FALSE
;

124 #ifdeà
APDK_AUTODUPLEX


125 
bDu¶exC­abË
 = 
TRUE
;

127 #ifdeà
APDK_EXTENDED_MEDIASIZE


128 
theQu®™y
 = 
qu®™yD¿á
;

129 
pmQu®™y
 = 
QUALITY_DRAFT
;

131 
	}
}

133 
	gDJ990Mode
::
	$DJ990Mode
()

134 : 
	$PrštMode
(
NULL
)

147 
Ba£ResX
 = 
Ba£ResY
 = 
TextRes
 = 
ResŞutiÚX
[0] = 
ResŞutiÚY
[0] = 
VIP_BASE_RES
;

149 
medium
 = 
medŸAuto
;

151 #ià
	`defšed
(
APDK_VIP_COLORFILTERING
)

152 
CÚfig
.
bEº›
 = 
TRUE
;

155 
CÚfig
.
bCŞÜImage
 = 
FALSE
;

157 #ifdeà
APDK_AUTODUPLEX


158 
bDu¶exC­abË
 = 
TRUE
;

160 
	}
}

163 
	gDJ990CMYG¿yMode
::
	$DJ990CMYG¿yMode
()

164 : 
	$PrštMode
(
NULL
)

171 
Ba£ResX
 = 
Ba£ResY
 = 
TextRes
 = 
ResŞutiÚX
[0] = 
ResŞutiÚY
[0] = 
VIP_BASE_RES
;

173 
medium
 = 
medŸAuto
;

175 #ià
	`defšed
(
APDK_VIP_COLORFILTERING
)

176 
CÚfig
.
bEº›
 = 
TRUE
;

179 
CÚfig
.
bCŞÜImage
 = 
FALSE
;

181 #ifdeà
APDK_AUTODUPLEX


182 
bDu¶exC­abË
 = 
TRUE
;

184 
pmCŞÜ
 = 
GREY_CMY
;

185 
bFÚtC­abË
 = 
FALSE
;

186 
	}
}

188 #ifdeà
APDK_EXTENDED_MEDIASIZE


189 
	gDJ990KG¿yMode
::
	$DJ990KG¿yMode
 (è: 
	$PrštMode
 (
NULL
)

196 
Ba£ResX
 = 
Ba£ResY
 = 
ResŞutiÚX
[0] = 
ResŞutiÚY
[0] = 
VIP_BASE_RES
;

197 
medium
 = 
medŸPÏš
;

198 #ià
	`defšed
(
APDK_VIP_COLORFILTERING
)

199 
CÚfig
.
bEº›
 = 
TRUE
;

202 
CÚfig
.
bCŞÜImage
 = 
FALSE
;

204 #ifdeà
APDK_AUTODUPLEX


205 
bDu¶exC­abË
 = 
TRUE
;

207 
pmCŞÜ
 = 
GREY_K
;

208 
bFÚtC­abË
 = 
FALSE
;

209 
dyeCouÁ
 = 1;

210 
	}
}

212 
	gDJ9902400Mode
::
	$DJ9902400Mode
 (è: 
	$PrštMode
 (
NULL
)

214 
Ba£ResX
 =

215 
Ba£ResY
 = 1200;

216 
ResŞutiÚX
[0] = 1200;

217 
ResŞutiÚY
[0] = 1200;

218 
bFÚtC­abË
 = 
FALSE
;

219 #ifdeà
APDK_AUTODUPLEX


220 
bDu¶exC­abË
 = 
FALSE
;

222 #ià
	`defšed
(
APDK_VIP_COLORFILTERING
)

223 
CÚfig
.
bEº›
 = 
TRUE
;

226 
CÚfig
.
bCŞÜImage
 = 
FALSE
;

228 
medium
 = 
medŸHigh»sPhÙo
;

229 
theQu®™y
 = 
qu®™yP»£Á©iÚ
;

230 
pmMedŸTy³
 = 
MEDIA_PHOTO
;

231 
pmQu®™y
 = 
QUALITY_HIGHRES_PHOTO
;

232 
	}
}

234 
	gDJ990D¿áMode
::
	$DJ990D¿áMode
 (è: 
	$PrštMode
 (
NULL
)

236 
bFÚtC­abË
 = 
FALSE
;

237 #ifdeà
APDK_AUTODUPLEX


238 
bDu¶exC­abË
 = 
TRUE
;

240 #ià
	`defšed
(
APDK_VIP_COLORFILTERING
)

241 
CÚfig
.
bEº›
 = 
TRUE
;

244 
CÚfig
.
bCŞÜImage
 = 
FALSE
;

246 
medium
 = 
medŸAuto
;

247 
theQu®™y
 = 
qu®™yD¿á
;

248 
pmQu®™y
 = 
QUALITY_DRAFT
;

249 
	}
}

258 
	gDJ990Be¡Mode
::
	$DJ990Be¡Mode
 (è: 
	$PrštMode
 (
NULL
)

260 
Ba£ResX
 = 
Ba£ResY
 = 
ResŞutiÚX
[0] = 
ResŞutiÚY
[0] = 
VIP_BASE_RES
;

262 
bFÚtC­abË
 = 
FALSE
;

264 #ifdeà 
APDK_AUTODUPLEX


265 
bDu¶exC­abË
 = 
TRUE
;

268 #ià
	`defšed
(
APDK_VIP_COLORFILTERING
)

269 
CÚfig
.
bEº›
 = 
TRUE
;

272 
CÚfig
.
bCŞÜImage
 = 
FALSE
;

274 
medium
 = 
medŸGlossy
;

275 
theQu®™y
 = 
qu®™yP»£Á©iÚ
;

276 
pmQu®™y
 = 
QUALITY_BEST
;

277 
pmMedŸTy³
 = 
MEDIA_PHOTO
;

278 
	}
}

280 
	gDJ990PhÙoNÜm®Mode
::
	$DJ990PhÙoNÜm®Mode
 (è: 
	$PrštMode
 (
NULL
)

282 
Ba£ResX
 = 
Ba£ResY
 = 
ResŞutiÚX
[0] = 
ResŞutiÚY
[0] = 
VIP_BASE_RES
;

284 
bFÚtC­abË
 = 
FALSE
;

286 #ifdeà 
APDK_AUTODUPLEX


287 
bDu¶exC­abË
 = 
TRUE
;

290 #ià
	`defšed
(
APDK_VIP_COLORFILTERING
)

291 
CÚfig
.
bEº›
 = 
TRUE
;

294 
CÚfig
.
bCŞÜImage
 = 
FALSE
;

296 
medium
 = 
medŸGlossy
;

297 
theQu®™y
 = 
qu®™yNÜm®
;

298 
pmQu®™y
 = 
QUALITY_NORMAL
;

299 
pmMedŸTy³
 = 
MEDIA_PHOTO
;

300 
	}
}

302 
BOOL
 
	gDJ9xxVIP
::
U£GUIMode


304 
PrštMode
* 
pPrštMode


311  
TRUE
;

335 
DRIVER_ERROR
 
	gDJ9xxVIP
::
	$AddPJLH—d”
 ()

337 *
szPJLBufãr
 = 
NULL
;

338 
DRIVER_ERROR
 
”r
 = 
NO_ERROR
;

339 
iPJLBufãrSize
;

340 ià(((
iPJLBufãrSize
 = 
pSS
->
	`G‘PJLH—d”Bufãr
 (&
szPJLBufãr
)è> 0è&& (szPJLBufã¸!ğ
NULL
))

342 
”r
 = 
	`S’d
 ((cÚ¡ 
BYTE
 *è
szPJLBufãr
, 
iPJLBufãrSize
);

344  
”r
;

345 
	}
}

347 
	gMode10
::
Mode10


349 
Sy¡emS”viûs
* 
pSys
,

350 
Prš‹r
* 
	gpPrš‹r
,

351 
	gPÏÃSize


353 
Com´essÜ
(
pSys
, 
PÏÃSize
, 
TRUE
),

354 
	$thePrš‹r
(
pPrš‹r
)

356 ià(
cÚ¡ruùÜ_”rÜ
 !ğ
NO_ERROR
)

362 
com´essBuf
 = (
BYTE
*)
pSS
->
	`AÎocMem
(
PÏÃSize
 + PlaneSize/2);

363 ià(
com´essBuf
 =ğ
NULL
)

364 
cÚ¡ruùÜ_”rÜ
=
ALLOCMEM_ERROR
;

366 
	`mem£t
(
S“dRow
,0xFF,
PÏÃSize
);

367 
	}
}

370 
	gMode10
::~
	$Mode10
()

371 { 
	}
}

374 cÚ¡ 
BYTE
 
Re£tS“drow
[]={
ESC
,'*','b','0','Y'};

376 
	gMode10
::
	$Flush
()

382 ià(!
£eded
)

386 
com´es£dsize
=0;

388 
iRa¡”sR—dy
 = 0;

389 
£eded
 = 
FALSE
;

390 
	`mem£t
(
S“dRow
,0xFF,
šputsize
);

391 
thePrš‹r
->
	`S’d
(
Re£tS“drow
, (ResetSeedrow));

392 
	}
}

395 
Com´essÜ
* 
	gDJ9xxVIP
::
	$C»©eCom´essÜ
(
Ra¡”Size
)

397  
Ãw
 
	`Mode10
(
pSS
,
this
,
Ra¡”Size
);

398 
	}
}

401 
H—d”
* 
	gDJ9xxVIP
::
	$S–eùH—d”
(
PrštCÚ‹xt
* 
pc
)

403  
Ãw
 
	`H—d”DJ990
(
this
,
pc
);

404 
	}
}

407 
	gH—d”DJ990
::
	$H—d”DJ990
(
Prš‹r
* 
p
,
PrštCÚ‹xt
* 
pc
)

408 : 
	$H—d”
(
p
,
pc
)

410 
	`S‘MedŸSourû
 (
pc
->
	`G‘MedŸSourû
());

411 
	}
}

414 
DRIVER_ERROR
 
	gH—d”DJ990
::
	$CÚfigu»Ra¡”D©a
()

420 
buff
[50];

421 *
out
 = 
buff
;

425 
	`memıy
(
out
,
üdS¹
,(crdStart) );

426 
out
 +ğ(
üdS¹
);

432 *
out
++ = 0x32;

433 *
out
++ = 0x30;

434 *
out
++ = 'W';

436 
	#VIPüdFÜm©
 6

	)

437 
	#VIPKRGBID
 0x1F

	)

439 *
out
++ = 
VIPüdFÜm©
;

440 *
out
++ = 
VIPKRGBID
;

444 *
out
++ = 0;

445 *
out
++ = 2;

447 *
out
++ = 
ResŞutiÚX
[0]/256;

448 *
out
++ = 
ResŞutiÚX
[0]%256;

449 *
out
++ = 
ResŞutiÚY
[0]/256;

450 *
out
++ = 
ResŞutiÚY
[0]%256;

453 *
out
++ = 9;

456 *
out
++ = 0;

459 *
out
++ = 1;

462 *
out
++ = 1;

464 *
out
++ = 
ResŞutiÚX
[0]/256;

465 *
out
++ = 
ResŞutiÚX
[0]%256;

466 *
out
++ = 
ResŞutiÚY
[0]/256;

467 *
out
++ = 
ResŞutiÚY
[0]%256;

470 *
out
++ = 10;

473 *
out
++ = 1;

476 *
out
++ = 32;

479 *
out
++ = 1;

481  
thePrš‹r
->
	`S’d
((cÚ¡ 
BYTE
*è
buff
, 
out
-buff);

482 
	}
}

485 
DRIVER_ERROR
 
	gH—d”DJ990
::
	$CÚfigu»ImageD©a
()

487 
DRIVER_ERROR
 
”r
 = 
thePrš‹r
->
	`S’d
((cÚ¡ 
BYTE
*)
cidS¹
, (cidStart));

488 
ERRCHECK
;

489 
siz”
[3];

490 
	`¥rštf
(
siz”
,"%dW",6);

491 
”r
 = 
thePrš‹r
->
	`S’d
((cÚ¡ 
BYTE
*)
siz”
,2);

492 
ERRCHECK
;

494 
BYTE
 
cŞÜ¥aû
 = 2;

495 
BYTE
 
codšg
 = 3;

496 
BYTE
 
b™sšdex
 = 3;

497 
BYTE
 
b™¥rim¬y
 = 8;

498 
BYTE
 
CID
[6];

499 
CID
[0] = 
cŞÜ¥aû
;

500 
CID
[1]=
codšg
;

501 
CID
[2] = 
b™sšdex
;

502 
CID
[3] = CID[4] = CID[5] = 
b™¥rim¬y
;

504  
thePrš‹r
->
	`S’d
((cÚ¡ 
BYTE
*è
CID
, 6);

505 
	}
}

508 
DRIVER_ERROR
 
	gH—d”DJ990
::
	$S’d
()

511 
DRIVER_ERROR
 
”r
;

513 
COLORMODE
 
eCŞÜMode
 = 
COLOR
;

514 
MEDIATYPE
 
eMedŸTy³
;

515 
QUALITY_MODE
 
eQu®™yMode
;

516 
BOOL
 
bDeviûText
;

518 
thePrštCÚ‹xt
->
	`G‘PrštModeS‘tšgs
 (
eQu®™yMode
, 
eMedŸTy³
, 
eCŞÜMode
, 
bDeviûText
);

520 ià(
eMedŸTy³
 =ğ
MEDIA_CDDVD
)

522 
thePrštCÚ‹xt
->
	`S‘MedŸSourû
 (
sourûT¿yCDDVD
);

523 
	`S‘MedŸSourû
 (
sourûT¿yCDDVD
);

526 
	`S¹S’d
();

528 #ifdeà
APDK_AUTODUPLEX


529 ià(
thePrštCÚ‹xt
->
	`Qu”yDu¶exMode
 (è!ğ
DUPLEXMODE_NONE
)

531 
”r
 = 
thePrš‹r
->
	`S’d
 ((cÚ¡ 
BYTE
 *è
EÇbËDu¶ex
,  (EnableDuplex));

532 
BYTE
 
cDryTime
;

533 
cDryTime
 = (
BYTE
è((
thePrš‹r
->
	`G‘Hšt
 (
EXTRA_DRYTIME_HINT
)) & 0xFF);

534 ià(
cDryTime
 != 0)

536 
”r
 = 
thePrš‹r
->
	`S’d
 (
ExŒaDryTime
,  (ExtraDryTime) - 1);

537 
”r
 = 
thePrš‹r
->
	`S’d
 ((cÚ¡ 
BYTE
 *è&
cDryTime
, 1);

538 
ERRCHECK
;

543 
”r
 = 
	`CÚfigu»ImageD©a
();

544 
ERRCHECK
;

546 
”r
 = 
	`CÚfigu»Ra¡”D©a
();

547 
ERRCHECK
;

549 ià(
thePrštMode
->
dyeCouÁ
 == 1)

551 
”r
=
thePrš‹r
->
	`S’d
((cÚ¡ 
BYTE
*)
G¿ysÿËSeq
, (GrayscaleSeq) );

552 
ERRCHECK
;

556 ià(
eCŞÜMode
 =ğ
GREY_CMY
)

558 
pSŒ
[12];

559 
	`memıy
 (
pSŒ
, 
G¿ysÿËSeq
, 10);

560 
pSŒ
[9] = 0x01;

561 
”r
 = 
thePrš‹r
->
	`S’d
 ((cÚ¡ 
BYTE
 *è
pSŒ
, 10);

567 
uom
[10];

568 
	`¥rštf
(
uom
,"%c%c%c%d%c",
ESC
,'&','u',
thePrštMode
->
ResŞutiÚX
[
K
],'D');

569 
”r
 = 
thePrš‹r
->
	`S’d
((cÚ¡ 
BYTE
*)
uom
, 
	`¡¾’
 (uom));

570 
ERRCHECK
;

573 
width
=
thePrštCÚ‹xt
->
	`OuutPix–sP”Row
();

574 
dig™s
 = 1;

575 
x
 = 
width
;

576 
x
 > 10)

578 
dig™s
++;

579 
x
 = x / 10;

581 
	`¥rštf
(
uom
,"%c%c%c%d%c",
ESC
,'*','r', 
width
,'S');

582 
”r
 = 
thePrš‹r
->
	`S’d
((cÚ¡ 
BYTE
*)
uom
, 4 + 
dig™s
 );

583 
ERRCHECK
;

591 ià(
thePrštCÚ‹xt
->
theP­”Size
 =ğ
CUSTOM_SIZE
)

593 
BYTE
 
szSŒ
[32];

594 
sWidth
, 
sHeight
;

595 
BYTE
 
b1
, 
b2
;

596 
sWidth
 = (è(
thePrštCÚ‹xt
->
	`PhysiÿlPageSizeX
 (è*hePrštCÚ‹xt->
	`EfãùiveResŞutiÚX
 ());

597 
sHeight
 = (è(
thePrštCÚ‹xt
->
	`PhysiÿlPageSizeY
 (è*hePrštCÚ‹xt->
	`EfãùiveResŞutiÚY
 ());

598 
	`memıy
 (
szSŒ
, "\x1B*o5W\x0E\x05\x00\x00\x00\x1B*o5W\x0E\x06\x00\x00\x00", 20);

599 
b1
 = (
BYTE
è((
sWidth
 & 0xFF00) >> 8);

600 
b2
 = (
BYTE
è(
sWidth
 & 0xFF);

601 
szSŒ
[8] = 
b1
;

602 
szSŒ
[9] = 
b2
;

603 
b1
 = (
BYTE
è((
sHeight
 & 0xFF00) >> 8);

604 
b2
 = (
BYTE
è(
sHeight
 & 0xFF);

605 
szSŒ
[18] = 
b1
;

606 
szSŒ
[19] = 
b2
;

607 
”r
 = 
thePrš‹r
->
	`S’d
 ((cÚ¡ 
BYTE
 *è
szSŒ
, 20);

610 
fXOv”S´ay
 = 0.0;

611 
fYOv”S´ay
 = 0.0;

612 
fLeáOv”S´ay
 = 0.0;

613 
fTİOv”S´ay
 = 0.0;

614 
FuÎbËedTy³
 
fbTy³
;

615 ià(
thePrštCÚ‹xt
->
bDoFuÎBËed
 &&

616 
thePrš‹r
->
	`FuÎBËedC­abË
 (
thePrštCÚ‹xt
->
theP­”Size
,

617 &
fbTy³
,

618 &
fXOv”S´ay
, &
fYOv”S´ay
,

619 &
fLeáOv”S´ay
, &
fTİOv”S´ay
))

631 
BYTE
 
cBuf
[4];

632 
BYTE
 
TİOv”S´aySeq
[] = {0x1b, 0x2A, 0x6F, 0x35, 0x57, 0x0E, 0x02, 0x00};

635 
BYTE
 
LeáOv”S´aySeq
[] = {0x1b, 0x2A, 0x6F, 0x35, 0x57, 0x0E, 0x01, 0x00};

638 
tİ¥¿y
 = ()(
fTİOv”S´ay
 * 
thePrštCÚ‹xt
->
	`EfãùiveResŞutiÚY
() + 0.5);

639 
cBuf
[1] = 
tİ¥¿y
 & 0xFF;

640 
cBuf
[0] = 
tİ¥¿y
 >> 8;

642 
”r
 = 
thePrš‹r
->
	`S’d
 ((cÚ¡ 
BYTE
 *è
TİOv”S´aySeq
,  (TopOverSpraySeq));

643 
”r
 = 
thePrš‹r
->
	`S’d
 ((cÚ¡ 
BYTE
 *è
cBuf
, 2);

646 
Ëá¥¿y
 = ()(
fLeáOv”S´ay
 * 
thePrštCÚ‹xt
->
	`EfãùiveResŞutiÚX
() + 0.5);

647 
cBuf
[1] = 
Ëá¥¿y
 & 0xFF;

648 
cBuf
[0] = 
Ëá¥¿y
 >> 8;

650 
”r
 = 
thePrš‹r
->
	`S’d
 ((cÚ¡ 
BYTE
 *è
LeáOv”S´aySeq
,  (LeftOverSpraySeq));

651 
”r
 = 
thePrš‹r
->
	`S’d
 ((cÚ¡ 
BYTE
 *è
cBuf
, 2);

655 
”r
 = 
thePrš‹r
->
	`S’d
 ((cÚ¡ 
BYTE
 *) "\033&l-2H", 6);

656 
ERRCHECK
;

659 
thePrš‹r
->
	`S‘Hšt
 (
SPEED_MECH_HINT
, 0);

663 
”r
 = 
thePrš‹r
->
	`S’d
((cÚ¡ 
BYTE
*)
g¿fS¹
, (grafStart) );

664 
ERRCHECK
;

666 ià(!
thePrš‹r
->
	`U£GUIMode
 (
thePrštCÚ‹xt
->
Cu¼’tMode
) &&

667 (
thePrštCÚ‹xt
->
	`PhysiÿlPageSizeX
 ()) < 8.0)

670 
BYTE
 
bÏnkRow
[40];

671 
	`mem£t
 (
bÏnkRow
, 0xFF, 40);

672 
	`¡rıy
 ((*è
bÏnkRow
, "\033*p0Y\033*b23W");

673 
bÏnkRow
[11] = 18;

674 
bÏnkRow
[30] = 0xCE; blankRow[31] = 0x7F;

675 
”r
 = 
thePrš‹r
->
	`S’d
 ((cÚ¡ 
BYTE
 *è
bÏnkRow
, 34);

678  
”r
;

679 
	}
}

682 
DRIVER_ERROR
 
	gH—d”DJ990
::
	$S¹S’d
()

684 
DRIVER_ERROR
 
”r
;

686 
”r
 = 
thePrš‹r
->
	`S’d
((cÚ¡ 
BYTE
*)
Re£t
,(Reset));

687 
ERRCHECK
;

689 
”r
 = 
thePrš‹r
->
	`S’d
((cÚ¡ 
BYTE
*)
UEL
,(UEL));

690 
ERRCHECK
;

692 
”r
 = 
thePrš‹r
->
	`AddPJLH—d”
 ();

693 
ERRCHECK
;

695 
”r
 = 
thePrš‹r
->
	`S’d
((cÚ¡ 
BYTE
*)
EÁ”Lªguage
,(EnterLanguage));

696 
ERRCHECK
;

698 ià(!
thePrš‹r
->
	`U£GUIMode
(
thePrštCÚ‹xt
->
Cu¼’tMode
))

700 
”r
 = 
thePrš‹r
->
	`S’d
((cÚ¡ 
BYTE
*)
PCL3
,(PCL3));

704 
”r
 = 
thePrš‹r
->
	`S’d
((cÚ¡ 
BYTE
*)
PCLGUI
,(PCLGUI));

706 
ERRCHECK
;

709 
”r
 = 
thePrš‹r
->
	`S’d
((cÚ¡ 
BYTE
*)&
LF
,1);

710 
ERRCHECK
;

712 
”r
 = 
	`Modes
 ();

713 
ERRCHECK
;

716 
iMedŸSubty³
 = 
thePrštCÚ‹xt
->
	`G‘MedŸSubty³
 ();

717 ià(
iMedŸSubty³
 !ğ
APDK_INVALID_VALUE
)

719 
BYTE
 
szMedŸSubty³Seq
[] = {0x1B, '*', 'o', '5', 'W', 0x0D, 0x03, 0x00, 0x00, 0x00};

720 
szMedŸSubty³Seq
[8] = (
BYTE
è((
iMedŸSubty³
 & 0xFF00) >> 8);

721 
szMedŸSubty³Seq
[9] = (
BYTE
è(
iMedŸSubty³
 & 0x00FF);

722 
”r
 = 
thePrš‹r
->
	`S’d
 ((cÚ¡ 
BYTE
 *è
szMedŸSubty³Seq
, (szMediaSubtypeSeq));

723 
ERRCHECK
;

726 ià(!
thePrš‹r
->
	`U£GUIMode
(
thePrštCÚ‹xt
->
Cu¼’tMode
))

728 
”r
 = 
	`M¬gšs
();

733 ià((
thePrštCÚ‹xt
->
	`PršbËS¹Y
 ()) > 0.0)

735 
CAPy
 = 
thePrštCÚ‹xt
->
	`GUITİM¬gš
();

738 ià((
thePrštCÚ‹xt
->
	`G‘MedŸSourû
()è=ğ
sourûT¿yCDDVD
)

740 
”r
 = 
thePrš‹r
->
	`S’d
 ((cÚ¡ 
BYTE
 *) "\033*o5W\x0D\x03\x00\x04\x0C", 10);

741 
ERRCHECK
;

744  
”r
;

745 
	}
}

748 
	gH—d”DJ990
::
	$S‘MedŸSourû
(
MedŸSourû
 
msourû
)

751 
m¤ccouÁ
=
	`EscAm¶Cİy
((
BYTE
*)
medŸsourû
,
msourû
,'H');

752 ià(
msourû
 =ğ
sourûT¿yCDDVD
)

754 
	`S‘MedŸTy³
 (
medŸCDDVD
);

755 
	`S‘Qu®™y
 (
qu®™yP»£Á©iÚ
);

758 ià(
msourû
 =ğ
sourûT¿y2
 || msourû > 
sourûT¿yAuto
)

760 
	`S‘MedŸTy³
 (
medŸPÏš
);

762 
	}
}

764 
DRIVER_ERROR
 
	gDJ9xxVIP
::
	$V”ifyP’Info
()

766 
DRIVER_ERROR
 
”r
=
NO_ERROR
;

768 if(
IOMode
.
bDevID
 =ğ
FALSE
)

769  
”r
;

770 
”r
 = 
	`P¬£P’Info
(
eP’
);

772 if(
”r
 =ğ
UNSUPPORTED_PEN
)

774 
	`DBG1
("DJ9xxVIP::Needo do‡ POWER ONo get…enIDs\n");

777 ià(
pSS
->
	`BusyWa™
((
DWORD
)2000è=ğ
JOB_CANCELED
)

779  
JOB_CANCELED
;

782 
DWORD
 
Ëngth
 = (
DJ895_Pow”_On
);

783 
”r
 = 
pSS
->
	`ToDeviû
(
DJ895_Pow”_On
,&
Ëngth
);

784 
ERRCHECK
;

786 
”r
 = 
pSS
->
	`FlushIO
();

787 
ERRCHECK
;

790 ià(
pSS
->
	`BusyWa™
 ((
DWORD
è2500è=ğ
JOB_CANCELED
)

792  
JOB_CANCELED
;

795 
”r
 = 
	`P¬£P’Info
(
eP’
);

798 
ERRCHECK
;

801 ià(
eP’
 =ğ
BOTH_PENS
 ||ƒP’ =ğ
MDL_BLACK_AND_COLOR_PENS
)

803  
NO_ERROR
;

808  
eP’
 !ğ
BOTH_PENS
 && 
pSS
->
	`G‘VIPV”siÚ
 () == 1 )

811 
eP’
)

813 
BLACK_PEN
:

815 
pSS
->
	`Di¥ÏyPrš‹rStus
(
DISPLAY_NO_COLOR_PEN
);

817 
COLOR_PEN
:

819 
pSS
->
	`Di¥ÏyPrš‹rStus
(
DISPLAY_NO_BLACK_PEN
);

821 
NO_PEN
:

824 
pSS
->
	`Di¥ÏyPrš‹rStus
(
DISPLAY_NO_PENS
);

828 ià(
pSS
->
	`BusyWa™
(500è=ğ
JOB_CANCELED
)

830  
JOB_CANCELED
;

833 
”r
 = 
	`P¬£P’Info
(
eP’
);

834 
ERRCHECK
;

837 
pSS
->
	`Di¥ÏyPrš‹rStus
(
DISPLAY_PRINTING
);

839  
NO_ERROR
;

840 
	}
}

843 
DRIVER_ERROR
 
	gDJ9xxVIP
::
	$P¬£P’Info
(
PEN_TYPE
& 
eP’
, 
BOOL
 
Qu”yPrš‹r
)

845 * 
¡r
;

846 
num_³ns
 = 0;

847 
PEN_TYPE
 
‹mp_³n1
 = 
NO_PEN
;

848 
BYTE
 
³nInfoB™s
[4];

849 
i
;

857 ià((
pSS
->
	`G‘VIPV”siÚ
 ()) > 5)

859 
eP’
 = 
BOTH_PENS
;

860  
NO_ERROR
;

863 
DRIVER_ERROR
 
”r
 = 
	`S‘P’Info
 (
¡r
, 
Qu”yPrš‹r
);

865 ià(
”r
 !ğ
NO_ERROR
)

867 
eP’
 = 
BOTH_PENS
;

868  
NO_ERROR
;

870 
iNumMissšgP’s
 = 0;

873 ià((
¡r
[0] >= '0') && (str[0] <= '9'))

875 
num_³ns
 = 
¡r
[0] - '0';

877 ià((
¡r
[0] >= 'A') && (str[0] <= 'F'))

879 
num_³ns
 = 10 + (
¡r
[0] - 'A');

881 ià((
¡r
[0] >= 'a') && (str[0] <= 'f'))

883 
num_³ns
 = 10 + (
¡r
[0] - 'a');

887  
BAD_DEVICE_ID
;

890 ià((è
	`¡¾’
 (
¡r
è< (
num_³ns
 * 8))

892  
BAD_DEVICE_ID
;

897 ià(
pSS
->
	`G‘VIPV”siÚ
 () == 1)

899 ià(
num_³ns
 < 2)

901  
UNSUPPORTED_PEN
;

905 
	`AsciiHexToBš¬y
(
³nInfoB™s
, 
¡r
+1, 4);

906 
³nInfoB™s
[1] &= 0xf8;

908 ià((
³nInfoB™s
[0] == 0xc1) && (penInfoBits[1] == 0x10))

910 
‹mp_³n1
 = 
BLACK_PEN
;

912 ià(
³nInfoB™s
[0] == 0xc0)

914 
‹mp_³n1
 = 
NO_PEN
;

915 
iNumMissšgP’s
 = 1;

919  
UNSUPPORTED_PEN
;

923 
	`AsciiHexToBš¬y
(
³nInfoB™s
, 
¡r
+9, 4);

924 
³nInfoB™s
[1] &= 0xf8;

926 ià((
³nInfoB™s
[0] == 0xc2) && (penInfoBits[1] == 0x08))

928 ià(
‹mp_³n1
 =ğ
BLACK_PEN
)

930 
eP’
 = 
BOTH_PENS
;

934 
eP’
 = 
COLOR_PEN
;

937 ià(
³nInfoB™s
[0] == 0xc0)

939 
eP’
 = 
‹mp_³n1
;

940 
iNumMissšgP’s
 = 1;

944  
UNSUPPORTED_PEN
;

947  
NO_ERROR
;

952 ià(*(
¡r
 - 1) == '1' && *(str - 2) == '1')

954  
UNSUPPORTED_PEN
;

957 *
p
 = 
¡r
 + 1;

1009 
eP’
 = 
NO_PEN
;

1011 ià(
pSS
->
	`G‘VIPV”siÚ
 () == 3)

1013 
i
 = 0; i < 
num_³ns
; i++, 
p
 += 4)

1015 ià(*
p
 > 0 && *p < '5')

1019 *
p
)

1023 
iNumMissšgP’s
++;

1028 
eP’
 = 
BLACK_PEN
;

1035 ià(
eP’
 =ğ
BLACK_PEN
)

1037 
eP’
 = 
BOTH_PENS
;

1039 ià(
eP’
 !ğ
BOTH_PENS
)

1041 
eP’
 = 
COLOR_PEN
;

1048 ià(
iNumMissšgP’s
 != 0)

1050  
MISSING_PENS
;

1052  
NO_ERROR
;

1057 
BYTE
 
³nCŞÜ
;

1066 
i
 = 0; i < 
num_³ns
; i++, 
p
 += 8)

1068 
	`AsciiHexToBš¬y
 (
³nInfoB™s
, 
p
, 8);

1070 ià((
³nInfoB™s
[1] & 0xf8) == 0xf8)

1076  
UNSUPPORTED_PEN
;

1079 ià((
³nInfoB™s
[0] & 0x40) != 0x40)

1083 
³nCŞÜ
 = 
³nInfoB™s
[0] & 0x3F;

1084 
³nCŞÜ
)

1088 
iNumMissšgP’s
++;

1092 
eP’
 = 
BLACK_PEN
;

1096 ià(
eP’
 =ğ
BLACK_PEN
)

1098 
eP’
 = 
BOTH_PENS
;

1100 ià(
eP’
 =ğ
MDL_PEN
)

1102 
eP’
 = 
MDL_BOTH
;

1104 ià(
eP’
 =ğ
GREY_PEN
)

1106 
eP’
 = 
GREY_BOTH
;

1110 
eP’
 = 
COLOR_PEN
;

1115 ià(
eP’
 =ğ
BLACK_PEN
)

1117 
eP’
 = 
MDL_AND_BLACK_PENS
;

1119 ià(
eP’
 =ğ
COLOR_PEN
)

1121 
eP’
 = 
MDL_BOTH
;

1123 ià(
eP’
 =ğ
BOTH_PENS
)

1125 
eP’
 = 
MDL_BLACK_AND_COLOR_PENS
;

1127 ià(
eP’
 =ğ
GREY_PEN
)

1129 
eP’
 = 
MDL_AND_GREY_PENS
;

1131 ià(
eP’
 =ğ
GREY_BOTH
)

1133 
eP’
 = 
MDL_GREY_AND_COLOR_PENS
;

1137 
eP’
 = 
MDL_PEN
;

1147 ià(
eP’
 =ğ
BLACK_PEN
 ||ƒP’ =ğ
BOTH_PENS
)

1149 
eP’
 = 
BOTH_PENS
;

1153 
eP’
 = 
COLOR_PEN
;

1157 
eP’
 = 
GREY_PEN
;

1160 
eP’
 = 
UNKNOWN_PEN
;

1163  
NO_ERROR
;

1166 
eP’
 = 
BOTH_PENS
;

1167  
NO_ERROR
;

1169 
	}
}

1172 
BOOL
 
	gDJ9xxVIP
::
	$IsPCL3Driv”w¬eAvaabË
()

1174 #ifdeà 
APDK_LINUX


1176  
TRUE
;

1179 
BOOL
 
pş3driv”w¬e
 = 
TRUE
;

1180 
BOOL
 
šAJob
 = 
FALSE
;

1181 *
pSŒ
;

1182 *
pEnd
;

1183 
BYTE
 
devIDBuff
[
DevIDBuffSize
];

1184 
maxWa™Tr›s
;

1185 
i
;

1189 ià(!
IOMode
.
bDevID
)

1191  
TRUE
;

1194 ià(
pSS
->
	`G‘DeviûID
(
devIDBuff
, 
DevIDBuffSize
, 
TRUE
è!ğ
NO_ERROR
)

1196 
ş—nup
;

1201 ià(!
	`¡r¡r
((cÚ¡ *)
devIDBuff
+2,"MDL:DESKJET 990C") &&

1202 !
	`¡r¡r
((cÚ¡ *)
devIDBuff
+2,"MDL:PHOTOSMART 1215") &&

1203 !
	`¡r¡r
((cÚ¡ *)
devIDBuff
+2,"MDL:PHOTOSMART 1218") )

1205  
TRUE
;

1223 ià(
	`Flush
(è!ğ
NO_ERROR
è
ş—nup
;

1224 ià(
	`S’d
((cÚ¡ 
BYTE
*)
UEL
,(UEL)è!ğ
NO_ERROR
è
ş—nup
;

1225 
šAJob
 = 
TRUE
;

1226 ià(
	`S’d
((cÚ¡ 
BYTE
*)
JobName
,(JobName)è!ğ
NO_ERROR
è
ş—nup
;

1227 ià(
	`S’d
((cÚ¡ 
BYTE
*)&
QuÙe
,1è!ğ
NO_ERROR
è
ş—nup
;

1228 ià(
	`S’d
((cÚ¡ 
BYTE
*)
OUR_PJL_JOBNAME
,
	`¡¾’
(OUR_PJL_JOBNAME)è!ğ
NO_ERROR
è
ş—nup
;

1229 ià(
	`S’d
((cÚ¡ 
BYTE
*)&
QuÙe
,1è!ğ
NO_ERROR
è
ş—nup
;

1230 ià(
	`S’d
((cÚ¡ 
BYTE
*)&
LF
,1è!ğ
NO_ERROR
è
ş—nup
;

1231 ià(
	`Flush
(è!ğ
NO_ERROR
è
ş—nup
;

1232 ià(
pSS
->
	`FlushIO
(è!ğ
NO_ERROR
è
ş—nup
;

1244 
maxWa™Tr›s
 = 120;

1245 
i
=0; i<
maxWa™Tr›s
; i++)

1247 ià(
pSS
->
	`G‘DeviûID
(
devIDBuff
, 
DevIDBuffSize
, 
TRUE
è!ğ
NO_ERROR
è
ş—nup
;

1248 iàĞ(
pSŒ
=(*)
	`¡r¡r
((cÚ¡ *)
devIDBuff
+2,";J:")) )

1250 
pSŒ
 += 3;

1251 iàĞ(
pEnd
=(*)
	`¡r¡r
((cÚ¡ *)
pSŒ
,";")) )

1253 *
pEnd
 = '\0';

1254 
pEnd
 > 
pSŒ
)

1256 ià(*(
pEnd
-1) == ' ')

1258 *(
pEnd
-1) = '\0';

1264 
pEnd
--;

1266 ià(!
	`¡rcmp
(
pSŒ
, 
OUR_PJL_JOBNAME
))

1271 
pSS
->
	`BusyWa™
((
DWORD
)500);

1275 
	`DBG1
("JobName missing from DeviceID strings");

1276 
ş—nup
;

1279 ià(
i
>=
maxWa™Tr›s
)

1282 
	`DBG1
("Printer didn't„espondo PJL\n");

1283 
ş—nup
;

1288 ià(
	`S’d
((cÚ¡ 
BYTE
*)
EÁ”Lªguage
,(EÁ”Lªguage)è!ğ
NO_ERROR
è
ş—nup
;

1289 ià(
	`S’d
((cÚ¡ 
BYTE
*)
PCL3
,(PCL3)è!ğ
NO_ERROR
è
ş—nup
;

1290 ià(
	`S’d
((cÚ¡ 
BYTE
*)&
LF
,1è!ğ
NO_ERROR
è
ş—nup
;

1291 ià(
	`S’d
((cÚ¡ 
BYTE
*)
Driv”w¬eJobName
,(Driv”w¬eJobName)è!ğ
NO_ERROR
è
ş—nup
;

1292 ià(
	`Flush
(è!ğ
NO_ERROR
è
ş—nup
;

1293 ià(
pSS
->
	`FlushIO
(è!ğ
NO_ERROR
è
ş—nup
;

1298 
maxWa™Tr›s
 = 4;

1299 
i
=0; i<
maxWa™Tr›s
; i++)

1301 ià(
pSS
->
	`G‘DeviûID
(
devIDBuff
, 
DevIDBuffSize
, 
TRUE
è!ğ
NO_ERROR
è
ş—nup
;

1302 iàĞ(
pSŒ
=(*)
	`¡r¡r
((cÚ¡ *)
devIDBuff
+2,";J:")) )

1304 
pSŒ
 += 3;

1305 iàĞ(
pEnd
=(*)
	`¡r¡r
((cÚ¡ *)
pSŒ
,";")) )

1307 *
pEnd
 = '\0';

1310 ià(!
	`¡ºcmp
(
pSŒ
, 
DRIVERWARE_JOBNAME
, 
	`¡¾’
(DRIVERWARE_JOBNAME)))

1312 
pş3driv”w¬e
 = 
TRUE
;

1316 
pSS
->
	`BusyWa™
((
DWORD
)500);

1320 
	`DBG1
("JobName missing from DeviceID string");

1321 
ş—nup
;

1324 ià(
i
>=
maxWa™Tr›s
)

1328 
pş3driv”w¬e
 = 
FALSE
;

1332 
ş—nup
:

1333 ià(
šAJob
)

1335 ià(
	`S’d
((cÚ¡ 
BYTE
*)
UEL
,(UEL)è!ğ
NO_ERROR
è
baout
;

1336 ià(
pSS
->
	`FlushIO
(è!ğ
NO_ERROR
è
baout
;

1339 
baout
:

1340  
pş3driv”w¬e
;

1344 
	}
}

1347 
DISPLAY_STATUS
 
	gDJ9xxVIP
::
	$P¬£E¼Ü
(
BYTE
 
¡©us_»g
)

1349 
	`DBG1
("DJ9xxVIP,…arsingƒrror info\n");

1351 
DRIVER_ERROR
 
”r
 = 
NO_ERROR
;

1352 
BYTE
 
DevIDBufãr
[
DevIDBuffSize
];

1353 *
pSŒ
;

1354 
iV”siÚ
 = 
pSS
->
	`G‘VIPV”siÚ
 ();

1356 if(
IOMode
.
bDevID
 && 
iV”siÚ
 < 6)

1360 
”r
 = 
pSS
->
	`G‘DeviûID
 (
DevIDBufãr
, 
DevIDBuffSize
, 
TRUE
);

1361 if(
”r
 !ğ
NO_ERROR
)

1364  
DISPLAY_COMM_PROBLEM
;

1367 iàĞ(
pSŒ
=(*)
	`¡r¡r
((cÚ¡ *)
DevIDBufãr
+2,";S:")è=ğ
NULL
 )

1369  
DISPLAY_COMM_PROBLEM
;

1373 
BYTE
 
b1
,
b2
;

1375 
pSŒ
+=5;

1376 
b1
=*
pSŒ
;

1378 ià(
b1
=='9')

1380  
DISPLAY_TOP_COVER_OPEN
;

1383 ià(
iV”siÚ
 < 3)

1385 
pSŒ
 += 12;

1387 ià(
iV”siÚ
 < 5)

1389 
pSŒ
 += 14;

1393 
pSŒ
 += 18;

1396 
b1
=*
pSŒ
++;

1397 
b2
=*
pSŒ
++;

1398 ià((
b1
=='0'è&& (
b2
=='9'))

1400 
	`DBG1
("Out of Paper [from Encoded DevID]\n");

1401  
DISPLAY_OUT_OF_PAPER
;

1404 ià(
b1
 =ğ'0' && (
b2
 == 'c' || b2 == 'C'))

1412 
	`DBG1
("Photo Tray Mismatch [from Encoded DevID]\n");

1413  
DISPLAY_PHOTOTRAY_MISMATCH
;

1418 ià((
b1
 =ğ'1' && 
b2
 == '0') ||

1419 (
b1
 =ğ'0' && (
b2
 == 'e' || b2 == 'E')))

1421  
DISPLAY_PAPER_JAMMED
;

1426 ià(
b1
 =ğ'0' && (
b2
 == 'F' || b2 == 'f'))

1428  
DISPLAY_ERROR_TRAP
;

1432 ià((
b1
=='0'è&& (
b2
=='5'))

1434 
	`DBG1
("Printing Canceled [from Encoded DevID]\n");

1435  
DISPLAY_PRINTING_CANCELED
;

1440 
”r
 = 
	`V”ifyP’Info
 ();

1442 if(
”r
 !ğ
NO_ERROR
)

1450  
DISPLAY_COMM_PROBLEM
;

1455 ià(
IOMode
.
bStus
)

1459 iàĞ
	`DEVICE_IS_OOP
(
¡©us_»g
) )

1461 
	`DBG1
("Out Of Paper [from status byte]\n");

1462  
DISPLAY_OUT_OF_PAPER
;

1467 ià(
	`DEVICE_PAPER_JAMMED
(
¡©us_»g
))

1469 
	`DBG1
("Jammed [from status byte]\n");

1470  
DISPLAY_PAPER_JAMMED
;

1487 ià(
pSS
->
	`Prš‹rIsAlive
())

1489 
iTÙ®_SLOW_POLL_CouÁ
 +ğ
iMax_SLOW_POLL_CouÁ
;

1490 #ià
	`defšed
(
DEBUG
è&& (
DBG_MASK
 & 
DBG_LVL1
)

1491 
	`´štf
("iTÙ®_SLOW_POLL_CouÁ = %d\n",
iTÙ®_SLOW_POLL_CouÁ
);

1499 ((
IOMode
.
bDevID
 =ğ
FALSE
è&& (
iTÙ®_SLOW_POLL_CouÁ
 >= 60)) ||

1500 ((
IOMode
.
bDevID
 =ğ
TRUE
è&& (
iTÙ®_SLOW_POLL_CouÁ
 >= 120))

1503  
DISPLAY_BUSY
;

1507  
DISPLAY_PRINTING
;

1512  
DISPLAY_COMM_PROBLEM
;

1514 
	}
}

1517 
DRIVER_ERROR
 
	gDJ9xxVIP
::
	$CËªP’
()

1519 cÚ¡ 
BYTE
 
DJ990_U£r_Ouut_Page
[] = {
ESC
, '%','P','u','i','f','p','.',

1521 'u','d','w','.','q','u','i','t',';',
ESC
,'%','-','1','2','3','4','5','X' };

1523 
DWORD
 
Ëngth
 = (
PEN_CLEAN_PML
);

1524 
DRIVER_ERROR
 
”r
 = 
pSS
->
	`ToDeviû
(
PEN_CLEAN_PML
, &
Ëngth
);

1525 
ERRCHECK
;

1529 
Ëngth
 = (
DJ990_U£r_Ouut_Page
);

1530  
pSS
->
	`ToDeviû
(
DJ990_U£r_Ouut_Page
, &
Ëngth
);

1531 
	}
}

1534 #ià
defšed
(
APDK_VIP_COLORFILTERING
)

1536 
BOOL
 
	gTEº›F‹r
::
	$Proûss
(
RASTERDATA
* 
ImageD©a
)

1538 ià(
ImageD©a
 =ğ
NULL
 || (ImageD©a->
¿¡”d©a
[
COLORTYPE_COLOR
] =ğNULL && ImageD©a->¿¡”d©a[
COLORTYPE_BLACK
] == NULL))

1540  
FALSE
;

1544 ià(
ImageD©a
->
¿¡”d©a
[
COLORTYPE_COLOR
])

1546 
	`subm™RowToF‹r
(
ImageD©a
->
¿¡”d©a
[
COLORTYPE_COLOR
]);

1548 ià(
ImageD©a
->
¿¡”d©a
[
COLORTYPE_BLACK
])

1550 
	`memıy
(
fBÏckRowPŒ
[
RowIndex
], 
ImageD©a
->
¿¡”d©a
[
COLORTYPE_BLACK
], ImageD©a->
¿¡”size
[COLORTYPE_BLACK]);

1552 
BÏckRa¡”Size
[
RowIndex
++] = 
ImageD©a
->
¿¡”size
[
COLORTYPE_BLACK
];

1554 ià(
RowIndex
 == 4)

1555 
RowIndex
 = 0;

1558  (
fNumb”OfBufã»dRows
 == 0);

1562 
iRa¡”sR—dy
 = 1;

1565  
TRUE
;

1566 
	}
}

1569 
	gTEº›F‹r
::
	$G‘OuutWidth
(
COLORTYPE
 
¿¡”cŞÜ
)

1571 ià(
¿¡”cŞÜ
 =ğ
COLORTYPE_COLOR
)

1573 ià(
¿¡”
.
¿¡”d©a
[
COLORTYPE_COLOR
] =ğ
NULL
)

1576  
fRowWidthInPix–s
 * 
BYTES_PER_PIXEL
;

1580 ià(
¿¡”
.
¿¡”d©a
[
COLORTYPE_COLOR
] =ğ
NULL
)

1581  
¿¡”
.
¿¡”size
[
¿¡”cŞÜ
];

1583  
BÏckRa¡”Size
[
iRa¡”sD–iv”ed
-1];

1585 
	}
}

1588 
BYTE
* 
	gTEº›F‹r
::
	$NextOuutRa¡”
(
COLORTYPE
 
¿¡”cŞÜ
)

1590 ià(
iRa¡”sR—dy
 == 0)

1591  (
BYTE
*)
NULL
;

1592 ià(
¿¡”cŞÜ
 =ğ
COLORTYPE_COLOR
)

1594 ià(
¿¡”
.
¿¡”d©a
[
COLORTYPE_COLOR
] =ğ
NULL
)

1596 
iRa¡”sR—dy
--;

1597  (
BYTE
*)
NULL
;

1601 ià(
iRa¡”sR—dy
 == 0)

1602  (
BYTE
*)
NULL
;

1604 
iRa¡”sR—dy
--;

1606  
fRowPŒ
[
iRa¡”sD–iv”ed
++];

1611 ià(
¿¡”
.
¿¡”d©a
[
COLORTYPE_COLOR
] =ğ
NULL
)

1613  
¿¡”
.
¿¡”d©a
[
¿¡”cŞÜ
];

1617 ià(
BÏckRa¡”Size
[
iRa¡”sD–iv”ed
] == 0)

1618  
NULL
;

1620  
fBÏckRowPŒ
[
iRa¡”sD–iv”ed
];

1623 
	}
}

1626 
	gTEº›F‹r
::
	$Flush
()

1628 
	`wr™eBufã»dRows
();

1629 
iRa¡”sD–iv”ed
=0;

1630 
fPix–Off£tIndex
 = 0;

1631 
iRa¡”sR—dy
 = 
fNumb”OfBufã»dRows
;

1632 
fNumb”OfBufã»dRows
 = 0;

1633 
	}
}

1637 
šlše
 
ušt32_t
 
	gMode10
::
g‘3Pix–


1639 
BYTE
* 
pixAdd»ss
,

1640 
	gpix–Off£t


1643 
	gpixAdd»ss
 +ğ((
pix–Off£t
 << 1) +…ixelOffset);

1645 
BYTE
 
	gr
 = *(
pixAdd»ss
);

1646 
BYTE
 
	gg
 = *(
pixAdd»ss
 + 1);

1647 
BYTE
 
	gb
 = *(
pixAdd»ss
 + 2);

1649  (
	gkWh™e
 & ((
	gr
 << 16è| (
	gg
 << 8è| (
	gb
)));

1656 
	gMode10
::
put3Pix–


1658 
BYTE
* 
pixAdd»ss
,

1659 
	gpix–Off£t
,

1660 
ušt32_t
 
	gpix–


1663 
	gpixAdd»ss
 +ğ((
pix–Off£t
 << 1) +…ixelOffset);

1665 
	g‹mp
 = (
pix–
 & 
kWh™e
);

1667 *(
	gpixAdd»ss
èğ((
‹mp
 >> 16) & 0x000000FF);

1668 *(
	gpixAdd»ss
 + 1èğ((
‹mp
 >> 8) & 0x000000FF);

1669 *(
	gpixAdd»ss
 + 2èğ(
‹mp
 & 0x000000FF);

1674 
	gMode10
::
ShÜtD–


1676 
ušt32_t
 
Ï¡Pix–
,

1677 
ušt32_t
 
	gÏ¡Uµ”Pix–


1680 
	gdr
,
	gdg
,
	gdb
;

1681 
	g»suÉ
;

1683 
	gdr
 = 
G‘Red
(
Ï¡Pix–
è- G‘Red(
Ï¡Uµ”Pix–
);

1684 
	gdg
 = 
G‘G»’
(
Ï¡Pix–
è- G‘G»’(
Ï¡Uµ”Pix–
);

1685 
	gdb
 = 
G‘Blue
(
Ï¡Pix–
è- G‘Blue(
Ï¡Uµ”Pix–
);

1687 ià((
	gdr
 <ğ15è&& (
dr
 >ğ-16è&& (
dg
 <ğ15è&& (dg >ğ-16è&& (
db
 <= 30) && (db >= -32))

1689 
»suÉ
 = ((
dr
 << 10è& 0x007C00è| (((
dg
 << 5è& 0x0003E0è| ((
db
 >> 1) & 0x01F) | 0x8000);

1693 
	g»suÉ
 = 0;

1696  
	g»suÉ
;

1699 
BOOL
 
	gMode10
::
Proûss


1701 
RASTERDATA
* 
šput


1713 ià(
šput
==
NULL
 ||

1714 (
šput
->
¿¡”d©a
[
COLORTYPE_COLOR
]==
NULL
 && iÅut->¿¡”d©a[
COLORTYPE_BLACK
]==NULL))

1716 
Flush
();

1717  
	gFALSE
;

1720 ià(
	gmy¶ªe
 =ğ
COLORTYPE_BLACK
 || 
šput
->
¿¡”d©a
[
COLORTYPE_COLOR
]==
NULL
)

1722 
iRa¡”sR—dy
 = 1;

1723 
	gcom´es£dsize
 = 0;

1724 ià(
	g£eded
)

1726 
	gthePrš‹r
->
S’d
(
Re£tS“drow
, (ResetSeedrow));

1727 
mem£t
(
S“dRow
,0xFF,
šputsize
);

1728 
	g£eded
 = 
FALSE
;

1730  
	gTRUE
;

1732 
	gÜigš®size
 = 
šput
->
¿¡”size
[
my¶ªe
];

1733 
	gsize
 = 
šput
->
¿¡”size
[
my¶ªe
];

1735 *
	g£edRowPŒ
 = (*)
S“dRow
;

1737 *
	gcom´es£dD©aPŒ
 = 
com´essBuf
;

1738 *
	gcurRowPŒ
 = (*)
šput
->
¿¡”d©a
[
my¶ªe
];

1739 
	growWidthInBy‹s
 = 
size
;

1741 
ASSERT
(
curRowPŒ
);

1742 
ASSERT
(
£edRowPŒ
);

1743 
ASSERT
(
com´es£dD©aPŒ
);

1744 
ASSERT
(
rowWidthInBy‹s
 >ğ
BYTES_PER_PIXEL
);

1745 
ASSERT
((
rowWidthInBy‹s
 % 
BYTES_PER_PIXEL
) == 0);

1747 *
	gcom´es£dD©aS¹
 = 
com´es£dD©aPŒ
;

1748 
	gÏ¡Pix–
 = (
rowWidthInBy‹s
 / 
BYTES_PER_PIXEL
) - 1;

1751 
ušt32_t
 
	g»®La¡Pix–
 = 
g‘Pix–
(
curRowPŒ
, 
Ï¡Pix–
);

1753 
ušt32_t
 
	gÃwLa¡Pix–
 = 
»®La¡Pix–
;

1754 (
g‘Pix–
(
curRowPŒ
, 
Ï¡Pix–
-1è=ğ
ÃwLa¡Pix–
) ||

1755 (
g‘Pix–
(
£edRowPŒ
, 
Ï¡Pix–
è=ğ
ÃwLa¡Pix–
))

1757 
putPix–
(
curRowPŒ
, 
Ï¡Pix–
, 
ÃwLa¡Pix–
 += 0x100);

1760 
	gcurPix–
 = 0;

1761 
	g£edRowPix–CİyCouÁ
;

1762 
	gÿchedCŞÜ
 = 
kWh™e
;

1766 
	gCMDBy‹
 = 0;

1767 
	g»¶aûm’tCouÁ
;

1770 
	g£edRowPix–CİyCouÁ
 = 
curPix–
;

1771 
g‘Pix–
(
£edRowPŒ
, 
curPix–
è=ğg‘Pix–(
curRowPŒ
, curPixel))

1773 
	gcurPix–
++;

1776 
	g£edRowPix–CİyCouÁ
 = 
curPix–
 - 
£edRowPix–CİyCouÁ
;

1777 
ASSERT
 (
curPix–
 <ğ
Ï¡Pix–
);

1779 
	gpix–Sourû
 = 0;

1781 ià(
	gcurPix–
 =ğ
Ï¡Pix–
)

1783 
putPix–
(
curRowPŒ
, 
Ï¡Pix–
, 
»®La¡Pix–
);

1785 ià(
g‘Pix–
(
£edRowPŒ
, 
curPix–
è=ğ
»®La¡Pix–
)

1787 
mode10¹n
;

1792 
	gCMDBy‹
 = 
eL™”®
;

1793 
	gpix–Sourû
 = 
“NewPix–
;

1794 
	g»¶aûm’tCouÁ
 = 1;

1795 
	gcurPix–
++;

1800 
ASSERT
(
curPix–
 < 
Ï¡Pix–
);

1802 
	g»¶aûm’tCouÁ
 = 
curPix–
;

1803 
ušt32_t
 
	gRLERun
 = 
g‘Pix–
(
curRowPŒ
, 
curPix–
);

1805 
	gcurPix–
++;

1806 
	gRLERun
 =ğ
g‘Pix–
(
curRowPŒ
, 
curPix–
))

1808 
	gcurPix–
++;

1810 
	gcurPix–
--;

1811 
	g»¶aûm’tCouÁ
 = 
curPix–
 - 
»¶aûm’tCouÁ
;

1812 
ASSERT
(
»¶aûm’tCouÁ
 >= 0);

1814 ià(
	g»¶aûm’tCouÁ
 > 0)

1816 
	gcurPix–
++;

1817 
	g»¶aûm’tCouÁ
++;

1819 ià(
	gÿchedCŞÜ
 =ğ
RLERun
)

1821 
pix–Sourû
 = 
“CachedCŞÜ
;

1823 ià(
g‘Pix–
(
£edRowPŒ
, 
curPix–
-
»¶aûm’tCouÁ
+1è=ğ
RLERun
)

1825 
pix–Sourû
 = 
“NEPix–
;

1827 ià((
	gcurPix–
-
	g»¶aûm’tCouÁ
 > 0è&& (
g‘Pix–
(
curRowPŒ
, 
curPix–
-
»¶aûm’tCouÁ
-1è=ğ
RLERun
))

1829 
pix–Sourû
 = 
“WPix–
;

1833 
	gpix–Sourû
 = 
“NewPix–
;

1834 
	gÿchedCŞÜ
 = 
RLERun
;

1837 
	gCMDBy‹
 = 
eRLE
;

1841 ià(
	gcurPix–
 =ğ
Ï¡Pix–
)

1843 
ASSERT
(
»¶aûm’tCouÁ
 > 0);

1845 ià(
	g»®La¡Pix–
 =ğ
RLERun
)

1847 
putPix–
(
curRowPŒ
, 
Ï¡Pix–
, 
»®La¡Pix–
);

1848 
	g»¶aûm’tCouÁ
++;

1849 
	gcurPix–
++;

1853 ià(0 =ğ
»¶aûm’tCouÁ
)

1855 
ušt32_t
 
‹mpPix–
 = 
g‘Pix–
(
curRowPŒ
, 
curPix–
);

1857 
ASSERT
(
‹mpPix–
 !ğ
g‘Pix–
(
curRowPŒ
, 
curPix–
+1));

1858 
ASSERT
(
‹mpPix–
 !ğ
g‘Pix–
(
£edRowPŒ
, 
curPix–
));

1860 
	gCMDBy‹
 = 
eL™”®
;

1862 ià(
	gÿchedCŞÜ
 =ğ
‹mpPix–
)

1864 
pix–Sourû
 = 
“CachedCŞÜ
;

1867 ià(
g‘Pix–
(
£edRowPŒ
, 
curPix–
+1è=ğ
‹mpPix–
)

1869 
pix–Sourû
 = 
“NEPix–
;

1872 ià((
	gcurPix–
 > 0è&& (
g‘Pix–
(
curRowPŒ
, 
curPix–
-1è=ğ
‹mpPix–
))

1874 
pix–Sourû
 = 
“WPix–
;

1880 
	gpix–Sourû
 = 
“NewPix–
;

1881 
	gÿchedCŞÜ
 = 
‹mpPix–
;

1884 
	g»¶aûm’tCouÁ
 = 
curPix–
;

1885 
ušt32_t
 
	gÿchePix–
;

1886 
ušt32_t
 
	gÃxtPix–
 = 
g‘Pix–
(
curRowPŒ
, 
curPix–
+1);

1889 ià(++
	gcurPix–
 =ğ
Ï¡Pix–
)

1891 
putPix–
(
curRowPŒ
, 
Ï¡Pix–
, 
»®La¡Pix–
);

1892 
	gcurPix–
++;

1895 
	gÿchePix–
 = 
ÃxtPix–
;

1897 (
	gÿchePix–
 !ğ(
ÃxtPix–
 = 
g‘Pix–
(
curRowPŒ
, 
curPix–
+1))) &&

1898 (
	gÿchePix–
 !ğ
g‘Pix–
(
£edRowPŒ
, 
curPix–
)));

1900 
	g»¶aûm’tCouÁ
 = 
curPix–
 - 
»¶aûm’tCouÁ
;

1902 
ASSERT
(
»¶aûm’tCouÁ
 > 0);

1906 
ASSERT
(
£edRowPix–CİyCouÁ
 >= 0);

1909 ià(
	geL™”®
 =ğ
CMDBy‹
)

1911 
ASSERT
(
»¶aûm’tCouÁ
 >= 1);

1913 
	g»¶aûm’tCouÁ
 -= 1;

1915 
	gCMDBy‹
 |ğ
pix–Sourû
;

1916 
	gCMDBy‹
 |ğ
MIN
(3, 
£edRowPix–CİyCouÁ
) << 3;

1917 
	gCMDBy‹
 |ğ
MIN
(7, 
»¶aûm’tCouÁ
);

1919 *
	gcom´es£dD©aPŒ
++ = 
CMDBy‹
;

1921 ià(
	g£edRowPix–CİyCouÁ
 >= 3)

1923 
ouutVLIBy‹sCÚ£cutiv–y
(
£edRowPix–CİyCouÁ
 - 3, 
com´es£dD©aPŒ
);

1926 
	g»¶aûm’tCouÁ
 += 1;

1928 
	gtÙ®R•Ïûm’tCouÁ
 = 
»¶aûm’tCouÁ
;

1929 
	gupw¬dPix–CouÁ
 = 1;

1931 ià(
	g“NewPix–
 !ğ
pix–Sourû
)

1933 
»¶aûm’tCouÁ
 -= 1;

1934 
	gupw¬dPix–CouÁ
 = 2;

1937  ; 
	gupw¬dPix–CouÁ
 <ğ
tÙ®R•Ïûm’tCouÁ
; upwardPixelCount++)

1939 
ASSERT
(
tÙ®R•Ïûm’tCouÁ
 >ğ
upw¬dPix–CouÁ
);

1941 
	gcom´es£dPix–
 = 
ShÜtD–
Ğ
g‘Pix–
(
curRowPŒ
, 
curPix–
-
»¶aûm’tCouÁ
),

1942 
g‘Pix–
(
£edRowPŒ
, 
curPix–
-
»¶aûm’tCouÁ
));

1943 ià(
	gcom´es£dPix–
)

1945 *
	gcom´es£dD©aPŒ
++ = 
com´es£dPix–
 >> 8;

1946 *
	gcom´es£dD©aPŒ
++ = ()
com´es£dPix–
;

1951 
ušt32_t
 
	guncom´es£dPix–
 = 
g‘Pix–
(
curRowPŒ
, 
curPix–
-
»¶aûm’tCouÁ
);

1953 
	guncom´es£dPix–
 >>= 1;

1955 *
	gcom´es£dD©aPŒ
++ = (
BYTE
)(
uncom´es£dPix–
 >> 16);

1956 *
	gcom´es£dD©aPŒ
++ = (
BYTE
)(
uncom´es£dPix–
 >> 8);

1957 *
	gcom´es£dD©aPŒ
++ = (
BYTE
)(
uncom´es£dPix–
);

1961 ià(((
	gupw¬dPix–CouÁ
-8) % 255) == 0)

1963 *
com´es£dD©aPŒ
++ = 
MIN
(255, 
tÙ®R•Ïûm’tCouÁ
 - 
upw¬dPix–CouÁ
);

1966 
	g»¶aûm’tCouÁ
--;

1971 
ASSERT
(
eRLE
 =ğ
CMDBy‹
);

1972 
ASSERT
(
»¶aûm’tCouÁ
 >= 2);

1974 
	g»¶aûm’tCouÁ
 -= 2;

1976 
	gCMDBy‹
 |ğ
pix–Sourû
;

1977 
	gCMDBy‹
 |ğ
MIN
(3, 
£edRowPix–CİyCouÁ
) << 3;

1978 
	gCMDBy‹
 |ğ
MIN
(7, 
»¶aûm’tCouÁ
);

1980 *
	gcom´es£dD©aPŒ
++ = 
CMDBy‹
;

1982 ià(
	g£edRowPix–CİyCouÁ
 >= 3)

1984 
ouutVLIBy‹sCÚ£cutiv–y
(
£edRowPix–CİyCouÁ
 - 3, 
com´es£dD©aPŒ
);

1987 
	g»¶aûm’tCouÁ
 += 2;

1989 ià(
	g“NewPix–
 =ğ
pix–Sourû
)

1991 
com´es£dPix–
 = 
ShÜtD–
(
g‘Pix–
(
curRowPŒ
, 
curPix–
 - 
»¶aûm’tCouÁ
),

1992 
g‘Pix–
(
£edRowPŒ
, 
curPix–
 - 
»¶aûm’tCouÁ
));

1993 ià(
	gcom´es£dPix–
)

1995 *
	gcom´es£dD©aPŒ
++ = 
com´es£dPix–
 >> 8;

1996 *
	gcom´es£dD©aPŒ
++ = ()
com´es£dPix–
;

2000 
ušt32_t
 
	guncom´es£dPix–
 = 
g‘Pix–
(
curRowPŒ
, 
curPix–
 - 
»¶aûm’tCouÁ
);

2002 
	guncom´es£dPix–
 >>= 1;

2004 *
	gcom´es£dD©aPŒ
++ = (
BYTE
)(
uncom´es£dPix–
 >> 16);

2005 *
	gcom´es£dD©aPŒ
++ = (
BYTE
)(
uncom´es£dPix–
 >> 8);

2006 *
	gcom´es£dD©aPŒ
++ = (
BYTE
)(
uncom´es£dPix–
);

2010 ià(
	g»¶aûm’tCouÁ
-2 >ğ7è
ouutVLIBy‹sCÚ£cutiv–y
(
»¶aûm’tCouÁ
 - (7+2), 
com´es£dD©aPŒ
);

2012 } 
	gcurPix–
 <ğ
Ï¡Pix–
);

2014 
	gmode10¹n
:

2015 
size
 = 
com´es£dD©aPŒ
 - 
com´es£dD©aS¹
;

2016 
	gcom´es£dsize
 = 
size
;

2017 
memıy
(
S“dRow
, 
šput
->
¿¡”d©a
[
my¶ªe
], 
Üigš®size
);

2018 
	g£eded
 = 
TRUE
;

2019 
	giRa¡”sR—dy
 = 1;

2020  
	gTRUE
;

2023 
BYTE
* 
	gMode10
::
	$NextOuutRa¡”
(
COLORTYPE
 
cŞÜ
)

2026 ià(
iRa¡”sR—dy
==0)

2027  (
BYTE
*)
NULL
;

2029 ià(
cŞÜ
 =ğ
COLORTYPE_BLACK
)

2031  
¿¡”
.
¿¡”d©a
[
cŞÜ
];

2035 
iRa¡”sR—dy
=0;

2036 ià(
¿¡”
.
¿¡”d©a
[
cŞÜ
] !ğ
NULL
)

2038  
com´essBuf
;

2042  
¿¡”
.
¿¡”d©a
[
cŞÜ
];

2045 
	}
}

2047 
BYTE
 
	gDJ9xxVIP
::
PhÙoT¿yStus


2049 
BOOL
 
bQu”yPrš‹r


2052 
DRIVER_ERROR
 
”r
;

2053 * 
	gpSŒ
;

2055 
BYTE
 
	gbDevIDBuff
[
DevIDBuffSize
];

2057 ià(!
	gIOMode
.
	gbDevID
)

2059 
	gbQu”yPrš‹r
 = 
FALSE
;

2062 
	g”r
 = 
pSS
->
G‘DeviûID
(
bDevIDBuff
, 
DevIDBuffSize
, 
bQu”yPrš‹r
);

2063 ià(
	g”r
!=
NO_ERROR
)

2068 iàĞ(
	gpSŒ
=(*)
¡r¡r
((cÚ¡ *)
bDevIDBuff
+2,";S:")è=ğ
NULL
 )

2074 
	gpSŒ
 += 8;

2075 
BYTE
 
	gb
 = *
pSŒ
;

2076  
	gb
;

2080 
BOOL
 
	gDJ9xxVIP
::
PhÙoT¿yP»£Á


2082 
BOOL
 
bQu”yPrš‹r


2086  ((
PhÙoT¿yStus
(
bQu”yPrš‹r
) & 8) == 8);

2090 
PHOTOTRAY_STATE
 
	gDJ9xxVIP
::
PhÙoT¿yEngaged


2092 
BOOL
 
bQu”yPrš‹r


2101  ((
PHOTOTRAY_STATE
è((
PhÙoT¿yStus
(
bQu”yPrš‹r
) & 9) == 9));

2105 
PAPER_SIZE
 
	gDJ9xxVIP
::
	$Mªd©ÜyP­”Size
()

2107 ià(
	`PhÙoT¿yEngaged
 (
TRUE
))

2108  
PHOTO_SIZE
;

2109  
UNSUPPORTED_SIZE
;

2110 
	}
}

2113 
DRIVER_ERROR
 
	gDJ9xxVIP
::
	$CheckInkLev–
()

2115 
DRIVER_ERROR
 
”r
;

2116 *
pSŒ
;

2117 
i
;

2121 ià(!
IOMode
.
bDevID
)

2123  
NO_ERROR
;

2131 ià((
pSS
->
	`G‘VIPV”siÚ
 ()) > 5)

2133  
NO_ERROR
;

2136 
”r
 = 
pSS
->
	`G‘DeviûID
(
bDevIDBuff
, 
DevIDBuffSize
, 
TRUE
);

2137 ià(
”r
!=
NO_ERROR
)

2139  
”r
;

2142 iàĞ(
pSŒ
=(*)
	`¡r¡r
((cÚ¡ *)
bDevIDBuff
+2,";S:")è=ğ
NULL
 )

2144  
NO_ERROR
;

2150 
”r
 = 
	`S‘P’Info
 (
pSŒ
, 
FALSE
);

2151 ià(
”r
 !ğ
NO_ERROR
)

2153  
NO_ERROR
;

2162 ià(
pSS
->
	`G‘VIPV”siÚ
 () == 1)

2171 
BYTE
 
b1
,
b2
,
b3
;

2172 
b1
=*
pSŒ
++; 
b2
=*pSŒ++; 
b3
=*pStr++;

2173 iàĞ(
b1
 !ğ'2'è|| (
b2
 !ğ'C'è|| (
b3
 != '1'))

2175  
NO_ERROR
;

2179 
pSŒ
++;

2180 
BYTE
 
bÏckšk
 = *
pSŒ
 - 48;

2182 
bÏckšk
 = blackink & 7;

2185 
pSŒ
 += 8;

2186 
BYTE
 
cŞÜšk
 = *
pSŒ
 - 48;

2188 
cŞÜšk
 = colorink & 7;

2190 ià((
bÏckšk
<5è&& (
cŞÜšk
<5))

2192  
NO_ERROR
;

2195 ià((
bÏckšk
>4è&& (
cŞÜšk
>4))

2197  
WARN_LOW_INK_BOTH_PENS
;

2199 ià(
bÏckšk
>4)

2201  
WARN_LOW_INK_BLACK
;

2205  
WARN_LOW_INK_COLOR
;

2210 
pSŒ
 += 21;

2211 ià(
pSS
->
	`G‘VIPV”siÚ
 () > 4)

2213 
pSŒ
 += 4;

2217 
numP’s
 = 0;

2218 ià(*
pSŒ
 > '0' && *pStr < '9')

2220 
numP’s
 = *
pSŒ
 - '0';

2222 ià(*
pSŒ
 > 'A' && *pStr < 'F')

2224 
numP’s
 = *
pSŒ
 - 'A';

2226 ià(*
pSŒ
 > 'a' && *pStr < 'f')

2228 
numP’s
 = *
pSŒ
 - 'a';

2231 
pSŒ
++;

2233 
”r
 = 
NO_ERROR
;

2234 ià(
pSS
->
	`G‘VIPV”siÚ
 () == 3)

2236 
i
 = 0; i < 
numP’s
; i++, 
pSŒ
 += 4)

2238 *
pSŒ
)

2242 ià((*(
pSŒ
+1) & 0xf3) > 1)

2244 ià(
”r
 !ğ
NO_ERROR
)

2246 
”r
 = 
WARN_LOW_INK_MULTIPLE_PENS
;

2250 
”r
 = 
WARN_LOW_INK_BLACK
;

2257 ià((*(
pSŒ
+1) & 0xf3) > 1)

2259 ià(
”r
 !ğ
NO_ERROR
)

2261 
”r
 = 
WARN_LOW_INK_MULTIPLE_PENS
;

2265 
”r
 = 
WARN_LOW_INK_CYAN
;

2272 ià((*(
pSŒ
+1) & 0xf3) > 1)

2274 ià(
”r
 !ğ
NO_ERROR
)

2276 
”r
 = 
WARN_LOW_INK_MULTIPLE_PENS
;

2280 
”r
 = 
WARN_LOW_INK_MAGENTA
;

2288 ià((*(
pSŒ
+1) & 0xf3) > 1)

2290 ià(
”r
 !ğ
NO_ERROR
)

2292 
”r
 = 
WARN_LOW_INK_MULTIPLE_PENS
;

2296 
”r
 = 
WARN_LOW_INK_YELLOW
;

2303  
”r
;

2306 
BYTE
 
³nInfoB™s
[4];

2307 
BYTE
 
bÏckšk
 = 0;

2308 
BYTE
 
cŞÜšk
 = 0;

2309 
BYTE
 
phÙošk
 = 0;

2310 
BYTE
 
g»yšk
 = 0;

2312 
i
 = 0; i < 
numP’s
; i++, 
pSŒ
 += 8)

2314 
	`AsciiHexToBš¬y
 (
³nInfoB™s
, 
pSŒ
, 8);

2316 ià((
³nInfoB™s
[0] & 0x40) != 0x40)

2320 
³nCŞÜ
 = 
³nInfoB™s
[0] & 0x3F;

2321 
³nCŞÜ
)

2324 
bÏckšk
 = 
³nInfoB™s
[1] & 0x7;

2327 
cŞÜšk
 = 
³nInfoB™s
[1] & 0x7;

2330 
phÙošk
 = 
³nInfoB™s
[1] & 0x7;

2333 
g»yšk
 = 
³nInfoB™s
[1] & 0x7;

2341 
cŞÜšk
 = 
³nInfoB™s
[1] & 0x7;

2347 ià(
bÏckšk
 < 2 && 
cŞÜšk
 < 2 && 
phÙošk
 < 2 && 
g»yšk
 < 2)

2349  
NO_ERROR
;

2351 ià(
bÏckšk
 > 1 && 
cŞÜšk
 > 1 && 
phÙošk
 > 1)

2353  
WARN_LOW_INK_COLOR_BLACK_PHOTO
;

2355 ià(
g»yšk
 > 1 && 
cŞÜšk
 > 1 && 
phÙošk
 > 1)

2357  
WARN_LOW_INK_COLOR_GREY_PHOTO
;

2359 ià(
bÏckšk
 > 1 && 
cŞÜšk
 > 1)

2361  
WARN_LOW_INK_BOTH_PENS
;

2363 ià(
bÏckšk
 > 1 && 
phÙošk
 > 1)

2365  
WARN_LOW_INK_BLACK_PHOTO
;

2367 ià(
g»yšk
 > 1 && 
cŞÜšk
 > 1)

2369  
WARN_LOW_INK_COLOR_GREY
;

2371 ià(
g»yšk
 > 1 && 
phÙošk
 > 1)

2373  
WARN_LOW_INK_GREY_PHOTO
;

2375 ià(
cŞÜšk
 > 1 && 
phÙošk
 > 1)

2377  
WARN_LOW_INK_COLOR_PHOTO
;

2379 ià(
bÏckšk
 > 1)

2381  
WARN_LOW_INK_BLACK
;

2383 ià(
cŞÜšk
 > 1)

2385  
WARN_LOW_INK_COLOR
;

2387 ià(
phÙošk
 > 1)

2389  
WARN_LOW_INK_PHOTO
;

2391 ià(
g»yšk
 > 1)

2393  
WARN_LOW_INK_GREY
;

2395 ià(
cŞÜšk
 > 1)

2397  
WARN_LOW_INK_COLOR
;

2401  
NO_ERROR
;

2403 
	}
}

2405 
	gAPDK_END_NAMESPACE


	@prnt/hpijs/dj9xxvip.h

32 #iâdeà
APDK_DJ9XXVIP_H


33 
	#APDK_DJ9XXVIP_H


	)

35 
APDK_BEGIN_NAMESPACE


42 şas 
	cDJ9xxVIP
 : 
public
 
Prš‹r


44 
public
:

45 
DJ9xxVIP
(
Sy¡emS”viûs
* 
pSS
, 
BOOL
 
´Ùo
=
FALSE
);

47 
H—d”
* 
S–eùH—d”
(
PrštCÚ‹xt
* 
pc
);

48 
DRIVER_ERROR
 
V”ifyP’Info
();

49 
DRIVER_ERROR
 
P¬£P’Info
(
PEN_TYPE
& 
eP’
, 
BOOL
 
Qu”yPrš‹r
=
TRUE
);

50 
DISPLAY_STATUS
 
P¬£E¼Ü
(
BYTE
 
¡©us_»g
);

52 
Com´essÜ
* 
C»©eCom´essÜ
(
Ra¡”Size
);

54 
vœtu®
 
BOOL
 
U£GUIMode
(
PrštMode
* 
pPrštMode
);

55 
BOOL
 
	$U£CMYK
(
iPrštMode
è{  
FALSE
; }

57 
DRIVER_ERROR
 
	`CËªP’
();

59 
vœtu®
 
PAPER_SIZE
 
	`Mªd©ÜyP­”Size
();

61 
vœtu®
 
DRIVER_ERROR
 
	`CheckInkLev–
();

63 
vœtu®
 
BOOL
 
	`PhÙoT¿yP»£Á
(BOOL 
bQu”yPrš‹r
);

65 
vœtu®
 
PHOTOTRAY_STATE
 
	`PhÙoT¿yEngaged
 (
BOOL
 
bQu”yPrš‹r
);

67 
šlše
 
vœtu®
 
BOOL
 
	$SuµÜtS•¬©eBÏck
 (
PrštMode
 *
pCu¼’tMode
)

69 ià(
pCu¼’tMode
->
medium
 =ğ
medŸAuto
 ||

70 
pCu¼’tMode
->
medium
 =ğ
medŸPÏš
)

72  
TRUE
;

74  
FALSE
;

75 
	}
}

77 
vœtu®
 
DRIVER_ERROR
 
	$S‘Hšt
 (
PRINTER_HINT
 
eHšt
, 
iV®ue
)

79 
eHšt
)

81 
PAGES_IN_DOC_HINT
:

83 
m_iNumPages
 = 
iV®ue
;

86 
SPEED_MECH_HINT
:

88  
	`S’dS³edMechCmd
 (
iV®ue
);

90 
EXTRA_DRYTIME_HINT
:

92 
m_cExŒaDryTime
 = (
BYTE
è(
iV®ue
 & 0xFF);

95 
LEFT_OVERSPRAY_HINT
:

97 
m_iLeáOv”¥¿y
 = 
iV®ue
;

100 
RIGHT_OVERSPRAY_HINT
:

102 
m_iRightOv”¥¿y
 = 
iV®ue
;

105 
TOP_OVERSPRAY_HINT
:

107 
m_iTİOv”¥¿y
 = 
iV®ue
;

110 
BOTTOM_OVERSPRAY_HINT
:

112 
m_iBÙtomOv”¥¿y
 = 
iV®ue
;

119  
NO_ERROR
;

120 
	}
}

121 
vœtu®
 
	$G‘Hšt
 (
PRINTER_HINT
 
eHšt
)

123 ià(
eHšt
 =ğ
EXTRA_DRYTIME_HINT
)

125  (è
m_cExŒaDryTime
;

128 
	}
}

130 
vœtu®
 
DRIVER_ERROR
 
AddPJLH—d”
 ();

131 
	g´Ùeùed
:

133 #ifdeà
APDK_HP_UX


134 
vœtu®
 
DJ9xxVIP
 & 
İ”©Ü
 = (
Prš‹r
& 
rhs
)

136  *
this
;

140 
BOOL
 
	gPCL3acû±sDriv”w¬e
;

141 
vœtu®
 
BYTE
 
PhÙoT¿yStus
(
BOOL
 
bQu”yPrš‹r
);

142 
	giNumMissšgP’s
;

143 
	gm_iLeáOv”¥¿y
;

144 
	gm_iTİOv”¥¿y
;

145 
	gm_iRightOv”¥¿y
;

146 
	gm_iBÙtomOv”¥¿y
;

148 
	g´iv©e
:

149 
BOOL
 
IsPCL3Driv”w¬eAvaabË
();

150 
vœtu®
 
DRIVER_ERROR
 
	$S’dS³edMechCmd
 (
BOOL
 
bLa¡Page
)

152  
NO_ERROR
;

153 
	}
}

154 
BYTE
 
	gm_cExŒaDryTime
;

158 şas 
	cDJ990Mode
 : 
public
 
PrštMode


160 
public
:

161 
DJ990Mode
();

165 şas 
	cG¿yModeDJ990
 : 
public
 
G¿yMode


167 
public
:

168 
G¿yModeDJ990
 (
ušt32_t
 *
m­
, 
BOOL
 
PCL3OK
);

171 şas 
	cDJ990CMYG¿yMode
 : 
public
 
PrštMode


173 
public
:

174 
DJ990CMYG¿yMode
 ();

177 #ifdeà
APDK_EXTENDED_MEDIASIZE


178 şas 
	cDJ990KG¿yMode
 : 
public
 
PrštMode


180 
public
:

181 
DJ990KG¿yMode
 ();

184 şas 
	cDJ9902400Mode
 : 
public
 
PrštMode


186 
public
:

187 
DJ9902400Mode
 ();

188 
vœtu®
 
šlše
 
BOOL
 
	$MedŸCom·tibË
 (
MEDIATYPE
 
eMedŸ
)

190  (
eMedŸ
 =ğ
pmMedŸTy³
 ||ƒMedŸ =ğ
MEDIA_PHOTO
);

192 
	}
};

194 şas 
	cDJ990D¿áMode
 : 
public
 
PrštMode


196 
public
:

197 
DJ990D¿áMode
 ();

202 şas 
	cDJ990Be¡Mode
 : 
public
 
PrštMode


204 
public
:

205 
DJ990Be¡Mode
 ();

208 şas 
	cDJ990PhÙoNÜm®Mode
 : 
public
 
PrštMode


210 
public
:

211 
DJ990PhÙoNÜm®Mode
 ();

214 #ifdeà
APDK_HIGH_RES_MODES


215 cÚ¡ 
	gVIP_BASE_RES
 = 600;

217 cÚ¡ 
	gVIP_BASE_RES
 = 300;

221 
	#kWh™e
 0x00FFFFFE

	)

222 
	#G‘Red
(
x
è(((x >> 16è& 0x0FF))

	)

223 
	#G‘G»’
(
x
è(((x >> 8è& 0x0FF))

	)

224 
	#G‘Blue
(
x
è((x & 0x0FF))

	)

226 
	#kB”tDecom´essPix–Size
 3

	)

229 
	#kTy³Mask
 0x80

	)

230 
	#kTy³ShiáAmouÁ
 7

	)

232 
	#kCacheL™”®B™sMask
 0x60

	)

233 
	#kCacheL™”®B™sShiáAmouÁ
 5

	)

235 
	#kCacheB™sMask
 0x60

	)

236 
	#kCacheB™sShiáAmouÁ
 5

	)

238 
	#kRoffMask
 0x18

	)

239 
	#kRoffShiáAmouÁ
 3

	)

241 
	#kR•Ïû_couÁMask
 0x07

	)

244 #ià((
kTy³Mask
 | 
kCacheL™”®B™sMask
 | 
kRoffMask
 | 
kR•Ïû_couÁMask
) != 255)

248 #ià((
kTy³Mask
 | 
kCacheB™sMask
 | 
kRoffMask
 | 
kR•Ïû_couÁMask
) != 255)

255 
	meL™”®
 = 0,

256 
	meRLE
 = 0x80

261 
	m“NewPix–
 = 0x0,

262 
	m“WPix–
 = 0x20,

263 
	m“NEPix–
 = 0x40,

264 
	m“CachedCŞÜ
 = 0x60

269 
	meNewCŞÜ
 = 0x0,

270 
	meWe¡CŞÜ
 = 0x1,

271 
	meNÜthEa¡CŞÜ
 = 0x2,

272 
	meCachedCŞÜ
 = 0x3

277 
	#M10_MAX_OFFSET0
 2

	)

278 
	#M10_MAX_COUNT0
 6

	)

279 
	#M10_COUNT_START0
 1

	)

282 
	#M10_MAX_OFFSET1
 2

	)

283 
	#M10_MAX_COUNT1
 6

	)

284 
	#M10_COUNT_START1
 2

	)

286 #iâdeà
MIN


287 
	#MIN
(
a
,
b
è((×)>=(b))?(b):×))

	)

289 #iâdeà
MAX


290 
	#MAX
(
a
,
b
è((×)<=(b))?(b):×))

	)

307 
	#g‘Pix–
 
g‘3Pix–


	)

308 
	#putPix–
 
put3Pix–


	)

309 cÚ¡ 
	gBYTES_PER_PIXEL
 = 3;

316 şas 
	cMode10
 : 
public
 
Com´essÜ


318 
public
:

319 
Mode10
(
Sy¡emS”viûs
* 
pSys
, 
Prš‹r
* 
pPrš‹r
, 
Ra¡”Size
);

320 
	mvœtu®
 ~
Mode10
();

321 
BOOL
 
Proûss
(
RASTERDATA
* 
šput
);

322 
BYTE
* 
NextOuutRa¡”
(
COLORTYPE
 
cŞÜ
);

323 
Flush
();

325 
	m´iv©e
:

326 
Prš‹r
* 
thePrš‹r
;

328 
šlše
 
ušt32_t
 
	$g‘4Pix–
(*
pixAdd»ss
, 
bPršt
 = 
FALSE
)

330 #ifdeà
APDK_LITTLE_ENDIAN


331  (((*)
pixAdd»ss
)[0]è& 
kWh™e
;

333  (((*)
pixAdd»ss
)[0]) & 0xFFFFFF00;

338 
šlše
 
ušt32_t
 
	$g‘4Pix–
(*
pixAdd»ss
, 
pix–Off£t
)

340 #ifdeà
APDK_LITTLE_ENDIAN


341  ((*)
pixAdd»ss
)[
pix–Off£t
] & 
kWh™e
;

343  ((*)
pixAdd»ss
)[
pix–Off£t
] & 0xFFFFFF00;

345 
	}
}

348 
šlše
 
	$put4Pix–
(*
pixAdd»ss
, 
pix–Off£t
, 
ušt32_t
 
pix–
)

350 #ifdeà
APDK_LITTLE_ENDIAN


351 (((*)
pixAdd»ss
)[
pix–Off£t
] = 
pix–
 & 
kWh™e
);

353 (((*)
pixAdd»ss
)[
pix–Off£t
] = 
pix–
 & 0xFFFFFF00);

355 
	}
}

358 
šlše
 
	$ouutVLIBy‹sCÚ£cutiv–y
(
numb”
, *&
com´es£dD©aPŒ
)

362 *
com´es£dD©aPŒ
++ = 
	`MIN
(
numb”
, 255);

363 ià(255 =ğ
numb”
)

365 *
com´es£dD©aPŒ
++ = 0;

367 
numb”
 -ğ
	`MIN
(number,255);

368 } 
numb”
);

369 
	}
}

372 
put3Pix–
(
BYTE
* 
pixAdd»ss
, 
pix–Off£t
, 
ušt32_t
 
pix–
);

373 
šlše
 
ušt32_t
 
g‘3Pix–
(
BYTE
* 
pixAdd»ss
, 
pix–Off£t
);

374 
ShÜtD–
(
ušt32_t
 
Ï¡Pix–
, ušt32_ˆ
Ï¡Uµ”Pix–
);

379 #ifdeà
APDK_DJ9xxVIP


383 şas 
	cDJ9xxVIPProxy
 : 
public
 
Prš‹rProxy


385 
public
:

386 
	$DJ9xxVIPProxy
(è: 
	`Prš‹rProxy
(

404 #ifdeà
APDK_MLC_PRINTER


408 è{
m_iPrš‹rTy³
 = 
eDJ9xxVIP
;}

409 
šlše
 
Prš‹r
* 
	$C»©ePrš‹r
(
Sy¡emS”viûs
* 
pSS
ècÚ¡ {  
Ãw
 
	`DJ9xxVIP
ÕSS); 
	}
}

410 
šlše
 
PRINTER_TYPE
 
	$G‘Prš‹rTy³
(ècÚ¡ {  
eDJ9xxVIP
;
	}
}

411 
šlše
 
	$G‘Mod–B™
(ècÚ¡ {  0x10000;
	}
}

415 
	gAPDK_END_NAMESPACE


	@prnt/hpijs/djd2600.h

32 #iâdeà
APDK_DJD2600_H


33 
	#APDK_DJD2600_H


	)

34 #ià
defšed
(
APDK_DJ3600
è&& defšed (
APDK_DJ3320
)

36 
APDK_BEGIN_NAMESPACE


42 şas 
	cDJD2600
 : 
public
 
DJ4100


44 
public
:

45 
	$DJD2600
 (
Sy¡emS”viûs
* 
pSS
, 
BOOL
 
´Ùo
 = 
FALSE
è: 
	$DJ4100
 (
pSS
, 
´Ùo
)

47 
m_iBÏckP’ResŞutiÚ
 = 600;

48 
m_iNumBÏckNozzËs
 = 336;

50 
	}
};

53 #ià
defšed
(
APDK_DJ3600
è&& defšed (
APDK_DJ3320
)

57 şas 
	cDJD2600Proxy
 : 
public
 
Prš‹rProxy


59 
public
:

60 
	$DJD2600Proxy
(è: 
	`Prš‹rProxy
(

64 è{
m_iPrš‹rTy³
 = 
eDJD2600
;}

65 
šlše
 
Prš‹r
* 
	$C»©ePrš‹r
(
Sy¡emS”viûs
* 
pSS
ècÚ¡ {  
Ãw
 
	`DJD2600
ÕSS); 
	}
}

66 
šlše
 
PRINTER_TYPE
 
	$G‘Prš‹rTy³
(ècÚ¡ {  
eDJD2600
;
	}
}

67 
šlše
 
	$G‘Mod–B™
(ècÚ¡ {  0x2;
	}
}

71 
	gAPDK_END_NAMESPACE


	@prnt/hpijs/djgenericvip.cpp

32 #ià
defšed
(
APDK_DJGENERICVIP
è&& defšed (
APDK_DJ9xxVIP
)

34 
	~"h—d”.h
"

35 
	~"dj9xxv.h
"

36 
	~"djg’”icv.h
"

37 
	~"´š‹½roxy.h
"

39 
APDK_BEGIN_NAMESPACE


41 
ušt32_t
 
ulM­DJ600_CCM_K
[ 9 * 9 * 9 ];

49 
	gDJG’”icVIP
::
	$DJG’”icVIP
 (
Sy¡emS”viûs
* 
pSS
, 
BOOL
 
´Ùo
)

50 : 
	$DJ9xxVIP
 (
pSS
, 
´Ùo
)

53 ià(!
´Ùo
 && 
IOMode
.
bDevID
)

55 
bCheckFÜCªûlBu‰Ú
 = 
TRUE
;

56 
cÚ¡ruùÜ_”rÜ
 = 
	`V”ifyP’Info
 ();

57 ià(
cÚ¡ruùÜ_”rÜ
 !ğ
NO_ERROR
)

59 
cÚ¡ruùÜ_”rÜ
 = 
NO_ERROR
;

60 
eP’
 = 
BOTH_PENS
;

64 
eP’
 = 
BOTH_PENS
;

74 
pMode
[
ModeCouÁ
++] = 
Ãw
 
	`VIPFa¡D¿áMode
 ();

75 
pMode
[
ModeCouÁ
++] = 
Ãw
 
	`VIPG¿yFa¡D¿áMode
 ();

76 
pMode
[
ModeCouÁ
++] = 
Ãw
 
	`VIPAutoPQMode
 ();

77 
pMode
[
ModeCouÁ
++] = 
Ãw
 
	`VIPFa¡PhÙoMode
 ();

78 
pMode
[
ModeCouÁ
++] = 
Ãw
 
	`VIPCDDVDMode
 ();

80 #ifdeà
APDK_EXTENDED_MEDIASIZE


81 
pMode
[
ModeCouÁ
++] = 
Ãw
 
	`VIPBrochu»NÜm®Mode
 ();

82 
pMode
[
ModeCouÁ
++] = 
Ãw
 
	`VIPP»miumNÜm®Mode
 ();

83 
pMode
[
ModeCouÁ
++] = 
Ãw
 
	`VIPPÏšBe¡Mode
 ();

84 
pMode
[
ModeCouÁ
++] = 
Ãw
 
	`VIPBrochu»Be¡Mode
 ();

85 
pMode
[
ModeCouÁ
++] = 
Ãw
 
	`VIPP»miumBe¡Mode
 ();

88 
i
 = 0; i < (è
ModeCouÁ
; i++)

90 
pMode
[
i
]->
bFÚtC­abË
 = 
FALSE
;

91 
j
 = 
BLACK_PEN
; j < 
MAX_COMPATIBLE_PENS
; j++)

93 
pMode
[
i
]->
Com·tibËP’s
[
j
] = (
PEN_TYPE
) j;

96 #ifdeà
APDK_EXTENDED_MEDIASIZE


102 
pMode
[4]->
theQu®™y
 = 
qu®™yM¬v–lous
;

104 
	}
}

106 
	gVIPFa¡D¿áMode
::
	$VIPFa¡D¿áMode
 (è: 
	$PrštMode
 (
NULL
)

108 
bFÚtC­abË
 = 
FALSE
;

109 #ifdeà
APDK_AUTODUPLEX


110 
bDu¶exC­abË
 = 
TRUE
;

112 #ià
	`defšed
(
APDK_VIP_COLORFILTERING
)

113 
CÚfig
.
bEº›
 = 
TRUE
;

116 
CÚfig
.
bCŞÜImage
 = 
FALSE
;

118 
medium
 = 
medŸPÏš
;

119 
theQu®™y
 = 
qu®™yFa¡D¿á
;

120 
pmQu®™y
 = 
QUALITY_FASTDRAFT
;

121 
pmMedŸTy³
 = 
MEDIA_PLAIN
;

122 
	}
}

124 
	gVIPG¿yFa¡D¿áMode
::
	$VIPG¿yFa¡D¿áMode
 (è: 
	$G¿yMode
 (
ulM­DJ600_CCM_K
)

126 
bFÚtC­abË
 = 
FALSE
;

128 #ià
	`defšed
(
APDK_VIP_COLORFILTERING
)

129 
CÚfig
.
bEº›
 = 
TRUE
;

132 
CÚfig
.
bCŞÜImage
 = 
FALSE
;

134 #ifdeà
APDK_AUTODUPLEX


135 
bDu¶exC­abË
 = 
TRUE
;

138 
dyeCouÁ
 = 1;

139 
medium
 = 
medŸPÏš
;

140 
theQu®™y
 = 
qu®™yFa¡D¿á
;

141 
pmQu®™y
 = 
QUALITY_FASTDRAFT
;

142 
pmMedŸTy³
 = 
MEDIA_PLAIN
;

143 
pmCŞÜ
 = 
GREY_K
;

144 
	}
}

146 
	gVIPFa¡PhÙoMode
::
	$VIPFa¡PhÙoMode
 (è: 
	$PrštMode
 (
NULL
)

148 
bFÚtC­abË
 = 
FALSE
;

149 #ià
	`defšed
(
APDK_VIP_COLORFILTERING
)

150 
CÚfig
.
bEº›
 = 
FALSE
;

152 
medium
 = 
medŸHigh»sPhÙo
;

153 
theQu®™y
 = 
qu®™yFa¡D¿á
;

154 
pmQu®™y
 = 
QUALITY_FASTDRAFT
;

155 
pmMedŸTy³
 = 
MEDIA_PHOTO
;

156 
	}
}

158 
	gVIPAutoPQMode
::
	$VIPAutoPQMode
 (è: 
	$PrštMode
 (
NULL
)

160 
Ba£ResX
 =

161 
Ba£ResY
 = 600;

162 
ResŞutiÚX
[0] = 600;

163 
ResŞutiÚY
[0] = 600;

164 
bFÚtC­abË
 = 
FALSE
;

165 #ifdeà
APDK_AUTODUPLEX


166 
bDu¶exC­abË
 = 
FALSE
;

168 #ià
	`defšed
(
APDK_VIP_COLORFILTERING
)

169 
CÚfig
.
bEº›
 = 
TRUE
;

172 
CÚfig
.
bCŞÜImage
 = 
FALSE
;

174 
medium
 = 
medŸAuto
;

175 
theQu®™y
 = 
qu®™yAuto
;

176 
pmQu®™y
 = 
QUALITY_AUTO
;

177 
	}
}

179 
	gVIPCDDVDMode
::
	$VIPCDDVDMode
 (è: 
	$PrštMode
 (
NULL
)

181 
Ba£ResX
 =

182 
Ba£ResY
 = 600;

183 
ResŞutiÚX
[0] = 600;

184 
ResŞutiÚY
[0] = 600;

185 
bFÚtC­abË
 = 
FALSE
;

186 #ifdeà
APDK_AUTODUPLEX


187 
bDu¶exC­abË
 = 
FALSE
;

189 #ià
	`defšed
(
APDK_VIP_COLORFILTERING
)

190 
CÚfig
.
bEº›
 = 
TRUE
;

193 
CÚfig
.
bCŞÜImage
 = 
FALSE
;

195 
medium
 = 
medŸCDDVD
;

196 
theQu®™y
 = 
qu®™yP»£Á©iÚ
;

197 
pmQu®™y
 = 
QUALITY_BEST
;

198 
pmMedŸTy³
 = 
MEDIA_CDDVD
;

199 
	}
}

201 
	gVIPBrochu»NÜm®Mode
::
	$VIPBrochu»NÜm®Mode
 (è: 
	$PrštMode
 (
NULL
)

203 
Ba£ResX
 =

204 
Ba£ResY
 = 600;

205 
ResŞutiÚX
[0] = 600;

206 
ResŞutiÚY
[0] = 600;

207 
bFÚtC­abË
 = 
FALSE
;

208 #ifdeà
APDK_AUTODUPLEX


209 
bDu¶exC­abË
 = 
TRUE
;

211 #ià
	`defšed
(
APDK_VIP_COLORFILTERING
)

212 
CÚfig
.
bEº›
 = 
TRUE
;

215 
CÚfig
.
bCŞÜImage
 = 
FALSE
;

217 
medium
 = 
medŸBrochu»
;

218 
theQu®™y
 = 
qu®™yNÜm®
;

219 
pmQu®™y
 = 
QUALITY_NORMAL
;

220 
pmMedŸTy³
 = 
MEDIA_BROCHURE
;

221 
	}
}

223 
	gVIPP»miumNÜm®Mode
::
	$VIPP»miumNÜm®Mode
 (è: 
	$PrštMode
 (
NULL
)

225 
Ba£ResX
 =

226 
Ba£ResY
 = 600;

227 
ResŞutiÚX
[0] = 600;

228 
ResŞutiÚY
[0] = 600;

229 
bFÚtC­abË
 = 
FALSE
;

230 #ifdeà
APDK_AUTODUPLEX


231 
bDu¶exC­abË
 = 
TRUE
;

233 #ià
	`defšed
(
APDK_VIP_COLORFILTERING
)

234 
CÚfig
.
bEº›
 = 
TRUE
;

237 
CÚfig
.
bCŞÜImage
 = 
FALSE
;

239 
medium
 = 
medŸS³cŸl
;

240 
theQu®™y
 = 
qu®™yNÜm®
;

241 
pmQu®™y
 = 
QUALITY_NORMAL
;

242 
pmMedŸTy³
 = 
MEDIA_PREMIUM
;

243 
	}
}

245 
	gVIPPÏšBe¡Mode
::
	$VIPPÏšBe¡Mode
 (è: 
	$PrštMode
 (
NULL
)

247 
Ba£ResX
 =

248 
Ba£ResY
 = 600;

249 
ResŞutiÚX
[0] = 600;

250 
ResŞutiÚY
[0] = 600;

251 
bFÚtC­abË
 = 
FALSE
;

252 #ifdeà
APDK_AUTODUPLEX


253 
bDu¶exC­abË
 = 
TRUE
;

255 #ià
	`defšed
(
APDK_VIP_COLORFILTERING
)

256 
CÚfig
.
bEº›
 = 
TRUE
;

259 
CÚfig
.
bCŞÜImage
 = 
FALSE
;

261 
medium
 = 
medŸPÏš
;

262 
theQu®™y
 = 
qu®™yP»£Á©iÚ
;

263 
pmQu®™y
 = 
QUALITY_BEST
;

264 
pmMedŸTy³
 = 
MEDIA_PLAIN
;

266 
	}
}

268 
	gVIPBrochu»Be¡Mode
::
	$VIPBrochu»Be¡Mode
 (è: 
	$PrštMode
 (
NULL
)

270 
Ba£ResX
 =

271 
Ba£ResY
 = 600;

272 
ResŞutiÚX
[0] = 600;

273 
ResŞutiÚY
[0] = 600;

274 
bFÚtC­abË
 = 
FALSE
;

275 #ifdeà
APDK_AUTODUPLEX


276 
bDu¶exC­abË
 = 
TRUE
;

278 #ià
	`defšed
(
APDK_VIP_COLORFILTERING
)

279 
CÚfig
.
bEº›
 = 
TRUE
;

282 
CÚfig
.
bCŞÜImage
 = 
FALSE
;

284 
medium
 = 
medŸBrochu»
;

285 
theQu®™y
 = 
qu®™yP»£Á©iÚ
;

286 
pmQu®™y
 = 
QUALITY_BEST
;

287 
pmMedŸTy³
 = 
MEDIA_BROCHURE
;

288 
	}
}

290 
	gVIPP»miumBe¡Mode
::
	$VIPP»miumBe¡Mode
 (è: 
	$PrštMode
 (
NULL
)

292 
Ba£ResX
 =

293 
Ba£ResY
 = 600;

294 
ResŞutiÚX
[0] = 600;

295 
ResŞutiÚY
[0] = 600;

296 
bFÚtC­abË
 = 
FALSE
;

297 #ifdeà
APDK_AUTODUPLEX


298 
bDu¶exC­abË
 = 
TRUE
;

300 #ià
	`defšed
(
APDK_VIP_COLORFILTERING
)

301 
CÚfig
.
bEº›
 = 
TRUE
;

304 
CÚfig
.
bCŞÜImage
 = 
FALSE
;

306 
medium
 = 
medŸS³cŸl
;

307 
theQu®™y
 = 
qu®™yP»£Á©iÚ
;

308 
pmQu®™y
 = 
QUALITY_BEST
;

309 
pmMedŸTy³
 = 
MEDIA_PREMIUM
;

310 
	}
}

312 
BOOL
 
	gDJG’”icVIP
::
	$U£GUIMode
 (
PrštMode
* 
pPrštMode
)

314  
TRUE
;

315 
	}
}

323 
PAPER_SIZE
 
	gDJG’”icVIP
::
	$Mªd©ÜyP­”Size
 ()

325 
BYTE
 
sDevIdSŒ
[
DevIDBuffSize
];

326 *
pSŒ
;

339 ià((
pSS
->
	`G‘DeviûID
 (
sDevIdSŒ
, 
DevIDBuffSize
, 
FALSE
)è=ğ
NO_ERROR
)

341 ià((
pSŒ
 = 
	`¡r¡r
 ((*è
sDevIdSŒ
, ";S:")è&& (
pSS
->
	`G‘VIPV”siÚ
 ()) >= 3)

343 #ifdeà
APDK_EXTENDED_MEDIASIZE


344 
PAPER_SIZE
 
P­”Sizes
[8] = {
UNSUPPORTED_SIZE
, 
A6
, 
LETTER
, 
B4
, 
SUPERB_SIZE
, UNSUPPORTED_SIZE, UNSUPPORTED_SIZE, UNSUPPORTED_SIZE};

346 
PAPER_SIZE
 
P­”Sizes
[8] = {
UNSUPPORTED_SIZE
, 
A6
, 
LETTER
, 
B4
, UNSUPPORTED_SIZE, UNSUPPORTED_SIZE, UNSUPPORTED_SIZE, UNSUPPORTED_SIZE};

348 
by‹12
 = 
pSŒ
[17];

349 
v®ue
 = (
by‹12
 >= '0' && byte12 <= '9') ? byte12 - '0' :

350 ((
by‹12
 >= 'A' && byte12 <= 'F') ? byte12 - 'A' + 10 :

351 ((
by‹12
 >= 'a' && byte12 <= 'f') ? byte12 - 'a' + 10 : -1));

352  (
v®ue
 =ğ-1è? 
UNSUPPORTED_SIZE
 : 
P­”Sizes
[(value & 0x07)];

355  
UNSUPPORTED_SIZE
;

356 
	}
}

370 
BOOL
 
	gDJG’”icVIP
::
	$FuÎBËedC­abË
 (
PAPER_SIZE
 
ps
, 
FuÎbËedTy³
 *
fbTy³
, *
xOv”S´ay
, *
yOv”S´ay
,

371 *
fLeáOv”S´ay
, *
fTİOv”S´ay
)

373 
BYTE
 
sDevIdSŒ
[
DevIDBuffSize
];

374 *
pSŒ
;

375 
sDevIdSŒ
[0] = 0;

378 ià(
this
->
m_iTİOv”¥¿y
 &&his->
m_iLeáOv”¥¿y
 &&his->
m_iRightOv”¥¿y
 &&his->
m_iBÙtomOv”¥¿y
)

386 ià(
fTİOv”S´ay
)

387 *
fTİOv”S´ay
 = (è
this
->
m_iTİOv”¥¿y
 / () 1000.0;

388 ià(
fLeáOv”S´ay
)

389 *
fLeáOv”S´ay
 = (è
this
->
m_iLeáOv”¥¿y
 / () 1000.0;

391 *
xOv”S´ay
 = (è(
this
->
m_iLeáOv”¥¿y
 +his->
m_iRightOv”¥¿y
) / () 1000.0;

392 *
yOv”S´ay
 = (è(
this
->
m_iTİOv”¥¿y
 +his->
m_iBÙtomOv”¥¿y
) / () 1000.0;

394 *
fbTy³
 = 
fuÎbËed4EdgeAÎMedŸ
;

396  
TRUE
;

399 ià((
pSS
->
	`G‘DeviûID
 (
sDevIdSŒ
, 
DevIDBuffSize
, 
FALSE
)è=ğ
NO_ERROR
)

401 ià((
pSŒ
 = 
	`¡r¡r
 ((*è
sDevIdSŒ
, ";S:")è&& (
pSS
->
	`G‘VIPV”siÚ
 ()) >= 3)

403 
by‹13
 = 
pSŒ
[18];

404 
v®ue
 = (
by‹13
 >= '0' && byte13 <= '9') ? byte13 - '0' :

405 ((
by‹13
 >= 'A' && byte13 <= 'F') ? byte13 - 'A' + 10 :

406 ((
by‹13
 >= 'a' && byte13 <= 'f') ? byte13 - 'a' + 10 : -1));

407 
ps
)

409 
PHOTO_SIZE
:

410 
A6
:

411 
CARD_4x6
:

412 
OUFUKU
:

413 
HAGAKI
:

414 
A6_WITH_TEAR_OFF_TAB
:

415 
CUSTOM_SIZE
:

417 *
xOv”S´ay
 = () 0.12;

418 *
yOv”S´ay
 = () 0.06;

420 ià(
fLeáOv”S´ay
)

421 *
fLeáOv”S´ay
 = () 0.05;

422 ià(
fTİOv”S´ay
)

423 *
fTİOv”S´ay
 = () 0.03;

425 ià(
ps
 =ğ
PHOTO_SIZE
 ||… =ğ
A6_WITH_TEAR_OFF_TAB
)

426 *
fbTy³
 = 
fuÎbËed4EdgeAÎMedŸ
;

427 ià((
v®ue
 != -1) && ((value & 0x03) == 0x03))

428 *
fbTy³
 = 
fuÎbËed4EdgeAÎMedŸ
;

429 ià((
v®ue
 != -1) && ((value & 0x01) == 0x01))

430 *
fbTy³
 = 
fuÎbËed4EdgePhÙoMedŸ
;

431 ià((
v®ue
 != -1) && ((value & 0x02) == 0x02))

432 *
fbTy³
 = 
fuÎbËed4EdgeNÚPhÙoMedŸ
;

434 *
fbTy³
 = 
fuÎbËed3EdgeAÎMedŸ
;

436  
TRUE
;

442 ià((
v®ue
 != -1) && (value & 0x03))

444 *
xOv”S´ay
 = () 0.216;

445 *
yOv”S´ay
 = () 0.149;

446 ià(
fLeáOv”S´ay
)

447 *
fLeáOv”S´ay
 = () 0.098;

448 ià(
fTİOv”S´ay
)

449 *
fTİOv”S´ay
 = () 0.051;

451 ià((
v®ue
 & 0x03) == 0x03)

452 *
fbTy³
 = 
fuÎbËed4EdgeAÎMedŸ
;

453 ià((
v®ue
 & 0x01) == 0x01)

454 *
fbTy³
 = 
fuÎbËed4EdgePhÙoMedŸ
;

455 ià((
v®ue
 & 0x02) == 0x02)

456 *
fbTy³
 = 
fuÎbËed4EdgeNÚPhÙoMedŸ
;

458  
TRUE
;

463 *
xOv”S´ay
 = () 0;

464 *
yOv”S´ay
 = () 0;

465 ià(
fLeáOv”S´ay
)

466 *
fLeáOv”S´ay
 = () 0;

467 ià(
fTİOv”S´ay
)

468 *
fTİOv”S´ay
 = () 0;

469 *
fbTy³
 = 
fuÎbËedNÙSuµÜ‹d
;

470  
FALSE
;

475 
ps
)

477 
PHOTO_SIZE
:

478 
A6
:

479 
CARD_4x6
:

480 
OUFUKU
:

481 
HAGAKI
:

482 
A6_WITH_TEAR_OFF_TAB
:

483 
LETTER
:

484 
A4
:

485 
CUSTOM_SIZE
:

487 *
xOv”S´ay
 = () 0.12;

488 *
yOv”S´ay
 = () 0.06;

490 ià(
fLeáOv”S´ay
)

491 *
fLeáOv”S´ay
 = () 0.05;

492 ià(
fTİOv”S´ay
)

493 *
fTİOv”S´ay
 = () 0.03;

495 ià(
ps
 =ğ
PHOTO_SIZE
 ||… =ğ
A6_WITH_TEAR_OFF_TAB
)

496 *
fbTy³
 = 
fuÎbËed4EdgeAÎMedŸ
;

497 ià(
ps
==
LETTER
||ps==
A4
||ps==
CUSTOM_SIZE
)

499 *
fbTy³
 = 
fuÎbËed4EdgeAÎMedŸ
;

500 *
xOv”S´ay
 = () 0.1;

501 *
yOv”S´ay
 = () 0.1;

502 ià(
fLeáOv”S´ay
)

503 *
fLeáOv”S´ay
 = () 0.05;

504 ià(
fTİOv”S´ay
)

505 *
fTİOv”S´ay
 = () 0.05;

508 *
fbTy³
 = 
fuÎbËed3EdgeAÎMedŸ
;

510  
TRUE
;

516 *
xOv”S´ay
 = () 0;

517 *
yOv”S´ay
 = () 0;

518 ià(
fLeáOv”S´ay
)

519 *
fLeáOv”S´ay
 = () 0;

520 ià(
fTİOv”S´ay
)

521 *
fTİOv”S´ay
 = () 0;

522 *
fbTy³
 = 
fuÎbËedNÙSuµÜ‹d
;

523  
FALSE
;

524 
	}
}

526 
BOOL
 
	gDJG’”icVIP
::
	$G‘M¬gšs
 (
PAPER_SIZE
 
ps
, *
fM¬gšs
)

528 
xo
, 
yo
, 
xl
, 
yt
;

529 
FuÎbËedTy³
 
fbTy³
 = 
fuÎbËedNÙSuµÜ‹d
;

531 ià(
ps
 =ğ
CDDVD_120
 ||… =ğ
CDDVD_80
)

533 
fM¬gšs
[0] = () 0.06;

534 
fM¬gšs
[1] = () 0.06;

535 
fM¬gšs
[2] = () 0.06;

536 
fM¬gšs
[3] = () 0.06;

537  
TRUE
;

540 
fM¬gšs
[0] = () 0.125;

541 
fM¬gšs
[1] = () 0.125;

542 
fM¬gšs
[2] = () 0.125;

543 
fM¬gšs
[3] = () 0.5;

544 ià((
	`FuÎBËedC­abË
 (
ps
, &
fbTy³
, &
xo
, &
yo
, &
xl
, &
yt
)) &&

545 (
fbTy³
 =ğ
fuÎbËed4EdgeAÎMedŸ
 ||

546 
fbTy³
 =ğ
fuÎbËed4EdgePhÙoMedŸ
 ||

547 
fbTy³
 =ğ
fuÎbËed4EdgeNÚPhÙoMedŸ
))

549 
fM¬gšs
[3] = () 0.125;

552 ià(
ps
 =ğ
SUPERB_SIZE
)

554 
fM¬gšs
[0] = () 0.125;

555 
fM¬gšs
[1] = () 0.5;

556 
fM¬gšs
[2] = () 0.125;

557 
fM¬gšs
[3] = () 0.75;

560  
TRUE
;

561 
	}
}

564 
PHOTOTRAY_STATE
 
	gDJG’”icVIP
::
	$PhÙoT¿yEngaged
 (
BOOL
 
bQu”yPrš‹r
)

566  
UNKNOWN
;

567 
	}
}

570 
BOOL
 
	gDJG’”icVIP
::
	$HagakiF“dP»£Á
(
BOOL
 
bQu”yPrš‹r
)

572 
DRIVER_ERROR
 
”r
;

573 * 
pSŒ
;

575 
BYTE
 
bDevIDBuff
[
DevIDBuffSize
];

577 ià(!
IOMode
.
bDevID
)

579 
bQu”yPrš‹r
 = 
FALSE
;

582 
”r
 = 
pSS
->
	`G‘DeviûID
(
bDevIDBuff
, 
DevIDBuffSize
, 
bQu”yPrš‹r
);

583 ià(
”r
!=
NO_ERROR
)

588 iàĞ(
pSŒ
=(*)
	`¡r¡r
((cÚ¡ *)
bDevIDBuff
+2,";S:")è=ğ
NULL
 )

594 
pSŒ
 += 8;

595 
BYTE
 
b
 = *
pSŒ
;

596  ((
b
 & 4) == 4);

597 
	}
}

599 #ifdeà
APDK_AUTODUPLEX


601 
BOOL
 
	gDJG’”icVIP
::
	$HagakiF“dDu¶ex”P»£Á
(
BOOL
 
bQu”yPrš‹r
)

603 
DRIVER_ERROR
 
”r
;

604 * 
pSŒ
;

606 
BYTE
 
bDevIDBuff
[
DevIDBuffSize
];

608 ià(!
IOMode
.
bDevID
)

610 
bQu”yPrš‹r
 = 
FALSE
;

613 
”r
 = 
pSS
->
	`G‘DeviûID
 (
bDevIDBuff
, 
DevIDBuffSize
, 
bQu”yPrš‹r
);

614 ià(
”r
!=
NO_ERROR
)

619 iàĞ(
pSŒ
=(*)
	`¡r¡r
((cÚ¡ *)
bDevIDBuff
+2,";S:")è=ğ
NULL
 )

625 
pSŒ
 += 6;

626 
BYTE
 
b
 = *
pSŒ
;

627  ((
b
 & 4) == 4);

628 
	}
}

632 
DRIVER_ERROR
 
	gDJG’”icVIP
::
	$V”ifyP’Info
 ()

635 
DRIVER_ERROR
 
”r
 = 
NO_ERROR
;

637 ià(
IOMode
.
bDevID
 =ğ
FALSE
)

638  
”r
;

640 
eP’
 = 
NO_PEN
;

642 
”r
 = 
	`P¬£P’Info
 (
eP’
);

644 if(
”r
 =ğ
UNSUPPORTED_PEN
)

648 ià(
pSS
->
	`BusyWa™
 ((
DWORD
è2000è=ğ
JOB_CANCELED
)

650  
JOB_CANCELED
;

653 
DWORD
 
Ëngth
 =  (
DJ895_Pow”_On
);

654 
”r
 = 
pSS
->
	`ToDeviû
 (
DJ895_Pow”_On
, &
Ëngth
);

655 
ERRCHECK
;

657 
”r
 = 
pSS
->
	`FlushIO
 ();

658 
ERRCHECK
;

661 ià(
pSS
->
	`BusyWa™
 ((
DWORD
è2500è=ğ
JOB_CANCELED
)

663  
JOB_CANCELED
;

666 
”r
 = 
	`P¬£P’Info
 (
eP’
);

669 
ERRCHECK
;

678 
BYTE
 
sDevIdSŒ
[
DevIDBuffSize
];

679 *
pSŒ
;

680 
BOOL
 
bN“dAÎP’s
 = 
FALSE
;

682 ià(
iNumMissšgP’s
 > 0 && ((
pSS
->
	`G‘DeviûID
 (
sDevIdSŒ
, 
DevIDBuffSize
, 
FALSE
)è=ğ
NO_ERROR
))

684 ià((
pSŒ
 = 
	`¡r¡r
 ((*è
sDevIdSŒ
, ";S:")))

686 
by‹7
 = 
pSŒ
[12];

687 
v®ue
 = (
by‹7
 >= '0' && byte7 <= '9') ? byte7 - '0' :

688 ((
by‹7
 >= 'A' && byte7 <= 'F') ? byte7 - 'A' + 10 :

689 ((
by‹7
 >= 'a' && byte7 <= 'f') ? byte7 - 'a' + 10 : 0));

690 
bN“dAÎP’s
 = !(
v®ue
 & 0x04);

694 
eP’
 =ğ
NO_PEN
 || (
bN“dAÎP’s
 && 
iNumMissšgP’s
 > 0))

696 ià(
eP’
 =ğ
NO_PEN
 || 
iNumMissšgP’s
 > 0)

698 
pSS
->
	`Di¥ÏyPrš‹rStus
 (
DISPLAY_NO_PENS
);

700 ià(
pSS
->
	`BusyWa™
 (500è=ğ
JOB_CANCELED
)

702  
JOB_CANCELED
;

705 
”r
 = 
	`P¬£P’Info
 (
eP’
);

706 
ERRCHECK
;

709 
pSS
->
	`Di¥ÏyPrš‹rStus
(
DISPLAY_PRINTING
);

711  
NO_ERROR
;

712 
	}
}

714 
	gDJG’”icVIP
::
	$Adju¡ModeS‘tšgs
 (
BOOL
 
bDoFuÎBËed
, 
MEDIATYPE
 
ReqMedŸ
,

715 
MedŸTy³
 *
medium
, 
Qu®™y
 *
qu®™y
)

725 ià(
bDoFuÎBËed
 && *
medium
 =ğ
medŸAuto
)

728 ià(
ReqMedŸ
 =ğ
MEDIA_PHOTO
)

730 *
medium
 = 
medŸGlossy
;

731 *
qu®™y
 = 
qu®™yP»£Á©iÚ
;

736 *
medium
 = 
medŸPÏš
;

737 *
qu®™y
 = 
qu®™yNÜm®
;

744 ifĞ
ReqMedŸ
 =ğ
MEDIA_PLAIN
)

745 *
medium
 = 
medŸPÏš
;

747 ifĞ
ReqMedŸ
 =ğ
MEDIA_PREMIUM
)

748 *
medium
 = 
medŸS³cŸl
;

750 ifĞ
ReqMedŸ
 =ğ
MEDIA_BROCHURE
)

751 *
medium
 = 
medŸBrochu»
;

753 
	}
}

755 #ifdeà
APDK_LINUX


756 
DRIVER_ERROR
 
	gDJG’”icVIP
::
	$S’dS³edMechCmd
 (
BOOL
 
bLa¡Page
)

758 
DRIVER_ERROR
 
”r
 = 
NO_ERROR
;

759 
BYTE
 
szSŒ
[16];

760 ià(
m_iNumPages
 > 1)

762 
	`memıy
 (
szSŒ
, "\x1B*o5W\x0D\x02\x00\x00\x00", 10);

763 
szSŒ
[7] = (
BYTE
è((
m_iNumPages
 & 0x00FF0000) >> 16);

764 
szSŒ
[8] = (
BYTE
è((
m_iNumPages
 & 0x0000FF00) >> 8);

765 
szSŒ
[9] = (
BYTE
è(
m_iNumPages
 & 0x000000FF);

766 
”r
 = 
	`S’d
 ((cÚ¡ 
BYTE
 *è
szSŒ
, 10);

767 ià(
bLa¡Page
)

769 
”r
 = 
	`S’d
 ((cÚ¡ 
BYTE
 *) "\x1B*o5W\x0D\x05\x00\x00\x01", 10);

773 
”r
 = 
	`S’d
 ((cÚ¡ 
BYTE
 *) "\x1B*o5W\x0D\x05\x00\x00\x00", 10);

776  
”r
;

777 
	}
}

780 
H—d”
 *
	gDJG’”icVIP
::
	$S–eùH—d”
 (
PrštCÚ‹xt
 *
pc
)

782  
Ãw
 
	`H—d”DJG’”icVIP
 (
this
, 
pc
);

783 
	}
}

785 
	gH—d”DJG’”icVIP
::
	$H—d”DJG’”icVIP
 (
Prš‹r
 *
p
, 
PrštCÚ‹xt
 *
pc
è: 
	$H—d”DJ990
 (
p
, 
pc
)

787 
m_uiCAPy
 = 0;

788 
	}
}

790 
DRIVER_ERROR
 
	gH—d”DJG’”icVIP
::
	$S’dCAPy
 (
iAbsY
)

792 
¡r
[16];

793 
DRIVER_ERROR
 
”r
 = 
NO_ERROR
;

794 ià(
m_uiCAPy
 == 0)

796 
	`¥rštf
 (
¡r
, "\x1B*p%dY", 
iAbsY
);

797 
”r
 = 
thePrš‹r
->
	`S’d
 ((cÚ¡ 
BYTE
 *è
¡r
, 
	`¡¾’
 (str));

798 
m_uiCAPy
 = 
iAbsY
;

800  
”r
;

801 
	}
}

803 
DRIVER_ERROR
 
	gH—d”DJG’”icVIP
::
	$FÜmF“d
 ()

805 
BYTE
 
FF
 = 12;

806 
m_uiCAPy
 = 0;

807  
thePrš‹r
->
	`S’d
 ((cÚ¡ 
BYTE
 *è&
FF
, 1);

808 
	}
}

810 
	gAPDK_END_NAMESPACE


	@prnt/hpijs/djgenericvip.h

32 #iâdeà
APDK_DJ_GENERIC_VIP_H


33 
	#APDK_DJ_GENERIC_VIP_H


	)

35 
APDK_BEGIN_NAMESPACE


42 şas 
	cDJG’”icVIP
 : 
public
 
DJ9xxVIP


44 
public
:

45 
DJG’”icVIP
 (
Sy¡emS”viûs
* 
pSS
, 
BOOL
 
´Ùo
 = 
FALSE
);

46 
H—d”
 *
S–eùH—d”
 (
PrštCÚ‹xt
 *
pc
);

47 
DRIVER_ERROR
 
V”ifyP’Info
 ();

48 
vœtu®
 
BOOL
 
FuÎBËedC­abË
 (
PAPER_SIZE
 
ps
, 
FuÎbËedTy³
 *
fbTy³
, *
xOv”S´ay
, *
yOv”S´ay
,

49 *
fLeáOv”S´ay
, *
fTİOv”S´ay
);

50 
vœtu®
 
BOOL
 
U£GUIMode
 (
PrštMode
 *
pPrštMode
);

51 
vœtu®
 
PAPER_SIZE
 
Mªd©ÜyP­”Size
 ();

52 
vœtu®
 
PHOTOTRAY_STATE
 
PhÙoT¿yEngaged
 (
BOOL
 
bQu”yPrš‹r
);

54 
vœtu®
 
BOOL
 
HagakiF“dP»£Á
(BOOL 
bQu”yPrš‹r
);

55 
vœtu®
 
DATA_FORMAT
 
	$G‘D©aFÜm©
 (è{  
RASTER_STRIP
; }

57 #ifdeà
APDK_AUTODUPLEX


60 
vœtu®
 
BOOL
 
	`HagakiF“dDu¶ex”P»£Á
(BOOL 
bQu”yPrš‹r
);

62 
vœtu®
 
BOOL
 
	`G‘M¬gšs
 (
PAPER_SIZE
 
ps
, *
fM¬gšs
);

63 #ifdeà
APDK_LINUX


64 
vœtu®
 
DRIVER_ERROR
 
	`S’dS³edMechCmd
 (
BOOL
 
bLa¡Page
);

67 
´iv©e
:

68 
vœtu®
 
	`Adju¡ModeS‘tšgs
 (
BOOL
 
bDoFuÎBËed
, 
MEDIATYPE
 
ReqMedŸ
,

69 
MedŸTy³
 *
medium
, 
Qu®™y
 *
qu®™y
);

71 
	}
};

73 şas 
	cVIPFa¡D¿áMode
 : 
public
 
PrštMode


75 
public
:

76 
VIPFa¡D¿áMode
 ();

79 şas 
	cVIPG¿yFa¡D¿áMode
 : 
public
 
G¿yMode


81 
public
:

82 
VIPG¿yFa¡D¿áMode
 ();

85 şas 
	cVIPFa¡PhÙoMode
 : 
public
 
PrštMode


87 
public
:

88 
VIPFa¡PhÙoMode
 ();

91 şas 
	cVIPAutoPQMode
 : 
public
 
PrštMode


93 
public
:

94 
VIPAutoPQMode
 ();

97 şas 
	cVIPCDDVDMode
 : 
public
 
PrštMode


99 
public
:

100 
VIPCDDVDMode
 ();

103 şas 
	cVIPBrochu»NÜm®Mode
 : 
public
 
PrštMode


105 
public
:

106 
VIPBrochu»NÜm®Mode
 ();

109 şas 
	cVIPP»miumNÜm®Mode
 : 
public
 
PrštMode


111 
public
:

112 
VIPP»miumNÜm®Mode
 ();

115 şas 
	cVIPPÏšBe¡Mode
 : 
public
 
PrštMode


117 
public
:

118 
VIPPÏšBe¡Mode
 ();

121 şas 
	cVIPBrochu»Be¡Mode
 : 
public
 
PrštMode


123 
public
:

124 
VIPBrochu»Be¡Mode
 ();

127 şas 
	cVIPP»miumBe¡Mode
 : 
public
 
PrštMode


129 
public
:

130 
VIPP»miumBe¡Mode
 ();

133 #ià
defšed
(
APDK_DJGENERICVIP
è&& defšed (
APDK_DJ9xxVIP
)

137 şas 
	cDJG’”icVIPProxy
 : 
public
 
Prš‹rProxy


139 
public
:

140 
	$DJG’”icVIPProxy
(è: 
	`Prš‹rProxy
(

275 è{
m_iPrš‹rTy³
 = 
eDJG’”icVIP
;}

276 
šlše
 
Prš‹r
* 
	$C»©ePrš‹r
(
Sy¡emS”viûs
* 
pSS
ècÚ¡ {  
Ãw
 
	`DJG’”icVIP
ÕSS); 
	}
}

277 
šlše
 
PRINTER_TYPE
 
	$G‘Prš‹rTy³
(ècÚ¡ {  
eDJG’”icVIP
;
	}
}

278 
šlše
 
	$G‘Mod–B™
(ècÚ¡ {  0x80;
	}
}

282 
	gAPDK_END_NAMESPACE


	@prnt/hpijs/ernieplatform.h

32 
	gAPDK_BEGIN_NAMESPACE


35 #ifdeà
APDK_LITTLE_ENDIAN


36 
	#bigEndŸn
 0

	)

37 
	#l™eEndŸn
 1

	)

38 
	#G‘Red
(
x
è(((x >> 16è& 0x0FF))

	)

39 
	#G‘G»’
(
x
è(((x >> 8è& 0x0FF))

	)

40 
	#G‘Blue
(
x
è((x & 0x0FF))

	)

42 
	#bigEndŸn
 1

	)

43 
	#l™eEndŸn
 0

	)

44 
	#G‘Red
(
x
è(((x >> 24è& 0x0FF))

	)

45 
	#G‘G»’
(
x
è(((x >> 16è& 0x0FF))

	)

46 
	#G‘Blue
(
x
è(((x >> 8è& 0x0FF))

	)

54 
	#kG©h”Sts
 0

	)

55 
	#kDecom´essSts
 0

	)

73 #iâdeà
MIN


74 
	#MIN
(
a
,
b
è((×)>=(b))?(b):×))

	)

76 #iâdeà
MAX


77 
	#MAX
(
a
,
b
è((×)<=(b))?(b):×))

	)

80 
	#kWh™e
 0x00FFFFFE

	)

86 
šlše
 
ušt32_t
 
	$g‘4Pix–
(*
pixAdd»ss
)

94 #ifdeà
APDK_LITTLE_ENDIAN


95  (((*)
pixAdd»ss
)[0]è& 
kWh™e
;

97  (((*)
pixAdd»ss
)[0]) & 0xFFFFFF00;

99 
	}
}

106 
šlše
 
ušt32_t
 
	$g‘4Pix–
(*
pixAdd»ss
, 
pix–Off£t
)

114 #ifdeà
APDK_LITTLE_ENDIAN


115  ((*)
pixAdd»ss
)[
pix–Off£t
] & 
kWh™e
;

117  ((*)
pixAdd»ss
)[
pix–Off£t
] & 0xFFFFFF00;

119 
	}
}

122 
put3Pix–
(*
pixAdd»ss
, 
pix–Off£t
, 
ušt32_t
 
pix–
);

128 
šlše
 
	$put4Pix–
(*
pixAdd»ss
, 
pix–Off£t
, 
ušt32_t
 
pix–
)

130 #ifdeà
APDK_LITTLE_ENDIAN


131 (((*)
pixAdd»ss
)[
pix–Off£t
] = 
pix–
 & 
kWh™e
);

133 (((*)
pixAdd»ss
)[
pix–Off£t
] = 
pix–
 & 0xFFFFFF00);

135 
	}
}

137 
	gAPDK_END_NAMESPACE


	@prnt/hpijs/filterhpa.cpp

32 #ià
defšed
(
APDK_DJ9xxVIP
è&& defšed(
APDK_VIP_COLORFILTERING
)

34 
	~"h—d”.h
"

47 
	~"”n›¶©fÜm.h
"

48 
	~"f‹rh·.h
"

50 #ià
kG©h”Sts
 == 1

51 
blockSts
[];

54 #ià((
kMemWr™esO±imize
 != 1) && (kMemWritesOptimize != 0))

58 
APDK_BEGIN_NAMESPACE


60 
šlše
 
Av”ageNRound
(
boŞ
 
roundG»’Down
, &
rFš®
, &
r0
, &
r1
, &
gFš®
, &
g0
, &
g1
, &
bFš®
, &
b0
, &
b1
);

61 
šlše
 
	$Av”ageNRound
(
boŞ
 
roundG»’Down
, &
rFš®
, &
r0
, &
r1
, &
gFš®
, &
g0
, &
g1
, &
bFš®
, &
b0
, &
b1
)

64 ià(
roundG»’Down
)

66 
rFš®
 = (
r0
 + 
r1
 + 1) / 2;

67 
gFš®
 = (
g0
 + 
g1
) / 2;

68 
bFš®
 = (
b0
 + 
b1
 + 1) / 2;

72 
rFš®
 = (
r0
 + 
r1
) / 2;

73 
gFš®
 = (
g0
 + 
g1
 + 1) / 2;

74 
bFš®
 = (
b0
 + 
b1
) / 2;

76 
	}
}

82 
	gTEº›F‹r
::
	$F‹r1RawRow
(*
cu¼PŒ
, 
rowWidthInPix–s
, *
æagsPŒ
)

84 
	`ASSERT
(
cu¼PŒ
);

85 
	`ASSERT
(
rowWidthInPix–s
 > 0);

87 
R0
, 
G0
, 
B0
, 
R1
, 
G1
, 
B1
, 
Ï¡R
, 
Ï¡G
, 
Ï¡B
;

88 cÚ¡ 
maxE¼ÜFÜFourPix–s
 = 
fMaxE¼ÜFÜTwoPix–s
 / 2;

92 
ušt32_t
 
cu¼Pix–
, 
Ï¡Pix–
;

93 
boŞ
 
Ï¡PaœAv”aged
 = 
çl£
;

94 
boŞ
 
Ï¡2by2Av”aged
 = 
çl£
;

97 
pix–Num
 = 0;…ix–Num < 
rowWidthInPix–s
;…ixelNum++)

99 ià((
pix–Num
 & 0x03) == 0x00)

101 
Ï¡2by2Av”aged
 = 
çl£
;

104 
cu¼Pix–
 = 
	`g‘4Pix–
(
cu¼PŒ
);

106 
æagsPŒ
[0] = (
e11n
|
e11s
);

108 ià(
	`isWh™e
(
cu¼Pix–
))

110 
æagsPŒ
[0] = 
eDÚe
;

111 #ià
kG©h”Sts
 == 1

112 
blockSts
[
esWh™eFound
]++;

117 ià(
æagsPŒ
[0] =ğ(
e11n
|
e11s
))

119 
R1
 = 
	`G‘Red
(
cu¼Pix–
);

120 
G1
 = 
	`G‘G»’
(
cu¼Pix–
);

121 
B1
 = 
	`G‘Blue
(
cu¼Pix–
);

124 ià(
	`isOdd
(
pix–Num
))

127 
Ï¡Pix–
 = 
	`g‘4Pix–
(
cu¼PŒ
,-1);

128 
Ï¡R
 = 
	`G‘Red
(
Ï¡Pix–
);

129 
Ï¡G
 = 
	`G‘G»’
(
Ï¡Pix–
);

130 
Ï¡B
 = 
	`G‘Blue
(
Ï¡Pix–
);

131 ià((
fMaxE¼ÜFÜTwoPix–s
 >ğ3è&& (
	`NewD–E
(
Ï¡R
, 
R1
, 
Ï¡G
, 
G1
, 
Ï¡B
, 
B1
, fMaxErrorForTwoPixels)))

137 
didNÙBud4by1
 = 
Œue
;

138 #ià
kG©h”Sts
 == 1

139 
blockSts
[
es21nw
]++;

141 
	`Av”ageNRound
(
	`isOdd
(
pix–Num
), 
Ï¡R
,†a¡R, 
R1
, 
Ï¡G
,†a¡G, 
G1
, 
Ï¡B
,†a¡B, 
B1
);

142 ià((
pix–Num
 >ğ3è&& (
æagsPŒ
[-3] & 
e21nw
))

145 
	`ASSERT
(!((
æagsPŒ
[-3] | fÏgsPŒ[-2] | fÏgsPŒ[-1] | fÏgsPŒ[0]è& 
eTheRe¡
));

147 
Ï¡Pix–
 = 
	`g‘4Pix–
(
cu¼PŒ
,-3);

148 
R0
 = 
	`G‘Red
(
Ï¡Pix–
);

149 
G0
 = 
	`G‘G»’
(
Ï¡Pix–
);

150 
B0
 = 
	`G‘Blue
(
Ï¡Pix–
);

151 ià((
maxE¼ÜFÜFourPix–s
 >ğ3è&& (
	`NewD–E
(
Ï¡R
, 
R0
, 
Ï¡G
, 
G0
, 
Ï¡B
, 
B0
, maxErrorForFourPixels)))

157 #ià
kG©h”Sts
 == 1

158 
blockSts
[
es41ni
]++;

160 
didNÙBud4by1
 = 
çl£
;

161 
	`Av”ageNRound
((
pix–Num
 & 0x04)=ğ0x04, 
Ï¡R
,†a¡R, 
R0
, 
Ï¡G
,†a¡G, 
G0
, 
Ï¡B
,†a¡B, 
B0
);

163 if(
l™eEndŸn
)

164 
cu¼Pix–
 = (
Ï¡R
<<16è+ (
Ï¡G
<<8è+ 
Ï¡B
;

165 if(
bigEndŸn
)

166 
cu¼Pix–
 = (
Ï¡R
<<24è+ (
Ï¡G
<<16è+ (
Ï¡B
<<8);

168 #ià
kMemWr™esO±imize
 == 0

169 
	`put4Pix–
(
cu¼PŒ
, -3, 
cu¼Pix–
);

170 
	`put4Pix–
(
cu¼PŒ
, -2, 
cu¼Pix–
);

171 
	`put4Pix–
(
cu¼PŒ
, -1, 
cu¼Pix–
);

172 
	`put4Pix–
(
cu¼PŒ
, 0, 
cu¼Pix–
);

174 
	`put4Pix–
(
cu¼PŒ
, -3, 
cu¼Pix–
);

176 
æagsPŒ
[-3] = (æagsPŒ[-3] & ~
eNÜths
è| 
e41ni
;

177 
æagsPŒ
[-2] = (æagsPŒ[-2] & ~
eNÜths
è| 
e41n
;

178 
æagsPŒ
[-1] = (æagsPŒ[-1] & ~
eNÜths
è| 
e41n
;

179 
æagsPŒ
[0] = (æagsPŒ[0] & ~
eNÜths
è| 
e41n
;

183 ià(
didNÙBud4by1
)

185 
	`ASSERT
(!((
æagsPŒ
[-1] | fÏgsPŒ[0]è& 
eTheRe¡
));

187 if(
l™eEndŸn
)

188 
cu¼Pix–
 = (
Ï¡R
<<16è+ (
Ï¡G
<<8è+ 
Ï¡B
;

189 if(
bigEndŸn
)

190 
cu¼Pix–
 = (
Ï¡R
<<24è+ (
Ï¡G
<<16è+ (
Ï¡B
<<8);

192 #ià
kMemWr™esO±imize
 == 0

193 
	`put4Pix–
(
cu¼PŒ
, -1, 
cu¼Pix–
);

194 
	`put4Pix–
(
cu¼PŒ
, 0, 
cu¼Pix–
);

196 
	`put4Pix–
(
cu¼PŒ
, -1, 
cu¼Pix–
);

198 
æagsPŒ
[-1] = (æagsPŒ[-1] & ~
eNÜths
è| 
e21nw
;

199 
æagsPŒ
[0] = (æagsPŒ[0] & ~
eNÜths
è| 
e21Ã
;

206 
Ï¡PaœAv”aged
 = 
çl£
;

209 
cu¼PŒ
 +ğ
eBufã»dPix–WidthInBy‹s
;

210 
æagsPŒ
++;

212 
	}
}

219 
	gTEº›F‹r
::
	$F‹r2RawRows
(*
cu¼PŒ
, *
upPŒ
, 
rowWidthInPix–s
, *
æagsPŒ
)

221 
	`ASSERT
(
cu¼PŒ
);

222 
	`ASSERT
(
upPŒ
);

223 
	`ASSERT
(
rowWidthInPix–s
 > 0);

225 
R0
, 
G0
, 
B0
, 
R1
, 
G1
, 
B1
, 
Ï¡R
, 
Ï¡G
, 
Ï¡B
;

226 cÚ¡ 
maxE¼ÜFÜFourPix–s
 = 
fMaxE¼ÜFÜTwoPix–s
 / 2;

227 cÚ¡ 
maxE¼ÜFÜEightPix–s
 = 
maxE¼ÜFÜFourPix–s
 / 2;

230 
ušt32_t
 
cu¼Pix–
, 
upPix–
, 
Ï¡Pix–
;

231 
boŞ
 
Ï¡PaœAv”aged
 = 
çl£
;

232 
boŞ
 
Ï¡2by2Av”aged
 = 
çl£
;

234 
pix–Num
 = 0;…ix–Num < 
rowWidthInPix–s
;…ixelNum++)

236 ià((
pix–Num
 & 0x03) == 0x00)

238 
Ï¡2by2Av”aged
 = 
çl£
;

241 
upPix–
 = 
	`g‘4Pix–
(
upPŒ
);

242 
cu¼Pix–
 = 
	`g‘4Pix–
(
cu¼PŒ
);

244 
æagsPŒ
[0] = (
e11n
|
e11s
);

246 ià(
	`isWh™e
(
upPix–
è&& isWh™e(
cu¼Pix–
))

248 
æagsPŒ
[0] = 
eDÚe
;

249 #ià
kG©h”Sts
 == 1

250 
blockSts
[
esWh™eFound
]++;

257 ià(
æagsPŒ
[0] =ğ(
e11n
|
e11s
))

259 
R1
 = 
	`G‘Red
(
cu¼Pix–
);

260 
G1
 = 
	`G‘G»’
(
cu¼Pix–
);

261 
B1
 = 
	`G‘Blue
(
cu¼Pix–
);

263 
R0
 = 
	`G‘Red
(
upPix–
);

264 
G0
 = 
	`G‘G»’
(
upPix–
);

265 
B0
 = 
	`G‘Blue
(
upPix–
);

267 ià((
fMaxE¼ÜFÜTwoPix–s
 >ğ3è&& (
	`NewD–E
(
R0
, 
R1
, 
G0
, 
G1
, 
B0
, 
B1
, fMaxErrorForTwoPixels)))

274 
	`ASSERT
(
æagsPŒ
[0] =ğ(
e11n
|
e11s
));

275 
æagsPŒ
[0] = 
e12
;

276 #ià
kG©h”Sts
 == 1

277 
blockSts
[
es12
]++;

279 
R1
 = 
	`G‘Red
(
cu¼Pix–
);

280 
G1
 = 
	`G‘G»’
(
cu¼Pix–
);

281 
B1
 = 
	`G‘Blue
(
cu¼Pix–
);

283 
R0
 = 
	`G‘Red
(
upPix–
);

284 
G0
 = 
	`G‘G»’
(
upPix–
);

285 
B0
 = 
	`G‘Blue
(
upPix–
);

287 
	`Av”ageNRound
(
	`isOdd
(
pix–Num
), 
R1
, R1, 
R0
, 
G1
, G1, 
G0
, 
B1
, B1, 
B0
);

290 ià(
	`isOdd
(
pix–Num
))

292 ià(
Ï¡PaœAv”aged
)

295 ià((
maxE¼ÜFÜFourPix–s
 >ğ3è&& (
	`NewD–E
(
Ï¡R
, 
R1
, 
Ï¡G
, 
G1
,
Ï¡B
, 
B1
, maxErrorForFourPixels)))

302 
	`ASSERT
(
æagsPŒ
[-1] =ğ
e12
);

303 
didNÙBud4by2
 = 
Œue
;

304 #ià
kG©h”Sts
 == 1

305 
blockSts
[
es22w
]++;

307 
æagsPŒ
[-1] = 
e22w
;

308 
æagsPŒ
[0] = 
e22e
;

310 
	`Av”ageNRound
((
pix–Num
 & 0x02è=ğ0x02, 
R1
, R1, 
Ï¡R
, 
G1
, G1, 
Ï¡G
, 
B1
, B1, 
Ï¡B
);

312 ià((
pix–Num
 & 0x03) == 0x03)

314 ià(
Ï¡2by2Av”aged
)

322 
Ï¡Pix–
 = 
	`g‘4Pix–
(
upPŒ
, -3);

323 
Ï¡R
 = 
	`G‘Red
(
Ï¡Pix–
);

324 
Ï¡G
 = 
	`G‘G»’
(
Ï¡Pix–
);

325 
Ï¡B
 = 
	`G‘Blue
(
Ï¡Pix–
);

326 ià((
maxE¼ÜFÜEightPix–s
 >ğ3è&& (
	`NewD–E
(
Ï¡R
, 
R1
, 
Ï¡G
, 
G1
,
Ï¡B
, 
B1
, maxErrorForEightPixels)))

335 #ià
kG©h”Sts
 == 1

336 
blockSts
[
es42i
]++;

338 
didNÙBud4by2
 = 
çl£
;

340 
æagsPŒ
[-3] = 
e42i
;

341 
æagsPŒ
[-2] = fÏgsPŒ[-1] = fÏgsPŒ[0] = 
e42
;

343 
	`Av”ageNRound
((
pix–Num
 & 0x04è=ğ0x04, 
R1
, R1, 
Ï¡R
, 
G1
, G1, 
Ï¡G
, 
B1
, B1, 
Ï¡B
);

345 if(
l™eEndŸn
)

346 
cu¼Pix–
 = (
R1
<<16è+ (
G1
<<8è+ 
B1
;

347 if(
bigEndŸn
)

348 
cu¼Pix–
 = (
R1
<<24è+ (
G1
<<16è+ (
B1
<<8);

350 #ià
kMemWr™esO±imize
 == 0

351 
	`put4Pix–
(
upPŒ
, -3, 
cu¼Pix–
);

352 
	`put4Pix–
(
upPŒ
, -2, 
cu¼Pix–
);

353 
	`put4Pix–
(
upPŒ
, -1, 
cu¼Pix–
);

354 
	`put4Pix–
(
upPŒ
, 0, 
cu¼Pix–
);

355 
	`put4Pix–
(
cu¼PŒ
, -3, 
cu¼Pix–
);

356 
	`put4Pix–
(
cu¼PŒ
, -2, 
cu¼Pix–
);

357 
	`put4Pix–
(
cu¼PŒ
, -1, 
cu¼Pix–
);

358 
	`put4Pix–
(
cu¼PŒ
, 0, 
cu¼Pix–
);

360 
	`put4Pix–
(
upPŒ
, -3, 
cu¼Pix–
);

365 ià(
didNÙBud4by2
)

373 
Ï¡2by2Av”aged
 = 
Œue
;

375 if(
l™eEndŸn
)

376 
cu¼Pix–
 = (
R1
<<16è+ (
G1
<<8è+ 
B1
;

377 if(
bigEndŸn
)

378 
cu¼Pix–
 = (
R1
<<24è+ (
G1
<<16è+ (
B1
<<8);

380 #ià
kMemWr™esO±imize
 == 0

381 
	`put4Pix–
(
upPŒ
, -1, 
cu¼Pix–
);

382 
	`put4Pix–
(
upPŒ
, 0, 
cu¼Pix–
);

383 
	`put4Pix–
(
cu¼PŒ
, -1, 
cu¼Pix–
);

384 
	`put4Pix–
(
cu¼PŒ
, 0, 
cu¼Pix–
);

386 
	`put4Pix–
(
upPŒ
, -1, 
cu¼Pix–
);

398 
Ï¡2by2Av”aged
 = 
Œue
;

400 if(
l™eEndŸn
)

401 
cu¼Pix–
 = (
R1
<<16è+ (
G1
<<8è+ 
B1
;

402 if(
bigEndŸn
)

403 
cu¼Pix–
 = (
R1
<<24è+ (
G1
<<16è+ (
B1
<<8);

405 #ià
kMemWr™esO±imize
 == 0

406 
	`put4Pix–
(
upPŒ
, -1, 
cu¼Pix–
);

407 
	`put4Pix–
(
upPŒ
, 0, 
cu¼Pix–
);

408 
	`put4Pix–
(
cu¼PŒ
, -1, 
cu¼Pix–
);

409 
	`put4Pix–
(
cu¼PŒ
, 0, 
cu¼Pix–
);

411 
	`put4Pix–
(
upPŒ
, -1, 
cu¼Pix–
);

423 
Ï¡2by2Av”aged
 = 
çl£
;

425 if(
l™eEndŸn
)

426 
cu¼Pix–
 = (
R1
<<16è+ (
G1
<<8è+ 
B1
;

427 if(
bigEndŸn
)

428 
cu¼Pix–
 = (
R1
<<24è+ (
G1
<<16è+ (
B1
<<8);

430 #ià
kMemWr™esO±imize
 == 0

431 
	`put4Pix–
(
upPŒ
, 0, 
cu¼Pix–
);

432 
	`put4Pix–
(
cu¼PŒ
, 0, 
cu¼Pix–
);

434 
	`put4Pix–
(
upPŒ
,0, 
cu¼Pix–
);

437 
Ï¡R
 = 
R1
;

438 
Ï¡G
 = 
G1
;

439 
Ï¡B
 = 
B1
;

440 
Ï¡PaœAv”aged
 = 
Œue
;

449 
Ï¡2by2Av”aged
 = 
çl£
;

450 
Ï¡PaœAv”aged
 = 
Œue
;

451 
Ï¡R
 = 
R1
;

452 
Ï¡G
 = 
G1
;

453 
Ï¡B
 = 
B1
;

455 if(
l™eEndŸn
)

456 
cu¼Pix–
 = (
R1
<<16è+ (
G1
<<8è+ 
B1
;

457 if(
bigEndŸn
)

458 
cu¼Pix–
 = (
R1
<<24è+ (
G1
<<16è+ (
B1
<<8);

460 #ià
kMemWr™esO±imize
 == 0

461 
	`put4Pix–
(
upPŒ
, 0, 
cu¼Pix–
);

462 
	`put4Pix–
(
cu¼PŒ
, 0, 
cu¼Pix–
);

464 
	`put4Pix–
(
upPŒ
, 0, 
cu¼Pix–
);

476 
Ï¡PaœAv”aged
 = 
Œue
;

477 
Ï¡R
 = 
R1
;

478 
Ï¡G
 = 
G1
;

479 
Ï¡B
 = 
B1
;

481 if(
l™eEndŸn
)

482 
cu¼Pix–
 = (
R1
<<16è+ (
G1
<<8è+ 
B1
;

483 if(
bigEndŸn
)

484 
cu¼Pix–
 = (
R1
<<24è+ (
G1
<<16è+ (
B1
<<8);

486 #ià
kMemWr™esO±imize
 == 0

487 
	`put4Pix–
(
upPŒ
, 0, 
cu¼Pix–
);

488 
	`put4Pix–
(
cu¼PŒ
, 0, 
cu¼Pix–
);

490 
	`put4Pix–
(
upPŒ
, 0, 
cu¼Pix–
);

494 ià(
Ï¡PaœAv”aged
)

504 
Ï¡PaœAv”aged
 = 
çl£
;

512 ià(
	`isOdd
(
pix–Num
))

515 
Ï¡Pix–
 = 
	`g‘4Pix–
(
upPŒ
,-1);

516 
Ï¡R
 = 
	`G‘Red
(
Ï¡Pix–
);

517 
Ï¡G
 = 
	`G‘G»’
(
Ï¡Pix–
);

518 
Ï¡B
 = 
	`G‘Blue
(
Ï¡Pix–
);

519 ià(((
fMaxE¼ÜFÜTwoPix–s
 >ğ3)è&& (
	`NewD–E
(
Ï¡R
, 
R0
, 
Ï¡G
, 
G0
,
Ï¡B
, 
B0
, fMaxErrorForTwoPixels)))

525 #ià
kG©h”Sts
 == 1

526 
blockSts
[
es21nw
]++;

528 
didNÙBud4by1
 = 
Œue
;

530 
	`Av”ageNRound
(
	`isOdd
(
pix–Num
), 
Ï¡R
,†a¡R, 
R0
, 
Ï¡G
,†a¡G, 
G0
, 
Ï¡B
,†a¡B, 
B0
);

532 ià((
pix–Num
 >ğ3è&& (
æagsPŒ
[-3] & 
e21nw
))

534 
	`ASSERT
(!((
æagsPŒ
[-3] | fÏgsPŒ[-2] | fÏgsPŒ[-1] | fÏgsPŒ[0]è& 
eTheRe¡
));

537 
Ï¡Pix–
 = 
	`g‘4Pix–
(
upPŒ
,-3);

538 
R0
 = 
	`G‘Red
(
Ï¡Pix–
);

539 
G0
 = 
	`G‘G»’
(
Ï¡Pix–
);

540 
B0
 = 
	`G‘Blue
(
Ï¡Pix–
);

541 iàĞ(
maxE¼ÜFÜFourPix–s
 >ğ3è&& (
	`NewD–E
(
Ï¡R
, 
R0
, 
Ï¡G
, 
G0
,
Ï¡B
, 
B0
, maxErrorForFourPixels)))

547 #ià
kG©h”Sts
 == 1

548 
blockSts
[
es41ni
]++;

550 
didNÙBud4by1
 = 
çl£
;

551 
	`Av”ageNRound
((
pix–Num
 & 0x04)=ğ0x04, 
Ï¡R
,†a¡R, 
R0
, 
Ï¡G
,†a¡G, 
G0
, 
Ï¡B
,†a¡B, 
B0
);

553 if(
l™eEndŸn
)

554 
cu¼Pix–
 = (
Ï¡R
<<16è+ (
Ï¡G
<<8è+ 
Ï¡B
;

555 if(
bigEndŸn
)

556 
cu¼Pix–
 = (
Ï¡R
<<24è+ (
Ï¡G
<<16è+ (
Ï¡B
<<8);

558 #ià
kMemWr™esO±imize
 == 0

559 
	`put4Pix–
(
upPŒ
, -3, 
cu¼Pix–
);

560 
	`put4Pix–
(
upPŒ
, -2, 
cu¼Pix–
);

561 
	`put4Pix–
(
upPŒ
, -1, 
cu¼Pix–
);

562 
	`put4Pix–
(
upPŒ
, 0, 
cu¼Pix–
);

564 
	`put4Pix–
(
upPŒ
, -3, 
cu¼Pix–
);

567 
	`ASSERT
(!((
æagsPŒ
[-3] | fÏgsPŒ[-2] | fÏgsPŒ[-1] | fÏgsPŒ[0]è& 
eTheRe¡
));

569 
æagsPŒ
[-3] = (æagsPŒ[-3] & ~
eNÜths
è| 
e41ni
;

570 
æagsPŒ
[-2] = (æagsPŒ[-2] & ~
eNÜths
è| 
e41n
;

571 
æagsPŒ
[-1] = (æagsPŒ[-1] & ~
eNÜths
è| 
e41n
;

572 
æagsPŒ
[0] = (æagsPŒ[0] & ~
eNÜths
è| 
e41n
;

576 ià(
didNÙBud4by1
)

578 if(
l™eEndŸn
)

579 
cu¼Pix–
 = (
Ï¡R
<<16è+ (
Ï¡G
<<8è+ 
Ï¡B
;

580 if(
bigEndŸn
)

581 
cu¼Pix–
 = (
Ï¡R
<<24è+ (
Ï¡G
<<16è+ (
Ï¡B
<<8);

583 #ià
kMemWr™esO±imize
 == 0

584 
	`put4Pix–
(
upPŒ
, -1, 
cu¼Pix–
);

585 
	`put4Pix–
(
upPŒ
, 0, 
cu¼Pix–
);

587 
	`put4Pix–
(
upPŒ
, -1, 
cu¼Pix–
);

589 
	`ASSERT
(!((
æagsPŒ
[-1] | fÏgsPŒ[0]è& 
eTheRe¡
));

590 
æagsPŒ
[-1] = (æagsPŒ[-1] & ~
eNÜths
è| 
e21nw
;

591 
æagsPŒ
[0] = (æagsPŒ[0] & ~
eNÜths
è| 
e21Ã
;

596 
Ï¡Pix–
 = 
	`g‘4Pix–
(
cu¼PŒ
,-1);

597 
Ï¡R
 = 
	`G‘Red
(
Ï¡Pix–
);

598 
Ï¡G
 = 
	`G‘G»’
(
Ï¡Pix–
);

599 
Ï¡B
 = 
	`G‘Blue
(
Ï¡Pix–
);

600 ià((
fMaxE¼ÜFÜTwoPix–s
 >ğ3è&& (
	`NewD–E
(
Ï¡R
, 
R1
, 
Ï¡G
, 
G1
, 
Ï¡B
, 
B1
, fMaxErrorForTwoPixels)))

606 
didNÙBud4by1
 = 
Œue
;

607 #ià
kG©h”Sts
 == 1

608 
blockSts
[
es21sw
]++;

610 
	`Av”ageNRound
(
	`isOdd
(
pix–Num
), 
Ï¡R
,†a¡R, 
R1
, 
Ï¡G
,†a¡G, 
G1
, 
Ï¡B
,†a¡B, 
B1
);

611 ià((
pix–Num
 >ğ3è&& (
æagsPŒ
[-3] & 
e21sw
))

614 
	`ASSERT
(!((
æagsPŒ
[-3] | fÏgsPŒ[-2] | fÏgsPŒ[-1] | fÏgsPŒ[0]è& 
eTheRe¡
));

616 
Ï¡Pix–
 = 
	`g‘4Pix–
(
cu¼PŒ
,-3);

617 
R0
 = 
	`G‘Red
(
Ï¡Pix–
);

618 
G0
 = 
	`G‘G»’
(
Ï¡Pix–
);

619 
B0
 = 
	`G‘Blue
(
Ï¡Pix–
);

620 ià((
maxE¼ÜFÜFourPix–s
 >ğ3è&& (
	`NewD–E
(
Ï¡R
, 
R0
, 
Ï¡G
, 
G0
, 
Ï¡B
, 
B0
, maxErrorForFourPixels)))

626 #ià
kG©h”Sts
 == 1

627 
blockSts
[
es41si
]++;

629 
didNÙBud4by1
 = 
çl£
;

630 
	`Av”ageNRound
((
pix–Num
 & 0x04)=ğ0x04, 
Ï¡R
,†a¡R, 
R0
, 
Ï¡G
,†a¡G, 
G0
, 
Ï¡B
,†a¡B, 
B0
);

632 if(
l™eEndŸn
)

633 
cu¼Pix–
 = (
Ï¡R
<<16è+ (
Ï¡G
<<8è+ 
Ï¡B
;

634 if(
bigEndŸn
)

635 
cu¼Pix–
 = (
Ï¡R
<<24è+ (
Ï¡G
<<16è+ (
Ï¡B
<<8);

637 #ià
kMemWr™esO±imize
 == 0

638 
	`put4Pix–
(
cu¼PŒ
, -3, 
cu¼Pix–
);

639 
	`put4Pix–
(
cu¼PŒ
, -2, 
cu¼Pix–
);

640 
	`put4Pix–
(
cu¼PŒ
, -1, 
cu¼Pix–
);

641 
	`put4Pix–
(
cu¼PŒ
, 0, 
cu¼Pix–
);

643 
	`put4Pix–
(
cu¼PŒ
, -3, 
cu¼Pix–
);

645 
æagsPŒ
[-3] = (æagsPŒ[-3] & ~
eSouths
è| 
e41si
;

646 
æagsPŒ
[-2] = (æagsPŒ[-2] & ~
eSouths
è| 
e41s
;

647 
æagsPŒ
[-1] = (æagsPŒ[-1] & ~
eSouths
è| 
e41s
;

648 
æagsPŒ
[0] = (æagsPŒ[0] & ~
eSouths
è| 
e41s
;

652 ià(
didNÙBud4by1
)

654 
	`ASSERT
(!((
æagsPŒ
[-1] | fÏgsPŒ[0]è& 
eTheRe¡
));

656 if(
l™eEndŸn
)

657 
cu¼Pix–
 = (
Ï¡R
<<16è+ (
Ï¡G
<<8è+ 
Ï¡B
;

658 if(
bigEndŸn
)

659 
cu¼Pix–
 = (
Ï¡R
<<24è+ (
Ï¡G
<<16è+ (
Ï¡B
<<8);

661 #ià
kMemWr™esO±imize
 == 0

662 
	`put4Pix–
(
cu¼PŒ
, -1, 
cu¼Pix–
);

663 
	`put4Pix–
(
cu¼PŒ
, 0, 
cu¼Pix–
);

665 
	`put4Pix–
(
cu¼PŒ
, -1, 
cu¼Pix–
);

668 
æagsPŒ
[-1] = (æagsPŒ[-1] & ~
eSouths
è| 
e21sw
;

669 
æagsPŒ
[0] = (æagsPŒ[0] & ~
eSouths
è| 
e21£
;

677 
Ï¡PaœAv”aged
 = 
çl£
;

680 
upPŒ
 +ğ
eBufã»dPix–WidthInBy‹s
;

681 
cu¼PŒ
 +ğ
eBufã»dPix–WidthInBy‹s
;

682 
æagsPŒ
++;

684 
	}
}

694 
	gTEº›F‹r
::
	$F‹r2PaœsOfF‹»dRows
(*
row1PŒ
, *
row2PŒ
, *
row3PŒ
, *
row4PŒ
)

696 cÚ¡ 
maxE¼ÜFÜFourPix–s
 = 
fMaxE¼ÜFÜTwoPix–s
 / 2;

697 cÚ¡ 
maxE¼ÜFÜEightPix–s
 = 
maxE¼ÜFÜFourPix–s
 / 2;

698 cÚ¡ 
maxE¼ÜFÜSix‹’Pix–s
 = 
maxE¼ÜFÜEightPix–s
 / 2;

699 cÚ¡ 
maxE¼ÜFÜThœtyTwoPix–s
 = 
maxE¼ÜFÜSix‹’Pix–s
 / 2;

701 
pix–Num
 = 0;…ix–Num < (
fRowWidthInPix–s
-3);)

703 
cu¼Pix–
, 
upPix–
;

704 
R0
, 
G0
, 
B0
, 
R1
, 
G1
, 
B1
;

706 ià((
fPix–F‹»dFÏgs
[0][
pix–Num
] & 
e42i
) && (fPixelFilteredFlags[1][pixelNum] &ƒ42i))

717 
	`ASSERT
(
fPix–F‹»dFÏgs
[0][
pix–Num
] =ğ
e42i
 && fPix–F‹»dFÏgs[0][pix–Num+1] =ğ
e42
 && fPixelFilteredFlags[0][pixelNum+2] ==ƒ42 && fPixelFilteredFlags[0][pixelNum+3] ==ƒ42);

718 
	`ASSERT
(
fPix–F‹»dFÏgs
[1][
pix–Num
] =ğ
e42i
 && fPix–F‹»dFÏgs[1][pix–Num+1] =ğ
e42
 && fPixelFilteredFlags[1][pixelNum+2] ==ƒ42 && fPixelFilteredFlags[1][pixelNum+3] ==ƒ42);

720 
upPix–
 = 
	`g‘4Pix–
(
row1PŒ
);

721 
cu¼Pix–
 = 
	`g‘4Pix–
(
row3PŒ
);

723 
R1
 = 
	`G‘Red
(
cu¼Pix–
);

724 
G1
 = 
	`G‘G»’
(
cu¼Pix–
);

725 
B1
 = 
	`G‘Blue
(
cu¼Pix–
);

727 
R0
 = 
	`G‘Red
(
upPix–
);

728 
G0
 = 
	`G‘G»’
(
upPix–
);

729 
B0
 = 
	`G‘Blue
(
upPix–
);

731 if((
maxE¼ÜFÜSix‹’Pix–s
 >ğ3è&&(
	`NewD–E
(
R1
, 
R0
, 
G1
, 
G0
, 
B1
, 
B0
, maxErrorForSixteenPixels)))

740 #ià
kG©h”Sts
 == 1

741 
blockSts
[
es44ni
]++;

743 
	`Av”ageNRound
((
pix–Num
 & 0x04è=ğ0x04, 
R1
, R1, 
R0
, 
G1
, G1, 
G0
, 
B1
, B1, 
B0
);

745 if(
l™eEndŸn
)

746 
cu¼Pix–
 = (
R1
<<16è+ (
G1
<<8è+ 
B1
;

747 if(
bigEndŸn
)

748 
cu¼Pix–
 = (
R1
<<24è+ (
G1
<<16è+ (
B1
<<8);

750 #ià
kMemWr™esO±imize
 == 0

751 
	`put4Pix–
(
row1PŒ
, 0, 
cu¼Pix–
);

752 
	`put4Pix–
(
row1PŒ
, 1, 
cu¼Pix–
);

753 
	`put4Pix–
(
row1PŒ
, 2, 
cu¼Pix–
);

754 
	`put4Pix–
(
row1PŒ
, 3, 
cu¼Pix–
);

755 
	`put4Pix–
(
row2PŒ
, 0, 
cu¼Pix–
);

756 
	`put4Pix–
(
row2PŒ
, 1, 
cu¼Pix–
);

757 
	`put4Pix–
(
row2PŒ
, 2, 
cu¼Pix–
);

758 
	`put4Pix–
(
row2PŒ
, 3, 
cu¼Pix–
);

759 
	`put4Pix–
(
row3PŒ
, 0, 
cu¼Pix–
);

760 
	`put4Pix–
(
row3PŒ
, 1, 
cu¼Pix–
);

761 
	`put4Pix–
(
row3PŒ
, 2, 
cu¼Pix–
);

762 
	`put4Pix–
(
row3PŒ
, 3, 
cu¼Pix–
);

763 
	`put4Pix–
(
row4PŒ
, 0, 
cu¼Pix–
);

764 
	`put4Pix–
(
row4PŒ
, 1, 
cu¼Pix–
);

765 
	`put4Pix–
(
row4PŒ
, 2, 
cu¼Pix–
);

766 
	`put4Pix–
(
row4PŒ
, 3, 
cu¼Pix–
);

768 
	`put4Pix–
(
row1PŒ
, 0, 
cu¼Pix–
);

770 
row1PŒ
 +ğ4*
eBufã»dPix–WidthInBy‹s
;

771 
row2PŒ
 +ğ4*
eBufã»dPix–WidthInBy‹s
;

772 
row3PŒ
 +ğ4*
eBufã»dPix–WidthInBy‹s
;

773 
row4PŒ
 +ğ4*
eBufã»dPix–WidthInBy‹s
;

775 
fPix–F‹»dFÏgs
[0][
pix–Num
] = 
e44ni
;

776 
fPix–F‹»dFÏgs
[0][
pix–Num
+1] = fPix–F‹»dFÏgs[0][pix–Num+2] = fPix–F‹»dFÏgs[0][pix–Num+3] = 
e44n
;

777 
fPix–F‹»dFÏgs
[1][
pix–Num
] = 
e44si
;

778 
fPix–F‹»dFÏgs
[1][
pix–Num
+1] = fPix–F‹»dFÏgs[1][pix–Num+2] = fPix–F‹»dFÏgs[1][pix–Num+3] = 
e44s
;

780 ià((
pix–Num
 >ğ4è&& (
fPix–F‹»dFÏgs
[1][pix–Num-4] & 
e44si
))

789 
	`ASSERT
(
fPix–F‹»dFÏgs
[0][
pix–Num
-4] =ğ
e44ni
 && fPix–F‹»dFÏgs[0][pix–Num-3] =ğ
e44n
 && fPixelFilteredFlags[0][pixelNum-2] ==ƒ44n && fPixelFilteredFlags[0][pixelNum-1] ==ƒ44n);

790 
	`ASSERT
(
fPix–F‹»dFÏgs
[1][
pix–Num
-4] =ğ
e44si
 && fPix–F‹»dFÏgs[1][pix–Num-3] =ğ
e44s
 && fPixelFilteredFlags[1][pixelNum-2] ==ƒ44s && fPixelFilteredFlags[1][pixelNum-1] ==ƒ44s);

792 
upPix–
 = 
	`g‘4Pix–
(
row1PŒ
, -8);

794 
R0
 = 
	`G‘Red
(
upPix–
);

795 
G0
 = 
	`G‘G»’
(
upPix–
);

796 
B0
 = 
	`G‘Blue
(
upPix–
);

798 ifĞ(
maxE¼ÜFÜThœtyTwoPix–s
 >ğ3è&& (
	`NewD–E
(
R1
, 
R0
, 
G1
, 
G0
, 
B1
, 
B0
, maxErrorForThirtyTwoPixels)))

807 #ià
kG©h”Sts
 == 1

808 
blockSts
[
es84ni
]++;

810 
	`Av”ageNRound
((
pix–Num
 & 0x08è=ğ0x08, 
R1
, R1, 
R0
, 
G1
, G1, 
G0
, 
B1
, B1, 
B0
);

811 if(
l™eEndŸn
)

812 
cu¼Pix–
 = (
R1
<<16è+ (
G1
<<8è+ 
B1
;

813 if(
bigEndŸn
)

814 
cu¼Pix–
 = (
R1
<<24è+ (
G1
<<16è+ (
B1
<<8);

816 #ià
kMemWr™esO±imize
 == 0

817 
	`put4Pix–
(
row1PŒ
, -8, 
cu¼Pix–
);

818 
	`put4Pix–
(
row1PŒ
, -7, 
cu¼Pix–
);

819 
	`put4Pix–
(
row1PŒ
, -6, 
cu¼Pix–
);

820 
	`put4Pix–
(
row1PŒ
, -5, 
cu¼Pix–
);

821 
	`put4Pix–
(
row1PŒ
, -4, 
cu¼Pix–
);

822 
	`put4Pix–
(
row1PŒ
, -3, 
cu¼Pix–
);

823 
	`put4Pix–
(
row1PŒ
, -2, 
cu¼Pix–
);

824 
	`put4Pix–
(
row1PŒ
, -1, 
cu¼Pix–
);

825 
	`put4Pix–
(
row2PŒ
, -8, 
cu¼Pix–
);

826 
	`put4Pix–
(
row2PŒ
, -7, 
cu¼Pix–
);

827 
	`put4Pix–
(
row2PŒ
, -6, 
cu¼Pix–
);

828 
	`put4Pix–
(
row2PŒ
, -5, 
cu¼Pix–
);

829 
	`put4Pix–
(
row2PŒ
, -4, 
cu¼Pix–
);

830 
	`put4Pix–
(
row2PŒ
, -3, 
cu¼Pix–
);

831 
	`put4Pix–
(
row2PŒ
, -2, 
cu¼Pix–
);

832 
	`put4Pix–
(
row2PŒ
, -1, 
cu¼Pix–
);

833 
	`put4Pix–
(
row3PŒ
, -8, 
cu¼Pix–
);

834 
	`put4Pix–
(
row3PŒ
, -7, 
cu¼Pix–
);

835 
	`put4Pix–
(
row3PŒ
, -6, 
cu¼Pix–
);

836 
	`put4Pix–
(
row3PŒ
, -5, 
cu¼Pix–
);

837 
	`put4Pix–
(
row3PŒ
, -4, 
cu¼Pix–
);

838 
	`put4Pix–
(
row3PŒ
, -3, 
cu¼Pix–
);

839 
	`put4Pix–
(
row3PŒ
, -2, 
cu¼Pix–
);

840 
	`put4Pix–
(
row3PŒ
, -1, 
cu¼Pix–
);

841 
	`put4Pix–
(
row4PŒ
, -8, 
cu¼Pix–
);

842 
	`put4Pix–
(
row4PŒ
, -7, 
cu¼Pix–
);

843 
	`put4Pix–
(
row4PŒ
, -6, 
cu¼Pix–
);

844 
	`put4Pix–
(
row4PŒ
, -5, 
cu¼Pix–
);

845 
	`put4Pix–
(
row4PŒ
, -4, 
cu¼Pix–
);

846 
	`put4Pix–
(
row4PŒ
, -3, 
cu¼Pix–
);

847 
	`put4Pix–
(
row4PŒ
, -2, 
cu¼Pix–
);

848 
	`put4Pix–
(
row4PŒ
, -1, 
cu¼Pix–
);

850 
	`put4Pix–
(
row1PŒ
, -8, 
cu¼Pix–
);

852 
fPix–F‹»dFÏgs
[0][
pix–Num
-4] = 
e84ni
;

853 
fPix–F‹»dFÏgs
[0][
pix–Num
-3] = fPix–F‹»dFÏgs[0][pix–Num-2] = fPix–F‹»dFÏgs[0][pix–Num-1] = fPix–F‹»dFÏgs[0][pix–Num] = fPix–F‹»dFÏgs[0][pix–Num+1] = fPix–F‹»dFÏgs[0][pix–Num+2] = fPix–F‹»dFÏgs[0][pix–Num+3] = 
e84n
;

854 
fPix–F‹»dFÏgs
[1][
pix–Num
-4] = 
e84si
;

855 
fPix–F‹»dFÏgs
[1][
pix–Num
-3] = fPix–F‹»dFÏgs[1][pix–Num-2] = fPix–F‹»dFÏgs[1][pix–Num-1] = fPix–F‹»dFÏgs[1][pix–Num] = fPix–F‹»dFÏgs[1][pix–Num+1] = fPix–F‹»dFÏgs[1][pix–Num+2] = fPix–F‹»dFÏgs[1][pix–Num+3] = 
e84s
;

861 
row1PŒ
 +ğ4*
eBufã»dPix–WidthInBy‹s
;

862 
row2PŒ
 +ğ4*
eBufã»dPix–WidthInBy‹s
;

863 
row3PŒ
 +ğ4*
eBufã»dPix–WidthInBy‹s
;

864 
row4PŒ
 +ğ4*
eBufã»dPix–WidthInBy‹s
;

866 
pix–Num
 += 4;

868 ià((
fPix–F‹»dFÏgs
[0][
pix–Num
] & 
e22w
) && (fPixelFilteredFlags[1][pixelNum] &ƒ22w))

879 
	`ASSERT
(
fPix–F‹»dFÏgs
[0][
pix–Num
] =ğ
e22w
 && fPix–F‹»dFÏgs[0][pix–Num+1] =ğ
e22e
);

880 
	`ASSERT
(
fPix–F‹»dFÏgs
[1][
pix–Num
] =ğ
e22w
 && fPix–F‹»dFÏgs[1][pix–Num+1] =ğ
e22e
);

882 
upPix–
 = 
	`g‘4Pix–
(
row1PŒ
);

883 
cu¼Pix–
 = 
	`g‘4Pix–
(
row3PŒ
);

885 
R1
 = 
	`G‘Red
(
cu¼Pix–
);

886 
G1
 = 
	`G‘G»’
(
cu¼Pix–
);

887 
B1
 = 
	`G‘Blue
(
cu¼Pix–
);

889 
R0
 = 
	`G‘Red
(
upPix–
);

890 
G0
 = 
	`G‘G»’
(
upPix–
);

891 
B0
 = 
	`G‘Blue
(
upPix–
);

893 ià((
maxE¼ÜFÜEightPix–s
 >ğ3è&& (
	`NewD–E
(
R1
, 
R0
, 
G1
, 
G0
, 
B1
, 
B0
, maxErrorForEightPixels)))

902 #ià
kG©h”Sts
 == 1

903 
blockSts
[
es24nw
]++;

905 
	`Av”ageNRound
((
pix–Num
 & 0x02è=ğ0x02, 
R1
, R1, 
R0
, 
G1
, G1, 
G0
, 
B1
, B1, 
B0
);

907 if(
l™eEndŸn
)

908 
cu¼Pix–
 = (
R1
<<16è+ (
G1
<<8è+ 
B1
;

909 if(
bigEndŸn
)

910 
cu¼Pix–
 = (
R1
<<24è+ (
G1
<<16è+ (
B1
<<8);

912 #ià
kMemWr™esO±imize
 == 0

913 
	`put4Pix–
(
row1PŒ
, 0, 
cu¼Pix–
);

914 
	`put4Pix–
(
row1PŒ
, 1, 
cu¼Pix–
);

915 
	`put4Pix–
(
row2PŒ
, 0, 
cu¼Pix–
);

916 
	`put4Pix–
(
row2PŒ
, 1, 
cu¼Pix–
);

917 
	`put4Pix–
(
row3PŒ
, 0, 
cu¼Pix–
);

918 
	`put4Pix–
(
row3PŒ
, 1, 
cu¼Pix–
);

919 
	`put4Pix–
(
row4PŒ
, 0, 
cu¼Pix–
);

920 
	`put4Pix–
(
row4PŒ
, 1, 
cu¼Pix–
);

922 
	`put4Pix–
(
row1PŒ
, 0, 
cu¼Pix–
);

924 
row1PŒ
 +ğ2*
eBufã»dPix–WidthInBy‹s
;

925 
row2PŒ
 +ğ2*
eBufã»dPix–WidthInBy‹s
;

926 
row3PŒ
 +ğ2*
eBufã»dPix–WidthInBy‹s
;

927 
row4PŒ
 +ğ2*
eBufã»dPix–WidthInBy‹s
;

929 
fPix–F‹»dFÏgs
[0][
pix–Num
] = 
e24nw
;

930 
fPix–F‹»dFÏgs
[0][
pix–Num
+1] = 
e24Ã
;

931 
fPix–F‹»dFÏgs
[1][
pix–Num
] = 
e24sw
;

932 
fPix–F‹»dFÏgs
[1][
pix–Num
+1] = 
e24£
;

936 
row1PŒ
 +ğ2*
eBufã»dPix–WidthInBy‹s
;

937 
row2PŒ
 +ğ2*
eBufã»dPix–WidthInBy‹s
;

938 
row3PŒ
 +ğ2*
eBufã»dPix–WidthInBy‹s
;

939 
row4PŒ
 +ğ2*
eBufã»dPix–WidthInBy‹s
;

941 
pix–Num
 += 2;

943 ià((
fPix–F‹»dFÏgs
[0][
pix–Num
] & 
e12
) && (fPixelFilteredFlags[1][pixelNum] &ƒ12))

954 
	`ASSERT
(
fPix–F‹»dFÏgs
[0][
pix–Num
] =ğ
e12
);

955 
	`ASSERT
(
fPix–F‹»dFÏgs
[1][
pix–Num
] =ğ
e12
);

957 
upPix–
 = 
	`g‘4Pix–
(
row1PŒ
);

958 
cu¼Pix–
 = 
	`g‘4Pix–
(
row3PŒ
);

960 
R1
 = 
	`G‘Red
(
cu¼Pix–
);

961 
G1
 = 
	`G‘G»’
(
cu¼Pix–
);

962 
B1
 = 
	`G‘Blue
(
cu¼Pix–
);

964 
R0
 = 
	`G‘Red
(
upPix–
);

965 
G0
 = 
	`G‘G»’
(
upPix–
);

966 
B0
 = 
	`G‘Blue
(
upPix–
);

968 ià((
maxE¼ÜFÜFourPix–s
 >ğ3è&& (
	`NewD–E
(
R1
, 
R0
, 
G1
, 
G0
, 
B1
, 
B0
, maxErrorForFourPixels)))

977 #ià
kG©h”Sts
 == 1

978 
blockSts
[
es14n
]++;

980 
	`Av”ageNRound
((
pix–Num
 & 0x01è=ğ0x01, 
R1
, R1, 
R0
, 
G1
, G1, 
G0
, 
B1
, B1, 
B0
);

982 if(
l™eEndŸn
)

983 
cu¼Pix–
 = (
R1
<<16è+ (
G1
<<8è+ 
B1
;

984 if(
bigEndŸn
)

985 
cu¼Pix–
 = (
R1
<<24è+ (
G1
<<16è+ (
B1
<<8);

987 #ià
kMemWr™esO±imize
 == 0

988 
	`put4Pix–
(
row1PŒ
, 0, 
cu¼Pix–
);

989 
	`put4Pix–
(
row2PŒ
, 0, 
cu¼Pix–
);

990 
	`put4Pix–
(
row3PŒ
, 0, 
cu¼Pix–
);

991 
	`put4Pix–
(
row4PŒ
, 0, 
cu¼Pix–
);

993 
	`put4Pix–
(
row1PŒ
, 0, 
cu¼Pix–
);

995 
fPix–F‹»dFÏgs
[0][
pix–Num
] = 
e14n
;

996 
fPix–F‹»dFÏgs
[1][
pix–Num
] = 
e14s
;

999 
row1PŒ
 +ğ
eBufã»dPix–WidthInBy‹s
;

1000 
row2PŒ
 +ğ
eBufã»dPix–WidthInBy‹s
;

1001 
row3PŒ
 +ğ
eBufã»dPix–WidthInBy‹s
;

1002 
row4PŒ
 +ğ
eBufã»dPix–WidthInBy‹s
;

1004 
pix–Num
++;

1006 ià((
fPix–F‹»dFÏgs
[0][
pix–Num
] & 
e41si
)

1007 && (
fPix–F‹»dFÏgs
[1][
pix–Num
] & 
e41ni
))

1017 
upPix–
 = 
	`g‘4Pix–
(
row2PŒ
);

1018 
cu¼Pix–
 = 
	`g‘4Pix–
(
row3PŒ
);

1020 
R1
 = 
	`G‘Red
(
cu¼Pix–
);

1021 
G1
 = 
	`G‘G»’
(
cu¼Pix–
);

1022 
B1
 = 
	`G‘Blue
(
cu¼Pix–
);

1024 
R0
 = 
	`G‘Red
(
upPix–
);

1025 
G0
 = 
	`G‘G»’
(
upPix–
);

1026 
B0
 = 
	`G‘Blue
(
upPix–
);

1029 ià((
maxE¼ÜFÜEightPix–s
 >ğ3è&& (
	`NewD–E
(
R1
, 
R0
, 
G1
, 
G0
, 
B1
, 
B0
, maxErrorForEightPixels)))

1037 #ià
kG©h”Sts
 == 1

1038 
blockSts
[
es42w
]++;

1040 
	`Av”ageNRound
((
pix–Num
 & 0x04è=ğ0x04, 
R1
, R1, 
R0
, 
G1
, G1, 
G0
, 
B1
, B1, 
B0
);

1042 if(
l™eEndŸn
)

1043 
cu¼Pix–
 = (
R1
<<16è+ (
G1
<<8è+ 
B1
;

1044 if(
bigEndŸn
)

1045 
cu¼Pix–
 = (
R1
<<24è+ (
G1
<<16è+ (
B1
<<8);

1048 
	`put4Pix–
(
row2PŒ
, 0, 
cu¼Pix–
);

1049 
	`put4Pix–
(
row2PŒ
, 1, 
cu¼Pix–
);

1050 
	`put4Pix–
(
row2PŒ
, 2, 
cu¼Pix–
);

1051 
	`put4Pix–
(
row2PŒ
, 3, 
cu¼Pix–
);

1052 
	`put4Pix–
(
row3PŒ
, 0, 
cu¼Pix–
);

1053 
	`put4Pix–
(
row3PŒ
, 1, 
cu¼Pix–
);

1054 
	`put4Pix–
(
row3PŒ
, 2, 
cu¼Pix–
);

1055 
	`put4Pix–
(
row3PŒ
, 3, 
cu¼Pix–
);

1057 
fPix–F‹»dFÏgs
[0][
pix–Num
] = fPix–F‹»dFÏgs[0][pix–Num] & ~
e41si
;

1058 
fPix–F‹»dFÏgs
[0][
pix–Num
+1] = fPix–F‹»dFÏgs[0][pix–Num+1] & ~
e41s
;

1059 
fPix–F‹»dFÏgs
[0][
pix–Num
+2] = fPix–F‹»dFÏgs[0][pix–Num+1] & ~
e41s
;

1060 
fPix–F‹»dFÏgs
[0][
pix–Num
+3] = fPix–F‹»dFÏgs[0][pix–Num+1] & ~
e41s
;

1062 
fPix–F‹»dFÏgs
[1][
pix–Num
] = fPix–F‹»dFÏgs[1][pix–Num] & ~
e41ni
;

1063 
fPix–F‹»dFÏgs
[1][
pix–Num
+1] = fPix–F‹»dFÏgs[1][pix–Num+1] & ~
e41n
;

1064 
fPix–F‹»dFÏgs
[1][
pix–Num
+2] = fPix–F‹»dFÏgs[1][pix–Num+1] & ~
e41n
;

1065 
fPix–F‹»dFÏgs
[1][
pix–Num
+3] = fPix–F‹»dFÏgs[1][pix–Num+1] & ~
e41n
;

1067 
pix–Num
 += 4;

1069 
row1PŒ
 +ğ4*
eBufã»dPix–WidthInBy‹s
;

1070 
row2PŒ
 +ğ4*
eBufã»dPix–WidthInBy‹s
;

1071 
row3PŒ
 +ğ4*
eBufã»dPix–WidthInBy‹s
;

1072 
row4PŒ
 +ğ4*
eBufã»dPix–WidthInBy‹s
;

1074 ià((
fPix–F‹»dFÏgs
[0][
pix–Num
] & 
e21sw
)

1075 && (
fPix–F‹»dFÏgs
[1][
pix–Num
] & 
e21nw
))

1084 
	`ASSERT
(!((
fPix–F‹»dFÏgs
[0][
pix–Num
] & 
e11s
) | (fPixelFilteredFlags[0][pixelNum+1] &ƒ11s)));

1085 
	`ASSERT
(!((
fPix–F‹»dFÏgs
[1][
pix–Num
] & 
e11n
) | (fPixelFilteredFlags[1][pixelNum+1] &ƒ11n)));

1087 
upPix–
 = 
	`g‘4Pix–
(
row2PŒ
);

1088 
cu¼Pix–
 = 
	`g‘4Pix–
(
row3PŒ
);

1090 
R1
 = 
	`G‘Red
(
cu¼Pix–
);

1091 
G1
 = 
	`G‘G»’
(
cu¼Pix–
);

1092 
B1
 = 
	`G‘Blue
(
cu¼Pix–
);

1094 
R0
 = 
	`G‘Red
(
upPix–
);

1095 
G0
 = 
	`G‘G»’
(
upPix–
);

1096 
B0
 = 
	`G‘Blue
(
upPix–
);

1098 ià((
maxE¼ÜFÜFourPix–s
 >ğ3è&& (
	`NewD–E
(
R1
, 
R0
, 
G1
, 
G0
, 
B1
, 
B0
, maxErrorForFourPixels)))

1105 #ià
kG©h”Sts
 == 1

1106 
blockSts
[
es22w
]++;

1108 
	`Av”ageNRound
((
pix–Num
 & 0x02è=ğ0x02, 
R1
, R1, 
R0
, 
G1
, G1, 
G0
, 
B1
, B1, 
B0
);

1110 if(
l™eEndŸn
)

1111 
cu¼Pix–
 = (
R1
<<16è+ (
G1
<<8è+ 
B1
;

1112 if(
bigEndŸn
)

1113 
cu¼Pix–
 = (
R1
<<24è+ (
G1
<<16è+ (
B1
<<8);

1116 
	`put4Pix–
(
row2PŒ
, 0, 
cu¼Pix–
);

1117 
	`put4Pix–
(
row2PŒ
, 1, 
cu¼Pix–
);

1118 
	`put4Pix–
(
row3PŒ
, 0, 
cu¼Pix–
);

1119 
	`put4Pix–
(
row3PŒ
, 1, 
cu¼Pix–
);

1121 
fPix–F‹»dFÏgs
[0][
pix–Num
] = fPix–F‹»dFÏgs[0][pix–Num] & ~
e21sw
;

1122 
fPix–F‹»dFÏgs
[0][
pix–Num
+1] = fPix–F‹»dFÏgs[0][pix–Num+1] & ~
e21£
;

1124 
fPix–F‹»dFÏgs
[1][
pix–Num
] = fPix–F‹»dFÏgs[1][pix–Num] & ~
e21nw
;

1125 
fPix–F‹»dFÏgs
[1][
pix–Num
+1] = fPix–F‹»dFÏgs[1][pix–Num+1] & ~
e21Ã
;

1128 
pix–Num
 += 2;

1130 
row1PŒ
 +ğ2*
eBufã»dPix–WidthInBy‹s
;

1131 
row2PŒ
 +ğ2*
eBufã»dPix–WidthInBy‹s
;

1132 
row3PŒ
 +ğ2*
eBufã»dPix–WidthInBy‹s
;

1133 
row4PŒ
 +ğ2*
eBufã»dPix–WidthInBy‹s
;

1135 ià((
fPix–F‹»dFÏgs
[0][
pix–Num
] & 
e11s
)

1136 && (
fPix–F‹»dFÏgs
[1][
pix–Num
] & 
e11n
))

1146 
upPix–
 = 
	`g‘4Pix–
(
row2PŒ
);

1147 
cu¼Pix–
 = 
	`g‘4Pix–
(
row3PŒ
);

1149 
R1
 = 
	`G‘Red
(
cu¼Pix–
);

1150 
G1
 = 
	`G‘G»’
(
cu¼Pix–
);

1151 
B1
 = 
	`G‘Blue
(
cu¼Pix–
);

1153 
R0
 = 
	`G‘Red
(
upPix–
);

1154 
G0
 = 
	`G‘G»’
(
upPix–
);

1155 
B0
 = 
	`G‘Blue
(
upPix–
);

1157 ià((
fMaxE¼ÜFÜTwoPix–s
 >ğ3è&& (
	`NewD–E
(
R1
, 
R0
, 
G1
, 
G0
, 
B1
, 
B0
, fMaxErrorForTwoPixels)))

1164 #ià
kG©h”Sts
 == 1

1165 
blockSts
[
es12w
]++;

1167 
	`Av”ageNRound
(
	`isOdd
(
pix–Num
), 
R1
, R1, 
R0
, 
G1
, G1, 
G0
, 
B1
, B1, 
B0
);

1169 if(
l™eEndŸn
)

1170 
cu¼Pix–
 = (
R1
<<16è+ (
G1
<<8è+ 
B1
;

1171 if(
bigEndŸn
)

1172 
cu¼Pix–
 = (
R1
<<24è+ (
G1
<<16è+ (
B1
<<8);

1175 
	`put4Pix–
(
row2PŒ
, 0, 
cu¼Pix–
);

1176 
	`put4Pix–
(
row3PŒ
, 0, 
cu¼Pix–
);

1178 
fPix–F‹»dFÏgs
[0][
pix–Num
] = fPix–F‹»dFÏgs[0][pix–Num] & ~
e11s
;

1180 
fPix–F‹»dFÏgs
[1][
pix–Num
] = fPix–F‹»dFÏgs[1][pix–Num] & ~
e11n
;

1183 
pix–Num
 += 1;

1185 
row1PŒ
 +ğ
eBufã»dPix–WidthInBy‹s
;

1186 
row2PŒ
 +ğ
eBufã»dPix–WidthInBy‹s
;

1187 
row3PŒ
 +ğ
eBufã»dPix–WidthInBy‹s
;

1188 
row4PŒ
 +ğ
eBufã»dPix–WidthInBy‹s
;

1192 
pix–Num
 += 1;

1194 
row1PŒ
 +ğ
eBufã»dPix–WidthInBy‹s
;

1195 
row2PŒ
 +ğ
eBufã»dPix–WidthInBy‹s
;

1196 
row3PŒ
 +ğ
eBufã»dPix–WidthInBy‹s
;

1197 
row4PŒ
 +ğ
eBufã»dPix–WidthInBy‹s
;

1200 
	}
}

1209 
	gTEº›F‹r
::
	$F‹r3F‹»dRows
(*
row1PŒ
, *
row2PŒ
, *
row3PŒ
)

1211 cÚ¡ 
maxE¼ÜFÜFourPix–s
 = 
fMaxE¼ÜFÜTwoPix–s
 / 2;

1212 cÚ¡ 
maxE¼ÜFÜEightPix–s
 = 
maxE¼ÜFÜFourPix–s
 / 2;

1216 
pix–Num
 = 0;…ix–Num < (
fRowWidthInPix–s
-3);)

1219 
ušt32_t
 
cu¼Pix–
, 
upPix–
;

1220 
R0
, 
G0
, 
B0
, 
R1
, 
G1
, 
B1
;

1222 ià((
fPix–F‹»dFÏgs
[0][
pix–Num
] & 
e41si
)

1223 && (
fPix–F‹»dFÏgs
[1][
pix–Num
] & 
e41ni
))

1232 
	`ASSERT
(!((
fPix–F‹»dFÏgs
[0][
pix–Num
] & 
e11s
) | (fPixelFilteredFlags[0][pixelNum+1] &ƒ11s)));

1233 
	`ASSERT
(!((
fPix–F‹»dFÏgs
[1][
pix–Num
] & 
e11n
) | (fPixelFilteredFlags[1][pixelNum+1] &ƒ11n)));

1235 
upPix–
 = 
	`g‘4Pix–
(
row2PŒ
);

1236 
cu¼Pix–
 = 
	`g‘4Pix–
(
row3PŒ
);

1238 
R1
 = 
	`G‘Red
(
cu¼Pix–
);

1239 
G1
 = 
	`G‘G»’
(
cu¼Pix–
);

1240 
B1
 = 
	`G‘Blue
(
cu¼Pix–
);

1242 
R0
 = 
	`G‘Red
(
upPix–
);

1243 
G0
 = 
	`G‘G»’
(
upPix–
);

1244 
B0
 = 
	`G‘Blue
(
upPix–
);

1247 ià((
maxE¼ÜFÜEightPix–s
 >ğ3è&& (
	`NewD–E
(
R1
, 
R0
, 
G1
, 
G0
, 
B1
, 
B0
, maxErrorForEightPixels)))

1255 #ià
kG©h”Sts
 == 1

1256 
blockSts
[
es42w
]++;

1258 
	`Av”ageNRound
((
pix–Num
 & 0x04è=ğ0x04, 
R1
, R1, 
R0
, 
G1
, G1, 
G0
, 
B1
, B1, 
B0
);

1260 if(
l™eEndŸn
)

1261 
cu¼Pix–
 = (
R1
<<16è+ (
G1
<<8è+ 
B1
;

1262 if(
bigEndŸn
)

1263 
cu¼Pix–
 = (
R1
<<24è+ (
G1
<<16è+ (
B1
<<8);

1266 
	`put4Pix–
(
row2PŒ
, 0, 
cu¼Pix–
);

1267 
	`put4Pix–
(
row2PŒ
, 1, 
cu¼Pix–
);

1268 
	`put4Pix–
(
row2PŒ
, 2, 
cu¼Pix–
);

1269 
	`put4Pix–
(
row2PŒ
, 3, 
cu¼Pix–
);

1270 
	`put4Pix–
(
row3PŒ
, 0, 
cu¼Pix–
);

1271 
	`put4Pix–
(
row3PŒ
, 1, 
cu¼Pix–
);

1272 
	`put4Pix–
(
row3PŒ
, 2, 
cu¼Pix–
);

1273 
	`put4Pix–
(
row3PŒ
, 3, 
cu¼Pix–
);

1275 
fPix–F‹»dFÏgs
[0][
pix–Num
] = fPix–F‹»dFÏgs[0][pix–Num] & ~
e41si
;

1276 
fPix–F‹»dFÏgs
[0][
pix–Num
+1] = fPix–F‹»dFÏgs[0][pix–Num+1] & ~
e41s
;

1277 
fPix–F‹»dFÏgs
[0][
pix–Num
+2] = fPix–F‹»dFÏgs[0][pix–Num+1] & ~
e41s
;

1278 
fPix–F‹»dFÏgs
[0][
pix–Num
+3] = fPix–F‹»dFÏgs[0][pix–Num+1] & ~
e41s
;

1280 
fPix–F‹»dFÏgs
[1][
pix–Num
] = fPix–F‹»dFÏgs[1][pix–Num] & ~
e41ni
;

1281 
fPix–F‹»dFÏgs
[1][
pix–Num
+1] = fPix–F‹»dFÏgs[1][pix–Num+1] & ~
e41n
;

1282 
fPix–F‹»dFÏgs
[1][
pix–Num
+2] = fPix–F‹»dFÏgs[1][pix–Num+1] & ~
e41n
;

1283 
fPix–F‹»dFÏgs
[1][
pix–Num
+3] = fPix–F‹»dFÏgs[1][pix–Num+1] & ~
e41n
;

1285 
pix–Num
 += 4;

1287 
row1PŒ
 +ğ4*
eBufã»dPix–WidthInBy‹s
;

1288 
row2PŒ
 +ğ4*
eBufã»dPix–WidthInBy‹s
;

1289 
row3PŒ
 +ğ4*
eBufã»dPix–WidthInBy‹s
;

1291 ià((
fPix–F‹»dFÏgs
[0][
pix–Num
] & 
e21sw
)

1292 && (
fPix–F‹»dFÏgs
[1][
pix–Num
] & 
e21nw
))

1301 
	`ASSERT
(!((
fPix–F‹»dFÏgs
[0][
pix–Num
] & 
e11s
) | (fPixelFilteredFlags[0][pixelNum+1] &ƒ11s)));

1302 
	`ASSERT
(!((
fPix–F‹»dFÏgs
[1][
pix–Num
] & 
e11n
) | (fPixelFilteredFlags[1][pixelNum+1] &ƒ11n)));

1304 
upPix–
 = 
	`g‘4Pix–
(
row2PŒ
);

1305 
cu¼Pix–
 = 
	`g‘4Pix–
(
row3PŒ
);

1307 
R1
 = 
	`G‘Red
(
cu¼Pix–
);

1308 
G1
 = 
	`G‘G»’
(
cu¼Pix–
);

1309 
B1
 = 
	`G‘Blue
(
cu¼Pix–
);

1311 
R0
 = 
	`G‘Red
(
upPix–
);

1312 
G0
 = 
	`G‘G»’
(
upPix–
);

1313 
B0
 = 
	`G‘Blue
(
upPix–
);

1315 ià((
maxE¼ÜFÜFourPix–s
 >ğ3è&& (
	`NewD–E
(
R1
, 
R0
, 
G1
, 
G0
, 
B1
, 
B0
, maxErrorForFourPixels)))

1322 #ià
kG©h”Sts
 == 1

1323 
blockSts
[
es22w
]++;

1325 
	`Av”ageNRound
((
pix–Num
 & 0x02è=ğ0x02, 
R1
, R1, 
R0
, 
G1
, G1, 
G0
, 
B1
, B1, 
B0
);

1327 if(
l™eEndŸn
)

1328 
cu¼Pix–
 = (
R1
<<16è+ (
G1
<<8è+ 
B1
;

1329 if(
bigEndŸn
)

1330 
cu¼Pix–
 = (
R1
<<24è+ (
G1
<<16è+ (
B1
<<8);

1333 
	`put4Pix–
(
row2PŒ
, 0, 
cu¼Pix–
);

1334 
	`put4Pix–
(
row2PŒ
, 1, 
cu¼Pix–
);

1335 
	`put4Pix–
(
row3PŒ
, 0, 
cu¼Pix–
);

1336 
	`put4Pix–
(
row3PŒ
, 1, 
cu¼Pix–
);

1338 
fPix–F‹»dFÏgs
[0][
pix–Num
] = fPix–F‹»dFÏgs[0][pix–Num] & ~
e21sw
;

1339 
fPix–F‹»dFÏgs
[0][
pix–Num
+1] = fPix–F‹»dFÏgs[0][pix–Num+1] & ~
e21£
;

1341 
fPix–F‹»dFÏgs
[1][
pix–Num
] = fPix–F‹»dFÏgs[1][pix–Num] & ~
e21nw
;

1342 
fPix–F‹»dFÏgs
[1][
pix–Num
+1] = fPix–F‹»dFÏgs[1][pix–Num+1] & ~
e21Ã
;

1345 
pix–Num
 += 2;

1347 
row1PŒ
 +ğ2*
eBufã»dPix–WidthInBy‹s
;

1348 
row2PŒ
 +ğ2*
eBufã»dPix–WidthInBy‹s
;

1349 
row3PŒ
 +ğ2*
eBufã»dPix–WidthInBy‹s
;

1351 ià((
fPix–F‹»dFÏgs
[0][
pix–Num
] & 
e11s
)

1352 && (
fPix–F‹»dFÏgs
[1][
pix–Num
] & 
e11n
))

1362 
upPix–
 = 
	`g‘4Pix–
(
row2PŒ
);

1363 
cu¼Pix–
 = 
	`g‘4Pix–
(
row3PŒ
);

1365 
R1
 = 
	`G‘Red
(
cu¼Pix–
);

1366 
G1
 = 
	`G‘G»’
(
cu¼Pix–
);

1367 
B1
 = 
	`G‘Blue
(
cu¼Pix–
);

1369 
R0
 = 
	`G‘Red
(
upPix–
);

1370 
G0
 = 
	`G‘G»’
(
upPix–
);

1371 
B0
 = 
	`G‘Blue
(
upPix–
);

1373 ià((
fMaxE¼ÜFÜTwoPix–s
 >ğ3è&& (
	`NewD–E
(
R1
, 
R0
, 
G1
, 
G0
, 
B1
, 
B0
, fMaxErrorForTwoPixels)))

1380 #ià
kG©h”Sts
 == 1

1381 
blockSts
[
es12w
]++;

1383 
	`Av”ageNRound
(
	`isOdd
(
pix–Num
), 
R1
, R1, 
R0
, 
G1
, G1, 
G0
, 
B1
, B1, 
B0
);

1385 if(
l™eEndŸn
)

1386 
cu¼Pix–
 = (
R1
<<16è+ (
G1
<<8è+ 
B1
;

1387 if(
bigEndŸn
)

1388 
cu¼Pix–
 = (
R1
<<24è+ (
G1
<<16è+ (
B1
<<8);

1391 
	`put4Pix–
(
row2PŒ
, 0, 
cu¼Pix–
);

1392 
	`put4Pix–
(
row3PŒ
, 0, 
cu¼Pix–
);

1394 
fPix–F‹»dFÏgs
[0][
pix–Num
] = fPix–F‹»dFÏgs[0][pix–Num] & ~
e11s
;

1396 
fPix–F‹»dFÏgs
[1][
pix–Num
] = fPix–F‹»dFÏgs[1][pix–Num] & ~
e11n
;

1399 
pix–Num
 += 1;

1401 
row1PŒ
 +ğ
eBufã»dPix–WidthInBy‹s
;

1402 
row2PŒ
 +ğ
eBufã»dPix–WidthInBy‹s
;

1403 
row3PŒ
 +ğ
eBufã»dPix–WidthInBy‹s
;

1407 
pix–Num
 += 1;

1409 
row1PŒ
 +ğ
eBufã»dPix–WidthInBy‹s
;

1410 
row2PŒ
 +ğ
eBufã»dPix–WidthInBy‹s
;

1411 
row3PŒ
 +ğ
eBufã»dPix–WidthInBy‹s
;

1414 
	}
}

1416 
	#NEWTEST
 
Œue


	)

1418 
šlše
 
boŞ
 
	gTEº›F‹r
::
	$NewD–E
(
dr0
, 
dr1
, 
dg0
, 
dg1
, 
db0
, 
db1
, 
tŞ”ªû
)

1420 
Y0
, 
Y1
, 
dY
, 
Cr0
, 
Cr1
, 
Cb0
, 
Cb1
, 
dCr
, 
dCb
;

1424 
Y0
 = 5*
dr0
 + 9*
dg0
 + 2*
db0
;

1425 
Y1
 = 5*
dr1
 + 9*
dg1
 + 2*
db1
;

1427 
dY
 = 
	`ABS
(
Y0
 - 
Y1
) >> 4;

1429 if(
dY
 > 
tŞ”ªû
) {

1430  
çl£
;

1434 
Cr0
 = (
dr0
 << 4è- 
Y0
;

1435 
Cr1
 = (
dr1
 << 4è- 
Y1
;

1436 
dCr
 = 
	`ABS
(
Cr0
 - 
Cr1
) >> 5;

1437 if(
dCr
 > 
tŞ”ªû
)

1439  
çl£
;

1443 
Cb0
 = (
db0
 << 4è- 
Y0
;

1444 
Cb1
 = (
db1
 << 4è- 
Y1
;

1445 
dCb
 = 
	`ABS
(
Cb0
 - 
Cb1
) >> 6;

1446 if(
dCb
 > 
tŞ”ªû
)

1448  
çl£
;

1452  
Œue
;

1453 
	}
}

1455 
	gTEº›F‹r
::
	$TEº›F‹r
(
rowWidthInPix–s
, 
pix–Ty³s
 
pix–Ty³
, 
maxE¼ÜFÜTwoPix–s
, 
by‹sP”Pix–
)

1456 : 
	$fOrigš®Pix–Size
(
by‹sP”Pix–
)

1458 
šdex
;

1459 
	`ASSERT
((
fOrigš®Pix–Size
 == 3) || (fOriginalPixelSize == 4));

1460 
	`ASSERT
(
rowWidthInPix–s
 > 0);

1461 
	`ASSERT
(
pix–Ty³
 =ğ
eBGRPix–D©a
);

1463 
fIÁ”ÇlBufãrPix–Size
 = 4;

1465 
fPix–Off£tIndex
 = 0;

1466 
fRowWidthInPix–s
 = 
rowWidthInPix–s
;

1467 
fRowWidthInBy‹s
 = 
fRowWidthInPix–s
*
fIÁ”ÇlBufãrPix–Size
;

1468 
fMaxE¼ÜFÜTwoPix–s
 = 
maxE¼ÜFÜTwoPix–s
;

1470 
šdex
 = 0; index < 4; index++)

1472 
fRowBuf
[
šdex
] = 
Ãw
 
ušt32_t
[
rowWidthInPix–s
];

1473 
	`ASSERT
(
fRowBuf
[
šdex
]);

1475 
fRowPŒ
[
šdex
] = 
Ãw
 [
rowWidthInPix–s
*
fOrigš®Pix–Size
];

1476 
	`ASSERT
(
fRowPŒ
[
šdex
]);

1478 
fBÏckRowPŒ
[
šdex
] = 
Ãw
 
BYTE
[
rowWidthInPix–s
*
fOrigš®Pix–Size
];

1479 
	`ASSERT
(
fBÏckRowPŒ
[
šdex
]);

1481 
BÏckRa¡”Size
[
šdex
] = 0;

1484 
šdex
 = 0; index < 2; index++)

1486 
fPix–F‹»dFÏgs
[
šdex
] = 
Ãw
 [
rowWidthInPix–s
];

1487 
	`ASSERT
(
fPix–F‹»dFÏgs
[
šdex
]);

1493 
maxCom´essiÚBufSize
 = 
fRowWidthInBy‹s
 + 1 + (()
	`û
(()
	`MAX
((
rowWidthInPix–s
-2)/255, 0)));

1495 
fCom´essiÚOutBuf
 = 
Ãw
 [
maxCom´essiÚBufSize
];

1496 
	`ASSERT
(
fCom´essiÚOutBuf
);

1498 
fNumb”OfBufã»dRows
 = 0;

1500 
fPix–Off£t
[0] = 0;

1501 
fPix–Off£t
[1] = 5;

1502 
fPix–Off£t
[2] = 2;

1503 
fPix–Off£t
[3] = 7;

1504 
fPix–Off£t
[4] = 1;

1505 
fPix–Off£t
[5] = 4;

1506 
fPix–Off£t
[6] = 6;

1507 
fPix–Off£t
[7] = 3;

1509 
RowIndex
 = 0;

1510 
	}
}

1513 
	gTEº›F‹r
::~
	$TEº›F‹r
()

1516 
šdex
;

1518 
šdex
 = 0; index < 4; index++)

1520 
d–‘e
 [] 
fRowBuf
[
šdex
];

1521 
d–‘e
 [] 
fRowPŒ
[
šdex
];

1522 
d–‘e
 [] 
fBÏckRowPŒ
[
šdex
];

1525 
šdex
 = 0; index < 2; index++)

1527 
d–‘e
 [] 
fPix–F‹»dFÏgs
[
šdex
];

1530 
d–‘e
 [] 
fCom´essiÚOutBuf
;

1531 
	}
}

1533 
	gTEº›F‹r
::
	$wr™eBufã»dRows
()

1535 
pix–Index
 = 0;

1539 ifĞ1 =ğ
fNumb”OfBufã»dRows
)

1542 
off£t2
 = 
fPix–Off£t
[
fPix–Off£tIndex
];

1544 
	`F‹r1RawRow
Ğ(*)(
fRowBuf
[0] + 
off£t2
),

1545 
fRowWidthInPix–s
 - 
fPix–Off£t
[
fPix–Off£tIndex
],

1546 
fPix–F‹»dFÏgs
[0] + 
fPix–Off£t
[
fPix–Off£tIndex
]);

1549 *
rowPŒ
 = 
fRowPŒ
[0];

1550 
	`ASSERT
(
rowPŒ
);

1551 
pix–Index
 = 0;

1554 
	`memıy
(
rowPŒ
, &
fRowBuf
[0][
pix–Index
], 3);

1555 
rowPŒ
 += 3;

1556 } ++
pix–Index
 < 
fRowWidthInPix–s
);

1562 ià(2 =ğ
fNumb”OfBufã»dRows
)

1565 
k
;

1566 
k
 = 0; k < 2; k++)

1568 *
rowPŒ
 = 
fRowPŒ
[
k
];

1569 
	`ASSERT
(
rowPŒ
);

1570 
pix–Index
 = 0;

1573 
	`memıy
(
rowPŒ
, &
fRowBuf
[
k
][
pix–Index
], 3);

1574 
rowPŒ
 += 3;

1575 } ++
pix–Index
 < 
fRowWidthInPix–s
);

1584 ià(3 =ğ
fNumb”OfBufã»dRows
)

1587 
off£t2
 = 
fPix–Off£t
[
fPix–Off£tIndex
];

1589 
	`F‹r1RawRow
Ğ(*)(
fRowBuf
[2] + 
off£t2
),

1590 
fRowWidthInPix–s
 - 
fPix–Off£t
[
fPix–Off£tIndex
],

1591 
fPix–F‹»dFÏgs
[1] + 
fPix–Off£t
[
fPix–Off£tIndex
]);

1594 
	`F‹r3F‹»dRows
Ğ(*)
fRowBuf
[0],

1595 (*)
fRowBuf
[1],

1596 (*)
fRowBuf
[2]);

1598 
k
;

1599 
k
 = 0; k < 3; k++)

1601 *
rowPŒ
 = 
fRowPŒ
[
k
];

1602 
	`ASSERT
(
rowPŒ
);

1603 
pix–Index
 = 0;

1606 
	`memıy
(
rowPŒ
, &
fRowBuf
[
k
][
pix–Index
], 3);

1607 
rowPŒ
 += 3;

1608 } ++
pix–Index
 < 
fRowWidthInPix–s
);

1611 
	}
}

1613 
	gTEº›F‹r
::
	$subm™RowToF‹r
(*
rowPŒ
)

1615 
	`memıy
(
fRowPŒ
[
fNumb”OfBufã»dRows
], 
rowPŒ
, 
fRowWidthInPix–s
*3);

1618 
pix–Index
 = 0;

1619 
ušt32_t
 *
RowPŒDe¡
 = 
fRowBuf
[
fNumb”OfBufã»dRows
];

1620 
BYTE
 
by‹1
 = 0;

1621 
BYTE
 
by‹2
 = 0;

1622 
BYTE
 
by‹3
 = 0;

1625 
by‹1
 = *
rowPŒ
++;

1626 
by‹2
 = *
rowPŒ
++;

1627 
by‹3
 = *
rowPŒ
++;

1628 if(
l™eEndŸn
)

1629 
RowPŒDe¡
[
pix–Index
] = ((
by‹3
 << 16è| (
by‹2
 << 8è| (
by‹1
)) & 0x00FFFFFF;

1630 if(
bigEndŸn
)

1631 
RowPŒDe¡
[
pix–Index
] = ((
by‹1
 << 24è| (
by‹2
 << 16è| (
by‹3
 << 8)) & 0xFFFFFF00;

1632 } ++
pix–Index
 < 
fRowWidthInPix–s
);

1634 
fNumb”OfBufã»dRows
++;

1636 
iRa¡”sR—dy
=0;

1637 
iRa¡”sD–iv”ed
=0;

1642 ià(2 =ğ
fNumb”OfBufã»dRows
)

1644 
off£t2
 = 
fPix–Off£t
[
fPix–Off£tIndex
];

1646 
	`F‹r2RawRows
Ğ(*)(
fRowBuf
[1] + 
off£t2
),

1647 (*)(
fRowBuf
[0] + 
off£t2
),

1648 
fRowWidthInPix–s
 - 
fPix–Off£t
[
fPix–Off£tIndex
],

1649 
fPix–F‹»dFÏgs
[0] + 
fPix–Off£t
[
fPix–Off£tIndex
]);

1652 ià(4 =ğ
fNumb”OfBufã»dRows
)

1654 
off£t4
 = 
fPix–Off£t
[
fPix–Off£tIndex
];

1655 
	`F‹r2RawRows
Ğ(*)(
fRowBuf
[3] + 
off£t4
),

1656 (*)(
fRowBuf
[2] + 
off£t4
),

1657 
fRowWidthInPix–s
 - 
fPix–Off£t
[
fPix–Off£tIndex
],

1658 
fPix–F‹»dFÏgs
[1] + 
fPix–Off£t
[
fPix–Off£tIndex
]);

1660 
	`F‹r2PaœsOfF‹»dRows
Ğ(*)
fRowBuf
[0],

1661 (*)
fRowBuf
[1],

1662 (*)
fRowBuf
[2],

1663 (*)
fRowBuf
[3]);

1665 #ià
kMemWr™esO±imize
 == 1

1668 
	`Wr™eBlockPix–s
();

1671 
fPix–Off£tIndex
 = (fPixelOffsetIndex + 1) % 8;

1673 
k
;

1674 
k
 = 0; k < 
fPix–Off£t
[
fPix–Off£tIndex
]; k++)

1676 
fPix–F‹»dFÏgs
[0][
k
] = 
eDÚe
;

1677 
fPix–F‹»dFÏgs
[1][
k
] = 
eDÚe
;

1681 
k
 = 0; k < 4; k++)

1683 *
rowPŒ
 = 
fRowPŒ
[
k
];

1684 
	`ASSERT
(
rowPŒ
);

1685 
pix–Index
 = 0;

1688 
	`memıy
(
rowPŒ
, &
fRowBuf
[
k
][
pix–Index
], 
fOrigš®Pix–Size
);

1689 
rowPŒ
 +ğ
fOrigš®Pix–Size
;

1690 } ++
pix–Index
 < 
fRowWidthInPix–s
);

1693 
fNumb”OfBufã»dRows
 = 0;

1694 
iRa¡”sR—dy
 = 4;

1696 
	}
}

1699 #ià
kMemWr™esO±imize
 == 1

1707 
	gTEº›F‹r
::
	$Wr™eBlockPix–s
()

1709 *
row1PŒ
 = (*)
fRowBuf
[0];

1710 *
row2PŒ
 = (*)
fRowBuf
[1];

1711 *
row3PŒ
 = (*)
fRowBuf
[2];

1712 *
row4PŒ
 = (*)
fRowBuf
[3];

1714 
æagS‘
 = 0; flagSet <= 1; flagSet++)

1716 *
æagsPŒ
 = 
fPix–F‹»dFÏgs
[0];

1717 *
rowA
 = (*)
fRowBuf
[0];

1718 *
rowB
 = (*)
fRowBuf
[1];

1720 ià(
æagS‘
 == 1)

1722 
æagsPŒ
 = 
fPix–F‹»dFÏgs
[1];

1723 
rowA
 = (*)
fRowBuf
[2];

1724 
rowB
 = (*)
fRowBuf
[3];

1727 
rowIndex
 = 0;„owIndex < 
fRowWidthInPix–s
;)

1729 
cu¼’tFÏgs
 = 
æagsPŒ
[
rowIndex
];

1731 #iâdeà
NDEBUG


1732 
numb”OfB™sS‘
 = 0;

1733 
cu¼’tFÏgsCİy
 = 
cu¼’tFÏgs
 & 
eTİLeáOfBlocks
;

1734 
cu¼’tFÏgsCİy
)

1736 ià(
cu¼’tFÏgsCİy
 & 1è
numb”OfB™sS‘
++;

1737 
cu¼’tFÏgsCİy
 >>= 1;

1739 
	`ASSERT
Ğ(
numb”OfB™sS‘
 <= 1) ||

1740 ((
numb”OfB™sS‘
 == 2) &&

1741 (((
cu¼’tFÏgs
 & 
eTİLeáOfBlocks
è& ~(
e21nw
|
e21sw
|
e41ni
|
e41si
))==0)));

1744 ià(
cu¼’tFÏgs
 & 
eTİLeáOfBlocks
)

1747 
ušt32_t
 
pix–
;

1754 ià(
cu¼’tFÏgs
 & 
e22w
)

1756 
pix–
 = 
	`g‘4Pix–
(
rowA
, 
rowIndex
);

1758 
	`put4Pix–
(
rowB
, 
rowIndex
, 
pix–
);

1759 
rowIndex
 += 1;

1760 
	`put4Pix–
(
rowA
, 
rowIndex
, 
pix–
);

1761 
	`put4Pix–
(
rowB
, 
rowIndex
, 
pix–
);

1763 
rowIndex
 += 1;

1767 ià(
cu¼’tFÏgs
 & 
e12
)

1769 
	`put4Pix–
(
rowB
, 
rowIndex
, 
	`g‘4Pix–
(
rowA
,„owIndex));

1771 
rowIndex
 += 1;

1775 ià(
cu¼’tFÏgs
 & 
e42i
)

1777 
pix–
 = 
	`g‘4Pix–
(
rowA
, 
rowIndex
);

1779 
	`put4Pix–
(
rowB
, 
rowIndex
, 
pix–
);

1781 
rowIndex
 += 1;

1782 
	`put4Pix–
(
rowA
, 
rowIndex
, 
pix–
);

1783 
	`put4Pix–
(
rowB
, 
rowIndex
, 
pix–
);

1785 
rowIndex
 += 1;

1786 
	`put4Pix–
(
rowB
, 
rowIndex
, 
pix–
);

1787 
	`put4Pix–
(
rowA
, 
rowIndex
, 
pix–
);

1789 
rowIndex
 += 1;

1790 
	`put4Pix–
(
rowA
, 
rowIndex
, 
pix–
);

1791 
	`put4Pix–
(
rowB
, 
rowIndex
, 
pix–
);

1793 
rowIndex
 += 1;

1797 ià(
cu¼’tFÏgs
 & 
e84ni
)

1799 
pix–
 = 
	`g‘4Pix–
(
rowA
, 
rowIndex
);

1801 
	`put4Pix–
(
row2PŒ
, 
rowIndex
, 
pix–
);

1802 
	`put4Pix–
(
row3PŒ
, 
rowIndex
, 
pix–
);

1803 
	`put4Pix–
(
row4PŒ
, 
rowIndex
, 
pix–
);

1805 
rowIndex
 += 1;

1806 
	`put4Pix–
(
row1PŒ
, 
rowIndex
, 
pix–
);

1807 
	`put4Pix–
(
row2PŒ
, 
rowIndex
, 
pix–
);

1808 
	`put4Pix–
(
row3PŒ
, 
rowIndex
, 
pix–
);

1809 
	`put4Pix–
(
row4PŒ
, 
rowIndex
, 
pix–
);

1811 
rowIndex
 += 1;

1812 
	`put4Pix–
(
row1PŒ
, 
rowIndex
, 
pix–
);

1813 
	`put4Pix–
(
row2PŒ
, 
rowIndex
, 
pix–
);

1814 
	`put4Pix–
(
row3PŒ
, 
rowIndex
, 
pix–
);

1815 
	`put4Pix–
(
row4PŒ
, 
rowIndex
, 
pix–
);

1817 
rowIndex
 += 1;

1818 
	`put4Pix–
(
row1PŒ
, 
rowIndex
, 
pix–
);

1819 
	`put4Pix–
(
row2PŒ
, 
rowIndex
, 
pix–
);

1820 
	`put4Pix–
(
row3PŒ
, 
rowIndex
, 
pix–
);

1821 
	`put4Pix–
(
row4PŒ
, 
rowIndex
, 
pix–
);

1823 
rowIndex
 += 1;

1824 
	`put4Pix–
(
row1PŒ
, 
rowIndex
, 
pix–
);

1825 
	`put4Pix–
(
row2PŒ
, 
rowIndex
, 
pix–
);

1826 
	`put4Pix–
(
row3PŒ
, 
rowIndex
, 
pix–
);

1827 
	`put4Pix–
(
row4PŒ
, 
rowIndex
, 
pix–
);

1829 
rowIndex
 += 1;

1830 
	`put4Pix–
(
row1PŒ
, 
rowIndex
, 
pix–
);

1831 
	`put4Pix–
(
row2PŒ
, 
rowIndex
, 
pix–
);

1832 
	`put4Pix–
(
row3PŒ
, 
rowIndex
, 
pix–
);

1833 
	`put4Pix–
(
row4PŒ
, 
rowIndex
, 
pix–
);

1835 
rowIndex
 += 1;

1836 
	`put4Pix–
(
row1PŒ
, 
rowIndex
, 
pix–
);

1837 
	`put4Pix–
(
row2PŒ
, 
rowIndex
, 
pix–
);

1838 
	`put4Pix–
(
row3PŒ
, 
rowIndex
, 
pix–
);

1839 
	`put4Pix–
(
row4PŒ
, 
rowIndex
, 
pix–
);

1841 
rowIndex
 += 1;

1842 
	`put4Pix–
(
row1PŒ
, 
rowIndex
, 
pix–
);

1843 
	`put4Pix–
(
row2PŒ
, 
rowIndex
, 
pix–
);

1844 
	`put4Pix–
(
row3PŒ
, 
rowIndex
, 
pix–
);

1845 
	`put4Pix–
(
row4PŒ
, 
rowIndex
, 
pix–
);

1847 
rowIndex
 += 1;

1852 ià(
cu¼’tFÏgs
 & 
e24nw
)

1854 
pix–
 = 
	`g‘4Pix–
(
row1PŒ
, 
rowIndex
);

1856 
	`put4Pix–
(
row2PŒ
, 
rowIndex
, 
pix–
);

1857 
	`put4Pix–
(
row3PŒ
, 
rowIndex
, 
pix–
);

1858 
	`put4Pix–
(
row4PŒ
, 
rowIndex
, 
pix–
);

1860 
rowIndex
 += 1;

1861 
	`put4Pix–
(
row1PŒ
, 
rowIndex
, 
pix–
);

1862 
	`put4Pix–
(
row2PŒ
, 
rowIndex
, 
pix–
);

1863 
	`put4Pix–
(
row3PŒ
, 
rowIndex
, 
pix–
);

1864 
	`put4Pix–
(
row4PŒ
, 
rowIndex
, 
pix–
);

1866 
rowIndex
 += 1;

1870 ià(
cu¼’tFÏgs
 & 
e44ni
)

1872 
pix–
 = 
	`g‘4Pix–
(
row1PŒ
, 
rowIndex
);

1874 
	`put4Pix–
(
row2PŒ
, 
rowIndex
, 
pix–
);

1875 
	`put4Pix–
(
row3PŒ
, 
rowIndex
, 
pix–
);

1876 
	`put4Pix–
(
row4PŒ
, 
rowIndex
, 
pix–
);

1878 
rowIndex
 += 1;

1879 
	`put4Pix–
(
row1PŒ
, 
rowIndex
, 
pix–
);

1880 
	`put4Pix–
(
row2PŒ
, 
rowIndex
, 
pix–
);

1881 
	`put4Pix–
(
row3PŒ
, 
rowIndex
, 
pix–
);

1882 
	`put4Pix–
(
row4PŒ
, 
rowIndex
, 
pix–
);

1884 
rowIndex
 += 1;

1885 
	`put4Pix–
(
row1PŒ
, 
rowIndex
, 
pix–
);

1886 
	`put4Pix–
(
row2PŒ
, 
rowIndex
, 
pix–
);

1887 
	`put4Pix–
(
row3PŒ
, 
rowIndex
, 
pix–
);

1888 
	`put4Pix–
(
row4PŒ
, 
rowIndex
, 
pix–
);

1890 
rowIndex
 += 1;

1891 
	`put4Pix–
(
row1PŒ
, 
rowIndex
, 
pix–
);

1892 
	`put4Pix–
(
row2PŒ
, 
rowIndex
, 
pix–
);

1893 
	`put4Pix–
(
row3PŒ
, 
rowIndex
, 
pix–
);

1894 
	`put4Pix–
(
row4PŒ
, 
rowIndex
, 
pix–
);

1896 
rowIndex
 += 1;

1900 ià(
cu¼’tFÏgs
 & 
e14n
)

1902 
pix–
 = 
	`g‘4Pix–
(
row1PŒ
, 
rowIndex
);

1904 
	`put4Pix–
(
row2PŒ
, 
rowIndex
, 
pix–
);

1905 
	`put4Pix–
(
row3PŒ
, 
rowIndex
, 
pix–
);

1906 
	`put4Pix–
(
row4PŒ
, 
rowIndex
, 
pix–
);

1908 
rowIndex
 += 1;

1912 ià(
cu¼’tFÏgs
 & 
e21nw
)

1914 
	`put4Pix–
(
rowA
, 
rowIndex
+1, 
	`g‘4Pix–
(rowA,„owIndex));

1916 ià(!(
cu¼’tFÏgs
 & (
e21sw
|
e41si
)))

1918 
rowIndex
 += 2;

1923 ià(
cu¼’tFÏgs
 & 
e41ni
)

1925 
pix–
 = 
	`g‘4Pix–
(
rowA
, 
rowIndex
);

1927 
	`put4Pix–
(
rowA
, 
rowIndex
+1, 
pix–
);

1928 
	`put4Pix–
(
rowA
, 
rowIndex
+2, 
pix–
);

1929 
	`put4Pix–
(
rowA
, 
rowIndex
+3, 
pix–
);

1931 ià(!(
cu¼’tFÏgs
 & (
e21sw
|
e41si
)))

1933 
rowIndex
 += 2;

1938 ià(
cu¼’tFÏgs
 & 
e21sw
)

1940 
	`put4Pix–
(
rowB
, 
rowIndex
+1, 
	`g‘4Pix–
(rowB,„owIndex));

1942 
rowIndex
 += 2;

1946 ià(
cu¼’tFÏgs
 & 
e41si
)

1948 
pix–
 = 
	`g‘4Pix–
(
rowB
, 
rowIndex
);

1950 
	`put4Pix–
(
rowB
, 
rowIndex
+1, 
pix–
);

1951 
	`put4Pix–
(
rowB
, 
rowIndex
+2, 
pix–
);

1952 
	`put4Pix–
(
rowB
, 
rowIndex
+3, 
pix–
);

1954 
rowIndex
 += 2;

1958 
rowIndex
 += 1;

1961 
	}
}

1965 
	gAPDK_END_NAMESPACE


	@prnt/hpijs/filterhpa.h

32 #iâdeà
APDK_FILTERHPA_H


33 
	#APDK_FILTERHPA_H


	)

35 #ià
defšed
(
APDK_DJ9xxVIP
è&& defšed(
APDK_VIP_COLORFILTERING
)

37 
APDK_BEGIN_NAMESPACE


46 
	eeBlockTy³


48 
	meDÚe
 = 0x0,

49 
	me11n
 = 0x00000001,

50 
	me11s
 = 0x00000002,

51 
	me12
 = 0x00000004,

52 
	me14n
 = 0x00000008,

53 
	me14s
 = 0x00000010,

54 
	me21nw
 = 0x00000020,

55 
	me21Ã
 = 0x00000040,

56 
	me21sw
 = 0x00000080,

57 
	me21£
 = 0x00000100,

58 
	me22w
 = 0x00000200,

59 
	me22e
 = 0x00000400,

60 
	me24nw
 = 0x00000800,

61 
	me24Ã
 = 0x00001000,

62 
	me24sw
 = 0x00002000,

63 
	me24£
 = 0x00004000,

64 
	me41ni
 = 0x00008000,

65 
	me41n
 = 0x00010000,

66 
	me41si
 = 0x00020000,

67 
	me41s
 = 0x00040000,

68 
	me42i
 = 0x00080000,

69 
	me42
 = 0x00100000,

70 
	me44ni
 = 0x00200000,

71 
	me44n
 = 0x00400000,

72 
	me44si
 = 0x00800000,

73 
	me44s
 = 0x01000000,

74 
	me84ni
 = 0x02000000,

75 
	me84n
 = 0x04000000,

76 
	me84si
 = 0x08000000,

77 
	me84s
 = 0x10000000,

79 
	meNÜths
 = 
e11n
 | 
e21nw
 | 
e21Ã
 | 
e41ni
 | 
e41n
,

80 
	meSouths
 = 
e11s
 | 
e21sw
 | 
e21£
 | 
e41si
 | 
e41s
,

81 
	meTheRe¡
 = ~(
eNÜths
|
eSouths
),

83 
	meTİLeáOfBlocks
 = 
e12
 | 
e14n
 | 
e21nw
 | 
e21sw
 | 
e22w
 | 
e24nw
 | 
e41ni
 | 
e41si
 | 
e42i
 | 
e44ni
 | 
e84ni


86 
	#isOdd
(
x
è(x & 0x01)

	)

87 
	#isWh™e
(
x
è(((xè& 
kWh™e
è=ğkWh™e)

	)

89 
	#kMemWr™esO±imize
 0

90 

	)

95 #ià
kG©h”Sts
 == 1

101 
	eSti¡icBlocks


103 
	mes11n
 = 0,

104 
	mes11s
,

105 
	mes12
,

106 
	mes14n
,

107 
	mes14s
,

108 
	mes21nw
,

109 
	mes21Ã
,

110 
	mes21sw
,

111 
	mes21£
,

112 
	mes22w
,

113 
	mes22e
,

114 
	mes24nw
,

115 
	mes24Ã
,

116 
	mes24sw
,

117 
	mes24£
,

118 
	mes41ni
,

119 
	mes41n
,

120 
	mes41si
,

121 
	mes41s
,

122 
	mes42i
,

123 
	mes42
,

124 
	mes44ni
,

125 
	mes44n
,

126 
	mes44si
,

127 
	mes44s
,

128 
	mes84ni
,

129 
	mes84n
,

130 
	mes84si
,

131 
	mes84s
,

133 
	mesDÚeSt
,

134 
	mesWh™eFound
,

136 
	meLa¡Av”agšgFÏgPos™iÚ


141 
	epix–Ty³s


143 
	meBGRPix–D©a
 = 0

146 şas 
	cTEº›F‹r
 : 
public
 
ProûssÜ


148 
public
:

149 
TEº›F‹r
(
rowWidthInPix–s
, 
pix–Ty³s
 
pix–Ty³
, 
maxE¼ÜFÜTwoPix–s
, 
by‹sP”Pix–
 = 3);

150 
	mvœtu®
 ~
TEº›F‹r
();

152 
subm™RowToF‹r
(*
rowPŒ
);

153 
wr™eBufã»dRows
();

156 
BOOL
 
Proûss
(
RASTERDATA
* 
IÅutRa¡”
=
NULL
);

157 
Flush
();

158 
G‘OuutWidth
(
COLORTYPE
 
¿¡”cŞÜ
);

159 
G‘IÅutWidth
();

160 
BYTE
* 
NextOuutRa¡”
(
COLORTYPE
 
¿¡”cŞÜ
);

163 
	m´iv©e
:

164 
ušt32_t
 *
fRowBuf
[4];

165 *
	mfRowPŒ
[4];

166 
BYTE
 *
	mfBÏckRowPŒ
[4];

167 
	mBÏckRa¡”Size
[4];

168 *
	mfCom´essiÚOutBuf
;

169 *
	mfPix–F‹»dFÏgs
[2];

171 
	mfNumb”OfBufã»dRows
;

172 
	mfPix–Off£t
[8];

173 
	mfPix–Off£tIndex
;

174 
	mfRowWidthInPix–s
;

175 
	mfRowWidthInBy‹s
;

176 
	mfIÁ”ÇlBufãrPix–Size
;

177 
	mfOrigš®Pix–Size
;

178 
	mfMaxE¼ÜFÜTwoPix–s
;

180 
	mRowIndex
;

182 
F‹r1RawRow
(*
cu¼PŒ
, 
rowWidthInPix–s
, *
æagsPŒ
);

183 
F‹r2RawRows
(*
cu¼PŒ
, *
upPŒ
, 
rowWidthInPix–s
, *
æagsPŒ
);

184 
F‹r2PaœsOfF‹»dRows
(*
row1PŒ
, *
row2PŒ
, *
row3PŒ
, *
row4PŒ
);

185 
F‹r3F‹»dRows
(*
row1PŒ
, *
row2PŒ
, *
row3PŒ
);

186 
šlše
 
D–E
(
dr0
, 
dr1
, 
dg0
, 
dg1
, 
db0
, 
db1
);

187 
šlše
 
boŞ
 
NewD–E
(
dr0
, 
dr1
, 
dg0
, 
dg1
, 
db0
, 
db1
, 
tŞ”ªû
);

188 
šlše
 
G¿dD–E
(
dr
, 
dg
, 
db
);

190 #ià
kMemWr™esO±imize
 == 1

191 
Wr™eBlockPix–s
();

196 
	meBufã»dPix–WidthInBy‹s
 = 4

200 
	gAPDK_END_NAMESPACE


	@prnt/hpijs/font.h

32 #iâdeà
APDK_FONT_H


33 
	#APDK_FONT_H


	)

34 #ià
defšed
(
APDK_FONTS_NEEDED
)

36 
APDK_BEGIN_NAMESPACE


39 cÚ¡ 
	gsCour›r
[]="Courier";

40 cÚ¡ 
	gsCGTimes
[]="CGTimes";

41 cÚ¡ 
	gsL‘‹rGÙhic
[]="LetterGothic";

42 cÚ¡ 
	gsUniv”s
[]="Univers";

43 cÚ¡ 
	gsBad
[]="Bad";

45 
şass
 
	gPrštCÚ‹xt
;

68 şas 
	cFÚt


70 
ä›nd
 
şass
 
	mPrš‹r
;

71 
ä›nd
 
şass
 
	mTextMªag”
;

72 
	mpublic
:

75 
vœtu®
 ~
FÚt
();

80 
vœtu®
 
DRIVER_ERROR
 
G‘TextEx‹Á
(
PrštCÚ‹xt
* 
pPC
, cÚ¡ * 
pTextSŒšg
,cÚ¡ 
iL’SŒšg
,

81 & 
iHeight
, & 
iWidth
);

86 
vœtu®
 cÚ¡ * 
	$G‘Name
(ècÚ¡ {  
sBad
; }

89 
vœtu®
 
BOOL
 
	$IsBŞdAÎowed
(ècÚ¡ {  
FALSE
; 
	}
}

92 
vœtu®
 
BOOL
 
	$IsIlicAÎowed
(ècÚ¡ {  
FALSE
; 
	}
}

95 
vœtu®
 
BOOL
 
	$IsUnd”lšeAÎowed
(ècÚ¡ {  
FALSE
; 
	}
}

98 
vœtu®
 
BOOL
 
	$IsCŞÜAÎowed
(ècÚ¡ {  
FALSE
; 
	}
}

101 
vœtu®
 
BOOL
 
	$IsPrİÜtiÚ®
(ècÚ¡ {  
FALSE
; 
	}
}

104 
vœtu®
 
BOOL
 
	$HasS”if
(ècÚ¡ {  
FALSE
; 
	}
}

111 
vœtu®
 
BYTE
 
	$G‘P™ch
(cÚ¡ 
BYTE
 
poštsize
) const

112 {  0; 
	}
}

116 
BYTE
 
	giPoštsize
;

117 
BOOL
 
	gbBŞd
;

118 
BOOL
 
	gbIlic
;

119 
BOOL
 
	gbUnd”lše
;

120 
TEXTCOLOR
 
	geCŞÜ
;

121 
	giP™ch
;

128 
	gch¬£t
[
MAX_CHAR_SET
];

130 
BOOL
 
	gPrš‹rBa£d
;

133 
vœtu®
 
	$Index
(è{  -1; 
	}
};

139 #ifdeà
APDK_CAPTURE


140 
Sy¡emS”viûs
* 
	gpSS
;

141 
C­tu»_dFÚt
(cÚ¡ 
±r
);

143 
	g´Ùeùed
:

145 
FÚt
(
SizesAvaabË
,
BYTE
 
size
=0,

146 
BOOL
 
bŞd
=
FALSE
, BOOL 
™®ic
=FALSE, BOOL 
und”lše
=FALSE,

147 
TEXTCOLOR
 
cŞÜ
=
BLACK_TEXT
,
BOOL
 
´š‹r
=
TRUE
,

148 
pv»s
=300,
ph»s
=300);

151 
FÚt
(cÚ¡ FÚt& 
f
,cÚ¡ 
BYTE
 
bSize
,

152 cÚ¡ 
TEXTCOLOR
 
cŞÜ
, cÚ¡ 
BOOL
 
bŞd
,

153 cÚ¡ 
BOOL
 
™®ic
, cÚ¡ BOOL 
und”lše
);

157 
vœtu®
 
FÚt
* 
	$Ch¬S‘ClÚe
(* 
NewCh¬S‘
) const;

159 
numsizes
;

161 
vœtu®
 
BYTE
* 
	$G‘Sizes
(ècÚ¡ {  (
BYTE
*)
NULL
; 
	}
}

163 
vœtu®
 
	$Ordš®
() const

164 {  0; 
	}
}

167 
BYTE
 
AssignSize
(BYTE 
Size
);

168 
	$Sub¡_Ch¬
(& 
bCu¼Ch¬
)const;

172 cÚ¡ 
BYTE
 *
pWidthLo
[
MAX_POINTSIZES
];

173 cÚ¡ 
BYTE
 *
pWidthHi
[
MAX_POINTSIZES
];

175 
Prš‹rVRes
;

176 
Prš‹rHRes
;

178 
BOOL
 
š‹º®
;

180 
	}
};

196 şas 
	cReã»nûFÚt
 : 
public
 
FÚt


198 
ä›nd
 
şass
 
Prš‹r
;

199 
ä›nd
 
şass
 
	mDJ400
;

200 
	mpublic
:

201 
Reã»nûFÚt
(
SizesAvaabË
,
BYTE
 
size
=0,

202 
BOOL
 
bŞd
=
FALSE
, BOOL 
™®ic
=FALSE, BOOL 
und”lše
=FALSE,

203 
TEXTCOLOR
 
cŞÜ
=
BLACK_TEXT
,
BOOL
 
´š‹r
=
TRUE
,

204 
pv»s
=300,
ph»s
=300);

205 
	m´Ùeùed
:

206 ~
Reã»nûFÚt
();

209 
Reã»nûFÚt
(cÚ¡ Reã»nûFÚt& 
f
,cÚ¡ 
BYTE
 
bSize
,

210 cÚ¡ 
TEXTCOLOR
 
cŞÜ
, cÚ¡ 
BOOL
 
bŞd
,

211 cÚ¡ 
BOOL
 
™®ic
, cÚ¡ BOOL 
und”lše
);

216 #ifdeà
APDK_COURIER


219 
BYTE
 
Cour›rSizes
[];

221 şas 
	cCour›r
 : 
public
 
Reã»nûFÚt


223 
ä›nd
 
şass
 
Prš‹r
;

224 
	mpublic
:

225 
Cour›r
(
BYTE
 
size
=0,

226 
BOOL
 
bŞd
=
FALSE
, BOOL 
™®ic
=FALSE, BOOL 
und”lše
=FALSE,

227 
TEXTCOLOR
=
BLACK_TEXT
, 
SizesAvaabË
=3);

228 
	mvœtu®
 ~
Cour›r
();

231 
BYTE
 
	$G‘P™ch
(cÚ¡ 
BYTE
 
poštsize
)const;

232 cÚ¡ * 
	$G‘Name
(ècÚ¡ {  
sCour›r
; }

233 
BOOL
 
	$IsBŞdAÎowed
(ècÚ¡ {  
TRUE
; 
	}
}

234 
BOOL
 
	$IsIlicAÎowed
(ècÚ¡ {  
TRUE
; 
	}
}

235 
BOOL
 
	$IsUnd”lšeAÎowed
(ècÚ¡ {  
TRUE
; 
	}
}

236 
vœtu®
 
BOOL
 
	$IsCŞÜAÎowed
(ècÚ¡ {  
TRUE
; 
	}
}

237 
BOOL
 
	$IsPrİÜtiÚ®
(ècÚ¡ {  
FALSE
; 
	}
}

238 
BOOL
 
	$HasS”if
(ècÚ¡ {  
TRUE
; 
	}
}

240 
	$Index
(è{  
COURIER_INDEX
; 
	}
}

242 
BYTE
 
	gunu£d
;

244 
	g´Ùeùed
:

245 
Cour›r
(cÚ¡ Cour›r& 
f
,cÚ¡ 
BYTE
 
bSize
,

246 cÚ¡ 
TEXTCOLOR
 
cŞÜ
, cÚ¡ 
BOOL
 
bŞd
,

247 cÚ¡ 
BOOL
 
™®ic
, cÚ¡ BOOL 
und”lše
);

248 
	$Ordš®
(
poštsize
)const;

249 
vœtu®
 
BYTE
* 
	$G‘Sizes
(ècÚ¡ {  
Cour›rSizes
; 
	}
}

250 
vœtu®
 
FÚt
* 
	$Ch¬S‘ClÚe
(* 
NewCh¬S‘
) const

251 { 
Cour›r
* 
c
 = 
Ãw
 
	`Cour›r
(*
this
,
iPoštsize
,
eCŞÜ
,
bBŞd
,
bIlic
,
bUnd”lše
);

252 ià(
c
==
NULL
è (
FÚt
*)NULL;

253 
	`¡rıy
(
c
->
ch¬£t
, 
NewCh¬S‘
);

254  
c
;

255 
	}
}

258 #ifdeà
APDK_DJ400


260 
BYTE
 
Cour›r400Sizes
[];

262 şas 
	cCour›r400
 : 
public
 
Cour›r


264 
ä›nd
 
şass
 
DJ400
;

265 
	mpublic
:

266 
Cour›r400
(
BYTE
 
size
=0,

267 
BOOL
 
bŞd
=
FALSE
, BOOL 
™®ic
=FALSE, BOOL 
und”lše
=FALSE);

269 
BOOL
 
	$IsCŞÜAÎowed
(ècÚ¡ {  
FALSE
; }

272 
´Ùeùed
:

273 
	`Cour›r400
(cÚ¡ 
Cour›r400
& 
f
,cÚ¡ 
BYTE
 
bSize
,

274 cÚ¡ 
TEXTCOLOR
 
cŞÜ
, cÚ¡ 
BOOL
 
bŞd
,

275 cÚ¡ 
BOOL
 
™®ic
, cÚ¡ BOOL 
und”lše
);

276 
BYTE
* 
	$G‘Sizes
(ècÚ¡ {  
Cour›r400Sizes
; 
	}
}

277 
FÚt
* 
	$Ch¬S‘ClÚe
(* 
NewCh¬S‘
) const

278 { 
Cour›r400
* 
c
 = 
Ãw
 
	`Cour›r400
(*
this
,
iPoštsize
,
eCŞÜ
,
bBŞd
,
bIlic
,
bUnd”lše
);

279 ià(
c
==
NULL
è (
FÚt
*)NULL;

280 
	`¡rıy
(
c
->
ch¬£t
, 
NewCh¬S‘
);

281  
c
;

282 
	}
}

290 #ifdeà
APDK_CGTIMES


293 
BYTE
 
CGTimesSizes
[];

295 şas 
	cCGTimes
 : 
public
 
Reã»nûFÚt


297 
ä›nd
 
şass
 
Prš‹r
;

298 
	mpublic
:

299 
CGTimes
(
BYTE
 
size
=0,

300 
BOOL
 
bŞd
=
FALSE
, BOOL 
™®ic
=FALSE, BOOL 
und”lše
=FALSE,

301 
TEXTCOLOR
=
BLACK_TEXT
, 
SizesAvaabË
=5);

303 cÚ¡ * 
	$G‘Name
(ècÚ¡ {  
sCGTimes
; }

304 
BOOL
 
	$IsBŞdAÎowed
(ècÚ¡ {  
TRUE
; 
	}
}

305 
BOOL
 
	$IsIlicAÎowed
(ècÚ¡ {  
TRUE
; 
	}
}

306 
BOOL
 
	$IsUnd”lšeAÎowed
(ècÚ¡ {  
TRUE
; 
	}
}

307 
vœtu®
 
BOOL
 
	$IsCŞÜAÎowed
(ècÚ¡ {  
TRUE
; 
	}
}

308 
BOOL
 
	$IsPrİÜtiÚ®
(ècÚ¡ {  
TRUE
; 
	}
}

309 
BOOL
 
	$HasS”if
(ècÚ¡ {  
TRUE
; 
	}
}

311 
	$Index
(è{  
CGTIMES_INDEX
; 
	}
}

313 
	g´Ùeùed
:

314 
CGTimes
(cÚ¡ CGTimes& 
f
,cÚ¡ 
BYTE
 
bSize
,

315 cÚ¡ 
TEXTCOLOR
 
cŞÜ
, cÚ¡ 
BOOL
 
bŞd
,

316 cÚ¡ 
BOOL
 
™®ic
, cÚ¡ BOOL 
und”lše
);

317 
	$Ordš®
(
poštsize
)const;

318 
vœtu®
 
BYTE
* 
	$G‘Sizes
(ècÚ¡ {  
CGTimesSizes
; 
	}
}

319 
vœtu®
 
FÚt
* 
	$Ch¬S‘ClÚe
(* 
NewCh¬S‘
) const

320 { 
CGTimes
* 
c
 = 
Ãw
 
	`CGTimes
(*
this
,
iPoštsize
,
eCŞÜ
,
bBŞd
,
bIlic
,
bUnd”lše
);

321 ià(
c
==
NULL
è (
FÚt
*)NULL;

322 
	`¡rıy
(
c
->
ch¬£t
, 
NewCh¬S‘
);

323  
c
;

324 
	}
}

328 #ifdeà
APDK_DJ400


330 
BYTE
 
CGTimes400Sizes
[];

332 şas 
	cCGTimes400
 : 
public
 
CGTimes


334 
ä›nd
 
şass
 
DJ400
;

335 
	mpublic
:

336 
CGTimes400
(
BYTE
 
size
=0,

337 
BOOL
 
bŞd
=
FALSE
, BOOL 
™®ic
=FALSE, BOOL 
und”lše
=FALSE);

339 
BOOL
 
	$IsCŞÜAÎowed
(ècÚ¡ {  
FALSE
; }

342 
´Ùeùed
:

343 
	`CGTimes400
(cÚ¡ 
CGTimes400
& 
f
,cÚ¡ 
BYTE
 
bSize
,

344 cÚ¡ 
TEXTCOLOR
 
cŞÜ
, cÚ¡ 
BOOL
 
bŞd
,

345 cÚ¡ 
BOOL
 
™®ic
, cÚ¡ BOOL 
und”lše
);

346 
	$Ordš®
(
poštsize
)const;

347 
BYTE
* 
	$G‘Sizes
(ècÚ¡ {  
CGTimes400Sizes
; 
	}
}

348 
FÚt
* 
	$Ch¬S‘ClÚe
(* 
NewCh¬S‘
) const

349 { 
CGTimes400
* 
c
 = 
Ãw
 
	`CGTimes400
(*
this
,
iPoštsize
,
eCŞÜ
,
bBŞd
,
bIlic
,
bUnd”lše
);

350 ià(
c
==
NULL
è (
FÚt
*)NULL;

351 
	`¡rıy
(
c
->
ch¬£t
, 
NewCh¬S‘
);

352  
c
;

353 
	}
}

362 #ifdeà
APDK_LTRGOTHIC


365 
BYTE
 
L‘‹rGÙhicSizes
[];

368 şas 
	cL‘‹rGÙhic
 : 
public
 
Reã»nûFÚt


370 
ä›nd
 
şass
 
Prš‹r
;

371 
	mpublic
:

372 
L‘‹rGÙhic
(
BYTE
 
size
=0,

373 
BOOL
 
bŞd
=
FALSE
, BOOL 
™®ic
=FALSE, BOOL 
und”lše
=FALSE,

374 
TEXTCOLOR
=
BLACK_TEXT
, 
SizesAvaabË
=3);

375 
	mvœtu®
 ~
L‘‹rGÙhic
();

378 
BYTE
 
	$G‘P™ch
(cÚ¡ 
BYTE
 
poštsize
)const;

379 cÚ¡ * 
	$G‘Name
(ècÚ¡ {  
sL‘‹rGÙhic
; }

380 
BOOL
 
	$IsBŞdAÎowed
(ècÚ¡ {  
TRUE
; 
	}
}

381 
BOOL
 
	$IsIlicAÎowed
(ècÚ¡ {  
TRUE
; 
	}
}

382 
BOOL
 
	$IsUnd”lšeAÎowed
(ècÚ¡ {  
TRUE
; 
	}
}

383 
vœtu®
 
BOOL
 
	$IsCŞÜAÎowed
(ècÚ¡ {  
TRUE
; 
	}
}

384 
BOOL
 
	$IsPrİÜtiÚ®
(ècÚ¡ {  
FALSE
; 
	}
}

385 
BOOL
 
	$HasS”if
(ècÚ¡ {  
FALSE
; 
	}
}

387 
	$Index
(è{  
LETTERGOTHIC_INDEX
; 
	}
}

389 
BYTE
 
	gunu£d
;

391 
	g´Ùeùed
:

392 
L‘‹rGÙhic
(cÚ¡ L‘‹rGÙhic& 
f
,cÚ¡ 
BYTE
 
bSize
,

393 cÚ¡ 
TEXTCOLOR
 
cŞÜ
, cÚ¡ 
BOOL
 
bŞd
,

394 cÚ¡ 
BOOL
 
™®ic
, cÚ¡ BOOL 
und”lše
);

395 
	$Ordš®
(
poštsize
)const;

396 
vœtu®
 
BYTE
* 
	$G‘Sizes
(ècÚ¡ {  
L‘‹rGÙhicSizes
; 
	}
}

397 
vœtu®
 
FÚt
* 
	$Ch¬S‘ClÚe
(* 
NewCh¬S‘
) const

398 { 
L‘‹rGÙhic
* 
c
 = 
Ãw
 
	`L‘‹rGÙhic
(*
this
,
iPoštsize
,
eCŞÜ
,
bBŞd
,
bIlic
,
bUnd”lše
);

399 ià(
c
==
NULL
è (
FÚt
*)NULL;

400 
	`¡rıy
(
c
->
ch¬£t
, 
NewCh¬S‘
);

401  
c
;

402 
	}
}

405 #ifdeà
APDK_DJ400


407 
BYTE
 
L‘‹rGÙhic400Sizes
[];

409 şas 
	cL‘‹rGÙhic400
 : 
public
 
L‘‹rGÙhic


411 
ä›nd
 
şass
 
DJ400
;

412 
	mpublic
:

413 
L‘‹rGÙhic400
(
BYTE
 
size
=0,

414 
BOOL
 
bŞd
=
FALSE
, BOOL 
™®ic
=FALSE, BOOL 
und”lše
=FALSE);

416 
BOOL
 
	$IsCŞÜAÎowed
(ècÚ¡ {  
FALSE
; }

419 
´Ùeùed
:

420 
	`L‘‹rGÙhic400
(cÚ¡ 
L‘‹rGÙhic400
& 
f
,cÚ¡ 
BYTE
 
bSize
,

421 cÚ¡ 
TEXTCOLOR
 
cŞÜ
, cÚ¡ 
BOOL
 
bŞd
,

422 cÚ¡ 
BOOL
 
™®ic
, cÚ¡ BOOL 
und”lše
);

423 
BYTE
* 
	$G‘Sizes
(ècÚ¡ {  
L‘‹rGÙhic400Sizes
; 
	}
}

424 
FÚt
* 
	$Ch¬S‘ClÚe
(* 
NewCh¬S‘
) const

425 { 
L‘‹rGÙhic400
* 
c
 = 
Ãw
 
	`L‘‹rGÙhic400
(*
this
,
iPoštsize
,
eCŞÜ
,
bBŞd
,
bIlic
,
bUnd”lše
);

426 ià(
c
==
NULL
è (
FÚt
*)NULL;

427 
	`¡rıy
(
c
->
ch¬£t
, 
NewCh¬S‘
);

428  
c
;

429 
	}
}

437 #ifdeà
APDK_UNIVERS


440 
BYTE
 
Univ”sSizes
[];

442 şas 
	cUniv”s
 : 
public
 
Reã»nûFÚt


444 
ä›nd
 
şass
 
Prš‹r
;

445 
	mpublic
:

446 
Univ”s
(
BYTE
 
size
=0,

447 
BOOL
 
bŞd
=
FALSE
, BOOL 
™®ic
=FALSE, BOOL 
und”lše
=FALSE,

448 
TEXTCOLOR
=
BLACK_TEXT
, 
SizesAvaabË
=3);

450 cÚ¡ * 
	$G‘Name
(ècÚ¡ {  
sUniv”s
; }

451 
BOOL
 
	$IsBŞdAÎowed
(ècÚ¡ {  
TRUE
; 
	}
}

452 
BOOL
 
	$IsIlicAÎowed
(ècÚ¡ {  
TRUE
; 
	}
}

453 
BOOL
 
	$IsUnd”lšeAÎowed
(ècÚ¡ {  
TRUE
; 
	}
}

454 
vœtu®
 
BOOL
 
	$IsCŞÜAÎowed
(ècÚ¡ {  
TRUE
; 
	}
}

455 
BOOL
 
	$IsPrİÜtiÚ®
(ècÚ¡ {  
TRUE
; 
	}
}

456 
BOOL
 
	$HasS”if
(ècÚ¡ {  
FALSE
; 
	}
}

458 
	$Index
(è{  
UNIVERS_INDEX
; 
	}
}

460 
	g´Ùeùed
:

461 
Univ”s
(cÚ¡ Univ”s& 
f
,cÚ¡ 
BYTE
 
bSize
,

462 cÚ¡ 
TEXTCOLOR
 
cŞÜ
, cÚ¡ 
BOOL
 
bŞd
,

463 cÚ¡ 
BOOL
 
™®ic
, cÚ¡ BOOL 
und”lše
);

464 
	$Ordš®
(
poštsize
)const;

465 
vœtu®
 
BYTE
* 
	$G‘Sizes
(ècÚ¡ {  
Univ”sSizes
; 
	}
}

466 
vœtu®
 
FÚt
* 
	$Ch¬S‘ClÚe
(* 
NewCh¬S‘
) const

467 { 
Univ”s
* 
c
 = 
Ãw
 
	`Univ”s
(*
this
,
iPoštsize
,
eCŞÜ
,
bBŞd
,
bIlic
,
bUnd”lše
);

468 ià(
c
==
NULL
è (
FÚt
*)NULL;

469 
	`¡rıy
(
c
->
ch¬£t
, 
NewCh¬S‘
);

470  
c
;

471 
	}
}

476 
	gAPDK_END_NAMESPACE


	@prnt/hpijs/global_types.h

43 #iâdeà
APDK_GLOBAL_TYPES_H


44 
	#APDK_GLOBAL_TYPES_H


	)

46 
	~"mod–s.h
"

47 
	~"modes.h
"

49 
	#APDK_INVALID_VALUE
 -9999

	)

51 #ià
APDK_AUTO_INCLUDE


52 
	~"auto-šşude.h
"

54 
	tušt32_t
;

59 #ifdeà
APDK_NOTHROW


60 
	~<Ãw
>

62 
	#Ãw
 
	`Ãw
(
¡d
::
nÙhrow
)

	)

68 #ifdeà
NULL


69 #undeà
NULL


72 #iâdeà
NULL


73 
	#NULL
 0

	)

76 #iâdeà
BOOL


77 
	tBOOL
;

78 
	#TRUE
 1

	)

79 
	#FALSE
 0

	)

94 
	tBYTE
;

96 
	tWORD
;

98 
ušt32_t
 
	tDWORD
;

100 #iâdeà
LOWORD


101 
	#LOWORD
(
l
è((
WORD
èÖ))

	)

104 #iâdeà
HIWORD


105 
	#HIWORD
(
l
è((
WORD
è(((
DWORD
èÖè>> 16è& 0xFFFF))

	)

108 #iâdeà
ABS


109 
	#ABS
(
x
èĞ((x)<0è? -(xè: (xè)

	)

112 #ifdeà
BLACK_PEN


113 #undeà
BLACK_PEN


116 #ifdeà
NO_ERROR


117 #undeà
NO_ERROR


120 
APDK_BEGIN_NAMESPACE


124 
	eMedŸTy³


126 
	mmedŸAuto
 = -1,

127 
	mmedŸPÏš
 = 0,

128 
	mmedŸBÚd
 = 0,

129 
	mmedŸS³cŸl
 = 2,

130 
	mmedŸGlossy
 = 3,

131 
	mmedŸT¿n¥¬’cy
 = 4,

132 
	mmedŸHigh»sPhÙo
 = 3,

133 
	mmedŸCDDVD
 = 7,

134 
	mmedŸBrochu»
 = 8

139 
	eMedŸSize


141 
	msizeUSL‘‹r
 = 2,

142 
	msizeUSLeg®
 = 3,

143 
	msizeA4
 = 26,

144 
	msizeNum10Env
 = 81,

145 
	msizeA2Env
 = 109,

146 
	msizeC6Env
 = 92,

147 
	msizeDLEnv
 = 90,

148 
	msize3JPNEnv
 = 110,

149 
	msize4JPNEnv
 = 111,

150 
	msizePhÙo
 = 74,

151 
	msizeA6
 = 73,

152 
	msizeB4
 = 46,

153 
	msizeB5
 = 45,

154 
	msizeOUFUKU
 = 72,

155 
	msizeHAGAKI
 = 71,

156 
	msizeA3
 = 27,

157 
	msizeA5
 = 25,

158 
	msizeSu³rB
 = 16,

159 
	msizeLedg”
 = 6,

160 
	msizeFLSA
 = 10,

161 
	msizeExecutive
 = 1,

162 
	msizeCu¡om
 = 101,

163 
	msize5x7
 = 122,

164 
	msizeCDDVD80
 = 98,

165 
	msizeCDDVD120
 = 99

169 
	eMedŸSourû


171 
	msourûT¿yMš
 = -2,

172 
	msourûBªÃr
 = -1,

173 
	msourûT¿y1
 = 1,

174 
	msourûMªu®
 = 2,

175 
	msourûMªu®Env
 = 3,

176 
	msourûT¿y2
 = 4,

177 
	msourûDu¶ex”NHagakiF“d
 = 5,

178 
	msourûO±iÚ®Env
 = 6,

179 
	msourûT¿yPhÙo
 = 6,

180 
	msourûT¿yAuto
 = 7,

181 
	msourûT¿yCDDVD
 = 14,

182 
	msourûT¿yMax
 = 50

187 
	eQu®™y


189 
	mqu®™yAuto
 = -3,

190 
	mqu®™yFa¡D¿á
 = -2,

191 
	mqu®™yD¿á
 = -1,

192 
	mqu®™yNÜm®
 = 0,

193 
	mqu®™yP»£Á©iÚ
 = 1,

194 
	mqu®™yM¬v–lous
 = 2,

195 
	mqu®™yFa¡NÜm®
 = 3

199 
	eFuÎbËedTy³


201 
	mfuÎbËedNÙSuµÜ‹d
 = 0,

202 
	mfuÎbËed3EdgeAÎMedŸ
 = 1,

203 
	mfuÎbËed3EdgePhÙoMedŸ
 = 2,

204 
	mfuÎbËed3EdgeNÚPhÙoMedŸ
 = 3,

205 
	mfuÎbËed4EdgeAÎMedŸ
 = 4,

206 
	mfuÎbËed4EdgePhÙoMedŸ
 = 5,

207 
	mfuÎbËed4EdgeNÚPhÙoMedŸ
 = 6

210 
	eFÚtIndex


212 
	mCOURIER_INDEX
 = 1,

213 
	mCGTIMES_INDEX
 = 2,

214 
	mLETTERGOTHIC_INDEX
 = 3,

215 
	mUNIVERS_INDEX
 = 4

218 cÚ¡ 
	gMAX_CHAR_SET
 = 5;

220 cÚ¡ 
	gMAX_POINTSIZES
 = 5;

222 cÚ¡ 
	gMAXCOLORDEPTH
 = 3;

224 cÚ¡ 
	gMAXCOLORPLANES
 = 6;

226 cÚ¡ 
	gMAXCOLORROWS
 = 2;

231 
	ePEN_TYPE


233 
	mBLACK_PEN
,

234 
	mCOLOR_PEN
,

235 
	mBOTH_PENS
,

236 
	mMDL_PEN
,

237 
	mMDL_BOTH
,

238 
	mMDL_AND_BLACK_PENS
,

239 
	mMDL_BLACK_AND_COLOR_PENS
,

240 
	mGREY_PEN
,

241 
	mGREY_BOTH
,

242 
	mMDL_AND_GREY_PENS
,

243 
	mMDL_GREY_AND_COLOR_PENS
,

244 
	mUNKNOWN_PEN
,

246 
	mNO_PEN
,

247 
	mDUMMY_PEN
,

248 
	mMAX_PEN_TYPE
 = 
UNKNOWN_PEN


262 
	mUNSUPPORTED_SIZE
 =-1,

263 
	mLETTER
 = 0,

264 
	mA4
 = 1,

265 
	mLEGAL
 = 2,

266 
	mPHOTO_SIZE
 = 3,

267 
	mA6
 = 4,

268 
	mCARD_4x6
 = 5,

269 
	mB4
 = 6,

270 
	mB5
 = 7,

271 
	mOUFUKU
 = 8,

272 
	mOFUKU
 = 8,

273 
	mHAGAKI
 = 9,

274 
	mA6_WITH_TEAR_OFF_TAB
 = 10,

275 #ifdeà
APDK_EXTENDED_MEDIASIZE


276 
	mA3
 = 11,

277 
	mA5
 = 12,

278 
	mLEDGER
 = 13,

279 
	mSUPERB_SIZE
 = 14,

280 
	mEXECUTIVE
 = 15,

281 
	mFLSA
 = 16,

282 
	mCUSTOM_SIZE
 = 17,

283 
	mENVELOPE_NO_10
 = 18,

284 
	mENVELOPE_A2
 = 19,

285 
	mENVELOPE_C6
 = 20,

286 
	mENVELOPE_DL
 = 21,

287 
	mENVELOPE_JPN3
 = 22,

288 
	mENVELOPE_JPN4
 = 23,

290 
	mPHOTO_5x7
,

291 
	mCDDVD_80
,

292 
	mCDDVD_120
,

293 #ifdeà
APDK_EXTENDED_MEDIASIZE


294 
	mPHOTO_4x8
,

295 
	mPHOTO_4x12
,

296 
	mL
,

298 
	mMAX_PAPER_SIZE


299 } 
	tPAPER_SIZE
;

304 
	mCLEAN_PEN
 = 0

305 } 
	tPRINTER_FUNC
;

313 
	mWHITE_TEXT
,

314 
	mCYAN_TEXT
,

315 
	mMAGENTA_TEXT
,

316 
	mBLUE_TEXT
,

317 
	mYELLOW_TEXT
,

318 
	mGREEN_TEXT
,

319 
	mRED_TEXT
,

320 
	mBLACK_TEXT


321 } 
	tTEXTCOLOR
;

325 
	eTEXTORIENT


327 
	mPORTRAIT
,

328 
	mLANDSCAPE
,

329 
	mBOTH


332 cÚ¡ 
	gMAX_FONT_SIZES
 = 10;

337 cÚ¡ 
	gTIMEOUTVAL
 = 500;

339 
WORD
 
	tPORTID
;

340 * 
	tPORTHANDLE
;

342 
	eMODE1284


344 
	mCOMPATIBILITY
,

345 
	mNIBBLE
,

346 
	mECP


350 
	eHALFTONING_ALGORITHM


352 
	mFED
,

353 
	mMATRIX


360 
	mGREY_K
,

361 
	mGREY_CMY
,

362 
	mCOLOR
,

363 
	mMAX_COLORMODE


364 } 
	tCOLORMODE
;

370 
	mQUALITY_NORMAL
,

371 
	mQUALITY_DRAFT
,

372 
	mQUALITY_BEST
,

373 
	mQUALITY_HIGHRES_PHOTO
,

374 
	mQUALITY_FASTDRAFT
,

375 
	mQUALITY_AUTO
,

376 
	mQUALITY_FASTNORMAL
,

377 
	mMAX_QUALITY_MODE


378 } 
	tQUALITY_MODE
;

384 
	mMEDIA_PLAIN
,

385 
	mMEDIA_PREMIUM
,

386 
	mMEDIA_PHOTO
,

387 
	mMEDIA_TRANSPARENCY
,

388 
	mMEDIA_HIGHRES_PHOTO
,

389 
	mMEDIA_AUTO
,

390 
	mMEDIA_ADVANCED_PHOTO
,

391 
	mMEDIA_CDDVD
 = 7,

392 
	mMEDIA_BROCHURE
 = 8,

393 
	mMAX_MEDIATYPE


394 } 
	tMEDIATYPE
;

399 
	mUNKNOWN
 = -1,

400 
	mDISENGAGED
 = 0,

401 
	mENGAGED
 = 1

402 } 
	tPHOTOTRAY_STATE
;

412 
	mNO_ERROR
 = 0x00,

413 
	mJOB_CANCELED
 = 0x01,

414 
	mSYSTEM_ERROR
 = 0x02,

415 
	mALLOCMEM_ERROR
 = 0x03,

416 
	mNO_PRINTER_SELECTED
 = 0x04,

417 
	mINDEX_OUT_OF_RANGE
 = 0x05,

418 
	mILLEGAL_RESOLUTION
 = 0x06,

419 
	mNULL_POINTER
 = 0x07,

420 
	mMISSING_PENS
 = 0x08,

424 
	mUNSUPPORTED_PRINTER
 = 0x10,

425 
	mUNSUPPORTED_PEN
 = 0x11,

426 
	mTEXT_UNSUPPORTED
 = 0x12,

427 
	mGRAPHICS_UNSUPPORTED
 = 0x13,

428 
	mUNSUPPORTED_FONT
 = 0x14,

429 
	mILLEGAL_COORDS
 = 0x15,

430 
	mUNSUPPORTED_FUNCTION
 = 0x16,

431 
	mBAD_INPUT_WIDTH
 = 0x18,

432 
	mOUTPUTWIDTH_EXCEEDS_PAGEWIDTH
 = 0x19,

433 
	mUNSUPPORTED_SCALING
 = 0x1a,

436 
	mIO_ERROR
 = 0x20,

437 
	mBAD_DEVICE_ID
 = 0x21,

438 
	mCONTINUE_FROM_BLOCK
 = 0x22,

441 
	mPLUGIN_LIBRARY_MISSING
 = 0x30,

445 
	mWARN_MODE_MISMATCH
 = -1,

446 
	mWARN_DUPLEX
 = -2,

447 
	mWARN_LOW_INK_BOTH_PENS
= -3,

448 
	mWARN_LOW_INK_BLACK
 = -4,

449 
	mWARN_LOW_INK_COLOR
 = -5,

451 
	mWARN_LOW_INK_PHOTO
 = -10,

452 
	mWARN_LOW_INK_GREY
 = -11,

453 
	mWARN_LOW_INK_BLACK_PHOTO
 = -12,

454 
	mWARN_LOW_INK_COLOR_PHOTO
 = -13,

455 
	mWARN_LOW_INK_GREY_PHOTO
 = -14,

456 
	mWARN_LOW_INK_COLOR_GREY
 = -15,

457 
	mWARN_LOW_INK_COLOR_GREY_PHOTO
 = -16,

458 
	mWARN_LOW_INK_COLOR_BLACK_PHOTO
 = -17,

459 
	mWARN_LOW_INK_CYAN
 = -18,

460 
	mWARN_LOW_INK_MAGENTA
 = -19,

461 
	mWARN_LOW_INK_YELLOW
 = -20,

462 
	mWARN_LOW_INK_MULTIPLE_PENS
 = - 21,

463 
	mWARN_FULL_BLEED_UNSUPPORTED
 = -6,

464 
	mWARN_FULL_BLEED_3SIDES
 = -7,

465 
	mWARN_FULL_BLEED_PHOTOPAPER_ONLY
 = -30,

466 
	mWARN_FULL_BLEED_3SIDES_PHOTOPAPER_ONLY
 = -31,

467 
	mWARN_ILLEGAL_PAPERSIZE
 = -8,

468 
	mILLEGAL_PAPERSIZE
 = -8,

469 
	mWARN_INVALID_MEDIA_SOURCE
 = -9

470 } 
	tDRIVER_ERROR
;

478 
	eDISPLAY_STATUS


480 
	mNODISPLAYSTATUS
 = -1,

481 
	mDISPLAY_PRINTING
,

482 
	mDISPLAY_PRINTING_COMPLETE
,

483 
	mDISPLAY_PRINTING_CANCELED
,

484 
	mDISPLAY_OFFLINE
,

485 
	mDISPLAY_BUSY
,

486 
	mDISPLAY_OUT_OF_PAPER
,

487 
	mDISPLAY_TOP_COVER_OPEN
,

488 
	mDISPLAY_ERROR_TRAP
,

489 
	mDISPLAY_NO_PRINTER_FOUND
,

490 
	mDISPLAY_NO_PEN_DJ400
,

491 
	mDISPLAY_NO_PEN_DJ600
,

492 
	mDISPLAY_NO_COLOR_PEN
,

493 
	mDISPLAY_NO_BLACK_PEN
,

494 
	mDISPLAY_NO_PENS
,

495 
	mDISPLAY_PHOTO_PEN_WARN
,

496 
	mDISPLAY_PRINTER_NOT_SUPPORTED
,

497 
	mDISPLAY_COMM_PROBLEM
,

498 
	mDISPLAY_CANT_ID_PRINTER
,

499 
	mDISPLAY_OUT_OF_PAPER_NEED_CONTINUE
,

500 
	mDISPLAY_PAPER_JAMMED
,

501 
	mDISPLAY_PHOTOTRAY_MISMATCH
,

505 
	mACCEPT_DEFAULT
,

506 
	mDISPLAY_PRINTCONTEXT_WARN
,

507 
	mDISPLAY_PRINTMODE_WARN
,

508 
	mDISPLAY_JOB_WARN


515 cÚ¡ 
	gNUMBER_PLANES
 = 3;

518 
	#NUMBER_RASTERS
 3

519 

	)

520 #ifdeà
APDK_AUTODUPLEX


521 
	eDUPLEXMODE


523 
	mDUPLEXMODE_NONE
,

524 
	mDUPLEXMODE_TABLET
,

525 
	mDUPLEXMODE_BOOK


531 
	mSPEED_MECH_HINT
,

532 
	mPAGES_IN_DOC_HINT
,

533 
	mEXTRA_DRYTIME_HINT
,

534 
	mMAX_FILE_SIZE_HINT
,

535 
	mRED_EYE_REMOVAL_HINT
,

536 
	mPHOTO_FIX_HINT
,

537 
	mLEFT_OVERSPRAY_HINT
,

538 
	mRIGHT_OVERSPRAY_HINT
,

539 
	mTOP_OVERSPRAY_HINT
,

540 
	mBOTTOM_OVERSPRAY_HINT


541 } 
	tPRINTER_HINT
;

543 
	gAPDK_END_NAMESPACE


	@prnt/hpijs/globals.cpp

32 
	~"h—d”.h
"

35 
APDK_BEGIN_NAMESPACE


38 
	$¡ršgËn
(cÚ¡ *
s
)

40 { 
c
=0;

41 
s
[
c
++]) ;

42  
c
-1;

43 
	}
}

49 
BYTE
 
	$EscCİy
(
BYTE
 *
de¡
, cÚ¡ *
s
,
num
, 
’d
)

51 
de¡
[0]=
ESC
; 
	`¡rıy
((*)&de¡[1],
s
);

52 
BYTE
 
k
 = 
	`¡ršgËn
(
s
)+1;

53 
BYTE
 
i
 = 
	`¥rštf
((*)&
de¡
[
k
],"%d",
num
);

54 
de¡
[
k
+
i
] = 
’d
;

55  (
k
+
i
+1);

56 
	}
}

57 
BYTE
 
	$EscAm¶Cİy
(
BYTE
 *
de¡
, 
num
, 
’d
)

59 
de¡
[0]=
ESC
; dest[1]='&';dest[2]='l';

60 
BYTE
 
i
 = 
	`¥rštf
((*)&
de¡
[3],"%d",
num
);

61 
de¡
[3+
i
] = 
’d
;

62  (4+
i
);

63 
	}
}

65 
MedŸSize
 
	$P­”ToMedŸSize
(
PAPER_SIZE
 
psize
)

67 
psize
)

69 
LETTER
:  
sizeUSL‘‹r
; ;

70 
LEGAL
:  
sizeUSLeg®
; ;

71 
A4
:  
sizeA4
; ;

72 
PHOTO_SIZE
:  
sizePhÙo
; ;

73 
CARD_4x6
:  
sizePhÙo
;

74 
A6
:  
sizeA6
; ;

75 
A6_WITH_TEAR_OFF_TAB
:  
sizeA6
;

76 
B4
:  
sizeB4
; ;

77 
B5
:  
sizeB5
; ;

78 
OUFUKU
:  
sizeOUFUKU
; ;

79 
HAGAKI
:  
sizeHAGAKI
; ;

80 #ifdeà
APDK_EXTENDED_MEDIASIZE


81 
A3
:  
sizeA3
; ;

82 
A5
:  
sizeA5
; ;

83 
LEDGER
:  
sizeLedg”
; ;

84 
SUPERB_SIZE
:  
sizeSu³rB
; ;

85 
EXECUTIVE
:  
sizeExecutive
; ;

86 
FLSA
:  
sizeFLSA
; ;

87 
CUSTOM_SIZE
:  
sizeCu¡om
; ;

88 
ENVELOPE_NO_10
:  
sizeNum10Env
; ;

89 
ENVELOPE_A2
:  
sizeA2Env
; ;

90 
ENVELOPE_C6
:  
sizeC6Env
; ;

91 
ENVELOPE_DL
:  
sizeDLEnv
; ;

92 
ENVELOPE_JPN3
:  
size3JPNEnv
; ;

93 
ENVELOPE_JPN4
:  
size4JPNEnv
; ;

95 
PHOTO_5x7
:  
size5x7
; ;

96 
CDDVD_80
:  
sizeCDDVD80
; ;

97 
CDDVD_120
:  
sizeCDDVD120
; ;

98 :  
sizeUSL‘‹r
; ;

100 
	}
}

102 
PAPER_SIZE
 
	$MedŸSizeToP­”
(
MedŸSize
 
msize
)

104 
msize
)

106 
sizeUSL‘‹r
:  
LETTER
; ;

107 
sizeUSLeg®
:  
LEGAL
; ;

108 
sizeA4
:  
A4
; ;

109 
sizePhÙo
:  
PHOTO_SIZE
; ;

110 
sizeA6
:  
A6
; ;

111 
sizeB4
:  
B4
; ;

112 
sizeB5
:  
B5
; ;

113 
sizeOUFUKU
:  
OUFUKU
; ;

114 
sizeHAGAKI
:  
HAGAKI
; ;

115 #ifdeà
APDK_EXTENDED_MEDIASIZE


116 
sizeA3
:  
A3
; ;

117 
sizeA5
:  
A5
; ;

118 
sizeLedg”
:  
LEDGER
; ;

119 
sizeSu³rB
:  
SUPERB_SIZE
; ;

120 
sizeExecutive
:  
EXECUTIVE
; ;

121 
sizeFLSA
:  
FLSA
; ;

122 
sizeCu¡om
:  
CUSTOM_SIZE
; ;

123 
sizeNum10Env
:  
ENVELOPE_NO_10
; ;

124 
sizeA2Env
:  
ENVELOPE_A2
; ;

125 
sizeC6Env
:  
ENVELOPE_C6
; ;

126 
sizeDLEnv
:  
ENVELOPE_DL
; ;

127 
size3JPNEnv
:  
ENVELOPE_JPN3
; ;

128 
size4JPNEnv
:  
ENVELOPE_JPN4
; ;

130 
size5x7
:  
PHOTO_5x7
; ;

131 
sizeCDDVD80
:  
CDDVD_80
; ;

132 
sizeCDDVD120
:  
CDDVD_120
; ;

133 :  
UNSUPPORTED_SIZE
; ;

135 
	}
}

137 
MedŸTy³
 
	$MedŸTy³ToPş
 (
MEDIATYPE
 
eMedŸTy³
)

139 
eMedŸTy³
)

141 
MEDIA_PLAIN
:

142  
medŸPÏš
;

143 
MEDIA_PREMIUM
:

144  
medŸS³cŸl
;

145 
MEDIA_PHOTO
:

146 
MEDIA_ADVANCED_PHOTO
:

147  
medŸGlossy
;

148 
MEDIA_TRANSPARENCY
:

149  
medŸT¿n¥¬’cy
;

150 
MEDIA_HIGHRES_PHOTO
:

151  
medŸHigh»sPhÙo
;

152 
MEDIA_AUTO
:

153  
medŸAuto
;

154 
MEDIA_CDDVD
:

155  
medŸCDDVD
;

156 
MEDIA_BROCHURE
:

157  
medŸBrochu»
;

159  
medŸPÏš
;

161 
	}
}

163 
	$AsciiHexToBš¬y
(
BYTE
* 
de¡
, * 
¤c
, 
couÁ
)

165 
i
;

166 
BYTE
 
b™P©‹º
;

167 
i
=0; i<
couÁ
 ; i++)

169 
¤c
[
i
])

172 
b™P©‹º
 = 0x00;

175 
b™P©‹º
 = 0x01;

178 
b™P©‹º
 = 0x02;

181 
b™P©‹º
 = 0x03;

184 
b™P©‹º
 = 0x04;

187 
b™P©‹º
 = 0x05;

190 
b™P©‹º
 = 0x06;

193 
b™P©‹º
 = 0x07;

196 
b™P©‹º
 = 0x08;

199 
b™P©‹º
 = 0x09;

203 
b™P©‹º
 = 0x0a;

207 
b™P©‹º
 = 0x0b;

211 
b™P©‹º
 = 0x0c;

215 
b™P©‹º
 = 0x0d;

219 
b™P©‹º
 = 0x0e;

223 
b™P©‹º
 = 0x0f;

227 
	`ASSERT
(0);

228 
b™P©‹º
 = 0;

232 ià((
i
%2) == 0)

234 
de¡
[
i
/2] = 
b™P©‹º
 << 4;

238 
de¡
[
i
/2] |ğ
b™P©‹º
;

241 
	}
}

243 #ifdeà
HAVE_LIBDL


244 
	~<dlfú.h
>

246 *
	$LßdPlugš
 (cÚ¡ *
szPlugšName
)

248 
FILE
 *
å
;

249 
szLše
[256];

250 
i
;

251 *
±emp
 = 
NULL
;

252 *
p
 = 
NULL
;

253 
bFound
 = 0;

254 ià((
å
 = 
	`fİ’
 ("/‘c/hp/h¶.cÚf", "r")è=ğ
NULL
)

256  
NULL
;

258 !
	`ãof
 (
å
))

260 ià(!
	`fg‘s
 (
szLše
, 256, 
å
))

264 ià(!
bFound
 && 
	`¡ºcmp
 (
szLše
, "[dirs]", 6))

266 
bFound
 = 1;

267 ià(
szLše
[0] < ' ')

269 ià(!
	`¡ºcmp
 (
szLše
, "home", 4))

271 
i
 = 
	`¡¾’
 (
szLše
);

272 
i
 > 0 && 
szLše
[i] < ' ')

273 
szLše
[
i
--] = '\0';

274 
p
 = 
szLše
 + 4;

275 *
p
 && *p != '/')

276 
p
++;

277 
i
 = (
szLše
è- (
	`¡¾’
 (
p
) + (p - szLine));

278 
	`¢´štf
 (
p
+
	`¡¾’
 (p), 
i
, "/´Á/¶ugšs/%s", 
szPlugšName
);

279 
±emp
 = 
	`dlİ’
 (
p
, 
RTLD_LAZY
);

282 
	`fşo£
 (
å
);

283  
±emp
;

284 
	}
}

287 
	gAPDK_END_NAMESPACE


	@prnt/hpijs/halftoner.cpp

62 
	~"h—d”.h
"

63 
	~"h±y³s.h
"

64 
	~"h®áÚ”.h
"

66 
APDK_BEGIN_NAMESPACE


68 
	gH®áÚ”
::
H®áÚ”


70 
Sy¡emS”viûs
* 
pSys
,

71 
PrštMode
* 
	gpPM
,

72 
	giIÅutWidth
,

73 
	giNumRows
[],

74 
	gHiResFaùÜ
,

75 
BOOL
 
	gm©rixba£d


76 è: 
CŞÜPÏÃCouÁ
(
pPM
->
dyeCouÁ
),

77 
IÅutWidth
(
iIÅutWidth
),

78 
ResBoo¡
(
HiResFaùÜ
),

79 
pSS
(
pSys
),

80 
nNextRa¡”
(0),

81 
fBÏckFEDResPŒ
(
pPM
->
BÏckFEDTabË
),

82 
fCŞÜFEDResPŒ
(
pPM
->
CŞÜFEDTabË
),

83 
iCŞÜ
(0),

84 
iRow
(0),

85 
iPÏÃ
(0),

86 
‹mpBufãr
(
NULL
),

87 
‹mpBufãr2
(
NULL
),

88 
hŞd_¿ndom
(0),

89 
	$u£m©rix
(
m©rixba£d
)

91 
i
;

92 
j
,
k
,
PÏÃSize
;

93 
cÚ¡ruùÜ_”rÜ
 = 
NO_ERROR
;

95 
S¹PÏÃ
 = 
K
;

97 ià(
CŞÜPÏÃCouÁ
 == 3)

99 
S¹PÏÃ
=
C
;

100 
NumRows
[
K
] = 
CŞÜD•th
[K] = 
OuutWidth
[K] = 0;

103 
EndPÏÃ
=
Y
;

104 ià(
CŞÜPÏÃCouÁ
 == 6)

106 
EndPÏÃ
 = 
Mlight
;

108 ià(
CŞÜPÏÃCouÁ
 == 1)

110 
EndPÏÃ
 = 
K
;

113 
Adju¡edIÅutWidth
 = 
IÅutWidth
;

114 ià(
Adju¡edIÅutWidth
 % 8)

116 
Adju¡edIÅutWidth
 += 8 - (AdjustedInputWidth % 8);

120 
i
 = 
S¹PÏÃ
; i < (
CŞÜPÏÃCouÁ
 + StartPlane); i++)

122 
CŞÜD•th
[
i
]ğ
pPM
->ColorDepth[i];

123 
NumRows
[
i
]=
iNumRows
[i];

125 
OuutWidth
[
i
] = 
Adju¡edIÅutWidth
 * 
NumRows
[i] * 
ResBoo¡
;

128 ;
i
 < ()
MAXCOLORPLANES
; i++)

130 
NumRows
[
i
] = 
CŞÜD•th
[i] = 
OuutWidth
[i] = 0;

133 
oddb™s
 = 
Adju¡edIÅutWidth
 - 
IÅutWidth
;

135 
i
=0; i <ğ
Mlight
; i++)

137 
E¼Buff
[
i
]=
NULL
;

140 
i
=
S¹PÏÃ
; i <ğ
EndPÏÃ
; i++)

142 
E¼Buff
[
i
] = (*)
pSS
->
	`AÎocMem
((
OuutWidth
[i] + 2) * ());

143 ià(
E¼Buff
[
i
] =ğ
NULL
)

145 
MemÜyE¼Ü
;

149 ià(
OuutWidth
[
K
] > 
Adju¡edIÅutWidth
)

152 
‹mpBufãr
 = (
BYTE
*è
pSS
->
	`AÎocMem
(
OuutWidth
[
K
]);

153 ià(
‹mpBufãr
 =ğ
NULL
)

155 
MemÜyE¼Ü
;

157 ià(
EndPÏÃ
 > 
Y
)

159 
‹mpBufãr2
 = (
BYTE
*è
pSS
->
	`AÎocMem
(
OuutWidth
[
K
]);

160 ià(
‹mpBufãr2
 =ğ
NULL
)

162 
MemÜyE¼Ü
;

169 
	`Re¡¬t
();

172 
i
 = 0; i < ()
MAXCOLORPLANES
; i++)

174 
j
 = 0; j < 
MAXCOLORROWS
; j++)

176 
k
 = 0; k < 
MAXCOLORDEPTH
; k++)

178 
CŞÜPÏÃ
[
i
][
j
][
k
] = 
NULL
;

183 
i
=
S¹PÏÃ
; i < (
CŞÜPÏÃCouÁ
+StartPlane); i++)

185 
j
=0; j < 
NumRows
[
i
]; j++)

187 
k
=0; k < 
CŞÜD•th
[
i
]; k++)

189 
PÏÃSize
ğ
OuutWidth
[
i
]/8 +

190 ((
OuutWidth
[
i
] % 8)!=0);

191 
CŞÜPÏÃ
[
i
][
j
][
k
] = (
BYTE
*è
pSS
->
	`AÎocMem
(
PÏÃSize
);

192 ià(
CŞÜPÏÃ
[
i
][
j
] =ğ
NULL
)

194 
MemÜyE¼Ü
;

196 
	`mem£t
(
CŞÜPÏÃ
[
i
][
j
][
k
], 0, 
PÏÃSize
);

201 
PÏÃSize
 = (
OuutWidth
[0] + 7) / 8;

202 ià(
PÏÃSize
 > 0)

204 
Üigš®KD©a
 = (
BYTE
*è
pSS
->
	`AÎocMem
(
PÏÃSize
);

205 ià(
Üigš®KD©a
 =ğ
NULL
)

207 
MemÜyE¼Ü
;

209 
	`mem£t
(
Üigš®KD©a
, 0, 
PÏÃSize
);

213 
MemÜyE¼Ü
:

214 
cÚ¡ruùÜ_”rÜ
=
ALLOCMEM_ERROR
;

216 
	`F»eBufãrs
();

218 
i
=0; i < 
CŞÜPÏÃCouÁ
; i++)

220 
j
=0; j < 
NumRows
[
i
]; j++)

222 
k
=0; k < 
CŞÜD•th
[
i
]; k++)

224 ià(
CŞÜPÏÃ
[
i
][
j
][
k
])

226 
pSS
->
	`F»eMemÜy
(
CŞÜPÏÃ
[
i
][
j
][
k
]);

231 ià(
Üigš®KD©a
)

233 
pSS
->
	`F»eMemÜy
(
Üigš®KD©a
);

236 
	}
}

239 
	gH®áÚ”
::~
	$H®áÚ”
()

241 
	`DBG1
("destroying Halftoner \n");

243 
	`F»eBufãrs
();

245 
i
=0; i < 
MAXCOLORPLANES
; i++)

247 
j
=0; j < 
NumRows
[
i
]; j++)

249 
k
=0; k < 
CŞÜD•th
[
i
]; k++)

251 ià(
CŞÜPÏÃ
[
i
][
j
][
k
])

253 
pSS
->
	`F»eMemÜy
(
CŞÜPÏÃ
[
i
][
j
][
k
]);

258 ià(
Üigš®KD©a
)

260 
pSS
->
	`F»eMemÜy
(
Üigš®KD©a
);

262 
	}
}

265 
	gH®áÚ”
::
	$Re¡¬t
()

267 
nNextRa¡”
 = 0;

269 
i
 = 
S¹PÏÃ
; i <ğ
EndPÏÃ
; i++)

271 
	`mem£t
(
E¼Buff
[
i
], 0, (
OuutWidth
[i]+2) * ());

274 
¡¬‹d
 = 
FALSE
;

275 
	}
}

278 
	gH®áÚ”
::
	$Flush
()

280 ià(!
¡¬‹d
)

284 
	`Re¡¬t
();

285 
	}
}

288 
	gH®áÚ”
::
	$F»eBufãrs
()

290 
i
 = 
S¹PÏÃ
; i <ğ
EndPÏÃ
; i++)

292 
pSS
->
	`F»eMemÜy
(
E¼Buff
[
i
]);

294 ià(
‹mpBufãr
)

296 
pSS
->
	`F»eMemÜy
(
‹mpBufãr
);

298 ià(
‹mpBufãr2
)

300 
pSS
->
	`F»eMemÜy
(
‹mpBufãr2
);

302 
	}
}

306 
	gH®áÚ”
::
	$Pix–MuÉly
(* 
bufãr
, 
width
, 
çùÜ
)

308 ià(
çùÜ
 == 1)

313 
j
 = ()(
width
-1); j >= 0; j--)

315 
iOff£t
 = 
j
 * 
çùÜ
;

316 
k
 = 0; k < 
çùÜ
; k++)

318 
bufãr
[
iOff£t
 + 
k
] = bufãr[
j
];

322 
	}
}

325 
BYTE
* 
	gH®áÚ”
::
	$NextOuutRa¡”
(
COLORTYPE
 
¿¡”cŞÜ
)

327 ià(
¿¡”cŞÜ
 =ğ
COLORTYPE_COLOR
)

329 ià(
iRa¡”sR—dy
 == 0)

331  
NULL
;

334 ià(
iCŞÜ
 =ğ(
CŞÜPÏÃCouÁ
+
S¹PÏÃ
))

336  
NULL
;

339 ià(
iPÏÃ
 =ğ
CŞÜD•th
[
iCŞÜ
])

341 
iPÏÃ
 = 0;

342 
iRow
++;

343  
	`NextOuutRa¡”
(
¿¡”cŞÜ
);

346 ià(
iRow
 =ğ
NumRows
[
iCŞÜ
])

348 
iRow
 = 0;

349 
iCŞÜ
++;

350  
	`NextOuutRa¡”
(
¿¡”cŞÜ
);

353 
iRa¡”sD–iv”ed
++;

354 
iRa¡”sR—dy
--;

355  
CŞÜPÏÃ
[
iCŞÜ
][
iRow
][
iPÏÃ
++];

359  
NULL
;

361 
	}
}

364 
BOOL
 
	gH®áÚ”
::
	$La¡PÏÃ
()

366  ((
iCŞÜ
 =ğ(
CŞÜPÏÃCouÁ
+
S¹PÏÃ
-1)) &&

367 (
iRow
 =ğ()(
NumRows
[
iCŞÜ
] - 1)) &&

368 (
iPÏÃ
 =ğ
CŞÜD•th
[
iCŞÜ
])

370 
	}
}

373 
BOOL
 
	gH®áÚ”
::
	$Fœ¡PÏÃ
()

375  ((
iCŞÜ
 =ğ
S¹PÏÃ
) &&

376 (
iRow
 == 0) &&

377 (
iPÏÃ
 == 1)

379 
	}
}

382 
	gH®áÚ”
::
	$G‘OuutWidth
(
COLORTYPE
 
¿¡”cŞÜ
)

386 ià(
¿¡”cŞÜ
 =ğ
COLORTYPE_COLOR
)

388 
cŞÜ¶ªe
, 
tmp
;

390 
¿¡”d
 = 
iRa¡”sD–iv”ed
;

392 ià(
¿¡”d
>0)

394 
¿¡”d
--;

397 
tmp
 = ()(
NumRows
[0]*
CŞÜD•th
[0]);

398 ià(
¿¡”d
 < 
tmp
)

400 
cŞÜ¶ªe
 = 0;

406 
cŞÜ¶ªe
 = 1;

409 
‹mp
 = (
OuutWidth
[
cŞÜ¶ªe
] + 7) / 8;

410  
‹mp
;

416 
	}
}

419 
	gH®áÚ”
::
	$G‘MaxOuutWidth
(
COLORTYPE
 
¿¡”cŞÜ
)

423 ià(
¿¡”cŞÜ
 =ğ
COLORTYPE_COLOR
)

425 
max
=0;

426 
i
=
S¹PÏÃ
; i <ğ
EndPÏÃ
; i++)

428 ià(
OuutWidth
[
i
] > 
max
)

430 
max
 = 
OuutWidth
[
i
];

433  (
max
 / 8) + ((max % 8)!=0);

439 
	}
}

442 
	gH®áÚ”
::
	$PÏÃCouÁ
()

444 
couÁ
=0;

446 
i
 = 0; i < 
MAXCOLORPLANES
; i++)

448 
couÁ
 +ğ
NumRows
[
i
] * 
CŞÜD•th
[i];

451  
couÁ
;

452 
	}
}

455 
	gH®áÚ”
::
	$CËªOddB™s
(
iCŞÜ
, 
iRow
)

457 
šdex
 = (
OuutWidth
[
iCŞÜ
]/8)-1;

459 
i
=0; i < 
CŞÜD•th
[
iCŞÜ
]; i++)

461 
BYTE
 
Ï¡by‹0
 = 
CŞÜPÏÃ
[
iCŞÜ
][
iRow
][
i
][
šdex
];

462 
Ï¡by‹0
 =†a¡by‹0 >> 
oddb™s
;

463 
Ï¡by‹0
 =†a¡by‹0 << 
oddb™s
;

464 
CŞÜPÏÃ
[
iCŞÜ
][
iRow
][
i
][
šdex
] = 
Ï¡by‹0
;

466 
	}
}

468 
	gAPDK_END_NAMESPACE


	@prnt/hpijs/halftoner.h

32 #iâdeà
APDK_HALFTONER_H


33 
	#APDK_HALFTONER_H


	)

44 #iâdeà
HPTYPES_H


45 
	~"h±y³s.h
"

48 
	gAPDK_BEGIN_NAMESPACE


51 
	#K
 0

	)

52 
	#C
 1

	)

53 
	#M
 2

	)

54 
	#Y
 3

	)

55 
	#Clight
 4

	)

56 
	#Mlight
 5

	)

58 
	#RANDSEED
 77

	)

66 şas 
	cH®áÚ”
 : 
public
 
ProûssÜ


68 
public
:

69 
H®áÚ”
(
Sy¡emS”viûs
* 
pSys
,

70 
PrštMode
* 
pPM
,

71 
iIÅutWidth
,

72 
iNumRows
[],

73 
HiResFaùÜ
,

74 
BOOL
 
m©rixba£d


76 
	mvœtu®
 ~
H®áÚ”
();

78 
vœtu®
 
BOOL
 
Proûss
(
RASTERDATA
* 
pbyIÅutKRGBRa¡”
=
NULL
) = 0;

79 
vœtu®
 
Flush
();

81 
DRIVER_ERROR
 
	mcÚ¡ruùÜ_”rÜ
;

83 
vœtu®
 
Re¡¬t
();

86 
G‘OuutWidth
(
COLORTYPE
 
¿¡”cŞÜ
);

87 
G‘MaxOuutWidth
(
COLORTYPE
 
¿¡”cŞÜ
);

88 
BYTE
* 
NextOuutRa¡”
(
COLORTYPE
 
¿¡”cŞÜ
);

89 
BOOL
 
La¡PÏÃ
();

90 
BOOL
 
Fœ¡PÏÃ
();

91 
	$PÏÃSize
()

92 {  
OuutWidth
[
iCŞÜ
] / 8 + (OutputWidth[iColor] % 8); }

94 
CŞÜPÏÃCouÁ
;

95 
IÅutWidth
;

96 
OuutWidth
[
MAXCOLORPLANES
];

97 
CŞÜD•th
[
MAXCOLORPLANES
];

99 
NumRows
[
MAXCOLORPLANES
];

103 
BYTE
* 
CŞÜPÏÃ
[
MAXCOLORPLANES
][
MAXCOLORROWS
][
MAXCOLORDEPTH
];

105 
S¹PÏÃ
;

106 
EndPÏÃ
;

107 
ResBoo¡
;

109 
´Ùeùed
:

111 
Sy¡emS”viûs
* 
pSS
;

113 
	`F»eBufãrs
();

115 
HPBoŞ
 
	$FÜw¬d16Pix–sNÚWh™e
(
HPBy‹PŒ
 
šputPŒ
)

119 
i
=0; i < 16; i++)

121 ià((*
šputPŒ
++) != 0)

123  
TRUE
;

126  
FALSE
;

127 
	}
}

129 
HPBoŞ
 
	$Backw¬d16Pix–sNÚWh™e
(
HPBy‹PŒ
 
šputPŒ
)

133 
i
=0; i < 16; i++)

135 ià((*
šputPŒ
--) !=0 )

137  
TRUE
;

140  
FALSE
;

141 
	}
}

144 * 
	gE¼Buff
[6];

146 
	gnNextRa¡”
;

148 
	gfRa¡”Odd
;

149 * 
	gfBÏckFEDResPŒ
;

150 * 
	gfCŞÜFEDResPŒ
;

152 
	gAdju¡edIÅutWidth
;

153 
Pix–MuÉly
(* 
bufãr
, 
width
, 
çùÜ
);

155 
	giCŞÜ
, 
	giRow
, 
	giPÏÃ
;

156 
PÏÃCouÁ
();

158 
BOOL
 
	g¡¬‹d
;

160 
BYTE
* 
	g‹mpBufãr
;

161 
BYTE
* 
	g‹mpBufãr2
;

162 
BYTE
* 
	gÜigš®KD©a
;

163 
	goddb™s
;

164 
CËªOddB™s
(
iCŞÜ
, 
iRow
);

166 
HPUIÁ32
 
	ghŞd_¿ndom
;

167 
šlše
 
BYTE
 
	$RªdomNumb”
()

169 
hŞd_¿ndom
 = (hold_random * 214013) + 2531011;

170  (
BYTE
)((
hŞd_¿ndom
 >> 16) & 0xFF);

171 
	}
}

174 
	sTHTD™h”P¬ms


176 
HPUIÁ16
 
	gfNumPix
;

177 
HPBy‹PŒ
 
	gfIÅut
;

178 
HPBy‹PŒ
 
	gfOuut1
;

179 
HPBy‹PŒ
 
	gfOuut2
;

180 
HPBy‹PŒ
 
	gfOuut3
;

182 
HPCBy‹PŒ
 
	gfFEDResPŒ
;

184 
kS´šgsE¼ÜTy³PŒ
 
	gfE¼
;

185 
HPIÁ16
 
	gfRa¡”Ev’OrOdd
;

187 
HPBoŞ
 
	gfSymm‘ricFÏg
;

189 
HPBoŞ
 
	gfHife
;

191 
HPUIÁ16
 
	gfM©rixRowSize
;

192 
HPBy‹PŒ
 
	gfM©rixV1
;

193 
HPUIÁ16
 
	gfD™h”C–lOff£t
;

194 
HPUIÁ16
 
	gfSqu“zeOff£t
;

196 
HPCIÁ16PŒ
 
	gfWeightTabËPŒ
;

197 
HPIÁ16
 
	gfOff£tPick
;

198 
HPBoŞ
 
	gfV”tiÿlExpFÏg
;

199 } 
	tTHTD™h”P¬ms
, 
	tENVPTR
(
	tTHTD™h”P¬msPŒ
);

201 
BOOL
 
	gu£m©rix
;

203 
DRIVER_ERROR
 
HTMATRIXHI_KCMY
(
THTD™h”P¬msPŒ
 
d™h”P¬msPŒ
, 
HPUIÁ16
 
couÁ
);

207 
	gAPDK_END_NAMESPACE


	@prnt/hpijs/halftoner_open.cpp

31 
	~"h—d”.h
"

32 
	~"h®áÚ”.h
"

33 
	~"h®áÚ”_İ’.h
"

35 
APDK_BEGIN_NAMESPACE


37 
Bay”M©rix
[];

39 
	gH®áÚ”_O³n
::
H®áÚ”_O³n


41 
Sy¡emS”viûs
* 
pSys
,

42 
PrštMode
* 
	gpPM
,

43 
	giIÅutWidth
,

44 
	giNumRows
[],

45 
	gHiResFaùÜ
,

46 
BOOL
 
	gm©rixba£d


48 : 
	$H®áÚ”
(
pSys
,
pPM
,
iIÅutWidth
,
iNumRows
,
HiResFaùÜ
,
m©rixba£d
)

49 { 
	}
}

52 
	gH®áÚ”_O³n
::~
	$H®áÚ”_O³n
()

53 { 
	}
}

56 
BOOL
 
H®áÚ”_O³n
::
Proûss


58 
RASTERDATA
* 
pbyIÅutKRGBRa¡”


61 
i
;

62 
	gj
, 
	gk
;

64 ià((
	gpbyIÅutKRGBRa¡”
 =ğ
NULL
) ||

65 (
pbyIÅutKRGBRa¡”
 &&…byIÅutKRGBRa¡”->
¿¡”d©a
[
COLORTYPE_COLOR
]==
NULL
 &&…byIÅutKRGBRa¡”->¿¡”d©a[
COLORTYPE_BLACK
]==NULL))

67 
Re¡¬t
();

68  
	gFALSE
;

70 
	g¡¬‹d
=
TRUE
;

72 
	gi
=
S¹PÏÃ
; i < (
	gCŞÜPÏÃCouÁ
+
	gS¹PÏÃ
); i++)

74 
	gj
=0; j < 
	gNumRows
[
i
]; j++)

76 
	gk
=0; k < 
	gCŞÜD•th
[
i
]; k++)

78 
	gPÏÃSize
ğ(
OuutWidth
[
i
] + 7) / 8;

79 
mem£t
(
CŞÜPÏÃ
[
i
][
j
][
k
], 0, 
PÏÃSize
);

83 ià(
	gpbyIÅutKRGBRa¡”
->
	g¿¡”d©a
[
COLORTYPE_COLOR
])

86 ++
	gnNextRa¡”
;

87 iàĞ-1 =ğ
nNextRa¡”
 )

88 
nNextRa¡”
 = 0;

90 
	gfRa¡”Odd
 = ( 1 & 
nNextRa¡”
 ) ? 0 : 1;

92 
BYTE
* 
	gšput
;

93 
	gnumpix
;

95 
	gi
=
S¹PÏÃ
; i <ğ
EndPÏÃ
; i++)

97 ià(
	gOuutWidth
[
i
] > 
	gAdju¡edIÅutWidth
)

99 
mem£t
(
‹mpBufãr
, 0, 
OuutWidth
[
i
]);

101 
memıy
(
‹mpBufãr
,
pbyIÅutKRGBRa¡”
->
¿¡”d©a
[
COLORTYPE_COLOR
],
IÅutWidth
);

102 
	gçùÜ
 = 
NumRows
[
i
] * 
ResBoo¡
;

103 
Pix–MuÉly
(
‹mpBufãr
, 
IÅutWidth
, 
çùÜ
);

104 
	gšput
=
‹mpBufãr
;

105 
	gnumpix
 = 
OuutWidth
[
i
];

109 
	gšput
=
pbyIÅutKRGBRa¡”
->
¿¡”d©a
[
COLORTYPE_COLOR
];

110 
	gnumpix
 = 
Adju¡edIÅutWidth
;

113 
	gfD™h”P¬ms
[
i
].
	gfNumPix
 = 
numpix
;

114 
	gfD™h”P¬ms
[
i
].
	gfIÅut
 = 
šput
;

115 
	gfD™h”P¬ms
[
i
].
	gfE¼
 = 
E¼Buff
[i];

116 
	gfD™h”P¬ms
[
i
].
	gfE¼
++;

117 
	gfD™h”P¬ms
[
i
].
	gfSymm‘ricFÏg
 = 
HPTRUE
;

118 ià(
	gi
 =ğ
K
)

119 
fD™h”P¬ms
[
i
].
fFEDResPŒ
 = 
fBÏckFEDResPŒ
;

121 
	gfD™h”P¬ms
[
i
].
	gfFEDResPŒ
 = 
fCŞÜFEDResPŒ
;

122 
	gfD™h”P¬ms
[
i
].
	gfRa¡”Ev’OrOdd
 = 
fRa¡”Odd
;

123 
	gfD™h”P¬ms
[
i
].
	gfHife
 = 
CŞÜD•th
[i]>1;

126 ià(
	gu£m©rix
)

128 
	gfD™h”P¬ms
[
i
].
	gfSqu“zeOff£t
=0;

129 
	gfD™h”P¬ms
[
i
].
	gfM©rixRowSize
 = 
Bay”M©rix
[1];

130 
BYTE
 
	gcŞÜšdex
 = 
i
 + 2;

131 ià(
	gi
>=
Y
)

132 
cŞÜšdex
 = 4;

133 
BYTE
 
	gd™h”off£t
 = 
Bay”M©rix
[
cŞÜšdex
];

134 
BYTE
 
	gm©rixrowsize
 = 
Bay”M©rix
[1];

135 
	gfD™h”P¬ms
[
i
].
	gfD™h”C–lOff£t
 = 
d™h”off£t
;

136 
HPBy‹PŒ
 
	gm©rix±r
 = (HPBytePtr)(

137 (((
d™h”off£t
 + 
nNextRa¡”
è% 
m©rixrowsize
) * matrixrowsize)

138 + 5 + 
Bay”M©rix
);

140 
	gfD™h”P¬ms
[
i
].
	gfM©rixV1
 = 
m©rix±r
;

145 
	gj
=0; j < 
	gNumRows
[
i
]; j++)

147 
	gfD™h”P¬ms
[
i
].
	gfOuut1
 = 
CŞÜPÏÃ
[i][
j
][0];

148 
	gfD™h”P¬ms
[
i
].
	gfOuut2
 = 
CŞÜPÏÃ
[i][
j
][1];

150 ià(
	gu£m©rix
)

152 
mem£t
(
fD™h”P¬ms
[
i
].
fOuut1
, 0, 
OuutWidth
[i]/8);

153 ià(
	gfD™h”P¬ms
[
i
].
	gfOuut2
)

154 
mem£t
(
fD™h”P¬ms
[
i
].
fOuut2
, 0, 
OuutWidth
[i]/8);

155 
HTMATRIXHI_KCMY
((
THTD™h”P¬msPŒ
è
fD™h”P¬ms
, 
i
);

157 
HTEDiffO³n
 ((
THTD™h”P¬msPŒ
è
fD™h”P¬ms
, 
i
);

161 
CËªOddB™s
(
i
,
j
);

164 
	gpbyIÅutKRGBRa¡”
->
	g¿¡”d©a
[
COLORTYPE_COLOR
] +ğ
IÅutWidth
;

169 ià(
	gpbyIÅutKRGBRa¡”
->
	g¿¡”d©a
[
COLORTYPE_BLACK
])

171 
	gçùÜ
 = 1;

172 ià(
	gOuutWidth
[
K
] > 
	gAdju¡edIÅutWidth
)

174 
mem£t
(
‹mpBufãr
, 0, 
OuutWidth
[
K
]);

175 
memıy
(
‹mpBufãr
,
pbyIÅutKRGBRa¡”
->
¿¡”d©a
[
COLORTYPE_BLACK
],pbyIÅutKRGBRa¡”->
¿¡”size
[COLORTYPE_BLACK]);

177 
	gçùÜ
 = 
NumRows
[
K
] * 
ResBoo¡
;

178 
Pix–MuÉly
(
‹mpBufãr
, 
pbyIÅutKRGBRa¡”
->
¿¡”size
[
COLORTYPE_BLACK
], 
çùÜ
);

182 
mem£t
(
Üigš®KD©a
, 0, (
pbyIÅutKRGBRa¡”
->
¿¡”size
[
COLORTYPE_BLACK
] * 
çùÜ
 +7)/8);

183 
	gcurB™
 = 0x80, 
	gcurBy‹
 = 0;

184 
	gi
=0; i<
	gpbyIÅutKRGBRa¡”
->
	g¿¡”size
[
COLORTYPE_BLACK
] * 
	gçùÜ
; i++)

186 ià(
	gOuutWidth
[
K
] > 
	gAdju¡edIÅutWidth
)

188 ià(
	g‹mpBufãr
[
i
])

190 
	gÜigš®KD©a
[
curBy‹
] |ğ
curB™
;

195 ià(
	gpbyIÅutKRGBRa¡”
->
	g¿¡”d©a
[
COLORTYPE_BLACK
][
i
])

197 
	gÜigš®KD©a
[
curBy‹
] |ğ
curB™
;

200 ià(
	gcurB™
 == 0x01)

202 
curBy‹
++;

203 
	gcurB™
 = 0x80;

207 
	gcurB™
 = 
curB™
 >> 1;

210 
	gj
=0; j < 
	gNumRows
[
K
]; j++)

212 
	gk
 = 0; k < (
	gpbyIÅutKRGBRa¡”
->
	g¿¡”size
[
COLORTYPE_BLACK
] * 
	gçùÜ
 +7)/8; k++)

213 ià(
	gCŞÜPÏÃ
[
K
][
j
][0])

214 
	gCŞÜPÏÃ
[
K
][
j
][0][
k
] |ğ
Üigš®KD©a
[k];

215 ià(
	gCŞÜPÏÃ
[
K
][
j
][1])

216 
	gCŞÜPÏÃ
[
K
][
j
][1][
k
] |ğ
Üigš®KD©a
[k];

220 
	giCŞÜ
 = 
S¹PÏÃ
;

221 
	giRow
 = 
iPÏÃ
 = 0;

222 
	giRa¡”sR—dy
 = 
PÏÃCouÁ
();

223 
	giRa¡”sD–iv”ed
 = 0;

224  
	gTRUE
;

228 
	gH®áÚ”_O³n
::
HTEDiffO³n


230 
THTD™h”P¬msPŒ
 
d™h”P¬msPŒ
,

231 
HPUIÁ16
 
	gcouÁ


236 
	gd™h”P¬ms
 = 
d™h”P¬msPŒ
+
couÁ
;

237 
	g”rPŒ
 = 
d™h”P¬ms
->
fE¼
;

238 
	gnumLoİ
 = 
d™h”P¬ms
->
fNumPix
;

239 
	gšputPŒ
 = 
d™h”P¬ms
->
fIÅut
;

240 
	gãdResTbl
 = 
d™h”P¬ms
->
fFEDResPŒ
;

241 
	gsymm‘ricFÏg
 = 
d™h”P¬ms
->
fSymm‘ricFÏg
;

242 
	gdoNext8Pix–s
 = 
HPTRUE
;

243 
	ghife
 = 
d™h”P¬ms
->
fHife
;

244 
	gouutPŒ1
 = 
d™h”P¬ms
->
fOuut1
;

246 
	gouutPŒ1
 = 
d™h”P¬ms
->
fOuut1
;

248 ià(
	ghife
)

250 
	gouutPŒ1
 = 
d™h”P¬ms
->
fOuut1
;

251 
	gouutPŒ2
 = 
d™h”P¬ms
->
fOuut2
;

252 
	gouutPŒ3
 = 
d™h”P¬ms
->
fOuut3
;

255 
	gdiffusiÚE¼ÜPŒ
 = 
”rPŒ
;

257 
	g¿¡”By‹1
 = 0;

258 
	g¿¡”By‹2
 = 0;

259 
	g¿¡”By‹3
 = 0;

261 ifĞ
	gd™h”P¬ms
->
	gfRa¡”Ev’OrOdd
 == 1 )

263 
tmpShÜtStÜe
 = *
diffusiÚE¼ÜPŒ
;

265 *
	gdiffusiÚE¼ÜPŒ
 = 0;

267 
	gpix–CouÁ
 = 
numLoİ
 + 8; (pixelCount -= 8) > 0; )

269 ià(
	gpix–CouÁ
 > 16)

271 
	gdoNext8Pix–s
 = 
FÜw¬d16Pix–sNÚWh™e
(
šputPŒ
);

275 
	gdoNext8Pix–s
 = 
HPTRUE
;

278 ià(
	gdoNext8Pix–s
)

280 
	gthV®ue
 = 
HPRªd
();

281 
FORWARD_FED
Ğ
thV®ue
, 0x80 );

282 
	gthV®ue
 = 
HPRªd
();

283 
FORWARD_FED
Ğ
thV®ue
, 0x40 );

284 
	gthV®ue
 = 
HPRªd
();

285 
FORWARD_FED
Ğ
thV®ue
, 0x20 );

286 
	gthV®ue
 = 
HPRªd
();

287 
FORWARD_FED
Ğ
thV®ue
, 0x10 );

288 
	gthV®ue
 = 
HPRªd
();

289 
FORWARD_FED
Ğ
thV®ue
, 0x08 );

290 
	gthV®ue
 = 
HPRªd
();

291 
FORWARD_FED
Ğ
thV®ue
, 0x04 );

292 
	gthV®ue
 = 
HPRªd
();

293 
FORWARD_FED
Ğ
thV®ue
, 0x02 );

294 
	gthV®ue
 = 
HPRªd
();

295 
FORWARD_FED
Ğ
thV®ue
, 0x01 );

297 *
	gouutPŒ1
++ = 
¿¡”By‹1
;

298 
	g¿¡”By‹1
 = 0;

300 ià(
	ghife
)

302 *
	gouutPŒ2
++ = 
¿¡”By‹2
;

303 
	g¿¡”By‹2
 = 0;

308 
	gšputPŒ
 += 8;

309 *
	gouutPŒ1
++ = 0;

310 ià(
	ghife
)

312 *
	gouutPŒ2
++ = 0;

314 *
	gdiffusiÚE¼ÜPŒ
++ = 0;

315 *
	gdiffusiÚE¼ÜPŒ
++ = 0;

316 *
	gdiffusiÚE¼ÜPŒ
++ = 0;

317 *
	gdiffusiÚE¼ÜPŒ
++ = 0;

318 *
	gdiffusiÚE¼ÜPŒ
++ = 0;

319 *
	gdiffusiÚE¼ÜPŒ
++ = 0;

320 *
	gdiffusiÚE¼ÜPŒ
++ = 0;

321 *
	gdiffusiÚE¼ÜPŒ
++ = 0;

322 
	g¿¡”By‹1
 = 0;

323 
	g¿¡”By‹2
 = 0;

324 
	gtmpShÜtStÜe
 = 0;

330 
	g¿¡”By‹1
 = 0;

331 
	g¿¡”By‹2
 = 0;

332 
	gšputPŒ
 +ğĞ
numLoİ
-1 );

333 
	gouutPŒ1
 +ğĞ
numLoİ
/8 - 1 );

334 
	gouutPŒ2
 +ğĞ
numLoİ
/8 - 1 );

335 
	gdiffusiÚE¼ÜPŒ
 +ğĞ
numLoİ
-1 );

337 
	gtmpShÜtStÜe
 = *
diffusiÚE¼ÜPŒ
;

339 *
	gdiffusiÚE¼ÜPŒ
 = 0;

341 
	gpix–CouÁ
 = 
numLoİ
 + 8; (pixelCount -= 8) > 0; )

343 ià(
	gpix–CouÁ
 > 16)

345 
	gdoNext8Pix–s
 = 
Backw¬d16Pix–sNÚWh™e
(
šputPŒ
);

349 
	gdoNext8Pix–s
 = 
HPTRUE
;

352 ià(
	gdoNext8Pix–s
)

354 
	gthV®ue
 = 
HPRªd
();

355 
BACKWARD_FED
Ğ
thV®ue
, 0x01 );

356 
	gthV®ue
 = 
HPRªd
();

357 
BACKWARD_FED
Ğ
thV®ue
, 0x02 );

358 
	gthV®ue
 = 
HPRªd
();

359 
BACKWARD_FED
Ğ
thV®ue
, 0x04 );

360 
	gthV®ue
 = 
HPRªd
();

361 
BACKWARD_FED
Ğ
thV®ue
, 0x08 );

362 
	gthV®ue
 = 
HPRªd
();

363 
BACKWARD_FED
Ğ
thV®ue
, 0x10 );

364 
	gthV®ue
 = 
HPRªd
();

365 
BACKWARD_FED
Ğ
thV®ue
, 0x20 );

366 
	gthV®ue
 = 
HPRªd
();

367 
BACKWARD_FED
Ğ
thV®ue
, 0x40 );

368 
	gthV®ue
 = 
HPRªd
();

369 
BACKWARD_FED
Ğ
thV®ue
, 0x80 );

371 *
	gouutPŒ1
-- = 
¿¡”By‹1
;

372 
	g¿¡”By‹1
 = 0;

374 ià(
	ghife
)

376 *
	gouutPŒ2
-- = 
¿¡”By‹2
;

377 
	g¿¡”By‹2
 = 0;

382 
	gšputPŒ
 -= 8;

383 *
	gouutPŒ1
-- = 0;

384 ià(
	ghife
)

386 *
	gouutPŒ2
-- = 0;

388 *
	gdiffusiÚE¼ÜPŒ
-- = 0;

389 *
	gdiffusiÚE¼ÜPŒ
-- = 0;

390 *
	gdiffusiÚE¼ÜPŒ
-- = 0;

391 *
	gdiffusiÚE¼ÜPŒ
-- = 0;

392 *
	gdiffusiÚE¼ÜPŒ
-- = 0;

393 *
	gdiffusiÚE¼ÜPŒ
-- = 0;

394 *
	gdiffusiÚE¼ÜPŒ
-- = 0;

395 *
	gdiffusiÚE¼ÜPŒ
-- = 0;

396 
	g¿¡”By‹1
 = 0;

397 
	g¿¡”By‹2
 = 0;

398 
	gtmpShÜtStÜe
 = 0;

405 
	gH®áÚ”_O³n
::
FORWARD_FED


407 
HPIÁ16
 
th»shŞdV®ue
,

408 
	gb™Mask


411 
	gtÚe
 = (*
šputPŒ
++ );

412 
	gãdResPŒ
 = 
ãdResTbl
 + (
tÚe
 << 2);

413 
	gËv–
 = *
ãdResPŒ
++;

414 ià(
	gtÚe
 != 0)

416 
tÚe
 = ( 
tmpShÜtStÜe
 + (
HPIÁ16
)(*
ãdResPŒ
++) );

417 ià(
	gtÚe
 >ğ
th»shŞdV®ue
)

419 
tÚe
 -= 255;

420 
	gËv–
++;

422 
	gËv–
)

427 
¿¡”By‹1
 |ğ
b™Mask
;

430 
¿¡”By‹2
 |ğ
b™Mask
;

433 
¿¡”By‹2
 |ğ
b™Mask
; 
	g¿¡”By‹1
 |= bitMask;

436 
¿¡”By‹3
 |ğ
b™Mask
;

439 
¿¡”By‹3
 |ğ
b™Mask
; 
	g¿¡”By‹1
 |= bitMask;

442 
¿¡”By‹3
 |ğ
b™Mask
; 
	g¿¡”By‹2
 |= bitMask;

445 
¿¡”By‹3
 |ğ
b™Mask
; 
	g¿¡”By‹2
 |ğb™Mask; 
	g¿¡”By‹1
 |= bitMask;

451 
	gtÚe
 = 
tmpShÜtStÜe
;

453 *
	gdiffusiÚE¼ÜPŒ
++ = 
tÚe
 >> 1;

454 
	gtmpShÜtStÜe
 = *
diffusiÚE¼ÜPŒ
 + (
tÚe
 - (tone >> 1));

458 
	gH®áÚ”_O³n
::
BACKWARD_FED


460 
HPIÁ16
 
th»shŞdV®ue
,

461 
	gb™Mask


464 
	gtÚe
 = (*
šputPŒ
-- );

465 
	gãdResPŒ
 = 
ãdResTbl
 + (
tÚe
 << 2);

466 
	gËv–
 = *
ãdResPŒ
++;

467 ià(
	gtÚe
 != 0)

469 
tÚe
 = ( 
tmpShÜtStÜe
 + (
HPIÁ16
)(*
ãdResPŒ
++) );

470 ià(
	gtÚe
 >ğ
th»shŞdV®ue
)

472 
tÚe
 -= 255;

473 
	gËv–
++;

475 
	gËv–
)

480 
¿¡”By‹1
 |ğ
b™Mask
;

483 
¿¡”By‹2
 |ğ
b™Mask
;

486 
¿¡”By‹2
 |ğ
b™Mask
; 
	g¿¡”By‹1
 |= bitMask;

489 
¿¡”By‹3
 |ğ
b™Mask
;

492 
¿¡”By‹3
 |ğ
b™Mask
; 
	g¿¡”By‹1
 |= bitMask;

495 
¿¡”By‹3
 |ğ
b™Mask
; 
	g¿¡”By‹2
 |= bitMask;

498 
¿¡”By‹3
 |ğ
b™Mask
; 
	g¿¡”By‹2
 |ğb™Mask; 
	g¿¡”By‹1
 |= bitMask;

504 
	gtÚe
 = 
tmpShÜtStÜe
;

506 *
	gdiffusiÚE¼ÜPŒ
-- = 
tÚe
 >> 1;

507 
	gtmpShÜtStÜe
 = *
diffusiÚE¼ÜPŒ
 + (
tÚe
 - (tone >> 1));

511 
	gAPDK_END_NAMESPACE


	@prnt/hpijs/halftoner_open.h

32 #iâdeà
HALFTONER_OPEN_H


33 
	#HALFTONER_OPEN_H


	)

35 
APDK_BEGIN_NAMESPACE


37 şas 
	cH®áÚ”_O³n
 : 
public
 
H®áÚ”


39 
public
:

40 
H®áÚ”_O³n


42 
Sy¡emS”viûs
* 
pSys
,

43 
PrštMode
* 
	mpPM
,

44 
	miIÅutWidth
,

45 
	miNumRows
[],

46 
	mHiResFaùÜ
,

47 
BOOL
 
	mm©rixba£d


49 
	mvœtu®
 ~
H®áÚ”_O³n
();

51 
vœtu®
 
BOOL
 
Proûss
(
RASTERDATA
* 
pbyIÅutKRGBRa¡”
=
NULL
);

54 
	m´Ùeùed
:

56 
IÁ”pŞ©e
(cÚ¡ 
ušt32_t
 *
¡¬t
,cÚ¡ 
i
,

57 
r
,
g
,
b
,

58 *
bÏckout
, *
cyªout
,

59 *
mag’out
, *
y–lowout
, 
HPBoŞ
);

62 
HPBy‹
 
	$HPRªd
()

63 { 
BYTE
 
b
=
	`RªdomNumb”
() % 74; b+= 5;  b; }

66 
	`HTEDiffO³n
 (
THTD™h”P¬msPŒ
 
d™h”P¬msPŒ
,

67 
HPUIÁ16
 
couÁ
);

69 
THTD™h”P¬ms
 
fD™h”P¬ms
[6];

71 
THTD™h”P¬msPŒ
 
d™h”P¬ms
;

72 
kS´šgsE¼ÜTy³
 
tÚe
;

73 
kS´šgsE¼ÜTy³PŒ
 
diffusiÚE¼ÜPŒ
;

74 
kS´šgsE¼ÜTy³
 
tmpShÜtStÜe
;

75 
HPUIÁ8
 
¿¡”By‹1
, 
¿¡”By‹2
, 
¿¡”By‹3
;

76 
HPUIÁ8
 
Ëv–
;

77 
HPIÁ16
 
pix–CouÁ
;

78 
HPIÁ16
 
thV®ue
;

80 
kS´šgsE¼ÜTy³PŒ
 
”rPŒ
;

81 
HPUIÁ16
 
numLoİ
;

83 
HPBy‹PŒ
 
šputPŒ
;

84 
HPBy‹PŒ
 
ouutPŒ1
, 
ouutPŒ2
, 
ouutPŒ3
;

86 
HPCBy‹PŒ
 
ãdResTbl
;

87 
HPCBy‹PŒ
 
ãdResPŒ
;

89 
HPBoŞ
 
symm‘ricFÏg
;

91 
HPBoŞ
 
doNext8Pix–s
;

93 
HPBoŞ
 
hife
;

95 
	`BACKWARD_FED
Ğ
HPIÁ16
 
th»shŞdV®ue
, 
b™Mask
 );

96 
	`FORWARD_FED
Ğ
HPIÁ16
 
th»shŞdV®ue
, 
b™Mask
 );

98 
	}
};

100 
	gAPDK_END_NAMESPACE


	@prnt/hpijs/header.h

32 #iâdeà
APDK_HEADER_H


33 
	#APDK_HEADER_H


	)

35 
	~"cÚfig.h
"

37 
	~"¶©fÜm.h
"

38 
	~"debug.h
"

40 
	~"hµršpi.h
"

41 
	~"š‹º®.h
"

42 
	~"´š‹r.h
"

43 
	~"fÚt.h
"

44 
	~"f‹rh·.h
"

46 #ià
defšed
(
APDK_CAPTURE
è|| defšed(
APDK_REPLAY
)

47 
	~"h¬Ãss.h
"

	@prnt/hpijs/header2.cpp

32 
	~"h—d”.h
"

34 
APDK_BEGIN_NAMESPACE


36 
BYTE
 
EscCİy
(BYTE *
de¡
,cÚ¡ *
s
,
num
, 
’d
);

37 
BYTE
 
EscAm¶Cİy
(BYTE *
de¡
, 
num
, 
’d
);

38 
PAPER_SIZE
 
MedŸSizeToP­”
(
MedŸSize
 
msize
);

39 
MedŸSize
 
P­”ToMedŸSize
(
PAPER_SIZE
 
psize
);

42 
	$äac
(
f
)

44 { 
g
=()
f
;

45 
å
ğ
f
 - ()
g
;

46  
å
;

47 
	}
}

53 
	gH—d”
::
	$H—d”
(
Prš‹r
* 
p
,
PrštCÚ‹xt
* 
pc
)

54 : 
	`CAPy
(0), 
	`thePrš‹r
(
p
), 
	$thePrštCÚ‹xt
(
pc
)

56 
thePrštMode
 = 
thePrštCÚ‹xt
->
Cu¼’tMode
;

58 
dyeCouÁ
 = 
thePrštMode
->dyeCount;

60 
	`DBG1
("In Header constructor\n");

61 
i
=0; i<
MAXCOLORPLANES
; i++)

63 
ResŞutiÚX
[
i
] = 
thePrštMode
->ResolutionX[i];

64 
ResŞutiÚY
[
i
] = 
thePrštMode
->ResolutionY[i];

77 
thePrš‹r
->
	`Adju¡ModeS‘tšgs
 (
thePrštCÚ‹xt
->
bDoFuÎBËed
,

78 
thePrštCÚ‹xt
->
m_mtReqMedŸTy³
,

79 &
thePrštCÚ‹xt
->
Cu¼’tMode
->
medium
,

80 &
thePrštCÚ‹xt
->
Cu¼’tMode
->
theQu®™y
);

82 
	`S‘MedŸTy³
(
thePrštCÚ‹xt
->
Cu¼’tMode
->
medium
);

83 
	`S‘Qu®™y
(
thePrštCÚ‹xt
->
Cu¼’tMode
->
theQu®™y
);

85 
	`S‘MedŸSize
Ğ
thePrštCÚ‹xt
->
theP­”Size
 );

86 
	`S‘MedŸSourû
 (
thePrštCÚ‹xt
->
	`G‘MedŸSourû
 ());

88 
	`S‘Sim¶eCŞÜ
();

89 
	}
}

91 
	gH—d”
::~
	$H—d”
 ()

93 
	}
}

99 
H—d”
::
	$S‘MedŸTy³
(
MedŸTy³
 
mty³
)

102 
mtcouÁ
=
	`EscAm¶Cİy
((
BYTE
*)
medŸty³
,
mty³
,'M');

103 
	}
}

105 
	gH—d”
::
	$S‘MedŸSize
(
PAPER_SIZE
 
psize
)

108 
msizeCode
;

110 ià((
msizeCode
 = 
thePrštCÚ‹xt
->
	`G‘JobA‰ribu‹s
(
MEDIASIZE_PCL
)) < 0)

112 
msizeCode
 = 
	`P­”ToMedŸSize
(
psize
);

115 
mscouÁ
=
	`EscAm¶Cİy
((
BYTE
*)
medŸsize
,
msizeCode
,'A');

116 
	}
}

118 
	gH—d”
::
	$S‘MedŸSourû
(
MedŸSourû
 
msourû
)

121 #ià
	`defšed
(
DEBUG
è&& (
DBG_MASK
 & 
DBG_LVL1
)

122 
	`DBG1
("Setting MediaSourceo ");

123 
msourû
)

125 
sourûT¿y1
: 
	`DBG1
("Tray1\n"); ;

126 
sourûT¿y2
: 
	`DBG1
("Tray2\n"); ;

127 
sourûMªu®
: 
	`DBG1
("Manual\n"); ;

128 
sourûMªu®Env
: 
	`DBG1
("ManualEnv\n"); ;

129 
sourûT¿yAuto
: 
	`DBG1
("AutoTray\n"); ;

130 
sourûDu¶ex”NHagakiF“d
: 
	`DBG1
("HagakiTray\n"); ;

131 
sourûBªÃr
: 
	`DBG1
("Bannerpaper\n"); ;

132 
sourûT¿yCDDVD
: 
	`DBG1
("CD/DVD Tray\n"); ;

133 : 
	`DBG1
("<out of„ange, using> Tray1\n"); ;

137 
	`ASSERT
Ğ(
msourû
==
sourûT¿y1
è|| (msourû==
sourûMªu®
) ||

138 (
msourû
==
sourûT¿y2
è|| (msourû==
sourûDu¶ex”NHagakiF“d
) ||

139 (
msourû
==
sourûMªu®Env
è|| (msourû==
sourûT¿yAuto
) ||

140 (
msourû
 =ğ
sourûO±iÚ®Env
è|| (msourû =ğ
sourûBªÃr
) ||

141 (
msourû
 =ğ
sourûT¿yCDDVD
));

143 ifĞ(
msourû
!=
sourûT¿y1
è&& (msourû!=
sourûMªu®
) &&

144 (
msourû
!=
sourûT¿y2
è&& (msourû!=
sourûDu¶ex”NHagakiF“d
) &&

145 (
msourû
!=
sourûMªu®Env
è&& (msourû!=
sourûT¿yAuto
) &&

146 (
msourû
 !ğ
sourûO±iÚ®Env
è&& (msourû !ğ
sourûBªÃr
) &&

147 (
msourû
 !ğ
sourûT¿yCDDVD
))

148 
msourû
=
sourûT¿y1
;

150 ià(
thePrš‹r
 !ğ
NULL
)

152 ià(
msourû
==
sourûDu¶ex”NHagakiF“d
 && !
thePrš‹r
->
	`HagakiF“dP»£Á
(
TRUE
))

154 
msourû
=
sourûT¿y1
;

157 
m¤ccouÁ
=
	`EscAm¶Cİy
((
BYTE
*)
medŸsourû
,
msourû
,'H');

158 
	}
}

160 
	gH—d”
::
	$S‘Qu®™y
(
Qu®™y
 
qu®
)

163 #ià
	`defšed
(
DEBUG
è&& (
DBG_MASK
 & 
DBG_LVL1
)

164 
	`DBG1
("Setting Qualityo ");

165 
qu®
)

167 
qu®™yP»£Á©iÚ
: 
	`DBG1
("Presentation\n"); ;

168 
qu®™yNÜm®
: 
	`DBG1
("Normal\n"); ;

169 
qu®™yD¿á
: 
	`DBG1
("Draft\n"); ;

170 
qu®™yFa¡D¿á
: 
	`DBG1
 ("FastDraft\n"); ;

171 : 
	`DBG1
("<out of„ange, using> Normal\n"); ;

174 
	`ASSERT
 (
qu®
 >ğ
qu®™yAuto
 && qu® <ğ
qu®™yFa¡NÜm®
);

176 ià(
qu®
 < 
qu®™yAuto
 || qu® > 
qu®™yFa¡NÜm®
)

177 
qu®
 = 
qu®™yNÜm®
;

179 
qu®couÁ
 = 
	`EscCİy
 ((
BYTE
 *è
qu®™y
,"*o",
qu®
,'M');

180 
	}
}

182 
BYTE
 
	gH—d”
::
	$Qu®™yCode
()

183 {  
qu®™y
[3]; 
	}
}

185 
	gH—d”
::
	$S‘Sim¶eCŞÜ
()

191 
	`DBG1
("Setting SimpleColor mode\n");

192 
¶ªes
ğ0 - 
dyeCouÁ
;

193 
sccouÁ
=
	`EscCİy
((
BYTE
*)
Sim¶eCŞÜ
,"*r",
¶ªes
,'U');

194 
	}
}

197 
DRIVER_ERROR
 
	gH—d”
::
	$S¹S’d
()

200 
DRIVER_ERROR
 
”r
;

207 
”r
 = 
thePrš‹r
->
	`S’d
((cÚ¡ 
BYTE
*)
UEL
,(UEL));

208 
ERRCHECK
;

210 
”r
 = 
thePrš‹r
->
	`S’d
((cÚ¡ 
BYTE
*)
EÁ”Lªguage
,(EnterLanguage));

211 
ERRCHECK
;

213 
”r
 = 
thePrš‹r
->
	`S’d
((cÚ¡ 
BYTE
*)
PCL3
,(PCL3));

214 
ERRCHECK
;

216 
”r
 = 
thePrš‹r
->
	`S’d
((cÚ¡ 
BYTE
*)
Re£t
,(Reset));

217 
ERRCHECK
;

219 
”r
 = 
thePrš‹r
->
	`S’d
((cÚ¡ 
BYTE
*)&
LF
,1);

220 
ERRCHECK
;

222 
”r
=
	`Modes
();

223 
ERRCHECK
;

225 
”r
=
	`M¬gšs
();

227  
”r
;

228 
	}
}

231 
DRIVER_ERROR
 
	gH—d”
::
	$CÚfigu»Ra¡”D©a
()

237 
	#CRDSIZE
 41

238 
buff
[
CRDSIZE
];

	)

239 *
out
=
buff
;

243 
	`memıy
(
out
,
üdS¹
,(crdStart) );

244 
out
 +ğ(
üdS¹
);

249 
sBufãr
[3];

250 
num
 = 
dyeCouÁ
 * 
MAXCOLORPLANES
 + 2;

251 
	`¥rštf
Ğ
sBufãr
, "%d", 
num
 );

252 *
out
++ = 
sBufãr
[0];

253 ià(
num
 > 9)

254 *
out
++ = 
sBufãr
[1];

255 *
out
++ = 'W';

257 *
out
++ = 
üdFÜm©
;

258 *
out
++ = (
BYTE
)
dyeCouÁ
;

260 
¡¬t
=
K
;

261 ià(
dyeCouÁ
==3)

262 
¡¬t
=
C
;

264 
cŞÜ
 = 
¡¬t
; cŞÜ < (¡¬ˆ+ 
dyeCouÁ
); color++)

266 *
out
++ = 
ResŞutiÚX
[
cŞÜ
]/256;

267 *
out
++ = 
ResŞutiÚX
[
cŞÜ
]%256;

268 *
out
++ = 
ResŞutiÚY
[
cŞÜ
]/256;

269 *
out
++ = 
ResŞutiÚY
[
cŞÜ
]%256;

271 
d•th
=
	`CŞÜLev–s
(
cŞÜ
);

273 *
out
++ = 
d•th
/256;

274 *
out
++ = 
d•th
%256;

276 
DRIVER_ERROR
 
”rÜ
ğ
thePrš‹r
->
	`S’d
((cÚ¡ 
BYTE
*è
buff
, 
out
-buff);

277  
”rÜ
;

278 
	}
}

281 
	#uÅršbË
 ().04

	)

282 
	#g¿nuÏr™y
 48

	)

284 
DRIVER_ERROR
 
	gH—d”
::
	$M¬gšs
()

287 
	#MARGINSIZE
 (5 * 6)

288 
BYTE
 
buff
[
MARGINSIZE
];

	)

289 
BYTE
 *
out
=
buff
;

297 
tmInches
 = 
thePrštCÚ‹xt
->
	`PršbËS¹Y
();

298 
Adju¡edS¹Y
 = 
tmInches
 - 
uÅršbË
;

299 
fTİM¬gš
 = ()
g¿nuÏr™y
 * 
Adju¡edS¹Y
;

301 
iTİM¬gš
 = (è
fTİM¬gš
;

302 ià(
	`äac
(
fTİM¬gš
) > ().5)

303 
iTİM¬gš
++;

306 
out
 +ğ
	`EscAm¶Cİy
(out,0, 'L');

307 
out
 +ğ
	`EscAm¶Cİy
(out,
g¿nuÏr™y
,'D');

308 
out
 +ğ
	`EscAm¶Cİy
(out,
iTİM¬gš
,'E');

309 
out
 +ğ
	`EscAm¶Cİy
(out,6,'D');

314 
out
 +ğ
	`EscCİy
(out,"*p", 0, 'X');

316 
DRIVER_ERROR
 
”rÜ
ğ
thePrš‹r
->
	`S’d
((cÚ¡ 
BYTE
*è
buff
,(
out
-buff) );

318  
”rÜ
;

319 
	}
}

321 
DRIVER_ERROR
 
	gH—d”
::
	$G¿phics
()

323 
DRIVER_ERROR
 
”rÜ
ğ
thePrš‹r
->
	`S’d
((cÚ¡ 
BYTE
*)
g¿fS¹
, (grafStart) );

324 ià(
”rÜ
!=
NO_ERROR
)

325  
”rÜ
;

327 ià(
thePrštMode
->
CÚfig
.
bCom´ess
)

329 
”rÜ
ğ
thePrš‹r
->
	`S’d
((cÚ¡ 
BYTE
*)
g¿fMode9
, (grafMode9) );

330 ià(
”rÜ
!=
NO_ERROR
)

331  
”rÜ
;

332 
”rÜ
ğ
thePrš‹r
->
	`S’d
((cÚ¡ 
BYTE
*)
S“dSame
, (SeedSame) );

335 
”rÜ
ğ
thePrš‹r
->
	`S’d
((cÚ¡ 
BYTE
*)
g¿fMode0
, (grafMode0) );

337  
”rÜ
;

338 
	#GRAPHICSIZE
 ((
g¿fS¹
)+(
g¿fMode9
)+(
S“dSame
))

	)

339 
	}
}

342 
DRIVER_ERROR
 
	gH—d”
::
	$Sim¶e
()

347 
	#SIMPLESIZE
 21

348 
BYTE
 
buff
[
SIMPLESIZE
];

	)

349 
BYTE
 *
out
 = 
buff
;

351 
»sŞutiÚ
 = 
thePrštCÚ‹xt
->
Cu¼’tMode
->
Ba£ResX
;

352 
gwidth
 = 
thePrštCÚ‹xt
->
PageWidth
;

354 
	`memıy
(
out
, 
Sim¶eCŞÜ
, 
sccouÁ
);

355 
out
 +ğ
sccouÁ
;

358 
out
 +ğ
	`EscCİy
(out,"*t", 
»sŞutiÚ
, 'R');

361 
out
 +ğ
	`EscCİy
(out,"*r", 
gwidth
, 'S');

364 
DRIVER_ERROR
 
”rÜ
ğ
thePrš‹r
->
	`S’d
((cÚ¡ 
BYTE
*è
buff
,(
out
-buff) );

366  
”rÜ
;

368 
	}
}

370 
DRIVER_ERROR
 
	gH—d”
::
	$Modes
()

373 
	#MODESIZE
 6*4

	)

374 
BYTE
 
buff
[
MODESIZE
];

375 
BYTE
 *
out
 = 
buff
;

377 
	`memıy
(
out
,
medŸsourû
, 
m¤ccouÁ
 );

378 
out
 +ğ
m¤ccouÁ
;

379 
	`memıy
(
out
,
medŸty³
, 
mtcouÁ
 );

380 
out
 +ğ
mtcouÁ
;

392 
	`memıy
(
out
,
medŸsize
,
mscouÁ
 );

393 
out
 +ğ
mscouÁ
;

395 
	`memıy
(
out
,
qu®™y
, 
qu®couÁ
 );

396 
out
 +ğ
qu®couÁ
;

398 
DRIVER_ERROR
 
”rÜ
ğ
thePrš‹r
->
	`S’d
((cÚ¡ 
BYTE
*è
buff
,(
out
-buff) );

404  
”rÜ
;

405 
	}
}

410 
DRIVER_ERROR
 
	gH—d”
::
	$EndJob
()

412 
DRIVER_ERROR
 
”r
 = 
thePrš‹r
->
	`S’d
((cÚ¡ 
BYTE
*)
Re£t
,(Reset));

413 
ERRCHECK
;

415  
thePrš‹r
->
	`S’d
((cÚ¡ 
BYTE
*)
UEL
,(UEL));

416 
	}
}

419 
DRIVER_ERROR
 
	gH—d”
::
	$S’dCAPy
(
iAbsY
)

420 { 
Ën
; 
BYTE
 
‹mp
[10];

422 
Ën
 = 
	`EscCİy
 (
‹mp
,"*p",
iAbsY
,'Y');

424  
thePrš‹r
->
	`S’d
Ğ
‹mp
, 
Ën
);

425 
	}
}

427 
	gH—d”
::
	$CŞÜLev–s
(
CŞÜPÏÃ
)

430 
b™s
=
thePrštCÚ‹xt
->
Cu¼’tMode
->
CŞÜD•th
[
CŞÜPÏÃ
];

431 
»s
=1;

432 
i
=0; i<
b™s
; i++)

433 
»s
=res*2;

435  
»s
;

436 
	}
}

438 
DRIVER_ERROR
 
	gH—d”
::
	$FÜmF“d
()

440 
BYTE
 
FF
=12;

441  
thePrš‹r
->
	`S’d
((cÚ¡ 
BYTE
*)&
FF
,1);

442 
	}
}

444 
	gAPDK_END_NAMESPACE


	@prnt/hpijs/hpcupsfax.cpp

32 
	~<sys/¡©.h
>

33 
	~<¡dio.h
>

34 
	~<¡dlib.h
>

35 
	~<¡d¬g.h
>

36 
	~<sy¦og.h
>

37 
	~<¡ršg.h
>

38 
	~<uni¡d.h
>

39 
	~<fú.h
>

40 
	~<¡dšt.h
>

41 
	~<time.h
>

42 
	~<sys/time.h
>

43 
	~<¬·/š‘.h
>

44 
	~<m©h.h
>

45 
	~<cups/cups.h
>

46 
	~<cups/¿¡”.h
>

47 
	~<¡ršg
>

48 #ifdeà
FALSE


49 #undeà
FALSE


51 #ifdeà
TRUE


52 #undeà
TRUE


54 
	~"hp.h
"

55 
	~"hpcupsçx.h
"

56 
	~"bug.h
"

57 
	~"uts.h
"

58 
usšg
 
Çme¥aû
 
	g¡d
;

60 
	gçx_’codšg
 = 
RASTER_MMR
;

61 
	gdeviû_Çme
[16];

62 
BYTE
 
	gszFeH—d”
[68];

63 
BYTE
 
	gszPageH—d”
[64];

65 
	$ušt32_t
 (*
cÚv”t_’dŸn_l
)(
ušt32_t
);

66 
	$ušt16_t
 (*
cÚv”t_’dŸn_s
)(
ušt16_t
);

68 
iLogLev–
 = 1;

69 
hpFeName
[
MAX_FILE_PATH_LEN
] ;

71 
	#TIFF_HDR_SIZE
 8

	)

72 
	#LITTLE_ENDIAN_MODE
 
I


	)

73 
	#BIG_ENDIAN_MODE
 
M


	)

75 
	#DBG
(
¬gs
...è
	`sy¦og
(
LOG_INFO
, 
__FILE__
 " " 
	`STRINGIZE
(
__LINE__
è": "‡rgs)

	)

78 
	#RGB2BW
(
r
, 
g
, 
b
è(
BYTE
è((Ô << 2è+„ + (g << 3è+ g + (b << 1)è>> 4)

	)

81 
	$RGB2G¿y
 (
BYTE
 *
pRGBD©a
, 
iNumPix–s
, BYTE *
pGD©a
)

83 
i
;

84 
BYTE
 *
pIn
 = 
pRGBD©a
;

85 
BYTE
 *
pOut
 = 
pGD©a
;

86 
i
 = 0; i < 
iNumPix–s
; i++, 
pIn
 += 3)

88 *
pOut
++ = 
	`RGB2BW
 ((è*
pIn
, ()…In[1], ()…In[2]);

90 
	}
}

92 
	$G‘LogLev–
 ()

94 
FILE
 *
å
;

95 
¡r
[258];

96 *
p
;

97 
å
 = 
	`fİ’
 ("/etc/cups/cupsd.conf", "r");

98 ià(
å
 =ğ
NULL
)

100 !
	`ãof
 (
å
))

102 ià(!
	`fg‘s
 (
¡r
, 256, 
å
))

106 ià((
p
 = 
	`¡r¡r
 (
¡r
, "hpLogLevel")))

108 
p
 +ğ
	`¡¾’
 ("hpLogLevel") + 1;

109 
iLogLev–
 = 
	`©oi
 (
p
);

113 
	`fşo£
 (
å
);

114 
	}
}

116 
	$PrštCupsH—d”
 (
cups_·ge_h—d”2_t
 
m_cupsH—d”
)

118 ià(
iLogLev–
 == 0)

122 
	`BUG
 ("DEBUG: HPFAX - startPage...\n");

123 
	`BUG
 ("DEBUG: HPFAX - MedŸCÏs ğ\"%s\"\n", 
m_cupsH—d”
.
MedŸCÏss
);

124 
	`BUG
 ("DEBUG: HPFAX - MedŸCŞÜ = \"%s\"\n", 
m_cupsH—d”
.
MedŸCŞÜ
);

125 
	`BUG
 ("DEBUG: HPFAX - MedŸTy³ = \"%s\"\n", 
m_cupsH—d”
.
MedŸTy³
);

126 
	`BUG
 ("DEBUG: HPFAX - OuutTy³ = \"%s\"\n", 
m_cupsH—d”
.
OuutTy³
);

127 
	`BUG
 ("DEBUG: HPFAX - AdvªûDi¡ªû = %d\n", 
m_cupsH—d”
.
AdvªûDi¡ªû
);

128 
	`BUG
 ("DEBUG: HPFAX - AdvªûMedŸ = %d\n", 
m_cupsH—d”
.
AdvªûMedŸ
);

129 
	`BUG
 ("DEBUG: HPFAX - CŞÏ‹ = %d\n", 
m_cupsH—d”
.
CŞÏ‹
);

130 
	`BUG
 ("DEBUG: HPFAX - CutMedŸ = %d\n", 
m_cupsH—d”
.
CutMedŸ
);

131 
	`BUG
 ("DEBUG: HPFAX - Du¶ex = %d\n", 
m_cupsH—d”
.
Du¶ex
);

132 
	`BUG
 ("DEBUG: HPFAX - HWResŞutiÚ = [ %d %d ]\n", 
m_cupsH—d”
.
HWResŞutiÚ
[0], m_cupsHeader.HWResolution[1]);

133 
	`BUG
 ("DEBUG: HPFAX - ImagingBoundingBox = [ %d %d %d %d ]\n",

134 
m_cupsH—d”
.
ImagšgBoundšgBox
[0], m_cupsHeader.ImagingBoundingBox[1],

135 
m_cupsH—d”
.
ImagšgBoundšgBox
[2], m_cupsHeader.ImagingBoundingBox[3]);

136 
	`BUG
 ("DEBUG: HPFAX - In£¹Sh“ˆğ%d\n", 
m_cupsH—d”
.
In£¹Sh“t
);

137 
	`BUG
 ("DEBUG: HPFAX - Jog = %d\n", 
m_cupsH—d”
.
Jog
);

138 
	`BUG
 ("DEBUG: HPFAX - L—dšgEdgğ%d\n", 
m_cupsH—d”
.
L—dšgEdge
);

139 
	`BUG
 ("DEBUG: HPFAX - M¬gš ğ[ %d %d ]\n", 
m_cupsH—d”
.
M¬gšs
[0], m_cupsHeader.Margins[1]);

140 
	`BUG
 ("DEBUG: HPFAX - Mªu®F“d = %d\n", 
m_cupsH—d”
.
Mªu®F“d
);

141 
	`BUG
 ("DEBUG: HPFAX - MedŸPos™iÚ = %d\n", 
m_cupsH—d”
.
MedŸPos™iÚ
);

142 
	`BUG
 ("DEBUG: HPFAX - MedŸWeighˆğ%d\n", 
m_cupsH—d”
.
MedŸWeight
);

143 
	`BUG
 ("DEBUG: HPFAX - MœrÜPršˆğ%d\n", 
m_cupsH—d”
.
MœrÜPršt
);

144 
	`BUG
 ("DEBUG: HPFAX - Neg©ivePršˆğ%d\n", 
m_cupsH—d”
.
Neg©ivePršt
);

145 
	`BUG
 ("DEBUG: HPFAX - NumCİ› ğ%d\n", 
m_cupsH—d”
.
NumCİ›s
);

146 
	`BUG
 ("DEBUG: HPFAX - Or›Á©iÚ = %d\n", 
m_cupsH—d”
.
Or›Á©iÚ
);

147 
	`BUG
 ("DEBUG: HPFAX - OuutFaûU°ğ%d\n", 
m_cupsH—d”
.
OuutFaûUp
);

148 
	`BUG
 ("DEBUG: HPFAX - PageSizğ[ %d %d ]\n", 
m_cupsH—d”
.
PageSize
[0], m_cupsHeader.PageSize[1]);

149 
	`BUG
 ("DEBUG: HPFAX - S•¬©iÚ ğ%d\n", 
m_cupsH—d”
.
S•¬©iÚs
);

150 
	`BUG
 ("DEBUG: HPFAX - T¿ySw™ch = %d\n", 
m_cupsH—d”
.
T¿ySw™ch
);

151 
	`BUG
 ("DEBUG: HPFAX - TumbË = %d\n", 
m_cupsH—d”
.
TumbË
);

152 
	`BUG
 ("DEBUG: HPFAX - cupsWidth = %d\n", 
m_cupsH—d”
.
cupsWidth
);

153 
	`BUG
 ("DEBUG: HPFAX - cupsHeighˆğ%d\n", 
m_cupsH—d”
.
cupsHeight
);

154 
	`BUG
 ("DEBUG: HPFAX - cupsMedŸTy³ = %d\n", 
m_cupsH—d”
.
cupsMedŸTy³
);

155 
	`BUG
 ("DEBUG: HPFAX - cupsRowS‹°ğ%d\n", 
m_cupsH—d”
.
cupsRowS‹p
);

156 
	`BUG
 ("DEBUG: HPFAX - cupsB™sP”CŞÜ = %d\n", 
m_cupsH—d”
.
cupsB™sP”CŞÜ
);

157 
	`BUG
 ("DEBUG: HPFAX - cupsB™sP”Pix– = %d\n", 
m_cupsH—d”
.
cupsB™sP”Pix–
);

158 
	`BUG
 ("DEBUG: HPFAX - cupsBy‹sP”Lšğ%d\n", 
m_cupsH—d”
.
cupsBy‹sP”Lše
);

159 
	`BUG
 ("DEBUG: HPFAX - cupsCŞÜOrd” = %d\n", 
m_cupsH—d”
.
cupsCŞÜOrd”
);

160 
	`BUG
 ("DEBUG: HPFAX - cupsCŞÜS·û = %d\n", 
m_cupsH—d”
.
cupsCŞÜS·û
);

161 
	`BUG
 ("DEBUG: HPFAX - cupsCom´essiÚ = %d\n", 
m_cupsH—d”
.
cupsCom´essiÚ
);

162 
	`BUG
 ("DEBUG: HPFAX - cupsPageSizeNamğ%s\n", 
m_cupsH—d”
.
cupsPageSizeName
);

163 
	}
}

165 
	$G‘PageSizeFromSŒšg
(*
¡ršg
)

167 
iPageSize
 = 
	`©oi
(
¡ršg
);

168 if(
iPageSize
 == 0)

170 if(
	`¡rcmp
(
¡ršg
,"Letter") ==0){

171 
iPageSize
 = 1;

173 if(
	`¡rcmp
(
¡ršg
,"A4") ==0){

174 
iPageSize
 = 2;

176 if(
	`¡rcmp
(
¡ršg
,"Legal") ==0){

177 
iPageSize
 = 3;

180 
	`DBG
("hpcupsfax: GetPageSizeFromString:Default Page Size isaken,ensure it is ok.\n");

181 
iPageSize
 = 1;

184 
	`DBG
("hpcupsçx: G‘PageSizeFromSŒšg: PageSizğ%d\n",
iPageSize
);

185  
iPageSize
;

186 
	}
}

188 
	$ProûssRa¡”D©a
 (
cups_¿¡”_t
 *
cups_¿¡”
, 
fdFax
)

190 
¡©us
 = 0;

191 
i
;

192 
widthMMR
;

193 
iIÅutBufSize
;

194 
BYTE
 *
pThisSÿnLše
;

195 
LPBYTE
 
pbOuutBuf
 = 
NULL
;

196 
LPBYTE
 
pIÅutBuf
 = 
NULL
;

197 
IP_XFORM_SPEC
 
xFÜm
[3];

198 
IP_IMAGE_TRAITS
 
Œa™s
;

199 
IP_HANDLE
 
hJob
;

201 
BYTE
 *
p
;

202 
cups_·ge_h—d”2_t
 
cups_h—d”
;

203 
iPageNum
 = 0;

204 
cŞÜ_mode
;

205 *
pDev
;

206 
uiPageNum
 = 0;

208 
pDev
 = 
	`g‘’v
 ("DEVICE_URI");

210 
	`cupsRa¡”R—dH—d”2
 (
cups_¿¡”
, &
cups_h—d”
))

212 
iPageNum
++;

213 ià(
iPageNum
 == 1)

215 
	`PrštCupsH—d”
 (
cups_h—d”
);

216 
cŞÜ_mode
 = (
cups_h—d”
.
cupsRowS‹p
 =ğ0è? 
HPLIPFAX_MONO
 : 
HPLIPFAX_COLOR
;

217 ià(
cŞÜ_mode
 =ğ
HPLIPFAX_COLOR
)

219 
çx_’codšg
 = 
RASTER_JPEG
;

221 
	`mem£t
 (
szFeH—d”
, 0,  (szFileHeader));

222 
	`memıy
 (
szFeH—d”
, "hplip_g3", 8);

223 
p
 = 
szFeH—d”
 + 8;

224 *
p
++ = 1;

225 
	`HPLIPPUTINT32
 (
p
, 0);… += 4;

226 
	`HPLIPPUTINT16
 (
p
, 
cups_h—d”
.
HWResŞutiÚ
[0]);… += 2;

227 
	`HPLIPPUTINT16
 (
p
, 
cups_h—d”
.
HWResŞutiÚ
[1]);… += 2;

228 
	`BUG
("ATOI V®u = %d",
	`©oi
 (
cups_h—d”
.
cupsPageSizeName
));

229 *
p
++ = 
	`G‘PageSizeFromSŒšg
(
cups_h—d”
.
cupsPageSizeName
);

230 *
p
++ = 
	`©oi
 (
cups_h—d”
.
OuutTy³
);

231 *
p
++ = 
çx_’codšg
;

232 
p
 += 4;

233 
p
 += 4;

234 
	`wr™e
 (
fdFax
, 
szFeH—d”
, (
p
 - szFileHeader));

237 
widthMMR
 = (((
cups_h—d”
.
cupsWidth
 + 7) >> 3)) << 3;

244 ià(
	`¡rcmp
 (
deviû_Çme
, "HPFax4") ==0)

246 
widthMMR
 = 1728;

248 ià(!
	`¡rcmp
 (
deviû_Çme
, "HPFax2"))

250 
widthMMR
 = 2528;

252 
iIÅutBufSize
 = 
widthMMR
 * 
cups_h—d”
.
cupsHeight
;

254 
pIÅutBuf
 = (
LPBYTE
è
	`m®loc
 (
iIÅutBufSize
);

255 ià(
pIÅutBuf
 =ğ
NULL
)

257 
	`BUG
 ("UÇbËØ®loÿ‹…IÅutBuf, sizğ%d\n", 
iIÅutBufSize
);

258 
BUGOUT
;

260 
	`mem£t
 (
pIÅutBuf
, 0xFF, 
iIÅutBufSize
);

262 
pThisSÿnLše
 = 
Ãw
 
BYTE
[
cups_h—d”
.
cupsBy‹sP”Lše
];

263 ià(
pThisSÿnLše
 =ğ
NULL
)

265 
	`BUG
 ("UÇbËØ®loÿ‹…ThisSÿnLše, sizğ%d\n", 
cups_h—d”
.
cupsBy‹sP”Lše
);

266 
BUGOUT
;

269 
i
 = 0; i < 
cups_h—d”
.
cupsHeight
; i++)

271 
	`cupsRa¡”R—dPix–s
 (
cups_¿¡”
, 
pThisSÿnLše
, 
cups_h—d”
.
cupsBy‹sP”Lše
);

272 
	`RGB2G¿y
 (
pThisSÿnLše
, 
cups_h—d”
.
cupsWidth
, 
pIÅutBuf
 + 
i
 * 
widthMMR
);

275 
WORD
 
wResuÉ
;

276 
DWORD
 
dwIÅutAva
;

277 
DWORD
 
dwIÅutU£d
;

278 
DWORD
 
dwIÅutNextPos
;

279 
DWORD
 
dwOuutAva
;

280 
DWORD
 
dwOuutU£d
;

281 
DWORD
 
dwOuutThisPos
;

282 
pbOuutBuf
 = (
LPBYTE
è
	`m®loc
 (
iIÅutBufSize
);

283 ià(
pbOuutBuf
 =ğ
NULL
)

285 
	`BUG
 ("uÇbËØ®loÿ‹…bOuutBuf, bufã¸sizğ%d\n", 
iIÅutBufSize
);

286 
BUGOUT
;

288 
	`mem£t
 (
pbOuutBuf
, 0xFF, 
iIÅutBufSize
);

290 
	`mem£t
 (
xFÜm
, 0,  (xForm));

292 ià(
cŞÜ_mode
 =ğ
HPLIPFAX_MONO
)

294 
i
 = 0;

295 
xFÜm
[
i
].
eXfÜm
 = 
X_GRAY_2_BI
;

300 
xFÜm
[
i
].
aXfÜmInfo
[
IP_GRAY_2_BI_THRESHOLD
].
dwÜd
 = 127;

301 
i
++;

303 
xFÜm
[
i
].
eXfÜm
 = 
X_FAX_ENCODE
;

304 ià(
çx_’codšg
=ğ
RASTER_MMR
)

306 
xFÜm
[
i
].
aXfÜmInfo
[
IP_FAX_FORMAT
].
dwÜd
 = 
IP_FAX_MMR
;

310 
xFÜm
[
i
].
aXfÜmInfo
[
IP_FAX_FORMAT
].
dwÜd
 = 
IP_FAX_MH
;

314 
xFÜm
[
i
].
aXfÜmInfo
[
IP_FAX_NO_EOLS
].
dwÜd
 = 0;

315 
xFÜm
[
i
].
pXfÜm
 = 
NULL
;

316 
xFÜm
[
i
].
pfR—dP“k
 = 
NULL
;

317 
xFÜm
[
i
].
pfWr™eP“k
 = 
NULL
;

318 
i
++;

320 
wResuÉ
 = 
	`O³n
 (
i
, 
xFÜm
, 0, &
hJob
);

321 
Œa™s
.
iCompÚ’tsP”Pix–
 = 1;

322 
Œa™s
.
iB™sP”Pix–
 = 8;

326 
xFÜm
[0].
eXfÜm
 = 
X_CNV_COLOR_SPACE
;

327 
xFÜm
[0].
aXfÜmInfo
[
IP_CNV_COLOR_SPACE_WHICH_CNV
].
dwÜd
 = 
IP_CNV_SRGB_TO_YCC
;

328 
xFÜm
[1].
eXfÜm
 = 
X_CNV_COLOR_SPACE
;

329 
xFÜm
[1].
aXfÜmInfo
[
IP_CNV_COLOR_SPACE_WHICH_CNV
].
dwÜd
 = 
IP_CNV_YCC_TO_CIELAB
;

330 
xFÜm
[0].
eXfÜm
 = 
X_JPG_ENCODE
;

331 
xFÜm
[0].
aXfÜmInfo
[
IP_JPG_ENCODE_FOR_COLOR_FAX
].
dwÜd
 = 1;

332 
wResuÉ
 = 
	`O³n
 (1, 
xFÜm
, 0, &
hJob
);

333 
Œa™s
.
iCompÚ’tsP”Pix–
 = 3;

334 
Œa™s
.
iB™sP”Pix–
 = 8;

337 ià(
wResuÉ
 !ğ
IP_DONE
)

339 
	`BUG
 ("O³Àçed: wResuÉ = %x\n", 
wResuÉ
);

340 
BUGOUT
;

342 
Œa™s
.
iPix–sP”Row
 = 
widthMMR
;

343 
Œa™s
.
lHÜizDPI
 = 
cups_h—d”
.
HWResŞutiÚ
[0];

344 
Œa™s
.
lV”tDPI
 = 
cups_h—d”
.
HWResŞutiÚ
[1];

345 
Œa™s
.
lNumRows
 = 
cups_h—d”
.
cupsHeight
;

346 
Œa™s
.
iNumPages
 = 1;

347 
Œa™s
.
iPageNum
 = 1;

349 
wResuÉ
 = 
	`S‘DeçuÉIÅutT¿™s
 (
hJob
, &
Œa™s
);

350 ià(
wResuÉ
 !ğ
IP_DONE
)

352 
	`BUG
 ("S‘DeçuÉIÅutT¿™ çed: wResuÉ = %x\n", 
wResuÉ
);

353 
wResuÉ
 = 
	`Clo£
 (
hJob
);

354 
BUGOUT
;

356 
dwIÅutAva
 = 
iIÅutBufSize
;

357 
dwOuutAva
 = 
dwIÅutAva
;

359 
wResuÉ
 = 
	`CÚv”t
 (
hJob
, 
dwIÅutAva
, 
pIÅutBuf
, &
dwIÅutU£d
,

360 &
dwIÅutNextPos
, 
dwOuutAva
, 
pbOuutBuf
,

361 &
dwOuutU£d
, &
dwOuutThisPos
);

363 ià(
wResuÉ
 =ğ
IP_FATAL_ERROR
)

365 
	`BUG
 ("CÚv”ˆçed, wResuÉ = %d\n", 
wResuÉ
);

366 
BUGOUT
;

368 ià(
iLogLev–
 > 0)

370 
	`BUG
 ("dwInputAvail = %d dwInputUsed = %d dwOutputUsed = %d\n",

371 
dwIÅutAva
, 
dwIÅutU£d
, 
dwOuutU£d
);

373 
wResuÉ
 = 
	`Clo£
 (
hJob
);

374 
hJob
 = 0;

376 
uiPageNum
++;

378 
p
 = 
szPageH—d”
;

379 
	`HPLIPPUTINT32
 (
p
, 
uiPageNum
);… += 4;

380 
	`HPLIPPUTINT32
 (
p
, 
widthMMR
);… += 4;

381 
	`HPLIPPUTINT32
 (
p
, 
cups_h—d”
.
cupsHeight
);… += 4;

382 
	`HPLIPPUTINT32
 (
p
, 
dwOuutU£d
);… += 4;

383 
	`HPLIPPUTINT32
 (
p
, 0);… += 4;

384 
	`HPLIPPUTINT32
 (
p
, 0);… += 4;

385 
	`wr™e
 (
fdFax
, 
szPageH—d”
, (
p
 - szPageHeader));

386 
	`wr™e
 (
fdFax
, 
pbOuutBuf
, 
dwOuutU£d
);

393 
	`ä“
 (
pbOuutBuf
);

394 
	`ä“
 (
pIÅutBuf
);

395 
	`ä“
 (
pThisSÿnLše
);

396 
pbOuutBuf
 = 
NULL
;

397 
pIÅutBuf
 = 
NULL
;

398 
pThisSÿnLše
 = 
NULL
;

402 
	`l£ek
 (
fdFax
, 9, 
SEEK_SET
);

403 
	`HPLIPPUTINT32
 ((
szFeH—d”
 + 9), 
uiPageNum
);

404 
	`wr™e
 (
fdFax
, 
szFeH—d”
 + 9, 4);

406 
BUGOUT
:

407 ià(
pbOuutBuf
)

409 
	`ä“
 (
pbOuutBuf
);

412 ià(
pIÅutBuf
)

414 
	`ä“
 (
pIÅutBuf
);

417  
¡©us
;

418 
	}
}

425 
	$ProûssTiffD©a
(
äomFD
, 
toFD
, * 
u£r_Çme
)

427 
BYTE
 *
p
;

428 
fdTiff
;

429 
BYTE
 
pTmp
[4096];

430 
timev®
 
tv
;

431 
fd_£t
 
fds
;

432 
·ge_Ëngth
;

433 
·ge_couÁ”
;

434 
cu¼’t_ifd_¡¬t
;

435 *
ifd_off£t
;

436 
Ãxt_ifd_off£t
;

437 
ifd_couÁ
;

438 
boŞ
 
big_’dŸn
 = 
çl£
;

439 
i
, 
»t
, 
Ën
;

440 
BYTE
 
szTiffH—d”
[
TIFF_HDR_SIZE
];

441 
by‹s_wr™‹n
 = 0;

442 
»t_¡©us
 = 0;

443 
by‹s_»ad
 = 0;

444 
hpTiffFeName
[
MAX_FILE_PATH_LEN
];

445 
šput_fe_size
 = 0;

446 
FILE
* 
pFePŒFax
;

447 
	`¢´štf
(
hpTiffFeName
,(hpTiffFeName), "%s/hp_%s_çx_tiffXXXXXX",
CUPS_TMP_DIR
,
u£r_Çme
);

451 
fdTiff
 = 
	`ü—‹TempFe
(
hpTiffFeName
, &
pFePŒFax
);

452 ià(
fdTiff
 < 0)

454 
	`BUG
("ERROR: UÇbËØİ’ Fax ouuˆf- % fÜ wr™šg\n", 
hpTiffFeName
);

458 
	`mem£t
 (
szFeH—d”
, 0,  (szFileHeader));

459 
	`memıy
 (
szFeH—d”
, "hplip_g3", 8);

460 
p
 = 
szFeH—d”
 + 8;

461 *
p
++ = 1;

462 
	`HPLIPPUTINT32
 (
p
, 0);… += 4;

463 
	`HPLIPPUTINT16
 (
p
, 0);… += 2;

464 
	`HPLIPPUTINT16
 (
p
, 0);… += 2;

465 *
p
++ = 
	`©oi
 ("0");

466 *
p
++ = 
	`©oi
 ("0");

467 *
p
++ = 
çx_’codšg
;

468 
p
 += 4;

469 
p
 += 4;

470 
	`wr™e
 (
toFD
, 
szFeH—d”
, (
p
 - szFileHeader));

472 
	`FD_ZERO
(&
fds
);

473 
	`FD_SET
(
äomFD
, &
fds
);

474 
tv
.
tv_£c
 = 0;

475 
tv
.
tv_u£c
 = 100 * 1000;

476 
i
 = 0;

479 
Ën
 = 
	`»ad
 (
äomFD
, 
pTmp
, 4096);

480 ià(
Ën
 > 0) {

481 
	`DBG
("hpcupsçx:„—d %d by‹ äom stdš", 
Ën
);

482 
	`wr™e
 (
fdTiff
, 
pTmp
, 
Ën
);

483 
by‹s_wr™‹n
 +ğ
Ën
;

485 
	`DBG
("hpcupsfax: No data was‡vailable...");

488 
i
++ < 10)

490 
	`mem£t
 (
pTmp
, 0, 4096);

491 
»t
 = 
	`£Ëù
(
äomFD
+1, &
fds
, 
NULL
, NULL, &
tv
);

492 ià(
»t
 < 0) {

493 
	`DBG
("hpcupsfax: Timed out, Continue...");

497 ià(
	`FD_ISSET
(
äomFD
, &
fds
)) {

498 
	`DBG
("hpcupsfax: Data is‡vailable");

500 
	`mem£t
 (
pTmp
, 0, 4096);

501 
Ën
 = 
	`»ad
 (
äomFD
, 
pTmp
, 4096);

502 
	`DBG
("hpcupsçx:„—d %d by‹ äom stdš", 
Ën
);

503 ià(
Ën
 <= 0) {

504 
	`DBG
("hpcupsfax: No data was‡vailable, Continue...");

507 
	`wr™e
 (
fdTiff
, 
pTmp
, 
Ën
);

508 
by‹s_wr™‹n
 +ğ
Ën
;

512 
	`DBG
("hpcupsçx:Ù® by‹ wr™‹ÀtØfdTifài  %d ", 
by‹s_wr™‹n
);

513 
šput_fe_size
 = 
by‹s_wr™‹n
;

515 
»t
 = 
	`l£ek
 (
fdTiff
, 0, 
SEEK_SET
);

516 
	`mem£t
 (
szTiffH—d”
, 0,  (
TIFF_HDR_SIZE
));

517 
»t
 = 
	`»ad
 (
fdTiff
, 
szTiffH—d”
, 8);

518 
	`DBG
("hpcupsçx:„—d %d by‹ äom fdTiff", 
»t
);

519 
ifd_off£t
 = (*è&(
szTiffH—d”
[4]);

520 ià(
szTiffH—d”
[0] == 'M') {

521 
	`DBG
("hpcupsfax: it is bigƒndian");

522 
big_’dŸn
 = 
Œue
;

523 *
ifd_off£t
 = 
	`Áohl
(*ifd_offset);

525 
	`DBG
("hpcupsçx: ifd_off£ˆi %d", *
ifd_off£t
);

527 
cu¼’t_ifd_¡¬t
 = 0;

528 
·ge_couÁ”
 = 0;

529 
by‹s_wr™‹n
 = 0;

533 
»t
 = 
	`l£ek
 (
fdTiff
, *
ifd_off£t
, 
SEEK_SET
);

534 
»t
 = 
	`»ad
 (
fdTiff
, &
ifd_couÁ
, 2);

535 ià(
big_’dŸn
) {

536 
ifd_couÁ
 = 
	`Áohs
(ifd_count);

538 
	`DBG
("hpcupsçx:„—d %d by‹ äom fdTiff; ifd couÁ i %d", 
»t
, 
ifd_couÁ
);

541 
»t
 = 
	`l£ek
 (
fdTiff
, (*
ifd_off£t
+2+((
ifd_couÁ
)*12)), 
SEEK_SET
);

542 
»t
 = 
	`»ad
 (
fdTiff
, &
Ãxt_ifd_off£t
, 4);

543 ià(
big_’dŸn
) {

544 
Ãxt_ifd_off£t
 = 
	`Áohs
(next_ifd_offset);

546 
	`DBG
("hpcupsfax:„ead %d bytes from fdTiff‡t %d;‚ext ifd offset is %d",

547 
»t
, (*
ifd_off£t
+2+((
ifd_couÁ
)*12)), 
Ãxt_ifd_off£t
);

550 
·ge_couÁ”
 =…age_counter + 1;

551 
	`DBG
("hpcupsçx: Cu¼’ˆ·ge_couÁ” i %d", 
·ge_couÁ”
);

554 
·ge_Ëngth
 = 
Ãxt_ifd_off£t
-
cu¼’t_ifd_¡¬t
;

555 
	`DBG
("hpcupsçx:…age_Ëngth i %d ", 
·ge_Ëngth
);

556 ià(
·ge_Ëngth
 <= 0) {

557 
Ën
 = 
	`l£ek
 (
fdTiff
, 0, 
SEEK_END
);

558 
·ge_Ëngth
 = 
Ën
 - 
cu¼’t_ifd_¡¬t
;

560 
	`DBG
("hpcupsçx: cu¼’t_ifd_¡¬t=%d‚ext_ifd_off£t=%dÙ® by‹ ¬%d", 
cu¼’t_ifd_¡¬t
, 
Ãxt_ifd_off£t
, 
·ge_Ëngth
);

563 
p
 = 
szPageH—d”
;

564 
	`HPLIPPUTINT32
 (
p
, 
·ge_couÁ”
);… += 4;

565 
	`HPLIPPUTINT32
 (
p
, 0);… += 4;

566 
	`HPLIPPUTINT32
 (
p
, 0);… += 4;

567 
	`HPLIPPUTINT32
 (
p
, 
·ge_Ëngth
);… += 4;

568 
	`HPLIPPUTINT32
 (
p
, 0);… += 4;

569 
	`HPLIPPUTINT32
 (
p
, 0);… += 4;

570 
»t
 = 
	`wr™e
 (
toFD
, 
szPageH—d”
, (
p
 - szPageHeader));

572 
»t
 = 
	`l£ek
 (
fdTiff
, 
cu¼’t_ifd_¡¬t
, 
SEEK_SET
);

573 
·ge_Ëngth
 > 0) {

574 ià(
·ge_Ëngth
 < 4096) {

575 
Ën
 = 
·ge_Ëngth
;

577 
Ën
 = 4096;

579 
by‹s_»ad
 = 
	`»ad
 (
fdTiff
, 
pTmp
, 
Ën
);

580 
»t
 = 
	`wr™e
 (
toFD
, 
pTmp
, 
by‹s_»ad
);

581 
·ge_Ëngth
 =…age_Ëngth - 
»t
;

582 
by‹s_wr™‹n
 +ğ
»t
;

586 ià(
by‹s_wr™‹n
 > 
šput_fe_size
) {

587 
	`BUG
("Error!! Bytes writtenooFD is becoming morehan input file size.");

588 
»t_¡©us
 = -1;

592 ià(
Ãxt_ifd_off£t
 == 0) {

595 
cu¼’t_ifd_¡¬t
 = *
ifd_off£t
 = 
Ãxt_ifd_off£t
;

598 
	`l£ek
 (
toFD
, 9, 
SEEK_SET
);

599 
	`HPLIPPUTINT32
 ((
szFeH—d”
 + 9), 
·ge_couÁ”
);

600 
	`wr™e
 (
toFD
, 
szFeH—d”
 + 9, 4);

602 ià(!(
iLogLev–
 & 
SAVE_PCL_FILE
))

604 
	`uÆšk
(
hpTiffFeName
);

606  
»t_¡©us
;

607 
	}
}

610 
	$£nd_d©a_to_¡dout
(
äomFD
)

612 
iSize
, 
i
;

613 
Ën
;

614 
BYTE
 *
pTmp
 = 
NULL
;

616 
iSize
 = 
	`l£ek
 (
äomFD
, 0, 
SEEK_END
);

617 
	`l£ek
 (
äomFD
, 0, 
SEEK_SET
);

619 
	`DBG
("hpcupsçx:†£ek(äomFDè»tuºed %d", 
iSize
);

620 ià(
iSize
 > 0)

622 
pTmp
 = (
BYTE
 *è
	`m®loc
 (
iSize
);

624 ià(
pTmp
 =ğ
NULL
)

626 
iSize
 = 1024;

627 
pTmp
 = (
BYTE
 *è
	`m®loc
 (
iSize
);

628 ià(
pTmp
 =ğ
NULL
)

634 (
Ën
 = 
	`»ad
 (
äomFD
, 
pTmp
, 
iSize
)) > 0)

636 
	`wr™e
 (
STDOUT_FILENO
, 
pTmp
, 
Ën
);

638 
	`ä“
 (
pTmp
);

641 
	}
}

643 
	$maš
 (
¬gc
, **
¬gv
)

645 
¡©us
 = 0;

646 
fd
 = 0;

647 
fdFax
 = -1;

648 
i
 = 0;

649 
FILE
 *
pFePŒFax
;

650 
cups_¿¡”_t
 *
cups_¿¡”
;

651 
µd_fe_t
 *
µd
;

652 
µd_©Œ_t
 *
©Œ
;

653 
µd_©Œ_t
 *
com´essiÚ_©Œ
;

657 
	`G‘LogLev–
();

658 
	`İ’log
("hpcupsçx", 
LOG_PID
, 
LOG_DAEMON
);

660 ià(
¬gc
 < 6 ||‡rgc > 7)

662 
	`BUG
 ("ERROR: % job-id u£¸t™Ë cİ› İtiÚ [fe]\n", *
¬gv
);

666 ià(
¬gc
 == 7)

668 ià((
fd
 = 
	`İ’
 (
¬gv
[6], 
O_RDONLY
)) == -1)

670 
	`BUG
 ("ERROR: UÇbËØİ’„a¡” f%s\n", 
¬gv
[6]);

675 
¬gv
[
i
] !ğ
NULL
) {

676 
	`DBG
("hpcupsçx:‡rgv[%d] = %s\n", 
i
, 
¬gv
[i]);

677 
i
++;

680 
	`¢´štf
(
hpFeName
,(hpFeName),"%s/hp_%s_çx_Log_XXXXXX",
CUPS_TMP_DIR
, 
¬gv
[2]);

683 
fdFax
 = 
	`ü—‹TempFe
(
hpFeName
, &
pFePŒFax
);

684 ià(
fdFax
 < 0)

686 
	`BUG
 ("ERROR: UÇbËØİ’ Fax ouuˆf- % fÜ wr™šg\n", 
hpFeName
);

690 
	`chmod
(
hpFeName
, 
S_IRUSR
 | 
S_IWUSR
 | 
S_IRGRP
 | 
S_IWGRP
 );

694 
µd
 = 
	`µdO³nFe
 (
	`g‘’v
 ("PPD"));

695 ià(
µd
 =ğ
NULL
)

697 
	`BUG
 ("ERROR: UÇbËØİ’…pd f%s\n", 
	`g‘’v
 ("PPD"));

700 ià((
©Œ
 = 
	`µdFšdA‰r
 (
µd
, "cupsMod–Name", 
NULL
)) == NULL ||

701 (
©Œ
 &&‡‰r->
v®ue
 =ğ
NULL
))

703 
	`µdClo£
 (
µd
);

704 
	`BUG
 ("ERROR: Required cupsModelName is missing in…pd file\n");

708 
	`mem£t
 (
deviû_Çme
, 0,  (device_name));

709 
	`¡ºıy
 (
deviû_Çme
, 
©Œ
->
v®ue
, 15);

711 ià((
©Œ
 = 
	`µdFšdA‰r
 (
µd
, "DeçuÉEncodšg", 
NULL
)) == NULL ||

712 (
©Œ
 &&‡‰r->
v®ue
 =ğ
NULL
))

714 
	`µdClo£
 (
µd
);

715 
	`BUG
 ("ERROR: Required DefaultEncoding is missing in…pd file\n");

718 ià(
	`¡r¡r
(
¬gv
[5],"Encoding=MMR"))

720 
çx_’codšg
 = 
RASTER_MMR
;

722 if(
	`¡r¡r
(
¬gv
[5],"Encoding=MH"))

724 
çx_’codšg
 = 
RASTER_MH
;

726 ià(
	`¡r¡r
(
¬gv
[5],"Encoding=Auto"))

728 
	`BUG
 ("WARNING: AUTO is selected for Fax Encoding! Ensurehisype is correct forhe device");

729 
çx_’codšg
 = 
RASTER_AUTO
;

731 ià(
	`¡r¡r
(
¬gv
[5],"Encoding=TIFF"))

733 
çx_’codšg
 = 
RASTER_TIFF
;

737 if(
	`¡rcmp
(
©Œ
->
v®ue
,"MH") == 0) {

738 
çx_’codšg
 = 
RASTER_MH
;

739 } if(
	`¡rcmp
(
©Œ
->
v®ue
,"MMR") == 0){

740 
çx_’codšg
 = 
RASTER_MMR
;

741 }if(
	`¡rcmp
(
©Œ
->
v®ue
,"TIFF") ==0){

742 
çx_’codšg
 = 
RASTER_TIFF
;

743 }if(
	`¡rcmp
(
©Œ
->
v®ue
,"Auto") ==0){

744 
	`BUG
 ("WARNING: AUTO is selected for Fax Encoding! Ensurehisype is correct forhe device");

745 
çx_’codšg
 = 
RASTER_AUTO
;

748 ià(
çx_’codšg
 < 0) {

749 
	`BUG
 ("ERROR: Required DefaultEncoding is invalid in…pd file\n");

752 
	`DBG
("hpcupsçx: maš: fax_’codšg = %d \n", 
çx_’codšg
);

753 
	`µdClo£
 (
µd
);

755 ià(
çx_’codšg
 =ğ
RASTER_TIFF
)

757 
¡©us
 = 
	`ProûssTiffD©a
(
fd
, 
fdFax
, 
¬gv
[2]);

759 
cups_¿¡”
 = 
	`cupsRa¡”O³n
 (
fd
, 
CUPS_RASTER_READ
);

760 ià(
cups_¿¡”
 =ğ
NULL
)

762 
¡©us
 = 1;

763 
	`BUG
 ("cupsRa¡”O³Àçed, fd = %d\n", 
fd
);

764 
EPILOGUE
;

767 
¡©us
 = 
	`ProûssRa¡”D©a
 (
cups_¿¡”
, 
fdFax
);

769 
	`cupsRa¡”Clo£
 (
cups_¿¡”
);

772 
	`DBG
("hpcupsfax: Send datao stdout \n");

773 
¡©us
 = 
	`£nd_d©a_to_¡dout
(
fdFax
);

776 
EPILOGUE
:

777 ià(
fd
 != 0)

779 
	`şo£
 (
fd
);

782 ià(
fdFax
 > 0)

784 
	`şo£
 (
fdFax
);

785 ià(!(
iLogLev–
 & 
SAVE_PCL_FILE
))

788 
	`uÆšk
(
hpFeName
);

792  
¡©us
;

793 
	}
}

	@prnt/hpijs/hpcupsfax.h

32 #iâdeà
HPCUPSFAX_H


33 
	#HPCUPSFAX_H


	)

34 
	~<cups/µd.h
>

39 
	#RASTER_BITMAP
 0

	)

40 
	#RASTER_GRAYMAP
 1

	)

41 
	#RASTER_MH
 2

	)

42 
	#RASTER_MR
 3

	)

43 
	#RASTER_MMR
 4

	)

44 
	#RASTER_RGB
 5

	)

45 
	#RASTER_YCC411
 6

	)

46 
	#RASTER_JPEG
 7

	)

47 
	#RASTER_PCL
 8

	)

48 
	#RASTER_NOT
 9

	)

49 
	#RASTER_TIFF
 10

	)

50 
	#RASTER_AUTO
 99

	)

52 
	#HPLIPFAX_MONO
 1

	)

53 
	#HPLIPFAX_COLOR
 2

	)

55 
	#HPLIPPUTINT32
(
by‹¬r
, 
v®
) \

56 
by‹¬r
[0] = (
v®
 & 0xFF000000) >> 24; \

57 
by‹¬r
[1] = (
v®
 & 0x00FF0000) >> 16; \

58 
by‹¬r
[2] = (
v®
 & 0x0000FF00) >> 8; \

59 
by‹¬r
[3] = (
v®
 & 0x000000FF)

	)

61 
	#HPLIPPUTINT16
(
by‹¬r
, 
v®
) \

62 
by‹¬r
[0] = (
v®
 & 0x0000FF00) >> 8; \

63 
by‹¬r
[1] = (
v®
 & 0x000000FF)

	)

	@prnt/hpijs/hpijs.cpp

32 
	~<sys/¡©.h
>

33 
	~<¡dio.h
>

34 
	~<¡dlib.h
>

35 
	~<¡d¬g.h
>

36 
	~<sy¦og.h
>

37 
	~<¡ršg.h
>

38 
	~<uni¡d.h
>

39 
	~<fú.h
>

40 
	~"h—d”.h
"

41 
	~"ijs.h
"

42 
	~"ijs_£rv”.h
"

43 
	~"hpijs.h
"

44 
	~"£rviûs.h
"

45 
	~"uts.h
"

47 
S’dDbusMes§ge
 (cÚ¡ *
dev
, cÚ¡ *
´š‹r
, 
code
,

48 cÚ¡ *
u£ºame
, cÚ¡ 
jobid
, cÚ¡ *
t™Ë
);

50 #ifdeà
HAVE_LIBHPIP


51 
hpijsFaxS”v”
 (
¬gc
, **
¬gv
);

55 
	$bug
(cÚ¡ *
fmt
, ...)

57 
buf
[256];

58 
va_li¡
 
¬gs
;

59 
n
;

61 
	`va_¡¬t
(
¬gs
, 
fmt
);

63 ià((
n
 = 
	`v¢´štf
(
buf
, 256, 
fmt
, 
¬gs
)) == -1)

64 
buf
[255] = 0;

66 
	`årštf
(
¡d”r
, 
buf
);

67 
	`sy¦og
(
LOG_WARNING
, 
buf
);

69 
	`fæush
(
¡d”r
);

70 
	`va_’d
(
¬gs
);

71  
n
;

72 
	}
}

75 
	$£tLogLev–
(
UXS”viûs
 *
pSS
, *
u£r_Çme
)

77 
FILE
 *
å
;

78 
¡r
[258];

79 *
p
;

80 
å
 = 
	`fİ’
 ("/etc/cups/cupsd.conf", "r");

81 ià(
å
 =ğ
NULL
)

83 !
	`ãof
 (
å
))

85 ià(!
	`fg‘s
 (
¡r
, 256, 
å
))

89 ià((
p
 = 
	`¡r¡r
 (
¡r
, "hpLogLevel")))

91 
p
 +ğ
	`¡¾’
 ("hpLogLevel") + 1;

92 
pSS
->
m_iLogLev–
 = 
	`©oi
 (
p
);

96 
	`fşo£
 (
å
);

98 ià(
pSS
->
m_iLogLev–
 & 
SAVE_PCL_FILE
)

100 
szFeName
[
MAX_FILE_PATH_LEN
];

101 
	`¢´štf
 (
szFeName
,(szFeName), "%s/hp_%s_ijs_%d_XXXXXX", 
CUPS_TMP_DIR
, 
u£r_Çme
, 
	`g‘pid
());

102 
	`ü—‹TempFe
(
szFeName
, &
pSS
->
outå
);

105 ià(
pSS
->
outå
)

107 
	`chmod
 (
szFeName
, 
S_IRUSR
 | 
S_IWUSR
 | 
S_IRGRP
 | 
S_IROTH
);

110 
	}
}

113 
	$hpijs_£t_cÚ‹xt
(
UXS”viûs
 *
pSS
)

115 
r
;

117 ià(
pSS
->
P’S‘
 !ğ
DUMMY_PEN
)

119 ià((
r
 = 
pSS
->
pPC
->
	`S‘P’S‘
((
PEN_TYPE
íSS->
P’S‘
)è!ğ
NO_ERROR
)

120 
	`BUG
("uÇbËØS‘P’S‘ s‘=%d,ƒ¼=%d\n", 
pSS
->
P’S‘
, 
r
);

123 ià((
r
 = 
pSS
->
pPC
->
	`S–eùPrštMode
((
QUALITY_MODE
íSS->
Qu®™y
, (
MEDIATYPE
íSS->
MedŸTy³
, (
COLORMODE
íSS->
CŞÜMode
)è!ğ
NO_ERROR
)

125 
BOOL
 
bDevText
;

126 
	`BUG
("uÇbËØ£ˆQu®™y=%d, CŞÜMode=%d, MedŸTy³=%d,ƒ¼=%d\n", 
pSS
->
Qu®™y
,…SS->
CŞÜMode
,…SS->
MedŸTy³
, 
r
);

127 
pSS
->
pPC
->
	`G‘PrštModeS‘tšgs
((
QUALITY_MODE
 &íSS->
Qu®™y
, (
MEDIATYPE
 &íSS->
MedŸTy³
, (
COLORMODE
 &íSS->
CŞÜMode
, 
bDevText
);

128 
	`BUG
("fŞlowšg wÈbu£d Qu®™y=%d, CŞÜMode=%d, MedŸTy³=%d\n", 
pSS
->
Qu®™y
,…SS->
CŞÜMode
,…SS->
MedŸTy³
);

132 
pSS
->
	`M­P­”Size
ÕSS->
P­”Width
,…SS->
P­”Height
);

135 ià(
pSS
->
Du¶ex
 && !pSS->
TumbË
)

137 ià(
pSS
->
pPC
->
	`S–eùDu¶exPrštšg
(
DUPLEXMODE_BOOK
è!ğ
TRUE
)

138 
	`BUG
("unableo set duplex mode=book\n");

140 ià(
pSS
->
Du¶ex
 &&…SS->
TumbË
)

142 ià(
pSS
->
pPC
->
	`S–eùDu¶exPrštšg
(
DUPLEXMODE_TABLET
è!ğ
TRUE
)

143 
	`BUG
("unableo set duplex mode=tablet\n");

147 
pSS
->
pPC
->
	`S–eùDu¶exPrštšg
(
DUPLEXMODE_NONE
);

150 ià(
pSS
->
MedŸPos™iÚ
 !ğ
sourûT¿yAuto
)

152 ià(
pSS
->
pPC
->
	`S‘MedŸSourû
((
MedŸSourû
íSS->
MedŸPos™iÚ
è!ğ
NO_ERROR
)

153 
	`BUG
("uÇbËØ£ˆMedŸPos™iÚ=%d\n", 
pSS
->
MedŸPos™iÚ
);

157 
	}
}

159 
	$hpijs_¡©us_cb
(*
¡©us_cb_d©a
, 
IjsS”v”Ctx
 *
ùx
, 
IjsJobId
 
job_id
)

162 
	}
}

164 
	$hpijs_li¡_cb
(*
li¡_cb_d©a
, 
IjsS”v”Ctx
 *
ùx
, 
IjsJobId
 
job_id
,

165 *
v®_buf
, 
v®_size
)

167  
	`¢´štf
(
v®_buf
, 
v®_size
, "OutputFD,DeviceManufacturer,DeviceModel,PageImageFormat,Dpi,Width,Height,BitsPerSample,ColorSpace,PaperSize,PrintableArea,PrintableTopLeft,DryTime,PS:Duplex,PS:Tumble,Quality:Quality,Quality:MediaType,Quality:ColorMode,Quality:PenSet,Quality:FullBleed,PS:MediaPosition");

168 
	}
}

170 
	$hpijs_’um_cb
(*
’um_cb_d©a
, 
IjsS”v”Ctx
 *
ùx
, 
IjsJobId
 
job_id
,

171 cÚ¡ *
key
, *
v®_buf
, 
v®_size
)

173 
UXS”viûs
 *
pSS
 = (UXS”viûs*)
’um_cb_d©a
;

175 ià(!
	`¡rcmp
 (
key
, "ColorSpace"))

177 ià(
pSS
->
pPC
->
	`SuµÜtS•¬©eBÏck
())

178  
	`¢´štf
(
v®_buf
, 
v®_size
, "sRGB,KRGB");

180  
	`¢´štf
(
v®_buf
, 
v®_size
, "sRGB");

182 ià(!
	`¡rcmp
 (
key
, "DeviceManufacturer"))

183  
	`¢´štf
(
v®_buf
, 
v®_size
, "HEWLETT-PACKARD,APOLLO,HP");

184 ià(!
	`¡rcmp
 (
key
, "PageImageFormat"))

185  
	`¢´štf
(
v®_buf
, 
v®_size
, "Raster");

186 ià(!
	`¡rcmp
 (
key
, "BitsPerSample"))

187  
	`¢´štf
(
v®_buf
, 
v®_size
, "8");

188 ià(!
	`¡rcmp
 (
key
, "PS:Duplex"))

190 ià(
pSS
->
pPC
->
	`S–eùDu¶exPrštšg
(
DUPLEXMODE_BOOK
è=ğ
TRUE
)

191  
	`¢´štf
(
v®_buf
, 
v®_size
, "true");

193  
	`¢´štf
(
v®_buf
, 
v®_size
, "false");

194 
pSS
->
pPC
->
	`S–eùDu¶exPrštšg
(
DUPLEXMODE_NONE
);

196 ià(!
	`¡rcmp
 (
key
, "PS:Tumble"))

198 ià(
pSS
->
pPC
->
	`S–eùDu¶exPrštšg
(
DUPLEXMODE_TABLET
è=ğ
TRUE
)

199  
	`¢´štf
(
v®_buf
, 
v®_size
, "true");

201  
	`¢´štf
(
v®_buf
, 
v®_size
, "false");

202 
pSS
->
pPC
->
	`S–eùDu¶exPrštšg
(
DUPLEXMODE_NONE
);

205 
	`BUG
("uÇbËØ’um key=%s\n", 
key
);

206  
IJS_ERANGE
;

207 
	}
}

213 
	$hpijs_£t_cb
 (*
£t_cb_d©a
, 
IjsS”v”Ctx
 *
ùx
, 
IjsJobId
 
job_id
,

214 cÚ¡ *
key
, cÚ¡ *
v®ue
, 
v®ue_size
)

216 
UXS”viûs
 *
pSS
 = (UXS”viûs*)
£t_cb_d©a
;

217 
fd
, 
r
;

218 *

;

219 
¡©us
 = 0;

220 
sv®ue
[
IJS_MAX_PARAM
+1];

221 
w
, 
h
, 
dx
, 
dy
;

222 
iV®
;

225 ià(
v®ue_size
 > 
IJS_MAX_PARAM
)

227 
	`memıy
(
sv®ue
, 
v®ue
, 
IJS_MAX_PARAM
);

228 
sv®ue
[
IJS_MAX_PARAM
] = 0;

232 
	`memıy
(
sv®ue
, 
v®ue
, 
v®ue_size
);

233 
sv®ue
[
v®ue_size
] = 0;

236 ià(!
	`¡rcmp
 (
key
, "OutputFD"))

238 
fd
 = 
	`¡¹Ş
(
sv®ue
, &

, 10);

239 
pSS
->
OuutP©h
 = 
fd
;

241 ià(!
	`¡rcmp
 (
key
, "DeviceManufacturer"))

243 ià((
	`¡ºÿ£cmp
(
sv®ue
, "HEWLETT-PACKARD", 15) != 0) &&

244 (
	`¡ºÿ£cmp
(
sv®ue
, "APOLLO", 6) != 0) && (strncasecmp(svalue, "HP", 2) != 0))

246 
	`BUG
("uÇbËØ£ˆDeviûMªuçùu»r=%s\n", 
sv®ue
);

247 
¡©us
 = -1;

250 ià(!
	`¡rcmp
 (
key
, "DeviceModel"))

252 ià((
r
 = 
pSS
->
pPC
->
	`S–eùDeviû
(
sv®ue
)è!ğ
NO_ERROR
)

254 ià(
r
 =ğ
PLUGIN_LIBRARY_MISSING
)

257 cÚ¡ *
u£r_Çme
 = " ";

258 cÚ¡ *
t™Ë
 = " ";

259 cÚ¡ *
deviû_uri
 = 
	`g‘’v
 ("DEVICE_URI");

260 cÚ¡ *
´š‹r
 = 
	`g‘’v
 ("PRINTER");

261 
job_id
 = 0;

263 ià(
deviû_uri
 =ğ
NULL
)

264 
deviû_uri
 = "";

265 ià(
´š‹r
 =ğ
NULL
)

266 
´š‹r
 = "";

268 
	`S’dDbusMes§ge
 (
deviû_uri
, 
´š‹r
,

269 
EVENT_PRINT_FAILED_MISSING_PLUGIN
,

270 
u£r_Çme
, 
job_id
, 
t™Ë
);

271 
	`BUG
("uÇbËØ£ˆdeviû=%s,ƒ¼=%d\n", 
sv®ue
, 
r
);

272 
¡©us
 = -1;

277 ià(!
	`¡ºcmp
(
sv®ue
,"OfficeJet", 10))

278 
r
 = 
pSS
->
pPC
->
	`S–eùDeviû
("DESKJET 540");

282 ià(
r
 =ğ
NO_ERROR
)

284 
pSS
->
Mod–
 = 1;

287 
BOOL
 
bDevText
;

288 
pSS
->
pPC
->
	`G‘PrštModeS‘tšgs
((
QUALITY_MODE
 &íSS->
Qu®™y
, (
MEDIATYPE
 &íSS->
MedŸTy³
, (
COLORMODE
 &íSS->
CŞÜMode
, 
bDevText
);

292 
	`BUG
("uÇbËØ£ˆdeviû=%s,ƒ¼=%d\n", 
sv®ue
, 
r
);

293 
¡©us
 = -1;

296 ià((
	`¡rcmp
 (
key
, "PS:Duplex") == 0) || (strcmp (key, "Duplex") == 0))

298 ià(
	`¡ºcmp
(
sv®ue
, "true", 4) == 0)

299 
pSS
->
Du¶ex
 = 1;

301 
pSS
->
Du¶ex
 = 0;

303 ià((
	`¡rcmp
 (
key
, "PS:Tumble") == 0) || (strcmp (key, "Tumble") == 0))

305 ià(
	`¡ºcmp
(
sv®ue
, "true", 4) == 0)

306 
pSS
->
TumbË
 = 1;

308 
pSS
->
TumbË
 = 0;

310 ià(!
	`¡rcmp
 (
key
, "PaperSize"))

312 
w
 = ()
	`¡¹od
(
sv®ue
, &

);

313 
h
 = ()
	`¡¹od
(

+1, &tail);

315 ià(
pSS
->
Fœ¡Ra¡”
)

318 
pSS
->
P­”Width
 = 
w
;

319 
pSS
->
P­”Height
 = 
h
;

320 
	`hpijs_£t_cÚ‹xt
(
pSS
);

325 
dx
 = 
w
 > 
pSS
->
P­”Width
 ? w -…SS->PaperWidth :…SS->PaperWidth - w;

326 
dy
 = 
h
 > 
pSS
->
P­”Height
 ? h -…SS->PaperHeight :…SS->PaperHeight - h;

329 ià((
dx
 > 0.25è|| (
dy
 > 0.25))

331 
pSS
->
Fœ¡Ra¡”
 = 1;

332 
pSS
->
P­”Width
 = 
w
;

333 
pSS
->
P­”Height
 = 
h
;

334 
	`hpijs_£t_cÚ‹xt
(
pSS
);

338 ià(!
	`¡rcmp
 (
key
, "TopLeft"))

342 ià(!
	`¡rcmp
 (
key
, "Quality:Quality"))

344 
pSS
->
Qu®™y
 = (
QUALITY_MODE
è
	`¡¹Ş
(
sv®ue
, &

, 10);

346 ià(!
	`¡rcmp
 (
key
, "Quality:MediaType"))

348 
pSS
->
MedŸTy³
 = (
MEDIATYPE
è
	`¡¹Ş
(
sv®ue
, &

, 10);

350 ià(!
	`¡rcmp
 (
key
, "Quality:ColorMode"))

352 
pSS
->
CŞÜMode
 = (
COLORMODE
è
	`¡¹Ş
(
sv®ue
, &

, 10);

354 ià(!
	`¡rcmp
 (
key
, "Quality:PenSet"))

356 
pSS
->
P’S‘
 = (
PEN_TYPE
è
	`¡¹Ş
(
sv®ue
, &

, 10);

358 ià(!
	`¡rcmp
 (
key
, "Quality:FullBleed"))

360 
pSS
->
FuÎBËed
 = 
	`¡¹Ş
(
sv®ue
, &

, 10);

362 ià(!
	`¡rcmp
 (
key
, "PS:MediaPosition"))

364 
pSS
->
MedŸPos™iÚ
 = 
	`¡¹Ş
(
sv®ue
, &

, 10);

366 ià(!
	`¡rcmp
 (
key
, "DryTime"))

368 
iV®
 = 
	`¡¹Ş
 (
sv®ue
, &

, 10);

369 
pSS
->
pPC
->
	`S‘Prš‹rHšt
 (
EXTRA_DRYTIME_HINT
, 
iV®
);

371 ià(!
	`¡rcmp
 (
key
, "RedEye"))

373 
iV®
 = 
	`¡¹Ş
 (
sv®ue
, &

, 10);

374 
pSS
->
pPC
->
	`S‘Prš‹rHšt
 (
RED_EYE_REMOVAL_HINT
, 
iV®
);

376 ià(!
	`¡rcmp
 (
key
, "PhotoFix"))

378 
iV®
 = 
	`¡¹Ş
 (
sv®ue
, &

, 10);

379 
pSS
->
pPC
->
	`S‘Prš‹rHšt
 (
PHOTO_FIX_HINT
, 
iV®
);

381 ià(!
	`¡rcmp
 (
key
, "MaxJpegFileSize"))

383 
iV®
 = 
	`¡¹Ş
 (
sv®ue
, &

, 10);

384 
pSS
->
pPC
->
	`S‘Prš‹rHšt
 (
MAX_FILE_SIZE_HINT
, 
iV®
);

386 ià(!
	`¡rcmp
 (
key
, "Qu®™y:S³edMech"è&& !
pSS
->
Du¶ex
)

388 
pSS
->
pPC
->
	`S‘Prš‹rHšt
 (
PAGES_IN_DOC_HINT
, 512);

389 
pSS
->
	`EÇbËS³edMech
 (
TRUE
);

391 ià(!
	`¡rcmp
 (
key
, "Quality:MediaSubtype"))

393 
iV®
 = 
	`¡¹Ş
 (
sv®ue
, &

, 10);

394 
pSS
->
pPC
->
	`S‘MedŸSubty³
 (
iV®
);

397 ià(!
	`¡rcmp
 (
key
, "Margin:TopPadding"))

399 
iV®
 = 
	`¡¹Ş
 (
sv®ue
, &

, 10);

400 
pSS
->
pPC
->
	`S‘MechOff£t
 (
iV®
);

402 ià(!
	`¡rcmp
 (
key
, "Overspray:Left"))

404 
iV®
 = 
	`¡¹Ş
 (
sv®ue
, &

, 10);

405 
pSS
->
pPC
->
	`S‘Prš‹rHšt
 (
LEFT_OVERSPRAY_HINT
, 
iV®
);

407 ià(!
	`¡rcmp
 (
key
, "Overspray:Top"))

409 
iV®
 = 
	`¡¹Ş
 (
sv®ue
, &

, 10);

410 
pSS
->
pPC
->
	`S‘Prš‹rHšt
 (
TOP_OVERSPRAY_HINT
, 
iV®
);

412 ià(!
	`¡rcmp
 (
key
, "Overspray:Right"))

414 
iV®
 = 
	`¡¹Ş
 (
sv®ue
, &

, 10);

415 
pSS
->
pPC
->
	`S‘Prš‹rHšt
 (
RIGHT_OVERSPRAY_HINT
, 
iV®
);

417 ià(!
	`¡rcmp
 (
key
, "Overspray:Bottom"))

419 
iV®
 = 
	`¡¹Ş
 (
sv®ue
, &

, 10);

420 
pSS
->
pPC
->
	`S‘Prš‹rHšt
 (
BOTTOM_OVERSPRAY_HINT
, 
iV®
);

423 
	`BUG
("uÇbËØ£ˆkey=%s, v®ue=%s\n", 
key
, 
sv®ue
);

425  
¡©us
;

426 
	}
}

429 
	$hpijs_g‘_cb
(*
g‘_cb_d©a
, 
IjsS”v”Ctx
 *
ùx
, 
IjsJobId
 
job_id
, cÚ¡ *
key
, *
v®ue_buf
, 
v®ue_size
)

431 
UXS”viûs
 *
pSS
 = (UXS”viûs*)
g‘_cb_d©a
;

432 
fX
;

433 
fY
;

435 ià(!
	`¡rcmp
 (
key
, "PrintableArea"))

437 
fY
 = 
pSS
->
pPC
->
	`PršbËHeight
 ();

439 ià((
pSS
->
pPC
->
	`Qu”yDu¶exMode
(è!ğ
DUPLEXMODE_NONE
è&&…SS->pPC->
	`RÙ©eImageFÜBackPage
(è&& (
FALSE
 =ğpSS->pPC->
	`IsBÜd”Ëss
()))

447 ià((
pSS
->
pPC
->
	`PršbËHeight
 (è+ 0.28è<…SS->pPC->
	`PhysiÿlPageSizeY
 ())

449 
fY
 = 
pSS
->
pPC
->
	`PhysiÿlPageSizeY
 () - 1.0;

452 
fY
 = 
pSS
->
pPC
->
	`PhysiÿlPageSizeY
 () - 1.0;

455 ià(
pSS
->
pPC
->
	`PhysiÿlPageSizeY
 () > 18.0)

457 
fY
 = 1.5;

467 ià((
fX
 = 
pSS
->
pPC
->
	`PršbËWidth
 ()è>…SS->
P­”Width
)

469 
fX
 = 
pSS
->
P­”Width
;

470 
fY
 = 
pSS
->
P­”Height
;

473  (
	`¢´štf
 (
v®ue_buf
, 
v®ue_size
, "%.4fx%.4f", 
fX
, 
fY
));

475 ià(!
	`¡rcmp
 (
key
, "PrintableTopLeft"))

477 
fY
 = 
pSS
->
pPC
->
	`PršbËS¹Y
 ();

479 ià((
pSS
->
pPC
->
	`Qu”yDu¶exMode
(è!ğ
DUPLEXMODE_NONE
è&&…SS->pPC->
	`RÙ©eImageFÜBackPage
(è&& (
FALSE
 =ğpSS->pPC->
	`IsBÜd”Ëss
()))

482 ià((
pSS
->
pPC
->
	`PršbËHeight
 (è+ 0.28è<…SS->pPC->
	`PhysiÿlPageSizeY
 ())

484 
fY
 = 0.5;

487 
fY
 = 0.5;

489 ià(
pSS
->
pPC
->
	`PhysiÿlPageSizeY
 () > 18.0)

491 
fY
 = 0.75;

496  
	`¢´štf
 (
v®ue_buf
, 
v®ue_size
, "%.4fx%.4f", 
pSS
->
pPC
->
	`PršbËS¹X
 (), 
fY
);

498 ià((!
	`¡rcmp
 (
key
, "Duplex")) || (!strcmp (key, "PS:Duplex")))

500 ià(
pSS
->
pPC
->
	`Qu”yDu¶exMode
(è=ğ
DUPLEXMODE_NONE
)

501  
	`¢´štf
(
v®ue_buf
, 
v®ue_size
, "false");

503  
	`¢´štf
(
v®ue_buf
, 
v®ue_size
, "true");

505 ià((!
	`¡rcmp
 (
key
, "Tumble")) || (!strcmp (key, "PS:Tumble")))

507 ià(
pSS
->
pPC
->
	`Qu”yDu¶exMode
(è=ğ
DUPLEXMODE_TABLET
)

508  
	`¢´štf
(
v®ue_buf
, 
v®ue_size
, "true");

510  
	`¢´štf
(
v®ue_buf
, 
v®ue_size
, "false");

512 ià(!
	`¡rcmp
 (
key
, "PaperSize"))

514  
	`¢´štf
(
v®ue_buf
, 
v®ue_size
, "%.4fx%.4f", 
pSS
->
pPC
->
	`PhysiÿlPageSizeX
(),…SS->pPC->
	`PhysiÿlPageSizeY
());

516 ià(!
	`¡rcmp
 (
key
, "Dpi"))

518  
	`¢´štf
(
v®ue_buf
, 
v®ue_size
, "%dx%d", 
pSS
->
pPC
->
	`EfãùiveResŞutiÚX
(),…SS->pPC->
	`EfãùiveResŞutiÚY
());

520 ià(!
	`¡rcmp
 (
key
, "DeviceModel"))

522  
	`¢´štf
(
v®ue_buf
, 
v®ue_size
, "%s", 
pSS
->
pPC
->
	`Prš‹rMod–
());

524 ià(!
	`¡rcmp
 (
key
, "Quality:Quality"))

526  
	`¢´štf
(
v®ue_buf
, 
v®ue_size
, "%d", 
pSS
->
Qu®™y
);

528 ià(!
	`¡rcmp
 (
key
, "Quality:ColorMode"))

530  
	`¢´štf
(
v®ue_buf
, 
v®ue_size
, "%d", 
pSS
->
CŞÜMode
);

532 ià(!
	`¡rcmp
 (
key
, "Quality:MediaType"))

534  
	`¢´štf
(
v®ue_buf
, 
v®ue_size
, "%d", 
pSS
->
MedŸTy³
);

536 ià(!
	`¡rcmp
 (
key
, "ColorSpace"))

538  
	`¢´štf
(
v®ue_buf
, 
v®ue_size
, "%s", 
pSS
->
ph
.
cs
);

540 ià(!
	`¡rcmp
 (
key
, "PageImageFormat"))

542  
	`¢´štf
(
v®ue_buf
, 
v®ue_size
, "Raster");

544 ià(!
	`¡rcmp
 (
key
, "BitsPerSample"))

546  
	`¢´štf
(
v®ue_buf
, 
v®ue_size
, "8");

548 ià(!
	`¡rcmp
 (
key
, "PS:MediaPosition"))

550  
	`¢´štf
(
v®ue_buf
, 
v®ue_size
, "%d", 
pSS
->
MedŸPos™iÚ
);

553 
	`BUG
("uÇbËØg‘ key=%s\n", 
key
);

555  
IJS_EUNKPARAM
;

556 
	}
}

559 
	$hpijs_g‘_ş›Á_¿¡”
(
IjsS”v”Ctx
 *
ùx
, *
buf
, 
size
, 
wh™e
)

561 
¡©us
, 
ş—n
=1, 
i
;

563 
¡©us
 = 
	`ijs_£rv”_g‘_d©a
(
ùx
, (*)
buf
, 
size
);

565 ià(
¡©us
 < 0)

566  
¡©us
;

569 
i
 = 0; i < 
size
; i++)

571 ià(
buf
[
i
] !ğ
wh™e
)

573 
ş—n
 = 0;

578 ià(
ş—n
)

581  
size
;

582 
	}
}

584 
	$maš
 (
¬gc
, *
¬gv
[], *
ev’p
[])

586 
UXS”viûs
 *
pSS
 = 
NULL
;

587 
IjsS”v”Ctx
 *
ùx
 = 
NULL
;

588 *
¿¡”
 = 
NULL
, *
k_¿¡”
 = NULL;

589 
¡©us
 = 
EXIT_FAILURE
;

590 
»t
, 
n
, 
i
, 
kn
=0, 
width
, 
k_width
;

591 
u£r_Çme
[32]={0,};

593 
	`İ’log
("hpijs", 
LOG_PID
, 
LOG_DAEMON
);

595 ià(
¬gc
 > 1)

597 cÚ¡ *
¬g
 = 
¬gv
[1];

598 ià((
¬g
[0] == '-') && (arg[1] == 'h'))

600 
	`årštf
(
¡dout
, "\nHP Co. Inkj‘ S”v” %s\n", 
VERSION
);

601 
	`årštf
(
¡dout
, "Copyright (c) 2001-2004, HP Co.\n");

602 
	`ex™
(0);

606 ià(
¬gc
 > 2)

607 
	`¡ºıy
(
u£r_Çme
, 
¬gv
[2], (user_name));

609 #ifdeà
HAVE_LIBHPIP


610 *
pDev
;

611 ià((
pDev
 = 
	`g‘’v
 ("DEVICE_URI")) &&

612 ((
	`¡ºcmp
 (
pDev
, "hpfax:", 6)) == 0))

614 
	`ex™
 ( 
	`hpijsFaxS”v”
 (
¬gc
, 
¬gv
));

618 
ùx
 = 
	`ijs_£rv”_š™
();

619 ià(
ùx
 =ğ
NULL
)

621 
	`BUG
("unableo init hpijs server\n");

622 
BUGOUT
;

625 
pSS
 = 
Ãw
 
	`UXS”viûs
();

626 ià(
pSS
->
cÚ¡ruùÜ_”rÜ
 !ğ
NO_ERROR
)

628 
	`BUG
("uÇbËØİ’ S”viû objeùƒ¼=%d\n", 
pSS
->
cÚ¡ruùÜ_”rÜ
);

629 
BUGOUT
;

632 
	`£tLogLev–
(
pSS
, 
u£r_Çme
);

634 #ifdeà
CAPTURE


635 
szC­OutFe
[
MAX_FILE_PATH_LEN
];

636 
	`¢´štf
(
szC­OutFe
, (szC­OutFe),"%s/hp_%s_ijs_ÿpout_XXXXXX",
CUPS_TMP_DIR
, 
u£r_Çme
);

637 ià((
pSS
->
	`In™Süt
(
szC­OutFe
, 
TRUE
)è!ğ
NO_ERROR
)

638 
	`BUG
("unableo init capture");

642 
pSS
->
pPC
 = 
Ãw
 
	`PrštCÚ‹xt
 (pSS, 0, 0);

645 ià(
pSS
->
pPC
->
cÚ¡ruùÜ_”rÜ
 > 0 &&…SS->
Di¥ÏyStus
 !ğ
DISPLAY_PRINTING_CANCELED
)

647 
	`BUG
("uÇbËØİ’ PrštCÚ‹xˆobjeùƒ¼=%d\n", 
pSS
->
pPC
->
cÚ¡ruùÜ_”rÜ
);

648 
BUGOUT
;

656 ià(
pSS
->
pPC
->
cÚ¡ruùÜ_”rÜ
 < 0 &&

657 
pSS
->
pPC
->
cÚ¡ruùÜ_”rÜ
 !ğ
WARN_MODE_MISMATCH
)

659 
	`BUG
 ("WARNING: %s\n", 
pSS
->
	`G‘Driv”Mes§ge
 (pSS->
pPC
->
cÚ¡ruùÜ_”rÜ
));

660 
pSS
->
pPC
->
cÚ¡ruùÜ_”rÜ
)

662 
WARN_LOW_INK_BOTH_PENS
:

663 
WARN_LOW_INK_BLACK
:

664 
WARN_LOW_INK_COLOR
:

665 
WARN_LOW_INK_PHOTO
:

666 
WARN_LOW_INK_GREY
:

667 
WARN_LOW_INK_BLACK_PHOTO
:

668 
WARN_LOW_INK_COLOR_PHOTO
:

669 
WARN_LOW_INK_GREY_PHOTO
:

670 
WARN_LOW_INK_COLOR_GREY
:

671 
WARN_LOW_INK_COLOR_GREY_PHOTO
:

672 
WARN_LOW_INK_COLOR_BLACK_PHOTO
:

673 
WARN_LOW_INK_CYAN
:

674 
WARN_LOW_INK_MAGENTA
:

675 
WARN_LOW_INK_YELLOW
:

676 
WARN_LOW_INK_MULTIPLE_PENS
:

678 
	`åuts
("STATE: +m¬k”-suµly-low-w¬nšg\n", 
¡d”r
);

682 
	`åuts
("STATE: +m¬k”-suµly-low-w¬nšg\n", 
¡d”r
);

687 
	`BUG
("deviû mod–=%s\n", 
pSS
->
pPC
->
	`Prš‹rMod–
());

688 
	`BUG
("deviû cÏss=%s\n", 
pSS
->
pPC
->
	`Prš‹¹y³ToSŒšg
ÕSS->pPC->
	`S–eùedDeviû
()));

689 
	`BUG
("deçuÉ…’=%d\n", 
pSS
->
pPC
->
	`G‘DeçuÉP’S‘
());

690 
	`BUG
("š¡®Ëd…’=%d\n", 
pSS
->
pPC
->
	`G‘In¡®ËdP’s
());

693 
	`ijs_£rv”_š¡®l_¡©us_cb
 (
ùx
, 
hpijs_¡©us_cb
, 
pSS
);

694 
	`ijs_£rv”_š¡®l_li¡_cb
 (
ùx
, 
hpijs_li¡_cb
, 
pSS
);

695 
	`ijs_£rv”_š¡®l_’um_cb
 (
ùx
, 
hpijs_’um_cb
, 
pSS
);

696 
	`ijs_£rv”_š¡®l_£t_cb
 (
ùx
, 
hpijs_£t_cb
, 
pSS
);

697 
	`ijs_£rv”_š¡®l_g‘_cb
 (
ùx
, 
hpijs_g‘_cb
, 
pSS
);

701 ià((
»t
 = 
	`ijs_£rv”_g‘_·ge_h—d”
(
ùx
, &
pSS
->
ph
)) < 0)

703 
	`BUG
("uÇbËØ»ad cl›Á d©¨”r=%d\n", 
»t
);

704 
BUGOUT
;

707 ià(
pSS
->
Mod–
 == -1)

708 
BUGOUT
;

710 ià(
»t
)

712 
¡©us
 = 0;

716 ià(
pSS
->
Fœ¡Ra¡”
)

718 *
pEnv
 = 
	`g‘’v
 ("COPY_COUNT");

719 ià(
pEnv
)

721 
i
 = 
	`©oi
 (
pEnv
);

722 
pSS
->
pPC
->
	`S‘CİyCouÁ
 (
i
);

725 
pSS
->
Fœ¡Ra¡”
 = 0;

727 
width
 = ()(
pSS
->
ph
.
x»s
 *…SS->
pPC
->
	`PršbËWidth
() + 0.5);

730 ià(
pSS
->
ph
.
width
 < width)

731 
width
 = 
pSS
->
ph
.width;

733 ià((
»t
 = 
pSS
->
pPC
->
	`S‘Pix–sP”Row
(
width
, width)è!ğ
NO_ERROR
)

735 
	`BUG
("uÇbËØS‘Pix–sP”Row width=%d,ƒ¼=%d\n", 
pSS
->
ph
.
width
, 
»t
);

740 
pSS
->
	`Re£tIOMode
 (
FALSE
, FALSE);

743 ià(
pSS
->
Du¶ex
)

745 
pSS
->
	`EÇbËS³edMech
 (
FALSE
);

748 ià(
pSS
->
	`IsS³edMechEÇbËd
 ())

750 
pSS
->
	`In™S³edMechBufãr
 ();

753 ià(
pSS
->
pJob
 !ğ
NULL
)

754 
d–‘e
 
pSS
->
pJob
;

755 
pSS
->
pJob
 = 
Ãw
 
	`Job
ÕSS->
pPC
);

756 ià(
pSS
->
pJob
->
cÚ¡ruùÜ_”rÜ
 !ğ
NO_ERROR
)

758 
	`BUG
("uÇbËØü—‹ Job objeùƒ¼=%d\n", 
pSS
->
pJob
->
cÚ¡ruùÜ_”rÜ
);

759 
BUGOUT
;

762 ià(
pSS
->
pPC
->
	`Qu”yDu¶exMode
(è!ğ
DUPLEXMODE_NONE
)

764 ià((
pSS
->
pPC
->
	`Qu”yDu¶exMode
(è=ğ
DUPLEXMODE_BOOK
è&&…SS->pPC->
	`RÙ©eImageFÜBackPage
())

765 
pSS
->
	`In™Du¶exBufãr
();

766 
pSS
->
BackPage
 = 
FALSE
;

769 
pSS
->
KRGB
=0;

770 ià(
	`¡rcmp
(
pSS
->
ph
.
cs
, "KRGB") == 0)

771 
pSS
->
KRGB
=1;

774 
	`BUG
("·³rsize=%d\n", 
pSS
->
pPC
->
	`G‘P­”Size
());

775 
	`BUG
("width=%d, height=%d\n", 
pSS
->
ph
.
width
,…SS->ph.
height
);

776 
	`BUG
("EffResX=%d, EffResY=%d, InPixelsPerRow=%d, OutPixelsPerRow=%d\n",

777 
pSS
->
pPC
->
	`EfãùiveResŞutiÚX
(),…SS->pPC->
	`EfãùiveResŞutiÚY
(),

778 
pSS
->
pPC
->
	`IÅutPix–sP”Row
(),…SS->pPC->
	`OuutPix–sP”Row
());

779 
	`BUG
("deviû=%s\n", 
pSS
->
pPC
->
	`Prš‹rMod–
());

783 ià((
¿¡”
 = (*)
	`m®loc
(
pSS
->
ph
.
width
*3)è=ğ
NULL
)

785 
	`BUG
("uÇbËØ®loÿ‹„a¡” bufã¸size=%d: %m\n", 
pSS
->
ph
.
width
*3);

786 
BUGOUT
;

789 
k_width
 = (
pSS
->
ph
.
width
 + 7) >> 3;

791 ià((
k_¿¡”
 = (*)
	`m®loc
(
k_width
)è=ğ
NULL
)

793 
	`BUG
("uÇbËØ®loÿ‹ bÏck„a¡” bufã¸size=%d: %m\n", 
k_width
);

794 
BUGOUT
;

796 
	`mem£t
(
k_¿¡”
, 0, 
k_width
);

798 
pSS
->
	`S’dP»viousPage
 ();

799 
i
=0; i < 
pSS
->
ph
.
height
; i++)

801 ià((
n
 = 
	`hpijs_g‘_ş›Á_¿¡”
(
ùx
, 
¿¡”
, 
pSS
->
ph
.
width
*3, 0xff)) < 0)

803 ià(
pSS
->
KRGB
)

805 ià((
kn
 = 
	`hpijs_g‘_ş›Á_¿¡”
(
ùx
, 
k_¿¡”
, 
k_width
, 0)) < 0)

808 ià(
n
 =ğ0 && 
kn
 == 0)

809 
pSS
->
	`ProûssRa¡”
((*)0, (*)0);

810 ià(
kn
 == 0)

811 
pSS
->
	`ProûssRa¡”
(
¿¡”
, (*)0);

812 ià(
n
 == 0)

813 
pSS
->
	`ProûssRa¡”
((*)0, 
k_¿¡”
);

815 
pSS
->
	`ProûssRa¡”
(
¿¡”
, 
k_¿¡”
);

818 
	`ä“
(
¿¡”
);

819 
¿¡”
 = 
NULL
;

820 
	`ä“
(
k_¿¡”
);

821 
k_¿¡”
 = 
NULL
;

823 ià(
pSS
->
pPC
->
	`Qu”yDu¶exMode
(è!ğ
DUPLEXMODE_NONE
)

825 ià((
pSS
->
pPC
->
	`Qu”yDu¶exMode
(è=ğ
DUPLEXMODE_BOOK
è&&…SS->pPC->
	`RÙ©eImageFÜBackPage
(è&&…SS->
BackPage
)

827 
pSS
->
	`S’dBackPage
();

829 
pSS
->
BackPage
 = (
BOOL
)(()pSS->BackPage + 1) % 2;

832 
pSS
->
pJob
->
	`NewPage
();

837 ià(
pSS
->
pPC
->
	`Qu”yDu¶exMode
(è!ğ
DUPLEXMODE_NONE
)

839 ià(
pSS
->
BackPage
)

844 
i
 = 0; i < 401; i++)

845 
pSS
->
pJob
->
	`S’dRa¡”s
((*)0);

846 
pSS
->
pJob
->
	`NewPage
();

850 
BUGOUT
:

851 ià(
pSS
 !ğ
NULL
)

853 ià(
pSS
->
pJob
 !ğ
NULL
)

854 
d–‘e
 
pSS
->
pJob
;

855 ià(
pSS
->
pPC
 !ğ
NULL
)

856 
d–‘e
 
pSS
->
pPC
;

857 #ifdeà
CAPTURE


858 
pSS
->
	`EndSüt
();

860 
d–‘e
 
pSS
;

862 ià(
¿¡”
 !ğ
NULL
)

863 
	`ä“
(
¿¡”
);

864 ià(
k_¿¡”
 !ğ
NULL
)

865 
	`ä“
(
k_¿¡”
);

866 ià(
ùx
 !ğ
NULL
)

867 
	`ijs_£rv”_dÚe
(
ùx
);

869 
	`ex™
(
¡©us
);

870 
	}
}

	@prnt/hpijs/hpijs.h

32 #iâdeà
hpijs_INCLUDED


33 
	#hpijs_INCLUDED


	)

35 
	#IJS_MAX_PARAM
 256

	)

36 
	#EXCEPTION_TIMEOUT
 45

	)

38 #ifdeà
HAVE_LIBHPIP


39 
	~"hpmud.h
"

40 
	~"hpiom.h
"

43 
	~"bug.h
"

	@prnt/hpijs/hpijsfax.cpp

32 #ifdeà
HAVE_LIBHPIP


34 
	~<sys/¡©.h
>

35 
	~<¡dio.h
>

36 
	~<¡dlib.h
>

37 
	~<¡d¬g.h
>

38 
	~<sy¦og.h
>

39 
	~<¡ršg.h
>

40 
	~<uni¡d.h
>

41 
	~<fú.h
>

42 
	~<¡dšt.h
>

43 
	~<time.h
>

44 
	~<sys/time.h
>

45 
	~<m©h.h
>

46 
	~"ijs.h
"

47 
	~"ijs_£rv”.h
"

48 #ifdeà
FALSE


49 #undeà
FALSE


51 #ifdeà
TRUE


52 #undeà
TRUE


54 
	~"hp.h
"

55 
	~"hpijsçx.h
"

56 
	~"uts.h
"

59 
	$hpijsçx_¡©us_cb
 (*
¡©us_cb_d©a
, 
IjsS”v”Ctx
 *
ùx
, 
IjsJobId
 
job_id
)

62 
	}
}

64 
	$hpijsçx_li¡_cb
 (*
li¡_cb_d©a
, 
IjsS”v”Ctx
 *
ùx
, 
IjsJobId
 
job_id
,

65 *
v®_buf
, 
v®_size
)

67  
	`¢´štf
 (
v®_buf
, 
v®_size
, "OutputFD,DeviceManufacturer,DeviceModel,\
,Dpi,Width,Height,BitsPerSample,\
,PaperSize,PrintableArea,\
");

71 
	}
}

73 
	$hpijsçx_’um_cb
 (*
’um_cb_d©a
, 
IjsS”v”Ctx
 *
ùx
, 
IjsJobId
 
job_id
,

74 cÚ¡ *
key
, *
v®_buf
, 
v®_size
)

77 ià(!
	`¡rcmp
 (
key
, "ColorSpace"))

79  
	`¢´štf
(
v®_buf
, 
v®_size
, "sRGB");

82 ià(!
	`¡rcmp
 (
key
, "DeviceManufacturer"))

84  
	`¢´štf
(
v®_buf
, 
v®_size
, "HEWLETT-PACKARD,HP");

86 ià(!
	`¡rcmp
 (
key
, "PageImageFormat"))

88  
	`¢´štf
(
v®_buf
, 
v®_size
, "Raster");

90 ià(!
	`¡rcmp
 (
key
, "BitsPerSample"))

92  
	`¢´štf
(
v®_buf
, 
v®_size
, "8");

96  
IJS_ERANGE
;

97 
	}
}

104 
	$hpijsçx_£t_cb
 (*
£t_cb_d©a
, 
IjsS”v”Ctx
 *
ùx
, 
IjsJobId
 
job_id
,

105 cÚ¡ *
key
, cÚ¡ *
v®ue
, 
v®ue_size
)

107 
HPIJSFax
 *
pFaxSŒuù
 = (HPIJSFax*)
£t_cb_d©a
;

108 
fd
;

109 *

;

110 
¡©us
 = 0;

111 
sv®ue
[
IJS_MAX_PARAM
+1];

112 
w
;

113 
h
;

116 ià(
v®ue_size
 > 
IJS_MAX_PARAM
)

118 
	`memıy
(
sv®ue
, 
v®ue
, 
IJS_MAX_PARAM
);

119 
sv®ue
[
IJS_MAX_PARAM
] = 0;

123 
	`memıy
(
sv®ue
, 
v®ue
, 
v®ue_size
);

124 
sv®ue
[
v®ue_size
] = 0;

127 ià(!
	`¡rcmp
 (
key
, "OutputFD"))

129 
fd
 = 
	`¡¹Ş
 (
sv®ue
, &

, 10);

130 
pFaxSŒuù
->
iOuutP©h
 = 
fd
;

132 ià(!
	`¡rcmp
 (
key
, "DeviceModel"))

134 
pFaxSŒuù
->
	`S‘DeviûName
 (
sv®ue
);

136 ià(!
	`¡rcmp
 (
key
, "PaperSize"))

138 
w
 = (è
	`¡¹od
 (
sv®ue
, &

);

139 
h
 = (è
	`¡¹od
 (

+1, &tail);

140 
pFaxSŒuù
->
	`S‘P­”Size
 (
w
, 
h
);

143 ià(
pFaxSŒuù
->
	`IsFœ¡Ra¡”
 ())

146 
pFaxSŒuù
->
	`S‘P­”Size
 (
w
, 
h
);

151 ià(!(
w
 =ğ
pFaxSŒuù
->
	`G‘P­”Width
 () &&

152 
h
 =ğ
pFaxSŒuù
->
	`G‘P­”Height
 ()))

156 
pFaxSŒuù
->
	`S‘Fœ¡Ra¡”
 (1);

157 
pFaxSŒuù
->
	`S‘P­”Size
 (
w
, 
h
);

163 ià(!
	`¡rcmp
 (
key
, "Quality:Quality"))

165 
pFaxSŒuù
->
	`S‘Qu®™y
 (
	`¡¹Ş
 (
sv®ue
, &

, 10));

167 ià(!
	`¡rcmp
 (
key
, "Quality:MediaType"))

169 
pFaxSŒuù
->
	`S‘MedŸTy³
 (
	`¡¹Ş
 (
sv®ue
, &

, 10));

171 ià(!
	`¡rcmp
 (
key
, "Quality:ColorMode"))

173 
pFaxSŒuù
->
	`S‘CŞÜMode
 (
	`¡¹Ş
 (
sv®ue
, &

, 10));

175 ià(!
	`¡rcmp
 (
key
, "FaxEncoding"))

177 
pFaxSŒuù
->
	`S‘FaxEncodšg
 ((è
	`¡¹Ş
 (
sv®ue
, &

, 10));

182  
¡©us
;

183 
	}
}

190 
	$hpijsçx_g‘_cb
 (*
g‘_cb_d©a
, 
IjsS”v”Ctx
 *
ùx
, 
IjsJobId
 
job_id
,

191 cÚ¡ *
key
, *
v®ue_buf
, 
v®ue_size
)

193 
HPIJSFax
 *
pFaxSŒuù
 = (HPIJSFax*è
g‘_cb_d©a
;

195 ià(!
	`¡rcmp
 (
key
, "PrintableArea"))

197  
	`¢´štf
 (
v®ue_buf
, 
v®ue_size
, "%.4fx%.4f",

198 
pFaxSŒuù
->
	`PršbËWidth
 (),

199 
pFaxSŒuù
->
	`PršbËHeight
 ());

201 ià(!
	`¡rcmp
 (
key
, "DeviceModel"))

203  
	`¢´štf
 (
v®ue_buf
, 
v®ue_size
, "%s", 
pFaxSŒuù
->
	`G‘DeviûName
 ());

205 ià(!
	`¡rcmp
 (
key
, "PrintableTopLeft"))

207  
	`¢´štf
 (
v®ue_buf
, 
v®ue_size
, "%.4fx%.4f",

208 
pFaxSŒuù
->
	`PršbËS¹X
 (),

209 
pFaxSŒuù
->
	`PršbËS¹Y
 ());

211 ià(!
	`¡rcmp
 (
key
, "PaperSize"))

213  
	`¢´štf
 (
v®ue_buf
, 
v®ue_size
, "%.4fx%.4f",

214 
pFaxSŒuù
->
	`PhysiÿlPageSizeX
 (),

215 
pFaxSŒuù
->
	`PhysiÿlPageSizeY
 ());

217 ià(!
	`¡rcmp
 (
key
, "Dpi"))

219  
	`¢´štf
 (
v®ue_buf
, 
v®ue_size
, "%dx%d",

220 
pFaxSŒuù
->
	`EfãùiveResŞutiÚX
 (),

221 
pFaxSŒuù
->
	`EfãùiveResŞutiÚY
 ());

223 ià(!
	`¡rcmp
 (
key
, "Quality:Quality"))

225  
	`¢´štf
 (
v®ue_buf
, 
v®ue_size
, "%d", 
pFaxSŒuù
->
	`G‘Qu®™y
 ());

227 ià(!
	`¡rcmp
 (
key
, "Quality:ColorMode"))

229  
	`¢´štf
 (
v®ue_buf
, 
v®ue_size
, "%d", 
pFaxSŒuù
->
	`G‘CŞÜMode
 ());

231 ià(!
	`¡rcmp
 (
key
, "Quality:MediaType"))

233  
	`¢´štf
 (
v®ue_buf
, 
v®ue_size
, "%d", 
pFaxSŒuù
->
	`G‘MedŸTy³
 ());

235 ià(!
	`¡rcmp
 (
key
, "FaxEncoding"))

237  
	`¢´štf
 (
v®ue_buf
, 
v®ue_size
, "%d", 
pFaxSŒuù
->
	`G‘FaxEncodšg
 ());

239 ià(!
	`¡rcmp
 (
key
, "ColorSpace"))

241  
	`¢´štf
 (
v®ue_buf
, 
v®ue_size
, "%s", 
pFaxSŒuù
->
ph
.
cs
);

243 ià(!
	`¡rcmp
 (
key
, "PageImageFormat"))

245  
	`¢´štf
 (
v®ue_buf
, 
v®ue_size
, "Raster");

247 ià(!
	`¡rcmp
 (
key
, "BitsPerSample"))

249  
	`¢´štf
 (
v®ue_buf
, 
v®ue_size
, "8");

254  
IJS_EUNKPARAM
;

255 
	}
}

257 
	$hpijsFaxS”v”
 (
¬gc
, **
¬gv
)

259 
IjsS”v”Ctx
 *
ùx
 = 
NULL
;

260 
HPIJSFax
 *
pFaxSŒuù
 = 
NULL
;

261 
¡©us
 = 
EXIT_FAILURE
;

262 
»t
;

263 
n
;

264 
i
;

265 
width
;

266 
widthMMR
;

267 
iIÅutBufSize
;

268 
LPBYTE
 
pbOuutBuf
 = 
NULL
;

269 
LPBYTE
 
pThisSÿnLše
 = 
NULL
;

270 
LPBYTE
 
pIÅutBuf
 = 
NULL
;

271 
IP_XFORM_SPEC
 
xFÜm
[3];

272 
IP_IMAGE_TRAITS
 
Œa™s
;

273 
IP_HANDLE
 
hJob
;

274 
FILE
 *
pFePŒFax
;

276 
hpFeName
[
MAX_FILE_PATH_LEN
];

277 
fdFax
 = -1;

278 
BYTE
 
szFeH—d”
[68];

279 
BYTE
 
szPageH—d”
[64];

280 
BYTE
 *
p
;

281 
uiPageNum
 = 0;

282 
u£r_Çme
[32]={0,};

284 ià(
¬gc
 > 2)

285 
	`¡ºıy
(
u£r_Çme
, 
¬gv
[2], (user_name));

287 
	`¢´štf
(
hpFeName
,(hpFeName),"%s/hp_%s_ijsçx_Log_XXXXXX",
CUPS_TMP_DIR
, 
u£r_Çme
);

290 
pFaxSŒuù
 = 
Ãw
 
	`HPIJSFax
 ();

292 ià(
pFaxSŒuù
 =ğ
NULL
)

294 
	`BUG
 ("unableo‡llocate HPIJSFax\n");

295 
	`ex™
 (0);

298 
pFaxSŒuù
->
	`S‘Fœ¡Ra¡”
 (
TRUE
);

300 
ùx
 = 
	`ijs_£rv”_š™
 ();

301 ià(
ùx
 =ğ
NULL
)

303 
	`BUG
 ("unableo init hpijs server\n");

304 
BUGOUT
;

307 
	`ijs_£rv”_š¡®l_¡©us_cb
 (
ùx
, 
hpijsçx_¡©us_cb
, 
pFaxSŒuù
);

308 
	`ijs_£rv”_š¡®l_li¡_cb
 (
ùx
, 
hpijsçx_li¡_cb
, 
pFaxSŒuù
);

309 
	`ijs_£rv”_š¡®l_’um_cb
 (
ùx
, 
hpijsçx_’um_cb
, 
pFaxSŒuù
);

310 
	`ijs_£rv”_š¡®l_£t_cb
 (
ùx
, 
hpijsçx_£t_cb
, 
pFaxSŒuù
);

311 
	`ijs_£rv”_š¡®l_g‘_cb
 (
ùx
, 
hpijsçx_g‘_cb
, 
pFaxSŒuù
);

315 ià((
»t
 = 
	`ijs_£rv”_g‘_·ge_h—d”
(
ùx
, &
pFaxSŒuù
->
ph
)) < 0)

317 
	`BUG
("uÇbËØ»ad cl›Á d©¨”r=%d\n", 
»t
);

318 
BUGOUT
;

321 ià(
pFaxSŒuù
->
	`IsFœ¡Ra¡”
 ())

323 
pFaxSŒuù
->
	`S‘Fœ¡Ra¡”
 (0);

324 ià(
fdFax
 == -1)

327 
fdFax
 = 
	`ü—‹TempFe
(
hpFeName
, &
pFePŒFax
);

328 ià(
fdFax
 < 0)

330 
	`BUG
 ("UÇbËØİ’ Fax ouuˆf- % fÜ wr™šg\n", 
hpFeName
);

331 
BUGOUT
;

334 
	`mem£t
 (
szFeH—d”
, 0,  (szFileHeader));

335 
	`memıy
 (
szFeH—d”
, "hplip_g3", 8);

336 
p
 = 
szFeH—d”
 + 8;

338 *
p
++ = 1;

339 
	`HPLIPPUTINT32
 (
p
, 0);… += 4;

340 
	`HPLIPPUTINT16
 (
p
, (
pFaxSŒuù
->
	`EfãùiveResŞutiÚX
 ()));… += 2;

341 
	`HPLIPPUTINT16
 (
p
, (
pFaxSŒuù
->
	`EfãùiveResŞutiÚY
 ()));… += 2;

342 *
p
++ = 
pFaxSŒuù
->
	`G‘P­”Size
 ();

343 *
p
++ = 
pFaxSŒuù
->
	`G‘Qu®™y
 ();

344 *
p
++ = 
pFaxSŒuù
->
	`G‘FaxEncodšg
 ();

345 
p
 += 4;

346 
p
 += 4;

347 
	`wr™e
 (
fdFax
, 
szFeH—d”
, (
p
 - szFileHeader));

351 ià(
»t
)

353 
¡©us
 = 0;

357 
width
 = (((
pFaxSŒuù
->
ph
.width + 7) >> 3)) << 3;

358 
widthMMR
 = 
width
;

365 ià(!
	`¡rcmp
 (
pFaxSŒuù
->
	`G‘DeviûName
 (), "HPFax2"))

367 
widthMMR
 = 2528;

370 ià((
pThisSÿnLše
 = (
LPBYTE
è
	`m®loc
 (
width
 * 3)è=ğ
NULL
)

372 
	`BUG
 ("uÇbËØ®loÿ‹…ThisSÿnLšbufã¸sizğ%d: %m\n", 
width
 * 3);

373 
BUGOUT
;

376 
	`mem£t
 (
pThisSÿnLše
, 0xFF, 
width
 * 3);

378 
iIÅutBufSize
 = 
widthMMR
 * 
pFaxSŒuù
->
ph
.
height
;

379 ià(
pFaxSŒuù
->
	`G‘CŞÜMode
 (è=ğ
HPLIPFAX_COLOR
)

381 
iIÅutBufSize
 *= 3;

384 
pIÅutBuf
 = (
LPBYTE
è
	`m®loc
 (
iIÅutBufSize
);

385 ià(
pIÅutBuf
 =ğ
NULL
)

387 
	`BUG
 ("UÇbËØ®loÿ‹…IÅutBuf, sizğ%d\n", 
iIÅutBufSize
);

388 
BUGOUT
;

390 
	`mem£t
 (
pIÅutBuf
, 0xFF, 
iIÅutBufSize
);

392 
i
 = 0; i < 
pFaxSŒuù
->
ph
.
height
; i++)

394 ià((
n
 = 
	`ijs_£rv”_g‘_d©a
 (
ùx
, (*è
pThisSÿnLše
, 
pFaxSŒuù
->
ph
.
width
 * 3)) < 0)

396 
	`BUG
 ("ijs_server_get_data failed\n");

399 ià(
pFaxSŒuù
->
	`G‘CŞÜMode
 (è=ğ
HPLIPFAX_MONO
)

401 
	`RGB2G¿y
 (
pThisSÿnLše
, 
width
, 
pIÅutBuf
 + 
i
 * 
widthMMR
);

405 
	`memıy
 (
pIÅutBuf
 + (
i
 * 
widthMMR
 * 3), 
pThisSÿnLše
, 
n
);

408 
WORD
 
wResuÉ
;

409 
DWORD
 
dwIÅutAva
;

410 
DWORD
 
dwIÅutU£d
;

411 
DWORD
 
dwIÅutNextPos
;

412 
DWORD
 
dwOuutAva
;

413 
DWORD
 
dwOuutU£d
;

414 
DWORD
 
dwOuutThisPos
;

415 
pbOuutBuf
 = (
LPBYTE
è
	`m®loc
 (
iIÅutBufSize
);

416 ià(
pbOuutBuf
 =ğ
NULL
)

418 
	`BUG
 ("uÇbËØ®loÿ‹…bOuutBuf, bufã¸sizğ%d\n", 
iIÅutBufSize
);

419 
BUGOUT
;

421 
	`mem£t
 (
pbOuutBuf
, 0xFF, 
iIÅutBufSize
);

423 
	`mem£t
 (
xFÜm
, 0,  (xForm));

425 ià(
pFaxSŒuù
->
	`G‘CŞÜMode
 (è=ğ
HPLIPFAX_MONO
)

427 
xFÜm
[0].
eXfÜm
 = 
X_GRAY_2_BI
;

432 
xFÜm
[0].
aXfÜmInfo
[
IP_GRAY_2_BI_THRESHOLD
].
dwÜd
 = 127;

434 
xFÜm
[1].
eXfÜm
 = 
X_FAX_ENCODE
;

435 ià(
pFaxSŒuù
->
	`G‘FaxEncodšg
 (è=ğ
RASTER_MMR
)

437 
xFÜm
[1].
aXfÜmInfo
[
IP_FAX_FORMAT
].
dwÜd
 = 
IP_FAX_MMR
;

441 
xFÜm
[1].
aXfÜmInfo
[
IP_FAX_FORMAT
].
dwÜd
 = 
IP_FAX_MH
;

445 
xFÜm
[1].
aXfÜmInfo
[
IP_FAX_NO_EOLS
].
dwÜd
 = 0;

447 
xFÜm
[1].
pXfÜm
 = 
NULL
;

448 
xFÜm
[1].
pfR—dP“k
 = 
NULL
;

449 
xFÜm
[1].
pfWr™eP“k
 = 
NULL
;

451 
Œa™s
.
iCompÚ’tsP”Pix–
 = 1;

452 
wResuÉ
 = 
	`O³n
 (2, 
xFÜm
, 0, &
hJob
);

456 
xFÜm
[0].
eXfÜm
 = 
X_CNV_COLOR_SPACE
;

457 
xFÜm
[0].
aXfÜmInfo
[
IP_CNV_COLOR_SPACE_WHICH_CNV
].
dwÜd
 = 
IP_CNV_SRGB_TO_YCC
;

458 
xFÜm
[1].
eXfÜm
 = 
X_CNV_COLOR_SPACE
;

459 
xFÜm
[1].
aXfÜmInfo
[
IP_CNV_COLOR_SPACE_WHICH_CNV
].
dwÜd
 = 
IP_CNV_YCC_TO_CIELAB
;

460 
xFÜm
[0].
eXfÜm
 = 
X_JPG_ENCODE
;

461 
xFÜm
[0].
aXfÜmInfo
[
IP_JPG_ENCODE_FOR_COLOR_FAX
].
dwÜd
 = 1;

462 
Œa™s
.
iCompÚ’tsP”Pix–
 = 3;

463 
wResuÉ
 = 
	`O³n
 (1, 
xFÜm
, 0, &
hJob
);

466 ià(
wResuÉ
 !ğ
IP_DONE
)

468 
	`BUG
 ("O³Àçed: wResuÉ = %x\n", 
wResuÉ
);

469 
BUGOUT
;

471 
Œa™s
.
iB™sP”Pix–
 = 8;

472 
Œa™s
.
iPix–sP”Row
 = 
widthMMR
;

473 
Œa™s
.
lHÜizDPI
 = 
pFaxSŒuù
->
	`EfãùiveResŞutiÚX
 ();

474 
Œa™s
.
lV”tDPI
 = 
pFaxSŒuù
->
	`EfãùiveResŞutiÚY
 ();

475 
Œa™s
.
lNumRows
 = 
pFaxSŒuù
->
ph
.
height
;

476 
Œa™s
.
iNumPages
 = 1;

477 
Œa™s
.
iPageNum
 = 1;

479 
wResuÉ
 = 
	`S‘DeçuÉIÅutT¿™s
 (
hJob
, &
Œa™s
);

480 ià(
wResuÉ
 !ğ
IP_DONE
)

482 
	`BUG
 ("S‘DeçuÉIÅutT¿™ çed: wResuÉ = %x\n", 
wResuÉ
);

483 
wResuÉ
 = 
	`Clo£
 (
hJob
);

484 
BUGOUT
;

486 
dwIÅutAva
 = 
iIÅutBufSize
;

487 
dwOuutAva
 = 
dwIÅutAva
;

489 
wResuÉ
 = 
	`CÚv”t
 (
hJob
, 
dwIÅutAva
, 
pIÅutBuf
, &
dwIÅutU£d
,

490 &
dwIÅutNextPos
, 
dwOuutAva
, 
pbOuutBuf
,

491 &
dwOuutU£d
, &
dwOuutThisPos
);

493 ià(
wResuÉ
 =ğ
IP_FATAL_ERROR
)

495 
	`BUG
 ("CÚv”ˆçed, wResuÉ = %d\n", 
wResuÉ
);

496 
BUGOUT
;

499 
	`BUG
 ("dwInputAvail = %d dwInputUsed = %d dwOutputUsed = %d\n",

500 
dwIÅutAva
, 
dwIÅutU£d
, 
dwOuutU£d
);

502 
wResuÉ
 = 
	`Clo£
 (
hJob
);

503 
hJob
 = 0;

505 
uiPageNum
++;

507 
p
 = 
szPageH—d”
;

508 
	`HPLIPPUTINT32
 (
p
, 
uiPageNum
);… += 4;

509 
	`HPLIPPUTINT32
 (
p
, 
widthMMR
);… += 4;

510 
	`HPLIPPUTINT32
 (
p
, 
pFaxSŒuù
->
ph
.
height
);… += 4;

511 
	`HPLIPPUTINT32
 (
p
, 
dwOuutU£d
);… += 4;

512 
	`HPLIPPUTINT32
 (
p
, 0);… += 4;

513 
	`HPLIPPUTINT32
 (
p
, 0);… += 4;

514 
	`wr™e
 (
fdFax
, 
szPageH—d”
, (
p
 - szPageHeader));

515 
	`wr™e
 (
fdFax
, 
pbOuutBuf
, 
dwOuutU£d
);

522 
	`ä“
 (
pThisSÿnLše
);

523 
pThisSÿnLše
 = 
NULL
;

524 
	`ä“
 (
pbOuutBuf
);

525 
	`ä“
 (
pIÅutBuf
);

526 
pbOuutBuf
 = 
NULL
;

527 
pIÅutBuf
 = 
NULL
;

531 
	`l£ek
 (
fdFax
, 9, 
SEEK_SET
);

532 
	`HPLIPPUTINT32
 ((
szFeH—d”
 + 9), 
uiPageNum
);

533 
	`wr™e
 (
fdFax
, 
szFeH—d”
 + 9, 4);

540 
BYTE
 *
pTmp
;

541 
iSize
;

542 
pTmp
 = 
NULL
;

544 
iSize
 = 
	`l£ek
 (
fdFax
, 0, 
SEEK_END
);

545 
	`l£ek
 (
fdFax
, 0, 
SEEK_SET
);

547 ià(
iSize
 > 0)

548 
pTmp
 = 
Ãw
 
BYTE
[
iSize
];

549 ià(
pTmp
 =ğ
NULL
)

551 
iSize
 = 1024;

552 
pTmp
 = 
Ãw
 
BYTE
[
iSize
];

553 ià(
pTmp
 =ğ
NULL
)

555 
BUGOUT
;

558 (
i
 = 
	`»ad
 (
fdFax
, 
pTmp
, 
iSize
)) > 0)

560 
	`wr™e
 (
pFaxSŒuù
->
iOuutP©h
, 
pTmp
, 
i
);

562 
d–‘e
 [] 
pTmp
;

564 
BUGOUT
:

565 ià(
fdFax
 > 0)

567 
	`şo£
 (
fdFax
);

570 ià(
pFaxSŒuù
 !ğ
NULL
)

572 #ifdeà
CAPTURE


573 
pFaxSŒuù
->
	`EndSüt
 ();

576 ià(
pThisSÿnLše
 !ğ
NULL
)

578 
	`ä“
 (
pThisSÿnLše
);

580 ià(
pbOuutBuf
)

582 
	`ä“
 (
pbOuutBuf
);

585 ià(
pIÅutBuf
)

587 
	`ä“
 (
pIÅutBuf
);

590 ià(
pFaxSŒuù
)

592 
d–‘e
 
pFaxSŒuù
;

593 
pFaxSŒuù
 = 
NULL
;

596 ià(
ùx
 !ğ
NULL
)

598 
	`ijs_£rv”_dÚe
 (
ùx
);

601 
	`ex™
(
¡©us
);

602 
	}
}

605 
	#RGB2BW
(
r
, 
g
, 
b
è(
BYTE
è((Ô << 2è+„ + (g << 3è+ g + (b << 1)è>> 4)

	)

607 
	$RGB2G¿y
 (
BYTE
 *
pRGBD©a
, 
iNumPix–s
, BYTE *
pGD©a
)

609 
i
;

610 
BYTE
 *
pIn
 = 
pRGBD©a
;

611 
BYTE
 *
pOut
 = 
pGD©a
;

612 
i
 = 0; i < 
iNumPix–s
; i++, 
pIn
 += 3)

614 *
pOut
++ = 
	`RGB2BW
 ((è*
pIn
, ()…In[1], ()…In[2]);

616 
	}
}

	@prnt/hpijs/hpijsfax.h

32 #ifdeà 
HAVE_LIBHPIP


34 #iâdeà
HPIJSFAX_H


35 
	#HPIJSFAX_H


	)

37 
	#IJS_MAX_PARAM
 256

	)

39 
	~"bug.h
"

45 
	#RASTER_BITMAP
 0

	)

46 
	#RASTER_GRAYMAP
 1

	)

47 
	#RASTER_MH
 2

	)

48 
	#RASTER_MR
 3

	)

49 
	#RASTER_MMR
 4

	)

50 
	#RASTER_RGB
 5

	)

51 
	#RASTER_YCC411
 6

	)

52 
	#RASTER_JPEG
 7

	)

53 
	#RASTER_PCL
 8

	)

54 
	#RASTER_NOT
 9

	)

55 
	#RASTER_AUTO
 99

	)

57 
	#HPLIPFAX_MONO
 1

	)

58 
	#HPLIPFAX_COLOR
 2

	)

60 
	#HPLIPPUTINT32
(
by‹¬r
, 
v®
) \

61 
by‹¬r
[0] = (
v®
 & 0xFF000000) >> 24; \

62 
by‹¬r
[1] = (
v®
 & 0x00FF0000) >> 16; \

63 
by‹¬r
[2] = (
v®
 & 0x0000FF00) >> 8; \

64 
by‹¬r
[3] = (
v®
 & 0x000000FF)

	)

66 
	#HPLIPPUTINT16
(
by‹¬r
, 
v®
) \

67 
by‹¬r
[0] = (
v®
 & 0x0000FF00) >> 8; \

68 
by‹¬r
[1] = (
v®
 & 0x000000FF)

	)

93 şas 
	cHPIJSFax


96 
	mpublic
:

97 
	$HPIJSFax
 ()

99 
iQu®™y
 = 2;

100 
iCŞÜMode
 = 1;

101 
iMedŸTy³
 = 0;

102 
iP­”Size
 = 1;

103 
iFœ¡Ra¡”
 = 1;

104 
iFaxEncodšg
 = 
RASTER_MH
;

105 
fP­”Width
 = 8.5;

106 
fP­”Height
 = 11.0;

107 
	`¡rıy
 (
m_szDeviûName
, "HPFax");

109 *
	$G‘DeviûName
 ()

111  
m_szDeviûName
;

112 
	}
}

113 
	$S‘DeviûName
 (*
szDeviûName
)

115 
	`¡rıy
 (
m_szDeviûName
, 
szDeviûName
);

116 
	}
}

117 
	$S‘OuutP©h
 (
fd
)

119 
iOuutP©h
 = 
fd
;

120 
	}
}

121 
	$S‘P­”Size
 (
w
, 
h
)

123 
fP­”Width
 = 
w
;

124 
fP­”Height
 = 
h
;

125 ià(
	`çbs
 (8.5 - 
w
) < 0.05 && fabs (11.0 - w) < 0.05)

127 
iP­”Size
 = 1;

129 ià(
	`çbs
 (8.27 - 
w
è< 0.05 && fab (11.69 - 
h
) < 0.05)

131 
iP­”Size
 = 2;

133 ià(
	`çbs
 (8.5 - 
w
è< 0.05 && fab (14.0 - 
h
) < 0.05)

135 
iP­”Size
 = 3;

137 
	}
}

138 
	$S‘P­”Width
 (
w
)

140 
fP­”Width
 = 
w
;

141 
	}
}

142 
	$S‘P­”Height
 (
h
)

144 
fP­”Height
 = 
h
;

145 
	}
}

146 
	$G‘Qu®™y
 ()

148  
iQu®™y
;

149 
	}
}

150 
	$S‘Qu®™y
 (
iQ
)

152 
iQu®™y
 = 
iQ
;

153 
	}
}

154 
	$S‘MedŸTy³
 (
iM
)

156 
iMedŸTy³
 = 
iM
;

157 
	}
}

158 
	$S‘CŞÜMode
 (
iCm
)

160 
iCŞÜMode
 = 
iCm
;

161 ià(
iCm
 =ğ
HPLIPFAX_COLOR
)

163 
iFaxEncodšg
 = 
RASTER_JPEG
;

165 
	}
}

166 
	$S‘Fœ¡Ra¡”
 (
iFœ¡
)

168 
iFœ¡Ra¡”
 = 
iFœ¡
;

169 
	}
}

170 
	$S‘FaxEncodšg
 (
iV®
)

172 
iFaxEncodšg
 = 
iV®
;

173 ià(
iCŞÜMode
 =ğ
HPLIPFAX_COLOR
)

175 
iFaxEncodšg
 = 
RASTER_JPEG
;

178 ià(
iV®
 =ğ
RASTER_AUTO
)

180 *
pDev
 = 
	`g‘’v
 ("DEVICE_URI");

181 
iFaxEncodšg
 = 
RASTER_MH
;

182 ià(
pDev
 =ğ
NULL
)

186 ià((
	`¡r¡r
 (
pDev
, "Laser") || strstr (pDev, "laser")))

188 
iFaxEncodšg
 = 
RASTER_MMR
;

191 
	}
}

193 
	$G‘FaxEncodšg
 ()

195  
iFaxEncodšg
;

196 
	}
}

197 
	$G‘CŞÜMode
 ()

199  
iCŞÜMode
;

200 
	}
}

201 
	$G‘MedŸTy³
 ()

203  
iMedŸTy³
;

204 
	}
}

205 
	$G‘P­”Size
 ()

207  
iP­”Size
;

208 
	}
}

209 
	$G‘P­”Width
 ()

211  
fP­”Height
;

212 
	}
}

213 
	$G‘P­”Height
 ()

215  
fP­”Height
;

216 
	}
}

217 
	$IsFœ¡Ra¡”
 ()

219  
iFœ¡Ra¡”
;

220 
	}
}

221 
	$PršbËS¹X
 ()

225 
	}
}

226 
	$PršbËS¹Y
 ()

229 
	}
}

230 
	$PršbËWidth
 ()

232  
fP­”Width
 - (2.0 * 0.125);

233 
	}
}

234 
	$PršbËHeight
 ()

236  
fP­”Height
 - (2.0 * 0.125);

237 
	}
}

238 
	$PhysiÿlPageSizeX
 ()

240  
fP­”Width
;

241 
	}
}

242 
	$PhysiÿlPageSizeY
 ()

244  
fP­”Height
;

245 
	}
}

246 
	$EfãùiveResŞutiÚX
 ()

248 ià(
iQu®™y
 == 3)

253 
	}
}

254 
	$EfãùiveResŞutiÚY
 ()

256 ià(
iQu®™y
 == 2)

260 ià(
iQu®™y
 == 3)

265 
	}
}

267 
IjsPageH—d”
 
	gph
;

268 
	giOuutP©h
;

269 
	g´iv©e
:

270 
iQu®™y
;

271 
	giCŞÜMode
;

272 
	giMedŸTy³
;

273 
	giP­”Size
;

274 
	giFaxEncodšg
;

275 
	gfP­”Width
;

276 
	gfP­”Height
;

277 
	giFœ¡Ra¡”
;

278 
	gm_szDeviûName
[64];

281 
RGB2G¿y
 (
BYTE
 *
pRGBD©a
, 
iNumPix–s
, BYTE *
pBWD©a
);

	@prnt/hpijs/hpiom.c

32 #ifdeà
HAVE_LIBHPIP


34 
	~<sys/ty³s.h
>

35 
	~<sys/¡©.h
>

36 
	~<sys/sock‘.h
>

37 
	~<Ãtš‘/š.h
>

38 
	~<Ãtdb.h
>

39 
	~<¡dio.h
>

40 
	~<¡dlib.h
>

41 
	~<fú.h
>

42 
	~<¡ršg.h
>

43 
	~<uni¡d.h
>

44 
	~"hpijs.h
"

45 
	~"hpiom.h
"

47 cÚ¡ 
	ggnMaxD©aSize
 = 2048;

48 cÚ¡ 
	ggnMaxCmdO±iÚSize
 = 4;

50 cÚ¡ 
	ggcF¿meM¬k”
 = '$';

51 cÚ¡ 
	ggnPaddšg
 = 255;

52 cÚ¡ 
	ggnRequœedSize
 = 11;

53 cÚ¡ 
	ggnMšCommªdSize
 = 16;

54 cÚ¡ 
	ggnMšDecodeSize
 = 10;

57 cÚ¡ 
	ggUV8F¿meOff£t
 = 0;

58 cÚ¡ 
	ggUV16CommªdL’gthOff£t
 = 1;

59 cÚ¡ 
	ggUV8Un™Numb”Off£t
 = 3;

60 cÚ¡ 
	ggE8Pack‘Ty³Off£t
 = 4;

61 cÚ¡ 
	ggUV8CommªdNumb”Off£t
 = 5;

62 cÚ¡ 
	ggUV16Reã»nûNumb”Off£t
 = 6;

63 cÚ¡ 
	ggUV16D©aL’gthOff£t
 = 8;

64 cÚ¡ 
	ggUV8CommªdO±iÚsOff£t
 = 10;

66 cÚ¡ 
	ggUV8Re¥F¿meOff£t
 = 0;

67 cÚ¡ 
	ggUV16Re¥CommªdL’gthOff£t
 = 1;

68 cÚ¡ 
	ggUV8Re¥Un™Numb”Off£t
 = 3;

69 cÚ¡ 
	ggE8Re¥Pack‘Ty³Off£t
 = 4;

70 cÚ¡ 
	ggUV8Re¥CommªdNumb”Off£t
 = 5;

71 cÚ¡ 
	ggUV16Re¥Reã»nûNumb”Off£t
 = 6;

72 cÚ¡ 
	ggUV16Re¥D©aL’gthOff£t
 = 8;

73 cÚ¡ 
	ggE8Re¥Com¶‘eOff£t
 = 10;

77 cÚ¡ 
	ggnMšRefNum
 = 0xF000;

78 cÚ¡ 
	ggnMaxRefNum
 = 0xFFFD;

80 
	ggwSynchRefNum
 = 0xFFEC;

81 
	ggwSynchCom¶‘eRefNum
 = 0xFFEB;

82 
	ggwRe£tRefNum
 = 0xFFEA;

84 
	ggwPrš‹rV”siÚQu”yRefNum
 = 0xFFD0;

85 
	ggwPrš‹rStusQu”yRefNum
 = 0xFFD1;

86 
	ggwPrš‹rA‰ribu‹sQu”yRefNum
 = 0xFFD2;

87 
	ggwAlignm’tQu”yRefNum
 = 0xFFD3;

88 
	ggwDeviûIdQu”yRefNum
 = 0xFFDD;

89 
	ggwHueCom³n§tiÚQu”yRefNum
 = 0xFFDE;

95 cÚ¡ 
	ggnPrš‹rQu”yO±iÚsSize
 = 4;

97 
	ggpPrš‹rV”siÚQu”y
[] = { 0x00, 0x00, 0x00, 0x00 };

100 
	ggpAlignm’tQu”y
[] = { 0x03, 0x00, 0x00, 0x00 };

103 
	ggpP’Alignm’tQu”y
[] = { 0x0F, 0x00, 0x00, 0x00 };

109 
	gEncodeCommªd


111 *
	gÍBufãr
,

112 
	gwBufãrSize
,

113 
	gunUn™Numb”
,

114 
	gePack‘Ty³
,

115 
	geCommªdNumb”
,

116 *
	gÍD©a
,

117 
	gwD©aL’gth
,

118 *
	gÍCommªdO±iÚs
,

119 
	gwCommªdO±iÚsSize
,

120 *
	gdPack‘Size
,

121 
	gwRefNum


124 
	gx
;

125 
	glNumPaddšgN“ded
 = 0;

126 *
	gÍTemp
 = 
NULL
;

128 
mem£t
Ğ
ÍBufãr
, 0, 
wBufãrSize
 );

129 
	gÍBufãr
 [ 
gUV8F¿meOff£t
 ] = 
gcF¿meM¬k”
;

130 
	gÍBufãr
 [ 
gUV8Un™Numb”Off£t
 ] = 
unUn™Numb”
;

131 
	gÍBufãr
 [ 
gE8Pack‘Ty³Off£t
 ] = 
ePack‘Ty³
;

132 
	gÍBufãr
 [ 
gUV8CommªdNumb”Off£t
 ] = 
eCommªdNumb”
;

133 *(*)(
	gÍBufãr
 + 
	ggUV16D©aL’gthOff£t
èğ
htÚs
(
wD©aL’gth
);

135 iàĞ
	gwCommªdO±iÚsSize
 > 0 )

137 iàĞ
	gÍCommªdO±iÚs
 )

140 
memıy
(Ğ
ÍBufãr
 + 
gUV8CommªdO±iÚsOff£t
 ), 
ÍCommªdO±iÚs
, 
wCommªdO±iÚsSize
);

145 
mem£t
(Ğ
ÍBufãr
 + 
gUV8CommªdO±iÚsOff£t
 ), 0, 
wCommªdO±iÚsSize
 );

150 *
	gdPack‘Size
 = 
gnRequœedSize
 + 
wCommªdO±iÚsSize
;

151 
	glNumPaddšgN“ded
 = 
gnMšCommªdSize
 - *
dPack‘Size
;

153 iàĞ
	glNumPaddšgN“ded
 > 0 )

156 
	gÍTemp
 = 
ÍBufãr
 + 
gUV8CommªdO±iÚsOff£t
 + 
wCommªdO±iÚsSize
;

158 
	gx
 = 0; x < 
	glNumPaddšgN“ded
; x++, 
	gÍTemp
++ )

160 *
	gÍTemp
 = 
gnPaddšg
;

163 *
	gdPack‘Size
 = 
gnMšCommªdSize
;

166 *(*)(
	gÍBufãr
 + 
	ggUV16CommªdL’gthOff£t
èğ
htÚs
(*
dPack‘Size
);

167 *(*)(
	gÍBufãr
 + 
	ggUV16Reã»nûNumb”Off£t
èğ
htÚs
(
wRefNum
 ? wRefNum : 1);

170 
	gÍBufãr
[ *
dPack‘Size
 - 1 ] = 
gcF¿meM¬k”
;

172 iàĞ
	gwD©aL’gth
 )

174 ià((*
	gdPack‘Size
 + 
	gwD©aL’gth
è> 
	gwBufãrSize
)

176 
BUG
("uÇbËØfÈd©¨bufã¸EncodeCommªd size=%d\n", 
wD©aL’gth
);

180 iàĞ
	gÍD©a
 )

183 
memıy
Ğ
ÍBufãr
 + *
dPack‘Size
, 
ÍD©a
, 
wD©aL’gth
 );

188 
mem£t
Ğ
ÍBufãr
 + *
dPack‘Size
, 0, 
wD©aL’gth
 );

191 *
	gdPack‘Size
 +ğ
wD©aL’gth
;

197 
	$Synch
(
hd
, 
chª
)

199 
bR‘
 = 0;

200 
dPack‘Size
 = 0;

201 
buf
[4096];

205 
	`EncodeCommªd
(
buf
, (buf)

207 , 
eSynch


208 , 
eCommªdUnknown


209 , 
NULL


210 , 
gnMaxD©aSize


211 , 
NULL


212 , 
gnMaxCmdO±iÚSize


213 , &
dPack‘Size


214 , 
gwSynchRefNum


217 
	`hpmud_wr™e_chªÃl
(
hd
, 
chª
, 
buf
, 
dPack‘Size
, 
EXCEPTION_TIMEOUT
, &
bR‘
);

219 Ğ
bR‘
 );

220 
	}
}

222 
	$SynchCom¶‘e
(
hd
, 
chª
)

224 
bR‘
 = 0;

225 
dPack‘Size
 = 0;

226 
buf
[32];

230 
	`EncodeCommªd
(
buf
, (buf)

232 , 
eSynchCom¶‘e


233 , 
eCommªdUnknown


234 , 
NULL


236 , 
NULL


238 , &
dPack‘Size


239 , 
gwSynchCom¶‘eRefNum


242 
	`hpmud_wr™e_chªÃl
(
hd
, 
chª
, 
buf
, 
dPack‘Size
, 
EXCEPTION_TIMEOUT
, &
bR‘
);

244 Ğ
bR‘
 );

245 
	}
}

247 
	$Re£t
(
hd
, 
chª
)

249 
bR‘
 = 0;

250 
dPack‘Size
 = 0;

251 
buf
[32];

256 
	`EncodeCommªd
(
buf
, (buf)

258 , 
eRe£tLid


259 , 
eCommªdUnknown


260 , 
NULL


262 , 
NULL


264 , &
dPack‘Size


265 , 
gwRe£tRefNum


268 
	`hpmud_wr™e_chªÃl
(
hd
, 
chª
, 
buf
, 
dPack‘Size
, 
EXCEPTION_TIMEOUT
, &
bR‘
);

270 Ğ
bR‘
 );

271 
	}
}

273 
	$R‘r›veAlignm’tV®ues038
(
hd
, 
chª
, 
LDLG’Align
 *
pG
)

275 
n
;

276 
dPack‘Size
 = 0;

277 
buf
[256];

278 
LDLRe¥Ú£Align038
 *
pA
;

281 
	`EncodeCommªd
(
buf
, (buf)

283 , 
eEÇbËRe¥Ú£s


284 , 
eCommªdUnknown


285 , 
NULL


287 , 
NULL


289 , &
dPack‘Size


292 
	`hpmud_wr™e_chªÃl
(
hd
, 
chª
, 
buf
, 
dPack‘Size
, 
EXCEPTION_TIMEOUT
, &
n
);

295 
	`EncodeCommªd
(
buf
, (buf)

297 , 
eCommªd


298 , 
eQu”y


299 , 
NULL


301 , 
gpAlignm’tQu”y


302 , 
gnPrš‹rQu”yO±iÚsSize


303 , &
dPack‘Size


304 , 
gwAlignm’tQu”yRefNum


306 
	`hpmud_wr™e_chªÃl
(
hd
, 
chª
, 
buf
, 
dPack‘Size
, 
EXCEPTION_TIMEOUT
, &
n
);

309 
	`EncodeCommªd
(
buf
, (buf)

311 , 
eDŸbËRe¥Ú£s


312 , 
eCommªdUnknown


313 , 
NULL


315 , 
NULL


317 , &
dPack‘Size


320 
	`hpmud_wr™e_chªÃl
(
hd
, 
chª
, 
buf
, 
dPack‘Size
, 
EXCEPTION_TIMEOUT
, &
n
);

323 
	`hpmud_»ad_chªÃl
(
hd
, 
chª
, 
buf
, (buf), 
EXCEPTION_TIMEOUT
, &
n
);

324 
pA
 = (
LDLRe¥Ú£Align038
 *)
buf
;

325 
	`mem£t
(
pG
, 0, (
LDLG’Align
));

326 ià(
pA
->
h
.
·ck‘_ty³
 == 16)

328 
pG
->
nP’s
 = 2;

330 
pG
->
³n
[0].
cŞÜ
 = 0;

331 
pG
->
³n
[0].
v”t
 = -
pA
->
c
[0];

332 
pG
->
³n
[0].
hÜz
 = -
pA
->
c
[1];

333 
pG
->
³n
[0].
bi
 = 
pA
->
k
[2];

334 
pG
->
³n
[1].
cŞÜ
 = 1;

335 
pG
->
³n
[1].
v”t
 = 
pA
->
k
[0];

336 
pG
->
³n
[1].
hÜz
 = 
pA
->
k
[1];

337 
pG
->
³n
[1].
bi
 = 
pA
->
c
[2];

341 
	}
}

343 
	$R‘r›veAlignm’tV®ues043
(
hd
, 
chª
, 
LDLG’Align
 *
pG
)

345 
n
=0;

346 
dPack‘Size
 = 0;

347 
buf
[256];

348 
LDLRe¥Ú£Align043
 *
pA
;

351 
	`EncodeCommªd
(
buf
, (buf)

353 , 
eEÇbËRe¥Ú£s


354 , 
eCommªdUnknown


355 , 
NULL


357 , 
NULL


359 , &
dPack‘Size


362 
	`hpmud_wr™e_chªÃl
(
hd
, 
chª
, 
buf
, 
dPack‘Size
, 
EXCEPTION_TIMEOUT
, &
n
);

365 
	`EncodeCommªd
(
buf
, (buf)

367 , 
eCommªd


368 , 
eQu”y


369 , 
NULL


371 , 
gpP’Alignm’tQu”y


372 , 
gnPrš‹rQu”yO±iÚsSize


373 , &
dPack‘Size


374 , 
gwAlignm’tQu”yRefNum


376 
	`hpmud_wr™e_chªÃl
(
hd
, 
chª
, 
buf
, 
dPack‘Size
, 
EXCEPTION_TIMEOUT
, &
n
);

379 
	`EncodeCommªd
(
buf
, (buf)

381 , 
eDŸbËRe¥Ú£s


382 , 
eCommªdUnknown


383 , 
NULL


385 , 
NULL


387 , &
dPack‘Size


390 
	`hpmud_wr™e_chªÃl
(
hd
, 
chª
, 
buf
, 
dPack‘Size
, 
EXCEPTION_TIMEOUT
, &
n
);

392 
	`hpmud_»ad_chªÃl
(
hd
, 
chª
, 
buf
, (buf), 
EXCEPTION_TIMEOUT
, &
n
);

393 
pA
 = (
LDLRe¥Ú£Align043
 *)
buf
;

394 
	`mem£t
(
pG
, 0, (
LDLG’Align
));

395 ià(
pA
->
h
.
·ck‘_ty³
 == 16)

397 
	`memıy
(
pG
, &
pA
->
g
, (
LDLG’Align
));

401 
	}
}

403 
ušt32_t
 
	$R‘r›veV”siÚ
(
hd
, 
chª
)

405 
n
, 
v”siÚ
=0;

406 
dPack‘Size
 = 0;

407 
buf
[256];

408 
LDLRe¥Ú£V”siÚ
 *
pV
;

411 
	`EncodeCommªd
(
buf
, (buf)

413 , 
eEÇbËRe¥Ú£s


414 , 
eCommªdUnknown


415 , 
NULL


417 , 
NULL


419 , &
dPack‘Size


422 
	`hpmud_wr™e_chªÃl
(
hd
, 
chª
, 
buf
, 
dPack‘Size
, 
EXCEPTION_TIMEOUT
, &
n
);

425 
	`EncodeCommªd
(
buf
, (buf)

427 , 
eCommªd


428 , 
eQu”y


429 , 
NULL


431 , 
gpPrš‹rV”siÚQu”y


432 , 
gnPrš‹rQu”yO±iÚsSize


433 , &
dPack‘Size


434 , 
gwAlignm’tQu”yRefNum


436 
	`hpmud_wr™e_chªÃl
(
hd
, 
chª
, 
buf
, 
dPack‘Size
, 
EXCEPTION_TIMEOUT
, &
n
);

439 
	`EncodeCommªd
(
buf
, (buf)

441 , 
eDŸbËRe¥Ú£s


442 , 
eCommªdUnknown


443 , 
NULL


445 , 
NULL


447 , &
dPack‘Size


450 
	`hpmud_wr™e_chªÃl
(
hd
, 
chª
, 
buf
, 
dPack‘Size
, 
EXCEPTION_TIMEOUT
, &
n
);

452 
	`hpmud_»ad_chªÃl
(
hd
, 
chª
, 
buf
, (buf), 
EXCEPTION_TIMEOUT
, &
n
);

453 
pV
 = (
LDLRe¥Ú£V”siÚ
 *)
buf
;

454 ià(
pV
->
h
.
·ck‘_ty³
 == 16)

456 
v”siÚ
 = 
	`Áohl
(
pV
->
ldlv”siÚ
);

457 
	`årštf
(
¡dout
, "lid v”siÚ = %x\n", 
v”siÚ
);

460 (
v”siÚ
);

461 
	}
}

469 
	$R—dHPV”tAlign
(
hd
)

471 
chªÃl
, 
n
, 
i
, 
x2cŞÜV”t
=-1;

472 
ušt32_t
 
v”
;

473 
LDLG’Align
 
ga
;

475 ià(
	`hpmud_İ’_chªÃl
(
hd
, "PRINT", &
chªÃl
è!ğ
HPMUD_R_OK
)

477 
	`BUG
("unableo open…rint channel ReadHPVertAlign\n");

478 
bugout
;

481 ià(
	`Synch
(
hd
, 
chªÃl
)==0)

483 
	`BUG
("unableo write sync ReadHPVertAlign\n");

484 
bugout
;

487 ià(
	`SynchCom¶‘e
(
hd
, 
chªÃl
)==0)

489 
	`BUG
("unableo write sync complete ReadHPVertAlign\n");

490 
bugout
;

493 ià(
	`Re£t
(
hd
, 
chªÃl
)==0)

495 
	`BUG
("unableo write„eset ReadHPVertAlign\n");

496 
bugout
;

499 ià((
v”
 = 
	`R‘r›veV”siÚ
(
hd
, 
chªÃl
))==0)

501 
	`BUG
("unableo„ead version ReadHPVertAlign\n");

502 
bugout
;

505 ià(
v”
 > 0x308)

506 
	`R‘r›veAlignm’tV®ues043
(
hd
, 
chªÃl
, &
ga
);

508 
	`R‘r›veAlignm’tV®ues038
(
hd
, 
chªÃl
, &
ga
);

510 ià(!(
n
 = 
ga
.
nP’s
))

511 
bugout
;

513 
i
=0; i<
n
; i++)

515 ià(
ga
.
³n
[
i
].
cŞÜ
 == 0 || ga.pen[i].color == 2)

517 
x2cŞÜV”t
 = 
ga
.
³n
[
i
].
v”t
;

518 
	`BUG
("% ®ignm’t: v”t=%d hÜz=%d bi=%d x2c=%d\n", (
ga
.
³n
[
i
].
cŞÜ
==0è? "bÏck" : "phÙo", ga.³n[i].
v”t
, ga.³n[i].
hÜz
, ga.³n[i].
bi
, 
x2cŞÜV”t
);

522 
	`Re£t
(
hd
, 
chªÃl
);

524 
bugout
:

525 ià(
chªÃl
 >= 0)

526 
	`hpmud_şo£_chªÃl
(
hd
, 
chªÃl
);

528  
x2cŞÜV”t
;

529 
	}
}

	@prnt/hpijs/hpiom.h

32 #iâdeà
hpiom_INCLUDED


33 
	#hpiom_INCLUDED


	)

39 
	eePACKETTYPE
{ 
	meCommªd


40 , 
	meDi§bËPacšg


41 , 
	meEÇbËPacšg


42 , 
	meResumeNÜm®O³¿tiÚ


43 , 
	meDŸbËRe¥Ú£s


44 , 
	meEÇbËRe¥Ú£s


45 , 
	meRe£tLid


46 , 
	meSynch


47 , 
	meSynchCom¶‘e


48 , 
	meRe¥Ú£CommªdExecu‹d
 = 16

49 , 
	meRe¥Ú£CommªdDisÿrded


50 , 
	meRe¥Ú£CommªdNÙSuµÜ‹d


51 , 
	meRe¥Ú£Un™Numb”NÙSuµÜ‹d


52 , 
	meRe¥Ú£CommªdL’gthNÙSuµÜ‹d


53 , 
	meRe¥Ú£D©aL’gthNÙSuµÜ‹d


54 , 
	meRe¥Ú£CommªdE¼Ü


55 , 
	meRe¥Ú£PrÙoÿlE¼Ü


56 , 
	meRe¥Ú£Auto


57 , 
	meO³¿tiÚCom¶‘e


58 , 
	meAbsŞu‹C»d™
 = 32

59 , 
	meC»d™


60 , 
	mePack‘Unknown


63 
	eeCOMMANDNUMBER
{ 
	meJobCÚŒŞ


64 , 
	meLßdPage


65 , 
	meEjeùPage


66 , 
	mePrštSw“p


67 , 
	meLßdSw“pD©a


68 , 
	meQu”y


69 , 
	meComm’t
 = 7

70 , 
	meHªdËP’


71 , 
	meUnd”w¬e
 = 11

72 , 
	meDeviûCÚŒŞCommªd


73 , 
	meCommªdUnknown


78 
	m¡¬t_äame
;

79 
	mcmd_Ëngth
;

80 
	mun™_num
;

81 
	m·ck‘_ty³
;

82 
	mcmd_num
;

83 
	m»f_num
;

84 
	md©a_Ëngth
;

85 
	m»¥Ú£_cmp
;

86 
	m·d
[4];

87 
	m’d_äame
;

88 } 
	t__©Œibu‹__
((
	t·cked
)è
	tLDLRe¥Ú£H—d”
;

92 
LDLRe¥Ú£H—d”
 
	mh
;

93 
	mcŞÜs
;

94 
	mk
[3];

95 
	mc
[3];

96 
	mm
[3];

97 
	my
[3];

98 } 
	t__©Œibu‹__
((
	t·cked
)è
	tLDLRe¥Ú£Align038
;

102 
	mcŞÜ
;

103 
	mv”t
;

104 
	mhÜz
;

105 
	mbi
;

106 } 
	t__©Œibu‹__
((
	t·cked
)è
	tLDLP’
;

110 
	mnP’s
;

111 
LDLP’
 
	m³n
[3];

112 } 
	t__©Œibu‹__
((
	t·cked
)è
	tLDLG’Align
;

116 
LDLRe¥Ú£H—d”
 
	mh
;

117 
LDLG’Align
 
	mg
;

118 } 
	t__©Œibu‹__
((
	t·cked
)è
	tLDLRe¥Ú£Align043
;

122 
LDLRe¥Ú£H—d”
 
	mh
;

123 
ušt32_t
 
	mldlv”siÚ
;

124 
	mfœmv”siÚ
[8];

125 } 
	t__©Œibu‹__
((
	t·cked
)è
	tLDLRe¥Ú£V”siÚ
;

127 #ifdeà
__ılu¥lus


131 
R—dHPV”tAlign
(
hd
);

133 #ifdeà
__ılu¥lus


	@prnt/hpijs/hpjbig_wrapper.h

33 *
	mpszCom´es£dD©a
;

34 
	mdwTÙ®Size
;

35 } 
	tHPLJZjcBuff
;

39 
	mxd
;

40 
	myd
;

41 
	ml0
;

42 
	mmx
;

43 
	mmy
;

44 
	mÜd”
;

45 
	m¶ªes
;

46 
	mdl
;

47 
	md
;

48 
	mİtiÚs
;

49 } 
	tHPLJZjsJbgEncSt
;

	@prnt/hpijs/hpprint_c_api.h

38 #iâdeà
APDK_HPPRINT_C_API_H


39 
	#APDK_HPPRINT_C_API_H


	)

41 
	~"glob®_ty³s.h
"

42 
	~"´š‹rçùÜy.h
"

44 * 
	tJobHªdË
;

45 * 
	tPrštCÚ‹xtHªdË
;

46 * 
	tFÚtHªdË
;

47 * 
	tReã»nûFÚtHªdË
;

48 * 
	tSy¡emS”viûsHªdË
;

50 
	gAPDK_USING_NAMESPACE


56 #ifdeà
__ılu¥lus


60 
DRIVER_ERROR
 
C_Job_C»©e
(
JobHªdË
 *
phNewJob
, 
PrštCÚ‹xtHªdË
 
hPrštCÚ‹xt
);

62 
C_Job_De¡roy
(
JobHªdË
 
hJob
);

64 
DRIVER_ERROR
 
C_Job_S’dRa¡”s
(
JobHªdË
 
hJob
, 
BYTE
* 
ImageD©a
);

66 
DRIVER_ERROR
 
C_Job_SuµÜtS•¬©eBÏck
(
JobHªdË
 
hJob
, 
BOOL
* 
bS•¬©eBÏck
);

68 
DRIVER_ERROR
 
C_Job_S’dMuÉiPÏÃRa¡”s
(
JobHªdË
 
hJob
, 
BYTE
* 
BÏckImageD©a
, BYTE* 
CŞÜImageD©a
);

70 #ià
defšed
(
APDK_FONTS_NEEDED
)

71 
DRIVER_ERROR
 
C_Job_TextOut
(
JobHªdË
 
hJob
, cÚ¡ * 
pTextSŒšg
,

72 
iL’SŒšg
, cÚ¡ 
FÚtHªdË
 
hFÚt
,

73 
iAbsX
, 
iAbsY
 );

76 
DRIVER_ERROR
 
C_Job_NewPage
(
JobHªdË
 
hJob
);

83 
DRIVER_ERROR
 
C_PrštCÚ‹xt_C»©e
(
PrštCÚ‹xtHªdË
 *
phNewPrštCÚ‹xt
,

84 
Sy¡emS”viûsHªdË
 
hSysS”v
,

85 
IÅutPix–sP”Row
,

86 
OuutPix–sP”Row
,

87 
PAPER_SIZE
 
ps
);

89 
C_PrštCÚ‹xt_De¡roy
(
PrštCÚ‹xtHªdË
 
hPrštCÚ‹xt
);

91 
C_PrštCÚ‹xt_Flush
(
PrštCÚ‹xtHªdË
 
hPrštCÚ‹xt
, 
FlushSize
);

93 
DRIVER_ERROR
 
C_PrštCÚ‹xt_S–eùDeviû
(
PrštCÚ‹xtHªdË
 
hPrštCÚ‹xt
, cÚ¡ 
PRINTER_TYPE
 
Mod–
);

95 
C_PrštCÚ‹xt_G‘ModeCouÁ
(
PrštCÚ‹xtHªdË
 
hPrštCÚ‹xt
);

97 
DRIVER_ERROR
 
C_PrštCÚ‹xt_OldS–eùPrštMode
(
PrštCÚ‹xtHªdË
 
hPrštCÚ‹xt
, cÚ¡ 
šdex
);

99 
DRIVER_ERROR
 
C_PrštCÚ‹xt_S–eùPrštMode
(
PrštCÚ‹xtHªdË
 
hPrštCÚ‹xt
,

100 cÚ¡ 
QUALITY_MODE
 
qu®™y_mode
,

101 cÚ¡ 
MEDIATYPE
 
medŸ_ty³
,

102 cÚ¡ 
COLORMODE
 
cŞÜ_mode
,

103 cÚ¡ 
BOOL
 
deviû_‹xt
);

105 
C_PrštCÚ‹xt_OldCu¼’tPrštMode
(
PrštCÚ‹xtHªdË
 
hPrštCÚ‹xt
);

107 
DRIVER_ERROR
 
C_PrštCÚ‹xt_Cu¼’tPrštMode
(
PrštCÚ‹xtHªdË
 
hPrštCÚ‹xt
,

108 
QUALITY_MODE
 
qu®™y_mode
,

109 
MEDIATYPE
 
medŸ_ty³
,

110 
COLORMODE
 
cŞÜ_mode
,

111 
BOOL
 
deviû_‹xt
);

113 cÚ¡ * 
C_PrštCÚ‹xt_G‘ModeName
(
PrštCÚ‹xtHªdË
 
hPrštCÚ‹xt
);

115 
PRINTER_TYPE
 
C_PrštCÚ‹xt_S–eùedDeviû
(
PrštCÚ‹xtHªdË
 
hPrštCÚ‹xt
);

117 #ià
defšed
(
APDK_FONTS_NEEDED
)

118 
Reã»nûFÚtHªdË
 
C_PrštCÚ‹xt_EnumFÚt
(
PrštCÚ‹xtHªdË
 
hPrštCÚ‹xt
, * 
iCu¼Idx
);

120 
FÚtHªdË
 
C_PrštCÚ‹xt_R—lizeFÚt
(
PrštCÚ‹xtHªdË
 
hPrštCÚ‹xt
,

121 cÚ¡ 
šdex
, cÚ¡ 
BYTE
 
bSize
, cÚ¡ 
TEXTCOLOR
 
eCŞÜ
,

122 cÚ¡ 
BOOL
 
bBŞd
, cÚ¡ BOOL 
bIlic
, cÚ¡ BOOL 
bUnd”lše
);

125 
PRINTER_TYPE
 
C_PrštCÚ‹xt_EnumDeviûs
(cÚ¡ 
PrštCÚ‹xtHªdË
 
hPrštCÚ‹xt
, 
FAMILY_HANDLE
& 
çmyHªdË
);

127 
DRIVER_ERROR
 
C_PrštCÚ‹xt_P”fÜmPrš‹rFunùiÚ
(
PrštCÚ‹xtHªdË
 
hPrštCÚ‹xt
, 
PRINTER_FUNC
 
eFunc
);

129 
DRIVER_ERROR
 
C_PrštCÚ‹xt_S‘P­”Size
(
PrštCÚ‹xtHªdË
 
hPrštCÚ‹xt
, 
PAPER_SIZE
 
ps
, 
BOOL
 
bFuÎBËed
);

131 
DRIVER_ERROR
 
C_PrštCÚ‹xt_S‘Pix–sP”Row
(
PrštCÚ‹xtHªdË
 
hPrštCÚ‹xt
,

132 
IÅutPix–sP”Row
,

133 
OuutPix–sP”Row
);

135 
BOOL
 
C_PrštCÚ‹xt_Prš‹rS–eùed
(
PrštCÚ‹xtHªdË
 
hPrštCÚ‹xt
);

137 
BOOL
 
C_PrštCÚ‹xt_Prš‹rFÚtsAvaabË
(
PrštCÚ‹xtHªdË
 
hPrštCÚ‹xt
);

139 
C_PrštCÚ‹xt_IÅutPix–sP”Row
(
PrštCÚ‹xtHªdË
 
hPrštCÚ‹xt
);

141 
C_PrštCÚ‹xt_OuutPix–sP”Row
(
PrštCÚ‹xtHªdË
 
hPrštCÚ‹xt
);

143 
PAPER_SIZE
 
C_PrštCÚ‹xt_G‘P­”Size
(
PrštCÚ‹xtHªdË
 
hPrštCÚ‹xt
);

145 cÚ¡ * 
C_PrštCÚ‹xt_Prš‹rMod–
(
PrštCÚ‹xtHªdË
 
hPrštCÚ‹xt
);

147 cÚ¡ * 
C_PrštCÚ‹xt_Prš‹¹y³ToSŒšg
(
PrštCÚ‹xtHªdË
 
hPrštCÚ‹xt
, 
PRINTER_TYPE
 
±
);

149 
C_PrštCÚ‹xt_IÅutResŞutiÚ
(
PrštCÚ‹xtHªdË
 
hPrštCÚ‹xt
);

151 
DRIVER_ERROR
 
C_PrštCÚ‹xt_S‘IÅutResŞutiÚ
(
PrštCÚ‹xtHªdË
 
hPrštCÚ‹xt
, 
Res
);

153 
C_PrštCÚ‹xt_EfãùiveResŞutiÚX
(
PrštCÚ‹xtHªdË
 
hPrštCÚ‹xt
);

155 
C_PrštCÚ‹xt_EfãùiveResŞutiÚY
(
PrštCÚ‹xtHªdË
 
hPrštCÚ‹xt
);

157 
C_PrštCÚ‹xt_PršbËWidth
(
PrštCÚ‹xtHªdË
 
hPrštCÚ‹xt
);

159 
C_PrštCÚ‹xt_PršbËHeight
(
PrštCÚ‹xtHªdË
 
hPrštCÚ‹xt
);

161 
C_PrštCÚ‹xt_PhysiÿlPageSizeX
(
PrštCÚ‹xtHªdË
 
hPrštCÚ‹xt
);

163 
C_PrštCÚ‹xt_PhysiÿlPageSizeY
(
PrštCÚ‹xtHªdË
 
hPrštCÚ‹xt
);

165 
C_PrštCÚ‹xt_PršbËS¹X
(
PrštCÚ‹xtHªdË
 
hPrštCÚ‹xt
);

167 
C_PrštCÚ‹xt_PršbËS¹Y
(
PrštCÚ‹xtHªdË
 
hPrštCÚ‹xt
);

169 
DRIVER_ERROR
 
C_PrštCÚ‹xt_S’dPrš‹rR—dyD©a
(
PrštCÚ‹xtHªdË
 
hPrštCÚ‹xt
, 
BYTE
* 
¡»am
, 
size
);

175 #ià
defšed
(
APDK_FONTS_NEEDED
)

177 
C_FÚt_De¡roy
(
FÚtHªdË
 
hFÚt
);

179 
DRIVER_ERROR
 
C_FÚt_G‘TextEx‹Á
(
PrštCÚ‹xtHªdË
 
hPrštCÚ‹xt
,
FÚtHªdË
 
hFÚt
,

180 cÚ¡ * 
pTextSŒšg
, cÚ¡ 
iL’SŒšg
,

181 * 
iHeight
, * 
iWidth
);

183 cÚ¡ * 
C_FÚt_G‘Name
(cÚ¡ 
FÚtHªdË
 
hFÚt
);

185 
BOOL
 
C_FÚt_IsBŞdAÎowed
(cÚ¡ 
FÚtHªdË
 
hFÚt
);

187 
BOOL
 
C_FÚt_IsIlicAÎowed
(cÚ¡ 
FÚtHªdË
 
hFÚt
);

189 
BOOL
 
C_FÚt_IsUnd”lšeAÎowed
(cÚ¡ 
FÚtHªdË
 
hFÚt
);

191 
BOOL
 
C_FÚt_IsCŞÜAÎowed
(cÚ¡ 
FÚtHªdË
 
hFÚt
);

193 
BOOL
 
C_FÚt_IsPrİÜtiÚ®
(cÚ¡ 
FÚtHªdË
 
hFÚt
);

195 
BOOL
 
C_FÚt_HasS”if
(cÚ¡ 
FÚtHªdË
 
hFÚt
);

197 
BYTE
 
C_FÚt_G‘P™ch
(cÚ¡ 
FÚtHªdË
 
hFÚt
, cÚ¡ BYTE 
poštsize
);

199 
C_FÚt_G‘_iPoštsize
(cÚ¡ 
FÚtHªdË
 
hFÚt
);

201 
C_FÚt_S‘_iPoštsize
(cÚ¡ 
FÚtHªdË
 
hFÚt
, 
iPoštsize
);

203 
BOOL
 
C_FÚt_G‘_bBŞd
(cÚ¡ 
FÚtHªdË
 
hFÚt
);

205 
C_FÚt_S‘_bBŞd
(cÚ¡ 
FÚtHªdË
 
hFÚt
, 
BOOL
 
bBŞd
);

207 
BOOL
 
C_FÚt_G‘_bIlic
(cÚ¡ 
FÚtHªdË
 
hFÚt
);

209 
C_FÚt_S‘_bIlic
(cÚ¡ 
FÚtHªdË
 
hFÚt
, 
BOOL
 
bIlic
);

211 
BOOL
 
C_FÚt_G‘_bUnd”lše
(cÚ¡ 
FÚtHªdË
 
hFÚt
);

213 
C_FÚt_S‘_bUnd”lše
(cÚ¡ 
FÚtHªdË
 
hFÚt
, 
BOOL
 
bUnd”lše
);

215 
TEXTCOLOR
 
C_FÚt_G‘_eCŞÜ
(cÚ¡ 
FÚtHªdË
 
hFÚt
);

217 
C_FÚt_S‘_eCŞÜ
(cÚ¡ 
FÚtHªdË
 
hFÚt
, 
TEXTCOLOR
 
eCŞÜ
);

219 
C_FÚt_G‘_iP™ch
(cÚ¡ 
FÚtHªdË
 
hFÚt
);

221 
C_FÚt_S‘_iP™ch
(cÚ¡ 
FÚtHªdË
 
hFÚt
, 
iP™ch
);

223 
C_FÚt_Index
(
FÚtHªdË
 
hFÚt
);

227 #ifdeà
__ılu¥lus


	@prnt/hpijs/hpprintapi.h

32 #iâdeà
APDK_HPPRINTAPI_H


33 
	#APDK_HPPRINTAPI_H


	)

35 
	~"glob®_ty³s.h
"

38 
	~"sy¡em£rviûs.h
"

41 #ià
defšed
(
APDK_FONTS_NEEDED
)

42 
	~"fÚt.h
"

47 
	~"cÚ‹xt.h
"

50 
	~"job.h
"

	@prnt/hpijs/hptypes.h

32 #iâdeà
HPTYPES_H


33 
	#HPTYPES_H


	)

48 
	#HPFAR


	)

50 
	#ENVPTR
(
ty³Name
è
HPFAR
 *
	)
typeName

52 
	tHPUIÁ8
;

54 cÚ¡ 
	tHPCUIÁ8
;

56 sigÃd 
	tHPIÁ16
, 
	tENVPTR
(
	tHPIÁ16PŒ
);

58 cÚ¡ sigÃd 
	tHPCIÁ16
, 
	tENVPTR
(
	tHPCIÁ16PŒ
);

60 
	tHPUIÁ16
;

62 
ušt32_t
 
	tHPUIÁ32
, 
	tENVPTR
(
	tHPUIÁ32PŒ
);

64 
	tHPBoŞ
;

66 
HPUIÁ8
 
	tHPBy‹
, 
	tENVPTR
(
	tHPBy‹PŒ
);

68 
HPCUIÁ8
 
	tHPCBy‹
, 
	tENVPTR
(
	tHPCBy‹PŒ
);

70 
HPUIÁ32
 
	tHPUIÁPŒSize
, 
	tENVPTR
(
	tHPUIÁPŒSizePŒ
);

72 
	#kS´šgsE¼ÜTy³
 
HPIÁ16


	)

73 
	#kS´šgsE¼ÜTy³PŒ
 
HPIÁ16PŒ


	)

75 
	#HPTRUE
 1

	)

76 
	#HPFALSE
 0

	)

	@prnt/hpijs/htfed.h

32 #iâdeà
HTFED_H


33 
	#HTFED_H


	)

35 
	#FORWARD_FED
Ğ
th»shŞdV®ue
, 
b™Mask
 )\

37 
tÚe
 = (*
šputPŒ
++ );\

38 
ãdResPŒ
 = 
ãdResTbl
 + (
tÚe
 << 2);\

39 
Ëv–
 = *
ãdResPŒ
++;\

40 ià(
tÚe
 != 0)\

42 
tÚe
 = ( 
tmpShÜtStÜe
 + (
HPIÁ16
)(*
ãdResPŒ
++) );\

43 ià(
tÚe
 >ğ
th»shŞdV®ue
)\

45 
tÚe
 -= 255;\

46 
Ëv–
++;\

48 
Ëv–
)\

53 
¿¡”By‹1
 |ğ
b™Mask
;\

56 
¿¡”By‹2
 |ğ
b™Mask
;\

59 
¿¡”By‹2
 |ğ
b™Mask
; 
¿¡”By‹1
 |= bitMask;\

62 
¿¡”By‹3
 |ğ
b™Mask
;\

65 
¿¡”By‹3
 |ğ
b™Mask
; 
¿¡”By‹1
 |= bitMask;\

68 
¿¡”By‹3
 |ğ
b™Mask
; 
¿¡”By‹2
 |= bitMask;\

71 
¿¡”By‹3
 |ğ
b™Mask
; 
¿¡”By‹2
 |ğb™Mask; 
¿¡”By‹1
 |= bitMask;\

77 
tÚe
 = 
tmpShÜtStÜe
;\

79 *
diffusiÚE¼ÜPŒ
++ = 
tÚe
 >> 1;\

80 
tmpShÜtStÜe
 = *
diffusiÚE¼ÜPŒ
 + (
tÚe
 - (tone >> 1));\

81 }

	)

83 
	#BACKWARD_FED
Ğ
th»shŞdV®ue
, 
b™Mask
 )\

85 
tÚe
 = (*
šputPŒ
-- );\

86 
ãdResPŒ
 = 
ãdResTbl
 + (
tÚe
 << 2);\

87 
Ëv–
 = *
ãdResPŒ
++;\

88 ià(
tÚe
 != 0)\

90 
tÚe
 = ( 
tmpShÜtStÜe
 + (
HPIÁ16
)(*
ãdResPŒ
++) );\

91 ià(
tÚe
 >ğ
th»shŞdV®ue
)\

93 
tÚe
 -= 255;\

94 
Ëv–
++;\

96 
Ëv–
)\

101 
¿¡”By‹1
 |ğ
b™Mask
;\

104 
¿¡”By‹2
 |ğ
b™Mask
;\

107 
¿¡”By‹2
 |ğ
b™Mask
; 
¿¡”By‹1
 |= bitMask;\

110 
¿¡”By‹3
 |ğ
b™Mask
;\

113 
¿¡”By‹3
 |ğ
b™Mask
; 
¿¡”By‹1
 |= bitMask;\

116 
¿¡”By‹3
 |ğ
b™Mask
; 
¿¡”By‹2
 |= bitMask;\

119 
¿¡”By‹3
 |ğ
b™Mask
; 
¿¡”By‹2
 |ğb™Mask; 
¿¡”By‹1
 |= bitMask;\

125 
tÚe
 = 
tmpShÜtStÜe
;\

127 *
diffusiÚE¼ÜPŒ
-- = 
tÚe
 >> 1;\

128 
tmpShÜtStÜe
 = *
diffusiÚE¼ÜPŒ
 + (
tÚe
 - (tone >> 1));\

129 }

	)

	@prnt/hpijs/htmtxhi.cpp

63 
	~"h—d”.h
"

64 
	~"h®áÚ”.h
"

66 
	gAPDK_BEGIN_NAMESPACE


68 
	#D™h”4Lev–HiFe
(
m©rix
,
b™Mask
)\

70 
tÚe
 = (*
šputPŒ
++ );\

71 
ãdResPŒ
 = 
ãdResTbl
 + (
tÚe
 << 2);\

72 
Ëv–
 = *
ãdResPŒ
++;\

73 ià(*(
ãdResPŒ
è>ğ(
HPBy‹
)
m©rix
 )\

75 
Ëv–
++;\

77 
Ëv–
)\

82 
¿¡”By‹1
 |ğ
b™Mask
;\

85 
¿¡”By‹2
 |ğ
b™Mask
;\

88 
¿¡”By‹2
 |ğ
b™Mask
; 
¿¡”By‹1
 |= bitMask;\

91 
¿¡”By‹3
 |ğ
b™Mask
;\

94 
¿¡”By‹3
 |ğ
b™Mask
; 
¿¡”By‹1
 |= bitMask;\

97 
¿¡”By‹3
 |ğ
b™Mask
; 
¿¡”By‹2
 |= bitMask;\

100 
¿¡”By‹3
 |ğ
b™Mask
; 
¿¡”By‹2
 |ğb™Mask; 
¿¡”By‹1
 |= bitMask;\

103 }

	)

128 
DRIVER_ERROR
 
	gH®áÚ”
::
	$HTMATRIXHI_KCMY
 (
THTD™h”P¬msPŒ
 
d™h”P¬msPŒ
,

129 
HPUIÁ16
 
couÁ
)

131 #ià
HPUNUSEDVAR


132 #´agm¨
	`unu£d
(
’vP1
)

135 
THTD™h”P¬msPŒ
 
d™h”P¬ms
 = 
d™h”P¬msPŒ
+
couÁ
;

136 
HPBy‹
 
tÚe
;

137 
HPUIÁ8
 
¿¡”By‹1
,
¿¡”By‹2
, 
¿¡”By‹3
;

138 
HPUIÁ8
 
Ëv–
;

139 
HPIÁ16
 
pix–CouÁ
;

141 
HPUIÁ16
 
numLoİ
 = 
d™h”P¬ms
->
fNumPix
;

142 
HPBy‹PŒ
 
šputPŒ
 = 
d™h”P¬ms
->
fIÅut
;

143 
HPBy‹PŒ
 
ouutPŒ1
, 
ouutPŒ2
, 
ouutPŒ3
;

145 
HPBy‹PŒ
 
ãdResTbl
 = (HPBy‹PŒ)
d™h”P¬ms
->
fFEDResPŒ
;

146 
HPBy‹PŒ
 
ãdResPŒ
;

148 
HPBy‹PŒ
 
m©rixV
 = 
d™h”P¬ms
->
fM©rixV1
;

149 
HPBy‹PŒ
 
m©rixH
;

150 
HPUIÁ16
 
šdex
;

151 
HPUIÁ16
 
m©rixRowSize
 = 
d™h”P¬ms
->
fM©rixRowSize
;

153 
¿¡”By‹1
 = 0;

154 
¿¡”By‹2
 = 0;

155 
¿¡”By‹3
 = 0;

157 
ouutPŒ1
 = 
d™h”P¬ms
->
fOuut1
;

158 
ouutPŒ2
 = 
d™h”P¬ms
->
fOuut2
;

159 
ouutPŒ3
 = 
d™h”P¬ms
->
fOuut3
;

161 ià(!
d™h”P¬ms
->
fSymm‘ricFÏg
)

162  
SYSTEM_ERROR
;

164 
šdex
 = (
d™h”P¬ms
->
fD™h”C–lOff£t
 + d™h”P¬ms->
fSqu“zeOff£t
è% (
m©rixRowSize
);

165 
m©rixH
 = 
m©rixV
 + 
šdex
;

167 
pix–CouÁ
 = 
numLoİ
 + 8; (pixelCount -= 8) > 0; )

171 iàĞ
šdex
 =ğ
m©rixRowSize
 )

173 
m©rixH
 = 
m©rixV
;

174 
šdex
 = 0;

177 
	`D™h”4Lev–HiFe
(*
m©rixH
,0x80);

178 
m©rixH
++;

179 
	`D™h”4Lev–HiFe
(*
m©rixH
,0x40);

180 
m©rixH
++;

181 
	`D™h”4Lev–HiFe
(*
m©rixH
,0x20);

182 
m©rixH
++;

183 
	`D™h”4Lev–HiFe
(*
m©rixH
,0x10);

184 
m©rixH
++;

185 
	`D™h”4Lev–HiFe
(*
m©rixH
,0x08);

186 
m©rixH
++;

187 
	`D™h”4Lev–HiFe
(*
m©rixH
,0x04);

188 
m©rixH
++;

189 
	`D™h”4Lev–HiFe
(*
m©rixH
,0x02);

190 
m©rixH
++;

191 
	`D™h”4Lev–HiFe
(*
m©rixH
,0x01);

192 
m©rixH
++;

194 *
ouutPŒ1
++ |ğ
¿¡”By‹1
;

195 ià(
ouutPŒ2
)

196 *
ouutPŒ2
++ |ğ
¿¡”By‹2
;

197 
¿¡”By‹1
 = 0;

198 
¿¡”By‹2
 = 0;

200 
šdex
 += 8;

202  
NO_ERROR
;

203 
	}
}

205 
	gBay”M©rix
[] =

218 
	gAPDK_END_NAMESPACE


	@prnt/hpijs/ijs.c

25 
	~<¡ršg.h
>

26 
	~"uni¡d_.h
"

27 
	~"ijs.h
"

30 
	$ijs_put_št
 (*
p
, 
v®
)

32 
p
[0] = (
v®
 >> 24) & 0xff;

33 
p
[1] = (
v®
 >> 16) & 0xff;

34 
p
[2] = (
v®
 >> 8) & 0xff;

35 
p
[3] = 
v®
 & 0xff;

36 
	}
}

39 
	$ijs_£nd_š™
 (
IjsS’dChª
 *
ch
, 
fd
)

41 
ch
->
fd
 = fd;

42 
ch
->
buf_size
 = 0;

43 
	}
}

46 
	$ijs_£nd_št
 (
IjsS’dChª
 *
ch
, 
v®
)

48 ià((
ch
->
buf_size
 + 4è> ()(ch->
buf
))

49  
IJS_ERANGE
;

50 
	`ijs_put_št
 (
ch
->
buf
 + ch->
buf_size
, 
v®
);

51 
ch
->
buf_size
 += 4;

53 
	}
}

56 
	$ijs_£nd_begš
 (
IjsS’dChª
 *
ch
, 
IjsCommªd
 
cmd
)

58 ià(
ch
->
buf_size
 != 0)

59  
IJS_EINTERNAL
;

60 
	`ijs_£nd_št
 (
ch
, 
cmd
);

61 
ch
->
buf_size
 += 4;

63 
	}
}

66 
	$ijs_£nd_block
 (
IjsS’dChª
 *
ch
, cÚ¡ *
buf
, 
Ën
)

68 ià((
ch
->
buf_size
 + 
Ën
è> ()(ch->
buf
))

69  
IJS_ERANGE
;

70 
	`memıy
 (
ch
->
buf
 + ch->
buf_size
, buf, 
Ën
);

71 
ch
->
buf_size
 +ğ
Ën
;

73 
	}
}

76 
	$ijs_£nd_buf
 (
IjsS’dChª
 *
ch
)

78 
¡©us
;

80 
	`ijs_put_št
 (
ch
->
buf
 + 4, ch->
buf_size
);

81 
¡©us
 = 
	`wr™e
 (
ch
->
fd
, ch->
buf
, ch->
buf_size
);

82 
¡©us
 = (¡©u =ğ
ch
->
buf_size
è? 0 : 
IJS_EIO
;

83 
ch
->
buf_size
 = 0;

84  
¡©us
;

85 
	}
}

88 
	$ijs_»cv_š™
 (
IjsRecvChª
 *
ch
, 
fd
)

90 
ch
->
fd
 = fd;

91 
ch
->
buf_size
 = 0;

92 
	}
}

95 
	$ijs_g‘_št
 (cÚ¡ *
p
)

97 cÚ¡ *
up
 = (cÚ¡ *)
p
;

98  (
up
[0] << 24) | (up[1] << 16) | (up[2] << 8) | up[3];

99 
	}
}

103 
	$ijs_»cv_»ad
 (
IjsRecvChª
 *
ch
, *
buf
, 
size
)

105 
ix
 = 0;

106 
nby‹s
;

110 
nby‹s
 = 
	`»ad
 (
ch
->
fd
, 
buf
 + 
ix
, 
size
 - ix);

111 ià(
nby‹s
 < 0)

112  
nby‹s
;

113 ià(
nby‹s
 == 0)

114  
ix
;

116 
ix
 +ğ
nby‹s
;

118 
ix
 < 
size
);

119  
ix
;

120 
	}
}

123 
	$ijs_»cv_buf
 (
IjsRecvChª
 *
ch
)

125 
nby‹s
;

126 
d©a_size
;

128 
nby‹s
 = 
	`ijs_»cv_»ad
 (
ch
, ch->
buf
, 8);

129 ià(
nby‹s
 != 8)

130  
IJS_EIO
;

131 
ch
->
buf_size
 = 
	`ijs_g‘_št
 (ch->
buf
 + 4);

132 ià(
ch
->
buf_size
 < 8 || ch->buf_siz> ()(ch->
buf
))

133  
IJS_ERANGE
;

134 
d©a_size
 = 
ch
->
buf_size
 - 8;

135 ià(
d©a_size
 > 0)

137 
nby‹s
 = 
	`ijs_»cv_»ad
 (
ch
, ch->
buf
 + 8, 
d©a_size
);

138 ià(
nby‹s
 !ğ
d©a_size
)

139  
IJS_EIO
;

141 
ch
->
buf_idx
 = 8;

143 
	}
}

157 
	$ijs_»cv_ack
 (
IjsRecvChª
 *
ch
)

159 
¡©us
;

161 
¡©us
 = 
	`ijs_»cv_buf
 (
ch
);

162 ià(
¡©us
 == 0)

164 
cmd
 = 
	`ijs_g‘_št
 (
ch
->
buf
);

166 ià(
cmd
 =ğ
IJS_CMD_NAK
)

168 ià(
ch
->
buf_size
 != 12)

169 
¡©us
 = 
IJS_EPROTO
;

171 
¡©us
 = 
	`ijs_g‘_št
 (
ch
->
buf
 + 8);

174  
¡©us
;

175 
	}
}

178 
	$ijs_»cv_št
 (
IjsRecvChª
 *
ch
, *
v®
)

180 ià(
ch
->
buf_idx
 + 4 > ch->
buf_size
)

181  
IJS_EPROTO
;

182 *
v®
 = 
	`ijs_g‘_št
 (
ch
->
buf
 + ch->
buf_idx
);

183 
ch
->
buf_idx
 += 4;

185 
	}
}

192 
	$ijs_»cv_block
 (
IjsRecvChª
 *
ch
, *
buf
, 
buf_size
)

194 
size
 = 
ch
->
buf_size
 - ch->
buf_idx
;

196 ià(
size
 > 
buf_size
)

197  
IJS_ERANGE
;

198 
	`memıy
 (
buf
, 
ch
->buà+ ch->
buf_idx
, 
size
);

199 
ch
->
buf_idx
 = ch->
buf_size
;

200  
size
;

201 
	}
}

	@prnt/hpijs/ijs.h

28 
	#IJS_VERSION
 35

	)

30 
	tijs_boŞ
;

32 #iâdeà
FALSE


33 
	#FALSE
 0

	)

35 #iâdeà
TRUE


36 
	#TRUE
 1

	)

40 
	mIJS_CMD_ACK
,

41 
	mIJS_CMD_NAK
,

42 
	mIJS_CMD_PING
,

43 
	mIJS_CMD_PONG
,

44 
	mIJS_CMD_OPEN
,

45 
	mIJS_CMD_CLOSE
,

46 
	mIJS_CMD_BEGIN_JOB
,

47 
	mIJS_CMD_END_JOB
,

48 
	mIJS_CMD_CANCEL_JOB
,

49 
	mIJS_CMD_QUERY_STATUS
,

50 
	mIJS_CMD_LIST_PARAMS
,

51 
	mIJS_CMD_ENUM_PARAM
,

52 
	mIJS_CMD_SET_PARAM
,

53 
	mIJS_CMD_GET_PARAM
,

54 
	mIJS_CMD_BEGIN_PAGE
,

55 
	mIJS_CMD_SEND_DATA_BLOCK
,

56 
	mIJS_CMD_END_PAGE
,

57 
	mIJS_CMD_EXIT


58 } 
	tIjsCommªd
;

60 
	tIjsJobId
;

62 
	#IJS_EIO
 -2

	)

63 
	#IJS_EPROTO
 -3

	)

64 
	#IJS_ERANGE
 -4

	)

65 
	#IJS_EINTERNAL
 -5

	)

66 
	#IJS_ENYI
 -6

	)

67 
	#IJS_ESYNTAX
 -7

	)

68 
	#IJS_ECOLORSPACE
 -8

	)

69 
	#IJS_EUNKPARAM
 -9

	)

70 
	#IJS_EJOBID
 -10

	)

71 
	#IJS_ETOOMANYJOBS
 -11

	)

72 
	#IJS_EBUF
 -12

	)

74 
	#IJS_HELO_STR
 "IJS\n\252v1\n"

	)

75 
	#IJS_RESP_STR
 "IJS\n\253v1\n"

	)

78 
	mfd
;

79 
	mbuf
[4096];

80 
	mbuf_size
;

81 } 
	tIjsS’dChª
;

84 
	mfd
;

85 
	mbuf
[4096];

86 
	mbuf_size
;

87 
	mbuf_idx
;

88 } 
	tIjsRecvChª
;

91 
ijs_£nd_š™
 (
IjsS’dChª
 *
ch
, 
fd
);

94 
ijs_£nd_št
 (
IjsS’dChª
 *
ch
, 
v®
);

97 
ijs_£nd_begš
 (
IjsS’dChª
 *
ch
, 
IjsCommªd
 
cmd
);

100 
ijs_£nd_block
 (
IjsS’dChª
 *
ch
, cÚ¡ *
buf
, 
Ën
);

103 
ijs_£nd_buf
 (
IjsS’dChª
 *
ch
);

106 
ijs_g‘_št
 (cÚ¡ *
p
);

109 
ijs_»cv_š™
 (
IjsRecvChª
 *
ch
, 
fd
);

112 
ijs_»cv_»ad
 (
IjsRecvChª
 *
ch
, *
buf
, 
size
);

115 
ijs_»cv_buf
 (
IjsRecvChª
 *
ch
);

118 
ijs_»cv_ack
 (
IjsRecvChª
 *
ch
);

121 
ijs_»cv_št
 (
IjsRecvChª
 *
ch
, *
v®
);

124 
ijs_»cv_block
 (
IjsRecvChª
 *
ch
, *
buf
, 
buf_size
);

	@prnt/hpijs/ijs_client.h

25 #ifdeà
__ılu¥lus


29 
_IjsCl›ÁCtx
 
	tIjsCl›ÁCtx
;

31 
IjsCl›ÁCtx
 *

32 
ijs_švoke_£rv”
 (cÚ¡ *
£rv”_cmd
);

35 
ijs_exec_£rv”
 (cÚ¡ *
£rv”_cmd
, *
pfd_to
, *
pfd_äom
,

36 *
pchd_pid
);

39 
ijs_ş›Á_begš_cmd
 (
IjsCl›ÁCtx
 *
ùx
, 
IjsCommªd
 
cmd
);

42 
ijs_ş›Á_£nd_št
 (
IjsCl›ÁCtx
 *
ùx
, 
v®
);

45 
ijs_ş›Á_£nd_cmd
 (
IjsCl›ÁCtx
 *
ùx
);

48 
ijs_ş›Á_£nd_cmd_wa™
 (
IjsCl›ÁCtx
 *
ùx
);

51 
ijs_ş›Á_£nd_d©a_wa™
 (
IjsCl›ÁCtx
 *
ùx
, 
IjsJobId
 
job_id
,

52 cÚ¡ *
buf
, 
size
);

55 
ijs_ş›Á_İ’
 (
IjsCl›ÁCtx
 *
ùx
);

58 
ijs_ş›Á_şo£
 (
IjsCl›ÁCtx
 *
ùx
);

61 
ijs_ş›Á_begš_job
 (
IjsCl›ÁCtx
 *
ùx
, 
IjsJobId
 
job_id
);

64 
ijs_ş›Á_’d_job
 (
IjsCl›ÁCtx
 *
ùx
, 
IjsJobId
 
job_id
);

67 
ijs_ş›Á_li¡_·¿ms
 (
IjsCl›ÁCtx
 *
ùx
, 
IjsJobId
 
job_id
,

68 *
v®ue
, 
v®ue_size
);

71 
ijs_ş›Á_’um_·¿m
 (
IjsCl›ÁCtx
 *
ùx
, 
IjsJobId
 
job_id
,

72 cÚ¡ *
key
, *
v®ue
,

73 
v®ue_size
);

76 
ijs_ş›Á_£t_·¿m
 (
IjsCl›ÁCtx
 *
ùx
, 
IjsJobId
 
job_id
,

77 cÚ¡ *
key
, cÚ¡ *
v®ue
,

78 
v®ue_size
);

81 
ijs_ş›Á_g‘_·¿m
 (
IjsCl›ÁCtx
 *
ùx
, 
IjsJobId
 
job_id
,

82 cÚ¡ *
key
, *
v®ue
,

83 
v®ue_size
);

86 
ijs_ş›Á_begš_·ge
 (
IjsCl›ÁCtx
 *
ùx
, 
IjsJobId
 
job_id
);

89 
ijs_ş›Á_’d_·ge
 (
IjsCl›ÁCtx
 *
ùx
, 
IjsJobId
 
job_id
);

92 
ijs_ş›Á_g‘_v”siÚ
 (
IjsCl›ÁCtx
 *
ùx
);

94 #ifdeà
__ılu¥lus


	@prnt/hpijs/ijs_server.c

25 
	~<¡dlib.h
>

26 
	~<¡dio.h
>

27 
	~"uni¡d_.h
"

28 
	~<¡ršg.h
>

30 
	~"ijs.h
"

31 
	~"ijs_£rv”.h
"

33 
	#noVERBOSE


	)

36 
	mIJS_N_CHAN_SET
 = 1,

37 
	mIJS_BPS_SET
 = 2,

38 
	mIJS_CS_SET
 = 4,

39 
	mIJS_WIDTH_SET
 = 8,

40 
	mIJS_HEIGHT_SET
 = 16,

41 
	mIJS_DPI_SET
 = 32

42 } 
	tIjsF›ldsS‘
;

44 
	#IJS_FIELDS_REQUIRED
 (
IJS_N_CHAN_SET
 | 
IJS_BPS_SET
 | 
IJS_CS_SET
 | \

45 
IJS_WIDTH_SET
 | 
IJS_HEIGHT_SET
 | 
IJS_DPI_SET
)

	)

47 
	s_IjsS”v”Ctx
 {

48 
	mfd_äom
;

49 
	mchd_pid
;

50 
IjsS’dChª
 
	m£nd_chª
;

51 
IjsRecvChª
 
	m»cv_chª
;

52 
	mv”siÚ
;

55 
IjsBegšJobCb
 *
	mbegš_cb
;

56 *
	mbegš_cb_d©a
;

57 
IjsEndJobCb
 *
	m’d_cb
;

58 *
	m’d_cb_d©a
;

59 
IjsQu”yStusCb
 *
	m¡©us_cb
;

60 *
	m¡©us_cb_d©a
;

61 
IjsLi¡P¬amsCb
 *
	mli¡_cb
;

62 *
	mli¡_cb_d©a
;

63 
IjsEnumP¬amCb
 *
	m’um_cb
;

64 *
	m’um_cb_d©a
;

65 
IjsS‘P¬amCb
 *
	m£t_cb
;

66 *
	m£t_cb_d©a
;

67 
IjsG‘P¬amCb
 *
	mg‘_cb
;

68 *
	mg‘_cb_d©a
;

70 
ijs_boŞ
 
	mš_job
;

71 
IjsJobId
 
	mjob_id
;

73 
IjsPageH—d”
 *
	mph
;

77 
	mf›lds_£t
;

78 
ijs_boŞ
 
	mš_·ge
;

80 *
	mbuf
;

81 
	mbuf_size
;

82 
	mbuf_ix
;

83 *
	mov”æow_buf
;

84 
	mov”æow_buf_size
;

85 
	mov”æow_buf_ix
;

89 
	$ijs_£rv”_dummy_begš_cb
 (*
begš_cb_d©a
,

90 
IjsS”v”Ctx
 *
ùx
,

91 
IjsJobId
 
job_id
)

94 
	}
}

97 
	$ijs_£rv”_dummy_’d_cb
 (*
’d_cb_d©a
,

98 
IjsS”v”Ctx
 *
ùx
,

99 
IjsJobId
 
job_id
)

102 
	}
}

104 
IjsS”v”Ctx
 *

105 
	$ijs_£rv”_š™
 ()

107 
ijs_boŞ
 
ok
 = 
TRUE
;

108 
h–o_buf
[8];

109 
»¥_buf
[8];

110 
nby‹s
;

111 
IjsS”v”Ctx
 *
ùx
 = (IjsS”v”Ctx *)
	`m®loc
 ((IjsServerCtx));

112 
fd_äom
, 
fd_to
;

114 
	`memıy
 (
»¥_buf
, 
IJS_RESP_STR
, (resp_buf));

116 
fd_äom
 = 0;

117 
fd_to
 = 1;

118 #ifdeà
_MSC_VER


119 
	`_£tmode
(
fd_äom
, 
_O_BINARY
);

120 
	`_£tmode
(
fd_to
, 
_O_BINARY
);

122 #ifdeà
VERBOSE


123 
	`årštf
 (
¡d”r
, "fd_äom = %d, fd_tØğ%d\n", 
fd_äom
, 
fd_to
);

125 
	`ijs_»cv_š™
 (&
ùx
->
»cv_chª
, 
fd_äom
);

126 
	`ijs_£nd_š™
 (&
ùx
->
£nd_chª
, 
fd_to
);

127 
nby‹s
 = 
	`»ad
 (
ùx
->
»cv_chª
.
fd
, 
h–o_buf
, (helo_buf));

129 ià(
nby‹s
 !ğ(
h–o_buf
))

130 
ok
 = 
FALSE
;

132 ià(
ok
)

133 
nby‹s
 = 
	`wr™e
 (
ùx
->
£nd_chª
.
fd
, 
»¥_buf
, (resp_buf));

134 ià(
nby‹s
 !ğ(
»¥_buf
))

135 
ok
 = 
FALSE
;

137 
ùx
->
š_job
 = 
FALSE
;

138 
ùx
->
job_id
 = -1;

140 
ùx
->
ph
 = 
NULL
;

141 
ùx
->
š_·ge
 = 
FALSE
;

142 
ùx
->
buf
 = 
NULL
;

143 
ùx
->
ov”æow_buf
 = 
NULL
;

145 
ùx
->
begš_cb
 = 
ijs_£rv”_dummy_begš_cb
;

146 
ùx
->
’d_cb
 = 
ijs_£rv”_dummy_’d_cb
;

148 ià(
ok
)

149  
ùx
;

152 
	`ijs_£rv”_dÚe
 (
ùx
);

153  
NULL
;

155 
	}
}

158 
	$ijs_£rv”_š¡®l_begš_cb
 (
IjsS”v”Ctx
 *
ùx
,

159 
IjsBegšJobCb
 *
begš_cb
, *
begš_cb_d©a
)

161 
ùx
->
begš_cb
 = begin_cb;

162 
ùx
->
begš_cb_d©a
 = begin_cb_data;

164 
	}
}

167 
	$ijs_£rv”_š¡®l_’d_cb
 (
IjsS”v”Ctx
 *
ùx
,

168 
IjsEndJobCb
 *
’d_cb
, *
’d_cb_d©a
)

170 
ùx
->
’d_cb
 =ƒnd_cb;

171 
ùx
->
’d_cb_d©a
 =ƒnd_cb_data;

173 
	}
}

176 
	$ijs_£rv”_š¡®l_¡©us_cb
 (
IjsS”v”Ctx
 *
ùx
,

177 
IjsQu”yStusCb
 *
¡©us_cb
,

178 *
¡©us_cb_d©a
)

180 
ùx
->
¡©us_cb
 = status_cb;

181 
ùx
->
¡©us_cb_d©a
 = status_cb_data;

183 
	}
}

186 
	$ijs_£rv”_š¡®l_li¡_cb
 (
IjsS”v”Ctx
 *
ùx
,

187 
IjsLi¡P¬amsCb
 *
li¡_cb
, *
li¡_cb_d©a
)

189 
ùx
->
li¡_cb
 =†ist_cb;

190 
ùx
->
li¡_cb_d©a
 =†ist_cb_data;

192 
	}
}

195 
	$ijs_£rv”_š¡®l_’um_cb
 (
IjsS”v”Ctx
 *
ùx
,

196 
IjsEnumP¬amCb
 *
’um_cb
, *
’um_cb_d©a
)

198 
ùx
->
’um_cb
 =ƒnum_cb;

199 
ùx
->
’um_cb_d©a
 =ƒnum_cb_data;

201 
	}
}

204 
	$ijs_£rv”_š¡®l_£t_cb
 (
IjsS”v”Ctx
 *
ùx
,

205 
IjsS‘P¬amCb
 *
£t_cb
, *
£t_cb_d©a
)

207 
ùx
->
£t_cb
 = set_cb;

208 
ùx
->
£t_cb_d©a
 = set_cb_data;

210 
	}
}

213 
	$ijs_£rv”_š¡®l_g‘_cb
 (
IjsS”v”Ctx
 *
ùx
,

214 
IjsG‘P¬amCb
 *
g‘_cb
, *
g‘_cb_d©a
)

216 
ùx
->
g‘_cb
 = get_cb;

217 
ùx
->
g‘_cb_d©a
 = get_cb_data;

219 
	}
}

222 
	$ijs_£rv”_ack
 (
IjsS”v”Ctx
 *
ùx
)

224 
¡©us
;

226 
¡©us
 = 
	`ijs_£nd_begš
 (&
ùx
->
£nd_chª
, 
IJS_CMD_ACK
);

227 ià(
¡©us
 < 0)

228  
¡©us
;

229  
	`ijs_£nd_buf
 (&
ùx
->
£nd_chª
);

230 
	}
}

233 
	$ijs_£rv”_dÚe
 (
IjsS”v”Ctx
 *
ùx
)

236 
	`ijs_£rv”_ack
 (
ùx
);

238 
	`ä“
 (
ùx
);

239 
	}
}

242 
	$ijs_£rv”_Çk
 (
IjsS”v”Ctx
 *
ùx
, 
”rÜcode
)

244 
¡©us
;

246 
¡©us
 = 
	`ijs_£nd_begš
 (&
ùx
->
£nd_chª
, 
IJS_CMD_NAK
);

247 ià(
¡©us
 < 0)

248  
¡©us
;

249 
¡©us
 = 
	`ijs_£nd_št
 (&
ùx
->
£nd_chª
, 
”rÜcode
);

250 ià(
¡©us
 < 0)

251  
¡©us
;

252  
	`ijs_£nd_buf
 (&
ùx
->
£nd_chª
);

253 
	}
}

256 (*
	tijs_£rv”_´oc
è(
	tIjsS”v”Ctx
 *
	tùx
);

259 
	$ijs_£rv”_´oc_ack
 (
IjsS”v”Ctx
 *
ùx
)

262  
IJS_EPROTO
;

263 
	}
}

266 
	$ijs_£rv”_´oc_Çk
 (
IjsS”v”Ctx
 *
ùx
)

269  
IJS_EPROTO
;

270 
	}
}

273 
	$ijs_£rv”_´oc_pšg
 (
IjsS”v”Ctx
 *
ùx
)

275 
¡©us
;

276 
v”siÚ
;

278 
¡©us
 = 
	`ijs_»cv_št
 (&
ùx
->
»cv_chª
, &
v”siÚ
);

279 ià(
¡©us
 < 0)

280  
¡©us
;

281 ià(
v”siÚ
 > 
IJS_VERSION
)

282 
v”siÚ
 = 
IJS_VERSION
;

283 
ùx
->
v”siÚ
 = version;

285 #ifdeà
VERBOSE


286 
	`årštf
 (
¡d”r
, "pšg v”siÚ=%d\n", 
v”siÚ
);

288 
¡©us
 = 
	`ijs_£nd_begš
 (&
ùx
->
£nd_chª
, 
IJS_CMD_PONG
);

289 ià(
¡©us
 < 0)

290  
¡©us
;

291 
¡©us
 = 
	`ijs_£nd_št
 (&
ùx
->
£nd_chª
, 
IJS_VERSION
);

292 ià(
¡©us
 < 0)

293  
¡©us
;

294  
	`ijs_£nd_buf
 (&
ùx
->
£nd_chª
);

295 
	}
}

298 
	$ijs_£rv”_´oc_pÚg
 (
IjsS”v”Ctx
 *
ùx
)

301  
IJS_EPROTO
;

302 
	}
}

305 
	$ijs_£rv”_´oc_İ’
 (
IjsS”v”Ctx
 *
ùx
)

308  
	`ijs_£rv”_ack
 (
ùx
);

309 
	}
}

312 
	$ijs_£rv”_´oc_şo£
 (
IjsS”v”Ctx
 *
ùx
)

315  
	`ijs_£rv”_ack
 (
ùx
);

316 
	}
}

319 
	$ijs_£rv”_´oc_begš_job
 (
IjsS”v”Ctx
 *
ùx
)

321 
code
;

322 
IjsJobId
 
job_id
;

324 
code
 = 
	`ijs_»cv_št
 (&
ùx
->
»cv_chª
, &
job_id
);

325 ià(
code
 < 0)  code;

327 ià(
ùx
->
š_job
)

328  
	`ijs_£rv”_Çk
 (
ùx
, 
IJS_ETOOMANYJOBS
);

329 
ùx
->
š_job
 = 
TRUE
;

330 
ùx
->
job_id
 = job_id;

332  
	`ijs_£rv”_ack
 (
ùx
);

333 
	}
}

336 
	$ijs_£rv”_´oc_’d_job
 (
IjsS”v”Ctx
 *
ùx
)

338 
code
;

339 
IjsJobId
 
job_id
;

341 
code
 = 
	`ijs_»cv_št
 (&
ùx
->
»cv_chª
, &
job_id
);

342 ià(
code
 < 0)  code;

344 ià(!
ùx
->
š_job
 || 
job_id
 != ctx->job_id)

345  
	`ijs_£rv”_Çk
 (
ùx
, 
IJS_EJOBID
);

346 
ùx
->
š_job
 = 
FALSE
;

348  
	`ijs_£rv”_ack
 (
ùx
);

349 
	}
}

352 
	$ijs_£rv”_´oc_ÿnûl_job
 (
IjsS”v”Ctx
 *
ùx
)

354 
code
;

355 
IjsJobId
 
job_id
;

357 
code
 = 
	`ijs_»cv_št
 (&
ùx
->
»cv_chª
, &
job_id
);

358 ià(
code
 < 0)  code;

360 ià(!
ùx
->
š_job
 || 
job_id
 != ctx->job_id)

361  
	`ijs_£rv”_Çk
 (
ùx
, 
IJS_EJOBID
);

363 
ùx
->
š_job
 = 
FALSE
;

365  
	`ijs_£rv”_ack
 (
ùx
);

366 
	}
}

369 
	$ijs_£rv”_´oc_qu”y_¡©us
 (
IjsS”v”Ctx
 *
ùx
)

371 
code
;

372 
IjsJobId
 
job_id
;

374 
code
 = 
	`ijs_»cv_št
 (&
ùx
->
»cv_chª
, &
job_id
);

375 ià(
code
 < 0)

376  
code
;

378 ià(!
ùx
->
š_job
 || ctx->
job_id
 != job_id)

379  
	`ijs_£rv”_Çk
 (
ùx
, 
IJS_EJOBID
);

381 
code
 = 
ùx
->
	`¡©us_cb
 (ùx->
li¡_cb_d©a
, ctx, 
job_id
);

382 ià(
code
 < 0)

383  
	`ijs_£rv”_Çk
 (
ùx
, 
code
);

386 
¡©us
;

388 
¡©us
 = 
	`ijs_£nd_begš
 (&
ùx
->
£nd_chª
, 
IJS_CMD_ACK
);

389 ià(
¡©us
 < 0)

390  
¡©us
;

391 
¡©us
 = 
	`ijs_£nd_št
 (&
ùx
->
£nd_chª
, 
code
);

392 ià(
¡©us
 < 0)

393  
¡©us
;

394  
	`ijs_£nd_buf
 (&
ùx
->
£nd_chª
);

396 
	}
}

399 
	$ijs_£rv”_´oc_li¡_·¿ms
 (
IjsS”v”Ctx
 *
ùx
)

401 
code
;

402 
buf
[4096];

403 
IjsJobId
 
job_id
;

405 
code
 = 
	`ijs_»cv_št
 (&
ùx
->
»cv_chª
, &
job_id
);

406 ià(
code
 < 0)

407  
code
;

409 ià(!
ùx
->
š_job
 || ctx->
job_id
 != job_id)

410  
	`ijs_£rv”_Çk
 (
ùx
, 
IJS_EJOBID
);

412 
code
 = 
ùx
->
	`li¡_cb
 (ùx->
li¡_cb_d©a
, ctx, 
job_id
, 
buf
, (buf));

413 ià(
code
 < 0)

414  
	`ijs_£rv”_Çk
 (
ùx
, 
code
);

417 
¡©us
;

419 
¡©us
 = 
	`ijs_£nd_begš
 (&
ùx
->
£nd_chª
, 
IJS_CMD_ACK
);

420 ià(
¡©us
 < 0)

421  
¡©us
;

422 
¡©us
 = 
	`ijs_£nd_block
 (&
ùx
->
£nd_chª
, 
buf
, 
code
);

423 ià(
¡©us
 < 0)

424  
¡©us
;

425  
	`ijs_£nd_buf
 (&
ùx
->
£nd_chª
);

427 
	}
}

430 
	$ijs_£rv”_´oc_’um_·¿m
 (
IjsS”v”Ctx
 *
ùx
)

432 cÚ¡ *
key
;

433 
key_size
;

434 
code
;

435 
buf
[4096];

436 
IjsJobId
 
job_id
;

438 
code
 = 
	`ijs_»cv_št
 (&
ùx
->
»cv_chª
, &
job_id
);

439 ià(
code
 < 0)

440  
code
;

442 ià(!
ùx
->
š_job
 || ctx->
job_id
 != job_id)

443  
	`ijs_£rv”_Çk
 (
ùx
, 
IJS_EJOBID
);

445 
key
 = 
ùx
->
»cv_chª
.
buf
 + ctx->»cv_chª.
buf_idx
;

446 
key_size
 = 
ùx
->
»cv_chª
.
buf_size
 - ctx->»cv_chª.
buf_idx
;

447 ià(
key_size
 =ğ0 || 
key
[key_size - 1])

448  
IJS_ESYNTAX
;

449 #ifdeà
VERBOSE


450 
	`årštf
 (
¡d”r
, "ijs_£rv”_´oc_’um_·¿m, key_sizğ%d\n", 
key_size
);

453 
code
 = 
ùx
->
	`’um_cb
 (ùx->
’um_cb_d©a
, ctx, 
job_id
, 
key
, 
buf
, (buf));

454 ià(
code
 < 0)

455  
	`ijs_£rv”_Çk
 (
ùx
, 
code
);

458 
¡©us
;

460 
¡©us
 = 
	`ijs_£nd_begš
 (&
ùx
->
£nd_chª
, 
IJS_CMD_ACK
);

461 ià(
¡©us
 < 0)

462  
¡©us
;

463 
¡©us
 = 
	`ijs_£nd_block
 (&
ùx
->
£nd_chª
, 
buf
, 
code
);

464 ià(
¡©us
 < 0)

465  
¡©us
;

466  
	`ijs_£nd_buf
 (&
ùx
->
£nd_chª
);

468 
	}
}

471 
	$ijs_¡ºËn
 (cÚ¡ *
s
, 
size
)

473 
i
;

475 
i
 = 0; i < 
size
; i++)

476 ià(
s
[
i
] == 0)

477  
i
;

478  
size
;

479 
	}
}

482 
	$ijs_£rv”_·r£_št
 (cÚ¡ *
v®ue
, 
size
, *
»suÉ
)

484 
num
 = 0;

485 
i
;

486 
sign
 = 1;

488 
i
 = 0;

489 ià(
i
 =ğ
size
)

490  
IJS_ESYNTAX
;

491 ià(
v®ue
[
i
] == '-')

493 
sign
 = -1;

494 
i
++;

497 ià(
i
 =ğ
size
)

498  
IJS_ESYNTAX
;

500 ; 
i
 < 
size
; i++)

502 
c
 = 
v®ue
[
i
];

503 ià(
c
 < '0' || c > '9')

504  
IJS_ESYNTAX
;

505 
num
 = (num * 10è+ (
c
 - '0');

507 *
»suÉ
 = 
num
;

509 
	}
}

512 
	$ijs_£rv”_·r£_æßt
 (cÚ¡ *
v®ue
, 
size
, *
»suÉ
)

514 
buf
[256];

515 *

;

517 ià(
size
 + 1 > (
buf
))

518  
IJS_EBUF
;

519 
	`memıy
 (
buf
, 
v®ue
, 
size
);

520 
buf
[
size
] = 0;

521 *
»suÉ
 = 
	`¡¹od
 (
buf
, &

);

522 ià(

 =ğ
buf
)

523  
IJS_ESYNTAX
;

525 
	}
}

528 
	$ijs_£rv”_£t_·¿m
 (
IjsS”v”Ctx
 *
ùx
, 
IjsJobId
 
job_id
, cÚ¡ *
key
,

529 cÚ¡ *
v®ue
, 
v®ue_size
)

531 
code
;

533 #ifdeà
VERBOSE


534 
	`årštf
 (
¡d”r
, "£t_·¿m % ğ", 
key
);

535 
	`fwr™e
 (
v®ue
, 1, 
v®ue_size
, 
¡d”r
);

536 
	`åuts
 ("\n", 
¡d”r
);

538 ià(!
	`¡rcmp
 (
key
, "NumChan"))

540 
code
 = 
	`ijs_£rv”_·r£_št
 (
v®ue
, 
v®ue_size
, &
ùx
->
ph
->
n_chª
);

541 ià(
code
 == 0)

542 
ùx
->
f›lds_£t
 |ğ
IJS_N_CHAN_SET
;

543  
code
;

545 ià(!
	`¡rcmp
 (
key
, "BitsPerSample"))

547 
code
 = 
	`ijs_£rv”_·r£_št
 (
v®ue
, 
v®ue_size
, &
ùx
->
ph
->
bps
);

548 ià(
code
 == 0)

549 
ùx
->
f›lds_£t
 |ğ
IJS_BPS_SET
;

550  
code
;

552 ià(!
	`¡rcmp
 (
key
, "ColorSpace"))

554 
size
 = 
v®ue_size
;

556 ià(
size
 > ()(
ùx
->
ph
->
cs
) - 1)

557 
size
 = (
ùx
->
ph
->
cs
) - 1;

558 
	`memıy
 (
ùx
->
ph
->
cs
, 
v®ue
, 
size
);

559 
ùx
->
ph
->
cs
[
size
] = 0;

560 
ùx
->
f›lds_£t
 |ğ
IJS_CS_SET
;

563 ià(!
	`¡rcmp
 (
key
, "Width"))

565 
code
 = 
	`ijs_£rv”_·r£_št
 (
v®ue
, 
v®ue_size
, &
ùx
->
ph
->
width
);

566 ià(
code
 == 0)

567 
ùx
->
f›lds_£t
 |ğ
IJS_WIDTH_SET
;

568  
code
;

570 ià(!
	`¡rcmp
 (
key
, "Height"))

572 
code
 = 
	`ijs_£rv”_·r£_št
 (
v®ue
, 
v®ue_size
, &
ùx
->
ph
->
height
);

573 ià(
code
 == 0)

574 
ùx
->
f›lds_£t
 |ğ
IJS_HEIGHT_SET
;

575  
code
;

577 ià(!
	`¡rcmp
 (
key
, "Dpi"))

579 
x_ix
;

581 
x_ix
 = 0; x_ix < 
v®ue_size
; x_ix++)

582 ià(
v®ue
[
x_ix
] == 'x')

584 ià(
x_ix
 =ğ
v®ue_size
)

585  
IJS_ESYNTAX
;

586 
code
 = 
	`ijs_£rv”_·r£_æßt
 (
v®ue
, 
x_ix
, &
ùx
->
ph
->
x»s
);

587 ià(
code
 < 0)

588  
code
;

589 
code
 = 
	`ijs_£rv”_·r£_æßt
 (
v®ue
 + 
x_ix
 + 1, 
v®ue_size
 - (x_ix + 1),

590 &
ùx
->
ph
->
y»s
);

591 ià(
code
 < 0)

592  
code
;

593 
ùx
->
f›lds_£t
 |ğ
IJS_DPI_SET
;

598  
ùx
->
	`£t_cb
 (ùx->
£t_cb_d©a
, ctx, 
job_id
, 
key
, 
v®ue
, 
v®ue_size
);

600 
	}
}

603 
	$ijs_£rv”_´oc_£t_·¿m
 (
IjsS”v”Ctx
 *
ùx
)

605 cÚ¡ *
key
, *
v®ue
;

606 
key_size
, 
v®ue_size
;

607 
IjsJobId
 
job_id
;

608 
·¿m_size
;

609 
code
;

611 
code
 = 
	`ijs_»cv_št
 (&
ùx
->
»cv_chª
, &
job_id
);

612 ià(
code
 < 0)

613  
code
;

615 ià(!
ùx
->
š_job
 || ctx->
job_id
 != job_id)

616  
	`ijs_£rv”_Çk
 (
ùx
, 
IJS_EJOBID
);

618 
code
 = 
	`ijs_»cv_št
 (&
ùx
->
»cv_chª
, &
·¿m_size
);

619 ià(
code
 < 0)

620  
code
;

621 ià(
·¿m_size
 !ğ
ùx
->
»cv_chª
.
buf_size
 - ctx->»cv_chª.
buf_idx
)

622  
IJS_EPROTO
;

623 
key
 = 
ùx
->
»cv_chª
.
buf
 + ctx->»cv_chª.
buf_idx
;

624 
key_size
 = 
	`ijs_¡ºËn
 (
key
, 
ùx
->
»cv_chª
.
buf_size
);

625 ià(
key_size
 =ğ
·¿m_size
)

626  
IJS_EPROTO
;

627 
v®ue
 = 
key
 + 
key_size
 + 1;

628 
v®ue_size
 = 
·¿m_size
 - (
key_size
 + 1);

629 
code
 = 
	`ijs_£rv”_£t_·¿m
 (
ùx
, 
job_id
, 
key
, 
v®ue
, 
v®ue_size
);

630 ià(
code
)

631  
	`ijs_£rv”_Çk
 (
ùx
, 
code
);

633  
	`ijs_£rv”_ack
 (
ùx
);

634 
	}
}

637 
	$ijs_£rv”_g‘_·¿m
 (
IjsS”v”Ctx
 *
ùx
, 
IjsJobId
 
job_id
, cÚ¡ *
key
,

638 *
v®ue
, 
v®ue_size
)

640 #ifdeà
VERBOSE


641 
	`årštf
 (
¡d”r
, "ijs_£rv”_g‘_·¿m %s\n", 
key
);

643  
ùx
->
	`g‘_cb
 (ùx->
g‘_cb_d©a
, ctx, 
job_id
, 
key
,

644 
v®ue
, 
v®ue_size
);

645 
	}
}

648 
	$ijs_£rv”_´oc_g‘_·¿m
 (
IjsS”v”Ctx
 *
ùx
)

650 cÚ¡ *
key
;

651 
key_size
;

652 
code
;

653 
buf
[4096];

654 
IjsJobId
 
job_id
;

656 
code
 = 
	`ijs_»cv_št
 (&
ùx
->
»cv_chª
, &
job_id
);

657 ià(
code
 < 0)

658  
code
;

660 ià(!
ùx
->
š_job
 || ctx->
job_id
 != job_id)

661  
	`ijs_£rv”_Çk
 (
ùx
, 
IJS_EJOBID
);

663 
key
 = 
ùx
->
»cv_chª
.
buf
 + ctx->»cv_chª.
buf_idx
;

664 
key_size
 = 
ùx
->
»cv_chª
.
buf_size
 - ctx->»cv_chª.
buf_idx
;

665 ià(
key_size
 =ğ0 || 
key
[key_size - 1])

666  
IJS_ESYNTAX
;

667 #ifdeà
VERBOSE


668 
	`årštf
 (
¡d”r
, "ijs_£rv”_´oc_g‘_·¿m, key_sizğ%d\n", 
key_size
);

671 
code
 = 
	`ijs_£rv”_g‘_·¿m
 (
ùx
, 
job_id
, 
key
, 
buf
, (buf));

672 ià(
code
 < 0)

673  
	`ijs_£rv”_Çk
 (
ùx
, 
code
);

676 
¡©us
;

678 
¡©us
 = 
	`ijs_£nd_begš
 (&
ùx
->
£nd_chª
, 
IJS_CMD_ACK
);

679 ià(
¡©us
 < 0)

680  
¡©us
;

681 
¡©us
 = 
	`ijs_£nd_block
 (&
ùx
->
£nd_chª
, 
buf
, 
code
);

682 ià(
¡©us
 < 0)

683  
¡©us
;

684  
	`ijs_£nd_buf
 (&
ùx
->
£nd_chª
);

686 
	}
}

689 
	$ijs_£rv”_´oc_begš_·ge
 (
IjsS”v”Ctx
 *
ùx
)

691 
IjsPageH—d”
 *
ph
 = 
ùx
->ph;

692 
¡©us
 = 0;

694 ià(
ph
 =ğ
NULL
)

695 
¡©us
 = 
IJS_EPROTO
;

696 ià((
ùx
->
f›lds_£t
 & 
IJS_FIELDS_REQUIRED
) != IJS_FIELDS_REQUIRED)

697 
¡©us
 = 
IJS_EPROTO
;

698 #ifdeà
VERBOSE


699 
	`årštf
 (
¡d”r
, "begin…age %d %d %d %d %d\n",

700 
ph
->
n_chª
,…h->
bps
,…h->
cs
,…h->
width
,…h->
height
);

702 ià(!
¡©us
)

704 
ùx
->
š_·ge
 = 
TRUE
;

705  
	`ijs_£rv”_ack
 (
ùx
);

708  
	`ijs_£rv”_Çk
 (
ùx
, 
¡©us
);

709 
	}
}

712 
	$ijs_£rv”_»ad_d©a
 (
IjsS”v”Ctx
 *
ùx
, *
buf
, 
size
)

714 
¡©us
;

716 
¡©us
 = 
	`ijs_»cv_»ad
 (&
ùx
->
»cv_chª
, 
buf
, 
size
);

717  (
¡©us
 =ğ
size
è? 0 : 
IJS_EIO
;

718 
	}
}

721 
	$ijs_£rv”_´oc_£nd_d©a_block
 (
IjsS”v”Ctx
 *
ùx
)

723 
size
;

724 
¡©us
 = 0;

725 
IjsJobId
 
job_id
;

727 
¡©us
 = 
	`ijs_»cv_št
 (&
ùx
->
»cv_chª
, &
job_id
);

728 ià(
¡©us
 < 0)  status;

730 ià(!
ùx
->
š_job
 || 
job_id
 != ctx->job_id)

731 
¡©us
 = 
IJS_EJOBID
;

732 ià(
ùx
->
buf
 =ğ
NULL
)

733 
¡©us
 = 
IJS_EPROTO
;

735 ià(!
¡©us
è¡©u ğ
	`ijs_»cv_št
 (&
ùx
->
»cv_chª
, &
size
);

737 #ifdeà
VERBOSE


738 
	`årštf
 (
¡d”r
, "status=%d, send data block id=%d, size=%d\n",

739 
¡©us
, 
job_id
, 
size
);

741 ià(
¡©us
)

742  
	`ijs_£rv”_Çk
 (
ùx
, 
¡©us
);

744 ià(
size
 <ğ
ùx
->
buf_size
 - ctx->
buf_ix
)

746 
¡©us
 = 
	`ijs_£rv”_»ad_d©a
 (
ùx
, ctx->
buf
 + ctx->
buf_ix
, 
size
);

747 
ùx
->
buf_ix
 +ğ
size
;

751 
ùx
->
ov”æow_buf_size
 = 
size
 - (ùx->
buf_size
 - ctx->
buf_ix
);

752 
ùx
->
ov”æow_buf
 = (*)
	`m®loc
 (ùx->
ov”æow_buf_size
);

753 
ùx
->
ov”æow_buf_ix
 = 0;

754 
¡©us
 = 
	`ijs_£rv”_»ad_d©a
 (
ùx
, ctx->
buf
 + ctx->
buf_ix
,

755 
ùx
->
buf_size
 - ctx->
buf_ix
);

756 
ùx
->
buf_ix
 = ctx->
buf_size
;

757 ià(!
¡©us
)

759 
¡©us
 = 
	`ijs_£rv”_»ad_d©a
 (
ùx
, ctx->
ov”æow_buf
,

760 
ùx
->
ov”æow_buf_size
);

763  
	`ijs_£rv”_ack
 (
ùx
);

764 
	}
}

767 
	$ijs_£rv”_´oc_’d_·ge
 (
IjsS”v”Ctx
 *
ùx
)

769 #ifdeà
VERBOSE


770 
	`årštf
 (
¡d”r
, "end…age\n");

772  
	`ijs_£rv”_ack
 (
ùx
);

773 
	}
}

776 
	$ijs_£rv”_´oc_ex™
 (
IjsS”v”Ctx
 *
ùx
)

779 
	}
}

781 
ijs_£rv”_´oc
 
	gijs_£rv”_´ocs
[] = {

782 
ijs_£rv”_´oc_ack
,

783 
ijs_£rv”_´oc_Çk
,

784 
ijs_£rv”_´oc_pšg
,

785 
ijs_£rv”_´oc_pÚg
,

786 
ijs_£rv”_´oc_İ’
,

787 
ijs_£rv”_´oc_şo£
,

788 
ijs_£rv”_´oc_begš_job
,

789 
ijs_£rv”_´oc_’d_job
,

790 
ijs_£rv”_´oc_ÿnûl_job
,

791 
ijs_£rv”_´oc_qu”y_¡©us
,

792 
ijs_£rv”_´oc_li¡_·¿ms
,

793 
ijs_£rv”_´oc_’um_·¿m
,

794 
ijs_£rv”_´oc_£t_·¿m
,

795 
ijs_£rv”_´oc_g‘_·¿m
,

796 
ijs_£rv”_´oc_begš_·ge
,

797 
ijs_£rv”_´oc_£nd_d©a_block
,

798 
ijs_£rv”_´oc_’d_·ge
,

799 
ijs_£rv”_´oc_ex™


803 
	$ijs_£rv”_™”
 (
IjsS”v”Ctx
 *
ùx
)

805 
cmd_num
;

806 
¡©us
;

808 
¡©us
 = 
	`ijs_»cv_buf
 (&
ùx
->
»cv_chª
);

810 ià(
¡©us
 < 0)

811  
¡©us
;

813 
cmd_num
 = 
	`ijs_g‘_št
 (
ùx
->
»cv_chª
.
buf
);

814 #ifdeà
VERBOSE


815 
	`årštf
 (
¡d”r
, "commªd %d, %d by‹s\n", 
cmd_num
, 
ùx
->
»cv_chª
.
buf_size
);

817 ià(
cmd_num
 < 0 ||

818 
cmd_num
 >ğ()(
ijs_£rv”_´ocs
) / (ijs_server_procs[0]))

820  
ijs_£rv”_´ocs
[
cmd_num
] (
ùx
);

821 
	}
}

831 
	$ijs_£rv”_g‘_·ge_h—d”
 (
IjsS”v”Ctx
 *
ùx
, 
IjsPageH—d”
 *
ph
)

833 
¡©us
;

835 
ùx
->
ph
 =…h;

836 
ùx
->
š_·ge
 = 
FALSE
;

840 
¡©us
 = 
	`ijs_£rv”_™”
 (
ùx
);

842 
¡©us
 =ğ0 && !
ùx
->
š_·ge
);

844 
ùx
->
ph
 = 
NULL
;

845  
¡©us
;

846 
	}
}

861 
	$ijs_£rv”_g‘_d©a
 (
IjsS”v”Ctx
 *
ùx
, *
buf
, 
size
)

863 
buf_ix
 = 0;

864 
¡©us
 = 0;

866 #ifdeà
VERBOSE


867 
	`årštf
 (
¡d”r
, "ijs_£rv”_g‘_d©¨%d\n", 
size
);

870 ià(
ùx
->
ov”æow_buf
 !ğ
NULL
)

872 
n_by‹s
 = 
ùx
->
ov”æow_buf_size
 - ctx->
ov”æow_buf_ix
;

873 ià(
n_by‹s
 > 
size
)

874 
n_by‹s
 = 
size
;

875 
	`memıy
 (
buf
, 
ùx
->
ov”æow_buf
 + ctx->
ov”æow_buf_ix
, 
n_by‹s
);

876 
ùx
->
ov”æow_buf_ix
 +ğ
n_by‹s
;

877 
buf_ix
 = 
n_by‹s
;

878 ià(
ùx
->
ov”æow_buf_ix
 =ğùx->
ov”æow_buf_size
)

880 
	`ä“
 (
ùx
->
ov”æow_buf
);

881 
ùx
->
ov”æow_buf
 = 
NULL
;

882 
ùx
->
ov”æow_buf_size
 = 0;

883 
ùx
->
ov”æow_buf_ix
 = 0;

886 
ùx
->
buf
 = buf;

887 
ùx
->
buf_size
 = 
size
;

888 
ùx
->
buf_ix
 = buf_ix;

889 !
¡©us
 && 
ùx
->
buf_ix
 < 
size
)

891 
¡©us
 = 
	`ijs_£rv”_™”
 (
ùx
);

893 
ùx
->
buf
 = 
NULL
;

894  
¡©us
;

895 
	}
}

	@prnt/hpijs/ijs_server.h

25 #ifdeà
__ılu¥lus


29 
_IjsS”v”Ctx
 
	tIjsS”v”Ctx
;

32 
n_chª
;

33 
bps
;

34 
cs
[256];

35 
width
;

36 
height
;

37 
x»s
;

38 
y»s
;

39 } 
	tIjsPageH—d”
;

43 
	tIjsBegšJobCb
 (*
	tbegš_cb_d©a
,

44 
	tIjsS”v”Ctx
 *
	tùx
,

45 
	tIjsJobId
 
	tjob_id
);

47 
	tIjsEndJobCb
 (*
	t’d_cb_d©a
,

48 
	tIjsS”v”Ctx
 *
	tùx
,

49 
	tIjsJobId
 
	tjob_id
);

51 
	tIjsQu”yStusCb
 (*
	t¡©us_cb_d©a
,

52 
	tIjsS”v”Ctx
 *
	tùx
,

53 
	tIjsJobId
 
	tjob_id
);

55 
	tIjsLi¡P¬amsCb
 (*
	tli¡_cb_d©a
,

56 
	tIjsS”v”Ctx
 *
	tùx
,

57 
	tIjsJobId
 
	tjob_id
,

58 *
	tv®_buf
,

59 
	tv®_size
);

61 
	tIjsEnumP¬amCb
 (*
	t’um_cb_d©a
,

62 
	tIjsS”v”Ctx
 *
	tùx
,

63 
	tIjsJobId
 
	tjob_id
,

64 cÚ¡ *
	tkey
,

65 *
	tv®_buf
,

66 
	tv®_size
);

68 
	tIjsS‘P¬amCb
 (*
	t£t_cb_d©a
,

69 
	tIjsS”v”Ctx
 *
	tùx
,

70 
	tIjsJobId
 
	tjob_id
,

71 cÚ¡ *
	tkey
,

72 cÚ¡ *
	tv®ue
,

73 
	tv®ue_size
);

75 
	tIjsG‘P¬amCb
 (*
	tg‘_cb_d©a
,

76 
	tIjsS”v”Ctx
 *
	tùx
,

77 
	tIjsJobId
 
	tjob_id
,

78 cÚ¡ *
	tkey
,

79 *
	tv®_buf
,

80 
	tv®_size
);

82 
IjsS”v”Ctx
 *

83 
ijs_£rv”_š™
 ();

86 
ijs_£rv”_š¡®l_begš_cb
 (
IjsS”v”Ctx
 *
ùx
,

87 
IjsBegšJobCb
 *
begš_cb
, *
begš_cb_d©a
);

90 
ijs_£rv”_š¡®l_’d_cb
 (
IjsS”v”Ctx
 *
ùx
,

91 
IjsEndJobCb
 *
’d_cb
, *
’d_cb_d©a
);

94 
ijs_£rv”_š¡®l_¡©us_cb
 (
IjsS”v”Ctx
 *
ùx
,

95 
IjsQu”yStusCb
 *
¡©us_cb
,

96 *
¡©us_cb_d©a
);

99 
ijs_£rv”_š¡®l_li¡_cb
 (
IjsS”v”Ctx
 *
ùx
,

100 
IjsLi¡P¬amsCb
 *
li¡_cb
, *
li¡_cb_d©a
);

103 
ijs_£rv”_š¡®l_’um_cb
 (
IjsS”v”Ctx
 *
ùx
,

104 
IjsEnumP¬amCb
 *
’um_cb
, *
’um_cb_d©a
);

107 
ijs_£rv”_š¡®l_£t_cb
 (
IjsS”v”Ctx
 *
ùx
,

108 
IjsS‘P¬amCb
 *
£t_cb
, *
£t_cb_d©a
);

111 
ijs_£rv”_š¡®l_g‘_cb
 (
IjsS”v”Ctx
 *
ùx
,

112 
IjsG‘P¬amCb
 *
g‘_cb
, *
g‘_cb_d©a
);

115 
ijs_£rv”_dÚe
 (
IjsS”v”Ctx
 *
ùx
);

118 
ijs_£rv”_™”
 (
IjsS”v”Ctx
 *
ùx
);

121 
ijs_£rv”_g‘_·ge_h—d”
 (
IjsS”v”Ctx
 *
ùx
, 
IjsPageH—d”
 *
ph
);

124 
ijs_£rv”_g‘_d©a
 (
IjsS”v”Ctx
 *
ùx
, *
buf
, 
size
);

126 #ifdeà
__ılu¥lus


	@prnt/hpijs/internal.h

32 #iâdeà
APDK_INTERNAL_H


33 
	#APDK_INTERNAL_H


	)

35 
APDK_BEGIN_NAMESPACE


44 
	tTYPEFACE
;

45 
	#COURIER
 3

	)

46 
	#LETTERGOTHIC
 6

	)

47 
	#CGTIMES
 4101

	)

48 
	#UNIVERS
 52

	)

51 
	#LATIN1
 "0N"

52 
	#PC8
 "10U"

	)

53 
	#HP_LEGAL
 "1U"

	)

57 
	#K
 0

	)

58 
	#C
 1

	)

59 
	#M
 2

	)

60 
	#Y
 3

	)

61 
	#Clight
 4

	)

62 
	#Mlight
 5

	)

64 
	#RANDSEED
 77

	)

67 
	#DEFAULT_SLOW_POLL_COUNT
 30

	)

68 
	#DEFAULT_SLOW_POLL_BIDI
 3

	)

72 
	eSTYLE_TYPE
 { 
	mUPRIGHT
, 
	mITALIC
 };

74 
	eWEIGHT_TYPE
 { 
	mNORMAL
, 
	mBOLD
 };

76 
	eDATA_FORMAT
 { 
	mRASTER_LINE
, 
	mRASTER_STRIP
 };

81 
	#MAX_ESC_SEQ
 40

	)

82 
	#MAX_RASTERSIZE
 10000

83 

	)

84 
	#MAX_Y_OFFSET
 32767

	)

86 
	#CERRCHECK
 ià(
cÚ¡ruùÜ_”rÜ
 !ğ
NO_ERROR
è{
	`DBG1
("CERRCHECK fœed\n"); ;}

	)

87 
	#ERRCHECK
 ià(
”r
 !ğ
NO_ERROR
è{
	`DBG1
("ERRCHECK fœed\n"); ƒ¼;}

	)

88 
	#NEWCHECK
(
x
èià(x==
NULL
è 
ALLOCMEM_ERROR
;

	)

89 
	#CNEWCHECK
(
x
èià(x==
NULL
è{ 
cÚ¡ruùÜ_”rÜ
=
ALLOCMEM_ERROR
; ; }

	)

96 
	#ESC
 0x1b

	)

98 cÚ¡ 
	gUEL
[] = {
ESC
, '%', '-','1','2','3','4','5','X' };

99 cÚ¡ 
	gEÁ”Lªguage
[] = {'@','P','J','L',' ','E','N','T','E','R',' ',

101 cÚ¡ 
	gPCL3
[] = {'P','C','L','3' };

102 cÚ¡ 
	gPCLGUI
[] = {'P','C','L','3','G','U','I' };

103 cÚ¡ 
	gJobName
[] = {'@','P','J','L',' ','J','O','B',' ','N','A','M','E',' ','=',' '};

104 cÚ¡ 
	gRe£t
[] = {
ESC
,'E'};

105 cÚ¡ 
	güdS¹
[] = {
ESC
, '*', 'g'};

106 cÚ¡ 
	gcidS¹
[] = {
ESC
, '*', 'v'};

107 cÚ¡ 
	güdFÜm©
 = 2;

108 cÚ¡ 
	gg¿fS¹
[] = {
ESC
, '*', 'r', '1', 'A'};

109 cÚ¡ 
	gg¿fMode0
[] = {
ESC
, '*', 'b', '0', 'M'};

110 cÚ¡ 
	gg¿fMode9
[] = {
ESC
, '*', 'b', '9', 'M'};

111 cÚ¡ 
	gg¿fMode2
[] = {
ESC
, '*', 'b', '2', 'M'};

112 cÚ¡ 
	gS“dSame
[] = {
ESC
, '*', 'b', '0', 'S'};

114 cÚ¡ 
	gBÏckExŒaùOff
[] = {
ESC
, '*', 'o', '5', 'W', 0x04, 0xC, 0, 0, 0 };

115 cÚ¡ 
	gLF
 = '\012';

116 cÚ¡ 
	gQuÙe
 = '\042';

117 cÚ¡ 
BYTE
 
	gDJ895_Pow”_On
[] = {
ESC
, '%','P','u','i','f','p','.',

119 'u','d','w','.','q','u','i','t',';',
ESC
,'%','-','1','2','3','4','5','X' };

125 cÚ¡ 
	gEÇbËDu¶ex
[] = { 
ESC
,'&','l', '2', 'S'};

126 cÚ¡ 
	gNoD•ËtiÚ
[] = {
ESC
, '*', 'o', '1', 'D'};

127 cÚ¡ 
	gNoG¿yB®ªû
[] = {
ESC
, '*', 'b', '2', 'B'};

128 cÚ¡ 
	gEÇbËBufãrFlushšg
[] = { 
ESC
,'&','b','1','5','W','P','M','L',32,4,0,5,1,2,1,1,5,4,1,1 };

129 cÚ¡ 
	gDi§bËBufãrFlushšg
[] = { 
ESC
,'&','b','1','5','W','P','M','L',32,4,0,5,1,2,1,1,5,4,1,2 };

130 cÚ¡ 
	gDriv”w¬eJobName
[] = { 
ESC
,'*','o','5','W',0x0d,0x06,0x00,0x00,0x01 };

131 cÚ¡ 
BYTE
 
	gPEN_CLEAN_PML
[]={0x1B,0x45,0x1B,0x26,0x62,0x31,0x36,0x57,

139 
	sfO±SubSig


141 
	mpi
;

142 cÚ¡ *
	mm—ns
;

146 
	sfO±CÏssSig


148 
	mnsubşas£s
;

149 
	mv¬Ÿnû
;

150 
	mšv_v¬Ÿnû
;

151 
	mú¡
;

152 
fO±SubSig
 *
	mO±SubSig
;

156 
	sfO±SigS‘


158 
	mnbªds
;

159 
fO±CÏssSig
 *
	mO±CÏssSig
;

163 
	sRESSYNSTRUCT


165 
	mWidth
;

166 
	mSÿËFaùÜMuÉl›r
;

167 
	mSÿËFaùÜDivisÜ
;

169 
	mRemašd”
;

170 
	mR•—t
;

171 
	mRa¡”sšBufãr
;

172 * 
	mBufã½t
[
NUMBER_RASTERS
];

173 
	mBufãrSize
;

174 * 
	mBufãr
;

175 
fO±SigS‘
 
	mOS
;

176 
fO±SubSig
 
	mrsO±SubSigPŒ1
[45];

177 
fO±CÏssSig
 
	mOCS
;

178 **
	mjošt_m—ns
;

179 ***
	mf‹r
;

180 
	mf‹rPŒ1
[45];

181 
	mf‹rPŒ2
[45][9];

182 
	mjošt_m—nsPŒ1
[45];

188 
	mCOLORTYPE_COLOR
,

189 
	mCOLORTYPE_BLACK
,

190 
	mCOLORTYPE_BOTH


191 } 
	tCOLORTYPE
;

193 
	#MAX_COLORTYPE
 2

	)

195 
	sRASTERDATA


197 
	m¿¡”size
[
MAX_COLORTYPE
];

198 
BYTE
* 
	m¿¡”d©a
[
MAX_COLORTYPE
];

202 
	sHPRGBQUAD
 {

203 
BYTE
 
	mrgbBlue
;

204 
BYTE
 
	mrgbG»’
;

205 
BYTE
 
	mrgbRed
;

206 
BYTE
 
	mrgbRe£rved
;

209 
	sHPBITMAPINFOHEADER
{

210 
DWORD
 
	mbiSize
;

211 
	mbiWidth
;

212 
	mbiHeight
;

213 
WORD
 
	mbiPÏÃs
;

214 
WORD
 
	mbiB™CouÁ
;

215 
DWORD
 
	mbiCom´essiÚ
;

216 
DWORD
 
	mbiSizeImage
;

217 
	mbiXP–sP”M‘”
;

218 
	mbiYP–sP”M‘”
;

219 
DWORD
 
	mbiCÌU£d
;

220 
DWORD
 
	mbiCÌImpÜÁ
;

223 
	sHPBITMAPINFO
 {

224 
HPBITMAPINFOHEADER
 
	mbmiH—d”
;

225 
HPRGBQUAD
 
	mbmiCŞÜs
[1];

229 
	sHPLJBITMAP
 {

231 
HPBITMAPINFO
 
	mb™m­Info
;

232 
	mcjB™s
;

233 
BYTE
 *
	mpvB™s
;

234 
BYTE
 *
	mpvAligÃdB™s
;

239 
şass
 
	gP–še
;

252 şas 
	cProûssÜ


254 
	mpublic
:

255 
ProûssÜ
();

256 
	mvœtu®
 ~
ProûssÜ
();

259 
vœtu®
 
BOOL
 
Proûss
(
RASTERDATA
 *
IÅutRa¡”
=
NULL
)=0;

260 
vœtu®
 
Flush
()=0;

261 
vœtu®
 
BYTE
* 
NextOuutRa¡”
(
COLORTYPE
 
¿¡”cŞÜ
)=0;

262 
vœtu®
 
G‘OuutWidth
(
COLORTYPE
 
¿¡”cŞÜ
)=0;

263 
vœtu®
 
	$G‘MaxOuutWidth
(
COLORTYPE
 
¿¡”cŞÜ
è{  
	`G‘OuutWidth
(rastercolor); }

265 
iRa¡”sR—dy
, 
iRa¡”sD–iv”ed
;

266 
P–še
* 
mypha£
;

267 
COLORTYPE
 
my¶ªe
;

268 
RASTERDATA
 
¿¡”
;

269 
	}
};

279 şas 
	cP–še


281 
	mpublic
:

282 
P–še
(
ProûssÜ
* 
E
);

283 
	mvœtu®
 ~
P–še
();

285 
AddPha£
(
P–še
* 
p
);

288 
DRIVER_ERROR
 
Execu‹
(
RASTERDATA
* 
IÅutRa¡”
=
NULL
);

290 
DRIVER_ERROR
 
Flush
();

293 
BOOL
 
Proûss
(
RASTERDATA
* 
IÅutRa¡”
=
NULL
);

295 
BYTE
* 
	$NextOuutRa¡”
(
COLORTYPE
 
¿¡”cŞÜ
è{  
Exec
->
	`NextOuutRa¡”
(rastercolor); }

296 
	$G‘OuutWidth
(
COLORTYPE
 
¿¡”cŞÜ
è{  
Exec
->
	`G‘OuutWidth
Ôa¡”cŞÜ); 
	}
}

297 
	$G‘MaxOuutWidth
(
COLORTYPE
 
¿¡”cŞÜ
è{  
Exec
->
	`G‘MaxOuutWidth
Ôa¡”cŞÜ); 
	}
}

299 
P–še
* 
	gÃxt
;

300 
P–še
* 
	g´ev
;

302 
ProûssÜ
* 
	gExec
;

304 
DRIVER_ERROR
 
	g”r
;

308 
	sPeCÚfigTabË


310 
BOOL
 
	mbResSyÁh
;

312 #ià
defšed
(
APDK_VIP_COLORFILTERING
)

313 
BOOL
 
	mbEº›
;

316 
BOOL
 
	mbPix–R•liÿ‹
;

317 
BOOL
 
	mbCŞÜImage
;

318 
BOOL
 
	mbCom´ess
;

319 
HALFTONING_ALGORITHM
 
	meHT
;

330 şas 
	cSÿËr
 : 
public
 
ProûssÜ


332 
public
:

334 
vœtu®
 ~
SÿËr
();

336 
BOOL
 
Proûss
(
RASTERDATA
* 
IÅutRa¡”
=
NULL
)=0;

337 
vœtu®
 
	$Flush
(è{ 
	`Proûss
(); }

339 
DRIVER_ERROR
 
cÚ¡ruùÜ_”rÜ
;

341 
SÿËFaùÜ
;

342 
»mašd”
;

344 
vœtu®
 
	`G‘OuutWidth
(
COLORTYPE
 
¿¡”cŞÜ
);

345 
vœtu®
 
	`G‘MaxOuutWidth
(
COLORTYPE
 
¿¡”cŞÜ
);

346 
vœtu®
 
BYTE
* 
	`NextOuutRa¡”
(
COLORTYPE
 
¿¡”cŞÜ
)=0;

348 
´Ùeùed
:

349 
	`SÿËr
(
Sy¡emS”viûs
* 
pSys
,
šputwidth
,

350 
num”©Ü
,
d’omš©Ü
, 
BOOL
 
v
, 
By‹sP”Pix–
);

351 
Sy¡emS”viûs
* 
pSS
;

353 
BOOL
 
sÿlšg
;

354 
BOOL
 
R•liÿ‹OÆy
;

357 
iOuutWidth
;

358 
iIÅutWidth
;

359 
BYTE
* 
pOuutBufãr
[
MAX_COLORTYPE
];

360 
BOOL
 
äaùiÚ®
;

361 
	}
};

363 #ifdeà
APDK_PSCRIPT


364 
şass
 
	gPSütProxy
;

367 #ifdeà
APDK_LJMONO


368 
şass
 
	gLJMÚoProxy
;

371 #ifdeà
APDK_LJCOLOR


372 
şass
 
	gLJCŞÜProxy
;

375 #ifdeà
APDK_LJJETREADY


376 
şass
 
	gLJJ‘R—dyProxy
;

379 #ifdeà
APDK_LJFASTRASTER


380 
şass
 
	gLJFa¡Ra¡”Proxy
;

383 #ifdeà
APDK_LJZJS_MONO


384 
şass
 
	gLJZjsMÚoProxy
;

387 #ifdeà
APDK_LJZJS_COLOR


388 
şass
 
	gLJZjsCŞÜProxy
;

391 #ifdeà
APDK_LJM1005


392 
şass
 
	gLJM1005Proxy
;

393 
şass
 
	gLJP1XXXProxy
;

396 #ià
defšed
(
APDK_PSP100
è&& defšed (
APDK_DJ9xxVIP
)

397 
şass
 
	gPSP100Proxy
;

398 
şass
 
	gPSP470Proxy
;

401 #ià
defšed
(
APDK_DJGENERICVIP
è&& defšed (
APDK_DJ9xxVIP
)

402 
şass
 
	gDJG’”icVIPProxy
;

403 
şass
 
	gDJ55xxProxy
;

406 #ifdeà
APDK_DJ9xxVIP


407 
şass
 
	gDJ9xxVIPProxy
;

408 
şass
 
	gOJProKx50Proxy
;

411 #ifdeà
APDK_DJ9xx


412 
şass
 
	gDJ9xxProxy
;

415 #ià
defšed
(
APDK_DJ8xx
)|| defšed(
APDK_DJ9xx
)

416 
şass
 
	gDJ8xxProxy
;

419 #ià
defšed
(
APDK_DJ8xx
)|| defšed(
APDK_DJ9xx
)

420 #ifdeà
APDK_DJ8x5


421 
şass
 
	gDJ8x5Proxy
;

425 #ià
defšed
(
APDK_DJ890
)

426 
şass
 
	gDJ890Proxy
;

429 #ià
defšed
(
APDK_DJ850
)

430 
şass
 
	gDJ850Proxy
;

433 #ifdeà
APDK_DJ6xxPhÙo


434 
şass
 
	gDJ6xxPhÙoProxy
;

437 #ifdeà
APDK_DJ6xx


438 
şass
 
	gDJ660Proxy
;

441 #ifdeà
APDK_DJ630


442 
şass
 
	gDJ630Proxy
;

445 #ifdeà
APDK_DJ600


446 
şass
 
	gDJ600Proxy
;

449 #ifdeà
APDK_DJ540


450 
şass
 
	gDJ540Proxy
;

453 #ifdeà
APDK_DJ400


454 
şass
 
	gDJ400Proxy
;

457 #ifdeà
APDK_DJ350


458 
şass
 
	gDJ350Proxy
;

461 #ià
defšed
(
APDK_DJ3600
è&& defšed (
APDK_DJ3320
)

462 
şass
 
	gDJ3600Proxy
;

463 
şass
 
	gDJ4100Proxy
;

464 
şass
 
	gDJD2600Proxy
;

467 #ià
defšed
 (
APDK_DJ3320
)

468 
şass
 
	gDJ3320Proxy
;

471 #ifdeà
APDK_APOLLO2560


472 
şass
 
	gApŞlo2560Proxy
;

475 #ifdeà
APDK_APOLLO21XX


476 
şass
 
	gApŞlo21xxProxy
;

479 #ifdeà
APDK_APOLLO2XXX


480 
şass
 
	gApŞlo2xxxProxy
;

483 #ifdeà
APDK_QUICKCONNECT


484 
şass
 
	gQuickCÚÃùProxy
;

498 şas 
	cDeviûRegi¡ry


500 
	mpublic
:

501 
DeviûRegi¡ry
();

502 
	mvœtu®
 ~
DeviûRegi¡ry
();

506 
DRIVER_ERROR
 
P¬£DevIDSŒšg
(cÚ¡ * 
sDevID
, * 
¡rMod–
, *
pVIPV”siÚ
, * 
¡rP’s
);

508 
vœtu®
 
DRIVER_ERROR
 
S–eùDeviû
(* 
mod–
, * 
pVIPV”siÚ
, * 
³ns
, 
Sy¡emS”viûs
* 
pSS
);

510 
vœtu®
 
DRIVER_ERROR
 
S–eùDeviû
(cÚ¡ * 
sDevID
, 
Sy¡emS”viûs
* 
pSS
);

512 
vœtu®
 
DRIVER_ERROR
 
S–eùDeviû
(cÚ¡ 
PRINTER_TYPE
 
Mod–
);

514 
vœtu®
 
DRIVER_ERROR
 
G‘Prš‹rMod–
(* 
¡rMod–
, * 
pVIPV”siÚ
, * 
¡rP’s
, 
Sy¡emS”viûs
* 
pSS
);

519 
vœtu®
 
DRIVER_ERROR
 
In¡ªtŸ‹Prš‹r
(
Prš‹r
*& 
p
,
Sy¡emS”viûs
* 
pSS
);

522 
	mdeviû
;

524 #ifdeà
APDK_PSCRIPT


525 
PSütProxy
 
	ms_PSütProxy
;

528 #ifdeà
APDK_LJMONO


529 
LJMÚoProxy
 
	ms_LJMÚoProxy
;

532 #ifdeà
APDK_LJCOLOR


533 
LJCŞÜProxy
 
	ms_LJCŞÜProxy
;

536 #ifdeà
APDK_LJJETREADY


537 
LJJ‘R—dyProxy
 
	ms_LJJ‘R—dyProxy
;

540 #ifdeà
APDK_LJFASTRASTER


541 
LJFa¡Ra¡”Proxy
 
	ms_LJFa¡Ra¡”Proxy
;

544 #ifdeà
APDK_LJZJS_MONO


545 
LJZjsMÚoProxy
 
	ms_LJZjsMÚoProxy
;

548 #ifdeà
APDK_LJZJS_COLOR


549 
LJZjsCŞÜProxy
 
	ms_LJZjsCŞÜProxy
;

552 #ifdeà
APDK_LJM1005


553 
LJM1005Proxy
 
	ms_LJM1005Proxy
;

554 
LJP1XXXProxy
 
	ms_LJP1XXXProxy
;

557 #ià
defšed
(
APDK_PSP100
è&& 
	$defšed
 (
APDK_DJ9xxVIP
)

558 
PSP100Proxy
 
s_PSP100Proxy
;

559 
PSP470Proxy
 
s_PSP470Proxy
;

562 #ià
	`defšed
(
APDK_DJGENERICVIP
è&& 
	$defšed
 (
APDK_DJ9xxVIP
)

563 
DJG’”icVIPProxy
 
s_DJG’”icVIPProxy
;

564 
DJ55xxProxy
 
s_DJ55xxProxy
;

567 #ifdeà
APDK_DJ9xxVIP


568 
DJ9xxVIPProxy
 
s_DJ9xxVIPProxy
;

569 
OJProKx50Proxy
 
s_OJProKx50Proxy
;

572 #ifdeà
APDK_DJ9xx


573 
DJ9xxProxy
 
s_DJ9xxProxy
;

576 #ià
	`defšed
(
APDK_DJ8xx
)|| 
	$defšed
(
APDK_DJ9xx
)

577 
DJ8xxProxy
 
s_DJ8xxProxy
;

580 #ià
	`defšed
(
APDK_DJ8xx
)|| 
	$defšed
(
APDK_DJ9xx
)

581 #ifdeà
APDK_DJ8x5


582 
DJ8x5Proxy
 
s_DJ8x5Proxy
;

586 #ià
	$defšed
(
APDK_DJ890
)

587 
DJ890Proxy
 
s_DJ890Proxy
;

590 #ià
	$defšed
(
APDK_DJ850
)

591 
DJ850Proxy
 
s_DJ850Proxy
;

594 #ifdeà
APDK_DJ6xxPhÙo


595 
DJ6xxPhÙoProxy
 
s_DJ6xxPhÙoProxy
;

598 #ifdeà
APDK_DJ6xx


599 
DJ660Proxy
 
s_DJ660Proxy
;

602 #ifdeà
APDK_DJ630


603 
DJ630Proxy
 
s_DJ630Proxy
;

606 #ifdeà
APDK_DJ600


607 
DJ600Proxy
 
s_DJ600Proxy
;

610 #ifdeà
APDK_DJ540


611 
DJ540Proxy
 
s_DJ540Proxy
;

614 #ifdeà
APDK_DJ400


615 
DJ400Proxy
 
s_DJ400Proxy
;

618 #ifdeà
APDK_DJ350


619 
DJ350Proxy
 
s_DJ350Proxy
;

622 #ià
	`defšed
(
APDK_DJ3600
è&& 
	$defšed
 (
APDK_DJ3320
)

623 
DJ3600Proxy
 
s_DJ3600Proxy
;

624 
DJ4100Proxy
 
s_DJ4100Proxy
;

625 
DJD2600Proxy
 
s_DJD2600Proxy
;

628 #ià
	$defšed
 (
APDK_DJ3320
)

629 
DJ3320Proxy
 
s_DJ3320Proxy
;

632 #ifdeà
APDK_APOLLO2560


633 
ApŞlo2560Proxy
 
s_ApŞlo2560Proxy
;

636 #ifdeà
APDK_APOLLO21XX


637 
ApŞlo21xxProxy
 
s_ApŞlo21xxProxy
;

640 #ifdeà
APDK_APOLLO2XXX


641 
ApŞlo2xxxProxy
 
s_ApŞlo2xxxProxy
;

644 #ifdeà
APDK_QUICKCONNECT


645 
QuickCÚÃùProxy
 
s_QuickCÚÃùProxy
;

654 cÚ¡ 
ušt32_t
 *
ulM­1
;

655 cÚ¡ 
ušt32_t
 *
ulM­2
;

656 cÚ¡ *
ulM­3
;

657 } 
	tCŞÜM­
;

667 şas 
	cCom´essÜ
 : 
public
 
ProûssÜ


669 
public
:

670 
	`Com´essÜ
(
Sy¡emS”viûs
* 
pSys
, 
Ra¡”Size
, 
BOOL
 
u££ed
);

671 
vœtu®
 ~
	`Com´essÜ
();

673 
vœtu®
 
BOOL
 
	`Proûss
(
RASTERDATA
* 
IÅutRa¡”
=
NULL
)=0;

675 
vœtu®
 
	$Flush
() { }

677 
	`G‘OuutWidth
(
COLORTYPE
 
cŞÜ
);

678 
vœtu®
 
BYTE
* 
	`NextOuutRa¡”
(
COLORTYPE
 
cŞÜ
);

680 
	$S‘S“dRow
(
BYTE
* 
£ed
è{ 
S“dRow
=£ed; 
	}
}

682 
DRIVER_ERROR
 
	gcÚ¡ruùÜ_”rÜ
;

684 
Sy¡emS”viûs
* 
	gpSS
;

686 
BYTE
* 
	gcom´essBuf
;

687 
BYTE
* 
	gS“dRow
;

688 
BOOL
 
	gU£S“dRow
;

689 
BYTE
* 
	gÜigš®KD©a
;

691 
	gcom´es£dsize
;

692 
	gšputsize
;

693 
BOOL
 
	g£eded
;

702 şas 
	cMode9
 : 
public
 
Com´essÜ


704 
public
:

705 
Mode9
(
Sy¡emS”viûs
* 
pSys
,
Ra¡”Size
, 
BOOL
 
bVIPPrš‹r
 = 
FALSE
);

706 
	mvœtu®
 ~
Mode9
();

707 
BOOL
 
Proûss
(
RASTERDATA
* 
šput
);

708 
Flush
();

709 
BOOL
 
	mRe£tS“dRow
;

710 
BOOL
 
	mm_bVIPPrš‹r
;

718 şas 
	cMode2
 : 
public
 
Com´essÜ


720 
public
:

721 
Mode2
(
Sy¡emS”viûs
* 
pSys
,
Ra¡”Size
);

722 
	mvœtu®
 ~
Mode2
();

723 
BOOL
 
Proûss
(
RASTERDATA
* 
šput
);

731 şas 
	cMode3
 : 
public
 
Com´essÜ


733 
public
:

734 
Mode3
 (
Sy¡emS”viûs
* 
pSys
, 
Prš‹r
 *
pPrš‹r
, 
Ra¡”Size
);

735 
	mvœtu®
 ~
Mode3
 ();

736 
BOOL
 
Proûss
 (
RASTERDATA
* 
šput
);

737 
Flush
 ();

738 
	m´iv©e
:

739 
Prš‹r
 *
m_pPrš‹r
;

743 #ià
defšed
(
APDK_FONTS_NEEDED
)

754 şas 
	cTextT¿n¦©Ü


756 
	mpublic
:

757 
TextT¿n¦©Ü
(
Prš‹r
* 
p
,
qu®™y
,
cŞÜ¶ªes
);

758 
	mvœtu®
 ~
TextT¿n¦©Ü
();

760 
DRIVER_ERROR
 
TextOut
(cÚ¡ * 
pTextSŒšg
, 
L’SŒšg
,

761 cÚ¡ 
FÚt
& 
fÚt
, 
BOOL
 
£ndfÚt
=
FALSE
,

762 
iAbsX
=-1, 
iAbsY
=-1);

764 
DRIVER_ERROR
 
S’dCAP
(
iAbsX
,
iAbsY
);

765 cÚ¡ 
BYTE
* 
CŞÜSequ’û
(
TEXTCOLOR
 
eCŞÜ
);

766 
BYTE
 
CŞÜCode
(
TEXTCOLOR
 
eCŞÜ
);

767 
Ty³çûCode
(cÚ¡ * 
FÚtName
);

768 cÚ¡ 
BYTE
* 
PoštsizeSequ’û
(
iPoštsize
);

769 cÚ¡ 
BYTE
* 
P™chSequ’û
(
iP™ch
);

770 cÚ¡ 
BYTE
* 
StyËSequ’û
(
BOOL
 
bIlic
);

771 cÚ¡ 
BYTE
* 
WeightSequ’û
(
BOOL
 
bBŞd
);

772 cÚ¡ 
BYTE
* 
Com¶‘eSequ’û
(cÚ¡ 
FÚt
& 
fÚt
);

773 cÚ¡ 
BYTE
* 
Und”lšeSequ’û
();

774 cÚ¡ 
BYTE
* 
Di§bËUnd”lšeSequ’û
();

777 
T¿n¥¬’tCh¬
(
iMaxL’
, 
BYTE
 
b
, BYTE* 
outbuff
);

779 
DRIVER_ERROR
 
	mcÚ¡ruùÜ_”rÜ
;

781 
DRIVER_ERROR
 
S’dFÚt
(cÚ¡ 
FÚt
& 
fÚt
);

782 
DRIVER_ERROR
 
S’dCŞÜSequ’û
(cÚ¡ 
TEXTCOLOR
 
eCŞÜ
);

783 
DRIVER_ERROR
 
S’dPoštsize
(cÚ¡ 
iPoštsize
);

784 
DRIVER_ERROR
 
S’dP™ch
(cÚ¡ 
iP™ch
);

785 
DRIVER_ERROR
 
S’dStyË
(cÚ¡ 
BOOL
 
bIlic
);

786 
DRIVER_ERROR
 
S’dWeight
(cÚ¡ 
BOOL
 
bBŞd
);

787 
DRIVER_ERROR
 
S’dUnd”lše
();

788 
DRIVER_ERROR
 
S’dCom¶‘eSequ’û
(cÚ¡ 
FÚt
& 
fÚt
);

789 
DRIVER_ERROR
 
Di§bËUnd”lše
();

792 
	m´iv©e
:

793 
Prš‹r
* 
thePrš‹r
;

794 
	mqu®code
;

795 
BYTE
 
	mEscSeq
[
MAX_ESC_SEQ
];

796 
	miNumPÏÃs
;

797 
BYTE
 
CŞÜCode1
(
TEXTCOLOR
 
eCŞÜ
);

798 
BYTE
 
CŞÜCode3
(
TEXTCOLOR
 
eCŞÜ
);

799 
BYTE
 
CŞÜCode4
(
TEXTCOLOR
 
eCŞÜ
);

803 
TEXTCOLOR
 
	mÏ¡cŞÜ
;

804 
	mÏ¡Çme
[20];

805 
	mÏ¡ch¬£t
[
MAX_CHAR_SET
];

806 
	mÏ¡poštsize
;

807 
BOOL
 
	mÏ¡™®ic
;

808 
BOOL
 
	mÏ¡bŞd
;

809 
S‘La¡
(cÚ¡ 
FÚt
& 
fÚt
);

823 şas 
	cH—d”


825 
ä›nd
 
şass
 
	mJob
;

826 
ä›nd
 
şass
 
	mModeJPEG
;

828 
	mpublic
:

829 
H—d”
(
Prš‹r
* 
p
,
PrštCÚ‹xt
* 
pc
);

830 
	mvœtu®
 ~
H—d”
 ();

832 
vœtu®
 
DRIVER_ERROR
 
S’d
()=0;

834 
vœtu®
 
DRIVER_ERROR
 
EndJob
();

836 
vœtu®
 
DRIVER_ERROR
 
S’dCAPy
(
iAbsY
);

837 
vœtu®
 
DRIVER_ERROR
 
FÜmF“d
();

839 
BOOL
 
	$IsLa¡Bªd
(è{  
bLa¡Bªd
; }

840 
	$S‘La¡Bªd
(
BOOL
 
Ï¡bªd
è{ 
bLa¡Bªd
 =†a¡bªd; 
	}
}

842 
	gCAPy
;

844 
	g´Ùeùed
:

845 
Prš‹r
* 
thePrš‹r
;

846 
PrštCÚ‹xt
* 
	gthePrštCÚ‹xt
;

847 
PrštMode
* 
	gthePrštMode
;

849 
S‘MedŸTy³
(
MedŸTy³
 
mty³
);

850 
S‘MedŸSize
(
PAPER_SIZE
 
·³rsize
);

851 
S‘MedŸSourû
(
MedŸSourû
 
msourû
);

852 
S‘Qu®™y
(
Qu®™y
 
qu®
);

853 
S‘Sim¶eCŞÜ
();

856 
DRIVER_ERROR
 
M¬gšs
();

857 
vœtu®
 
DRIVER_ERROR
 
G¿phics
();

858 
DRIVER_ERROR
 
Sim¶e
();

859 
DRIVER_ERROR
 
Modes
();

860 
DRIVER_ERROR
 
CÚfigu»Ra¡”D©a
();

863 
vœtu®
 
DRIVER_ERROR
 
S¹S’d
();

866 
	gResŞutiÚX
[
MAXCOLORPLANES
];

867 
	gResŞutiÚY
[
MAXCOLORPLANES
];

868 
	gdyeCouÁ
;

872 
CŞÜLev–s
(
CŞÜPÏÃ
);

875 
	gSim¶eCŞÜ
[6]; 
BYTE
 
	gsccouÁ
;

876 
	gmedŸty³
[6]; 
BYTE
 
	gmtcouÁ
;

877 
	gmedŸsize
[8]; 
BYTE
 
	gmscouÁ
;

878 
	gmedŸsourû
[6]; 
BYTE
 
	gm¤ccouÁ
;

879 
	gqu®™y
[6]; 
BYTE
 
	gqu®couÁ
;

880 
BYTE
 
Qu®™yCode
();

881 
BOOL
 
	gbLa¡Bªd
;

888 şas 
	cH—d”350
 : 
public
 
H—d”


890 
public
:

891 
H—d”350
(
Prš‹r
* 
p
,
PrštCÚ‹xt
* 
pc
);

892 
DRIVER_ERROR
 
S’d
();

899 şas 
	cH—d”400
 : 
public
 
H—d”


901 
public
:

902 
H—d”400
(
Prš‹r
* 
p
,
PrštCÚ‹xt
* 
pc
);

903 
DRIVER_ERROR
 
S’d
();

911 şas 
	cH—d”6XX
 : 
public
 
H—d”


913 
public
:

914 
H—d”6XX
(
Prš‹r
* 
p
,
PrštCÚ‹xt
* 
pc
);

915 
vœtu®
 
DRIVER_ERROR
 
S’d
();

916 
	m´Ùeùed
:

924 şas 
	cH—d”600
 : 
public
 
H—d”6XX


926 
public
:

927 
H—d”600
(
Prš‹r
* 
p
,
PrštCÚ‹xt
* 
pc
);

928 
DRIVER_ERROR
 
S’d
();

936 şas 
	cH—d”690
 : 
public
 
H—d”


938 
public
:

939 
H—d”690
(
Prš‹r
* 
p
,
PrštCÚ‹xt
* 
pc
);

940 
DRIVER_ERROR
 
S’d
();

947 şas 
	cH—d”540
 : 
public
 
H—d”


949 
public
:

950 
H—d”540
(
Prš‹r
* 
p
,
PrštCÚ‹xt
* 
pc
);

951 
DRIVER_ERROR
 
S’d
();

959 şas 
	cH—d”895
 : 
public
 
H—d”


961 
public
:

962 
H—d”895
(
Prš‹r
* 
p
,
PrštCÚ‹xt
* 
pc
);

963 
vœtu®
 
DRIVER_ERROR
 
S’d
();

965 
	m´Ùeùed
:

966 
DRIVER_ERROR
 
G¿phics
();

967 
DRIVER_ERROR
 
S¹S’d
();

974 şas 
	cH—d”850
 : 
public
 
H—d”895


976 
public
:

977 
H—d”850
(
Prš‹r
* 
p
,
PrštCÚ‹xt
* 
pc
);

979 
	m´Ùeùed
:

980 
DRIVER_ERROR
 
S¹S’d
();

988 şas 
	cH—d”900
 : 
public
 
H—d”895


990 
public
:

991 
H—d”900
(
Prš‹r
* 
p
,
PrštCÚ‹xt
* 
pc
);

992 
vœtu®
 
DRIVER_ERROR
 
S’d
();

994 
	m´Ùeùed
:

995 
BOOL
 
Du¶exEÇbËd
(
BYTE
* 
bDevIDBuff
);

1002 şas 
	cH—d”DJ990
 : 
public
 
H—d”


1004 
public
:

1005 
H—d”DJ990
(
Prš‹r
* 
p
,
PrštCÚ‹xt
* 
pc
);

1006 
DRIVER_ERROR
 
CÚfigu»Ra¡”D©a
();

1007 
DRIVER_ERROR
 
CÚfigu»ImageD©a
();

1008 
DRIVER_ERROR
 
S’d
();

1009 
DRIVER_ERROR
 
S¹S’d
();

1010 
S‘MedŸSourû
(
MedŸSourû
 
msourû
);

1016 şas 
	cH—d”DJG’”icVIP
 : 
public
 
H—d”DJ990


1018 
public
:

1019 
H—d”DJG’”icVIP
 (
Prš‹r
 *
p
, 
PrštCÚ‹xt
 *
pc
);

1020 
	m´Ùeùed
:

1021 
m_uiCAPy
;

1022 
DRIVER_ERROR
 
S’dCAPy
 (
iAbsY
);

1023 
DRIVER_ERROR
 
FÜmF“d
 ();

1029 şas 
	cH—d”630
 : 
public
 
H—d”


1031 
public
:

1032 
H—d”630
(
Prš‹r
* 
p
,
PrštCÚ‹xt
* 
pc
);

1033 
DRIVER_ERROR
 
S’d
();

1040 şas 
	cH—d”2xxx
 : 
public
 
H—d”


1042 
public
:

1043 
H—d”2xxx
(
Prš‹r
* 
p
,
PrštCÚ‹xt
* 
pc
);

1044 
DRIVER_ERROR
 
S’d
();

1051 şas 
	cH—d”3320
 : 
public
 
H—d”


1053 
public
:

1054 
H—d”3320
 (
Prš‹r
 *
p
, 
PrštCÚ‹xt
 *
pc
);

1055 
DRIVER_ERROR
 
S’d
 ();

1056 
	m´Ùeùed
:

1057 
DRIVER_ERROR
 
EndJob
 ();

1058 
DRIVER_ERROR
 
FÜmF“d
 ();

1059 
DRIVER_ERROR
 
S’dCAPy
 (
iAbsY
);

1064 şas 
	cH—d”21xx
 : 
public
 
H—d”


1066 
public
:

1067 
H—d”21xx
(
Prš‹r
* 
p
,
PrštCÚ‹xt
* 
pc
);

1068 
DRIVER_ERROR
 
S’d
();

1074 şas 
	cH—d”LJMÚo
 : 
public
 
H—d”


1076 
public
:

1077 
H—d”LJMÚo
 (
Prš‹r
* 
p
,
PrštCÚ‹xt
* 
pc
);

1078 
vœtu®
 
DRIVER_ERROR
 
S’d
();

1080 
	m´Ùeùed
:

1081 
DRIVER_ERROR
 
EndJob
 ();

1082 
DRIVER_ERROR
 
G¿phics
 ();

1083 
DRIVER_ERROR
 
S¹S’d
 ();

1089 şas 
	cH—d”LJCŞÜ
 : 
public
 
H—d”


1091 
public
:

1092 
H—d”LJCŞÜ
 (
Prš‹r
* 
p
,
PrštCÚ‹xt
* 
pc
);

1093 
vœtu®
 
DRIVER_ERROR
 
S’d
();

1094 
vœtu®
 
DRIVER_ERROR
 
FÜmF“d
 ();

1096 
	m´Ùeùed
:

1097 
DRIVER_ERROR
 
EndJob
 ();

1098 
DRIVER_ERROR
 
G¿phics
 ();

1099 
DRIVER_ERROR
 
S¹S’d
 ();

1100 
DRIVER_ERROR
 
S’dCAPy
 (
iAbsY
);

1106 şas 
	cH—d”PSüt
 : 
public
 
H—d”


1108 
public
:

1109 
H—d”PSüt
 (
Prš‹r
 *
p
, 
PrštCÚ‹xt
 *
pc
);

1110 
DRIVER_ERROR
 
S’d
 ();

1111 
	m´Ùeùed
:

1112 
DRIVER_ERROR
 
EndJob
 ();

1113 
DRIVER_ERROR
 
FÜmF“d
 ();

1114 
DRIVER_ERROR
 
S’dCAPy
 (
iAbsY
);

1115 
DRIVER_ERROR
 
S¹S’d
 ();

1121 şas 
	cH—d”LJJ‘R—dy
 : 
public
 
H—d”


1123 
ä›nd
 
şass
 
LJJ‘R—dy
;

1124 
	mpublic
:

1125 
H—d”LJJ‘R—dy
 (
Prš‹r
* 
p
,
PrštCÚ‹xt
* 
pc
);

1126 
vœtu®
 
DRIVER_ERROR
 
S’d
();

1127 
vœtu®
 
DRIVER_ERROR
 
FÜmF“d
 ();

1128 
vœtu®
 
DRIVER_ERROR
 
S¹Page
();

1129 
vœtu®
 
DRIVER_ERROR
 
EndPage
();

1130 
	m´Ùeùed
:

1131 
DRIVER_ERROR
 
EndJob
 ();

1132 
DRIVER_ERROR
 
S¹S’d
 ();

1133 
DRIVER_ERROR
 
S’dCAPy
 (
iAbsY
);

1134 
DRIVER_ERROR
 
M­PCLMedŸTy³ToSŒšg
 (
MEDIATYPE
 
eM
);

1135 
JRP­”ToMedŸSize
(
PAPER_SIZE
 
ps
);

1141 şas 
	cH—d”LJFa¡Ra¡”
 : 
public
 
H—d”


1143 
ä›nd
 
şass
 
LJFa¡Ra¡”
;

1144 
	mpublic
:

1145 
H—d”LJFa¡Ra¡”
 (
Prš‹r
* 
p
,
PrštCÚ‹xt
* 
pc
);

1146 
vœtu®
 
DRIVER_ERROR
 
S’d
();

1147 
vœtu®
 
DRIVER_ERROR
 
FÜmF“d
 ();

1148 
vœtu®
 
DRIVER_ERROR
 
S¹Page
();

1149 
vœtu®
 
DRIVER_ERROR
 
EndPage
();

1150 
	m´Ùeùed
:

1151 
DRIVER_ERROR
 
EndJob
 ();

1152 
DRIVER_ERROR
 
S¹S’d
 ();

1153 
DRIVER_ERROR
 
S’dCAPy
 (
iAbsY
);

1154 
DRIVER_ERROR
 
M­PCLMedŸTy³ToSŒšg
 (
MEDIATYPE
 
eM
);

1155 
FrP­”ToMedŸSize
(
PAPER_SIZE
 
ps
);

1161 şas 
	cH—d”LJZjs
 : 
public
 
H—d”


1163 
ä›nd
 
şass
 
LJZjs
;

1164 
	mpublic
:

1165 
H—d”LJZjs
 (
Prš‹r
 *
p
, 
PrštCÚ‹xt
 *
pc
);

1166 
vœtu®
 
DRIVER_ERROR
 
S’d
 ();

1167 
vœtu®
 
DRIVER_ERROR
 
FÜmF“d
 ();

1168 
	m´Ùeùed
:

1169 
DRIVER_ERROR
 
EndJob
 ();

1170 
DRIVER_ERROR
 
S’dCAPy
 (
iAbsY
);

1176 şas 
	cH—d”QuickCÚÃù
 : 
public
 
H—d”


1178 
public
:

1179 
H—d”QuickCÚÃù
 (
Prš‹r
 *
p
, 
PrštCÚ‹xt
 *
pc
);

1180 
vœtu®
 
DRIVER_ERROR
 
S’d
 ();

1181 
vœtu®
 
DRIVER_ERROR
 
FÜmF“d
 ();

1182 
	m´Ùeùed
:

1183 
DRIVER_ERROR
 
EndJob
 ();

1184 
DRIVER_ERROR
 
S’dCAPy
 (
iAbsY
);

1191 şas 
	cRa¡”S’d”
 : 
public
 
ProûssÜ


1193 
ä›nd
 
şass
 
H—d”
;

1194 
ä›nd
 
şass
 
	mH—d”895
;

1195 
ä›nd
 
şass
 
	mH—d”900
;

1196 
	mpublic
:

1198 
Ra¡”S’d”
(
Prš‹r
* 
pP
, 
PrštCÚ‹xt
* 
pPC
,

1199 
Job
* 
pJob
,
H®áÚ”
* 
pH®áÚ”
);

1201 
	mvœtu®
 ~
Ra¡”S’d”
();

1205 
BOOL
 
Proûss
(
RASTERDATA
* 
IÅutRa¡”
=
NULL
);

1206 
	$Flush
() { };

1207 
BYTE
* 
	$NextOuutRa¡”
(
COLORTYPE
 
¿¡”cŞÜ
è{  
NULL
; 
	}
}

1208 
	$G‘OuutWidth
(
COLORTYPE
 
¿¡”cŞÜ
è{  0; 
	}
}

1211 
DRIVER_ERROR
 
	gcÚ¡ruùÜ_”rÜ
;

1213 
DRIVER_ERROR
 
S’dRa¡”
(
RASTERDATA
* 
IÅutRa¡”
=
NULL
);

1215 
	g´iv©e
:

1216 
Prš‹r
* 
thePrš‹r
;

1218 
PrštCÚ‹xt
* 
	gthePrštCÚ‹xt
;

1219 
Job
* 
	gtheJob
;

1220 
H®áÚ”
* 
	gtheH®áÚ”
;

1221 
	gm_lNBÏnkRa¡”s
;

1227 #ià
defšed
(
APDK_FONTS_NEEDED
)

1242 şas 
	cTextM­³r


1244 
	mpublic
:

1245 
TextM­³r
(
TextT¿n¦©Ü
* 
t
);

1248 
vœtu®
 
M­
(
BYTE
 
b
,BYTE* 
bSub¡
);

1251 
	mSub¡L’
;

1252 
	mch¬£t
[
MAX_CHAR_SET
];

1254 
	m´Ùeùed
:

1255 
TextT¿n¦©Ü
* 
theT¿n¦©Ü
;

1262 şas 
	cG’”icM­³r
 : 
public
 
TextM­³r


1264 
public
:

1265 
G’”icM­³r
(
TextT¿n¦©Ü
* 
t
);

1266 
M­
(
BYTE
 
b
,BYTE* 
bSub¡
);

1275 şas 
	cTextMªag”


1278 
	mpublic
:

1279 
TextMªag”
(
TextT¿n¦©Ü
* 
t
,
PršbËX
, 
PršbËY
);

1280 
	mvœtu®
 ~
TextMªag”
();

1282 
vœtu®
 
DRIVER_ERROR
 
TextOut
(cÚ¡ * 
pTextSŒšg
, 
iL’SŒšg
,

1283 cÚ¡ 
FÚt
& 
fÚt
, 
iAbsX
=-1, 
iAbsY
=-1);

1284 
TextT¿n¦©Ü
* 
	mtheT¿n¦©Ü
;

1286 
DRIVER_ERROR
 
	mcÚ¡ruùÜ_”rÜ
;

1288 
	m´Ùeùed
:

1290 
PršbËRegiÚX
;

1291 
	mPršbËRegiÚY
;

1293 
DRIVER_ERROR
 
CheckCoÜds
(
iAbsX
, 
iAbsY
 );

1295 
TextM­³r
* 
	mtheM­³r
;

1301 
	gAPDK_END_NAMESPACE


	@prnt/hpijs/interp.h

32 #iâdeà
APDK_INTERP_H


33 
	#APDK_INTERP_H


	)

35 
	gAPDK_BEGIN_NAMESPACE


38 
	#NUMBER_RASTERS
 3

	)

41 
	sr¡


43 
	mWidth
;

44 
	mSÿËFaùÜMuÉl›r
;

45 
	mSÿËFaùÜDivisÜ
;

47 
	mRa¡”sšBufãr
;

48 * 
	mBufã½t
[
NUMBER_RASTERS
];

49 
	mBufãrSize
;

50 * 
	mBufãr
;

52 } 
	tRESSYNSTRUCT
;

55 
ResSynS¹
 ( 
WidthInPix–s
,

56 
SÿËFaùÜMuÉl›r
,

57 
SÿËFaùÜDivisÜ
,

59 
RESSYNSTRUCT
 *
ResSynSŒuù
);

62 
ResSyn
(
RESSYNSTRUCT
 *
ResSynSŒuù
, *
¿¡”_š
,

63 *
¿¡”_out
 );

65 
	gAPDK_END_NAMESPACE


	@prnt/hpijs/interp_data_50.h

32 #iâdeà
APDK_INTERP_DATA_50_H


33 
	#APDK_INTERP_DATA_50_H


	)

35 
	gAPDK_BEGIN_NAMESPACE


37 
	#NBANDS3
 8

	)

38 
	#NSUBCLASSES3
 45

	)

39 
	#VARIANCE3
 ((è0.222875)

	)

40 
	#INV_VARIANCE3
 ((è4.486825)

	)

41 
	#CNST3
 ((è-1.346927)

	)

42 
	#CLUST_VEC_POWER3
 ((è0.250000)

	)

43 
	#INTERP_FACTOR3
 2

	)

44 
	#W3
 1

	)

45 
	#P3
 1

	)

46 
	#BORDER3
 3

	)

47 
	#TOTAL_LENGTH3
 13

	)

48 
	#INTERP_CLUST_LENGTH3
 8

	)

49 
	#FILT_LENGTH3
 9

	)

50 
	#HIGH_RES_LENGTH3
 4

	)

52 cÚ¡ 
	gpi3
[
NSUBCLASSES3
] =

65 cÚ¡ 
	gm—ns3
[
NSUBCLASSES3
*
NBANDS3
] =

116 cÚ¡ 
	gjošt_m—ns3
[
NSUBCLASSES3
*
TOTAL_LENGTH3
] =

218 cÚ¡ 
	gf‹r3
[
NSUBCLASSES3
*
FILT_LENGTH3
*
HIGH_RES_LENGTH3
] =

492 
	gAPDK_END_NAMESPACE


	@prnt/hpijs/io_defs.h

31 #iâdeà
APDK_IO_DEFS_H


32 
	#APDK_IO_DEFS_H


	)

34 
	#NFAULT_BIT
 0x08

	)

35 
	#SELECT_BIT
 0x10

	)

36 
	#PERROR_BIT
 0x20

	)

37 
	#NACK_BIT
 0x40

	)

38 
	#BUSY_BIT
 0x80

	)

40 
	#STATUS_MASK
 (
NFAULT_BIT
 | 
PERROR_BIT
)

	)

41 
	#BUSY_MASK
 (
BUSY_BIT
 | 
NACK_BIT
 | 
NFAULT_BIT
)

	)

43 
	#DEVICE_IS_BUSY
(
»g
èÔeg =ğ
BUSY_MASK
)

	)

44 
	#DEVICE_IS_OOP
(
»g
è(Ôeg & 
STATUS_MASK
è=ğ
OOP
)

	)

45 
	#DEVICE_JAMMED_OR_TRAPPED
(
»g
èĞ(Ôeg & 
STATUS_MASK
è=ğ
JAMMED
è|| (Ôeg & STATUS_MASKè=ğ
ERROR_TRAP
è)

	)

46 
	#DEVICE_PAPER_JAMMED
(
»g
è(Ôeg & 
STATUS_MASK
è=ğ
JAMMED
)

	)

47 
	#DEVICE_IO_TRAP
(
»g
è(Ôeg & 
STATUS_MASK
è=ğ
ERROR_TRAP
)

	)

49 
	#OOP
 (
NFAULT_BIT
 | 
PERROR_BIT
)

	)

50 
	#JAMMED
 (
PERROR_BIT
)

	)

51 
	#ERROR_TRAP
 (0)

	)

52 
	#OFFLINE
 (
NFAULT_BIT
)

	)

54 
	#MAX_BUSY_TIME
 30000

55 
	#C32_STATUS_WAIT
 2000

56 

	)

57 
	#MAX_SLOW_POLL_TIMES
 3

	)

58 
	#MIN_XFER_FOR_SLOW_POLL
 2

	)

	@prnt/hpijs/jccolor.c

1 #ià
defšed
 (
APDK_LJJETREADY
è|| defšed (
APDK_QUICKCONNECT
è|| defšed (
APDK_PSCRIPT
)

12 
	#JPEG_INTERNALS


	)

13 
	~"jšşude.h
"

14 
	~"j³glib.h
"

21 
j³g_cŞÜ_cÚv”‹r
 
	mpub
;

24 
INT32
 * 
	mrgb_ycc_b
;

25 } 
	tmy_cŞÜ_cÚv”‹r
;

27 
my_cŞÜ_cÚv”‹r
 * 
	tmy_ccÚv”t_±r
;

70 
	#SCALEBITS
 16

	)

71 
	#CBCR_OFFSET
 ((
INT32
è
CENTERJSAMPLE
 << 
SCALEBITS
)

	)

72 
	#ONE_HALF
 ((
INT32
è1 << (
SCALEBITS
-1))

	)

73 
	#FIX
(
x
è((
INT32
è((xè* (1L<<
SCALEBITS
è+ 0.5))

	)

81 
	giU£MojaveCsc
 = 1;

83 
	gR_Y_OFF
;

84 
	gG_Y_OFF
;

85 
	gB_Y_OFF
;

86 
	gR_CB_OFF
;

87 
	gG_CB_OFF
;

88 
	gB_CB_OFF
;

89 
	gR_CR_OFF
;

90 
	gG_CR_OFF
;

91 
	gB_CR_OFF
;

92 
	gTABLE_SIZE
;

94 
	$hp_rgb_ycc_£tup
 (
iFÏg
)

96 
iU£MojaveCsc
 = 
iFÏg
;

97 ià(
iU£MojaveCsc
)

99 
R_Y_OFF
 = 0;

100 
G_Y_OFF
 = (1*(
MAXJSAMPLE
+1));

101 
B_Y_OFF
 = (2*(
MAXJSAMPLE
+1));

102 
R_CB_OFF
 = 
R_Y_OFF
;

103 
G_CB_OFF
 = (3*(
MAXJSAMPLE
+1));

104 
B_CB_OFF
 = 
G_Y_OFF
;

105 
R_CR_OFF
 = 
R_Y_OFF
;

106 
G_CR_OFF
 = 
G_Y_OFF
;

107 
B_CR_OFF
 = 
G_CB_OFF
;

108 
TABLE_SIZE
 = (4*(
MAXJSAMPLE
+1));

112 
R_Y_OFF
 = 0;

113 
G_Y_OFF
 = (1*(
MAXJSAMPLE
+1));

114 
B_Y_OFF
ğ(2*(
MAXJSAMPLE
+1));

115 
R_CB_OFF
ğ(3*(
MAXJSAMPLE
+1));

116 
G_CB_OFF
ğ(4*(
MAXJSAMPLE
+1));

117 
B_CB_OFF
ğ(5*(
MAXJSAMPLE
+1));

118 
R_CR_OFF
ğ
B_CB_OFF
;

119 
G_CR_OFF
ğ(6*(
MAXJSAMPLE
+1));

120 
B_CR_OFF
ğ(7*(
MAXJSAMPLE
+1));

121 
TABLE_SIZE
 =(8*(
MAXJSAMPLE
+1));

123 
	}
}

129 
	$METHODDEF
()

130 
	$rgb_ycc_¡¬t
 (
j_com´ess_±r
 
cšfo
)

132 
my_ccÚv”t_±r
 
ccÚv”t
 = (my_ccÚv”t_±rè
cšfo
->cconvert;

133 
INT32
 * 
rgb_ycc_b
;

134 
INT32
 
i
;

137 
ccÚv”t
->
rgb_ycc_b
 =„gb_ycc_b = (
INT32
 *)

138 (*
cšfo
->
mem
->
®loc_sm®l
è((
j_commÚ_±r
ècšfo, 
JPOOL_IMAGE
,

139 (
TABLE_SIZE
 * 
	`SIZEOF
(
INT32
)));

141 
i
 = 0; i <ğ
MAXJSAMPLE
; i++)

143 ià(
iU£MojaveCsc
)

145 
rgb_ycc_b
[
i
+
R_Y_OFF
] = 
	`FIX
(0.50000) * i;

146 
rgb_ycc_b
[
i
+
G_Y_OFF
] = 
	`FIX
(0.00000) * i;

147 
rgb_ycc_b
[
i
+
B_Y_OFF
] = 
	`FIX
(0.00000è* i + 
ONE_HALF
;

151 
rgb_ycc_b
[
i
+
G_CB_OFF
] = (-
	`FIX
(0.50000)è* i + 
CBCR_OFFSET
 + 
ONE_HALF
-1;

171 
rgb_ycc_b
[
i
+
R_Y_OFF
] = 
	`FIX
(0.29900) * i;

172 
rgb_ycc_b
[
i
+
G_Y_OFF
] = 
	`FIX
(0.58700) * i;

173 
rgb_ycc_b
[
i
+
B_Y_OFF
] = 
	`FIX
(0.11400è* i + 
ONE_HALF
;

174 
rgb_ycc_b
[
i
+
R_CB_OFF
] = (-
	`FIX
(0.16874)) * i;

175 
rgb_ycc_b
[
i
+
G_CB_OFF
] = (-
	`FIX
(0.33126)) * i;

180 
rgb_ycc_b
[
i
+
B_CB_OFF
] = 
	`FIX
(0.50000è* i + 
CBCR_OFFSET
 + 
ONE_HALF
-1;

184 
rgb_ycc_b
[
i
+
G_CR_OFF
] = (-
	`FIX
(0.41869)) * i;

185 
rgb_ycc_b
[
i
+
B_CR_OFF
] = (-
	`FIX
(0.08131)) * i;

188 
	}
}

203 
	$METHODDEF
()

204 
	$rgb_ycc_cÚv”t
 (
j_com´ess_±r
 
cšfo
,

205 
JSAMPARRAY
 
šput_buf
, 
JSAMPIMAGE
 
ouut_buf
,

206 
JDIMENSION
 
ouut_row
, 
num_rows
)

208 
my_ccÚv”t_±r
 
ccÚv”t
 = (my_ccÚv”t_±rè
cšfo
->cconvert;

209 
r
, 
g
, 
b
;

210 
INT32
 * 
ùab
 = 
ccÚv”t
->
rgb_ycc_b
;

211 
JSAMPROW
 
š±r
;

212 
JSAMPROW
 
ouŒ0
, 
ouŒ1
, 
ouŒ2
;

213 
JDIMENSION
 
cŞ
;

214 
JDIMENSION
 
num_cŞs
 = 
cšfo
->
image_width
;

216 --
num_rows
 >= 0) {

217 
š±r
 = *
šput_buf
++;

218 
ouŒ0
 = 
ouut_buf
[0][
ouut_row
];

219 
ouŒ1
 = 
ouut_buf
[1][
ouut_row
];

220 
ouŒ2
 = 
ouut_buf
[2][
ouut_row
];

221 
ouut_row
++;

222 
cŞ
 = 0; cŞ < 
num_cŞs
; col++) {

223 
r
 = 
	`GETJSAMPLE
(
š±r
[
RGB_RED
]);

224 
g
 = 
	`GETJSAMPLE
(
š±r
[
RGB_GREEN
]);

225 
b
 = 
	`GETJSAMPLE
(
š±r
[
RGB_BLUE
]);

226 
š±r
 +ğ
RGB_PIXELSIZE
;

233 
ouŒ0
[
cŞ
] = (
JSAMPLE
)

234 ((
ùab
[
r
+
R_Y_OFF
] + cb[
g
+
G_Y_OFF
] + cb[
b
+
B_Y_OFF
])

235 >> 
SCALEBITS
);

237 
ouŒ1
[
cŞ
] = (
JSAMPLE
)

238 ((
ùab
[
r
+
R_CB_OFF
] + cb[
g
+
G_CB_OFF
] + cb[
b
+
B_CB_OFF
])

239 >> 
SCALEBITS
);

241 
ouŒ2
[
cŞ
] = (
JSAMPLE
)

242 ((
ùab
[
r
+
R_CR_OFF
] + cb[
g
+
G_CR_OFF
] + cb[
b
+
B_CR_OFF
])

243 >> 
SCALEBITS
);

246 
	}
}

259 
	$METHODDEF
()

260 
	$rgb_g¿y_cÚv”t
 (
j_com´ess_±r
 
cšfo
,

261 
JSAMPARRAY
 
šput_buf
, 
JSAMPIMAGE
 
ouut_buf
,

262 
JDIMENSION
 
ouut_row
, 
num_rows
)

264 
my_ccÚv”t_±r
 
ccÚv”t
 = (my_ccÚv”t_±rè
cšfo
->cconvert;

265 
r
, 
g
, 
b
;

266 
INT32
 * 
ùab
 = 
ccÚv”t
->
rgb_ycc_b
;

267 
JSAMPROW
 
š±r
;

268 
JSAMPROW
 
ouŒ
;

269 
JDIMENSION
 
cŞ
;

270 
JDIMENSION
 
num_cŞs
 = 
cšfo
->
image_width
;

272 --
num_rows
 >= 0) {

273 
š±r
 = *
šput_buf
++;

274 
ouŒ
 = 
ouut_buf
[0][
ouut_row
];

275 
ouut_row
++;

276 
cŞ
 = 0; cŞ < 
num_cŞs
; col++) {

277 
r
 = 
	`GETJSAMPLE
(
š±r
[
RGB_RED
]);

278 
g
 = 
	`GETJSAMPLE
(
š±r
[
RGB_GREEN
]);

279 
b
 = 
	`GETJSAMPLE
(
š±r
[
RGB_BLUE
]);

280 
š±r
 +ğ
RGB_PIXELSIZE
;

282 
ouŒ
[
cŞ
] = (
JSAMPLE
)

283 ((
ùab
[
r
+
R_Y_OFF
] + cb[
g
+
G_Y_OFF
] + cb[
b
+
B_Y_OFF
])

284 >> 
SCALEBITS
);

287 
	}
}

298 
	$METHODDEF
()

299 
	$cmyk_ycck_cÚv”t
 (
j_com´ess_±r
 
cšfo
,

300 
JSAMPARRAY
 
šput_buf
, 
JSAMPIMAGE
 
ouut_buf
,

301 
JDIMENSION
 
ouut_row
, 
num_rows
)

303 
my_ccÚv”t_±r
 
ccÚv”t
 = (my_ccÚv”t_±rè
cšfo
->cconvert;

304 
r
, 
g
, 
b
;

305 
INT32
 * 
ùab
 = 
ccÚv”t
->
rgb_ycc_b
;

306 
JSAMPROW
 
š±r
;

307 
JSAMPROW
 
ouŒ0
, 
ouŒ1
, 
ouŒ2
, 
ouŒ3
;

308 
JDIMENSION
 
cŞ
;

309 
JDIMENSION
 
num_cŞs
 = 
cšfo
->
image_width
;

311 --
num_rows
 >= 0) {

312 
š±r
 = *
šput_buf
++;

313 
ouŒ0
 = 
ouut_buf
[0][
ouut_row
];

314 
ouŒ1
 = 
ouut_buf
[1][
ouut_row
];

315 
ouŒ2
 = 
ouut_buf
[2][
ouut_row
];

316 
ouŒ3
 = 
ouut_buf
[3][
ouut_row
];

317 
ouut_row
++;

318 
cŞ
 = 0; cŞ < 
num_cŞs
; col++) {

319 
r
 = 
MAXJSAMPLE
 - 
	`GETJSAMPLE
(
š±r
[0]);

320 
g
 = 
MAXJSAMPLE
 - 
	`GETJSAMPLE
(
š±r
[1]);

321 
b
 = 
MAXJSAMPLE
 - 
	`GETJSAMPLE
(
š±r
[2]);

323 
ouŒ3
[
cŞ
] = 
š±r
[3];

324 
š±r
 += 4;

331 
ouŒ0
[
cŞ
] = (
JSAMPLE
)

332 ((
ùab
[
r
+
R_Y_OFF
] + cb[
g
+
G_Y_OFF
] + cb[
b
+
B_Y_OFF
])

333 >> 
SCALEBITS
);

335 
ouŒ1
[
cŞ
] = (
JSAMPLE
)

336 ((
ùab
[
r
+
R_CB_OFF
] + cb[
g
+
G_CB_OFF
] + cb[
b
+
B_CB_OFF
])

337 >> 
SCALEBITS
);

339 
ouŒ2
[
cŞ
] = (
JSAMPLE
)

340 ((
ùab
[
r
+
R_CR_OFF
] + cb[
g
+
G_CR_OFF
] + cb[
b
+
B_CR_OFF
])

341 >> 
SCALEBITS
);

344 
	}
}

353 
	$METHODDEF
()

354 
	$g¿ysÿË_cÚv”t
 (
j_com´ess_±r
 
cšfo
,

355 
JSAMPARRAY
 
šput_buf
, 
JSAMPIMAGE
 
ouut_buf
,

356 
JDIMENSION
 
ouut_row
, 
num_rows
)

358 
JSAMPROW
 
š±r
;

359 
JSAMPROW
 
ouŒ
;

360 
JDIMENSION
 
cŞ
;

361 
JDIMENSION
 
num_cŞs
 = 
cšfo
->
image_width
;

362 
š¡ride
 = 
cšfo
->
šput_compÚ’ts
;

364 --
num_rows
 >= 0) {

365 
š±r
 = *
šput_buf
++;

366 
ouŒ
 = 
ouut_buf
[0][
ouut_row
];

367 
ouut_row
++;

368 
cŞ
 = 0; cŞ < 
num_cŞs
; col++) {

369 
ouŒ
[
cŞ
] = 
š±r
[0];

370 
š±r
 +ğ
š¡ride
;

373 
	}
}

382 
	$METHODDEF
()

383 
	$nuÎ_cÚv”t
 (
j_com´ess_±r
 
cšfo
,

384 
JSAMPARRAY
 
šput_buf
, 
JSAMPIMAGE
 
ouut_buf
,

385 
JDIMENSION
 
ouut_row
, 
num_rows
)

387 
JSAMPROW
 
š±r
;

388 
JSAMPROW
 
ouŒ
;

389 
JDIMENSION
 
cŞ
;

390 
ci
;

391 
nc
 = 
cšfo
->
num_compÚ’ts
;

392 
JDIMENSION
 
num_cŞs
 = 
cšfo
->
image_width
;

394 --
num_rows
 >= 0) {

396 
ci
 = 0; c˜< 
nc
; ci++) {

397 
š±r
 = *
šput_buf
;

398 
ouŒ
 = 
ouut_buf
[
ci
][
ouut_row
];

399 
cŞ
 = 0; cŞ < 
num_cŞs
; col++) {

400 
ouŒ
[
cŞ
] = 
š±r
[
ci
];

401 
š±r
 +ğ
nc
;

404 
šput_buf
++;

405 
ouut_row
++;

407 
	}
}

414 
	$METHODDEF
()

415 
	$nuÎ_m‘hod
 (
j_com´ess_±r
 
cšfo
)

418 
	}
}

425 
	$GLOBAL
()

426 
	$jš™_cŞÜ_cÚv”‹r
 (
j_com´ess_±r
 
cšfo
)

428 
my_ccÚv”t_±r
 
ccÚv”t
;

430 
ccÚv”t
 = (
my_ccÚv”t_±r
)

431 (*
cšfo
->
mem
->
®loc_sm®l
è((
j_commÚ_±r
ècšfo, 
JPOOL_IMAGE
,

432 
	`SIZEOF
(
my_cŞÜ_cÚv”‹r
));

433 
cšfo
->
ccÚv”t
 = (
j³g_cŞÜ_cÚv”‹r
 *) cconvert;

435 
ccÚv”t
->
pub
.
¡¬t_·ss
 = 
nuÎ_m‘hod
;

438 
cšfo
->
š_cŞÜ_¥aû
) {

439 
JCS_GRAYSCALE
:

440 ià(
cšfo
->
šput_compÚ’ts
 != 1)

441 
	`ERREXIT
(
cšfo
, 
JERR_BAD_IN_COLORSPACE
);

444 
JCS_RGB
:

445 #ià
RGB_PIXELSIZE
 != 3

446 ià(
cšfo
->
šput_compÚ’ts
 !ğ
RGB_PIXELSIZE
)

447 
	`ERREXIT
(
cšfo
, 
JERR_BAD_IN_COLORSPACE
);

451 
JCS_YCbCr
:

452 ià(
cšfo
->
šput_compÚ’ts
 != 3)

453 
	`ERREXIT
(
cšfo
, 
JERR_BAD_IN_COLORSPACE
);

456 
JCS_CMYK
:

457 
JCS_YCCK
:

458 ià(
cšfo
->
šput_compÚ’ts
 != 4)

459 
	`ERREXIT
(
cšfo
, 
JERR_BAD_IN_COLORSPACE
);

463 ià(
cšfo
->
šput_compÚ’ts
 < 1)

464 
	`ERREXIT
(
cšfo
, 
JERR_BAD_IN_COLORSPACE
);

469 
cšfo
->
j³g_cŞÜ_¥aû
) {

470 
JCS_GRAYSCALE
:

471 ià(
cšfo
->
num_compÚ’ts
 != 1)

472 
	`ERREXIT
(
cšfo
, 
JERR_BAD_J_COLORSPACE
);

473 ià(
cšfo
->
š_cŞÜ_¥aû
 =ğ
JCS_GRAYSCALE
)

474 
ccÚv”t
->
pub
.
cŞÜ_cÚv”t
 = 
g¿ysÿË_cÚv”t
;

475 ià(
cšfo
->
š_cŞÜ_¥aû
 =ğ
JCS_RGB
) {

476 
ccÚv”t
->
pub
.
¡¬t_·ss
 = 
rgb_ycc_¡¬t
;

477 
ccÚv”t
->
pub
.
cŞÜ_cÚv”t
 = 
rgb_g¿y_cÚv”t
;

478 } ià(
cšfo
->
š_cŞÜ_¥aû
 =ğ
JCS_YCbCr
)

479 
ccÚv”t
->
pub
.
cŞÜ_cÚv”t
 = 
g¿ysÿË_cÚv”t
;

481 
	`ERREXIT
(
cšfo
, 
JERR_CONVERSION_NOTIMPL
);

484 
JCS_RGB
:

485 ià(
cšfo
->
num_compÚ’ts
 != 3)

486 
	`ERREXIT
(
cšfo
, 
JERR_BAD_J_COLORSPACE
);

487 ià(
cšfo
->
š_cŞÜ_¥aû
 =ğ
JCS_RGB
 && 
RGB_PIXELSIZE
 == 3)

488 
ccÚv”t
->
pub
.
cŞÜ_cÚv”t
 = 
nuÎ_cÚv”t
;

490 
	`ERREXIT
(
cšfo
, 
JERR_CONVERSION_NOTIMPL
);

493 
JCS_YCbCr
:

494 ià(
cšfo
->
num_compÚ’ts
 != 3)

495 
	`ERREXIT
(
cšfo
, 
JERR_BAD_J_COLORSPACE
);

496 ià(
cšfo
->
š_cŞÜ_¥aû
 =ğ
JCS_RGB
) {

497 
ccÚv”t
->
pub
.
¡¬t_·ss
 = 
rgb_ycc_¡¬t
;

498 
ccÚv”t
->
pub
.
cŞÜ_cÚv”t
 = 
rgb_ycc_cÚv”t
;

499 } ià(
cšfo
->
š_cŞÜ_¥aû
 =ğ
JCS_YCbCr
)

500 
ccÚv”t
->
pub
.
cŞÜ_cÚv”t
 = 
nuÎ_cÚv”t
;

502 
	`ERREXIT
(
cšfo
, 
JERR_CONVERSION_NOTIMPL
);

505 
JCS_CMYK
:

506 ià(
cšfo
->
num_compÚ’ts
 != 4)

507 
	`ERREXIT
(
cšfo
, 
JERR_BAD_J_COLORSPACE
);

508 ià(
cšfo
->
š_cŞÜ_¥aû
 =ğ
JCS_CMYK
)

509 
ccÚv”t
->
pub
.
cŞÜ_cÚv”t
 = 
nuÎ_cÚv”t
;

511 
	`ERREXIT
(
cšfo
, 
JERR_CONVERSION_NOTIMPL
);

514 
JCS_YCCK
:

515 ià(
cšfo
->
num_compÚ’ts
 != 4)

516 
	`ERREXIT
(
cšfo
, 
JERR_BAD_J_COLORSPACE
);

517 ià(
cšfo
->
š_cŞÜ_¥aû
 =ğ
JCS_CMYK
) {

518 
ccÚv”t
->
pub
.
¡¬t_·ss
 = 
rgb_ycc_¡¬t
;

519 
ccÚv”t
->
pub
.
cŞÜ_cÚv”t
 = 
cmyk_ycck_cÚv”t
;

520 } ià(
cšfo
->
š_cŞÜ_¥aû
 =ğ
JCS_YCCK
)

521 
ccÚv”t
->
pub
.
cŞÜ_cÚv”t
 = 
nuÎ_cÚv”t
;

523 
	`ERREXIT
(
cšfo
, 
JERR_CONVERSION_NOTIMPL
);

527 ià(
cšfo
->
j³g_cŞÜ_¥aû
 !ğcšfo->
š_cŞÜ_¥aû
 ||

528 
cšfo
->
num_compÚ’ts
 !ğcšfo->
šput_compÚ’ts
)

529 
	`ERREXIT
(
cšfo
, 
JERR_CONVERSION_NOTIMPL
);

530 
ccÚv”t
->
pub
.
cŞÜ_cÚv”t
 = 
nuÎ_cÚv”t
;

533 
	}
}

	@prnt/hpijs/jdatadbf.c

1 #ià
defšed
 (
APDK_LJJETREADY
è|| defšed (
APDK_QUICKCONNECT
è|| defšed (
APDK_PSCRIPT
)

14 
	~"jšşude.h
"

15 
	~"j³glib.h
"

16 
	~"j”rÜ.h
"

19 #iâdeà
JMETHOD


20 
	#JMETHOD
(
ty³
,
m‘hodÇme
,
¬gli¡
è
	`ty³
 (*m‘hodÇmeè()

	)

26 
j³g_de¡š©iÚ_mgr
 
	mpub
;

28 
JOCTET
 * 
	moutbuff
;

29 
JOCTET
 * 
	mbufãr
;

30 
UINT16
 
	msize_outbuff
;

31 
JMETHOD
 (, 
æush_ouut_bufãr_ÿÎback
, (
JOCTET
 *
outbuf
, JOCTET* 
bufãr
, 
size_t
 
size
));

32 } 
	tmy_de¡š©iÚ_mgr
;

34 
my_de¡š©iÚ_mgr
 * 
	tmy_de¡_±r
;

36 
	#OUTPUT_BUF_SIZE
 4096

	)

44 
	$METHODDEF
()

45 
	$š™_de¡š©iÚ
 (
j_com´ess_±r
 
cšfo
)

47 
my_de¡_±r
 
de¡
 = (my_de¡_±rè
cšfo
->dest;

50 
de¡
->
bufãr
 = (
JOCTET
 *)

51 (*
cšfo
->
mem
->
®loc_sm®l
è((
j_commÚ_±r
ècšfo, 
JPOOL_IMAGE
,

52 
OUTPUT_BUF_SIZE
 * 
	`SIZEOF
(
JOCTET
));

54 
de¡
->
pub
.
Ãxt_ouut_by‹
 = de¡->
bufãr
;

55 
de¡
->
pub
.
ä“_š_bufãr
 = 
OUTPUT_BUF_SIZE
;

56 
	}
}

82 
	$METHODDEF
(
boŞ—n
)

83 
	$em±y_ouut_bufãr
 (
j_com´ess_±r
 
cšfo
)

85 
my_de¡_±r
 
de¡
 = (my_de¡_±rè
cšfo
->dest;

96 (*
de¡
->
æush_ouut_bufãr_ÿÎback
)(de¡->
outbuff
, de¡->
bufãr
, 
OUTPUT_BUF_SIZE
);

99 
de¡
->
pub
.
Ãxt_ouut_by‹
 = de¡->
bufãr
;

100 
de¡
->
pub
.
ä“_š_bufãr
 = 
OUTPUT_BUF_SIZE
;

102  
TRUE
;

103 
	}
}

115 
	$METHODDEF
()

116 
	$‹rm_de¡š©iÚ
 (
j_com´ess_±r
 
cšfo
)

118 
my_de¡_±r
 
de¡
 = (my_de¡_±rè
cšfo
->dest;

119 
size_t
 
d©acouÁ
 = 
OUTPUT_BUF_SIZE
 - 
de¡
->
pub
.
ä“_š_bufãr
;

122 ià(
d©acouÁ
 > 0) {

132 (*
de¡
->
æush_ouut_bufãr_ÿÎback
)(de¡->
outbuff
, de¡->
bufãr
, 
d©acouÁ
);

134 
	}
}

143 
	$GLOBAL
()

144 
	$j³g_bufãr_de¡
 (
j_com´ess_±r
 
cšfo
, 
JOCTET
* 
outbuff
, * 
æush_ouut_bufãr_ÿÎback
)

146 
my_de¡_±r
 
de¡
;

154 ià(
cšfo
->
de¡
 =ğ
NULL
) {

155 
cšfo
->
de¡
 = (
j³g_de¡š©iÚ_mgr
 *)

156 (*
cšfo
->
mem
->
®loc_sm®l
è((
j_commÚ_±r
ècšfo, 
JPOOL_PERMANENT
,

157 
	`SIZEOF
(
my_de¡š©iÚ_mgr
));

160 
de¡
 = (
my_de¡_±r
è
cšfo
->dest;

161 
de¡
->
pub
.
š™_de¡š©iÚ
 = init_destination;

162 
de¡
->
pub
.
em±y_ouut_bufãr
 =ƒmpty_output_buffer;

163 
de¡
->
pub
.
‹rm_de¡š©iÚ
 =erm_destination;

165 
de¡
->
outbuff
 = outbuff;

166 
de¡
->
size_outbuff
 = 0;

167 
de¡
->
æush_ouut_bufãr_ÿÎback
 = flush_output_buffer_callback;

169 
	}
}

171 
	$GLOBAL
()

172 
	$j³g_bufãr_size_de¡
 (
j_com´ess_±r
 
cšfo
)

174 
my_de¡_±r
 
de¡
 = (my_de¡_±rè
cšfo
->dest;

176  
de¡
->
size_outbuff
;

177 
	}
}

	@prnt/hpijs/jinclude.h

20 
	~"jcÚfig.h
"

21 
	#JCONFIG_INCLUDED


	)

34 #ifdeà
HAVE_STDDEF_H


35 
	~<¡ddef.h
>

38 #ifdeà
HAVE_STDLIB_H


39 
	~<¡dlib.h
>

42 #ifdeà
NEED_SYS_TYPES_H


43 
	~<sys/ty³s.h
>

46 
	~<¡dio.h
>

58 #ifdeà
NEED_BSD_STRINGS


60 
	~<¡ršgs.h
>

61 
	#MEMZERO
(
rg‘
,
size
è
	`bz”o
((*)Ñ¬g‘), (
size_t
)(size))

	)

62 
	#MEMCOPY
(
de¡
,
¤c
,
size
è
	`bcİy
((cÚ¡ *)(¤c), (*)(de¡), (
size_t
)(size))

	)

66 
	~<¡ršg.h
>

67 
	#MEMZERO
(
rg‘
,
size
è
	`mem£t
((*)Ñ¬g‘), 0, (
size_t
)(size))

	)

68 
	#MEMCOPY
(
de¡
,
¤c
,
size
è
	`memıy
((*)(de¡), (cÚ¡ *)(¤c), (
size_t
)(size))

	)

80 
	#SIZEOF
(
objeù
è((
size_t
è(objeù))

	)

88 
	#JFREAD
(
fe
,
buf
,
sizeofbuf
) \

89 ((
size_t
è
	`ä—d
((*è(
buf
), (size_tè1, (size_tè(
sizeofbuf
), (
fe
)))

	)

90 
	#JFWRITE
(
fe
,
buf
,
sizeofbuf
) \

91 ((
size_t
è
	`fwr™e
((cÚ¡ *è(
buf
), (size_tè1, (size_tè(
sizeofbuf
), (
fe
)))

	)

	@prnt/hpijs/job.cpp

31 
	~"h—d”.h
"

32 
	~"h®áÚ”.h
"

33 
	~"cŞÜm©ch.h
"

34 
	~"sÿËr_İ’.h
"

35 
	~"sÿËr_´İ.h
"

37 
APDK_BEGIN_NAMESPACE


38 
H®áÚ”
* 
C»©e_H®áÚ”
Ğ
Sy¡emS”viûs
* 
pSys
, 
PrštMode
* 
pPM
,

39 
iIÅutWidth
, 
iNumRows
[], 
HiResFaùÜ
,

40 
BOOL
 
u£m©rix
);

41 
SÿËr
* 
C»©e_SÿËr
(
Sy¡emS”viûs
* 
pSys
,
šputwidth
,

42 
num”©Ü
,
d’omš©Ü
,
BOOL
 
v
,
By‹sP”Pix–
);

43 
CŞÜM©ch”
* 
C»©e_CŞÜM©ch”
Ğ
Sy¡emS”viûs
* 
pSys
,

44 
CŞÜM­
 
cm
,
DyeCouÁ
,

45 
iIÅutWidth
);

46 
BOOL
 
Prİr›ryImagšg
();

47 
BOOL
 
Prİr›rySÿlšg
();

48 
APDK_END_NAMESPACE


50 
APDK_BEGIN_NAMESPACE


52 
äac
(
f
);

54 
	#In™ŸlPix–Size
 3

55 
	#By‹s
(
x
è((x/8)+(x%8))

	)

70 
	gJob
::
Job


72 
PrštCÚ‹xt
* 
pPC


74 
thePrštCÚ‹xt
(
pPC
),

75 
pSS
(
pPC
->pSS),

76 
thePrš‹r
(
NULL
),

77 
theP–še
(
NULL
),

78 
pText
(
NULL
),

79 
pS’d”
(
NULL
),

80 
pH®áÚ”
(
NULL
),

81 
pCŞÜM©ch”
(
NULL
),

82 
pResSyÁh
(
NULL
),

83 
pBÏckPÏÃR•liÿtÜ
(
NULL
),

84 
pR•liÿtÜ
(
NULL
),

85 
theCom´essÜ
(
NULL
),

86 
pBÏckPÏÃCom´essÜ
(
NULL
),

87 
pH—d
(
NULL
),

88 #ià
defšed
(
APDK_VIP_COLORFILTERING
)

89 
pEº›
(
NULL
),

91 #ià
defšed
(
APDK_FONTS_NEEDED
)

92 
theTextMªag”
(
NULL
),

94 
Cu¼’tMode
(
pPC
->CurrentMode),

95 
fcouÁ
(0),

96 
skcouÁ
(0),

97 
RowsIÅut
(0),

98 
BÏnkRa¡”
(
NULL
),

99 
BÏckRa¡”
(
NULL
),

100 
	$D©aS’t
(
FALSE
)

101 #ifdeà
APDK_USAGE_LOG


102 , 
	`UText
(0),

103 
	$UTextCouÁ
(0)

106 #ifdeà
APDK_CAPTURE


107 
	`C­tu»_Job
(
pPC
);

109 
i
;

110 
cÚ¡ruùÜ_”rÜ
 = 
NO_ERROR
;

112 ià(!
thePrštCÚ‹xt
->
	`Prš‹rS–eùed
())

114 
cÚ¡ruùÜ_”rÜ
 = 
NO_PRINTER_SELECTED
;

117 
thePrš‹r
 = 
thePrštCÚ‹xt
->thePrinter;

120 
i
=0; i<()
MAXCOLORPLANES
; i++)

121 ià(
Cu¼’tMode
->
MixedRes
)

122 
numrows
[
i
] = 
Cu¼’tMode
->
ResŞutiÚX
[i] / Cu¼’tMode->
Ba£ResX
;

123 
numrows
[
i
]=1;

125 
ResBoo¡
 = 
Cu¼’tMode
->
Ba£ResX
 / Cu¼’tMode->
Ba£ResY
;

126 ià(
ResBoo¡
==0) ResBoost=1;

129 
pH—d
 = 
thePrš‹r
->
	`S–eùH—d”
(
thePrštCÚ‹xt
);

130 
	`CNEWCHECK
(
pH—d
);

134 
cÚ¡ruùÜ_”rÜ
=
	`£tbÏnk¿¡”
();

135 
CERRCHECK
;

138 
cÚ¡ruùÜ_”rÜ
=
thePrš‹r
->
	`Flush
();

139 
CERRCHECK
;

141 
cÚ¡ruùÜ_”rÜ
=
pH—d
->
	`S’d
();

142 
CERRCHECK
;

144 
CAPy
=
pH—d
->CAPy;

147 
cÚ¡ruùÜ_”rÜ
=
	`CÚfigu»
();

148 
CERRCHECK
;

151 #ià
	`defšed
(
APDK_FONTS_NEEDED
)

153 
pText
 = 
Ãw
 
	`TextT¿n¦©Ü
(
thePrš‹r
, 
pH—d
->
	`Qu®™yCode
(),

154 
thePrštCÚ‹xt
->
Cu¼’tMode
->
dyeCouÁ
);

155 
	`CNEWCHECK
(
pText
);

157 
theTextMªag”
 = 
NULL
;

158 ià(
Cu¼’tMode
->
bFÚtC­abË
)

160 
pix–sX
 = (è(è(
thePrštCÚ‹xt
->
	`´šbËwidth
() *

161 
Cu¼’tMode
->
Ba£ResX
);

162 
pix–sY
 = (è(è(
thePrštCÚ‹xt
->
	`´šbËheight
() *

163 
Cu¼’tMode
->
Ba£ResY
);

165 
theTextMªag”
=
Ãw
 
	`TextMªag”
Ğ
pText
, 
pix–sX
,
pix–sY
 );

166 
	`CNEWCHECK
(
theTextMªag”
);

167 
cÚ¡ruùÜ_”rÜ
 = 
theTextMªag”
->constructor_error;

168 
CERRCHECK
;

172 ià(!
thePrštCÚ‹xt
->
	`ModeAg»esW™hH¬dw¬e
(
TRUE
))

173 
cÚ¡ruùÜ_”rÜ
 = 
WARN_MODE_MISMATCH
;

175 #ifdeà
APDK_USAGE_LOG


176 
UH—d”
[0]='\0';

178 
	}
}

180 
DRIVER_ERROR
 
	gJob
::
	$S‘upH®áÚšg
(
HALFTONING_ALGORITHM
 
eHT
)

186 
BOOL
 
u£m©rix
 = (
eHT
 =ğ
MATRIX
);

189 #ifdeà
APDK_OPTIMIZE_FOR_SPEED


190 
u£m©rix
 = 
TRUE
;

193 
pH®áÚ”
 = 
	`C»©e_H®áÚ”
(
thePrštCÚ‹xt
->
pSS
, 
Cu¼’tMode
,

194 
OuutWidth
, 
numrows
,
ResBoo¡
,
u£m©rix
);

195 
	`NEWCHECK
(
pH®áÚ”
);

196  
pH®áÚ”
->
cÚ¡ruùÜ_”rÜ
;

197 
	}
}

199 
DRIVER_ERROR
 
	gJob
::
	$S‘upCŞÜM©chšg
()

202 
cmWidth
=
IÅutWidth
;

203 ià(
pResSyÁh
)

204 
cmWidth
 *= 2;

206 
pCŞÜM©ch”
 = 
	`C»©e_CŞÜM©ch”
(
thePrštCÚ‹xt
->
pSS
, 
Cu¼’tMode
->
cm­
,

207 
Cu¼’tMode
->
dyeCouÁ
, 
cmWidth
);

208 
	`NEWCHECK
(
pCŞÜM©ch”
);

209  
pCŞÜM©ch”
->
cÚ¡ruùÜ_”rÜ
;

210 
	}
}

213 
	gJob
::~
	$Job
()

215 #ifdeà
APDK_CAPTURE


216 
	`C­tu»_dJob
();

221 ià(
D©aS’t
)

223 
MedŸSourû
 
mSourû
 = 
thePrštCÚ‹xt
->
	`G‘MedŸSourû
 ();

224 ià(
mSourû
 =ğ
sourûBªÃr
)

226 
thePrštCÚ‹xt
->
	`S‘MedŸSourû
 (
sourûT¿yAuto
);

228 
	`Ãw·ge
();

229 
thePrštCÚ‹xt
->
	`S‘MedŸSourû
 (
mSourû
);

234 if(
pH—d
)

236 
pH—d
->
	`EndJob
();

240 #ià
	`defšed
(
APDK_FONTS_NEEDED
)

241 
	`DBG1
("deleting TextManager\n");

242 ià(
theTextMªag”
)

244 
d–‘e
 
theTextMªag”
;

248 
	`DBG1
("deleting RasterSender\n");

249 ià(
pS’d”
)

251 
d–‘e
 
pS’d”
;

254 ià(
pH®áÚ”
)

256 
d–‘e
 
pH®áÚ”
;

259 ià(
pCŞÜM©ch”
)

261 
d–‘e
 
pCŞÜM©ch”
;

264 ià(
BÏnkRa¡”
)

266 
pSS
->
	`F»eMemÜy
(
BÏnkRa¡”
);

269 ià(
BÏckRa¡”
)

271 
pSS
->
	`F»eMemÜy
(
BÏckRa¡”
);

274 ià(
pBÏckPÏÃR•liÿtÜ
)

276 
d–‘e
 
pBÏckPÏÃR•liÿtÜ
;

279 ià(
pR•liÿtÜ
)

281 
d–‘e
 
pR•liÿtÜ
;

284 ià(
pResSyÁh
)

286 
d–‘e
 
pResSyÁh
;

289 ià(
theP–še
)

291 
d–‘e
 
theP–še
;

294 ià(
pH—d
)

296 
d–‘e
 
pH—d
;

299 #ià
	`defšed
(
APDK_VIP_COLORFILTERING
)

300 ià(
pEº›
)

302 
d–‘e
 
pEº›
;

306 ià(
theCom´essÜ
)

308 
d–‘e
 
theCom´essÜ
;

311 ià(
pBÏckPÏÃCom´essÜ
)

313 
d–‘e
 
pBÏckPÏÃCom´essÜ
;

316 #ià
	`defšed
(
APDK_FONTS_NEEDED
)

317 ià(
pText
)

319 
d–‘e
 
pText
;

323 if(
thePrš‹r
)

325 
BYTE
 
‹mp
 = 0;

326 
thePrš‹r
->
EndJob
 = 
TRUE
;

327 
thePrš‹r
->
	`S’d
(&
‹mp
,0);

330 
	`DBG1
("done with ~Job\n");

331 
	}
}

334 
DRIVER_ERROR
 
	gJob
::
	$S’dCAPy
()

336  
pH—d
->
	`S’dCAPy
(
CAPy
++);

337 
	}
}

345 
DRIVER_ERROR
 
	gJob
::
	$S’dRa¡”s
(
BYTE
* 
ImageD©a
)

351 #ifdeà
APDK_CAPTURE


352 
	`C­tu»_S’dRa¡”s
(
NULL
, 
ImageD©a
);

355  
	`£nd¿¡”s
(
NULL
, 
ImageD©a
);

356 
	}
}

365 
DRIVER_ERROR
 
	gJob
::
	$S’dRa¡”s
(
BYTE
* 
BÏckImageD©a
, BYTE* 
CŞÜImageD©a
)

371 #ifdeà
APDK_CAPTURE


372 
	`C­tu»_S’dRa¡”s
(
BÏckImageD©a
, 
CŞÜImageD©a
);

374  
	`£nd¿¡”s
(
BÏckImageD©a
, 
CŞÜImageD©a
);

375 
	}
}

380 
DRIVER_ERROR
 
	gJob
::
	$SuµÜtS•¬©eBÏck
(
BOOL
* 
bS•¬©eBÏck
)

382 *
bS•¬©eBÏck
 = 
thePrš‹r
->
	`SuµÜtS•¬©eBÏck
(
Cu¼’tMode
);

383  
NO_ERROR
;

384 
	}
}

387 
DRIVER_ERROR
 
	gJob
::
	$£nd¿¡”s
(
BYTE
* 
BÏckImageD©a
, BYTE* 
CŞÜImageD©a
)

389 
DRIVER_ERROR
 
”r
 = 
NO_ERROR
;

391 ià(
theP–še
 =ğ
NULL
)

393  
SYSTEM_ERROR
;

398 ià(
BÏckImageD©a
 =ğ
NULL
 && 
CŞÜImageD©a
 == NULL)

400 ià(
thePrš‹r
->
	`G‘D©aFÜm©
(è=ğ
RASTER_STRIP
)

402 
skcouÁ
=0;

403 
CŞÜImageD©a
=
BÏnkRa¡”
;

407 
skcouÁ
++;

408 ià(
skcouÁ
 >= 200)

410 
skcouÁ
=0;

411 
CŞÜImageD©a
=
BÏnkRa¡”
;

415 
fcouÁ
 +ğ
SÿËFaùÜ
;

418 
”r
 = 
theP–še
->
	`Flush
();

419 
ERRCHECK
;

424 
skcouÁ
=0;

425 
D©aS’t
=
TRUE
;

428 
RowsIÅut
++;

430 ià(
BÏckImageD©a
 || 
CŞÜImageD©a
)

432 ià(
fcouÁ
 > 1000)

434 
CAPy
 +ğ
fcouÁ
/1000;

436 
”r
 = 
thePrš‹r
->
	`SkRa¡”s
 ((
fcouÁ
 / 1000));

437 
ERRCHECK
;

438 
fcouÁ
 =fcount % 1000;

441 ià(
BÏckImageD©a
 && 
Cu¼’tMode
->
dyeCouÁ
 != 3 && CurrentMode->dyeCount != 6)

443 
”r
 = 
	`£tbÏck¿¡”
();

444 
ERRCHECK
;

446 
i
 = 0; i < 
thePrštCÚ‹xt
->
IÅutWidth
 / 8; i++)

448 
b™æag
 = 0x80;

449 
j
 = 0; j < 8; j++)

451 ià(
BÏckImageD©a
[
i
] & 
b™æag
)

452 
BÏckRa¡”
[
i
*8+
j
] = 1;

453 
b™æag
 = bitflag >> 1;

456 ià(
thePrštCÚ‹xt
->
IÅutWidth
 % 8 > 0)

458 
i
 = 
thePrštCÚ‹xt
->
IÅutWidth
 / 8;

459 
b™æag
 = 0x80;

460 
j
 = 0; j < 
thePrštCÚ‹xt
->
IÅutWidth
 % 8; j++)

462 ià(
BÏckImageD©a
[
i
] & 
b™æag
)

463 
BÏckRa¡”
[
i
*8+
j
] = 1;

464 
b™æag
 = bitflag >> 1;

467 
theP–še
->
Exec
->
¿¡”
.
¿¡”size
[
COLORTYPE_BLACK
] = 
thePrštCÚ‹xt
->
IÅutWidth
;

468 
theP–še
->
Exec
->
¿¡”
.
¿¡”d©a
[
COLORTYPE_BLACK
] = 
BÏckRa¡”
;

472 
theP–še
->
Exec
->
¿¡”
.
¿¡”size
[
COLORTYPE_BLACK
] = 0;

473 
theP–še
->
Exec
->
¿¡”
.
¿¡”d©a
[
COLORTYPE_BLACK
] = 
NULL
;

475 ià(
CŞÜImageD©a
)

477 
theP–še
->
Exec
->
¿¡”
.
¿¡”size
[
COLORTYPE_COLOR
] = 
thePrštCÚ‹xt
->
IÅutWidth
*3;

478 
theP–še
->
Exec
->
¿¡”
.
¿¡”d©a
[
COLORTYPE_COLOR
] = 
CŞÜImageD©a
;

482 
theP–še
->
Exec
->
¿¡”
.
¿¡”size
[
COLORTYPE_COLOR
] = 0;

483 
theP–še
->
Exec
->
¿¡”
.
¿¡”d©a
[
COLORTYPE_COLOR
] = 
NULL
;

485 
”r
 = 
theP–še
->
	`Execu‹
(&ÑheP–še->
Exec
->
¿¡”
));

488  
”r
;

489 
	}
}

492 
DRIVER_ERROR
 
	gJob
::
	$Ãw·ge
()

495 
DRIVER_ERROR
 
”r
;

497 ià(
thePrš‹r
->
	`G‘D©aFÜm©
(è=ğ
RASTER_STRIP
)

499 
pH—d
->
	`S‘La¡Bªd
(
TRUE
);

502 
	`£nd¿¡”s
();

504 ià((
thePrštCÚ‹xt
->
	`G‘MedŸSourû
 ()è=ğ
sourûBªÃr
)

506 
CAPy
 = 0;

510 
”r
 = 
pH—d
->
	`FÜmF“d
();

511 
ERRCHECK
;

514 ià(
thePrš‹r
->
	`U£GUIMode
(
thePrštCÚ‹xt
->
Cu¼’tMode
) &&

515 ((è(
thePrštCÚ‹xt
->
	`PršbËS¹Y
 () * 100)) != 0)

519 
CAPy
 = 
thePrštCÚ‹xt
->
	`GUITİM¬gš
();

523 
CAPy
 = 0;

527 
skcouÁ
 = 
RowsIÅut
 = 0;

528 
fcouÁ
 = 0;

531 
D©aS’t
 = 
FALSE
;

533 ià(!
thePrštCÚ‹xt
->
	`ModeAg»esW™hH¬dw¬e
(
TRUE
))

535  
WARN_MODE_MISMATCH
;

538 #ifdeà
APDK_USAGE_LOG


539 
theT¿n¦©Ü
->
	`PrštDÙCouÁ
(
UH—d”
);

540 
theT¿n¦©Ü
->
	`NextPage
();

541 
UTextCouÁ
=
UText
=0;

544  
NO_ERROR
;

545 
	}
}

557 
DRIVER_ERROR
 
	gJob
::
	$Flush
()

559 if(
thePrš‹r
)

561 
BYTE
 
‹mp
 = 0;

562 
thePrš‹r
->
EndJob
 = 
TRUE
;

563  
thePrš‹r
->
	`S’d
(&
‹mp
,0);

565  
NO_PRINTER_SELECTED
;

566 
	}
}

571 
DRIVER_ERROR
 
	gJob
::
	$NewPage
()

574 #ifdeà
APDK_CAPTURE


575 
	`C­tu»_NewPage
();

577  
	`Ãw·ge
();

578 
	}
}

581 
	gJob
::
	$S‘OuutWidth
()

585 
OuutWidth
 = 
thePrštCÚ‹xt
->OutputWidth;

586 
IÅutWidth
 = 
thePrštCÚ‹xt
->InputWidth;

588 ià(
Cu¼’tMode
->
Ba£ResX
 !ğCu¼’tMode->
Ba£ResY
)

590 
mixedçùÜ
 = 
Cu¼’tMode
->
Ba£ResX
 / Cu¼’tMode->
Ba£ResY
;

591 
widthçùÜ
 = 
OuutWidth
 / 
IÅutWidth
;

592 ià(
widthçùÜ
 >ğ
mixedçùÜ
)

594 
OuutWidth
 = OuutWidth / 
mixedçùÜ
;

597 
	}
}

600 
DRIVER_ERROR
 
	gJob
::
	$In™SÿËr
()

603 
num”©Ü
, 
d’omš©Ü
;

606 
	`S‘OuutWidth
();

608 ià((
OuutWidth
 % 
IÅutWidth
) == 0)

610 
num”©Ü
 = 
OuutWidth
 / 
IÅutWidth
;

611 
d’omš©Ü
 = 1;

615 
num”©Ü
 = 
OuutWidth
;

616 
d’omš©Ü
 = 
IÅutWidth
;

620 
‹mpçùÜ
 = ()
num”©Ü
 / ()
d’omš©Ü
;

621 
‹mpçùÜ
 *= 1000.0f;

622 
SÿËFaùÜ
 = (è(è
‹mpçùÜ
;

628 
BOOL
 
RSok
;

629 
BOOL
 
¥“dy
=
FALSE
;

630 #ifdeà
APDK_OPTIMIZE_FOR_SPEED


631 
¥“dy
 = 
TRUE
;

633 ià(
¥“dy
)

635 
RSok
 = 
FALSE
;

639 ià(
thePrštCÚ‹xt
->
	`EfãùiveResŞutiÚX
()>300)

642 
RSok
 = 
SÿËFaùÜ
 >= 4000;

646 
RSok
 = 
SÿËFaùÜ
 >= 2333;

651 
R•lFÜm©
;

652 ià(
Cu¼’tMode
->
CÚfig
.
bCŞÜImage
)

654 
R•lFÜm©
 = 
Cu¼’tMode
->
dyeCouÁ
;

658 
R•lFÜm©
 = 3;

661 
BOOL
 
v
 = !
Cu¼’tMode
->
CÚfig
.
bCŞÜImage
;

663 ià((!
	`Prİr›rySÿlšg
()è|| !
RSok
 )

666 
pResSyÁh
=
NULL
;

667 
pR•liÿtÜ
 = 
Ãw
 
	`SÿËr_O³n
(
pSS
,
IÅutWidth
,
num”©Ü
,
d’omš©Ü
,
v
,
R•lFÜm©
);

668 
	`NEWCHECK
(
pR•liÿtÜ
);

669  
pR•liÿtÜ
->
cÚ¡ruùÜ_”rÜ
;

676 
pResSyÁh
 = 
	`C»©e_SÿËr
(
pSS
,
IÅutWidth
,2,1,

677 
TRUE
,

679 
	`NEWCHECK
(
pResSyÁh
);

680 
pResSyÁh
->
my¶ªe
 = 
COLORTYPE_COLOR
;

681 ià(
pResSyÁh
->
cÚ¡ruùÜ_”rÜ
 !ğ
NO_ERROR
)

683  
pResSyÁh
->
cÚ¡ruùÜ_”rÜ
;

686 
pBÏckPÏÃR•liÿtÜ
 = 
Ãw
 
	`SÿËr_O³n
(
pSS
,
IÅutWidth
,2,1,
FALSE
,1);

687 
	`NEWCHECK
(
pBÏckPÏÃR•liÿtÜ
);

688 
pBÏckPÏÃR•liÿtÜ
->
my¶ªe
 = 
COLORTYPE_BLACK
;

689 ià(
pBÏckPÏÃR•liÿtÜ
->
cÚ¡ruùÜ_”rÜ
 !ğ
NO_ERROR
)

691  
pBÏckPÏÃR•liÿtÜ
->
cÚ¡ruùÜ_”rÜ
;

695 
pR•liÿtÜ
 = 
Ãw
 
	`SÿËr_O³n
(
pSS
,2*
IÅutWidth
,
num”©Ü
,2*
d’omš©Ü
,
v
,
R•lFÜm©
);

696 
	`NEWCHECK
(
pR•liÿtÜ
);

697  
pR•liÿtÜ
->
cÚ¡ruùÜ_”rÜ
;

699 
	}
}

702 
DRIVER_ERROR
 
	gJob
::
	$CÚfigu»
()

705 
DRIVER_ERROR
 
”r
;

706 
P–še
* 
p
=
NULL
;

707 
width
;

708 
BOOL
 
u£RS
=
FALSE
;

710 
”r
 = 
	`In™SÿËr
();

711 
ERRCHECK
;

713 ià((
Cu¼’tMode
->
CÚfig
.
bResSyÁh
è&& 
	`Prİr›rySÿlšg
()

714 && 
pResSyÁh
)

716 
p
 = 
Ãw
 
	`P–še
(
pBÏckPÏÃR•liÿtÜ
);

717 
	`NEWCHECK
(
p
);

718 ià(
theP–še
)

719 
theP–še
->
	`AddPha£
(
p
);

720 
theP–še
=
p
;

722 
p
 = 
Ãw
 
	`P–še
(
pResSyÁh
);

723 
	`NEWCHECK
(
p
);

724 ià(
theP–še
)

725 
theP–še
->
	`AddPha£
(
p
);

726 
theP–še
=
p
;

727 
u£RS
=
TRUE
;

730 #ià(
	`defšed
(
APDK_DJ9xxVIP
è|| defšed(
APDK_LJJETREADY
)è&& defšed(
APDK_VIP_COLORFILTERING
)

731 ià(
Cu¼’tMode
->
CÚfig
.
bEº›
)

734 ià(
p
)

736 
width
 = 
p
->
	`G‘MaxOuutWidth
(
COLORTYPE_COLOR
) / 3;

740 
width
 = 
thePrštCÚ‹xt
->
IÅutWidth
;

747 
sÿË
 = ()
thePrštCÚ‹xt
->
OuutWidth
 / (éhePrštCÚ‹xt->
IÅutWidth
;

748 
Üigš®_»s
 = (()
thePrštCÚ‹xt
->
	`EfãùiveResŞutiÚX
()è/ 
sÿË
;

749 ià(
u£RS
 && (
sÿË
 >= 2.0f))

752 
Üigš®_»s
 *= 2.0f;

754 
áh»shŞd
 = 
Üigš®_»s
 * 0.0876f;

755 
th»shŞd
 = ()
áh»shŞd
 - 2;

757 
pEº›
 = 
Ãw
 
	`TEº›F‹r
(
width
, 
eBGRPix–D©a
, 
th»shŞd
);

758 
p
 = 
Ãw
 
	`P–še
(
pEº›
);

759 
	`NEWCHECK
(
p
);

760 ià(
theP–še
)

762 
theP–še
->
	`AddPha£
(
p
);

766 
theP–še
 = 
p
;

771 ià(
Cu¼’tMode
->
CÚfig
.
bCŞÜImage
)

773 
”r
 = 
	`S‘upCŞÜM©chšg
();

774 
ERRCHECK
;

775 
p
 = 
Ãw
 
	`P–še
(
pCŞÜM©ch”
);

776 
	`NEWCHECK
(
p
);

777 ià(
theP–še
)

779 
theP–še
->
	`AddPha£
(
p
);

783 
theP–še
 = 
p
;

787 ià(
Cu¼’tMode
->
CÚfig
.
bPix–R•liÿ‹
)

790 
p
 = 
Ãw
 
	`P–še
(
pR•liÿtÜ
);

791 
	`NEWCHECK
(
p
);

792 ià(
theP–še
)

794 
theP–še
->
	`AddPha£
(
p
);

798 
theP–še
 = 
p
;

802 ià(
Cu¼’tMode
->
CÚfig
.
bCŞÜImage
)

804 
”r
 = 
	`S‘upH®áÚšg
(
Cu¼’tMode
->
CÚfig
.
eHT
);

805 
ERRCHECK
;

806 
p
 = 
Ãw
 
	`P–še
(
pH®áÚ”
);

807 
	`NEWCHECK
(
p
);

808 ià(
theP–še
)

810 
theP–še
->
	`AddPha£
(
p
);

814 
theP–še
 = 
p
;

818 ià(
Cu¼’tMode
->
CÚfig
.
bCom´ess
)

820 ià(
p
)

822 
width
 = 
p
->
	`G‘MaxOuutWidth
(
COLORTYPE_COLOR
);

826 
width
 = 
thePrštCÚ‹xt
->
IÅutWidth
;

828 
S“dBufãrSize
;

829 ià(
pH®áÚ”
)

832 
S“dBufãrSize
 = 
MAXCOLORPLANES
 * 
MAXCOLORDEPTH
 * 
MAXCOLORROWS
 * 
width
;

836 
S“dBufãrSize
 = 
width
;

839 
theCom´essÜ
 = 
thePrš‹r
->
	`C»©eCom´essÜ
(
S“dBufãrSize
);

840 
	`NEWCHECK
(
theCom´essÜ
);

841 
”r
 = 
theCom´essÜ
->
cÚ¡ruùÜ_”rÜ
;

842 
ERRCHECK
;

843 
theCom´essÜ
->
my¶ªe
 = 
COLORTYPE_COLOR
;

845 
p
 = 
Ãw
 
	`P–še
(
theCom´essÜ
);

846 
	`NEWCHECK
(
p
);

847 ià(
theP–še
)

849 
theP–še
->
	`AddPha£
(
p
);

853 
theP–še
 = 
p
;

855 ià(
thePrš‹r
->
	`VIPPrš‹r
())

857 
width
 = (width/3+7)/8;

858 ià(
width
 > 0)

861 
S“dBufãrSize
;

862 
S“dBufãrSize
 = 
width
;

863 
pBÏckPÏÃCom´essÜ
 = 
thePrš‹r
->
	`C»©eBÏckPÏÃCom´essÜ
(
S“dBufãrSize
, 
TRUE
);

864 
	`NEWCHECK
(
pBÏckPÏÃCom´essÜ
);

865 
”r
 = 
pBÏckPÏÃCom´essÜ
->
cÚ¡ruùÜ_”rÜ
;

866 
ERRCHECK
;

867 
pBÏckPÏÃCom´essÜ
->
my¶ªe
 = 
COLORTYPE_BLACK
;

869 
p
 = 
Ãw
 
	`P–še
(
pBÏckPÏÃCom´essÜ
);

870 
	`NEWCHECK
(
p
);

871 ià(
theP–še
)

873 
theP–še
->
	`AddPha£
(
p
);

877 
theP–še
 = 
p
;

886 
pS’d”
 = 
Ãw
 
	`Ra¡”S’d”
(
thePrš‹r
,
thePrštCÚ‹xt
,
this
,
pH®áÚ”
);

887 
	`NEWCHECK
(
pS’d”
);

888 
”r
 = 
pS’d”
->
cÚ¡ruùÜ_”rÜ
;

889 
ERRCHECK
;

891 
p
 = 
Ãw
 
	`P–še
(
pS’d”
);

893 ià(
theP–še
)

895 
theP–še
->
	`AddPha£
(
p
);

899 
theP–še
 = 
p
;

902  
NO_ERROR
;

903 
	}
}

906 
DRIVER_ERROR
 
	gJob
::
	$£tbÏnk¿¡”
()

908 ià(
BÏnkRa¡”
)

910 
pSS
->
	`F»eMemÜy
(
BÏnkRa¡”
);

913 
size_t
 
BÏnkRa¡”Size
 = 
thePrštCÚ‹xt
->
OuutWidth
 * 3;

914 
BÏnkRa¡”
 = (
BYTE
*)
pSS
->
	`AÎocMem
 (
BÏnkRa¡”Size
);

915 
	`NEWCHECK
(
BÏnkRa¡”
);

917 
	`mem£t
 (
BÏnkRa¡”
, 0xFF, 
BÏnkRa¡”Size
);

919  
NO_ERROR
;

920 
	}
}

922 
DRIVER_ERROR
 
	gJob
::
	$£tbÏck¿¡”
()

924 
size_t
 
BÏckRa¡”Size
 = 
thePrštCÚ‹xt
->
IÅutWidth
;

925 ià(!
BÏckRa¡”
)

927 
BÏckRa¡”
 = (
BYTE
*)
pSS
->
	`AÎocMem
 (
BÏckRa¡”Size
);

928 
	`NEWCHECK
(
BÏckRa¡”
);

930 
	`mem£t
 (
BÏckRa¡”
, 0, 
BÏckRa¡”Size
);

932  
NO_ERROR
;

933 
	}
}

937 #ià
defšed
(
APDK_FONTS_NEEDED
)

943 
DRIVER_ERROR
 
	gJob
::
TextOut


945 cÚ¡ * 
pTextSŒšg
,

946 
	giL’SŒšg
,

947 cÚ¡ 
	gFÚt
& 
	gfÚt
,

948 
	giAbsX
,

949 
	giAbsY


954 #ifdeà
APDK_CAPTURE


955 
C­tu»_TextOut
(
pTextSŒšg
, 
iL’SŒšg
, 
fÚt
, 
iAbsX
, 
iAbsY
);

962 
	gxçùÜ
 = (()
Cu¼’tMode
->
Ba£ResX
è/ (()Cu¼’tMode->
TextRes
);

963 
	gyçùÜ
 = (()
Cu¼’tMode
->
Ba£ResY
è/ (()Cu¼’tMode->
TextRes
);

965 
	gx
 = ()
iAbsX
 / 
xçùÜ
;

966 
	gy
 = ()
iAbsY
 / 
yçùÜ
;

968 
	giAbsX
 = ()()
x
;

969 
	giAbsY
 = ()()
y
;

971 
DRIVER_ERROR
 
	g”r
 = 
theTextMªag”
->
TextOut
(
pTextSŒšg
,
iL’SŒšg
,
fÚt
,
iAbsX
,
iAbsY
);

972 
	gERRCHECK
;

974 
	gD©aS’t
=
TRUE
;

976 #ifdeà
APDK_USAGE_LOG


977 ià(
	giL’SŒšg
 > 
	gUTextSize
)

979 
	giL’SŒšg
 = 
UTextSize
-1;

980 
	gUH—d”
[
iL’SŒšg
] = '\0';

982 ià(
	gUTextCouÁ
<2)

984 
¡rıy
(
UH—d”
,
pTextSŒšg
);

985 
	gUText
 +ğ
iL’SŒšg
;

987 ià(
	gUTextCouÁ
==1)

989 
UH—d”
[
UText
] = '\0';

991 
	gUTextCouÁ
++;

995  
	g”r
;

1003 
	gP–še
::
P–še


1005 
ProûssÜ
* 
E


1007 
Ãxt
(
NULL
),

1008 
	$´ev
(
NULL
)

1010 
Exec
 = 
E
;

1011 
Exec
->
mypha£
 = 
this
;

1012 
	}
}

1015 
	gP–še
::
	$AddPha£
(
P–še
* 
Ãwp
)

1017 
P–še
* 
p
 = 
this
;

1018 
p
->
Ãxt
)

1020 
p
 =…->
Ãxt
;

1022 
p
->
Ãxt
 = 
Ãwp
;

1023 
Ãwp
->
´ev
 = 
p
;

1024 
	}
}

1027 
	gP–še
::~
	$P–še
()

1029 ià(
Ãxt
)

1031 
d–‘e
 
Ãxt
;

1033 
	}
}

1036 
BOOL
 
	gP–še
::
	$Proûss
(
RASTERDATA
* 
¿¡”
)

1038  
Exec
->
	`Proûss
(
¿¡”
);

1039 
	}
}

1042 
DRIVER_ERROR
 
	gP–še
::
	$Execu‹
(
RASTERDATA
* 
IÅutRa¡”
)

1044 
”r
=
NO_ERROR
;

1046 ià(
	`Proûss
(
IÅutRa¡”
)

1047 && (
”r
==
NO_ERROR
))

1049 ià(
Ãxt
)

1051 
Ãxt
->
Exec
->
¿¡”
.
¿¡”d©a
[
COLORTYPE_BLACK
] = 
	`NextOuutRa¡”
(COLORTYPE_BLACK);

1052 
Ãxt
->
Exec
->
¿¡”
.
¿¡”d©a
[
COLORTYPE_COLOR
] = 
	`NextOuutRa¡”
(COLORTYPE_COLOR);

1053 
Ãxt
->
Exec
->
¿¡”
.
¿¡”d©a
[
COLORTYPE_COLOR
] ||

1054 
Ãxt
->
Exec
->
¿¡”
.
¿¡”d©a
[
COLORTYPE_BLACK
])

1056 
Ãxt
->
Exec
->
¿¡”
.
¿¡”size
[
COLORTYPE_COLOR
] = 
	`G‘OuutWidth
(COLORTYPE_COLOR);

1057 
Ãxt
->
Exec
->
¿¡”
.
¿¡”size
[
COLORTYPE_BLACK
] = 
	`G‘OuutWidth
(COLORTYPE_BLACK);

1058 
”r
 = 
Ãxt
->
	`Execu‹
(&Òext->
Exec
->
¿¡”
));

1059 
ERRCHECK
;

1060 
Ãxt
->
Exec
->
¿¡”
.
¿¡”d©a
[
COLORTYPE_BLACK
] = 
	`NextOuutRa¡”
(COLORTYPE_BLACK);

1061 
Ãxt
->
Exec
->
¿¡”
.
¿¡”d©a
[
COLORTYPE_COLOR
] = 
	`NextOuutRa¡”
(COLORTYPE_COLOR);

1065  
”r
;

1066 
	}
}

1069 
DRIVER_ERROR
 
	gP–še
::
	$Flush
()

1071 
”r
=
NO_ERROR
;

1073 
Exec
->
	`Flush
();

1075 ià(
Ãxt
 && (
”r
 =ğ
NO_ERROR
))

1077 
Ãxt
->
Exec
->
¿¡”
.
¿¡”d©a
[
COLORTYPE_BLACK
] = 
	`NextOuutRa¡”
(COLORTYPE_BLACK);

1078 
Ãxt
->
Exec
->
¿¡”
.
¿¡”d©a
[
COLORTYPE_COLOR
] = 
	`NextOuutRa¡”
(COLORTYPE_COLOR);

1079 
Ãxt
->
Exec
->
¿¡”
.
¿¡”d©a
[
COLORTYPE_COLOR
] ||‚ext->Exec->¿¡”.¿¡”d©a[
COLORTYPE_BLACK
])

1081 
Ãxt
->
Exec
->
¿¡”
.
¿¡”size
[
COLORTYPE_BLACK
] = 
	`G‘OuutWidth
(COLORTYPE_BLACK);

1082 
Ãxt
->
Exec
->
¿¡”
.
¿¡”size
[
COLORTYPE_COLOR
] = 
	`G‘OuutWidth
(COLORTYPE_COLOR);

1083 
”r
 = 
Ãxt
->
	`Execu‹
(&Òext->
Exec
->
¿¡”
));

1084 
Ãxt
->
Exec
->
¿¡”
.
¿¡”d©a
[
COLORTYPE_BLACK
] = 
	`NextOuutRa¡”
(COLORTYPE_BLACK);

1085 
Ãxt
->
Exec
->
¿¡”
.
¿¡”d©a
[
COLORTYPE_COLOR
] = 
	`NextOuutRa¡”
(COLORTYPE_COLOR);

1086 
ERRCHECK
;

1089 
”r
 = 
Ãxt
->
	`Flush
();

1092  
”r
;

1093 
	}
}

1096 
	gProûssÜ
::
	$ProûssÜ
() :

1097 
	`iRa¡”sR—dy
(0),

1098 
	`iRa¡”sD–iv”ed
(0),

1099 
	`mypha£
(
NULL
),

1100 
	$my¶ªe
(
COLORTYPE_BOTH
)

1102 
i
 = 
COLORTYPE_COLOR
; i < 
MAX_COLORTYPE
; i++)

1104 
¿¡”
.
¿¡”d©a
[
i
] = 
NULL
;

1105 
¿¡”
.
¿¡”size
[
i
] = 0;

1107 
	}
}

1110 
	gProûssÜ
::~
	$ProûssÜ
()

1112 
	}
}

1114 
APDK_END_NAMESPACE


	@prnt/hpijs/job.h

32 #iâdeà
APDK_JOB_H


33 
	#APDK_JOB_H


	)

35 
	gAPDK_BEGIN_NAMESPACE


37 #ià
defšed
(
APDK_VIP_COLORFILTERING
)

38 
şass
 
	gTEº›F‹r
;

41 
şass
 
	gRa¡”S’d”
;

42 
şass
 
	gH—d”
;

43 
şass
 
	gTextT¿n¦©Ü
;

44 
şass
 
	gTextMªag”
;

45 
şass
 
	gH®áÚ”
;

46 
şass
 
	gCŞÜM©ch”
;

47 
şass
 
	gSÿËr
;

59 şas 
	cJob


61 
ä›nd
 
şass
 
	mRa¡”S’d”
;

63 
	mpublic
:

64 
Job
(
PrštCÚ‹xt
* 
pPC
);

66 
	mvœtu®
 ~
Job
();

68 
DRIVER_ERROR
 
	mcÚ¡ruùÜ_”rÜ
;

70 
DRIVER_ERROR
 
S’dRa¡”s
(
BYTE
* 
ImageD©a
=(BYTE*)
NULL
);

72 
DRIVER_ERROR
 
S’dRa¡”s
(
BYTE
* 
BÏckImageD©a
, BYTE* 
CŞÜImageD©a
);

74 
DRIVER_ERROR
 
SuµÜtS•¬©eBÏck
(
BOOL
* 
bS•¬©eBÏck
);

76 #ià
	$defšed
(
APDK_FONTS_NEEDED
)

77 
DRIVER_ERROR
 
	`TextOut
(cÚ¡ * 
pTextSŒšg
, 
iL’SŒšg
,

78 cÚ¡ 
FÚt
& 
fÚt
, 
iAbsX
, 
iAbsY
 );

82 
DRIVER_ERROR
 
	`Flush
();

83 
DRIVER_ERROR
 
	`NewPage
();

85 
´iv©e
:

87 
PrštCÚ‹xt
* 
thePrštCÚ‹xt
;

88 
Sy¡emS”viûs
* 
pSS
;

89 
Prš‹r
* 
thePrš‹r
;

90 
P–še
* 
theP–še
;

91 
TextT¿n¦©Ü
* 
pText
;

92 
Ra¡”S’d”
* 
pS’d”
;

93 
H®áÚ”
* 
pH®áÚ”
;

94 
CŞÜM©ch”
* 
pCŞÜM©ch”
;

95 
SÿËr
* 
pResSyÁh
;

96 
SÿËr
* 
pBÏckPÏÃR•liÿtÜ
;

97 
SÿËr
* 
pR•liÿtÜ
;

98 
Com´essÜ
* 
theCom´essÜ
;

99 
Com´essÜ
* 
pBÏckPÏÃCom´essÜ
;

100 
H—d”
* 
pH—d
;

101 #ià
	$defšed
(
APDK_VIP_COLORFILTERING
)

102 
TEº›F‹r
* 
pEº›
;

105 #ià
	$defšed
(
APDK_FONTS_NEEDED
)

106 
TextMªag”
* 
theTextMªag”
;

109 
PrštMode
* 
Cu¼’tMode
;

111 
fcouÁ
;

112 
skcouÁ
;

113 
RowsIÅut
;

114 
BYTE
* 
BÏnkRa¡”
;

115 
BYTE
* 
BÏckRa¡”
;

117 
CAPy
;

119 
BOOL
 
D©aS’t
;

121 
ResBoo¡
;

122 
numrows
[
MAXCOLORPLANES
];

123 
OuutWidth
;

124 
IÅutWidth
;

125 
SÿËFaùÜ
;

127 
DRIVER_ERROR
 
	`CÚfigu»
();

128 
DRIVER_ERROR
 
	`In™SÿËr
();

130 
DRIVER_ERROR
 
	`Ãw·ge
();

131 
DRIVER_ERROR
 
	`S‘upH®áÚšg
(
HALFTONING_ALGORITHM
 
eHT
);

132 
DRIVER_ERROR
 
	`S‘upCŞÜM©chšg
();

133 
DRIVER_ERROR
 
	`S’dCAPy
();

134 
DRIVER_ERROR
 
	`£nd¿¡”s
(
BYTE
* 
BÏckImageD©a
=(BYTE*)
NULL
, BYTE* 
CŞÜImageD©a
=(BYTE*)NULL);

135 
DRIVER_ERROR
 
	`£tbÏnk¿¡”
();

136 
DRIVER_ERROR
 
	`£tbÏck¿¡”
();

137 
	`S‘OuutWidth
();

139 #ifdeà
APDK_CAPTURE


140 
	`C­tu»_Job
(
PrštCÚ‹xt
* 
pPC
);

141 
	`C­tu»_dJob
();

142 
	`C­tu»_S’dRa¡”s
(
BYTE
* 
BÏckImageD©a
, BYTE* 
CŞÜImageD©a
);

143 #ià
	$defšed
(
APDK_FONTS_NEEDED
)

144 
	`C­tu»_TextOut
(cÚ¡ * 
pTextSŒšg
, 
iL’SŒšg
,

145 cÚ¡ 
FÚt
& 
fÚt
, 
iAbsX
, 
iAbsY
 );

147 
	`C­tu»_NewPage
();

150 #ifdeà
APDK_USAGE_LOG


151 
UTextCouÁ
;

152 
UText
;

153 
	#UTextSize
 100

	)

154 
UH—d”
[
UTextSize
*2];

159 
APDK_END_NAMESPACE


	@prnt/hpijs/jpegint.h

14 #iâdeà
JMETHOD


15 
	#JMETHOD
(
ty³
,
m‘hodÇme
,
¬gli¡
è
	`ty³
 (*m‘hodÇmeè()

	)

21 
	mJBUF_PASS_THRU
,

23 
	mJBUF_SAVE_SOURCE
,

24 
	mJBUF_CRANK_DEST
,

25 
	mJBUF_SAVE_AND_PASS


26 } 
	tJ_BUF_MODE
;

29 
	#CSTATE_START
 100

	)

30 
	#CSTATE_SCANNING
 101

	)

31 
	#CSTATE_RAW_OK
 102

	)

32 
	#CSTATE_WRCOEFS
 103

	)

33 
	#DSTATE_START
 200

	)

34 
	#DSTATE_INHEADER
 201

	)

35 
	#DSTATE_READY
 202

	)

36 
	#DSTATE_PRELOAD
 203

	)

37 
	#DSTATE_PRESCAN
 204

	)

38 
	#DSTATE_SCANNING
 205

	)

39 
	#DSTATE_RAW_OK
 206

	)

40 
	#DSTATE_BUFIMAGE
 207

	)

41 
	#DSTATE_BUFPOST
 208

	)

42 
	#DSTATE_RDCOEFS
 209

	)

43 
	#DSTATE_STOPPING
 210

	)

49 
	sj³g_comp_ma¡”
 {

50 
JMETHOD
(, 
´•¬e_fÜ_·ss
, (
j_com´ess_±r
 
cšfo
));

51 
JMETHOD
(, 
·ss_¡¬tup
, (
j_com´ess_±r
 
cšfo
));

52 
JMETHOD
(, 
fšish_·ss
, (
j_com´ess_±r
 
cšfo
));

55 
boŞ—n
 
	mÿÎ_·ss_¡¬tup
;

56 
boŞ—n
 
	mis_Ï¡_·ss
;

60 
	sj³g_c_maš_cÚŒŞËr
 {

61 
JMETHOD
(, 
¡¬t_·ss
, (
j_com´ess_±r
 
cšfo
, 
J_BUF_MODE
 
·ss_mode
));

62 
JMETHOD
(, 
´oûss_d©a
, (
j_com´ess_±r
 
cšfo
,

63 
JSAMPARRAY
 
šput_buf
, 
JDIMENSION
 *
š_row_ùr
,

64 
JDIMENSION
 
š_rows_ava
));

68 
	sj³g_c_´•_cÚŒŞËr
 {

69 
JMETHOD
(, 
¡¬t_·ss
, (
j_com´ess_±r
 
cšfo
, 
J_BUF_MODE
 
·ss_mode
));

70 
JMETHOD
(, 
´e_´oûss_d©a
, (
j_com´ess_±r
 
cšfo
,

71 
JSAMPARRAY
 
šput_buf
,

72 
JDIMENSION
 *
š_row_ùr
,

73 
JDIMENSION
 
š_rows_ava
,

74 
JSAMPIMAGE
 
ouut_buf
,

75 
JDIMENSION
 *
out_row_group_ùr
,

76 
JDIMENSION
 
out_row_groups_ava
));

80 
	sj³g_c_cÛf_cÚŒŞËr
 {

81 
JMETHOD
(, 
¡¬t_·ss
, (
j_com´ess_±r
 
cšfo
, 
J_BUF_MODE
 
·ss_mode
));

82 
JMETHOD
(
boŞ—n
, 
com´ess_d©a
, (
j_com´ess_±r
 
cšfo
,

83 
JSAMPIMAGE
 
šput_buf
));

87 
	sj³g_cŞÜ_cÚv”‹r
 {

88 
JMETHOD
(, 
¡¬t_·ss
, (
j_com´ess_±r
 
cšfo
));

89 
JMETHOD
(, 
cŞÜ_cÚv”t
, (
j_com´ess_±r
 
cšfo
,

90 
JSAMPARRAY
 
šput_buf
, 
JSAMPIMAGE
 
ouut_buf
,

91 
JDIMENSION
 
ouut_row
, 
num_rows
));

95 
	sj³g_down§m¶”
 {

96 
JMETHOD
(, 
¡¬t_·ss
, (
j_com´ess_±r
 
cšfo
));

97 
JMETHOD
(, 
down§m¶e
, (
j_com´ess_±r
 
cšfo
,

98 
JSAMPIMAGE
 
šput_buf
, 
JDIMENSION
 
š_row_šdex
,

99 
JSAMPIMAGE
 
ouut_buf
,

100 
JDIMENSION
 
out_row_group_šdex
));

102 
boŞ—n
 
	mÃed_cÚ‹xt_rows
;

106 
	sj³g_fÜw¬d_dù
 {

107 
JMETHOD
(, 
¡¬t_·ss
, (
j_com´ess_±r
 
cšfo
));

109 
JMETHOD
(, 
fÜw¬d_DCT
, (
j_com´ess_±r
 
cšfo
,

110 
j³g_compÚ’t_šfo
 * 
comµŒ
,

111 
JSAMPARRAY
 
§m¶e_d©a
, 
JBLOCKROW
 
cÛf_blocks
,

112 
JDIMENSION
 
¡¬t_row
, JDIMENSION 
¡¬t_cŞ
,

113 
JDIMENSION
 
num_blocks
));

117 
	sj³g_’Œİy_’cod”
 {

118 
JMETHOD
(, 
¡¬t_·ss
, (
j_com´ess_±r
 
cšfo
, 
boŞ—n
 
g©h”_¡©i¡ics
));

119 
JMETHOD
(
boŞ—n
, 
’code_mcu
, (
j_com´ess_±r
 
cšfo
, 
JBLOCKROW
 *
MCU_d©a
));

120 
JMETHOD
(, 
fšish_·ss
, (
j_com´ess_±r
 
cšfo
));

124 
	sj³g_m¬k”_wr™”
 {

125 
JMETHOD
(, 
wr™e_fe_h—d”
, (
j_com´ess_±r
 
cšfo
));

126 
JMETHOD
(, 
wr™e_äame_h—d”
, (
j_com´ess_±r
 
cšfo
));

127 
JMETHOD
(, 
wr™e_sÿn_h—d”
, (
j_com´ess_±r
 
cšfo
));

128 
JMETHOD
(, 
wr™e_fe_Œa”
, (
j_com´ess_±r
 
cšfo
));

129 
JMETHOD
(, 
wr™e_bËs_Úly
, (
j_com´ess_±r
 
cšfo
));

132 
JMETHOD
(, 
wr™e_m¬k”_h—d”
, (
j_com´ess_±r
 
cšfo
, 
m¬k”
,

133 
d©®’
));

134 
JMETHOD
(, 
wr™e_m¬k”_by‹
, (
j_com´ess_±r
 
cšfo
, 
v®
));

141 
	sj³g_decomp_ma¡”
 {

142 
JMETHOD
(, 
´•¬e_fÜ_ouut_·ss
, (
j_decom´ess_±r
 
cšfo
));

143 
JMETHOD
(, 
fšish_ouut_·ss
, (
j_decom´ess_±r
 
cšfo
));

146 
boŞ—n
 
	mis_dummy_·ss
;

150 
	sj³g_šput_cÚŒŞËr
 {

151 
JMETHOD
(, 
cÚsume_šput
, (
j_decom´ess_±r
 
cšfo
));

152 
JMETHOD
(, 
»£t_šput_cÚŒŞËr
, (
j_decom´ess_±r
 
cšfo
));

153 
JMETHOD
(, 
¡¬t_šput_·ss
, (
j_decom´ess_±r
 
cšfo
));

154 
JMETHOD
(, 
fšish_šput_·ss
, (
j_decom´ess_±r
 
cšfo
));

157 
boŞ—n
 
	mhas_muÉË_sÿns
;

158 
boŞ—n
 
	meoi_»ached
;

162 
	sj³g_d_maš_cÚŒŞËr
 {

163 
JMETHOD
(, 
¡¬t_·ss
, (
j_decom´ess_±r
 
cšfo
, 
J_BUF_MODE
 
·ss_mode
));

164 
JMETHOD
(, 
´oûss_d©a
, (
j_decom´ess_±r
 
cšfo
,

165 
JSAMPARRAY
 
ouut_buf
, 
JDIMENSION
 *
out_row_ùr
,

166 
JDIMENSION
 
out_rows_ava
));

170 
	sj³g_d_cÛf_cÚŒŞËr
 {

171 
JMETHOD
(, 
¡¬t_šput_·ss
, (
j_decom´ess_±r
 
cšfo
));

172 
JMETHOD
(, 
cÚsume_d©a
, (
j_decom´ess_±r
 
cšfo
));

173 
JMETHOD
(, 
¡¬t_ouut_·ss
, (
j_decom´ess_±r
 
cšfo
));

174 
JMETHOD
(, 
decom´ess_d©a
, (
j_decom´ess_±r
 
cšfo
,

175 
JSAMPIMAGE
 
ouut_buf
));

177 
jvœt_b¬¿y_±r
 *
	mcÛf_¬¿ys
;

181 
	sj³g_d_po¡_cÚŒŞËr
 {

182 
JMETHOD
(, 
¡¬t_·ss
, (
j_decom´ess_±r
 
cšfo
, 
J_BUF_MODE
 
·ss_mode
));

183 
JMETHOD
(, 
po¡_´oûss_d©a
, (
j_decom´ess_±r
 
cšfo
,

184 
JSAMPIMAGE
 
šput_buf
,

185 
JDIMENSION
 *
š_row_group_ùr
,

186 
JDIMENSION
 
š_row_groups_ava
,

187 
JSAMPARRAY
 
ouut_buf
,

188 
JDIMENSION
 *
out_row_ùr
,

189 
JDIMENSION
 
out_rows_ava
));

193 
	sj³g_m¬k”_»ad”
 {

194 
JMETHOD
(, 
»£t_m¬k”_»ad”
, (
j_decom´ess_±r
 
cšfo
));

199 
JMETHOD
(, 
»ad_m¬k”s
, (
j_decom´ess_±r
 
cšfo
));

201 
j³g_m¬k”_·r£r_m‘hod
 
	m»ad_»¡¬t_m¬k”
;

206 
boŞ—n
 
	m§w_SOI
;

207 
boŞ—n
 
	m§w_SOF
;

208 
	mÃxt_»¡¬t_num
;

209 
	mdisÿrded_by‹s
;

213 
	sj³g_’Œİy_decod”
 {

214 
JMETHOD
(, 
¡¬t_·ss
, (
j_decom´ess_±r
 
cšfo
));

215 
JMETHOD
(
boŞ—n
, 
decode_mcu
, (
j_decom´ess_±r
 
cšfo
,

216 
JBLOCKROW
 *
MCU_d©a
));

220 
boŞ—n
 
	mšsuffic›Á_d©a
;

224 
JMETHOD
(, 
	tšv”£_DCT_m‘hod_±r
,

225 (
	tj_decom´ess_±r
 
	tcšfo
, 
	tj³g_compÚ’t_šfo
 * 
	tcomµŒ
,

226 
	tJCOEFPTR
 
	tcÛf_block
,

227 
	tJSAMPARRAY
 
	touut_buf
, 
	tJDIMENSION
 
	touut_cŞ
));

229 
	sj³g_šv”£_dù
 {

230 
JMETHOD
(, 
¡¬t_·ss
, (
j_decom´ess_±r
 
cšfo
));

232 
šv”£_DCT_m‘hod_±r
 
	mšv”£_DCT
[
MAX_COMPONENTS
];

236 
	sj³g_up§m¶”
 {

237 
JMETHOD
(, 
¡¬t_·ss
, (
j_decom´ess_±r
 
cšfo
));

238 
JMETHOD
(, 
up§m¶e
, (
j_decom´ess_±r
 
cšfo
,

239 
JSAMPIMAGE
 
šput_buf
,

240 
JDIMENSION
 *
š_row_group_ùr
,

241 
JDIMENSION
 
š_row_groups_ava
,

242 
JSAMPARRAY
 
ouut_buf
,

243 
JDIMENSION
 *
out_row_ùr
,

244 
JDIMENSION
 
out_rows_ava
));

246 
boŞ—n
 
	mÃed_cÚ‹xt_rows
;

250 
	sj³g_cŞÜ_decÚv”‹r
 {

251 
JMETHOD
(, 
¡¬t_·ss
, (
j_decom´ess_±r
 
cšfo
));

252 
JMETHOD
(, 
cŞÜ_cÚv”t
, (
j_decom´ess_±r
 
cšfo
,

253 
JSAMPIMAGE
 
šput_buf
, 
JDIMENSION
 
šput_row
,

254 
JSAMPARRAY
 
ouut_buf
, 
num_rows
));

258 
	sj³g_cŞÜ_quªtiz”
 {

259 
JMETHOD
(, 
¡¬t_·ss
, (
j_decom´ess_±r
 
cšfo
, 
boŞ—n
 
is_´e_sÿn
));

260 
JMETHOD
(, 
cŞÜ_quªtize
, (
j_decom´ess_±r
 
cšfo
,

261 
JSAMPARRAY
 
šput_buf
, JSAMPARRAY 
ouut_buf
,

262 
num_rows
));

263 
JMETHOD
(, 
fšish_·ss
, (
j_decom´ess_±r
 
cšfo
));

264 
JMETHOD
(, 
Ãw_cŞÜ_m­
, (
j_decom´ess_±r
 
cšfo
));

270 #undeà
MAX


271 
	#MAX
(
a
,
b
è(×è> (bè? (aè: (b))

	)

272 #undeà
MIN


273 
	#MIN
(
a
,
b
è(×è< (bè? (aè: (b))

	)

286 #ifdeà
RIGHT_SHIFT_IS_UNSIGNED


287 
	#SHIFT_TEMPS
 
INT32
 
shiá_‹mp
;

	)

288 
	#RIGHT_SHIFT
(
x
,
shá
) \

289 ((
shiá_‹mp
 = (
x
)) < 0 ? \

290 (
shiá_‹mp
 >> (
shá
)è| ((~((
INT32
) 0)) << (32-(shft))) : \

291 (
shiá_‹mp
 >> (
shá
)))

	)

293 
	#SHIFT_TEMPS


	)

294 
	#RIGHT_SHIFT
(
x
,
shá
è((xè>> (shá))

	)

300 #ifdeà
NEED_SHORT_EXTERNAL_NAMES


301 
	#jš™_com´ess_ma¡”
 
jICom´ess


	)

302 
	#jš™_c_ma¡”_cÚŒŞ
 
jICMa¡”


	)

303 
	#jš™_c_maš_cÚŒŞËr
 
jICMašC


	)

304 
	#jš™_c_´•_cÚŒŞËr
 
jICP»pC


	)

305 
	#jš™_c_cÛf_cÚŒŞËr
 
jICCÛfC


	)

306 
	#jš™_cŞÜ_cÚv”‹r
 
jICCŞÜ


	)

307 
	#jš™_down§m¶”
 
jIDown§m¶”


	)

308 
	#jš™_fÜw¬d_dù
 
jIFDCT


	)

309 
	#jš™_huff_’cod”
 
jIHEncod”


	)

310 
	#jš™_phuff_’cod”
 
jIPHEncod”


	)

311 
	#jš™_m¬k”_wr™”
 
jIMWr™”


	)

312 
	#jš™_ma¡”_decom´ess
 
jIDMa¡”


	)

313 
	#jš™_d_maš_cÚŒŞËr
 
jIDMašC


	)

314 
	#jš™_d_cÛf_cÚŒŞËr
 
jIDCÛfC


	)

315 
	#jš™_d_po¡_cÚŒŞËr
 
jIDPo¡C


	)

316 
	#jš™_šput_cÚŒŞËr
 
jIInCr


	)

317 
	#jš™_m¬k”_»ad”
 
jIMR—d”


	)

318 
	#jš™_huff_decod”
 
jIHDecod”


	)

319 
	#jš™_phuff_decod”
 
jIPHDecod”


	)

320 
	#jš™_šv”£_dù
 
jIIDCT


	)

321 
	#jš™_up§m¶”
 
jIUp§m¶”


	)

322 
	#jš™_cŞÜ_decÚv”‹r
 
jIDCŞÜ


	)

323 
	#jš™_1·ss_quªtiz”
 
jI1Quªt


	)

324 
	#jš™_2·ss_quªtiz”
 
jI2Quªt


	)

325 
	#jš™_m”ged_up§m¶”
 
jIMUp§m¶”


	)

326 
	#jš™_memÜy_mgr
 
jIMemMgr


	)

327 
	#jdiv_round_up
 
jDivRound


	)

328 
	#jround_up
 
jRound


	)

329 
	#jcİy_§m¶e_rows
 
jCİySam¶es


	)

330 
	#jcİy_block_row
 
jCİyBlocks


	)

331 
	#jz”o_çr
 
jZ”oF¬


	)

332 
	#j³g_zigzag_Üd”
 
jZIGTabË


	)

333 
	#j³g_Çtu¿l_Üd”
 
jZAGTabË


	)

338 
	$EXTERN
(è
jš™_com´ess_ma¡”
 
	`JPP
((
j_com´ess_±r
 
cšfo
));

339 
	$EXTERN
(è
jš™_c_ma¡”_cÚŒŞ
 
	`JPP
((
j_com´ess_±r
 
cšfo
,

340 
boŞ—n
 
Œªscode_Úly
));

341 
	$EXTERN
(è
jš™_c_maš_cÚŒŞËr
 
	`JPP
((
j_com´ess_±r
 
cšfo
,

342 
boŞ—n
 
Ãed_fuÎ_bufãr
));

343 
	$EXTERN
(è
jš™_c_´•_cÚŒŞËr
 
	`JPP
((
j_com´ess_±r
 
cšfo
,

344 
boŞ—n
 
Ãed_fuÎ_bufãr
));

345 
	$EXTERN
(è
jš™_c_cÛf_cÚŒŞËr
 
	`JPP
((
j_com´ess_±r
 
cšfo
,

346 
boŞ—n
 
Ãed_fuÎ_bufãr
));

347 
	$EXTERN
(è
jš™_cŞÜ_cÚv”‹r
 
	`JPP
((
j_com´ess_±r
 
cšfo
));

348 
	$EXTERN
(è
jš™_down§m¶”
 
	`JPP
((
j_com´ess_±r
 
cšfo
));

349 
	$EXTERN
(è
jš™_fÜw¬d_dù
 
	`JPP
((
j_com´ess_±r
 
cšfo
));

350 
	$EXTERN
(è
jš™_huff_’cod”
 
	`JPP
((
j_com´ess_±r
 
cšfo
));

351 
	$EXTERN
(è
jš™_phuff_’cod”
 
	`JPP
((
j_com´ess_±r
 
cšfo
));

352 
	$EXTERN
(è
jš™_m¬k”_wr™”
 
	`JPP
((
j_com´ess_±r
 
cšfo
));

354 
	$EXTERN
(è
jš™_ma¡”_decom´ess
 
	`JPP
((
j_decom´ess_±r
 
cšfo
));

355 
	$EXTERN
(è
jš™_d_maš_cÚŒŞËr
 
	`JPP
((
j_decom´ess_±r
 
cšfo
,

356 
boŞ—n
 
Ãed_fuÎ_bufãr
));

357 
	$EXTERN
(è
jš™_d_cÛf_cÚŒŞËr
 
	`JPP
((
j_decom´ess_±r
 
cšfo
,

358 
boŞ—n
 
Ãed_fuÎ_bufãr
));

359 
	$EXTERN
(è
jš™_d_po¡_cÚŒŞËr
 
	`JPP
((
j_decom´ess_±r
 
cšfo
,

360 
boŞ—n
 
Ãed_fuÎ_bufãr
));

361 
	$EXTERN
(è
jš™_šput_cÚŒŞËr
 
	`JPP
((
j_decom´ess_±r
 
cšfo
));

362 
	$EXTERN
(è
jš™_m¬k”_»ad”
 
	`JPP
((
j_decom´ess_±r
 
cšfo
));

363 
	$EXTERN
(è
jš™_huff_decod”
 
	`JPP
((
j_decom´ess_±r
 
cšfo
));

364 
	$EXTERN
(è
jš™_phuff_decod”
 
	`JPP
((
j_decom´ess_±r
 
cšfo
));

365 
	$EXTERN
(è
jš™_šv”£_dù
 
	`JPP
((
j_decom´ess_±r
 
cšfo
));

366 
	$EXTERN
(è
jš™_up§m¶”
 
	`JPP
((
j_decom´ess_±r
 
cšfo
));

367 
	$EXTERN
(è
jš™_cŞÜ_decÚv”‹r
 
	`JPP
((
j_decom´ess_±r
 
cšfo
));

368 
	$EXTERN
(è
jš™_1·ss_quªtiz”
 
	`JPP
((
j_decom´ess_±r
 
cšfo
));

369 
	$EXTERN
(è
jš™_2·ss_quªtiz”
 
	`JPP
((
j_decom´ess_±r
 
cšfo
));

370 
	$EXTERN
(è
jš™_m”ged_up§m¶”
 
	`JPP
((
j_decom´ess_±r
 
cšfo
));

372 
	$EXTERN
(è
jš™_memÜy_mgr
 
	`JPP
((
j_commÚ_±r
 
cšfo
));

375 
	$EXTERN
(è
jdiv_round_up
 
	`JPP
((
a
, 
b
));

376 
	$EXTERN
(è
jround_up
 
	`JPP
((
a
, 
b
));

377 
	$EXTERN
(è
jcİy_§m¶e_rows
 
	`JPP
((
JSAMPARRAY
 
šput_¬¿y
, 
sourû_row
,

378 
JSAMPARRAY
 
ouut_¬¿y
, 
de¡_row
,

379 
num_rows
, 
JDIMENSION
 
num_cŞs
));

380 
	$EXTERN
(è
jcİy_block_row
 
	`JPP
((
JBLOCKROW
 
šput_row
, JBLOCKROW 
ouut_row
,

381 
JDIMENSION
 
num_blocks
));

382 
	$EXTERN
(è
jz”o_çr
 
	`JPP
((
FAR
 * 
rg‘
, 
size_t
 
by‹¡oz”o
));

385 cÚ¡ 
j³g_zigzag_Üd”
[];

387 cÚ¡ 
j³g_Çtu¿l_Üd”
[];

391 #ifdeà
INCOMPLETE_TYPES_BROKEN


392 #iâdeà
AM_MEMORY_MANAGER


393 
	sjvœt_§¼ay_cÚŒŞ
 { 
dummy
; };

394 
	sjvœt_b¬¿y_cÚŒŞ
 { 
dummy
; };

	@prnt/hpijs/ldlencap.h

30 #iâdeà
_LDLENCAP


31 
	#_LDLECNAP


	)

34 
	#PACKET_WAIT
 5

	)

35 
	#IO_WAIT
 5

	)

36 
	#CREDIT_WAIT
 5

	)

37 
	#ERROR_WAIT
 20

	)

42 
	#FRAME_BYTE
 0

	)

43 
	#COMMAND_LENGTH_BYTE
 1

	)

44 
	#PACKET_TYPE_BYTE
 4

	)

45 
	#COMMAND_NUMBER_BYTE
 5

	)

46 
	#REFERENCE_NUMBER_BYTE
 6

	)

47 
	#DATA_LENGTH_BYTE
 8

	)

48 
	#NUMBER_OF_COMMANDS_BYTE
 10

	)

49 
	#COMMAND_OPT_BYTE
 10

	)

50 
	#CREDIT_BYTE
 11

	)

53 
	#RESPONSE_COMMAND_EXECUTED
 16

	)

54 
	#RESPONSE_AUTO
 24

	)

55 
	#ABSOLUTE_CREDIT
 32

	)

56 
	#INCREMENTAL_CREDIT
 33

	)

59 
	#COMMAND_CANCEL
 0

	)

60 
	#COMMAND_QUERY
 5

	)

61 
	#COMMAND_CONTINUE
 12

	)

62 
	#COMMAND_PREPARE_TO_CANCEL
 12

	)

65 
	#AUTO_RESPONSE_STATUS
 1

	)

69 
	#MAX_PACKET_READ_SIZE
 256

	)

72 cÚ¡ 
BYTE
 
	gbyEÇbËPacšg
[] = { 0x24, 0x00, 0x10, 0x00, 0x02, 0x00, 0x00, 0x00, 0x00,

74 cÚ¡ 
BYTE
 
	gbyRe£tLIDIL
[] = { 0x24, 0x00, 0x10, 0x00, 0x06, 0x00, 0x00, 0x00, 0x00,

81 cÚ¡ 
BYTE
 
	gbySync
[] = { 0x24, 0x01, 0x00, 0x00, 0x07, 0x00, 0x00, 0x00, 0x08,

83 cÚ¡ 
BYTE
 
	gbySyncCom¶‘e
[] = { 0x24, 0x00, 0x10, 0x00, 0x08, 0x00, 0x00, 0x00, 0x00,

92 cÚ¡ 
BYTE
 
	gbyEOCStusQu”y
[] = { 0x24, 0x00, 0x10, 0x00, 0x00, 0x05, 0x00, 0x00, 0x00,

94 cÚ¡ 
BYTE
 
	gbyCÚtšue
[] = { 0x24, 0x00, 0x10, 0x00, 0x00, 0x0C, 0x00, 0x00, 0x00,

96 cÚ¡ 
BYTE
 
	gbyP»·»ToCªûl
[] = { 0x24, 0x00, 0x10, 0x00, 0x00, 0x0C, 0x00, 0x00, 0x00,

99 cÚ¡ 
	gCANCELSIZE
 = 16;

100 cÚ¡ 
	gSYNCSIZE
 = 2304;

101 cÚ¡ 
	gSYNC_CMD_OPT_SIZE
 = 245;

104 
	tUIÁ16
;

105 
	tUIÁ32
;

106 
	tUCh¬
;

107 
	tIÁ16
;

108 
	tIÁ32
;

111 
	meLDLS¹Job
 = 0,

112 
	meLDLEndJob
 = 0,

113 
	meLDLLßdPage
 = 1,

114 
	meLDLEjeùPage
 =2,

115 
	meLDLPrštSw“p
=3,

116 
	meLDLLßdSw“pD©a
=4,

117 
	meLDLQu”yPrš‹r
 = 5,

118 
	meLDLComm’ts
=7,

119 
	meLDLHªdËP’
 = 8,

120 
	meLDLCÚŒŞ
 = 12,

121 
	meLDLD©aSŒ—mV”siÚ
=12

122 }
	tLDLCMD
;

126 
	meLDLUnknownCŞÜ
=-1,

127 
	meLDLBÏck
,

128 
	meLDLCyª
,

129 
	meLDLMag’
,

130 
	meLDLY–low
,

131 
	meLDLLoCyª
,

132 
	meLDLLoMag’
,

133 
	meLDLLoBÏck
,

134 
	meLDLMaxCŞÜ


135 } 
	tCOLORENUM
;

138 
	#LDLPACKET_MINSIZE
 16

139 
	#FRAME_SYN
 '$'

140 
	#OPTIMIZED_DELAYLIMIT
 0

142 

	)

143 
	#LDL_MAX_IMAGE_SIZE
 2048

	)

146 
	#SIZEOF_LDLHDR
 10

	)

147 
	#SIZEOF_LDLTERM
 1

	)

148 
	#SIZEOF_LDL_JOB_CMDOPT
 5

	)

151 
	#OPERATION_STJOB
 0

	)

152 
	#OPERATION_ENDJOB
 1

	)

153 
	#OPERATION_CANCJOB
 2

	)

155 
	#SIZEOF_LDL_LDPAGE_CMDOPT
 17

	)

158 
	#MEDIATYPE_PLAIN
 0

159 
	#MEDIATYPE_PHOTO
 3

	)

161 
	#MEDIASRC_MAINTRAY
 0

162 

	)

163 
	#MEDIADEST_MAINBIN
 0

164 

	)

165 
	#QUALITYLEVEL_DRAFT
 -1

166 
	#QUALITYLEVEL_NORMAL
 0

	)

167 
	#QUALITYLEVEL_BEST
 1

	)

168 
	#QUALITYLEVEL_WONDER
 2

	)

170 
	#SPECLOAD_NONE
 0

171 
	#SPECLOAD_ENVELOPE
 1

	)

173 
	#MEDIALD_SPEED
 0x00000001

174 
	#NEED_TO_SERVICE_PERIOD
 0x00000002

	)

175 
	#MINTIME_BTW_SWEEP
 0x00000004

	)

177 
	#DEVUNITS_XBOW
 2400

178 

	)

179 
	#SIZEOF_LDL_LDPAGE_OPTFLDS
 4

	)

181 
	#SIZEOF_LDL_COLROPT_ACTIVECOLR
 2

	)

183 
	#NO_ACTIVE_COLORS
 0x0000

	)

185 
	#SIZEOF_LDL_EJPAGE_CMDOPT
 4

	)

187 
	#MEDIA_EJSPEED
 0x00000001

188 

	)

189 
	#SIZEOF_LDL_EJPAGE_OPTFLDS
 1

	)

191 
	#SIZEOF_LDL_PRTSWP_CMDOPT
 18

	)

193 
	#SWINGFMT_UNCOMPRSS
 0

194 

	)

195 
	#PRNDRN_LEFTTORIGHT
 0

196 
	#PRNDRN_RIGHTTOLEFT
 1

	)

198 
	#IPS_CARRSPEED
 0x00000001

199 
	#IPS_INIPRNSPEED
 0x00000002

	)

200 
	#IPS_MEDIASPEED
 0x00000004

	)

201 
	#PAPER_ACCURACY
 0x00000008

	)

202 
	#ACCURATEPOSN_NEEDED
 0x00000010

	)

203 
	#DRYTIME
 0x00000020

204 

	)

205 
	#SIZEOF_LDL_PRTSWP_OPTFLDS
 3

	)

207 
	#SIZEOF_LDL_PRTSWP_COLROPT
 29

	)

209 
	#SIZEOF_LDL_LDSWPDATA_CMDOPT
 2

	)

211 
	#NO_ECHO
 0

	)

212 
	#ECHO_DATA
 1

	)

214 
	#OPERATION_CONTINUE
 2

	)

215 
	#DATASTREAMVERSION
 3

	)

217 
	#OPERATION_SPIT_PEN
 2

	)

220 
	#CURR_LDLVERSION
 0x00000302

221 

	)

	@prnt/hpijs/ljcolor.cpp

32 #ifdeà
APDK_LJCOLOR


34 
	~"h—d”.h
"

35 
	~"io_defs.h
"

36 
	~"ljcŞÜ.h
"

37 
	~"´š‹½roxy.h
"

38 
	~"»sourûs.h
"

40 
APDK_BEGIN_NAMESPACE


42 
ušt32_t
 
ulM­DJ600_CCM_K
[ 9 * 9 * 9 ];

43 
ušt32_t
 
ulM­GRAY_K_6x6x1
[9 * 9 * 9];

45 
	gLJCŞÜ
::
	$LJCŞÜ
 (
Sy¡emS”viûs
* 
pSS
, 
numfÚts
, 
BOOL
 
´Ùo
)

46 : 
	$Prš‹r
(
pSS
, 
numfÚts
, 
´Ùo
)

49 ià((!
´Ùo
è&& (
IOMode
.
bDevID
))

51 
cÚ¡ruùÜ_”rÜ
 = 
	`V”ifyP’Info
();

52 
CERRCHECK
;

54 
eP’
 = 
BOTH_PENS
;

56 
pMode
[
GRAYMODE_INDEX
] = 
Ãw
 
	`LJCŞÜG¿yMode
 ();

57 
pMode
[
DEFAULTMODE_INDEX
] = 
Ãw
 
	`LJCŞÜ300DPIMode
 ();

58 
pMode
[
SPECIALMODE_INDEX
] = 
Ãw
 
	`LJCŞÜ600DPIMode
 ();

59 
pMode
[
SPECIALMODE_INDEX
+1] = 
Ãw
 
	`LJCŞÜ150DPIMode
 ();

60 
pMode
[
SPECIALMODE_INDEX
+2] = 
Ãw
 
	`LJCŞÜKD¿áMode
 ();

61 
ModeCouÁ
 = 5;

64 
CMYM­
 = 
NULL
;

65 
m_bJobS¹ed
 = 
FALSE
;

66 #ifdeà 
APDK_AUTODUPLEX


67 
m_bRÙ©eBackPage
 = 
FALSE
;

69 #ifdeà
APDK_EXTENDED_MEDIASIZE


70 
pMode
[
SPECIALMODE_INDEX
+3] = 
Ãw
 
	`LJCŞÜPÏšBe¡Mode
 ();

71 
ModeCouÁ
 = 6;

73 
m_pCom´essÜ
 = 
NULL
;

74 
m_iYPos
 = 0;

76 
	`DBG1
("LJColor created\n");

77 
	}
}

79 
	gLJCŞÜ
::~
	$LJCŞÜ
 ()

81 
DISPLAY_STATUS
 
eDi¥Stus
;

82 ià(
IOMode
.
bStus
 && 
m_bJobS¹ed
)

84 
i
 = 0; i < 5; i++)

86 
pSS
->
	`BusyWa™
 (2000);

87 
eDi¥Stus
 = 
	`P¬£E¼Ü
 (0);

88 ià(
eDi¥Stus
 =ğ
DISPLAY_PRINTING_COMPLETE
)

90 
pSS
->
	`Di¥ÏyPrš‹rStus
 (
eDi¥Stus
);

95 
	}
}

97 
	gLJCŞÜKD¿áMode
::
	$LJCŞÜKD¿áMode
 ()

98 : 
	$G¿yMode
 (
ulM­DJ600_CCM_K
)

100 
theQu®™y
 = 
qu®™yD¿á
;

101 
pmQu®™y
 = 
QUALITY_DRAFT
;

102 
pmCŞÜ
 = 
GREY_K
;

103 #ifdeà
APDK_AUTODUPLEX


104 
bDu¶exC­abË
 = 
TRUE
;

106 
	}
}

108 
	gLJCŞÜG¿yMode
::
	$LJCŞÜG¿yMode
 (è: 
	$G¿yMode
 (
ulM­GRAY_K_6x6x1
)

110 
ResŞutiÚX
[0] =

111 
ResŞutiÚY
[0] =

112 
Ba£ResX
 =

113 
Ba£ResY
 = 600;

114 
pmCŞÜ
 = 
GREY_K
;

115 #ifdeà
APDK_AUTODUPLEX


116 
bDu¶exC­abË
 = 
TRUE
;

118 
	}
}

120 
	gLJCŞÜ150DPIMode
::
	$LJCŞÜ150DPIMode
 ()

121 : 
	$PrštMode
 (
NULL
)

123 
ResŞutiÚX
[0] = 
ResŞutiÚY
[0] = 150;

124 
Ba£ResX
 = 
Ba£ResY
 = 150;

125 
TextRes
 = 150;

126 
CÚfig
.
bCŞÜImage
 = 
FALSE
;

127 
theQu®™y
 = 
qu®™yD¿á
;

128 
pmQu®™y
 = 
QUALITY_DRAFT
;

129 #ifdeà
APDK_AUTODUPLEX


130 
bDu¶exC­abË
 = 
TRUE
;

132 
	}
}

134 
	gLJCŞÜ300DPIMode
::
	$LJCŞÜ300DPIMode
 ()

135 : 
	$PrštMode
 (
NULL
)

137 
ResŞutiÚX
[0] = 300;

138 
ResŞutiÚY
[0] = 300;

139 
Ba£ResX
 = 
Ba£ResY
 = 300;

141 
CÚfig
.
bCŞÜImage
 = 
FALSE
;

142 
theQu®™y
 = 
qu®™yNÜm®
;

144 
bFÚtC­abË
 = 
TRUE
;

145 
pmQu®™y
 = 
QUALITY_NORMAL
;

146 
CÚfig
.
bCŞÜImage
 = 
FALSE
;

147 #ifdeà
APDK_AUTODUPLEX


148 
bDu¶exC­abË
 = 
TRUE
;

150 
	}
}

152 
	gLJCŞÜ600DPIMode
::
	$LJCŞÜ600DPIMode
 ()

153 : 
	$PrštMode
 (
NULL
)

155 
ResŞutiÚX
[0] = 600;

156 
ResŞutiÚY
[0] = 600;

157 
Ba£ResX
 = 
Ba£ResY
 = 600;

158 
CÚfig
.
bCŞÜImage
 = 
FALSE
;

159 
theQu®™y
 = 
qu®™yP»£Á©iÚ
;

160 
bFÚtC­abË
 = 
TRUE
;

161 
pmQu®™y
 = 
QUALITY_BEST
;

162 
pmMedŸTy³
 = 
MEDIA_PHOTO
;

163 #ifdeà
APDK_AUTODUPLEX


164 
bDu¶exC­abË
 = 
TRUE
;

166 
	}
}

168 #ifdeà 
APDK_EXTENDED_MEDIASIZE


169 
	gLJCŞÜPÏšBe¡Mode
::
	$LJCŞÜPÏšBe¡Mode
 ()

170 : 
	$PrštMode
 (
NULL
)

172 
ResŞutiÚX
[0] = 600;

173 
ResŞutiÚY
[0] = 600;

174 
Ba£ResX
 = 
Ba£ResY
 = 600;

176 
CÚfig
.
bCŞÜImage
 = 
FALSE
;

177 
theQu®™y
 = 
qu®™yP»£Á©iÚ
;

178 
bFÚtC­abË
 = 
TRUE
;

179 
pmQu®™y
 = 
QUALITY_BEST
;

180 #ifdeà
APDK_AUTODUPLEX


181 
bDu¶exC­abË
 = 
TRUE
;

183 
	}
}

186 
	gH—d”LJCŞÜ
::
	$H—d”LJCŞÜ
 (
Prš‹r
* 
p
, 
PrštCÚ‹xt
* 
pc
)

187 : 
	$H—d”
(
p
,
pc
)

188 { 
	}
}

190 
DRIVER_ERROR
 
	gH—d”LJCŞÜ
::
	$S’d
 ()

192 
DRIVER_ERROR
 
”r
;

193 
uom
[12];

195 
COLORMODE
 
eC
 = 
COLOR
;

196 
MEDIATYPE
 
eM
;

197 
QUALITY_MODE
 
eQ
;

198 
BOOL
 
bD
;

200 ((
LJCŞÜ
 *)
thePrš‹r
)->
bG»y_K
 = 
FALSE
;

201 ià((
thePrštCÚ‹xt
->
	`G‘PrštModeS‘tšgs
 (
eQ
, 
eM
, 
eC
, 
bD
)è=ğ
NO_ERROR
 &&

202 
eC
 =ğ
GREY_K
)

204 ((
LJCŞÜ
 *)
thePrš‹r
)->
bG»y_K
 = 
TRUE
;

207 
	`S¹S’d
 ();

209 ià(
eC
 !ğ
GREY_K
)

220 
”r
 = 
thePrš‹r
->
	`S’d
 ((cÚ¡ 
BYTE
 *) "\033*v6W\00\03\010\010\010\010", 11);

221 
ERRCHECK
;

227 
”r
 = 
thePrš‹r
->
	`S’d
 ((cÚ¡ 
BYTE
 *) "\033*t18J", 6);

229 
ERRCHECK
;

238 
”r
 = 
thePrš‹r
->
	`S’d
 ((cÚ¡ 
BYTE
 *) "\033*o3W\06\04\06", 8);

239 
ERRCHECK
;

244 
”r
 = 
thePrš‹r
->
	`S’d
 ((cÚ¡ 
BYTE
 *) "\033*v255A\033*v255B\033*v255C\033*v0I", 26);

245 
ERRCHECK
;

247 
”r
 = 
thePrš‹r
->
	`S’d
 ((cÚ¡ 
BYTE
 *) "\033*v255A\033*v0B\033*v0C\033*v6I", 22);

248 
ERRCHECK
;

249 
”r
 = 
thePrš‹r
->
	`S’d
 ((cÚ¡ 
BYTE
 *) "\033*v0A\033*v255B\033*v0C\033*v5I", 22);

250 
ERRCHECK
;

251 
”r
 = 
thePrš‹r
->
	`S’d
 ((cÚ¡ 
BYTE
 *) "\033*v0A\033*v0B\033*v255C\033*v3I", 22);

252 
ERRCHECK
;

253 
”r
 = 
thePrš‹r
->
	`S’d
 ((cÚ¡ 
BYTE
 *) "\033*v255A\033*v255B\033*v0C\033*v4I", 24);

254 
ERRCHECK
;

255 
”r
 = 
thePrš‹r
->
	`S’d
 ((cÚ¡ 
BYTE
 *) "\033*v255A\033*v0B\033*v255C\033*v2I", 24);

256 
ERRCHECK
;

257 
”r
 = 
thePrš‹r
->
	`S’d
 ((cÚ¡ 
BYTE
 *) "\033*v0A\033*v255B\033*v255C\033*v1I", 24);

258 
ERRCHECK
;

259 
”r
 = 
thePrš‹r
->
	`S’d
 ((cÚ¡ 
BYTE
 *) "\033*v0A\033*v0B\033*v0C\033*v7I", 20);

260 
ERRCHECK
;

263 
	`¥rštf
 (
uom
, "\033*r%dS", 
thePrštCÚ‹xt
->
	`OuutPix–sP”Row
 ());

264 
”r
 = 
thePrš‹r
->
	`S’d
 ((cÚ¡ 
BYTE
*)
uom
, 
	`¡¾’
 (uom));

265 
ERRCHECK
;

267 
”r
 = 
	`G¿phics
 ();

269  
”r
;

270 
	}
}

272 
DRIVER_ERROR
 
	gH—d”LJCŞÜ
::
	$S¹S’d
 ()

274 
DRIVER_ERROR
 
”r
;

275 
»s
[72];

276 
iRes
;

278 
iRes
 = 
thePrštCÚ‹xt
->
	`EfãùiveResŞutiÚY
 ();

280 
”r
 = 
thePrš‹r
->
	`S’d
 ((cÚ¡ 
BYTE
*)
UEL
,(UEL));

281 
ERRCHECK
;

283 
	`¥rštf
 (
»s
, "@PJL SET PAGEPROTECT=AUTO@PJL SET RESOLUTION=%d\015\012", 
iRes
);

284 
”r
 = 
thePrš‹r
->
	`S’d
 ((cÚ¡ 
BYTE
 *è
»s
, 
	`¡¾’
 (res));

285 
ERRCHECK
;

287 ià(
thePrš‹r
->
IOMode
.
bStus
)

289 
	`¥rštf
 (
»s
, "@PJL JOB NAME = \"%ld\"\015\012", (è(
thePrš‹r
));

290 
”r
 = 
thePrš‹r
->
	`S’d
 ((cÚ¡ 
BYTE
 *è
»s
, 
	`¡¾’
 (res));

291 
ERRCHECK
;

294 
QUALITY_MODE
 
eQ
 = 
QUALITY_NORMAL
;

295 
COLORMODE
 
eC
;

296 
MEDIATYPE
 
eM
;

297 
BOOL
 
bD
;

299 
thePrštCÚ‹xt
->
	`G‘PrštModeS‘tšgs
 (
eQ
, 
eM
, 
eC
, 
bD
);

301 ià(
eQ
 =ğ
QUALITY_DRAFT
)

303 
	`¡rıy
 (
»s
, "@PJL SET RET=OFF\015\012@PJL SET ECONOMODE=ON\015\012");

304 
”r
 = 
thePrš‹r
->
	`S’d
 ((cÚ¡ 
BYTE
 *è
»s
, 
	`¡¾’
 (res));

305 
ERRCHECK
;

308 ià(
thePrš‹r
->
IOMode
.
bStus
)

310 
	`¡rıy
 (
»s
, "@PJL USTATUSOFF\015\012@PJL USTATUS DEVICE = ON\015\012@PJL USTATUS JOB = ON\015\012");

311 
”r
 = 
thePrš‹r
->
	`S’d
 ((cÚ¡ 
BYTE
 *è
»s
, 
	`¡¾’
 (res));

312 
ERRCHECK
;

317 
	`¡rıy
 (
»s
, "@PJL SET DUPLEX=OFF\015\012");

319 #ifdeà
APDK_AUTODUPLEX


320 
DUPLEXMODE
 
dupmode
 = 
thePrštCÚ‹xt
->
	`Qu”yDu¶exMode
 ();

321 ià(
dupmode
 !ğ
DUPLEXMODE_NONE
)

323 
	`¡rıy
 (
»s
, "@PJL SET DUPLEX=ON\015\012@PJL SET BINDING=");

324 ià(
dupmode
 =ğ
DUPLEXMODE_BOOK
)

325 
	`¡rÿt
 (
»s
, "LONGEDGE\015\012");

327 
	`¡rÿt
 (
»s
, "SHORTEDGE\015\012");

331 
”r
 = 
thePrš‹r
->
	`S’d
 ((cÚ¡ 
BYTE
 *è
»s
, 
	`¡¾’
 (res));

334 
”r
 = 
thePrš‹r
->
	`S’d
 ((cÚ¡ 
BYTE
*è
EÁ”Lªguage
,  (EnterLanguage));

335 
ERRCHECK
;

337 
”r
 = 
thePrš‹r
->
	`S’d
 ((cÚ¡ 
BYTE
*) "PCL\015\012", 5);

338 
ERRCHECK
;

340 
”r
 = 
thePrš‹r
->
	`S’d
 ((cÚ¡ 
BYTE
*è
Re£t
, (Reset));

341 
ERRCHECK
;

343 
	`¥rštf
 (
»s
, "\033&l%dH", 
thePrštCÚ‹xt
->
	`G‘MedŸSourû
 ());

344 
”r
 = 
thePrš‹r
->
	`S’d
 ((cÚ¡ 
BYTE
 *è
»s
, 
	`¡¾’
 (res));

345 
ERRCHECK
;

349 
	`memıy
 (
»s
, 
medŸsize
, 
mscouÁ
 - 1);

350 
	`¡rıy
 (
»s
+
mscouÁ
-1, "a8c0E");

351 
”r
 = 
thePrš‹r
->
	`S’d
 ((cÚ¡ 
BYTE
 *è
»s
, 
	`¡¾’
 (res));

352 
ERRCHECK
;

354 
	`¥rštf
 (
»s
, "\033*t%dR\033&u%dD", 
iRes
, iRes);

355 
”r
=
thePrš‹r
->
	`S’d
 ((cÚ¡ 
BYTE
*è
»s
, 
	`¡¾’
 (res));

356 
ERRCHECK
;

358 
”r
 = 
	`M¬gšs
 ();

359 
ERRCHECK
;

360 
CAPy
 = 0;

364 
	`¡rıy
 (
»s
, "\033&l0S");

366 #ifdeà
APDK_AUTODUPLEX


367 
DUPLEXMODE
 
eDupMode
 = 
thePrštCÚ‹xt
->
	`Qu”yDu¶exMode
 ();

368 ià(
eDupMode
 !ğ
DUPLEXMODE_NONE
)

370 
	`¥rštf
 (
»s
, "\033&l%dS", (
eDupMode
 =ğ
DUPLEXMODE_BOOK
) ? 1 : 2);

373 
”r
 = 
thePrš‹r
->
	`S’d
 ((cÚ¡ 
BYTE
 *è
»s
, 
	`¡¾’
 (res));

374 
ERRCHECK
;

382 
”r
 = 
thePrš‹r
->
	`S’d
 ((cÚ¡ 
BYTE
 *) "\033&l0O", 5);

385 
	`¥rštf
 (
»s
, "\033&l%dX", 
thePrštCÚ‹xt
->
	`G‘CİyCouÁ
 ());

386 
”r
 = 
thePrš‹r
->
	`S’d
 ((cÚ¡ 
BYTE
 *è
»s
, 
	`¡¾’
 (res));

387 
ERRCHECK
;

389  
”r
;

390 
	}
}

392 
DRIVER_ERROR
 
	gH—d”LJCŞÜ
::
	$G¿phics
 ()

395 
DRIVER_ERROR
 
”r
;

396 
”r
 = 
thePrš‹r
->
	`S’d
 ((cÚ¡ 
BYTE
*è
g¿fS¹
,  (grafStart));

397 
ERRCHECK
;

399 ià(((
LJCŞÜ
 *è
thePrš‹r
)->
bG»y_K
)

401 
”r
 = 
thePrš‹r
->
	`S’d
 ((cÚ¡ 
BYTE
*) "\033*b2M", 5);

402 
ERRCHECK
;

406 
”r
 = 
thePrš‹r
->
	`S’d
 ((cÚ¡ 
BYTE
*) "\033*b3M", 5);

409  
”r
;

410 
	}
}

412 
DRIVER_ERROR
 
	gH—d”LJCŞÜ
::
	$EndJob
 ()

414 
szBuff
[128];

415 
DRIVER_ERROR
 
”r
 = 
NO_ERROR
;

416 ià(
thePrš‹r
->
IOMode
.
bStus
)

418 
	`¥rštf
 (
szBuff
, "\033E\033%%-12345X@PJL EOJ NAME = \"%ld\"\015\012@PJL RESET\015\012",

419 (è(
thePrš‹r
));

420 
”r
 = 
thePrš‹r
->
	`S’d
 ((cÚ¡ 
BYTE
 *è
szBuff
, 
	`¡¾’
 (szBuff));

421 
ERRCHECK
;

423 
	`¡rıy
 (
szBuff
, "\033%-12345X");

424 
”r
 = 
thePrš‹r
->
	`S’d
 ((cÚ¡ 
BYTE
 *è
szBuff
, 
	`¡¾’
 (szBuff));

426  
”r
;

427 
	}
}

429 
DRIVER_ERROR
 
	gH—d”LJCŞÜ
::
	$FÜmF“d
 ()

431 ((
LJCŞÜ
 *)
thePrš‹r
)->
bFGCŞÜS‘
 = 
FALSE
;

432 ((
LJCŞÜ
 *)
thePrš‹r
)->
m_iYPos
 = 0;

434  (
thePrš‹r
->
	`S’d
 ((cÚ¡ 
BYTE
 *) "\014", 1));

435 
	}
}

437 
DRIVER_ERROR
 
	gH—d”LJCŞÜ
::
	$S’dCAPy
 (
iAbsY
)

439 ià(
iAbsY
 == 0)

441  
thePrš‹r
->
	`S’d
 ((cÚ¡ 
BYTE
 *) "\033*p0Y", 5);

443  
NO_ERROR
;

444 
	}
}

446 
DRIVER_ERROR
 
	gLJCŞÜ
::
	$EnÿpsuÏ‹
 (cÚ¡ 
RASTERDATA
* 
IÅutRa¡”
, 
BOOL
 
bLa¡PÏÃ
)

448 
szSü©chSŒ
[16];

449 
DRIVER_ERROR
 
”r
;

450 
m_iYPos
++;

451 ià(
bFGCŞÜS‘
 =ğ
FALSE
)

453 
	`S’d
 ((cÚ¡ 
BYTE
 *) "\033*v7S", 5);

454 
bFGCŞÜS‘
 = 
TRUE
;

456 
	`¥rštf
 (
szSü©chSŒ
, "\033*b%uW", 
IÅutRa¡”
->
¿¡”size
[
COLORTYPE_COLOR
]);

457 
”r
 = 
	`S’d
 ((cÚ¡ 
BYTE
 *è
szSü©chSŒ
, 
	`¡¾’
 (szScratchStr));

458 ià(
”r
 =ğ
NO_ERROR
)

460 
”r
 = 
	`S’d
 (
IÅutRa¡”
->
¿¡”d©a
[
COLORTYPE_COLOR
], IÅutRa¡”->
¿¡”size
[COLORTYPE_COLOR]);

469 ià(!
bG»y_K
 &&

470 
m_iYResŞutiÚ
 == 600 &&

471 
m_iYPos
 % 1200 == 0)

473 
	`SkRa¡”s
 (0);

474 
”r
 = 
	`S’d
 ((cÚ¡ 
BYTE
 *) "\033*rC\033*r1A\033*b3M", 14);

477  
”r
;

478 
	}
}

480 
DRIVER_ERROR
 
	gLJCŞÜ
::
	$SkRa¡”s
 (
nBÏnkRa¡”s
)

482 
szSü©chSŒ
[16];

483 
DRIVER_ERROR
 
”r
 = 
NO_ERROR
;

484 ià(
m_pCom´essÜ
)

486 
m_pCom´essÜ
->
	`Flush
 ();

488 ià(
nBÏnkRa¡”s
 > 0)

490 
m_iYPos
 +ğ
nBÏnkRa¡”s
;

491 
	`¥rštf
 (
szSü©chSŒ
, "\033*p%dY", 
m_iYPos
);

492 
”r
 = 
	`S’d
 ((cÚ¡ 
BYTE
 *è
szSü©chSŒ
, 
	`¡¾’
 (szScratchStr));

494  
”r
;

495 
	}
}

498 
H—d”
* 
	gLJCŞÜ
::
	$S–eùH—d”
 (
PrštCÚ‹xt
 *
pc
)

500 
m_iYResŞutiÚ
 = 
pc
->
	`EfãùiveResŞutiÚY
 ();

501  
Ãw
 
	`H—d”LJCŞÜ
 (
this
, 
pc
);

502 
	}
}

504 
DRIVER_ERROR
 
	gLJCŞÜ
::
	$V”ifyP’Info
()

507 
DRIVER_ERROR
 
”r
 = 
NO_ERROR
;

509 if(
IOMode
.
bDevID
 =ğ
FALSE
)

511  
”r
;

514 
eP’
 = 
BOTH_PENS
;

515  
NO_ERROR
;

516 
	}
}

518 
DRIVER_ERROR
 
	gLJCŞÜ
::
	$P¬£P’Info
(
PEN_TYPE
& 
eP’
, 
BOOL
 
Qu”yPrš‹r
)

524 
eP’
 = 
BOTH_PENS
;

526  
NO_ERROR
;

527 
	}
}

529 
Com´essÜ
* 
	gLJCŞÜ
::
	$C»©eCom´essÜ
 (
Ra¡”Size
)

531 
bFGCŞÜS‘
 = 
FALSE
;

532 ià(
bG»y_K
)

533  
Ãw
 
	`Mode2
 (
pSS
, 
Ra¡”Size
);

535 
m_pCom´essÜ
 = 
Ãw
 
	`Mode3
 (
pSS
, 
this
, 
Ra¡”Size
);

536  
m_pCom´essÜ
;

537 
	}
}

571 
DISPLAY_STATUS
 
	gLJCŞÜ
::
	$P¬£E¼Ü
(
BYTE
 
¡©us_»g
)

573 
	`DBG1
("LJColor:…arsingƒrror info\n");

575 
DRIVER_ERROR
 
”r
 = 
NO_ERROR
;

576 
BYTE
 
szR—dBuff
[256];

577 
DWORD
 
iR—dCouÁ
 = 256;

578 
DISPLAY_STATUS
 
eStus
 = (DISPLAY_STATUSè
¡©us_»g
;

579 *
tmpSŒ
;

580 
iE¼ÜCode
;

582 ià(!
IOMode
.
bDevID
)

583  
eStus
;

585 
	`mem£t
 (
szR—dBuff
, 0, 256);

586 
”r
 = 
pSS
->
	`FromDeviû
 (
szR—dBuff
, &
iR—dCouÁ
);

587 ià(
”r
 =ğ
NO_ERROR
 && 
iR—dCouÁ
 == 0)

588  
eStus
;

590 ià(
	`¡r¡r
 ((*è
szR—dBuff
, "JOB"))

592 ià(!(
tmpSŒ
 = 
	`¡r¡r
 ((*è
szR—dBuff
, "NAME")))

593  
DISPLAY_PRINTING
;

594 
tmpSŒ
 += 6;

595 *
tmpSŒ
 < '0' || *tmpStr > '9')

596 
tmpSŒ
++;

597 
	`ssÿnf
 (
tmpSŒ
, "%d", &
iE¼ÜCode
);

598 ià(
iE¼ÜCode
 !ğ(è(
this
))

599  
DISPLAY_PRINTING
;

602 ià(
	`¡r¡r
 ((*è
szR—dBuff
, "END"))

604  
DISPLAY_PRINTING_COMPLETE
;

608 ià(
	`¡r¡r
 ((*è
szR—dBuff
, "CANCEL"))

609  
DISPLAY_PRINTING_CANCELED
;

611 ià(!(
tmpSŒ
 = 
	`¡r¡r
 ((*è
szR—dBuff
, "CODE")))

612  
eStus
;

614 
tmpSŒ
 += 4;

615 *
tmpSŒ
 < '0' || *tmpStr > '9')

616 
tmpSŒ
++;

617 
	`ssÿnf
 (
tmpSŒ
, "%d", &
iE¼ÜCode
);

619 ià(
iE¼ÜCode
 < 32000)

620  
DISPLAY_PRINTING
;

622 ià(
iE¼ÜCode
 == 40010 || iErrorCode == 40020)

623  
DISPLAY_NO_PENS
;

625 ià(
iE¼ÜCode
 == 40021)

626  
DISPLAY_TOP_COVER_OPEN
;

628 ià((
iE¼ÜCode
 / 100) == 419)

629  
DISPLAY_OUT_OF_PAPER
;

631 ià((
iE¼ÜCode
 / 1000) == 42 || iErrorCode == 40022)

633 
	`DBG1
("Paper Jammed\n");

634  
DISPLAY_PAPER_JAMMED
;

637 ià(
iE¼ÜCode
 > 40049 && iErrorCode < 41000)

639 
	`DBG1
("IOrap\n");

640  
DISPLAY_ERROR_TRAP
;

643 ià(
iE¼ÜCode
 == 40079)

644  
DISPLAY_OFFLINE
;

646  
DISPLAY_ERROR_TRAP
;

647 
	}
}

649 
	gAPDK_END_NAMESPACE


	@prnt/hpijs/ljcolor.h

32 #iâdeà
APDK_LJCOLOR_H


33 
	#APDK_LJCOLOR_H


	)

35 
APDK_BEGIN_NAMESPACE


40 şas 
	cLJCŞÜ
 : 
public
 
Prš‹r


42 
public
:

43 
LJCŞÜ
 (
Sy¡emS”viûs
* 
pSS
,
numfÚts
=0, 
BOOL
 
´Ùo
=
FALSE
);

44 ~
LJCŞÜ
 ();

46 
vœtu®
 
H—d”
* 
S–eùH—d”
 (
PrštCÚ‹xt
* 
pc
);

47 
vœtu®
 
DRIVER_ERROR
 
V”ifyP’Info
 ();

48 
vœtu®
 
DRIVER_ERROR
 
P¬£P’Info
 (
PEN_TYPE
& 
eP’
, 
BOOL
 
Qu”yPrš‹r
=
TRUE
);

49 
vœtu®
 
DISPLAY_STATUS
 
P¬£E¼Ü
 (
BYTE
 
¡©us_»g
);

50 
šlše
 
vœtu®
 
BOOL
 
	$SuµÜtS•¬©eBÏck
 (
PrštMode
 *
pCu¼’tMode
è{ 
FALSE
;}

51 
DRIVER_ERROR
 
	`SkRa¡”s
 (
nBÏnkRa¡”s
);

52 
vœtu®
 
DRIVER_ERROR
 
	$Flush
 (
FlushSize
)

54  
NO_ERROR
;

55 
	}
}

57 
vœtu®
 
BOOL
 
	$G‘M¬gšs
 (
PAPER_SIZE
 
ps
, *
fM¬gšs
)

59 
fM¬gšs
[0] = () 0.25;

60 
fM¬gšs
[1] = () 0.25;

61 
fM¬gšs
[2] = () 0.2;

62 
fM¬gšs
[3] = () 0.2;

63  
TRUE
;

64 
	}
}

66 
vœtu®
 
BOOL
 
	$U£CMYK
 (
iPrštMode
è{  
FALSE
;
	}
}

67 
vœtu®
 
DRIVER_ERROR
 
EnÿpsuÏ‹
 (cÚ¡ 
RASTERDATA
* 
IÅutRa¡”
, 
BOOL
 
bLa¡PÏÃ
);

69 #ifdeà
APDK_AUTODUPLEX


78 
vœtu®
 
BOOL
 
	$HagakiF“dDu¶ex”P»£Á
 (
BOOL
 
bQu”yPrš‹r
)

80  
TRUE
;

81 
	}
}

84 
Com´essÜ
* 
C»©eCom´essÜ
 (
Ra¡”Size
);

85 
BOOL
 
	gbFGCŞÜS‘
;

86 
BOOL
 
	gbG»y_K
;

87 
	gm_iYPos
;

89 
	g´Ùeùed
:

91 #ifdeà
APDK_HP_UX


92 
vœtu®
 
LJCŞÜ
 & 
İ”©Ü
 = (
Prš‹r
& 
rhs
)

94  *
this
;

98 
BOOL
 
	gm_bJobS¹ed
;

99 
	gm_iYResŞutiÚ
;

100 
Com´essÜ
 *
	gm_pCom´essÜ
;

104 şas 
	cLJCŞÜKD¿áMode
 : 
public
 
G¿yMode


106 
public
:

107 
LJCŞÜKD¿áMode
 ();

110 şas 
	cLJCŞÜG¿yMode
 : 
public
 
G¿yMode


112 
public
:

113 
LJCŞÜG¿yMode
 ();

116 şas 
	cLJCŞÜ150DPIMode
 : 
public
 
PrštMode


118 
public
:

119 
LJCŞÜ150DPIMode
 ();

122 şas 
	cLJCŞÜ300DPIMode
 : 
public
 
PrštMode


124 
public
:

125 
LJCŞÜ300DPIMode
 ();

128 şas 
	cLJCŞÜ600DPIMode
 : 
public
 
PrštMode


130 
public
:

131 
LJCŞÜ600DPIMode
 ();

134 #ifdeà
APDK_EXTENDED_MEDIASIZE


135 şas 
	cLJCŞÜPÏšBe¡Mode
 : 
public
 
PrštMode


137 
public
:

138 
LJCŞÜPÏšBe¡Mode
 ();

142 #ifdeà
APDK_LJCOLOR


146 şas 
	cLJCŞÜProxy
 : 
public
 
Prš‹rProxy


148 
public
:

149 
	$LJCŞÜProxy
(è: 
	`Prš‹rProxy
(

157 #ifdeà
APDK_MLC_PRINTER


159 è{
m_iPrš‹rTy³
 = 
eLJCŞÜ
;}

160 
šlše
 
Prš‹r
* 
	$C»©ePrš‹r
(
Sy¡emS”viûs
* 
pSS
ècÚ¡ {  
Ãw
 
	`LJCŞÜ
ÕSS); 
	}
}

161 
šlše
 
PRINTER_TYPE
 
	$G‘Prš‹rTy³
(ècÚ¡ {  
eLJCŞÜ
;
	}
}

162 
šlše
 
	$G‘Mod–B™
(ècÚ¡ {  0x20;
	}
}

166 
	gAPDK_END_NAMESPACE


	@prnt/hpijs/ljfastraster.cpp

32 #ifdeà
APDK_LJFASTRASTER


34 
	~"h—d”.h
"

35 
	~"ljç¡¿¡”.h
"

36 
	~"´š‹½roxy.h
"

38 
	gAPDK_BEGIN_NAMESPACE


40 
	#INDY_STRIP_HEIGHT
 128

41 

	)

42 
ušt32_t
 
ulM­DJ600_CCM_K
[ 9 * 9 * 9 ];

44 
BYTE
 
	gFrBegšSessiÚSeq
[] = {0xC0, 0x00, 0xF8, 0x86, 0xC0, 0x03, 0xF8, 0x8F, 0xD1, 0x58,

46 
BYTE
 
	gFrF“dOr›Á©iÚSeq
[] = {0xC0, 0x00 , 0xF8, 0x28 };

48 
BYTE
 
	gFrP­”SizeSeq
[] = {0xC0, 0x00 ,0xF8, 0x25};

50 
BYTE
 
	gFrMedSourûSeq
[] = {0xC0, 0x00 ,0xF8, 0x26 };

52 
BYTE
 
	gFrMedDe¡š©iÚSeq
[] = {0xC0, 0x00 ,0xF8 , 0x24 };

54 
BYTE
 
	gFrBegšPageSeq
[] = {0x43, 0xD3, 0x00, 0x00, 0x00, 0x00, 0xF8, 0x2A, 0x75, 0xC0, 0x07,0xF8, 0x03, 0x6A,

58 
BYTE
 
	gFrBegšImageSeq
[] = {0xC2, 0x00, 0x40, 0x70, 0x68, 0xF8, 0x91, 0xC1};

60 
BYTE
 
	gFrVU_v”_TagSeq
[] = {0xC2, 0x00, 0x00, 0x04, 0x00 , 0xF8, 0x95 };

62 
BYTE
 
	gFrD©aL’gthSeq
[] = {0xC2, 0x86, 0x0A, 0x00, 0x00, 0xF8, 0x92 };

64 
BYTE
 
	gFrV’UniqSeq
[] = {0x46};

65 
BYTE
 
	gFrVUExŠ_3Seq
[] = {0xC2, 0x11, 0x20, 0x70, 0x68 ,0xF8, 0x91 };

67 
BYTE
 
	gFrO³nD©aSourûSeq
[] = {0xC0, 0x00, 0xF8, 0x88, 0xC0, 0x01, 0xF8, 0x82, 0x48};

69 
BYTE
 
	gFrEndPageSeq
[] = {0x44};

70 
BYTE
 
	gFrEndSessiÚSeq
[] = {0x42};

71 
BYTE
 
	gFrClo£D©aSourûSeq
[] = {0x49};

76 cÚ¡ *
	gcıPJLS¹Job
 = "\033%-12345X";

77 cÚ¡ *
	gcıPJLEx™Seq
 = "\033%-12345X@PJL EOJ\012\033%-12345X";

78 cÚ¡ *
	gcıPJLS‘Res
 = "@PJL SET RESOLUTION=600\012";

79 cÚ¡ *
	gcıPCLEÁ”XL
 = "@PJL ENTER LANGUAGE=PCLXL\012";

80 cÚ¡ *
	gcıPJLS‘TO
 = "@PJL SET TIMEOUT=900\012";

81 cÚ¡ *
	gcıUEL
 = "\033%-12345X";

82 cÚ¡ *
	gcıPJLComm’t
 = ") HP-PCL XL;2;0;Comment\012";

83 cÚ¡ *
	gcıPJLS‘1BPP
 = "@PJL SET BITSPERPIXEL=1\012";

84 cÚ¡ *
	gcıPJLS‘ECONOMODE
 = "@PJL SET ECONOMODE=OFF\012";

85 cÚ¡ *
	gcıPJLS‘TimeSmp
 = "@PJL SET JOBATTR=";

90 
	gLJFa¡Ra¡”
::
	$LJFa¡Ra¡”
 (
Sy¡emS”viûs
* 
pSS
, 
numfÚts
, 
BOOL
 
´Ùo
)

91 : 
	$Prš‹r
(
pSS
, 
numfÚts
, 
´Ùo
)

94 ià((!
´Ùo
è&& (
IOMode
.
bDevID
))

96 
cÚ¡ruùÜ_”rÜ
 = 
	`V”ifyP’Info
();

97 
CERRCHECK
;

99 
eP’
 = 
BLACK_PEN
;

101 
pMode
[
DEFAULTMODE_INDEX
] = 
Ãw
 
	`LJFa¡Ra¡”NÜm®Mode
 ();

102 
pMode
[
GRAYMODE_INDEX
] = 
Ãw
 
	`LJFa¡Ra¡”D¿áMode
 ();

104 
ModeCouÁ
 = 2;

106 
CMYM­
 = 
NULL
;

107 
m_bJobS¹ed
 = 
FALSE
;

108 #ifdeà 
APDK_AUTODUPLEX


109 
m_bRÙ©eBackPage
 = 
FALSE
;

112 
m_iYPos
 = 0;

113 
m_bS¹PageNÙS’t
 = 
TRUE
;

115 
	`DBG1
("LJFastRaster created\n");

116 
	}
}

118 
	gLJFa¡Ra¡”
::~
	$LJFa¡Ra¡”
 ()

120 
DISPLAY_STATUS
 
eDi¥Stus
;

121 ià(
IOMode
.
bStus
 && 
m_bJobS¹ed
)

123 
i
 = 0; i < 5; i++)

125 
pSS
->
	`BusyWa™
 (2000);

126 
eDi¥Stus
 = 
	`P¬£E¼Ü
 (0);

127 ià(
eDi¥Stus
 =ğ
DISPLAY_PRINTING_COMPLETE
)

129 
pSS
->
	`Di¥ÏyPrš‹rStus
 (
eDi¥Stus
);

134 
	}
}

136 
	gLJFa¡Ra¡”NÜm®Mode
::
	$LJFa¡Ra¡”NÜm®Mode
 ()

137 : 
	$G¿yMode
(
ulM­DJ600_CCM_K
)

139 
ResŞutiÚX
[0] = 600;

140 
ResŞutiÚY
[0] = 600;

141 
Ba£ResX
 = 
Ba£ResY
 = 600;

143 
MixedRes
 = 
FALSE
;

145 
theQu®™y
 = 
qu®™yNÜm®
;

147 
pmQu®™y
 = 
QUALITY_NORMAL
;

149 #ià
	`defšed
(
APDK_VIP_COLORFILTERING
)

150 
CÚfig
.
bEº›
 = 
FALSE
;

153 #ifdeà
APDK_AUTODUPLEX


154 
bDu¶exC­abË
 = 
TRUE
;

157 
bFÚtC­abË
 = 
FALSE
;

158 
	}
}

160 
	gLJFa¡Ra¡”D¿áMode
::
	$LJFa¡Ra¡”D¿áMode
 ()

161 : 
	$G¿yMode
(
ulM­DJ600_CCM_K
)

163 
ResŞutiÚX
[0] = 600;

164 
ResŞutiÚY
[0] = 600;

165 
Ba£ResX
 = 
Ba£ResY
 = 600;

167 
MixedRes
 = 
FALSE
;

169 
theQu®™y
 = 
qu®™yD¿á
;

171 
pmQu®™y
 = 
QUALITY_DRAFT
;

173 #ià
	`defšed
(
APDK_VIP_COLORFILTERING
)

174 
CÚfig
.
bEº›
 = 
FALSE
;

177 #ifdeà
APDK_AUTODUPLEX


178 
bDu¶exC­abË
 = 
TRUE
;

181 
bFÚtC­abË
 = 
FALSE
;

182 
	}
}

184 
	gH—d”LJFa¡Ra¡”
::
	$H—d”LJFa¡Ra¡”
 (
Prš‹r
* 
p
, 
PrštCÚ‹xt
* 
pc
)

185 : 
	$H—d”
(
p
,
pc
)

187 
	`S‘La¡Bªd
(
FALSE
);

188 
	}
}

190 
DRIVER_ERROR
 
	gH—d”LJFa¡Ra¡”
::
	$S’d
 ()

192 
	`S¹S’d
 ();

194  
NO_ERROR
;

195 
	}
}

197 
DRIVER_ERROR
 
	gH—d”LJFa¡Ra¡”
::
	$S¹S’d
 ()

199 
DRIVER_ERROR
 
”r
 = 
NO_ERROR
;

200 
»s
[64];

202 
”r
 = 
thePrš‹r
->
	`S’d
 ((cÚ¡ 
BYTE
*)
cıPJLS¹Job
, 
	`¡¾’
 (ccpPJLStartJob));

203 
ERRCHECK
;

206 
”r
 = 
thePrš‹r
->
	`S’d
 ((cÚ¡ 
BYTE
*)
cıPJLS‘Res
, 
	`¡¾’
 (ccpPJLSetRes));

207 
ERRCHECK
;

209 
”r
 = 
thePrš‹r
->
	`S’d
 ((cÚ¡ 
BYTE
*)
cıPJLS‘1BPP
, 
	`¡¾’
 (ccpPJLSet1BPP));

210 
ERRCHECK
;

212 
QUALITY_MODE
 
eQ
 = 
QUALITY_NORMAL
;

213 
COLORMODE
 
eC
;

214 
MEDIATYPE
 
eM
;

215 
BOOL
 
bD
;

217 
thePrštCÚ‹xt
->
	`G‘PrštModeS‘tšgs
 (
eQ
, 
eM
, 
eC
, 
bD
);

219 
	`¡rıy
 (
»s
, "@PJL SET ECONOMODE=");

221 ià(
eQ
 =ğ
QUALITY_DRAFT
)

223 
	`¡rÿt
 (
»s
, "ON\015\012");

227 
	`¡rÿt
 (
»s
, "OFF\015\012");

229 
”r
 = 
thePrš‹r
->
	`S’d
 ((cÚ¡ 
BYTE
 *è
»s
, 
	`¡¾’
 (res));

230 
ERRCHECK
;

234 
”r
 = 
thePrš‹r
->
	`S’d
 ((cÚ¡ 
BYTE
*)
cıPJLS‘TO
, 
	`¡¾’
 (ccpPJLSetTO));

235 
ERRCHECK
;

238 
”r
 = 
thePrš‹r
->
	`S’d
 ((cÚ¡ 
BYTE
*)
cıPCLEÁ”XL
, 
	`¡¾’
 (ccpPCLEnterXL));

239 
ERRCHECK
;

242 
”r
 = 
thePrš‹r
->
	`S’d
 ((cÚ¡ 
BYTE
*)
cıPJLComm’t
, 
	`¡¾’
 (ccpPJLComment));

243 
ERRCHECK
;

245 
”r
 = 
thePrš‹r
->
	`S’d
 ((cÚ¡ 
BYTE
*)
FrBegšSessiÚSeq
,(FrBeginSessionSeq));

246 
ERRCHECK
;

249 
”r
 = 
thePrš‹r
->
	`S’d
 ((cÚ¡ 
BYTE
*)
FrVUExŠ_3Seq
,(FrVUExtn_3Seq));

250 
ERRCHECK
;

251 
”r
 = 
thePrš‹r
->
	`S’d
 ((cÚ¡ 
BYTE
*)
FrV’UniqSeq
,(FrVenUniqSeq));

252 
ERRCHECK
;

259 
”r
 = 
thePrš‹r
->
	`S’d
 ((cÚ¡ 
BYTE
*)
FrO³nD©aSourûSeq
,(FrOpenDataSourceSeq));

260 
ERRCHECK
;

262  
”r
;

263 
	}
}

265 
	gH—d”LJFa¡Ra¡”
::
	$FrP­”ToMedŸSize
(
PAPER_SIZE
 
psize
)

267 
psize
)

269 
LETTER
:  0; ;

270 
LEGAL
:  1; ;

271 
A4
:  2; ;

272 
B4
:  10; ;

273 
B5
:  11; ;

274 
OUFUKU
:  14; ;

275 
HAGAKI
:  14; ;

276 
A6
:  17; ;

277 #ifdeà
APDK_EXTENDED_MEDIASIZE


278 
A3
:  5; ;

279 
A5
:  16; ;

280 
LEDGER
:  4; ;

281 
EXECUTIVE
:  3; ;

282 
CUSTOM_SIZE
:  96; ;

283 
ENVELOPE_NO_10
:  6; ;

284 
ENVELOPE_A2
:  6; ;

285 
ENVELOPE_C6
:  8; ;

286 
ENVELOPE_DL
:  9; ;

290 
	}
}

292 
DRIVER_ERROR
 
	gH—d”LJFa¡Ra¡”
::
	$S¹Page
 ()

294 
DRIVER_ERROR
 
”r
;

295 
BYTE
 
szCu¡omSize
[16];

304 
”r
 = 
thePrš‹r
->
	`S’d
 ((cÚ¡ 
BYTE
*)
FrF“dOr›Á©iÚSeq
,(FrFeedOrientationSeq));

305 
ERRCHECK
;

308 
PAPER_SIZE
 
ps
 = 
thePrštCÚ‹xt
->
	`G‘P­”Size
 ();

309 
msizeCode
 = 
	`FrP­”ToMedŸSize
(
ps
);

310 
FrP­”SizeSeq
[1] = (
BYTE
è
msizeCode
;

311 #ifdeà
APDK_EXTENDED_MEDIASIZE


312 if(
msizeCode
 == 96 || msizeCode == 17)

316 
fV®ue
;

317 
ušt32_t
 
uiV®ue
;

318 } 
LJFUniÚ
;

319 
ušt32_t
 
uiXsize
;

320 
ušt32_t
 
uiYsize
;

321 
k
 = 0;

322 
LJFUniÚ
.
fV®ue
 = (è
thePrštCÚ‹xt
->
	`PhysiÿlPageSizeX
 ();

323 
uiXsize
 = 
LJFUniÚ
.
uiV®ue
;

324 
LJFUniÚ
.
fV®ue
 = (è
thePrštCÚ‹xt
->
	`PhysiÿlPageSizeY
 ();

325 
uiYsize
 = 
LJFUniÚ
.
uiV®ue
;

326 
szCu¡omSize
[
k
++] = 0xD5;

327 
szCu¡omSize
[
k
++] = (
BYTE
è(
uiXsize
 & 0x000000FF);

328 
szCu¡omSize
[
k
++] = (
BYTE
è((
uiXsize
 & 0x0000FF00) >> 8);

329 
szCu¡omSize
[
k
++] = (
BYTE
è((
uiXsize
 & 0x00FF0000) >> 16);

330 
szCu¡omSize
[
k
++] = (
BYTE
è((
uiXsize
 & 0xFF000000) >> 24);

331 
szCu¡omSize
[
k
++] = (
BYTE
è(
uiYsize
 & 0x000000FF);

332 
szCu¡omSize
[
k
++] = (
BYTE
è((
uiYsize
 & 0x0000FF00) >> 8);

333 
szCu¡omSize
[
k
++] = (
BYTE
è((
uiYsize
 & 0x00FF0000) >> 16);

334 
szCu¡omSize
[
k
++] = (
BYTE
è((
uiYsize
 & 0xFF000000) >> 24);

335 
szCu¡omSize
[
k
++] = 0xF8;

336 
szCu¡omSize
[
k
++] = 0x2F;

337 
”r
 = 
thePrš‹r
->
	`S’d
 ((cÚ¡ 
BYTE
 *è
szCu¡omSize
, 
k
);

338 
ERRCHECK
;

341 
BYTE
 
FrCu¡omMedŸSeq
[] = {0xC0,0x00, 0xF8, 0x30};

342 
”r
 = 
thePrš‹r
->
	`S’d
 ((cÚ¡ 
BYTE
 *)
FrCu¡omMedŸSeq
, (FrCustomMediaSeq));

343 
ERRCHECK
;

348 
”r
 = 
thePrš‹r
->
	`S’d
 ((cÚ¡ 
BYTE
*)
FrP­”SizeSeq
,(FrPaperSizeSeq));

349 
ERRCHECK
;

352 
”r
 = 
thePrš‹r
->
	`S’d
 ((cÚ¡ 
BYTE
 *)
FrBegšPageSeq
, (FrBeginPageSeq));

353 
ERRCHECK
;

355 
bLa¡Bªd
 = 
FALSE
;

357  
”r
;

358 
	}
}

360 
DRIVER_ERROR
 
	gH—d”LJFa¡Ra¡”
::
	$EndPage
 ()

362 
DRIVER_ERROR
 
”r
;

365 
”r
 = 
thePrš‹r
->
	`S’d
 ((cÚ¡ 
BYTE
*)
FrEndPageSeq
,(FrEndPageSeq));

366 
ERRCHECK
;

368  
”r
;

369 
	}
}

371 
DRIVER_ERROR
 
	gH—d”LJFa¡Ra¡”
::
	$EndJob
 ()

373 
DRIVER_ERROR
 
”r
 = 
NO_ERROR
;

375 
”r
 = 
thePrš‹r
->
	`S’d
((cÚ¡ 
BYTE
*)
FrClo£D©aSourûSeq
, (FrCloseDataSourceSeq));

376 
ERRCHECK
;

378 
”r
 = 
thePrš‹r
->
	`S’d
((cÚ¡ 
BYTE
*)
FrEndSessiÚSeq
, (FrEndSessionSeq));

379 
ERRCHECK
;

381 
”r
 = 
thePrš‹r
->
	`S’d
((cÚ¡ 
BYTE
*)
cıPJLEx™Seq
, 
	`¡¾’
 (ccpPJLExitSeq));

382 
ERRCHECK
;

384  
”r
;

385 
	}
}

387 
DRIVER_ERROR
 
	gH—d”LJFa¡Ra¡”
::
	$FÜmF“d
 ()

389 
DRIVER_ERROR
 
”r
 = 
NO_ERROR
;

390 
LJFa¡Ra¡”
 *
pFRPrš‹r
 = (LJFa¡Ra¡” *è
thePrš‹r
;

392 
bLa¡Bªd
 = 
TRUE
;

394 
”r
 = 
	`EndPage
 ();

396 
pFRPrš‹r
->
m_bS¹PageNÙS’t
 = 
TRUE
;

397  
”r
;

398 
	}
}

400 
DRIVER_ERROR
 
	gH—d”LJFa¡Ra¡”
::
	$S’dCAPy
 (
iAbsY
)

402  
NO_ERROR
;

403 
	}
}

405 
	#FAST_RASTER_HEADERSIZE
 25

	)

409 
	#BASE_ADDRESS
 0

	)

410 
	#PAGE_NUM_ADDRESS
 1

	)

411 
	#RESOLUTION_ADDRESS_HI
 2

	)

412 
	#RESOLUTION_ADDRESS_LO
 3

	)

413 
	#COMPRESSION_ADDRESS_HI
 4

	)

414 
	#COMPRESSION_ADDRESS_LO
 5

	)

415 
	#COLOR_PLANE_SPECIFIER_ADDRESS
 6

	)

416 
	#COMPRESSION_RATIO
 7

	)

417 
	#PRODUCT_ID
 8

	)

418 
	#IMAGE_SIZE_ADDRESS_HIWORD_HI
 12

	)

419 
	#IMAGE_SIZE_ADDRESS_HIWORD_LO
 13

	)

420 
	#IMAGE_SIZE_ADDRESS_LOWORD_HI
 14

	)

421 
	#IMAGE_SIZE_ADDRESS_LOWORD_LO
 15

	)

422 
	#IMAGE_WIDTH_ADDRESS_HI
 16

	)

423 
	#IMAGE_WIDTH_ADDRESS_LO
 17

	)

424 
	#IMAGE_HEIGTH_ADDRESS_HI
 18

	)

425 
	#IMAGE_HEIGTH_ADDRESS_LO
 19

	)

426 
	#ABS_X_ADDRESS_HI
 20

	)

427 
	#ABS_X_ADDRESS_LO
 21

	)

428 
	#ABS_Y_ADDRESS_HI
 22

	)

429 
	#ABS_Y_ADDRESS_LO
 23

	)

430 
	#BIT_DEPTH_ADDRESS
 24

	)

432 
	#eK
 3

	)

435 
	meD–32
,

436 
	meD–Plus
 = 24,

437 
	meFX
 = 18,

438 
	meRAW
 = 2

439 } 
	tCom´essiÚM‘hod
;

441 
	#KILOBYTE
 1024

	)

442 
	#MAX_IMAGE
 200*
KILOBYTE


	)

444 
DRIVER_ERROR
 
	gLJFa¡Ra¡”
::
	$EnÿpsuÏ‹
 (cÚ¡ 
RASTERDATA
* 
IÅutRa¡”
, 
BOOL
 
bLa¡PÏÃ
)

446 
BYTE
 
»s
[64];

447 
DRIVER_ERROR
 
”r
 = 
NO_ERROR
;

450 
pucH—d”
[
FAST_RASTER_HEADERSIZE
];

451 
lImageWidth
 = ((
ModeD–Plus
*)
m_pCom´essÜ
)->
šputsize
;

452 
lResŞutiÚ
 = 600;

453 
lBlockOff£t
 = ((((
ModeD–Plus
*)
m_pCom´essÜ
)->
m_lPrš‹rRa¡”Row
 + 127) / 128) * 128 - 128;

454 
lB™D•th
 = 1;

455 
lBlockHeight
 = ((
ModeD–Plus
*)
m_pCom´essÜ
)->
m_lCu¼BlockHeight
;

457 
WORD
 
wTemp
 = 
	`LOWORD
 (
lBlockOff£t
);

458 
BYTE
 
byHIBy‹
 = 0;

459 
BYTE
 
byLOBy‹
 = 0;

461 
	`mem£t
 (
pucH—d”
, 0, 
FAST_RASTER_HEADERSIZE
);

463 
pucH—d”
[
ABS_X_ADDRESS_HI
] = 0;

464 
pucH—d”
[
ABS_X_ADDRESS_LO
] = 0;

465 
pucH—d”
[
ABS_Y_ADDRESS_HI
] = 
	`HIBYTE
 (
wTemp
);

466 
pucH—d”
[
ABS_Y_ADDRESS_LO
] = 
	`LOBYTE
 (
wTemp
);

468 
pucH—d”
[
BASE_ADDRESS
] = 0;

469 
pucH—d”
[
PAGE_NUM_ADDRESS
] = 1;

471 
wTemp
 = (
WORD
è(
lResŞutiÚ
 );

472 
byHIBy‹
 = 
	`HIBYTE
 (
wTemp
);

473 
byLOBy‹
 = 
	`LOBYTE
 (
wTemp
);

474 
pucH—d”
[
RESOLUTION_ADDRESS_HI
] = 
byHIBy‹
;

475 
pucH—d”
[
RESOLUTION_ADDRESS_LO
] = 
byLOBy‹
;

477 
wTemp
 = ((
ModeD–Plus
*)
m_pCom´essÜ
)->
m_bCom´es£d
 ? (
WORD
)
eD–Plus
 : (WORD)
eRAW
;

478 
byHIBy‹
 = 
	`HIBYTE
 (
wTemp
);

479 
byLOBy‹
 = 
	`LOBYTE
 (
wTemp
);

480 
pucH—d”
[
COMPRESSION_ADDRESS_HI
] = 
byHIBy‹
;

481 
pucH—d”
[
COMPRESSION_ADDRESS_LO
] = 
byLOBy‹
;

483 
pucH—d”
[
COLOR_PLANE_SPECIFIER_ADDRESS
] = (
BYTE
)
eK
;

484 
pucH—d”
[
COMPRESSION_RATIO
] = (
BYTE
)
	`û
 (((
ModeD–Plus
*)
m_pCom´essÜ
)->
m_fR©io
);

485 
wTemp
 = 
	`HIWORD
 (
IÅutRa¡”
->
¿¡”size
[
COLORTYPE_COLOR
]);

486 
byHIBy‹
 = 
	`HIBYTE
 (
wTemp
);

487 
byLOBy‹
 = 
	`LOBYTE
 (
wTemp
);

488 
pucH—d”
[
IMAGE_SIZE_ADDRESS_HIWORD_HI
] = 
byHIBy‹
;

489 
pucH—d”
[
IMAGE_SIZE_ADDRESS_HIWORD_LO
] = 
byLOBy‹
;

491 
wTemp
 = 
	`LOWORD
 (
IÅutRa¡”
->
¿¡”size
[
COLORTYPE_COLOR
]);

492 
byHIBy‹
 = 
	`HIBYTE
 (
wTemp
);

493 
byLOBy‹
 = 
	`LOBYTE
 (
wTemp
);

494 
pucH—d”
[
IMAGE_SIZE_ADDRESS_LOWORD_HI
] = 
byHIBy‹
;

495 
pucH—d”
[
IMAGE_SIZE_ADDRESS_LOWORD_LO
] = 
byLOBy‹
;

497 
wTemp
 = 
	`LOWORD
 (
lImageWidth
*8);

498 
byHIBy‹
 = 
	`HIBYTE
 (
wTemp
);

499 
byLOBy‹
 = 
	`LOBYTE
 (
wTemp
);

501 
pucH—d”
[
IMAGE_WIDTH_ADDRESS_HI
] = 
byHIBy‹
;

502 
pucH—d”
[
IMAGE_WIDTH_ADDRESS_LO
] = 
byLOBy‹
;

504 
wTemp
 = 
	`LOWORD
 (
lBlockHeight
);

505 
byHIBy‹
 = 
	`HIBYTE
 (
wTemp
);

506 
byLOBy‹
 = 
	`LOBYTE
 (
wTemp
);

507 
pucH—d”
[
IMAGE_HEIGTH_ADDRESS_HI
] = 
byHIBy‹
;

508 
pucH—d”
[
IMAGE_HEIGTH_ADDRESS_LO
] = 
byLOBy‹
;

510 
wTemp
 = 
	`LOWORD
 (
lB™D•th
);

511 
pucH—d”
[
BIT_DEPTH_ADDRESS
] = 
	`LOBYTE
 (
wTemp
);

513 
ulVUD©aL’gth
 = ()(
IÅutRa¡”
->
¿¡”size
[
COLORTYPE_COLOR
] + 
FAST_RASTER_HEADERSIZE
);

515 
BYTE
 
FrEÁ”FRModeSeq
[] = {0xC2, 0x06, 0x20, 0x70,0x68, 0xF8, 0x91, 0xC2};

516 
”r
 = 
	`S’d
 ((cÚ¡ 
BYTE
 *)
FrEÁ”FRModeSeq
, (FrEnterFRModeSeq));

517 
ERRCHECK
;

518 
»s
[0] = (
BYTE
è(
ulVUD©aL’gth
 & 0xFF);

519 
»s
[1] = (
BYTE
è((
ulVUD©aL’gth
 & 0x0000FF00) >> 8);

520 
»s
[2] = (
BYTE
è((
ulVUD©aL’gth
 & 0x00FF0000) >> 16);

521 
»s
[3] = (
BYTE
è((
ulVUD©aL’gth
 & 0xFF000000) >> 24);

522 
»s
[4] = 0xF8;

523 
»s
[5] = 0x92;

524 
»s
[6] = 0x46;

525 
”r
 = 
	`S’d
 (
»s
, 7);

526 
ERRCHECK
;

529 
”r
 = 
	`S’d
 (
pucH—d”
, 
FAST_RASTER_HEADERSIZE
);

530 
ERRCHECK
;

531 
”r
 = 
	`S’d
 (
IÅutRa¡”
->
¿¡”d©a
[
COLORTYPE_COLOR
],

532 
IÅutRa¡”
->
¿¡”size
[
COLORTYPE_COLOR
]);

533  
”r
;

534 
	}
}

536 
H—d”
* 
	gLJFa¡Ra¡”
::
	$S–eùH—d”
 (
PrštCÚ‹xt
 *
pc
)

538 
phLJFa¡Ra¡”
 = 
Ãw
 
	`H—d”LJFa¡Ra¡”
 (
this
, 
pc
);

539  
phLJFa¡Ra¡”
;

540 
	}
}

542 
DRIVER_ERROR
 
	gLJFa¡Ra¡”
::
	$V”ifyP’Info
()

544 
eP’
 = 
BLACK_PEN
;

545  
NO_ERROR
;

546 
	}
}

548 
DRIVER_ERROR
 
	gLJFa¡Ra¡”
::
	$P¬£P’Info
(
PEN_TYPE
& 
eP’
, 
BOOL
 
Qu”yPrš‹r
)

550 
eP’
 = 
BOTH_PENS
;

552  
NO_ERROR
;

553 
	}
}

555 
Com´essÜ
* 
	gLJFa¡Ra¡”
::
	$C»©eCom´essÜ
 (
Ra¡”Size
)

557 
m_pCom´essÜ
 = 
Ãw
 
	`ModeD–Plus
 (
pSS
, 
this
, 
Ra¡”Size
);

558  
m_pCom´essÜ
;

559 
	}
}

580 
DISPLAY_STATUS
 
	gLJFa¡Ra¡”
::
	$P¬£E¼Ü
(
BYTE
 
¡©us_»g
)

582 
	`DBG1
("LJFastRaster:…arsingƒrror info\n");

584 
DRIVER_ERROR
 
”r
 = 
NO_ERROR
;

585 
BYTE
 
szR—dBuff
[256];

586 
DWORD
 
iR—dCouÁ
 = 256;

587 
DISPLAY_STATUS
 
eStus
 = (DISPLAY_STATUSè
¡©us_»g
;

588 *
tmpSŒ
;

589 
iE¼ÜCode
;

591 ià(!
IOMode
.
bDevID
)

592  
eStus
;

594 
	`mem£t
 (
szR—dBuff
, 0, 256);

595 
”r
 = 
pSS
->
	`FromDeviû
 (
szR—dBuff
, &
iR—dCouÁ
);

596 ià(
”r
 =ğ
NO_ERROR
 && 
iR—dCouÁ
 == 0)

597  
eStus
;

599 ià(
	`¡r¡r
 ((*è
szR—dBuff
, "JOB"))

601 ià(!(
tmpSŒ
 = 
	`¡r¡r
 ((*è
szR—dBuff
, "NAME")))

602  
DISPLAY_PRINTING
;

603 
tmpSŒ
 += 6;

604 *
tmpSŒ
 < '0' || *tmpStr > '9')

605 
tmpSŒ
++;

606 
	`ssÿnf
 (
tmpSŒ
, "%d", &
iE¼ÜCode
);

607 ià(
iE¼ÜCode
 !ğ(è(
this
))

608  
DISPLAY_PRINTING
;

611 ià(
	`¡r¡r
 ((*è
szR—dBuff
, "END"))

613  
DISPLAY_PRINTING_COMPLETE
;

617 ià(
	`¡r¡r
 ((*è
szR—dBuff
, "CANCEL"))

618  
DISPLAY_PRINTING_CANCELED
;

620 ià(!(
tmpSŒ
 = 
	`¡r¡r
 ((*è
szR—dBuff
, "CODE")))

621  
eStus
;

623 
tmpSŒ
 += 4;

624 *
tmpSŒ
 < '0' || *tmpStr > '9')

625 
tmpSŒ
++;

626 
	`ssÿnf
 (
tmpSŒ
, "%d", &
iE¼ÜCode
);

628 ià(
iE¼ÜCode
 < 32000)

629  
DISPLAY_PRINTING
;

631 ià(
iE¼ÜCode
 == 40010 || iErrorCode == 40020)

632  
DISPLAY_NO_PENS
;

634 ià(
iE¼ÜCode
 == 40021)

635  
DISPLAY_TOP_COVER_OPEN
;

637 ià((
iE¼ÜCode
 / 100) == 419)

638  
DISPLAY_OUT_OF_PAPER
;

640 ià((
iE¼ÜCode
 / 1000) == 42 || iErrorCode == 40022)

642 
	`DBG1
("Paper Jammed\n");

643  
DISPLAY_PAPER_JAMMED
;

646 ià(
iE¼ÜCode
 > 40049 && iErrorCode < 41000)

648 
	`DBG1
("IOrap\n");

649  
DISPLAY_ERROR_TRAP
;

652 ià(
iE¼ÜCode
 == 40079)

653  
DISPLAY_OFFLINE
;

655  
DISPLAY_ERROR_TRAP
;

656 
	}
}

680 
	gModeD–Plus
::
ModeD–Plus


682 
Sy¡emS”viûs
* 
pSys
,

683 
Prš‹r
* 
	gpPrš‹r
,

684 
	gPÏÃSize


686 
Com´essÜ
(
pSys
, 
PÏÃSize
, 
TRUE
),

687 
thePrš‹r
(
pPrš‹r
),

688 
pbyIÅutImageBufãr
 (
NULL
),

689 
	$pbyS“dRow
 (
NULL
)

691 ià(
cÚ¡ruùÜ_”rÜ
 !ğ
NO_ERROR
)

696 
šputsize
 = 
PÏÃSize
 / (
MAXCOLORPLANES
 * 
MAXCOLORDEPTH
 * 
MAXCOLORROWS
);

697 
šputsize
 = ((inputsize + 7) / 8) * 8;

700 
com´essBuf
 = (
BYTE
*)
pSS
->
	`AÎocMem
(2 * 
INDY_STRIP_HEIGHT
 * 
šputsize
);

701 ià(
com´essBuf
 =ğ
NULL
)

703 
cÚ¡ruùÜ_”rÜ
 = 
ALLOCMEM_ERROR
;

705 
	`mem£t
 (
com´essBuf
, 0x00, 2 * 
INDY_STRIP_HEIGHT
 * 
šputsize
);

707 
pbyIÅutImageBufãr
 = (
BYTE
*)
pSS
->
	`AÎocMem
(
INDY_STRIP_HEIGHT
 * 
šputsize
);

708 ià(
pbyIÅutImageBufãr
 =ğ
NULL
)

709 
cÚ¡ruùÜ_”rÜ
=
ALLOCMEM_ERROR
;

710 
	`mem£t
(
pbyIÅutImageBufãr
, 0x00, 
INDY_STRIP_HEIGHT
 * 
šputsize
);

712 
pbyS“dRow
 = (
HPUIÁ8
*è
pSS
->
	`AÎocMem
 (
šputsize
 *  (HPUInt8));

713 ià(
pbyS“dRow
 =ğ
NULL
)

715 
cÚ¡ruùÜ_”rÜ
 = 
ALLOCMEM_ERROR
;

717 
	`mem£t
 (
pbyS“dRow
, 0, 
šputsize
 *  (
HPUIÁ8
));

719 
m_lCu¼CDRa¡”Row
 = 0;

722 
m_lPrš‹rRa¡”Row
 = 0;

724 
iRa¡”sR—dy
 = 0;

726 
m_bCom´es£d
 = 
FALSE
;

727 
m_com´es£dsize
 = 0;

728 
m_fR©io
 = 0;

729 
	}
}

753 
	gModeD–Plus
::~
	$ModeD–Plus
 ()

755 ià(
pbyIÅutImageBufãr
)

757 
pSS
->
	`F»eMem
 (
pbyIÅutImageBufãr
);

758 
pbyIÅutImageBufãr
 = 
NULL
;

760 ià(
pbyS“dRow
)

762 
pSS
->
	`F»eMem
 (
pbyS“dRow
);

763 
pbyS“dRow
 = 
NULL
;

766 
	}
}

772 
	#ROW_LIMIT
 7040

	)

783 
	#LITERAL_LIMIT
 511

	)

786 
	#LTEST_W
 
cŞ
 > 0

	)

787 
	#LVAL_W
(
cŞ
è
cur_row
[cŞ-1]

	)

788 
	#LTEST_NW
 
cŞ
 > 0

	)

789 
	#LVAL_NW
(
cŞ
è
£edrow
[cŞ-1]

	)

790 
	#LTEST_WW
 
cŞ
 > 1

	)

791 
	#LVAL_WW
(
cŞ
è
cur_row
[cŞ-2]

	)

792 
	#LTEST_NWW
 
cŞ
 > 1

	)

793 
	#LVAL_NWW
(
cŞ
è
£edrow
[cŞ-2]

	)

794 
	#LTEST_NE
 (
cŞ
+1è< 
row_width


	)

795 
	#LVAL_NE
(
cŞ
è
£edrow
[cŞ+1]

	)

796 
	#LTEST_NEWCOL
 1

	)

797 
	#LVAL_NEWCOL
(
cŞ
è
Ãw_cŞÜ


	)

798 
	#LTEST_CACHE
 1

	)

799 
	#LVAL_CACHE
(
cŞ
è
ÿche


	)

801 
	#LOC1TEST
 
LTEST_NE


	)

802 
	#LOC1VAL
(
cŞ
è
	`LVAL_NE
(cŞ)

	)

803 
	#LOC2TEST
 
LTEST_NW


	)

804 
	#LOC2VAL
(
cŞ
è
	`LVAL_NW
(cŞ)

	)

805 
	#LOC3TEST
 
LTEST_NEWCOL


	)

806 
	#LOC3VAL
(
cŞ
è
	`LVAL_NEWCOL
(cŞ)

	)

809 
	#check
(
cÚd™iÚ
èià(!(cÚd™iÚ)è 0

	)

811 
	#wr™e_comp_by‹
(
v®
) \

812 
	`check
(
ouŒ
 < 
·¡outmem
); \

813 *
ouŒ
++ = (
HPUIÁ8
è
v®
;

	)

815 
	#»ad_by‹
(
v®
) \

816 
	`check
(
šmem
 < 
·¡šmem
); \

817 
v®
 = *
šmem
++;

	)

819 
	#’code_couÁ
(
couÁ
, 
ov”
, 
mem
) \

820 ià(
couÁ
 >ğ
ov”
) \

822 
couÁ
 -ğ
ov”
; \

823 ià(
couÁ
 <ğ(
ušt32_t
) 253) \

825 
	`check
(
mem
 < 
·¡outmem
); \

826 *
mem
++ = (
HPUIÁ8
è
couÁ
; \

828 ià(
couÁ
 <ğ(
ušt32_t
) (254 + 255) ) \

830 
	`check
((
mem
+1è< 
·¡outmem
); \

831 
	`check
Ğ
couÁ
 >= 254 ); \

832 
	`check
Ğ(
couÁ
 - 254) <= 255 ); \

833 *
mem
++ = (
HPUIÁ8
) 0xFE; \

834 *
mem
++ = (
HPUIÁ8
è(
couÁ
 - 254); \

838 
	`check
((
mem
+2è< 
·¡outmem
); \

839 
	`check
Ğ
couÁ
 >= 255 ); \

840 
	`check
Ğ(
couÁ
 - 255) <= 65535 ); \

841 
couÁ
 -= 255; \

842 *
mem
++ = (
HPUIÁ8
) 0xFF; \

843 *
mem
++ = (
HPUIÁ8
è(
couÁ
 >> 8); \

844 *
mem
++ = (
HPUIÁ8
è(
couÁ
 & 0xFF); \

846 }

	)

847 
	#decode_couÁ
(
couÁ
, 
ov”
) \

848 ià(
couÁ
 >ğ
ov”
) \

850 
	`»ad_by‹
(
šv®
); \

851 
couÁ
 +ğ(
ušt32_t
è
šv®
; \

852 ià(
šv®
 =ğ(
HPUIÁ8
) 0xFE) \

854 
	`»ad_by‹
(
šv®
); \

855 
couÁ
 +ğ(
ušt32_t
è
šv®
; \

857 ià(
šv®
 =ğ(
HPUIÁ8
) 0xFF) \

859 
	`»ad_by‹
(
šv®
); \

860 
couÁ
 +ğ(((
ušt32_t
è
šv®
) << 8); \

861 
	`»ad_by‹
(
šv®
); \

862 
couÁ
 +ğ(
ušt32_t
è
šv®
; \

864 }

	)

866 
	#by‹s_fÜ_couÁ
(
couÁ
, 
ov”
) \

867 Ğ(
couÁ
 >ğ255è? 3 : (couÁ >ğ
ov”
è? 1 : 0 )

	)

871 
	#memut_th»sh
 15

	)

873 
HPUIÁ8
* 
	gModeD–Plus
::
	$’code_h—d”
(
HPUIÁ8
* 
ouŒ
, cÚ¡ HPUIÁ8* 
·¡outmem
, 
ušt32_t
 
i¤un
, ušt32_ˆ
loÿtiÚ
, ušt32_ˆ
£edrow_couÁ
, ušt32_ˆ
run_couÁ
, cÚ¡ HPUIÁ8 
Ãw_cŞÜ
)

875 
ušt32_t
 
by‹
;

877 
	`check
 (
loÿtiÚ
 < 4);

878 
	`check
Ğ(
i¤un
 == 0) || (isrun == 1) );

881 
by‹
 = (
i¤un
 << 7è| (
loÿtiÚ
 << 5);

884 ià(
£edrow_couÁ
 > 2)

885 
by‹
 |= (0x03 << 3);

887 
by‹
 |ğ(
£edrow_couÁ
 << 3);

889 ià(
run_couÁ
 > 6)

890 
by‹
 |= 0x07;

892 
by‹
 |ğ
run_couÁ
;

895 
	`wr™e_comp_by‹
(
by‹
);

898 
	`’code_couÁ
Ğ
£edrow_couÁ
, 3, 
ouŒ
 );

901 ià(
loÿtiÚ
 == 0)

903 
	`wr™e_comp_by‹
Ğ
Ãw_cŞÜ
 );

907 
	`’code_couÁ
Ğ
run_couÁ
, 7, 
ouŒ
 );

909  
ouŒ
;

910 
	}
}

915 
BOOL
 
	gModeD–Plus
::
	$Com´ess
 (
HPUIÁ8
 *
outmem
,

916 
ušt32_t
 *
ou’
,

917 cÚ¡ 
HPUIÁ8
 *
šmem
,

918 cÚ¡ 
ušt32_t
 
row_width
,

919 cÚ¡ 
ušt32_t
 
šheight
,

920 
ušt32_t
 
hÜz_ht_di¡
)

922 
HPUIÁ8
 *
ouŒ
 = 
outmem
;

923 
ušt32_t
 
cŞ
;

924 cÚ¡ 
HPUIÁ8
 *
£edrow
;

925 
ušt32_t
 
£edrow_couÁ
 = 0;

926 
ušt32_t
 
loÿtiÚ
 = 0;

927 
HPUIÁ8
 
Ãw_cŞÜ
 = (HPUInt8) 0xFF;

928 cÚ¡ 
HPUIÁ8
 *
cur_row
;

929 
ušt32_t
 
row
;

930 cÚ¡ 
HPUIÁ8
 *
·¡outmem
 = 
outmem
 + *
ou’
;

931 
ušt32_t
 
do_wÜd_cİ›s
;

933 ià(
hÜz_ht_di¡
 > 32)

935  
FALSE
;

937 ià(
hÜz_ht_di¡
 < 1)

939 
hÜz_ht_di¡
 = 1;

942 
£edrow
 = 
pbyS“dRow
;

943 
do_wÜd_cİ›s
 = ((
row_width
 % 4) == 0);

945 
row
 = 0;„ow < 
šheight
;„ow++)

947 
cur_row
 = 
šmem
 + (
row
 * 
row_width
);

949 
cŞ
 = 0;

950 
cŞ
 < 
row_width
)

953 
£edrow_couÁ
 = 0;

954 ià(
do_wÜd_cİ›s
)

957  ((
cŞ
 & 3) != 0) &&

958 (
cŞ
 < 
row_width
) &&

959 (
cur_row
[
cŞ
] =ğ
£edrow
[col]) )

961 
£edrow_couÁ
++;

962 
cŞ
++;

964 iàĞ(
cŞ
 & 3) == 0)

966  ((
cŞ
+3è< 
row_width
) &&

967 *((cÚ¡ 
ušt32_t
*è(
cur_row
 + 
cŞ
)è=ğ*((cÚ¡ ušt32_t*è(
£edrow
 + col)) )

969 
£edrow_couÁ
 += 4;

970 
cŞ
 += 4;

974  (
cŞ
 < 
row_width
è&& (
cur_row
[cŞ] =ğ
£edrow
[col]) )

976 
£edrow_couÁ
++;

977 
cŞ
++;

981 ià(
cŞ
 =ğ
row_width
)

984 
ouŒ
 = 
	`’code_h—d”
(ouŒ, 
·¡outmem
, 1 , 1 , 
£edrow_couÁ
, 0 , (
HPUIÁ8
) 0 );

988 
	`check
(
cŞ
 < 
row_width
);

992 iàĞ(
LOC1TEST
è&& (
cur_row
[
cŞ
] =ğ
	`LOC1VAL
(col)) )

993 
loÿtiÚ
 = 1;

994 iàĞ(
LOC2TEST
è&& (
cur_row
[
cŞ
] =ğ
	`LOC2VAL
(col)) )

995 
loÿtiÚ
 = 2;

996 iàĞ(
LOC3TEST
è&& (
cur_row
[
cŞ
] =ğ
	`LOC3VAL
(col)) )

997 
loÿtiÚ
 = 3;

1000 
loÿtiÚ
 = 0;

1001 
Ãw_cŞÜ
 = 
cur_row
[
cŞ
];

1007 ((
cŞ
+1è< 
row_width
)

1009 ((
cŞ
+1è>ğ
hÜz_ht_di¡
)

1011 (
cur_row
[
cŞ
+1-
hÜz_ht_di¡
] == cur_row[col+1])

1015 
ušt32_t
 
run_couÁ
 = 0;

1016 
cŞ
++;

1017  ((
cŞ
+1è< 
row_width
è&& (
cur_row
[cŞ+1-
hÜz_ht_di¡
] == cur_row[col+1]) )

1019 
run_couÁ
++;

1020 
cŞ
++;

1022 
cŞ
++;

1023 
ouŒ
 = 
	`’code_h—d”
(ouŒ, 
·¡outmem
, 1 , 
loÿtiÚ
, 
£edrow_couÁ
, 
run_couÁ
, 
Ãw_cŞÜ
);

1030 
ušt32_t
 
»¶aûm’t_couÁ
 = 0;

1031 cÚ¡ 
HPUIÁ8
* 
by‹_¬¿y
 = 
cur_row
 + 
cŞ
 + 1;

1032 
ušt32_t
 
i
;

1033 
cŞ
++;

1039  (
cŞ
+1è< 
row_width
 )

1050 (
cur_row
[
cŞ
] =ğ
£edrow
[col])

1055 (
cur_row
[
cŞ
+1] =ğ
£edrow
[col+1])

1060 (
cur_row
[
cŞ
+1] =ğ
	`LVAL_NW
(col+1))

1062 (
cur_row
[
cŞ
+1] =ğ
	`LVAL_NEWCOL
(col+1))

1066 ((
cŞ
+2è< 
row_width
)

1071 ((
cŞ
 + 2è>ğ
hÜz_ht_di¡
) &&

1072 (
cur_row
[
cŞ
+2-
hÜz_ht_di¡
] == cur_row[col+2])

1076 (
cur_row
[
cŞ
+1] =ğ
	`LVAL_NE
(col+1))

1084 (
cur_row
[
cŞ
] !ğ
£edrow
[col])

1086 ((
cŞ
 + 1è>ğ
hÜz_ht_di¡
)

1088 (
cur_row
[
cŞ
+1-
hÜz_ht_di¡
] == cur_row[col+1])

1093 ((
cŞ
+2è< 
row_width
)

1095 ((
cŞ
 + 2è>ğ
hÜz_ht_di¡
)

1097 (
cur_row
[
cŞ
+2-
hÜz_ht_di¡
] == cur_row[col+2])

1101 (
cur_row
[
cŞ
] =ğ
	`LVAL_NE
(col))

1103 (
cur_row
[
cŞ
] =ğ
	`LVAL_NW
(col))

1105 (
cur_row
[
cŞ
] =ğ
	`LVAL_NEWCOL
(col))

1112 ià(
»¶aûm’t_couÁ
 >ğ
LITERAL_LIMIT
)

1116 
»¶aûm’t_couÁ
++;

1117 
cŞ
++;

1121 iàĞ(
cŞ
+1è=ğ
row_width
 ) {

1122 
»¶aûm’t_couÁ
++;

1123 
cŞ
++;

1126 
ouŒ
 = 
	`’code_h—d”
(ouŒ, 
·¡outmem
, 0 , 
loÿtiÚ
, 
£edrow_couÁ
, 
»¶aûm’t_couÁ
, 
Ãw_cŞÜ
);

1138 ià(
»¶aûm’t_couÁ
 > 0)

1141 ià(
»¶aûm’t_couÁ
 > 
memut_th»sh
)

1143 
	`check
Ğ(
ouŒ
 + 
»¶aûm’t_couÁ
è<ğ
·¡outmem
 );

1144 
	`memıy
(
ouŒ
, 
by‹_¬¿y
, (
size_t
è
»¶aûm’t_couÁ
);

1145 
ouŒ
 +ğ
»¶aûm’t_couÁ
;

1149 
i
 = 0; i < 
»¶aûm’t_couÁ
; i++)

1151 
	`wr™e_comp_by‹
Ğ
by‹_¬¿y
[
i
] );

1160 
£edrow
 = 
cur_row
;

1164 
	`check
Ğ
ouŒ
 <ğ
·¡outmem
 );

1165 ià(
ouŒ
 > 
·¡outmem
)

1168 *
ou’
 = 0;

1172 *
ou’
 = (
ušt32_t
è(
ouŒ
 - 
outmem
);

1175 
	}
}

1178 
BOOL
 
	gModeD–Plus
::
Proûss


1180 
RASTERDATA
* 
šput


1183 
DRIVER_ERROR
 
”r
 = 
NO_ERROR
;

1185 ià(
	gšput
==
NULL
 ||

1186 (
šput
->
¿¡”d©a
[
COLORTYPE_COLOR
]==
NULL
 && iÅut->¿¡”d©a[
COLORTYPE_BLACK
]==NULL))

1188  
FALSE
;

1190 ià(
	gšput
->
	g¿¡”d©a
[
COLORTYPE_COLOR
])

1192 ià(
	gm_lCu¼CDRa¡”Row
 < 
	gINDY_STRIP_HEIGHT
 )

1195 
memıy
(
pbyIÅutImageBufãr
 + 
m_lCu¼CDRa¡”Row
 * 
šputsize
, 
šput
->
¿¡”d©a
[
COLORTYPE_COLOR
], iÅut->
¿¡”size
[COLORTYPE_COLOR]);

1196 
	gm_lCu¼CDRa¡”Row
 ++;

1198 ià(
	gm_lCu¼CDRa¡”Row
 =ğ
INDY_STRIP_HEIGHT
 || ((
LJFa¡Ra¡”
*)
thePrš‹r
)->
phLJFa¡Ra¡”
->
IsLa¡Bªd
())

1200 ià(((
LJFa¡Ra¡”
*)
thePrš‹r
)->
m_bS¹PageNÙS’t
)

1202 
”r
 = (((
LJFa¡Ra¡”
*)
thePrš‹r
)->
phLJFa¡Ra¡”
)->
S¹Page
();

1203 ((
	gLJFa¡Ra¡”
*)
	gthePrš‹r
)->
	gm_bS¹PageNÙS’t
 = 
FALSE
;

1204 
	gm_lPrš‹rRa¡”Row
 = 0;

1207 
	gm_com´es£dsize
 = 2 * 
šputsize
 * 
INDY_STRIP_HEIGHT
;

1208 
BOOL
 
	gbR‘
 = 
Com´ess
 (
com´essBuf
,

1209 &
m_com´es£dsize
,

1210 
pbyIÅutImageBufãr
,

1211 
šputsize
,

1212 
m_lCu¼CDRa¡”Row
,

1215 ià(!
	gbR‘
)

1217 
memıy
 (
com´essBuf
, 
pbyIÅutImageBufãr
, 
šputsize
 * 
INDY_STRIP_HEIGHT
);

1218 
	gm_com´es£dsize
 = 
šputsize
 * 
INDY_STRIP_HEIGHT
;

1222 
	gm_bCom´es£d
 = 
TRUE
;

1226 
mem£t
(
pbyIÅutImageBufãr
, 0x00, 
šputsize
 * 
INDY_STRIP_HEIGHT
);

1228 
	gm_lPrš‹rRa¡”Row
 +ğ
m_lCu¼CDRa¡”Row
;

1229 
	gm_lCu¼BlockHeight
 = 
m_lCu¼CDRa¡”Row
;

1230 
	gm_lCu¼CDRa¡”Row
 = 0;

1231 
	giRa¡”sR—dy
 = 1;

1233 ((
	gLJFa¡Ra¡”
*)
	gthePrš‹r
)->
	gphLJFa¡Ra¡”
->
S‘La¡Bªd
(
FALSE
);

1237  
	gFALSE
;

1240  
	gTRUE
;

1243 
BYTE
* 
	gModeD–Plus
::
	$NextOuutRa¡”
(
COLORTYPE
 
cŞÜ
)

1246 ià(
iRa¡”sR—dy
==0)

1247  (
BYTE
*)
NULL
;

1249 ià(
cŞÜ
 =ğ
COLORTYPE_BLACK
)

1251  (
BYTE
*)
NULL
;

1255 
iRa¡”sR—dy
=0;

1256  
com´essBuf
;

1258 
	}
}

1260 
	gModeD–Plus
::
	$G‘OuutWidth
(
COLORTYPE
 
cŞÜ
)

1262 ià(
cŞÜ
 =ğ
COLORTYPE_COLOR
)

1264  
m_com´es£dsize
;

1270 
	}
}

1272 
	gAPDK_END_NAMESPACE


	@prnt/hpijs/ljfastraster.h

32 #iâdeà
APDK_LJFASTRASTER_H


33 
	#APDK_LJFASTRASTER_H


	)

36 
APDK_BEGIN_NAMESPACE


40 şas 
	cLJFa¡Ra¡”
 : 
public
 
Prš‹r


42 
public
:

43 
LJFa¡Ra¡”
 (
Sy¡emS”viûs
* 
pSS
,
numfÚts
=0, 
BOOL
 
´Ùo
=
FALSE
);

44 ~
LJFa¡Ra¡”
 ();

46 
vœtu®
 
H—d”
* 
S–eùH—d”
 (
PrštCÚ‹xt
* 
pc
);

47 
vœtu®
 
DRIVER_ERROR
 
V”ifyP’Info
 ();

48 
vœtu®
 
DRIVER_ERROR
 
P¬£P’Info
 (
PEN_TYPE
& 
eP’
, 
BOOL
 
Qu”yPrš‹r
=
TRUE
);

49 
vœtu®
 
DISPLAY_STATUS
 
P¬£E¼Ü
 (
BYTE
 
¡©us_»g
);

50 
vœtu®
 
DRIVER_ERROR
 
	$Flush
 (
FlushSize
)

52  
NO_ERROR
;

55 
vœtu®
 
BOOL
 
	$G‘M¬gšs
 (
PAPER_SIZE
 
ps
, *
fM¬gšs
)

57 
fM¬gšs
[0] = () 0.1667;

58 
fM¬gšs
[1] = () 0.1667;

59 
fM¬gšs
[2] = () 0.1667;

60 
fM¬gšs
[3] = () 0.1667;

61  
TRUE
;

62 
	}
}

64 
vœtu®
 
BOOL
 
	$U£CMYK
 (
iPrštMode
è{  
FALSE
;
	}
}

65 
vœtu®
 
DRIVER_ERROR
 
EnÿpsuÏ‹
 (cÚ¡ 
RASTERDATA
* 
IÅutRa¡”
, 
BOOL
 
bLa¡PÏÃ
);

66 
vœtu®
 
BOOL
 
	$SuµÜtS•¬©eBÏck
 (
PrštMode
 *
pCu¼’tMode
)

68  
FALSE
;

69 
	}
}

71 
Com´essÜ
* 
C»©eCom´essÜ
 (
Ra¡”Size
);

72 
	gm_iYPos
;

73 
BOOL
 
	gm_bS¹PageNÙS’t
;

75 
H—d”LJFa¡Ra¡”
 *
	gphLJFa¡Ra¡”
;

76 
	g´Ùeùed
:

78 #ifdeà
APDK_HP_UX


79 
vœtu®
 
LJFa¡Ra¡”
 & 
İ”©Ü
 = (
Prš‹r
& 
rhs
)

81  *
this
;

85 
vœtu®
 
DATA_FORMAT
 
	$G‘D©aFÜm©
(è{  
RASTER_STRIP
; 
	}
}

87 
BOOL
 
	gm_bJobS¹ed
;

89 
Com´essÜ
 *
	gm_pCom´essÜ
;

92 şas 
	cLJFa¡Ra¡”NÜm®Mode
 : 
public
 
G¿yMode


94 
public
:

95 
LJFa¡Ra¡”NÜm®Mode
 ();

98 şas 
	cLJFa¡Ra¡”D¿áMode
 : 
public
 
G¿yMode


100 
public
:

101 
LJFa¡Ra¡”D¿áMode
 ();

108 
	~"h±y³s.h
"

110 
	#HIBYTE
(
sV¬
è(
BYTE
è((sV¬ & 0xFF00è>> 8)

	)

111 
	#LOBYTE
(
sV¬
è(
BYTE
è((sV¬ & 0x00FF))

	)

113 şas 
	cModeD–Plus
 : 
public
 
Com´essÜ


115 
ä›nd
 
şass
 
LJFa¡Ra¡”
;

116 
ä›nd
 
şass
 
	mH—d”LJFa¡Ra¡”
;

118 
	mpublic
:

119 
ModeD–Plus
(
Sy¡emS”viûs
* 
pSys
, 
Prš‹r
* 
pPrš‹r
, 
Ra¡”Size
);

120 
	mvœtu®
 ~
ModeD–Plus
();

121 
BOOL
 
Proûss
(
RASTERDATA
* 
šput
);

122 
BYTE
* 
NextOuutRa¡”
(
COLORTYPE
 
cŞÜ
);

123 
G‘OuutWidth
(
COLORTYPE
 
cŞÜ
);

125 
	m´Ùeùed
:

126 
BOOL
 
Com´ess
(
HPUIÁ8
* 
outmem
, 
ušt32_t
* 
ou’
, cÚ¡ HPUIÁ8* 
šmem
, cÚ¡ ušt32_ˆ
row_width
, cÚ¡ ušt32_ˆ
šheight
, ušt32_ˆ
hÜz_ht_di¡
);

127 
	m´iv©e
:

128 
Prš‹r
* 
thePrš‹r
;

130 
HPUIÁ8
* 
’code_h—d”
(HPUIÁ8* 
ouŒ
, cÚ¡ HPUIÁ8* 
·¡outmem
, 
ušt32_t
 
i¤un
, ušt32_ˆ
loÿtiÚ
, ušt32_ˆ
£edrow_couÁ
, ušt32_ˆ
run_couÁ
, cÚ¡ HPUIÁ8 
Ãw_cŞÜ
);

132 *
	mpbyIÅutImageBufãr
;

134 
HPLJBITMAP
 
	mm_De¡B™m­
;;

135 
	mm_lCu¼CDRa¡”Row
;

136 
	mm_lCu¼BlockHeight
;

137 
	mm_lPrš‹rRa¡”Row
;

139 
ušt32_t
 
	mm_com´es£dsize
;

140 
BOOL
 
	mm_bCom´es£d
;

141 
	mm_fR©io
;

142 
HPUIÁ8
 *
	mpbyS“dRow
;

146 #ifdeà
APDK_LJFASTRASTER


150 şas 
	cLJFa¡Ra¡”Proxy
 : 
public
 
Prš‹rProxy


152 
public
:

153 
	$LJFa¡Ra¡”Proxy
 (è: 
	`Prš‹rProxy
(

164 
m_iPrš‹rTy³
 = 
eLJFa¡Ra¡”
;

166 
šlše
 
Prš‹r
* 
	$C»©ePrš‹r
 (
Sy¡emS”viûs
* 
pSS
) const

168  
Ãw
 
	`LJFa¡Ra¡”
(
pSS
);

169 
	}
}

170 
šlše
 
PRINTER_TYPE
 
	$G‘Prš‹rTy³
 () const

172  
eLJFa¡Ra¡”
;

173 
	}
}

174 
šlše
 
	$G‘Mod–B™
 () const

177 
	}
}

181 
	gAPDK_END_NAMESPACE


	@prnt/hpijs/ljjetready.cpp

32 #ifdeà
APDK_LJJETREADY


41 
	~"h—d”.h
"

42 
	~"io_defs.h
"

43 
	~"ljj‘»ady.h
"

44 
	~"´š‹½roxy.h
"

45 
	~"»sourûs.h
"

47 #ifdeà
HAVE_LIBDL


48 
	~<dlfú.h
>

53 (*
HPLJJRCom´ess
è(
BYTE
 *
pbOutBufãr
,

54 
ušt32_t
 *
ou’
,

55 
BYTE
 *
šmem
,

56 cÚ¡ 
ušt32_t
 
iLogiÿlImageWidth
,

57 cÚ¡ 
ušt32_t
 
iLogiÿlImageHeight
);

60 
APDK_BEGIN_NAMESPACE


62 #ifdeà
HAVE_LIBDL


63 *
LßdPlugš
 (cÚ¡ *
szPlugšName
);

66 
MedŸSize
 
P­”ToMedŸSize
(
PAPER_SIZE
 
psize
);

68 
	#MOJAVE_STRIP_HEIGHT
 128

69 

	)

70 
	#MOJAVE_RESOLUTION
 600

71 

	)

72 
BYTE
 
	gJrBegšSessiÚSeq
[] = {0xC0, 0x00, 0xF8, 0x86, 0xC0, 0x03, 0xF8, 0x8F, 0xD1, 0x58,

74 
BYTE
 
	gJrF“dOr›Á©iÚSeq
[] = {0xC0, 0x00 , 0xF8, 0x28 };

76 
BYTE
 
	gJrP­”SizeSeq
[] = {0xC0, 0x00 ,0xF8, 0x25};

78 
BYTE
 
	gJrMedSourûSeq
[] = {0xC0, 0x00 ,0xF8, 0x26 };

80 
BYTE
 
	gJrMedDe¡š©iÚSeq
[] = {0xC0, 0x00 ,0xF8 , 0x24 };

82 
BYTE
 
	gJrBegšPageSeq
[] = {0x43, 0xD3, 0x64, 0x00, 0x64, 0x00, 0xF8, 0x2A, 0x75, 0xD3,

84 
BYTE
 
	gJrBegšImageSeq
[] = {0xC2, 0x00, 0x40, 0x70, 0x68, 0xF8, 0x91, 0xC1};

86 
BYTE
 
	gJrVU_v”_TagSeq
[] = {0xC2, 0x00, 0x00, 0x04, 0x00 , 0xF8, 0x95 };

88 
BYTE
 
	gJrD©aL’gthSeq
[] = {0xC2, 0x86, 0x0A, 0x00, 0x00, 0xF8, 0x92 };

90 
BYTE
 
	gJrV’UniqSeq
[] = {0x46};

91 
BYTE
 
	gJrVUExŠ_3Seq
[] = {0xC2, 0x02, 0x40, 0x70, 0x68 ,0xF8, 0x91 };

93 
BYTE
 
	gJrEndPageSeq
[] = {0x44};

94 
BYTE
 
	gJrEndSessiÚSeq
[] = {0x42};

98 cÚ¡ 
	gcıPJLS¹Job
[] = {
ESC
, '%', '-','1','2','3','4','5','X' };;

99 cÚ¡ 
	gcıPJLEx™Seq
[] = {
ESC
, '%', '-','1','2','3','4','5','X', '@','P','J','L',' ','E','O','J', 
LF
, ESC,'%', '-','1','2','3','4','5','X'};

100 cÚ¡ 
	gcıPJLS‘Res
[] = {'@','P','J','L',' ','S','E','T',' ','R','E','S','O','L','U','T','I','O','N','=','6','0','0', 
LF
};

101 cÚ¡ 
	gcıPJLUTF8
[] = {'@','P','J','L',' ','S','E','T',' ','S','T','R','I','N','G','C','O','D','E','S','E','T','=','U','T','F','8', 
LF
};

102 cÚ¡ 
	gcıPJLS‘PÏÃs
[] = {'@','P','J','L',' ','S','E','T',' ','P','L','A','N','E','S','I','N','U','S','E','=','1',
LF
};

103 cÚ¡ 
	gcıPCLEÁ”XL
[] = {'@','P','J','L',' ','E','N','T','E','R',' ','L','A','N','G','U','A','G','E','=','P','C','L','X','L', 
LF
};

104 cÚ¡ 
	gcıPJLS‘TO
[] = {'@','P','J','L',' ','S','E','T',' ','T','I','M','E','O','U','T','=','9','0', 
LF
};

105 cÚ¡ 
	gcıPJLS‘CİyCouÁ
[] = {'@','P','J','L',' ','S','E','T',' ','C','O','P','I','E','S','=','1',
LF
};

106 cÚ¡ 
	gcıUEL
[] = {
ESC
, '%', '-','1','2','3','4','5','X' };

107 cÚ¡ 
	gcıPJLComm’t
[] = {')',' ','H','P','-','P','C','L',' ','X','L',';','3',';','0',';','C','o','m','m','e','n','t',',',' ','P','C','L','-','X','L',' ','J','e','t','R','e','a','d','y',' ','g','e','n','e','r','a','t','o','r', 
LF
};

111 
	gLJJ‘R—dy
::
	$LJJ‘R—dy
 (
Sy¡emS”viûs
* 
pSS
, 
numfÚts
, 
BOOL
 
´Ùo
)

112 : 
	$Prš‹r
(
pSS
, 
numfÚts
, 
´Ùo
)

115 ià((!
´Ùo
è&& (
IOMode
.
bDevID
))

117 
cÚ¡ruùÜ_”rÜ
 = 
	`V”ifyP’Info
();

118 
CERRCHECK
;

120 
eP’
 = 
BOTH_PENS
;

122 
pMode
[
GRAYMODE_INDEX
] = 
Ãw
 
	`LJJ‘R—dyG¿yMode
 ();

123 
pMode
[
DEFAULTMODE_INDEX
] = 
Ãw
 
	`LJJ‘R—dyNÜm®Mode
 ();

124 
ModeCouÁ
 = 2;

127 
CMYM­
 = 
NULL
;

128 
m_bJobS¹ed
 = 
FALSE
;

129 #ifdeà 
APDK_AUTODUPLEX


130 
m_bRÙ©eBackPage
 = 
FALSE
;

132 
m_pCom´essÜ
 = 
NULL
;

133 
m_iYPos
 = 0;

135 
m_bS¹PageNÙS’t
 = 
TRUE
;

137 
HPLJJRCom´ess
 = 
NULL
;

139 #ifdeà
HAVE_LIBDL


140 
m_hHPLibHªdË
 = 
	`LßdPlugš
 ("lj.so");

141 ià(
m_hHPLibHªdË
)

143 
	`dË¼Ü
 ();

144 *(**è(&
HPLJJRCom´ess
èğ
	`dlsym
 (
m_hHPLibHªdË
, "HPJetReadyCompress");

146 ià(
HPLJJRCom´ess
)

148 
pMode
[
ModeCouÁ
] = 
Ãw
 
	`LJJ‘R—dyBe¡CŞÜMode
 ();

149 
ModeCouÁ
++;

150 
pMode
[
ModeCouÁ
] = 
Ãw
 
	`LJJ‘R—dyBe¡G¿yMode
 ();

151 
ModeCouÁ
++;

154 
m_eCom´essMode
 = 
COMPRESS_MODE_JPEG
;

156 
	`DBG1
("LJJetReady created\n");

157 
	}
}

159 
	gLJJ‘R—dy
::~
	$LJJ‘R—dy
 ()

161 
DISPLAY_STATUS
 
eDi¥Stus
;

163 #ifdeà
HAVE_LIBDL


164 ià(
m_hHPLibHªdË
)

166 
	`dlşo£
 (
m_hHPLibHªdË
);

170 ià(
IOMode
.
bStus
 && 
m_bJobS¹ed
)

172 
i
 = 0; i < 5; i++)

174 
pSS
->
	`BusyWa™
 (2000);

175 
eDi¥Stus
 = 
	`P¬£E¼Ü
 (0);

176 ià(
eDi¥Stus
 =ğ
DISPLAY_PRINTING_COMPLETE
)

178 
pSS
->
	`Di¥ÏyPrš‹rStus
 (
eDi¥Stus
);

183 
	}
}

185 
	gLJJ‘R—dyNÜm®Mode
::
	$LJJ‘R—dyNÜm®Mode
 ()

186 : 
	$PrštMode
 (
NULL
)

188 
ResŞutiÚX
[0] = 600;

189 
ResŞutiÚY
[0] = 600;

190 
Ba£ResX
 = 
Ba£ResY
 = 600;

192 
bFÚtC­abË
 = 
FALSE
;

194 #ià
	`defšed
(
APDK_VIP_COLORFILTERING
)

195 
CÚfig
.
bEº›
 = 
FALSE
;

197 
CÚfig
.
bCŞÜImage
 = 
FALSE
;

198 
theQu®™y
 = 
qu®™yNÜm®
;

200 
pmQu®™y
 = 
QUALITY_NORMAL
;

201 
CÚfig
.
bCŞÜImage
 = 
FALSE
;

202 #ifdeà
APDK_AUTODUPLEX


203 
bDu¶exC­abË
 = 
TRUE
;

205 
	}
}

207 
	gLJJ‘R—dyBe¡CŞÜMode
::
	$LJJ‘R—dyBe¡CŞÜMode
 (è: 
	$PrštMode
 (
NULL
)

209 
ResŞutiÚX
[0] =

210 
ResŞutiÚY
[0] =

211 
Ba£ResX
 =

212 
Ba£ResY
 = 600;

214 
bFÚtC­abË
 = 
FALSE
;

216 #ià
	`defšed
(
APDK_VIP_COLORFILTERING
)

217 
CÚfig
.
bEº›
 = 
FALSE
;

220 
CÚfig
.
bCŞÜImage
 = 
FALSE
;

221 
theQu®™y
 = 
qu®™yP»£Á©iÚ
;

222 
pmQu®™y
 = 
QUALITY_BEST
;

223 #ifdeà
APDK_AUTODUPLEX


224 
bDu¶exC­abË
 = 
TRUE
;

226 
	}
}

228 
	gLJJ‘R—dyG¿yMode
::
	$LJJ‘R—dyG¿yMode
 (è: 
	$PrštMode
 (
NULL
)

230 
ResŞutiÚX
[0] =

231 
ResŞutiÚY
[0] =

232 
Ba£ResX
 =

233 
Ba£ResY
 = 600;

235 
bFÚtC­abË
 = 
FALSE
;

237 #ià
	`defšed
(
APDK_VIP_COLORFILTERING
)

238 
CÚfig
.
bEº›
 = 
FALSE
;

241 
CÚfig
.
bCŞÜImage
 = 
FALSE
;

242 
pmCŞÜ
 = 
GREY_K
;

243 #ifdeà
APDK_AUTODUPLEX


244 
bDu¶exC­abË
 = 
TRUE
;

246 
	}
}

248 
	gLJJ‘R—dyBe¡G¿yMode
::
	$LJJ‘R—dyBe¡G¿yMode
 (è: 
	$PrštMode
 (
NULL
)

250 
ResŞutiÚX
[0] =

251 
ResŞutiÚY
[0] =

252 
Ba£ResX
 =

253 
Ba£ResY
 = 600;

255 
bFÚtC­abË
 = 
FALSE
;

257 #ià
	`defšed
(
APDK_VIP_COLORFILTERING
)

258 
CÚfig
.
bEº›
 = 
FALSE
;

261 
CÚfig
.
bCŞÜImage
 = 
FALSE
;

262 
pmCŞÜ
 = 
GREY_K
;

263 
pmQu®™y
 = 
QUALITY_BEST
;

264 
theQu®™y
 = 
qu®™yP»£Á©iÚ
;

265 #ifdeà
APDK_AUTODUPLEX


266 
bDu¶exC­abË
 = 
TRUE
;

268 
	}
}

270 
	gH—d”LJJ‘R—dy
::
	$H—d”LJJ‘R—dy
 (
Prš‹r
* 
p
, 
PrštCÚ‹xt
* 
pc
)

271 : 
	$H—d”
(
p
,
pc
)

273 
	`S‘La¡Bªd
(
FALSE
);

274 
	}
}

276 
DRIVER_ERROR
 
	gH—d”LJJ‘R—dy
::
	$S’d
 ()

278 
	`S¹S’d
 ();

280  
NO_ERROR
;

281 
	}
}

283 
DRIVER_ERROR
 
	gH—d”LJJ‘R—dy
::
	$S¹S’d
 ()

285 
DRIVER_ERROR
 
”r
;

286 
szSü©chSŒ
[64];

288 
”r
 = 
thePrš‹r
->
	`S’d
 ((cÚ¡ 
BYTE
*)
cıPJLS¹Job
, (ccpPJLStartJob));

289 
ERRCHECK
;

292 
”r
 = 
thePrš‹r
->
	`S’d
 ((cÚ¡ 
BYTE
*)
cıPJLUTF8
, (ccpPJLUTF8));

293 
ERRCHECK
;

296 
COLORMODE
 
eC
 = 
COLOR
;

297 
MEDIATYPE
 
eM
;

298 
QUALITY_MODE
 
eQ
;

299 
BOOL
 
bD
;

301 ((
LJJ‘R—dy
 *)
thePrš‹r
)->
bG»y_K
 = 
FALSE
;

302 ià((
thePrštCÚ‹xt
->
	`G‘PrštModeS‘tšgs
 (
eQ
, 
eM
, 
eC
, 
bD
)è=ğ
NO_ERROR
 &&

303 
eC
 =ğ
GREY_K
)

305 ((
LJJ‘R—dy
 *)
thePrš‹r
)->
bG»y_K
 = 
TRUE
;

306 
”r
 = 
thePrš‹r
->
	`S’d
 ((cÚ¡ 
BYTE
*)
cıPJLS‘PÏÃs
,(ccpPJLSetPlanes));

307 
ERRCHECK
;

312 
	`¥rštf
 (
szSü©chSŒ
, "@PJL SET COPIES=%d\015\012", 
thePrštCÚ‹xt
->
	`G‘CİyCouÁ
 ());

313 
”r
 = 
thePrš‹r
->
	`S’d
 ((cÚ¡ 
BYTE
 *è
szSü©chSŒ
, 
	`¡¾’
 (szScratchStr));

314 
ERRCHECK
;

317 
	`¡rıy
 (
szSü©chSŒ
, "@PJL SET DUPLEX=OFF\015\012");

318 #ifdeà
APDK_AUTODUPLEX


319 
DUPLEXMODE
 
dupmode
 = 
thePrštCÚ‹xt
->
	`Qu”yDu¶exMode
 ();

320 ià(
dupmode
 !ğ
DUPLEXMODE_NONE
)

322 
	`¡rıy
 (
szSü©chSŒ
, "@PJL SET DUPLEX=ON\015\012@PJL SET BINDING=");

323 ià(
dupmode
 =ğ
DUPLEXMODE_BOOK
)

324 
	`¡rÿt
 (
szSü©chSŒ
, "LONGEDGE\015\012");

326 
	`¡rÿt
 (
szSü©chSŒ
, "SHORTEDGE\015\012");

329 
”r
 = 
thePrš‹r
->
	`S’d
 ((cÚ¡ 
BYTE
 *è
szSü©chSŒ
, 
	`¡¾’
 (szScratchStr));

330 
ERRCHECK
;

333 
”r
 = 
thePrš‹r
->
	`S’d
 ((cÚ¡ 
BYTE
*)
cıPJLS‘Res
,(ccpPJLSetRes));

334 
ERRCHECK
;

337 
”r
 = 
thePrš‹r
->
	`S’d
 ((cÚ¡ 
BYTE
*)
cıPJLS‘TO
,(ccpPJLSetTO));

338 
ERRCHECK
;

341 
”r
 = 
thePrš‹r
->
	`S’d
 ((cÚ¡ 
BYTE
*)
cıPCLEÁ”XL
,(ccpPCLEnterXL));

342 
ERRCHECK
;

345 
”r
 = 
thePrš‹r
->
	`S’d
 ((cÚ¡ 
BYTE
*)
cıPJLComm’t
,(ccpPJLComment));

346 
ERRCHECK
;

348 
”r
 = 
thePrš‹r
->
	`S’d
 ((cÚ¡ 
BYTE
*)
JrBegšSessiÚSeq
,(JrBeginSessionSeq));

349 
ERRCHECK
;

351  
”r
;

352 
	}
}

354 
	gH—d”LJJ‘R—dy
::
	$JRP­”ToMedŸSize
(
PAPER_SIZE
 
psize
)

356 
psize
)

358 
LETTER
:  0;

359 
LEGAL
:  1;

360 
A4
:  2;

361 
B4
:  10;

362 
B5
:  11;

363 
OUFUKU
:  14;

364 
HAGAKI
:  14;

365 
A6
:  17;

366 #ifdeà
APDK_EXTENDED_MEDIASIZE


367 
A3
:  5;

368 
A5
:  16;

369 
LEDGER
:  4;

370 
EXECUTIVE
:  3;

371 
CUSTOM_SIZE
:  96;

372 
ENVELOPE_NO_10
:  6;

373 
ENVELOPE_A2
:  6;

374 
ENVELOPE_C6
:  8;

375 
ENVELOPE_DL
:  9;

379 
	}
}

381 
DRIVER_ERROR
 
	gH—d”LJJ‘R—dy
::
	$S¹Page
 ()

383 
DRIVER_ERROR
 
”r
;

384 
BYTE
 
szCu¡omSize
[64];

395 
”r
 = 
thePrš‹r
->
	`S’d
 ((cÚ¡ 
BYTE
*)
JrF“dOr›Á©iÚSeq
,(JrFeedOrientationSeq));

396 
ERRCHECK
;

399 
PAPER_SIZE
 
ps
 = 
thePrštCÚ‹xt
->
	`G‘P­”Size
 ();

400 
msizeCode
;

401 
msizeCode
 = 
	`JRP­”ToMedŸSize
(
ps
);

403 
JrP­”SizeSeq
[1] = (
BYTE
è
msizeCode
;

404 #ifdeà
APDK_EXTENDED_MEDIASIZE


405 if(
msizeCode
 == 96)

407 
BYTE
 
szSü©chSŒ
[] = {"\xF8\x2F\xC0\x00\xF8\x30"};

410 
fV®ue
;

411 
ušt32_t
 
uiV®ue
;

412 } 
LJJRUniÚ
;

413 
ušt32_t
 
uiXsize
;

414 
ušt32_t
 
uiYsize
;

415 
k
 = 0;

416 
LJJRUniÚ
.
fV®ue
 = (è
thePrštCÚ‹xt
->
	`PhysiÿlPageSizeX
 ();

417 
uiXsize
 = 
LJJRUniÚ
.
uiV®ue
;

418 
LJJRUniÚ
.
fV®ue
 = (è
thePrštCÚ‹xt
->
	`PhysiÿlPageSizeY
 ();

419 
uiYsize
 = 
LJJRUniÚ
.
uiV®ue
;

420 
szCu¡omSize
[
k
++] = 0xD5;

421 
szCu¡omSize
[
k
++] = (
BYTE
è(
uiXsize
 & 0x000000FF);

422 
szCu¡omSize
[
k
++] = (
BYTE
è((
uiXsize
 & 0x0000FF00) >> 8);

423 
szCu¡omSize
[
k
++] = (
BYTE
è((
uiXsize
 & 0x00FF0000) >> 16);

424 
szCu¡omSize
[
k
++] = (
BYTE
è((
uiXsize
 & 0xFF000000) >> 24);

425 
szCu¡omSize
[
k
++] = (
BYTE
è(
uiYsize
 & 0x000000FF);

426 
szCu¡omSize
[
k
++] = (
BYTE
è((
uiYsize
 & 0x0000FF00) >> 8);

427 
szCu¡omSize
[
k
++] = (
BYTE
è((
uiYsize
 & 0x00FF0000) >> 16);

428 
szCu¡omSize
[
k
++] = (
BYTE
è((
uiYsize
 & 0xFF000000) >> 24);

429 
”r
 = 
thePrš‹r
->
	`S’d
 ((cÚ¡ 
BYTE
 *è
szCu¡omSize
, 
k
);

431 
”r
 = 
thePrš‹r
->
	`S’d
 (
szSü©chSŒ
,  (szScratchStr));

432 
ERRCHECK
;

437 
”r
 = 
thePrš‹r
->
	`S’d
 ((cÚ¡ 
BYTE
*)
JrP­”SizeSeq
,(JrPaperSizeSeq));

438 
ERRCHECK
;

442 
COLORMODE
 
eC
 = 
COLOR
;

443 
MEDIATYPE
 
eM
;

444 
QUALITY_MODE
 
eQ
;

445 
BOOL
 
bD
;

447 
thePrštCÚ‹xt
->
	`G‘PrštModeS‘tšgs
 (
eQ
, 
eM
, 
eC
, 
bD
);

457 
BYTE
 
szPršbËA»a
[] = {"\xD1\x00\x00\x00\x00\xF8\x74"};

458 
iWidth
 = (è
thePrštCÚ‹xt
->
	`IÅutPix–sP”Row
 ();

459 
iPageHeight
;

467 ià(
eC
 =ğ
GREY_K
)

469 
iWidth
 = (è(
thePrštCÚ‹xt
->
	`PršbËWidth
 () *

470 
thePrštCÚ‹xt
->
	`EfãùiveResŞutiÚX
 ());

477 ià(
iWidth
 < 1600)

479 
iWidth
 = 1600;

487 
iWidth
 = ((iWidth + 31) / 32) * 32;

489 
iPageHeight
 = (è(
thePrštCÚ‹xt
->
	`PršbËHeight
 () *

490 
thePrštCÚ‹xt
->
	`EfãùiveResŞutiÚY
 ());

491 
iPageHeight
 = ((iPageHeighˆ+ (
MOJAVE_STRIP_HEIGHT
 - 1)) / MOJAVE_STRIP_HEIGHT) * MOJAVE_STRIP_HEIGHT;

493 
szPršbËA»a
[1] = 
iWidth
 & 0xFF;

494 
szPršbËA»a
[2] = (
iWidth
 >> 8) & 0xFF;

495 
szPršbËA»a
[3] = 
iPageHeight
 & 0xFF;

496 
szPršbËA»a
[4] = (
iPageHeight
 >> 8) & 0xFF;

497 
”r
 = 
thePrš‹r
->
	`S’d
 (
szPršbËA»a
, 7);

498 
ERRCHECK
;

502 
”r
 = 
thePrš‹r
->
	`S’d
 ((cÚ¡ 
BYTE
 *)
JrBegšPageSeq
, (JrBeginPageSeq));

503 
ERRCHECK
;

508 ià(
eC
 =ğ
GREY_K
 )

511 
”r
 = 
thePrš‹r
->
	`S’d
 ((cÚ¡ 
BYTE
 *) "\xC0\x07\xF8\x03\x6A", 5);

512 
ERRCHECK
;

517 
”r
 = 
thePrš‹r
->
	`S’d
 ((cÚ¡ 
BYTE
 *) "\xC0\x06\xF8\x03\x6A", 5);

518 
ERRCHECK
;

521 
bLa¡Bªd
 = 
FALSE
;

523  
”r
;

524 
	}
}

526 
DRIVER_ERROR
 
	gH—d”LJJ‘R—dy
::
	$EndPage
 ()

528 
DRIVER_ERROR
 
”r
;

530 
”r
 = 
thePrš‹r
->
	`S’d
 ((cÚ¡ 
BYTE
*)
JrVUExŠ_3Seq
,(JrVUExtn_3Seq));

531 
ERRCHECK
;

532 
”r
 = 
thePrš‹r
->
	`S’d
 ((cÚ¡ 
BYTE
*)
JrVU_v”_TagSeq
,(JrVU_ver_TagSeq));

533 
ERRCHECK
;

534 
”r
 = 
thePrš‹r
->
	`S’d
 ((cÚ¡ 
BYTE
*)
JrV’UniqSeq
,(JrVenUniqSeq));

535 
ERRCHECK
;

536 
”r
 = 
thePrš‹r
->
	`S’d
 ((cÚ¡ 
BYTE
*)
JrEndPageSeq
,(JrEndPageSeq));

537 
ERRCHECK
;

539  
”r
;

540 
	}
}

558 
DRIVER_ERROR
 
	gH—d”LJJ‘R—dy
::
	$M­PCLMedŸTy³ToSŒšg
 (
MEDIATYPE
 
eM
)

560 
DRIVER_ERROR
 
”r
;

561 
BYTE
 
szPÏš
[] = {"\xC8\xC1\x05\x00Plain\xF8\x27"};

562 
BYTE
 
szPhÙo
[] = {"\xC8\xC1\x05\x00Gloss\xF8\x27"};

564 
eM
)

566 (
MEDIA_PLAIN
):

567 
”r
 = 
thePrš‹r
->
	`S’d
 (
szPÏš
,  (szPlain));

568 
ERRCHECK
;

571 (
MEDIA_PHOTO
):

572 
”r
 = 
thePrš‹r
->
	`S’d
 (
szPhÙo
,  (szPhoto));

573 
ERRCHECK
;

577 
	`as£¹
 (0);

578 
”r
 = 
SYSTEM_ERROR
;

582  
”r
;

583 
	}
}

585 
DRIVER_ERROR
 
	gH—d”LJJ‘R—dy
::
	$EndJob
 ()

587 
DRIVER_ERROR
 
”r
 = 
NO_ERROR
;

589 
”r
 = 
thePrš‹r
->
	`S’d
((cÚ¡ 
BYTE
*)
JrEndSessiÚSeq
, (JrEndSessionSeq));

590 
ERRCHECK
;

592 
”r
 = 
thePrš‹r
->
	`S’d
((cÚ¡ 
BYTE
*)
cıPJLEx™Seq
, (ccpPJLExitSeq));

593 
ERRCHECK
;

595  
”r
;

596 
	}
}

598 
DRIVER_ERROR
 
	gH—d”LJJ‘R—dy
::
	$FÜmF“d
 ()

600 
DRIVER_ERROR
 
”r
 = 
NO_ERROR
;

601 
ModeJPEG
 *
pCom´essÜ
;

602 
LJJ‘R—dy
 *
thisPrš‹r
 = (LJJ‘R—dy *è
thePrš‹r
;

603 
iPageHeight
;

605 
iPageHeight
 = (è(
thePrštCÚ‹xt
->
	`PršbËHeight
 () *

606 
thePrštCÚ‹xt
->
	`EfãùiveResŞutiÚY
 ());

607 
iPageHeight
 = ((iPageHeighˆ+ 
MOJAVE_STRIP_HEIGHT
 - 1) / MOJAVE_STRIP_HEIGHT) * MOJAVE_STRIP_HEIGHT;

615 
pCom´essÜ
 = (
ModeJPEG
 *è
thisPrš‹r
->
	`G‘Com´essÜ
 ();

616 
”r
 = 
pCom´essÜ
->
	`S’dWh™eSŒs
 (
iPageHeight
, 
thisPrš‹r
->
bG»y_K
);

619 
bLa¡Bªd
 = 
TRUE
;

621 
”r
 = 
	`EndPage
 ();

623 
thisPrš‹r
->
m_bS¹PageNÙS’t
 = 
TRUE
;

624  
”r
;

625 
	}
}

627 
DRIVER_ERROR
 
	gH—d”LJJ‘R—dy
::
	$S’dCAPy
 (
iAbsY
)

629  
NO_ERROR
;

630 
	}
}

632 
DRIVER_ERROR
 
	gLJJ‘R—dy
::
	$EnÿpsuÏ‹
 (cÚ¡ 
RASTERDATA
* 
IÅutRa¡”
, 
BOOL
 
bLa¡PÏÃ
)

634 
BYTE
 
»s
[64];

635 
BYTE
 *
pD©aPŒ
 = 
NULL
;

636 
DRIVER_ERROR
 
”r
;

647 
wCoÜdš©e
;

649 
ulVUD©aL’gth
 = 0;

653 
iJ³gH—d”Size
 = 623;

654 #ifdeà
HAVE_LIBDL


655 ià(
HPLJJRCom´ess
 && 
m_eCom´essMode
 =ğ
COMPRESS_MODE_LJ
)

657 
iJ³gH—d”Size
 = 0;

661 ià(
bG»y_K
)

663 
ulVUD©aL’gth
 = 
IÅutRa¡”
->
¿¡”size
[
COLORTYPE_COLOR
];

664 
pD©aPŒ
 = (
BYTE
 *è
IÅutRa¡”
->
¿¡”d©a
[
COLORTYPE_COLOR
];

668 
ulVUD©aL’gth
 = 
IÅutRa¡”
->
¿¡”size
[
COLORTYPE_COLOR
] - 
iJ³gH—d”Size
;

669 
pD©aPŒ
 = (
BYTE
 *è
IÅutRa¡”
->
¿¡”d©a
[
COLORTYPE_COLOR
] + 
iJ³gH—d”Size
;

674 
BYTE
 
JrR—dImageSeq
[] = {0xC2, 0x01, 0x40, 0x70,0x68, 0xF8, 0x91, 0xC1};

675 
”r
 = 
	`S’d
 ((cÚ¡ 
BYTE
 *)
JrR—dImageSeq
, (JrReadImageSeq));

676 
ERRCHECK
;

678 
ModeJPEG
 *
pCom´essÜ
 = 
NULL
;

679 
pCom´essÜ
 = (
ModeJPEG
*)
	`G‘Com´essÜ
();

681 
wCoÜdš©e
 = ()
pCom´essÜ
->
	`G‘CoÜdš©es
() - 128;

683 
»s
[0] = 
wCoÜdš©e
 & 0xFF;

684 
»s
[1] = ((
wCoÜdš©e
 & 0xFF00) >> 8);

685 
”r
 = 
	`S’d
 ((cÚ¡ 
BYTE
 *è
»s
, 2);

686 
ERRCHECK
;

688 
BYTE
 
JrSŒHeight
[] = {0xF8,0x6D,0xC1,0x80,0x00,0xF8,0x63};

689 
”r
 = 
	`S’d
 ((cÚ¡ 
BYTE
 *)
JrSŒHeight
, (JrStripHeight));

690 
ERRCHECK
;

692 
BYTE
 
JrTextObjeùTy³Seq
[] = {0xC0,0x00, 0xF8, 0x96};

693 
”r
 = 
	`S’d
 ((cÚ¡ 
BYTE
 *)
JrTextObjeùTy³Seq
, (JrTextObjectTypeSeq));

694 
ERRCHECK
;

696 
”r
 = 
	`S’d
 ((cÚ¡ 
BYTE
 *)
JrVU_v”_TagSeq
, (JrVU_ver_TagSeq));

697 
ERRCHECK
;

699 
”r
 = 
	`S’d
 ((cÚ¡ 
BYTE
 *) "\xC2", 1);

700 
ERRCHECK
;

702 
ulVUD©aL’gth
 += 6;

703 
»s
[0] = (
BYTE
è(
ulVUD©aL’gth
 & 0xFF);

704 
»s
[1] = (
BYTE
è((
ulVUD©aL’gth
 & 0x0000FF00) >> 8);

705 
»s
[2] = (
BYTE
è((
ulVUD©aL’gth
 & 0x00FF0000) >> 16);

706 
»s
[3] = (
BYTE
è((
ulVUD©aL’gth
 & 0xFF000000) >> 24);

707 
»s
[4] = 0xF8;

708 
»s
[5] = 0x92;

709 
»s
[6] = 0x46;

710 
»s
[7] = 0x21;

711 #ifdeà
HAVE_LIBDL


712 ià(
HPLJJRCom´ess
 && 
m_eCom´essMode
 =ğ
COMPRESS_MODE_LJ
)

714 
»s
[7] = 0x11;

717 
»s
[8] = 0x90;

719 
ulVUD©aL’gth
 -= 6;

720 
»s
[9] = (
BYTE
è(
ulVUD©aL’gth
 & 0xFF);

721 
»s
[10] = (
BYTE
è((
ulVUD©aL’gth
 & 0x0000FF00) >> 8);

722 
»s
[11] = (
BYTE
è((
ulVUD©aL’gth
 & 0x00FF0000) >> 16);

723 
»s
[12] = (
BYTE
è((
ulVUD©aL’gth
 & 0xFF000000) >> 24);

725 
”r
 = 
	`S’d
 (
»s
, 13);

726 
ERRCHECK
;

728 
”r
 = 
	`S’d
 (
pD©aPŒ
, 
ulVUD©aL’gth
);

729 
ERRCHECK
;

731  
”r
;

732 
	}
}

734 
H—d”
* 
	gLJJ‘R—dy
::
	$S–eùH—d”
 (
PrštCÚ‹xt
 *
pc
)

743 
COLORMODE
 
eC
 = 
COLOR
;

744 
MEDIATYPE
 
eM
;

745 
QUALITY_MODE
 
eQ
;

746 
BOOL
 
bD
;

748 
thePrštCÚ‹xt
 = 
pc
;

749 
phLJJ‘R—dy
 = 
Ãw
 
	`H—d”LJJ‘R—dy
 (
this
, 
pc
);

750 
pc
->
	`G‘PrštModeS‘tšgs
 (
eQ
, 
eM
, 
eC
, 
bD
);

751 ià(
eQ
 =ğ
QUALITY_BEST
)

753 
m_eCom´essMode
 = 
COMPRESS_MODE_LJ
;

756 #ifdeà
HAVE_LIBDL


757 ià(
HPLJJRCom´ess
 && 
m_eCom´essMode
 !ğ
COMPRESS_MODE_LJ
)

759 
	`dlşo£
 (
m_hHPLibHªdË
);

760 
m_hHPLibHªdË
 = 
NULL
;

761 
HPLJJRCom´ess
 = 
NULL
;

764  
phLJJ‘R—dy
;

765 
	}
}

767 
DRIVER_ERROR
 
	gLJJ‘R—dy
::
	$V”ifyP’Info
()

769 
eP’
 = 
BOTH_PENS
;

770  
NO_ERROR
;

771 
	}
}

773 
DRIVER_ERROR
 
	gLJJ‘R—dy
::
	$P¬£P’Info
(
PEN_TYPE
& 
eP’
, 
BOOL
 
Qu”yPrš‹r
)

775 
eP’
 = 
BOTH_PENS
;

777  
NO_ERROR
;

778 
	}
}

780 
Com´essÜ
* 
	gLJJ‘R—dy
::
	$C»©eCom´essÜ
 (
Ra¡”Size
)

794 ià(
bG»y_K
)

796 
Ra¡”Size
 = (è(
thePrštCÚ‹xt
->
	`PršbËWidth
 (è*hePrštCÚ‹xt->
	`EfãùiveResŞutiÚX
 ()) * 3;

799 ià(
Ra¡”Size
 < 4800)

801 
Ra¡”Size
 = 4800;

808 
Ra¡”Size
 = ((RasterSize + 95) / 96) * 96;

810 
m_pCom´essÜ
 = 
Ãw
 
	`ModeJPEG
 (
pSS
, 
this
, 
Ra¡”Size
, 
m_eCom´essMode
);

811  
m_pCom´essÜ
;

812 
	}
}

833 
DISPLAY_STATUS
 
	gLJJ‘R—dy
::
	$P¬£E¼Ü
(
BYTE
 
¡©us_»g
)

835 
	`DBG1
("LJJetReady:…arsingƒrror info\n");

837 
DRIVER_ERROR
 
”r
 = 
NO_ERROR
;

838 
BYTE
 
szR—dBuff
[256];

839 
DWORD
 
iR—dCouÁ
 = 256;

840 
DISPLAY_STATUS
 
eStus
 = (DISPLAY_STATUSè
¡©us_»g
;

841 *
tmpSŒ
;

842 
iE¼ÜCode
;

844 ià(!
IOMode
.
bDevID
)

845  
eStus
;

847 
	`mem£t
 (
szR—dBuff
, 0, 256);

848 
”r
 = 
pSS
->
	`FromDeviû
 (
szR—dBuff
, &
iR—dCouÁ
);

849 ià(
”r
 =ğ
NO_ERROR
 && 
iR—dCouÁ
 == 0)

850  
eStus
;

852 ià(
	`¡r¡r
 ((*è
szR—dBuff
, "JOB"))

854 ià(!(
tmpSŒ
 = 
	`¡r¡r
 ((*è
szR—dBuff
, "NAME")))

855  
DISPLAY_PRINTING
;

856 
tmpSŒ
 += 6;

857 *
tmpSŒ
 < '0' || *tmpStr > '9')

858 
tmpSŒ
++;

859 
	`ssÿnf
 (
tmpSŒ
, "%d", &
iE¼ÜCode
);

860 ià(
iE¼ÜCode
 !ğ(è(
this
))

861  
DISPLAY_PRINTING
;

864 ià(
	`¡r¡r
 ((*è
szR—dBuff
, "END"))

866  
DISPLAY_PRINTING_COMPLETE
;

870 ià(
	`¡r¡r
 ((*è
szR—dBuff
, "CANCEL"))

871  
DISPLAY_PRINTING_CANCELED
;

873 ià(!(
tmpSŒ
 = 
	`¡r¡r
 ((*è
szR—dBuff
, "CODE")))

874  
eStus
;

876 
tmpSŒ
 += 4;

877 *
tmpSŒ
 < '0' || *tmpStr > '9')

878 
tmpSŒ
++;

879 
	`ssÿnf
 (
tmpSŒ
, "%d", &
iE¼ÜCode
);

881 ià(
iE¼ÜCode
 < 32000)

882  
DISPLAY_PRINTING
;

884 ià(
iE¼ÜCode
 == 40010 || iErrorCode == 40020)

885  
DISPLAY_NO_PENS
;

887 ià(
iE¼ÜCode
 == 40021)

888  
DISPLAY_TOP_COVER_OPEN
;

890 ià((
iE¼ÜCode
 / 100) == 419)

891  
DISPLAY_OUT_OF_PAPER
;

893 ià((
iE¼ÜCode
 / 1000) == 42 || iErrorCode == 40022)

895 
	`DBG1
("Paper Jammed\n");

896  
DISPLAY_PAPER_JAMMED
;

899 ià(
iE¼ÜCode
 > 40049 && iErrorCode < 41000)

901 
	`DBG1
("IOrap\n");

902  
DISPLAY_ERROR_TRAP
;

905 ià(
iE¼ÜCode
 == 40079)

906  
DISPLAY_OFFLINE
;

908  
DISPLAY_ERROR_TRAP
;

909 
	}
}

911 
BYTE
 * 
	gModeJPEG
::
åJPEGBufãr
 = 
NULL
;

912 
DWORD
 
	gModeJPEG
::
fJPEGBufãrPos
;

914 
	gModeJPEG
::
	$j³g_æush_ouut_bufãr_ÿÎback
(
JOCTET
 *
outbuf
, 
BYTE
* 
bufãr
, 
DWORD
 
size
)

916 
fJPEGBufãrPos
 +ğ
size
;

917 
	`memıy
 (
åJPEGBufãr
, 
bufãr
, 
size
);

918 
åJPEGBufãr
 +ğ
size
;

919 
	}
}

924 
	$Gj³g_”rÜ
 (
j_commÚ_±r
 
cšfo
)

927 
	}
}

934 
DWORD
 
	gModeJPEG
::
	$G‘JPEGBufãrSize
() const

936  
fJPEGBufãrPos
;

937 
	}
}

948 
j³g_bufãr_de¡
 (
j_com´ess_±r
 
cšfo
, 
JOCTET
* 
outbuff
, * 
æush_ouut_bufãr_ÿÎback
);

949 
hp_rgb_ycc_£tup
 (
iFÏg
);

952 
	#CÚv”tToG¿yMaüo
(
»d
, 
g»’
, 
blue
è(()ĞĞÔed * 30è+ (g»’ * 59è+ (blu* 11èè/ 100 ))

	)

975 
ModeJPEG
::ModeJPEG

977 
Sy¡emS”viûs
* 
pSys
,

978 
Prš‹r
* 
pPrš‹r
,

979 
PÏÃSize
,

980 
COMPRESS_MODE
 
eCom´essMode


982 
Com´essÜ
(
pSys
, 
PÏÃSize
, 
TRUE
),

983 
	$thePrš‹r
(
pPrš‹r
)

985 ià(
cÚ¡ruùÜ_”rÜ
 !ğ
NO_ERROR
)

989 
åJPEGBufãr
 = 
NULL
;

990 
fJPEGBufãrPos
 = 0;

991 
åJPEGS¹
 = 
NULL
;

993 
m_SourûB™m­
.
pvB™s
 = (
BYTE
*è
Ãw
 BYTE[(
šputsize
 * 
MOJAVE_STRIP_HEIGHT
)];

995 ià(
m_SourûB™m­
.
pvB™s
 =ğ
NULL
)

997 
cÚ¡ruùÜ_”rÜ
 = 
ALLOCMEM_ERROR
;

1001 
	`mem£t
 (
m_SourûB™m­
.
pvB™s
, 0xFF, 
šputsize
 * 
MOJAVE_STRIP_HEIGHT
);

1003 
m_SourûB™m­
.
cjB™s
 = 0;

1004 
m_SourûB™m­
.
b™m­Info
.
bmiH—d”
.
biWidth
 = 0;

1005 
m_SourûB™m­
.
b™m­Info
.
bmiH—d”
.
biHeight
 = 0;

1008 
m_De¡B™m­
.
pvB™s
 = 
NULL
;

1009 
m_De¡B™m­
.
cjB™s
 = 0;

1010 
m_De¡B™m­
.
b™m­Info
.
bmiH—d”
.
biWidth
 = 0;

1011 
m_De¡B™m­
.
b™m­Info
.
bmiH—d”
.
biHeight
 = 0;

1013 
m_lCu¼CDRa¡”Row
 = 0;

1014 
m_lPrš‹rRa¡”Row
 = 0;

1016 
m_iRa¡”Width
 = 
šputsize
 / 3;

1018 
iRa¡”sR—dy
 = 0;

1020 
com´essBuf
 = 
NULL
;

1021 
m_eCom´essMode
 = 
eCom´essMode
;

1023 
	}
}

1047 
ModeJPEG
::~
	$ModeJPEG
 ()

1049 ià(
m_SourûB™m­
.
pvB™s
)

1051 
d–‘e
 
m_SourûB™m­
.
pvB™s
;

1052 
m_SourûB™m­
.
pvB™s
 = 
NULL
;

1055 ià(
m_De¡B™m­
.
pvB™s
)

1057 
d–‘e
 
m_De¡B™m­
.
pvB™s
;

1058 
m_De¡B™m­
.
pvB™s
 = 
NULL
;

1061 
	}
}

1069 
DRIVER_ERROR
 
ModeJPEG
::
	$S’dWh™eSŒs
 (
iPageHeight
, 
BOOL
 
bG¿y
)

1071 
DRIVER_ERROR
 
”r
 = 
NO_ERROR
;

1072 
HPLJBITMAP
 
hWh™eB™m­
;

1073 
QTABLEINFO
 
qTabËInfo
;

1074 
RASTERDATA
 
wh™eRa¡”
;

1076 
qTabËInfo
.
qFaùÜ
 = 6;

1078 
hWh™eB™m­
.
pvB™s
 = 
NULL
;

1080 ià(
bG¿y
)

1082 
m_SourûB™m­
.
cjB™s
 = 
m_iRa¡”Width
 * 
MOJAVE_STRIP_HEIGHT
;

1083 
	`mem£t
 (
m_SourûB™m­
.
pvB™s
, 0x00, m_SourûB™m­.
cjB™s
);

1087 
m_SourûB™m­
.
cjB™s
 = 
m_iRa¡”Width
 * 
MOJAVE_STRIP_HEIGHT
 * 3;

1088 
	`mem£t
 (
m_SourûB™m­
.
pvB™s
, 0xFF, m_SourûB™m­.
cjB™s
);

1090 
	`mem£t
(&
m_SourûB™m­
.
b™m­Info
.
bmiH—d”
, 0, (
HPBITMAPINFOHEADER
));

1091 
m_SourûB™m­
.
b™m­Info
.
bmiH—d”
.
biWidth
 = 
m_iRa¡”Width
;

1092 
m_SourûB™m­
.
b™m­Info
.
bmiH—d”
.
biHeight
 = 
MOJAVE_STRIP_HEIGHT
;

1093 
m_SourûB™m­
.
b™m­Info
.
bmiH—d”
.
biSizeImage
 = m_SourûB™m­.
cjB™s
;

1094 
m_SourûB™m­
.
b™m­Info
.
bmiH—d”
.
biB™CouÁ
 = 8;

1095 
	`Com´ess
 (&
m_SourûB™m­
, &
m_De¡B™m­
, &
qTabËInfo
, 
bG¿y
);

1096 
wh™eRa¡”
.
¿¡”size
[
COLORTYPE_COLOR
] = 
m_De¡B™m­
.
cjB™s
;

1097 
wh™eRa¡”
.
¿¡”d©a
[
COLORTYPE_COLOR
] = 
m_De¡B™m­
.
pvB™s
;

1098 
m_lPrš‹rRa¡”Row
 < 
iPageHeight
)

1100 
thePrš‹r
->
	`EnÿpsuÏ‹
 (&
wh™eRa¡”
, 
TRUE
);

1101 
m_lPrš‹rRa¡”Row
 +ğ
MOJAVE_STRIP_HEIGHT
;

1104  
”r
;

1105 
	}
}

1107 
BOOL
 
ModeJPEG
::
	$Com´ess
Ğ
HPLJBITMAP
 *
pSrcB™m­
,

1108 
HPLJBITMAP
 *
pTrgB™m­
,

1109 
QTABLEINFO
 *
pQTabË
,

1110 
BOOL
 
bG¿ysÿËS‘


1114 #ifdeà
HAVE_LIBDL


1115 ià(
HPLJJRCom´ess
 && 
m_eCom´essMode
 =ğ
COMPRESS_MODE_LJ
)

1117 
iR‘
;

1118 
	`memıy
 (
pTrgB™m­
, 
pSrcB™m­
,  (
HPLJBITMAP
));

1119 
pTrgB™m­
->
pvB™s
 = 
Ãw
 
BYTE
[
pSrcB™m­
->
b™m­Info
.
bmiH—d”
.
biWidth
 *…SrcB™m­->b™m­Info.bmiH—d”.
biHeight
 * 3];

1120 ià(
pTrgB™m­
->
pvB™s
 =ğ
NULL
)

1122  
FALSE
;

1124 ià(
bG¿ysÿËS‘
)

1126 
BYTE
 *
p
 = 
pSrcB™m­
->
pvB™s
;

1127 
j
 = 0; j < 
pSrcB™m­
->
b™m­Info
.
bmiH—d”
.
biHeight
; j++)

1129 
i
 = 0; i < 
pSrcB™m­
->
b™m­Info
.
bmiH—d”
.
biWidth
; i++)

1131 
p
[0] = 
	`CÚv”tToG¿yMaüo
 (p[0],…[1],…[2]);

1132 
p
[1] =…[2] = 0;

1133 
p
 += 3;

1137 
iR‘
 = 
	`HPLJJRCom´ess
 (
pTrgB™m­
->
pvB™s
, (
ušt32_t
 *è&pTrgB™m­->
cjB™s
, 
pSrcB™m­
->pvBits,

1138 
pSrcB™m­
->
b™m­Info
.
bmiH—d”
.
biWidth
,…SrcB™m­->b™m­Info.bmiH—d”.
biHeight
);

1139 ià(
iR‘
 < 0)

1140  
FALSE
;

1141  
TRUE
;

1145 #ifdeà
JPEG_FILE_OUTPUT


1146 
ifecouÁ
 = 0;

1147 
szFeName
 [256];

1148 
	`¥rštf
(
szFeName
,"C:\\Temp\\com´es£d%03d",
ifecouÁ
++);

1149 
	`¡rÿt
(
szFeName
,".jpg");

1150 
FILE
 *
pFe
 = 
	`fİ’
(
szFeName
, "w+b");

1153 
fJPEGBufãrPos
 = 0;

1155 
	`hp_rgb_ycc_£tup
 (1);

1164 
cšfo
.
”r
 = 
	`j³g_¡d_”rÜ
Ğ&
j”r
 );

1168 
j”r
.
”rÜ_ex™
 = 
Gj³g_”rÜ
;

1171 ià(
	`£tjmp
(
£tjmp_bufãr
)) {

1176 
	`j³g_de¡roy_com´ess
(&
cšfo
);

1177  
FALSE
;

1180 
	`j³g_ü—‹_com´ess
Ğ&
cšfo
 );

1194 
iCŞÜsU£d
;

1196 if(
bG¿ysÿËS‘
)

1198 
cšfo
.
š_cŞÜ_¥aû
 = 
JCS_GRAYSCALE
;

1199 
iCŞÜsU£d
 = 1;

1203 
cšfo
.
š_cŞÜ_¥aû
 = 
JCS_RGB
;

1204 
iCŞÜsU£d
 = 3;

1206 
	`j³g_£t_deçuÉs
Ğ&
cšfo
 );

1208 
cšfo
.
image_width
 = 
pSrcB™m­
->
b™m­Info
.
bmiH—d”
.
biWidth
;

1209 
cšfo
.
image_height
 = 
pSrcB™m­
->
b™m­Info
.
bmiH—d”
.
biHeight
;

1210 
cšfo
.
šput_compÚ’ts
 = 
iCŞÜsU£d
;

1211 
cšfo
.
d©a_´ecisiÚ
 = 8;

1216 
mojave_quªt_bË1
[64] = { 2,3,4,5,5,5,5,5,

1227 
iSÿËFaùÜ
 = 
pQTabË
->
qFaùÜ
;

1247 
i
 = 0; i < 3; i++)

1252 
	`j³g_add_quªt_bË
(&
cšfo
, 
i
, 
mojave_quªt_bË1
, 0, 
FALSE
 );

1257 
j
 = 1; j < 64; j++)

1259 
cšfo
.
quªt_tbl_±rs
[
i
]->
quªtv®
[
j
] = (
UINT16
)((
mojave_quªt_bË1
[j] * 
iSÿËFaùÜ
) & 0xFF);

1270 
cšfo
.
quªt_tbl_±rs
[
i
]->
quªtv®
[0] = (
UINT16
)
mojave_quªt_bË1
[0];

1277 
dTemp
 = 
mojave_quªt_bË1
[1] * (1 + 0.25 * (
iSÿËFaùÜ
 - 1)) + 0.5;

1278 
cšfo
.
quªt_tbl_±rs
[
i
]->
quªtv®
[1] = (
UINT16
)
dTemp
 & 0xFF;

1280 
dTemp
 = 
mojave_quªt_bË1
[8] * (1 + 0.25 * (
iSÿËFaùÜ
 - 1)) + 0.5;

1281 
cšfo
.
quªt_tbl_±rs
[
i
]->
quªtv®
[8] = (
UINT16
)
dTemp
 & 0xFF;

1286 
dTemp
 = 
mojave_quªt_bË1
[16] * (1 + 0.50 * (
iSÿËFaùÜ
 - 1)) + 0.5;

1287 
cšfo
.
quªt_tbl_±rs
[
i
]->
quªtv®
[16] = (
UINT16
)
dTemp
 & 0xFF;

1289 
dTemp
 = 
mojave_quªt_bË1
[9] * (1 + 0.50 * (
iSÿËFaùÜ
 - 1)) + 0.5;

1290 
cšfo
.
quªt_tbl_±rs
[
i
]->
quªtv®
[9] = (
UINT16
)
dTemp
 & 0xFF;

1292 
dTemp
 = 
mojave_quªt_bË1
[2] * (1 + 0.50 * (
iSÿËFaùÜ
 - 1)) + 0.5;

1293 
cšfo
.
quªt_tbl_±rs
[
i
]->
quªtv®
[2] = (
UINT16
)
dTemp
 & 0xFF;

1299 
cšfo
.
comp_šfo
[0].
h_§mp_çùÜ
 = 1;

1300 
cšfo
.
comp_šfo
[0].
v_§mp_çùÜ
 = 1;

1303 
åJPEGBufãr
 = 
Ãw
 
BYTE
[
cšfo
.
image_width
 * cšfo.
image_height
 * 
iCŞÜsU£d
];

1304 ià(
NULL
 =ğ
åJPEGBufãr
)

1307  
FALSE
;

1310 
åJPEGS¹
 = 
åJPEGBufãr
;

1312 
	`j³g_bufãr_de¡
(&
cšfo
, (
JOCTET
 *è
åJPEGBufãr
, (*è(
ModeJPEG
::
j³g_æush_ouut_bufãr_ÿÎback
));

1313 if(
bG¿ysÿËS‘
)

1315 
cšfo
.
wr™e_JFIF_h—d”
 =

1316 
cšfo
.
wr™e_Adobe_m¬k”
 = 
FALSE
;

1317 
	`j³g_suµ»ss_bËs
(&
cšfo
, 
TRUE
);

1328 
	`j³g_¡¬t_com´ess
Ğ&
cšfo
, 
TRUE
 );

1337 
JSAMPROW
 
pRowA¼ay
[1];

1338 
BYTE
* 
pCurLše
 = (BYTE*è
pSrcB™m­
->
pvB™s
;

1339 
DWORD
 
dwSÿnLše
;

1341 
dwSÿnLše
 = 
cšfo
.
image_width
 * 
iCŞÜsU£d
;

1343 
Äow
 = 0;‚row < 
cšfo
.
image_height
;‚row++)

1345 
pRowA¼ay
[0] = (
JSAMPROW
è
pCurLše
;

1346 
	`j³g_wr™e_sÿÆšes
(&
cšfo
, 
pRowA¼ay
, 1);

1347 
pCurLše
 +ğ
dwSÿnLše
;

1354 
	`j³g_fšish_com´ess
Ğ&
cšfo
 );

1360 ià(
cšfo
.
quªt_tbl_±rs
[0] !ğ
NULL
)

1362 
iI
 = 0; iI < 
QTABLE_SIZE
; iI++)

1364 
pQTabË
->
qbË0
[
iI
] = (
DWORD
)
cšfo
.
quªt_tbl_±rs
[0]->
quªtv®
[iI];

1369 ià(
cšfo
.
quªt_tbl_±rs
[1] !ğ
NULL
)

1371 
iI
 = 0; iI < 
QTABLE_SIZE
; iI++)

1373 
pQTabË
->
qbË1
[
iI
] = (
DWORD
)
cšfo
.
quªt_tbl_±rs
[1]->
quªtv®
[iI];

1377 ià(
cšfo
.
quªt_tbl_±rs
[2] !ğ
NULL
)

1379 
iI
 = 0; iI < 
QTABLE_SIZE
; iI++)

1381 
pQTabË
->
qbË2
[
iI
] = (
DWORD
)
cšfo
.
quªt_tbl_±rs
[2]->
quªtv®
[iI];

1389 
	`j³g_de¡roy_com´ess
Ğ&
cšfo
 );

1391 
	`memıy
(
pTrgB™m­
, 
pSrcB™m­
, (
HPLJBITMAP
));

1393 #ifdeà
JPEG_FILE_OUTPUT


1394 
	`fwr™e
(
åJPEGS¹
, (
BYTE
), 
	`G‘JPEGBufãrSize
(), 
pFe
);

1397 if(
åJPEGS¹
 && 
bG¿ysÿËS‘
)

1399 
lBufãrSize
 = 
	`G‘JPEGBufãrSize
();

1400 
l
 = 0;

1401 
l
 < 
lBufãrSize
)

1403 if(
åJPEGS¹
[
l
] == 0xFF && fpJPEGStart[l+1] == 0xDA)

1405 
l
++;

1407 if(
l
 !ğ
lBufãrSize
)

1409 
	`memıy
 (
åJPEGS¹
, fpJPEGS¹ + 
l
 + 10, 
lBufãrSize
 -† - 10);

1410 
	`mem£t
 (
åJPEGS¹
 + 
lBufãrSize
 - 
l
 - 10, 0xFF,† + 10);

1411 
pTrgB™m­
->
cjB™s
 = 
lBufãrSize
 - 
l
 - 10;

1412 
pTrgB™m­
->
pvB™s
 = (
BYTE
*)
åJPEGS¹
;

1416 
pTrgB™m­
->
pvB™s
 = (
BYTE
*)
åJPEGS¹
;

1421 
pTrgB™m­
->
pvB™s
 = (
BYTE
*è
åJPEGS¹
;

1422 
pTrgB™m­
->
cjB™s
 = 
	`G‘JPEGBufãrSize
();

1425 #ifdeà
JPEG_FILE_OUTPUT


1426 
	`fşo£
(
pFe
);

1429  
TRUE
;

1431 
	}
}

1433 
BOOL
 
ModeJPEG
::
Proûss


1435 
RASTERDATA
* 
šput


1438 
DRIVER_ERROR
 
”r
 = 
NO_ERROR
;

1440 ià(
šput
==
NULL
 ||

1441 (
šput
->
¿¡”d©a
[
COLORTYPE_COLOR
]==
NULL
 && iÅut->¿¡”d©a[
COLORTYPE_BLACK
]==NULL))

1443  
FALSE
;

1445 ià(
šput
->
¿¡”d©a
[
COLORTYPE_COLOR
])

1447 ià(
m_lCu¼CDRa¡”Row
 < 
MOJAVE_STRIP_HEIGHT
 )

1450 
memıy
(
m_SourûB™m­
.
pvB™s
 + 
m_lCu¼CDRa¡”Row
 * 
šputsize
, 
šput
->
¿¡”d©a
[
COLORTYPE_COLOR
], iÅut->
¿¡”size
[COLORTYPE_COLOR]);

1451 
m_lCu¼CDRa¡”Row
 ++;

1454 ià(
m_lCu¼CDRa¡”Row
 =ğ
MOJAVE_STRIP_HEIGHT
 || ((
LJJ‘R—dy
*)
thePrš‹r
)->
phLJJ‘R—dy
->
IsLa¡Bªd
())

1456 
m_SourûB™m­
.
cjB™s
 = 
šputsize
 * 
MOJAVE_STRIP_HEIGHT
;

1457 
mem£t
(&
m_SourûB™m­
.
b™m­Info
.
bmiH—d”
, 0, (
HPBITMAPINFOHEADER
));

1458 
m_SourûB™m­
.
b™m­Info
.
bmiH—d”
.
biWidth
 = 
šputsize
 / 3;

1459 
m_SourûB™m­
.
b™m­Info
.
bmiH—d”
.
biHeight
 = 
MOJAVE_STRIP_HEIGHT
;

1461 
QTABLEINFO
 
qTabËInfo
;

1462 
BOOL
 
bG¿ySÿËS‘
 = ((
LJJ‘R—dy
 *)
thePrš‹r
)->
bG»y_K
;

1463 
BOOL
 
bR‘
 = 
TRUE
;

1465 
qTabËInfo
.
qFaùÜ
 = 6;

1466 ià(((
LJJ‘R—dy
*)
thePrš‹r
)->
m_bS¹PageNÙS’t
)

1468 
”r
 = (((
LJJ‘R—dy
*)
thePrš‹r
)->
phLJJ‘R—dy
)->
S¹Page
();

1469 ((
LJJ‘R—dy
*)
thePrš‹r
)->
m_bS¹PageNÙS’t
 = 
FALSE
;

1471 
»s
[64];

1478 
”r
 = 
thePrš‹r
->
S’d
 ((cÚ¡ 
BYTE
 *)
JrBegšImageSeq
, (JrBeginImageSeq));

1479 
ERRCHECK
;

1481 
sourûwidth
 = (è(
šputsize
 / 3);

1482 
sourûheight
 = ()((((
LJJ‘R—dy
*)
thePrš‹r
)->
phLJJ‘R—dy
)->
thePrštCÚ‹xt
->
PhysiÿlPageSizeY
(è* 
MOJAVE_RESOLUTION
 - 200);

1483 iàĞ0 !ğ(
sourûheight
 % 
MOJAVE_STRIP_HEIGHT
) )

1485 
sourûheight
 = ( (sourûheighˆ/ 
MOJAVE_STRIP_HEIGHT
) + 1) * MOJAVE_STRIP_HEIGHT;

1490 
»s
[0] = 
sourûwidth
 & 0x00FF;

1491 
»s
[1] = ((
sourûwidth
 & 0xFF00) >> 8);

1492 
”r
 = 
thePrš‹r
->
S’d
 ((cÚ¡ 
BYTE
 *è
»s
, 2);

1493 
ERRCHECK
;

1497 
¡rıy
 (
»s
, "\xF8\x6C\xC1");

1498 
”r
 = 
thePrš‹r
->
S’d
 ((cÚ¡ 
BYTE
 *è
»s
, 
¡¾’
 (res));

1499 
ERRCHECK
;

1503 
»s
[0] = 
sourûheight
 & 0x00FF;

1504 
»s
[1] = ((
sourûheight
 & 0xFF00) >> 8);

1505 
”r
 = 
thePrš‹r
->
S’d
 ((cÚ¡ 
BYTE
 *è
»s
, 2);

1506 
ERRCHECK
;

1510 
¡rıy
 (
»s
, "\xF8\x6B\xC1");

1511 
”r
 = 
thePrš‹r
->
S’d
 ((cÚ¡ 
BYTE
 *è
»s
, 
¡¾’
 (res));

1512 
ERRCHECK
;

1514 
¡rcouÁ
 = 
sourûheight
 / 
MOJAVE_STRIP_HEIGHT
;

1517 
»s
[0] = 
¡rcouÁ
 & 0x00FF;

1518 
»s
[1] = ((
¡rcouÁ
 & 0xFF00) >> 8);

1519 
”r
 = 
thePrš‹r
->
S’d
 ((cÚ¡ 
BYTE
 *è
»s
, 2);

1520 
ERRCHECK
;

1524 
¡rıy
 (
»s
, "\xF8\x93\xC1");

1525 
”r
 = 
thePrš‹r
->
S’d
 ((cÚ¡ 
BYTE
 *è
»s
, 
¡¾’
 (res));

1528 
ERRCHECK
;

1533 
BYTE
 
JrSŒHeightSeq
[] = {0x80,0x00,0xF8,0x94};

1534 
”r
 = 
thePrš‹r
->
S’d
 ((cÚ¡ 
BYTE
 *)
JrSŒHeightSeq
, (JrStripHeightSeq));

1535 
ERRCHECK
;

1537 ià(
bG¿ySÿËS‘
)

1540 
BYTE
 
JrG¿ySÿËSeq
[] = {0xC0,0x00,0xF8,0x97};

1541 
”r
 = 
thePrš‹r
->
S’d
 ((cÚ¡ 
BYTE
 *)
JrG¿ySÿËSeq
, (JrGrayScaleSeq));

1542 
ERRCHECK
;

1547 
BYTE
 
JrCŞÜSeq
[] = {0xC0,0x04,0xF8,0x97};

1548 
”r
 = 
thePrš‹r
->
S’d
 ((cÚ¡ 
BYTE
 *)
JrCŞÜSeq
, (JrColorSeq));

1549 
ERRCHECK
;

1553 
BYTE
 
JrSeq
[] = {0xC0,0x00,0xF8,0x98};

1554 
”r
 = 
thePrš‹r
->
S’d
 ((cÚ¡ 
BYTE
 *)
JrSeq
, (JrSeq));

1555 
ERRCHECK
;

1561 
”r
 = 
thePrš‹r
->
S’d
 ((cÚ¡ 
BYTE
 *)
JrVU_v”_TagSeq
, (JrVU_ver_TagSeq));

1562 
ERRCHECK
;

1570 
BYTE
 
JrD©aL’gthSeq
[] = {0xC2,0x38,0x03,0x00,0x00,0xF8,0x92,0x46};

1571 #ifdeà
HAVE_LIBDL


1572 ià(
HPLJJRCom´ess
 && 
m_eCom´essMode
 =ğ
COMPRESS_MODE_LJ
)

1574 
JrD©aL’gthSeq
[1] = 0;

1575 
JrD©aL’gthSeq
[2] = 0;

1578 
”r
 = 
thePrš‹r
->
S’d
 ((cÚ¡ 
BYTE
 *)
JrD©aL’gthSeq
, (JrDataLengthSeq));

1579 
ERRCHECK
;

1581 
bR‘
 = 
Com´ess
 (&
m_SourûB™m­
,

1582 &
m_De¡B™m­
,

1583 &
qTabËInfo
,

1584 
FALSE


1586 ià(!
HPLJJRCom´ess
 || (HPLJJRCom´es && 
m_eCom´essMode
 !ğ
COMPRESS_MODE_LJ
))

1590 
BYTE
 
JrQTSeq
[] = {0x00,0x80,0x00,0x03,0x00,0x00};

1591 
”r
 = 
thePrš‹r
->
S’d
 ((cÚ¡ 
BYTE
 *)
JrQTSeq
, (JrQTSeq));

1592 
ERRCHECK
;

1594 #ifdeà
APDK_LITTLE_ENDIAN


1596 
”r
 = 
thePrš‹r
->
S’d
 ((cÚ¡ 
BYTE
 *)
qTabËInfo
.
qbË0
, (
DWORD
è* 
QTABLE_SIZE
);

1597 
ERRCHECK
;

1601 
”r
 = 
thePrš‹r
->
S’d
 ((cÚ¡ 
BYTE
 *)
qTabËInfo
.
qbË1
, (
DWORD
è* 
QTABLE_SIZE
);

1602 
ERRCHECK
;

1605 
”r
 = 
thePrš‹r
->
S’d
 ((cÚ¡ 
BYTE
 *)
qTabËInfo
.
qbË2
, (
DWORD
è* 
QTABLE_SIZE
);

1606 
ERRCHECK
;

1608 
BYTE
 
szSŒ
[ (
DWORD
è* 
QTABLE_SIZE
 * 3];

1609 
BYTE
 *
p
;

1610 
p
 = 
szSŒ
;

1611 
i
 = 0; i < 
QTABLE_SIZE
; i++)

1613 *
p
++ = 
qTabËInfo
.
qbË0
[
i
] & 0xFF;

1614 *
p
++ = (
qTabËInfo
.
qbË0
[
i
] >> 8) & 0xFF;

1615 *
p
++ = (
qTabËInfo
.
qbË0
[
i
] >> 16) & 0xFF;

1616 *
p
++ = (
qTabËInfo
.
qbË0
[
i
] >> 24) & 0xFF;

1618 
i
 = 0; i < 
QTABLE_SIZE
; i++)

1620 *
p
++ = 
qTabËInfo
.
qbË1
[
i
] & 0xFF;

1621 *
p
++ = (
qTabËInfo
.
qbË1
[
i
] >> 8) & 0xFF;

1622 *
p
++ = (
qTabËInfo
.
qbË1
[
i
] >> 16) & 0xFF;

1623 *
p
++ = (
qTabËInfo
.
qbË1
[
i
] >> 24) & 0xFF;

1625 
i
 = 0; i < 
QTABLE_SIZE
; i++)

1627 *
p
++ = 
qTabËInfo
.
qbË2
[
i
] & 0xFF;

1628 *
p
++ = (
qTabËInfo
.
qbË2
[
i
] >> 8) & 0xFF;

1629 *
p
++ = (
qTabËInfo
.
qbË2
[
i
] >> 16) & 0xFF;

1630 *
p
++ = (
qTabËInfo
.
qbË2
[
i
] >> 24) & 0xFF;

1632 
”r
 = 
thePrš‹r
->
S’d
 ((cÚ¡ 
BYTE
 *è
szSŒ
, 3 *  (
DWORD
è* 
QTABLE_SIZE
);

1633 
ERRCHECK
;

1645 
BYTE
 
JrCRSeq
[] = {0x01,0x80,0x2C,0x00,0x00,0x00};

1646 
”r
 = 
thePrš‹r
->
S’d
 ((cÚ¡ 
BYTE
 *)
JrCRSeq
, (JrCRSeq));

1647 
ERRCHECK
;

1649 ià(
bG¿ySÿËS‘
)

1652 
BYTE
 
JrCR1GSeq
[] = {0x05,0xE0,0x00,0x00};

1653 
”r
 = 
thePrš‹r
->
S’d
 ((cÚ¡ 
BYTE
 *)
JrCR1GSeq
, (JrCR1GSeq));

1654 
ERRCHECK
;

1659 
BYTE
 
JrCR1CSeq
[] = {0x01,0xE0,0x14,0x66};

1660 
”r
 = 
thePrš‹r
->
S’d
 ((cÚ¡ 
BYTE
 *)
JrCR1CSeq
, (JrCR1CSeq));

1661 
ERRCHECK
;

1672 ià(
bG¿ySÿËS‘
)

1675 
BYTE
 
JrCR3GSeq
[] = {0x00,0x00,0x00,0x00};

1677 
”r
 = 
thePrš‹r
->
S’d
 ((cÚ¡ 
BYTE
 *)
JrCR3GSeq
, (JrCR3GSeq));

1678 
ERRCHECK
;

1683 
BYTE
 
JrCR3CSeq
[] = {0x01,0x00,0x00,0x00};

1684 
”r
 = 
thePrš‹r
->
S’d
 ((cÚ¡ 
BYTE
 *)
JrCR3CSeq
, (JrCR3CSeq));

1685 
ERRCHECK
;

1696 
BYTE
 
JrCSC1Seq
[] = {0x00,0x20,0x00,0x00};

1697 
”r
 = 
thePrš‹r
->
S’d
 ((cÚ¡ 
BYTE
 *)
JrCSC1Seq
, (JrCSC1Seq));

1698 
ERRCHECK
;

1701 
BYTE
 
JrCSC2Seq
[] = {0x00,0x00,0x00,0x00};

1702 
”r
 = 
thePrš‹r
->
S’d
 ((cÚ¡ 
BYTE
 *)
JrCSC2Seq
, (JrCSC2Seq));

1703 
ERRCHECK
;

1706 
BYTE
 
JrCSC3Seq
[] = {0x00,0x00,0x00,0x00};

1707 
”r
 = 
thePrš‹r
->
S’d
 ((cÚ¡ 
BYTE
 *)
JrCSC3Seq
, (JrCSC3Seq));

1708 
ERRCHECK
;

1711 
BYTE
 
JrCSC4Seq
[] = {0x00,0x20,0x00,0x00};

1712 
”r
 = 
thePrš‹r
->
S’d
 ((cÚ¡ 
BYTE
 *)
JrCSC4Seq
, (JrCSC4Seq));

1713 
ERRCHECK
;

1716 
BYTE
 
JrCSC5Seq
[] = {0x00,0xE0,0x00,0x00};

1717 
”r
 = 
thePrš‹r
->
S’d
 ((cÚ¡ 
BYTE
 *)
JrCSC5Seq
, (JrCSC5Seq));

1718 
ERRCHECK
;

1721 
BYTE
 
JrCSC6Seq
[] = {0x00,0x00,0x00,0x00};

1722 
”r
 = 
thePrš‹r
->
S’d
 ((cÚ¡ 
BYTE
 *)
JrCSC6Seq
, (JrCSC6Seq));

1723 
ERRCHECK
;

1726 
BYTE
 
JrCSC7Seq
[] = {0x00,0x20,0x00,0x00};

1727 
”r
 = 
thePrš‹r
->
S’d
 ((cÚ¡ 
BYTE
 *)
JrCSC7Seq
, (JrCSC7Seq));

1728 
ERRCHECK
;

1731 
BYTE
 
JrCSC8Seq
[] = {0x00,0x00,0x00,0x00};

1732 
”r
 = 
thePrš‹r
->
S’d
 ((cÚ¡ 
BYTE
 *)
JrCSC8Seq
, (JrCSC8Seq));

1733 
ERRCHECK
;

1736 
BYTE
 
JrCSC9Seq
[] = {0x00,0xE0,0x00,0x00};

1737 
”r
 = 
thePrš‹r
->
S’d
 ((cÚ¡ 
BYTE
 *)
JrCSC9Seq
, (JrCSC9Seq));

1738 
ERRCHECK
;

1743 
BYTE
 *
pbTemp
;

1744 
HPLJBITMAP
 
j³gG¿yB™m­
;

1746 
j³gG¿yB™m­
.
pvB™s
 = 
NULL
;

1751 if(
bG¿ySÿËS‘
 && 
m_eCom´essMode
 =ğ
COMPRESS_MODE_JPEG
)

1753 
pbTemp
 = (
BYTE
*)
m_SourûB™m­
.
pvB™s
;

1755 
j³gG¿yB™m­
.
pvB™s
 = 
Ãw
 
BYTE
[
m_SourûB™m­
.
cjB™s
 / 3];

1757 
i
 = 0, 
j
=0; i < ()
m_SourûB™m­
.
cjB™s
; i += 3, j++)

1759 
pbTemp
[
i
] = 
CÚv”tToG¿yMaüo
(pbTemp[i],…bTemp[i + 1],…bTemp[i + 2] );

1760 
pbTemp
[
i
] = 255 -…bTemp[i];

1761 
pbTemp
[
i
 + 1] =…bTemp[i];

1762 
pbTemp
[
i
 + 2] =…bTemp[i];

1764 
j³gG¿yB™m­
.
pvB™s
[
j
] = 
pbTemp
[
i
];

1768 ià(
m_De¡B™m­
.
pvB™s
)

1770 
d–‘e
 
m_De¡B™m­
.
pvB™s
;

1771 
m_De¡B™m­
.
pvB™s
 = 
NULL
;

1776 if(
bG¿ySÿËS‘
 && 
m_eCom´essMode
 =ğ
COMPRESS_MODE_JPEG
)

1778 
j³gG¿yB™m­
.
cjB™s
 = 
m_SourûB™m­
.cjBits / 3;

1779 
j³gG¿yB™m­
.
b™m­Info
.
bmiH—d”
.
biSizeImage
 = 
m_SourûB™m­
.bitmapInfo.bmiHeader.biSizeImage / 3;

1780 
j³gG¿yB™m­
.
b™m­Info
.
bmiH—d”
.
biB™CouÁ
 = 8;

1781 
j³gG¿yB™m­
.
b™m­Info
.
bmiH—d”
.
biWidth
 = 
m_SourûB™m­
.bitmapInfo.bmiHeader.biWidth;

1782 
j³gG¿yB™m­
.
b™m­Info
.
bmiH—d”
.
biHeight
 = 
m_SourûB™m­
.bitmapInfo.bmiHeader.biHeight;

1784 ià(
bG¿ySÿËS‘
 && 
m_eCom´essMode
 =ğ
COMPRESS_MODE_JPEG
)

1786 
bR‘
 = 
Com´ess
 (&
j³gG¿yB™m­
, &
m_De¡B™m­
, &
qTabËInfo
,
bG¿ySÿËS‘
);

1790 
bR‘
 = 
Com´ess
 (&
m_SourûB™m­
, &
m_De¡B™m­
, &
qTabËInfo
,
bG¿ySÿËS‘
);

1793 
m_SourûB™m­
.
cjB™s
 = 0;

1794 
m_SourûB™m­
.
b™m­Info
.
bmiH—d”
.
biWidth
 = 0;

1795 
m_SourûB™m­
.
b™m­Info
.
bmiH—d”
.
biHeight
 = 0;

1797 
mem£t
(
m_SourûB™m­
.
pvB™s
, 0xFF, 
šputsize
 * 
MOJAVE_STRIP_HEIGHT
);

1799 ià(
j³gG¿yB™m­
.
pvB™s
)

1801 
d–‘e
 
j³gG¿yB™m­
.
pvB™s
;

1802 
j³gG¿yB™m­
.
pvB™s
 = 
NULL
;

1804 
m_lPrš‹rRa¡”Row
 +ğ
MOJAVE_STRIP_HEIGHT
;

1806 
m_lCu¼CDRa¡”Row
 = 0;

1807 
iRa¡”sR—dy
 = 1;

1809 ((
LJJ‘R—dy
*)
thePrš‹r
)->
phLJJ‘R—dy
->
S‘La¡Bªd
(
FALSE
);

1813  
FALSE
;

1817  
TRUE
;

1820 
BYTE
* 
ModeJPEG
::
	$NextOuutRa¡”
(
COLORTYPE
 
cŞÜ
)

1823 ià(
iRa¡”sR—dy
==0)

1824  (
BYTE
*)
NULL
;

1826 ià(
cŞÜ
 =ğ
COLORTYPE_BLACK
)

1828  (
BYTE
*)
NULL
;

1832 
iRa¡”sR—dy
=0;

1833  
m_De¡B™m­
.
pvB™s
;

1835 
	}
}

1837 
ModeJPEG
::
	$G‘OuutWidth
(
COLORTYPE
 
cŞÜ
)

1839 ià(
cŞÜ
 =ğ
COLORTYPE_COLOR
)

1841  
m_De¡B™m­
.
cjB™s
;

1847 
	}
}

1849 
APDK_END_NAMESPACE


	@prnt/hpijs/ljjetready.h

32 #iâdeà
APDK_LJJETREADY_H


33 
	#APDK_LJJETREADY_H


	)

35 #ifdeà
APDK_LJJETREADY


37 
	~<£tjmp.h
>

41 
	~"j³glib.h
"

44 
APDK_BEGIN_NAMESPACE


49 
	eCOMPRESS_MODE
 { 
COMPRESS_MODE0
 = 0,

50 
COMPRESS_MODE2
 = 2,

51 
COMPRESS_MODE9
 = 9,

52 
COMPRESS_MODE_AUTO
 = 10,

53 
COMPRESS_MODE_JPEG
 = 11,

54 
COMPRESS_MODE_LJ
 = 12,

55 
COMPRESS_MODE_GRAFIT
 = 16

58 şas 
	cLJJ‘R—dy
 : 
public
 
Prš‹r


60 
public
:

61 
LJJ‘R—dy
 (
Sy¡emS”viûs
* 
pSS
,
numfÚts
=0, 
BOOL
 
´Ùo
=
FALSE
);

62 ~
LJJ‘R—dy
 ();

64 
vœtu®
 
H—d”
* 
S–eùH—d”
 (
PrštCÚ‹xt
* 
pc
);

65 
vœtu®
 
DRIVER_ERROR
 
V”ifyP’Info
 ();

66 
vœtu®
 
DRIVER_ERROR
 
P¬£P’Info
 (
PEN_TYPE
& 
eP’
, 
BOOL
 
Qu”yPrš‹r
=
TRUE
);

67 
vœtu®
 
DISPLAY_STATUS
 
P¬£E¼Ü
 (
BYTE
 
¡©us_»g
);

68 
šlše
 
vœtu®
 
BOOL
 
	$SuµÜtS•¬©eBÏck
(è{ 
FALSE
;}

69 
vœtu®
 
DRIVER_ERROR
 
	$Flush
 (
FlushSize
)

71  
NO_ERROR
;

72 
	}
}

74 
vœtu®
 
BOOL
 
	$G‘M¬gšs
 (
PAPER_SIZE
 
ps
, *
fM¬gšs
)

76 
fM¬gšs
[0] = () 0.1667;

77 
fM¬gšs
[1] = () 0.1667;

78 
fM¬gšs
[2] = () 0.1667;

79 
fM¬gšs
[3] = () 0.1667;

80  
TRUE
;

81 
	}
}

83 
vœtu®
 
BOOL
 
	$U£CMYK
 (
iPrštMode
è{  
FALSE
;
	}
}

84 
vœtu®
 
DRIVER_ERROR
 
EnÿpsuÏ‹
 (cÚ¡ 
RASTERDATA
* 
IÅutRa¡”
, 
BOOL
 
bLa¡PÏÃ
);

88 
vœtu®
 
BOOL
 
	$HagakiF“dDu¶ex”P»£Á
 (
BOOL
 
bQu”yPrš‹r
)

90  
TRUE
;

91 
	}
}

92 
vœtu®
 
BOOL
 
	$SuµÜtS•¬©eBÏck
 (
PrštMode
 *
pCu¼’tMode
)

94  
FALSE
;

95 
	}
}

98 
Com´essÜ
* 
C»©eCom´essÜ
 (
Ra¡”Size
);

99 
Com´essÜ
* 
	$G‘Com´essÜ
(è{  
m_pCom´essÜ
; 
	}
}

100 
BOOL
 
	gbFGCŞÜS‘
;

101 
BOOL
 
	gbG»y_K
;

102 
	gm_iYPos
;

103 
boŞ
 
	gm_bS¹PageNÙS’t
;

104 
H—d”LJJ‘R—dy
 *
	gphLJJ‘R—dy
;

106 
	g´Ùeùed
:

108 #ifdeà
APDK_HP_UX


109 
vœtu®
 
LJJ‘R—dy
 & 
İ”©Ü
 = (
Prš‹r
& 
rhs
)

111  *
this
;

115 
vœtu®
 
DATA_FORMAT
 
	$G‘D©aFÜm©
(è{  
RASTER_STRIP
; 
	}
}

116 
BOOL
 
	gm_bJobS¹ed
;

117 
	gm_iYResŞutiÚ
;

118 
Com´essÜ
 *
	gm_pCom´essÜ
;

119 
PrštCÚ‹xt
 *
	gthePrštCÚ‹xt
;

120 #ifdeà
HAVE_LIBDL


121 *
	gm_hHPLibHªdË
;

123 
COMPRESS_MODE
 
	gm_eCom´essMode
;

127 şas 
	cLJJ‘R—dyNÜm®Mode
 : 
public
 
PrštMode


129 
public
:

130 
LJJ‘R—dyNÜm®Mode
 ();

133 şas 
	cLJJ‘R—dyBe¡CŞÜMode
 : 
public
 
PrštMode


135 
public
:

136 
LJJ‘R—dyBe¡CŞÜMode
 ();

139 şas 
	cLJJ‘R—dyG¿yMode
 : 
public
 
PrštMode


141 
public
:

142 
LJJ‘R—dyG¿yMode
 ();

145 şas 
	cLJJ‘R—dyBe¡G¿yMode
 : 
public
 
PrštMode


147 
public
:

148 
LJJ‘R—dyBe¡G¿yMode
 ();

155 cÚ¡ 
	gJPEG_HEADER_SIZE
 = 600;

156 cÚ¡ 
	gJPEG_TRAILER_SIZE
 = 100;

158 cÚ¡ 
	gQTABLE_SIZE
 = 64;

159 
	sQTABLEINFO
 {

160 
DWORD
 
	mqbË0
[
QTABLE_SIZE
];

161 
DWORD
 
	mqbË1
[
QTABLE_SIZE
];

162 
DWORD
 
	mqbË2
[
QTABLE_SIZE
];

163 
	mqFaùÜ
;

166 şas 
	cModeJPEG
 : 
public
 
Com´essÜ


168 
ä›nd
 
şass
 
LJJ‘R—dy
;

169 
ä›nd
 
şass
 
	mH—d”LJJ‘R—dy
;

171 
	mpublic
:

172 
ModeJPEG
(
Sy¡emS”viûs
* 
pSys
, 
Prš‹r
* 
pPrš‹r
, 
Ra¡”Size
, 
COMPRESS_MODE
 
eCom´essMode
);

173 
	mvœtu®
 ~
ModeJPEG
();

174 
BOOL
 
Proûss
(
RASTERDATA
* 
šput
);

175 
BYTE
* 
NextOuutRa¡”
(
COLORTYPE
 
cŞÜ
);

176 
G‘OuutWidth
(
COLORTYPE
 
cŞÜ
);

177 
	$G‘CoÜdš©es
(è{  
m_lPrš‹rRa¡”Row
; }

178 
DRIVER_ERROR
 
	`S’dWh™eSŒs
 (
iPageHeight
, 
BOOL
 
bG¿y
);

180 
´Ùeùed
:

181 
BOOL
 
	`Com´ess
Ğ
HPLJBITMAP
 *
pSrcBm­
,

182 
HPLJBITMAP
 *
pTrgB™m­
,

183 
QTABLEINFO
 *
pQTabË
,

184 
BOOL
 
bG¿ysÿËS‘


187 
BYTE
* 
	`G‘Bufãr
();

188 
	`S‘Bufãr
(
BYTE
* 
pJPEGBufãr
);

189 
DWORD
 
	$G‘JPEGBufãrSize
() const;

191 
BYTE
* 
åJPEGBufãr
;

192 
DWORD
 
fJPEGBufãrPos
;

194 
JSAMPROW
 
fRow_¬¿y
[1];

198 
DWORD
 
fBufãrSize
;

199 
BYTE
* 
åJPEGS¹
;

204 
j³g_com´ess_¡ruù
 
cšfo
;

205 
j³g_decom´ess_¡ruù
 
dšfo
;

206 
j³g_”rÜ_mgr
 
j”r
;

207 
j³g_de¡š©iÚ_mgr
 
de¡
;

208 
jmp_buf
 
£tjmp_bufãr
;

213 
	`j³g_æush_ouut_bufãr_ÿÎback
(
JOCTET
 *
outbuf
, 
BYTE
* 
bufãr
, 
DWORD
 
size
);

215 
´iv©e
:

216 
Prš‹r
* 
thePrš‹r
;

218 
HPLJBITMAP
 
m_SourûB™m­
;

219 
HPLJBITMAP
 
m_De¡B™m­
;

220 
m_lCu¼CDRa¡”Row
;

221 
m_lPrš‹rRa¡”Row
;

222 
m_iRa¡”Width
;

223 
COMPRESS_MODE
 
m_eCom´essMode
;

224 
	}
};

227 #ifdeà
APDK_LJJETREADY


231 şas 
	cLJJ‘R—dyProxy
 : 
public
 
Prš‹rProxy


233 
public
:

234 
	$LJJ‘R—dyProxy
(è: 
	`Prš‹rProxy
(

240 #ifdeà
APDK_MLC_PRINTER


242 è{
m_iPrš‹rTy³
 = 
eLJJ‘R—dy
;}

243 
šlše
 
Prš‹r
* 
	$C»©ePrš‹r
(
Sy¡emS”viûs
* 
pSS
ècÚ¡ {  
Ãw
 
	`LJJ‘R—dy
ÕSS); 
	}
}

244 
šlše
 
PRINTER_TYPE
 
	$G‘Prš‹rTy³
(ècÚ¡ {  
eLJJ‘R—dy
;
	}
}

245 
šlše
 
	$G‘Mod–B™
(ècÚ¡ {  0x1;
	}
}

249 
	gAPDK_END_NAMESPACE


	@prnt/hpijs/ljm1005.cpp

31 #ifdeà
APDK_LJM1005


33 
	~"h—d”.h
"

34 
	~"io_defs.h
"

35 
	~"´š‹½roxy.h
"

36 
	~"»sourûs.h
"

37 
	~"ljzjs.h
"

38 
	~"ljm1005.h
"

40 
APDK_BEGIN_NAMESPACE


42 
ušt32_t
 
ulM­GRAY_K_6x6x1
[9 * 9 * 9];

44 
ušt32_t
 
ulM­DJ600_CCM_K
[9 * 9 * 9];

46 
	gLJM1005
::
	$LJM1005
 (
Sy¡emS”viûs
* 
pSS
, 
numfÚts
, 
BOOL
 
´Ùo
)

47 : 
	$LJZjs
 (
pSS
, 
numfÚts
, 
´Ùo
)

50 
eP’
 = 
BLACK_PEN
;

52 
pMode
[
GRAYMODE_INDEX
] = 
Ãw
 
	`LJM1005D¿áG¿yMode
 ();

53 
pMode
[
DEFAULTMODE_INDEX
] = 
Ãw
 
	`LJM1005NÜm®G¿yMode
 ();

54 
ModeCouÁ
 = 2;

56 
CMYM­
 = 
NULL
;

57 #ifdeà 
APDK_AUTODUPLEX


58 
m_bRÙ©eBackPage
 = 
FALSE
;

60 
m_pszIÅutRa¡”D©a
 = 
NULL
;

61 
m_dwCu¼’tRa¡”
 = 0;

62 
m_cmCŞÜMode
 = 
GREY_K
;

63 
m_bS¹PageS’t
 = 
FALSE
;

64 
m_iPÏÃNumb”
 = 0;

65 
m_iBPP
 = 2;

66 
i
 = 1; i < 4; i++)

68 
m_iP
[
i
] = i - 1;

70 
m_iP
[0] = 0;

71 
m_bIamCŞÜ
 = 
FALSE
;

72 
m_iPrš‹rTy³
 = 
eLJM1005
;

73 
	}
}

75 
	gLJM1005
::~
	$LJM1005
 ()

77 
	}
}

79 
LJM1005D¿áG¿yMode
::
	$LJM1005D¿áG¿yMode
 ()

80 : 
	$G¿yMode
Ğ
ulM­GRAY_K_6x6x1
)

82 
ResŞutiÚX
[0] =

83 
ResŞutiÚY
[0] = 600;

84 
Ba£ResX
 =

85 
Ba£ResY
 = 600;

86 
MixedRes
 = 
FALSE
;

87 
bFÚtC­abË
 = 
FALSE
;

88 
theQu®™y
 = 
qu®™yD¿á
;

89 
pmQu®™y
 = 
QUALITY_DRAFT
;

90 
CÚfig
.
bCom´ess
 = 
FALSE
;

91 
	}
}

93 
	gLJM1005NÜm®G¿yMode
::
	$LJM1005NÜm®G¿yMode
 ()

94 : 
	$G¿yMode
Ğ
ulM­GRAY_K_6x6x1
)

97 
ResŞutiÚX
[0] =

98 
ResŞutiÚY
[0] = 600;

99 
Ba£ResX
 =

100 
Ba£ResY
 = 600;

101 
TextRes
 = 600;

102 
MixedRes
 = 
FALSE
;

103 
bFÚtC­abË
 = 
FALSE
;

104 
CÚfig
.
bCom´ess
 = 
FALSE
;

105 
	}
}

107 
DRIVER_ERROR
 
	gLJM1005
::
	$EnÿpsuÏ‹
 (cÚ¡ 
RASTERDATA
 *
pRa¡”D©a
, 
BOOL
 
bLa¡PÏÃ
)

109 ià(
pRa¡”D©a
 !ğ
NULL
)

111 
i
 = 0; i < 
pRa¡”D©a
->
¿¡”size
[
COLORTYPE_COLOR
]; i++)

113 
m_pszCurPŒ
[
i
*
m_iBPP
] = 
szBy‹1
[
pRa¡”D©a
->
¿¡”d©a
[
COLORTYPE_COLOR
][i]];

114 
m_pszCurPŒ
[
i
*
m_iBPP
+1] = 
szBy‹2
[
pRa¡”D©a
->
¿¡”d©a
[
COLORTYPE_COLOR
][i]];

115 
m_pszCurPŒ
[
i
*
m_iBPP
] |= (m_pszCurPtr[i*m_iBPP] >> 1);

116 
m_pszCurPŒ
[
i
*
m_iBPP
+1] |= (m_pszCurPtr[i*m_iBPP+1] >> 1);

120 
m_dwCu¼’tRa¡”
++;

121 
m_pszCurPŒ
 +ğ(
m_iBPP
 * 
m_dwWidth
);

122 ià(
m_dwCu¼’tRa¡”
 =ğ
m_dwLa¡Ra¡”
)

124 
	`JbigCom´ess
 ();

126  
NO_ERROR
;

127 
	}
}

129 
DRIVER_ERROR
 
	gLJM1005
::
	$EndPage
 ()

131 
DRIVER_ERROR
 
”r
 = 
NO_ERROR
;

132 
BYTE
 
szSŒ
[16];

134 
	`mem£t
 (
szSŒ
, 0, 16);

135 
szSŒ
[3] = 0x06;

136 
szSŒ
[11] = 0x04;

137 
”r
 = 
	`S’d
 ((cÚ¡ 
BYTE
 *è
szSŒ
, 16);

139 
m_bS¹PageS’t
 = 
FALSE
;

141 
m_dwCu¼’tRa¡”
 = 0;

142 
m_pszCurPŒ
 = 
m_pszIÅutRa¡”D©a
;

144  
”r
;

145 
	}
}

147 
DRIVER_ERROR
 
	gLJM1005
::
	$S’dPÏÃD©a
 (
iPÏÃNumb”
, 
HPLJZjsJbgEncSt
 *
£
, 
HPLJZjcBuff
 *
pcBuff
, 
BOOL
 
bLa¡SŒide
)

149 
DRIVER_ERROR
 
”r
 = 
NO_ERROR
;

150 
BYTE
 
szSŒ
[128];

151 
i
 = 0;

157 
	`mem£t
 (
szSŒ
, 0x0, 128);

158 
szSŒ
[3] = 0x05;

159 
szSŒ
[7] = 0x04;

160 
i
 = 8;

161 
i
 +ğ
	`S’dIÁI‹m
 (
szSŒ
+i, 0x80000000, 0x04, 0x40);

162 
i
 +ğ
	`S’dIÁI‹m
 (
szSŒ
+i, 0x40000000, 0x04, 0x00);

163 
i
 +ğ
	`S’dIÁI‹m
 (
szSŒ
+i, 0x40000002, 0x14, 0x00);

164 
i
 -= 4;

165 
szSŒ
[
i
++] = 
£
->
dl
;

166 
szSŒ
[
i
++] = 
£
->
d
;

167 
szSŒ
[
i
++] = 
£
->
¶ªes
;

168 
szSŒ
[
i
++] = 0;

169 
j
 = 3; j >= 0; j--)

171 
szSŒ
[
i
] = (
BYTE
è((
£
->
xd
 >> (8 * 
j
)) & 0xFF);

172 
szSŒ
[4+
i
] = (
BYTE
è((
£
->
yd
 >> (8 * 
j
)) & 0xFF);

173 
szSŒ
[8+
i
] = (
BYTE
è((
£
->
l0
 >> (8 * 
j
)) & 0xFF);

174 
i
++;

176 
i
 = 56;

177 
szSŒ
[
i
++] = 
£
->
mx
;

178 
szSŒ
[
i
++] = 
£
->
my
;

179 
szSŒ
[
i
++] = 
£
->
Üd”
;

180 
szSŒ
[
i
++] = 
£
->
İtiÚs
;

181 
i
 +ğ
	`S’dIÁI‹m
 (
szSŒ
+i, 0x80000001, 0x04, 0xDEADBEEF);

183 
BYTE
 *
p
 = 
pcBuff
->
pszCom´es£dD©a
 + 20;

184 
iD©aSize
 = 
pcBuff
->
dwTÙ®Size
 - 20;

185 
szTmpSŒ
[32];

186 
	`mem£t
 (
szTmpSŒ
, 0x0, 32);

187 
szTmpSŒ
[3] = 0x07;

188 
szTmpSŒ
[5] = 0x01;

189 
szTmpSŒ
[19] = 0x06;

190 
szTmpSŒ
[27] = 0x04;

191 
iD©aSize
 > 65536)

193 
”r
 = 
	`S’d
 ((cÚ¡ 
BYTE
 *è
szSŒ
, 
i
);

194 
ERRCHECK
;

195 
”r
 = 
	`S’d
 ((cÚ¡ 
BYTE
 *è
szTmpSŒ
, 8);

196 
ERRCHECK
;

197 
”r
 = 
	`S’d
 ((cÚ¡ 
BYTE
 *è
p
, 65536);

198 
ERRCHECK
;

199 
iD©aSize
 -= 65536;

200 
p
 += 65536;

203 ià(
iD©aSize
 > 0)

205 
”r
 = 
	`S’d
 ((cÚ¡ 
BYTE
 *è
szSŒ
, 
i
);

206 
ERRCHECK
;

207 
szTmpSŒ
[5] = (è((
iD©aSize
 >> 16) & 0xFF);

208 
szTmpSŒ
[6] = (è((
iD©aSize
 >> 8) & 0xFF);

209 
szTmpSŒ
[7] = (è(
iD©aSize
 & 0xFF);

210 
”r
 = 
	`S’d
 ((cÚ¡ 
BYTE
 *è
szTmpSŒ
, 8);

211 
ERRCHECK
;

212 
”r
 = 
	`S’d
 ((cÚ¡ 
BYTE
 *è
p
, 
iD©aSize
);

213 
ERRCHECK
;

217  
”r
;

218 
	}
}

220 
DRIVER_ERROR
 
	gLJM1005
::
	$V”ifyP’Info
()

222 
eP’
 = 
BLACK_PEN
;

223  
NO_ERROR
;

224 
	}
}

226 
DRIVER_ERROR
 
	gLJM1005
::
	$P¬£P’Info
 (
PEN_TYPE
& 
eP’
, 
BOOL
 
Qu”yPrš‹r
)

228 
eP’
 = 
BLACK_PEN
;

230  
NO_ERROR
;

231 
	}
}

233 
	gAPDK_END_NAMESPACE


	@prnt/hpijs/ljm1005.h

32 #iâdeà
APDK_LJM1005_H


33 
	#APDK_LJM1005_H


	)

35 #ifdeà
APDK_LJM1005


37 
APDK_BEGIN_NAMESPACE


42 şas 
	cLJM1005
 : 
public
 
LJZjs


44 
public
:

45 
LJM1005
 (
Sy¡emS”viûs
* 
pSS
, 
numfÚts
 = 0, 
BOOL
 
´Ùo
 = 
FALSE
);

46 ~
LJM1005
 ();

48 
vœtu®
 
DRIVER_ERROR
 
EnÿpsuÏ‹
 (cÚ¡ 
RASTERDATA
 *
pRa¡”D©a
, 
BOOL
 
bLa¡PÏÃ
);

49 
vœtu®
 
DRIVER_ERROR
 
V”ifyP’Info
 ();

50 
vœtu®
 
DRIVER_ERROR
 
P¬£P’Info
 (
PEN_TYPE
& 
eP’
, 
BOOL
 
Qu”yPrš‹r
 = 
TRUE
);

51 
vœtu®
 
BOOL
 
	$G‘M¬gšs
 (
PAPER_SIZE
 
ps
, *
fM¬gšs
)

53 
fM¬gšs
[0] = () 0.156;

54 
fM¬gšs
[1] = () 0.156;

55 
fM¬gšs
[2] = () 0.156;

56 
fM¬gšs
[3] = () 0.2;

57  
TRUE
;

60 
´Ùeùed
:

62 #ifdeà
APDK_HP_UX


63 
vœtu®
 
LJM1005
 & 
İ”©Ü
 = (
Prš‹r
& 
rhs
)

65  *
this
;

66 
	}
}

69 
	g´iv©e
:

70 
vœtu®
 
DRIVER_ERROR
 
EndPage
 ();

71 
vœtu®
 
DRIVER_ERROR
 
S’dPÏÃD©a
 (
iPÏÃNumb”
, 
HPLJZjsJbgEncSt
 *
£
, 
HPLJZjcBuff
 *
pcBuff
, 
BOOL
 
bLa¡SŒide
);

72 
vœtu®
 
	$G‘OuutResŞutiÚY
 ()

75 
	}
}

79 şas 
	cLJM1005D¿áG¿yMode
 : 
public
 
G¿yMode


81 
public
:

82 
LJM1005D¿áG¿yMode
 ();

85 şas 
	cLJM1005NÜm®G¿yMode
 : 
public
 
G¿yMode


87 
public
:

88 
LJM1005NÜm®G¿yMode
 ();

94 şas 
	cLJM1005Proxy
 : 
public
 
Prš‹rProxy


96 
public
:

97 
	$LJM1005Proxy
(è: 
	`Prš‹rProxy
(

108 è{
m_iPrš‹rTy³
 = 
eLJM1005
;}

109 
šlše
 
Prš‹r
* 
	$C»©ePrš‹r
(
Sy¡emS”viûs
* 
pSS
ècÚ¡ {  
Ãw
 
	`LJM1005
ÕSS); 
	}
}

110 
šlše
 
PRINTER_TYPE
 
	$G‘Prš‹rTy³
(ècÚ¡ {  
eLJM1005
;
	}
}

111 
šlše
 
	$G‘Mod–B™
(ècÚ¡ {  0x40;
	}
}

114 
	gAPDK_END_NAMESPACE


	@prnt/hpijs/ljmono.cpp

32 #ifdeà
APDK_LJMONO


34 
	~"h—d”.h
"

35 
	~"io_defs.h
"

36 
	~"ljmÚo.h
"

37 
	~"´š‹½roxy.h
"

38 
	~"»sourûs.h
"

40 
APDK_BEGIN_NAMESPACE


42 
ušt32_t
 
ulM­DJ600_CCM_K
[ 9 * 9 * 9 ];

44 
	gLJMÚo
::
	$LJMÚo
 (
Sy¡emS”viûs
* 
pSS
, 
numfÚts
, 
BOOL
 
´Ùo
)

45 : 
	$Prš‹r
(
pSS
, 
numfÚts
, 
´Ùo
)

48 ià((!
´Ùo
è&& (
IOMode
.
bDevID
))

50 
cÚ¡ruùÜ_”rÜ
 = 
	`V”ifyP’Info
 ();

51 
CERRCHECK
;

53 
eP’
 = 
BLACK_PEN
;

55 
pMode
[
GRAYMODE_INDEX
] = 
Ãw
 
	`LJMÚoD¿áMode
 ();

56 
pMode
[
DEFAULTMODE_INDEX
] = 
Ãw
 
	`LJMÚoNÜm®Mode
 ();

57 
pMode
[
SPECIALMODE_INDEX
] = 
Ãw
 
	`LJMÚoBe¡Mode
 ();

58 
ModeCouÁ
 = 3;

60 
CMYM­
 = 
NULL
;

61 
m_bJobS¹ed
 = 
FALSE
;

62 #ifdeà 
APDK_AUTODUPLEX


63 
m_bRÙ©eBackPage
 = 
FALSE
;

66 
	`DBG1
("LJMono created\n");

67 
	}
}

69 
	gLJMÚo
::~
	$LJMÚo
 ()

71 
DISPLAY_STATUS
 
eDi¥Stus
;

72 ià(
IOMode
.
bStus
 && 
m_bJobS¹ed
)

74 
i
 = 0; i < 5; i++)

76 
pSS
->
	`BusyWa™
 (2000);

77 
eDi¥Stus
 = 
	`P¬£E¼Ü
 (0);

78 ià(
eDi¥Stus
 =ğ
DISPLAY_PRINTING_COMPLETE
)

80 
pSS
->
	`Di¥ÏyPrš‹rStus
 (
eDi¥Stus
);

85 
	}
}

87 
	gLJMÚoD¿áMode
::
	$LJMÚoD¿áMode
 ()

88 : 
	$G¿yMode
(
ulM­DJ600_CCM_K
)

94 
ResŞutiÚX
[0] =

95 
ResŞutiÚY
[0] = 
LJ_BASE_RES
;

96 
Ba£ResX
 =

97 
Ba£ResY
 = 
LJ_BASE_RES
;

98 
MixedRes
 = 
FALSE
;

99 
bFÚtC­abË
 = 
TRUE
;

100 
theQu®™y
 = 
qu®™yD¿á
;

101 
pmQu®™y
 = 
QUALITY_DRAFT
;

102 #ifdeà
APDK_AUTODUPLEX


103 
bDu¶exC­abË
 = 
TRUE
;

105 
	}
}

107 
	gLJMÚoNÜm®Mode
::
	$LJMÚoNÜm®Mode
 ()

108 : 
	$G¿yMode
(
ulM­DJ600_CCM_K
)

113 
ResŞutiÚX
[0] =

114 
ResŞutiÚY
[0] = 
LJ_BASE_RES
 * 2;

115 
Ba£ResX
 =

116 
Ba£ResY
 = 
LJ_BASE_RES
 * 2;

117 
TextRes
 = 
LJ_BASE_RES
 * 2;

118 
MixedRes
 = 
FALSE
;

119 
bFÚtC­abË
 = 
TRUE
;

120 #ifdeà
APDK_AUTODUPLEX


121 
bDu¶exC­abË
 = 
TRUE
;

123 
	}
}

125 
	gLJMÚoBe¡Mode
::
	$LJMÚoBe¡Mode
 ()

126 : 
	$G¿yMode
(
ulM­DJ600_CCM_K
)

128 
ResŞutiÚX
[0] = 
ResŞutiÚY
[0] = 600;

129 
Ba£ResX
 = 
Ba£ResY
 = 600;

130 
TextRes
 = 600;

131 
MixedRes
 = 
FALSE
;

132 
bFÚtC­abË
 = 
TRUE
;

133 
pmQu®™y
 = 
QUALITY_BEST
;

134 #ifdeà
APDK_AUTODUPLEX


135 
bDu¶exC­abË
 = 
TRUE
;

137 
	}
}

139 
	gH—d”LJMÚo
::
	$H—d”LJMÚo
 (
Prš‹r
* 
p
,
PrštCÚ‹xt
* 
pc
)

140 : 
	$H—d”
(
p
,
pc
)

141 { 
	}
}

143 
DRIVER_ERROR
 
	gH—d”LJMÚo
::
	$S’d
 ()

145 
DRIVER_ERROR
 
”r
;

147 
	`S¹S’d
 ();

149 
”r
 = 
	`G¿phics
 ();

151  
”r
;

152 
	}
}

154 
DRIVER_ERROR
 
	gH—d”LJMÚo
::
	$S¹S’d
 ()

156 
DRIVER_ERROR
 
”r
;

157 
»s
[96];

158 
iRes
;

160 
iRes
 = 
thePrštCÚ‹xt
->
	`EfãùiveResŞutiÚY
 ();

162 
”r
 = 
thePrš‹r
->
	`S’d
((cÚ¡ 
BYTE
*)
UEL
,(UEL));

163 
ERRCHECK
;

165 
	`¥rštf
 (
»s
, "@PJL SET PAGEPROTECT=AUTO\015\012@PJL SET RESOLUTION=%d\015\012", 
iRes
);

166 
”r
 = 
thePrš‹r
->
	`S’d
 ((cÚ¡ 
BYTE
 *è
»s
, 
	`¡¾’
 (res));

167 
ERRCHECK
;

169 
”r
 = 
thePrš‹r
->
	`S’d
 ((cÚ¡ 
BYTE
 *) "@PJL SET DENSITY=5\015\012", 20);

170 
ERRCHECK
;

172 
QUALITY_MODE
 
eQ
 = 
QUALITY_NORMAL
;

173 
COLORMODE
 
eC
;

174 
MEDIATYPE
 
eM
;

175 
BOOL
 
bD
;

177 
thePrštCÚ‹xt
->
	`G‘PrštModeS‘tšgs
 (
eQ
, 
eM
, 
eC
, 
bD
);

179 ià(
eQ
 =ğ
QUALITY_DRAFT
)

181 
	`¡rıy
 (
»s
, "@PJL SET RET=OFF\015\012@PJL SET ECONOMODE=ON\015\012");

182 
”r
 = 
thePrš‹r
->
	`S’d
 ((cÚ¡ 
BYTE
 *è
»s
, 
	`¡¾’
 (res));

183 
ERRCHECK
;

186 ià(
thePrš‹r
->
IOMode
.
bStus
)

188 
	`¥rštf
 (
»s
, "@PJL JOB NAME = \"%ld\"\015\012", (è(
thePrš‹r
));

189 
”r
 = 
thePrš‹r
->
	`S’d
 ((cÚ¡ 
BYTE
 *è
»s
, 
	`¡¾’
 (res));

190 
ERRCHECK
;

192 
	`¡rıy
 (
»s
, "@PJL USTATUSOFF\015\012@PJL USTATUS DEVICE = ON\015\012@PJL USTATUS JOB = ON\015\012");

193 
”r
 = 
thePrš‹r
->
	`S’d
 ((cÚ¡ 
BYTE
 *è
»s
, 
	`¡¾’
 (res));

194 
ERRCHECK
;

199 
	`¡rıy
 (
»s
, "@PJL SET DUPLEX=OFF\015\012");

201 #ifdeà
APDK_AUTODUPLEX


202 
DUPLEXMODE
 
dupmode
 = 
thePrštCÚ‹xt
->
	`Qu”yDu¶exMode
 ();

203 ià(
dupmode
 !ğ
DUPLEXMODE_NONE
)

205 
	`¡rıy
 (
»s
, "@PJL SET DUPLEX=ON\015\012@PJL SET BINDING=");

206 ià(
dupmode
 =ğ
DUPLEXMODE_BOOK
)

207 
	`¡rÿt
 (
»s
, "LONGEDGE\015\012");

209 
	`¡rÿt
 (
»s
, "SHORTEDGE\015\012");

212 
”r
 = 
thePrš‹r
->
	`S’d
 ((cÚ¡ 
BYTE
 *è
»s
, 
	`¡¾’
 (res));

213 
ERRCHECK
;

215 
”r
 = 
thePrš‹r
->
	`S’d
 ((cÚ¡ 
BYTE
*è
EÁ”Lªguage
,  (EnterLanguage));

216 
ERRCHECK
;

218 
”r
 = 
thePrš‹r
->
	`S’d
 ((cÚ¡ 
BYTE
*) "PCL\015\012", 5);

219 
ERRCHECK
;

221 
”r
 = 
thePrš‹r
->
	`S’d
 ((cÚ¡ 
BYTE
*)
Re£t
,(Reset));

222 
ERRCHECK
;

224 
	`¥rštf
 (
»s
, "\033&l%dH", 
thePrštCÚ‹xt
->
	`G‘MedŸSourû
());

225 
”r
 = 
thePrš‹r
->
	`S’d
 ((cÚ¡ 
BYTE
 *è
»s
, 
	`¡¾’
 (res));

226 
ERRCHECK
;

230 
	`memıy
 (
»s
, 
medŸsize
, 
mscouÁ
 - 1);

231 
	`¡rıy
 (
»s
+
mscouÁ
-1, "a8c0E");

232 
”r
 = 
thePrš‹r
->
	`S’d
 ((cÚ¡ 
BYTE
 *è
»s
, 
	`¡¾’
 (res));

233 
ERRCHECK
;

235 
	`¥rštf
 (
»s
, "\033*t%dR\033&u%dD", 
iRes
, iRes);

236 
”r
 = 
thePrš‹r
->
	`S’d
 ((cÚ¡ 
BYTE
 *è
»s
, 14);

237 
ERRCHECK
;

239 
”r
 = 
	`M¬gšs
 ();

240 
ERRCHECK
;

241 
CAPy
 = 0;

245 
	`¡rıy
 (
»s
, "\033&l0S");

246 #ifdeà
APDK_AUTODUPLEX


247 
DUPLEXMODE
 
eDupMode
 = 
thePrštCÚ‹xt
->
	`Qu”yDu¶exMode
 ();

248 ià(
eDupMode
 !ğ
DUPLEXMODE_NONE
)

250 
	`¥rštf
 (
»s
, "\033&l%dS", (
eDupMode
 =ğ
DUPLEXMODE_BOOK
) ? 1 : 2);

253 
”r
 = 
thePrš‹r
->
	`S’d
 ((cÚ¡ 
BYTE
 *è
»s
, 
	`¡¾’
 (res));

254 
ERRCHECK
;

262 
”r
 = 
thePrš‹r
->
	`S’d
 ((cÚ¡ 
BYTE
 *) "\033&l0O", 5);

265 
	`¥rštf
 (
»s
, "\033&l%dX", 
thePrštCÚ‹xt
->
	`G‘CİyCouÁ
 ());

266 
”r
 = 
thePrš‹r
->
	`S’d
 ((cÚ¡ 
BYTE
 *è
»s
, 
	`¡¾’
 (res));

267 
ERRCHECK
;

269  
”r
;

270 
	}
}

272 
DRIVER_ERROR
 
	gH—d”LJMÚo
::
	$G¿phics
 ()

274 
DRIVER_ERROR
 
”rÜ
 = 
thePrš‹r
->
	`S’d
 ((cÚ¡ 
BYTE
*)
g¿fS¹
,  (grafStart) );

275 ià(
”rÜ
!=
NO_ERROR
)

276  
”rÜ
;

278 
”rÜ
ğ
thePrš‹r
->
	`S’d
((cÚ¡ 
BYTE
*è
g¿fMode2
,  (grafMode2) );

280 ià(
”rÜ
!=
NO_ERROR
)

281  
”rÜ
;

283  
”rÜ
;

284 
	}
}

286 
DRIVER_ERROR
 
	gH—d”LJMÚo
::
	$EndJob
 ()

288 
szBuff
[128];

289 
DRIVER_ERROR
 
”r
 = 
NO_ERROR
;

290 ià(
thePrš‹r
->
IOMode
.
bStus
)

292 
	`¥rštf
 (
szBuff
, "\033E\033%%-12345X@PJL EOJ NAME = \"%ld\"\015\012@PJL RESET\015\012",

293 (è(
thePrš‹r
));

294 
”r
 = 
thePrš‹r
->
	`S’d
 ((cÚ¡ 
BYTE
 *è
szBuff
, 
	`¡¾’
 (szBuff));

297 
	`¡rıy
 (
szBuff
, "\033%-12345X");

298 
”r
 = 
thePrš‹r
->
	`S’d
 ((cÚ¡ 
BYTE
 *è
szBuff
, 
	`¡¾’
 (szBuff));

300  
”r
;

301 
	}
}

303 
H—d”
* 
	gLJMÚo
::
	$S–eùH—d”
 (
PrštCÚ‹xt
* 
pc
)

305 
m_bJobS¹ed
 = 
TRUE
;

306  
Ãw
 
	`H—d”LJMÚo
 (
this
,
pc
);

307 
	}
}

309 
DRIVER_ERROR
 
	gLJMÚo
::
	$V”ifyP’Info
()

312 
DRIVER_ERROR
 
”r
 = 
NO_ERROR
;

314 if(
IOMode
.
bDevID
 =ğ
FALSE
)

316  
”r
;

319 
eP’
 = 
BLACK_PEN
;

320  
NO_ERROR
;

321 
	}
}

323 
DRIVER_ERROR
 
	gLJMÚo
::
	$P¬£P’Info
(
PEN_TYPE
& 
eP’
, 
BOOL
 
Qu”yPrš‹r
)

326 
eP’
 = 
BLACK_PEN
;

328  
NO_ERROR
;

329 
	}
}

331 
Com´essÜ
* 
	gLJMÚo
::
	$C»©eCom´essÜ
 (
Ra¡”Size
)

333  
Ãw
 
	`Mode2
 (
pSS
,
Ra¡”Size
);

334 
	}
}

336 
DISPLAY_STATUS
 
	gLJMÚo
::
	$P¬£E¼Ü
 (
BYTE
 
¡©us_»g
)

338 
	`DBG1
("LJMono:…arsingƒrror info\n");

340 
DRIVER_ERROR
 
”r
 = 
NO_ERROR
;

341 
BYTE
 
szR—dBuff
[256];

342 
DWORD
 
iR—dCouÁ
 = 256;

343 
DISPLAY_STATUS
 
eStus
 = (DISPLAY_STATUSè
¡©us_»g
;

344 *
tmpSŒ
;

345 
iE¼ÜCode
;

347 ià(!
IOMode
.
bDevID
)

348  
eStus
;

350 
	`mem£t
 (
szR—dBuff
, 0, 256);

351 
”r
 = 
pSS
->
	`FromDeviû
 (
szR—dBuff
, &
iR—dCouÁ
);

352 ià(
”r
 =ğ
NO_ERROR
 && 
iR—dCouÁ
 == 0)

353  
eStus
;

355 ià(
	`¡r¡r
 ((*è
szR—dBuff
, "JOB"))

357 ià(!(
tmpSŒ
 = 
	`¡r¡r
 ((*è
szR—dBuff
, "NAME")))

358  
DISPLAY_PRINTING
;

359 
tmpSŒ
 += 6;

360 *
tmpSŒ
 < '0' || *tmpStr > '9')

361 
tmpSŒ
++;

362 
	`ssÿnf
 (
tmpSŒ
, "%d", &
iE¼ÜCode
);

363 ià(
iE¼ÜCode
 !ğ(è(
this
))

364  
DISPLAY_PRINTING
;

367 ià(
	`¡r¡r
 ((*è
szR—dBuff
, "END"))

369  
DISPLAY_PRINTING_COMPLETE
;

373 ià(
	`¡r¡r
 ((*è
szR—dBuff
, "CANCEL"))

374  
DISPLAY_PRINTING_CANCELED
;

376 ià(!(
tmpSŒ
 = 
	`¡r¡r
 ((*è
szR—dBuff
, "CODE")))

377  
eStus
;

379 
tmpSŒ
 += 4;

380 *
tmpSŒ
 < '0' || *tmpStr > '9')

381 
tmpSŒ
++;

382 
	`ssÿnf
 (
tmpSŒ
, "%d", &
iE¼ÜCode
);

384 ià(
iE¼ÜCode
 < 32000)

385  
DISPLAY_PRINTING
;

387 ià(
iE¼ÜCode
 == 40010 || iErrorCode == 40020)

388  
DISPLAY_NO_PENS
;

390 ià(
iE¼ÜCode
 == 40021)

391  
DISPLAY_TOP_COVER_OPEN
;

393 ià((
iE¼ÜCode
 / 100) == 419)

394  
DISPLAY_OUT_OF_PAPER
;

396 ià((
iE¼ÜCode
 / 1000) == 42 || iErrorCode == 40022)

398 
	`DBG1
("Paper Jammed\n");

399  
DISPLAY_PAPER_JAMMED
;

402 ià(
iE¼ÜCode
 > 40049 && iErrorCode < 41000)

404 
	`DBG1
("IOrap\n");

405  
DISPLAY_ERROR_TRAP
;

408 ià(
iE¼ÜCode
 == 40079)

409  
DISPLAY_OFFLINE
;

411  
DISPLAY_ERROR_TRAP
;

412 
	}
}

414 
	gAPDK_END_NAMESPACE


	@prnt/hpijs/ljmono.h

32 #iâdeà
APDK_LJMONO_H


33 
	#APDK_LJMONO_H


	)

35 
	gAPDK_BEGIN_NAMESPACE


37 #ifdeà 
APDK_HIGH_RES_MODES


38 
	#LJ_BASE_RES
 300

	)

40 
	#LJ_BASE_RES
 150

	)

46 şas 
	cLJMÚo
 : 
public
 
Prš‹r


48 
public
:

49 
LJMÚo
 (
Sy¡emS”viûs
* 
pSS
,
numfÚts
=0, 
BOOL
 
´Ùo
=
FALSE
);

50 ~
LJMÚo
 ();

52 
vœtu®
 
H—d”
* 
S–eùH—d”
 (
PrštCÚ‹xt
* 
pc
);

53 
vœtu®
 
DRIVER_ERROR
 
V”ifyP’Info
 ();

54 
vœtu®
 
DRIVER_ERROR
 
P¬£P’Info
 (
PEN_TYPE
& 
eP’
, 
BOOL
 
Qu”yPrš‹r
=
TRUE
);

55 
vœtu®
 
DISPLAY_STATUS
 
P¬£E¼Ü
 (
BYTE
 
¡©us_»g
);

56 
vœtu®
 
DRIVER_ERROR
 
	$Flush
 (
FlushSize
)

58  
NO_ERROR
;

61 
vœtu®
 
BOOL
 
	$G‘M¬gšs
 (
PAPER_SIZE
 
ps
, *
fM¬gšs
)

63 
fM¬gšs
[0] = () 0.25;

64 
fM¬gšs
[1] = () 0.25;

65 
fM¬gšs
[2] = () 0.2;

66 
fM¬gšs
[3] = () 0.2;

67  
TRUE
;

68 
	}
}

70 #ifdeà
APDK_AUTODUPLEX


79 
vœtu®
 
BOOL
 
	$HagakiF“dDu¶ex”P»£Á
 (
BOOL
 
bQu”yPrš‹r
)

81  
TRUE
;

82 
	}
}

85 
Com´essÜ
* 
C»©eCom´essÜ
 (
Ra¡”Size
);

87 
	g´Ùeùed
:

89 #ifdeà
APDK_HP_UX


90 
vœtu®
 
LJMÚo
 & 
İ”©Ü
 = (
Prš‹r
& 
rhs
)

92  *
this
;

96 
BOOL
 
	gm_bJobS¹ed
;

100 şas 
	cLJMÚoD¿áMode
 : 
public
 
G¿yMode


102 
public
:

103 
LJMÚoD¿áMode
 ();

106 şas 
	cLJMÚoNÜm®Mode
 : 
public
 
G¿yMode


108 
public
:

109 
LJMÚoNÜm®Mode
 ();

112 şas 
	cLJMÚoBe¡Mode
 : 
public
 
G¿yMode


114 
public
:

115 
LJMÚoBe¡Mode
 ();

118 #ifdeà
APDK_LJMONO


122 şas 
	cLJMÚoProxy
 : 
public
 
Prš‹rProxy


124 
public
:

125 
	$LJMÚoProxy
(è: 
	`Prš‹rProxy
(

129 #ifdeà
APDK_MLC_PRINTER


131 è{
m_iPrš‹rTy³
 = 
eLJMÚo
;}

132 
šlše
 
Prš‹r
* 
	$C»©ePrš‹r
(
Sy¡emS”viûs
* 
pSS
ècÚ¡ {  
Ãw
 
	`LJMÚo
ÕSS); 
	}
}

133 
šlše
 
PRINTER_TYPE
 
	$G‘Prš‹rTy³
(ècÚ¡ {  
eLJMÚo
;
	}
}

134 
šlše
 
	$G‘Mod–B™
(ècÚ¡ {  0x40;
	}
}

138 
	gAPDK_END_NAMESPACE


	@prnt/hpijs/ljp1xxx.h

32 #iâdeà
APDK_LJP1XXX_H


33 
	#APDK_LJP1XXX_H


	)

35 #ifdeà
APDK_LJM1005


37 
APDK_BEGIN_NAMESPACE


39 
ušt32_t
 
ulM­GRAY_K_6x6x1
[9 * 9 * 9];

41 şas 
	cLJP1XXXBe¡G¿yMode
 : 
public
 
G¿yMode


43 
public
:

44 
	$LJP1XXXBe¡G¿yMode
 (è: 
	$G¿yMode
 (
ulM­GRAY_K_6x6x1
)

49 
ResŞutiÚX
[0] =

50 
ResŞutiÚY
[0] = 600;

51 
Ba£ResX
 =

52 
Ba£ResY
 = 600;

53 
TextRes
 = 600;

54 
MixedRes
 = 
FALSE
;

55 
bFÚtC­abË
 = 
FALSE
;

56 
CÚfig
.
bCom´ess
 = 
FALSE
;

57 
theQu®™y
 = 
qu®™yP»£Á©iÚ
;

58 
pmQu®™y
 = 
QUALITY_BEST
;

60 
	}
};

65 şas 
	cLJP1XXX
 : 
public
 
LJM1005


67 
public
:

68 
	$LJP1XXX
 (
Sy¡emS”viûs
* 
pSS
, 
numfÚts
 = 0, 
BOOL
 
´Ùo
 = 
FALSE
è: 
	$LJM1005
 (
pSS
)

70 
pMode
[
ModeCouÁ
] = 
Ãw
 
	`LJP1XXXBe¡G¿yMode
 ();

71 
ModeCouÁ
++;

73 
´Ùeùed
:

75 #ifdeà
APDK_HP_UX


76 
vœtu®
 
LJP1XXX
 & 
İ”©Ü
 = (
Prš‹r
& 
rhs
)

78  *
this
;

79 
	}
}

82 
	g´iv©e
:

83 
	$G‘OuutResŞutiÚY
 ()

86 
	}
}

92 şas 
	cLJP1XXXProxy
 : 
public
 
Prš‹rProxy


94 
public
:

95 
	$LJP1XXXProxy
(è: 
	`Prš‹rProxy
(

102 è{
m_iPrš‹rTy³
 = 
eLJP1XXX
;}

103 
šlše
 
Prš‹r
* 
	$C»©ePrš‹r
(
Sy¡emS”viûs
* 
pSS
ècÚ¡ {  
Ãw
 
	`LJP1XXX
ÕSS); 
	}
}

104 
šlše
 
PRINTER_TYPE
 
	$G‘Prš‹rTy³
(ècÚ¡ {  
eLJP1XXX
;
	}
}

105 
šlše
 
	$G‘Mod–B™
(ècÚ¡ {  0x40;
	}
}

108 
	gAPDK_END_NAMESPACE


	@prnt/hpijs/ljzjs.cpp

32 #ià
defšed
 (
APDK_LJZJS_MONO
è|| defšed (
APDK_LJZJS_COLOR
è|| defšed (
APDK_LJM1005
)

34 
	~"h—d”.h
"

35 
	~"io_defs.h
"

36 
	~"´š‹½roxy.h
"

37 
	~"»sourûs.h
"

38 
	~"ljzjs.h
"

39 #ifdeà
HAVE_LIBDL


40 
	~<dlfú.h
>

45 (*
HPLJJBGCom´ess
è(
iWidth
, 
iHeight
, **
pBuff
,

46 
HPLJZjcBuff
 *
pOutBuff
, 
HPLJZjsJbgEncSt
 *
pJbgEncSt
);

47 (*
HPLJSoIn™
è(
iFÏg
);

50 
APDK_BEGIN_NAMESPACE


52 #ifdeà
HAVE_LIBDL


53 *
LßdPlugš
 (cÚ¡ *
szPlugšName
);

56 cÚ¡ 
	gLJZjs
::
szBy‹1
[256] =

81 cÚ¡ 
	gLJZjs
::
szBy‹2
[256] =

107 
	gLJZjs
::
	$LJZjs
 (
Sy¡emS”viûs
* 
pSS
, 
numfÚts
, 
BOOL
 
´Ùo
)

108 : 
	$Prš‹r
(
pSS
, 
numfÚts
, 
´Ùo
)

111 
CMYM­
 = 
NULL
;

112 #ifdeà 
APDK_AUTODUPLEX


113 
m_bRÙ©eBackPage
 = 
FALSE
;

115 
m_pszIÅutRa¡”D©a
 = 
NULL
;

116 
m_dwCu¼’tRa¡”
 = 0;

117 
m_bS¹PageS’t
 = 
FALSE
;

118 
HPLJJBGCom´ess
 = 
NULL
;

119 
m_hHPLibHªdË
 = 
NULL
;

120 
m_iPrš‹rTy³
 = 
UNSUPPORTED
;

121 #ifdeà
HAVE_LIBDL


122 
m_hHPLibHªdË
 = 
	`LßdPlugš
 ("lj.so");

123 ià(
m_hHPLibHªdË
)

125 
	`dË¼Ü
 ();

126 *(**è(&
HPLJJBGCom´ess
èğ
	`dlsym
 (
m_hHPLibHªdË
, "hp_encode_bits_to_jbig");

127 *(**è(&
HPLJSoIn™
èğ
	`dlsym
 (
m_hHPLibHªdË
, "hp_init_lib");

128 ià(!
HPLJSoIn™
 || (HPLJSoIn™ && !
	`HPLJSoIn™
 (1)))

130 
cÚ¡ruùÜ_”rÜ
 = 
PLUGIN_LIBRARY_MISSING
;

134 ià(
HPLJJBGCom´ess
 =ğ
NULL
)

136 
cÚ¡ruùÜ_”rÜ
 = 
PLUGIN_LIBRARY_MISSING
;

143 
m_bLJZjsCŞÜ2Prš‹r
 = 
FALSE
;

145 
	}
}

147 
	gLJZjs
::~
	$LJZjs
 ()

149 #ifdeà
HAVE_LIBDL


150 ià(
m_hHPLibHªdË
)

152 
	`dlşo£
 (
m_hHPLibHªdË
);

155 ià(
m_pszIÅutRa¡”D©a
)

157 
d–‘e
 [] 
m_pszIÅutRa¡”D©a
;

159 
	}
}

161 
	gH—d”LJZjs
::
	$H—d”LJZjs
 (
Prš‹r
* 
p
,
PrštCÚ‹xt
* 
pc
)

162 : 
	$H—d”
(
p
,
pc
)

164 
	}
}

166 
DRIVER_ERROR
 
	gH—d”LJZjs
::
	$S’d
 ()

168 
DRIVER_ERROR
 
”r
 = 
NO_ERROR
;

169 
szSŒ
[256];

170 
WORD
 
wI‹ms
[3] = {
ZJI_DMCOLLATE
, 
ZJI_PAGECOUNT
, 
ZJI_DMDUPLEX
};

171 
i
 = 4;

173 
QUALITY_MODE
 
eQu®™y
;

174 
MEDIATYPE
 
cmt
;

175 
BOOL
 
cdt
;

176 
COLORMODE
 
ccm
;

177 
thePrštCÚ‹xt
->
	`G‘PrštModeS‘tšgs
 (
eQu®™y
, 
cmt
, 
ccm
, 
cdt
);

179 ià(((
LJZjs
 *è
thePrš‹r
)->
m_iPrš‹rTy³
 =ğ
eLJM1005
)

181 
	`¡rıy
 (
szSŒ
, "\x1B\x25-12345X@PJL JOB\x0D\x0A");

182 
	`¡rıy
 (
szSŒ
+
	`¡¾’
 (szStr), "@PJL SET JAMRECOVERY=OFF\x0D\x0A");

183 
	`¡rıy
 (
szSŒ
+
	`¡¾’
 (szStr), "@PJL SET DENSITY=3\x0D\x0A");

184 
	`¡rıy
 (
szSŒ
+
	`¡¾’
 (szStr), "@PJL SET RET=MEDIUM\x0D\x0A");

185 
	`¡rıy
 (
szSŒ
+
	`¡¾’
 (szStr), "@PJL SET ECONOMODE=");

186 ià(
eQu®™y
 =ğ
QUALITY_DRAFT
)

188 
	`¡rıy
 (
szSŒ
+
	`¡¾’
 (szStr), "ON\x0D\x0A");

192 
	`¡rıy
 (
szSŒ
+
	`¡¾’
 (szStr), "OFF\x0D\x0A");

194 
”r
 = 
thePrš‹r
->
	`S’d
 ((cÚ¡ 
BYTE
 *è
szSŒ
, 
	`¡¾’
 (szStr));

195 
ERRCHECK
;

197 
	`¡rıy
 (
szSŒ
, "\x1B\x25-12345X,XQX");

198 
”r
 = 
thePrš‹r
->
	`S’d
 ((cÚ¡ 
BYTE
 *è
szSŒ
, 
	`¡¾’
 (szStr));

199 
	`mem£t
 (
szSŒ
, 0x0, 92);

200 
szSŒ
[3] = 0x01;

201 
szSŒ
[7] = 0x07;

202 
i
 = 8;

203 
i
 +ğ((
LJZjs
 *è
thePrš‹r
)->
	`S’dIÁI‹m
 ((
BYTE
 *è
szSŒ
+i, 0x80000000, 0x04, 0x54);

204 
i
 +ğ((
LJZjs
 *è
thePrš‹r
)->
	`S’dIÁI‹m
 ((
BYTE
 *è
szSŒ
+i, 0x10000005, 0x04, 0x01);

205 
i
 +ğ((
LJZjs
 *è
thePrš‹r
)->
	`S’dIÁI‹m
 ((
BYTE
 *è
szSŒ
+i, 0x10000001, 0x04, 0x00);

206 
i
 +ğ((
LJZjs
 *è
thePrš‹r
)->
	`S’dIÁI‹m
 ((
BYTE
 *è
szSŒ
+i, 0x10000002, 0x04, 0x00);

207 
i
 +ğ((
LJZjs
 *è
thePrš‹r
)->
	`S’dIÁI‹m
 ((
BYTE
 *è
szSŒ
+i, 0x10000000, 0x04, 0x00);

208 
i
 +ğ((
LJZjs
 *è
thePrš‹r
)->
	`S’dIÁI‹m
 ((
BYTE
 *è
szSŒ
+i, 0x10000003, 0x04, 0x01);

209 
i
 +ğ((
LJZjs
 *è
thePrš‹r
)->
	`S’dIÁI‹m
 ((
BYTE
 *è
szSŒ
+i, 0x80000001, 0x04, 0xDEADBEEF);

210 
”r
 = 
thePrš‹r
->
	`S’d
 ((cÚ¡ 
BYTE
 *è
szSŒ
, 
i
);

211  
”r
;

214 
	`¡rıy
 (
szSŒ
, "\x1B\x25-12345X@PJL ENTER LANGUAGE=ZJS\x0A");

215 
”r
 = 
thePrš‹r
->
	`S’d
 ((cÚ¡ 
BYTE
 *è
szSŒ
, 
	`¡¾’
 (szStr));

216 
ERRCHECK
;

218 
	`mem£t
 (
szSŒ
, 0, 256);

220 
	`¡rıy
 (
szSŒ
, "JZJZ");

221 
i
 = 0;

222 
szSŒ
[
i
+7] = 52;

223 
szSŒ
[
i
+11] = 
ZJT_START_DOC
;

224 
szSŒ
[
i
+15] = 3;

225 
szSŒ
[
i
+17] = 36;

226 
szSŒ
[
i
+18] = 'Z';

227 
szSŒ
[
i
+19] = 'Z';

229 
i
 += 20;

230 
j
 = 0; j < 3; j++)

232 
szSŒ
[
i
+3] = 12;

233 
szSŒ
[
i
+5] = (è
wI‹ms
[
j
];

234 
szSŒ
[
i
+6] = 
ZJIT_UINT32
;

235 
szSŒ
[
i
+11] = 
j
 / 2;

236 
i
 += 12;

238 
”r
 = 
thePrš‹r
->
	`S’d
 ((cÚ¡ 
BYTE
 *è
szSŒ
, 
i
);

239  
”r
;

240 
	}
}

242 
	gLJZjs
::
	$M­P­”Size
 ()

244 
thePrštCÚ‹xt
->
	`G‘P­”Size
 ())

246 
LETTER
:  1;

247 
LEGAL
:  5;

248 
A4
:  9;

249 
B4
:  12;

250 
B5
:  357;

251 
OUFUKU
:  43;

252 
HAGAKI
:  43;

253 #ifdeà
APDK_EXTENDED_MEDIASIZE


254 
A3
:  8;

255 
A5
:  11;

257 
EXECUTIVE
:  7;

259 
ENVELOPE_NO_10
:  20;

260 
ENVELOPE_DL
:  27;

261 
FLSA
:  258;

265 
	}
}

267 
DRIVER_ERROR
 
	gLJZjs
::
	$S¹Page
 (
DWORD
 
dwWidth
, DWORD 
dwHeight
)

269 
DRIVER_ERROR
 
”r
 = 
NO_ERROR
;

270 
QUALITY_MODE
 
cqm
;

271 
MEDIATYPE
 
cmt
;

272 
BOOL
 
cdt
;

273 
DWORD
 
dwNumI‹ms
 = (
m_bIamCŞÜ
) ? 15 : 14;

274 
BYTE
 
szSŒ
[16 + 15 * 12];

275 
iPÏÃs
 = 1;

276 
i
;

277 
iMedŸTy³
 = 1;

279 ià(
m_bS¹PageS’t
)

281  
NO_ERROR
;

283 
m_bS¹PageS’t
 = 
TRUE
;

284 
”r
 = 
thePrštCÚ‹xt
->
	`G‘PrštModeS‘tšgs
 (
cqm
, 
cmt
, 
m_cmCŞÜMode
, 
cdt
);

285 ià(
cmt
 =ğ
MEDIA_TRANSPARENCY
)

287 
iMedŸTy³
 = 2;

289 ià(
cmt
 =ğ
MEDIA_PHOTO
)

291 
iMedŸTy³
 = 3;

294 ià(
m_iPrš‹rTy³
 =ğ
eLJM1005
)

296 
iOuutResŞutiÚ
 = 
	`G‘OuutResŞutiÚY
 ();

297 ià(
cqm
 =ğ
QUALITY_BEST
)

298 
iOuutResŞutiÚ
 = (è
thePrštCÚ‹xt
->
	`EfãùiveResŞutiÚY
 ();

299 
	`mem£t
 (
szSŒ
, 0x0,  (szStr));

300 
szSŒ
[3] = 0x03;

301 
szSŒ
[7] = 0x0F;

302 
”r
 = 
	`S’d
 ((cÚ¡ 
BYTE
 *è
szSŒ
, 8);

303 
i
 = 0;

304 
i
 +ğ
	`S’dIÁI‹m
 (
szSŒ
+i, 0x80000000, 0x04, 0xB4);

305 
i
 +ğ
	`S’dIÁI‹m
 (
szSŒ
+i, 0x20000005, 0x04, 0x01);

306 
i
 +ğ
	`S’dIÁI‹m
 (
szSŒ
+i, 0x20000006, 0x04, 0x07);

307 
i
 +ğ
	`S’dIÁI‹m
 (
szSŒ
+i, 0x20000000, 0x04, 0x01);

308 
i
 +ğ
	`S’dIÁI‹m
 (
szSŒ
+i, 0x20000007, 0x04, 0x01);

309 
i
 +ğ
	`S’dIÁI‹m
 (
szSŒ
+i, 0x20000008, 0x04, (è
thePrštCÚ‹xt
->
	`EfãùiveResŞutiÚX
 ());

310 
i
 +ğ
	`S’dIÁI‹m
 (
szSŒ
+i, 0x20000009, 0x04, 
iOuutResŞutiÚ
);

311 
i
 +ğ
	`S’dIÁI‹m
 (
szSŒ
+i, 0x2000000D, 0x04, (è
dwWidth
);

312 
i
 +ğ
	`S’dIÁI‹m
 (
szSŒ
+i, 0x2000000E, 0x04, (è
m_dwLa¡Ra¡”
);

313 
i
 +ğ
	`S’dIÁI‹m
 (
szSŒ
+i, 0x2000000A, 0x04, 
m_iBPP
);

314 
i
 +ğ
	`S’dIÁI‹m
 (
szSŒ
+i, 0x2000000F, 0x04, (è
dwWidth
/
m_iBPP
);

315 
i
 +ğ
	`S’dIÁI‹m
 (
szSŒ
+i, 0x20000010, 0x04, (è
m_dwLa¡Ra¡”
);

316 
i
 +ğ
	`S’dIÁI‹m
 (
szSŒ
+i, 0x20000011, 0x04, 0x01);

317 
i
 +ğ
	`S’dIÁI‹m
 (
szSŒ
+i, 0x20000001, 0x04, 
	`M­P­”Size
 ());

318 
i
 +ğ
	`S’dIÁI‹m
 (
szSŒ
+i, 0x80000001, 0x04, 0xDEADBEEF);

319 
”r
 = 
	`S’d
 ((cÚ¡ 
BYTE
 *è
szSŒ
, 
i
);

320  
”r
;

323 if(
m_bLJZjsCŞÜ2Prš‹r
)

325 
dwNumI‹ms
 = 13;

327 ià(
m_cmCŞÜMode
 =ğ
COLOR
 && 
m_bIamCŞÜ
)

329 
iPÏÃs
 = 4;

332 
i
 = 0;

333 
i
 +ğ
	`S’dChunkH—d”
 (
szSŒ
, 16 + 
dwNumI‹ms
 * 12, 
ZJT_START_PAGE
, dwNumItems);

335 ià(
m_bIamCŞÜ
)

337 
i
 +ğ
	`S’dI‹m
 (
szSŒ
+i, 
ZJIT_UINT32
, 
ZJI_PLANE
, 
iPÏÃs
);

339 
i
 +ğ
	`S’dI‹m
 (
szSŒ
+i, 
ZJIT_UINT32
, 
ZJI_DMPAPER
, 
	`M­P­”Size
 ());

340 
i
 +ğ
	`S’dI‹m
 (
szSŒ
+i, 
ZJIT_UINT32
, 
ZJI_DMCOPIES
, 
thePrštCÚ‹xt
->
	`G‘CİyCouÁ
 ());

341 
i
 +ğ
	`S’dI‹m
 (
szSŒ
+i, 
ZJIT_UINT32
, 
ZJI_DMDEFAULTSOURCE
, 
thePrštCÚ‹xt
->
	`G‘MedŸSourû
 ());

342 
i
 +ğ
	`S’dI‹m
 (
szSŒ
+i, 
ZJIT_UINT32
, 
ZJI_DMMEDIATYPE
, 
iMedŸTy³
);

343 
i
 +ğ
	`S’dI‹m
 (
szSŒ
+i, 
ZJIT_UINT32
, 
ZJI_NBIE
, 
iPÏÃs
);

344 
i
 +ğ
	`S’dI‹m
 (
szSŒ
+i, 
ZJIT_UINT32
, 
ZJI_RESOLUTION_X
, 
thePrštCÚ‹xt
->
	`EfãùiveResŞutiÚX
 ());

345 
i
 +ğ
	`S’dI‹m
 (
szSŒ
+i, 
ZJIT_UINT32
, 
ZJI_RESOLUTION_Y
, 
thePrštCÚ‹xt
->
	`EfãùiveResŞutiÚY
 ());

346 
i
 +ğ
	`S’dI‹m
 (
szSŒ
+i, 
ZJIT_UINT32
, 
ZJI_RASTER_X
, 
dwWidth
);

347 
i
 +ğ
	`S’dI‹m
 (
szSŒ
+i, 
ZJIT_UINT32
, 
ZJI_RASTER_Y
, 
m_dwLa¡Ra¡”
);

348 
i
 +ğ
	`S’dI‹m
 (
szSŒ
+i, 
ZJIT_UINT32
, 
ZJI_VIDEO_BPP
, 
m_iBPP
);

349 
i
 +ğ
	`S’dI‹m
 (
szSŒ
+i, 
ZJIT_UINT32
, 
ZJI_VIDEO_X
, 
dwWidth
/
m_iBPP
);

350 
i
 +ğ
	`S’dI‹m
 (
szSŒ
+i, 
ZJIT_UINT32
, 
ZJI_VIDEO_Y
, 
m_dwLa¡Ra¡”
);

351 if(!
m_bLJZjsCŞÜ2Prš‹r
)

353 
i
 +ğ
	`S’dI‹m
 (
szSŒ
+i, 
ZJIT_UINT32
, 
ZJI_RET
, 
RET_ON
);

354 
i
 +ğ
	`S’dI‹m
 (
szSŒ
+i, 
ZJIT_UINT32
, 
ZJI_TONER_SAVE
, (
cqm
 =ğ
QUALITY_DRAFT
) ? 1 : 0);

357 
”r
 = 
	`S’d
 ((cÚ¡ 
BYTE
 *è
szSŒ
, 
i
);

358  
”r
;

359 
	}
}

361 
	gLJZjs
::
	$S’dChunkH—d”
 (
BYTE
 *
szSŒ
, 
DWORD
 
dwSize
, DWORD 
dwChunkTy³
, DWORD 
dwNumI‹ms
)

363 
j
 = 3, 
i
 = 0; j >= 0; j--)

365 
szSŒ
[
i
] = (
BYTE
è((
dwSize
 >> (8 * (
j
))) & 0xFF);

366 
szSŒ
[4+
i
] = (
BYTE
è((
dwChunkTy³
 >> (8 * (
j
))) & 0xFF);

367 
szSŒ
[8+
i
] = (
BYTE
è((
dwNumI‹ms
 >> (8 * (
j
))) & 0xFF);

368 
i
++;

371 
szSŒ
[12] = (
BYTE
è(((
dwNumI‹ms
 * 12) & 0xFF00) >> 8);

372 
szSŒ
[13] = (
BYTE
è(((
dwNumI‹ms
 * 12) & 0x00FF));

374 
szSŒ
[14] = 'Z';

375 
szSŒ
[15] = 'Z';

377 
	}
}

379 
	gLJZjs
::
	$S’dI‹m
 (
BYTE
 *
szSŒ
, BYTE 
cTy³
, 
WORD
 
wI‹m
, 
DWORD
 
dwV®ue
, DWORD 
dwExŒa
)

381 
i
, 
j
;

382 
dwExŒa
 += 12;

383 
j
 = 3, 
i
 = 0; j >= 0; j--)

385 
szSŒ
[
i
++] = (
BYTE
è((
dwExŒa
 >> (8 * (
j
))) & 0xFF);

387 
szSŒ
[
i
++] = (
BYTE
è((
wI‹m
 & 0xFF00) >> 8);

388 
szSŒ
[
i
++] = (
BYTE
è((
wI‹m
 & 0x00FF));

389 
szSŒ
[
i
++] = (
BYTE
è
cTy³
;

390 
szSŒ
[
i
++] = 0;

391 
j
 = 3; j >= 0; j--)

393 
szSŒ
[
i
++] = (
BYTE
è((
dwV®ue
 >> (8 * (
j
))) & 0xFF);

395  
i
;

396 
	}
}

398 
	gLJZjs
::
	$S’dIÁI‹m
 (
BYTE
 *
szSŒ
, 
iI‹m
, 
iI‹mTy³
, 
iI‹mV®ue
)

400 
i
 = 0;

401 
j
;

402 
j
 = 3; j >= 0; j--)

404 
szSŒ
[
i
++] = (
BYTE
è((
iI‹m
 >> (8 * (
j
))) & 0xFF);

406 
j
 = 3; j >= 0; j--)

408 
szSŒ
[
i
++] = (
BYTE
è((
iI‹mTy³
 >> (8 * (
j
))) & 0xFF);

410 
j
 = 3; j >= 0; j--)

412 
szSŒ
[
i
++] = (
BYTE
è((
iI‹mV®ue
 >> (8 * (
j
))) & 0xFF);

414  
i
;

415 
	}
}

417 
DRIVER_ERROR
 
	gLJZjs
::
	$SkRa¡”s
 (
iBÏnkRa¡”s
)

419 
DRIVER_ERROR
 
”r
 = 
NO_ERROR
;

420 
BOOL
 
bLa¡PÏÃ
;

421 
iPÏÃs
 = (
m_cmCŞÜMode
 =ğ
COLOR
) ? 4 : 1;

422 
i
 = 1; i <ğ
iPÏÃs
; i++)

424 
bLa¡PÏÃ
 = (
i
 =ğ
iPÏÃs
è? 
TRUE
 : 
FALSE
;

425 
j
 = 0; j < 
iBÏnkRa¡”s
; j++)

427 
”r
 = 
this
->
	`EnÿpsuÏ‹
 (
NULL
, 
bLa¡PÏÃ
);

430  
”r
;

431 
	}
}

433 
DRIVER_ERROR
 
	gH—d”LJZjs
::
	$FÜmF“d
 ()

435 
DRIVER_ERROR
 
”r
 = 
NO_ERROR
;

437 
”r
 = 
thePrš‹r
->
	`Flush
 (0);

439  
”r
;

440 
	}
}

442 
DRIVER_ERROR
 
	gH—d”LJZjs
::
	$S’dCAPy
 (
iAbsY
)

444  
NO_ERROR
;

445 
	}
}

447 
DRIVER_ERROR
 
	gLJZjs
::
	$Flush
 (
FlushSize
)

449 
DRIVER_ERROR
 
”r
 = 
NO_ERROR
;

450 ià(
m_dwCu¼’tRa¡”
 == 0)

452  
NO_ERROR
;

454 
”r
 = 
	`SkRa¡”s
 ((
m_dwLa¡Ra¡”
 - 
m_dwCu¼’tRa¡”
));

455  
”r
;

456 
	}
}

458 
DRIVER_ERROR
 
	gLJZjs
::
	$JbigCom´ess
 ()

460 
DRIVER_ERROR
 
”r
 = 
NO_ERROR
;

461 
HPLJZjcBuff
 
myBufãr
;

462 
iPÏÃs
 = (
m_cmCŞÜMode
 =ğ
COLOR
) ? 4 : 1;

463 
iInü
 = (
m_bIamCŞÜ
è? 100 : 
m_dwLa¡Ra¡”
;

465 
HPLJZjsJbgEncSt
 
£
;

466 
BYTE
 *
b™m­s
[4] =

468 
m_pszIÅutRa¡”D©a
,

469 
m_pszIÅutRa¡”D©a
 + (
m_dwWidth
 * 
m_iBPP
 * 
m_dwLa¡Ra¡”
),

470 
m_pszIÅutRa¡”D©a
 + (
m_dwWidth
 * 
m_iBPP
 * 
m_dwLa¡Ra¡”
 * 2),

471 
m_pszIÅutRa¡”D©a
 + (
m_dwWidth
 * 
m_iBPP
 * 
m_dwLa¡Ra¡”
 * 3)

473 
myBufãr
.
pszCom´es£dD©a
 = 
Ãw
 
BYTE
[
m_dwWidth
 * 
m_dwLa¡Ra¡”
 * 
m_iBPP
];

474 
myBufãr
.
dwTÙ®Size
 = 0;

476 
BYTE
 *
p
;

477 
iHeight
;

478 
DWORD
 
y
 = 0; y < 
m_dwLa¡Ra¡”
; y +ğ
iInü
)

480 
i
 = 0; i < 
iPÏÃs
; i++)

482 
	`mem£t
 (
myBufãr
.
pszCom´es£dD©a
, 0, 
m_dwWidth
 * 
m_dwLa¡Ra¡”
 * 
m_iBPP
);

483 
myBufãr
.
dwTÙ®Size
 = 0;

484 
p
 = 
b™m­s
[
i
] + (
y
 * 
m_dwWidth
 * 
m_iBPP
);

485 
iHeight
 = 
iInü
;

486 ià(
y
 + 
iInü
 > 
m_dwLa¡Ra¡”
)

488 
iHeight
 = 
m_dwLa¡Ra¡”
 - 
y
;

491 
	`HPLJJBGCom´ess
 (
m_dwWidth
 * 8 * 
m_iBPP
, 
iHeight
, &
p
, &
myBufãr
, &
£
);

493 ià(
i
 == 0)

495 
	`S¹Page
 (
£
.
xd
, se.
yd
);

497 
”r
 = 
this
->
	`S’dPÏÃD©a
 (
i
 + 1, &
£
, &
myBufãr
, (
y
 + 
iInü
è>ğ
m_dwLa¡Ra¡”
);

501 
d–‘e
 [] 
myBufãr
.
pszCom´es£dD©a
;

502 
m_dwCu¼’tRa¡”
 = 0;

503 
m_pszCurPŒ
 = 
m_pszIÅutRa¡”D©a
;

504 
	`mem£t
 (
m_pszCurPŒ
, 0, (
m_dwWidth
 * 
m_dwLa¡Ra¡”
 * 
iPÏÃs
 * 
m_iBPP
));

506 
”r
 = 
	`EndPage
 ();

508  
”r
;

509 
	}
}

515 
DRIVER_ERROR
 
	gLJZjs
::
	$JbigCom´ess_LJZjsCŞÜ2
 ()

517 
DRIVER_ERROR
 
”r
 = 
NO_ERROR
;

518 
HPLJZjcBuff
 
myBufãr
;

520 
iPÏÃs
 = (
m_cmCŞÜMode
 =ğ
COLOR
) ? 4 : 1;

521 
¬rPÏÃsOrd”
[] = {3,2,1,4};

522 
nBy‹CouÁ
 = 0;

523 
iHeight
 = 0;

525 
HPLJZjsJbgEncSt
 
£
;

526 
BYTE
 *
pbUnCom´es£dD©a
 = 
NULL
;

528 
BYTE
 *
b™m­s
[4] =

530 
m_pszIÅutRa¡”D©a
,

531 
m_pszIÅutRa¡”D©a
 + (
m_dwWidth
 * 
m_iBPP
 * 
m_dwLa¡Ra¡”
),

532 
m_pszIÅutRa¡”D©a
 + (
m_dwWidth
 * 
m_iBPP
 * 
m_dwLa¡Ra¡”
 * 2),

533 
m_pszIÅutRa¡”D©a
 + (
m_dwWidth
 * 
m_iBPP
 * 
m_dwLa¡Ra¡”
 * 3)

536 
myBufãr
.
pszCom´es£dD©a
 = 
Ãw
 
BYTE
[
m_dwWidth
 * 
m_dwLa¡Ra¡”
 * 
m_iBPP
];

537 if(
NULL
 =ğ
myBufãr
.
pszCom´es£dD©a
)

539  
ALLOCMEM_ERROR
;

541 
myBufãr
.
dwTÙ®Size
 = 0;

543 
nPÏÃCouÁ
 = 0;‚PÏÃCouÁ < 
iPÏÃs
;‚PlaneCount++)

546 
	`mem£t
 (
myBufãr
.
pszCom´es£dD©a
, 0, 
m_dwWidth
 * 
m_dwLa¡Ra¡”
 * 
m_iBPP
);

547 
myBufãr
.
dwTÙ®Size
 = 0;

549 if(4 =ğ
iPÏÃs
)

551 
pbUnCom´es£dD©a
 = 
b™m­s
[
¬rPÏÃsOrd”
[
nPÏÃCouÁ
]-1] ;

555  
SYSTEM_ERROR
;

559 
iHeight
 = 
m_dwLa¡Ra¡”
;

561 
	`HPLJJBGCom´ess
 (
m_dwWidth
 * 8 * 
m_iBPP
, 
iHeight
, &
pbUnCom´es£dD©a
, &
myBufãr
, &
£
);

563 if(0 =ğ
nPÏÃCouÁ
)

565 
	`S¹Page
 (
£
.
xd
, se.
yd
);

568 
”r
 = 
this
->
	`S’dPÏÃD©a
 (
¬rPÏÃsOrd”
[
nPÏÃCouÁ
], &
£
, &
myBufãr
, 
FALSE
);

572 
d–‘e
 [] 
myBufãr
.
pszCom´es£dD©a
;

573 
m_dwCu¼’tRa¡”
 = 0;

574 
m_pszCurPŒ
 = 
m_pszIÅutRa¡”D©a
;

575 
	`mem£t
 (
m_pszCurPŒ
, 0, (
m_dwWidth
 * 
m_dwLa¡Ra¡”
 * 
iPÏÃs
 * 
m_iBPP
));

577 
”r
 = 
	`EndPage
 ();

579  
”r
;

580 
	}
}

582 
DRIVER_ERROR
 
	gH—d”LJZjs
::
	$EndJob
 ()

584 
DRIVER_ERROR
 
”r
 = 
NO_ERROR
;

585 
szSŒ
[64];

587 ià(((
LJZjs
 *è
thePrš‹r
)->
m_iPrš‹rTy³
 =ğ
eLJM1005
)

589 
	`mem£t
 (
szSŒ
, 0, 8);

590 
szSŒ
[3] = 2;

591 
	`¡rıy
 ((*è
szSŒ
+8, "\x1B\x25-12345X@PJL EOJ\x0D\x0A\x1B\x25-12345X");

592 
”r
 = 
thePrš‹r
->
	`S’d
 ((cÚ¡ 
BYTE
 *è
szSŒ
, 8 + 
	`¡¾’
 ((*) (szStr+8)));

593  
”r
;

597 
	`mem£t
 (
szSŒ
, 0, 64);

599 
szSŒ
[3] = 16;

600 
szSŒ
[7] = 
ZJT_END_DOC
;

601 
szSŒ
[14] = 'Z';

602 
szSŒ
[15] = 'Z';

603 
”r
 = 
thePrš‹r
->
	`S’d
 ((cÚ¡ 
BYTE
 *è
szSŒ
, 16);

604  
”r
;

605 
	}
}

607 
H—d”
 *
	gLJZjs
::
	$S–eùH—d”
 (
PrštCÚ‹xt
* 
pc
)

609 
DRIVER_ERROR
 
”r
 = 
NO_ERROR
;

610 
DWORD
 
dwSize
;

611 
iPÏÃs
 = 1;

612 
QUALITY_MODE
 
cqm
;

613 
MEDIATYPE
 
cmt
;

614 
BOOL
 
cdt
;

615 
”r
 = 
pc
->
	`G‘PrštModeS‘tšgs
 (
cqm
, 
cmt
, 
m_cmCŞÜMode
, 
cdt
);

617 ià(
m_cmCŞÜMode
 =ğ
COLOR
 && 
m_bIamCŞÜ
)

619 
iPÏÃs
 = 4;

620 
m_iP
[0] = 3;

622 
m_dwWidth
 = 
pc
->
	`OuutPix–sP”Row
 () / 8;

623 ià(
m_dwWidth
 % 8)

625 
m_dwWidth
 = (m_dwWidth / 8 + 1) * 8;

627 
m_dwLa¡Ra¡”
 = (è(
pc
->
	`PršbËHeight
 (è*…c->
	`EfãùiveResŞutiÚY
 () + 0.5);

628 
dwSize
 = 
m_dwWidth
 * 
m_dwLa¡Ra¡”
 * 
iPÏÃs
 * 
m_iBPP
;

629 
m_pszIÅutRa¡”D©a
 = 
Ãw
 
BYTE
[
dwSize
];

630 ià(
m_pszIÅutRa¡”D©a
 =ğ
NULL
)

632  
NULL
;

634 
m_pszCurPŒ
 = 
m_pszIÅutRa¡”D©a
;

635 
	`mem£t
 (
m_pszCurPŒ
, 0, 
dwSize
);

636 
thePrštCÚ‹xt
 = 
pc
;

637  
Ãw
 
	`H—d”LJZjs
 (
this
,
pc
);

638 
	}
}

640 
DRIVER_ERROR
 
	gLJZjs
::
	$V”ifyP’Info
()

643 
eP’
 = 
BOTH_PENS
;

644  
NO_ERROR
;

645 
	}
}

647 
DRIVER_ERROR
 
	gLJZjs
::
	$P¬£P’Info
 (
PEN_TYPE
& 
eP’
, 
BOOL
 
Qu”yPrš‹r
)

650 
eP’
 = 
BOTH_PENS
;

652  
NO_ERROR
;

653 
	}
}

655 
	gAPDK_END_NAMESPACE


	@prnt/hpijs/ljzjs.h

32 #iâdeà
APDK_LJZJS_H


33 
	#APDK_LJZJS_H


	)

35 #ià
defšed
 (
APDK_LJZJS_MONO
è|| defšed (
APDK_LJZJS_COLOR
è|| defšed (
APDK_LJM1005
)

37 
	~"hpjbig_w¿µ”.h
"

39 
APDK_BEGIN_NAMESPACE


45 şas 
	cLJZjs
 : 
public
 
Prš‹r


47 
public
:

48 
LJZjs
 (
Sy¡emS”viûs
* 
pSS
, 
numfÚts
 = 0, 
BOOL
 
´Ùo
 = 
FALSE
);

49 ~
LJZjs
 ();

51 
vœtu®
 
H—d”
* 
S–eùH—d”
 (
PrštCÚ‹xt
* 
pc
);

52 
vœtu®
 
DRIVER_ERROR
 
V”ifyP’Info
 ();

53 
vœtu®
 
DRIVER_ERROR
 
P¬£P’Info
 (
PEN_TYPE
& 
eP’
, 
BOOL
 
Qu”yPrš‹r
 = 
TRUE
);

54 
vœtu®
 
DRIVER_ERROR
 
	$EnÿpsuÏ‹
 (cÚ¡ 
RASTERDATA
 *
pRa¡”D©a
, 
BOOL
 
bLa¡PÏÃ
)

56  
SYSTEM_ERROR
;

58 
vœtu®
 
DRIVER_ERROR
 
	`Flush
 (
FlushSize
);

59 
vœtu®
 
DRIVER_ERROR
 
	`SkRa¡”s
 (
iBÏnkRa¡”s
);

60 
	`S’dChunkH—d”
 (
BYTE
 *
szSŒ
, 
DWORD
 
dwSize
, DWORD 
dwChunkTy³
, DWORD 
dwNumI‹ms
);

61 
	`S’dI‹m
 (
BYTE
 *
szSŒ
, BYTE 
cTy³
, 
WORD
 
wI‹m
, 
DWORD
 
dwV®ue
, DWORD 
dwExŒa
 = 0);

62 
	`S’dIÁI‹m
 (
BYTE
 *
szSŒ
, 
iI‹m
, 
iI‹mTy³
, 
iI‹mV®ue
);

63 
DRIVER_ERROR
 
	`S’dChunkAndI‹mH—d”
 (
BYTE
 
ty³
, *
obj
);

65 
vœtu®
 
BOOL
 
	$G‘M¬gšs
 (
PAPER_SIZE
 
ps
, *
fM¬gšs
)

67 
fM¬gšs
[0] = () 0.25;

68 
fM¬gšs
[1] = () 0.25;

69 
fM¬gšs
[2] = () 0.2;

70 
fM¬gšs
[3] = () 0.2;

71  
TRUE
;

72 
	}
}

73 
PRINTER_TYPE
 
	gm_iPrš‹rTy³
;

75 
	g´Ùeùed
:

77 #ifdeà
APDK_HP_UX


78 
vœtu®
 
LJZjs
 & 
İ”©Ü
 = (
Prš‹r
& 
rhs
)

80  *
this
;

85 
M­P­”Size
 ();

86 
DRIVER_ERROR
 
JbigCom´ess
 ();

87 
DRIVER_ERROR
 
JbigCom´ess_LJZjsCŞÜ2
 ();

88 
DRIVER_ERROR
 
S’dI‹mD©a
 (
BYTE
 
I‹mTy³
, 
WORD
 
I‹m
, 
DWORD
 
dwV®ue
);

89 
DRIVER_ERROR
 
S¹Page
 (
DWORD
 
dwWidth
, DWORD 
dwHeight
);

90 
vœtu®
 
DRIVER_ERROR
 
	$EndPage
 ()

92  
SYSTEM_ERROR
;

93 
	}
}

94 
vœtu®
 
DRIVER_ERROR
 
	$S’dPÏÃD©a
 (
iPÏÃNumb”
, 
HPLJZjsJbgEncSt
 *
£
, 
HPLJZjcBuff
 *
pcBuff
, 
BOOL
 
bLa¡SŒide
)

96  
SYSTEM_ERROR
;

97 
	}
}

98 
vœtu®
 
	$G‘OuutResŞutiÚY
 ()

101 
	}
}

103 cÚ¡ 
	gszBy‹1
[256];

104 cÚ¡ 
	gszBy‹2
[256];

105 *
	gm_hHPLibHªdË
;

107 
DWORD
 
	gm_dwWidth
;

108 
DWORD
 
	gm_dwCu¼’tRa¡”
;

109 
DWORD
 
	gm_dwLa¡Ra¡”
;

110 
BYTE
 *
	gm_pszIÅutRa¡”D©a
;

111 
BYTE
 *
	gm_pszCurPŒ
;

112 
PrštCÚ‹xt
 *
	gthePrštCÚ‹xt
;

113 
BOOL
 
	gm_bS¹PageS’t
;

114 
COLORMODE
 
	gm_cmCŞÜMode
;

115 
BOOL
 
	gm_bIamCŞÜ
;

116 
	gm_iPÏÃNumb”
;

117 
	gm_iBPP
;

118 
	gm_iP
[4];

119 
BOOL
 
	gm_bLJZjsCŞÜ2Prš‹r
 ;

124 
	mZJT_START_DOC
,

125 
	mZJT_END_DOC
,

126 
	mZJT_START_PAGE
,

127 
	mZJT_END_PAGE
,

128 
	mZJT_JBIG_BIH
,

129 
	mZJT_JBIG_HID
,

130 
	mZJT_END_JBIG
,

131 
	mZJT_SIGNATURE
,

132 
	mZJT_RAW_IMAGE
,

133 
	mZJT_START_PLANE
,

134 
	mZJT_END_PLANE
,

135 
	mZJT_PAUSE
,

136 
	mZJT_BITMAP


137 } 
	tCHUNK_TYPE
;

141  
	mZJI_PAGECOUNT
,

142  
	mZJI_DMCOLLATE
,

143  
	mZJI_DMDUPLEX
,

145  
	mZJI_DMPAPER
,

146  
	mZJI_DMCOPIES
,

147  
	mZJI_DMDEFAULTSOURCE
,

148  
	mZJI_DMMEDIATYPE
,

149  
	mZJI_NBIE
,

150  
	mZJI_RESOLUTION_X
,

151  
	mZJI_RESOLUTION_Y
,

152  
	mZJI_OFFSET_X
,

153  
	mZJI_OFFSET_Y
,

154  
	mZJI_RASTER_X
,

155  
	mZJI_RASTER_Y
,

157  
	mZJI_COLLATE
,

158  
	mZJI_QUANTITY
,

160  
	mZJI_VIDEO_BPP
,

161  
	mZJI_VIDEO_X
,

162  
	mZJI_VIDEO_Y
,

163  
	mZJI_INTERLACE
,

164  
	mZJI_PLANE
,

165  
	mZJI_PALETTE
,

167  
	mZJI_RET
,

168  
	mZJI_TONER_SAVE
,

170  
	mZJI_MEDIA_SIZE_X
,

171  
	mZJI_MEDIA_SIZE_Y
,

172  
	mZJI_MEDIA_SIZE_UNITS
,

174  
	mZJI_CHROMATIC
,

176  
	mZJI_PAD
 = 99,

178  
	mZJI_PROMPT
,

180  
	mZJI_BITMAP_TYPE
,

181  
	mZJI_ENCODING_DATA
,

182  
	mZJI_END_PLANE
,

184  
	mZJI_BITMAP_PIXELS
,

185  
	mZJI_BITMAP_LINES
,

186  
	mZJI_BITMAP_BPP
,

187  
	mZJI_BITMAP_STRIDE
,

189 } 
	tZJ_ITEM
;

193 
	mRET_OFF
 = 0,

194 
	mRET_ON
,

195 
	mRET_AUTO
,

196 
	mRET_LIGHT
,

197 
	mRET_MEDIUM
,

198 
	mRET_DARK


199 } 
	tRET_VALUE
;

203 
	mZJIT_UINT32
 = 1,

204 
	mZJIT_INT32
,

205 
	mZJIT_STRING
,

206 
	mZJIT_BYTELUT


207 } 
	tCHUNK_ITEM_TYPE
;

209 
	gAPDK_END_NAMESPACE


	@prnt/hpijs/ljzjscolor.cpp

32 #ifdeà
APDK_LJZJS_COLOR


34 
	~"h—d”.h
"

35 
	~"io_defs.h
"

36 
	~"´š‹½roxy.h
"

37 
	~"»sourûs.h
"

38 
	~"ljzjs.h
"

39 
	~"ljzjscŞÜ.h
"

41 
	gAPDK_BEGIN_NAMESPACE


43 
	#LJZJSCOLOR2DEVICESCOUNT
 8

	)

45 
ušt32_t
 
ulM­GRAY_K_6x6x1
[9 * 9 * 9];

47 
ušt32_t
 
ulM­DJ600_CCM_K
[9 * 9 * 9];

48 
ušt32_t
 
ulM­DJ970_KCMY
[9 * 9 * 9];

49 
ucM­DJ4100_KCMY_PhÙo_Be¡A_12x12x1
[];

50 
ucM­DJ4100_KCMY_PhÙo_Be¡V_12x12x1
[];

51 
ucM­DJ4100_KCMY_Be¡A_12x12x1
[];

52 
ucM­DJ4100_KCMY_Be¡S_12x12x1
[];

53 
BYTE
 *
G‘HT12x12x1_4100_PhÙo_Be¡
 ();

55 
	gLJZjsCŞÜ
::
	$LJZjsCŞÜ
 (
Sy¡emS”viûs
* 
pSS
, 
numfÚts
, 
BOOL
 
´Ùo
)

56 : 
	$LJZjs
 (
pSS
, 
numfÚts
, 
´Ùo
)

59 
eP’
 = 
BOTH_PENS
;

61 
pMode
[
GRAYMODE_INDEX
] = 
Ãw
 
	`LJZjsCŞÜD¿áG¿yMode
 ();

62 
pMode
[
DEFAULTMODE_INDEX
] = 
Ãw
 
	`LJZjsCŞÜNÜm®G¿yMode
 ();

63 
pMode
[
SPECIALMODE_INDEX
] = 
Ãw
 
	`LJZjsCŞÜD¿áCŞÜMode
 ();

64 
pMode
[
SPECIALMODE_INDEX
+1] = 
Ãw
 
	`LJZjsCŞÜNÜm®CŞÜMode
 ();

65 
ModeCouÁ
 = 4;

67 
CMYM­
 = 
NULL
;

68 #ifdeà 
APDK_AUTODUPLEX


69 
m_bRÙ©eBackPage
 = 
FALSE
;

71 
m_pszIÅutRa¡”D©a
 = 
NULL
;

72 
m_dwCu¼’tRa¡”
 = 0;

73 
m_cmCŞÜMode
 = 
GREY_K
;

74 
m_bS¹PageS’t
 = 
FALSE
;

75 
m_iPÏÃNumb”
 = 0;

76 
m_iBPP
 = 2;

77 
i
 = 1; i < 4; i++)

79 
m_iP
[
i
] = i - 1;

81 
m_iP
[0] = 3;

82 
m_bIamCŞÜ
 = 
TRUE
;

83 
m_iPrš‹rTy³
 = 
eLJZjsCŞÜ
;

86 
m_bLJZjsCŞÜ2Prš‹r
 = 
	`IsLJZjsCŞÜ2Prš‹r
(
pSS
);

87 
	}
}

89 
	gLJZjsCŞÜ
::~
	$LJZjsCŞÜ
 ()

91 
	}
}

97 
LJZjsCŞÜD¿áG¿yMode
::
	$LJZjsCŞÜD¿áG¿yMode
 ()

98 : 
	$G¿yMode
Ğ
ulM­GRAY_K_6x6x1
)

101 
ResŞutiÚX
[0] =

102 
ResŞutiÚY
[0] = 600;

103 
Ba£ResX
 =

104 
Ba£ResY
 = 600;

105 
MixedRes
 = 
FALSE
;

106 
bFÚtC­abË
 = 
FALSE
;

107 
theQu®™y
 = 
qu®™yD¿á
;

108 
pmQu®™y
 = 
QUALITY_DRAFT
;

109 #ifdeà
APDK_AUTODUPLEX


110 
bDu¶exC­abË
 = 
TRUE
;

112 
CÚfig
.
bCom´ess
 = 
FALSE
;

113 
	}
}

119 
	gLJZjsCŞÜNÜm®G¿yMode
::
	$LJZjsCŞÜNÜm®G¿yMode
 ()

120 : 
	$G¿yMode
Ğ
ulM­GRAY_K_6x6x1
)

123 
ResŞutiÚX
[0] =

124 
ResŞutiÚY
[0] = 600;

125 
Ba£ResX
 =

126 
Ba£ResY
 = 600;

127 
TextRes
 = 600;

128 
MixedRes
 = 
FALSE
;

129 
bFÚtC­abË
 = 
FALSE
;

130 #ifdeà
APDK_AUTODUPLEX


131 
bDu¶exC­abË
 = 
TRUE
;

133 
CÚfig
.
bCom´ess
 = 
FALSE
;

134 
	}
}

140 
	gLJZjsCŞÜD¿áCŞÜMode
::
	$LJZjsCŞÜD¿áCŞÜMode
 ()

141 : 
	$PrštMode
(
ulM­DJ970_KCMY
)

143 
cm­
.
ulM­1
 =

144 
cm­
.
ulM­2
 = 
NULL
;

145 
cm­
.
ulM­3
 = (*è
ucM­DJ4100_KCMY_PhÙo_Be¡A_12x12x1
;

146 
CŞÜFEDTabË
 = 
	`G‘HT12x12x1_4100_PhÙo_Be¡
 ();

148 
ResŞutiÚX
[0] = 
ResŞutiÚY
[0] = 600;

149 
Ba£ResX
 = 
Ba£ResY
 = 600;

150 
TextRes
 = 600;

151 
MixedRes
 = 
FALSE
;

152 
bFÚtC­abË
 = 
FALSE
;

153 
pmQu®™y
 = 
QUALITY_DRAFT
;

154 
theQu®™y
 = 
qu®™yD¿á
;

155 #ifdeà
APDK_AUTODUPLEX


156 
bDu¶exC­abË
 = 
TRUE
;

158 
CÚfig
.
bCom´ess
 = 
FALSE
;

159 
	}
}

166 
	gLJZjsCŞÜNÜm®CŞÜMode
::
	$LJZjsCŞÜNÜm®CŞÜMode
 ()

167 : 
	$PrštMode
(
ulM­DJ970_KCMY
)

169 
cm­
.
ulM­1
 =

170 
cm­
.
ulM­2
 = 
NULL
;

171 
cm­
.
ulM­3
 = (*è
ucM­DJ4100_KCMY_PhÙo_Be¡A_12x12x1
;

173 
CŞÜFEDTabË
 = 
	`G‘HT12x12x1_4100_PhÙo_Be¡
 ();

175 
i
 = 0; i < 4; i++)

177 
CŞÜD•th
[
i
] = 1;

179 
ResŞutiÚX
[
i
] = 600;

180 
ResŞutiÚY
[
i
] = 600;

183 
ResŞutiÚX
[0] =

184 
ResŞutiÚY
[0] = 600;

185 
Ba£ResX
 =

186 
Ba£ResY
 = 600;

187 
TextRes
 = 600;

188 
MixedRes
 = 
FALSE
;

189 
bFÚtC­abË
 = 
FALSE
;

190 
pmQu®™y
 = 
QUALITY_NORMAL
;

191 #ifdeà
APDK_AUTODUPLEX


192 
bDu¶exC­abË
 = 
TRUE
;

194 
CÚfig
.
bCom´ess
 = 
FALSE
;

195 
	}
}

197 
DRIVER_ERROR
 
	gLJZjsCŞÜ
::
	$EnÿpsuÏ‹
 (cÚ¡ 
RASTERDATA
 *
pRa¡”D©a
, 
BOOL
 
bLa¡PÏÃ
)

199 
DRIVER_ERROR
 
”r
 = 
NO_ERROR
;

200 ifĞ
m_cmCŞÜMode
 =ğ
COLOR
 )

202 ià(
pRa¡”D©a
 !ğ
NULL
)

204 
BYTE
 *
p
 = 
m_pszCurPŒ
 + (
m_iP
[
m_iPÏÃNumb”
] * 
m_dwWidth
 * 
m_iBPP
è* 
m_dwLa¡Ra¡”
;

205 
i
 = 0; i < 
pRa¡”D©a
->
¿¡”size
[
COLORTYPE_COLOR
]; i++)

207 
p
[
i
*
m_iBPP
] = 
szBy‹1
[
pRa¡”D©a
->
¿¡”d©a
[
COLORTYPE_COLOR
][i]];

208 
p
[
i
*
m_iBPP
+1] = 
szBy‹2
[
pRa¡”D©a
->
¿¡”d©a
[
COLORTYPE_COLOR
][i]];

209 
p
[
i
*
m_iBPP
] |= (p[i*m_iBPP] >> 1);

210 
p
[
i
*
m_iBPP
+1] |= (p[i*m_iBPP+1] >> 1);

213 
m_iPÏÃNumb”
++;

215 ià(
bLa¡PÏÃ
)

217 
m_dwCu¼’tRa¡”
++;

218 
m_pszCurPŒ
 +ğ
m_iBPP
 * 
m_dwWidth
;

219 
m_iPÏÃNumb”
 = 0;

225 ià(
pRa¡”D©a
 !ğ
NULL
)

227 
i
 = 0; i < 
pRa¡”D©a
->
¿¡”size
[
COLORTYPE_COLOR
]; i++)

229 
m_pszCurPŒ
[
i
*
m_iBPP
] = 
szBy‹1
[
pRa¡”D©a
->
¿¡”d©a
[
COLORTYPE_COLOR
][i]];

230 
m_pszCurPŒ
[
i
*
m_iBPP
+1] = 
szBy‹2
[
pRa¡”D©a
->
¿¡”d©a
[
COLORTYPE_COLOR
][i]];

231 
m_pszCurPŒ
[
i
*
m_iBPP
] |= (m_pszCurPtr[i*m_iBPP] >> 1);

232 
m_pszCurPŒ
[
i
*
m_iBPP
+1] |= (m_pszCurPtr[i*m_iBPP+1] >> 1);

236 
m_dwCu¼’tRa¡”
++;

237 
m_pszCurPŒ
 +ğ(
m_iBPP
 * 
m_dwWidth
);

240 ià(
m_dwCu¼’tRa¡”
 =ğ
m_dwLa¡Ra¡”
)

242 if(
TRUE
 =ğ
m_bLJZjsCŞÜ2Prš‹r
)

244 
”r
 = 
	`JbigCom´ess_LJZjsCŞÜ2
 ();

248 
”r
 = 
	`JbigCom´ess
();

251  
”r
;

252 
	}
}

254 
DRIVER_ERROR
 
	gLJZjsCŞÜ
::
	$EndPage
 ()

256 
DRIVER_ERROR
 
”r
 = 
NO_ERROR
;

257 
BYTE
 
szSŒ
[256];

258 
i
 = 0;

259 
iCŞ
 = (
m_cmCŞÜMode
 =ğ
COLOR
) ? 1 : 0;

261 
i
 = 
	`S’dChunkH—d”
 (
szSŒ
, 112, 
ZJT_END_PAGE
, 8);

262 
j
 = 0; j < 8; j++)

264 
i
 +ğ
	`S’dI‹m
 (
szSŒ
+i, 
ZJIT_UINT32
, 0x8200+
j
, (j % 4 =ğ3è? 1 : 
iCŞ
);

266 
”r
 = 
	`S’d
 ((cÚ¡ 
BYTE
 *è
szSŒ
, 112);

268 
m_bS¹PageS’t
 = 
FALSE
;

270 
m_dwCu¼’tRa¡”
 = 0;

271 
m_pszCurPŒ
 = 
m_pszIÅutRa¡”D©a
;

273  
”r
;

274 
	}
}

284 
DRIVER_ERROR
 
	gLJZjsCŞÜ
::
	$S’dPÏÃD©a
 (
iPÏÃNumb”
, 
HPLJZjsJbgEncSt
 *
£
, 
HPLJZjcBuff
 *
pcBuff
, 
BOOL
 
bLa¡SŒide
)

286 
DRIVER_ERROR
 
”r
 = 
NO_ERROR
;

287 if(
TRUE
 =ğ
m_bLJZjsCŞÜ2Prš‹r
)

289 
”r
 = 
	`S’dPÏÃD©a_LJZjsCŞÜ2
 (
iPÏÃNumb”
,
£
, 
pcBuff
,
bLa¡SŒide
);

293 
”r
 = 
	`S’dPÏÃD©a_LJZjsCŞÜ
 (
iPÏÃNumb”
, 
£
, 
pcBuff
, 
bLa¡SŒide
);

295  
”r
;

296 
	}
}

298 
DRIVER_ERROR
 
	gLJZjsCŞÜ
::
	$S’dPÏÃD©a_LJZjsCŞÜ
 (
iPÏÃNumb”
, 
HPLJZjsJbgEncSt
 *
£
, 
HPLJZjcBuff
 *
pcBuff
, 
BOOL
 
bLa¡SŒide
)

300 
DRIVER_ERROR
 
”r
 = 
NO_ERROR
;

301 
BYTE
 
szSŒ
[256];

302 
BOOL
 
bNÙS’t
 = 
TRUE
;

303 
kEnd
 = (
m_cmCŞÜMode
 =ğ
COLOR
) ? 5 : 2;

304 
i
 = 0;

311 ià(
iPÏÃNumb”
 =ğ1 && 
bNÙS’t
)

313 
bNÙS’t
 = 
FALSE
;

314 
i
 = 0;

315 
k
 = 1; k < 
kEnd
; k++)

317 
i
 = 
	`S’dChunkH—d”
 (
szSŒ
, 132, 
ZJT_BITMAP
, 8);

318 
szSŒ
[13] += 20;

319 
i
 +ğ
	`S’dI‹m
 (
szSŒ
+i, 
ZJIT_UINT32
, 
ZJI_BITMAP_TYPE
, 1);

320 
i
 +ğ
	`S’dI‹m
 (
szSŒ
+i, 
ZJIT_UINT32
, 
ZJI_BITMAP_PIXELS
, 
£
->
xd
);

321 
i
 +ğ
	`S’dI‹m
 (
szSŒ
+i, 
ZJIT_UINT32
, 
ZJI_BITMAP_STRIDE
, 
£
->
xd
);

322 
i
 +ğ
	`S’dI‹m
 (
szSŒ
+i, 
ZJIT_UINT32
, 
ZJI_BITMAP_LINES
, 
£
->
yd
);

323 
i
 +ğ
	`S’dI‹m
 (
szSŒ
+i, 
ZJIT_UINT32
, 
ZJI_BITMAP_BPP
, 1);

324 
i
 +ğ
	`S’dI‹m
 (
szSŒ
+i, 
ZJIT_UINT32
, 
ZJI_VIDEO_BPP
, 
m_iBPP
);

325 
i
 +ğ
	`S’dI‹m
 (
szSŒ
+i, 
ZJIT_UINT32
, 
ZJI_PLANE
,

326 (
m_cmCŞÜMode
 =ğ
COLOR
è? 
k
 : 4);

327 
i
 +ğ
	`S’dI‹m
 (
szSŒ
+i, 
ZJIT_BYTELUT
, 
ZJI_ENCODING_DATA
, 20, 20);

328 
szSŒ
[
i
++] = 
£
->
dl
;

329 
szSŒ
[
i
++] = 
£
->
d
;

330 
szSŒ
[
i
++] = 
£
->
¶ªes
;

331 
szSŒ
[
i
++] = 0;

332 
j
 = 3; j >= 0; j--)

334 
szSŒ
[
i
] = (
BYTE
è((
£
->
xd
 >> (8 * 
j
)) & 0xFF);

335 
szSŒ
[4+
i
] = (
BYTE
è((
£
->
yd
 >> (8 * 
j
)) & 0xFF);

336 
szSŒ
[8+
i
] = (
BYTE
è((
£
->
l0
 >> (8 * 
j
)) & 0xFF);

337 
i
++;

339 
i
 += 8;

341 
szSŒ
[
i
++] = 
£
->
mx
;

342 
szSŒ
[
i
++] = 
£
->
my
;

343 
szSŒ
[
i
++] = 
£
->
Üd”
;

344 
szSŒ
[
i
++] = 
£
->
İtiÚs
;

345 
”r
 = 
	`S’d
 ((cÚ¡ 
BYTE
 *è
szSŒ
, 132);

346 
ERRCHECK
;

350 
BYTE
 *
p
 = 
pcBuff
->
pszCom´es£dD©a
 + 20;

351 
dwNumI‹ms
;

352 
dwSize
;

354 
pcBuff
->
dwTÙ®Size
 -= 20;

355 
iPadCouÁ
 = 0;

357 
i
 = 0;

358 ià(
pcBuff
->
dwTÙ®Size
 % 4)

360 
iPadCouÁ
 = ((
pcBuff
->
dwTÙ®Size
 / 4 + 1) * 4) -…cBuff->dwTotalSize;

363 
dwSize
 = 16 + 
pcBuff
->
dwTÙ®Size
 + 
iPadCouÁ
;

364 
dwNumI‹ms
 = 1;

365 ià(
bLa¡SŒide
)

367 
dwNumI‹ms
 = 3;

368 
bNÙS’t
 = 
TRUE
;

370 
dwSize
 +ğ(
dwNumI‹ms
 * 12);

371 
i
 = 
	`S’dChunkH—d”
 (
szSŒ
, 
dwSize
, 
ZJT_BITMAP
, 
dwNumI‹ms
);

372 
i
 +ğ
	`S’dI‹m
 (
szSŒ
+i, 
ZJIT_UINT32
, 
ZJI_PLANE
, (
kEnd
 =ğ5è? 
iPÏÃNumb”
 : 4);

373 ià(
bLa¡SŒide
)

375 
i
 +ğ
	`S’dI‹m
 (
szSŒ
+i, 
ZJIT_UINT32
, 
ZJI_BITMAP_LINES
, 
£
->
yd
);

376 
i
 +ğ
	`S’dI‹m
 (
szSŒ
+i, 
ZJIT_UINT32
, 
ZJI_END_PLANE
, 
bLa¡SŒide
);

378 
”r
 = 
	`S’d
 ((cÚ¡ 
BYTE
 *è
szSŒ
, 
i
);

379 
ERRCHECK
;

381 
”r
 = 
	`S’d
 ((cÚ¡ 
BYTE
 *è
p
, 
pcBuff
->
dwTÙ®Size
);

382 
ERRCHECK
;

383 ià(
iPadCouÁ
 != 0)

385 
	`mem£t
 (
szSŒ
, 0, 
iPadCouÁ
);

386 
”r
 = 
	`S’d
 ((cÚ¡ 
BYTE
 *è
szSŒ
, 
iPadCouÁ
);

389  
”r
;

390 
	}
}

402 
DRIVER_ERROR
 
	gLJZjsCŞÜ
::
	$S’dPÏÃD©a_LJZjsCŞÜ2
 (
iPÏÃNumb”
, 
HPLJZjsJbgEncSt
 *
£
, 
HPLJZjcBuff
 *
pcBuff
, 
BOOL
 
bLa¡SŒide
)

404 
DRIVER_ERROR
 
”r
 = 
NO_ERROR
;

405 
BYTE
 
szSŒ
[256];

407 
BYTE
 *
pbJBigD©a
 = 
NULL
;

409 
DWORD
 
dwD©aSize
 = 0;

410 
DWORD
 
dwMaxChunkSize
 = 0x10000;

411 
DWORD
 
dwCu¼’tChunkSize
 = 0;

412 
DWORD
 
dwLoİCouÁ
 = 0;

414 
iPadCouÁ
 = 0;

415 
nBy‹CouÁ
 = 0;

417 
boŞ
 
bLa¡Chunk
 = 
FALSE
;

419 
	`mem£t
 (
szSŒ
, 0, (szStr));

422 
nBy‹CouÁ
 = 
	`S’dChunkH—d”
 (
szSŒ
, 28, 
ZJT_START_PLANE
, 1);

423 
nBy‹CouÁ
 +ğ
	`S’dI‹m
 (
szSŒ
+nBy‹CouÁ, 
ZJIT_UINT32
, 
ZJI_PLANE
,
iPÏÃNumb”
);

426 
nBy‹CouÁ
 +ğ
	`S’dChunkH—d”
 (
szSŒ
+nBy‹CouÁ, 36, 
ZJT_JBIG_BIH
, 0);

427 
”r
 = 
	`S’d
 ((cÚ¡ 
BYTE
 *è
szSŒ
, 
nBy‹CouÁ
);

428 
ERRCHECK
;

430 
pbJBigD©a
 = 
pcBuff
->
pszCom´es£dD©a
;

431 
”r
 = 
	`S’d
 ((cÚ¡ 
BYTE
 *è
pbJBigD©a
, 20);

432 
ERRCHECK
;

434 
pbJBigD©a
 += 20;

435 
pcBuff
->
dwTÙ®Size
 -= 20;

438 ià(
pcBuff
->
dwTÙ®Size
 % 4)

440 
iPadCouÁ
 = ((
pcBuff
->
dwTÙ®Size
 / 4 + 1) * 4) -…cBuff->dwTotalSize;

443 
dwD©aSize
 = 
pcBuff
->
dwTÙ®Size
;

446 
dwLoİCouÁ
 = 0; dwLoİCouÁ < 
dwD©aSize
 ; dwLoİCouÁ +=
dwMaxChunkSize
)

448 
	`mem£t
 (
szSŒ
, 0, (szStr));

449 
dwCu¼’tChunkSize
 = 
dwMaxChunkSize
;

451 if(
dwLoİCouÁ
+
dwCu¼’tChunkSize
 > 
dwD©aSize
)

453 
dwCu¼’tChunkSize
 = 
dwD©aSize
 - (
dwLoİCouÁ
);

454 
bLa¡Chunk
 = 
TRUE
;

456 ià(!
bLa¡Chunk
)

458 
nBy‹CouÁ
 = 
	`S’dChunkH—d”
 (
szSŒ
, 
dwCu¼’tChunkSize
 + 16, 
ZJT_JBIG_HID
, 0);

462 
nBy‹CouÁ
 = 
	`S’dChunkH—d”
 (
szSŒ
, 
dwCu¼’tChunkSize
 + 16 + 
iPadCouÁ
, 
ZJT_JBIG_HID
, 0);

464 
”r
 = 
	`S’d
 ((cÚ¡ 
BYTE
 *è
szSŒ
, 
nBy‹CouÁ
);

465 
ERRCHECK
;

467 
”r
 = 
	`S’d
 ((cÚ¡ 
BYTE
 *è
pbJBigD©a
, 
dwCu¼’tChunkSize
);

468 
ERRCHECK
;

470 
pbJBigD©a
+=
dwCu¼’tChunkSize
;

472 if(
iPadCouÁ
 != 0)

474 
	`mem£t
 (
szSŒ
, 0, 
iPadCouÁ
);

475 
”r
 = 
	`S’d
 ((cÚ¡ 
BYTE
 *è
szSŒ
, 
iPadCouÁ
);

478 
	`mem£t
 (
szSŒ
, 0, (szStr));

482 
nBy‹CouÁ
 = 
	`S’dChunkH—d”
 (
szSŒ
, 16, 
ZJT_END_JBIG
, 0);

484 
nBy‹CouÁ
 +ğ
	`S’dChunkH—d”
 (
szSŒ
+nBy‹CouÁ, 28, 
ZJT_END_PLANE
, 1);

485 
nBy‹CouÁ
 +ğ
	`S’dI‹m
 (
szSŒ
+nBy‹CouÁ, 
ZJIT_UINT32
, 
ZJI_PLANE
,
iPÏÃNumb”
);

487 
”r
 = 
	`S’d
 ((cÚ¡ 
BYTE
 *è
szSŒ
, 
nBy‹CouÁ
);

488 
ERRCHECK
;

490  
”r
;

491 
	}
}

493 
DRIVER_ERROR
 
	gLJZjsCŞÜ
::
	$V”ifyP’Info
()

495 
eP’
 = 
BOTH_PENS
;

496  
NO_ERROR
;

497 
	}
}

499 
DRIVER_ERROR
 
	gLJZjsCŞÜ
::
	$P¬£P’Info
 (
PEN_TYPE
& 
eP’
, 
BOOL
 
Qu”yPrš‹r
)

501 
eP’
 = 
BOTH_PENS
;

503  
NO_ERROR
;

504 
	}
}

506 
boŞ
 
	gLJZjsCŞÜ
::
	$IsLJZjsCŞÜ2Prš‹r
(
Sy¡emS”viûs
* 
pSS
)

508 ià(
pSS
 =ğ
NULL
)

509  
çl£
;

510 
szLJZjsCŞÜ2Mod–Names
[
LJZJSCOLOR2DEVICESCOUNT
][25] = {

521 
BYTE
 
¡rDeviûID
[
DevIDBuffSize
];

522 
DRIVER_ERROR
 
”r
;

523 
boŞ
 
bLJZjsCŞÜ2Prš‹r
 = 
FALSE
;

524 
”r
 = 
pSS
->
	`G‘DeviûID
(
¡rDeviûID
,
DevIDBuffSize
,
FALSE
);

526 
i
=0; i< 
LJZJSCOLOR2DEVICESCOUNT
; i++)

528 ifĞ
NO_ERROR
 =ğ
”r
 &&

529 (
	`¡ºËn
((cÚ¡ *)
¡rDeviûID
, 
DevIDBuffSize
)< DevIDBuffSize) &&

530 (
	`¡r¡r
((cÚ¡ *)
¡rDeviûID
, (cÚ¡ *)
szLJZjsCŞÜ2Mod–Names
[
i
])))

532 
bLJZjsCŞÜ2Prš‹r
 = 
TRUE
;

536  
bLJZjsCŞÜ2Prš‹r
;

537 
	}
}

539 
	gAPDK_END_NAMESPACE


	@prnt/hpijs/ljzjscolor.h

32 #iâdeà
APDK_LJZJS_COLOR_H


33 
	#APDK_LJZJS_COLOR_H


	)

35 
APDK_BEGIN_NAMESPACE


40 şas 
	cLJZjsCŞÜ
 : 
public
 
LJZjs


42 
public
:

43 
LJZjsCŞÜ
 (
Sy¡emS”viûs
* 
pSS
, 
numfÚts
 = 0, 
BOOL
 
´Ùo
 = 
FALSE
);

44 ~
LJZjsCŞÜ
 ();

46 
vœtu®
 
DRIVER_ERROR
 
V”ifyP’Info
 ();

47 
vœtu®
 
DRIVER_ERROR
 
P¬£P’Info
 (
PEN_TYPE
& 
eP’
, 
BOOL
 
Qu”yPrš‹r
 = 
TRUE
);

48 
vœtu®
 
DRIVER_ERROR
 
EnÿpsuÏ‹
 (cÚ¡ 
RASTERDATA
 *
pRa¡”D©a
, 
BOOL
 
bLa¡PÏÃ
);

50 
	m´Ùeùed
:

52 #ifdeà
APDK_HP_UX


53 
vœtu®
 
LJZjsCŞÜ
 & 
İ”©Ü
 = (
Prš‹r
& 
rhs
)

55  *
this
;

59 
	g´iv©e
:

60 
boŞ
 
IsLJZjsCŞÜ2Prš‹r
(
Sy¡emS”viûs
* 
pSS
);

61 
vœtu®
 
DRIVER_ERROR
 
EndPage
 ();

62 
vœtu®
 
DRIVER_ERROR
 
S’dPÏÃD©a
 (
iPÏÃNumb”
, 
HPLJZjsJbgEncSt
 *
£
, 
HPLJZjcBuff
 *
pcBuff
, 
BOOL
 
bLa¡SŒide
);

63 
vœtu®
 
DRIVER_ERROR
 
S’dPÏÃD©a_LJZjsCŞÜ
 (
iPÏÃNumb”
, 
HPLJZjsJbgEncSt
 *
£
, 
HPLJZjcBuff
 *
pcBuff
, 
BOOL
 
bLa¡SŒide
);

64 
vœtu®
 
DRIVER_ERROR
 
S’dPÏÃD©a_LJZjsCŞÜ2
 (
iPÏÃNumb”
, 
HPLJZjsJbgEncSt
 *
£
, 
HPLJZjcBuff
 *
pcBuff
, 
BOOL
 
bLa¡SŒide
);

68 şas 
	cLJZjsCŞÜD¿áG¿yMode
 : 
public
 
G¿yMode


70 
public
:

71 
LJZjsCŞÜD¿áG¿yMode
 ();

74 şas 
	cLJZjsCŞÜNÜm®G¿yMode
 : 
public
 
G¿yMode


76 
public
:

77 
LJZjsCŞÜNÜm®G¿yMode
 ();

80 şas 
	cLJZjsCŞÜD¿áCŞÜMode
 : 
public
 
PrštMode


82 
public
:

83 
LJZjsCŞÜD¿áCŞÜMode
 ();

86 şas 
	cLJZjsCŞÜNÜm®CŞÜMode
 : 
public
 
PrštMode


88 
public
:

89 
LJZjsCŞÜNÜm®CŞÜMode
 ();

95 şas 
	cLJZjsCŞÜProxy
 : 
public
 
Prš‹rProxy


97 
public
:

98 
	$LJZjsCŞÜProxy
(è: 
	`Prš‹rProxy
(

111 è{
m_iPrš‹rTy³
 = 
eLJZjsCŞÜ
;}

112 
šlše
 
Prš‹r
* 
	$C»©ePrš‹r
(
Sy¡emS”viûs
* 
pSS
ècÚ¡ {  
Ãw
 
	`LJZjsCŞÜ
ÕSS); 
	}
}

113 
šlše
 
PRINTER_TYPE
 
	$G‘Prš‹rTy³
(ècÚ¡ {  
eLJZjsCŞÜ
;
	}
}

114 
šlše
 
	$G‘Mod–B™
(ècÚ¡ {  0x40;
	}
}

117 
	gAPDK_END_NAMESPACE


	@prnt/hpijs/ljzjsmono.cpp

31 #ifdeà
APDK_LJZJS_MONO


33 
	~"h—d”.h
"

34 
	~"io_defs.h
"

35 
	~"´š‹½roxy.h
"

36 
	~"»sourûs.h
"

37 
	~"ljzjs.h
"

38 
	~"ljzjsmÚo.h
"

40 
APDK_BEGIN_NAMESPACE


42 
ušt32_t
 
ulM­GRAY_K_6x6x1
[9 * 9 * 9];

44 
ušt32_t
 
ulM­DJ600_CCM_K
[9 * 9 * 9];

46 
	gLJZjsMÚo
::
	$LJZjsMÚo
 (
Sy¡emS”viûs
* 
pSS
, 
numfÚts
, 
BOOL
 
´Ùo
)

47 : 
	$LJZjs
 (
pSS
, 
numfÚts
, 
´Ùo
)

50 
eP’
 = 
BLACK_PEN
;

52 
pMode
[
GRAYMODE_INDEX
] = 
Ãw
 
	`LJZjsMÚoD¿áG¿yMode
 ();

53 
pMode
[
DEFAULTMODE_INDEX
] = 
Ãw
 
	`LJZjsMÚoNÜm®G¿yMode
 ();

54 
ModeCouÁ
 = 2;

56 
CMYM­
 = 
NULL
;

57 #ifdeà 
APDK_AUTODUPLEX


58 
m_bRÙ©eBackPage
 = 
FALSE
;

60 
m_pszIÅutRa¡”D©a
 = 
NULL
;

61 
m_dwCu¼’tRa¡”
 = 0;

62 
m_cmCŞÜMode
 = 
GREY_K
;

63 
m_bS¹PageS’t
 = 
FALSE
;

64 
m_iPÏÃNumb”
 = 0;

65 
m_iBPP
 = 1;

66 
i
 = 1; i < 4; i++)

68 
m_iP
[
i
] = i - 1;

70 
m_iP
[0] = 0;

71 
m_bIamCŞÜ
 = 
FALSE
;

72 
m_iPrš‹rTy³
 = 
eLJZjsMÚo
;

73 
	}
}

75 
	gLJZjsMÚo
::~
	$LJZjsMÚo
 ()

77 
	}
}

79 
LJZjsMÚoD¿áG¿yMode
::
	$LJZjsMÚoD¿áG¿yMode
 ()

80 : 
	$G¿yMode
Ğ
ulM­GRAY_K_6x6x1
)

83 
ResŞutiÚX
[0] =

84 
ResŞutiÚY
[0] = 600;

85 
Ba£ResX
 =

86 
Ba£ResY
 = 600;

87 
MixedRes
 = 
FALSE
;

88 
bFÚtC­abË
 = 
FALSE
;

89 
theQu®™y
 = 
qu®™yD¿á
;

90 
pmQu®™y
 = 
QUALITY_DRAFT
;

91 #ifdeà
APDK_AUTODUPLEX


92 
bDu¶exC­abË
 = 
TRUE
;

94 
CÚfig
.
bCom´ess
 = 
FALSE
;

95 
medium
 = 
medŸAuto
;

96 
	}
}

98 
	gLJZjsMÚoNÜm®G¿yMode
::
	$LJZjsMÚoNÜm®G¿yMode
 ()

99 : 
	$G¿yMode
Ğ
ulM­GRAY_K_6x6x1
)

102 
ResŞutiÚX
[0] =

103 
ResŞutiÚY
[0] = 600;

104 
Ba£ResX
 =

105 
Ba£ResY
 = 600;

106 
TextRes
 = 600;

107 
MixedRes
 = 
FALSE
;

108 
bFÚtC­abË
 = 
FALSE
;

109 #ifdeà
APDK_AUTODUPLEX


110 
bDu¶exC­abË
 = 
TRUE
;

112 
CÚfig
.
bCom´ess
 = 
FALSE
;

113 
medium
 = 
medŸAuto
;

114 
	}
}

116 
DRIVER_ERROR
 
	gLJZjsMÚo
::
	$EnÿpsuÏ‹
 (cÚ¡ 
RASTERDATA
 *
pRa¡”D©a
, 
BOOL
 
bLa¡PÏÃ
)

118 ià(
pRa¡”D©a
 !ğ
NULL
)

120 
	`memıy
 (
m_pszCurPŒ
, 
pRa¡”D©a
->
¿¡”d©a
[
COLORTYPE_COLOR
],

121 
pRa¡”D©a
->
¿¡”size
[
COLORTYPE_COLOR
]);

124 
m_dwCu¼’tRa¡”
++;

125 
m_pszCurPŒ
 +ğ
m_dwWidth
;

126 ià(
m_dwCu¼’tRa¡”
 =ğ
m_dwLa¡Ra¡”
)

128 
	`JbigCom´ess
 ();

130  
NO_ERROR
;

131 
	}
}

133 
DRIVER_ERROR
 
	gLJZjsMÚo
::
	$EndPage
 ()

135 
DRIVER_ERROR
 
”r
 = 
NO_ERROR
;

136 
BYTE
 
szSŒ
[16];

138 
	`S’dChunkH—d”
 (
szSŒ
, 16, 
ZJT_END_PAGE
, 0);

139 
”r
 = 
	`S’d
 ((cÚ¡ 
BYTE
 *è
szSŒ
, 16);

141 
m_bS¹PageS’t
 = 
FALSE
;

143 
m_dwCu¼’tRa¡”
 = 0;

144 
m_pszCurPŒ
 = 
m_pszIÅutRa¡”D©a
;

146  
”r
;

147 
	}
}

149 
DRIVER_ERROR
 
	gLJZjsMÚo
::
	$S’dPÏÃD©a
 (
iPÏÃNumb”
, 
HPLJZjsJbgEncSt
 *
£
, 
HPLJZjcBuff
 *
pcBuff
, 
BOOL
 
bLa¡SŒide
)

151 
DRIVER_ERROR
 
”r
 = 
NO_ERROR
;

152 
BYTE
 
szSŒ
[36];

153 
i
 = 0;

159 
i
 = 
	`S’dChunkH—d”
 (
szSŒ
, 36, 
ZJT_JBIG_BIH
, 0);

161 
	`memıy
 (
szSŒ
 + 16, 
pcBuff
->
pszCom´es£dD©a
, 20);

162 
”r
 = 
	`S’d
 ((cÚ¡ 
BYTE
 *è
szSŒ
, 36);

163 
ERRCHECK
;

165 
pcBuff
->
dwTÙ®Size
 -= 20;

166 
iPadCouÁ
 = 0;

167 ià(
pcBuff
->
dwTÙ®Size
 % 16)

169 
iPadCouÁ
 = ((
pcBuff
->
dwTÙ®Size
 / 16 + 1) * 16) -…cBuff->dwTotalSize;

171 
DWORD
 
dwTÙ®
 = 
pcBuff
->
dwTÙ®Size
;

172 
BYTE
 *
p
 = 
pcBuff
->
pszCom´es£dD©a
 + 20;

173 
i
 = 
dwTÙ®
 / 65536;

174 
j
 = 0; j < 
i
; j++)

176 
	`S’dChunkH—d”
 (
szSŒ
, 16 + 65536, 
ZJT_JBIG_HID
, 0);

177 
”r
 = 
	`S’d
 ((cÚ¡ 
BYTE
 *è
szSŒ
, 16);

178 
”r
 = 
	`S’d
 ((cÚ¡ 
BYTE
 *è
p
, 65536);

179 
dwTÙ®
 -= 65536;

180 
p
 += 65536;

182 
i
 = 
	`S’dChunkH—d”
 (
szSŒ
, 16 + 
dwTÙ®
 + 
iPadCouÁ
, 
ZJT_JBIG_HID
, 0);

183 
”r
 = 
	`S’d
 ((cÚ¡ 
BYTE
 *è
szSŒ
, 16);

184 
”r
 = 
	`S’d
 ((cÚ¡ 
BYTE
 *è
p
, 
dwTÙ®
);

185 
ERRCHECK
;

186 ià(
iPadCouÁ
 != 0)

188 
	`mem£t
 (
szSŒ
, 0, 
iPadCouÁ
);

189 
”r
 = 
	`S’d
 ((cÚ¡ 
BYTE
 *è
szSŒ
, 
iPadCouÁ
);

191 
i
 = 
	`S’dChunkH—d”
 (
szSŒ
, 16, 
ZJT_END_JBIG
, 0);

192 
”r
 = 
	`S’d
 ((cÚ¡ 
BYTE
 *è
szSŒ
, 16);

193  
”r
;

194 
	}
}

196 
DRIVER_ERROR
 
	gLJZjsMÚo
::
	$V”ifyP’Info
()

198 
eP’
 = 
BLACK_PEN
;

199  
NO_ERROR
;

200 
	}
}

202 
DRIVER_ERROR
 
	gLJZjsMÚo
::
	$P¬£P’Info
 (
PEN_TYPE
& 
eP’
, 
BOOL
 
Qu”yPrš‹r
)

204 
eP’
 = 
BLACK_PEN
;

206  
NO_ERROR
;

207 
	}
}

209 
	gAPDK_END_NAMESPACE


	@prnt/hpijs/ljzjsmono.h

32 #iâdeà
APDK_LJZJS_MONO_H


33 
	#APDK_LJZJS_MONO_H


	)

35 #ifdeà
APDK_LJZJS_MONO


37 
APDK_BEGIN_NAMESPACE


42 şas 
	cLJZjsMÚo
 : 
public
 
LJZjs


44 
public
:

45 
LJZjsMÚo
 (
Sy¡emS”viûs
* 
pSS
, 
numfÚts
 = 0, 
BOOL
 
´Ùo
 = 
FALSE
);

46 ~
LJZjsMÚo
 ();

48 
vœtu®
 
DRIVER_ERROR
 
EnÿpsuÏ‹
 (cÚ¡ 
RASTERDATA
 *
pRa¡”D©a
, 
BOOL
 
bLa¡PÏÃ
);

49 
vœtu®
 
DRIVER_ERROR
 
V”ifyP’Info
 ();

50 
vœtu®
 
DRIVER_ERROR
 
P¬£P’Info
 (
PEN_TYPE
& 
eP’
, 
BOOL
 
Qu”yPrš‹r
 = 
TRUE
);

52 
	m´Ùeùed
:

54 #ifdeà
APDK_HP_UX


55 
vœtu®
 
LJZjsMÚo
 & 
İ”©Ü
 = (
Prš‹r
& 
rhs
)

57  *
this
;

61 
	g´iv©e
:

62 
vœtu®
 
DRIVER_ERROR
 
EndPage
 ();

63 
vœtu®
 
DRIVER_ERROR
 
S’dPÏÃD©a
 (
iPÏÃNumb”
, 
HPLJZjsJbgEncSt
 *
£
, 
HPLJZjcBuff
 *
pcBuff
, 
BOOL
 
bLa¡SŒide
);

67 şas 
	cLJZjsMÚoD¿áG¿yMode
 : 
public
 
G¿yMode


69 
public
:

70 
LJZjsMÚoD¿áG¿yMode
 ();

73 şas 
	cLJZjsMÚoNÜm®G¿yMode
 : 
public
 
G¿yMode


75 
public
:

76 
LJZjsMÚoNÜm®G¿yMode
 ();

82 şas 
	cLJZjsMÚoProxy
 : 
public
 
Prš‹rProxy


84 
public
:

85 
	$LJZjsMÚoProxy
(è: 
	`Prš‹rProxy
(

99 è{
m_iPrš‹rTy³
 = 
eLJZjsMÚo
;}

100 
šlše
 
Prš‹r
* 
	$C»©ePrš‹r
(
Sy¡emS”viûs
* 
pSS
ècÚ¡ {  
Ãw
 
	`LJZjsMÚo
ÕSS); 
	}
}

101 
šlše
 
PRINTER_TYPE
 
	$G‘Prš‹rTy³
(ècÚ¡ {  
eLJZjsMÚo
;
	}
}

102 
šlše
 
	$G‘Mod–B™
(ècÚ¡ {  0x40;
	}
}

105 
	gAPDK_END_NAMESPACE


	@prnt/hpijs/models.cpp

32 
	~"mod–s.h
"

34 
APDK_BEGIN_NAMESPACE


36 
	gAPDK_END_NAMESPACE


	@prnt/hpijs/models.h

32 #iâdeà
APDK_MODELS_H


33 
	#APDK_MODELS_H


	)

35 
	~"cÚfig.h
"

37 
APDK_BEGIN_NAMESPACE


43 
	ePRINTER_TYPE


45 
	mUNSUPPORTED
=-1,

46 
	meDJ400
,

47 
	meDJ540
,

48 
	meDJ600
,

49 
	meDJ6xx
,

50 
	meDJ6xxPhÙo
,

51 
	meDJ8xx
,

52 
	meDJ850
,

53 
	meDJ890
,

54 
	meDJ9xx
,

55 
	meDJ9xxVIP
,

56 
	meDJ630
,

57 
	meAP2xxx
,

58 
	meAP21xx
,

59 
	meAP2560
,

60 
	meDJ350
,

61 
	meDJ8x5
,

62 
	mePSP100
,

63 
	mePSP470
,

64 
	meDJ3320
,

65 
	meDJG’”icVIP
,

66 
	meDJ55xx
,

67 
	meOJProKx50
,

68 
	meLJMÚo
,

69 
	meLJCŞÜ
,

70 
	mePSüt
,

71 
	meDJ3600
,

72 
	meDJ4100
,

73 
	meDJD2600
,

74 
	meLJJ‘R—dy
,

75 
	meLJFa¡Ra¡”
,

76 
	meLJZjsMÚo
,

77 
	meLJM1005
,

78 
	meLJP1XXX
,

79 
	meQuickCÚÃù
,

80 
	meLJZjsCŞÜ
,

81 
	mMAX_PRINTER_TYPE


82 } 
	tPRINTER_TYPE
;

88 cÚ¡ 
	gMod–Name
[
MAX_PRINTER_TYPE
][13] =

127 
	gAPDK_END_NAMESPACE


	@prnt/hpijs/modes.h

1 #ifdeà
APDK_EXTENDED_MEDIASIZE


2 
	#MAX_PRINTMODES
 20

	)

4 
	#MAX_PRINTMODES
 10

	)

7 
	#GRAYMODE_INDEX
 0

	)

8 
	#DEFAULTMODE_INDEX
 1

	)

9 
	#SPECIALMODE_INDEX
 2

	)

10 
	#EXTRASPECIALMODE_INDEX
 3

	)

	@prnt/hpijs/ojprokx50.h

32 #iâdeà
APDK_OJ_PROKX50_H


33 
	#APDK_OJ_PROKX50_H


	)

35 
APDK_BEGIN_NAMESPACE


42 şas 
	cOJProKx50
 : 
public
 
DJ9xxVIP


44 
public
:

45 
	$OJProKx50
 (
Sy¡emS”viûs
* 
pSS
, 
BOOL
 
´Ùo
 = 
FALSE
è: 
	$DJ9xxVIP
 (
pSS
, 
´Ùo
)

48 
pMode
[4]->
medium
 = 
medŸGlossy
;

50 
vœtu®
 
BOOL
 
	$G‘M¬gšs
 (
PAPER_SIZE
 
ps
, *
fM¬gšs
)

52 
fM¬gšs
[0] = () 0.125;

53 
fM¬gšs
[1] = () 0.125;

54 
fM¬gšs
[2] = () 0.125;

55 
fM¬gšs
[3] = () 0.5;

56 ià(
ps
 =ğ
SUPERB_SIZE
)

58 
fM¬gšs
[0] = () 0.125;

59 
fM¬gšs
[1] = () 0.5;

60 
fM¬gšs
[2] = () 0.125;

61 
fM¬gšs
[3] = () 0.75;

63  
TRUE
;

64 
	}
}

67 #ià
defšed
 (
APDK_DJ9xxVIP
)

71 şas 
	cOJProKx50Proxy
 : 
public
 
Prš‹rProxy


73 
public
:

74 
	$OJProKx50Proxy
(è: 
	`Prš‹rProxy
(

78 è{
m_iPrš‹rTy³
 = 
eOJProKx50
;}

79 
šlše
 
Prš‹r
* 
	$C»©ePrš‹r
(
Sy¡emS”viûs
* 
pSS
ècÚ¡ {  
Ãw
 
	`OJProKx50
ÕSS); 
	}
}

80 
šlše
 
PRINTER_TYPE
 
	$G‘Prš‹rTy³
(ècÚ¡ {  
eOJProKx50
;
	}
}

81 
šlše
 
	$G‘Mod–B™
(ècÚ¡ {  0x200;
	}
}

85 
	gAPDK_END_NAMESPACE


	@prnt/hpijs/phobos_cmaps.cpp

32 
	~"cÚfig.h
"

34 
	~"glob®_ty³s.h
"

36 #ifdeà
APDK_DJ8x5


38 
APDK_BEGIN_NAMESPACE


40 
ušt32_t
 
	gulM­DJ8x5D¿á
[ 9 * 9 * 9 ] =

166 
ušt32_t
 
	gulM­DJ8x5PÏšNÜm®
[9 * 9 * 9] =

420 
	gAPDK_END_NAMESPACE


	@prnt/hpijs/pmselect.cpp

32 
	~"h—d”.h
"

33 
	~"pm£Ëù.h
"

35 
APDK_BEGIN_NAMESPACE


37 
	gModeS‘
::
ModeS‘


39 
PrštMode
* 
pPM


42 
ASSERT
(
pPM
);

43 
	gm_Li¡H—d
 = 
Ãw
 
MSNode
;

45 ià(
	gm_Li¡H—d
 !ğ
NULL
)

47 
m_Li¡H—d
->
m_pNext
 = 
NULL
;

48 
	gm_Li¡H—d
->
	gm_pPrštMode
 = 
pPM
;

50 
Re£t
();

54 
	gModeS‘
::~
	$ModeS‘
()

56 ià(
m_Li¡H—d
 !ğ
NULL
)

58 
	`Re£t
();

59 
m_Cu¼’t
 !ğ
NULL
)

61 
MSNode
* 
pD–‘—bË
 = 
m_Cu¼’t
;

62 
	`Next
();

63 
d–‘e
 
pD–‘—bË
;

65 
m_Li¡H—d
 = 
NULL
;

67 
	}
}

72 
	gModeS‘
::
ModeS‘


74 
ModeS‘
* 
pSourû


76 
m_Li¡H—d
(
NULL
),

77 
	$m_Cu¼’t
(
NULL
)

79 
	`ASSERT
(
pSourû
);

81 
MSNode
* 
t_SrcNode
 = 
pSourû
->
m_Li¡H—d
;

83 
t_SrcNode
)

85 
	`Aµ’d
(
t_SrcNode
->
m_pPrštMode
);

86 
t_SrcNode
 =_SrcNode->
m_pNext
;

88 
	}
}

91 
BOOL
 
	gModeS‘
::
	$Aµ’d
(
PrštMode
* 
pPrM
)

93 
	`ASSERT
(
pPrM
);

94 ià(
m_Li¡H—d
 =ğ
NULL
)

96 
m_Li¡H—d
 = 
Ãw
 
MSNode
;

97 ià(
m_Li¡H—d
 =ğ
NULL
)

99  
TRUE
;

101 
m_Li¡H—d
->
m_pPrštMode
 = 
pPrM
;

105 
MSNode
* 
t_w®k
;

106 ià(
m_Cu¼’t
 !ğ
NULL
)

108 
t_w®k
 = 
m_Cu¼’t
;

112 
t_w®k
 = 
m_Li¡H—d
;

115 
t_w®k
->
m_pNext
 !ğ
NULL
)

117 
t_w®k
 =_w®k->
m_pNext
;

120 
t_w®k
->
m_pNext
 = 
Ãw
 
MSNode
;

121 ià(
t_w®k
->
m_pNext
 =ğ
NULL
)

123  
TRUE
;

128 
m_Cu¼’t
 = 
t_w®k
->
m_pNext
;

129 
m_Cu¼’t
->
m_pPrštMode
 = 
pPrM
;

132  
FALSE
;

133 
	}
}

136 
	gModeS‘
::
	$Size
() const

138 
uCouÁ
 = 0;

140 
MSNode
* 
t_w®k
 = 
m_Li¡H—d
;

141 
t_w®k
 !ğ
NULL
)

143 
uCouÁ
++;

144 
t_w®k
 =_w®k->
m_pNext
;

147  
uCouÁ
;

148 
	}
}

151 
ModeS‘
* 
	gModeS‘
::
	$H—d
()

153 
	`ASSERT
(
m_Li¡H—d
);

154 
ModeS‘
* 
pNew
 = 
Ãw
 
	`ModeS‘
(
	`H—dPrštMode
());

155  
pNew
;

156 
	}
}

159 
ModeS‘
* 
	gModeS‘
::
	$FÚtC­abËSub£t
()

161 
ModeS‘
* 
»sMS
 = 
Ãw
 ModeSet;

162 ià(
»sMS
 =ğ
NULL
)

164  
NULL
;

167 
	`Re£t
();

168 
m_Cu¼’t
)

172 
	`ASSERT
(
	`Cu¼PrštMode
());

174 if(
	`Cu¼PrštMode
()->
bFÚtC­abË
)

176 if(
»sMS
->
	`Aµ’d
(
	`Cu¼PrštMode
()))

178 
d–‘e
 
»sMS
;

179  
NULL
;

182 
	`Next
();

184  
»sMS
;

185 
	}
}

188 
ModeS‘
* 
	gModeS‘
::
	$P’Com·tibËSub£t
(
PEN_TYPE
 
³ns
)

190 
ModeS‘
* 
»sMS
 = 
Ãw
 ModeSet;

191 ià(
»sMS
 =ğ
NULL
)

193  
NULL
;

196 
	`Re£t
();

197 
m_Cu¼’t
)

199 
	`ASSERT
(
	`Cu¼PrštMode
());

201 if(
	`Cu¼PrštMode
()->
	`Com·tibË
(
³ns
))

203 if(
»sMS
->
	`Aµ’d
(
	`Cu¼PrštMode
()))

205 
d–‘e
 
»sMS
;

206  
NULL
;

209 
	`Next
();

211  
»sMS
;

212 
	}
}

215 
ModeS‘
* 
	gModeS‘
::
	$CŞÜCom·tibËSub£t
(
COLORMODE
 
cŞÜ
)

217 
ModeS‘
* 
»sMS
 = 
Ãw
 ModeSet;

218 ià(
»sMS
 =ğ
NULL
)

220  
NULL
;

223 
	`Re£t
();

224 
m_Cu¼’t
)

226 
	`ASSERT
(
	`Cu¼PrštMode
());

228 ià(
	`Cu¼PrštMode
()->
	`CŞÜCom·tibË
(
cŞÜ
))

230 if(
»sMS
->
	`Aµ’d
(
	`Cu¼PrštMode
()))

232 
d–‘e
 
»sMS
;

233  
NULL
;

236 
	`Next
();

238  
»sMS
;

239 
	}
}

242 
ModeS‘
* 
	gModeS‘
::
	$Qu®™ySub£t
(
QUALITY_MODE
 
eQu®™y
)

244 
ModeS‘
* 
»sMS
 = 
Ãw
 ModeSet;

245 ià(
»sMS
 =ğ
NULL
)

247  
NULL
;

250 
	`Re£t
();

251 
m_Cu¼’t
)

253 
	`ASSERT
(
	`Cu¼PrštMode
());

255 ià(
	`Cu¼PrštMode
()->
	`Qu®™yCom·tibË
(
eQu®™y
))

257 if(
»sMS
->
	`Aµ’d
(
	`Cu¼PrštMode
()))

259 
d–‘e
 
»sMS
;

260  
NULL
;

263 
	`Next
();

265  
»sMS
;

266 
	}
}

269 
ModeS‘
* 
	gModeS‘
::
	$MedŸSub£t
(
MEDIATYPE
 
eMedŸ
)

271 
ModeS‘
* 
»sMS
 = 
Ãw
 ModeSet;

272 ià(
»sMS
 =ğ
NULL
)

274  
NULL
;

277 
	`Re£t
();

278 
m_Cu¼’t
)

280 
	`ASSERT
(
	`Cu¼PrštMode
());

282 ià(
	`Cu¼PrštMode
()->
	`MedŸCom·tibË
(
eMedŸ
))

284 if(
»sMS
->
	`Aµ’d
(
	`Cu¼PrštMode
()))

286 
d–‘e
 
»sMS
;

287  
NULL
;

290 
	`Next
();

292  
»sMS
;

293 
	}
}

295 
	gAPDK_END_NAMESPACE


	@prnt/hpijs/pmselect.h

32 #iâdeà
APDK_PMSELECT_H


33 
	#APDK_PMSELECT_H


	)

35 
APDK_BEGIN_NAMESPACE


42 
	sMSNode


45 
MSNode
(è: 
m_pNext
(
NULL
), 
m_pPrštMode
(NULL) { }

48 
MSNode
* 
	mm_pNext
;

49 
PrštMode
* 
	mm_pPrštMode
;

57 şas 
	cModeS‘


59 
	mpublic
:

60 
	$ModeS‘
(è: 
	`m_Li¡H—d
(
NULL
), 
	$m_Cu¼’t
(
NULL
) { }

61 
	`ModeS‘
(
PrštMode
* 
pPM
);

62 
	`ModeS‘
(
ModeS‘
* 
pMS
);

63 ~
	`ModeS‘
();

66 
ModeS‘
* 
	`H—d
();

67 
PrštMode
* 
	$H—dPrštMode
(ècÚ¡ {  
m_Li¡H—d
->
m_pPrštMode
; 
	}
}

68 
PrštMode
* 
	$Cu¼PrštMode
(ècÚ¡ {  
m_Cu¼’t
->
m_pPrštMode
; 
	}
}

69 
MSNode
* 
	$Next
(è{ 
m_Cu¼’t
 = m_Cu¼’t->
m_pNext
;  m_Cu¼’t; 
	}
}

70 
	$Re£t
(è{ 
m_Cu¼’t
 = 
m_Li¡H—d
; 
	}
}

71 
BOOL
 
Aµ’d
(
PrštMode
* 
pPrM
);

72 
BOOL
 
	$IsEm±y
(ècÚ¡ {  (
m_Li¡H—d
 =ğ
NULL
); 
	}
}

73 
	$Size
() const;

76 
ModeS‘
* 
	`FÚtC­abËSub£t
();

77 
ModeS‘
* 
	`P’Com·tibËSub£t
(
PEN_TYPE
 
³ns
);

78 
ModeS‘
* 
	`CŞÜCom·tibËSub£t
(
COLORMODE
 
cŞÜ
);

79 
ModeS‘
* 
	`Qu®™ySub£t
(
QUALITY_MODE
 
eQu®™y
);

80 
ModeS‘
* 
	`MedŸSub£t
(
MEDIATYPE
 
eMedŸ
);

85 
´iv©e
:

86 
MSNode
* 
m_Li¡H—d
;

87 
MSNode
* 
m_Cu¼’t
;

91 
	}
};

93 
	gAPDK_END_NAMESPACE


	@prnt/hpijs/printer.cpp

32 
	~"h—d”.h
"

33 
	~"io_defs.h
"

34 
	~"»sourûs.h
"

40 
APDK_BEGIN_NAMESPACE


41 
BYTE
* 
G‘HTBš¬y
();

42 
APDK_END_NAMESPACE


44 
APDK_BEGIN_NAMESPACE


46 
	gPrš‹r
::
Prš‹r


48 
Sy¡emS”viûs
* 
pSys
,

49 
	gnumfÚts
,

50 
BOOL
 
	g´Ùo


52 
cÚ¡ruùÜ_”rÜ
(
NO_ERROR
),

53 
IOMode
(
pSys
->IOMode),

54 #ià
defšed
(
APDK_FONTS_NEEDED
)

55 
iNumFÚts
(
numfÚts
),

57 
iNumFÚts
(0),

59 
bCheckFÜCªûlBu‰Ú
(
FALSE
),

60 
ulBy‹sS’tSšûCªûlCheck
(0),

61 
eP’
(
NO_PEN
),

62 
CMYM­
(
NULL
),

63 
pSS
(
pSys
),

64 
InSlowPŞlMode
(0),

65 
iTÙ®_SLOW_POLL_CouÁ
(0),

66 
iMax_SLOW_POLL_CouÁ
(
DEFAULT_SLOW_POLL_COUNT
),

67 
E¼ÜT”mš©iÚS‹
(
FALSE
),

68 
iBuffSize
(
pSys
->
G‘S’dBufãrSize
()),

69 
iCu¼BuffSize
(0),

70 
EndJob
(
FALSE
),

71 
ModeCouÁ
(2),

72 
	$m_bVIPPrš‹r
(
FALSE
)

75 
i
 = 0;

77 #ifdeà 
APDK_LINUX


78 
m_iNumPages
 = 0;

81 
i
 = 0; i < 
MAX_PRINTMODES
; i++)

83 
pMode
[
i
]=
NULL
;

92 ià(
IOMode
.
bDevID
)

94 
iMax_SLOW_POLL_CouÁ
 = 
DEFAULT_SLOW_POLL_BIDI
;

98 
pS’dBufãr
 = 
NULL
;

99 #ifdeà
APDK_BUFFER_SEND


100 
pS’dBufãr
 = 
pSS
->
	`AÎocMem
(
iBuffSize
+2);

101 
	`CNEWCHECK
(
pS’dBufãr
);

104 #ifdeà
APDK_AUTODUPLEX


105 
bDu¶exC­abË
 = 
FALSE
;

106 
m_bRÙ©eBackPage
 = 
TRUE
;

115 
m_bStusByPJL
 = 
FALSE
;

116 *
tmpSŒ
;

117 ià((
	`¡r¡r
 ((*è
pSS
->
¡rDevID
, "LaserJet")) &&

118 (
tmpSŒ
 = 
	`¡r¡r
 ((*è
pSS
->
¡rDevID
, "CMD:")) &&

119 (
tmpSŒ
 = 
	`¡r¡r
 (tmpStr+4, "PJL")))

121 
m_bStusByPJL
 = 
TRUE
;

124 #ià
	`defšed
(
APDK_FONTS_NEEDED
)

128 
i
 = 0; i<=
MAX_PRINTER_FONTS
; i++)

129 
fÚ¼ay
[
i
] = 
NULL
;

132 #ifdeà
APDK_COURIER


133 
fÚ¼ay
[
COURIER_INDEX
] = 
Ãw
 
	`Cour›r
();

134 
	`CNEWCHECK
(
fÚ¼ay
[
COURIER_INDEX
]);

136 #ifdeà
APDK_CGTIMES


137 
fÚ¼ay
[
CGTIMES_INDEX
] = 
Ãw
 
	`CGTimes
();

138 
	`CNEWCHECK
(
fÚ¼ay
[
CGTIMES_INDEX
]);

140 #ifdeà
APDK_LTRGOTHIC


141 
fÚ¼ay
[
LETTERGOTHIC_INDEX
] = 
Ãw
 
	`L‘‹rGÙhic
();

142 
	`CNEWCHECK
(
fÚ¼ay
[
LETTERGOTHIC_INDEX
]);

144 #ifdeà
APDK_UNIVERS


145 
fÚ¼ay
[
UNIVERS_INDEX
] = 
Ãw
 
	`Univ”s
();

146 
	`CNEWCHECK
(
fÚ¼ay
[
UNIVERS_INDEX
]);

150 
	}
}

153 
	gPrš‹r
::~
	$Prš‹r
()

155 ià(
pMode
[
GRAYMODE_INDEX
])

157 ià(
pMode
[
GRAYMODE_INDEX
]->
dyeCouÁ
==3)

159 
pSS
->
	`F»eMem
((
BYTE
*è
pMode
[
GRAYMODE_INDEX
]->
cm­
.
ulM­1
 );

163 
i
 = 0; i < 
MAX_PRINTMODES
; i++)

165 ià(
pMode
[
i
])

167 
d–‘e
 
pMode
[
i
];

171 #ifdeà
APDK_BUFFER_SEND


172 ià(
pS’dBufãr
 !ğ
NULL
)

174 
pSS
->
	`F»eMem
(
pS’dBufãr
);

178 #ifdeà
APDK_COURIER


179 
d–‘e
 
fÚ¼ay
[
COURIER_INDEX
];

181 #ifdeà
APDK_CGTIMES


182 
d–‘e
 
fÚ¼ay
[
CGTIMES_INDEX
];

184 #ifdeà
APDK_LTRGOTHIC


185 
d–‘e
 
fÚ¼ay
[
LETTERGOTHIC_INDEX
];

187 #ifdeà
APDK_UNIVERS


188 
d–‘e
 
fÚ¼ay
[
UNIVERS_INDEX
];

191 
	}
}

195 
Com´essÜ
* 
	gPrš‹r
::
	$C»©eCom´essÜ
 (
Ra¡”Size
)

197  
Ãw
 
	`Mode9
 (
pSS
, 
Ra¡”Size
);

198 
	}
}

201 
Com´essÜ
* 
	gPrš‹r
::
	$C»©eBÏckPÏÃCom´essÜ
 (
Ra¡”Size
,

202 
BOOL
 
bVIPPrš‹r
)

204  
Ãw
 
	`Mode9
 (
pSS
, 
Ra¡”Size
, 
bVIPPrš‹r
);

205 
	}
}

212 
DRIVER_ERROR
 
	gPrš‹r
::
Flush


214 
FlushSize


219 
ASSERT
(
FlushSize
 > 0);

220 
ASSERT
(
FlushSize
 <ğ
MAX_RASTERSIZE
);

222 
DRIVER_ERROR
 
	g”r
 = 
NO_ERROR
;

223 
	giChunkSize
 = 1000;

224 
BYTE
 *
	gz”o
 = 
NULL
;

231 
	giChunkSize
 > 10 && 
	gz”o
 =ğ
NULL
)

233 
z”o
 = 
pSS
->
AÎocMem
(
iChunkSize
);

234 ià(
	gz”o
 =ğ
NULL
)

236 
iChunkSize
 /= 2;

240 ià(
	gz”o
 =ğ
NULL
)

242  
ALLOCMEM_ERROR
;

245 
mem£t
(
z”o
, 0, 
iChunkSize
);

246 
	giChunks
 = (
FlushSize
 / 
iChunkSize
) + 1;

248 
	gi
 = 0; i < 
	giChunks
; i++)

250 ià((
	g”r
 = 
S’d
Ğ
z”o
, 
iChunkSize
)è!ğ
NO_ERROR
)

255 
	gpSS
->
F»eMem
(
z”o
);

256  
	g”r
;

280 
DISPLAY_STATUS
 
	gPrš‹r
::
P¬£E¼Ü


282 
BYTE
 
¡©us_»g


285 
DBG1
("Printer:…arsingƒrror info\n");

287 
DRIVER_ERROR
 
	g”r
 = 
NO_ERROR
;

288 
BYTE
 
	gDevIDBufãr
[
DevIDBuffSize
];

290 if(
	gIOMode
.
	gbDevID
)

294 
	g”r
 = 
pSS
->
G‘DeviûID
(
DevIDBufãr
, 
DevIDBuffSize
, 
TRUE
);

295 if(
	g”r
 !ğ
NO_ERROR
)

299  
DISPLAY_COMM_PROBLEM
;

305 ià(
	gIOMode
.
	gbStus
)

307 iàĞ
DEVICE_IS_OOP
(
¡©us_»g
) )

309 
DBG1
("Out Of Paper\n");

310  
	gDISPLAY_OUT_OF_PAPER
;

313 ià(
DEVICE_PAPER_JAMMED
(
¡©us_»g
))

315 
DBG1
("Paper Jammed\n");

316  
	gDISPLAY_PAPER_JAMMED
;

318 ià(
DEVICE_IO_TRAP
(
¡©us_»g
))

320 
DBG1
("IO Trap\n");

321  
	gDISPLAY_ERROR_TRAP
;

325 ià(
	gIOMode
.
	gbDevID
)

327 iàĞ
TİCov”O³n
(
¡©us_»g
) )

329 
DBG1
("Top Cover Open\n");

330  
	gDISPLAY_TOP_COVER_OPEN
;

335 
V”ifyP’Info
();

340 ià(
	gpSS
->
Prš‹rIsAlive
())

342 
	giTÙ®_SLOW_POLL_CouÁ
 +ğ
iMax_SLOW_POLL_CouÁ
;

353 ((
	gIOMode
.
	gbDevID
 =ğ
FALSE
è&& (
iTÙ®_SLOW_POLL_CouÁ
 >= 60)) ||

354 ((
IOMode
.
bDevID
 =ğ
TRUE
è&& (
iTÙ®_SLOW_POLL_CouÁ
 >= 120))

357  
DISPLAY_BUSY
;

361  
	gDISPLAY_PRINTING
;

366  
	gDISPLAY_COMM_PROBLEM
;

370 
DRIVER_ERROR
 
	gPrš‹r
::
EnÿpsuÏ‹


372 cÚ¡ 
RASTERDATA
* 
IÅutRa¡”
,

373 
BOOL
 
	gbLa¡PÏÃ


376 
DRIVER_ERROR
 
	g”r
;

377 
	gsü©ch
[20];

378 
	gsü©chL’
;

380 ià(
	gbLa¡PÏÃ
)

382 ià(
VIPPrš‹r
())

384 ià(
	gIÅutRa¡”
->
	g¿¡”size
[
COLORTYPE_BLACK
] != 0)

386 ià(
IÅutRa¡”
->
¿¡”size
[
COLORTYPE_COLOR
] != 0)

388 
sü©chL’
 = 
¥rštf
 (
sü©ch
, "\033*b%uV", 
IÅutRa¡”
->
¿¡”size
[
COLORTYPE_BLACK
]);

389 
	g”r
 = 
S’d
 ((cÚ¡ 
BYTE
*è
sü©ch
, 
sü©chL’
);

390 ià(
	g”r
 =ğ
NO_ERROR
)

392 
”r
 = 
S’d
 (
IÅutRa¡”
->
¿¡”d©a
[
COLORTYPE_BLACK
], IÅutRa¡”->
¿¡”size
[COLORTYPE_BLACK]);

394 ià(
	g”r
 =ğ
NO_ERROR
)

396 
sü©chL’
 = 
¥rštf
 (
sü©ch
, "\033*b%uW", 
IÅutRa¡”
->
¿¡”size
[
COLORTYPE_COLOR
]);

397 
	g”r
 = 
S’d
 ((cÚ¡ 
BYTE
*è
sü©ch
, 
sü©chL’
);

398 ià(
	g”r
 =ğ
NO_ERROR
)

400 
”r
 = 
S’d
 (
IÅutRa¡”
->
¿¡”d©a
[
COLORTYPE_COLOR
], IÅutRa¡”->
¿¡”size
[COLORTYPE_COLOR]);

406 
	gsü©chL’
 = 
¥rštf
 (
sü©ch
, "\033*b%uV", 
IÅutRa¡”
->
¿¡”size
[
COLORTYPE_BLACK
]);

407 
	g”r
 = 
S’d
 ((cÚ¡ 
BYTE
*è
sü©ch
, 
sü©chL’
);

408 ià(
	g”r
 =ğ
NO_ERROR
)

410 
”r
 = 
S’d
 (
IÅutRa¡”
->
¿¡”d©a
[
COLORTYPE_BLACK
], IÅutRa¡”->
¿¡”size
[COLORTYPE_BLACK]);

411 ià(
	g”r
 =ğ
NO_ERROR
)

413 
sü©chL’
 = 
¥rštf
 (
sü©ch
, "\033*b%uW", 0);

414 
	g”r
 = 
S’d
 ((cÚ¡ 
BYTE
*è
sü©ch
, 
sü©chL’
);

421 
	gsü©chL’
 = 
¥rštf
 (
sü©ch
, "\033*b%uV", 0);

422 
	g”r
 = 
S’d
 ((cÚ¡ 
BYTE
*è
sü©ch
, 
sü©chL’
);

423 ià(
	g”r
 =ğ
NO_ERROR
)

425 
sü©chL’
 = 
¥rštf
 (
sü©ch
, "\033*b%uW", 
IÅutRa¡”
->
¿¡”size
[
COLORTYPE_COLOR
]);

426 
	g”r
 = 
S’d
 ((cÚ¡ 
BYTE
*è
sü©ch
, 
sü©chL’
);

427 ià(
	g”r
 =ğ
NO_ERROR
 && 
IÅutRa¡”
->
¿¡”size
[
COLORTYPE_COLOR
] != 0)

429 
”r
 = 
S’d
 (
IÅutRa¡”
->
¿¡”d©a
[
COLORTYPE_COLOR
], IÅutRa¡”->
¿¡”size
[COLORTYPE_COLOR]);

436 
	gsü©chL’
 = 
¥rštf
 (
sü©ch
, "\033*b%uW", 
IÅutRa¡”
->
¿¡”size
[
COLORTYPE_COLOR
]);

437 
	g”r
 = 
S’d
 ((cÚ¡ 
BYTE
*è
sü©ch
, 
sü©chL’
);

438 ià(
	g”r
 =ğ
NO_ERROR
)

440 
”r
 = 
S’d
 (
IÅutRa¡”
->
¿¡”d©a
[
COLORTYPE_COLOR
], IÅutRa¡”->
¿¡”size
[COLORTYPE_COLOR]);

446 
	gsü©chL’
 = 
¥rštf
 (
sü©ch
, "\033*b%uV", 
IÅutRa¡”
->
¿¡”size
[
COLORTYPE_COLOR
]);

447 
	g”r
 = 
S’d
 ((cÚ¡ 
BYTE
*è
sü©ch
, 
sü©chL’
);

448 ià(
	g”r
 =ğ
NO_ERROR
)

450 
”r
 = 
S’d
 (
IÅutRa¡”
->
¿¡”d©a
[
COLORTYPE_COLOR
], IÅutRa¡”->
¿¡”size
[COLORTYPE_COLOR]);

453  
	g”r
;

457 
DRIVER_ERROR
 
	gPrš‹r
::
S’d


459 cÚ¡ 
BYTE
* 
pWr™eBuff


462 
ASSERT
(
pWr™eBuff
);

463 
	gËn
 = 
¡¾’
((cÚ¡ *)
pWr™eBuff
);

464  
S’d
(
pWr™eBuff
,
Ën
);

505 
DRIVER_ERROR
 
	gPrš‹r
::
S’d


507 cÚ¡ 
BYTE
* 
pWr™eBuff
,

508 
DWORD
 
	gdwWr™eCouÁ


511 
ASSERT
(
pWr™eBuff
);

513 
DRIVER_ERROR
 
	gwr™e_”rÜ
 = 
NO_ERROR
;

514 
DWORD
 
	g»sidu®
 = 0;

515 cÚ¡ 
BYTE
 * 
	gpWr™ePos
 = 
NULL
;

516 
BOOL
 
	g”rÜ_di¥Ïyed
 = 
FALSE
;

517 
BYTE
 
	g¡©us_»g
 = 0;

518 
DISPLAY_STATUS
 
	geDi¥ÏyStus
 = 
DISPLAY_PRINTING
;

519 
BOOL
 
	gJobCªûËd
 = 
FALSE
;

522 cÚ¡ 
BYTE
 * 
	gpBufãr
 = 
pWr™eBuff
;

523 
DWORD
 
	gdwS’dSize
 = 
dwWr™eCouÁ
;

526 #ifdeà
NULL_IO


529  
	gNO_ERROR
;

533 ià(
	gE¼ÜT”mš©iÚS‹
)

535  
	gJOB_CANCELED
;

538 ià(
	gEndJob
 =ğ
FALSE
 && 
dwWr™eCouÁ
 == 0)

540  
NO_ERROR
;

543 #ifdeà
APDK_BUFFER_SEND


544 
DWORD
 
	gBy‹sToWr™e
 = 
dwWr™eCouÁ
;

549 iàĞ(
	gBy‹sToWr™e
 >ğ
iBuffSize
è&& (
iCu¼BuffSize
 == 0) )

551 
pBufãr
 = 
pWr™eBuff
+(
dwWr™eCouÁ
-
By‹sToWr™e
);

552 
	gdwS’dSize
 = 
By‹sToWr™e
;

553 
	gBy‹sToWr™e
 = 0;

558 ià(
	gBy‹sToWr™e
 <ğ
DWORD
(
iBuffSize
-
iCu¼BuffSize
))

560 
memıy
((*)(
pS’dBufãr
+
iCu¼BuffSize
),

561 (*)(
pWr™eBuff
+(
dwWr™eCouÁ
-
By‹sToWr™e
)),BytesToWrite);

562 
	giCu¼BuffSize
 +ğ
By‹sToWr™e
;

563 
	gBy‹sToWr™e
 = 0;

567 
memıy
((*)(
pS’dBufãr
+
iCu¼BuffSize
),

568 (*)(
pWr™eBuff
+(
dwWr™eCouÁ
-
By‹sToWr™e
)),

569 
iBuffSize
-
iCu¼BuffSize
);

570 
	gBy‹sToWr™e
 -ğ(
iBuffSize
-
iCu¼BuffSize
);

571 
	giCu¼BuffSize
 = 
iBuffSize
;

577 iàĞ(
	gEndJob
 =ğ
FALSE
è&& (
iCu¼BuffSize
 !ğ
iBuffSize
) )

583 
	gpBufãr
 = 
pS’dBufãr
;

584 
	gdwS’dSize
 = 
iCu¼BuffSize
;

590 
	g»sidu®
 = 
dwS’dSize
;

592 ià(
	gbCheckFÜCªûlBu‰Ú
 &&

593 (
	gulBy‹sS’tSšûCªûlCheck
 >ğ
CANCEL_BUTTON_CHECK_THRESHOLD
) &&

594 (
pSS
->
IOMode
.
bDevID
))

596 
ulBy‹sS’tSšûCªûlCheck
 = 0;

597 * 
	gtmpSŒ
;

598 
BYTE
 
	gDevIDBufãr
[
DevIDBuffSize
];

599 
DRIVER_ERROR
 
	gtmpE¼
 = 
pSS
->
G‘DeviûID
(
DevIDBufãr
, 
DevIDBuffSize
, 
TRUE
);

600 if(
	gtmpE¼
)

601  
	gtmpE¼
;

602 
BOOL
 
	gÿnûlcheck
=
FALSE
;

604 if((
	gtmpSŒ
 = 
¡r¡r
((*)
DevIDBufãr
 + 2,"CNCL")))

606 
	gÿnûlcheck
=
TRUE
;

610 
	giV”siÚ
 = 
pSS
->
G‘VIPV”siÚ
 ();

612 if((
	gtmpSŒ
 = 
¡r¡r
((*)
DevIDBufãr
 + 2,";S:")) &&

613 
	giV”siÚ
 < 6)

622 ià(
	giV”siÚ
 < 3)

624 
	gtmpSŒ
 += 17;

626 ià(
	giV”siÚ
 < 5)

628 
	gtmpSŒ
 += 19;

632 
	gtmpSŒ
 += 23;

635 
BYTE
 
	gb1
=*
tmpSŒ
++;

636 
BYTE
 
	gb2
=*
tmpSŒ
++;

637 ià(((
	gb1
=='0'è&& (
b2
=='5')è&& 
iV”siÚ
 <= 5)

639 
ÿnûlcheck
=
TRUE
;

643 ià(
	gÿnûlcheck
)

648 
	gE¼ÜT”mš©iÚS‹
 = 
TRUE
;

649 
	gpSS
->
Di¥ÏyPrš‹rStus
(
DISPLAY_PRINTING_CANCELED
);

650  
	gJOB_CANCELED
;

657 ià(
	g»sidu®
 <= 0)

659  
NO_ERROR
;

662 
	g»sidu®
 > 0)

664 
DWORD
 
	g´ev_»sidu®
 = 
»sidu®
;

667 
	gpWr™ePos
 = (cÚ¡ 
BYTE
 *è&(
pBufãr
[
dwS’dSize
-
»sidu®
]);

668 
	gwr™e_”rÜ
 = 
pSS
->
ToDeviû
(
pWr™ePos
, &
»sidu®
);

685 
	gwr™e_”rÜ
 = 
NO_ERROR
;

686 
	geDi¥ÏyStus
 = 
DISPLAY_PRINTING
;

687 ià(
	g»sidu®
 == 0)

689 ià(
m_bStusByPJL
)

691 
¡©us_»g
 = (
BYTE
è
DISPLAY_PRINTING
;

692 ià(
	gIOMode
.
	gbStus
)

693 
	geDi¥ÏyStus
 = 
P¬£E¼Ü
 (
¡©us_»g
);

694 ià(
	geDi¥ÏyStus
 !ğ
DISPLAY_PRINTING
)

695 
wr™e_”rÜ
 = 
IO_ERROR
;

699 iàĞ(
	gInSlowPŞlMode
 != 0) &&

700 (
´ev_»sidu®
 > 
MIN_XFER_FOR_SLOW_POLL
) )

702 
InSlowPŞlMode
 = 0;

703 
	giTÙ®_SLOW_POLL_CouÁ
 = 0;

705 ià(
	gwr™e_”rÜ
 =ğ
NO_ERROR
)

714 ià(
	gInSlowPŞlMode
 > 
	giMax_SLOW_POLL_CouÁ
 )

716 ià(
	gJobCªûËd
 =ğ
TRUE
)

720 
DBG1
("Send(SlowPoll): Premature„eturn w/ JOB_CANCELED\n");

721 
	gE¼ÜT”mš©iÚS‹
 = 
TRUE
;

722  
	gJOB_CANCELED
;

725 
DBG1
("Printer slow…ollimesƒxceeded\n");

727 
	gInSlowPŞlMode
 = 1;

728 
	gwr™e_”rÜ
 = 
IO_ERROR
;

732 
	gwr™e_”rÜ
 = 
NO_ERROR
;

736 iàĞ(
	g´ev_»sidu®
 - 
	g»sidu®
è<ğ
MIN_XFER_FOR_SLOW_POLL
)

738 
InSlowPŞlMode
++;

740 #ià
defšed
(
DEBUG
è&& (
DBG_MASK
 & 
DBG_LVL1
)

741 ià(
	gInSlowPŞlMode
 == 1)

743 
´štf
("entering slow…oll mode\n");

747 
´štf
("still in slow…oll mode, count = %d\n",

748 
InSlowPŞlMode
);

752 ià(
	gpSS
->
BusyWa™
((
DWORD
)200è=ğ
JOB_CANCELED
)

754 
DBG1
("Send: JOB_CANCELED\n");

755 
	gJobCªûËd
 = 
TRUE
;

756 
	gpSS
->
Di¥ÏyPrš‹rStus
(
DISPLAY_PRINTING_CANCELED
);

763 
DBG1
("Partial Send but‚ot slow…oll mode\n");

764 
	gInSlowPŞlMode
 = 0;

765 
	giTÙ®_SLOW_POLL_CouÁ
 = 0;

769 ià(
	gwr™e_”rÜ
 !ğ
NO_ERROR
 || (
m_bStusByPJL
 && 
eDi¥ÏyStus
 !ğ
DISPLAY_PRINTING
))

773 
DBG1
("Parsing…ossibleƒrror state...\n");

774 
	g”rÜ_di¥Ïyed
 = 
TRUE
;

776 ià(
	gm_bStusByPJL
)

778 
	g¡©us_»g
 = (
BYTE
è
eDi¥ÏyStus
;

783 ià(
	gIOMode
.
	gbStus
)

785 
	gpSS
->
G‘StusInfo
(&
¡©us_»g
);

789 
	geDi¥ÏyStus
 = 
P¬£E¼Ü
(
¡©us_»g
);

792 
	geDi¥ÏyStus
)

794 
	gDISPLAY_PRINTING_CANCELED
:

800 
E¼ÜT”mš©iÚS‹
 = 
TRUE
;

801 
	gpSS
->
Di¥ÏyPrš‹rStus
(
eDi¥ÏyStus
);

802  
	gJOB_CANCELED
;

804 
	gDISPLAY_ERROR_TRAP
:

805 
DISPLAY_COMM_PROBLEM
:

810 
E¼ÜT”mš©iÚS‹
 = 
TRUE
;

811 
	gpSS
->
Di¥ÏyPrš‹rStus
(
eDi¥ÏyStus
);

816 
	gpSS
->
BusyWa™
(500è!ğ
JOB_CANCELED
)

821  
	gIO_ERROR
;

823 
	gDISPLAY_TOP_COVER_OPEN
:

825 
pSS
->
Di¥ÏyPrš‹rStus
(
DISPLAY_TOP_COVER_OPEN
);

828  
	geDi¥ÏyStus
 =ğ
DISPLAY_TOP_COVER_OPEN
)

830 ià(
pSS
->
BusyWa™
((
DWORD
)500è=ğ
JOB_CANCELED
)

834 
E¼ÜT”mš©iÚS‹
 = 
TRUE
;

835  
	gJOB_CANCELED
;

838 ià(
	gm_bStusByPJL
)

840 
	g¡©us_»g
 = (
BYTE
è
eDi¥ÏyStus
;

844 ià(
	gIOMode
.
	gbStus
)

846 
	gpSS
->
G‘StusInfo
(&
¡©us_»g
);

850 
	geDi¥ÏyStus
 = 
P¬£E¼Ü
(
¡©us_»g
);

853 
	gpSS
->
Di¥ÏyPrš‹rStus
(
DISPLAY_PRINTING
);

856 ià(
	gpSS
->
BusyWa™
((
DWORD
)1000è=ğ
JOB_CANCELED
)

861 
DBG1
("Send: JOB_CANCELED\n");

862 
	gJobCªûËd
 = 
TRUE
;

863 
	gpSS
->
Di¥ÏyPrš‹rStus
(
DISPLAY_PRINTING_CANCELED
);

868 
	gDISPLAY_OUT_OF_PAPER
:

869 
DISPLAY_PHOTOTRAY_MISMATCH
:

871 
DISPLAY_STATUS
 
tmpStus
 = 
eDi¥ÏyStus
;

872 
	gpSS
->
Di¥ÏyPrš‹rStus
(
eDi¥ÏyStus
);

876  
	geDi¥ÏyStus
 =ğ
tmpStus
)

878 ià(
pSS
->
BusyWa™
((
DWORD
)500è=ğ
JOB_CANCELED
)

882 
E¼ÜT”mš©iÚS‹
 = 
TRUE
;

883  
	gJOB_CANCELED
;

886 ià(
	gm_bStusByPJL
)

888 
	g¡©us_»g
 = (
BYTE
è
eDi¥ÏyStus
;

892 ià(
	gIOMode
.
	gbStus
)

894 
	gpSS
->
G‘StusInfo
(&
¡©us_»g
);

898 
	geDi¥ÏyStus
 = 
P¬£E¼Ü
(
¡©us_»g
);

901 
	gpSS
->
Di¥ÏyPrš‹rStus
(
DISPLAY_PRINTING
);

906 
	gDISPLAY_BUSY
:

908 ià(
pSS
->
BusyWa™
((
DWORD
)5000è=ğ
JOB_CANCELED
)

910 
E¼ÜT”mš©iÚS‹
 = 
TRUE
;

911  
	gJOB_CANCELED
;

914 
	gpSS
->
Di¥ÏyPrš‹rStus
(
DISPLAY_BUSY
);

921 
pSS
->
Di¥ÏyPrš‹rStus
(
eDi¥ÏyStus
);

928 ià(
	gpSS
->
BusyWa™
((
DWORD
)100è=ğ
JOB_CANCELED
)

930 
DBG1
("Send: JOB_CANCELED\n");

931 
	gJobCªûËd
 = 
TRUE
;

932 
	gpSS
->
Di¥ÏyPrš‹rStus
(
DISPLAY_PRINTING_CANCELED
);

940 ià(
	gpSS
->
BusyWa™
((
DWORD
)0è=ğ
JOB_CANCELED
)

942 
JobCªûËd
 = 
TRUE
;

943 
	gpSS
->
Di¥ÏyPrš‹rStus
(
DISPLAY_PRINTING_CANCELED
);

946 #ifdeà
APDK_BUFFER_SEND


948 
	giCu¼BuffSize
 = 0;

950 } 
	gBy‹sToWr™e
 > 0);

954 ià(
	gJobCªûËd
 =ğ
TRUE
)

956 
DBG1
("Send: Clean„eturn w/ JOB_CANCELED\n");

958 
	gpSS
->
Di¥ÏyPrš‹rStus
(
DISPLAY_PRINTING_CANCELED
);

959  
	gJOB_CANCELED
;

964 
	gpSS
->
Di¥ÏyPrš‹rStus
(
DISPLAY_PRINTING
);

965 ià(
	gbCheckFÜCªûlBu‰Ú
)

967 
	gulBy‹sS’tSšûCªûlCheck
 +ğ
dwWr™eCouÁ
;

969  
	gNO_ERROR
;

974 
BOOL
 
	gPrš‹r
::
TİCov”O³n


976 
BYTE


979 * 
pSŒ
;

980 
BYTE
 
	gbDevIDBuff
[
DevIDBuffSize
];

982 if(
	gIOMode
.
	gbDevID
 =ğ
FALSE
)

984  
FALSE
;

987 
DRIVER_ERROR
 
	g”r
 = 
pSS
->
G‘DeviûID
(
bDevIDBuff
, 
DevIDBuffSize
, 
TRUE
);

988 ià(
	g”r
 !ğ
NO_ERROR
)

990  
FALSE
;

993 ifĞ(
	gpSŒ
=
¡r¡r
((*)
bDevIDBuff
+2,"VSTATUS:")) )

995 
	gpSŒ
+=8;

998 ià(
¡r¡r
((*)
pSŒ
,"UP"))

1000  
	gTRUE
;

1002 ià(
¡r¡r
((*)
pSŒ
,"DN"))

1004  
	gFALSE
;

1007 
DBG1
("didn't find UP or DN!!\n");

1008  
	gFALSE
;

1011 ià(Ğ
	gpSŒ
 = 
¡r¡r
 ((*è
bDevIDBuff
+2, ";S")))

1013 iàĞ(*(
	gpSŒ
+5) == '9') )

1015  
TRUE
;

1019  
	gFALSE
;

1024  
	gFALSE
;

1029 
DRIVER_ERROR
 
	gPrš‹r
::
	$CËªP’
()

1031 
	`DBG1
("Printer::ClearPen() called\n");

1033 
DWORD
 
Ëngth
=(
PEN_CLEAN_PML
);

1034  
pSS
->
	`ToDeviû
(
PEN_CLEAN_PML
,&
Ëngth
);

1035 
	}
}

1038 
PrštMode
* 
	gPrš‹r
::
G‘Mode


1040 
šdex


1043 ià(
šdex
 >ğ
ModeCouÁ
)

1045  
NULL
;

1048  
	gpMode
[
šdex
];

1052 
	gPrštMode
::
PrštMode


1054 
ušt32_t
 *
m­1
,

1055 
ušt32_t
 *
	gm­2


1058 
	gpmQu®™y
 = 
QUALITY_NORMAL
;

1059 
	gpmMedŸTy³
 = 
MEDIA_PLAIN
;

1060 
	gpmCŞÜ
 = 
COLOR
;

1061 
	giCouÁ
;

1063 
	gcm­
.
	gulM­1
 = 
m­1
;

1064 
	gcm­
.
	gulM­2
 = 
m­2
;

1065 
	gcm­
.
	gulM­3
 = 
NULL
;

1067 
	gBa£ResX
 = 
Ba£ResY
 = 
TextRes
 = 300;

1068 
	gMixedRes
ğ
FALSE
;

1071 
	giCouÁ
 = 0; iCouÁ < 
	gMAXCOLORPLANES
; iCount++)

1073 
	gResŞutiÚX
[
iCouÁ
] = 
Ba£ResX
;

1074 
	gResŞutiÚY
[
iCouÁ
] = 
Ba£ResY
;

1075 
	gCŞÜD•th
[
iCouÁ
] = 1;

1078 
	gmedium
 = 
medŸPÏš
;

1079 
	gtheQu®™y
 = 
qu®™yNÜm®
;

1080 
	gdyeCouÁ
=4;

1082 
	gCÚfig
.
	gbResSyÁh
 = 
TRUE
;

1084 #ià
defšed
(
APDK_VIP_COLORFILTERING
)

1085 
	gCÚfig
.
	gbEº›
 = 
FALSE
;

1088 
	gCÚfig
.
	gbPix–R•liÿ‹
 = 
TRUE
;

1089 
	gCÚfig
.
	gbCŞÜImage
 = 
TRUE
;

1090 
	gCÚfig
.
	gbCom´ess
 = 
TRUE
;

1091 
	gCÚfig
.
	geHT
 = 
FED
;

1092 
	gBÏckFEDTabË
 = 
G‘HTBš¬y
();

1093 
	gCŞÜFEDTabË
 = 
G‘HTBš¬y
();

1097 
	gbFÚtC­abË
 = 
TRUE
;

1098 
	gCom·tibËP’s
[0] = 
BOTH_PENS
;

1099 
	giCouÁ
 = 1; iCouÁ < 
	gMAX_COMPATIBLE_PENS
; iCount++)

1101 
	gCom·tibËP’s
[
iCouÁ
] = 
DUMMY_PEN
;

1104 #ifdeà
APDK_AUTODUPLEX


1105 
	gbDu¶exC­abË
 = 
FALSE
;

1106 
	gDu¶exMode
 = 
DUPLEXMODE_NONE
;

1112 
	gG¿yMode
::
G¿yMode


1114 
ušt32_t
 *
m­


1116 
	$PrštMode
(
m­
)

1119 
CŞÜD•th
[
K
] = 1;

1120 
dyeCouÁ
 = 1;

1121 
Com·tibËP’s
[1] = 
BLACK_PEN
;

1122 
pmCŞÜ
 = 
GREY_K
;

1123 
	}
}

1126 
	gCMYG¿yMode
::
CMYG¿yMode


1128 
ušt32_t
 *
m­


1130 
	$G¿yMode
(
m­
)

1132 
Com·tibËP’s
[1] = 
COLOR_PEN
;

1133 
dyeCouÁ
 = 3;

1134 
pmCŞÜ
 = 
GREY_CMY
;

1135 
	}
}

1138 
	gKCMYG¿yMode
::
KCMYG¿yMode


1140 
ušt32_t
 *
m­


1142 
	$G¿yMode
(
m­
)

1144 
dyeCouÁ
 = 4;

1145 
pmCŞÜ
 = 
GREY_CMY
;

1146 
	}
}

1149 
DRIVER_ERROR
 
	gPrš‹r
::
S‘P’Info


1151 *& 
pSŒ
,

1152 
BOOL
 
	gQu”yPrš‹r


1155 
DRIVER_ERROR
 
	g”r
;

1157 ià(
	gQu”yPrš‹r
)

1160 
	g”r
 = 
pSS
->
G‘DeviûID
ÕSS->
¡rDevID
, 
DevIDBuffSize
, 
TRUE
);

1161 
	gERRCHECK
;

1164 
	g”r
 = 
pSS
->
DR
->
P¬£DevIDSŒšg
((cÚ¡ *)ÕSS->
¡rDevID
),pSS->
¡rMod–
,&ÕSS->
VIPV”siÚ
),pSS->
¡rP’s
);

1165 
	gERRCHECK
;

1167 ià((
	gpSŒ
 = 
¡r¡r
((*)
pSS
->
¡rDevID
,"VSTATUS:")))

1169 
	gpSŒ
 += 8;

1171 ià((
	gpSŒ
 = 
¡r¡r
((*)
pSS
->
¡rDevID
, ";S:00")))

1173 
	gpSŒ
 += 19;

1175 ià((
	gpSŒ
 = 
¡r¡r
 ((*è
pSS
->
¡rDevID
, ";S:01")))

1177 
	gpSŒ
 += 19;

1179 ià((
	gpSŒ
 = 
¡r¡r
((*)
pSS
->
¡rDevID
, ";S:02")))

1182 
	gpSŒ
 += 19;

1184 ià((
	gpSŒ
 = 
¡r¡r
((*)
pSS
->
¡rDevID
, ";S:03")))

1186 
	gpSŒ
 += 21;

1188 ià((
	gpSŒ
 = 
¡r¡r
((*)
pSS
->
¡rDevID
, ";S:04")))

1190 
	gpSŒ
 += 25;

1192 ià((
	gpSS
->
G‘VIPV”siÚ
 ()) > 5)

1194  
	gNO_ERROR
;

1198 
TRACE
("Prš‹r::S‘P’InfØ- UnsuµÜ‹d DeviûID %s.\n", 
pSS
->
¡rDevID
);

1200  
	gBAD_DEVICE_ID
;

1205 
	gpSŒ
 = 
pSS
->
¡rP’s
;

1207  
	gNO_ERROR
;

1211 
BOOL
 
	gPrštMode
::
Com·tibË


1213 
PEN_TYPE
 
³ns


1216 
BOOL
 
»s
 = 
FALSE
;

1217 
	gi
=0; i < 
	gMAX_COMPATIBLE_PENS
; i++)

1219 ià(
	gCom·tibËP’s
[
i
] =ğ
³ns
)

1221 
»s
 = 
TRUE
;

1224  
	g»s
;

1229 
DRIVER_ERROR
 
	gPrš‹r
::
S‘P’s


1231 
PEN_TYPE
 
eNewP’


1234 
ASSERT
(
eNewP’
 <ğ
MAX_PEN_TYPE
);

1238 ià(
	geNewP’
 <ğ
MAX_PEN_TYPE
)

1240 
eP’
 = 
eNewP’
;

1241  
	gNO_ERROR
;

1245  
	gUNSUPPORTED_PEN
;

1249 
	gPrštMode
::
G‘V®ues


1251 
QUALITY_MODE
& 
eQu®™y
,

1252 
	gMEDIATYPE
& 
	geMedŸ
,

1253 
	gCOLORMODE
& 
	geCŞÜ
,

1254 
	gBOOL
& 
	gbDeviûText


1257 ià(&
	geQu®™y
 !ğ
NULL
)

1259 
eQu®™y
 = 
pmQu®™y
;

1262 ià(&
	geMedŸ
 !ğ
NULL
)

1264 
eMedŸ
 = 
pmMedŸTy³
;

1267 ià(&
	geCŞÜ
 !ğ
NULL
)

1269 
eCŞÜ
 = 
pmCŞÜ
;

1272 ià(&
	gbDeviûText
 !ğ
NULL
)

1274 
bDeviûText
 = 
bFÚtC­abË
;

1279 
	gPrš‹r
::
	$S‘PMIndiûs
()

1281 
i
=0; i < 
ModeCouÁ
; i++)

1283 
pMode
[
i
]->
myIndex
 = i;

1285 
	}
}

1287 
	gAPDK_END_NAMESPACE


	@prnt/hpijs/printer.h

32 #iâdeà
APDK_PRINTER_H


33 
	#APDK_PRINTER_H


	)

35 
	~"modes.h
"

37 
	gAPDK_BEGIN_NAMESPACE


42 
	#MAX_PRINTER_FONTS
 4

	)

43 
	#NUM_DJ400_FONTS
 3

44 
	#NUM_DJ6XX_FONTS
 4

45 

	)

46 
	#MAX_COMPATIBLE_PENS
 
MAX_PEN_TYPE
 + 1

	)

48 
	#CANCEL_BUTTON_CHECK_THRESHOLD
 150000

50 

	)

51 
şass
 
	gCom´essÜ
;

58 şas 
	cPrštMode


60 
ä›nd
 
şass
 
	mJob
;

61 
ä›nd
 
şass
 
	mH—d”
;

62 
ä›nd
 
şass
 
	mPrštCÚ‹xt
;

63 
ä›nd
 
şass
 
	mT¿n¦©Ü
;

64 
ä›nd
 
şass
 
	mG¿phicsT¿n¦©Ü
;

65 
ä›nd
 
şass
 
	mH®áÚ”
;

66 
ä›nd
 
şass
 
	mPrš‹r
;

67 
ä›nd
 
şass
 
	mTe¡”
;

68 #ifdeà
APDK_DJ9xxVIP


69 
ä›nd
 
şass
 
	mDJG’”icVIP
;

71 #ifdeà
APDK_DJ3320


72 
ä›nd
 
şass
 
	mDJ4100
;

74 
	mpublic
:

75 
PrštMode
 (
ušt32_t
 *
m­1
,ušt32_ˆ*
m­2
=(ušt32_t*)
NULL
);

76 
	mvœtu®
 ~
	$PrštMode
 ()

80 
BOOL
 
	`Com·tibË
(
PEN_TYPE
 
³ns
);

81 
šlše
 
BOOL
 
	$CŞÜCom·tibË
(
COLORMODE
 
cŞÜ
è{  (cŞÜ =ğ
pmCŞÜ
); 
	}
}

82 
šlše
 
BOOL
 
	$Qu®™yCom·tibË
(
QUALITY_MODE
 
eQu®™y
è{  (eQu®™y =ğ
pmQu®™y
); 
	}
}

83 
vœtu®
 
šlše
 
BOOL
 
	$MedŸCom·tibË
(
MEDIATYPE
 
eMedŸ
è{  (eMedŸ =ğ
pmMedŸTy³
); 
	}
}

84 
šlše
 
QUALITY_MODE
 
	$G‘Qu®™yMode
(è{  
pmQu®™y
;
	}
}

85 
šlše
 
MEDIATYPE
 
	$G‘MedŸTy³
(è{  
pmMedŸTy³
; 
	}
}

86 
G‘V®ues
 (
QUALITY_MODE
& 
eQu®™y
, 
MEDIATYPE
& 
eMedŸ
, 
COLORMODE
& 
eCŞÜ
, 
BOOL
& 
bDeviûText
);

89 
	gResŞutiÚX
[
MAXCOLORPLANES
];

90 
	gResŞutiÚY
[
MAXCOLORPLANES
];

92 
	gCŞÜD•th
[
MAXCOLORPLANES
];

94 
MedŸTy³
 
	gmedium
;

96 
BOOL
 
	gbFÚtC­abË
;

100 
PeCÚfigTabË
 
	gCÚfig
;

101 
	gdyeCouÁ
;

102 #ifdeà
APDK_AUTODUPLEX


103 
BOOL
 
	gbDu¶exC­abË
;

104 
	$S‘Du¶exMode
 (
DUPLEXMODE
 
du¶exmode
)

106 
Du¶exMode
 = 
du¶exmode
;

107 ià(
Du¶exMode
 !ğ
DUPLEXMODE_NONE
)

108 
bFÚtC­abË
 = 
FALSE
;

109 
	}
};

111 
DUPLEXMODE
 
	$Qu”yDu¶exMode
 ()

113  
Du¶exMode
;

114 
	}
};

117 
DRIVER_ERROR
 
	$S‘MedŸTy³
 (
MEDIATYPE
 
eMedŸTy³
)

119 ià(
	`MedŸCom·tibË
 (
eMedŸTy³
))

121 
pmMedŸTy³
 = 
eMedŸTy³
;

122  
NO_ERROR
;

124  
WARN_MODE_MISMATCH
;

125 
	}
}

127 
	g´Ùeùed
:

128 
Qu®™y
 
theQu®™y
;

129 #ifdeà
APDK_AUTODUPLEX


130 
DUPLEXMODE
 
	gDu¶exMode
;

133 
CŞÜM­
 
	gcm­
;

135 
	gBa£ResX
,
	gBa£ResY
, 
	gTextRes
;

136 
BOOL
 
	gMixedRes
;

138 * 
	gBÏckFEDTabË
;

139 * 
	gCŞÜFEDTabË
;

142 
PEN_TYPE
 
	gCom·tibËP’s
[
MAX_COMPATIBLE_PENS
];

143 
QUALITY_MODE
 
	gpmQu®™y
;

144 
MEDIATYPE
 
	gpmMedŸTy³
;

145 
COLORMODE
 
	gpmCŞÜ
;

147 
	gmyIndex
;

156 şas 
	cG¿yMode
 : 
public
 
PrštMode


158 
public
:

159 
G¿yMode
(
ušt32_t
 *
m­
);

167 şas 
	cCMYG¿yMode
 : 
public
 
G¿yMode


169 
public
:

170 
CMYG¿yMode
(
ušt32_t
 *
m­
);

177 şas 
	cKCMYG¿yMode
 : 
public
 
G¿yMode


179 
public
:

180 
KCMYG¿yMode
(
ušt32_t
 *
m­
);

188 şas 
	cPrš‹r


190 
ä›nd
 
şass
 
	mJob
;

191 
ä›nd
 
şass
 
	mTe¡”
;

192 
	mpublic
:

194 
Prš‹r
(
Sy¡emS”viûs
* 
pSys
, 
numfÚts
,

195 
BOOL
 
´Ùo
 = 
FALSE
);

197 
	mvœtu®
 ~
Prš‹r
();

199 
DRIVER_ERROR
 
	mcÚ¡ruùÜ_”rÜ
;

201 
vœtu®
 
	$G‘ModeCouÁ
(è{  
ModeCouÁ
; }

202 
vœtu®
 
PrštMode
* 
	`G‘Mode
(
šdex
);

205 #ià
	$defšed
(
APDK_FONTS_NEEDED
)

206 
Reã»nûFÚt
* 
	`EnumFÚt
(& 
iCu¼Idx
);

208 
vœtu®
 
FÚt
* 
	`R—lizeFÚt
(cÚ¡ 
šdex
, cÚ¡ 
BYTE
 
bSize
,

209 cÚ¡ 
TEXTCOLOR
 
eCŞÜ
 = 
BLACK_TEXT
,

210 cÚ¡ 
BOOL
 
bBŞd
 = 
FALSE
,

211 cÚ¡ 
BOOL
 
bIlic
 = 
FALSE
,

212 cÚ¡ 
BOOL
 
bUnd”lše
 = 
FALSE
);

215 
vœtu®
 
DRIVER_ERROR
 
	`S’d
(cÚ¡ 
BYTE
* 
pWr™eBuff
);

216 
vœtu®
 
DRIVER_ERROR
 
	`S’d
(cÚ¡ 
BYTE
* 
pWr™eBuff
, 
DWORD
 
dwWr™eL’
);

218 
vœtu®
 
DRIVER_ERROR
 
	`Flush
(
FlushSize
 = 
MAX_RASTERSIZE
);

221 
vœtu®
 
H—d”
* 
	`S–eùH—d”
(
PrštCÚ‹xt
* 
pc
) = 0;

224 
vœtu®
 
Com´essÜ
* 
	`C»©eCom´essÜ
(
Ra¡”Size
);

226 
vœtu®
 
Com´essÜ
* 
	`C»©eBÏckPÏÃCom´essÜ
 (
Ra¡”Size
, 
BOOL
 
bVIPPrš‹r
 = 
FALSE
);

228 
vœtu®
 
DISPLAY_STATUS
 
	`P¬£E¼Ü
(
BYTE
 
¡©us_»g
);

230 
vœtu®
 
DRIVER_ERROR
 
	`CËªP’
();

232 
vœtu®
 
DRIVER_ERROR
 
	$PagesPrš‹d
(& 
couÁ
)

233 {  
UNSUPPORTED_FUNCTION
; 
	}
}

237 
IO_MODE
 
	gIOMode
;

239 
	giNumFÚts
;

240 
BOOL
 
	gbCheckFÜCªûlBu‰Ú
;

241 
	gulBy‹sS’tSšûCªûlCheck
;

243 
vœtu®
 
BOOL
 
	$U£GUIMode
(
PrštMode
* 
pPrštMode
è{  
FALSE
; 
	}
}

244 
vœtu®
 
BOOL
 
	$U£CMYK
(
iPrštMode
è{  
TRUE
;
	}
}

246 
vœtu®
 
BOOL
 
	$PhÙoT¿yP»£Á
(
BOOL
 
bQu”yPrš‹r
)

247 {  
FALSE
; 
	}
}

249 
vœtu®
 
PHOTOTRAY_STATE
 
	$PhÙoT¿yEngaged
 (
BOOL
 
bQu”yPrš‹r
)

250 {  
DISENGAGED
; 
	}
}

253 
vœtu®
 
BOOL
 
	$HagakiF“dP»£Á
(
BOOL
 
bQu”yPrš‹r
)

254 {  
FALSE
; 
	}
}

256 #ifdeà
APDK_AUTODUPLEX


258 
vœtu®
 
BOOL
 
	$HagakiF“dDu¶ex”P»£Á
(
BOOL
 
bQu”yPrš‹r
)

259 {  
FALSE
; 
	}
}

262 
vœtu®
 
PAPER_SIZE
 
	$Mªd©ÜyP­”Size
()

263 {  
UNSUPPORTED_SIZE
; 
	}
}

266 
šlše
 
vœtu®
 
DRIVER_ERROR
 
	$P¬£P’Info
(
PEN_TYPE
& 
eP’
, 
BOOL
 
Qu”yPrš‹r
 = 
TRUE
)

268 
eP’
 = 
NO_PEN
;

269  
NO_ERROR
;

270 
	}
}

272 
šlše
 
BOOL
 
	$VIPPrš‹r
(è{ 
m_bVIPPrš‹r
;
	}
}

274 
šlše
 
vœtu®
 
BOOL
 
	$SuµÜtS•¬©eBÏck
 (
PrštMode
 *
pCu¼’tMode
è{ 
TRUE
;
	}
}

276 
PEN_TYPE
 
	geP’
;

277 
ušt32_t
 *
	gCMYM­
;

279 
vœtu®
 
DRIVER_ERROR
 
	$CheckInkLev–
(è{  
NO_ERROR
; 
	}
}

281 
vœtu®
 
PEN_TYPE
 
	$DeçuÉP’S‘
(è{  
BOTH_PENS
; 
	}
}

283 
PEN_TYPE
 
	$Aùu®P’s
(è{  
eP’
; 
	}
}

284 
vœtu®
 
DRIVER_ERROR
 
S‘P’s
(
PEN_TYPE
 
eNewP’
);

288 
S‘PMIndiûs
();

290 
vœtu®
 
DRIVER_ERROR
 
	$SkRa¡”s
 (
nBÏnkRa¡”s
)

292  
NO_ERROR
;

293 
	}
}

295 
vœtu®
 
DRIVER_ERROR
 
EnÿpsuÏ‹
 (cÚ¡ 
RASTERDATA
* 
IÅutRa¡”
, 
BOOL
 
bLa¡PÏÃ
);

297 
vœtu®
 
BOOL
 
	$FuÎBËedC­abË
 (
PAPER_SIZE
 
ps
, 
FuÎbËedTy³
 *
fbTy³
, *
xOv”S´ay
, *
yOv”S´ay
,

298 *
fLeáOv”S´ay
 = 
NULL
, *
fTİOv”S´ay
 = NULL)

300 *
fbTy³
 = 
fuÎbËedNÙSuµÜ‹d
;

301  
FALSE
;

302 
	}
}

312 
vœtu®
 
BOOL
 
	$G‘M¬gšs
 (
PAPER_SIZE
 
ps
, *
fM¬gšs
)

314  
FALSE
;

315 
	}
}

322 
vœtu®
 
	$Adju¡ModeS‘tšgs
 (
BOOL
 
bDoFuÎBËed
, 
MEDIATYPE
 
ReqMedŸ
,

323 
MedŸTy³
 *
medium
, 
Qu®™y
 *
qu®™y
)

326 
	}
}

328 
vœtu®
 
	$Prš‹rLªguage
 ()

331 
	}
}

333 
vœtu®
 
DRIVER_ERROR
 
	$SaveText
 (cÚ¡ *
psSŒ
, 
iPoštSize
, 
iX
, 
iY
,

334 cÚ¡ *
pTextSŒšg
, 
iTextSŒšgL’
,

335 
BOOL
 
bUnd”lše
)

337  
NO_ERROR
;

338 
	}
}

341 #ifdeà
APDK_AUTODUPLEX


342 
BOOL
 
	gbDu¶exC­abË
;

343 
BOOL
 
	$RÙ©eImageFÜBackPage
 ()

345  
m_bRÙ©eBackPage
;

346 
	}
};

350 
vœtu®
 
DRIVER_ERROR
 
	$S’dP”PageH—d”
 (
BOOL
 
bLa¡Page
)

352  
NO_ERROR
;

353 
	}
}

354 
vœtu®
 
DRIVER_ERROR
 
	$S‘Hšt
 (
PRINTER_HINT
 
eHšt
, 
iV®ue
)

356  
NO_ERROR
;

357 
	}
}

358 
vœtu®
 
	$G‘Hšt
 (
PRINTER_HINT
 
eHšt
)

361 
	}
}

363 
vœtu®
 
DRIVER_ERROR
 
	$AddPJLH—d”
 ()

365  
NO_ERROR
;

366 
	}
}

368 
	g´Ùeùed
:

369 
Sy¡emS”viûs
* 
pSS
;

370 #ià
	$defšed
(
APDK_FONTS_NEEDED
)

371 
Reã»nûFÚt
* 
fÚ¼ay
[
MAX_PRINTER_FONTS
+1];

374 
InSlowPŞlMode
;

375 
iTÙ®_SLOW_POLL_CouÁ
;

376 
iMax_SLOW_POLL_CouÁ
;

377 
BOOL
 
E¼ÜT”mš©iÚS‹
;

380 cÚ¡ 
iBuffSize
;

381 
BYTE
* 
pS’dBufãr
;

382 
iCu¼BuffSize
;

383 
BOOL
 
EndJob
;

385 
vœtu®
 
DRIVER_ERROR
 
	`V”ifyP’Info
() = 0;

386 
vœtu®
 
BOOL
 
	`TİCov”O³n
(
BYTE
 
¡©us_»g
);

387 
vœtu®
 
DATA_FORMAT
 
	$G‘D©aFÜm©
(è{  
RASTER_LINE
; 
	}
}

388 
DRIVER_ERROR
 
S‘P’Info
(*& 
pSŒ
, 
BOOL
 
Qu”yPrš‹r
);

390 
PrštMode
* 
	gpMode
[
MAX_PRINTMODES
];

391 
	gModeCouÁ
;

392 
BOOL
 
	gm_bVIPPrš‹r
;

393 
BOOL
 
	gm_bStusByPJL
;

394 #ifdeà 
APDK_AUTODUPLEX


395 
BOOL
 
	gm_bRÙ©eBackPage
;

398 
	gm_iNumPages
;

400 
vœtu®
 
	gPrš‹r
& 
	gİ”©Ü
=(cÚ¡ 
Prš‹r
& 
rhs
è{ *
this
;}

404 
	gAPDK_END_NAMESPACE


	@prnt/hpijs/printerfactory.cpp

30 
	~"h—d”.h
"

31 
	~<¡ršg.h
>

32 
	~"´š‹rçùÜy.h
"

34 
APDK_BEGIN_NAMESPACE


36 
Prš‹rFaùÜy
* 
	gPrš‹rFaùÜy
::
s_In¡ªû
 = 
NULL
;

37 
	gPrš‹rFaùÜy
::
ProxyLi¡EËm’t
* 
Prš‹rFaùÜy
::
s_ProxyLi¡
 = 
NULL
;

38 
	gPrš‹rFaùÜy
::
s_uFamyCouÁ
 = 0;

39 
	gPrš‹rFaùÜy
::
s_uPrš‹rCouÁ
 = 0;

41 
HP_¡rÿt
(* 
¡r1
, cÚ¡ * 
¡r2
);

47 
	gPrš‹rFaùÜy
::
Prš‹rFaùÜy


51 
TRACE
("PF::PF\n");

53 
TRACE
("PF - static factory construction complete\n");

61 
	gPrš‹rFaùÜy
::~
Prš‹rFaùÜy


65 
TRACE
("PF::~PF - static factory destructing\n");

66 
ProxyLi¡EËm’t
* 
	gt_Li¡EÁry
;

67 
	gs_ProxyLi¡
)

69 
TRACE
(" - d–‘šg % äom faùÜy†i¡\n", 
s_ProxyLi¡
->
´š‹rProxyEËm’t
->
G‘FamyName
());

70 
	gt_Li¡EÁry
 = 
s_ProxyLi¡
;

71 
	gs_ProxyLi¡
 = 
t_Li¡EÁry
->
Ãxt
;

72 
d–‘e
 
	gt_Li¡EÁry
;

74 
	gs_In¡ªû
 = 
NULL
;

75 
TRACE
("finished PF::~PF\n");

86 
	gPrš‹rFaùÜy
::
Regi¡”


88 cÚ¡ 
Prš‹rProxy
* 
thePrš‹rProxy


93 ià(
s_In¡ªû
 =ğ
NULL
)

95 
TRACE
("PF::Register -‡sking for‚ew factory\n");

97 
	gs_In¡ªû
 = 
Ãw
 
Prš‹rFaùÜy
;

100 
TRACE
("PF::Register\n");

102 
ProxyLi¡EËm’t
* 
	gt_Li¡EÁry
 = 
Ãw
(ProxyListElement);

103 ià(
	gt_Li¡EÁry
 =ğ
NULL
)

112 
	gt_Li¡EÁry
->
	g´š‹rProxyEËm’t
 = 
thePrš‹rProxy
;

113 
	gt_Li¡EÁry
->
	gÃxt
 = 
s_ProxyLi¡
;

114 
	gs_ProxyLi¡
 = 
t_Li¡EÁry
;

115 
	gs_uFamyCouÁ
++;

116 
	gs_uPrš‹rCouÁ
 +ğ
thePrš‹rProxy
->
G‘Mod–CouÁ
();

118 
TRACE
("PF::Regi¡” % »gi¡”ed w™h Prš‹rFaùÜy\n", 
thePrš‹rProxy
->
G‘FamyName
());

119 
TRACE
("Printers supported by class‡re:\n");

120 
MODEL_HANDLE
 
	gmyHªdË
 = 
thePrš‹rProxy
->
S¹Mod–NameEnum
();

121 cÚ¡ * 
	g´š‹rName
;

122 (
	g´š‹rName
 = 
thePrš‹rProxy
->
G‘NextMod–Name
(
myHªdË
)))

124 
TRACE
(" %s\n", 
´š‹rName
);

135 
	gPrš‹rFaùÜy
::
UnRegi¡”


137 cÚ¡ 
Prš‹rProxy
* 
thePrš‹rProxy


142 ià(
s_In¡ªû
 =ğ
NULL
)

144 
TRACE
("Unregistering‡ PrinterProxy when factory does‚otƒxist\n");

148 
TRACE
("PF::UnRegi¡” %s\n", 
thePrš‹rProxy
->
G‘FamyName
());

149 ià(
	gs_ProxyLi¡
 =ğ
NULL
)

151 
TRACE
("PF::UnRegister - Printer Factory…rinter†ist isƒmpty!\n");

154 
ProxyLi¡EËm’t
* 
	g´evLi¡EÁry
 = 
NULL
;

155 
ProxyLi¡EËm’t
* 
	gt_Li¡EÁry
 = 
s_ProxyLi¡
;

156 
boŞ
 
	gbFound
 = 
çl£
;

158 (
	gt_Li¡EÁry
è&& (!
	gbFound
))

160 ià(
	gt_Li¡EÁry
->
	g´š‹rProxyEËm’t
 =ğ
thePrš‹rProxy
)

162 
TRACE
("We foundhe matching…roxy by‡ddress\n");

163 
	gbFound
 = 
Œue
;

164 ià(
	g´evLi¡EÁry
 !ğ
NULL
)

166 
´evLi¡EÁry
->
Ãxt
 = 
t_Li¡EÁry
->next;

170 
	gs_ProxyLi¡
 = 
t_Li¡EÁry
->
Ãxt
;

172 
d–‘e
 
	gt_Li¡EÁry
;

173 
	gs_uFamyCouÁ
--;

174 
	gs_uPrš‹rCouÁ
 -ğ
thePrš‹rProxy
->
G‘Mod–CouÁ
();

176 
	g´evLi¡EÁry
 = 
t_Li¡EÁry
;

177 
	gt_Li¡EÁry
 = 
t_Li¡EÁry
->
Ãxt
;

179 
TRACE
("PF::UnRegi¡”„emoved % äom Prš‹rFaùÜy\n", 
thePrš‹rProxy
->
G‘FamyName
());

180 
TRACE
("PF::UnRegister - factory‚ow supports %d families‡nd %d…rinters\n",

181 
s_uFamyCouÁ
,

182 
s_uPrš‹rCouÁ
);

184 ià(
	gs_ProxyLi¡
 =ğ
NULL
)

186 
TRACE
("PF::UnRegister‡sking for deletion ofƒmpty Factory\n");

187 
d–‘e
 
	gPrš‹rFaùÜy
::
G‘In¡ªû
();

204 cÚ¡ * 
	gPrš‹rFaùÜy
::
G‘NextFamyName


206 
FAMILY_HANDLE
& 
theFamyHªdË


209 
TRACE
("PF::GetNextFamilyName()\n");

210 ià(
ÃxtFamy
(
theFamyHªdË
))

212  
g‘Prš‹rProxy
(
theFamyHªdË
)->
G‘FamyName
();

216  
	gNULL
;

228 cÚ¡ * 
	gPrš‹rFaùÜy
::
G‘FamyName


230 cÚ¡ * 
thePrš‹rName


233 cÚ¡ * 
szFamyName
 = 
NULL
;

234 
FAMILY_HANDLE
 
	gmyFamyHªdË
 = 
FšdDevIdM©ch
(
thePrš‹rName
);

235 ià(
	gmyFamyHªdË
)

237 
	gszFamyName
 = 
g‘Prš‹rProxy
(
myFamyHªdË
)->
G‘FamyName
();

239  
	gszFamyName
;

250 cÚ¡ * 
	gPrš‹rFaùÜy
::
G‘NextMod–Name


252 
FAMILY_HANDLE
 
theFamyHªdË
,

253 
	gMODEL_HANDLE
& 
	gtheMod–HªdË


256 
TRACE
("PF::GetNextModelName()\n");

257 cÚ¡ * 
	gszMod–Name
 = 
NULL
;

258 ià(
	gtheFamyHªdË
 =ğ
NULL
)

260 
theMod–HªdË
 = 
NULL
;

264 
	gszMod–Name
 = 
g‘Prš‹rProxy
(
theFamyHªdË
)->
G‘NextMod–Name
(
theMod–HªdË
);

266  
	gszMod–Name
;

281 cÚ¡ * 
	gPrš‹rFaùÜy
::
G‘NextPrš‹rName


283 
PRINTER_HANDLE
& 
thePrš‹rHªdË


286 
TRACE
("PF::GetNextPrinterName()\n");

287 
FAMILY_HANDLE
 
	gçmyHªdË
;

288 
ÃxtPrš‹r
(
çmyHªdË
, 
thePrš‹rHªdË
);

289  
	g»š‹½»t_ÿ¡
<cÚ¡ *>(
	gthePrš‹rHªdË
);

303 
boŞ
 
	gPrš‹rFaùÜy
::
ÃxtFamy


305 
FAMILY_HANDLE
& 
theFamyHªdË


308 
TRACE
("PF::nextFamily()\n");

309 
boŞ
 
	gbMÜe
 = 
Œue
;

310 cÚ¡ 
ProxyLi¡EËm’t
* 
	g´oxyLi¡
 = 
g‘ProxyLi¡EËm’t
(
theFamyHªdË
);

311 ià(
	g´oxyLi¡
 =ğ
NULL
)

313 
TRACE
("PF::nextFamily -„eseto head of†ist\n");

314 
	gtheFamyHªdË
 = 
s_ProxyLi¡
;

318 
TRACE
("PF::nextFamily -‚extƒlement\n");

319 
	gtheFamyHªdË
 = 
´oxyLi¡
->
Ãxt
;

321 ià(
	gtheFamyHªdË
 =ğ
NULL
)

323 
TRACE
("PF::nextFamily - NULL (end of†ist)\n");

324 
	gbMÜe
 = 
çl£
;

326  
	gbMÜe
;

340 cÚ¡ 
PRINTER_TYPE
 
	gPrš‹rFaùÜy
::
EnumDeviûs


342 
FAMILY_HANDLE
& 
theFamyHªdË


345 
TRACE
("PF::EnumDevices()\n");

346 ià(
ÃxtFamy
(
theFamyHªdË
))

348  
g‘Prš‹rProxy
(
theFamyHªdË
)->
G‘Prš‹rTy³
();

352  
	gUNSUPPORTED
;

368 
boŞ
 
	gPrš‹rFaùÜy
::
ÃxtPrš‹r


370 
FAMILY_HANDLE
& 
theFamyHªdË
,

371 
	gMODEL_HANDLE
& 
	gtheMod–HªdË


374 
TRACE
("PF::nextPrinter(,)\n");

375 
boŞ
 
	gbMÜe
 = 
Œue
;

376 ià(
	gtheFamyHªdË
 =ğ
NULL
)

378 
theFamyHªdË
 = 
S¹FamyNameEnum
();

379 ià(
ÃxtFamy
(
theFamyHªdË
))

381 
	gtheMod–HªdË
 = 
S¹Mod–NameEnum
(
theFamyHªdË
);

385 
	gbMÜe
 = 
çl£
;

386 
	gEXIT
;

389 ià(
G‘NextMod–Name
(
theFamyHªdË
, 
theMod–HªdË
è=ğ
NULL
)

391 if(
ÃxtFamy
(
theFamyHªdË
))

393 
theMod–HªdË
 = 
S¹Mod–NameEnum
(
theFamyHªdË
);

394 ià(
G‘NextMod–Name
(
theFamyHªdË
, 
theMod–HªdË
è=ğ
NULL
)

396 
bMÜe
 = 
çl£
;

401 
	gbMÜe
 = 
çl£
;

405 
	gEXIT
:

407  
bMÜe
;

424 cÚ¡ 
FAMILY_HANDLE
 
	gPrš‹rFaùÜy
::
FšdDevIdM©ch


426 cÚ¡ * 
szDevIdSŒšg


429 
TRACE
("PF::FšdDevIdM©ch(%s)\n", 
szDevIdSŒšg
);

430 
FAMILY_HANDLE
 
	gmyFamyHªdË
 = 
S¹FamyNameEnum
();

432 
boŞ
 
	gbDevIDSŒšg
 = 
TRUE
;

433 ià((!
¡r¡r
(
szDevIdSŒšg
, "MFG:") &&

434 !
¡r¡r
(
szDevIdSŒšg
+2, "MFG:") &&

435 !
¡r¡r
(
szDevIdSŒšg
, "MANUFACTURER:") &&

436 !
¡r¡r
(
szDevIdSŒšg
+2, "MANUFACTURER:")) ||

437 (!
¡r¡r
(
szDevIdSŒšg
, "MDL:") &&

438 !
¡r¡r
(
szDevIdSŒšg
+2, "MDL:") &&

439 !
¡r¡r
(
szDevIdSŒšg
, "MODEL:") &&

440 !
¡r¡r
(
szDevIdSŒšg
+2, "MODEL:")) ||

441 ((
	gszDevIdSŒšg
[0] =ğ'\0'è&& (
szDevIdSŒšg
[1] == '\0')))

443 
bDevIDSŒšg
 = 
FALSE
;

446 
ÃxtFamy
(
myFamyHªdË
))

448 ià(
	gbDevIDSŒšg
)

451 ià(
g‘Prš‹rProxy
(
myFamyHªdË
)->
DeviûM©chQu”y
(
szDevIdSŒšg
))

459 ià(
g‘Prš‹rProxy
(
myFamyHªdË
)->
Mod–M©chQu”y
(
szDevIdSŒšg
))

466  
	gmyFamyHªdË
;

477 cÚ¡ 
	gPrš‹rFaùÜy
::
G‘Mod–B™s


481 
b™s
=0;

482 
TRACE
("PF::GetModelBits\n");

483 
FAMILY_HANDLE
 
	gmyFamyHªdË
 = 
S¹FamyNameEnum
();

485 
ÃxtFamy
(
myFamyHªdË
))

487 ià(
	gmyFamyHªdË
)

489 
	gb™s
 = 
b™s
 | 
g‘Prš‹rProxy
(
myFamyHªdË
)->
G‘Mod–B™
();

492  
	gb™s
;

503 cÚ¡ 
	gPrš‹rFaùÜy
::
G‘Mod–SŒšg


505 * 
m»suÉ
,

506 
	gm»suÉ_Ëngth


509 
as£¹
(
m»suÉ
);

510 
	gm»suÉ
[0] = '\0';

512 
TRACE
("PF::GetModelString\n");

513 
FAMILY_HANDLE
 
	gmyFamyHªdË
 = 
S¹FamyNameEnum
();

514 
	gi
 = 2;

515 cÚ¡ *
	gp
;

516 
ÃxtFamy
(
myFamyHªdË
))

518 
	gp
 = 
g‘Prš‹rProxy
(
myFamyHªdË
)->
G‘FamyName
();

519 
	gi
 +ğ
¡¾’
(
p
) + 1;

520 ià(
	gi
 > 
	gm»suÉ_Ëngth
) ;

521 
HP_¡rÿt
(
m»suÉ
, 
p
);

522 
HP_¡rÿt
(
m»suÉ
, " ");

527 
	gAPDK_END_NAMESPACE


	@prnt/hpijs/printerfactory.h

30 #ià!
defšed
(
APDK_PRINTERFACTORY_H
)

31 
	#APDK_PRINTERFACTORY_H


	)

33 
	~"´š‹½roxy.h
"

35 
APDK_BEGIN_NAMESPACE


37 cÚ¡ * 
	tFAMILY_HANDLE
;

38 
MODEL_HANDLE
 
	tPRINTER_HANDLE
;

40 
	#pPFI
 
Prš‹rFaùÜy
::
	`G‘In¡ªû
()

	)

56 
şass
 
	gPrš‹r
;

58 şas 
	cPrš‹rFaùÜy


60 
ä›nd
 
şass
 
	mdummy
;

61 
	mpublic
:

65 
šlše
 cÚ¡ 
Prš‹rFaùÜy
* 
	$G‘In¡ªû
(è{  
s_In¡ªû
; }

66 
šlše
 cÚ¡ 
	$G‘Prš‹rCouÁ
(ècÚ¡ {  
s_uPrš‹rCouÁ
; 
	}
}

67 
šlše
 cÚ¡ 
	$G‘FamyCouÁ
(ècÚ¡ {  
s_uFamyCouÁ
; 
	}
}

71 
FAMILY_HANDLE
 
	$S¹FamyNameEnum
(ècÚ¡ {  
NULL
; 
	}
}

72 cÚ¡ * 
	$G‘NextFamyName
(
FAMILY_HANDLE
& 
theFamyHªdË
) const;

75 
šlše
 
MODEL_HANDLE
 
	$S¹Mod–NameEnum
(
FAMILY_HANDLE
 
theFamyHªdË
) const;

76 cÚ¡ * 
	$G‘NextMod–Name
(
FAMILY_HANDLE
 
theFamyHªdË
, 
MODEL_HANDLE
& 
theMod–HªdË
) const;

79 
PRINTER_HANDLE
 
	$S¹Prš‹rNameEnum
(ècÚ¡ {  
NULL
; 
	}
}

80 cÚ¡ * 
	$G‘NextPrš‹rName
(
PRINTER_HANDLE
& 
thePrš‹rHªdË
) const;

83 cÚ¡ * 
	$G‘FamyName
(cÚ¡ * 
thePrš‹rName
) const;

84 cÚ¡ * 
	$G‘FamyName
(cÚ¡ 
FAMILY_HANDLE
 
theFamyHªdË
) const;

85 cÚ¡ 
PRINTER_TYPE
 
	$G‘FamyTy³
(cÚ¡ 
FAMILY_HANDLE
 
theFamyHªdË
) const;

86 cÚ¡ 
PRINTER_TYPE
 
	$EnumDeviûs
Ğ
FAMILY_HANDLE
& 
theFamyHªdË
) const;

87 cÚ¡ 
	$G‘Mod–B™s
() const;

88 cÚ¡ 
	$G‘Mod–SŒšg
(* 
mod–¡ršg
, 
mod–¡ršg_Ëngth
) const;

92 cÚ¡ 
FAMILY_HANDLE
 
	$FšdDevIdM©ch
(cÚ¡ * 
szDevIdSŒšg
) const;

95 
	`Regi¡”
(cÚ¡ 
Prš‹rProxy
* 
thePrš‹rProxy
);

96 
	`UnRegi¡”
(cÚ¡ 
Prš‹rProxy
* 
thePrš‹rProxy
);

97 
šlše
 
Prš‹r
* 
	$C»©ePrš‹r
(
Sy¡emS”viûs
* 
pSys
, cÚ¡ 
FAMILY_HANDLE
& 
theFamyHªdË
) const;

99 
´iv©e
:

101 
	`Prš‹rFaùÜy
();

102 ~
	`Prš‹rFaùÜy
();

103 
	$Prš‹rFaùÜy
(cÚ¡ 
Prš‹rFaùÜy
& 
theFaùÜy
è{
	}
};

106 
	sProxyLi¡EËm’t


108 cÚ¡ 
Prš‹rProxy
* 
	g´š‹rProxyEËm’t
;

109 
ProxyLi¡EËm’t
* 
	gÃxt
;

112 
šlše
 cÚ¡ 
ProxyLi¡EËm’t
* 
	$g‘ProxyLi¡EËm’t
(
FAMILY_HANDLE
 
theFamyHªdË
) const;

113 
šlše
 cÚ¡ 
Prš‹rProxy
* 
	$g‘Prš‹rProxy
(
FAMILY_HANDLE
 
theFamyHªdË
) const;

114 
boŞ
 
	$ÃxtPrš‹r
(
FAMILY_HANDLE
& 
theFamyHªdË
, 
MODEL_HANDLE
& 
theMod–HªdË
) const;

115 
boŞ
 
	$ÃxtFamy
(
FAMILY_HANDLE
& 
theFamyHªdË
) const;

117 
Prš‹rFaùÜy
* 
s_In¡ªû
;

118 
ProxyLi¡EËm’t
* 
s_ProxyLi¡
;

120 
s_uPrš‹rCouÁ
;

121 
s_uFamyCouÁ
;

123 
	}
};

128 
šlše
 cÚ¡ 
	gPrš‹rFaùÜy
::
ProxyLi¡EËm’t
* 
Prš‹rFaùÜy
::
g‘ProxyLi¡EËm’t


130 cÚ¡ 
FAMILY_HANDLE
 
theFamyHªdË


133  
»š‹½»t_ÿ¡
<cÚ¡ 
ProxyLi¡EËm’t
*>(
theFamyHªdË
);

139 
šlše
 cÚ¡ 
Prš‹rProxy
* 
	gPrš‹rFaùÜy
::
g‘Prš‹rProxy


141 cÚ¡ 
FAMILY_HANDLE
 
theFamyHªdË


144  
theFamyHªdË
 ? 
g‘ProxyLi¡EËm’t
ÑheFamyHªdË)->
´š‹rProxyEËm’t
 : 
NULL
;

150 
šlše
 
MODEL_HANDLE
 
	gPrš‹rFaùÜy
::
S¹Mod–NameEnum


152 cÚ¡ 
FAMILY_HANDLE
 
theFamyHªdË


155  
g‘Prš‹rProxy
(
theFamyHªdË
)->
S¹Mod–NameEnum
();

161 
šlše
 cÚ¡ * 
	gPrš‹rFaùÜy
::
G‘FamyName


163 cÚ¡ 
FAMILY_HANDLE
 
theFamyHªdË


166  
g‘Prš‹rProxy
(
theFamyHªdË
)->
G‘FamyName
();

171 
šlše
 cÚ¡ 
PRINTER_TYPE
 
	gPrš‹rFaùÜy
::
G‘FamyTy³


173 cÚ¡ 
FAMILY_HANDLE
 
theFamyHªdË


176  
g‘Prš‹rProxy
(
theFamyHªdË
)->
G‘Prš‹rTy³
();

183 
šlše
 
Prš‹r
* 
	gPrš‹rFaùÜy
::
C»©ePrš‹r


185 
Sy¡emS”viûs
* 
pSys
,

186 cÚ¡ 
	gFAMILY_HANDLE
& 
	gtheFamyHªdË


189  
	gtheFamyHªdË
 ? 
g‘Prš‹rProxy
(
theFamyHªdË
)->
C»©ePrš‹r
(
pSys
è: 
NULL
;

192 
	gAPDK_END_NAMESPACE


	@prnt/hpijs/printerproxy.cpp

30 
	~"h—d”.h
"

31 
	~<¡ršg.h
>

32 
	~"´š‹rçùÜy.h
"

33 
	~"´š‹½roxy.h
"

35 
APDK_BEGIN_NAMESPACE


41 
	gPrš‹rProxy
::
Prš‹rProxy


43 cÚ¡ * 
szFamyName
,

44 cÚ¡ * 
	gszMod–Names


45 è: 
m_szFamyName
(
szFamyName
),

46 
	$m_szMod–Names
(
szMod–Names
)

48 
uCouÁ
 = 0;

49 * 
tPŒ
 = 
cÚ¡_ÿ¡
<*>(
m_szMod–Names
);

50 *
tPŒ
)

52 
tPŒ
 +ğ
	`¡¾’
(tPtr)+1;

53 
uCouÁ
++;

55 
m_uMod–CouÁ
 = 
uCouÁ
;

57 
Prš‹rFaùÜy
::
	`Regi¡”
(
this
);

58 
	`TRACE
("PP::PP famy i % ªd suµÜt %d mod–s\n", 
	`G‘FamyName
(), 
	`G‘Mod–CouÁ
());

59 
	}
}

66 
	gPrš‹rProxy
::~
	$Prš‹rProxy
()

68 
	`TRACE
("PP::~PP<%s> de¡ruùšg\n", 
	`G‘FamyName
());

69 
Prš‹rFaùÜy
::
	`UnRegi¡”
(
this
);

70 
	}
}

80 cÚ¡ * 
	gPrš‹rProxy
::
G‘NextMod–Name


82 
MODEL_HANDLE
& 
theMod–HªdË


85 
TRACE
("PP::GetNextModelName()\n");

86 cÚ¡ * 
	gszMod–Name
 = 
G‘Mod–Name
(
theMod–HªdË
);

87 ià(
	gszMod–Name
 =ğ
NULL
)

89 
TRACE
("PP:GetNextModelName -„eseto being of†ist\n");

90 
	gszMod–Name
 = 
m_szMod–Names
;

94 
	gszMod–Name
 +ğ
¡¾’
(
szMod–Name
)+1;

96 ià(*
	gszMod–Name
 == '\0')

98 
TRACE
("PP:GetNextModelName - hitƒnd of†ist\n");

99 
	gszMod–Name
 = 
NULL
;

101 
	gtheMod–HªdË
 = 
szMod–Name
;

102  
	gszMod–Name
;

113 
boŞ
 
	gPrš‹rProxy
::
Mod–M©chQu”y


115 cÚ¡ * 
szMod–SŒšg


118 
TRACE
("PP::Mod–M©chQu”y(%s)\n", 
szMod–SŒšg
);

119 
boŞ
 
	gbFound
 = 
çl£
;

121 
TRACE
("PP::MMQ - s—rchšg fÜ %s(çmyèš %s\n",
G‘FamyName
(), 
szMod–SŒšg
);

122 ià(!
¡rcmp
(
szMod–SŒšg
, 
G‘FamyName
()))

124 
TRACE
("PP::MMQ - found famy‚amm©ch (%s)!\n", 
G‘FamyName
());

125 
	gbFound
 = 
Œue
;

129 cÚ¡ * 
	gszNextMod–
 = 
m_szMod–Names
;

130 *
	gszNextMod–
)

132 
TRACE
("PP::MMQ - s—rchšg fÜ % š %s\n", 
szNextMod–
, 
szMod–SŒšg
);

134 ià(
¡r¡r
(
szMod–SŒšg
, 
szNextMod–
))

137 
TRACE
("PP:MMQ - found‡ mod–‚amm©ch (%s)!\n", 
szNextMod–
);

138 
	gbFound
 = 
Œue
;

141 
	gszNextMod–
 +ğ
¡¾’
(
szNextMod–
)+1;

144  
	gbFound
;

157 
PROXY_VOTE
 
	gPrš‹rProxy
::
DeviûM©chQu”y


159 cÚ¡ * 
szDeviûSŒšg


162 
TRACE
("PP::DeviûM©chQu”y(%s)\n", 
szDeviûSŒšg
);

163  
	gVOTE_NO_MATCH
;

166 
	gAPDK_END_NAMESPACE


	@prnt/hpijs/printerproxy.h

30 #ià!
defšed
(
APDK_PRINTERPROXY_H
)

31 
	#APDK_PRINTERPROXY_H


	)

33 
APDK_BEGIN_NAMESPACE


35 cÚ¡ * 
	tMODEL_HANDLE
;

38 
	ePROXY_VOTE


40 
	mVOTE_NO_MATCH
 = 0,

41 
	mVOTE_LAST_DITCH_MATCH
 = 10,

42 
	mVOTE_POSSIBLE_MATCH
 = 50,

43 
	mVOTE_FAMILY_MATCH
 = 70,

44 
	mVOTE_VIP_MATCH
 = 80,

45 
	mVOTE_SUBSTRING_MATCH
 = 90,

46 
	mVOTE_EXACT_MATCH
 = 100

47 } 
	tPROXY_VOTE
;

51 
şass
 
	gPrš‹r
;

57 şas 
	cPrš‹rProxy


59 
	mpublic
:

60 
Prš‹rProxy


62 cÚ¡ * 
szFamyName
,

63 cÚ¡ * 
	mszMod–Names


66 
	mvœtu®
 ~
Prš‹rProxy
();

69 
šlše
 cÚ¡ * 
	$G‘FamyName
(ècÚ¡ {  
m_szFamyName
; }

70 
šlše
 
	$G‘Mod–CouÁ
(ècÚ¡ {  
m_uMod–CouÁ
; 
	}
}

71 
vœtu®
 
Prš‹r
* 
	$C»©ePrš‹r
(
Sy¡emS”viûs
* 
pSS
) const = 0;

72 
vœtu®
 
PRINTER_TYPE
 
	$G‘Prš‹rTy³
() const = 0;

73 
vœtu®
 
	$G‘Mod–B™
() const = 0;

75 
šlše
 
MODEL_HANDLE
 
	$S¹Mod–NameEnum
(ècÚ¡ {  
NULL
; 
	}
}

77 cÚ¡ * 
	$G‘Mod–Name
(
MODEL_HANDLE
& 
theHªdË
) const;

78 cÚ¡ * 
	$G‘NextMod–Name
(
MODEL_HANDLE
& 
theHªdË
) const;

80 
PROXY_VOTE
 
	$DeviûM©chQu”y
(cÚ¡ * 
szDeviûSŒšg
) const;

81 
boŞ
 
	$Mod–M©chQu”y
(cÚ¡ * 
szMod–SŒšg
) const;

83 
´Ùeùed
:

84 
PRINTER_TYPE
 
m_iPrš‹rTy³
;

86 
´iv©e
:

87 cÚ¡ * 
m_szFamyName
;

88 cÚ¡ * 
m_szMod–Names
;

89 
m_uMod–CouÁ
;

90 
	}
};

98 
šlše
 cÚ¡ * 
	gPrš‹rProxy
::
G‘Mod–Name


100 
MODEL_HANDLE
& 
theMod–HªdË


103 
TRACE
("PP::G‘Mod–Name(è»tuºšg %s\n", 
»š‹½»t_ÿ¡
<cÚ¡ *>(
theMod–HªdË
));

104  
	g»š‹½»t_ÿ¡
<cÚ¡ *>(
	gtheMod–HªdË
);

107 
	gAPDK_END_NAMESPACE


	@prnt/hpijs/pscript.h

32 #iâdeà
APDK_PSCRIPT_H


33 
	#APDK_PSCRIPT_H


	)

35 #ifdeà
APDK_PSCRIPT


39 
	~"j³glib.h
"

41 
	~<£tjmp.h
>

43 
APDK_BEGIN_NAMESPACE


45 #ifdeà 
APDK_HIGH_RES_MODES


46 
	#PS_BASE_RES
 300

	)

48 
	#PS_BASE_RES
 150

	)

52 
	s_SŒLi¡


54 *
pPSSŒšg
;

55 
_SŒLi¡
 *
Ãxt
;

56 } 
	tSŒLi¡
;

61 şas 
	cPSüt
 : 
public
 
Prš‹r


63 
public
:

64 
PSüt
 (
Sy¡emS”viûs
* 
pSS
,
numfÚts
=0, 
BOOL
 
´Ùo
=
FALSE
);

65 ~
PSüt
 ();

67 
PrštMode
* 
G‘Mode
 (
šdex
);

69 
vœtu®
 
H—d”
* 
S–eùH—d”
 (
PrštCÚ‹xt
* 
pc
);

70 
vœtu®
 
DRIVER_ERROR
 
V”ifyP’Info
 ();

71 
vœtu®
 
DRIVER_ERROR
 
P¬£P’Info
 (
PEN_TYPE
& 
eP’
, 
BOOL
 
Qu”yPrš‹r
=
TRUE
);

72 
vœtu®
 
DISPLAY_STATUS
 
P¬£E¼Ü
 (
BYTE
 
¡©us_»g
);

73 
vœtu®
 
DRIVER_ERROR
 
EnÿpsuÏ‹
 (cÚ¡ 
RASTERDATA
* 
IÅutRa¡”
, 
BOOL
 
bLa¡PÏÃ
);

74 
šlše
 
vœtu®
 
BOOL
 
	$SuµÜtS•¬©eBÏck
 (
PrštMode
 *
pCu¼’tMode
è{ 
FALSE
;}

75 
vœtu®
 
DRIVER_ERROR
 
	`Flush
 (
FlushSize
);

76 
DRIVER_ERROR
 
	`SkRa¡”s
 (
nBÏnkRa¡”s
);

78 
vœtu®
 
	$Prš‹rLªguage
 ()

81 
	}
}

83 
vœtu®
 
DRIVER_ERROR
 
SaveText
 (cÚ¡ *
psSŒ
, 
iPoštSize
, 
iX
, 
iY
,

84 cÚ¡ *
pTextSŒšg
, 
iTextSŒšgL’
,

85 
BOOL
 
bUnd”lše
);

87 
vœtu®
 
BOOL
 
	$U£CMYK
(
iPrštMode
è{  
FALSE
;
	}
}

89 
DRIVER_ERROR
 
S’dText
 (
iCurYPos
);

90 
F»eLi¡
 ();

91 
J³gD©a
 (
BYTE
 *
bufãr
, 
iSize
);

93 
	g´Ùeùed
:

95 #ifdeà
APDK_HP_UX


96 
vœtu®
 
PSüt
 & 
İ”©Ü
 = (
Prš‹r
& 
rhs
)

98  *
this
;

102 
	g´iv©e
:

103 
DRIVER_ERROR
 
S’dImage
 ();

104 
AddRa¡”
 (
BYTE
 *
pbyRow
, 
iL’gth
);

105 
J³gRa¡”
 ();

106 
EncodeJ³g
 ();

107 
DRIVER_ERROR
 
S¹J³gCom´essiÚ
 ();

108 
FšishJ³gCom´essiÚ
 ();

109 
SŒLi¡
 *
	gm_pH—dPŒ
;

110 
SŒLi¡
 *
	gm_pCurI‹m
;

111 
PrštCÚ‹xt
 *
	gm_pPC
;

112 
j³g_com´ess_¡ruù
 
	gm_cšfo
;

113 
j³g_”rÜ_mgr
 
	gm_j”r
;

114 
jmp_buf
 
	gm_£tjmp_bufãr
;

116 
	gm_iRowNumb”
;

117 
	gm_iRowWidth
;

118 
	gm_iJ³gBufãrPos
;

119 
	gm_iJ³gBufãrSize
;

120 
BYTE
 *
	gm_pbyIÅutRa¡”
;

121 
BYTE
 *
	gm_pbyJ³gBufãr
;

122 
BYTE
 *
	gm_pbyEncodedBufãr
;

123 
	gm_iPageNumb”
;

124 
COLORMODE
 
	gm_eCŞÜMode
;

127 şas 
	cPSütD¿áMode
 : 
public
 
PrštMode


129 
public
:

130 
PSütD¿áMode
 ();

133 şas 
	cPSütNÜm®Mode
 : 
public
 
PrštMode


135 
public
:

136 
PSütNÜm®Mode
 ();

139 şas 
	cPSütG¿yMode
 : 
public
 
PrštMode


141 
public
:

142 
PSütG¿yMode
 ();

145 #ifdeà
APDK_PSCRIPT


149 şas 
	cPSütProxy
 : 
public
 
Prš‹rProxy


151 
public
:

152 
	$PSütProxy
(è: 
	`Prš‹rProxy
(

157 #ifdeà
APDK_MLC_PRINTER


159 è{
m_iPrš‹rTy³
 = 
ePSüt
;}

160 
šlše
 
Prš‹r
* 
	$C»©ePrš‹r
(
Sy¡emS”viûs
* 
pSS
ècÚ¡ {  
Ãw
 
	`PSüt
ÕSS); 
	}
}

161 
šlše
 
PRINTER_TYPE
 
	$G‘Prš‹rTy³
(ècÚ¡ {  
ePSüt
;
	}
}

162 
šlše
 
	$G‘Mod–B™
(ècÚ¡ {  0x10;
	}
}

166 
	gAPDK_END_NAMESPACE


	@prnt/hpijs/psp100.cpp

31 #ià
defšed
(
APDK_PSP100
è&& defšed (
APDK_DJ9xxVIP
)

33 
	~"h—d”.h
"

34 
	~"dj9xxv.h
"

35 
	~"p¥100.h
"

36 
	~"´š‹½roxy.h
"

38 
APDK_BEGIN_NAMESPACE


41 
	gPSP100
::
	$PSP100
 (
Sy¡emS”viûs
* 
pSS
, 
BOOL
 
´Ùo
)

42 : 
	$DJ9xxVIP
 (
pSS
, 
´Ùo
)

45 
i
 = 0; i < 
ModeCouÁ
; i++)

47 ià(
pMode
[
i
])

48 
d–‘e
 
pMode
[
i
];

49 
pMode
[
i
] = 
NULL
;

52 
eP’
 = 
COLOR_PEN
;

54 ià(!
´Ùo
 && 
IOMode
.
bDevID
)

56 
bCheckFÜCªûlBu‰Ú
 = 
TRUE
;

57 
cÚ¡ruùÜ_”rÜ
 = 
	`V”ifyP’Info
 ();

58 
CERRCHECK
;

61 
pMode
[
GRAYMODE_INDEX
] = 
Ãw
 
	`G¿yModePSP100
 ();

62 
pMode
[
DEFAULTMODE_INDEX
] = 
Ãw
 
	`PSP100Mode
 ();

63 
pMode
[
SPECIALMODE_INDEX
] = 
Ãw
 
	`PSP100NÜm®Mode
 ();

65 
ModeCouÁ
 = 3;

67 #ifdeà
APDK_AUTODUPLEX


68 
bDu¶exC­abË
 = 
FALSE
;

70 #ifdeà
APDK_EXTENDED_MEDIASIZE


71 
pMode
[
SPECIALMODE_INDEX
+1] = 
Ãw
 
	`PSP1002400Mode
 ();

72 
ModeCouÁ
 = 4;

75 
	}
}

78 
	gG¿yModePSP100
::
	$G¿yModePSP100
 ()

79 : 
	$PrštMode
(
NULL
)

81 #ià
	`defšed
(
APDK_VIP_COLORFILTERING
)

82 
CÚfig
.
bEº›
=
TRUE
;

85 
CÚfig
.
bCŞÜImage
=
FALSE
;

95 
Ba£ResX
 =

96 
Ba£ResY
 =

97 
TextRes
 =

98 
ResŞutiÚX
[0] =

99 
ResŞutiÚY
[0] = 
VIP_BASE_RES
;

100 
medium
 = 
medŸGlossy
;

101 
Com·tibËP’s
[0] = 
COLOR_PEN
;

102 
theQu®™y
 = 
qu®™yP»£Á©iÚ
;

103 
bFÚtC­abË
 = 
FALSE
;

104 
pmCŞÜ
 = 
GREY_CMY
;

105 
	}
}

108 
PEN_TYPE
 
	gPSP100
::
	$DeçuÉP’S‘
()

109 {  
COLOR_PEN
; 
	}
}

112 
	gPSP100Mode
::
	$PSP100Mode
 (è: 
	$PrštMode
 (
NULL
)

119 
Ba£ResX
 = 
Ba£ResY
 = 
TextRes
 = 
ResŞutiÚX
[0] = 
ResŞutiÚY
[0] = 
VIP_BASE_RES
;

121 #ià
	`defšed
(
APDK_VIP_COLORFILTERING
)

122 
CÚfig
.
bEº›
 = 
TRUE
;

125 
CÚfig
.
bCŞÜImage
 = 
FALSE
;

127 
medium
 = 
medŸGlossy
;

128 
theQu®™y
 = 
qu®™yP»£Á©iÚ
;

129 
pmQu®™y
 = 
QUALITY_BEST
;

130 
pmMedŸTy³
 = 
MEDIA_PHOTO
;

131 
Com·tibËP’s
[0] = 
COLOR_PEN
;

132 
bFÚtC­abË
 = 
FALSE
;

133 
	}
}

135 
	gPSP100NÜm®Mode
::
	$PSP100NÜm®Mode
 (è: 
	$PrštMode
 (
NULL
)

142 
Ba£ResX
 = 
Ba£ResY
 = 
TextRes
 = 
ResŞutiÚX
[0] = 
ResŞutiÚY
[0] = 
VIP_BASE_RES
;

144 #ià
	`defšed
(
APDK_VIP_COLORFILTERING
)

145 
CÚfig
.
bEº›
 = 
TRUE
;

148 
CÚfig
.
bCŞÜImage
 = 
FALSE
;

150 
medium
 = 
medŸS³cŸl
;

151 
theQu®™y
 = 
qu®™yNÜm®
;

152 
Com·tibËP’s
[0] = 
COLOR_PEN
;

153 
bFÚtC­abË
 = 
FALSE
;

154 
	}
}

156 #ifdeà
APDK_EXTENDED_MEDIASIZE


157 
	gPSP1002400Mode
::
	$PSP1002400Mode
 (è: 
	$PrštMode
 (
NULL
)

164 
Ba£ResX
 = 
Ba£ResY
 = 
TextRes
 = 
ResŞutiÚX
[0] = 
ResŞutiÚY
[0] = 1200;

166 #ià
	`defšed
(
APDK_VIP_COLORFILTERING
)

167 
CÚfig
.
bEº›
 = 
TRUE
;

170 
CÚfig
.
bCŞÜImage
 = 
FALSE
;

172 
medium
 = 
medŸHigh»sPhÙo
;

173 
theQu®™y
 = 
qu®™yP»£Á©iÚ
;

174 
pmMedŸTy³
 = 
MEDIA_PHOTO
;

175 
pmQu®™y
 = 
QUALITY_HIGHRES_PHOTO
;

176 
Com·tibËP’s
[0] = 
COLOR_PEN
;

177 
bFÚtC­abË
 = 
FALSE
;

178 
	}
}

181 
PAPER_SIZE
 
	gPSP100
::
	$Mªd©ÜyP­”Size
 ()

183  
A6
;

185 
	}
}

188 
BOOL
 
	gPSP100
::
U£GUIMode


190 
PrštMode
* 
pPrštMode


193  
TRUE
;

197 
DRIVER_ERROR
 
	gPSP100
::
	$V”ifyP’Info
 ()

199 
DRIVER_ERROR
 
”r
 = 
NO_ERROR
;

201 if(
IOMode
.
bDevID
 =ğ
FALSE
)

203  
”r
;

205 
eP’
 = 
NO_PEN
;

206 *
¡r
;

207 
eP’
 =ğ
NO_PEN
)

209 
”r
 = 
	`S‘P’Info
 (
¡r
, 
TRUE
);

210 
ERRCHECK
;

212 ià(*(
¡r
-1) == '1' && *(str-2) == '1')

214 
pSS
->
	`Di¥ÏyPrš‹rStus
 (
DISPLAY_NO_PENS
);

218 
eP’
 = 
COLOR_PEN
;

221 ià(
pSS
->
	`BusyWa™
(500è=ğ
JOB_CANCELED
)

223  
JOB_CANCELED
;

227  
NO_ERROR
;

228 
	}
}

230 
	gAPDK_END_NAMESPACE


	@prnt/hpijs/psp100.h

32 #iâdeà
APDK_PSP100_H


33 
	#APDK_PSP100_H


	)

36 
APDK_BEGIN_NAMESPACE


43 şas 
	cPSP100
 : 
public
 
DJ9xxVIP


45 
public
:

46 
PSP100
 (
Sy¡emS”viûs
* 
pSS
, 
BOOL
 
´Ùo
 = 
FALSE
);

48 
DRIVER_ERROR
 
V”ifyP’Info
 ();

50 
vœtu®
 
PEN_TYPE
 
DeçuÉP’S‘
();

51 
šlše
 
vœtu®
 
BOOL
 
	$SuµÜtS•¬©eBÏck
 (
PrštMode
 *
pCu¼’tMode
è{ 
FALSE
;}

52 
vœtu®
 
BOOL
 
	`U£GUIMode
 (
PrštMode
* 
pPrštMode
);

53 
PAPER_SIZE
 
	`Mªd©ÜyP­”Size
 ();

54 
vœtu®
 
BOOL
 
	$FuÎBËedC­abË
 (
PAPER_SIZE
 
ps
, 
FuÎbËedTy³
 *
fbTy³
, *
xOv”S´ay
, *
yOv”S´ay
,

55 *
fLeáOv”S´ay
, *
fTİOv”S´ay
)

57 *
xOv”S´ay
 = () 0.12;

58 *
yOv”S´ay
 = () 0.06;

60 ià(
fLeáOv”S´ay
)

61 *
fLeáOv”S´ay
 = () 0.05;

62 ià(
fTİOv”S´ay
)

63 *
fTİOv”S´ay
 = () 0.03;

65 ià(
ps
 =ğ
PHOTO_SIZE
 ||… =ğ
A6_WITH_TEAR_OFF_TAB
 ||

66 
ps
 =ğ
PHOTO_5x7
)

68 *
fbTy³
 = 
fuÎbËed4EdgeAÎMedŸ
;

72 *
fbTy³
 = 
fuÎbËed3EdgeAÎMedŸ
;

75  
TRUE
;

76 
	}
}

84 şas 
	cPSP100Mode
 : 
public
 
PrštMode


86 
public
:

87 
PSP100Mode
 ();

90 şas 
	cPSP100NÜm®Mode
 : 
public
 
PrštMode


92 
public
:

93 
PSP100NÜm®Mode
 ();

96 #ifdeà
APDK_EXTENDED_MEDIASIZE


100 şas 
	cPSP1002400Mode
 : 
public
 
PrštMode


102 
public
:

103 
PSP1002400Mode
 ();

110 şas 
	cG¿yModePSP100
 : 
public
 
PrštMode


112 
public
:

113 
G¿yModePSP100
 ();

118 #ià
defšed
(
APDK_PSP100
è&& defšed (
APDK_DJ9xxVIP
)

122 şas 
	cPSP100Proxy
 : 
public
 
Prš‹rProxy


124 
public
:

125 
	$PSP100Proxy
(è: 
	`Prš‹rProxy
(

132 #ifdeà
APDK_MLC_PRINTER


134 è{
m_iPrš‹rTy³
 = 
ePSP100
;}

135 
šlše
 
Prš‹r
* 
	$C»©ePrš‹r
(
Sy¡emS”viûs
* 
pSS
ècÚ¡ {  
Ãw
 
	`PSP100
ÕSS); 
	}
}

136 
šlše
 
PRINTER_TYPE
 
	$G‘Prš‹rTy³
(ècÚ¡ {  
ePSP100
;
	}
}

137 
šlše
 
	$G‘Mod–B™
(ècÚ¡ {  0x200;
	}
}

141 
	gAPDK_END_NAMESPACE


	@prnt/hpijs/psp470.h

32 #iâdeà
APDK_PSP470_H


33 
	#APDK_PSP470_H


	)

36 
APDK_BEGIN_NAMESPACE


41 şas 
	cPSPFa¡NÜm®Mode
 : 
public
 
PrštMode


43 
public
:

44 
PSPFa¡NÜm®Mode
 ();

48 
	gPSPFa¡NÜm®Mode
::
	$PSPFa¡NÜm®Mode
 (è: 
	$PrštMode
 (
NULL
)

51 
Ba£ResX
 = 
Ba£ResY
 = 
TextRes
 = 
ResŞutiÚX
[0] = 
ResŞutiÚY
[0] = 600;

53 #ià
	`defšed
(
APDK_VIP_COLORFILTERING
)

54 
CÚfig
.
bEº›
 = 
TRUE
;

57 
CÚfig
.
bCŞÜImage
 = 
FALSE
;

59 
medium
 = 
medŸAuto
;

60 
theQu®™y
 = 
qu®™yD¿á
;

61 
pmQu®™y
 = 
QUALITY_DRAFT
;

62 
pmMedŸTy³
 = 
MEDIA_PHOTO
;

63 
Com·tibËP’s
[0] = 
COLOR_PEN
;

64 
bFÚtC­abË
 = 
FALSE
;

65 
	}
}

72 şas 
	cPSP470
 : 
public
 
PSP100


74 
public
:

75 
	$PSP470
 (
Sy¡emS”viûs
* 
pSS
, 
BOOL
 
´Ùo
 = 
FALSE
è: 
	$PSP100
 (
pSS
, 
´Ùo
)

77 
pMode
[
ModeCouÁ
] = 
Ãw
 
	`PSPFa¡NÜm®Mode
 ();

78 
ModeCouÁ
++;

81 
PAPER_SIZE
 
	$Mªd©ÜyP­”Size
 ()

83  
PHOTO_5x7
;

84 
	}
}

85 
vœtu®
 
BOOL
 
	$FuÎBËedC­abË
 (
PAPER_SIZE
 
ps
, 
FuÎbËedTy³
 *
fbTy³
, *
xOv”S´ay
, *
yOv”S´ay
,

86 *
fLeáOv”S´ay
, *
fTİOv”S´ay
)

88 *
xOv”S´ay
 = () 0.12;

89 *
yOv”S´ay
 = () 0.06;

91 ià(
fLeáOv”S´ay
)

92 *
fLeáOv”S´ay
 = () 0.05;

93 ià(
fTİOv”S´ay
)

94 *
fTİOv”S´ay
 = () 0.03;

96 *
fbTy³
 = 
fuÎbËed4EdgeAÎMedŸ
;

97  
TRUE
;

98 
	}
}

102 #ià
defšed
(
APDK_PSP100
è&& defšed (
APDK_DJ9xxVIP
)

106 şas 
	cPSP470Proxy
 : 
public
 
Prš‹rProxy


108 
public
:

109 
	$PSP470Proxy
(è: 
	`Prš‹rProxy
(

117 è{
m_iPrš‹rTy³
 = 
ePSP470
;}

118 
šlše
 
Prš‹r
* 
	$C»©ePrš‹r
(
Sy¡emS”viûs
* 
pSS
ècÚ¡ {  
Ãw
 
	`PSP470
ÕSS); 
	}
}

119 
šlše
 
PRINTER_TYPE
 
	$G‘Prš‹rTy³
(ècÚ¡ {  
ePSP470
;
	}
}

120 
šlše
 
	$G‘Mod–B™
(ècÚ¡ {  0x200;
	}
}

124 
	gAPDK_END_NAMESPACE


	@prnt/hpijs/quickconnect.cpp

32 #ifdeà
APDK_QUICKCONNECT


34 
	~"h—d”.h
"

35 
	~"io_defs.h
"

36 
	~"quickcÚÃù.h
"

37 
	~"´š‹½roxy.h
"

38 
	~"»sourûs.h
"

39 
	~<£tjmp.h
>

41 
	gAPDK_BEGIN_NAMESPACE


43 
	#MAX_JPEG_FILE_SIZE
 2097152

	)

45 
	gQuickCÚÃù
::
	$QuickCÚÃù
 (
Sy¡emS”viûs
* 
pSS
, 
BOOL
 
´Ùo
)

46 : 
	$Prš‹r
 (
pSS
, 
´Ùo
)

49 ià((!
´Ùo
è&& (
IOMode
.
bDevID
))

51 
cÚ¡ruùÜ_”rÜ
 = 
	`V”ifyP’Info
 ();

52 
CERRCHECK
;

55 
eP’
 = 
BOTH_PENS
;

57 
ModeCouÁ
 = 0;

58 
pMode
[
ModeCouÁ
++] = 
Ãw
 
	`QCAutom©ic
 ();

59 
pMode
[
ModeCouÁ
++] = 
Ãw
 
	`QCFa¡NÜm®
 ();

60 
pMode
[
ModeCouÁ
++] = 
Ãw
 
	`QCNÜm®
 ();

61 
pMode
[
ModeCouÁ
++] = 
Ãw
 
	`QCBe¡
 ();

63 
CMYM­
 = 
NULL
;

65 
m_iJ³gBufãrPos
 = 0;

66 
m_iMaxFeSize
 = 
MAX_JPEG_FILE_SIZE
;

67 
m_iIÅutBufãrSize
 = 0;

68 
m_pbyJ³gBufãr
 = 
NULL
;

69 
m_pbyIÅutBufãr
 = 
NULL
;

71 
m_iPhÙoFix
 = 0;

72 
m_iRemoveRedEye
 = 1;

73 
m_iJobId
 = 
pSS
->
	`G‘Sy¡emTickCouÁ
 ();

74 
	}
}

76 
	gQuickCÚÃù
::~
	$QuickCÚÃù
 ()

78 ià(
m_pbyJ³gBufãr
)

80 
pSS
->
	`F»eMemÜy
 (
m_pbyJ³gBufãr
);

82 ià(
m_pbyIÅutBufãr
)

84 
pSS
->
	`F»eMemÜy
 (
m_pbyIÅutBufãr
);

86 
	}
}

88 
	gQCAutom©ic
::
	$QCAutom©ic
 ()

89 : 
	$PrštMode
 (
NULL
)

91 
ResŞutiÚX
[0] = 300;

92 
ResŞutiÚY
[0] = 300;

93 
Ba£ResX
 = 
Ba£ResY
 = 300;

95 
bFÚtC­abË
 = 
FALSE
;

97 
theQu®™y
 = 
qu®™yAuto
;

98 
medium
 = 
medŸAuto
;

100 
pmQu®™y
 = 
QUALITY_AUTO
;

101 
pmMedŸTy³
 = 
MEDIA_PLAIN
;

102 
CÚfig
.
bCŞÜImage
 = 
FALSE
;

103 
CÚfig
.
bCom´ess
 = 
FALSE
;

104 #ifdeà
APDK_AUTODUPLEX


105 
bDu¶exC­abË
 = 
FALSE
;

107 
	}
}

109 
	gQCFa¡NÜm®
::
	$QCFa¡NÜm®
 ()

110 : 
	$PrštMode
 (
NULL
)

112 
ResŞutiÚX
[0] = 300;

113 
ResŞutiÚY
[0] = 300;

114 
Ba£ResX
 = 
Ba£ResY
 = 300;

116 
bFÚtC­abË
 = 
FALSE
;

118 
theQu®™y
 = 
qu®™yFa¡NÜm®
;

119 
medium
 = 
medŸAuto
;

121 
pmQu®™y
 = 
QUALITY_FASTNORMAL
;

122 
pmMedŸTy³
 = 
MEDIA_PLAIN
;

123 
CÚfig
.
bCŞÜImage
 = 
FALSE
;

124 
CÚfig
.
bCom´ess
 = 
FALSE
;

125 #ifdeà
APDK_AUTODUPLEX


126 
bDu¶exC­abË
 = 
FALSE
;

128 
	}
}

130 
	gQCNÜm®
::
	$QCNÜm®
 ()

131 : 
	$PrštMode
 (
NULL
)

133 
ResŞutiÚX
[0] = 300;

134 
ResŞutiÚY
[0] = 300;

135 
Ba£ResX
 = 
Ba£ResY
 = 300;

137 
bFÚtC­abË
 = 
FALSE
;

139 
theQu®™y
 = 
qu®™yNÜm®
;

140 
medium
 = 
medŸAuto
;

142 
pmQu®™y
 = 
QUALITY_NORMAL
;

143 
pmMedŸTy³
 = 
MEDIA_PLAIN
;

144 
CÚfig
.
bCŞÜImage
 = 
FALSE
;

145 
CÚfig
.
bCom´ess
 = 
FALSE
;

146 #ifdeà
APDK_AUTODUPLEX


147 
bDu¶exC­abË
 = 
FALSE
;

149 
	}
}

151 
	gQCBe¡
::
	$QCBe¡
 ()

152 : 
	$PrštMode
 (
NULL
)

154 
ResŞutiÚX
[0] = 300;

155 
ResŞutiÚY
[0] = 300;

156 
Ba£ResX
 = 
Ba£ResY
 = 300;

158 
bFÚtC­abË
 = 
FALSE
;

160 
theQu®™y
 = 
qu®™yP»£Á©iÚ
;

161 
medium
 = 
medŸAuto
;

163 
pmQu®™y
 = 
QUALITY_BEST
;

164 
pmMedŸTy³
 = 
MEDIA_PLAIN
;

165 
CÚfig
.
bCŞÜImage
 = 
FALSE
;

166 
CÚfig
.
bCom´ess
 = 
FALSE
;

167 #ifdeà
APDK_AUTODUPLEX


168 
bDu¶exC­abË
 = 
FALSE
;

170 
	}
}

172 
H—d”
 *
	gQuickCÚÃù
::
	$S–eùH—d”
 (
PrštCÚ‹xt
 *
pc
)

174 
m_iRowNumb”
 = 0;

175 
m_pPC
 = 
pc
;

176 
m_iRowWidth
 = 
pc
->
	`OuutPix–sP”Row
 () * 3;

178 
m_iIÅutBufãrSize
 = 
m_iRowWidth
 * (è(
pc
->
	`PhysiÿlPageSizeY
 (è*…c->
	`EfãùiveResŞutiÚY
 ());

179 
m_pbyIÅutBufãr
 = (
BYTE
 *è
pSS
->
	`AÎocMem
 (
m_iIÅutBufãrSize
);

180 
m_pbyJ³gBufãr
 = (
BYTE
 *è
pSS
->
	`AÎocMem
 (
m_iMaxFeSize
);

181 ià(
m_pbyIÅutBufãr
 =ğ
NULL
 || 
m_pbyJ³gBufãr
 == NULL)

183 
cÚ¡ruùÜ_”rÜ
 = 
ALLOCMEM_ERROR
;

184  
NULL
;

186 
	`mem£t
 (
m_pbyIÅutBufãr
, 0xFF, 
m_iIÅutBufãrSize
);

187  
Ãw
 
	`H—d”QuickCÚÃù
 (
this
, 
pc
);

188 
	}
}

190 
DRIVER_ERROR
 
	gQuickCÚÃù
::
	$EnÿpsuÏ‹
 (cÚ¡ 
RASTERDATA
* 
IÅutRa¡”
, 
BOOL
 
bLa¡PÏÃ
)

192 
	`memıy
 (
m_pbyIÅutBufãr
 + (
m_iRowNumb”
 * 
m_iRowWidth
), 
IÅutRa¡”
->
¿¡”d©a
[
COLORTYPE_COLOR
],

193 
IÅutRa¡”
->
¿¡”size
[
COLORTYPE_COLOR
]);

194 
m_iRowNumb”
++;

195  
NO_ERROR
;

196 
	}
}

198 
DRIVER_ERROR
 
	gQuickCÚÃù
::
	$P¬£P’Info
 (
PEN_TYPE
& 
eP’
, 
BOOL
 
Qu”yPrš‹r
)

200 *
¡r
;

201 
num_³ns
 = 0;

202 
eP’
 = 
BOTH_PENS
;

204 
DRIVER_ERROR
 
”r
 = 
	`S‘P’Info
 (
¡r
, 
Qu”yPrš‹r
);

205 ià(
”r
 !ğ
NO_ERROR
)

207  
NO_ERROR
;

210 
num_³ns
 = 
¡r
[0] - '0';

211 ià(
num_³ns
 == 0)

213 
eP’
 = 
NO_PEN
;

214  
NO_ERROR
;

217 ià((è
	`¡¾’
 (
¡r
è< (
num_³ns
 * 8))

219  
BAD_DEVICE_ID
;

222  
NO_ERROR
;

223 
	}
}

225 
DRIVER_ERROR
 
	gQuickCÚÃù
::
	$V”ifyP’Info
 ()

227 
eP’
 = 
BOTH_PENS
;

228 
DRIVER_ERROR
 
”r
 = 
NO_ERROR
;

230 ià(
IOMode
.
bDevID
 =ğ
FALSE
)

231  
”r
;

233 
eP’
 = 
NO_PEN
;

235 
”r
 = 
	`P¬£P’Info
 (
eP’
);

237 if(
”r
 =ğ
UNSUPPORTED_PEN
)

241 ià(
pSS
->
	`BusyWa™
 ((
DWORD
è2000è=ğ
JOB_CANCELED
)

243  
JOB_CANCELED
;

246 
DWORD
 
Ëngth
 =  (
DJ895_Pow”_On
);

247 
”r
 = 
pSS
->
	`ToDeviû
 (
DJ895_Pow”_On
, &
Ëngth
);

248 
ERRCHECK
;

250 
”r
 = 
pSS
->
	`FlushIO
 ();

251 
ERRCHECK
;

254 ià(
pSS
->
	`BusyWa™
 ((
DWORD
è2500è=ğ
JOB_CANCELED
)

256  
JOB_CANCELED
;

259 
”r
 = 
	`P¬£P’Info
 (
eP’
);

262 
ERRCHECK
;

263 
eP’
 =ğ
NO_PEN
)

265 
pSS
->
	`Di¥ÏyPrš‹rStus
 (
DISPLAY_NO_PENS
);

267 ià(
pSS
->
	`BusyWa™
 (500è=ğ
JOB_CANCELED
)

269  
JOB_CANCELED
;

271 
”r
 = 
	`P¬£P’Info
 (
eP’
);

272 
ERRCHECK
;

275 
pSS
->
	`Di¥ÏyPrš‹rStus
 (
DISPLAY_PRINTING
);

277  
”r
;

278 
	}
}

280 
	gQuickCÚÃù
::
	$M­P­”Size
 (
PAPER_SIZE
 
eP­”Size
)

282 
eP­”Size
)

284 
PHOTO_5x7
:

286 
L
:

288 
PHOTO_4x8
:

290 
PHOTO_4x12
:

292 
CARD_4x6
:

293 
HAGAKI
:

294 
A6
:

299 
	}
}

301 
	gQuickCÚÃù
::
	$M­MedŸTy³
 (
MEDIATYPE
 
eMedŸTy³
)

303 
eMedŸTy³
)

305 
MEDIA_HIGHRES_PHOTO
:

307 
MEDIA_PREMIUM
:

309 
MEDIA_PLAIN
:

311 
MEDIA_PHOTO
:

313 
MEDIA_AUTO
:

317 
	}
}

319 
	gQuickCÚÃù
::
	$M­Qu®™yMode
 (
QUALITY_MODE
 
eQu®™yMode
)

321 
eQu®™yMode
)

323 
QUALITY_NORMAL
:

325 
QUALITY_FASTNORMAL
:

327 
QUALITY_BEST
:

329 
QUALITY_AUTO
:

333 
	}
}

335 
DRIVER_ERROR
 
	gQuickCÚÃù
::
	$S‘Hšt
 (
PRINTER_HINT
 
eHšt
, 
iV®ue
)

337 
eHšt
)

339 
PHOTO_FIX_HINT
:

341 
m_iPhÙoFix
 = 
iV®ue
 & 0x1;

344 
RED_EYE_REMOVAL_HINT
:

346 
m_iRemoveRedEye
 = 
iV®ue
 & 0x1;

349 
MAX_FILE_SIZE_HINT
:

351 
m_iMaxFeSize
 = 
iV®ue
;

357  
NO_ERROR
;

358 
	}
}

361 
DRIVER_ERROR
 
	gQuickCÚÃù
::
	$Flush
 (
iBufãrSize
)

363 
DRIVER_ERROR
 
”r
 = 
NO_ERROR
;

364 ià(
iBufãrSize
 =ğ-1 && 
m_iRowNumb”
 > 0)

366 
szSŒ
[256];

367 
iP­”Size
, 
iMedŸTy³
, 
iPrštQu®™y
;

368 
szCİ›sSŒ
[64];

369 
szNuÎBy‹s
[632];

370 cÚ¡ 
szPJLH—d”
[] = "\x1B\x45\x1B%-12345X@PJL ENTER LANGUAGE=PHOTOJPEG\012";

371 cÚ¡ 
szPJLEndJob
[] = "\x1B\x45\x1B%-12345X";

373 
”r
 = 
	`Com´ess
 ();

374 
ERRCHECK
;

376 
	`mem£t
 (
szNuÎBy‹s
, 0,  (szNullBytes));

377 
	`¥rštf
 (
szCİ›sSŒ
, "@PJL SET COPIES=%d\012@PJL SET JOBID=%d\012", 
m_pPC
->
	`G‘CİyCouÁ
 (), 
m_iJobId
);

379 
	`S’d
 ((cÚ¡ 
BYTE
 *è
szNuÎBy‹s
, 600);

380 
	`S’d
 ((cÚ¡ 
BYTE
 *è
szPJLH—d”
, (szPJLHeader) - 1);

381 
	`S’d
 ((cÚ¡ 
BYTE
 *è
szCİ›sSŒ
, 
	`¡¾’
 (szCopiesStr));

383 
COLORMODE
 
eCŞÜMode
 = 
COLOR
;

384 
MEDIATYPE
 
eMedŸTy³
;

385 
QUALITY_MODE
 
eQu®™yMode
;

386 
BOOL
 
bDeviûText
;

388 
m_pPC
->
	`G‘PrštModeS‘tšgs
 (
eQu®™yMode
, 
eMedŸTy³
, 
eCŞÜMode
, 
bDeviûText
);

389 
iMedŸTy³
 = 
	`M­MedŸTy³
 (
eMedŸTy³
);

390 
iPrštQu®™y
 = 
	`M­Qu®™yMode
 (
eQu®™yMode
);

391 
iP­”Size
 = 
	`M­P­”Size
 (
m_pPC
->
	`G‘P­”Size
 ());

393 
	`¥rštf
 (
szSŒ
,

395 
iP­”Size
, 
iMedŸTy³
, 
iPrštQu®™y
, 
m_pPC
->
	`IsBÜd”Ëss
 ());

396 
”r
 = 
	`S’d
 ((cÚ¡ 
BYTE
 *è
szSŒ
, 
	`¡¾’
 (szStr));

398 
”r
 = 
	`AddExifH—d”
 ();

399 
ERRCHECK
;

401 
	`mem£t
 (
m_pbyIÅutBufãr
, 0xFF, 
m_iIÅutBufãrSize
);

405 
	`S’d
 ((cÚ¡ 
BYTE
 *è
szPJLEndJob
, (szPJLEndJob) - 1);

407 
m_iRowNumb”
 = 0;

409  
”r
;

410 
	}
}

412 
	gH—d”QuickCÚÃù
::
	$H—d”QuickCÚÃù
 (
Prš‹r
 *
p
, 
PrštCÚ‹xt
 *
pc
)

413 : 
	$H—d”
 (
p
,
pc
)

415 
	}
}

417 
DRIVER_ERROR
 
	gH—d”QuickCÚÃù
::
	$S’d
 ()

419  
NO_ERROR
;

420 
	}
}

422 
DRIVER_ERROR
 
	gH—d”QuickCÚÃù
::
	$EndJob
 ()

424 
DRIVER_ERROR
 
”r
 = 
NO_ERROR
;

426  
”r
;

427 
	}
}

429 
DRIVER_ERROR
 
	gH—d”QuickCÚÃù
::
	$FÜmF“d
 ()

431 
DRIVER_ERROR
 
”r
 = 
NO_ERROR
;

432 
thePrš‹r
->
	`Flush
 (-1);

433  
”r
;

434 
	}
}

436 
DRIVER_ERROR
 
	gH—d”QuickCÚÃù
::
	$S’dCAPy
 (
iAbsY
)

438  
NO_ERROR
;

439 
	}
}

441 
	$HPFlush_ouut_bufãr_ÿÎback
 (
JOCTET
 *
outbuf
, 
BYTE
 *
bufãr
, 
size
)

443 
QuickCÚÃù
 *
pQC
 = (QuickCÚÃù *è
outbuf
;

444 
pQC
->
	`J³gD©a
 (
bufãr
, 
size
);

445 
	}
}

447 
	gQuickCÚÃù
::
	$J³gD©a
 (
BYTE
 *
bufãr
, 
iSize
)

449 
m_iJ³gBufãrPos
 +ğ
iSize
;

450 ià(
m_iJ³gBufãrPos
 < 
m_iMaxFeSize
)

452 
	`memıy
 (
m_pbyJ³gBufãr
 + 
m_iJ³gBufãrPos
 - 
iSize
, 
bufãr
, iSize);

456 
m_iJ³gBufãrPos
 = 
m_iMaxFeSize
 + 1;

458 
	}
}

464 
	$HPJ³g_”rÜ
 (
j_commÚ_±r
 
cšfo
)

467 
	}
}

471 
j³g_bufãr_de¡
 (
j_com´ess_±r
 
cšfo
, 
JOCTET
* 
outbuff
, * 
æush_ouut_bufãr_ÿÎback
);

472 
hp_rgb_ycc_£tup
 (
iFÏg
);

475 
DRIVER_ERROR
 
QuickCÚÃù
::
	$Com´ess
 ()

478 
BYTE
 *
p
;

479 vŞ©
iQu®™y
 = 100;

486 
j³g_com´ess_¡ruù
 
cšfo
;

487 
j³g_”rÜ_mgr
 
j”r
;

488 
jmp_buf
 
£tjmp_bufãr
;

490 
BOOL
 
bRedo
;

494 
	`hp_rgb_ycc_£tup
 (0);

497 
bRedo
 = 0;

499 
m_iJ³gBufãrPos
 = 0;

500 
	`mem£t
 (
m_pbyJ³gBufãr
, 0xFF, 
m_iMaxFeSize
);

502 
cšfo
.
”r
 = 
	`j³g_¡d_”rÜ
 (&
j”r
);

503 
j”r
.
”rÜ_ex™
 = 
HPJ³g_”rÜ
;

504 ià(
	`£tjmp
 (
£tjmp_bufãr
))

506 
	`j³g_de¡roy_com´ess
 (&
cšfo
);

507  
SYSTEM_ERROR
;

510 
	`j³g_ü—‹_com´ess
 (&
cšfo
);

511 
cšfo
.
š_cŞÜ_¥aû
 = 
JCS_RGB
;

512 
	`j³g_£t_deçuÉs
 (&
cšfo
);

513 
cšfo
.
image_width
 = 
m_iRowWidth
 / 3;

514 
cšfo
.
image_height
 = 
m_iRowNumb”
;

515 
cšfo
.
šput_compÚ’ts
 = 3;

516 
cšfo
.
d©a_´ecisiÚ
 = 8;

517 
	`j³g_£t_qu®™y
 (&
cšfo
, 
iQu®™y
, 
TRUE
);

518 
	`j³g_bufãr_de¡
 (&
cšfo
, (
JOCTET
 *è
this
, (*è(
HPFlush_ouut_bufãr_ÿÎback
));

519 
	`j³g_¡¬t_com´ess
 (&
cšfo
, 
TRUE
);

520 
JSAMPROW
 
pRowA¼ay
[1];

521 
p
 = 
m_pbyIÅutBufãr
;

522 
i
 = 0; i < 
m_iRowNumb”
; i++)

524 
pRowA¼ay
[0] = (
JSAMPROW
è
p
;

525 
	`j³g_wr™e_sÿÆšes
 (&
cšfo
, 
pRowA¼ay
, 1);

526 
p
 +ğ(
m_iRowWidth
);

527 ià(
m_iJ³gBufãrPos
 > 
m_iMaxFeSize
)

529 
m_iJ³gBufãrPos
 = 0;

530 
bRedo
 = 1;

533 
	`j³g_fšish_com´ess
 (&
cšfo
);

534 
	`j³g_de¡roy_com´ess
 (&
cšfo
);

535 
iQu®™y
 -= 10;

536 ià(
iQu®™y
 == 0)

538 
m_iJ³gBufãrPos
 = 0;

539  
SYSTEM_ERROR
;

541 } 
bRedo
);

543 #ifdeà
_DEBUG


544 
szFeName
[64];

545 
	`¥rštf
 (
szFeName
, "C:\\temp\\HPJpeg.jpg");

546 
FILE
 *
å
 = 
	`fİ’
 (
szFeName
, "wb");

547 ià(
å
)

549 
	`fwr™e
 (
m_pbyJ³gBufãr
, 1, 
m_iJ³gBufãrPos
, 
å
);

550 
	`fşo£
 (
å
);

554  
NO_ERROR
;

555 
	}
}

557 
DRIVER_ERROR
 
QuickCÚÃù
::
	$AddExifH—d”
 ()

560 
DRIVER_ERROR
 
”r
;

561 
BYTE
 *
pBufãr
 = 
m_pbyJ³gBufãr
;

580 
Aµ2
[] = {"\xFF\xE2\x00\x23\x48\x50\x51\x43\x00\x00\x01\x00\x02"};

581 
szAµ2M¬k”s
[2][12];

582 
iNumTags
 = 0;

583 
iO±s
[2];

587 
iO±s
[0] = 
m_iRemoveRedEye
;

588 
iO±s
[1] = 
m_iBÜd”Ëss
;

590 
skey
;

591 
szTag
[] = {"\x00\x01\x00\x03\x00\x00\x00\x01\x00\x00\x00\x01"};

592 
iV®
;

594 
skey
 = 1; skey <= 2; skey++)

596 
szTag
[0] = (
BYTE
è((
skey
 & 0xFF) >> 8);

597 
szTag
[1] = (
BYTE
è(
skey
 & 0xFF);

599 
iV®
 = 
iO±s
[
skey
];

600 
szTag
[8] = (
BYTE
è((
iV®
 >> 24) & 0xFF);

601 
szTag
[9] = (
BYTE
è((
iV®
 >> 16) & 0xFF);

602 
szTag
[10] = (
BYTE
è((
iV®
 >> 8) & 0xFF);

603 
szTag
[11] = (
BYTE
è(
iV®
 & 0xFF);

604 
	`memıy
 (
szAµ2M¬k”s
[
iNumTags
], 
szTag
, 12);

605 
iNumTags
++;

607 
skey
 = (è
iNumTags
 * 12 + 11;

608 
Aµ2
[2] = (
BYTE
è((
skey
 >> 8) & 0xFF);

609 
Aµ2
[3] = (
BYTE
è(
skey
 & 0xFF);

610 
Aµ2
[11] = (
BYTE
è((
iNumTags
 >> 8) & 0xFF);

611 
Aµ2
[12] = (
BYTE
è(
iNumTags
 & 0xFF);

630 
sJFIFH—d”Size
 = ((((è
pBufãr
[4]) << 8) |…Buffer[5]) + 4;

631 
”r
 = 
	`S’d
 ((cÚ¡ 
BYTE
 *è
pBufãr
, 
sJFIFH—d”Size
);

632 
ERRCHECK
;

634 
m_iJ³gBufãrPos
 -ğ
sJFIFH—d”Size
;

635 
pBufãr
 +ğ
sJFIFH—d”Size
;

637 ià(
iNumTags
 != 0)

639 
”r
 = 
	`S’d
 ((cÚ¡ 
BYTE
 *è
Aµ2
, 13);

640 
i
 = 0; i < 
iNumTags
; i++)

642 
”r
 = 
	`S’d
 ((cÚ¡ 
BYTE
 *è
szAµ2M¬k”s
[
i
], 12);

646 
”r
 = 
	`S’d
 ((cÚ¡ 
BYTE
 *è
pBufãr
, 
m_iJ³gBufãrPos
);

647  
”r
;

648 
	}
}

650 
APDK_END_NAMESPACE


	@prnt/hpijs/quickconnect.h

32 #iâdeà
APDK_QUICKCONNECT_H


33 
	#APDK_QUICKCONNECT_H


	)

37 
	~"j³glib.h
"

40 
APDK_BEGIN_NAMESPACE


45 şas 
	cQuickCÚÃù
 : 
public
 
Prš‹r


47 
public
:

48 
QuickCÚÃù
 (
Sy¡emS”viûs
* 
pSS
, 
BOOL
 
´Ùo
=
FALSE
);

49 ~
QuickCÚÃù
 ();

51 
H—d”
 *
S–eùH—d”
 (
PrštCÚ‹xt
* 
pc
);

52 
DRIVER_ERROR
 
V”ifyP’Info
 ();

53 
DRIVER_ERROR
 
P¬£P’Info
 (
PEN_TYPE
& 
eP’
, 
BOOL
 
Qu”yPrš‹r
=
TRUE
);

54 
šlše
 
vœtu®
 
BOOL
 
	$SuµÜtS•¬©eBÏck
 (
PrštMode
 *
pCu¼’tMode
)

56  
FALSE
;

59 
vœtu®
 
BOOL
 
	$G‘M¬gšs
 (
PAPER_SIZE
 
ps
, *
fM¬gšs
)

61 
fM¬gšs
[0] = () 0.0;

62 
fM¬gšs
[1] = () 0.0;

63 
fM¬gšs
[2] = () 0.0;

64 
fM¬gšs
[3] = () 0.0;

65  
TRUE
;

66 
	}
}

67 
vœtu®
 
BOOL
 
	$FuÎBËedC­abË
 (
PAPER_SIZE
 
ps
, 
FuÎbËedTy³
 *
fbTy³
,

68 *
xOv”S´ay
, *
yOv”S´ay
,

69 *
fLeáOv”S´ay
, *
fTİOv”S´ay
)

71 *
xOv”S´ay
 = () 0.0;

72 *
yOv”S´ay
 = () 0.0;

73 ià(
fLeáOv”S´ay
)

74 *
fLeáOv”S´ay
 = () 0.0;

75 ià(
fTİOv”S´ay
)

76 *
fTİOv”S´ay
 = () 0.0;

77 *
fbTy³
 = 
fuÎbËed4EdgeAÎMedŸ
;

78  
TRUE
;

79 
	}
}

81 
vœtu®
 
DRIVER_ERROR
 
S‘Hšt
 (
PRINTER_HINT
 
eHšt
, 
iV®ue
);

82 
J³gD©a
 (
BYTE
 *
bufãr
, 
size
);

83 
DRIVER_ERROR
 
EnÿpsuÏ‹
 (cÚ¡ 
RASTERDATA
 *
IÅutRa¡”
, 
BOOL
 
bLa¡PÏÃ
);

84 
DRIVER_ERROR
 
Flush
 (
iBufãrSize
);

85 
PAPER_SIZE
 
	$Mªd©ÜyP­”Size
 ()

87  
PHOTO_5x7
;

88 
	}
}

90 
´Ùeùed
:

92 #ifdeà
APDK_HP_UX


93 
vœtu®
 
QuickCÚÃù
 & 
İ”©Ü
 = (
Prš‹r
& 
rhs
)

95  *
this
;

99 
´iv©e
:

100 
M­P­”Size
 (
PAPER_SIZE
 
eP­”Size
);

101 
M­MedŸTy³
 (
MEDIATYPE
 
eMedŸTy³
);

102 
M­Qu®™yMode
 (
QUALITY_MODE
 
eQu®™yMode
);

103 
DRIVER_ERROR
 
AddExifH—d”
 ();

104 
DRIVER_ERROR
 
Com´ess
 ();

105 
PrštCÚ‹xt
 *
m_pPC
;

107 
m_iPhÙoFix
;

108 
m_iRemoveRedEye
;

109 
m_iBÜd”Ëss
;

110 
m_iMaxFeSize
;

112 
m_iRowNumb”
;

113 
m_iRowWidth
;

114 
m_iJobId
;

115 
m_iJ³gBufãrPos
;

116 
m_iJ³gBufãrSize
;

117 
m_iIÅutBufãrSize
;

118 
BYTE
 *
m_pbyIÅutBufãr
;

119 
BYTE
 *
m_pbyJ³gBufãr
;

123 şas 
	cQCAutom©ic
 : 
public
 
PrštMode


125 
public
:

126 
QCAutom©ic
 ();

127 
šlše
 
BOOL
 
	$MedŸCom·tibË
 (
MEDIATYPE
 
eMedŸ
)

129  
TRUE
;

131 
	}
};

134 şas 
	cQCFa¡NÜm®
 : 
public
 
PrštMode


136 
public
:

137 
QCFa¡NÜm®
 ();

138 
šlše
 
BOOL
 
	$MedŸCom·tibË
 (
MEDIATYPE
 
eMedŸ
)

140  
TRUE
;

143 
	}
};

145 şas 
	cQCNÜm®
 : 
public
 
PrštMode


147 
public
:

148 
QCNÜm®
 ();

149 
šlše
 
BOOL
 
	$MedŸCom·tibË
 (
MEDIATYPE
 
eMedŸ
)

151  
TRUE
;

154 
	}
};

156 şas 
	cQCBe¡
 : 
public
 
PrštMode


158 
public
:

159 
QCBe¡
 ();

160 
šlše
 
BOOL
 
	$MedŸCom·tibË
 (
MEDIATYPE
 
eMedŸ
)

162  
TRUE
;

165 
	}
};

167 #ifdeà
APDK_QUICKCONNECT


171 şas 
	cQuickCÚÃùProxy
 : 
public
 
Prš‹rProxy


173 
public
:

174 
	$QuickCÚÃùProxy
(è: 
	`Prš‹rProxy
 (

179 è{
m_iPrš‹rTy³
 = 
eQuickCÚÃù
;}

180 
šlše
 
Prš‹r
* 
	$C»©ePrš‹r
 (
Sy¡emS”viûs
 *
pSS
ècÚ¡ {  
Ãw
 
	`QuickCÚÃù
 (pSS); 
	}
}

181 
šlše
 
PRINTER_TYPE
 
	$G‘Prš‹rTy³
 (ècÚ¡ {  
eQuickCÚÃù
;
	}
}

182 
šlše
 
	$G‘Mod–B™
(ècÚ¡ {  0x10000;
	}
}

186 
	gAPDK_END_NAMESPACE


	@prnt/hpijs/registry.cpp

35 
	~"h—d”.h
"

36 
	~"´š‹rçùÜy.h
"

38 
	~"´š‹r.h
"

39 
	~"­Şlo2xxx.h
"

40 
	~"­Şlo21xx.h
"

41 
	~"­Şlo2560.h
"

42 
	~"­Şlo2xxx.h
"

43 #ifdeà
APDK_DJ3320


44 
	~"dj3320.h
"

45 #ifdeà
APDK_DJ3600


46 
	~"dj3600.h
"

47 
	~"dj4100.h
"

48 
	~"djd2600.h
"

51 
	~"dj400.h
"

52 
	~"dj6xx.h
"

53 
	~"dj600.h
"

54 
	~"dj630.h
"

55 
	~"dj660.h
"

56 
	~"dj690.h
"

57 
	~"dj350.h
"

58 
	~"dj540.h
"

59 
	~"dj8xx.h
"

60 
	~"dj850.h
"

61 
	~"dj8x5.h
"

62 
	~"dj890.h
"

63 
	~"dj9xx.h
"

64 
	~"dj9xxv.h
"

65 
	~"djg’”icv.h
"

66 
	~"dj55xx.h
"

67 
	~"oj´okx50.h
"

68 
	~"ljmÚo.h
"

69 
	~"ljcŞÜ.h
"

70 
	~"p¥100.h
"

71 
	~"p¥470.h
"

72 
	~"psüt.h
"

73 
	~"ljj‘»ady.h
"

74 
	~"ljç¡¿¡”.h
"

75 #ià
defšed
 (
APDK_LJZJS_MONO
è|| defšed (
APDK_LJZJS_COLOR
è|| defšed (
APDK_LJM1005
)

76 
	~"ljzjs.h
"

78 #ifdeà
APDK_LJZJS_MONO


79 
	~"ljzjsmÚo.h
"

81 #ifdeà
APDK_LJZJS_COLOR


82 
	~"ljzjscŞÜ.h
"

84 #ifdeà
APDK_LJM1005


85 
	~"ljm1005.h
"

86 
	~"ljp1xxx.h
"

89 #ifdeà
APDK_QUICKCONNECT


90 
	~"quickcÚÃù.h
"

93 
	gAPDK_BEGIN_NAMESPACE


95 #ifdeà
APDK_PSCRIPT


96 
PSütProxy
 
	gDeviûRegi¡ry
::
s_PSütProxy
;

99 #ifdeà
APDK_LJMONO


100 
LJMÚoProxy
 
	gDeviûRegi¡ry
::
s_LJMÚoProxy
;

103 #ifdeà
APDK_LJCOLOR


104 
LJCŞÜProxy
 
	gDeviûRegi¡ry
::
s_LJCŞÜProxy
;

107 #ifdeà
APDK_LJJETREADY


108 
LJJ‘R—dyProxy
 
	gDeviûRegi¡ry
::
s_LJJ‘R—dyProxy
;

111 #ifdeà
APDK_LJFASTRASTER


112 
LJFa¡Ra¡”Proxy
 
	gDeviûRegi¡ry
::
s_LJFa¡Ra¡”Proxy
;

115 #ifdeà
APDK_LJZJS_MONO


116 
LJZjsMÚoProxy
 
	gDeviûRegi¡ry
::
s_LJZjsMÚoProxy
;

119 #ifdeà
APDK_LJZJS_COLOR


120 
LJZjsCŞÜProxy
 
	gDeviûRegi¡ry
::
s_LJZjsCŞÜProxy
;

123 #ifdeà
APDK_LJM1005


124 
LJM1005Proxy
 
	gDeviûRegi¡ry
::
s_LJM1005Proxy
;

125 
LJP1XXXProxy
 
	gDeviûRegi¡ry
::
s_LJP1XXXProxy
;

128 #ià
defšed
(
APDK_PSP100
è&& defšed (
APDK_DJ9xxVIP
)

129 
PSP100Proxy
 
	gDeviûRegi¡ry
::
s_PSP100Proxy
;

130 
PSP470Proxy
 
	gDeviûRegi¡ry
::
s_PSP470Proxy
;

133 #ià
defšed
(
APDK_DJGENERICVIP
è&& defšed (
APDK_DJ9xxVIP
)

134 
DJG’”icVIPProxy
 
	gDeviûRegi¡ry
::
s_DJG’”icVIPProxy
;

135 
DJ55xxProxy
 
	gDeviûRegi¡ry
::
s_DJ55xxProxy
;

138 #ifdeà
APDK_DJ9xx


139 
DJ9xxProxy
 
	gDeviûRegi¡ry
::
s_DJ9xxProxy
;

142 #ifdeà
APDK_DJ9xxVIP


143 
DJ9xxVIPProxy
 
	gDeviûRegi¡ry
::
s_DJ9xxVIPProxy
;

144 
OJProKx50Proxy
 
	gDeviûRegi¡ry
::
s_OJProKx50Proxy
;

147 #ià
defšed
(
APDK_DJ8xx
)|| defšed(
APDK_DJ9xx
)

148 
DJ8xxProxy
 
	gDeviûRegi¡ry
::
s_DJ8xxProxy
;

151 #ià
defšed
(
APDK_DJ8xx
)|| defšed(
APDK_DJ9xx
)

152 #ifdeà
APDK_DJ8x5


153 
DJ8x5Proxy
 
	gDeviûRegi¡ry
::
s_DJ8x5Proxy
;

157 #ià
defšed
(
APDK_DJ890
)

158 
DJ890Proxy
 
	gDeviûRegi¡ry
::
s_DJ890Proxy
;

161 #ià
defšed
(
APDK_DJ850
)

162 
DJ850Proxy
 
	gDeviûRegi¡ry
::
s_DJ850Proxy
;

165 #ifdeà
APDK_DJ6xxPhÙo


166 
DJ6xxPhÙoProxy
 
	gDeviûRegi¡ry
::
s_DJ6xxPhÙoProxy
;

169 #ifdeà
APDK_DJ6xx


170 
DJ660Proxy
 
	gDeviûRegi¡ry
::
s_DJ660Proxy
;

173 #ifdeà
APDK_DJ630


174 
DJ630Proxy
 
	gDeviûRegi¡ry
::
s_DJ630Proxy
;

177 #ifdeà
APDK_DJ600


178 
DJ600Proxy
 
	gDeviûRegi¡ry
::
s_DJ600Proxy
;

181 #ifdeà
APDK_DJ540


182 
DJ540Proxy
 
	gDeviûRegi¡ry
::
s_DJ540Proxy
;

185 #ifdeà
APDK_DJ400


186 
DJ400Proxy
 
	gDeviûRegi¡ry
::
s_DJ400Proxy
;

189 #ifdeà
APDK_DJ350


190 
DJ350Proxy
 
	gDeviûRegi¡ry
::
s_DJ350Proxy
;

193 #ià
defšed
(
APDK_DJ3600
è&& defšed (
APDK_DJ3320
)

194 
DJ3600Proxy
 
	gDeviûRegi¡ry
::
s_DJ3600Proxy
;

195 
DJ4100Proxy
 
	gDeviûRegi¡ry
::
s_DJ4100Proxy
;

196 
DJD2600Proxy
 
	gDeviûRegi¡ry
::
s_DJD2600Proxy
;

199 #ià
defšed
 (
APDK_DJ3320
)

200 
DJ3320Proxy
 
	gDeviûRegi¡ry
::
s_DJ3320Proxy
;

203 #ifdeà
APDK_APOLLO2560


204 
ApŞlo2560Proxy
 
	gDeviûRegi¡ry
::
s_ApŞlo2560Proxy
;

207 #ifdeà
APDK_APOLLO21XX


208 
ApŞlo21xxProxy
 
	gDeviûRegi¡ry
::
s_ApŞlo21xxProxy
;

211 #ifdeà
APDK_APOLLO2XXX


212 
ApŞlo2xxxProxy
 
	gDeviûRegi¡ry
::
s_ApŞlo2xxxProxy
;

215 #ifdeà
APDK_QUICKCONNECT


216 
QuickCÚÃùProxy
 
	gDeviûRegi¡ry
::
s_QuickCÚÃùProxy
;

219 
	gDeviûRegi¡ry
::
	$DeviûRegi¡ry
()

220 : 
	$deviû
(
UNSUPPORTED
)

222 
	}
}

225 
DeviûRegi¡ry
::~
	$DeviûRegi¡ry
()

227 
	`DBG1
("deleting DeviceRegistry\n");

228 
	}
}

231 
DRIVER_ERROR
 
	gDeviûRegi¡ry
::
	$S–eùDeviû
(cÚ¡ 
PRINTER_TYPE
 
Mod–
)

233 ià(
Mod–
 > 
MAX_PRINTER_TYPE
)

234  
UNSUPPORTED_PRINTER
;

235 
deviû
 = 
Mod–
;

237  
NO_ERROR
;

238 
	}
}

241 
DRIVER_ERROR
 
	gDeviûRegi¡ry
::
	$S–eùDeviû
(* 
mod–
, *
pVIPV”siÚ
, * 
³ns
, 
Sy¡emS”viûs
* 
pSS
)

247 #ià
	`defšed
(
DEBUG
è&& (
DBG_MASK
 & 
DBG_LVL1
)

248 
	`´štf
("DR::S–eùDeviû: mod–ğ'%s'\n",
mod–
);

249 
	`´štf
("DR::S–eùDeviû: VIPv”ğ%d\n",*
pVIPV”siÚ
);

250 
	`´štf
("DR::S–eùDeviû:…’sğ'%s'\n",
³ns
);

253 
j
 = 0;

254 
³n1
 = '\0';

255 
³n2
 = '\0';

257 
BOOL
 
m©ch
=
FALSE
;

259 
DRIVER_ERROR
 
”r
 = 
NO_ERROR
;

261 
FAMILY_HANDLE
 
çmyHªdË
 = 
pPFI
->
	`FšdDevIdM©ch
(
mod–
);

262 ià(
çmyHªdË
 !ğ
NULL
)

264 
deviû
 = 
pPFI
->
	`G‘FamyTy³
(
çmyHªdË
);

265 
m©ch
 = 
TRUE
;

268 ià(!
m©ch
)

270 ià(*
pVIPV”siÚ
 == 1)

272 
m©ch
 = 
TRUE
;

273 
deviû
 = 
eDJ9xxVIP
;

275 ià(*
pVIPV”siÚ
 > 1)

277 
m©ch
 = 
TRUE
;

278 
deviû
 = 
eDJG’”icVIP
;

286 ià(!
m©ch
)

288 
BYTE
 
DevIDBufãr
[
DevIDBuffSize
];

290 
”r
 = 
pSS
->
	`G‘DeviûID
(
DevIDBufãr
, 
DevIDBuffSize
, 
FALSE
);

291 
ERRCHECK
;

293 *
cmdSŒ
 = (*è
	`¡r¡r
 ((cÚ¡ *è
DevIDBufãr
+2, "CMD:");

294 *
cmdSŒEnd
;

295 ià((
	`¡r¡r
((cÚ¡ *è
DevIDBufãr
+2,"CMD:LDL")))

297 
deviû
 = 
eDJ3320
;

298 
m©ch
 = 
TRUE
;

300 ià(!
m©ch
 && 
cmdSŒ
 && (
cmdSŒEnd
 = (*è
	`¡r¡r
 (cmdStr, ";")))

302 *
cmdSŒEnd
 = '\0';

303 ià(
	`¡r¡r
 (
cmdSŒ
, "LDL"))

305 
m©ch
 = 
TRUE
;

306 
deviû
 = 
eDJ4100
;

308 *
cmdSŒEnd
 = ';';

310 ià(!
m©ch
 && !
cmdSŒ
)

312 
cmdSŒ
 = (*è
	`¡r¡r
 ((cÚ¡ *è
DevIDBufãr
+2, "COMMAND SET:");

314 ià(!
m©ch
 && 
cmdSŒ
 && (
	`¡r¡r
 ((const *) cmdStr+4, "POSTSCRIPT") ||

315 
	`¡r¡r
 ((cÚ¡ *è
cmdSŒ
+4, "PostScript") ||

316 
	`¡r¡r
 ((cÚ¡ *è
cmdSŒ
+4, "Postscript") ||

317 
	`¡r¡r
 ((cÚ¡ *è
cmdSŒ
+4, "postscript") ))

319 
deviû
 = 
ePSüt
;

320 
m©ch
 = 
TRUE
;

324 ià(!
m©ch
)

331 
deviû
 = 
UNSUPPORTED
;

332 iàĞ
³ns
[0] != '\0' )

336 if(
³ns
[1] == 'X')

338 
	`DBG1
("DR:(Unknown Model) Needo do‡ POWER ONo get…enIDs\n");

340 
DWORD
 
Ëngth
=(
DJ895_Pow”_On
);

341 
”r
 = 
pSS
->
	`ToDeviû
(
DJ895_Pow”_On
, &
Ëngth
);

342 
ERRCHECK
;

344 
”r
 = 
pSS
->
	`FlushIO
();

345 
ERRCHECK
;

348 ià(
pSS
->
	`BusyWa™
((
DWORD
)1000è=ğ
JOB_CANCELED
)

349  
JOB_CANCELED
;

352 
”r
=
	`G‘Prš‹rMod–
(
mod–
,
pVIPV”siÚ
,
³ns
,
pSS
);

353 
ERRCHECK
;

362 ià(
³ns
[0] != '$')

368 
³n1
=
³ns
[1];

371 
j
=2;

372 
BOOL
 
NO_PEN2
 = 
FALSE
;

373 
³ns
[
j
] != '$')

375 
j
++;

376 iàĞ
³ns
[
j
] == '\0' )

379 
³n2
 = '\0';

380 
NO_PEN2
 = 
TRUE
;

384 ià(
NO_PEN2
 =ğ
FALSE
)

386 
j
++;

387 
³n2
 = 
³ns
[
j
];

390 if(
³n1
 =ğ'A' || 
³n2
 == 'A')

392 if(
³n1
 == 'A')

395 if(
³n2
 == 'A')

396 
pSS
->
	`Di¥ÏyPrš‹rStus
(
DISPLAY_NO_PENS
);

399 if(
³n2
 == '\0')

400 
pSS
->
	`Di¥ÏyPrš‹rStus
(
DISPLAY_NO_PEN_DJ600
);

403 ià(
³n2
 == 'F')

405 
deviû
 = 
eDJ8x5
;

406  
NO_ERROR
;

409 
pSS
->
	`Di¥ÏyPrš‹rStus
(
DISPLAY_NO_BLACK_PEN
);

412 if(
³n2
 == 'A')

417 ià(
³n1
 == 'H' ||…en1 == 'Z' ||…en1 == 'L')

419 
deviû
 = 
eDJ8x5
;

420  
NO_ERROR
;

422 
pSS
->
	`Di¥ÏyPrš‹rStus
(
DISPLAY_NO_COLOR_PEN
);

425 ià(
pSS
->
	`BusyWa™
(500è=ğ
JOB_CANCELED
)

426  
JOB_CANCELED
;

429 
”r
=
	`G‘Prš‹rMod–
(
mod–
,
pVIPV”siÚ
,
³ns
,
pSS
);

430 
ERRCHECK
;

433 } 
³n1
 =ğ'A' || 
³n2
 == 'A');

438 ià(
³n1
 == 'H' ||…en1 == 'Z' ||…en1 == 'L')

441 ià(
³n2
 == 'M')

442 
deviû
 = 
eDJ850
;

443 ià(
	`¡ºcmp
 (
mod–
,"DESKJET 890",11) == 0)

444 
deviû
=
eDJ890
;

445 ià(
³n2
 == 'N')

446 
deviû
 = 
eDJ9xx
;

450 
deviû
 = 
eDJ8xx
;

452 if(
³n1
 == 'C')

455 ià(
³n2
 =ğ'\0'è
deviû
 = 
eDJ600
;

457 
deviû
 = 
eDJ6xx
;

459 if(
³n1
 == 'M')

462 
deviû
 = 
eDJ6xxPhÙo
;

475 iàĞĞ(
	`¡ºcmp
(
mod–
,"DESKJET 81",10) == 0)

476 || (
	`¡ºcmp
(
mod–
,"DESKJET 83",10) == 0)

477 || (
	`¡ºcmp
(
mod–
,"DESKJET 88",10) == 0)

478 || (
	`¡ºcmp
(
mod–
,"DESKJET 895",11) == 0)

480 && (
pSS
->
IOMode
.
bUSB
)

483 
	`DBG1
("This…rinter has†imited USB status\n");

484 
pSS
->
IOMode
.
bStus
 = 
FALSE
;

485 
pSS
->
IOMode
.
bDevID
 = 
FALSE
;

488 iàĞĞ(
	`¡ºcmp
(
mod–
,"DESKJET 63",10) == 0)

489 || (
	`¡ºcmp
(
mod–
,"DESKJET 64",10) == 0)

491 && (
pSS
->
IOMode
.
bUSB
)

494 
	`DBG1
("This…rinter has†imited USB status, but we did get DeviceIDString\n");

495 
pSS
->
IOMode
.
bStus
 = 
FALSE
;

498 ià(
deviû
 =ğ
UNSUPPORTED
è 
UNSUPPORTED_PRINTER
;

499  
NO_ERROR
;

500 
	}
}

502 
DRIVER_ERROR
 
	gDeviûRegi¡ry
::
	$S–eùDeviû
(cÚ¡ * 
sDevID
, 
Sy¡emS”viûs
* 
pSS
)

504 
¡rMod–
[
DevIDBuffSize
];

505 
¡rP’s
[64];

506 
VIPV”siÚ
;

508 
DRIVER_ERROR
 
”r
 = 
	`P¬£DevIDSŒšg
(
sDevID
, 
¡rMod–
, &
VIPV”siÚ
, 
¡rP’s
);

509 ià(
”r
 !ğ
NO_ERROR
)

511  
UNSUPPORTED_PRINTER
;

514  
	`S–eùDeviû
(
¡rMod–
, &
VIPV”siÚ
, 
¡rP’s
, 
pSS
);

515 
	}
}

517 
DRIVER_ERROR
 
	gDeviûRegi¡ry
::
	$In¡ªtŸ‹Prš‹r
(
Prš‹r
*& 
p
, 
Sy¡emS”viûs
* 
pSS
)

523 
FAMILY_HANDLE
 
çmyHªdË
 = 
pPFI
->
	`FšdDevIdM©ch
(
Mod–Name
[
deviû
]);

524 ià(
çmyHªdË
 =ğ
NULL
)

526 
	`ASSERT
(
çmyHªdË
);

527 
	`DBG1
("DR::InstantiatePrinter -‚o family match\n");

528  
UNSUPPORTED_PRINTER
;

530 
p
 = 
pPFI
->
	`C»©ePrš‹r
(
pSS
, 
çmyHªdË
);

531 
	`NEWCHECK
(
p
);

532  
p
->
cÚ¡ruùÜ_”rÜ
;

533 
	}
}

537 
DRIVER_ERROR
 
	gDeviûRegi¡ry
::
	$G‘Prš‹rMod–
(* 
¡rMod–
, *
pVIPV”siÚ
, * 
¡rP’s
, 
Sy¡emS”viûs
* 
pSS
)

539 
DRIVER_ERROR
 
”r
;

540 
BYTE
 
DevIDBufãr
[
DevIDBuffSize
];

542 
”r
 = 
pSS
->
	`G‘DeviûID
(
DevIDBufãr
, 
DevIDBuffSize
, 
TRUE
);

543 
ERRCHECK
;

545  
	`P¬£DevIDSŒšg
((cÚ¡ *)
DevIDBufãr
, 
¡rMod–
, 
pVIPV”siÚ
, 
¡rP’s
);

547 
	}
}

549 
	#HEXTOINT
(
x
, 
p
) if (x >= '0' && x <= '9') *p |= x - '0'; \

550 ià(
x
 >ğ'A' && x <ğ'F'è*
p
 |= 0xA + x - 'A'; \

551 ià(
x
 >ğ'a' && x <ğ'f'è*
p
 |ğ0xA + x - 'a'

	)

560 
DRIVER_ERROR
 
	gDeviûRegi¡ry
::
	$P¬£DevIDSŒšg
(cÚ¡ * 
sDevID
, * 
¡rMod–
, *
pVIPV”siÚ
, * 
¡rP’s
)

562 
i
;

563 * 
pSŒ
 = 
NULL
;

568 iàĞ(
pSŒ
 = (*)
	`¡r¡r
(
sDevID
+2,"MODEL:")) )

569 
pSŒ
+=6;

571 iàĞ(
pSŒ
=(*)
	`¡r¡r
(
sDevID
+2,"MDL:")) )

572 
pSŒ
+=4;

573  
BAD_DEVICE_ID
;

576 
i
 = 0;

577  (
pSŒ
[
i
] !ğ';'è&& (pSŒ[i] !ğ'\0'è&& (˜< 
DevIDBuffSize
))

579 
¡rMod–
[
i
] = 
pSŒ
[i];

580 
i
++;

582 
¡rMod–
[
i
] = '\0';

586 iàĞ(
pSŒ
=(*)
	`¡r¡r
(
sDevID
+2,";S:00")) )

588 
pSŒ
 += 15;

589 ià((*
pSŒ
 >= '0') && (*pStr <= '9'))

591 *
pVIPV”siÚ
 = *
pSŒ
 - '0';

593 ià((*
pSŒ
 >= 'A') && (*pStr <= 'F'))

595 *
pVIPV”siÚ
 = 10 + (*
pSŒ
 - 'A');

599 *
pVIPV”siÚ
 = 0;

620 ià((
pSŒ
 = (*)
	`¡r¡r
 (
sDevID
+2, ";S:")))

622 *
pVIPV”siÚ
 = 0;

623 
	`HEXTOINT
 (*(
pSŒ
+3), 
pVIPV”siÚ
);

624 *
pVIPV”siÚ
 = *pVIPVersion << 4;

625 
	`HEXTOINT
 (*(
pSŒ
+4), 
pVIPV”siÚ
);

626 ià(*(
pSŒ
 + 15) == '1')

628 (*
pVIPV”siÚ
)++;

632 *
pVIPV”siÚ
 = 0;

638 *
pVIPV”siÚ
 = 0;

642 ifĞ(
pSŒ
=(*)
	`¡r¡r
(
sDevID
+2,"VSTATUS:")) )

644 
pSŒ
+=8;

645 
i
=0;

646  (
pSŒ
[
i
] != ',') && (pStr[i] != ';') && (pStr[i] != '\0') )

648 
¡rP’s
[
i
] = 
pSŒ
[i];

649 
i
++;

651 
¡rP’s
[
i
] = '\0';

653 iàĞ(
pSŒ
 = (*)
	`¡r¡r
(
sDevID
 + 2, ";S:00")) ||

654 (
pSŒ
 = (*)
	`¡r¡r
 (
sDevID
 + 2, ";S:")))

657 
iV”siÚ
 = 0;

658 
	`HEXTOINT
 (*(
pSŒ
+3), &
iV”siÚ
);

659 
iV”siÚ
 = iVersion << 4;

660 
	`HEXTOINT
 (*(
pSŒ
+4), &
iV”siÚ
);

661 ià(
iV”siÚ
 <= 2)

663 
pSŒ
 += 19;

665 ià(
iV”siÚ
 < 4)

667 
pSŒ
 += 21;

671 
pSŒ
 += 25;

676 ià((*
pSŒ
 >= '0') && (*pStr <= '9'))

678 
i
 = 1 + ((*
pSŒ
-'0')*8);

680 ià((*
pSŒ
 >= 'A') && (*pStr <= 'F'))

682 
i
 = 1 + ((10 + (*
pSŒ
-'A')) * 8);

686 
i
 = 1;

688 
	`memıy
(
¡rP’s
, 
pSŒ
, 
i
);

689 
¡rP’s
[
i
] = '\0';

692 
¡rP’s
[0] = '\0';

694  
NO_ERROR
;

695 
	}
}

697 
	gAPDK_END_NAMESPACE


	@prnt/hpijs/resources.h

32 
	~"cÚfig.h
"

34 
APDK_BEGIN_NAMESPACE


36 cÚ¡ 
HTBš¬y_İ’
[1024];

37 cÚ¡ 
HT300x3004Ëv–_İ’
[1024];

38 cÚ¡ 
HT600x6004Ëv–895_İ’
[1024];

40 cÚ¡ 
HTBš¬y_´İ
[1024];

41 cÚ¡ 
HT300x3004Ëv–_´İ
[1024];

42 cÚ¡ 
HT600x6004Ëv–895_´İ
[1024];

44 cÚ¡ 
HT600x6004Ëv–970_İ’
[1024];

45 cÚ¡ 
HT600x6004Ëv–970_´İ
[1024];

47 cÚ¡ 
HT600x6004Ëv–3600_İ’
[1024];

50 cÚ¡ 
HT1200x1200x1_PhÙoP»s970_İ’
[1024];

51 cÚ¡ 
HT600x600x4_P»s970_İ’
[1024];

53 cÚ¡ 
HT300x3004Ëv–970_İ’
[1024];

54 cÚ¡ 
HT1200x1200x1PhÙoBe¡_İ’
[];

56 
	gAPDK_END_NAMESPACE


	@prnt/hpijs/scaler.cpp

31 
	~"h—d”.h
"

33 
	gAPDK_BEGIN_NAMESPACE


35 
	#MAX_OUTPUT_RASTERS
 32

	)

38 
	gSÿËr
::
	$SÿËr
(
Sy¡emS”viûs
* 
pSys
,
šputwidth
,

39 
num”©Ü
,
d’omš©Ü
, 
BOOL
 
v
, 
By‹sP”Pix–
)

40 : 
	`pSS
(
pSys
), 
	$iIÅutWidth
(
šputwidth
)

43 
	`ASSERT
(
d’omš©Ü
 > 0);

45 
cÚ¡ruùÜ_”rÜ
=
NO_ERROR
;

46 
i
 = 
COLORTYPE_COLOR
; i < 
MAX_COLORTYPE
; i++)

48 
pOuutBufãr
[
i
] = 
NULL
;

51 
SÿËFaùÜ
ğ()
num”©Ü
 / ()
d’omš©Ü
;

52 ià(
SÿËFaùÜ
 > ()
MAX_OUTPUT_RASTERS
)

54 
cÚ¡ruùÜ_”rÜ
 = 
INDEX_OUT_OF_RANGE
;

57 
çùÜ
 = ()
SÿËFaùÜ
;

58 
»m
 = 
SÿËFaùÜ
 - ()
çùÜ
;

59 
»m
 *= 1000;

60 
»mašd”
 = ()
»m
;

62 
iOuutWidth
 = (è(((è
iIÅutWidth
 / (è
d’omš©Ü
) *

63 (è
num”©Ü
);

64 
iOuutWidth
++;

66 ià(
num”©Ü
 =ğ
d’omš©Ü
)

67 
sÿlšg
=
FALSE
;

68 
sÿlšg
=
TRUE
;

74 
SÿËBound
 = (
SÿËFaùÜ
);

75 ià(
SÿËFaùÜ
 > (è
SÿËBound
)

76 
SÿËBound
++;

79 
RSBuffSize
ğ()((()(
By‹sP”Pix–
*
iOuutWidth
)è* 
SÿËBound
 );

80 
pOuutBufãr
[
COLORTYPE_COLOR
]=(
BYTE
*)
pSS
->
	`AÎocMem
(
RSBuffSize
);

81 ià(
pOuutBufãr
[
COLORTYPE_COLOR
] =ğ
NULL
)

83 
cÚ¡ruùÜ_”rÜ
=
ALLOCMEM_ERROR
;

88 ià(
v
)

90 
	`mem£t
(
pOuutBufãr
[
COLORTYPE_COLOR
], 0xFF, 
RSBuffSize
);

93 
BÏckBuffSize
ğ()((()(
iOuutWidth
)è* 
SÿËBound
 );

94 
pOuutBufãr
[
COLORTYPE_BLACK
]=(
BYTE
*)
pSS
->
	`AÎocMem
(
BÏckBuffSize
);

95 ià(
pOuutBufãr
[
COLORTYPE_BLACK
] =ğ
NULL
)

97 
cÚ¡ruùÜ_”rÜ
=
ALLOCMEM_ERROR
;

101 ià(
SÿËFaùÜ
 < 2.0)

102 
R•liÿ‹OÆy
 = 
TRUE
;

103 
R•liÿ‹OÆy
=
FALSE
;

105 ià(
SÿËFaùÜ
 > ()
çùÜ
)

106 
äaùiÚ®
=
TRUE
;

107 
äaùiÚ®
=
FALSE
;

108 
	}
}

110 
	gSÿËr
::~
	$SÿËr
()

112 
i
 = 
COLORTYPE_COLOR
; i < 
MAX_COLORTYPE
; i++)

114 ià(
pOuutBufãr
[
i
])

116 
pSS
->
	`F»eMemÜy
(
pOuutBufãr
[
i
]);

117 
pOuutBufãr
[
i
] = 
NULL
;

120 
	}
}

122 
	gSÿËr
::
	$G‘MaxOuutWidth
(
COLORTYPE
 
¿¡”cŞÜ
)

124 ià(
¿¡”cŞÜ
 =ğ
COLORTYPE_COLOR
)

126  (
iOuutWidth
-1)*
NUMBER_PLANES
;

130  (
iOuutWidth
-1);

132 
	}
}

134 
	gSÿËr
::
	$G‘OuutWidth
(
COLORTYPE
 
cŞÜ
)

136 ià(
cŞÜ
 =ğ
COLORTYPE_COLOR
)

138 ià(
¿¡”
.
¿¡”d©a
[
cŞÜ
])

139 ià(
my¶ªe
 =ğ
COLORTYPE_BLACK
)

140  
¿¡”
.
¿¡”size
[
cŞÜ
];

142  (
iOuutWidth
-1)*
NUMBER_PLANES
;

148 ià(
¿¡”
.
¿¡”d©a
[
cŞÜ
])

149 ià(
my¶ªe
 =ğ
COLORTYPE_COLOR
)

150  
¿¡”
.
¿¡”size
[
cŞÜ
];

152  (
iOuutWidth
-1);

156 
	}
}

158 
	gAPDK_END_NAMESPACE


	@prnt/hpijs/scaler_open.cpp

31 
	~"h—d”.h
"

32 
	~"sÿËr_İ’.h
"

35 
APDK_BEGIN_NAMESPACE


37 
	gSÿËr_O³n
::
	$SÿËr_O³n
(
Sy¡emS”viûs
* 
pSys
,
šputwidth
,

38 
num”©Ü
,
d’omš©Ü
,

39 
BOOL
 
bVIP
, 
iNumInks
)

40 : 
	`SÿËr
(
pSys
,
šputwidth
,
num”©Ü
,
d’omš©Ü
,
bVIP
, 
iNumInks
),

41 
	`NumInks
(
iNumInks
), 
	$v
(
bVIP
)

43 
row»mašd”
 = 
»mašd”
;

44 
	}
}

46 
	gSÿËr_O³n
::~
	$SÿËr_O³n
()

47 { 
	}
}

49 
BOOL
 
SÿËr_O³n
::
	$Proûss
(
RASTERDATA
* 
¿¡”_š
)

51 
iRa¡”sD–iv”ed
=0;

53 ià(
¿¡”_š
 =ğ
NULL
 || (¿¡”_š->
¿¡”d©a
[
COLORTYPE_COLOR
] =ğNULL &&„a¡”_š->¿¡”d©a[
COLORTYPE_BLACK
] == NULL))

55 
row»mašd”
=
»mašd”
;

56  
FALSE
;

59 ià(!
sÿlšg
)

62 
i
 = 
COLORTYPE_COLOR
; i < 
MAX_COLORTYPE
; i++)

64 ià(
¿¡”_š
->
¿¡”d©a
[
i
])

66 
	`memıy
(
pOuutBufãr
[
i
], 
¿¡”_š
->
¿¡”d©a
[i],„a¡”_š->
¿¡”size
[i]);

69 
iRa¡”sR—dy
 = 1;

70  
TRUE
;

73 ià(
my¶ªe
 =ğ
COLORTYPE_COLOR
)

75 ià(
¿¡”_š
->
¿¡”d©a
[
COLORTYPE_BLACK
])

77 
	`memıy
(
pOuutBufãr
[
COLORTYPE_BLACK
], 
¿¡”_š
->
¿¡”d©a
[COLORTYPE_BLACK],„a¡”_š->
¿¡”size
[COLORTYPE_BLACK]);

81 ià(
my¶ªe
 =ğ
COLORTYPE_BLACK
)

83 ià(
¿¡”_š
->
¿¡”d©a
[
COLORTYPE_COLOR
])

85 
	`memıy
(
pOuutBufãr
[
COLORTYPE_COLOR
], 
¿¡”_š
->
¿¡”d©a
[COLORTYPE_COLOR],„a¡”_š->
¿¡”size
[COLORTYPE_COLOR]);

90 
içùÜ
 = (è(è
SÿËFaùÜ
;

91 
rg±r
=0;

92 
sourû±r
=0;

93 
»m
 = 
»mašd”
;

95 ià(
my¶ªe
 =ğ
COLORTYPE_COLOR
 || my¶ª=ğ
COLORTYPE_BOTH
)

97 ià(
¿¡”_š
->
¿¡”d©a
[
COLORTYPE_COLOR
])

99 ià(
v
)

101 
width
 = 
iIÅutWidth
*3;

102 
i
=0; i < 
width
; i += 3)

104 
çùÜ
 = 
içùÜ
;

105 ià(
»m
 >= 1000)

107 
çùÜ
++;

108 
»m
 -= 1000;

110 
j
=0; j < 
çùÜ
; j++)

112 
pOuutBufãr
[
COLORTYPE_COLOR
][
rg±r
++] = 
¿¡”_š
->
¿¡”d©a
[COLORTYPE_COLOR][
i
];

113 
pOuutBufãr
[
COLORTYPE_COLOR
][
rg±r
++] = 
¿¡”_š
->
¿¡”d©a
[COLORTYPE_COLOR][
i
+1];

114 
pOuutBufãr
[
COLORTYPE_COLOR
][
rg±r
++] = 
¿¡”_š
->
¿¡”d©a
[COLORTYPE_COLOR][
i
+2];

116 
»m
 +ğ
»mašd”
;

121 
i
=0; i < 
NumInks
; i++)

123 
¶ªecouÁ
=0;

124 
¤c
=0;

125 (
¶ªecouÁ
 < 
iOuutWidth
-1è&& (
¤c
 < 
iIÅutWidth
))

127 
çùÜ
 = 
içùÜ
;

128 ià(
»m
 >= 1000)

130 
çùÜ
++;

131 
»m
 -= 1000;

133 
j
=0; (j < 
çùÜ
è&& (
¶ªecouÁ
 < 
iOuutWidth
-1); j++)

135 
pOuutBufãr
[
COLORTYPE_COLOR
][
rg±r
++] = 
¿¡”_š
->
¿¡”d©a
[COLORTYPE_COLOR][
sourû±r
];

136 
¶ªecouÁ
++;

138 
»m
 +ğ
»mašd”
;

139 
sourû±r
++; 
¤c
++;

141 
¶ªecouÁ
 < 
iOuutWidth
-1)

143 
pOuutBufãr
[
COLORTYPE_COLOR
][
rg±r
++] = 
¿¡”_š
->
¿¡”d©a
[COLORTYPE_COLOR][
sourû±r
-1];

144 
¶ªecouÁ
++;

151 
içùÜ
 = (è(è
SÿËFaùÜ
;

152 
rg±r
=0;

153 
sourû±r
=0;

154 
»m
 = 
»mašd”
;

156 ià(
my¶ªe
 =ğ
COLORTYPE_BLACK
 || my¶ª=ğ
COLORTYPE_BOTH
)

158 ià(
¿¡”_š
->
¿¡”d©a
[
COLORTYPE_BLACK
])

162 
¶ªecouÁ
=0;

163 
¤c
=0;

164 (
¶ªecouÁ
 < 
iOuutWidth
-1è&& (
¤c
 < 
iIÅutWidth
))

166 
çùÜ
 = 
içùÜ
;

167 ià(
»m
 >= 1000)

169 
çùÜ
++;

170 
»m
 -= 1000;

172 
j
=0; (j < 
çùÜ
è&& (
¶ªecouÁ
 < 
iOuutWidth
-1); j++)

174 
pOuutBufãr
[
COLORTYPE_BLACK
][
rg±r
++] = 
¿¡”_š
->
¿¡”d©a
[COLORTYPE_BLACK][
sourû±r
];

175 
¶ªecouÁ
++;

177 
»m
 +ğ
»mašd”
;

178 
sourû±r
++; 
¤c
++;

180 
¶ªecouÁ
 < 
iOuutWidth
-1)

182 
pOuutBufãr
[
COLORTYPE_BLACK
][
rg±r
++] = 
¿¡”_š
->
¿¡”d©a
[COLORTYPE_BLACK][
sourû±r
-1];

183 
¶ªecouÁ
++;

188 
çùÜ
 = 
içùÜ
;

189 ià(
row»mašd”
 >= 1000)

191 
çùÜ
++;

192 
row»mašd”
 -= 1000;

194 ià(
my¶ªe
 =ğ
COLORTYPE_BLACK
 && 
¿¡”_š
->
¿¡”d©a
[
COLORTYPE_COLOR
])

195 
iRa¡”sR—dy
 = 1;

197 
iRa¡”sR—dy
=
çùÜ
;

198 
iRa¡”sD–iv”ed
=0;

199 
row»mašd”
 +ğ
»mašd”
;

200  
TRUE
;

201 
	}
}

204 
BYTE
* 
	gSÿËr_O³n
::
	$NextOuutRa¡”
(
COLORTYPE
 
cŞÜ
)

206 ià(
iRa¡”sR—dy
==0)

207  
NULL
;

209 ià(
my¶ªe
 =ğ
COLORTYPE_BLACK
)

211 ià(
¿¡”
.
¿¡”d©a
[
my¶ªe
] =ğ
NULL
)

212 
iRa¡”sR—dy
 = 1;

214 ià(
cŞÜ
 =ğ
COLORTYPE_COLOR
)

216 
iRa¡”sR—dy
--; 
iRa¡”sD–iv”ed
++;

218 ià(
¿¡”
.
¿¡”size
[
cŞÜ
] > 0)

220  
pOuutBufãr
[
cŞÜ
];

224  
NULL
;

226 
	}
}

228 
	gAPDK_END_NAMESPACE


	@prnt/hpijs/scaler_open.h

32 #iâdeà
APDK_SCALER_OPEN_H


33 
	#APDK_SCALER_OPEN_H


	)

35 
APDK_BEGIN_NAMESPACE


40 şas 
	cSÿËr_O³n
 : 
public
 
SÿËr


42 
public
:

43 
SÿËr_O³n
(
Sy¡emS”viûs
* 
pSys
,
šputwidth
,

44 
num”©Ü
,
d’omš©Ü
,

45 
BOOL
 
bVIP
, 
iNumInks
);

46 ~
SÿËr_O³n
();

48 
BYTE
* 
NextOuutRa¡”
(
COLORTYPE
 
cŞÜ
);

50 
	m´Ùeùed
:

51 
BOOL
 
Proûss
(
RASTERDATA
* 
IÅutRa¡”
=
NULL
);

52 
	mrow»mašd”
;

53 
	mNumInks
;

54 
BOOL
 
	mv
;

58 
	gAPDK_END_NAMESPACE


	@prnt/hpijs/scaler_prop.h

32 #iâdeà
APDK_SCALER_PROP_H


33 
	#APDK_SCALER_PROP_H


	)

35 
APDK_BEGIN_NAMESPACE


37 şas 
	cSÿËr_Prİ
 : 
public
 
SÿËr


39 
public
:

40 
SÿËr_Prİ
(
Sy¡emS”viûs
* 
pSys
,
šputwidth
,

41 
num”©Ü
,
d’omš©Ü
);

42 ~
SÿËr_Prİ
();

43 
BOOL
 
Proûss
(
RASTERDATA
* 
IÅutRa¡”
=
NULL
);

44 
BYTE
* 
NextOuutRa¡”
(
COLORTYPE
 
cŞÜ
);

45 
	m´Ùeùed
:

46 
RESSYNSTRUCT
* 
pRS¡ruù
;

47 
Pix–_R•liÿ‹F
(
cŞÜ
, 
h_off£t
, 
v_off£t
,

48 **
out_¿¡”
, 
¶ªe
);

49 
Pix–MuÉly
(* 
bufãr
, 
width
, 
çùÜ
);

51 
»z_syÁh
(
RESSYNSTRUCT
 *
ResSynSŒuù
, *
¿¡”_out
);

52 
In™IÁ”Çls
();

54 
ResSyn
(cÚ¡ *
¿¡”_š
);

55 
ü—‹_out
(
BOOL
 
sim¶e
);

56 
	mæag
;

59 
	gAPDK_END_NAMESPACE


	@prnt/hpijs/script.cpp

31 #ià
defšed
(
APDK_CAPTURE
)

33 
	~"h—d”.h
"

34 
	~"süt.h
"

36 
APDK_BEGIN_NAMESPACE


38 * 
V”siÚ
(
bCom´es£d
);

40 
	gSü‹r
::
	$Sü‹r
(
Sy¡emS”viûs
* 
pSS
):

41 
	`pSys
(
pSS
),

42 
	`Glob®Bufãr
(
NULL
),

43 
	$buffsize
(0)

44 { 
	}
}

47 
	gSü‹r
::~
	$Sü‹r
()

48 { 
	}
}

51 
AsciiSü‹r
::
	$AsciiSü‹r
(
Sy¡emS”viûs
* 
pSS
)

52 : 
	$Sü‹r
(
pSS
)

53 { 
	}
}

56 
AsciiSü‹r
::~
	$AsciiSü‹r
()

57 { 
	}
}

60 
Bš¬ySü‹r
::
	$Bš¬ySü‹r
(
Sy¡emS”viûs
* 
pSS
)

61 : 
	$AsciiSü‹r
(
pSS
)

62 { 
	}
}

65 
Bš¬ySü‹r
::~
	$Bš¬ySü‹r
()

66 { 
	}
}

69 
DRIVER_ERROR
 
Sy¡emS”viûs
::
	$In™Süt
(cÚ¡ * 
FeName
, 
BOOL
 
ascii
, BOOL 
»ad
)

71 ià(
ascii
)

72 
pSü‹r
 = 
Ãw
 
	`AsciiSü‹r
(
this
);

73 
pSü‹r
 = 
Ãw
 
	`Bš¬ySü‹r
(
this
);

75 ià(
»ad
)

77 
»¶ay
=
TRUE
;

78 ià(
pSü‹r
->
	`O³nDebugSŒ—mR
(
FeName
))

79  
SYSTEM_ERROR
;

80  
NO_ERROR
;

84 
»¶ay
=
FALSE
;

85 ià(
pSü‹r
->
	`O³nDebugSŒ—mW
(
FeName
))

86  
SYSTEM_ERROR
;

87  
NO_ERROR
;

90 
	}
}

92 
DRIVER_ERROR
 
	gSy¡emS”viûs
::
	$EndSüt
()

94 ià(
pSü‹r
==
NULL
)

95  
SYSTEM_ERROR
;

97 ià(
»¶ay
)

99 ià(
pSü‹r
->
	`Clo£DebugSŒ—mR
())

100  
SYSTEM_ERROR
;

101  
NO_ERROR
;

105 ià(
pSü‹r
->
	`Clo£DebugSŒ—mW
())

106  
SYSTEM_ERROR
;

107  
NO_ERROR
;

110 
d–‘e
 
pSü‹r
;

111 
	}
}

114 
BOOL
 
	gSü‹r
::
	$P¬£V”
(* 
¡r
)

120 
c
;

121 
v”
[5];

122 
i
=0;

123 
c
=
¡r
[
i
];

124 (
c
!='!'è&& (c!=
EOF
))

125 
c
=
¡r
[++
i
];

126 ià(
c
!='!')

127  
TRUE
;

128 (
c
!=' 'è&& (c!=
EOF
))

129 
c
=
¡r
[++
i
];

130 ià(
c
!=' ')

131  
TRUE
;

133 
j
=0; j<4; j++)

134 
v”
[
j
]=
¡r
[++
i
];

135 
v”
[4]='\0';

137 ià(!
	`¡rcmp
(
v”
,"open"))

139 ià(!
	`¡rcmp
(
v”
,"prop"))

144 ià(!
	`¡rcmp
(
v”
,"openscale"))

146 ià(!
	`¡rcmp
(
v”
,"propscale"))

148  
TRUE
;

149 ià(!
	`¡rcmp
(
v”
,"openimg"))

151 ià(!
	`¡rcmp
(
v”
,"propimg"))

153  
TRUE
;

155  
FALSE
;

156 
	}
}

158 
BOOL
 
	gAsciiSü‹r
::
	$O³nDebugSŒ—mR
(cÚ¡ * 
FeName
)

160 
x
;

161 *
¡r
;

163 
	`¡ºıy
(
SütFeName
,
FeName
, (ScriptFileName)-1);

165 
SütFe
 = 
	`fİ’
(
SütFeName
, "ra");

167 ià(
SütFe
 =ğ
NULL
)

168  
TRUE
;

170 
c
=
	`fg‘c
(
SütFe
);

171 
	`f£ek
(
SütFe
,0, 0);

173 ià(
c
==' ')

175 
x
 = 2000;

178 ià(
	`G‘DebugIÁ
(
x
))

179  
TRUE
;

181 
Tok’CouÁ
=
x
;

182 
R•ÏyTok’CouÁ
=0;

183 
fÚtcouÁ
=0;

185 ià(
	`G‘DebugSŒšg
(
¡r
,
x
))

186  
TRUE
;

188 ià(
	`P¬£V”
(
¡r
))

189  
TRUE
;

191  
FALSE
;

192 
	}
}

195 
BOOL
 
	gAsciiSü‹r
::
	$Clo£DebugSŒ—mR
()

197 ià(
Glob®Bufãr
 !ğ
NULL
)

198 
pSys
->
	`F»eMem
((
BYTE
*)
Glob®Bufãr
,
FALSE
);

200 ià(
SütFe
==
NULL
)

201  
TRUE
;

202  
	`fşo£
(
SütFe
);

203 
	}
}

206 
BOOL
 
	gAsciiSü‹r
::
	$O³nDebugSŒ—mW
(cÚ¡ * 
FeName
)

208 
	`¡ºıy
(
SütFeName
,
FeName
, (ScriptFileName)-1);

209 
SütFe
 = 
	`fİ’
(
SütFeName
, "wa");

211 ià(
SütFe
 =ğ
NULL
)

212  
TRUE
;

214 
pSys
->
C­turšg
=
TRUE
;

215 
Tok’CouÁ
=0;

216 
fÚtcouÁ
=0;

219 
	`¡rıy
(
TokSŒšg
[0],"Job constructor");

220 
	`¡rıy
(
TokSŒšg
[1],"Job destructor");

221 
	`¡rıy
(
TokSŒšg
[2],"NewPage");

222 
	`¡rıy
(
TokSŒšg
[3],"SendRasters");

223 
	`¡rıy
(
TokSŒšg
[4],"TextOut");

224 
	`¡rıy
(
TokSŒšg
[5],"UNUSED1");

225 
	`¡rıy
(
TokSŒšg
[6],"Font destructor");

226 
	`¡rıy
(
TokSŒšg
[7],"PrintContext constructor");

227 
	`¡rıy
(
TokSŒšg
[8],"PrintContext destructor");

228 
	`¡rıy
(
TokSŒšg
[9],"SetPixelsPerRow");

229 
	`¡rıy
(
TokSŒšg
[10],"RealizeFont");

230 
	`¡rıy
(
TokSŒšg
[11],"SelectDevice");

231 
	`¡rıy
(
TokSŒšg
[12],"SelectPrintMode");

232 
	`¡rıy
(
TokSŒšg
[13],"SetPaperSize");

233 
	`¡rıy
(
TokSŒšg
[14],"UseBlackOnly");

234 
	`¡rıy
(
TokSŒšg
[15],"UseColor");

235 
	`¡rıy
(
TokSŒšg
[16],"SetInputResolution");

236 
	`¡rıy
(
TokSŒšg
[17],"UNUSED");

237 
	`¡rıy
(
TokSŒšg
[18],"UNUSED");

238 
	`¡rıy
(
TokSŒšg
[19],"UNUSED");

239 
	`¡rıy
(
TokSŒšg
[20],"String");

240 
	`¡rıy
(
TokSŒšg
[21],"RLE stream");

241 
	`¡rıy
(
TokSŒšg
[22],"RAW stream");

242 
	`¡rıy
(
TokSŒšg
[23],"streamoken");

243 
	`¡rıy
(
TokSŒšg
[24],"NULLoken");

245 
i
=0; i<25; i++)

246 
TokCouÁ
[
i
]=0;

248 
	`årštf
(
SütFe
," ");

250 
v”siÚ
[
TEMPLEN
];

251 
	`¥rštf
(
v”siÚ
, 
	`V”siÚ
(
FALSE
) );

252 
Ën
 = 
	`¡¾’
(
v”siÚ
);

254 ià(
	`PutDebugSŒšg
(
v”siÚ
, 
Ën
))

255  
TRUE
;

258  
FALSE
;

259 
	}
}

261 
BOOL
 
	gAsciiSü‹r
::
	$Clo£DebugSŒ—mW
()

263 ià(
SütFe
==
NULL
)

264  
TRUE
;

266 ià(
Glob®Bufãr
 !ğ
NULL
)

267 
pSys
->
	`F»eMem
((
BYTE
*)
Glob®Bufãr
,
FALSE
);

269 
	`f£ek
(
SütFe
,0, 0);

270 
	`PutDebugIÁ
(
Tok’CouÁ
);

272 
pSys
->
C­turšg
=
FALSE
;

275  
	`fşo£
(
SütFe
);

276 
	}
}

279 
BOOL
 
	gAsciiSü‹r
::
	$PutDebugTok’
(cÚ¡ 
tok’
)

281 
Tok’CouÁ
++;

282 
TokCouÁ
[
tok’
] = TokCount[token]+1;

284 
»s
=
	`årštf
(
SütFe
,"%%%0x ",
tok’
);

285 ià(
»s
<1)

286  
TRUE
;

288 
»s
=
	`årštf
(
SütFe
,"\n%s:%d\n",
TokSŒšg
[
tok’
], 
TokCouÁ
[token]);

290  (
»s
 < 1);

291 
	}
}

294 
BOOL
 
	gAsciiSü‹r
::
	$PutDebugIÁ
(cÚ¡ 
d©a
)

296 
»s
=
	`årštf
(
SütFe
,"%%%0x ",
d©a
);

297  (
»s
 < 1);

298 
	}
}

301 
BOOL
 
	gAsciiSü‹r
::
	$PutDebugBy‹
(cÚ¡ 
BYTE
 
d©a
)

302 {  
	`PutDebugIÁ
(
d©a
); 
	}
}

305 
BOOL
 
	gAsciiSü‹r
::
	$PutDebugSŒšg
(cÚ¡ * 
¡r
,cÚ¡ 
Ën
)

307 ià(
	`PutDebugTok’
(
tokCh¬PŒ
))

308  
TRUE
;

309 ià(
	`PutDebugIÁ
(
Ën
))

310  
TRUE
;

312 
	`åutc
('"',
SütFe
);

313 
i
=0; i < 
Ën
; i++)

314 
	`årštf
(
SütFe
,"%c",
¡r
[
i
]);

315 
	`åutc
('"',
SütFe
);

317  
FALSE
;

318 
	}
}

321 
BOOL
 
	gAsciiSü‹r
::
	$PutDebugSŒ—m
(cÚ¡ 
BYTE
* 
¡r
,cÚ¡ 
Ën
)

325 
tÙ®
=1; 
couÁ
,
i
,
j
; 
BYTE
 
cu¼’t
,
Ãxt
,
Ï¡
;

326 
BOOL
 
¾e
=
TRUE
;

327 
chunk¬¿y
[3];

329 ià((
Ën
==0è|| (
¡r
==
NULL
))

331 
	`PutDebugTok’
(
tokRawSŒ—m
);

332 
	`årštf
(
SütFe
,"%%%0x ", 
Ën
);

333  
FALSE
;

336 
Ãxt
=0;

337 
®loş’
ğ
Ën
*2;

338 ià(
buffsize
 < 
®loş’
)

340 ià(
Glob®Bufãr
!=
NULL
)

341 
pSys
->
	`F»eMem
((
BYTE
*)
Glob®Bufãr
,
FALSE
);

342 
Glob®Bufãr
 = (*)
pSys
->
	`AÎocMem
(
®loş’
,
FALSE
);

343 
buffsize
=
®loş’
;

346 * 
buff
 = 
Glob®Bufãr
;

348 *
thebuff
=
buff
;

349 ià(
buff
==
NULL
)

350  
TRUE
;

351 cÚ¡ 
BYTE
 *
¡¬t¡»am
=
¡r
;

353 
i
=0;i<3;i++)

355 * 
¡¬tbuff
=
buff
;

356 cÚ¡ 
BYTE
* 
¡»am
=
¡¬t¡»am
+
i
;

357 
tÙ®
=1;

358 
cu¼’t
 = *
¡»am
; stream+=3;

359 
tÙ®
<(
Ën
/3))

361 
couÁ
=1;

362 (
tÙ®
<(
Ën
/3)è&& (
cu¼’t
 =ğ(
Ãxt
ğ*
¡»am
)) )

363 { 
couÁ
++; 
tÙ®
++; 
¡»am
+=3; }

364 ià(
tÙ®
<(
Ën
/3))

365 { 
Ãxt
ğ*
¡»am
; sŒ—m+=3; 
tÙ®
++; }

366 
buff
[0]=
couÁ
; buff[1]=
cu¼’t
;

367 
buff
+=2;

368 
Ï¡
=
cu¼’t
;

369 
cu¼’t
=
Ãxt
;

372 ià(
cu¼’t
 !ğ
Ï¡
)

374 
buff
[0]=
couÁ
; buff[1]=
cu¼’t
;

375 
buff
+=2;

378 
chunks
=(
buff
-
¡¬tbuff
)/2;

379 ià(
chunks
>(
Ën
/6))

380 { 
¾e
=
FALSE
; ; }

381 
chunk¬¿y
[
i
]=
chunks
;

384 ià(!
¾e
)

386 
	`PutDebugTok’
(
tokRawSŒ—m
);

387 
	`årštf
(
SütFe
,"%%%0x ", 
Ën
);

388 
i
=0;i<
Ën
;i++)

389 
	`årštf
(
SütFe
,"%%%0x ",
¡¬t¡»am
[
i
]);

393 { 
tÙ®
=0;

394 
	`PutDebugTok’
(
tokRLE¡»am
);

395 
	`årštf
(
SütFe
,"%%%0x ",
Ën
);

396 
i
=0;i<3;i++)

397 { 
couÁ
=
chunk¬¿y
[
i
];

398 
j
=0;j<
couÁ
;j++)

399 
	`årštf
(
SütFe
,"%%%0x %%%0x ",
thebuff
[
tÙ®
+2*
j
],thebuff[total+2*j+1]);

400 
tÙ®
 +ğ
couÁ
*2;

404  
FALSE
;

405 
	}
}

409 
BOOL
 
	gAsciiSü‹r
::
	$FšdP”ûÁ
()

413 
c
;

414 
c
=
	`fg‘c
(
SütFe
);

415 (
c
!='%'è&& (c!=
EOF
))

417 
c
=
	`fg‘c
(
SütFe
);

419  (
c
==
EOF
);

420 
	}
}

423 * 
	gAsciiSü‹r
::
	$dig™s
()

426 
c
;

427 *
¡r
=
sÿÂ”
;

428 
BOOL
 
dÚe
=
FALSE
;

430 !
dÚe
)

432 
c
=
	`fg‘c
(
SütFe
);

433 ià(((
c
>='0')&&(c<='9')) ||

434 ((
c
>='a')&&(c<='f')) ||

435 ((
c
>='A')&&(c<='F'))

437 *
¡r
++ = 
c
;

438 ià(
c
==' ')

439 { 
dÚe
=
TRUE
; *
¡r
++=
c
; }

440 ià((
c
!=10)&&(c!=13))

441 { 
sÿÂ”
[0]=0; 
dÚe
=
TRUE
; }

443 *
¡r
=0;

444  
sÿÂ”
;

445 
	}
}

449 
	gAsciiSü‹r
::
	$R—dRLE
(
š¡»amËn
, 
BYTE
* 
out¡»am
)

452 
couÁ
,
tÙ®
,
i
,
j
;

453 
BYTE
 
b
;

454 
bi
;

455 
BYTE
* 
buff
=(BYTE*)
pSys
->
	`AÎocMem
(
š¡»amËn
*2,
FALSE
);

456 
cŞÜsize
=
š¡»amËn
/3;

460 
i
=0;i<3;i++)

461 { 
tÙ®
=0;

462 
tÙ®
<
cŞÜsize
)

465 ià(
	`FšdP”ûÁ
())

467 
	`ssÿnf
(
	`dig™s
(),"%x ",&
couÁ
);

468 ià(
	`FšdP”ûÁ
())

470 
	`ssÿnf
(
	`dig™s
(),"%x ",&
bi
);

471 
b
ğ(
BYTE
)
bi
;

472 
j
=0;j<
couÁ
;j++)

473 
buff
[ 
tÙ®
 + (
i
*
cŞÜsize
è+ 
j
 ] = 
b
;

474 
tÙ®
+=
couÁ
;

480 
i
=0;i<(
š¡»amËn
/3);i++)

482 *
out¡»am
++ = 
buff
[
i
];

483 *
out¡»am
++ = 
buff
[
i
+
cŞÜsize
];

484 *
out¡»am
++ = 
buff
[
i
+(2*
cŞÜsize
)];

486 
pSys
->
	`F»eMem
(
buff
,
FALSE
);

487 
	}
}

490 
	gAsciiSü‹r
::
	$R—dRaw
(
š¡»amËn
, 
BYTE
* 
out¡»am
)

492 
BYTE
 
b
; 
bi
;

493 
i
=0;i<
š¡»amËn
;i++)

494 { ià(
	`FšdP”ûÁ
())

496 
	`ssÿnf
(
	`dig™s
(),"%x ",&
bi
);

497 
b
=(
BYTE
)
bi
;

498 *
out¡»am
++ = 
b
; }

499 
	}
}

503 
BOOL
 
	gAsciiSü‹r
::
	$G‘DebugTok’
(& 
tok’
)

505 
c
;

507 ià(
	`G‘DebugIÁ
(
tok’
))

508  
TRUE
;

509 ià((
tok’
<0)||Ñok’>
LAST_TOKEN
))

510  
TRUE
;

513 
c
=
	`fg‘c
(
SütFe
);

514 ià(
c
!=10)

515  
TRUE
;

517  (
c
=
	`fg‘c
(
SütFe
))!=10) ;

520 
R•ÏyTok’CouÁ
++;

522  
FALSE
;

523 
	}
}

526 
BOOL
 
	gAsciiSü‹r
::
	$G‘DebugIÁ
(& 
d©a
)

527 { 
»s
,
k
;

529 ià(
	`FšdP”ûÁ
())

530 { 
d©a
=-1;  
TRUE
; }

532 
»s
 = 
	`ssÿnf
(
	`dig™s
(),"%x ",&
k
);

533 ià(!
»s
)

534 
d©a
 = -1;

535 
d©a
=
k
;

536  
FALSE
;

537 
	}
}

540 
BOOL
 
	gAsciiSü‹r
::
	$G‘DebugBy‹
(
BYTE
& 
d©a
)

542 
‹mp
;

543 
BOOL
 
»s
=
	`G‘DebugIÁ
(
‹mp
);

544 ià(
»s
)

545  
TRUE
;

546 
d©a
=
‹mp
;

547  
FALSE
;

548 
	}
}

551 
BOOL
 
	gAsciiSü‹r
::
	$G‘DebugSŒšg
(*& 
¡r
,& 
Ëngth
)

553 
»s
,
Ën
,
i
;

554 
¡r
=
NULL
;

556 
i
=0; i<
TEMPLEN
; i++)

557 
‹mpSŒ
[
i
]=0;

559 
	`G‘DebugIÁ
(
»s
);

560 ià(
»s
 !ğ
tokCh¬PŒ
)

561  
TRUE
;

562 
	`G‘DebugIÁ
(
Ën
);

564 ià(
Ën
 >ğ
TEMPLEN
)

565  
TRUE
;

567 
c
=
	`fg‘c
(
SütFe
);

568 ià(
c
!='"')

569  
TRUE
;

570 
i
=0;

571 
‹mpSŒ
[
i
]=
	`fg‘c
(
SütFe
);

572 (
i
<
TEMPLEN
è&& (
‹mpSŒ
[i] != '"'))

573 
‹mpSŒ
[++
i
]=
	`fg‘c
(
SütFe
);

575 ià((
i
==
TEMPLEN
è|| (i!=
Ën
))

576  
TRUE
;

578 
‹mpSŒ
[
i
]=0;

579 
¡r
=
‹mpSŒ
;

580 
Ëngth
=
Ën
;

582  
FALSE
;

583 
	}
}

586 
BOOL
 
	gAsciiSü‹r
::
	$G‘DebugSŒ—m
(cÚ¡ 
bufãrsize
, 
BYTE
*& 
bufãr
)

588 
BYTE
 
tok
;

589 
tok’
;

591 
	`G‘DebugTok’
(
tok’
);

592 ià(
tok’
 =ğ
tokSŒ—m
)

594 
bufãr
 = (
BYTE
*)
pSys
->
	`AÎocMem
(
bufãrsize
,
FALSE
);

595 ià(
bufãr
==
NULL
)

596  
TRUE
;

597 
Ën
;

599 
	`G‘DebugIÁ
(
Ën
);

600 ià(
Ën
==0)

601  
FALSE
;

602 ià((()
Ën
è!ğ
bufãrsize
)

603  
TRUE
;

605 
i
=0; i < 
Ën
; i++)

607 
	`G‘DebugBy‹
(
tok
);

608 
bufãr
[
i
] = 
tok
;

611 ià((
tok’
 =ğ
tokRLE¡»am
è|| (tok’ =ğ
tokRawSŒ—m
))

613 
Ën
;

615 
	`G‘DebugIÁ
(
Ën
);

616 ià(
Ën
==0)

617 
bufãr
=
NULL
;

620 
bufãr
 = (
BYTE
*)
pSys
->
	`AÎocMem
(
Ën
,
FALSE
);

621 ià(
tok’
 =ğ
tokRLE¡»am
)

622 
	`R—dRLE
(
Ën
, 
bufãr
);

623 
	`R—dRaw
(
Ën
, 
bufãr
);

626  
TRUE
;

628  
FALSE
;

629 
	}
}

633 
BOOL
 
	gBš¬ySü‹r
::
	$O³nDebugSŒ—mR
(cÚ¡ * 
FeName
)

635 
	`¡ºıy
(
SütFeName
,
FeName
, (ScriptFileName)-1);

637 
SütFe
 = 
	`fİ’
(
SütFeName
, "rb");

639 ià(
SütFe
 =ğ
NULL
)

640  
TRUE
;

642 
x
;

643 ià(
	`G‘DebugIÁ
(
x
))

644  
TRUE
;

645 
Tok’CouÁ
=
x
;

646 
R•ÏyTok’CouÁ
=0;

647 
fÚtcouÁ
=0;

649 *
v”
;

650 ià(
	`G‘DebugSŒšg
(
v”
,
x
))

651  
TRUE
;

653 ià(
	`P¬£V”
(
v”
))

654  
TRUE
;

656  
FALSE
;

657 
	}
}

660 
BOOL
 
	gBš¬ySü‹r
::
	$O³nDebugSŒ—mW
(cÚ¡ * 
FeName
)

662 
	`¡ºıy
(
SütFeName
,
FeName
, (ScriptFileName)-1);

663 
SütFe
 = 
	`fİ’
(
SütFeName
, "wb");

665 ià(
SütFe
 =ğ
NULL
)

666  
TRUE
;

668 
pSys
->
C­turšg
=
TRUE
;

669 
Tok’CouÁ
=0;

670 
fÚtcouÁ
=0;

672 
	`PutDebugIÁ
(-1);

674 
v”siÚ
[
TEMPLEN
];

675 
	`¥rštf
(
v”siÚ
, 
	`V”siÚ
(
FALSE
) );

676 
Ën
 = 
	`¡¾’
(
v”siÚ
);

678 ià(
	`PutDebugSŒšg
(
v”siÚ
, 
Ën
))

679  
TRUE
;

681  
FALSE
;

682 
	}
}

684 
BOOL
 
	gBš¬ySü‹r
::
	$PutDebugTok’
(cÚ¡ 
tok’
)

686 
Tok’CouÁ
++;

688  
	`PutDebugBy‹
(
tok’
);

689 
	}
}

692 
BOOL
 
	gBš¬ySü‹r
::
	$PutDebugIÁ
(cÚ¡ 
d©a
)

694 
»s
=
	`fwr™e
Ğ&
d©a
, (), 1, 
SütFe
 );

695  (
»s
 =ğ
EOF
);

696 
	}
}

699 
BOOL
 
	gBš¬ySü‹r
::
	$PutDebugBy‹
(cÚ¡ 
BYTE
 
d©a
)

701 
»s
=
	`åutc
Ğ
d©a
, 
SütFe
 );

702  (
»s
 =ğ
EOF
);

703 
	}
}

706 
BOOL
 
	gBš¬ySü‹r
::
	$PutDebugSŒšg
(cÚ¡ * 
¡r
,cÚ¡ 
Ën
)

708 ià(
	`PutDebugTok’
(
tokCh¬PŒ
))

709  
TRUE
;

710 ià(
	`PutDebugIÁ
(
Ën
))

711  
TRUE
;

713 
i
=0; i < 
Ën
; i++)

714 ià((
	`åutc
(
¡r
[
i
],
SütFe
))==
EOF
)

715  
TRUE
;

717  
FALSE
;

718 
	}
}

720 
BOOL
 
	gBš¬ySü‹r
::
	$PutDebugSŒ—m
(cÚ¡ 
BYTE
* 
¡r
,cÚ¡ 
Ën
)

722 ià(
	`PutDebugTok’
(
tokSŒ—m
))

723  
TRUE
;

724 ià(
	`PutDebugIÁ
(
Ën
))

725  
TRUE
;

727 
i
=0; i < 
Ën
; i++)

728 ià((
	`åutc
(
¡r
[
i
],
SütFe
))==
EOF
)

729  
TRUE
;

731  
FALSE
;

732 
	}
}

735 
BOOL
 
	gBš¬ySü‹r
::
	$G‘DebugTok’
(& 
tok’
)

737 
BYTE
 
b
;

738 ià(
	`G‘DebugBy‹
(
b
))

739  
TRUE
;

740 
tok’
=
b
;

741 ià(
tok’
>
LAST_TOKEN
)

742  
TRUE
;

744 
R•ÏyTok’CouÁ
++;

746  
FALSE
;

747 
	}
}

750 
BOOL
 
	gBš¬ySü‹r
::
	$G‘DebugIÁ
(& 
d©a
)

752 
‹mp
;

753 
»s
 = 
	`ä—d
(&
‹mp
, (), 1, 
SütFe
);

754 
d©a
=
‹mp
;

755  (
»s
<1);

756 
	}
}

759 
BOOL
 
	gBš¬ySü‹r
::
	$G‘DebugBy‹
(
BYTE
& 
d©a
)

761 
d©a
=
	`fg‘c
(
SütFe
);

762  
FALSE
;

763 
	}
}

766 
BOOL
 
	gBš¬ySü‹r
::
	$G‘DebugSŒšg
(*& 
¡r
,& 
Ëngth
)

768 
»s
,
Ën
,
i
;

769 
¡r
=
NULL
;

771 
i
=0; i<
TEMPLEN
; i++)

772 
‹mpSŒ
[
i
]=0;

774 
	`G‘DebugTok’
(
»s
);

775 ià(
»s
 !ğ
tokCh¬PŒ
)

776  
TRUE
;

777 
	`G‘DebugIÁ
(
Ën
);

779 ià(
Ën
 >ğ
TEMPLEN
)

780  
TRUE
;

782 
i
=0; i<
Ën
; i++)

783 ià((
‹mpSŒ
[
i
]=
	`fg‘c
(
SütFe
))==
EOF
)

784  
TRUE
;

786 
‹mpSŒ
[
i
]=0;

787 
¡r
=
‹mpSŒ
;

788 
Ëngth
=
Ën
;

790  
FALSE
;

791 
	}
}

794 
BOOL
 
	gBš¬ySü‹r
::
	$G‘DebugSŒ—m
(cÚ¡ 
bufãrsize
, 
BYTE
*& 
bufãr
)

796 
tok’
;

797 
BYTE
 
tok
;

799 
	`G‘DebugTok’
(
tok’
);

800 ià(
tok’
 !ğ
tokSŒ—m
)

801  
TRUE
;

803 
bufãr
 = (
BYTE
*)
pSys
->
	`AÎocMem
(
bufãrsize
,
FALSE
);

804 ià(
bufãr
==
NULL
)

805  
TRUE
;

806 
Ën
;

808 
	`G‘DebugIÁ
(
Ën
);

809 ià(
Ën
==0)

811 
pSys
->
	`F»eMem
(
bufãr
,
FALSE
);

812 
bufãr
=
NULL
;

813  
FALSE
;

815 ià((()
Ën
è!ğ
bufãrsize
)

816  
TRUE
;

818 
i
=0; i < 
Ën
; i++)

820 
	`G‘DebugBy‹
(
tok
);

821 
bufãr
[
i
] = 
tok
;

824  
FALSE
;

825 
	}
}

827 
	gAPDK_END_NAMESPACE


	@prnt/hpijs/script.h

32 
APDK_BEGIN_NAMESPACE


34 şas 
	cSü‹r


36 
	mpublic
:

37 
Sü‹r
(
Sy¡emS”viûs
* 
pSS
);

38 
	mvœtu®
 ~
Sü‹r
();

40 
	mTok’CouÁ
;

41 
	mR•ÏyTok’CouÁ
;

43 
FILE
* 
	mSütFe
;

44 
	mSütFeName
[200];

45 
	mfÚtcouÁ
;

47 
Sy¡emS”viûs
* 
	mpSys
;

48 * 
	mGlob®Bufãr
;

49 
	mbuffsize
;

52 
vœtu®
 
BOOL
 
O³nDebugSŒ—mR
(cÚ¡ * 
f’ame
)=0;

53 
vœtu®
 
BOOL
 
Clo£DebugSŒ—mR
()=0;

54 
vœtu®
 
BOOL
 
O³nDebugSŒ—mW
(cÚ¡ * 
f’ame
)=0;

55 
vœtu®
 
BOOL
 
Clo£DebugSŒ—mW
()=0;

56 
vœtu®
 
BOOL
 
PutDebugTok’
(cÚ¡ 
tok’
)=0;

57 
vœtu®
 
BOOL
 
PutDebugIÁ
(cÚ¡ 
d©a
)=0;

58 
vœtu®
 
BOOL
 
PutDebugBy‹
(cÚ¡ 
BYTE
 
d©a
)=0;

59 
vœtu®
 
BOOL
 
PutDebugSŒ—m
(cÚ¡ 
BYTE
* 
¡»am
,cÚ¡ 
Ën
)=0;

60 
vœtu®
 
BOOL
 
PutDebugSŒšg
(cÚ¡ * 
¡r
,cÚ¡ 
Ën
)=0;

61 
vœtu®
 
BOOL
 
G‘DebugTok’
(& 
tok’
)=0;

62 
vœtu®
 
BOOL
 
G‘DebugIÁ
(& 
d©a
)=0;

63 
vœtu®
 
BOOL
 
G‘DebugSŒšg
(*& 
¡r
,& 
Ën
)=0;

64 
vœtu®
 
BOOL
 
G‘DebugSŒ—m
(cÚ¡ 
bufãrsize
, 
BYTE
*& 
bufãr
)=0;

65 
vœtu®
 
BOOL
 
G‘DebugBy‹
(
BYTE
& 
d©a
)=0;

67 
BOOL
 
P¬£V”
(* 
¡r
);

70 şas 
	cAsciiSü‹r
 : 
public
 
Sü‹r


72 
public
:

73 
AsciiSü‹r
(
Sy¡emS”viûs
* 
pSS
);

74 ~
AsciiSü‹r
();

76 
vœtu®
 
BOOL
 
O³nDebugSŒ—mR
(cÚ¡ * 
f’ame
);

77 
vœtu®
 
BOOL
 
Clo£DebugSŒ—mR
();

78 
vœtu®
 
BOOL
 
O³nDebugSŒ—mW
(cÚ¡ * 
f’ame
);

79 
vœtu®
 
BOOL
 
Clo£DebugSŒ—mW
();

80 
vœtu®
 
BOOL
 
PutDebugTok’
(cÚ¡ 
tok’
);

81 
vœtu®
 
BOOL
 
PutDebugIÁ
(cÚ¡ 
d©a
);

82 
vœtu®
 
BOOL
 
PutDebugBy‹
(cÚ¡ 
BYTE
 
d©a
);

83 
vœtu®
 
BOOL
 
PutDebugSŒšg
(cÚ¡ * 
¡r
,cÚ¡ 
Ën
);

84 
vœtu®
 
BOOL
 
PutDebugSŒ—m
(cÚ¡ 
BYTE
* 
¡»am
,cÚ¡ 
Ën
);

85 
vœtu®
 
BOOL
 
G‘DebugTok’
(& 
tok’
);

86 
vœtu®
 
BOOL
 
G‘DebugIÁ
(& 
d©a
);

87 
vœtu®
 
BOOL
 
G‘DebugBy‹
(
BYTE
& 
d©a
);

88 
vœtu®
 
BOOL
 
G‘DebugSŒšg
(*& 
¡r
,& 
Ën
);

89 
vœtu®
 
BOOL
 
G‘DebugSŒ—m
(cÚ¡ 
bufãrsize
, 
BYTE
*& 
bufãr
 );

91 
R—dRLE
(
š¡»amËn
, 
BYTE
* 
out¡»am
);

92 
R—dRaw
(
š¡»amËn
, 
BYTE
* 
out¡»am
);

94 
BOOL
 
FšdP”ûÁ
();

95 * 
dig™s
();

96 
	msÿÂ”
[30];

97 
	#TEMPLEN
 600

	)

98 
	m‹mpSŒ
[
TEMPLEN
];

100 
	mTokSŒšg
[25][40];

101 
	mTokCouÁ
[25];

105 şas 
	cBš¬ySü‹r
 : 
public
 
AsciiSü‹r


107 
public
:

108 
Bš¬ySü‹r
(
Sy¡emS”viûs
* 
pSS
);

109 ~
Bš¬ySü‹r
();

111 
BOOL
 
O³nDebugSŒ—mR
(cÚ¡ * 
f’ame
);

112 
BOOL
 
O³nDebugSŒ—mW
(cÚ¡ * 
f’ame
);

113 
BOOL
 
PutDebugTok’
(cÚ¡ 
tok’
);

114 
BOOL
 
PutDebugIÁ
(cÚ¡ 
d©a
);

115 
BOOL
 
PutDebugBy‹
(cÚ¡ 
BYTE
 
d©a
);

116 
BOOL
 
PutDebugSŒšg
(cÚ¡ * 
¡r
,cÚ¡ 
Ën
);

117 
BOOL
 
PutDebugSŒ—m
(cÚ¡ 
BYTE
* 
¡»am
,cÚ¡ 
Ën
);

118 
BOOL
 
G‘DebugTok’
(& 
tok’
);

119 
BOOL
 
G‘DebugIÁ
(& 
d©a
);

120 
BOOL
 
G‘DebugSŒšg
(*& 
¡r
,& 
Ën
);

121 
BOOL
 
G‘DebugSŒ—m
(cÚ¡ 
bufãrsize
, 
BYTE
*& 
bufãr
 );

122 
BOOL
 
G‘DebugBy‹
(
BYTE
& 
d©a
);

126 
	gAPDK_END_NAMESPACE


	@prnt/hpijs/services.cpp

32 
	~<sys/¡©.h
>

33 
	~<¡dio.h
>

34 
	~<¡dlib.h
>

35 
	~<¡d¬g.h
>

36 
	~<sy¦og.h
>

37 
	~<¡ršg.h
>

38 
	~<uni¡d.h
>

39 
	~<fú.h
>

40 
	~"h—d”.h
"

41 
	~"ijs.h
"

42 
	~"ijs_£rv”.h
"

43 
	~"hpijs.h
"

44 
	~"£rviûs.h
"

46 #ià
defšed
(
HAVE_LIBHPIP
è&& defšed(
HAVE_DBUS
)

47 
	~<dbus/dbus.h
>

48 
	#DBUS_INTERFACE
 "com.h¶.StusS”viû"

	)

49 
	#DBUS_PATH
 "/"

	)

50 
DBusE¼Ü
 
	gdbus_”r
;

51 
DBusCÚÃùiÚ
 *
	gdbus_cÚn
;

52 
In™Dbus
 ();

53 
S’dDbusMes§ge
 (cÚ¡ *
dev
, cÚ¡ *
´š‹r
, 
code
,

54 cÚ¡ *
u£ºame
, cÚ¡ 
jobid
, cÚ¡ *
t™Ë
);

56 
	$S’dDbusMes§ge
 (cÚ¡ *
dev
, cÚ¡ *
´š‹r
, 
code
,

57 cÚ¡ *
u£ºame
, cÚ¡ 
jobid
, cÚ¡ *
t™Ë
)

59 
	}
}

62 
	gUXS”viûs
::
	$In™Du¶exBufãr
()

65 ià(
Ra¡”sOnPage
)

66 
d–‘e
 [] 
Ra¡”sOnPage
;

67 ià(
KRa¡”sOnPage
)

68 
d–‘e
 [] 
KRa¡”sOnPage
;

71 
Cu¼’tRa¡”
 = 
ph
.
height
 - 1;

72 
Ra¡”sOnPage
 = (
BYTE
 **è
Ãw
 BYTE[(
ph
.
height
) *  (BYTE *)];

73 
KRa¡”sOnPage
 = (
BYTE
 **è
Ãw
 BYTE[(
ph
.
height
) *  (BYTE *)];

74 
i
 = 0; i < 
ph
.
height
; i++)

76 
Ra¡”sOnPage
[
i
] = 
NULL
;

77 
KRa¡”sOnPage
[
i
] = 
NULL
;

80 
	}
}

82 
	gUXS”viûs
::
	$S’dBackPage
()

84 
DRIVER_ERROR
 
”r
;

85 
i
 = 
Cu¼’tRa¡”
+1;

87 
i
 < 
ph
.
height
)

89 ià(
KRGB
)

91 ià((
”r
 = 
pJob
->
	`S’dRa¡”s
(
KRa¡”sOnPage
[
i
], 
Ra¡”sOnPage
[i])è!ğ
NO_ERROR
)

92  
”r
;

96 ià((
”r
 = 
pJob
->
	`S’dRa¡”s
(
Ra¡”sOnPage
[
i
])è!ğ
NO_ERROR
)

97  
”r
;

100 ià(
Ra¡”sOnPage
[
i
])

101 
d–‘e
 [] 
Ra¡”sOnPage
[
i
];

102 ià(
KRa¡”sOnPage
[
i
])

103 
d–‘e
 [] 
KRa¡”sOnPage
[
i
];

104 
i
++;

107 
Cu¼’tRa¡”
 = 
ph
.
height
 - 1;

110 
	}
}

112 
	gxmask
[] =

124 
	gUXS”viûs
::
	$ProûssRa¡”
(*
¿¡”
, *
k_¿¡”
)

126 ià(!((
pPC
->
	`Qu”yDu¶exMode
(è=ğ
DUPLEXMODE_BOOK
è&&…PC->
	`RÙ©eImageFÜBackPage
(è&& 
BackPage
))

128 ià(
KRGB
)

129  
pJob
->
	`S’dRa¡”s
((*)
k_¿¡”
, (*)
¿¡”
);

131  
pJob
->
	`S’dRa¡”s
((*)
¿¡”
);

135 ià(
Cu¼’tRa¡”
 < 0)

138 
BYTE
 *
Ãw_¿¡”
;

139 
Ãw_¿¡”_size
;

140 
i
,
w
;

142 ià(
¿¡”
 =ğ
NULL
)

144 
Ra¡”sOnPage
[
Cu¼’tRa¡”
] = 
NULL
;

148 
Ãw_¿¡”_size
 = 
pPC
->
	`IÅutPix–sP”Row
() * 3;

149 
Ãw_¿¡”
 = 
Ãw
 
BYTE
[
Ãw_¿¡”_size
];

150 ià(
Ãw_¿¡”
 == 0)

152 
	`BUG
("uÇbËØü—‹ du¶ex bufãr, size=%d: %m\n", 
Ãw_¿¡”_size
);

155 
	`mem£t
(
Ãw_¿¡”
, 0xFF, 
Ãw_¿¡”_size
);

156 
Ra¡”sOnPage
[
Cu¼’tRa¡”
] = 
Ãw_¿¡”
;

157 
BYTE
 *
p
 = 
Ãw_¿¡”
 + 
Ãw_¿¡”_size
 - 3;

158 
i
 = 0; i < 
Ãw_¿¡”_size
; i += 3)

160 
	`memıy
 (
p
, 
¿¡”
+
i
, 3);

161 
p
 -= 3;

165 ià(
k_¿¡”
 =ğ
NULL
)

167 
KRa¡”sOnPage
[
Cu¼’tRa¡”
] = 
NULL
;

171 
Ãw_¿¡”_size
 = (
pPC
->
	`IÅutPix–sP”Row
() + 7) >> 3;

172 
Ãw_¿¡”
 = 
Ãw
 
BYTE
[
Ãw_¿¡”_size
];

173 ià(
Ãw_¿¡”
 == 0)

175 
	`BUG
("uÇbËØü—‹ bÏck du¶ex bufãr, size=%d: %m\n", 
Ãw_¿¡”_size
);

178 
	`mem£t
(
Ãw_¿¡”
, 0, 
Ãw_¿¡”_size
);

179 
KRa¡”sOnPage
[
Cu¼’tRa¡”
] = 
Ãw_¿¡”
;

180 
w
 = 
pPC
->
	`IÅutPix–sP”Row
();

181 
i
=0; i<
w
; i++)

183 ià(
k_¿¡”
[
i
>>3] & 
xmask
[i&7])

184 
Ãw_¿¡”
[(
w
-
i
)>>3] |ğ
xmask
[(w-i)&7];

186 
k
 = ((
w
 + 7) / 8) * 8 - w;

187 
BYTE
 
c
 = 0xfà<< 
k
;

188 ià(
k
 != 0)

189 
Ãw_¿¡”
[0] = 
c
 & 
k_¿¡”
[
Ãw_¿¡”_size
-1];

192 
Cu¼’tRa¡”
--;

196 
	}
}

199 #ifdeà
HAVE_LIBHPIP


207 
BOOL
 
	gUXS”viûs
::
	$CªDoBiDi
 ()

209 *
hpDev
;

210 
hpmud_mod–_©Œibu‹s
 
ma
;

211 
¡rDevID
[512];

215 ià((
hpDev
 = 
	`g‘’v
 ("DEVICE_URI")è=ğ
NULL
)

217  
FALSE
;

222 ià(
	`¡ºcmp
 (
hpDev
, "hp:", 3))

224  
FALSE
;

229 
	`hpmud_qu”y_mod–
(
hpDev
, &
ma
);

231 ià(
ma
.
´t_mode
 =ğ
HPMUD_UNI_MODE
)

233  
FALSE
;

235 ià(
	`hpmud_İ’_deviû
(
hpDev
, 
ma
.
´t_mode
, &
hpFD
è!ğ
HPMUD_R_OK
)

237  
FALSE
;

239 
	`mem£t
 (
¡rDevID
, 0, 512);

240 ià((
	`R—dDeviûID
 ((
BYTE
 *è
¡rDevID
, 512)è!ğ
NO_ERROR
)

242  
FALSE
;

246 ià(
	`¡r¡r
 (
¡rDevID
, "Laser") || strstr (strDevID, "laser"))

248  
TRUE
;

252 ià(!(
	`¡r¡r
 (
¡rDevID
, ";S:")) && !(strstr (strDevID, "VSTATUS")))

254  
FALSE
;

256  
TRUE
;

257 
	}
}

261 
BOOL
 
	gUXS”viûs
::
	$CªDoBiDi
 ()

263  
FALSE
;

264 
	}
}

268 
	gUXS”viûs
::
	$UXS”viûs
():
	$Sy¡emS”viûs
()

270 
cÚ¡ruùÜ_”rÜ
 = 
NO_ERROR
;

271 
hpFD
 = -1;

274 
IOMode
.
bDevID
 = IOMode.
bStus
 = 
FALSE
;

279 ià((
hpDev
 = 
	`g‘’v
("DEVICE_URI")è!ğ
NULL
)

281 ià(
	`¡ºcmp
(
hpDev
, "hp:", 3) == 0)

283 
	`h¶_In™
();

284 
	`h¶_Mod–Qu”y
(
hpDev
, &
ma
);

285 ià(
ma
.
´t_mode
 !ğ
UNI_MODE
)

287 ià((
hpFD
 = 
	`h¶_O³nHP
(
hpDev
, &
ma
)) >= 0)

289 
	`In™DeviûComm
();

291 if(
IOMode
.
bDevID
 =ğ
FALSE
)

292 
	`BUG
("unableo set bi-di for hp backend\n");

299 ià(
	`CªDoBiDi
 ())

301 
	`In™DeviûComm
 ();

302 ià(
IOMode
.
bDevID
 =ğ
FALSE
)

304 
	`BUG
 ("Unableo set bi-di for hp backend\n");

308 
Qu®™y
 = 
QUALITY_NORMAL
;

309 
MedŸTy³
 = 
MEDIA_PLAIN
;

310 
CŞÜMode
 = 
COLOR
;

311 
P’S‘
 = 
DUMMY_PEN
;

313 
Ra¡”sOnPage
 = 0;

314 
KRa¡”sOnPage
 = 0;

315 
pPC
 = 
NULL
;

316 
pJob
 = 
NULL
;

317 
Du¶ex
 = 0;

318 
TumbË
 = 0;

319 
FuÎBËed
 = 0;

320 
Fœ¡Ra¡”
 = 1;

321 
MedŸPos™iÚ
 = 
sourûT¿yAuto
;

322 
Mod–
 = -1;

323 
	`¡rıy
(
ph
.
cs
, "sRGB");

324 
V”tAlign
 = -1;

325 
Di¥ÏyStus
 = 
NODISPLAYSTATUS
;

326 
OuutP©h
 = -1;

327 
outå
 = 
NULL
;

328 
m_iLogLev–
 = 0;

330 
m_pbyPşBufãr
 = 
NULL
;

331 
m_iPşBufãrSize
 = 
BUFFER_CHUNK_SIZE
;

332 
m_iCurPşBufãrPos
 = 0;

333 
m_iPageCouÁ
 = 0;

334 
m_bS³edMechEÇbËd
 = 
FALSE
;

335 
	}
}

337 
	gUXS”viûs
::~
	$UXS”viûs
()

339 ià(
m_bS³edMechEÇbËd
)

341 
	`S’dLa¡Page
 ();

344 ià(
Ra¡”sOnPage
)

345 
d–‘e
 [] 
Ra¡”sOnPage
;

346 ià(
KRa¡”sOnPage
)

347 
d–‘e
 [] 
KRa¡”sOnPage
;

348 #ifdeà
HAVE_LIBHPIP


349 ià(
hpFD
 >= 0)

350 
	`hpmud_şo£_deviû
(
hpFD
);

352 ià(
outå
)

354 
	`fşo£
 (
outå
);

356 
	}
}

358 
DRIVER_ERROR
 
	gUXS”viûs
::
	$ToDeviû
(cÚ¡ 
BYTE
 * 
pBufãr
, 
DWORD
 * 
CouÁ
)

360 ià(
OuutP©h
 == -1)

362  
IO_ERROR
;

365 ià(
m_bS³edMechEÇbËd
)

367 ià((
	`CİyD©a
 (
pBufãr
, *
CouÁ
)) == 0)

369 *
CouÁ
 = 0;

370  
NO_ERROR
;

374 ià(
outå
)

376 
	`fwr™e
 (
pBufãr
, 1, *
CouÁ
, 
outå
);

377 ià(!(
m_iLogLev–
 & 
SEND_TO_PRINTER
))

379 *
CouÁ
 = 0;

380  
NO_ERROR
;

385 ià(
	`wr™e
(
OuutP©h
, 
pBufãr
, *
CouÁ
è!ğ(
ssize_t
)*Count)

387 
út
=0;

388 ià(
út
++ < 5)

389 
	`BUG
("uÇbËØwr™tØouut, fd=%d, couÁ=%d: %m\n", 
OuutP©h
, *
CouÁ
);

390  
IO_ERROR
;

393 *
CouÁ
 = 0;

394  
NO_ERROR
;

395 
	}
}

397 
BOOL
 
	gUXS”viûs
::
	$G‘StusInfo
 (
BYTE
 * 
bStReg
)

399 #ifdeà
HAVE_LIBHPIP


400 
s
;

401 ià(
	`hpmud_g‘_deviû_¡©us
(
hpFD
, &
s
è=ğ
HPMUD_R_OK
)

403 *
bStReg
 = (
BYTE
)
s
;

404  
TRUE
;

407  
FALSE
;

408 
	}
}

410 
DRIVER_ERROR
 
	gUXS”viûs
::
	$R—dDeviûID
 (
BYTE
 * 
¡rID
, 
iSize
)

412 #ifdeà
HAVE_LIBHPIP


413 
Ën
;

414 
	`hpmud_g‘_deviû_id
(
hpFD
, (*)
¡rID
, 
iSize
, &
Ën
);

415 ià(
Ën
 < 3)

416  
IO_ERROR
;

418  
NO_ERROR
;

419 
	}
}

421 #ifdeà
HP_PRINTVIEW


422 cÚ¡ *
	gszPJLH—d”
 = "@PJL SET JOBATTR=\"JobAcct7=HPPrintView.exe\"\012";

423 
	gUXS”viûs
::
	$G‘PJLH—d”Bufãr
 (**
szPJLBufãr
)

425 *
szPJLBufãr
 = (*è
szPJLH—d”
;

426  
	`¡¾’
 (
szPJLH—d”
);

427 
	}
}

430 
BOOL
 
	gUXS”viûs
::
	$G‘V”tiÿlAlignm’tV®ue
(
BYTE
* 
cV”tAlignV®
)

432 ià(
V”tAlign
 == -1)

433  
FALSE
;

435 *
cV”tAlignV®
 = (
BYTE
)
V”tAlign
;

436  
TRUE
;

437 
	}
}

439 
BOOL
 
	gUXS”viûs
::
	$G‘V”tAlignFromDeviû
()

441 #ifdeà
HAVE_LIBHPIP


442 ià((
V”tAlign
 = 
	`R—dHPV”tAlign
(
hpFD
)) == -1)

443  
FALSE
;

445  
TRUE
;

446 
	}
}

448 
	gUXS”viûs
::
	$Di¥ÏyPrš‹rStus
 (
DISPLAY_STATUS
 
ePrš‹rStus
)

450 
Di¥ÏyStus
 = 
ePrš‹rStus
;

451 
	}
}

453 
DRIVER_ERROR
 
	gUXS”viûs
::
	$BusyWa™
 (
DWORD
 
m£c
)

455 
Di¥ÏyStus
)

457 
DISPLAY_ERROR_TRAP
:

458 
DISPLAY_COMM_PROBLEM
:

459 
DISPLAY_PRINTER_NOT_SUPPORTED
:

460 
DISPLAY_OUT_OF_PAPER
:

461 
DISPLAY_PHOTOTRAY_MISMATCH
:

462 
DISPLAY_TOP_COVER_OPEN
:

463 
DISPLAY_NO_COLOR_PEN
:

464 
DISPLAY_NO_BLACK_PEN
:

465 
DISPLAY_NO_PENS
:

466 
	`BUG
("WARNING:…rš‹¸bi-d˜”rÜ=%d\n", 
Di¥ÏyStus
);

467 
Di¥ÏyStus
 = 
DISPLAY_PRINTING_CANCELED
;

468  
JOB_CANCELED
;

472  
NO_ERROR
;

473 
	}
}

475 cÚ¡ * 
	gUXS”viûs
::
	$G‘Driv”Mes§ge
 (
DRIVER_ERROR
 
”r
)

477 cÚ¡ *
p
=
NULL
;

480 
”r
)

482 (
WARN_MODE_MISMATCH
):

483 
p
 = "printmode mismatch with…en,ray,ƒtc.";

485 (
WARN_LOW_INK_BOTH_PENS
):

486 
p
 = "both…ens have†ow ink";

488 (
WARN_LOW_INK_BLACK
):

489 
p
 = "black…en has†ow ink";

491 (
WARN_LOW_INK_COLOR
):

492 
p
 = "color…en has†ow ink";

494 (
WARN_LOW_INK_PHOTO
):

495 
p
 = "photo…en has†ow ink";

497 (
WARN_LOW_INK_GREY
):

498 
p
 = "grey…en has†ow ink";

500 (
WARN_LOW_INK_BLACK_PHOTO
):

501 
p
 = "black…hoto has†ow ink";

503 (
WARN_LOW_INK_COLOR_PHOTO
):

504 
p
 = "color…hoto…en has†ow ink";

506 (
WARN_LOW_INK_GREY_PHOTO
):

507 
p
 = "grey…hoto…en has†ow ink";

509 (
WARN_LOW_INK_COLOR_GREY
):

510 
p
 = "grey…en has†ow ink";

512 (
WARN_LOW_INK_COLOR_GREY_PHOTO
):

513 
p
 = "color grey…hoto…en has†ow ink";

515 (
WARN_LOW_INK_COLOR_BLACK_PHOTO
):

516 
p
 = "color back…en has†ow ink";

518 (
WARN_LOW_INK_CYAN
):

519 
p
 = "cyan has†ow ink";

521 (
WARN_LOW_INK_MAGENTA
):

522 
p
 = "magenta has†ow ink";

524 (
WARN_LOW_INK_YELLOW
):

525 
p
 = "yellow has†ow ink";

527 (
WARN_LOW_INK_MULTIPLE_PENS
):

528 
p
 = "morehat one ink is†ow";

530 (
WARN_FULL_BLEED_UNSUPPORTED
):

531 
p
 = "fullbleed is‚ot supported";

533 (
WARN_FULL_BLEED_3SIDES
):

534 
p
 = "fullbleed is 3 sides";

536 (
WARN_FULL_BLEED_PHOTOPAPER_ONLY
):

537 
p
 = "fullbleed…hoto…aper only";

539 (
WARN_FULL_BLEED_3SIDES_PHOTOPAPER_ONLY
):

540 
p
 = "fullbleed 3 sides…hoto…aper only";

542 (
WARN_ILLEGAL_PAPERSIZE
):

543 
p
 = "illegal…aper size";

545 (
WARN_INVALID_MEDIA_SOURCE
):

546 
p
 = "invalid media source";

549 
p
 = "driverƒrror";

550 
	`BUG
("driv”ƒ¼Ü=%d\n", 
”r
);

553  
p
;

554 
	}
}

556 
	gUXS”viûs
::
	$M­P­”Size
 (
width
, 
height
)

558 
i
, 
r
, 
size
;

559 
dx
, 
dy
;

562 
size
 = 
CUSTOM_SIZE
;

563 
i
=0; i<
MAX_PAPER_SIZE
; i++)

565 
r
 = 
pPC
->
	`S‘P­”Size
 ((
PAPER_SIZE
)
i
);

567 ià(
r
 !ğ
NO_ERROR
)

570 
dx
 = 
width
 > 
pPC
->
	`PhysiÿlPageSizeX
 () ? width -…PC->PhysicalPageSizeX () :…PC->PhysicalPageSizeX () - width;

571 
dy
 = 
height
 > 
pPC
->
	`PhysiÿlPageSizeY
 () ? height -…PC->PhysicalPageSizeY () :…PC->PhysicalPageSizeY () - height;

573 ià((
dx
 < 0.05è&& (
dy
 < 0.05))

575 
size
 = 
i
;

580 ià(
size
 =ğ
CUSTOM_SIZE
)

581 
pPC
->
	`S‘Cu¡omSize
 (
width
, 
height
);

583 ià((
r
 = 
pPC
->
	`S‘P­”Size
 ((
PAPER_SIZE
)
size
, 
FuÎBËed
)è!ğ
NO_ERROR
)

585 ià(
r
 > 0)

587 
	`BUG
("uÇbËØ£ˆ·³¸size=%d,ƒ¼=%d, width=%0.5g, height=%0.5g\n", 
size
, 
r
, 
width
, 
height
);

591 
	`BUG
("w¬nšg s‘tšg…­” size=%d,ƒ¼=%d, width=%0.5g, height=%0.5g\n", 
size
, 
r
, 
width
, 
height
);

598 
P­”Width
 = 
pPC
->
	`PhysiÿlPageSizeX
 ();

599 
P­”Height
 = 
pPC
->
	`PhysiÿlPageSizeY
 ();

603 
P­”Width
 = 
pPC
->
	`PhysiÿlPageSizeX
 ();

604 
P­”Height
 = 
pPC
->
	`PhysiÿlPageSizeY
 ();

607 
	}
}

609 
	gUXS”viûs
::
	$Re£tIOMode
 (
BOOL
 
bDevID
, BOOL 
bStus
)

611 ià(
pPC
)

613 
IOMode
.
bDevID
 = bDevID;

614 
IOMode
.
bStus
 = bStatus;

615 
pPC
->
	`Re£tIOMode
 (
bDevID
, 
bStus
);

617 
	}
}

619 
	gUXS”viûs
::
	$In™S³edMechBufãr
 ()

621 ià(
m_pbyPşBufãr
)

625 
m_pbyPşBufãr
 = 
Ãw
 
BYTE
[
m_iPşBufãrSize
 + 2];

626 ià(
m_pbyPşBufãr
)

628 
iS’dBufãrSize
 = 0;

630 
	}
}

632 
	gUXS”viûs
::
	$S’dP»viousPage
 ()

634 
DRIVER_ERROR
 
”r
;

635 ià(
m_bS³edMechEÇbËd
 =ğ
FALSE
)

639 
m_iPageCouÁ
++;

640 ià(
m_iPageCouÁ
 == 1)

644 
m_bS³edMechEÇbËd
 = 
FALSE
;

645 
”r
 = 
	`ToDeviû
 (
m_pbyPşBufãr
, (
DWORD
 *è&
m_iCurPşBufãrPos
);

646 ià(
”r
 !ğ
NO_ERROR
)

650 
m_bS³edMechEÇbËd
 = 
TRUE
;

651 
m_iCurPşBufãrPos
 = 0;

655 
pPC
->
	`S‘Prš‹rHšt
 (
SPEED_MECH_HINT
, 0);

657 
	}
}

659 
	gUXS”viûs
::
	$CİyD©a
 (cÚ¡ 
BYTE
 *
pBufãr
, 
DWORD
 
iCouÁ
)

661 ià(
m_iCurPşBufãrPos
 + (è
iCouÁ
 < 
m_iPşBufãrSize
)

663 
	`memıy
 (
m_pbyPşBufãr
 + 
m_iCurPşBufãrPos
, 
pBufãr
, 
iCouÁ
);

664 
m_iCurPşBufãrPos
 +ğ
iCouÁ
;

667 
BYTE
 *
p
 = 
Ãw
 BYTE[
m_iPşBufãrSize
 + 
BUFFER_CHUNK_SIZE
 + 2];

668 ià(
p
 =ğ
NULL
)

670 
m_bS³edMechEÇbËd
 = 
FALSE
;

673 
	`memıy
 (
p
, 
m_pbyPşBufãr
, 
m_iCurPşBufãrPos
);

674 
d–‘e
 [] 
m_pbyPşBufãr
;

675 
m_pbyPşBufãr
 = 
p
;

676 
	`memıy
 (
m_pbyPşBufãr
 + 
m_iCurPşBufãrPos
, 
pBufãr
, 
iCouÁ
);

677 
m_iCurPşBufãrPos
 +ğ
iCouÁ
;

678 
m_iPşBufãrSize
 +ğ
BUFFER_CHUNK_SIZE
;

680 
	}
}

683 cÚ¡ *
	gpbyS³edMechCmd
 = "\x1B*o5W\x0D\x02\x00";

685 
	gUXS”viûs
::
	$S’dLa¡Page
 ()

687 ià(
m_pbyPşBufãr
 =ğ
NULL
)

692 
i
 = 0;

693 
BYTE
 *
p
 = 
m_pbyPşBufãr
;

694 
i
 < 
m_iPşBufãrSize
)

696 ià(*
p
 == '\x1B')

698 ià(!(
	`memcmp
 (
p
, 
pbyS³edMechCmd
, 8)))

700 
p
 += 8;

701 *
p
++ = (
BYTE
è((
m_iPageCouÁ
 & 0xFF00) >> 8);

702 *
p
++ = (
BYTE
è((
m_iPageCouÁ
 & 0x00FF));

703 *(
p
 + 9) = 1;

707 
i
++;

708 
p
++;

710 
m_bS³edMechEÇbËd
 = 
FALSE
;

711 
	`ToDeviû
 (
m_pbyPşBufãr
, (
DWORD
 *è&
m_iCurPşBufãrPos
);

712 
d–‘e
 [] 
m_pbyPşBufãr
;

713 
	}
}

715 #ià
defšed
(
HAVE_LIBHPIP
è&& defšed(
HAVE_DBUS
)

716 
	$S’dDbusMes§ge
 (cÚ¡ *
dev
, cÚ¡ *
´š‹r
, 
code
,

717 cÚ¡ *
u£ºame
, cÚ¡ 
jobid
, cÚ¡ *
t™Ë
)

719 
DBusMes§ge
 * 
msg
 = 
NULL
;

721 
	`In™Dbus
 ();

722 ià(
dbus_cÚn
 =ğ
NULL
)

724 
msg
 = 
	`dbus_mes§ge_Ãw_sigÇl
(
DBUS_PATH
, 
DBUS_INTERFACE
, "Event");

726 ià(
NULL
 =ğ
msg
)

728 
	`BUG
("dbus message is NULL!\n");

732 
	`dbus_mes§ge_­³nd_¬gs
(
msg
,

733 
DBUS_TYPE_STRING
, &
dev
,

734 
DBUS_TYPE_STRING
, &
´š‹r
,

735 
DBUS_TYPE_UINT32
, &
code
,

736 
DBUS_TYPE_STRING
, &
u£ºame
,

737 
DBUS_TYPE_UINT32
, &
jobid
,

738 
DBUS_TYPE_STRING
, &
t™Ë
,

739 
DBUS_TYPE_INVALID
);

741 ià(!
	`dbus_cÚÃùiÚ_£nd
(
dbus_cÚn
, 
msg
, 
NULL
))

743 
	`BUG
("dbus message send failed!\n");

747 
	`dbus_cÚÃùiÚ_æush
(
dbus_cÚn
);

748 
	`dbus_mes§ge_uÄef
(
msg
);

751 
	}
}

753 
	$In™Dbus
 ()

755 
	`dbus_”rÜ_š™
 (&
dbus_”r
);

756 
dbus_cÚn
 = 
	`dbus_bus_g‘
 (
DBUS_BUS_SYSTEM
, &
dbus_”r
);

758 ià(
	`dbus_”rÜ_is_£t
 (&
dbus_”r
))

760 
	`BUG
 ("dBu CÚÃùiÚ E¼Ü (%s)!\n", 
dbus_”r
.
mes§ge
);

761 
	`dbus_”rÜ_ä“
 (&
dbus_”r
);

765 
	}
}

	@prnt/hpijs/services.h

32 #iâdeà
hpijs_£rviûs_INCLUDED


33 
	#hpijs_£rviûs_INCLUDED


	)

35 
	~<¡dio.h
>

36 
	~<m©h.h
>

38 
	#EVENT_PRINT_FAILED_MISSING_PLUGIN
 502

	)

40 
	~"glob®_ty³s.h
"

42 
	gAPDK_USING_NAMESPACE


44 
	#BUFFER_CHUNK_SIZE
 1024 * 1024 * 2

	)

46 şas 
	cUXS”viûs
:
public
 
Sy¡emS”viûs


48 
public
:

49 
UXS”viûs
 ();

50 
	mvœtu®
 ~ 
UXS”viûs
 ();

52 
DRIVER_ERROR
 
BusyWa™
 (
DWORD
 
m£c
);

54 
DRIVER_ERROR
 
ToDeviû
 (cÚ¡ 
BYTE
* 
pBufãr
, 
DWORD
* 
wCouÁ
);

56 
DRIVER_ERROR
 
	$FromDeviû
 (
BYTE
* 
pR—dBuff
, 
DWORD
 * 
wR—dCouÁ
)

58  
NO_ERROR
;

61 
DRIVER_ERROR
 
	`R—dDeviûID
 (
BYTE
 * 
¡rID
, 
iSize
);

62 
BOOL
 
	`G‘StusInfo
 (
BYTE
 * 
bStReg
);

64 
DWORD
 
	$G‘Sy¡emTickCouÁ
 ()

67 
	}
}

70 
BOOL
 
	$Y›ldToSy¡em
 ()

73 
	}
}

75 
BYTE
 
	$G‘RªdomNumb”
 ()

77  
	`¿nd
 ();

78 
	}
}

80 
Di¥ÏyPrš‹rStus
 (
DISPLAY_STATUS
 
ePrš‹rStus
);

82 
BYTE
 
	$G‘Stus
 ()

85 
	}
}

87 
DRIVER_ERROR
 
G‘DevID
 (
BYTE
 * 
pDevIDSŒšg
, *
iDevIDL’gth
);

89 
DRIVER_ERROR
 
	$G‘ECPStus
 (
BYTE
 * 
pStusSŒšg
, *
pECPL’gth
,

90 
ECPChªÃl
)

92  
NO_ERROR
;

93 
	}
}

95 #ifdeà
HP_PRINTVIEW


96 
G‘PJLH—d”Bufãr
 (**
szPJLBufãr
);

99 
BOOL
 
G‘V”tiÿlAlignm’tV®ue
(
BYTE
* 
cV”tAlignV®
);

100 
BOOL
 
G‘V”tAlignFromDeviû
();

102 
BYTE
 *
	$AÎocMem
 (
iMemSize
)

104  (
BYTE
 *è
	`m®loc
 (
iMemSize
);

105 
	}
}

107 
	$F»eMem
 (
BYTE
 * 
pMem
)

109 
	`ä“
 (
pMem
);

110 
	}
}

112 
	$pow”
 (
x
, 
y
)

114  
	`pow
 (
x
, 
y
);

115 
	}
}

117 
ProûssRa¡”
(*
¿¡”
, *
k_¿¡”
);

118 
In™Du¶exBufãr
();

119 
S’dBackPage
 ();

120 
M­P­”Size
(
width
, 
height
);

121 
M­Mod–
(cÚ¡ *
Çm
);

122 cÚ¡ * 
G‘Driv”Mes§ge
(
DRIVER_ERROR
 
”r
);

124 
Re£tIOMode
 (
BOOL
 
bDevID
, BOOL 
bStus
);

126 
In™S³edMechBufãr
 ();

127 
CİyD©a
 (cÚ¡ 
BYTE
 *
pBufãr
, 
DWORD
 
iCouÁ
);

128 
S’dP»viousPage
 ();

129 
S’dLa¡Page
 ();

130 
BOOL
 
	$IsS³edMechEÇbËd
 ()

132  
m_bS³edMechEÇbËd
;

133 
	}
}

134 
	$EÇbËS³edMech
 (
BOOL
 
bFÏg
)

136 
m_bS³edMechEÇbËd
 = 
bFÏg
;

137 
	}
}

139 
BOOL
 
	gBackPage
;

140 
	gCu¼’tRa¡”
;

141 
BYTE
 **
	gRa¡”sOnPage
;

142 
BYTE
 **
	gKRa¡”sOnPage
;

144 
IjsPageH—d”
 
	gph
;

146 cÚ¡ *
	gM¬gš
;

147 
	gMod–
;

148 
	gOuutP©h
;

149 
QUALITY_MODE
 
	gQu®™y
;

150 
MEDIATYPE
 
	gMedŸTy³
;

151 
COLORMODE
 
	gCŞÜMode
;

152 
PEN_TYPE
 
	gP’S‘
;

153 
	gMedŸPos™iÚ
;

154 
	gP­”Width
;

155 
	gP­”Height
;

156 
	gDu¶ex
;

157 
	gTumbË
;

158 
	gFuÎBËed
;

159 
	gFœ¡Ra¡”
;

160 
	gKRGB
;

161 
	ghpFD
;

162 
DISPLAY_STATUS
 
	gDi¥ÏyStus
;

163 
	gV”tAlign
;

165 
PrštCÚ‹xt
 *
	gpPC
;

166 
Job
 *
	gpJob
;

167 
FILE
 *
	goutå
;

168 
	gm_iLogLev–
;

170 
	g´Ùeùed
:

173 
vœtu®
 
BYTE
* 
	$AÎocMem
 (
iMemSize
, 
BOOL
 
ŒackmemÜy
)

174 {  
	`AÎocMem
(
iMemSize
); 
	}
}

176 
vœtu®
 
	$F»eMem
 (
BYTE
* 
pMem
, 
BOOL
 
ŒackmemÜy
)

177 { 
	`F»eMem
(
pMem
); 
	}
}

178 
BOOL
 
CªDoBiDi
 ();

180 
	g´iv©e
:

181 
m_iPageCouÁ
;

182 
BOOL
 
	gm_bS³edMechEÇbËd
;

183 
	gm_iPşBufãrSize
;

184 
	gm_iCurPşBufãrPos
;

185 
BYTE
 *
	gm_pbyPşBufãr
;

	@prnt/hpijs/systemservices.cpp

31 
	~"h—d”.h
"

32 
	~"io_defs.h
"

33 #ifdeà
APDK_CAPTURE


34 
	~"süt.h
"

37 
APDK_BEGIN_NAMESPACE


47 
	gSy¡emS”viûs
::
	$Sy¡emS”viûs
()

48 : 
	`cÚ¡ruùÜ_”rÜ
(
NO_ERROR
),

49 #ià
	`defšed
(
APDK_CAPTURE
)

50 
	`pSü‹r
(
NULL
),

51 
	`C­turšg
(
FALSE
),

53 
	$iS’dBufãrSize
(4096)

56 
¡rMod–
[0] = 
¡rP’s
[0] = '\0';

57 
VIPV”siÚ
 = 0;

59 
DR
 = 
Ãw
 
	`DeviûRegi¡ry
();

62 
IOMode
.
bDevID
=
FALSE
;

63 
IOMode
.
bStus
=
FALSE
;

64 
IOMode
.
bUSB
=
FALSE
;

65 
	`mem£t
 (
¡rDevID
, 0, 
DevIDBuffSize
);

67 
	}
}

73 
	gSy¡emS”viûs
::~
	$Sy¡emS”viûs
()

76 
d–‘e
 
DR
;

78 #ià
	`defšed
(
APDK_CAPTURE
)

79 ià(
pSü‹r
)

80 
d–‘e
 
pSü‹r
;

83 
	`DBG1
("deleting SystemServices\n");

84 
	}
}

91 
BOOL
 
	gSy¡emS”viûs
::
	$Prš‹rIsAlive
()

93 
BYTE
 
¡©us_»g
;

97 ià(!
IOMode
.
bStus
)

98  
TRUE
;

99 ifĞ
	`G‘StusInfo
(&
¡©us_»g
è=ğ
FALSE
 )

101 
	`DBG1
("PrinterIsAlive: No Status-Byte Available (Default = TRUE)\n");

102  
TRUE
;

105 
	#DJ6XX_OFF
 (0xF8)

	)

106 
	#DJ400_OFF
 (0xC0)

	)

108 
	#DJ400_OFF_BOGUS
 (0xC8)

	)

109 
	#DEVICE_IS_OK
(
»g
è(!(Ôeg =ğ
DJ6XX_OFF
è|| (»g =ğ
DJ400_OFF
è|| (»g =ğ
DJ400_OFF_BOGUS
)))

	)

111 #ià
	`defšed
(
APDK_DEBUG
è&& (
DBG_MASK
 & 
DBG_LVL1
)

112 
	`´štf
("¡©u »g i 0x%02x\n",
¡©us_»g
);

113 ià(
	`DEVICE_IS_OK
(
¡©us_»g
))

114 
	`DBG1
("PrinterIsAlive:„eturning TRUE\n");

116 
	`DBG1
("PrinterIsAlive:„eturning FALSE\n");

119  (
	`DEVICE_IS_OK
(
¡©us_»g
));

120 
	}
}

126 
DRIVER_ERROR
 
	gSy¡emS”viûs
::
	$F»eMemÜy
(*
±r
)

128 ià(
±r
 =ğ
NULL
)

129  
SYSTEM_ERROR
;

132 
	`F»eMem
((
BYTE
*)
±r
);

134  
NO_ERROR
;

135 
	}
}

141 
DRIVER_ERROR
 
	gSy¡emS”viûs
::
	$G‘DeviûID
(
BYTE
* 
¡rID
, 
iSize
, 
BOOL
 
bQu”y
)

144 ià(
iSize
 < 3)

146 (
SYSTEM_ERROR
);

149 
	`mem£t
 (
¡rID
, 0, 
iSize
);

151 ià(
bQu”y
)

157 
¡rID
[0] = strID[1] = strID[2] = '\0';

161 
i
 = 0;

162 
i
 = 0; i < 20; i++)

165 if((
	`R—dDeviûID
(
¡rID
, 
iSize
è!ğ
NO_ERROR
))

167 
	`DBG1
("Error from ReadDeviceID or No DevID Available\n");

168 if(
	`BusyWa™
((
DWORD
)100è=ğ
JOB_CANCELED
)

170  
JOB_CANCELED
;

180 ià((!
	`¡r¡r
((cÚ¡ *)
¡rID
, "MFG:") &&

181 !
	`¡r¡r
((cÚ¡ *)
¡rID
+2, "MFG:") &&

182 !
	`¡r¡r
((cÚ¡ *)
¡rID
, "MANUFACTURER:") &&

183 !
	`¡r¡r
((cÚ¡ *)
¡rID
+2, "MANUFACTURER:")) ||

184 (!
	`¡r¡r
((cÚ¡ *)
¡rID
, "MDL:") &&

185 !
	`¡r¡r
((cÚ¡ *)
¡rID
+2, "MDL:") &&

186 !
	`¡r¡r
((cÚ¡ *)
¡rID
, "MODEL:") &&

187 !
	`¡r¡r
((cÚ¡ *)
¡rID
+2, "MODEL:")) ||

188 ((
¡rID
[0] == '\0') && (strID[1] == '\0')))

190 
	`DBG1
("Successful' DevID„equest was‡†ie. Retry...waiting 100 ms\n");

191 if(
	`BusyWa™
((
DWORD
)100è=ğ
JOB_CANCELED
)

193  
JOB_CANCELED
;

201 ià(
¡rID
[0] == 0 || strID[1] == 0)

203 
¡rID
[0] = strID[1] = ' ';

210 if(
i
 >= 20)

212  
BAD_DEVICE_ID
;

219 ià(
DevIDBuffSize
 > 
iSize
)

221  
SYSTEM_ERROR
;

228 
	`memıy
(
¡rID
, 
¡rDevID
, 
DevIDBuffSize
);

230  
NO_ERROR
;

258 
	}
}

266 
DRIVER_ERROR
 
	gSy¡emS”viûs
::
	$In™DeviûComm
()

282 
DRIVER_ERROR
 
”r
 = 
NO_ERROR
;

283 
BOOL
 
E¼ÜDi¥Ïyed
 = 
FALSE
;

284 
BYTE
 
‹mp
;

287 ifĞ
	`G‘StusInfo
(&
‹mp
è=ğ
FALSE
 )

289 
	`DBG1
("InitDeviceComm: No Status-Byte Available\n");

291 
IOMode
.
bStus
 = 
TRUE
;

295 
”r
 = 
	`G‘DeviûID
(
¡rDevID
, 
DevIDBuffSize
, 
TRUE
);

297 iàĞ
”r
 =ğ
NO_ERROR
 )

299 
	`DBG1
("InitDeviceComm: DevID„equest successful\n");

300 
IOMode
.
bDevID
 = 
TRUE
;

307 iàĞ
IOMode
.
bStus
 =ğ
TRUE
 )

314 iàĞ(
”r
 !ğ
NO_ERROR
è&& (
	`Prš‹rIsAlive
(è=ğ
FALSE
) )

317 
	`Prš‹rIsAlive
(è=ğ
FALSE
)

319 
	`DBG1
("PrinterIsAlive„eturned FALSE\n");

320 
E¼ÜDi¥Ïyed
 = 
TRUE
;

321 
	`Di¥ÏyPrš‹rStus
(
DISPLAY_NO_PRINTER_FOUND
);

323 if(
	`BusyWa™
(500è=ğ
JOB_CANCELED
)

324  
JOB_CANCELED
;

326 if(
E¼ÜDi¥Ïyed
 =ğ
TRUE
)

328 
	`Di¥ÏyPrš‹rStus
(
DISPLAY_PRINTING
);

331 if(
	`BusyWa™
(2000è=ğ
JOB_CANCELED
)

332  
JOB_CANCELED
;

334 
”r
 = 
	`G‘DeviûID
(
¡rDevID
, 
DevIDBuffSize
, 
TRUE
);

335 iàĞ
”r
 =ğ
NO_ERROR
 )

337 
	`DBG1
("InitDeviceComm: DevID„equest successful\n");

338 
IOMode
.
bDevID
 = 
TRUE
;

347 ià(
”r
!=
NO_ERROR
)

349 
	`DBG1
("InitDeviceComm: No DeviceID Available\n");

350  
NO_ERROR
;

353 
”r
 = 
DR
->
	`P¬£DevIDSŒšg
((cÚ¡ *)
¡rDevID
, 
¡rMod–
, &
VIPV”siÚ
, 
¡rP’s
);

355 ià(
”r
!=
NO_ERROR
)

358 
	`DBG1
("InitDeviceComm: The DevID string is invalid!\n");

359 
IOMode
.
bDevID
=
FALSE
;

362  
NO_ERROR
;

363 
	}
}

384 
DRIVER_ERROR
 
	gSy¡emS”viûs
::
	$G‘ECPStus
(
BYTE
 *
pStusSŒšg
,*
pECPL’gth
, 
ECPChªÃl
)

386 
pStusSŒšg
 = 
NULL
;

387 *
pECPL’gth
 = 0;

389  
UNSUPPORTED_FUNCTION
;

390 
	}
}

393 
	gSy¡emS”viûs
::
	$Adju¡IO
(
IO_MODE
 
IM
, cÚ¡ * 
mod–
)

395 
IOMode
.
bStus
=
IM
.bStatus && IOMode.bStatus;

396 
IOMode
.
bDevID
 =
IM
.bDevID && IOMode.bDevID;

398 ià(
mod–
)

399 
	`¡ºıy
(
¡rMod–
,
mod–
, (strModel));

400 
	}
}

402 
	gAPDK_END_NAMESPACE


	@prnt/hpijs/systemservices.h

32 #iâdeà
APDK_SYSTEMSERVICES_H


33 
	#APDK_SYSTEMSERVICES_H


	)

35 
APDK_BEGIN_NAMESPACE


37 
	sIO_MODE


40 
BOOL
 
	mbDevID
;

41 
BOOL
 
	mbStus
;

42 
BOOL
 
	mbUSB
;

47 
şass
 
	gDeviûRegi¡ry
;

49 
şass
 
	gSü‹r
;

51 cÚ¡ 
	gDevIDBuffSize
 = 512;

68 şas 
	cSy¡emS”viûs


70 
ä›nd
 
şass
 
	mPrštCÚ‹xt
;

71 
ä›nd
 
şass
 
	mPrš‹r
;

72 #ifdeà
APDK_APOLLO2XXX


73 
ä›nd
 
şass
 
	mApŞlo2xxx
;

75 
ä›nd
 
şass
 
	mTe¡”
;

76 
ä›nd
 
şass
 
	mAsciiSü‹r
;

77 
ä›nd
 
şass
 
	mBš¬ySü‹r
;

78 
	mpublic
:

79 
Sy¡emS”viûs
();

80 
	mvœtu®
 ~
Sy¡emS”viûs
();

88 
DRIVER_ERROR
 
	mcÚ¡ruùÜ_”rÜ
;

91 
DRIVER_ERROR
 
In™DeviûComm
();

94 
IO_MODE
 
	mIOMode
;

124 
vœtu®
 
DRIVER_ERROR
 
	$FlushIO
(è{  
NO_ERROR
; }

138 
vœtu®
 
DRIVER_ERROR
 
	$AbÜtIO
(è{  
NO_ERROR
; 
	}
}

147 
vœtu®
 
Di¥ÏyPrš‹rStus
 (
DISPLAY_STATUS
 
ePrš‹rStus
)=0;

161 
vœtu®
 
DRIVER_ERROR
 
BusyWa™
(
DWORD
 
m£c
)=0;

170 
vœtu®
 
DRIVER_ERROR
 
R—dDeviûID
(
BYTE
* 
¡rID
, 
iSize
)=0;

178 
vœtu®
 
BYTE
* 
AÎocMem
 (
iMemSize
)=0;

185 
vœtu®
 
F»eMem
 (
BYTE
* 
pMem
)=0;

187 
vœtu®
 
BOOL
 
Prš‹rIsAlive
();

199 
vœtu®
 
BOOL
 
G‘StusInfo
(
BYTE
* 
bStReg
)=0;

211 
vœtu®
 
DRIVER_ERROR
 
ToDeviû
(cÚ¡ 
BYTE
* 
pBufãr
, 
DWORD
* 
dwCouÁ
)=0;

220 
vœtu®
 
DRIVER_ERROR
 
FromDeviû
(
BYTE
* 
pR—dBuff
, 
DWORD
* 
wR—dCouÁ
)=0;

222 
vœtu®
 
DRIVER_ERROR
 
G‘ECPStus
(
BYTE
 *
pStusSŒšg
,*
pECPL’gth
, 
ECPChªÃl
);

232 
vœtu®
 
DWORD
 
G‘Sy¡emTickCouÁ
 ()=0;

234 
vœtu®
 
pow”
(
x
, 
y
)=0;

239 cÚ¡ * 
	$Prš‹rMod–
(è{  
¡rMod–
; 
	}
}

244 
	$G‘S’dBufãrSize
(ècÚ¡ {  
iS’dBufãrSize
; 
	}
}

246 #ià
	$defšed
 (
APDK_DJ3320
)

258 
vœtu®
 
BOOL
 
	$G‘V”tiÿlAlignm’tV®ue
(
BYTE
* 
cV”tAlignV®
è{  
FALSE
; 
	}
}

268 
vœtu®
 
BOOL
 
	$G‘V”tAlignFromDeviû
(è{  
FALSE
; 
	}
}

274 
DRIVER_ERROR
 
F»eMemÜy
(*
±r
);

275 
DRIVER_ERROR
 
G‘DeviûID
(
BYTE
* 
¡rID
, 
iSize
, 
BOOL
 
qu”y
);

280 
	$G‘VIPV”siÚ
 (è{  
VIPV”siÚ
; 
	}
}

282 #ià
	$defšed
(
APDK_CAPTURE
)

283 
Sü‹r
 *
pSü‹r
;

289 
DRIVER_ERROR
 
	`In™Süt
(cÚ¡ * 
FeName
, 
BOOL
 
ascii
, BOOL 
»ad
=
FALSE
);

294 
DRIVER_ERROR
 
	`EndSüt
();

296 
BOOL
 
C­turšg
;

297 
BOOL
 
»¶ay
;

300 
vœtu®
 
	$G‘PJLH—d”Bufãr
 (**
szPJLBufãr
)

303 
	}
}

305 
	g´Ùeùed
:

306 
vœtu®
 
Adju¡IO
(
IO_MODE
 
IM
, cÚ¡ * 
mod–
 = 
NULL
);

308 
BYTE
 
	g¡rDevID
[
DevIDBuffSize
];

310 
	giS’dBufãrSize
;

313 
PORTID
 
	gePÜtID
;

315 
DeviûRegi¡ry
* 
	gDR
;

317 
	g¡rMod–
[
DevIDBuffSize
];

318 
	g¡rP’s
[132];

319 
	gVIPV”siÚ
;

322 
vœtu®
 
BYTE
* 
	$AÎocMem
 (
iMemSize
, 
BOOL
 
ŒackmemÜy
)

323 {  
	`AÎocMem
(
iMemSize
); 
	}
}

325 
vœtu®
 
	$F»eMem
 (
BYTE
* 
pMem
, 
BOOL
 
ŒackmemÜy
)

326 { 
	`F»eMem
(
pMem
); 
	}
}

330 
	gAPDK_END_NAMESPACE


	@prnt/hpijs/translator.cpp

32 
	~"h—d”.h
"

33 
	~"h®áÚ”.h
"

35 
APDK_BEGIN_NAMESPACE


37 
	gRa¡”S’d”
::
	$Ra¡”S’d”
(
Prš‹r
* 
pP
, 
PrštCÚ‹xt
* 
pPC
,

38 
Job
* 
pJob
,
H®áÚ”
* 
pH®áÚ”
)

39 : 
	`thePrš‹r
(
pP
), 
	`thePrštCÚ‹xt
(
pPC
), 
	`theJob
(
pJob
),
	$theH®áÚ”
(
pH®áÚ”
)

41 
cÚ¡ruùÜ_”rÜ
=
NO_ERROR
;

42 
m_lNBÏnkRa¡”s
 = 0;

43 
	}
}

45 
	gRa¡”S’d”
::~
	$Ra¡”S’d”
()

47 
	}
}

50 
BOOL
 
Ra¡”S’d”
::
	$Proûss
(
RASTERDATA
* 
IÅutRa¡”
)

52 
DRIVER_ERROR
 
”r
=
NO_ERROR
;

53 
BOOL
 
bOuut
=
FALSE
;

54 ià(
IÅutRa¡”
 && (IÅutRa¡”->
¿¡”d©a
[
COLORTYPE_COLOR
] || IÅutRa¡”->¿¡”d©a[
COLORTYPE_BLACK
]))

56 
”r
=
	`S’dRa¡”
(
IÅutRa¡”
);

57 ià(
”r
==
NO_ERROR
)

58 
bOuut
=
TRUE
;

67 
”r
 = 
theJob
->
	`S’dCAPy
 ();

71 
mypha£
->
”r
 =ƒrr;

73  
bOuut
;

74 
	}
}

77 
DRIVER_ERROR
 
	gRa¡”S’d”
::
	$S’dRa¡”
(
RASTERDATA
* 
IÅutRa¡”
)

79 
DRIVER_ERROR
 
”r
;

80 
BOOL
 
Ï¡¶ªe
,
fœ¡¶ªe
;

82 ià(
theH®áÚ”
)

84 
Ï¡¶ªe
 = 
theH®áÚ”
->
	`La¡PÏÃ
();

85 
fœ¡¶ªe
 = 
theH®áÚ”
->
	`Fœ¡PÏÃ
();

87 
Ï¡¶ªe
=
fœ¡¶ªe
=
TRUE
;

90 ià(
fœ¡¶ªe
)

91 
”r
=
theJob
->
	`S’dCAPy
();

93 
”r
 = 
thePrš‹r
->
	`EnÿpsuÏ‹
 (
IÅutRa¡”
, 
Ï¡¶ªe
);

94 
ERRCHECK
;

96  
”r
;

97 
	}
}

99 
	gAPDK_END_NAMESPACE


	@prnt/hpijs/unistd_.h

26 #ifdeà
_MSC_VER


27 
	~<´oûss.h
>

28 
	~<io.h
>

29 
	~<fú.h
>

30 
	#»ad
(
hªdË
, 
bufãr
, 
couÁ
è
	`_»ad
(hªdË, bufãr, couÁ)

	)

31 
	#wr™e
(
hªdË
, 
bufãr
, 
couÁ
è
	`_wr™e
(hªdË, bufãr, couÁ)

	)

33 
	~<uni¡d.h
>

	@prnt/hpijs/version.cpp

31 
	~"cÚfig.h
"

33 
APDK_BEGIN_NAMESPACE


43 
	gDev–İ”SŒšg
[32]="[platform-specific information]";

46 
	gAPDK_END_NAMESPACE


	@prnt/hpijs/versioncode.cpp

31 
	~"h—d”.h
"

32 
	~"´š‹rçùÜy.h
"

34 
APDK_BEGIN_NAMESPACE


35 
BOOL
 
Prİr›ryImagšg
();

36 
BOOL
 
Prİr›rySÿlšg
();

37 
APDK_END_NAMESPACE


39 
APDK_BEGIN_NAMESPACE


41 
Dev–İ”SŒšg
[32];

47 cÚ¡ 
	gV”siÚSŒšgID
[21] = "04.09.00A_11-06-2009";

49 
	g»suÉ
[500];

51 
	$HP_¡rÿt
(* 
¡r1
, cÚ¡ * 
¡r2
)

53 *
¡r1
)

55 
¡r1
++;

57  (*
¡r1
++ = *
¡r2
++) )

62 
	}
}

83 * 
	$V”siÚ
(
BOOL
 
bCom´es£d
)

85 ià(
bCom´es£d
)

87 
b™s
=0;

89 ià(
	`Prİr›rySÿlšg
())

90 
b™s
 = bits | 0x80000000;

92 #ifdeà
APDK_CAPTURE


93 
b™s
 = bits | 0x40000000;

96 #ifdeà
APDK_LITTLE_ENDIAN


97 
b™s
 = bits | 0x20000000;

100 ià(
	`Prİr›ryImagšg
())

101 
b™s
 = bits | 0x10000000;

103 #ifdeà
APDK_COURIER


104 
b™s
 = bits | 0x08000000;

106 #ifdeà
APDK_CGTIMES


107 
b™s
 = bits | 0x04000000;

109 #ifdeà
APDK_LTRGOTHIC


110 
b™s
 = bits | 0x02000000;

112 #ifdeà
APDK_UNIVERS


113 
b™s
 = bits | 0x01000000;

116 #ifdeà
APDK_OPTIMIZE_FOR_SPEED


117 
b™s
 = bits | 0x00800000;

120 
b™s
 = b™ | 
pPFI
->
	`G‘Mod–B™s
();

123 
	`¥rštf
(
»suÉ
,"%0x", 
b™s
);

127 
	`¡rıy
(
»suÉ
,
Dev–İ”SŒšg
);

128 
	`HP_¡rÿt
(
»suÉ
,"!!");

129 
	`HP_¡rÿt
(
»suÉ
,
V”siÚSŒšgID
);

130 
	`HP_¡rÿt
(
»suÉ
," ");

132 ià(
	`Prİr›rySÿlšg
())

133 
	`HP_¡rÿt
(
»suÉ
,"propscale ");

135 
	`HP_¡rÿt
(
»suÉ
,"openscale ");

137 ià(
	`Prİr›ryImagšg
())

138 
	`HP_¡rÿt
(
»suÉ
,"propimg ");

140 
	`HP_¡rÿt
(
»suÉ
,"openimg ");

142 #ifdeà
APDK_CAPTURE


143 
	`HP_¡rÿt
(
»suÉ
,"debug ");

145 
	`HP_¡rÿt
(
»suÉ
,"normal ");

148 #ifdeà
APDK_LITTLE_ENDIAN


149 
	`HP_¡rÿt
(
»suÉ
,"little_endian ");

151 
	`HP_¡rÿt
(
»suÉ
,"big_endian ");

154 #ià
	`defšed
(
APDK_FONTS_NEEDED
)

155 
	`HP_¡rÿt
(
»suÉ
,"fonts:");

157 
	`HP_¡rÿt
(
»suÉ
,"no_fonts");

159 #ifdeà
APDK_COURIER


160 
	`HP_¡rÿt
(
»suÉ
,"C");

162 #ifdeà
APDK_CGTIMES


163 
	`HP_¡rÿt
(
»suÉ
,"T");

165 #ifdeà
APDK_LTRGOTHIC


166 
	`HP_¡rÿt
(
»suÉ
,"L");

168 #ifdeà
APDK_UNIVERS


169 
	`HP_¡rÿt
(
»suÉ
,"U");

171 
	`HP_¡rÿt
(
»suÉ
," ");

173 #ifdeà
APDK_OPTIMIZE_FOR_SPEED


174 
	`HP_¡rÿt
(
»suÉ
,"speed ");

176 
	`HP_¡rÿt
(
»suÉ
,"memory ");

179 
mod–¡ršg
[300];

180 
pPFI
->
	`G‘Mod–SŒšg
(
mod–¡ršg
, (modelstring));

181 
	`HP_¡rÿt
(
»suÉ
, 
mod–¡ršg
);

185  
»suÉ
;

186 
	}
}

190 
	gAPDK_END_NAMESPACE


	@prnt/hpps/hppsfilter.c

33 
	~"hµsf‹r.h
"

37 
	gg_§v•sfe
 = 0;

40 
FILE
 *
	gg_å_outdbgps
 = 
NULL
;

43 
FILE
 *
	g±empbookËt_fe
 = 
NULL
;

44 
	g‹mp_f’ame
[
FILE_NAME_SIZE
] = {0};

45 
	gbookËt_f’ame
[
FILE_NAME_SIZE
] = {0};

46 
	gNup_f’ame
[
FILE_NAME_SIZE
] = {0};

47 
PS_BookËt
(*
‹mpfe
, *
bookËtfe
, *
nupfe
,
Üd”
, 
nup
, * 
·gesize
, 
bookËtMak”
);

50 
	$g‘_LogLev–
 ()

52 
FILE
 *
å
;

53 
¡r
[258];

54 *
p
;

55 
å
 = 
	`fİ’
 ("/etc/cups/cupsd.conf", "r");

56 ià(
å
 =ğ
NULL
)

58 !
	`ãof
 (
å
))

60 ià(!
	`fg‘s
 (
¡r
, 256, 
å
))

64 ià((
p
 = 
	`¡r¡r
 (
¡r
, "hpLogLevel")))

66 
p
 +ğ
	`¡¾’
 ("hpLogLevel") + 1;

67 
g_§v•sfe
 = 
	`©oi
 (
p
);

71 
	`fşo£
 (
å
);

72 
	}
}

76 
	$İ’_dbg_outfe
(* 
szjob_id
)

78 
g_å_outdbgps
 = 
NULL
;

79 ià(
g_§v•sfe
 & 
SAVE_PS_FILE
)

81 
sfe_Çme
[
FILE_NAME_SIZE
] = {0};

82 
	`¥rštf
(
sfe_Çme
, "%s/%s_%s.out", 
DBG_TMP_FOLDER
,
DBG_PSFILE
, 
szjob_id
);

83 
g_å_outdbgps
ğ
	`fİ’
(
sfe_Çme
, "w");

84 
	`chmod
(
sfe_Çme
, 
S_IRUSR
 | 
S_IWUSR
 | 
S_IRGRP
 | 
S_IROTH
);

86 
	}
}

89 
	$hpwr™e
 (*
pBufãr
, 
size_t
 
size
)

91 
nd©a_wr™‹n
 = 0;

92 if(
g_å_outdbgps
)

94 
nd©a_wr™‹n
 = 
	`fwr™e
 (
pBufãr
, 1, 
size
, 
g_å_outdbgps
);

97 
nd©a_wr™‹n
 = 
	`wr™e
 (
STDOUT_FILENO
, 
pBufãr
, 
size
);

98  
nd©a_wr™‹n
;

99 
	}
}

101 
	$İ’_‹mpbookËtfe
(*
mode
)

103 
±empbookËt_fe
ğ
	`fİ’
(
‹mp_f’ame
, 
mode
);

104 if(
±empbookËt_fe
 =ğ
NULL
)

106 
	`årštf
(
¡d”r
, "ERROR: UÇbËØİ’em°f%s\n", 
‹mp_f’ame
);

109 
	`chmod
(
‹mp_f’ame
, 
S_IRUSR
 | 
S_IWUSR
 | 
S_IRGRP
 | 
S_IROTH
);

111 
	}
}

113 
	$Dump_‹mpbookËtfe
 (*
pBufãr
, 
size_t
 
size
)

115 
nd©a_wr™‹n
 = 0;

117 
nd©a_wr™‹n
 = 
	`fwr™e
 (
pBufãr
, 1, 
size
, 
±empbookËt_fe
);

119  
nd©a_wr™‹n
;

120 
	}
}

127 
	gfš®¡r
[32]={0};

129 * 
	$G‘PPDV®ues
()

131 
µd_v®ues
[14] = {0},

132 *
by‹s
 = 
NULL
;

133 
couÁ
 = 0;

134 *
Ãw¡ršg
 = 
NULL
;

135 *
tk¡r
=
NULL
;

136 
Ën
 = 9;

137 
i
=0;

141 *
µpd_fe
 = 
	`g‘’v
("PPD");

143 
	`årštf
(
¡d”r
, "HP PS f‹¸funøğG‘PPDV®ue : PPD NAME %s\n", 
µpd_fe
);

144 if(
µpd_fe
 !ğ
NULL
)

147 
FILE
 * 
fe_poš‹r
 = 
	`fİ’
(
µpd_fe
, "r");

148 if(!
fe_poš‹r
)

150 
	`årštf
(
¡d”r
, "HP PS filter func = GetPPDValues : GET PPD VALUES FAILED - 1\n");

151  
NULL
;

156 
couÁ
 = 0; count < 13; count ++)

157 
µd_v®ues
[
couÁ
] = -1;

158 
couÁ
 = 0;

159 
	`f£ek
(
fe_poš‹r
, 0L, 
SEEK_END
 );

160 
couÁ
 = 
	`á–l
(
fe_poš‹r
);

161 
	`f£ek
(
fe_poš‹r
, 0L, 
SEEK_SET
 );

163 
by‹s
 = (*)
	`m®loc
(
couÁ
);

164 if(!
by‹s
)

165 
	`årštf
(
¡d”r
, "HP PS filter func = GetPPDValues : GET PPD VALUES FAILED - 2\n");

168 
	`mem£t
(
by‹s
, 0, 
couÁ
);

169 
	`ä—d
(
by‹s
, 
couÁ
, 1, 
fe_poš‹r
);

171 if((
	`¡r¡r
(
by‹s
, "HPDig™")è!ğ
NULL
)

172 
µd_v®ues
[0] = 1;

174 if((
	`¡r¡r
(
by‹s
, 
HPACCOUNTINGINFO
)è!ğ
NULL
)

175 
µd_v®ues
[1] = 1;

177 if((
	`¡r¡r
(
by‹s
, 
HPBOD
)è!ğ
NULL
)

178 
µd_v®ues
[2] = 1;

180 if((
	`¡r¡r
(
by‹s
, 
HPPJLECONOMODE
)è!ğ
NULL
)

181 
µd_v®ues
[3] = 1;

183 if((
	`¡r¡r
(
by‹s
, 
HPPJLECONOMODE2
)è!ğ
NULL
)

184 
µd_v®ues
[4] = 1;

186 if((
	`¡r¡r
(
by‹s
, 
HPPJLPRINTQUALITY
)è!ğ
NULL
)

187 
µd_v®ues
[5] = 1;

189 if((
	`¡r¡r
(
by‹s
, 
HPPJLOUTPUTMODE
)è!ğ
NULL
)

190 
µd_v®ues
[6] = 1;

192 if((
	`¡r¡r
(
by‹s
, 
HPPJLDRYTIME
)è!ğ
NULL
)

193 
µd_v®ues
[7] = 1;

195 if((
	`¡r¡r
(
by‹s
, 
HPPJLSATURATION
)è!ğ
NULL
)

196 
µd_v®ues
[8] = 1;

198 if((
	`¡r¡r
(
by‹s
, 
HPPJLINKBLEED
)è!ğ
NULL
)

199 
µd_v®ues
[9] = 1;

201 if((
	`¡r¡r
(
by‹s
, 
HPPJLCOLORASGRAY
)è!ğ
NULL
)

202 
µd_v®ues
[10] = 1;

204 if((
	`¡r¡r
(
by‹s
, 
HPPJLTRUEBLACK
)è!ğ
NULL
)

205 
µd_v®ues
[11] = 1;

206 if((
Ãw¡ršg
 = 
	`¡r¡r
(
by‹s
, "DeçuÉHPU£rAcûssCode: Cu¡om.")è!ğ
NULL
){

207 
tk¡r
=
	`¡¹ok
(
Ãw¡ršg
,"*");

208 
Ãw¡ršg
=
	`¡r¡r
(
tk¡r
,".");

209 
i
=0;i<
	`¡¾’
(
Ãw¡ršg
);i++){

210 if(
Ãw¡ršg
[
i
]=='\n')

213 
	`¡ºıy
(
fš®¡r
,&
Ãw¡ršg
[1],
i
-1);

214 
µd_v®ues
[12] = 1;

216 
µd_v®ues
[13] = '\0';

217 
	`ä“
(
by‹s
);

219 
	`fşo£
(
fe_poš‹r
);

220  
µd_v®ues
;

225 
	`årštf
(
¡d”r
, "HP PS filter func = GetPPDValues : GET PPD VALUES FAILED -3\n");

226  
NULL
;

227 
	}
}

236 sigÃd 
	$RemoveCh¬aù”s
(
šput_¦Ù
[])

238 
Ën
 = 0,

239 
‹mp_Ën
 = 0;

240 
‹mp_šput_¦Ù
[128] = {0};

242 if((
	`¡¾’
(
šput_¦Ù
)) > 0)

244 
šput_¦Ù
[
Ën
] != '\0')

246 ià(
šput_¦Ù
[
Ën
] != '-' && input_slot[len] != ' ')

248 
‹mp_šput_¦Ù
[
‹mp_Ën
] = 
šput_¦Ù
[
Ën
];

249 
‹mp_Ën
 ++;

250 
Ën
 ++;

253 
Ën
 ++;

255 
‹mp_šput_¦Ù
[
‹mp_Ën
] = '\0';

256 
	`¡rıy
(
šput_¦Ù
, 
‹mp_šput_¦Ù
);

259 
	`årštf
(
¡d”r
, "HP PS filter func = RemoveCharacters : REMOVE CHARACTER FAILED\n");

261 
	}
}

269 
	$Wr™eH—d”
(**
¬gum’t
)

271 
bufãr
[
MAX_BUFFER
] = {0};

275 
	`hpwr™e
("\x1b%-12345X@PJL JOBNAME=", 
	`¡¾’
("\x1b%-12345X@PJL JOBNAME="));

276 
	`¥rštf
(
bufãr
, "h¶_%s_%s\x0a", 
¬gum’t
[2],‡rgument[1]);

277 
	`hpwr™e
(
bufãr
, 
	`¡¾’
(buffer));

278 
	`mem£t
(
bufãr
, 0, (buffer));

279 
	`¥rštf
(
bufãr
, "@PJL SET USERNAME=\"%s\"\x0a", 
¬gum’t
[2]);

280 
	`hpwr™e
(
bufãr
, 
	`¡¾’
(buffer));

281 
	`mem£t
(
bufãr
, 0, (buffer));

282 
	`¥rštf
(
bufãr
, "@PJL SET JOBNAME=\"%s\"\x0a", 
¬gum’t
[3]);

283 
	`hpwr™e
(
bufãr
, 
	`¡¾’
(buffer));

284 
	`årštf
(
¡d”r
, "HP PS filter func = WriteHeader : WRITING PJL HEADER INFO\n");

286 
	}
}

295 
	$Wr™eSecu»Prštšg
(
is_£cu»_´štšg_Şd
, 
num_İtiÚs
, 
cups_İtiÚ_t
 *
İtiÚs
)

297 
£c_pš
[
MAX_BUFFER
] = {0},

298 
šput_¦Ù
[
MAX_BUFFER
] = {0};

299 cÚ¡ *
v®
 = 
NULL
;

301 if(
is_£cu»_´štšg_Şd
 == -1)

304 if((
v®
 = 
	`cupsG‘O±iÚ
("HPFIDig™", 
num_İtiÚs
, 
İtiÚs
)è!ğ
NULL
)

305 
£c_pš
[0] = 
v®
[0];

307 
£c_pš
[0] = '0';

309 if((
v®
 = 
	`cupsG‘O±iÚ
("HPSEDig™", 
num_İtiÚs
, 
İtiÚs
)è!ğ
NULL
)

310 
£c_pš
[1] = 
v®
[0];

312 
£c_pš
[1] = '0';

314 if((
v®
 = 
	`cupsG‘O±iÚ
("HPTHDig™", 
num_İtiÚs
, 
İtiÚs
)è!ğ
NULL
)

315 
£c_pš
[2] = 
v®
[0];

317 
£c_pš
[2] = '0';

319 if((
v®
 = 
	`cupsG‘O±iÚ
("HPFTDig™", 
num_İtiÚs
, 
İtiÚs
)è!ğ
NULL
)

320 
£c_pš
[3] = 
v®
[0];

322 
£c_pš
[3] = '0';

323 
£c_pš
[4] = '\0';

327 if(
is_£cu»_´štšg_Şd
 == 1)

330 if((
v®
 = 
	`cupsG‘O±iÚ
("HPDig™", 
num_İtiÚs
, 
İtiÚs
)è!ğ
NULL
)

332 
	`¡ºıy
(
šput_¦Ù
, 
v®
, 
	`¡¾’
(val));

333 if((
	`¡r¡r
(
šput_¦Ù
, "Cu¡om.")è!ğ
NULL
)

335 *
£c_pš_v®ue
 = 
	`¡¹ok
(
šput_¦Ù
, "Custom.");

336 if(
£c_pš_v®ue
 =ğ
NULL
)

338 
	`¡rıy
(
£c_pš
, 
£c_pš_v®ue
);

339 if((
	`¡¾’
(
£c_pš
)) != 4)

340 
	`¡rıy
(
£c_pš
, "0000");

343 
	`¡rıy
(
£c_pš
, 
šput_¦Ù
);

346 
	`¡rıy
(
£c_pš
, "0000");

350 
	`årštf
(
¡d”r
, "HP PS filter func = WriteSecurePrinting : SECURE PRINTING FAILED 1\n");

354 if((
	`¡¾’
(
£c_pš
)) == 4)

358 
£c_pš_commªd
[
MAX_BUFFER
] = {0};

359 
	`¥rštf
(
£c_pš_commªd
, "%s%s%s", "@PJL SET HOLDKEY=", 
£c_pš
, "\x0a");

360 
	`hpwr™e
("@PJL SET HOLD=ON\x0a", 
	`¡¾’
("@PJL SET HOLD=ON\x0a"));

361 
	`hpwr™e
("@PJL SET HOLDTYPE=PRIVATE\x0a", 
	`¡¾’
("@PJL SET HOLDTYPE=PRIVATE\x0a"));

362 
	`hpwr™e
(
£c_pš_commªd
, 
	`¡¾’
(sec_pin_command));

363 
	`årštf
(
¡d”r
, "HP PS filter func = WriteSecurePrinting : WRITING SECURE PRINTING INFO\n");

366 
	`årštf
(
¡d”r
, "HP PS filter func = WriteSecurePrinting : SECURE PRINTING FAILED 2\n");

368 
	}
}

377 
	$Wr™eJobAccouÁšg
(**
¬gum’t
, 
num_İtiÚs
, 
cups_İtiÚ_t
 *
İtiÚs
)

379 
bufãr
[
MAX_BUFFER
] = {0},

380 
Çme
[100] = {0},

381 
out¡r
[200] = {0},

382 
šput_¦Ù
[
MAX_BUFFER
] = {0};

383 cÚ¡ *
v®
 = 
NULL
;

384 
time_t
 
t
;

385 
tm
 *
tmp
;

388 
	`¥rštf
(
bufãr
, "@PJL SET JOBATTR=\"JobAcù1=%s\"\x0a", 
¬gum’t
[2]);

389 
	`hpwr™e
(
bufãr
, 
	`¡¾’
(buffer));

390 
	`mem£t
(
bufãr
, 0, (buffer));

391 
	`g‘ho¡Çme
(
Çme
, (name));

392 if((
	`¡¾’
(
Çme
)) < 1)

394 
	`¥rštf
(
bufãr
, "@PJL SET JOBATTR=\"JobAcct2=%s\"\x0a", "unknown_system_name");

395 
	`hpwr™e
(
bufãr
, 
	`¡¾’
(buffer));

396 
	`mem£t
(
bufãr
, 0, (buffer));

400 
	`¥rštf
(
bufãr
, "@PJL SET JOBATTR=\"JobAcù2=%s\"\x0a", 
Çme
);

401 
	`hpwr™e
(
bufãr
, 
	`¡¾’
(buffer));

402 
	`mem£t
(
bufãr
, 0, (buffer));

404 
	`mem£t
(
Çme
, 0, (name));

405 
	`g‘domašÇme
(
Çme
,(name));

406 if(
	`¡r¡r
(
Çme
, "nÚe"è!ğ
NULL
)

408 
	`¥rštf
(
bufãr
, "@PJL SET JOBATTR=\"JobAcct3=%s\"\x0a", "unknown_domain_name");

409 
	`hpwr™e
(
bufãr
, 
	`¡¾’
(buffer));

410 
	`mem£t
(
bufãr
, 0, (buffer));

414 
	`¥rštf
(
bufãr
, "@PJL SET JOBATTR=\"JobAcù3=%s\"\x0a", 
Çme
);

415 
	`hpwr™e
(
bufãr
, 
	`¡¾’
(buffer));

416 
	`mem£t
(
bufãr
, 0, (buffer));

418 
t
 = 
	`time
(
NULL
);

419 
tmp
 = 
	`loÿÉime
(&
t
);

420 if(
tmp
 =ğ
NULL
)

422 
	`årštf
(
¡d”r
, "HP PS filter func = WriteJobAccounting : JOB ACCOUNTING INFO FAILED -1\n");

425 ià(
	`¡ráime
(
out¡r
, (out¡r), "%Y%m%d%I%M%S", 
tmp
) == 0)

427 
	`årštf
(
¡d”r
, "HP PS filter func = WriteJobAccounting : JOB ACCOUNTING INFO FAILED -2\n");

431 
	`¥rštf
(
bufãr
, "@PJL SET JOBATTR=\"JobAcù4=%s\"\x0a", 
out¡r
);

432 
	`hpwr™e
(
bufãr
, 
	`¡¾’
(buffer));

433 
	`mem£t
(
bufãr
, 0, (buffer));

434 if((
v®
 = 
	`cupsG‘O±iÚ
("job-uuid", 
num_İtiÚs
, 
İtiÚs
)è!ğ
NULL
)

436 
	`¡ºıy
(
šput_¦Ù
, 
v®
, 
	`¡¾’
(val));

437 if(
šput_¦Ù
)

439 
	`¥rštf
(
bufãr
, "@PJL SET JOBATTR=\"JobAcù5=%s\"\x0a", 
šput_¦Ù
);

440 
	`hpwr™e
(
bufãr
, 
	`¡¾’
(buffer));

441 
	`mem£t
(
bufãr
, 0, (buffer));

447 
	`årštf
(
¡d”r
, "HP PS filter func = WriteJobAccounting : JOB ACCOUNTING INFO FAILED -3\n");

450 
	`¥rštf
(
bufãr
, "@PJL SET JOBATTR=\"JobAcct6=%s\"\x0a", "HP Linux Printing");

451 
	`hpwr™e
(
bufãr
, 
	`¡¾’
(buffer));

452 
	`mem£t
(
bufãr
, 0, (buffer));

454 
	`¥rštf
(
bufãr
, "@PJL SET JOBATTR=\"JobAcct7=%s\"\x0a", "HP Linux Printing");

455 
	`hpwr™e
(
bufãr
, 
	`¡¾’
(buffer));

456 
	`mem£t
(
bufãr
, 0, (buffer));

458 
	`¥rštf
(
bufãr
, "@PJL SET JOBATTR=\"JobAcù8=%s\"\x0a", 
¬gum’t
[2]);

459 
	`hpwr™e
(
bufãr
, 
	`¡¾’
(buffer));

460 
	`mem£t
(
bufãr
, 0, (buffer));

461 
	`årštf
(
¡d”r
, "HP PS filter func = WriteJobAccounting : WRITING JOB ACCOUNTING INFO\n");

463 
	}
}

471 
	$Wr™eBÜnOnD©e
()

473 * 
bod
 = "0400040101020D10100115";

474 
Çme
[100] = {0},

475 
out¡r
[200] = {0},

476 
fš®
[200] = {0},

477 
bufãr
[
MAX_BUFFER
] = {0};

478 
couÁ
 = 0,

479 
Ën
 = 0;

480 
time_t
 
t
;

481 
tm
 *
tmp
;

483 
t
 = 
	`time
(
NULL
);

484 
tmp
 = 
	`loÿÉime
(&
t
);

485 if(
tmp
 =ğ
NULL
)

487 
	`årštf
(
¡d”r
, "HP PS filter func = WriteBornOnDate : BORN-ON-DATE FAILED -1\n");

490 ià(
	`¡ráime
(
out¡r
, (out¡r), "%Y%m%d%I%M%S", 
tmp
) == 0)

492 
	`årštf
(
¡d”r
, "HP PS filter func = WriteBornOnDate : BORN-ON-DATE FAILED -2\n");

496 
couÁ
 = 0; couÁ < 
	`¡¾’
(
out¡r
è; couÁ++, 
Ën
 += 2)

497 
	`¥rštf
(&
fš®
[
Ën
], "%x", 
out¡r
[
couÁ
]);

499 
	`¥rštf
(
bufãr
, "@PJL DMINFO ASCIIHEX=\"%s%s\"\x0A", 
bod
, 
fš®
);

500 
	`hpwr™e
(
bufãr
, 
	`¡¾’
(buffer));

501 
	`årštf
(
¡d”r
, "HP PS filter func = WriteBornOnDate : WRITING BORN-ON-DATE\n");

503 
	}
}

511 
	$Wr™eECONOMODE
(**
¬gum’t
)

514 if((
	`¡r¡r
(
¬gum’t
[5], 
HPPJLECONOMODE
)è!ğ
NULL
 && (strstr(argument[5], "noHPPJLEconoMode")) == NULL)

516 
	`hpwr™e
("@PJL SET ECONOMODE=ON\x0a", 
	`¡¾’
("@PJL SET ECONOMODE=ON\x0a"));

517 
	`hpwr™e
("@PJL SET RESOLUTION=600\x0a", 
	`¡¾’
("@PJL SET RESOLUTION=600\x0a"));

518 
	`hpwr™e
("@PJL SET BITSPERPIXEL=2\x0a", 
	`¡¾’
("@PJL SET BITSPERPIXEL=2\x0a"));

522 
	`hpwr™e
("@PJL SET ECONOMODE=OFF\x0a", 
	`¡¾’
("@PJL SET ECONOMODE=OFF\x0a"));

523 
	`hpwr™e
("@PJL SET RESOLUTION=600\x0a", 
	`¡¾’
("@PJL SET RESOLUTION=600\x0a"));

524 
	`hpwr™e
("@PJL SET BITSPERPIXEL=2\x0a", 
	`¡¾’
("@PJL SET BITSPERPIXEL=2\x0a"));

526 
	`årštf
(
¡d”r
, "HP PS filter func = WriteECONOMODE : WRITNING ECONOMODE\n");

528 
	}
}

536 
	$Wr™eECONOMODE2
(
num_İtiÚs
, 
cups_İtiÚ_t
 *
İtiÚs
)

538 
šput_¦Ù
[
MAX_BUFFER
] = {0};

539 cÚ¡ *
v®
 = 
NULL
;

541 if((
v®
 = 
	`cupsG‘O±iÚ
(
HPPJLECONOMODE2
, 
num_İtiÚs
, 
İtiÚs
)è!ğ
NULL
)

543 
	`¡ºıy
(
šput_¦Ù
, 
v®
, 
	`¡¾’
(val));

544 if(
šput_¦Ù
)

546 if((
	`RemoveCh¬aù”s
(
šput_¦Ù
)) == -1)

548 
	`årštf
(
¡d”r
, "HP PS filter func = WriteECONOMODE2 : ECONOMODE FAILED\n");

551 if((
	`¡rcmp
(
šput_¦Ù
, "yes")) == 0 || (strcmp(input_slot, "on")) == 0 )

553 
	`hpwr™e
("@PJL SET ECONOMODE=ON\x0a", 
	`¡¾’
("@PJL SET ECONOMODE=ON\x0a"));

554 
	`hpwr™e
("@PJL SET RESOLUTION=600\x0a", 
	`¡¾’
("@PJL SET RESOLUTION=600\x0a"));

555 
	`hpwr™e
("@PJL SET BITSPERPIXEL=2\x0a", 
	`¡¾’
("@PJL SET BITSPERPIXEL=2\x0a"));

559 
	`hpwr™e
("@PJL SET ECONOMODE=OFF\x0a", 
	`¡¾’
("@PJL SET ECONOMODE=OFF\x0a"));

560 
	`hpwr™e
("@PJL SET RESOLUTION=600\x0a", 
	`¡¾’
("@PJL SET RESOLUTION=600\x0a"));

561 
	`hpwr™e
("@PJL SET BITSPERPIXEL=2\x0a", 
	`¡¾’
("@PJL SET BITSPERPIXEL=1\x0a"));

567 
	`hpwr™e
("@PJL SET RESOLUTION=600\x0a", 
	`¡¾’
("@PJL SET RESOLUTION=600\x0a"));

568 
	`hpwr™e
("@PJL SET BITSPERPIXEL=2\x0a", 
	`¡¾’
("@PJL SET BITSPERPIXEL=1\x0a"));

570 
	`årštf
(
¡d”r
, "HP PS filter func = WriteECONOMODE2 : WRITING ECONOMODE\n");

573 
	}
}

581 
	$Wr™eHPPJLPRINTQUALITY
(
num_İtiÚs
, 
cups_İtiÚ_t
 *
İtiÚs
)

583 
šput_¦Ù
[
MAX_BUFFER
] = {0};

584 cÚ¡ *
v®
 = 
NULL
;

586 if((
v®
 = 
	`cupsG‘O±iÚ
(
HPPJLPRINTQUALITY
, 
num_İtiÚs
, 
İtiÚs
)è!ğ
NULL
)

588 
	`¡ºıy
(
šput_¦Ù
, 
v®
, 
	`¡¾’
(val));

589 if(
šput_¦Ù
)

591 if((
	`RemoveCh¬aù”s
(
šput_¦Ù
)) == -1)

593 
	`årštf
(
¡d”r
, "HP PS filter func = WriteHPPJLPRINTQUALITY : PRINT QUALITY FAILED\n");

596 if((
	`¡rcmp
(
šput_¦Ù
, "ProRes1200")) == 0)

597 
	`hpwr™e
("@PJL SET RESOLUTION=600\x0a@PJL SET BITSPERPIXEL=1\x0a", 
	`¡¾’
("@PJL SET RESOLUTION=600\x0a@PJL SET BITSPERPIXEL=1\x0a"));

598 if((
	`¡rcmp
(
šput_¦Ù
, "600dpi")) == 0)

599 
	`hpwr™e
("@PJL SET RESOLUTION=600\x0a@PJL SET BITSPERPIXEL=1\x0a", 
	`¡¾’
("@PJL SET RESOLUTION=600\x0a@PJL SET BITSPERPIXEL=1\x0a"));

601 
	`hpwr™e
("@PJL SET RESOLUTION=600\x0a@PJL SET BITSPERPIXEL=2\x0a", 
	`¡¾’
("@PJL SET RESOLUTION=600\x0a@PJL SET BITSPERPIXEL=2\x0a"));

605 
	`hpwr™e
("@PJL SET RESOLUTION=600\x0a@PJL SET BITSPERPIXEL=2\x0a", 
	`¡¾’
("@PJL SET RESOLUTION=600\x0a@PJL SET BITSPERPIXEL=2\x0a"));

606 
	`årštf
(
¡d”r
, "HP PS filter func = WriteHPPJLPRINTQUALITY: WRITING PRINT QUALITY INFO\n");

608 
	}
}

616 
	$Wr™eHPPJLOUTPUTMODE
(
num_İtiÚs
, 
cups_İtiÚ_t
 *
İtiÚs
)

618 
šput_¦Ù
[
MAX_BUFFER
] = {0};

619 cÚ¡ *
v®
 = 
NULL
;

621 if((
v®
 = 
	`cupsG‘O±iÚ
(
HPPJLOUTPUTMODE
, 
num_İtiÚs
, 
İtiÚs
)è!ğ
NULL
)

623 
	`¡ºıy
(
šput_¦Ù
, 
v®
, 
	`¡¾’
(val));

624 if(
šput_¦Ù
)

626 if((
	`RemoveCh¬aù”s
(
šput_¦Ù
)) == -1)

628 
	`årštf
(
¡d”r
, "HP PS filter func = WriteHPPJLOUTPUTMODE : OUTPUTMODE FAILED\n");

631 if((
	`¡rcmp
(
šput_¦Ù
, "GeneralOffice")) == 0)

632 
	`hpwr™e
("@PJL SET PRINTQUALITY=DRAFT\x0a", 
	`¡¾’
("@PJL SET PRINTQUALITY=DRAFT\x0a"));

633 if((
	`¡rcmp
(
šput_¦Ù
, "Professional")) == 0)

634 
	`hpwr™e
("@PJL SET PRINTQUALITY=NORMAL\x0a", 
	`¡¾’
("@PJL SET PRINTQUALITY=NORMAL\x0a"));

635 if((
	`¡rcmp
(
šput_¦Ù
, "Presentation")) == 0)

636 
	`hpwr™e
("@PJL SET PRINTQUALITY=BEST\x0a", 
	`¡¾’
("@PJL SET PRINTQUALITY=BEST\x0a"));

637 if((
	`¡rcmp
(
šput_¦Ù
, "MaximumDPI")) == 0)

638 
	`hpwr™e
("@PJL SET PRINTQUALITY=MAX\x0a", 
	`¡¾’
("@PJL SET PRINTQUALITY=MAX\x0a"));

640 
	`hpwr™e
("@PJL SET PRINTQUALITY=NORMAL\x0a", 
	`¡¾’
("@PJL SET PRINTQUALITY=NORMAL\x0a"));

644 
	`hpwr™e
("@PJL SET PRINTQUALITY=NORMAL\x0a", 
	`¡¾’
("@PJL SET PRINTQUALITY=NORMAL\x0a"));

645 
	`årštf
(
¡d”r
, "HP PS filter func = WriteHPPJLOUTPUTMODE : WRITING OUTPUTMODE INFO\n");

648 
	}
}

656 
	$Wr™eHPPJLDRYTIME
(
num_İtiÚs
, 
cups_İtiÚ_t
 *
İtiÚs
)

658 
šput_¦Ù
[
MAX_BUFFER
] = {0};

659 cÚ¡ *
v®
 = 
NULL
;

661 if((
v®
 = 
	`cupsG‘O±iÚ
(
HPPJLDRYTIME
, 
num_İtiÚs
, 
İtiÚs
)è!ğ
NULL
)

663 
	`¡ºıy
(
šput_¦Ù
, 
v®
, 
	`¡¾’
(val));

664 if(
šput_¦Ù
)

666 if((
	`RemoveCh¬aù”s
(
šput_¦Ù
)) == -1)

668 
	`årštf
(
¡d”r
, "HP PS filter func = WriteHPPJLDRYTIME : DRYTIME FAILED\n");

671 if((
	`¡rcmp
(
šput_¦Ù
, "Medium")) == 0)

672 
	`hpwr™e
("@PJL SET DRYTIME=4\x0a", 
	`¡¾’
("@PJL SET DRYTIME=4\x0a"));

673 if((
	`¡rcmp
(
šput_¦Ù
, "Long")) == 0)

674 
	`hpwr™e
("@PJL SET DRYTIME=7\x0a", 
	`¡¾’
("@PJL SET DRYTIME=7\x0a"));

676 
	`hpwr™e
("@PJL SET DRYTIME=0\x0a", 
	`¡¾’
("@PJL SET DRYTIME=0\x0a"));

680 
	`hpwr™e
("@PJL SET DRYTIME=0\x0a", 
	`¡¾’
("@PJL SET DRYTIME=0\x0a"));

681 
	`årštf
(
¡d”r
, "HP PS filter func = WriteHPPJLDRYTIME : WRITING DRYTIME INFO\n");

683 
	}
}

691 
	$Wr™eHPPJLSATURATION
(
num_İtiÚs
, 
cups_İtiÚ_t
 *
İtiÚs
)

693 
šput_¦Ù
[
MAX_BUFFER
] = {0};

694 cÚ¡ *
v®
 = 
NULL
;

696 if((
v®
 = 
	`cupsG‘O±iÚ
(
HPPJLSATURATION
, 
num_İtiÚs
, 
İtiÚs
)è!ğ
NULL
)

698 
	`¡ºıy
(
šput_¦Ù
, 
v®
, 
	`¡¾’
(val));

699 if(
šput_¦Ù
)

701 if((
	`RemoveCh¬aù”s
(
šput_¦Ù
)) == -1)

703 
	`årštf
(
¡d”r
, "HP PS filter func = WriteHPPJLSATURATION : SATURATION FAILED\n");

706 if((
	`¡rcmp
(
šput_¦Ù
, "-2")) == 0)

707 
	`hpwr™e
("@PJL SET SATURATION=0\x0a", 
	`¡¾’
("@PJL SET SATURATION=0\x0a"));

708 if((
	`¡rcmp
(
šput_¦Ù
, "-1")) == 0)

709 
	`hpwr™e
("@PJL SET SATURATION=2\x0a", 
	`¡¾’
("@PJL SET SATURATION=2\x0a"));

710 if((
	`¡rcmp
(
šput_¦Ù
, "0")) == 0)

711 
	`hpwr™e
("@PJL SET SATURATION=4\x0a", 
	`¡¾’
("@PJL SET SATURATION=4\x0a"));

712 if((
	`¡rcmp
(
šput_¦Ù
, "1")) == 0)

713 
	`hpwr™e
("@PJL SET SATURATION=6\x0a", 
	`¡¾’
("@PJL SET SATURATION=6\x0a"));

714 if((
	`¡rcmp
(
šput_¦Ù
, "2")) == 0)

715 
	`hpwr™e
("@PJL SET SATURATION=8\x0a", 
	`¡¾’
("@PJL SET SATURATION=8\x0a"));

717 
	`hpwr™e
("@PJL SET SATURATION=4\x0a", 
	`¡¾’
("@PJL SET SATURATION=4\x0a"));

721 
	`hpwr™e
("@PJL SET SATURATION=4\x0a", 
	`¡¾’
("@PJL SET SATURATION=4\x0a"));

722 
	`årštf
(
¡d”r
, "HP PS filter func = WriteHPPJLSATURATION : WRITING SATURATION INFO\n");

724 
	}
}

732 
	$Wr™eHPPJLINKBLEED
(
num_İtiÚs
, 
cups_İtiÚ_t
 *
İtiÚs
)

734 
šput_¦Ù
[
MAX_BUFFER
] = {0};

735 cÚ¡ *
v®
 = 
NULL
;

737 if((
v®
 = 
	`cupsG‘O±iÚ
(
HPPJLINKBLEED
, 
num_İtiÚs
, 
İtiÚs
)è!ğ
NULL
)

739 
	`¡ºıy
(
šput_¦Ù
, 
v®
, 
	`¡¾’
(val));

740 if(
šput_¦Ù
)

742 if((
	`RemoveCh¬aù”s
(
šput_¦Ù
)) == -1)

744 
	`årštf
(
¡d”r
, "HP PS filter func = WriteHPPJLINKBLEED : INKBLEED FAILED\n");

747 if((
	`¡rcmp
(
šput_¦Ù
, "-2")) == 0 || (strcmp(input_slot, "Default")) == 0)

748 
	`hpwr™e
("@PJL SET INKBLEED=0\x0a", 
	`¡¾’
("@PJL SET INKBLEED=0\x0a"));

749 if((
	`¡rcmp
(
šput_¦Ù
, "-1")) == 0)

750 
	`hpwr™e
("@PJL SET INKBLEED=2\x0a", 
	`¡¾’
("@PJL SET INKBLEED=2\x0a"));

751 if((
	`¡rcmp
(
šput_¦Ù
, "1")) == 0)

752 
	`hpwr™e
("@PJL SET INKBLEED=6\x0a", 
	`¡¾’
("@PJL SET INKBLEED=6\x0a"));

753 if((
	`¡rcmp
(
šput_¦Ù
, "2")) == 0)

754 
	`hpwr™e
("@PJL SET INKBLEED=8\x0a", 
	`¡¾’
("@PJL SET INKBLEED=8\x0a"));

755 if((
	`¡rcmp
(
šput_¦Ù
, "Least")) == 0)

756 
	`hpwr™e
("@PJL SET INKBLEED=7\x0a", 
	`¡¾’
("@PJL SET INKBLEED=7\x0a"));

758 
	`hpwr™e
("@PJL SET INKBLEED=4\x0a", 
	`¡¾’
("@PJL SET INKBLEED=4\x0a"));

762 
	`hpwr™e
("@PJL SET INKBLEED=4\x0a", 
	`¡¾’
("@PJL SET INKBLEED=4\x0a"));

763 
	`årštf
(
¡d”r
, "HP PS filter func = WriteHPPJLINKBLEED : WRITING INKBLEED INFO\n");

765 
	}
}

773 
	$Wr™eHPPJLCOLORASGRAY
(
num_İtiÚs
, 
cups_İtiÚ_t
 *
İtiÚs
)

775 
šput_¦Ù
[
MAX_BUFFER
] = {0};

776 cÚ¡ *
v®
 = 
NULL
;

778 if((
v®
 = 
	`cupsG‘O±iÚ
(
HPPJLCOLORASGRAY
, 
num_İtiÚs
, 
İtiÚs
)è!ğ
NULL
)

780 
	`¡ºıy
(
šput_¦Ù
, 
v®
, 
	`¡¾’
(val));

781 if(
šput_¦Ù
)

783 if((
	`RemoveCh¬aù”s
(
šput_¦Ù
)) == -1)

785 
	`årštf
(
¡d”r
, "HP PS filter func = WriteHPPJLCOLORASGRAY : COLORASGRAY FAILED\n");

788 if((
	`¡rcmp
(
šput_¦Ù
, "HighQuality")) == 0 || (strcmp(input_slot, "Default")) == 0)

790 
	`hpwr™e
("@PJL SET GRAYSCALE=COMPOSITE\x0a", 
	`¡¾’
("@PJL SET GRAYSCALE=COMPOSITE\x0a"));

791 
	`hpwr™e
("@PJL SET PLANESINUSE=1\x0a", 
	`¡¾’
("@PJL SET PLANESINUSE=1\x0a"));

793 if((
	`¡rcmp
(
šput_¦Ù
, "BlackInkOnly")) == 0)

795 
	`hpwr™e
("@PJL SET GRAYSCALE=BLACKONLY\x0a", 
	`¡¾’
("@PJL SET GRAYSCALE=BLACKONLY\x0a"));

796 
	`hpwr™e
("@PJL SET PLANESINUSE=1\x0a", 
	`¡¾’
("@PJL SET PLANESINUSE=1\x0a"));

798 if((
	`¡rcmp
(
šput_¦Ù
, "yes")) == 0 || (strcmp(input_slot, "on")) == 0)

800 
	`hpwr™e
("@PJL SET RESOLUTION=600\x0a", 
	`¡¾’
("@PJL SET RESOLUTION=600\x0a"));

801 
	`hpwr™e
("@PJL SET BITSPERPIXEL=8\x0a", 
	`¡¾’
("@PJL SET BITSPERPIXEL=8\x0a"));

802 
	`hpwr™e
("@PJL SET GRAYSCALE=COMPOSITE\x0a", 
	`¡¾’
("@PJL SET GRAYSCALE=COMPOSITE\x0a"));

804 if((
	`¡rcmp
(
šput_¦Ù
, "no")) == 0)

806 
	`hpwr™e
("@PJL SET RESOLUTION=600\x0a", 
	`¡¾’
("@PJL SET RESOLUTION=600\x0a"));

807 
	`hpwr™e
("@PJL SET BITSPERPIXEL=8\x0a", 
	`¡¾’
("@PJL SET BITSPERPIXEL=8\x0a"));

809 if((
	`¡rcmp
(
šput_¦Ù
, "Plain")) == 0 || (strcmp(input_slot, "True")) == 0)

810 
	`hpwr™e
("@PJL SET PLANESINUSE=1\x0a", 
	`¡¾’
("@PJL SET PLANESINUSE=1\x0a"));

812 
	`hpwr™e
("@PJL SET GRAYSCALE=OFF\x0a", 
	`¡¾’
("@PJL SET GRAYSCALE=OFF\x0a"));

816 
	`hpwr™e
("@PJL SET GRAYSCALE=OFF\x0a", 
	`¡¾’
("@PJL SET GRAYSCALE=OFF\x0a"));

817 
	`årštf
(
¡d”r
, "HP PS filter func = WriteHPPJLCOLORASGRAY : WRITING COLORASGRAY INFO\n");

819 
	}
}

827 
	$Wr™eHPPJLTRUEBLACK
(
num_İtiÚs
, 
cups_İtiÚ_t
 *
İtiÚs
)

829 
šput_¦Ù
[
MAX_BUFFER
] = {0};

830 cÚ¡ *
v®
 = 
NULL
;

832 if((
v®
 = 
	`cupsG‘O±iÚ
(
HPPJLTRUEBLACK
, 
num_İtiÚs
, 
İtiÚs
)è!ğ
NULL
)

834 
	`¡ºıy
(
šput_¦Ù
, 
v®
, 
	`¡¾’
(val));

835 if(
šput_¦Ù
)

837 if((
	`RemoveCh¬aù”s
(
šput_¦Ù
)) == -1)

839 
	`årštf
(
¡d”r
, "HP PS filter func = WriteHPPJLTRUEBLACK : TRUEBLACK FAILED\n");

842 if((
	`¡rcmp
(
šput_¦Ù
, "HighQuality")) == 0)

843 
	`hpwr™e
("@PJL SET GRAYSCALE=COMPOSITE\x0a", 
	`¡¾’
("@PJL SET GRAYSCALE=COMPOSITE\x0a"));

845 
	`hpwr™e
("@PJL SET GRAYSCALE=BLACKONLY\x0a", 
	`¡¾’
("@PJL SET GRAYSCALE=BLACKONLY\x0a"));

849 
	`hpwr™e
("@PJL SET GRAYSCALE=BLACKONLY\x0a", 
	`¡¾’
("@PJL SET GRAYSCALE=BLACKONLY\x0a"));

850 
	`årštf
(
¡d”r
, "HP PS filter func = WriteHPPJLTRUEBLACK : WRITING TRUEBLACK INFO\n");

852 
	}
}

855 
	$maš
 (
¬gc
, **
¬gv
)

857 
cups_fe_t
 *
å_šput
 = 
NULL
;

858 
cups_fe_t
 *
å_bookËtšput
 = 
NULL
;

859 
cups_İtiÚ_t
 *
İtiÚs
 = 
NULL
;

860 
lše
[
LINE_SIZE
] = {0},

861 
job_id
[
MAX_BUFFER
] = {0},

862 
u£r
[
MAX_BUFFER
] = {0},

863 
t™Ë
[
MAX_BUFFER
] = {0},

864 
cİ›s
[
MAX_BUFFER
] = {0},

865 
šput_¦Ù
[
MAX_BUFFER
] = {0};

866 
couÁ
 = 0;

867 *
µd_v®ues
 = 
NULL
;

868 
Üd”
 = 1;

869 
nup
 = 2;

870 
Ãwlše
[64] = {0};

871 *
subSŒšg
 = 
NULL
;

872 
bookËt_’abËd
=0;

873 
bookËtMak”
=0;

874 
bufãr
[
MAX_BUFFER
] = {0};

876 
	`g‘_LogLev–
();

877 
	`£tbuf
 (
¡d”r
, 
NULL
);

879 
	`årštf
 (
¡d”r
, "HP PS f‹¸¡¬tšg : % \n", *
¬gv
);

882 
couÁ
 = 0; couÁ < 
¬gc
; count++)

883 
	`årštf
 (
¡d”r
, "DEBUG: hµsf‹r:‡rgv[%d] = %s\n", 
couÁ
, 
¬gv
[count]);

886 ià(
g_§v•sfe
 & 
SAVE_PS_FILE
)

887 
	`İ’_dbg_outfe
(
¬gv
[1]);

890 ià(
¬gc
 < 6 ||‡rgc > 7)

892 
	`åuts
("ERROR: hµsf‹¸job-id u£¸t™Ë cİ› İtiÚ [fe]\n", 
¡d”r
);

897 ià(
¬gc
 == 6)

898 
å_šput
 = 
	`cupsFeStdš
();

902 ià((
å_šput
 = 
	`cupsFeO³n
(
¬gv
[6], "r")è=ğ
NULL
)

904 
	`årštf
(
¡d”r
, "ERROR: UÇbËØİ’…ršˆf\"%s\"", 
¬gv
[6]);

909 
num_İtiÚs
 = 
	`cupsP¬£O±iÚs
(
¬gv
[5], 0, &
İtiÚs
);

911 if(
İtiÚs
)

913 
	`Wr™eH—d”
(
¬gv
);

914 
µd_v®ues
 = 
	`G‘PPDV®ues
();

915 if((
	`¡r¡r
(
¬gv
[5], "HPPšPºt")è!ğ
NULL
 && (strstr(argv[5], "noHPPinPrnt"))== NULL)

916 
	`Wr™eSecu»Prštšg
(
µd_v®ues
[0], 
num_İtiÚs
, 
İtiÚs
);

917 ifĞ((
	`¡r¡r
(
¬gv
[5], "HPBookËtF‹r")è!ğ
NULL
) && ((strstr(argv[5], "fitplot")) != NULL) && ((strstr(argv[5], "Duplex=DuplexTumble")) != NULL) && ((strstr(argv[5], "number-up=1")) != NULL) )

919 
bookËt_’abËd
 = 1;

920 
Üd”
 = 1;

921 if((
subSŒšg
 = 
	`¡r¡r
(
¬gv
[5], "HPBookËtPageSize")è!ğ
NULL
)

923 
	`¡ºıy
(
Ãwlše
, 
subSŒšg
,64);

924 
subSŒšg
 = 
	`¡¹ok
(
Ãwlše
,"=");

925 
subSŒšg
 = 
	`¡¹ok
(
NULL
," ");

928 
subSŒšg
 = "letter";

931 
bookËt_’abËd
 = 0;

933 ifĞ((
	`¡r¡r
(
¬gv
[5], "FŞdSt™ch")è!ğ
NULL
))

935 
bookËtMak”
=1;

938 if(
µd_v®ues
[1] == 1)

939 
	`Wr™eJobAccouÁšg
(
¬gv
, 
num_İtiÚs
, 
İtiÚs
);

940 ifĞĞ(
	`¡r¡r
(
¬gv
[5], "HPU£rAcûssCode=Cu¡om"))!=
NULL
è&& (
µd_v®ues
[12] == 1))

942 
	`¥rštf
(
bufãr
, "@PJL SET JOBATTR=\"JobAcù17=%s\"\x0a", 
fš®¡r
);

943 
	`hpwr™e
(
bufãr
, 
	`¡¾’
(buffer));

944 
	`mem£t
(
bufãr
, 0, (buffer));

947 if(
µd_v®ues
[2] == 1)

948 
	`Wr™eBÜnOnD©e
();

949 if(
µd_v®ues
[3] == 1)

950 
	`Wr™eECONOMODE
(
¬gv
);

951 if(
µd_v®ues
[4] == 1)

952 
	`Wr™eECONOMODE2
(
num_İtiÚs
, 
İtiÚs
);

953 if(
µd_v®ues
[5] == 1)

954 
	`Wr™eHPPJLPRINTQUALITY
(
num_İtiÚs
, 
İtiÚs
);

955 if(
µd_v®ues
[6] == 1)

956 
	`Wr™eHPPJLOUTPUTMODE
(
num_İtiÚs
, 
İtiÚs
);

957 if(
µd_v®ues
[7] == 1)

958 
	`Wr™eHPPJLDRYTIME
(
num_İtiÚs
, 
İtiÚs
);

959 if(
µd_v®ues
[8] == 1)

960 
	`Wr™eHPPJLSATURATION
(
num_İtiÚs
, 
İtiÚs
);

961 if(
µd_v®ues
[9] == 1)

962 
	`Wr™eHPPJLINKBLEED
(
num_İtiÚs
, 
İtiÚs
);

963 if(
µd_v®ues
[10] == 1)

964 
	`Wr™eHPPJLCOLORASGRAY
(
num_İtiÚs
, 
İtiÚs
);

965 if(
µd_v®ues
[11] == 1)

966 
	`Wr™eHPPJLTRUEBLACK
(
num_İtiÚs
, 
İtiÚs
);

967 
	`hpwr™e
("@PJL ENTER LANGUAGE=POSTSCRIPT\x0a", 
	`¡¾’
("@PJL ENTER LANGUAGE=POSTSCRIPT\x0a"));

969 
numBy‹s
 = 0;

972 if(
bookËt_’abËd
)

975 
	`¥rštf
(
bookËt_f’ame
, "/tmp/%s.ps","booklet");

976 
	`¥rštf
(
‹mp_f’ame
, "/tmp/%s.ps","temp");

977 
	`¥rštf
(
Nup_f’ame
, "/tmp/%s.ps","NUP");

978 
	`İ’_‹mpbookËtfe
("w");

979  (
numBy‹s
 = 
	`cupsFeG‘Lše
(
å_šput
, 
lše
, (line))) > 0)

980 
	`Dump_‹mpbookËtfe
 (
lše
, 
numBy‹s
);

981 
	`fşo£
(
±empbookËt_fe
);

984 
	`PS_BookËt
(
‹mp_f’ame
,
bookËt_f’ame
,
Nup_f’ame
,
Üd”
,
nup
,
subSŒšg
,
bookËtMak”
);

987 
numBy‹s
 = 0;

988 ià((
å_bookËtšput
 = 
	`cupsFeO³n
(
Nup_f’ame
, "r")è=ğ
NULL
)

990 
	`årštf
(
¡d”r
, "ERROR: UÇbËØİ’ Nup_f’am´šˆf\"%s\"", 
Nup_f’ame
);

993  (
numBy‹s
 = 
	`cupsFeG‘Lše
(
å_bookËtšput
, 
lše
, (line))) > 0)

994 
	`hpwr™e
 (
lše
, 
numBy‹s
);

995 
	`cupsFeClo£
 (
å_bookËtšput
);

998 ifĞ(
	`uÆšk
(
bookËt_f’ame
)) == -1)

1000 
	`årštf
(
¡d”r
, "ERROR: UÇbËØ»mov‹mpÜ¬y fe š /tm°dœ \"%s\" ",
bookËt_f’ame
);

1003 ifĞ(
	`uÆšk
(
‹mp_f’ame
)) == -1)

1005 
	`årštf
(
¡d”r
, "ERROR: UÇbËØ»mov‹mpÜ¬y fe š /tm°dœ \"%s\" ",
‹mp_f’ame
);

1008 ifĞ(
	`uÆšk
(
Nup_f’ame
)) == -1)

1010 
	`årštf
(
¡d”r
, "ERROR: UÇbËØ»mov‹mpÜ¬y fe š /tm°dœ \"%s\" ",
Nup_f’ame
);

1013 
bookËt_’abËd
 = 0;

1014 
bookËtMak”
=0;

1018  (
numBy‹s
 = 
	`cupsFeG‘Lše
(
å_šput
, 
lše
, (line))) > 0)

1019 
	`hpwr™e
 (
lše
, 
numBy‹s
);

1023 
	`hpwr™e
("\x1b%-12345X@PJL EOJ\x0a\x1b%-12345X", 
	`¡¾’
("\x1b%-12345X@PJL EOJ\x0a\x1b%-12345X"));

1024 iàĞ(
¬gc
 =ğ7è&& (
å_šput
 !ğ
NULL
) )

1025 
	`cupsFeClo£
 (
å_šput
);

1027 if(
g_å_outdbgps
 !ğ
NULL
)

1029 
	`fşo£
 (
g_å_outdbgps
);

1031 
	`årštf
 (
¡d”r
, "HP PS filter ENDS\n");

1033 
	}
}

	@prnt/hpps/hppsfilter.h

1 #iâdeà
_HPPSFILTER_H


2 
	#_HPPSFILTER_H


	)

6 
	~<¡dio.h
>

7 
	~<¡ršg.h
>

8 
	~<memÜy.h
>

9 
	~<¡dlib.h
>

10 
	~<uni¡d.h
>

11 
	~<fú.h
>

12 
	~<cups/cups.h
>

13 
	~<cups/µd.h
>

14 
	~<sys/ty³s.h
>

15 
	~<sys/¡©.h
>

17 
	#MAX_PJL
 10

	)

18 
	#MAX_BUFFER
 256

	)

20 
	#PJL_HEADER
 "\x1B%-12345X@PJL\x0A"

	)

21 
	#BOD_PJL_FIXED
 "0400040101020D10100115"

	)

22 
	#BOD_PPD_ATR
 "HPBOD"

	)

23 
	#HPDIGT_ATR
 "HPDig™"

	)

24 
	#BOD_PJL
 "@PJL DMINFO ASCIIHEX=\"%s%s\"\012"

	)

25 
	#BOD_DATETIME_FORMAT
 "%04d%02d%02d%02d%02d%02d"

	)

26 
	#DBG_PSFILE
 "hµs_job"

	)

27 
	#DBG_TMP_FOLDER
 "/v¬/log/hp/tmp/"

	)

29 
	#LINE_SIZE
 258

	)

30 
	#FILE_NAME_SIZE
 128

	)

32 
	#SAVE_PS_FILE
 2

	)

34 
	#HPBOD
 "HPBOD"

	)

35 
	#HPACCOUNTINGINFO
 "HPAccouÁšgInfo"

	)

36 
	#HPPJLECONOMODE
 "HPPJLEcÚoMode"

	)

37 
	#HPPJLECONOMODE2
 "HPPJLEcÚoMode2"

	)

38 
	#HPPJLPRINTQUALITY
 "HPPJLPrštQu®™y"

	)

39 
	#HPPJLOUTPUTMODE
 "HPPJLOuutMode"

	)

40 
	#HPPJLDRYTIME
 "HPPJLDryTime"

	)

41 
	#HPPJLSATURATION
 "HPPJLS©u¿tiÚ"

	)

42 
	#HPPJLINKBLEED
 "HPPJLInkBËed"

	)

43 
	#HPPJLCOLORASGRAY
 "HPPJLCŞÜAsG¿y"

	)

44 
	#HPPJLTRUEBLACK
 "HPPJLTrueBÏck"

	)

	@prnt/hpps/patchlev.h

5 
	#RELEASE
 1

	)

6 
	#PATCHLEVEL
 17

	)

	@prnt/hpps/psbooklet.c

10 
	~<¡dio.h
>

11 
	~<¡dlib.h
>

12 
	~"psut.h
"

13 
	~"ps¥ec.h
"

14 
	~"p£¼Ü.h
"

15 
	~"·tchËv.h
"

16 
	~"hµsf‹r.h
"

19 
	#MIN
(
x
,
y
è((xè> (yè? (yè: (x))

	)

20 
	#MAX
(
x
,
y
è((xè> (yè? (xè: (y))

	)

23 *
	g´og¿m
;

24 
	g·ges
;

25 
	gv”bo£
;

26 
	g·g–ab–
[
BUFSIZ
];

27 
	g·g’o
;

28 
FILE
 *
	gšfe
 = 
NULL
;

29 
FILE
 *
	goutfe
ğ
NULL
;

32 
	snode
 {

33 
	md©a
[4];

34 
node
 *
	mÃxt
;

35 }*
	gh—d
;

36 
node
 *
	gÃwNode
=
NULL
;

37 
node
 *
	g‹mp
=
NULL
;

38 *
	gd©a
=
NULL
;

41 
ü—‹PageLi¡
(
max·ges
, *
d©a
, 
bookËtMak”
);

42 
PageLi¡cİy
();

43 
ä“Li¡
(
node
* 
h—d
);

44 
PS_BookËt
(*
‹mpfe
, *
bookËtfe
, *
nupfe
,
Üd”
, 
nup
, * 
·gesize
, 
bookËtMak”
);

45 
PS_BookËt_Ord”_W¿µ”
(*
šputfe
, *
ouutfe
, 
Üd”
, 
bookËtMak”
);

46 
PS_Nup_W¿µ”
(*
šputfe
, *
ouutfe
, *
·³rsize
, 
nu²umb”
);

51 
	$Ãxtdiv
(
n
, 
m
)

53 ++
n
 <ğ
m
) {

54 ià(
m
%
n
 == 0)

55  (
n
);

58 
	}
}

61 
	$PS_BookËt
(*
‹mpfe
, *
bookËtfe
, *
nupfe
,
Üd”
, 
nup
, * 
·gesize
, 
bookËtMak”
)

65 
	`PS_BookËt_Ord”_W¿µ”
(
‹mpfe
,
bookËtfe
,
Üd”
, 
bookËtMak”
);

67 
	`PS_Nup_W¿µ”
(
bookËtfe
,
nupfe
,
·gesize
,
nup
);

68 
	}
}

70 
	$ü—‹PageLi¡
(
max·ges
, *
d©a
, 
bookËtMak”
)

72 
i
=0;

73 
j
=0;

74 
k
=0;

75 
n
 = 
max·ges
/4;

76 
node
 *
node
;

77 
h—d
 = (
node
 *)
	`m®loc
((node));

80 if(
h—d
 =ğ
NULL
)

82 
	`mes§ge
(
FATAL
, "\nUnableo‡llocate memory for head‚ode.\n");

87 
k
=0;k<4;k++)

89 
h—d
->
d©a
[
k
] = d©a[
j
];

90 
j
= j+1;

92 
h—d
->
Ãxt
 = 
NULL
;

94 
‹mp
 = 
h—d
;

97 
i
=2; i<=
n
; i++)

99 
‹mp
=
h—d
;

100 
ÃwNode
 = (
node
 *)
	`m®loc
((node));

103 if(
ÃwNode
 =ğ
NULL
)

105 
	`mes§ge
(
FATAL
, "\nUnableo‡llocate memory for‚ew‚ode.\n");

110 
k
=0;k<4;k++)

112 
ÃwNode
->
d©a
[
k
] = d©a[
j
];

113 
j
= j+1;

115 if(
bookËtMak”
){

116 
ÃwNode
->
Ãxt
 = 
h—d
;

117 
h—d
 = 
ÃwNode
;

120 
‹mp
->
Ãxt
 !=
NULL
)

121 
‹mp
ğ‹mp->
Ãxt
;

123 
ÃwNode
->
Ãxt
 = 
NULL
;

124 
‹mp
->
Ãxt
 = 
ÃwNode
;

132 
	}
}

135 
	$PageLi¡cİy
()

137 
node
 *
‹m²ode
;

138 
i
=0;

141 if(
h—d
 =ğ
NULL
)

143 
	`mes§ge
(
FATAL
, "\nHead ofhe List isƒmpty.\n");

147 
‹m²ode
 = 
h—d
;

149 
‹m²ode
 !ğ
NULL
)

151 
i
=0;i<4;i++)

153 ià(
‹m²ode
->
d©a
[
i
] < 
·ges
)

155 
	`wr™•age
(
‹m²ode
->
d©a
[
i
]);

159 
	`wr™“m±y·ge
();

162 
‹m²ode
 =em²ode->
Ãxt
;

165 
	}
}

167 
	$ä“Li¡
(
node
* 
h—d
)

169 
node
* 
tmp
;

171 
h—d
 !ğ
NULL
)

173 
tmp
 = 
h—d
;

174 
h—d
 = h—d->
Ãxt
;

175 
	`ä“
(
tmp
);

177 
ÃwNode
=
NULL
;

178 
‹mp
=
NULL
;

180 
	}
}

183 
	$PS_BookËt_Ord”_W¿µ”
(*
šputfe
, *
ouutfe
, 
Üd”
, 
bookËtMak”
)

185 
sigÇtu»
 = 0;

186 
cu¼’g
 = 0;

187 
max·ge
 = 0;

188 
šdex
=0;

190 ià((
šfe
 = 
	`fİ’
(
šputfe
, "r")è=ğ
NULL
)

192 
	`mes§ge
(
FATAL
, "ÿn'ˆİ’ iÅuˆf%s\n", 
šfe
);

195 ià((
outfe
 = 
	`fİ’
(
ouutfe
, "w")è=ğ
NULL
)

197 
	`mes§ge
(
FATAL
, "ÿn'ˆİ’ ouuˆf%s\n", 
outfe
);

200 ià((
šfe
=
	`£ekabË
(šfe))==
NULL
)

202 
	`mes§ge
(
FATAL
, "can't seek input\n");

205 
	`sÿÅages
();

207 ià(!
sigÇtu»
)

208 
sigÇtu»
 = 
max·ge
 = 
·ges
+(4-pages%4)%4;

210 
max·ge
 = 
·ges
+(
sigÇtu»
-pages%signature)%signature;

213 
	`wr™eh—d”
(
max·ge
);

214 
	`wr™•rŞog
();

215 
	`wr™e£tup
();

217 
d©a
 = (*)
	`m®loc
((è* 
max·ge
);

218 if(
d©a
 =ğ
NULL
)

220 
	`mes§ge
(
FATAL
, "\ncan't create dynamic memory for booklet…age ordering\n");

222 
cu¼’g
 = 0; cu¼’g < 
max·ge
; currentpg++) {

223 
aùu®pg
 = 
cu¼’g
 - cu¼’g%
sigÇtu»
;

224 
cu¼’g
%4) {

227 
aùu®pg
 +ğ
sigÇtu»
-1-(
cu¼’g
%signature)/2;

231 
aùu®pg
 +ğ(
cu¼’g
%
sigÇtu»
)/2;

235 
d©a
[
šdex
++]=
aùu®pg
;

238 
	`ü—‹PageLi¡
(
max·ge
, 
d©a
, 
bookËtMak”
);

239 
	`PageLi¡cİy
();

241 
	`ä“
(
d©a
);

242 
	`ä“Li¡
(
h—d
);

244 
	`wr™‘¿”
();

245 
	`fşo£
(
šfe
);

246 
	`fşo£
(
outfe
);

247 
	}
}

249 
	$PS_Nup_W¿µ”
(*
šputfe
, *
ouutfe
, *
·³rsize
, 
nu²umb”
)

251 
hÜiz
, 
v”t
, 
rÙ©e
, 
cŞumn
, 
æ
, 
Ëáright
, 
tİbÙtom
;

252 
nup
 = 1;

253 
d¿w
 = 0;

254 
xsÿË
, 
ysÿË
, 
sÿË
;

255 
usÿË
 = 0;

256 
µwid
, 
µhgt
;

257 
m¬gš
, 
bÜd”
;

258 
vshiá
, 
hshiá
;

259 
iwidth
, 
iheight
 ;

260 
tŞ”ªû
 = 100000;

261 
P­”
 *
·³r
;

263 
m¬gš
 = 
bÜd”
 = 
vshiá
 = 
hshiá
 = 
cŞumn
 = 
æ
 = 0;

264 
Ëáright
 = 
tİbÙtom
 = 1;

265 
iwidth
 = 
iheight
 = -1 ;

266 
v”bo£
 = 1;

268 ià((
šfe
 = 
	`fİ’
(
šputfe
, "r")è=ğ
NULL
)

270 
	`mes§ge
(
FATAL
, "ÿn'ˆİ’ iÅuˆf%s\n", 
šfe
);

273 ià((
outfe
 = 
	`fİ’
(
ouutfe
, "w")è=ğ
NULL
)

275 
	`mes§ge
(
FATAL
, "ÿn'ˆİ’ ouuˆf%s\n", 
outfe
);

278 ià((
šfe
=
	`£ekabË
(šfe))==
NULL
)

280 
	`mes§ge
(
FATAL
, "can't seek input\n");

283 ià((
·³r
 = 
	`fšd·³r
(
·³rsize
)è!ğ(
P­”
 *)0 )

285 
width
 = ()
	`P­”Width
(
·³r
);

286 
height
 = ()
	`P­”Height
(
·³r
);

289 
nup
ğ
nu²umb”
;

290 
m¬gš
 = 10;

292 
µwid
 = 
width
 - 
m¬gš
*2;

293 
µhgt
 = 
height
 - 
m¬gš
*2;

295 ià(
µwid
 <ğ0 || 
µhgt
 <= 0)

296 
	`mes§ge
(
FATAL
, "paper margins‡reoo†arge\n");

299 iàĞ
iwidth
 > 0 )

300 
width
 = 
iwidth
 ;

301 iàĞ
iheight
 > 0 )

302 
height
 = 
iheight
 ;

308 
be¡
 = 
tŞ”ªû
;

309 
hÜ
;

310 
hÜ
 = 1; hÜ; hÜ = 
	`Ãxtdiv
(hÜ, 
nup
)) {

311 
v”
 = 
nup
/
hÜ
;

313 
sş
 = 
	`MIN
(
µhgt
/(
height
*
v”
), 
µwid
/(
width
*
hÜ
));

314 
İtim
 = (
µwid
-
sş
*
width
*
hÜ
)*(ppwid-scl*width*hor) +

315 (
µhgt
-
sş
*
height
*
v”
)*(pphgt-scl*height*ver);

316 ià(
İtim
 < 
be¡
) {

317 
be¡
 = 
İtim
;

319 
ysÿË
 = 
	`MIN
((
µhgt
-2*
bÜd”
*
v”
)/(
height
*ver),

320 (
µwid
-2*
bÜd”
*
hÜ
)/(
width
*hor));

321 
xsÿË
 = 
ysÿË
;

322 
hshiá
 = (
µwid
/
hÜ
 - 
width
*
xsÿË
)/2;

323 
vshiá
 = (
µhgt
/
v”
 - 
height
*
ysÿË
)/2;

324 
hÜiz
 = 
hÜ
; 
v”t
 = 
v”
;

325 
rÙ©e
 = 
æ
;

328 
sş
 = 
	`MIN
(
µhgt
/(
width
*
hÜ
), 
µwid
/(
height
*
v”
));

329 
İtim
 = (
µhgt
-
sş
*
width
*
hÜ
)*(pphgt-scl*width*hor) +

330 (
µwid
-
sş
*
height
*
v”
)*(ppwid-scl*height*ver);

331 ià(
İtim
 < 
be¡
) {

332 
be¡
 = 
İtim
;

335 
ysÿË
 = 
	`MIN
((
µhgt
-2*
bÜd”
*
hÜ
)/(
width
*hor),

336 (
µwid
-2*
bÜd”
*
v”
)/(
height
*ver));

337 
xsÿË
 = 
ysÿË
;

338 
hshiá
 = (
µwid
/
v”
 - 
height
*
ysÿË
)/2;

339 
vshiá
 = (
µhgt
/
hÜ
 - 
width
*
xsÿË
)/2;

340 
hÜiz
 = 
v”
; 
v”t
 = 
hÜ
;

341 
rÙ©e
 = !
æ
;

346 ià(
be¡
 =ğ
tŞ”ªû
)

347 
	`mes§ge
(
FATAL
, "ÿn'ˆfšd‡cû±abË†ayouˆfÜ %d-up\n", 
nup
);

350 ià(
æ
) {

351 
tmp
 = 
width
;

352 
width
 = 
height
;

353 
height
 = 
tmp
;

356 ià(
rÙ©e
) {

357 
tmp
 = 
tİbÙtom
;

358 
tİbÙtom
 = !
Ëáright
;

359 
Ëáright
 = 
tmp
;

360 
cŞumn
 = !column;

365 
·ge
 = 0;

366 
PageS³c
 *
¥ecs
, *

;

368 

 = 
¥ecs
 = 
	`Ãw¥ec
();

370 
·ge
 < 
nup
) {

371 
up
, 
aüoss
;

373 ià(
cŞumn
) {

374 ià(
Ëáright
)

375 
aüoss
 = 
·ge
/
v”t
;

377 
aüoss
 = 
hÜiz
-1-
·ge
/
v”t
;

378 ià(
tİbÙtom
)

379 
up
 = 
v”t
-1-
·ge
%vert;

381 
up
 = 
·ge
%
v”t
;

383 ià(
Ëáright
)

384 
aüoss
 = 
·ge
%
hÜiz
;

386 
aüoss
 = 
hÜiz
-1-
·ge
%horiz;

387 ià(
tİbÙtom
)

388 
up
 = 
v”t
-1-
·ge
/
hÜiz
;

390 
up
 = 
·ge
/
hÜiz
;

392 ià(
rÙ©e
) {

393 

->
xoff
 = 
m¬gš
 + (
aüoss
+1)*
µwid
/
hÜiz
 - 
hshiá
;

394 

->
rÙ©e
 = 90;

395 

->
æags
 |ğ
ROTATE
;

397 

->
xoff
 = 
m¬gš
 + 
aüoss
*
µwid
/
hÜiz
 + 
hshiá
;

399 

->
·g’o
 = 
·ge
;

400 ià(
usÿË
 > 0)

401 

->
sÿË
 = 
usÿË
;

403 

->
xsÿË
 = xscale;

404 

->
ysÿË
 = yscale;

405 

->
æags
 |ğ
SCALE
;

406 

->
yoff
 = 
m¬gš
 + 
up
*
µhgt
/
v”t
 + 
vshiá
;

407 

->
æags
 |ğ
OFFSET
;

408 ià(++
·ge
 < 
nup
) {

409 

->
æags
 |ğ
ADD_NEXT
;

410 

->
Ãxt
 = 
	`Ãw¥ec
();

411 

 =a->
Ãxt
;

415 
	`p¡İs
(
nup
, 1, 0, 
¥ecs
, 
d¿w
);

417 
	`fşo£
(
šfe
);

418 
	`fşo£
(
outfe
);

419 
	}
}

	@prnt/hpps/pserror.c

8 *
´og¿m
 ;

10 
	~"psut.h
"

11 
	~"p£¼Ü.h
"

12 
	~"·tchËv.h
"

14 
	~<¡ršg.h
>

20 
	#MAX_MESSAGE
 256

	)

21 
	#MAX_FORMAT
 16

	)

22 
	#MAX_COLUMN
 78

	)

24 
	$mes§ge
(
æags
, *
fÜm©
, ...)

26 
va_li¡
 
¬gs
 ;

27 
cŞumn
 = 0 ;

28 
msgbuf
[
MAX_MESSAGE
] ;

29 *
buåŒ
 = 
msgbuf
 ;

31 iàĞ(
æags
 & 
MESSAGE_NL
è&& 
cŞumn
 != 0 ) {

32 
	`putc
('\n', 
¡d”r
) ;

33 
cŞumn
 = 0 ;

36 iàĞ
æags
 & 
MESSAGE_PROGRAM
 ) {

37 
	`¡rıy
(
buåŒ
, 
´og¿m
) ;

38 
buåŒ
 +ğ
	`¡¾’
(
´og¿m
) ;

39 *
buåŒ
++ = ':' ;

40 *
buåŒ
++ = ' ' ;

43 
	`va_¡¬t
(
¬gs
, 
fÜm©
) ;

44 iàĞ
fÜm©
 !ğ
NULL
 ) {

45 
c
 ;

46  (
c
 = *
fÜm©
++) != '\0' ) {

47 ià(
c
 == '%') {

48 
dÚe
, 
lÚgfÜm
, 
šdex
 ;

49 
fmtbuf
[
MAX_FORMAT
] ;

50 
lÚgfÜm
 = 
šdex
 = 0 ;

51 
fmtbuf
[
šdex
++] = 
c
 ;

53 
dÚe
 = 1 ;

54 
fmtbuf
[
šdex
++] = 
c
 = *
fÜm©
++ ;

55 
fmtbuf
[
šdex
] = '\0' ;

56 
c
) {

58 *
buåŒ
++ = '%' ;

63 
d
 = 
	`va_¬g
(
¬gs
, ) ;

64 
	`¥rštf
(
buåŒ
, 
fmtbuf
, 
d
) ;

65 
buåŒ
 +ğ
	`¡¾’
(bufptr) ;

70 iàĞ
lÚgfÜm
 ) {

71 
l
 = 
	`va_¬g
(
¬gs
, ) ;

72 
	`¥rštf
(
buåŒ
, 
fmtbuf
, 
l
) ;

74 
i
 = 
	`va_¬g
(
¬gs
, ) ;

75 
	`¥rštf
(
buåŒ
, 
fmtbuf
, 
i
) ;

77 
buåŒ
 +ğ
	`¡¾’
(bufptr) ;

81 *
s
 = 
	`va_¬g
(
¬gs
, *) ;

82 
	`¥rštf
(
buåŒ
, 
fmtbuf
, 
s
) ;

83 
buåŒ
 +ğ
	`¡¾’
(bufptr) ;

87 
lÚgfÜm
 = 1 ;

90 
dÚe
 = 0 ;

92 }  !
dÚe
 ) ;

93 } iàĞ
c
 == '\n' ) {

94 
Ën
 = 
buåŒ
 - 
msgbuf
 ;

95 *
buåŒ
++ = '\n' ;

96 *
buåŒ
 = '\0' ;

97 iàĞ
cŞumn
 + 
Ën
 > 
MAX_COLUMN
 && column > 0 ) {

98 
	`putc
('\n', 
¡d”r
) ;

99 
cŞumn
 = 0 ;

101 
	`åuts
(
buåŒ
 = 
msgbuf
, 
¡d”r
) ;

102 
cŞumn
 = 0 ;

104 *
buåŒ
++ = 
c
 ;

106 *
buåŒ
 = '\0' ;

108 
Ën
 = 
buåŒ
 - 
msgbuf
 ;

109 iàĞ
cŞumn
 + 
Ën
 > 
MAX_COLUMN
 && column > 0 ) {

110 
	`putc
('\n', 
¡d”r
) ;

111 
cŞumn
 = 0 ;

113 
	`åuts
(
msgbuf
, 
¡d”r
) ;

114 
cŞumn
 +ğ
Ën
 ;

116 
	`fæush
(
¡d”r
) ;

118 
	`va_’d
(
¬gs
) ;

120 iàĞ
æags
 & 
MESSAGE_EXIT
 )

121 
	`ex™
(1) ;

122 
	}
}

	@prnt/hpps/pserror.h

8 
	~<¡d¬g.h
>

11 
	#MESSAGE_NL
 1

	)

12 
	#MESSAGE_PROGRAM
 2

	)

13 
	#MESSAGE_EXIT
 4

	)

16 
	#FATAL
 (
MESSAGE_EXIT
|
MESSAGE_PROGRAM
|
MESSAGE_NL
)

	)

17 
	#WARN
 (
MESSAGE_NL
|
MESSAGE_PROGRAM
)

	)

18 
	#LOG
 0

	)

20 
mes§ge
(
æags
, *
fÜm©
, ...) ;

	@prnt/hpps/psspec.c

8 
	~"psut.h
"

9 
	~"ps¥ec.h
"

10 
	~"p£¼Ü.h
"

11 
	~"·tchËv.h
"

13 
	~<¡ršg.h
>

15 
	gwidth
 = -1;

16 
	gheight
 = -1;

19 
PageS³c
 *
	$Ãw¥ec
()

21 
PageS³c
 *
‹mp
 = (PageS³ø*)
	`m®loc
((PageSpec));

22 ià(
‹mp
 =ğ
NULL
)

23 
	`mes§ge
(
FATAL
, "out of memory\n");

24 
‹mp
->
»v”£d
 =emp->
·g’o
 =emp->
æags
 =emp->
rÙ©e
 = 0;

25 
‹mp
->
sÿË
 = 1;

26 
‹mp
->
xoff
 =emp->
yoff
 = 0;

27 
‹mp
->
Ãxt
 = 
NULL
;

28  (
‹mp
);

29 
	}
}

32 
	$·r£št
(**
¥
, (*
”rÜâ
)())

34 *
s
 = *
¥
;

35 
num
 = 
	`©oi
(
s
);

37 
	`isdig™
(*
s
))

38 
s
++;

39 ià(*
¥
 =ğ
s
è(*
”rÜâ
)() ;

40 *
¥
 = 
s
;

41  (
num
);

42 
	}
}

44 
	$·r£doubË
(**
¥
, (*
”rÜâ
)())

46 *
s
 = *
¥
;

47 
num
 = 
	`©of
(
s
);

49 
	`isdig™
(*
s
) || *s == '-' || *s == '.')

50 
s
++;

51 ià(*
¥
 =ğ
s
è(*
”rÜâ
)() ;

52 *
¥
 = 
s
;

53  (
num
);

54 
	}
}

56 
	$·r£dim’
(**
¥
, (*
”rÜâ
)())

58 
num
 = 
	`·r£doubË
(
¥
, 
”rÜâ
);

59 *
s
 = *
¥
;

61 ià(
	`¡ºcmp
(
s
, "pt", 2) == 0) {

62 
s
 += 2;

63 } ià(
	`¡ºcmp
(
s
, "in", 2) == 0) {

64 
num
 *= 72;

65 
s
 += 2;

66 } ià(
	`¡ºcmp
(
s
, "cm", 2) == 0) {

67 
num
 *= 28.346456692913385211;

68 
s
 += 2;

69 } ià(
	`¡ºcmp
(
s
, "mm", 2) == 0) {

70 
num
 *= 2.8346456692913385211;

71 
s
 += 2;

72 } ià(*
s
 == 'w') {

73 ià(
width
 < 0)

74 
	`mes§ge
(
FATAL
, "width‚ot initialised\n");

75 
num
 *ğ
width
;

76 
s
++;

77 } ià(*
s
 == 'h') {

78 ià(
height
 < 0)

79 
	`mes§ge
(
FATAL
, "height‚ot initialised\n");

80 
num
 *ğ
height
;

81 
s
++;

83 *
¥
 = 
s
;

84  (
num
);

85 
	}
}

87 
	$sšgËdim’
(*
¡r
, (*
”rÜâ
)(), (*
u§geâ
)())

89 
num
 = 
	`·r£dim’
(&
¡r
, 
”rÜâ
);

90 ià(*
¡r
è(*
u§geâ
)();

91  (
num
);

92 
	}
}

94 *
	g´Şogue
[] = {

95 #iâdeà
SHOWPAGE_LOAD


132 
NULL


135 
	$p¡İs
(
modulo
, 
µs
, 
nobšd
, 
PageS³c
 *
¥ecs
, 
d¿w
)

137 
thi¥g
, 
max·ge
;

138 
·gešdex
 = 0;

139 **
´o
;

141 
	`sÿÅages
();

143 
max·ge
 = ((
·ges
+
modulo
-1)/modulo)*modulo;

146 
	`wr™eh—d”
((
max·ge
/
modulo
)*
µs
);

147 #iâdeà
SHOWPAGE_LOAD


148 
	`wr™e¡ršg
("%%BeginProcSet: PStoPS");

150 
	`wr™e¡ršg
("%%BeginProcSet: PStoPS-spload");

152 ià(
nobšd
)

153 
	`wr™e¡ršg
("-nobind");

154 
	`wr™e¡ršg
(" 1 15\n");

155 
´o
 = 
´Şogue
; *pro;…ro++) {

156 
	`wr™e¡ršg
(*
´o
);

157 
	`wr™e¡ršg
("\n");

159 ià(
nobšd
)

160 
	`wr™e¡ršg
("/bind{}def\n");

161 
	`wr™e¡ršg
("%%EndProcSet\n");

163 ià(
	`wr™•¬rŞog
()) {

164 
	`wr™e¡ršg
("userdict/PStoPSxform PStoPSmatrix matrix currentmatrix\n");

165 
	`wr™e¡ršg
(" matrix invertmatrix matrix concatmatrix\n");

166 
	`wr™e¡ršg
(" matrix invertmatrix…ut\n");

168 
	`wr™e£tup
();

169 
thi¥g
 = 0;hi¥g < 
max·ge
;hi¥g +ğ
modulo
) {

170 
add_Ï¡
 = 0;

171 
PageS³c
 *
ps
;

172 
ps
 = 
¥ecs
;… !ğ
NULL
;… ğps->
Ãxt
) {

173 
aùu®pg
;

174 
add_Ãxt
 = ((
ps
->
æags
 & 
ADD_NEXT
) != 0);

175 ià(
ps
->
»v”£d
)

176 
aùu®pg
 = 
max·ge
-
thi¥g
-
modulo
+
ps
->
·g’o
;

178 
aùu®pg
 = 
thi¥g
+
ps
->
·g’o
;

179 ià(
aùu®pg
 < 
·ges
)

180 
	`£ek·ge
(
aùu®pg
);

181 ià(!
add_Ï¡
) {

182 
PageS³c
 *
Å
 = 
ps
;

183 *
eob
 = 
·g–ab–
;

184 
£p
 = '(';

186 *
eob
++ = 
£p
;

187 ià(
Å
->
»v”£d
)

188 
	`¥rštf
(
eob
, "%d", 
max·ge
-
thi¥g
-
modulo
+
Å
->
·g’o
);

190 
	`¥rštf
(
eob
, "%d", 
thi¥g
+
Å
->
·g’o
);

191 
eob
 =ƒob + 
	`¡¾’
(eob);

192 
£p
 = ',';

193 } (
Å
->
æags
 & 
ADD_NEXT
è&& (Å =‚p->
Ãxt
));

194 
	`¡rıy
(
eob
, ")");

195 
	`wr™•ageh—d”
(
·g–ab–
, ++
·gešdex
);

197 
	`wr™e¡ršg
("userdict/PStoPSsaved save…ut\n");

198 ià(
ps
->
æags
 & 
GSAVE
) {

199 
bufãr
[
BUFSIZ
];

200 
	`wr™e¡ršg
("PStoPSmatrix setmatrix\n");

201 ià(
ps
->
æags
 & 
OFFSET
) {

202 
	`¥rštf
(
bufãr
, "%à%àŒª¦©e\n", 
ps
->
xoff
,…s->
yoff
);

203 
	`wr™e¡ršg
(
bufãr
);

205 ià(
ps
->
æags
 & 
ROTATE
) {

206 
	`¥rštf
(
bufãr
, "%d„Ù©e\n", 
ps
->
rÙ©e
);

207 
	`wr™e¡ršg
(
bufãr
);

209 ià(
ps
->
æags
 & 
SCALE
) {

210 
	`¥rštf
(
bufãr
, "%à%àsÿË\n", 
ps
->
xsÿË
,…s->
ysÿË
);

211 
	`wr™e¡ršg
(
bufãr
);

213 
	`wr™e¡ršg
("userdict/PStoPSmatrix matrix currentmatrix…ut\n");

214 ià(
width
 > 0 && 
height
 > 0) {

215 
bufãr
[
BUFSIZ
];

216 
	`wr™e¡ršg
("userdict/PStoPSclip{0 0 moveto\n");

217 
	`¥rštf
(
bufãr
, " %f 0„lineto 0 %f„lineto -%f 0„lineto\n",

218 
width
, 
height
, width);

219 
	`wr™e¡ršg
(
bufãr
);

220 
	`wr™e¡ršg
(" closepath}put initclip\n");

221 ià(
d¿w
 > 0) {

222 
	`¥rštf
(
bufãr
, "g§vş·th 0 s‘g¿y %à£šewidth sŒokg»¡Üe\n", 
d¿w
);

223 
	`wr™e¡ršg
(
bufãr
);

227 ià(
add_Ãxt
) {

228 #iâdeà
SHOWPAGE_LOAD


229 
	`wr™e¡ršg
("/showpage{}def/copypage{}def/erasepage{}def\n");

231 
	`wr™e¡ršg
("/PStoPSshowpage{}store/PStoPScopypage{}store/PStoPSerasepage{}store\n");

234 ià(
aùu®pg
 < 
·ges
) {

235 
	`wr™•age£tup
();

236 
	`wr™e¡ršg
("PStoPSxform concat\n");

237 
	`wr™•agebody
(
aùu®pg
);

239 
	`wr™e¡ršg
("PStoPSxform concat\n");

240 
	`wr™e¡ršg
("showpage\n");

242 
	`wr™e¡ršg
("PStoPSsaved„estore\n");

243 
add_Ï¡
 = 
add_Ãxt
;

246 
	`wr™‘¿”
();

247 
	}
}

	@prnt/hpps/psspec.h

9 
	#ADD_NEXT
 (0x01)

	)

10 
	#ROTATE
 (0x02)

	)

11 
	#SCALE
 (0x04)

	)

12 
	#OFFSET
 (0x08)

	)

13 
	#GSAVE
 (
ROTATE
|
SCALE
|
OFFSET
)

	)

15 
	s·ge¥ec
 {

16 
	m»v”£d
, 
	m·g’o
, 
	mæags
, 
	mrÙ©e
;

17 
	mxoff
, 
	myoff
, 
	msÿË
, 
	mxsÿË
, 
	mysÿË
;

18 
·ge¥ec
 *
	mÃxt
;

19 } 
	tPageS³c
 ;

21 
width
, 
height
;

23 
PageS³c
 *
Ãw¥ec
();

24 
·r£št
(**
¥
, (*
”rÜâ
)());

25 
	`·r£doubË
(**
¥
, (*
”rÜâ
)());

26 
	`·r£dim’
(**
¥
, (*
”rÜâ
)());

27 
	`sšgËdim’
(*
¡r
, (*
”rÜâ
)(),

28 (*
u§geâ
)());

29 
	`p¡İs
(
modulo
, 
µs
, 
nobšd
, 
PageS³c
 *
¥ecs
,

30 
d¿w
);

	@prnt/hpps/psutil.c

16 
	~"psut.h
"

17 
	~"p£¼Ü.h
"

18 
	~"·tchËv.h
"

20 
	~<¡ršg.h
>

21 
	~<sys/ty³s.h
>

22 
	~<sys/¡©.h
>

24 
	#iscomm’t
(
x
,
y
è(
	`¡ºcmp
(x,y,
	`¡¾’
(y)è=ğ0)

	)

26 *
´og¿m
 ;

27 
·ges
;

28 
v”bo£
;

29 
FILE
 *
šfe
;

30 
FILE
 *
outfe
;

31 
·g–ab–
[
BUFSIZ
];

32 
·g’o
;

34 
	gbufãr
[
BUFSIZ
];

35 
	gby‹s
 = 0;

36 
	g·gescmt
 = 0;

37 
	gh—d”pos
 = 0;

38 
	g’d£tup
 = 0;

39 
	gbegš´oc£t
 = 0;

40 
	g’d´oc£t
 = 0;

41 
	gouuage
 = 0;

42 
	gmax·ges
 = 100;

43 *
	g·g•Œ
;

46 
P­”
 
	g·³rsizes
[] = {

64 { 
NULL
, 0, 0 }

68 
P­”
* 
	$fšd·³r
(*
Çme
)

70 
P­”
 *
µ
;

71 
µ
 = 
·³rsizes
; 
	`P­”Name
(pp);…p++) {

72 ià(
	`¡rcmp
(
	`P­”Name
(
µ
), 
Çme
) == 0) {

73 
	`årštf
 (
¡d”r
, "RAM:: P­”Nameğ% , P­”Width=%d P­”Heightğ%d\n",
	`P­”Name
(
µ
),
	`P­”Width
Õp),
	`P­”Height
(pp));

74  
µ
;

78  (
P­”
 *)
NULL
;

79 
	}
}

82 
FILE
 *
	$£ekabË
(
FILE
 *
å
)

84 #iâdeà
MSDOS


85 
FILE
 *
á
;

86 
r
, 
w
 ;

88 *
p
;

89 
bufãr
[
BUFSIZ
] ;

90 #ià
	`defšed
(
WINNT
)

91 
_¡©
 
fs
 ;

93 
åos
;

96 #ià
	`defšed
(
WINNT
)

97 ià(
	`_f¡©
(
	`f’o
(
å
), &
fs
è=ğ0 && (fs.
¡_mode
&
_S_IFREG
) != 0)

98  (
å
);

100 ià((
åos
 = 
	`á–l
(
å
)) >= 0)

101 ià(!
	`f£ek
(
å
, 0L, 
SEEK_END
è&& !f£ek(å, 
åos
, 
SEEK_SET
))

102  (
å
);

105 #ià
	`defšed
(
MSDOS
)

106 
	`mes§ge
(
FATAL
, "input is‚ot seekable\n");

107  (
NULL
) ;

109 ià((
á
 = 
	`tmpfe
()è=ğ
NULL
)

110  (
NULL
);

112 (
r
 = 
	`ä—d
(
p
 = 
bufãr
, (), 
BUFSIZ
, 
å
)) > 0) {

114 ià((
w
 = 
	`fwr™e
(
p
, (), 
r
, 
á
)) == 0)

115  (
NULL
) ;

116 
p
 +ğ
w
 ;

117 
r
 -ğ
w
 ;

118 } 
r
 > 0) ;

121 ià(!
	`ãof
(
å
))

122  (
NULL
) ;

125 (è
	`fşo£
(
å
);

126 ià(
	`f£ek
(
á
, 0L, 
SEEK_SET
) != 0)

127  (
NULL
) ;

129  (
á
);

131 
	}
}

135 
	$fcİy
(
u±o
)

137 
h”e
 = 
	`á–l
(
šfe
);

138 
h”e
 < 
u±o
) {

139 ià((
	`fg‘s
(
bufãr
, 
BUFSIZ
, 
šfe
è=ğ
NULL
) ||

140 (
	`åuts
(
bufãr
, 
outfe
è=ğ
EOF
))

142 
h”e
 = 
	`á–l
(
šfe
);

143 
by‹s
 +ğ
	`¡¾’
(
bufãr
);

146 
	}
}

149 
	$sÿÅages
()

151 *
comm’t
 = 
bufãr
+2;

152 
Ã¡šg
 = 0;

153 
»cÜd
;

155 ià((
·g•Œ
 = (*)
	`m®loc
(()*
max·ges
)è=ğ
NULL
)

156 
	`mes§ge
(
FATAL
, "out of memory\n");

157 
·ges
 = 0;

158 
	`f£ek
(
šfe
, 0L, 
SEEK_SET
);

159 
»cÜd
 = 
	`á–l
(
šfe
), 
	`fg‘s
(
bufãr
, 
BUFSIZ
, infeè!ğ
NULL
)

160 ià(*
bufãr
 == '%') {

161 ià(
bufãr
[1] == '%') {

162 ià(
Ã¡šg
 =ğ0 && 
	`iscomm’t
(
comm’t
, "Page:")) {

163 ià(
·ges
 >ğ
max·ges
-1) {

164 
max·ges
 *= 2;

165 ià((
·g•Œ
 = (*)
	`»®loc
((*)pageptr,

166 ()*
max·ges
)è=ğ
NULL
)

167 
	`mes§ge
(
FATAL
, "out of memory\n");

169 
·g•Œ
[
·ges
++] = 
»cÜd
;

170 } ià(
h—d”pos
 =ğ0 && 
	`iscomm’t
(
comm’t
, "Pages:"))

171 
·gescmt
 = 
»cÜd
;

172 ià(
h—d”pos
 =ğ0 && 
	`iscomm’t
(
comm’t
, "EndComments"))

173 
h—d”pos
 = 
	`á–l
(
šfe
);

174 ià(
	`iscomm’t
(
comm’t
, "BeginDocument") ||

175 
	`iscomm’t
(
comm’t
, "BeginBinary") ||

176 
	`iscomm’t
(
comm’t
, "BeginFile"))

177 
Ã¡šg
++;

178 ià(
	`iscomm’t
(
comm’t
, "EndDocument") ||

179 
	`iscomm’t
(
comm’t
, "EndBinary") ||

180 
	`iscomm’t
(
comm’t
, "EndFile"))

181 
Ã¡šg
--;

182 ià(
Ã¡šg
 =ğ0 && 
	`iscomm’t
(
comm’t
, "EndSetup"))

183 
’d£tup
 = 
»cÜd
;

184 ià(
Ã¡šg
 =ğ0 && 
	`iscomm’t
(
comm’t
, "BeginProlog"))

185 
h—d”pos
 = 
	`á–l
(
šfe
);

186 ià(
Ã¡šg
 == 0 &&

187 
	`iscomm’t
(
comm’t
, "BeginProcSet: PStoPS"))

188 
begš´oc£t
 = 
»cÜd
;

189 ià(
begš´oc£t
 && !
’d´oc£t
 &&

190 
	`iscomm’t
(
comm’t
, "EndProcSet"))

191 
’d´oc£t
 = 
	`á–l
(
šfe
);

192 ià(
Ã¡šg
 =ğ0 && (
	`iscomm’t
(
comm’t
, "Trailer") ||

193 
	`iscomm’t
(
comm’t
, "EOF"))) {

194 
	`f£ek
(
šfe
, 
»cÜd
, 
SEEK_SET
);

197 } ià(
h—d”pos
 =ğ0 && 
bufãr
[1] != '!')

198 
h—d”pos
 = 
»cÜd
;

199 } ià(
h—d”pos
 == 0)

200 
h—d”pos
 = 
»cÜd
;

201 
·g•Œ
[
·ges
] = 
	`á–l
(
šfe
);

202 ià(
’d£tup
 =ğ0 ||ƒnd£tu°> 
·g•Œ
[0])

203 
’d£tup
 = 
·g•Œ
[0];

204 
	}
}

207 
	$£ek·ge
(
p
)

209 
	`f£ek
(
šfe
, 
·g•Œ
[
p
], 
SEEK_SET
);

210 ià(
	`fg‘s
(
bufãr
, 
BUFSIZ
, 
šfe
è!ğ
NULL
 &&

211 
	`iscomm’t
(
bufãr
, "%%Page:")) {

212 *
¡¬t
, *
’d
;

213 
¡¬t
 = 
bufãr
+7; 
	`is¥aû
(*start); start++);

214 ià(*
¡¬t
 == '(') {

215 
·»n
 = 1;

216 
’d
 = 
¡¬t
+1; 
·»n
 > 0;ƒnd++)

217 *
’d
) {

219 
	`mes§ge
(
FATAL
, "Bad…agÏb– wh£ekšg…ag%d\n", 
p
);

221 
·»n
++;

224 
·»n
--;

228 
’d
 = 
¡¬t
; !
	`is¥aû
(*end);ƒnd++);

229 
	`¡ºıy
(
·g–ab–
, 
¡¬t
, 
’d
-start);

230 
·g–ab–
[
’d
-
¡¬t
] = '\0';

231 
·g’o
 = 
	`©oi
(
’d
);

233 
	`mes§ge
(
FATAL
, "I/Oƒ¼Ü s“kšg…ag%d\n", 
p
);

234 
	}
}

238 
	$wr™e¡ršg
(*
s
)

240 
	`åuts
(
s
, 
outfe
);

241 
by‹s
 +ğ
	`¡¾’
(
s
);

242 
	}
}

245 
	$wr™•ageh—d”
(*
Ïb–
, 
·ge
)

247 ià(
v”bo£
)

248 
	`mes§ge
(
LOG
, "[%d] ", 
·ge
);

249 
	`¥rštf
(
bufãr
, "%%%%Page: % %d\n", 
Ïb–
, ++
ouuage
);

250 
	`wr™e¡ršg
(
bufãr
);

251 
	}
}

254 
	$wr™•age£tup
()

256 
bufãr
[
BUFSIZ
];

257 ià(
begš´oc£t
) {

259 ià(
	`fg‘s
(
bufãr
, 
BUFSIZ
, 
šfe
è=ğ
NULL
)

260 
	`mes§ge
(
FATAL
, "I/Oƒ¼Ü„—dšg…ag£tu°%d\n", 
ouuage
);

261 ià(!
	`¡ºcmp
(
bufãr
, "PStoPSxform", 11))

263 ià(
	`åuts
(
bufãr
, 
outfe
è=ğ
EOF
)

264 
	`mes§ge
(
FATAL
, "I/Oƒ¼Ü wr™šg…ag£tu°%d\n", 
ouuage
);

265 
by‹s
 +ğ
	`¡¾’
(
bufãr
);

268 
	}
}

271 
	$wr™•agebody
(
p
)

273 ià(!
	`fcİy
(
·g•Œ
[
p
+1]))

274 
	`mes§ge
(
FATAL
, "I/Oƒ¼Ü wr™šg…ag%d\n", 
ouuage
);

275 
	}
}

278 
	$wr™•age
(
p
)

280 
	`£ek·ge
(
p
);

281 
	`wr™•ageh—d”
(
·g–ab–
, 
p
+1);

282 
	`wr™•agebody
(
p
);

283 
	}
}

286 
	$wr™eh—d”
(
p
)

288 
	`f£ek
(
šfe
, 0L, 
SEEK_SET
);

289 ià(
·gescmt
) {

290 ià(!
	`fcİy
(
·gescmt
è|| 
	`fg‘s
(
bufãr
, 
BUFSIZ
, 
šfe
è=ğ
NULL
)

291 
	`mes§ge
(
FATAL
, "I/Oƒrror in header\n");

292 
	`¥rštf
(
bufãr
, "%%%%Pages: %d 0\n", 
p
);

293 
	`wr™e¡ršg
(
bufãr
);

295 ià(!
	`fcİy
(
h—d”pos
))

296 
	`mes§ge
(
FATAL
, "I/Oƒrror in header\n");

297 
	}
}

300 
	$wr™•¬rŞog
()

302 ià(
begš´oc£t
 && !
	`fcİy
(beginprocset))

303 
	`mes§ge
(
FATAL
, "I/Oƒrror in…rologue\n");

304 ià(
’d´oc£t
)

305 
	`f£ek
(
šfe
, 
’d´oc£t
, 
SEEK_SET
);

306 
	`wr™•rŞog
();

307  !
begš´oc£t
;

308 
	}
}

311 
	$wr™•rŞog
()

313 ià(!
	`fcİy
(
’d£tup
))

314 
	`mes§ge
(
FATAL
, "I/Oƒrror in…rologue\n");

315 
	}
}

318 
	$wr™e£tup
()

320 ià(!
	`fcİy
(
·g•Œ
[0]))

321 
	`mes§ge
(
FATAL
, "I/Oƒrror in…rologue\n");

322 
	}
}

325 
	$wr™‘¿”
()

327 
	`f£ek
(
šfe
, 
·g•Œ
[
·ges
], 
SEEK_SET
);

328 
	`fg‘s
(
bufãr
, 
BUFSIZ
, 
šfe
è!ğ
NULL
) {

329 
	`wr™e¡ršg
(
bufãr
);

331 ià(
v”bo£
)

332 
	`mes§ge
(
LOG
, "WrÙ%d…ages, %ld by‹s\n", 
ouuage
, 
by‹s
);

333 
	}
}

336 
	$wr™“m±y·ge
()

338 ià(
v”bo£
)

339 
	`mes§ge
(
LOG
, "[*] ");

340 
	`¥rštf
(
bufãr
, "%%%%Page: * %d\n", ++
ouuage
);

341 
	`wr™e¡ršg
(
bufãr
);

342 ià(
begš´oc£t
)

343 
	`wr™e¡ršg
("PStoPSxform concat\n");

344 
	`wr™e¡ršg
("showpage\n");

345 
	}
}

	@prnt/hpps/psutil.h

8 
	~<¡dio.h
>

9 
	~<¡dlib.h
>

10 
	~<ùy³.h
>

12 
	~"cÚfig.h
"

15 
	tF•Œ
 ;

19 
	s·³rsize
 {

20 *
	mÇme
;

21 
	mwidth
, 
	mheight
;

22 } 
	tP­”
 ;

23 
	#P­”Name
(
p
è(Õ)->
Çme
)

	)

24 
	#P­”Width
(
p
è(Õ)->
width
)

	)

25 
	#P­”Height
(
p
è(Õ)->
height
)

	)

28 
P­”
 *
fšd·³r
(*
Çme
);

29 
FILE
 *
£ekabË
(FILE *
å
);

30 
wr™•age
(
p
);

31 
£ek·ge
(
p
);

32 
wr™•ageh—d”
(*
Ïb–
, 
p
);

33 
wr™•age£tup
();

34 
wr™•agebody
(
p
);

35 
wr™eh—d”
(
p
);

36 
wr™•¬rŞog
();

37 
wr™•rŞog
();

38 
wr™e£tup
();

39 
wr™‘¿”
();

40 
wr™“m±y·ge
();

41 
sÿÅages
();

42 
wr™e¡ršg
(*
s
);

46 *
´og¿m
 ;

47 
·ges
;

48 
v”bo£
;

49 
FILE
 *
šfe
;

50 
FILE
 *
outfe
;

51 
·g–ab–
[
BUFSIZ
];

52 
·g’o
;

	@protocol/discovery/mdns.c

28 
	~<¡ršg.h
>

29 
	~<sy¦og.h
>

30 
	~<sys/sock‘.h
>

31 
	~<Ãtš‘/š.h
>

32 
	~<Ãtdb.h
>

33 
	~<¬·/š‘.h
>

34 
	~"mdns.h
"

37 
	$mdns_cÚv”t_Çme_to_dns
(cÚ¡ *
Çme
, 
Çme_size
, *
dns_Çme
)

39 
i
, 
x
 = 0;

40 *
p
 = 
dns_Çme
;

42 ià(
Çme
 == 0 ||‚ame[0] == 0)

45 
i
 = 0; i < 
Çme_size
 && 
Çme
[i]; i++)

47 ià(
Çme
[
i
] == '.')

49 *
p
++ = 
i
 - 
x
;

50 ; 
x
 < 
i
; x++)

51 *
p
++ = 
Çme
[
x
];

52 
x
++;

56 ià(
i
)

58 *
p
++ = 
i
 - 
x
;

59 ; 
x
 < 
i
; x++)

60 *
p
++ = 
Çme
[
x
];

61 
x
++;

64 
p
[
x
++] = 0;

66  
x
;

67 
	}
}

70 
	$mdns_İ’_sock‘
(*
psock‘
)

72 
¡©
 = 
MDNS_STATUS_ERROR
;

73 
udp_sock‘
 = -1, 
yes
 = 1;

74 
loİ
 = 0, 
‰l
 = 255;

75 
sockaddr_š
 
»cv_addr
 , 
addr
;

76 
_m»q
 
m»q
;

78 
	`DBG
("mdns_open_socketƒntry.\n");

80 ià((
udp_sock‘
 = 
	`sock‘
(
AF_INET
, 
SOCK_DGRAM
, 0)) == -1)

82 
	`BUG
("unableo create udp socket: %m\n");

83 
bugout
;

87 ià(
	`£tsockİt
(
udp_sock‘
, 
SOL_SOCKET
, 
SO_REUSEADDR
, &
yes
, (yes)) == -1)

89 
	`BUG
("unableo setsockopt: %m\n");

90 
bugout
;

94 
	`bz”o
(&
»cv_addr
, (recv_addr));

95 
»cv_addr
.
sš_çmy
 = 
AF_INET
;

96 
»cv_addr
.
sš_addr
.
s_addr
 = 
	`htÚl
(
INADDR_ANY
);

97 
»cv_addr
.
sš_pÜt
 = 
	`htÚs
(5353);

98 ià(
	`bšd
(
udp_sock‘
, (
sockaddr
 *è&
»cv_addr
, (recv_addr)) == -1)

100 
	`BUG
("unableo bind udp socket: %m\n");

101 
bugout
;

105 ià(
	`£tsockİt
(
udp_sock‘
, 
IPPROTO_IP
, 
IP_MULTICAST_LOOP
, &
loİ
, (loop)) == -1)

107 
	`BUG
("unableo setsockopt: %m\n");

108 
bugout
;

112 ià(
	`£tsockİt
(
udp_sock‘
, 
IPPROTO_IP
, 
IP_MULTICAST_TTL
, &
‰l
, (ttl))== -1)

114 
	`BUG
("unableo setsockopt: %m\n");

115 
bugout
;

119 
m»q
.
imr_muÉŸddr
.
s_addr
 = 
	`š‘_addr
("224.0.0.251");

120 
m»q
.
imr_š‹rçû
.
s_addr
 = 
	`htÚl
(
INADDR_ANY
);

121 ià(
	`£tsockİt
(
udp_sock‘
, 
IPPROTO_IP
, 
IP_ADD_MEMBERSHIP
, &
m»q
, (
_m»q
)) == -1) {

122 
	`BUG
("unableo‡ddo multicast group: %m\n");

123 
	`şo£
(
udp_sock‘
);

124 
bugout
;

127 *
psock‘
 = 
udp_sock‘
;

128 
	`DBG
("pSock‘ = [%d]: %m\n", *
psock‘
);

129 
¡©
 = 
MDNS_STATUS_OK
;

131 
bugout
:

132  
¡©
;

133 
	}
}

135 
	$mdns_ü—‹_qu”y_·ck‘
(* 
fqdn
, 
qu”y_ty³
, * 
qu”ybuf
, *
Ëngth
)

137 
n
 = 0;

138 
h—d”
[] = { 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00 };

141 
	`DBG
("mdns_create_query_packet.\n");

142 
	`memıy
(
qu”ybuf
, 
h—d”
, (header));

143 
n
 = (
h—d”
);

145 
n
 +ğ
	`mdns_cÚv”t_Çme_to_dns
(
fqdn
, 
	`¡¾’
(fqdn), 
qu”ybuf
 +‚);

146 
qu”ybuf
[
n
++] = 0x00;

147 
qu”ybuf
[
n
++] = 
qu”y_ty³
;

148 
qu”ybuf
[
n
++] = 0x00;

149 
qu”ybuf
[
n
++] = 
QCLASS_IN
;

152 *
Ëngth
 = 
n
;

153 
	}
}

155 
	$mdns_£nd_qu”y
(
udp_sock‘
, *
fqdn
, 
qu”y_ty³
)

157 
qu”ybuf
[256] = {0,};

158 
Ëngth
 = 0;

159 
¡©
 = 
MDNS_STATUS_OK
;

160 
sockaddr_š
 
£nd_addr
;

162 
	`DBG
("mdns_£nd_qu”yƒÁry. s’d sock‘=%d†’=%d\n", 
udp_sock‘
, 
Ëngth
);

164 
	`mdns_ü—‹_qu”y_·ck‘
(
fqdn
, 
qu”y_ty³
, 
qu”ybuf
, &
Ëngth
);

166 
	`bz”o
(&
£nd_addr
, (send_addr));

167 
£nd_addr
.
sš_çmy
 = 
AF_INET
;

168 
£nd_addr
.
sš_addr
.
s_addr
 = 
	`š‘_addr
("224.0.0.251");

169 
£nd_addr
.
sš_pÜt
 = 
	`htÚs
(5353);

170 ià(
	`£ndto
(
udp_sock‘
, 
qu”ybuf
, 
Ëngth
, 0, (
sockaddr
 *è&
£nd_addr
, (send_addr)) < 0)

171 
¡©
 = 
MDNS_STATUS_ERROR
;

173 
	`DBG
("mdns_£nd_qu”y„‘uºšg w™h stus(%d)...\n", 
¡©
);

174  
¡©
;

175 
	}
}

177 
	$mdns_»adName
(* 
¡¬t
, *
Re¥Ú£
, *
buf
)

179 
size
 = 0;

180 *
Çme
 = 
buf
;

181 *
p
 = 
Re¥Ú£
;

183 
size
 = *
p
++)

185 ià(
size
 >= 0xC0)

188 
p
++;

189  (
p
 - 
Re¥Ú£
);

191 
	`memıy
(
Çme
, 
p
, 
size
);

192 
Çme
[
size
] = '.';

193 
p
 +ğ
size
;

194 
Çme
 +ğ
size
 + 1;

197 *(
Çme
 - 1) = '\0';

199 
	`DBG
("Namğ[%s]\n", 
buf
);

200  (
p
 - 
Re¥Ú£
);

201 
	}
}

204 * 
	$mdns_»adMDL
(*
p
, *
nÜm®ized_mdl
, 
Ën
)

206 
i
 = 0;

207 
j
 = 0;

208 
z
 = 0;

209 
size
 = 0;

211 * 
mdl
 = 
nÜm®ized_mdl
;

212 
i
 < 
Ën
)

214 
size
 = *
p
++;

215 
i
 +ğ
size
 + 1;

217 ià(
	`¡ºcmp
(
p
, "mdl=", 4) == 0)

219 
z
 = 4;

221 ià(
	`¡ºcmp
(
p
, "ty=", 3) == 0)

223 
z
 = 3+3;

226 if(
z
 > 0)

228 
j
 = 
z
; j < 
size
; j++)

230 ià(*(
p
 + 
j
) == ' ')

231 *
mdl
++ = '_';

233 *
mdl
++ = 
	`tŞow”
(*(
p
 + 
j
));

236 *
mdl
++ = '\0';

239 
p
 +ğ
size
;

242 
	`DBG
("MDL = [%s]\n", 
nÜm®ized_mdl
);

243  
p
 + 4;

244 
	}
}

246 
	$mdns_»ad_h—d”
(*
Re¥Ú£
, 
DNS_PKT_HEADER
 *
h
)

248 
h
->
id
 = 
Re¥Ú£
[0] << 8 | Response[1];

249 
h
->
æags
 = 
Re¥Ú£
[2] << 8 | Response[3];

250 
h
->
que¡iÚs
 = 
Re¥Ú£
[4] << 8 | Response[5];

251 
h
->
ªsw”s
 = 
Re¥Ú£
[6] << 8 | Response[7];

252 
h
->
authÜ™›s
 = 
Re¥Ú£
[8] << 8 | Response[9];

253 
h
->
add™iÚ®s
 = 
Re¥Ú£
[10]<< 8 | Response[11];

255 
	`DBG
("ID=%x fÏgs=%x Q=%x A=%x AUTH=%x ADD=%x\n", 
h
->
id
, h->
æags
, h->
que¡iÚs
,

256 
h
->
ªsw”s
, h->
authÜ™›s
, h->
add™iÚ®s
);

258 
	}
}

260 
	$mdns_·r£_»¥pÚ£
(*
Re¥Ú£
, 
DNS_RECORD
 *
¼
)

262 *
p
 = 
Re¥Ú£
;

263 
ty³
 = 0, 
d©a_Ën
 = 0;

264 
DNS_PKT_HEADER
 
h
;

265 
i
 = 0;

267 
	`DBG
("mdns_parse_respponseƒntry.\n");

268 
	`mdns_»ad_h—d”
(
Re¥Ú£
, &
h
);

269 
p
 +ğ
MDNS_HEADER_SIZE
;

271 
i
 = 0; i < 
h
.
que¡iÚs
; i++)

273 
p
 +ğ
	`mdns_»adName
(
Re¥Ú£
,…, 
¼
->
Çme
);

274 
p
 += 4;

277 
i
 = 0; i < (
h
.
ªsw”s
 + h.
add™iÚ®s
); i++)

279 
p
 +ğ
	`mdns_»adName
(
Re¥Ú£
,…, 
¼
->
Çme
);

280 
ty³
 = (*
p
 << 8 | *(p+1));

281 
p
 += 8;

283 
d©a_Ën
 = ( *
p
 << 8 | *(p+1));

284 
p
 += 2;

286 
ty³
)

288 
QTYPE_A
:

289 
	`¥rštf
(
¼
->

, "%d.%d.%d.%d", 
p
[0],…[1],…[2],…[3]);

291 
QTYPE_TXT
:

292 
	`mdns_»adMDL
(
p
, 
¼
->
mdl
, 
d©a_Ën
);

298 
p
 +ğ
d©a_Ën
;

302 
	`DBG
("mdns_·r£_»¥pÚ£„‘uºšg MDL = %s, IP = %s\n",
¼
->
mdl
,„r->

);

303 
	}
}

305 
	$mdns_»ad_sšgË_»¥Ú£
(
udp_sock‘
, *
»cvbufãr
, 
»cvbufsize
)

307 
timev®
 
tmo
;

308 
sockaddr_š
 
addr
;

309 
sockËn_t
 
add¾’
 = (
addr
);

310 
fd_£t
 
ma¡”
, 
»adfd
;

311 
Ën
 = 0, 
maxfd
 = 0, 
»t
 = 0;

313 
	`DBG
("mdns_read_single_response.\n");

314 
	`FD_ZERO
(&
ma¡”
);

315 
	`FD_SET
(
udp_sock‘
, &
ma¡”
);

316 
maxfd
 = 
udp_sock‘
;

317 
tmo
.
tv_£c
 = 0;

318 
tmo
.
tv_u£c
 = 300000;

320 
»adfd
 = 
ma¡”
;

321 
»t
 = 
	`£Ëù
(
maxfd
 + 1, &
»adfd
, 
NULL
, NULL, &
tmo
);

322 ià(
»t
 > 0)

324 
	`bz”o
(&
addr
, (addr));

325 ià((
Ën
 = 
	`»cväom
(
udp_sock‘
, 
»cvbufãr
, 
»cvbufsize
, 0, (
sockaddr
 *è&
addr
, &
add¾’
)) < 0)

327 
	`BUG
("recvfromƒrror: (%m)\n");

328 
»t
 = -1;

332 
	`DBG
("mdns_»ad_sšgË_»¥Ú£ƒx™šg w™h„‘ = %d\n", 
»t
);

333  
»t
;

334 
	}
}

336 
DNS_RECORD
 *
	$mdns_»ad_»¥Ú£s
(
udp_sock‘
, 
mode
)

338 
»Œ›s
 = 3, 
»t
 = 0;

339 
»cvbufãr
[
MAX_MDNS_RESPONSE_LEN
] = { 0, };

340 
DNS_RECORD
 *
¼
 = 
NULL
, *
h—d
 = NULL, *
‹mp
 = NULL;

342 
	`DBG
("mdns_read_responses.\n");

345 
	`mem£t
(
»cvbufãr
, 0, (recvbuffer));

346 
»t
 = 
	`mdns_»ad_sšgË_»¥Ú£
(
udp_sock‘
, 
»cvbufãr
, (recvbuffer));

347 ià(
»t
 <= 0)

349 ià(
»t
 =ğ0 && 
»Œ›s
--)

356 
‹mp
 = (
DNS_RECORD
 *)
	`m®loc
((DNS_RECORD));

357 if(
‹mp
)

359 
‹mp
->
Ãxt
 = 
NULL
;

360 if(
h—d
 =ğ
NULL
)

361 
¼
 = 
h—d
 = 
‹mp
;

364 
¼
->
Ãxt
 = 
‹mp
;

365 
¼
 =„r->
Ãxt
;

368 
	`mem£t
(
¼
, 0, (
DNS_RECORD
));

369 
	`mdns_·r£_»¥pÚ£
(
»cvbufãr
, 
¼
);

371 if(
mode
 =ğ
MODE_READ_SINGLE
)

377 
	`DBG
("mdns_»ad_»¥Ú£ »tuºšg w™h (%p).\n", 
h—d
);

378  
h—d
;

379 
	}
}

381 
	$mdns_upd©e_uris
(
DNS_RECORD
 *
¼
, * 
uris_buf
, 
buf_size
, *
couÁ
)

383 
‹mpuri
[
MAX_URI_LEN
] = {0};

384 
by‹s_»ad
 = 0;

386 
	`DBG
("mdns_update_uris.\n");

388 *
couÁ
 = 0;

389 
	`mem£t
(
uris_buf
, 0, 
buf_size
);

391 
¼
)

393 ià(
¼
->
mdl
[0] &&„r->

[0] )

395 
	`mem£t
(
‹mpuri
, 0, (tempuri));

396 
	`¥rštf
(
‹mpuri
, "hp:/Ãt/%s?=%s&queue=çl£", 
¼
->
mdl
,„r->

);

399 if(
by‹s_»ad
 + (
‹mpuri
è< 
buf_size
 && !
	`¡r¡r
(
uris_buf
,empuri))

401 
by‹s_»ad
 +ğ
	`¥rštf
(
uris_buf
 + by‹s_»ad, "%s;", 
‹mpuri
);

402 (*
couÁ
)++;

403 *(
uris_buf
 + 
by‹s_»ad
) = '\0';

406 
¼
 =„r->
Ãxt
;

409 
	`DBG
("mdns_upd©e_uri CouÁ=[%d] by‹s=[%d] URI ğ%s\n",*
couÁ
, 
by‹s_»ad
, 
uris_buf
);

410  
by‹s_»ad
;

411 
	}
}

413 
	$mdns_¼_ş—nup
(
DNS_RECORD
 *
¼
)

415 
DNS_RECORD
 *
‹mp
 = 
NULL
;

417 
	`DBG
("mdns_rr_cleanupƒntry.\n");

418 
¼
)

420 
‹mp
 = 
¼
->
Ãxt
;

421 
	`ä“
(
¼
);

422 
¼
 = 
‹mp
;

424 
	}
}

426 
	$mdns_´obe_nw_sÿÂ”s
(* 
uris_buf
, 
buf_size
, *
couÁ
)

428 
n
 = 0, 
by‹s_»ad
 = 0;

429 
udp_sock‘
 = 0;

430 
¡©
 = 
MDNS_STATUS_ERROR
;

431 
DNS_RECORD
 *
¼_li¡
 = 
NULL
;

433 
	`DBG
("mdns_probe_nw_scannersƒntry.\n");

435 ià(
	`mdns_İ’_sock‘
(&
udp_sock‘
è!ğ
MDNS_STATUS_OK
)

436 
bugout
;

439 
	`mdns_£nd_qu”y
(
udp_sock‘
, "_sÿÂ”._tı.loÿl", 
QTYPE_PTR
);

440 
	`mdns_£nd_qu”y
(
udp_sock‘
, "_usÿn._tı.loÿl", 
QTYPE_PTR
);

443 
¼_li¡
 = 
	`mdns_»ad_»¥Ú£s
(
udp_sock‘
, 
MODE_READ_ALL
);

446 
by‹s_»ad
 = 
	`mdns_upd©e_uris
(
¼_li¡
, 
uris_buf
, 
buf_size
, 
couÁ
);

447 
	`DBG
("mdns_´obe_nw_sÿÂ” »tuºed w™h by‹s_»ad = [%d].\n",
by‹s_»ad
);

449 
bugout
:

450 ià(
udp_sock‘
 >= 0)

451 
	`şo£
(
udp_sock‘
);

453 
	`mdns_¼_ş—nup
(
¼_li¡
);

455  
by‹s_»ad
;

456 
	}
}

462 
	$mdns_lookup
(* 
ho¡Çme
, * 

)

464 
udp_sock‘
 = 0;

465 
¡©
 = 
MDNS_STATUS_ERROR
;

466 
fqdn
[
MAX_NAME_LENGTH
] = {0};

467 
DNS_RECORD
 *
¼_li¡
 = 
NULL
;

469 
	`DBG
("mdns_probe_nw_scannersƒntry.\n");

471 ià(
	`mdns_İ’_sock‘
(&
udp_sock‘
è!ğ
MDNS_STATUS_OK
)

472 
bugout
;

475 
	`¥rštf
(
fqdn
, "%s.loÿl", 
ho¡Çme
);

476 
	`mdns_£nd_qu”y
(
udp_sock‘
, 
fqdn
, 
QTYPE_A
);

479 
¼_li¡
 = 
	`mdns_»ad_»¥Ú£s
(
udp_sock‘
, 
MODE_READ_SINGLE
);

482 if(
¼_li¡
)

484 
	`¡rıy
(

, 
¼_li¡
->ip);

485 
¡©
 = 
MDNS_STATUS_OK
;

486 
	`DBG
("IP = [%s].\n",

);

489 
bugout
:

490 ià(
udp_sock‘
 >= 0)

491 
	`şo£
(
udp_sock‘
);

493 
	`mdns_¼_ş—nup
(
¼_li¡
);

494  
¡©
;

495 
	}
}

	@protocol/discovery/mdns.h

28 #iâdeà
_DISCOVERY_MDNS_H


29 
	#_DISCOVERY_MDNS_H


	)

32 
	#QTYPE_A
 1

	)

33 
	#QTYPE_TXT
 16

	)

34 
	#QTYPE_SRV
 33

	)

35 
	#QTYPE_AAAA
 28

	)

36 
	#QTYPE_PTR
 12

	)

37 
	#QCLASS_IN
 1

	)

38 
	#MDNS_HEADER_SIZE
 12

	)

41 
	#MDNS_STATUS_OK
 0

	)

42 
	#MDNS_STATUS_ERROR
 1

	)

43 
	#MDNS_STATUS_TIMEOUT
 2

	)

45 
	#MAX_IP_ADDR_LEN
 16

	)

46 
	#MAX_URI_LEN
 256

	)

47 
	#MAX_MDL_NAME_LEN
 256

	)

48 
	#MAX_NAME_LENGTH
 256

	)

49 
	#MAX_MDNS_RESPONSE_LEN
 2048

	)

50 
	#MODE_READ_ALL
 0

	)

51 
	#MODE_READ_SINGLE
 1

	)

54 
	s_DNS_RECORD


56 
	m
[
MAX_IP_ADDR_LEN
];

57 
	mmdl
[
MAX_MDL_NAME_LEN
];

58 
	mÇme
[
MAX_MDL_NAME_LEN
];

59 
_DNS_RECORD
 *
	mÃxt
;

60 }
	tDNS_RECORD
;

62 
	s_DNS_PKT_HEADER


64 
	mid
;

65 
	mæags
;

66 
	mque¡iÚs
;

67 
	mªsw”s
;

68 
	mauthÜ™›s
;

69 
	madd™iÚ®s
;

70 }
	tDNS_PKT_HEADER
;

75 
	#_STRINGIZE
(
x
è#x

	)

76 
	#STRINGIZE
(
x
è
	`_STRINGIZE
(x)

	)

78 
	#BUG
(
¬gs
...è
	`sy¦og
(
LOG_ERR
, 
__FILE__
 " " 
	`STRINGIZE
(
__LINE__
è": "‡rgs)

	)

79 #ifdeà
MDNS_DEBUG


80 
	#DBG
(
¬gs
...è
	`sy¦og
(
LOG_INFO
, 
__FILE__
 " " 
	`STRINGIZE
(
__LINE__
è": "‡rgs)

	)

82 
	#DBG
(
¬gs
...)

	)

86 
mdns_´obe_nw_sÿÂ”s
(* 
buf
, 
buf_size
, *
couÁ
);

87 
mdns_lookup
(* 
ho¡Çme
, * 

);

91 
mdns_cÚv”t_Çme_to_dns
(cÚ¡ *
Çme
, 
Çme_size
, *
dns_Çme
);

92 
mdns_»ad_sšgË_»¥Ú£
(
udp_sock‘
, *
»cvbufãr
, 
»cvbufsize
);

93 
mdns_İ’_sock‘
(*
psock‘
);

94 
mdns_£nd_qu”y
(
udp_sock‘
, *
fqdn
, 
qu”y_ty³
);

95 
mdns_»adName
(* 
¡¬t
, *
p
, *
buf
);

96 
mdns_upd©e_uris
(
DNS_RECORD
 *
¼
, * 
uris_buf
, 
buf_size
, *
couÁ
);

97 
mdns_ü—‹_qu”y_·ck‘
(* 
fqdn
, 
qu”y_ty³
, * 
dnsqu”y
, *
Ëngth
);

98 
mdns_»ad_h—d”
(*
Re¥Ú£
, 
DNS_PKT_HEADER
 *
h
);

99 
mdns_·r£_»¥pÚ£
(*
Re¥Ú£
, 
DNS_RECORD
 *
¼
);

100 
mdns_¼_ş—nup
(
DNS_RECORD
 *
¼
);

101 
DNS_RECORD
 *
mdns_»ad_»¥Ú£s
(
udp_sock‘
, 
mode
);

102 * 
mdns_»adMDL
(*
p
, *
nÜm®ized_mdl
, 
Ën
);

	@protocol/hp_ipp.c

22 
	~<cups/cups.h
>

23 
	~<cups/Ïnguage.h
>

24 
	~<cups/µd.h
>

25 
	~<sy¦og.h
>

26 
	~<¡d¬g.h
>

27 
	~<sys/ty³s.h
>

28 
	~<pwd.h
>

29 
	~<sys/¡©.h
>

30 
	~<fú.h
>

31 
	~<¡ršg.h
>

33 
	~<sys/time.h
>

34 
	~<time.h
>

35 
	~<uni¡d.h
>

37 
	~"hp_p.h
"

38 
	~"hp_p_i.h
"

40 
	#_STRINGIZE
(
x
è#x

	)

41 
	#STRINGIZE
(
x
è
	`_STRINGIZE
(x)

	)

44 
h‰p_t
* 
	$acquœeCupsIn¡ªû
()

46 iàĞ
h‰p
 =ğ
NULL
)

48 
h‰p
 = 
	`h‰pCÚÃùEnüy±
Ğ
	`cupsS”v”
(), 
	`pPÜt
(), 
	`cupsEnüy±iÚ
() );

51  
h‰p
;

52 
	}
}

55 
	$_»Ëa£CupsIn¡ªû
()

57 ià(
h‰p
)

59 
	`h‰pClo£
(
h‰p
);

62 
h‰p
 = 
NULL
;

63 
	}
}

70 
	$v®id©e_Çme
ĞcÚ¡ *
Çme
 )

73 
	}
}

75 cÚ¡ *
	$g‘CupsE¼ÜSŒšg
(
¡©us
)

77  
	`pE¼ÜSŒšg
(
¡©us
);

78 
	}
}

80 
	$ä“Prš‹rLi¡
(
´š‹r_t
 *
li¡
)

82 
´š‹r_t
 *
‹mp
;

83 
´š‹r_t
 *
–em
 = 
li¡
;

85 
–em
 !ğ
NULL
) {

86 
‹mp
 = 
–em
;

87 
–em
 =ƒËm->
Ãxt
;

88 
	`ä“
(
‹mp
);

90 
	}
}

92 
	$addCupsPrš‹r
(*
Çme
, *
deviû_uri
, *
loÿtiÚ
, *
µd_fe
, *
mod–
, *
šfo
)

94 
´š‹r_uri
[ 
HTTP_MAX_URI
 ];

95 
cups_Ïng_t
 *
Ïnguage
;

96 
»t_¡©us
 = 0;

97 
p_¡©us_t
 
¡©us
 = 
IPP_BAD_REQUEST
;

98 
p_t
 * 
»que¡
 = 
NULL
,

99 *
»¥Ú£
 = 
NULL
;

101 iàĞĞ
	`¡¾’
Ğ
µd_fe
 ) > 0 && sŒËnĞ
mod–
 ) > 0 ) ||

102 Ğ
	`¡¾’
Ğ
µd_fe
 ) =ğ0 && sŒËnĞ
mod–
 ) == 0) ) {

104 
abÜt
;

107 iàĞ!
	`v®id©e_Çme
(
Çme
) ) {

109 
abÜt
;

112 iàĞ
šfo
 =ğ
NULL
 )

113 
	`¡rıy
Ğ
šfo
, 
Çme
 );

115 
	`¥rštf
Ğ
´š‹r_uri
, "p://loÿlho¡/´š‹rs/%s", 
Çme
 );

117 
	`cupsS‘U£r
 ("root");

119 ià(
	`acquœeCupsIn¡ªû
(è=ğ
NULL
)

122 
abÜt
;

126 
»que¡
 = 
	`pNew
();

127 
Ïnguage
 = 
	`cupsLªgDeçuÉ
();

129 
	`pS‘O³¿tiÚ
Ğ
»que¡
, 
CUPS_ADD_PRINTER
 );

130 
	`pS‘Reque¡Id
 ( 
»que¡
, 1 );

132 
	`pAddSŒšg
Ğ
»que¡
, 
IPP_TAG_OPERATION
, 
IPP_TAG_CHARSET
,

133 "©Œibu‹s-ch¬£t", 
NULL
, 
	`cupsLªgEncodšg
Ğ
Ïnguage
 ) );

135 
	`pAddSŒšg
Ğ
»que¡
, 
IPP_TAG_OPERATION
, 
IPP_TAG_LANGUAGE
,

136 "©Œibu‹s-Çtu¿l-Ïnguage", 
NULL
, 
Ïnguage
->language );

138 
	`pAddSŒšg
Ğ
»que¡
, 
IPP_TAG_OPERATION
, 
IPP_TAG_URI
,

139 "´š‹r-uri", 
NULL
, 
´š‹r_uri
 );

141 
	`pAddIÁeg”
Ğ
»que¡
, 
IPP_TAG_PRINTER
, 
IPP_TAG_ENUM
,

142 "´š‹r-¡©e", 
IPP_PRINTER_IDLE
 );

144 
	`pAddBoŞ—n
Ğ
»que¡
, 
IPP_TAG_PRINTER
, "printer-is-accepting-jobs", 1 );

146 
	`pAddSŒšg
Ğ
»que¡
, 
IPP_TAG_PRINTER
, 
IPP_TAG_URI
, "deviû-uri", 
NULL
,

147 
deviû_uri
 );

149 
	`pAddSŒšg
Ğ
»que¡
, 
IPP_TAG_PRINTER
, 
IPP_TAG_TEXT
, "´š‹r-šfo", 
NULL
,

150 
šfo
 );

152 
	`pAddSŒšg
Ğ
»que¡
, 
IPP_TAG_PRINTER
, 
IPP_TAG_TEXT
, "´š‹r-loÿtiÚ", 
NULL
,

153 
loÿtiÚ
 );

155 iàĞ
	`¡¾’
Ğ
mod–
 ) > 0 ) {

156 
	`pAddSŒšg
Ğ
»que¡
, 
IPP_TAG_PRINTER
, 
IPP_TAG_NAME
, "µd-Çme", 
NULL
, 
mod–
 );

159 
»¥Ú£
 = 
	`cupsDoReque¡
Ğ
h‰p
, 
»que¡
, "/admin/" );

162 
»¥Ú£
 = 
	`cupsDoFeReque¡
Ğ
h‰p
, 
»que¡
, "/admš/", 
µd_fe
 );

165 ià(
»¥Ú£
 =ğ
NULL
)

166 
¡©us
 = 
	`cupsLa¡E¼Ü
();

168 
¡©us
 = 
	`pG‘StusCode
Ğ
»¥Ú£
 );

171 ià(
¡©us
 =ğ
IPP_FORBIDDEN
 && 
auth_ÿnûl_»q
) {

172 
¡©us
 = 
IPP_NOT_AUTHENTICATED
;

173 
auth_ÿnûl_»q
 = 0;

176 iàĞ
¡©us
 <ğ
IPP_OK_CONFLICT
 ) {

177 
¡©us
 =
IPP_OK
;

178 
»t_¡©us
 = 0;

180 
»t_¡©us
 = 1;

183 
abÜt
:

184 iàĞ
»¥Ú£
 !ğ
NULL
 )

185 
	`pD–‘e
Ğ
»¥Ú£
 );

187  
»t_¡©us
;

188 
	}
}

190 
	$d–CupsPrš‹r
(*
´_Çme
)

192 
»t_¡©us
;

193 
cups_Ïng_t
 *
Ïnguage
;

194 
uri
[ 
HTTP_MAX_URI
 ];

195 cÚ¡ *
u£ºame
 = 
NULL
;

196 
p_t
 * 
»que¡
 = 
NULL
,

197 *
»¥Ú£
 = 
NULL
;

199 iàĞ!
	`v®id©e_Çme
(
´_Çme
) ) {

200 
abÜt
;

203 
u£ºame
 = 
	`cupsU£r
();

205 
	`cupsS‘U£r
 ("root");

207 ià(
	`acquœeCupsIn¡ªû
(è=ğ
NULL
)

209 
abÜt
;

211 
	`¢´štf
Ğ
uri
, Ğur˜), "p://loÿlho¡/´š‹rs/%s", 
´_Çme
 );

221 
»que¡
 = 
	`pNew
();

223 
	`pS‘O³¿tiÚ
Ğ
»que¡
, 
CUPS_DELETE_PRINTER
 );

224 
	`pS‘Reque¡Id
 ( 
»que¡
, 1 );

226 
Ïnguage
 = 
	`cupsLªgDeçuÉ
();

228 
	`pAddSŒšg
Ğ
»que¡
, 
IPP_TAG_OPERATION
, 
IPP_TAG_CHARSET
,

229 "©Œibu‹s-ch¬£t", 
NULL
, 
	`cupsLªgEncodšg
Ğ
Ïnguage
 ) );

231 
	`pAddSŒšg
Ğ
»que¡
, 
IPP_TAG_OPERATION
, 
IPP_TAG_LANGUAGE
,

232 "©Œibu‹s-Çtu¿l-Ïnguage", 
NULL
, 
Ïnguage
->language );

234 
	`pAddSŒšg
Ğ
»que¡
, 
IPP_TAG_OPERATION
, 
IPP_TAG_URI
,

235 "´š‹r-uri", 
NULL
, 
uri
 );

240 
»¥Ú£
 = 
	`cupsDoReque¡
Ğ
h‰p
, 
»que¡
, "/admin/" );

242 ià(
»¥Ú£
 =ğ
NULL
)

243 
»t_¡©us
 = 
	`cupsLa¡E¼Ü
();

245 
»t_¡©us
 = 
	`pG‘StusCode
Ğ
»¥Ú£
 );

248 ià(
»t_¡©us
 =ğ
IPP_FORBIDDEN
 && 
auth_ÿnûl_»q
)

250 
»t_¡©us
 = 
IPP_NOT_AUTHENTICATED
;

251 
auth_ÿnûl_»q
 = 0;

254 iàĞ
»t_¡©us
 <ğ
IPP_OK_CONFLICT
 )

255 
»t_¡©us
 = 
IPP_OK
;

257 
abÜt
:

258 ià(
u£ºame
)

259 
	`cupsS‘U£r
(
u£ºame
);

261 iàĞ
»¥Ú£
 !ğ
NULL
 )

262 
	`pD–‘e
Ğ
»¥Ú£
 );

264  
»t_¡©us
;

265 
	}
}

268 
	$£tDeçuÉCupsPrš‹r
(*
´_Çme
)

270 
»t_¡©us
 = 0;

271 
uri
[ 
HTTP_MAX_URI
 ];

272 
p_t
 *
»que¡
 = 
NULL
,

273 *
»¥Ú£
 = 
NULL
;

274 
cups_Ïng_t
 *
Ïnguage
;

275 cÚ¡ *
u£ºame
 = 
NULL
;

277 iàĞ!
	`v®id©e_Çme
(
´_Çme
) ) {

278 
abÜt
;

281 
u£ºame
 = 
	`cupsU£r
();

283 
	`cupsS‘U£r
 ("root");

285 iàĞ
	`acquœeCupsIn¡ªû
 (è=ğ
NULL
) {

286 
abÜt
;

298 
	`¢´štf
Ğ
uri
, Ğur˜), "p://loÿlho¡/´š‹rs/%s", 
´_Çme
 );

300 
»que¡
 = 
	`pNew
();

302 
	`pS‘O³¿tiÚ
Ğ
»que¡
, 
CUPS_SET_DEFAULT
 );

303 
	`pS‘Reque¡Id
 ( 
»que¡
, 1 );

305 
Ïnguage
 = 
	`cupsLªgDeçuÉ
();

307 
	`pAddSŒšg
Ğ
»que¡
, 
IPP_TAG_OPERATION
, 
IPP_TAG_CHARSET
,

308 "©Œibu‹s-ch¬£t", 
NULL
, "utf-8" );

310 
	`pAddSŒšg
Ğ
»que¡
, 
IPP_TAG_OPERATION
, 
IPP_TAG_LANGUAGE
,

313 
NULL
, 
Ïnguage
->language );

315 
	`pAddSŒšg
Ğ
»que¡
, 
IPP_TAG_OPERATION
, 
IPP_TAG_URI
,

316 "´š‹r-uri", 
NULL
, 
uri
 );

322 
»¥Ú£
 = 
	`cupsDoReque¡
Ğ
h‰p
, 
»que¡
, "/admin/" );

323 ià(
»¥Ú£
 =ğ
NULL
)

324 
»t_¡©us
 = 
	`cupsLa¡E¼Ü
();

326 
»t_¡©us
 = 
	`pG‘StusCode
(
»¥Ú£
 );

329 ià(
»t_¡©us
 =ğ
IPP_FORBIDDEN
 && 
auth_ÿnûl_»q
)

331 
»t_¡©us
 = 
IPP_NOT_AUTHENTICATED
;

332 
auth_ÿnûl_»q
 = 0;

336 iàĞ
»t_¡©us
 <ğ
IPP_OK_CONFLICT
 )

337 
»t_¡©us
 = 
IPP_OK
;

339 
abÜt
:

340 ià(
u£ºame
)

341 
	`cupsS‘U£r
(
u£ºame
);

343 iàĞ
»¥Ú£
 !ğ
NULL
 )

344 
	`pD–‘e
Ğ
»¥Ú£
 );

346  
»t_¡©us
;

348 
	}
}

350 
	$cÚŒŞCupsPrš‹r
(*
´_Çme
, 
İ
)

352 
p_t
 *
»que¡
 = 
NULL
,

353 *
»¥Ú£
 = 
NULL
;

354 
uri
[ 
HTTP_MAX_URI
 ];

355 
cups_Ïng_t
 *
Ïnguage
;

356 cÚ¡ *
u£ºame
 = 
NULL
;

357 
»t_¡©us
 = 0;

359 iàĞ!
	`v®id©e_Çme
(
´_Çme
) ) {

360 
abÜt
;

363 
u£ºame
 = 
	`cupsU£r
();

364 
	`cupsS‘U£r
 ("root");

366 ià(
	`acquœeCupsIn¡ªû
 (è=ğ
NULL
)

368 
abÜt
;

371 
»que¡
 = 
	`pNew
();

373 
	`pS‘O³¿tiÚ
Ğ
»que¡
, 
İ
 );

374 
	`pS‘Reque¡Id
 ( 
»que¡
, 1 );

376 
Ïnguage
 = 
	`cupsLªgDeçuÉ
();

378 
	`¢´štf
Ğ
uri
, Ğur˜), "p://loÿlho¡/´š‹rs/%s", 
´_Çme
 );

380 
	`pAddSŒšg
Ğ
»que¡
, 
IPP_TAG_OPERATION
, 
IPP_TAG_CHARSET
,

381 "©Œibu‹s-ch¬£t", 
NULL
, 
	`cupsLªgEncodšg
Ğ
Ïnguage
 ) );

383 
	`pAddSŒšg
Ğ
»que¡
, 
IPP_TAG_OPERATION
, 
IPP_TAG_LANGUAGE
,

384 "©Œibu‹s-Çtu¿l-Ïnguage", 
NULL
, 
Ïnguage
->language );

386 
	`pAddSŒšg
Ğ
»que¡
, 
IPP_TAG_OPERATION
, 
IPP_TAG_URI
,

387 "´š‹r-uri", 
NULL
, 
uri
 );

390 
	`pAddSŒšg
(
»que¡
, 
IPP_TAG_OPERATION
, 
IPP_TAG_NAME
,

391 "»que¡šg-u£r-Çme", 
NULL
, 
	`cupsU£r
());

393 ià(
İ
 =ğ
IPP_PURGE_JOBS
)

394 
	`pAddBoŞ—n
(
»que¡
, 
IPP_TAG_OPERATION
, "purge-jobs", 1);

396 
»¥Ú£
 = 
	`cupsDoReque¡
(
h‰p
, 
»que¡
, "/admin/");

398 ià(
»¥Ú£
 =ğ
NULL
)

399 
»t_¡©us
 = 
	`cupsLa¡E¼Ü
();

401 
»t_¡©us
 = 
	`pG‘StusCode
Ğ
»¥Ú£
 );

404 ià(
»t_¡©us
 =ğ
IPP_FORBIDDEN
 && 
auth_ÿnûl_»q
)

406 
»t_¡©us
 = 
IPP_NOT_AUTHENTICATED
;

407 
auth_ÿnûl_»q
 = 0;

410 
abÜt
:

411 ià(
u£ºame
)

412 
	`cupsS‘U£r
(
u£ºame
);

414 iàĞ
»¥Ú£
 !ğ
NULL
 )

415 
	`pD–‘e
Ğ
»¥Ú£
 );

417  
»t_¡©us
;

418 
	}
}

428 
p_t
 * 
	$__g‘CupsPrš‹rs
()

430 
p_t
 *
»que¡
 = 
NULL
;

431 
p_t
 *
»¥Ú£
 = 
NULL
;

432 
p_©Œibu‹_t
 *
©Œ
;

435 cÚ¡ * 
©Œs
[] =

448 ià(
	`acquœeCupsIn¡ªû
(è=ğ
NULL
)

450 
abÜt
;

454 
»que¡
 = 
	`pNewReque¡
(
CUPS_GET_PRINTERS
);

456 ià(
»que¡
 =ğ
NULL
)

457 
abÜt
;

460 
	`pAddSŒšgs
Ğ
»que¡
, 
IPP_TAG_OPERATION
, 
IPP_TAG_KEYWORD
,

461 "»que¡ed-©Œibu‹s", Ğ
©Œs
 ) / (‡ttrs[ 0 ] ),

462 
NULL
, 
©Œs
 );

465 
»¥Ú£
 = 
	`cupsDoReque¡
Ğ
h‰p
, 
»que¡
, "/" );

467 
abÜt
:

469  
»¥Ú£
;

470 
	}
}

479 
	$__·r£Prš‹rA‰ribu‹s
(
p_t
 *
»¥Ú£
, 
´š‹r_t
 **
´š‹r_li¡
)

481 
p_©Œibu‹_t
 *
©Œ
;

482 
p_g_t
 
g½_g
;

483 
p_g_t
 
v®_g
;

484 *
©Œ_Çme
;

486 
´š‹r_t
 *
t_´š‹r
 = 
NULL
;

487 
´š‹r_t
 *
t_´š‹r_li¡
 = 
NULL
;

489  
©Œ
 = 
	`pFœ¡A‰ribu‹
(
»¥Ú£
);‡‰¸!ğ
NULL
;‡‰¸ğ
	`pNextA‰ribu‹
(response) )

491 iàĞ
	`pG‘GroupTag
(
©Œ
è!ğ
IPP_TAG_PRINTER
 )

494 
t_´š‹r
 = (
´š‹r_t
 *è
	`ÿÎoc
(1, (printer_t));

495 ià(
t_´š‹r
 =ğ
NULL
) {

496 
	`BUG
("Memory‡llocation for…rinter struct failed!\n");

497 
abÜt
;

500 ià(
t_´š‹r_li¡
 =ğ
NULL
) {

501 
t_´š‹r_li¡
 = 
t_´š‹r
;

502 *
´š‹r_li¡
 = 
t_´š‹r_li¡
;

504 
t_´š‹r_li¡
->
Ãxt
 = 
t_´š‹r
;

505 
t_´š‹r_li¡
 = 
t_´š‹r
;

508  
©Œ
 !ğ
NULL
 && 
	`pG‘GroupTag
×‰rè=ğ
IPP_TAG_PRINTER
 ) {

509 
©Œ_Çme
 = 
	`pG‘Name
(
©Œ
);

510 
v®_g
 = 
	`pG‘V®ueTag
(
©Œ
);

512 iàĞ
	`¡rcmp
(
©Œ_Çme
, "printer-name") == 0 &&

513 
v®_g
 =ğ
IPP_TAG_NAME
 ) {

514 
	`¡rıy
(
t_´š‹r
->
Çme
, 
	`pG‘SŒšg
(
©Œ
, 0, 
NULL
) );

516 iàĞ
	`¡rcmp
(
©Œ_Çme
, "device-uri") == 0 &&

517 
v®_g
 =ğ
IPP_TAG_URI
 ) {

518 
	`¡rıy
(
t_´š‹r
->
deviû_uri
, 
	`pG‘SŒšg
(
©Œ
, 0, 
NULL
) );

520 iàĞ
	`¡rcmp
(
©Œ_Çme
, "printer-uri-supported") == 0 &&

521 
v®_g
 =ğ
IPP_TAG_URI
 ) {

522 
	`¡rıy
(
t_´š‹r
->
´š‹r_uri
, 
	`pG‘SŒšg
(
©Œ
, 0, 
NULL
) );

524 iàĞ
	`¡rcmp
(
©Œ_Çme
, "printer-info") == 0 &&

525 
v®_g
 =ğ
IPP_TAG_TEXT
 ) {

526 
	`¡rıy
(
t_´š‹r
->
šfo
, 
	`pG‘SŒšg
(
©Œ
, 0, 
NULL
) );

528 iàĞ
	`¡rcmp
(
©Œ_Çme
, "printer-location") == 0 &&

529 
v®_g
 =ğ
IPP_TAG_TEXT
 ) {

530 
	`¡rıy
(
t_´š‹r
->
loÿtiÚ
, 
	`pG‘SŒšg
(
©Œ
, 0, 
NULL
) );

532 iàĞ
	`¡rcmp
(
©Œ_Çme
, "printer-make-and-model") == 0 &&

533 
v®_g
 =ğ
IPP_TAG_TEXT
 ) {

534 
	`¡rıy
(
t_´š‹r
->
make_mod–
, 
	`pG‘SŒšg
(
©Œ
, 0, 
NULL
) );

536 iàĞ
	`¡rcmp
(
©Œ_Çme
, "printer-state") == 0 &&

537 
v®_g
 =ğ
IPP_TAG_ENUM
 ) {

538 
t_´š‹r
->
¡©e
 = ( 
p_¡©e_t
 ) 
	`pG‘IÁeg”
(
©Œ
, 0);

540 ià(!
	`¡rcmp
(
©Œ_Çme
, "printer-is-accepting-jobs") &&

541 
v®_g
 =ğ
IPP_TAG_BOOLEAN
) {

542 
t_´š‹r
->
acû±šg
 = 
	`pG‘BoŞ—n
(
©Œ
, 0);

545 
©Œ
 = 
	`pNextA‰ribu‹
(
»¥Ú£
);

549 
abÜt
:

551 
	}
}

554 
	$g‘CupsPrš‹rs
(
´š‹r_t
 **
´š‹r_li¡
)

556 
p_t
 *
»¥Ú£
 = 
NULL
;

557 
»t_¡©us
 = 0;

559 
»¥Ú£
 = 
	`__g‘CupsPrš‹rs
();

561 ià(
»¥Ú£
) {

562 
»t_¡©us
 = 
	`__·r£Prš‹rA‰ribu‹s
(
»¥Ú£
, 
´š‹r_li¡
);

563 
	`pD–‘e
(
»¥Ú£
);

566  
»t_¡©us
;

567 
	}
}

574 
	$š™ŸlizeIPPReque¡
(
p_t
 *
»que¡
)

577 ià(
»que¡
)

580 
	`pS‘V”siÚ
 ( 
»que¡
, 2, 0 );

581 
	`pS‘Reque¡Id
 ( 
»que¡
, 100 );

583 
	}
}

589 
p_t
 * 
	$ü—‹DeviûStusReque¡
()

592 
p_t
 *
»que¡
 = 
NULL
;

593 cÚ¡ * 
©Œs
[] =

604 
»que¡
 = 
	`pNewReque¡
(
IPP_GET_PRINTER_ATTRIBUTES
);

605 
	`š™ŸlizeIPPReque¡
(
»que¡
);

606 ià(
»que¡
)

608 
	`pAddSŒšg
(
»que¡
, 
IPP_TAG_OPERATION
, 
IPP_TAG_URI
, "´š‹r-uri", 
NULL
, "");

609 
	`pAddSŒšgs
Ğ
»que¡
, 
IPP_TAG_OPERATION
, 
IPP_TAG_KEYWORD
, "»que¡ed-©Œibu‹s", Ğ
©Œs
 ) / Ğ©Œs[ 0 ] ), 
NULL
,‡ttrs );

612  
»que¡
;

613 
	}
}

619 
HPIPP_RESULT
 
	$ExŒaùIPPD©a
(* 
d©a
, *
Ëngth
)

621 * 
±r
 = 
d©a
;

622 
chunked
 = 0;

623 
cÚ‹Á_Ëngth
 = 0;

624 
HPIPP_RESULT
 
¡©us
 = 
HPIPP_OK
;

626 
¡©us
 = 
	`·r£Re¥Ú£H—d”
(
d©a
, &
cÚ‹Á_Ëngth
, &
chunked
, 
NULL
);

627 if(
HPIPP_OK
 !ğ
¡©us
 )

628  
¡©us
;

630 
	`DBG
("T¿nsãr-Encodšg (chunked = %d), D©aL’gth(w™h h‰°h—d”èğ[%d]\n", 
chunked
, *
Ëngth
);

633 
±r
 = 
	`¡r¡r
(
d©a
, 
CRLFCRLF
);

634 if(
±r
)

636 
±r
 +ğ
CRLFCRLF_LENGTH
;

637 *
Ëngth
 = *Ëngth - (
±r
 - 
d©a
);

638 
	`memmove
(
d©a
, 
±r
, *
Ëngth
);

641 ià(
chunked
)

643 
¡©us
 = 
	`»moveChunkInfo
(
d©a
, 
Ëngth
);

646  
¡©us
;

647 
	}
}

654 
HPIPP_RESULT
 
	$·r£Re¥Ú£H—d”
(*
h—d”
, *
cÚ‹Á_Ëngth
, *
chunked
, *
h—d”_size
)

656 
HPIPP_RESULT
 
hr
 = 
HPIPP_OK
;

657 *
±r
 = 
NULL
;

659 if(!
h—d”
 || !
cÚ‹Á_Ëngth
 || !
chunked
)

660  
HPIPP_ERROR
;

662 if(
h—d”_size
)

664 
±r
 = 
	`¡r¡r
(
h—d”
, 
CRLFCRLF
);

665 *
h—d”_size
 = (
±r
)? (±¸- 
h—d”
 + 
CRLFCRLF_LENGTH
): 0;

668 ià(
	`¡rÿ£¡r
(
h—d”
, "Transfer-Encoding:") && strcasestr(header, "chunked"))

670 *
chunked
 = 1;

671 *
cÚ‹Á_Ëngth
 = 0;

673 ià(
±r
 = 
	`¡r¡r
(
h—d”
,"Content-Length:"))

675 *
cÚ‹Á_Ëngth
 = 
	`¡¹Ş
(
±r
 + 
	`¡¾’
("CÚ‹Á-L’gth:"), 
NULL
, 
BASE_DECIMAL
);

676 *
chunked
 = 0;

680 
	`DBG
("parseResponseHeader: Could‚ot find Transfer-Encoding: chunked or Content-Length: \n");

681 
hr
 = 
HPIPP_ERROR
;

684 
	`DBG
("chunked = [%d] , CÚ‹Á_Ëngth = [%d]\n", *
chunked
, *
cÚ‹Á_Ëngth
);

685  
hr
;

686 
	}
}

696 
p_t
 * 
	$g‘DeviûStusA‰ribu‹s
(* 
deviû_uri
, *
couÁ
)

698 
p_t
 *
»que¡
 = 
NULL
;

699 
p_t
 *
»¥Ú£
 = 
NULL
;

700 
p_©Œibu‹_t
 *
©Œ
;

701 
max_couÁ
 = 0;

704 
»que¡
 = 
	`ü—‹DeviûStusReque¡
();

705 ià(
»que¡
 =ğ
NULL
)

706 
abÜt
;

709 if(
	`¡rÿ£¡r
(
deviû_uri
, ":/usb"è!ğ
NULL
 )

711 
»¥Ú£
 = 
	`usbDoReque¡
(
»que¡
, 
deviû_uri
);

713 ià(
	`¡rÿ£¡r
(
deviû_uri
, ":/Ãt"è!ğ
NULL
 )

715 
»¥Ú£
 = 
	`ÃtwÜkDoReque¡
(
»que¡
, 
deviû_uri
);

719 
	`BUG
("Inv®id deviû URI (%s)\n", 
deviû_uri
);

720 
abÜt
;

724 ià(
»¥Ú£
)

725  
©Œ
 = 
	`pFœ¡A‰ribu‹
Ğ
»¥Ú£
 );‡‰¸!ğ
NULL
;‡‰¸ğ
	`pNextA‰ribu‹
(„esponse ) )

726 
max_couÁ
++;

728 
abÜt
:

729 *
couÁ
 = 
max_couÁ
;

730  
»¥Ú£
;

731 
	}
}

741 
p_t
 * 
	$usbDoReque¡
(
p_t
 *
»que¡
, * 
deviû_uri
)

743 
p_t
 *
»¥Ú£
 = 
NULL
;

744 
p_¡©e_t
 
¡©e
;

745 
¿w_p
 
¿w_»que¡
;

746 
¿w_p
 
¿w_»¥Ú£
;

748 
	`mem£t
(&
¿w_»que¡
, 0, (raw_request));

749 
	`mem£t
(&
¿w_»¥Ú£
, 0, (raw_response));

752 
¡©e
 = 
	`pWr™eIO
(&
¿w_»que¡
, (
p_iocb_t
)
¿w_p_»que¡_ÿÎback
, 1, 
NULL
, 
»que¡
);

753 if(
IPP_ERROR
 =ğ
¡©e
)

755 
	`BUG
("ippWriteIO Failed...\n");

756 
abÜt
;

760 ià(
	`´•’d_h‰p_h—d”
(&
¿w_»que¡
è!ğ
HPIPP_OK
)

761 
abÜt
;

764 ià(
HPMUD_R_OK
 !ğ
	`£ndUSBReque¡
(
¿w_»que¡
.
d©a
,„aw_»que¡.
d©a_Ëngth
, &
¿w_»¥Ú£
, 
deviû_uri
))

766 
abÜt
;

770 
»¥Ú£
 = 
	`pNew
();

771 
¡©e
 = 
	`pR—dIO
(&
¿w_»¥Ú£
, (
p_iocb_t
)
¿w_p_»¥Ú£_»ad_ÿÎback
, 1, 
NULL
, 
»¥Ú£
);

772 if(
»¥Ú£
 && (
IPP_ERROR
 =ğ
¡©e
))

774 
	`BUG
("ippWriteIO Failed...\n");

775 
	`pD–‘e
Ğ
»¥Ú£
 );

776 
»¥Ú£
 = 
NULL
;

779 
abÜt
:

780  
»¥Ú£
;

781 
	}
}

789 
p_t
 * 
	$ÃtwÜkDoReque¡
(
p_t
 *
»que¡
, * 
deviû_uri
)

791 
p_t
 *
»¥Ú£
 = 
NULL
;

792 

[
HPMUD_LINE_SIZE
] = {0};

793 
h‰p_t
 * 
h‰p
 = 
NULL
;

796 
	`hpmud_g‘_uri_d©®šk
(
deviû_uri
, 

, 
HPMUD_LINE_SIZE
);

799 
h‰p
 = 
	`h‰pCÚÃùEnüy±
Ğ

, 
	`pPÜt
(), 
	`cupsEnüy±iÚ
() );

800 ià(
h‰p
 =ğ
NULL
)

801 
abÜt
;

804 iàĞĞ
»¥Ú£
 = 
	`cupsDoReque¡
Ğ
h‰p
, 
»que¡
, "/p/´š‹r" ) ) =ğ
NULL
 )

806 
abÜt
;

809 
abÜt
:

811  
»¥Ú£
;

812 
	}
}

819 
HPMUD_RESULT
 
	$£ndUSBReque¡
(*
buf
, 
size
, 
¿w_p
 *
»¥Ú£±r
, * 
deviû_uri
)

821 
HPMUD_DEVICE
 
hd
 = 0;

822 
HPMUD_CHANNEL
 
cd
;

823 
HPMUD_RESULT
 
¡©
 = 
HPMUD_R_OK
;

824 
deviû_®»ady_İ’
 = 0;

826 
	`DBG
("£ndUSBReque¡: buàğ%p, sizğ%d,„e¥Ú£±¸ğ%p, deviû_ur˜ğ%s\n", 
buf
, 
size
, 
»¥Ú£±r
, 
deviû_uri
);

829 ià((
¡©
 = 
	`hpmud_İ’_deviû
(
deviû_uri
, 
HPMUD_RAW_MODE
, &
hd
)è!ğ
HPMUD_R_OK
)

831 if(
¡©
 =ğ
HPMUD_R_INVALID_STATE
)

835 
hd
 = 1;

836 
deviû_®»ady_İ’
 = 1;

840 
	`BUG
("Deviû o³Àçed w™h stu codğ%d\n", 
¡©
);

841 
abÜt
;

846 ià((
¡©
 = 
	`hpmud_İ’_chªÃl
(
hd
, 
HPMUD_S_IPP_CHANNEL
, &
cd
)è!ğ
HPMUD_R_OK
)

848 ià((
¡©
 = 
	`hpmud_İ’_chªÃl
(
hd
, 
HPMUD_S_IPP_CHANNEL2
, &
cd
)è!ğ
HPMUD_R_OK
)

850 
	`BUG
("ChªÃÈİ’ faed w™h stu codğ%d\n", 
¡©
);

851 
abÜt
;

856 ià((
¡©
 = 
	`wr™eChªÃl
(
buf
, 
size
, 
hd
, 
cd
)è!ğ
HPMUD_R_OK
)

858 
	`BUG
("ChªÃÈwr™çed w™h stu codğ%d\n", 
¡©
);

859 
abÜt
;

863 ià((
¡©
 = 
	`»adChªÃl
(
»¥Ú£±r
, 
hd
, 
cd
)è!ğ
HPMUD_R_OK
)

865 
	`BUG
("ChªÃÈ»ad faed w™h stu codğ%d\n", 
¡©
);

871 
	`ExŒaùIPPD©a
(
»¥Ú£±r
->
d©a
, &»¥Ú£±r->
d©a_Ëngth
);

872 
¡©
 = 
HPMUD_R_OK
;

874 
abÜt
:

876 ià(
cd
 > 0)

877 
	`hpmud_şo£_chªÃl
(
hd
, 
cd
);

878 ià(
hd
 > 0 && !
deviû_®»ady_İ’
)

879 
	`hpmud_şo£_deviû
(
hd
);

881  
¡©
;

882 
	}
}

889 
HPMUD_RESULT
 
	$»adChªÃl
(
¿w_p
 *
»¥Ú£±r
, 
HPMUD_DEVICE
 
hd
, 
HPMUD_CHANNEL
 
cd
)

891 
by‹s_»ad
 = 0;

892 
by‹s_»maššg
 = 0;

893 
cÚ‹Á_Ëngth
 = 0;

894 
chunked
 = 0;

895 
h—d”_size
 = 0;

896 
HPMUD_RESULT
 
¡©
 = 
HPMUD_R_OK
;

897 * 
d©a
 = 
»¥Ú£±r
->data;

898 * 
size
 = &
»¥Ú£±r
->
d©a_Ëngth
;

900 if(!
»¥Ú£±r
)

902 
	`DBG
("NULL„esponseptr…assed.\n");

903  
HPMUD_R_INVALID_LENGTH
;

906 
	`mem£t
(
»¥Ú£±r
, 0, 
MAX_IPP_DATA_LENGTH
);

909 
¡©
 = 
	`hpmud_»ad_chªÃl
(
hd
, 
cd
, 
d©a
, 
USB_BULK_TRANSFER_LENGTH
, 
TIMEOUT
, &
by‹s_»ad
);

910 if(
HPMUD_R_OK
 !ğ
¡©
 && 
HPMUD_R_IO_TIMEOUT
 != stat)

912  
¡©
;

915 
	`DBG
("H—d” by‹ »ad fromhchªÃÈğ%d, stu ğ[%d] \n", 
by‹s_»ad
, 
¡©
);

916 *
size
 +ğ
by‹s_»ad
;

918 ià(
HPIPP_OK
 !ğ
	`·r£Re¥Ú£H—d”
(
d©a
, &
cÚ‹Á_Ëngth
, &
chunked
, &
h—d”_size
))

919  
HPMUD_R_IO_ERROR
;

921 
by‹s_»maššg
 = 
cÚ‹Á_Ëngth
 - (
by‹s_»ad
 - 
h—d”_size
);

924 
by‹s_»ad
)

926 ià(*
size
 + 
USB_BULK_TRANSFER_LENGTH
 > 
MAX_IPP_DATA_LENGTH
)

928 
¡©
 = 
HPMUD_R_INVALID_LENGTH
;

932 
¡©
 = 
	`hpmud_»ad_chªÃl
(
hd
, 
cd
, &
d©a
[*
size
], 
USB_BULK_TRANSFER_LENGTH
, 
TIMEOUT
, &
by‹s_»ad
);

934 
	`DBG
("By‹ »ad fromhchªÃÈğ%d , stu ğ[%d], by‹s_»maššg = [%d]\n", 
by‹s_»ad
, 
¡©
, 
by‹s_»maššg
);

935 if(
HPMUD_R_OK
 !ğ
¡©
 && 
HPMUD_R_IO_TIMEOUT
 != stat)

938 *
size
 +ğ
by‹s_»ad
;

939 if(
chunked
)

941 if(
	`memcmp
(&
d©a
[*
size
 - 
CHUNK_DELIMITER_LENGTH
], 
CHUNK_DELIMITER
, CHUNK_DELIMITER_LENGTH) == 0)

943 
	`DBG
("Chunkƒnd„ecieved....\n");

949 
by‹s_»maššg
 -ğ
by‹s_»ad
;

950 if(
by‹s_»maššg
 == 0)

952 
	`DBG
("Complete unchunked data„ecieved....\n");

958 
	`DBG
("TÙ® by‹ »ad fromhchªÃÈğ%d\n", *
size
);

959  
¡©
;

960 
	}
}

966 
HPMUD_RESULT
 
	$wr™eChªÃl
(*
buf
, 
size
, 
HPMUD_DEVICE
 
hd
, 
HPMUD_CHANNEL
 
cd
)

968 
timeout
 = 1;

969 
tÙ®
 = 0;

970 
Ën
 = 0;

971 
Œªsãr_size
 = 0;

972 
HPMUD_RESULT
 
¡©
 = 
HPMUD_R_OK
;

974 
size
 > 0)

976 
Œªsãr_size
 = (
size
 > 
USB_BULK_TRANSFER_LENGTH
)? USB_BULK_TRANSFER_LENGTH : size;

977 
¡©
 = 
	`hpmud_wr™e_chªÃl
(
hd
, 
cd
, 
buf
+
tÙ®
, 
Œªsãr_size
, 
timeout
, &
Ën
);

978 
	`DBG
("By‹ wr™‹ÀÚhchªÃÈğ%d Sizğ%d,¿nsãr_sizğ%d\n\n\n", 
Ën
, 
size
, 
Œªsãr_size
);

979 
tÙ®
 = 
Ën
;

980 
size
 -ğ
Ën
;

983 
	`DBG
("TÙ® by‹ wr™‹ÀÚhchªÃÈğ%d\n", 
tÙ®
);

985  
¡©
;

986 
	}
}

995 
ssize_t


996 
	$¿w_p_»¥Ú£_»ad_ÿÎback
(
¿w_p
 *
¤c
,

997 
p_uch¬_t
 *
bufãr
,

998 
size_t
 
Ëngth
)

1002 ià(
¤c
->
d©a_Ëngth
 < 
Ëngth
 )

1004 
	`DBG
("Reque¡ed L’gth(%dèi mÜthª sourû bufã¸Ëngth(%d).\n", 
Ëngth
, 
¤c
->
d©a_Ëngth
);

1005 
Ëngth
 = 
¤c
->
d©a_Ëngth
;

1009 
	`memıy
(
bufãr
, 
¤c
->
d©a
, 
Ëngth
);

1012 
	`memmove
(
¤c
->
d©a
, &¤c->d©a[
Ëngth
], src->
d©a_Ëngth
 -†ength);

1015 
¤c
->
d©a_Ëngth
 = src->d©a_Ëngth - 
Ëngth
;

1017  (
Ëngth
);

1019 
	}
}

1030 
ssize_t


1031 
	$¿w_p_»que¡_ÿÎback
(vŞ©
¿w_p
 *
¿w_bufãr
,

1032 
p_uch¬_t
 *
bufãr
,

1033 
size_t
 
Ëngth
)

1036 ià(
¿w_bufãr
->
d©a_Ëngth
 + 
Ëngth
 < 
MAX_IPP_DATA_LENGTH
)

1038 
	`memıy
((*)&
¿w_bufãr
->
d©a
[¿w_bufãr->
d©a_Ëngth
], 
bufãr
, 
Ëngth
);

1039 
¿w_bufãr
->
d©a_Ëngth
 =„aw_bufãr->d©a_Ëngth + 
Ëngth
;

1043 
	`BUG
("Insuffic›Á„aw_p->d©¨size. %d by‹ Ãeded.\n", 
¿w_bufãr
->
d©a_Ëngth
 + 
Ëngth
);

1046  (
Ëngth
);

1047 
	}
}

1054 
HPIPP_RESULT
 
	$´•’d_h‰p_h—d”
(
¿w_p
 *
¿w_»que¡
)

1057 *
h‰p_h—d”_m¶©e
 = "POST /ipp/printer HTTP/1.1\r\nContent-Length: %d\r\nContent-Type:‡pplication/ipp\r\nHOST: Localhost\r\n\r\n";

1058 
h‰p_h—d”
[1024] = {0};

1059 
h‰p_h—d”_size
 = 0;

1062 
h‰p_h—d”_size
 = 
	`¥rštf
(
h‰p_h—d”
, 
h‰p_h—d”_m¶©e
, 
¿w_»que¡
->
d©a_Ëngth
);

1065 ià(
¿w_»que¡
->
d©a_Ëngth
 + 
h‰p_h—d”_size
 >ğ
MAX_IPP_DATA_LENGTH
)

1066  
HPIPP_INVALID_LENGTH
;

1068 
	`memmove
(
¿w_»que¡
->
d©a
 + 
h‰p_h—d”_size
,„aw_»que¡->d©¨,„aw_»que¡->
d©a_Ëngth
);

1069 
	`memıy
(
¿w_»que¡
->
d©a
, 
h‰p_h—d”
, 
h‰p_h—d”_size
);

1070 
¿w_»que¡
->
d©a_Ëngth
 =„aw_»que¡->d©a_Ëngth + 
h‰p_h—d”_size
;

1072  
HPIPP_OK
;

1074 
	}
}

1079 
HPIPP_RESULT
 
	$»moveChunkInfo
(* 
d©a
, *
Ëngth
)

1081 * 
chunksize_¡¬t
 = 
d©a
;

1082 * 
chunksize_’d
 = 
NULL
;

1083 
chunkËn
 = 0;

1084 
»maššg_by‹s
 = *
Ëngth
;

1085 
HPIPP_RESULT
 
hr
 = 
HPIPP_OK
;

1086 
ÃwËngth
 = *
Ëngth
;

1090 
chunksize_’d
 = 
	`¡r¡r
(
chunksize_¡¬t
, 
CRLF
);

1091 if(
chunksize_’d
 =ğ
NULL
)

1093 
	`BUG
("removeChunkInfo failed.\n");

1094  
HPIPP_ERROR
;

1097 
chunksize_’d
 +ğ
CRLF_LENGTH
;

1098 
chunkËn
 = 
	`¡¹Ş
(
chunksize_¡¬t
, 
NULL
, 
BASE_HEX
);

1099 
»maššg_by‹s
 -ğ(
chunksize_’d
 -
chunksize_¡¬t
);

1101 
	`DBG
("chunkËÀğ[%d],„emaššg_by‹sğ[%d],‚ewËngth = [%d]\n", 
chunkËn
, 
»maššg_by‹s
, 
ÃwËngth
);

1102 if(
chunkËn
 > 
»maššg_by‹s
)

1104 
	`BUG
("RemoveChunkInfo failed.\n");

1105  
HPIPP_ERROR
;

1108 
	`memmove
(
chunksize_¡¬t
, 
chunksize_’d
, 
»maššg_by‹s
);

1109 
ÃwËngth
 -ğ(
chunksize_’d
 -
chunksize_¡¬t
);

1110 
chunksize_¡¬t
 +ğ
chunkËn
;

1111 
»maššg_by‹s
 -ğ
chunkËn
;

1114 if(
	`memcmp
(
chunksize_¡¬t
, 
CRLF
, 
CRLF_LENGTH
) == 0)

1116 
»maššg_by‹s
 -ğ
CRLF_LENGTH
;

1117 
ÃwËngth
 -ğ
CRLF_LENGTH
;

1118 
	`memmove
(
chunksize_¡¬t
, chunksize_¡¬ˆ+ 
CRLF_LENGTH
, 
»maššg_by‹s
);

1121 } 
chunkËn
);

1124 
	`mem£t
(
d©a
+
ÃwËngth
, 0, 
MAX_IPP_DATA_LENGTH
 -‚ewlength);

1125 *
Ëngth
 = 
ÃwËngth
;

1127  
hr
;

1128 
	}
}

	@protocol/hp_ipp.h

22 #iâdeà
_HP_IPP_H


23 
	#_HP_IPP_H


	)

25 
	~<cups/cups.h
>

26 
	~<cups/Ïnguage.h
>

27 
	~<cups/µd.h
>

30 
	#HP_DEV_URI_LEN
 256

	)

31 
	#HP_DEV_NAME_LEN
 128

	)

33 
	#MAX_ATTR_VALUES
 8

	)

34 
	#MAX_IPP_DATA_LENGTH
 20000

	)

36 
	#USB_BULK_TRANSFER_LENGTH
 512

	)

38 
	#CRLF
 "\r\n"

	)

39 
	#CRLF_LENGTH
 2

	)

40 
	#CRLFCRLF
 "\r\n\r\n"

	)

41 
	#CRLFCRLF_LENGTH
 4

	)

43 
	#CHUNK_DELIMITER
 "0\r\n\r\n"

	)

44 
	#CHUNK_DELIMITER_LENGTH
 5

	)

46 
	#BASE_DECIMAL
 10

	)

47 
	#BASE_HEX
 16

	)

49 
	#TIMEOUT
 3

	)

52 #ià(
CUPS_VERSION_MAJOR
 > 1è|| (
CUPS_VERSION_MINOR
 > 5)

53 
	#HAVE_CUPS_1_6
 1

	)

56 #iâdeà
HAVE_CUPS_1_6


57 
	#pG‘CouÁ
(
©Œ
è©Œ->
num_v®ues


	)

58 
	#pG‘GroupTag
(
©Œ
è©Œ->
group_g


	)

59 
	#pG‘V®ueTag
(
©Œ
è©Œ->
v®ue_g


	)

60 
	#pG‘Name
(
©Œ
è©Œ->
Çme


	)

61 
	#pG‘BoŞ—n
(
©Œ
, 
–em’t
è©Œ->
v®ues
[–em’t].
boŞ—n


	)

62 
	#pG‘IÁeg”
(
©Œ
, 
–em’t
è©Œ->
v®ues
[–em’t].
š‹g”


	)

63 
	#pG‘StusCode
(
p
èp->
»que¡
.
¡©us
.
¡©us_code


	)

64 
	#pG‘SŒšg
(
©Œ
, 
–em’t
, 
Ïnguage
è©Œ->
v®ues
[–em’t].
¡ršg
.
‹xt


	)

67 
p_©Œibu‹_t
 * 
	$pFœ¡A‰ribu‹
Ğ
p_t
 *
p
 )

69 ià(!
p
)

70  (
NULL
);

71  (
p
->
cu¼’t
 = iµ->
©Œs
);

72 
	}
}

74 
p_©Œibu‹_t
 * 
	$pNextA‰ribu‹
Ğ
p_t
 *
p
 )

76 ià(!
p
 || !p->
cu¼’t
)

77  (
NULL
);

78  (
p
->
cu¼’t
 = iµ->cu¼’t->
Ãxt
);

79 
	}
}

81 
	$pS‘O³¿tiÚ
Ğ
p_t
 *
p
, 
p_İ_t
 
İ
 )

83 ià(!
p
)

85 
p
->
»que¡
.
İ
.
İ”©iÚ_id
 = op;

87 
	}
}

89 
	$pS‘Reque¡Id
Ğ
p_t
 *
p
, 
»que¡_id
 )

91 ià(!
p
)

93 
p
->
»que¡
.
ªy
.
»que¡_id
 =„equest_id;

95 
	}
}

97 
	$pS‘V”siÚ
Ğ
p_t
 *
p
, 
majÜ
, 
mšÜ
 )

99 ià(!
p
)

101 
p
->
»que¡
.
ªy
.
v”siÚ
[0] = 
majÜ
;

102 
p
->
»que¡
.
ªy
.
v”siÚ
[1] = 
mšÜ
;

104 
	}
}

109 
	s_´š‹r_t


111 
	mdeviû_uri
 [
HP_DEV_URI_LEN
] ;

112 
	mÇme
 [
HP_DEV_NAME_LEN
] ;

113 
	m´š‹r_uri
 [
HP_DEV_URI_LEN
] ;

114 
	mloÿtiÚ
 [
HP_DEV_NAME_LEN
] ;

115 
	mmake_mod–
 [
HP_DEV_NAME_LEN
] ;

116 
	mšfo
 [
HP_DEV_NAME_LEN
] ;

117 
	m¡©e
;

118 
	macû±šg
;

119 
_´š‹r_t
 *
	mÃxt
;

120 } 
	t´š‹r_t
;

123 
	s_©Œ_t


125 * 
	mÇme
;

126 * 
	mv®ues
[
MAX_ATTR_VALUES
];

127 
	mcouÁ
;

128 
	mty³
;

129 } 
	t©Œ_t
;

132 
	s_¿w_p


134 
	md©a_Ëngth
;

135 
	md©a
[
MAX_IPP_DATA_LENGTH
];

136 } 
	t¿w_p
;

138 
	e_HPIPP_RESULT


140 
	mHPIPP_OK
 = 0,

141 
	mHPIPP_ERROR
 = 1,

142 
	mHPIPP_INVALID_LENGTH
 = 2,

143 } 
	tHPIPP_RESULT
;

146 
h‰p_t
 * 
	gh‰p
 = 
NULL
;

147 
	gauth_ÿnûl_»q
 = 0;

151 
h‰p_t
* 
acquœeCupsIn¡ªû
();

152 cÚ¡ *
g‘CupsE¼ÜSŒšg
(
¡©us
);

153 
ä“Prš‹rLi¡
(
´š‹r_t
 *
li¡
);

155 
ssize_t
 
¿w_p_»¥Ú£_»ad_ÿÎback
(
¿w_p
 *
¿w_bufãr
,
p_uch¬_t
 *
bufãr
,
size_t
 
Ëngth
);

156 
ssize_t
 
¿w_p_»que¡_ÿÎback
(vŞ©
¿w_p
 *
¿w_bufãr
, 
p_uch¬_t
 *
bufãr
, 
size_t
 
Ëngth
);

158 
š™ŸlizeIPPReque¡
(
p_t
 *
»que¡
);

159 
·r£Prš‹rA‰ribu‹s
(
p_t
 *
»¥Ú£
, 
´š‹r_t
 * 
´š‹r_li¡
, 
size
);

160 
p_t
 * 
ü—‹DeviûStusReque¡
();

161 
p_t
 * 
usbDoReque¡
(p_ˆ*
»que¡
, * 
deviû_uri
);

162 
p_t
 * 
ÃtwÜkDoReque¡
(p_ˆ*
»que¡
, * 
deviû_uri
);

163 
p_t
 * 
g‘DeviûStusA‰ribu‹s
(* 
deviû_uri
, *
couÁ
);

164 
g‘CupsPrš‹rs
(
´š‹r_t
 **
´š‹r_li¡
);

166 
HPIPP_RESULT
 
·r£Re¥Ú£H—d”
(* 
h—d”
, *
cÚ‹Á_Ëngth
, *
chunked
, * 
h—d”_size
);

167 
HPIPP_RESULT
 
´•’d_h‰p_h—d”
(
¿w_p
 *
¿w_»que¡
);

168 
HPMUD_RESULT
 
£ndUSBReque¡
(*
buf
, 
size
, 
¿w_p
 *
»¥Ú£±r
, * 
deviû_uri
);

	@protocol/hp_ipp_i.h

20 #iâdeà
_HP_IPP_I_H


21 
	#_HP_IPP_I_H


	)

23 
	~"hpmud.h
"

24 
	~"uts.h
"

26 
HPIPP_RESULT
 
»moveChunkInfo
(* 
d©a
, *
Ëngth
);

27 
HPIPP_RESULT
 
´•’d_h‰p_h—d”
(
¿w_p
 *
¿w_»que¡
);

28 
ssize_t


29 
¿w_p_»que¡_ÿÎback
(vŞ©
¿w_p
 *
¿w_bufãr
,

30 
p_uch¬_t
 *
bufãr
,

31 
size_t
 
Ëngth
);

32 
ssize_t


33 
¿w_p_»¥Ú£_»ad_ÿÎback
(
¿w_p
 *
¤c
,

34 
p_uch¬_t
 *
bufãr
,

35 
size_t
 
Ëngth
);

36 
HPMUD_RESULT
 
wr™eChªÃl
(*
buf
, 
size
, 
HPMUD_DEVICE
 
hd
, 
HPMUD_CHANNEL
 
cd
);

37 
HPMUD_RESULT
 
»adChªÃl
(
¿w_p
 *
»¥Ú£±r
, 
HPMUD_DEVICE
 
hd
, 
HPMUD_CHANNEL
 
cd
);

38 
HPMUD_RESULT
 
£ndUSBReque¡
(*
buf
, 
size
, 
¿w_p
 *
»¥Ú£±r
, * 
deviû_uri
);

39 
p_t
 * 
ÃtwÜkDoReque¡
(p_ˆ*
»que¡
, * 
deviû_uri
);

40 
p_t
 * 
usbDoReque¡
(p_ˆ*
»que¡
, * 
deviû_uri
);

	@scan/sane/OrbliteScan/LinuxCommon.h

1 #iâdeà
H_LšuxCommÚ


2 
	#H_LšuxCommÚ


	)

4 
	~<sys/ty³s.h
>

8 * 
	tSŒšgPŒ
;

9 
	tBoŞ—n
;

10 * 
	tPŒ
;

12 
	tUIÁ8
;

13 
UIÁ8
* 
	tPUIÁ8
;

14 sigÃd 
	tSIÁ8
;

15 
	tUIÁ16
;

16 sigÃd 
	tSIÁ16
;

17 
u_št32_t
 
	tUIÁ32
;

18 
št32_t
 
	tSIÁ32
;

21 
__S64_TYPE
 
	tSIÁ64
;

22 
__U64_TYPE
 
	tUIÁ64
;

23 
__S64_TYPE
 
	tšt64_t
;

24 
__U64_TYPE
 
	tušt64_t
;

31 
SIÁ16
 
	tOSE¼
;

33 
	tFourCh¬Code
;

34 
FourCh¬Code
 
	tOSTy³
;

36 
	tIUnknown
;

38 
	#FAILED
(
Stus
è((
HRESULT
)(Stusè< 0)

	)

42 
	tFSS³c
;

43 
	tCFURLRef
;

44 
	tCFBundËRef
;

45 * 
	tHªdË
;

48 
	#NewPŒ
 
m®loc


	)

49 
	#Di¥o£PŒ
 
ä“


	)

	@scan/sane/OrbliteScan/MacCommon.h

1 #iâdeà
H_MacCommÚ


2 
	#H_MacCommÚ


	)

4 #iâdeà
__lšux__


5 
	~<CÜeFound©iÚ/CFPlugInCOM.h
>

6 
	#__CFPlugInCOM_Inşuded__


	)

9 #ifdeà
__lšux__


10 
	~"LšuxCommÚ.h
"

13 
	~<¡dio.h
>

14 
	~<¡ršg.h
>

15 
	~<¡dlib.h
>

16 
	~<¡d¬g.h
>

18 #iâdeà
MAX_PATH


19 
	#MAX_PATH
 260

	)

22 #iâdeà
_MAX_PATH


23 
	#_MAX_PATH
 1024

	)

26 
	#OUT


	)

27 
	#IN


	)

29 #iâdeà
OKAY


30 
	#OKAY
 0

	)

33 
	#MAXDWORD
 0xffffffff

	)

35 
	#__cdeş


	)

37 
	#ATLASSERT
 
as£¹


	)

38 
	#ASSERT
 
as£¹


	)

39 
	#_ASSERT
 
as£¹


	)

41 
	#IDOK
 1

	)

42 
	#IDCANCEL
 2

	)

43 
	#IDABORT
 3

	)

44 
	#IDRETRY
 4

	)

45 
	#IDIGNORE
 5

	)

46 
	#IDYES
 6

	)

47 
	#IDNO
 7

	)

49 
	#TEXT
(
s
è
	)
s

50 
	#_TEXT
(
s
è
	)
s

51 
	#_T
(
s
è
	)
s

53 
	#_tz£t
 
tz£t


	)

58 
	#STDMETHOD
(
x
è
vœtu®
 
HRESULT
 
	)
x

59 
	#STDMETHODIMP
 
HRESULT


	)

60 
	#STDMETHODIMP_
(
x
è
	)
x

62 * 
	tHBITMAP
;

63 * 
	tPTIMERAPCROUTINE
;

64 * 
	tHANDLE
;

65 * 
	tHMODULE
;

66 
HANDLE
 *
	tLPHANDLE
;

67 
HANDLE
 
	tHINSTANCE
;

68 * 
	tHGLOBAL
;

69 
HANDLE
 
	tHKEY
;

70 
HKEY
 *
	tPHKEY
;

72 
	#DECLARE_HANDLE
(
Çme
èÇme##
__
 { 
unu£d
; }; Çme##
	t__
 *
	tÇme


	)

73 
	tDECLARE_HANDLE
(
	tHDC
);

75 
	tLONG
;

77 #ifdeà
_HP_SANE_ORBLITE_


79 
	tHRESULT
;

80 
	tBOOL
;

81 
u_št32_t
 
	tDWORD
;

82 
u_št16_t
 
	tWORD
;

84 
	tBYTE
;

85 
	tULONG
;

86 
	tUSHORT
;

87 
	tUINT
;

88 * 
	tPVOID
;

89 * 
	tLPVOID
;

90 
DWORD
 *
	tLPDWORD
;

91 
BYTE
* 
	tLPBYTE
;

92 
BYTE
* 
	tPBYTE
;

93 
WORD
* 
	tLPWORD
;

95 
	sgBITMAPINFOHEADER
 {

96 
DWORD
 
	mbiSize
;

97 
LONG
 
	mbiWidth
;

98 
LONG
 
	mbiHeight
;

99 
WORD
 
	mbiPÏÃs
;

100 
WORD
 
	mbiB™CouÁ
;

101 
DWORD
 
	mbiCom´essiÚ
;

102 
DWORD
 
	mbiSizeImage
;

103 
LONG
 
	mbiXP–sP”M‘”
;

104 
LONG
 
	mbiYP–sP”M‘”
;

105 
DWORD
 
	mbiCÌU£d
;

106 
DWORD
 
	mbiCÌImpÜÁ
;

107 } 
	tBITMAPINFOHEADER
;

123 
	tIUnknown
;

124 
	tULONG
;

125 * 
	tLPVOID
;

129 
BYTE
 
	tBOOLEAN
;

131 #iâdeà
__MACH__


132 
	tREFIID
;

134 
	tCHAR
;

135 #ifdeà
__BOOL_DEFINED_AS_CHAR


136 sigÃd 
	tBOOL
;

142 
u_št64_t
 
	tUINT64
;

143 
u_št64_t
 
	tDWORD64
;

144 
	tULONGLONG
;

145 
	tLONGLONG
;

146 
št64_t
 
	tINT64
;

147 
št64_t
 
	t_št64
;

150 
	tboŞ—n
;

151 
LONG
* 
	tPLONG
;

152 #iâdeà
__MACH__


155 
ULONG
* 
	tULONG_PTR
;

157 
	tUCHAR
;

158 
UCHAR
* 
	tPUCHAR
;

159 
	tINT
;

161 sigÃd 
	tINT8
;

162 
	tUINT8
;

163 
	tUINT16
;

164 
	tUINT32
;

165 sigÃd 
	tINT32
;

166 sigÃd 
	tINT16
;

174 
DWORD
 *
	tDWORD_PTR
;

175 
wch¬_t
 
	tWCHAR
;

176 cÚ¡ 
	twch¬_t
 *
	tLPCWSTR
;

177 
WCHAR
 *
	tLPWSTR
, *
	tPWSTR
;

178 
	tFLOAT
;

179 
	tFLOAT64
;

180 
	tDOUBLE
;

181 
size_t
 
	tSIZE_T
;

187 * 
	tHPINT8
;

188 * 
	tHPUINT8
;

189 * 
	tHPINT16
;

190 * 
	tHPUINT16
;

191 * 
	tHPINT32
;

192 * 
	tHPUINT32
;

193 * 
	tHPFLOAT32
;

194 * 
	tHPFLOAT64
;

196 * 
	tPINT8
;

197 * 
	tPUINT8
;

198 * 
	tPINT16
;

199 * 
	tPUINT16
;

200 
INT32
* 
	tPINT32
;

201 
UINT32
* 
	tPUINT32
;

203 * 
	tLPSTR
;

204 cÚ¡ * 
	tLPCSTR
;

205 cÚ¡ * 
	tLPCTSTR
;

206 * 
	tLPTSTR
;

207 
	tTCHAR
;

208 
	#A2T


	)

209 
	#T2CA


	)

210 
	#T2OLE
 
A2W


	)

211 
	#T2COLE
 
A2W


	)

212 
	#OLE2T
 
W2A


	)

213 
wch¬_t
 
	tOLECHAR
;

214 
OLECHAR
 *
	tLPOLESTR
;

215 cÚ¡ 
	tLPOLESTR
 
	tLPCOLESTR
;

216 
LPOLESTR
 
	tBSTR
;

217 ** 
	tHWND
;

218 
UINT
 
	tWPARAM
;

219 
LONG
 
	tLPARAM
;

220 
LONG
 
	tLRESULT
;

222 
	tPSTIDEVICE
;

223 
	tSCI
;

224 
	tPSTI
;

225 
	tREGSAM
;

226 
FILE
* 
	tHFILE
;

228 
	#HFILE_ERROR
 0

	)

230 
	#REG_NONE
 ( 0 )

231 
	#REG_SZ
 ( 1 )

232 
	#REG_EXPAND_SZ
 ( 2 )

234 
	#REG_BINARY
 ( 3 )

235 
	#REG_DWORD
 ( 4 )

236 
	#REG_DWORD_LITTLE_ENDIAN
 ( 4 )

237 
	#REG_DWORD_BIG_ENDIAN
 ( 5 )

238 
	#REG_LINK
 ( 6 )

239 
	#REG_MULTI_SZ
 ( 7 )

240 
	#REG_RESOURCE_LIST
 ( 8 )

241 
	#REG_FULL_RESOURCE_DESCRIPTOR
 ( 9 )

242 
	#REG_RESOURCE_REQUIREMENTS_LIST
 ( 10 )

	)

244 
	#REG_CREATED_NEW_KEY
 (0x00000001L)

245 
	#REG_OPENED_EXISTING_KEY
 (0x00000002L)

246 
	#REG_OPTION_NON_VOLATILE
 (0x00000000L)

247 
	#REG_OPTION_VOLATILE
 (0x00000001L)

248 

	)

249 
	#CALLBACK


	)

251 
	s_GUID
 {

252 
ULONG
 
	mD©a1
;

253 
	mD©a2
;

254 
	mD©a3
;

255 
	mD©a4
[8];

256 } 
	tGUID
;

258 
GUID
 
	tCLSID
;

260 #iâdeà
__lšux__


261 cÚ¡ 
CLSID
 
CLSID_NULL
;

262 cÚ¡ 
GUID
 
GUID_NULL
;

264 cÚ¡ 
CLSID
 
CLSID_NULL
;

267 
	sgPOINT


269 
LONG
 
	mx
;

270 
LONG
 
	my
;

271 } 
	tPOINT
, *
	tPPOINT
;

273 
	sgRECT


275 
LONG
 
	mËá
;

276 
LONG
 
	mtİ
;

277 
LONG
 
	mright
;

278 
LONG
 
	mbÙtom
;

279 } 
	tRECT
;

280 
RECT
 *
	tLPRECT
;

284 
DWORD
 
	mdwLowD©eTime
;

285 
DWORD
 
	mdwHighD©eTime
;

286 } 
	tFILETIME
;

287 
FILETIME
 *
	tPFILETIME
;

291 
DWORD
 
	mdwFeA‰ribu‹s
;

292 
FILETIME
 
	máC»©iÚTime
;

293 
FILETIME
 
	máLa¡AcûssTime
;

294 
FILETIME
 
	máLa¡Wr™eTime
;

295 
DWORD
 
	mnFeSizeHigh
;

296 
DWORD
 
	mnFeSizeLow
;

297 
DWORD
 
	mdwRe£rved0
;

298 
DWORD
 
	mdwRe£rved1
;

299 
TCHAR
 
	mcFeName
[
MAX_PATH
];

300 
TCHAR
 
	mcAÉ”Ç‹FeName
[14];

301 } 
	tWIN32_FIND_DATA
;

302 
WIN32_FIND_DATA
 *
	tLPWIN32_FIND_DATA
;

304 
	s_SYSTEMTIME
 {

305 
WORD
 
	mwY—r
;

306 
WORD
 
	mwMÚth
;

307 
WORD
 
	mwDayOfW“k
;

308 
WORD
 
	mwDay
;

309 
WORD
 
	mwHour
;

310 
WORD
 
	mwMšu‹
;

311 
WORD
 
	mwSecÚd
;

312 
WORD
 
	mwMli£cÚds
;

313 } 
	tSYSTEMTIME
, *
	tPSYSTEMTIME
, *
	tLPSYSTEMTIME
;

315 
	s_SECURITY_ATTRIBUTES
 {

316 
DWORD
 
	mnL’ght
;

317 
LPVOID
 
	mÍSecur™yDesütÜ
;

318 
BOOL
 
	mbInh”™HªdË
;

319 } 
	tSECURITY_ATTRIBUTES
, *
	tLPSECURITY_ATTRIBUTES
;

321 
	#DLL_PROCESS_ATTACH
 1

	)

322 
	#DLL_THREAD_ATTACH
 2

	)

323 
	#DLL_THREAD_DETACH
 3

	)

324 
	#DLL_PROCESS_DETACH
 0

	)

326 
	#FILE_DEVICE_PARALLEL_PORT
 0x00000016

	)

328 
	#FILE_FLAG_WRITE_THROUGH
 0x80000000

	)

329 
	#FILE_FLAG_OVERLAPPED
 0x40000000

	)

330 
	#FILE_FLAG_NO_BUFFERING
 0x20000000

	)

331 
	#FILE_FLAG_RANDOM_ACCESS
 0x10000000

	)

332 
	#FILE_FLAG_SEQUENTIAL_SCAN
 0x08000000

	)

333 
	#FILE_FLAG_DELETE_ON_CLOSE
 0x04000000

	)

334 
	#FILE_FLAG_BACKUP_SEMANTICS
 0x02000000

	)

335 
	#FILE_FLAG_POSIX_SEMANTICS
 0x01000000

	)

336 
	#FILE_FLAG_OPEN_REPARSE_POINT
 0x00200000

	)

337 
	#FILE_FLAG_OPEN_NO_RECALL
 0x00100000

	)

339 
	#FILE_BEGIN
 
SEEK_SET


	)

340 
	#FILE_CURRENT
 
SEEK_CUR


	)

341 
	#FILE_END
 
SEEK_END


	)

343 
	#INVALID_HANDLE_VALUE
 ((
HANDLE
)(-1))

	)

344 
	#INVALID_FILE_SIZE
 ((
DWORD
)0xFFFFFFFF)

	)

345 
	#INVALID_SET_FILE_POINTER
 ((
DWORD
)-1)

	)

346 
	#DELETE
 (0x00010000L)

	)

347 
	#READ_CONTROL
 (0x00020000L)

	)

348 
	#WRITE_DAC
 (0x00040000L)

	)

349 
	#WRITE_OWNER
 (0x00080000L)

	)

350 
	#SYNCHRONIZE
 (0x00100000L)

	)

351 
	#GENERIC_READ
 (0x80000000è

	)

352 
	#GENERIC_WRITE
 (0x40000000è

	)

353 
	#FILE_SHARE_READ
 (0x00000001è

	)

354 
	#FILE_SHARE_WRITE
 (0x00000002è

	)

357 
	#SRCCOPY
 (
DWORD
)0x00CC0020

	)

358 
	#SRCPAINT
 (
DWORD
)0x00EE0086

	)

359 
	#SRCAND
 (
DWORD
)0x008800C6

	)

360 
	#SRCINVERT
 (
DWORD
)0x00660046

	)

361 
	#SRCERASE
 (
DWORD
)0x00440328

	)

362 
	#NOTSRCCOPY
 (
DWORD
)0x00330008

	)

363 
	#NOTSRCERASE
 (
DWORD
)0x001100A6

	)

364 
	#MERGECOPY
 (
DWORD
)0x00C000CA

	)

365 
	#MERGEPAINT
 (
DWORD
)0x00BB0226

	)

366 
	#PATCOPY
 (
DWORD
)0x00F00021

	)

367 
	#PATPAINT
 (
DWORD
)0x00FB0A09

	)

368 
	#PATINVERT
 (
DWORD
)0x005A0049

	)

369 
	#DSTINVERT
 (
DWORD
)0x00550009

	)

370 
	#BLACKNESS
 (
DWORD
)0x00000042

	)

371 
	#WHITENESS
 (
DWORD
)0x00FF0062

	)

375 
	#DIB_RGB_COLORS
 0

	)

376 
	#DIB_PAL_COLORS
 1

	)

378 
	#CREATE_NEW
 1

	)

379 
	#CREATE_ALWAYS
 2

	)

380 
	#OPEN_EXISTING
 3

	)

381 
	#OPEN_ALWAYS
 4

	)

382 
	#TRUNCATE_EXISTING
 5

	)

384 
	#FILE_ATTRIBUTE_READONLY
 0x00000001

	)

385 
	#FILE_ATTRIBUTE_HIDDEN
 0x00000002

	)

386 
	#FILE_ATTRIBUTE_SYSTEM
 0x00000004

	)

387 
	#FILE_ATTRIBUTE_DIRECTORY
 0x00000010

	)

388 
	#FILE_ATTRIBUTE_ARCHIVE
 0x00000020

	)

389 
	#FILE_ATTRIBUTE_NORMAL
 0x00000080

	)

390 
	#FILE_ATTRIBUTE_TEMPORARY
 0x00000100

	)

392 
	#FILE_FLAG_WRITE_THROUGH
 0x80000000

	)

393 
	#FILE_FLAG_RANDOM_ACCESS
 0x10000000

	)

395 
	#METHOD_BUFFERED
 0

	)

396 
	#METHOD_IN_DIRECT
 1

	)

397 
	#METHOD_OUT_DIRECT
 2

	)

398 
	#METHOD_NEITHER
 3

	)

400 
	#FILE_ANY_ACCESS
 0

	)

401 
	#FILE_READ_ACCESS
 ( 0x0001 )

	)

402 
	#FILE_WRITE_ACCESS
 ( 0x0002 )

	)

403 
	#FILE_ALL_ACCESS
 ( 0x0003 )

	)

405 
	#ERROR_OPERATION_ABORTED
 995L

	)

406 
	#ERROR_IO_INCOMPLETE
 996L

	)

407 
	#ERROR_IO_PENDING
 997L

408 

	)

409 
	#ERROR_NO_MORE_FILES
 18L

	)

411 
	#WAIT_OBJECT_0
 0

	)

412 
	#WAIT_ABANDONED
 4

	)

413 
	#WAIT_TIMEOUT
 0x00000102L

	)

415 
	#C»©eMu‹x
(
©Œ
, 
owÃr
, 
Çme
è((
HANDLE
)1)

	)

416 
	#R–—£Mu‹x
(
hObj
è((
BOOL
)1)

	)

417 
	#Clo£Mu‹xHªdË
(
hObj
è
TRUE


	)

418 
	#R–—£Sem­hÜe
(
a
, 
b
, 
c
è1

	)

419 
	#T”mš©eTh»ad
(
a
, 
b
);

	)

423 
	#FACILITY_WINDOWS
 8

	)

424 
	#FACILITY_STORAGE
 3

	)

425 
	#FACILITY_SSPI
 9

	)

426 
	#FACILITY_SETUPAPI
 15

	)

427 
	#FACILITY_RPC
 1

	)

428 
	#FACILITY_WIN32
 7

	)

429 
	#FACILITY_CONTROL
 10

	)

430 
	#FACILITY_NULL
 0

	)

431 
	#FACILITY_MSMQ
 14

	)

432 
	#FACILITY_MEDIASERVER
 13

	)

433 
	#FACILITY_INTERNET
 12

	)

434 
	#FACILITY_ITF
 4

	)

435 
	#FACILITY_DISPATCH
 2

	)

436 
	#FACILITY_CERT
 11

	)

438 
	#PAGE_NOACCESS
 0x01

	)

439 
	#PAGE_READONLY
 0x02

	)

440 
	#PAGE_READWRITE
 0x04

	)

441 
	#PAGE_WRITECOPY
 0x08

	)

442 
	#PAGE_EXECUTE
 0x10

	)

443 
	#PAGE_EXECUTE_READ
 0x20

	)

444 
	#PAGE_EXECUTE_READWRITE
 0x40

	)

445 
	#PAGE_EXECUTE_WRITECOPY
 0x80

	)

446 
	#PAGE_GUARD
 0x100

	)

447 
	#PAGE_NOCACHE
 0x200

	)

448 
	#PAGE_WRITECOMBINE
 0x400

	)

449 
	#MEM_COMMIT
 0x1000

	)

450 
	#MEM_RESERVE
 0x2000

	)

451 
	#MEM_DECOMMIT
 0x4000

	)

452 
	#MEM_RELEASE
 0x8000

	)

453 
	#MEM_FREE
 0x10000

	)

454 
	#MEM_PRIVATE
 0x20000

	)

455 
	#MEM_MAPPED
 0x40000

	)

456 
	#MEM_RESET
 0x80000

	)

457 
	#MEM_TOP_DOWN
 0x100000

	)

458 
	#MEM_WRITE_WATCH
 0x200000

	)

459 
	#MEM_PHYSICAL
 0x400000

	)

460 
	#MEM_4MB_PAGES
 0x80000000

	)

461 
	#SEC_FILE
 0x800000

	)

462 
	#SEC_IMAGE
 0x1000000

	)

463 
	#SEC_RESERVE
 0x4000000

	)

464 
	#SEC_COMMIT
 0x8000000

	)

465 
	#SEC_NOCACHE
 0x10000000

	)

466 
	#MEM_IMAGE
 
SEC_IMAGE


	)

467 
	#WRITE_WATCH_FLAG_RESET
 0x01

	)

469 
	#MB_ICONEXCLAMATION
 0

	)

470 
	#MB_SYSTEMMODAL
 1

	)

471 
	#MB_ICONSTOP
 2

	)

472 
	#MB_OK
 3

	)

473 
	#MB_ICONERROR
 4

	)

474 
	#MB_ICONWARNING
 5

	)

475 
	#MB_TOPMOST
 6

	)

477 
	#VER_PLATFORM_WIN32_NT
 0

	)

478 
	#VER_PLATFORM_MACOS
 1

	)

480 
	#HRESULT_FROM_WIN32
(
x
è(x ? ((
HRESULT
è(((xè& 0x0000FFFFè| (
FACILITY_WIN32
 << 16è| 0x80000000)è: 0 )

	)

482 
	#CTL_CODE
Ğ
DeviûTy³
, 
FunùiÚ
, 
M‘hod
, 
Acûss
 ) ( \

483 ((
DeviûTy³
è<< 16è| ((
Acûss
è<< 14è| ((
FunùiÚ
è<< 2è| (
M‘hod
) \

484 )

	)

486 
	#MAKE_HRESULT
(
£v
,
çc
,
code
) \

487 ((
HRESULT
è((()(
£v
)<<31è| (()(
çc
)<<16è| (()(
code
))è)

	)

489 
	s_OVERLAPPED
 {

490 
DWORD
 
	mIÁ”Çl
;

491 
DWORD
 
	mIÁ”ÇlHigh
;

492 
DWORD
 
	mOff£t
;

493 
DWORD
 
	mOff£tHigh
;

494 
HANDLE
 
	mhEv’t
;

495 } 
	tOVERLAPPED
;

497 
OVERLAPPED
 *
	tLPOVERLAPPED
;

499 #ià
PRAGMA_STRUCT_ALIGN


500 #´agm¨
İtiÚs
 
®ign
=
mac68k


503 
	sgBITMAPFILEHEADER
 {

504 
WORD
 
	mbfTy³
;

505 
DWORD
 
	mbfSize
;

506 
WORD
 
	mbfRe£rved1
;

507 
WORD
 
	mbfRe£rved2
;

508 
DWORD
 
	mbfOffB™s
;

509 } 
	tBITMAPFILEHEADER
;

537 #ià
PRAGMA_STRUCT_ALIGN


538 #´agm¨
İtiÚs
 
®ign
=
»£t


543 
BOOL
 
	mAÎoÿ‹d
;

544 } 
	tFLAGS
;

548 
FLAGS
 
	mFÏgs
;

549 } 
	tBITMAPHANDLE
;

552 
DWORD
 
	mdwOSV”siÚInfoSize
;

553 
DWORD
 
	mdwMajÜV”siÚ
;

554 
DWORD
 
	mdwMšÜV”siÚ
;

555 
DWORD
 
	mdwBudNumb”
;

556 
DWORD
 
	mdwPÏtfÜmId
;

557 
TCHAR
 
	mszCSDV”siÚ
[128];

558 } 
	tOSVERSIONINFO
;

560 
	sgPALETTEENTRY
 {

561 
BYTE
 
	m³Red
;

562 
BYTE
 
	m³G»’
;

563 
BYTE
 
	m³Blue
;

564 
BYTE
 
	m³FÏgs
;

565 } 
	tPALETTEENTRY
, *
	tPPALETTEENTRY
;

568 
	sgLOGPALETTE
 {

569 
WORD
 
	m·lV”siÚ
;

570 
WORD
 
	m·lNumEÁr›s
;

571 
PALETTEENTRY
 
	m·lP®EÁry
[1];

572 } 
	tLOGPALETTE
, *
	tPLOGPALETTE
;

574 
	u_LARGE_INTEGER
 {

576 #ifdeà
__LITTLE_ENDIAN__


577 
DWORD
 
	mLowP¬t
;

578 
LONG
 
	mHighP¬t
;

580 
LONG
 
	mHighP¬t
;

581 
DWORD
 
	mLowP¬t
;

584 
LONGLONG
 
	mQuadP¬t
;

585 } 
	tLARGE_INTEGER
;

587 
	u_ULARGE_INTEGER
 {

589 #ifdeà
__LITTLE_ENDIAN__


590 
DWORD
 
	mLowP¬t
;

591 
DWORD
 
	mHighP¬t
;

593 
DWORD
 
	mHighP¬t
;

594 
DWORD
 
	mLowP¬t
;

597 
ULONGLONG
 
	mQuadP¬t
;

598 } 
	tULARGE_INTEGER
;

600 
	sRawFeH—d”


602 
UIÁ16
 
	mfH—d”Size
;

603 
UIÁ16
 
	mfImageFmt
;

604 
UIÁ16
 
	mfCompÚ’tsP”Pix–
;

605 
UIÁ16
 
	mfB™sP”CompÚ’t
;

606 
UIÁ32
 
	mfResDPI
;

607 
UIÁ32
 
	mfWidth
;

608 
UIÁ32
 
	mfHeight
;

610 } 
	tRawFeH—d”
;

612 #iâdeà
FALSE


613 
	#FALSE
 0

	)

615 #iâdeà
TRUE


616 
	#TRUE
 1

	)

619 
	#BI_RGB
 0L

	)

621 
	#G‘Focus
(è1

	)

623 #iâdeà
LOBYTE


624 
	#LOBYTE
(
b
è((
WORD
)b&0x00ff)

	)

626 #iâdeà
HIBYTE


627 
	#HIBYTE
(
b
è(((
WORD
)b>>8)&0x00ff)

	)

629 #iâdeà
HIWORD


630 
	#HIWORD
(
b
è(((
DWORD
)b>>16)&0x0000ffff)

	)

632 #iâdeà
LOWORD


633 
	#LOWORD
(
b
è((
DWORD
)b&0x0000ffff)

	)

636 
	#_tc¥brk
 
¡½brk


	)

637 
	#_tcsšc
(
_pc
è((_pc)+1)

	)

638 
	#_tc¤chr
 
¡¼chr


	)

639 
	#_tcschr
 
¡rchr


	)

640 
	#_tcs¡r
 
¡r¡r


	)

641 
	#_tc¢cmp
 
¡ºcmp


	)

642 
	#_tcscmp
 
¡rcmp


	)

643 
	#_tcsıy
 
¡rıy


	)

644 
	#_tcsicmp
 
¡rcmp


	)

645 
	#_tc¦’
 
¡¾’


	)

646 
	#_tc¢icmp
 
¡ºcmp


	)

647 
	#_tc¢ıy
 
¡ºıy


	)

648 
	#_tcsÿt
 
¡rÿt


	)

649 
	#l¡rÿt
 
¡rÿt


	)

650 
	#l¡¾’
 
¡¾’


	)

651 
	#l¡rıy
 
¡rıy


	)

652 
	#w¥rštf
 
¥rštf


	)

653 
	#wv¥rštf
 
v¥rštf


	)

654 
	#_v¡´štf_s
 
v¢´štf


	)

655 
	#_¡´štf_s
 
¥rštf_s


	)

656 
	#_rštf
 
´štf


	)

657 
	#_couÁof
 

	)

658 
	#¡ºicmp
 
¡ºcmp


	)

659 
	#_¡ºicmp
 
¡ºicmp


	)

660 
	#¡ºıy_s
 
¡ºıy


	)

661 
	#_t¡oi
 
©oi


	)

662 
	#_‰Ş
 
©Ş


	)

663 
	#_tfİ’
 
fİ’


	)

664 
	#_fg‘ts
 
fg‘s


	)

665 
	#_¡sÿnf
 
ssÿnf


	)

667 
	#CoTaskMemAÎoc
 
m®loc


	)

668 
	#CoTaskMemF»e
(
a
è
	`ä“
×)

	)

670 
	#INFINITE
 0xFFFFFFFF

	)

671 
	#SUCCESS
 0

	)

672 
	#FAILURE
 1

	)

673 #iâdeà 
__CFPlugInCOM_Inşuded__


675 
	#SUCCEEDED
(
Stus
è((
HRESULT
)(Stusè>ğ0)

	)

676 
	#FAILED
(
Stus
è((
HRESULT
)(Stusè< 0)

	)

677 
	#S_OK
 ((
HRESULT
)0x00000000L)

	)

678 
	#S_FALSE
 ((
HRESULT
)0x00000001L)

	)

679 
	#E_UNEXPECTED
 ((
HRESULT
)0x8000FFFFL)

	)

680 
	#E_NOTIMPL
 ((
HRESULT
)0x80004001L)

	)

681 
	#E_OUTOFMEMORY
 ((
HRESULT
)0x8007000EL)

	)

682 
	#E_INVALIDARG
 ((
HRESULT
)0x80070057L)

	)

683 
	#E_NOINTERFACE
 ((
HRESULT
)0x80004002L)

	)

684 
	#E_POINTER
 ((
HRESULT
)0x80004003L)

	)

685 
	#E_HANDLE
 ((
HRESULT
)0x80070006L)

	)

686 
	#E_ABORT
 ((
HRESULT
)0x80004004L)

	)

687 
	#E_FAIL
 ((
HRESULT
)0x80004005L)

	)

688 
	#E_ACCESSDENIED
 ((
HRESULT
)0x80070005L)

	)

691 
	#WINAPI


	)

692 
	#USES_CONVERSION


	)

693 
	#ATL_NO_VTABLE


	)

694 
	#DECLARE_REGISTRY_RESOURCEID
(
a
)

	)

695 
	#DECLARE_PROTECT_FINAL_CONSTRUCT
()

	)

696 
	#BEGIN_COM_MAP
(
a
)

	)

697 
	#COM_INTERFACE_ENTRY
(
a
)

	)

698 
	#END_COM_MAP
()

	)

701 
	#SP_NOTREPORTED
 0x4000

	)

702 
	#SP_ERROR
 (-1)

	)

703 
	#SP_APPABORT
 (-2)

	)

704 
	#SP_USERABORT
 (-3)

	)

705 
	#SP_OUTOFDISK
 (-4)

	)

706 
	#SP_OUTOFMEMORY
 (-5)

	)

708 
	#STI_OK
 
S_OK


	)

709 
	#STI_ERROR_NO_ERROR
 
STI_OK


	)

710 
	#STIERR_UNSUPPORTED
 
E_NOTIMPL


	)

712 
	#Z”oMemÜy
(
a
, 
b
è
	`mem£t
×, 0, b)

	)

713 
	#CİyMemÜy
(
a
, 
b
, 
c
è
	`memıy
×, b, c)

	)

715 #iâdeà
MIN


716 
	#MIN
(
a
, 
b
è(b <‡ ? b :‡)

	)

718 
	#FAR


	)

719 
	#CONST
 cÚ¡

	)

721 
	#KEY_QUERY_VALUE
 (0x0001)

	)

722 
	#KEY_SET_VALUE
 (0x0002)

	)

723 
	#KEY_CREATE_SUB_KEY
 (0x0004)

	)

724 
	#KEY_ENUMERATE_SUB_KEYS
 (0x0008)

	)

725 
	#KEY_NOTIFY
 (0x0010)

	)

726 
	#KEY_CREATE_LINK
 (0x0020)

	)

727 
	#KEY_WOW64_64KEY
 (0x0100)

	)

728 
	#KEY_WOW64_32KEY
 (0x0200)

	)

730 
	#HKEY_CLASSES_ROOT
 (Ğ
HKEY
 ) 0x80000000 )

	)

731 
	#HKEY_CURRENT_USER
 (Ğ
HKEY
 ) 0x80000001 )

	)

732 
	#HKEY_LOCAL_MACHINE
 (Ğ
HKEY
 ) 0x80000002 )

	)

733 
	#HKEY_USERS
 (Ğ
HKEY
 ) 0x80000003 )

	)

734 
	#HKEY_PERFORMANCE_DATA
 (Ğ
HKEY
 ) 0x80000004 )

	)

735 
	#REG_OPTION_NON_VOLATILE
 (0x00000000L)

	)

737 
	#STANDARD_RIGHTS_READ
 (
READ_CONTROL
)

	)

738 
	#STANDARD_RIGHTS_WRITE
 (
READ_CONTROL
)

	)

739 
	#STANDARD_RIGHTS_EXECUTE
 (
READ_CONTROL
)

	)

740 
	#STANDARD_RIGHTS_ALL
 (0x001F0000L)

	)

742 
	#ES_CONTINUOUS
 0x80000000

	)

743 
	#ES_DISPLAY_REQUIRED
 0x00000002

	)

744 
	#ES_SYSTEM_REQUIRED
 0x00000001

	)

746 
	#SPECIFIC_RIGHTS_ALL
 (0x0000FFFFL)

	)

748 
	#KEY_READ
 ((
STANDARD_RIGHTS_READ
 |\

749 
KEY_QUERY_VALUE
 |\

750 
KEY_ENUMERATE_SUB_KEYS
 |\

751 
KEY_NOTIFY
) \

753 (~
SYNCHRONIZE
))

	)

756 
	#KEY_WRITE
 ((
STANDARD_RIGHTS_WRITE
 |\

757 
KEY_SET_VALUE
 |\

758 
KEY_CREATE_SUB_KEY
) \

760 (~
SYNCHRONIZE
))

	)

762 
	#KEY_EXECUTE
 ((
KEY_READ
) \

764 (~
SYNCHRONIZE
))

	)

766 
	#KEY_ALL_ACCESS
 ((
STANDARD_RIGHTS_ALL
 |\

767 
KEY_QUERY_VALUE
 |\

768 
KEY_SET_VALUE
 |\

769 
KEY_CREATE_SUB_KEY
 |\

770 
KEY_ENUMERATE_SUB_KEYS
 |\

771 
KEY_NOTIFY
 |\

772 
KEY_CREATE_LINK
) \

774 (~
SYNCHRONIZE
))

	)

777 
	#NO_ERROR
 0

	)

778 
	#ERROR_SUCCESS
 0L

	)

779 
	#ERROR_INVALID_FUNCTION
 1L

	)

780 
	#ERROR_FILE_NOT_FOUND
 2L

	)

781 
	#ERROR_PATH_NOT_FOUND
 3L

	)

782 
	#ERROR_TOO_MANY_OPEN_FILES
 4L

	)

783 
	#ERROR_ACCESS_DENIED
 5L

	)

784 
	#ERROR_INVALID_HANDLE
 6L

	)

785 
	#ERROR_ARENA_TRASHED
 7L

	)

786 
	#ERROR_NOT_ENOUGH_MEMORY
 8L

	)

787 
	#ERROR_INVALID_BLOCK
 9L

	)

788 
	#ERROR_BAD_ENVIRONMENT
 10L

	)

789 
	#ERROR_BAD_FORMAT
 11L

	)

790 
	#ERROR_INVALID_ACCESS
 12L

	)

791 
	#ERROR_INVALID_DATA
 13L

	)

792 
	#ERROR_OUTOFMEMORY
 14L

	)

793 
	#ERROR_INVALID_DRIVE
 15L

	)

794 
	#ERROR_WRITE_PROTECT
 19L

	)

795 
	#ERROR_NOT_READY
 21L

	)

796 
	#ERROR_READ_FAULT
 30L

	)

797 
	#ERROR_GEN_FAILURE
 31L

	)

798 
	#ERROR_HANDLE_DISK_FULL
 39L

	)

799 
	#ERROR_CANNOT_MAKE
 82L

	)

800 
	#ERROR_OPEN_FAILED
 110L

	)

801 
	#ERROR_DISK_FULL
 112L

	)

803 
	#SEVERITY_SUCCESS
 0

	)

804 
	#SEVERITY_ERROR
 1

	)

807 
	#GMEM_FIXED
 0x0000

	)

808 
	#GMEM_MOVEABLE
 0x0002

	)

809 
	#GMEM_NOCOMPACT
 0x0010

	)

810 
	#GMEM_NODISCARD
 0x0020

	)

811 
	#GMEM_ZEROINIT
 0x0040

	)

812 
	#GMEM_MODIFY
 0x0080

	)

813 
	#GMEM_DISCARDABLE
 0x0100

	)

814 
	#GMEM_NOT_BANKED
 0x1000

	)

815 
	#GMEM_SHARE
 0x2000

	)

816 
	#GMEM_DDESHARE
 0x2000

	)

817 
	#GMEM_NOTIFY
 0x4000

	)

818 
	#GMEM_LOWER
 
GMEM_NOT_BANKED


	)

819 
	#GMEM_VALID_FLAGS
 0x7F72

	)

820 
	#GMEM_INVALID_HANDLE
 0x8000

	)

822 
	#GHND
 (
GMEM_MOVEABLE
 | 
GMEM_ZEROINIT
)

	)

823 
	#GPTR
 (
GMEM_FIXED
 | 
GMEM_ZEROINIT
)

	)

825 
	#SECTION_QUERY
 0x0001

	)

826 
	#SECTION_MAP_WRITE
 0x0002

	)

827 
	#SECTION_MAP_READ
 0x0004

	)

828 
	#SECTION_MAP_EXECUTE
 0x0008

	)

829 
	#SECTION_EXTEND_SIZE
 0x0010

	)

830 
	#STANDARD_RIGHTS_REQUIRED
 (0x000F0000L)

	)

832 
	#SECTION_ALL_ACCESS
 (
STANDARD_RIGHTS_REQUIRED
|
SECTION_QUERY
|\

833 
SECTION_MAP_WRITE
 | \

834 
SECTION_MAP_READ
 | \

835 
SECTION_MAP_EXECUTE
 | \

836 
SECTION_EXTEND_SIZE
)

	)

838 
	#FILE_MAP_COPY
 
SECTION_QUERY


	)

839 
	#FILE_MAP_WRITE
 
SECTION_MAP_WRITE


	)

840 
	#FILE_MAP_READ
 
SECTION_MAP_READ


	)

841 
	#FILE_MAP_ALL_ACCESS
 
SECTION_ALL_ACCESS


	)

843 
	#OF_READ
 0x00000000

	)

844 
	#OF_WRITE
 0x00000001

	)

845 
	#OF_READWRITE
 0x00000002

	)

846 
	#OF_SHARE_COMPAT
 0x00000000

	)

847 
	#OF_SHARE_EXCLUSIVE
 0x00000010

	)

848 
	#OF_SHARE_DENY_WRITE
 0x00000020

	)

849 
	#OF_SHARE_DENY_READ
 0x00000030

	)

850 
	#OF_SHARE_DENY_NONE
 0x00000040

	)

851 
	#OF_PARSE
 0x00000100

	)

852 
	#OF_DELETE
 0x00000200

	)

853 
	#OF_VERIFY
 0x00000400

	)

854 
	#OF_CANCEL
 0x00000800

	)

855 
	#OF_CREATE
 0x00001000

	)

856 
	#OF_PROMPT
 0x00002000

	)

857 
	#OF_EXIST
 0x00004000

	)

858 
	#OF_REOPEN
 0x00008000

	)

860 
	sTONEMAP_PARAMETERS


862 
WORD
 
	mwGamma
;

863 
BYTE
 
	mbyBrighŠess
;

864 
BYTE
 
	mbyCÚŒa¡
;

865 
WORD
 
	mwHighlight
;

866 
WORD
 
	mwShadow
;

869 
	sSCANNER_PARAMETERS
 {

870 
DWORD
 
	mdwLeá
;

871 
DWORD
 
	mdwTİ
;

872 
DWORD
 
	mdwWidth
;

873 
DWORD
 
	mdwL’gth
;

874 
DWORD
 
	mdwSÿnMode
;

875 
DWORD
 
	mdwSÿnO±iÚs
;

876 
BYTE
 
	mbyB™sP”ChªÃl
;

877 
BYTE
 
	mbyEdgeE¿£Tİ
;

878 
WORD
 
	mwXResŞutiÚ
;

879 
WORD
 
	mwYResŞutiÚ
;

880 
WORD
 
	mwG»yChªÃl
;

881 
WORD
 
	mwSÿnM‘hod
;

883 
DWORD
 
	mdwBWTh»shŞd
;

884 
WORD
 
	mwF“dEdge
;

885 
TONEMAP_PARAMETERS
 
	mtÚem­
;

886 
	mcSh¬pSmoÙhLev–
;

887 
BYTE
 
	mbyNoi£Remov®Lev–
;

888 
BYTE
 
	mbyCÚ‹ÁTy³
;

889 
BYTE
 
	mbyBÏnkPageS’s™iv™y
;

890 
BYTE
 
	mbyEdgeE¿£BÙtom
;

891 
BYTE
 
	mbyFlCŞÜ
;

892 
DWORD
 
	mdwPageWidth
;

893 
DWORD
 
	mdwPageHeight
;

894 
BYTE
 
	mbyAutoCrİTy³
;

895 
BYTE
 
	mbyACDm­pšg
;

896 
BYTE
 
	mbyACD£ns™iv™y
;

897 
BYTE
 
	mbyEdgeE¿£Leá
;

898 
BYTE
 
	mbyEdgeE¿£Right
;

899 
BYTE
 
	mbyAutoOr›ÁQu®™yMode
;

900 
BYTE
 
	mbyACD£ns™iv™yBW
;

901 
BYTE
 
	mbyAutoOr›ÁLªguage
;

902 
BYTE
 
	mbyAutoXşusiÚTİ
;

903 
BYTE
 
	mbyAutoXşusiÚLeá
;

904 
BYTE
 
	mbyAutoXşusiÚRight
;

905 
BYTE
 
	mbyAutoXşusiÚBÙtom
;

906 
BYTE
 
	mbyStÜeJobReque¡
;

907 
BYTE
 
	mbymuÉick
;

908 
BYTE
 
	mbyStÜedJobName
[64];

909 
BYTE
 
	mbyStÜedJobPIN
[10];

910 
WORD
 
	mwRe£rved
[ 5 ];

914 
	sBUFFER_INFO
 {

915 
DWORD
 
	mdwPix–Width
;

916 
DWORD
 
	mdwPix–Height
;

917 
DWORD
 
	mdwBy‹sP”Lše
;

919 
DWORD
 
	mdwRe£rved
[10];

922 
	s_SCAN_SOURCE


924 
WORD
 
	msÿnM‘hod
;

925 
DWORD
 
	madfO±iÚs
;

926 
WORD
 
	madfIÅutT¿y
;

927 
WORD
 
	mx·Tem¶©e
;

928 } 
	tSCAN_SOURCE
;

	@scan/sane/bb_ledm.c

9 #iâdeà
_GNU_SOURCE


10 
	#_GNU_SOURCE


	)

13 
	~<¡d¬g.h
>

14 
	~<sy¦og.h
>

15 
	~<¡dio.h
>

16 
	~<¡ršg.h
>

17 
	~<fú.h
>

18 
	~<m©h.h
>

19 
	~"§Ã.h
"

20 
	~"§Ãİts.h
"

21 
	~"hpmud.h
"

22 
	~"hp.h
"

23 
	~"commÚ.h
"

24 
	~"Ëdm.h
"

25 
	~"Ëdmi.h
"

26 
	~"h‰p.h
"

27 
	~"xml.h
"

28 
	~<¡dlib.h
>

30 
	~<¡dšt.h
>

32 
	#_STRINGIZE
(
x
è#x

	)

33 
	#STRINGIZE
(
x
è
	`_STRINGIZE
(x)

	)

35 
	#_BUG
(
¬gs
...è
	`sy¦og
(
LOG_ERR
, 
__FILE__
 " " 
	`STRINGIZE
(
__LINE__
è": "‡rgs)

	)

39 #ifdeà
BB_LEDM_DEBUG


40 
	#_DBG
(
¬gs
...è
	`sy¦og
(
LOG_INFO
, 
__FILE__
 " " 
	`STRINGIZE
(
__LINE__
è": "‡rgs)

	)

42 
	#_DBG
(
¬gs
...)

	)

45 
	eDOCUMENT_TYPE


47 
	mDT_AUTO
 = 1,

48 
	mDT_MAX
,

51 
	eSCANNER_STATE


53 
	mSS_IDLE
 = 1,

54 
	mSS_PROCESSING
,

55 
	mSS_STOPPED
,

58 
	eSCANNER_STATE_REASON


60 
	mSSR_ATTENTION_REQUIRED
 = 1,

61 
	mSSR_CALIBRATING
,

62 
	mSSR_COVER_OPEN
,

63 
	mSSR_INPUT_TRAY_EMPTY
,

64 
	mSSR_INTERNAL_STORAGE_FULL
,

65 
	mSSR_LAMP_ERROR
,

66 
	mSSR_LAMP_WARMING
,

67 
	mSSR_MEDIA_JAM
,

68 
	mSSR_BUSY
,

69 
	mSSR_NONE
,

72 
	smedŸ_size


74 
	mwidth
;

75 
	mheight
;

78 
	sdeviû_£‰šgs


80 
COLOR_ENTRY
 
	mcŞÜ
[
CE_MAX
];

81 
SCAN_FORMAT
 
	mfÜm©s
[
SF_MAX
];

82 
	mj³g_qu®™y_çùÜ_suµÜ‹d
;

83 
DOCUMENT_TYPE
 
	mdocs
[
DT_MAX
];

84 
	mdocum’t_size_auto_d‘eù_suµÜ‹d
;

85 
	mãed”_ÿ·c™y
;

88 
	sdeviû_¶©’


90 
	mæ©bed_suµÜ‹d
;

91 
medŸ_size
 
	mmšimum_size
;

92 
medŸ_size
 
	mmaximum_size
;

93 
medŸ_size
 
	mİtiÿl_»sŞutiÚ
;

94 
	m¶©’_»sŞutiÚ_li¡
[
MAX_LIST_SIZE
];

97 
	sdeviû_adf


99 
	msuµÜ‹d
;

100 
	mdu¶ex_suµÜ‹d
;

101 
medŸ_size
 
	mmšimum_size
;

102 
medŸ_size
 
	mmaximum_size
;

103 
medŸ_size
 
	mİtiÿl_»sŞutiÚ
;

104 
	madf_»sŞutiÚ_li¡
[
MAX_LIST_SIZE
];

107 
	ssÿÂ”_cÚfigu¿tiÚ


109 
deviû_£‰šgs
 
	m£‰šgs
;

110 
deviû_¶©’
 
	m¶©’
;

111 
deviû_adf
 
	madf
;

114 
	ssÿÂ”_¡©us


116 *
	mcu¼’t_time
;

117 
SCANNER_STATE
 
	m¡©e
;

118 
SCANNER_STATE_REASON
 
	m»asÚ
;

119 
	m·³r_š_adf
;

120 
	msÿn_to_avaabË
;

123 
	swsú_sÿn_–em’ts


125 
sÿÂ”_cÚfigu¿tiÚ
 
	mcÚfig
;

126 
sÿÂ”_¡©us
 
	m¡©us
;

127 
	mmod–_numb”
[32];

130 
	swsú_ü—‹_sÿn_job_»¥Ú£


132 
	mjobid
;

133 
	mpix–s_³r_lše
;

134 
	mlšes
;

135 
	mby‹s_³r_lše
;

136 
SCAN_FORMAT
 
	mfÜm©
;

137 
	mj³g_qu®™y_çùÜ
;

138 
	mimages_to_Œªsãr
;

139 
INPUT_SOURCE
 
	msourû
;

140 
DOCUMENT_TYPE
 
	mdoc
;

141 
medŸ_size
 
	mšput_size
;

142 
	msÿn_»giÚ_xoff£t
;

143 
	msÿn_»giÚ_yoff£t
;

144 
	msÿn_»giÚ_width
;

145 
	msÿn_»giÚ_height
;

146 
COLOR_ENTRY
 
	mcŞÜ
;

147 
medŸ_size
 
	m»sŞutiÚ
;

150 
	sbb_Ëdm_£ssiÚ


152 
wsú_ü—‹_sÿn_job_»¥Ú£
 
	mjob
;

153 
wsú_sÿn_–em’ts
 
	m–em’ts
;

154 
HTTP_HANDLE
 
	mh‰p_hªdË
;

158 cÚ¡ *
	gsf_–em’t
[
SF_MAX
] = { "", "raw", "jpeg" };

159 cÚ¡ *
	gû_–em’t
[
CE_MAX
] = { "", "K1", "Gray8", "Color8" };

160 cÚ¡ *
	gis_–em’t
[
IS_MAX
] = { "", "Platen", "Adf", "ADFDuplex" };

162 
	#POST_HEADER
 "POST /Sÿn/Job HTTP/1.1\r\nHo¡:†oÿlho¡\r\nU£r-Ag’t: \
\r\nAcû±:ext/¶aš, */*\r\nAcû±-Lªguage:ƒn-us,’\r\n\
-Ch¬£t: ISO-8859-1,utf-8\r\nK“p-Alive: 1000\r\nProxy-CÚÃùiÚ: k“p-®ive\r\n\
-Ty³: */*; ch¬£t=UTF-8\r\nX-Reque¡ed-W™h: XMLH‰pReque¡\r\n\
-L’gth: %d\r\nCook›: AcûssCouÁ”òew\r\n\
:‚o-ÿche\r\nCache-CÚŒŞ:‚o-ÿche\r\n\r\n"

	)

169 
	#GET_SCANNER_ELEMENTS
 "GET /Sÿn/SÿnC­ HTTP/1.1\r\n\
:†oÿlho¡\r\nU£r-Ag’t: h¶\r\n\
:ext/xml\r\n\
-Lªguage:ƒn-us,’\r\n\
-Ch¬£t:utf-8\r\n\
-Alive: 20\r\nProxy-CÚÃùiÚ: k“p-®ive\r\nCook›: AcûssCouÁ”òew\r\n0\r\n\r\n"

	)

176 
	#GET_SCANNER_STATUS
 "GET /Sÿn/Stu HTTP/1.1\r\n\
:†oÿlho¡\r\nU£r-Ag’t: h¶\r\n\
:ext/xml\r\n\
-Lªguage:ƒn-us,’\r\n\
-Ch¬£t:utf-8\r\n\
-Alive: 20\r\nProxy-CÚÃùiÚ: k“p-®ive\r\nCook›: AcûssCouÁ”òew\r\n0\r\n\r\n"

	)

183 
	#CREATE_SCAN_JOB_REQUEST
 "<?xmÈv”siÚ=\"1.0\"ƒncodšg=\"UTF-8\"?>\
<SÿnS‘tšg xmÊs=\"h‰p://www.hp.com/schemas/imagšg/cÚ/úx/sÿn/2008/08/19\">\
<XResŞutiÚ>%d</XResŞutiÚ>\
<YResŞutiÚ>%d</YResŞutiÚ>\
<XS¹>%d</XS¹>\
<Width>%d</Width>\
<YS¹>%d</YS¹>\
<Height>%d</Height>\
<FÜm©>%s</FÜm©>\
<Com´essiÚQFaùÜ>15</Com´essiÚQFaùÜ>\
<CŞÜS·û>%s</CŞÜS·û>\
<B™D•th>%d</B™D•th>\
<IÅutSourû>%s</IÅutSourû>\
<IÅutSourûTy³>%s</IÅutSourûTy³>%s\
<G¿yR’d”šg>NTSC</G¿yR’d”šg>\
<TÚeM­>\
<Gamma>0</Gamma>\
<BrighŠess>%d</BrighŠess>\
<CÚŒa¡>%d</CÚŒa¡>\
<Highl™e>0</Highl™e>\
<Shadow>0</Shadow></TÚeM­>\
<CÚ‹ÁTy³>PhÙo</CÚ‹ÁTy³></SÿnS‘tšgs>"

	)

206 
	#CANCEL_JOB_REQUEST
 "PUT % HTTP/1.1\r\nHo¡:†oÿlho¡\r\nU£r-Ag’t: h¶\r\n\
:ext/¶aš\r\nAcû±-Lªguage:ƒn-us,’\r\nAcû±-Ch¬£t:utf-8\r\nK“p-Alive: 10\r\n\
-Ty³:ext/xml\r\nProxy-CÚÃùiÚ: K“p-®ive\r\nX-Reque¡ed-W™h: XMLH‰pReque¡\r\nReã»r:†oÿlho¡\r\n\
-L’gth: %d\r\nCook›: AcûssCouÁ”òew\r\n\r\n"

	)

211 
	#CANCEL_JOB_DATA
 "<?xmÈv”siÚ=\"1.0\"ƒncodšg=\"UTF-8\"?>\n\
<j:Job xmÊs:j=\"h‰p://www.hp.com/schemas/imagšg/cÚ/Ëdm/jobs/2009/04/30\" \
:dd=\"h‰p://www.hp.com/schemas/imagšg/cÚ/diùiÚ¬›s/1.0/\" \
:çx=\"h‰p://www.hp.com/schemas/imagšg/cÚ/çx/2008/06/13\" \
:xsi=\"h‰p://www.w3.Üg/2001/XMLSchema-š¡ªû\" \
:schemaLoÿtiÚ=\"h‰p://www.hp.com/schemas/imagšg/cÚ/Ëdm/jobs/2009/04/30 ../schemas/Jobs.xsd\">\
<j:JobS‹>CªûËd</j:JobS‹></j:Job>"

	)

219 
	#GET_SCAN_JOB_URL
 "GET % HTTP/1.1\r\nHo¡:†oÿlho¡\r\nU£r-Ag’t: h¶\r\n\
:ext/¶aš\r\nAcû±-Lªguage:ƒn-us,’\r\nAcû±-Ch¬£t:utf-8\r\nX-Reque¡ed-W™h: XMLH‰pReque¡\r\n\
-Alive: 300\r\nProxy-CÚÃùiÚ: k“p-®ive\r\nCook›: AcûssCouÁ”òew\r\n0\r\n\r\n"

	)

223 
	#ZERO_FOOTER
 "\r\n0\r\n\r\n"

	)

225 
	#READY_TO_UPLOAD
 "<PageS‹>R—dyToU¶ßd</PageS‹>"

	)

226 
	#CANCELED_BY_DEVICE
 "<PageS‹>CªûËdByDeviû</PageS‹>"

	)

227 
	#CANCELED_BY_CLIENT
 "<PageS‹>CªûËdByCl›Á</PageS‹>"

	)

228 
	#ADF_LOADED
 "<AdfS‹>Lßded</AdfS‹>"

	)

229 
	#ADF_EMPTY
 "<AdfS‹>Em±y</AdfS‹>"

	)

230 
	#SCANNER_IDLE
 "<SÿÂ”S‹>IdË</SÿÂ”S‹>"

	)

231 
	#SCANNER_BUSY_WITH_SCAN_JOB
 "<SÿÂ”S‹>BusyW™hSÿnJob</SÿÂ”S‹>"

	)

232 
	#JOBSTATE_PROCESSING
 "<j:JobS‹>Proûssšg</j:JobS‹>"

	)

233 
	#JOBSTATE_CANCELED
 "<j:JobS‹>CªûËd</j:JobS‹>"

	)

234 
	#JOBSTATE_COMPLETED
 "<j:JobS‹>Com¶‘ed</j:JobS‹>"

	)

235 
	#PRESCANPAGE
 "<P»SÿnPage>"

	)

237 
	$·r£_sÿn_–em’ts
(cÚ¡ *
·ylßd
, 
size
, 
wsú_sÿn_–em’ts
 *
–em’ts
)

239 
g
[512];

240 
v®ue
[128];

241 
i
;

242 *

=(*)
·ylßd
;

244 
	`mem£t
(
–em’ts
, 0, (
wsú_sÿn_–em’ts
));

248 
	`g‘_g
(

, 
size
-Ña-
·ylßd
), 
g
, (tag), &tail);

250 ià(!
g
[0])

253 if(
	`¡ºcmp
(
g
, "ColorEntries", 12) == 0)

255 
h
=1;

256 
h
)

258 
	`g‘_g
(

, 
size
-Ña-
·ylßd
), 
g
, (tag), &tail);

259 if(
	`¡ºcmp
(
g
, "Platen", 6) ==0) ;

260 if(
	`¡ºcmp
(
g
, "/ColorEntries", 13) ==0) ;

261 if(
	`¡ºcmp
(
g
, "ColorType", 9)==0)

263 
	`g‘_–em’t
(

, 
size
-Ña-
·ylßd
), 
v®ue
, (value), &tail);

264 ià(
	`¡rcmp
(
v®ue
, 
û_–em’t
[
CE_K1
]) == 0)

265 
–em’ts
->
cÚfig
.
£‰šgs
.
cŞÜ
[
CE_K1
] = CE_K1;

266 ià(
	`¡rcmp
(
v®ue
, 
û_–em’t
[
CE_GRAY8
]) == 0)

267 
–em’ts
->
cÚfig
.
£‰šgs
.
cŞÜ
[
CE_GRAY8
] = CE_GRAY8;

268 ià(
	`¡rcmp
(
v®ue
, 
û_–em’t
[
CE_COLOR8
]) == 0)

269 
–em’ts
->
cÚfig
.
£‰šgs
.
cŞÜ
[
CE_COLOR8
] = CE_COLOR8;

272 
	`_DBG
("FÜm©SuµÜ‹d:%s\n", 
v®ue
);

273 
	`g‘_g
(

, 
size
-Ña-
·ylßd
), 
g
, (tag), &tail);

274 if(
	`¡ºcmp
(
g
, "/CŞÜEÁr›s", 13è=ğ0è
h
=0;

276 if(
	`¡ºcmp
(
g
, "/CŞÜEÁr›s", 13è=ğ0è
h
=0;

280 if(
	`¡ºcmp
(
g
, "Platen", 6) == 0)

282 
–em’ts
->
cÚfig
.
¶©’
.
æ©bed_suµÜ‹d
 = 1;

283 
	`g‘_g
(

, 
size
-Ña-
·ylßd
), 
g
, (tag), &tail);

284 
	`g‘_g
(

, 
size
-Ña-
·ylßd
), 
g
, (tag), &tail);

285 
	`g‘_–em’t
(

, 
size
-Ña-
·ylßd
), 
v®ue
, (value), &tail);

286 
–em’ts
->
cÚfig
.
¶©’
.
mšimum_size
.
width
=
	`¡¹Ş
(
v®ue
, 
NULL
, 10);

287 
	`g‘_g
(

, 
size
-Ña-
·ylßd
), 
g
, (tag), &tail);

288 
	`g‘_g
(

, 
size
-Ña-
·ylßd
), 
g
, (tag), &tail);

289 
	`g‘_–em’t
(

, 
size
-Ña-
·ylßd
), 
v®ue
, (value), &tail);

290 
–em’ts
->
cÚfig
.
¶©’
.
mšimum_size
.
height
=
	`¡¹Ş
(
v®ue
, 
NULL
, 10);

291 
	`g‘_g
(

, 
size
-Ña-
·ylßd
), 
g
, (tag), &tail);

292 
	`g‘_g
(

, 
size
-Ña-
·ylßd
), 
g
, (tag), &tail);

293 
	`g‘_–em’t
(

, 
size
-Ña-
·ylßd
), 
v®ue
, (value), &tail);

294 
–em’ts
->
cÚfig
.
¶©’
.
maximum_size
.
width
=
	`¡¹Ş
(
v®ue
, 
NULL
, 10);

295 
	`g‘_g
(

, 
size
-Ña-
·ylßd
), 
g
, (tag), &tail);

296 
	`g‘_g
(

, 
size
-Ña-
·ylßd
), 
g
, (tag), &tail);

297 
	`g‘_–em’t
(

, 
size
-Ña-
·ylßd
), 
v®ue
, (value), &tail);

298 
–em’ts
->
cÚfig
.
¶©’
.
maximum_size
.
height
=
	`¡¹Ş
(
v®ue
, 
NULL
, 10);

299 
	`g‘_g
(

, 
size
-Ña-
·ylßd
), 
g
, (tag), &tail);

300 
	`g‘_g
(

, 
size
-Ña-
·ylßd
), 
g
, (tag), &tail);

301 
	`g‘_–em’t
(

, 
size
-Ña-
·ylßd
), 
v®ue
, (value), &tail);

302 
	`g‘_g
(

, 
size
-Ña-
·ylßd
), 
g
, (tag), &tail);

303 
	`g‘_g
(

, 
size
-Ña-
·ylßd
), 
g
, (tag), &tail);

304 
	`g‘_–em’t
(

, 
size
-Ña-
·ylßd
), 
v®ue
, (value), &tail);

305 
	`g‘_g
(

, 
size
-Ña-
·ylßd
), 
g
, (tag), &tail);

306 
	`g‘_g
(

, 
size
-Ña-
·ylßd
), 
g
, (tag), &tail);

307 
	`g‘_–em’t
(

, 
size
-Ña-
·ylßd
), 
v®ue
, (value), &tail);

308 
	`g‘_g
(

, 
size
-Ña-
·ylßd
), 
g
, (tag), &tail);

309 
	`g‘_g
(

, 
size
-Ña-
·ylßd
), 
g
, (tag), &tail);

310 
	`g‘_–em’t
(

, 
size
-Ña-
·ylßd
), 
v®ue
, (value), &tail);

311 
	`g‘_g
(

, 
size
-Ña-
·ylßd
), 
g
, (tag), &tail);

312 
	`g‘_g
(

, 
size
-Ña-
·ylßd
), 
g
, (tag), &tail);

313 
	`g‘_–em’t
(

, 
size
-Ña-
·ylßd
), 
v®ue
, (value), &tail);

314 
–em’ts
->
cÚfig
.
¶©’
.
İtiÿl_»sŞutiÚ
.
width
=
	`¡¹Ş
(
v®ue
, 
NULL
, 10);

315 
	`g‘_g
(

, 
size
-Ña-
·ylßd
), 
g
, (tag), &tail);

316 
	`g‘_g
(

, 
size
-Ña-
·ylßd
), 
g
, (tag), &tail);

317 
	`g‘_–em’t
(

, 
size
-Ña-
·ylßd
), 
v®ue
, (value), &tail);

318 
–em’ts
->
cÚfig
.
¶©’
.
İtiÿl_»sŞutiÚ
.
height
=
	`¡¹Ş
(
v®ue
, 
NULL
, 10);

319 
	`g‘_g
(

, 
size
-Ña-
·ylßd
), 
g
, (tag), &tail);

320 
	`g‘_g
(

, 
size
-Ña-
·ylßd
), 
g
, (tag), &tail);

321 
	`g‘_–em’t
(

, 
size
-Ña-
·ylßd
), 
v®ue
, (value), &tail);

323 
	`g‘_g
(

, 
size
-Ña-
·ylßd
), 
g
, (tag), &tail);

324 
	`g‘_g
(

, 
size
-Ña-
·ylßd
), 
g
, (tag), &tail);

325 
i
=1;

326 
–em’ts
->
cÚfig
.
¶©’
.
¶©’_»sŞutiÚ_li¡
[0]=0;

327 
	`¡rcmp
(
g
, "/SupportedResolutions"))

329 
	`g‘_g
(

, 
size
-Ña-
·ylßd
), 
g
, (tag), &tail);

330 if(!
	`¡rcmp
(
g
, "Resolution"))

332 
	`g‘_g
(

, 
size
-Ña-
·ylßd
), 
g
, (tag), &tail);

333 
	`g‘_–em’t
(

, 
size
-Ña-
·ylßd
), 
v®ue
, (value), &tail);

334 
	`_DBG
 ("·r£_sÿn_–em’t ¶©’_»sŞutiÚ_li¡ v®ue=%s\n", 
v®ue
);

335 if(
	`¡¹Ş
(
v®ue
, 
NULL
, 10è&& 
–em’ts
->
cÚfig
.
¶©’
.
¶©’_»sŞutiÚ_li¡
[
i
-1] != strtol(value, NULL, 10))

337 
–em’ts
->
cÚfig
.
¶©’
.
¶©’_»sŞutiÚ_li¡
[
i
++]=
	`¡¹Ş
(
v®ue
, 
NULL
, 10);

340 
–em’ts
->
cÚfig
.
¶©’
.
¶©’_»sŞutiÚ_li¡
[0]=
i
-1;

343 if(
	`¡ºcmp
(
g
, "Adf", 3è=ğ0 && 
	`¡¾’
(tag) == 3)

345 
–em’ts
->
cÚfig
.
adf
.
suµÜ‹d
 = 1;

346 
	`g‘_g
(

, 
size
-Ña-
·ylßd
), 
g
, (tag), &tail);

347 
	`g‘_g
(

, 
size
-Ña-
·ylßd
), 
g
, (tag), &tail);

348 
	`g‘_–em’t
(

, 
size
-Ña-
·ylßd
), 
v®ue
, (value), &tail);

349 
–em’ts
->
cÚfig
.
adf
.
mšimum_size
.
width
=
	`¡¹Ş
(
v®ue
, 
NULL
, 10);

350 
	`g‘_g
(

, 
size
-Ña-
·ylßd
), 
g
, (tag), &tail);

351 
	`g‘_g
(

, 
size
-Ña-
·ylßd
), 
g
, (tag), &tail);

352 
	`g‘_–em’t
(

, 
size
-Ña-
·ylßd
), 
v®ue
, (value), &tail);

353 
–em’ts
->
cÚfig
.
adf
.
mšimum_size
.
height
=
	`¡¹Ş
(
v®ue
, 
NULL
, 10);

354 
	`g‘_g
(

, 
size
-Ña-
·ylßd
), 
g
, (tag), &tail);

355 
	`g‘_g
(

, 
size
-Ña-
·ylßd
), 
g
, (tag), &tail);

356 
	`g‘_–em’t
(

, 
size
-Ña-
·ylßd
), 
v®ue
, (value), &tail);

357 
–em’ts
->
cÚfig
.
adf
.
maximum_size
.
width
=
	`¡¹Ş
(
v®ue
, 
NULL
, 10);

358 
	`g‘_g
(

, 
size
-Ña-
·ylßd
), 
g
, (tag), &tail);

359 
	`g‘_g
(

, 
size
-Ña-
·ylßd
), 
g
, (tag), &tail);

360 
	`g‘_–em’t
(

, 
size
-Ña-
·ylßd
), 
v®ue
, (value), &tail);

361 
–em’ts
->
cÚfig
.
adf
.
maximum_size
.
height
=
	`¡¹Ş
(
v®ue
, 
NULL
, 10);

362 
	`g‘_g
(

, 
size
-Ña-
·ylßd
), 
g
, (tag), &tail);

363 
	`g‘_g
(

, 
size
-Ña-
·ylßd
), 
g
, (tag), &tail);

364 
	`g‘_–em’t
(

, 
size
-Ña-
·ylßd
), 
v®ue
, (value), &tail);

365 
	`g‘_g
(

, 
size
-Ña-
·ylßd
), 
g
, (tag), &tail);

366 
	`g‘_g
(

, 
size
-Ña-
·ylßd
), 
g
, (tag), &tail);

367 
	`g‘_–em’t
(

, 
size
-Ña-
·ylßd
), 
v®ue
, (value), &tail);

368 
	`g‘_g
(

, 
size
-Ña-
·ylßd
), 
g
, (tag), &tail);

369 
	`g‘_g
(

, 
size
-Ña-
·ylßd
), 
g
, (tag), &tail);

370 
	`g‘_–em’t
(

, 
size
-Ña-
·ylßd
), 
v®ue
, (value), &tail);

371 
	`g‘_g
(

, 
size
-Ña-
·ylßd
), 
g
, (tag), &tail);

372 
	`g‘_g
(

, 
size
-Ña-
·ylßd
), 
g
, (tag), &tail);

373 
	`g‘_–em’t
(

, 
size
-Ña-
·ylßd
), 
v®ue
, (value), &tail);

374 
	`g‘_g
(

, 
size
-Ña-
·ylßd
), 
g
, (tag), &tail);

375 
	`g‘_g
(

, 
size
-Ña-
·ylßd
), 
g
, (tag), &tail);

376 
	`g‘_–em’t
(

, 
size
-Ña-
·ylßd
), 
v®ue
, (value), &tail);

377 
–em’ts
->
cÚfig
.
adf
.
İtiÿl_»sŞutiÚ
.
width
=
	`¡¹Ş
(
v®ue
, 
NULL
, 10);

378 
	`g‘_g
(

, 
size
-Ña-
·ylßd
), 
g
, (tag), &tail);

379 
	`g‘_g
(

, 
size
-Ña-
·ylßd
), 
g
, (tag), &tail);

380 
	`g‘_–em’t
(

, 
size
-Ña-
·ylßd
), 
v®ue
, (value), &tail);

381 
–em’ts
->
cÚfig
.
adf
.
İtiÿl_»sŞutiÚ
.
height
=
	`¡¹Ş
(
v®ue
, 
NULL
, 10);

382 
	`g‘_g
(

, 
size
-Ña-
·ylßd
), 
g
, (tag), &tail);

383 
	`g‘_g
(

, 
size
-Ña-
·ylßd
), 
g
, (tag), &tail);

384 
	`g‘_–em’t
(

, 
size
-Ña-
·ylßd
), 
v®ue
, (value), &tail);

386 
	`g‘_g
(

, 
size
-Ña-
·ylßd
), 
g
, (tag), &tail);

387 
	`g‘_g
(

, 
size
-Ña-
·ylßd
), 
g
, (tag), &tail);

388 
i
=1;

389 
–em’ts
->
cÚfig
.
adf
.
adf_»sŞutiÚ_li¡
[0]=0;

390 
	`¡rcmp
(
g
, "/SupportedResolutions"))

392 
	`g‘_g
(

, 
size
-Ña-
·ylßd
), 
g
, (tag), &tail);

393 if(!
	`¡rcmp
(
g
, "Resolution"))

395 
	`g‘_g
(

, 
size
-Ña-
·ylßd
), 
g
, (tag), &tail);

396 
	`g‘_–em’t
(

, 
size
-Ña-
·ylßd
), 
v®ue
, (value), &tail);

397 
	`_DBG
 ("·r£_sÿn_–em’t adf_»sŞutiÚ_li¡ v®ue=%s", 
v®ue
);

398 if(
	`¡¹Ş
(
v®ue
, 
NULL
, 10è&& 
–em’ts
->
cÚfig
.
adf
.
adf_»sŞutiÚ_li¡
[
i
-1] != strtol(value, NULL, 10))

399 
–em’ts
->
cÚfig
.
adf
.
adf_»sŞutiÚ_li¡
[
i
++]=
	`¡¹Ş
(
v®ue
, 
NULL
, 10);

402 
–em’ts
->
cÚfig
.
adf
.
adf_»sŞutiÚ_li¡
[0]=
i
-1;

403 
	`g‘_g
(

, 
size
-Ña-
·ylßd
), 
g
, (tag), &tail);

404 
	`g‘_g
(

, 
size
-Ña-
·ylßd
), 
g
, (tag), &tail);

405 
	`g‘_–em’t
(

, 
size
-Ña-
·ylßd
), 
v®ue
, (value), &tail);

406 
	`_DBG
 ("·r£_sÿn_–em’t F“d”C­ac™y=%s", 
v®ue
);

407 
–em’ts
->
cÚfig
.
£‰šgs
.
ãed”_ÿ·c™y
 = 
	`¡¹Ş
(
v®ue
, 
NULL
, 10);

408 
	`g‘_g
(

, 
size
-Ña-
·ylßd
), 
g
, (tag), &tail);

409 
	`g‘_g
(

, 
size
-Ña-
·ylßd
), 
g
, (tag), &tail);

410 if(!
	`¡rcmp
(
g
, "AdfDuplexer"))

412 
–em’ts
->
cÚfig
.
adf
.
du¶ex_suµÜ‹d
 = 1;

413 
	`_DBG
 ("parse_scan_elements duplex_supported");

418 
	}
}

420 
bb_Ëdm_£ssiÚ
* 
	$ü—‹_£ssiÚ
()

422 
bb_Ëdm_£ssiÚ
* 
pbb
;

424 ià((
pbb
 = 
	`m®loc
((
bb_Ëdm_£ssiÚ
))è=ğ
NULL
)

426  
NULL
;

429 
	`mem£t
(
pbb
, 0, (
bb_Ëdm_£ssiÚ
));

430  
pbb
;

431 
	}
}

433 
	$»ad_h‰p_·ylßd
(
Ëdm_£ssiÚ
 *
ps
, *
·ylßd
, 
max_size
, 
£c_timeout
, *
by‹s_»ad
)

435 
bb_Ëdm_£ssiÚ
 *
pbb
 = 
ps
->
bb_£ssiÚ
;

436 
¡©
=1, 
tÙ®
=0, 
Ën
;

437 
tmo
=
£c_timeout
;

438 
HTTP_RESULT
 
»t
;

439 
·ylßd_Ëngth
=-1;

440 *
‹mp
=
NULL
;

442 *
by‹s_»ad
 = 0;

444 if(
	`h‰p_»ad_h—d”
(
pbb
->
h‰p_hªdË
, 
·ylßd
, 
max_size
, 
tmo
, &
Ën
è!ğ
HTTP_R_OK
)

445 
bugout
;

447 
	`_DBG
("»ad_h‰p_·ylßd†’=%d %s\n",
Ën
,
·ylßd
);

448 
‹mp
 = 
	`¡r¡r
(
·ylßd
, "HTTP/1.1 201 Created");

449 ià(
‹mp
)

451 *
by‹s_»ad
 = 
tÙ®
 = 
Ën
;

452 
¡©
=0;

453  
¡©
 ;

456 
‹mp
=
	`¡r¡r
(
·ylßd
, "Content-Length:");

457 ià(
‹mp
)

459 
‹mp
=temp+16;

460 
‹mp
=
	`¡¹ok
(temp, "\r\n");

461 
·ylßd_Ëngth
=
	`¡¹Ş
(
‹mp
, 
NULL
, 10);

462 ià(
·ylßd_Ëngth
 == 0)

464 *
by‹s_»ad
 = 
tÙ®
 = 
Ën
;

465 
¡©
=0;

466  
¡©
 ;

469 
	`mem£t
(
·ylßd
, ' ', 
Ën
);

470 if(
·ylßd_Ëngth
==-1)

472 
i
=10;

473 
i
)

475 
Ën
 = 0;

476 
»t
 = 
	`h‰p_»ad
(
pbb
->
h‰p_hªdË
, 
·ylßd
+
tÙ®
, 
max_size
-tÙ®, 
tmo
, &
Ën
);

477 
tÙ®
+=
Ën
;

478 
tmo
=1;

479 
i
--;

480 ià(
»t
 =ğ
HTTP_R_EOF
)

482 
	`_DBG
("read_http_payload1 DONE......\n");

486 ià(!(
»t
 =ğ
HTTP_R_OK
 ||„‘ =ğ
HTTP_R_EOF
))

488 
	`_DBG
("read_http_payload1 ERROR......\n");

489 
bugout
;

495 
Ën
=
·ylßd_Ëngth
;

496 
tÙ®
 < 
·ylßd_Ëngth
)

498 
»t
 = 
	`h‰p_»ad
(
pbb
->
h‰p_hªdË
, 
·ylßd
+
tÙ®
, 
max_size
-tÙ®, 
tmo
, &
Ën
);

499 
tÙ®
+=
Ën
;

500 
tmo
=1;

501 ià(
»t
 =ğ
HTTP_R_EOF
)

503 
	`_DBG
("read_http_payload2 DONE......\n");

507 ià(!(
»t
 =ğ
HTTP_R_OK
 ||„‘ =ğ
HTTP_R_EOF
))

509 
	`_DBG
("read_http_payload2 ERROR......\n");

510 
bugout
;

515 *
by‹s_»ad
 = 
tÙ®
;

516 
¡©
=0;

518 
bugout
:

519  
¡©
;

520 
	}
}

522 
	$g‘_sÿÂ”_–em’ts
(
Ëdm_£ssiÚ
 *
ps
, 
wsú_sÿn_–em’ts
 *
–em’ts
)

524 
bb_Ëdm_£ssiÚ
 *
pbb
 = 
ps
->
bb_£ssiÚ
;

525 
by‹s_»ad
 = 0;

526 
¡©
=1, 
tmo
=10;

527 
buf
[8192];

529 ià(
	`h‰p_İ’
(
ps
->
dd
, 
HPMUD_S_LEDM_SCAN
, &
pbb
->
h‰p_hªdË
è!ğ
HTTP_R_OK
)

531 
	`_BUG
("uÇbËØİ’ h‰°cÚÃùiÚ %s\n", 
ps
->
uri
);

532 
bugout
;

536 ià(
	`h‰p_wr™e
(
pbb
->
h‰p_hªdË
, 
GET_SCANNER_ELEMENTS
, (GET_SCANNER_ELEMENTS)-1, 
tmo
è!ğ
HTTP_R_OK
)

538 
	`_BUG
("uÇbËØg‘_sÿÂ”_–em’t %s\n", 
ps
->
uri
);

539 
bugout
;

543 ià(
	`»ad_h‰p_·ylßd
(
ps
, 
buf
, (buf), 
tmo
, &
by‹s_»ad
))

544 
bugout
;

546 
	`_DBG
("g‘_sÿÂ”_–em’t by‹s_»ad=%d†’=%d buf=%s\n", 
by‹s_»ad
, 
	`¡¾’
(
buf
), buf);

548 
	`h‰p_unchunk_d©a
(
buf
);

549 
by‹s_»ad
=
	`¡¾’
(
buf
);

551 
	`_DBG
("g‘_sÿÂ”_–em’t buf=%s\n", 
buf
);

552 
	`·r£_sÿn_–em’ts
(
buf
, 
by‹s_»ad
, 
–em’ts
);

553 
¡©
=0;

555 
bugout
:

556 ià(
pbb
->
h‰p_hªdË
)

558 
	`h‰p_şo£
(
pbb
->
h‰p_hªdË
);

559 
pbb
->
h‰p_hªdË
 = 0;

561  
¡©
;

562 
	}
}

564 
	$ÿnûl_job
(
Ëdm_£ssiÚ
 *
ps
)

566 
bb_Ëdm_£ssiÚ
 *
pbb
 = 
ps
->
bb_£ssiÚ
;

567 
Ën
, 
¡©
=1, 
tmo
=5 ;

568 
buf
[2048];

569 
by‹s_»ad
;

571 
	`_DBG
("ÿnûl_job u£r_ÿnûl=%d job_id=%d u¾=% \n", 
ps
->
u£r_ÿnûl
,…s->
job_id
,…s->
u¾
);

572 ià(
ps
->
job_id
 =ğ0 ||…s->
u£r_ÿnûl
 == 0)

574 
ps
->
job_id
 = 0;

575 
ps
->
·ge_id
 = 0;

579 ià(
	`h‰p_İ’
(
ps
->
dd
, 
HPMUD_S_LEDM_SCAN
, &
pbb
->
h‰p_hªdË
è!ğ
HTTP_R_OK
)

581 
	`_BUG
("uÇbËØİ’ h‰°cÚÃùiÚ %s\n", 
ps
->
uri
);

582 
bugout
;

585 
Ën
 = 
	`¢´štf
(
buf
, (buf), 
CANCEL_JOB_REQUEST
, 
ps
->
u¾
, 
	`¡¾’
(
CANCEL_JOB_DATA
));

586 ià(
	`h‰p_wr™e
(
pbb
->
h‰p_hªdË
, 
buf
, 
Ën
, 1è!ğ
HTTP_R_OK
)

588 
	`_BUG
("uÇbËØÿnûl_job %s\n", 
ps
->
u¾
);

591 
Ën
 = 
	`¢´štf
(
buf
, (buf), 
CANCEL_JOB_DATA
);

592 ià(
	`h‰p_wr™e
(
pbb
->
h‰p_hªdË
, 
buf
, 
Ën
, 1è!ğ
HTTP_R_OK
)

594 
	`_BUG
("uÇbËØÿnûl_job %s\n", 
ps
->
u¾
);

597 ià(
	`»ad_h‰p_·ylßd
(
ps
, 
buf
, (buf), 
tmo
, &
by‹s_»ad
))

598 
bugout
;

600 
¡©
=0;

602 
bugout
:

603 ià(
pbb
->
h‰p_hªdË
)

605 
	`h‰p_şo£
(
pbb
->
h‰p_hªdË
);

606 
pbb
->
h‰p_hªdË
 = 0;

608  
¡©
;

609 
	}
};

613 
	$bb_İ’
(
Ëdm_£ssiÚ
 *
ps
)

615 
bb_Ëdm_£ssiÚ
 *
pbb
;

616 
deviû_£‰šgs
 *
ds
;

617 
¡©
=1, 
i
, 
j
;

619 
	`_DBG
("bb_open()\n");

621 ià((
ps
->
bb_£ssiÚ
 = 
	`ü—‹_£ssiÚ
()è=ğ
NULL
)

622 
bugout
;

624 
pbb
 = 
ps
->
bb_£ssiÚ
;

627 ià(
	`g‘_sÿÂ”_–em’ts
(
ps
, &
pbb
->
–em’ts
))

629 
bugout
;

633 
ds
 = &
pbb
->
–em’ts
.
cÚfig
.
£‰šgs
;

634 
i
=0, 
j
=0; i<
CE_MAX
; i++)

636 ià(
ds
->
cŞÜ
[
i
] =ğ
CE_K1
)

638 
ps
->
sÿnModeLi¡
[
j
] = 
SANE_VALUE_SCAN_MODE_LINEART
;

639 
ps
->
sÿnModeM­
[
j
++] = 
CE_K1
;

641 ià(
ds
->
cŞÜ
[
i
] =ğ
CE_GRAY8
)

643 
ps
->
sÿnModeLi¡
[
j
] = 
SANE_VALUE_SCAN_MODE_GRAY
;

644 
ps
->
sÿnModeM­
[
j
++] = 
CE_GRAY8
;

646 ià(
ds
->
cŞÜ
[
i
] =ğ
CE_COLOR8
)

648 
ps
->
sÿnModeLi¡
[
j
] = 
SANE_VALUE_SCAN_MODE_COLOR
;

649 
ps
->
sÿnModeM­
[
j
++] = 
CE_COLOR8
;

654 
i
=0;

655 ià(
pbb
->
–em’ts
.
cÚfig
.
¶©’
.
æ©bed_suµÜ‹d
)

657 
ps
->
šputSourûLi¡
[
i
] = 
STR_ADF_MODE_FLATBED
;

658 
ps
->
šputSourûM­
[
i
++] = 
IS_PLATEN
;

660 ià(
pbb
->
–em’ts
.
cÚfig
.
adf
.
suµÜ‹d
)

662 
ps
->
šputSourûLi¡
[
i
] = 
STR_ADF_MODE_ADF
;

663 
ps
->
šputSourûM­
[
i
++] = 
IS_ADF
;

665 ià(
pbb
->
–em’ts
.
cÚfig
.
adf
.
du¶ex_suµÜ‹d
)

667 
ps
->
šputSourûLi¡
[
i
] = 
STR_TITLE_DUPLEX
;

668 
ps
->
šputSourûM­
[
i
++] = 
IS_ADF_DUPLEX
;

672 ià(
pbb
->
–em’ts
.
cÚfig
.
£‰šgs
.
j³g_qu®™y_çùÜ_suµÜ‹d
)

673 
ps
->
İtiÚ
[
LEDM_OPTION_JPEG_QUALITY
].
ÿp
 &ğ~
SANE_CAP_INACTIVE
;

675 
ps
->
İtiÚ
[
LEDM_OPTION_JPEG_QUALITY
].
ÿp
 |ğ
SANE_CAP_INACTIVE
;

679 
ps
->
¶©’_mš_width
 = 
	`SANE_FIX
(
pbb
->
–em’ts
.
cÚfig
.
¶©’
.
mšimum_size
.
width
/1000.0*
MM_PER_INCH
);

680 
ps
->
¶©’_mš_height
 = 
	`SANE_FIX
(
pbb
->
–em’ts
.
cÚfig
.
¶©’
.
mšimum_size
.
height
/1000.0*
MM_PER_INCH
);

681 
ps
->
¶©’_xRªge
.
max
 = 
	`SANE_FIX
(
pbb
->
–em’ts
.
cÚfig
.
¶©’
.
maximum_size
.
width
/11.811023);

682 
ps
->
¶©’_brxRªge
.
max
 =…s->
¶©’_xRªge
.max;

683 
ps
->
¶©’_yRªge
.
max
 = 
	`SANE_FIX
(
pbb
->
–em’ts
.
cÚfig
.
¶©’
.
maximum_size
.
height
/11.811023);

684 
ps
->
¶©’_bryRªge
.
max
 =…s->
¶©’_yRªge
.max;

687 
ps
->
adf_mš_width
 = 
	`SANE_FIX
(
pbb
->
–em’ts
.
cÚfig
.
adf
.
mšimum_size
.
width
/1000.0*
MM_PER_INCH
);

688 
ps
->
adf_mš_height
 = 
	`SANE_FIX
(
pbb
->
–em’ts
.
cÚfig
.
adf
.
mšimum_size
.
height
/1000.0*
MM_PER_INCH
);

689 
ps
->
adf_xRªge
.
max
 = 
	`SANE_FIX
(
pbb
->
–em’ts
.
cÚfig
.
adf
.
maximum_size
.
width
/11.811023);

690 
ps
->
adf_brxRªge
.
max
 =…s->
adf_xRªge
.max;

691 
ps
->
adf_yRªge
.
max
 = 
	`SANE_FIX
(
pbb
->
–em’ts
.
cÚfig
.
adf
.
maximum_size
.
height
/11.811023);

692 
ps
->
adf_bryRªge
.
max
 =…s->
adf_yRªge
.max;

694 ià(
pbb
->
–em’ts
.
cÚfig
.
¶©’
.
æ©bed_suµÜ‹d
)

696 
i
 = 
pbb
->
–em’ts
.
cÚfig
.
¶©’
.
¶©’_»sŞutiÚ_li¡
[0] + 1;

697 
i
--)

699 
	`_DBG
("bb_İ’…Ï‹n_»sŞutiÚ_li¡ = %d\n", 
pbb
->
–em’ts
.
cÚfig
.
¶©’
.
¶©’_»sŞutiÚ_li¡
[
i
]);

700 
ps
->
¶©’_»sŞutiÚLi¡
[
i
] = 
pbb
->
–em’ts
.
cÚfig
.
¶©’
.
¶©’_»sŞutiÚ_li¡
[i];

701 
ps
->
»sŞutiÚLi¡
[
i
] = 
pbb
->
–em’ts
.
cÚfig
.
¶©’
.
¶©’_»sŞutiÚ_li¡
[i];

704 ià(
pbb
->
–em’ts
.
cÚfig
.
adf
.
suµÜ‹d
)

706 
i
 = 
pbb
->
–em’ts
.
cÚfig
.
adf
.
adf_»sŞutiÚ_li¡
[0] + 1;

707 
i
--)

709 
	`_DBG
("bb_İ’‡df_»sŞutiÚ_li¡ = %d\n", 
pbb
->
–em’ts
.
cÚfig
.
adf
.
adf_»sŞutiÚ_li¡
[
i
]);

710 
ps
->
adf_»sŞutiÚLi¡
[
i
] = 
pbb
->
–em’ts
.
cÚfig
.
adf
.
adf_»sŞutiÚ_li¡
[i];

711 
ps
->
»sŞutiÚLi¡
[
i
] = 
pbb
->
–em’ts
.
cÚfig
.
adf
.
adf_»sŞutiÚ_li¡
[i];

714 
¡©
 = 0;

716 
bugout
:

717  
¡©
;

718 
	}
}

720 
	$bb_şo£
(
Ëdm_£ssiÚ
 *
ps
)

722 ià(
ps
->
bb_£ssiÚ
)

724 
	`ä“
(
ps
->
bb_£ssiÚ
);

725 
ps
->
bb_£ssiÚ
 = 
NULL
;

728 
	}
}

731 
	$bb_g‘_·¿m‘”s
(
Ëdm_£ssiÚ
 *
ps
, 
SANE_P¬am‘”s
 *
µ
, 
İtiÚ
)

733 
bb_Ëdm_£ssiÚ
 *
pbb
 = 
ps
->
bb_£ssiÚ
;

734 
µ
->
Ï¡_äame
 = 
SANE_TRUE
;

735 
çùÜ
;

737 
	`_DBG
("bb_g‘_·¿m‘”s(İtiÚ=%d)\n", 
İtiÚ
);

739 
ps
->
cu¼’tSÿnMode
)

741 
CE_K1
:

742 
µ
->
fÜm©
 = 
SANE_FRAME_GRAY
;

743 
µ
->
d•th
 = 1;

744 
çùÜ
 = 1;

746 
CE_GRAY8
:

747 
µ
->
fÜm©
 = 
SANE_FRAME_GRAY
;

748 
µ
->
d•th
 = 8;

749 
çùÜ
 = 1;

751 
CE_COLOR8
:

753 
µ
->
fÜm©
 = 
SANE_FRAME_RGB
;

754 
µ
->
d•th
 = 8;

755 
çùÜ
 = 3;

759 
İtiÚ
)

761 
SPO_STARTED
:

762 ià(
ps
->
cu¼’tCom´essiÚ
 =ğ
SF_RAW
 &&…s->
cu¼’tSÿnMode
 !ğ
CE_GRAY8
)

766 
µ
->
lšes
 = ()(
	`SANE_UNFIX
(
ps
->
efãùiveBry
 -…s->
efãùiveTly
)/
MM_PER_INCH
*ps->
cu¼’tResŞutiÚ
);

767 
µ
->
pix–s_³r_lše
 = 
pbb
->
job
.pixels_per_line;

768 
µ
->
by‹s_³r_lše
 = 
pbb
->
job
.bytes_per_line;

774 
µ
->
lšes
 = ()(
	`SANE_UNFIX
(
ps
->
efãùiveBry
 -…s->
efãùiveTly
)/
MM_PER_INCH
*ps->
cu¼’tResŞutiÚ
);

775 
µ
->
pix–s_³r_lše
 = 
ps
->
image_Œa™s
.
iPix–sP”Row
;

776 
µ
->
by‹s_³r_lše
 = 
	`BYTES_PER_LINE
Õp->
pix–s_³r_lše
,…p->
d•th
 * 
çùÜ
);

779 
SPO_STARTED_JR
:

781 
µ
->
lšes
 = 
pbb
->
job
.lines;

782 
µ
->
pix–s_³r_lše
 = 
pbb
->
job
.pixels_per_line;

783 
µ
->
by‹s_³r_lše
 = 
pbb
->
job
.bytes_per_line;

785 
SPO_BEST_GUESS
:

787 
µ
->
lšes
 = ()
	`round
(
	`SANE_UNFIX
(
ps
->
efãùiveBry
 -…s->
efãùiveTly
)/
MM_PER_INCH
*ps->
cu¼’tResŞutiÚ
);

788 
µ
->
pix–s_³r_lše
 = ()
	`round
(
	`SANE_UNFIX
(
ps
->
efãùiveBrx
 -ps->
efãùiveTlx
)/
MM_PER_INCH
*ps->
cu¼’tResŞutiÚ
);

789 
µ
->
by‹s_³r_lše
 = 
	`BYTES_PER_LINE
Õp->
pix–s_³r_lše
,…p->
d•th
 * 
çùÜ
);

795 
	}
}

808 
	$bb_is_·³r_š_adf
(
Ëdm_£ssiÚ
 *
ps
)

810 
buf
[1024];

811 
by‹s_»ad
;

812 
bb_Ëdm_£ssiÚ
 *
pbb
 = 
ps
->
bb_£ssiÚ
;

814 if(
	`h‰p_İ’
(
ps
->
dd
, 
HPMUD_S_LEDM_SCAN
, &
pbb
->
h‰p_hªdË
è!ğ
HTTP_R_OK
)

816 
	`_BUG
("unableo open channel HPMUD_S_LEDM_SCAN \n");

819 ià(
	`h‰p_wr™e
(
pbb
->
h‰p_hªdË
, 
GET_SCANNER_STATUS
, (GET_SCANNER_STATUS)-1, 10è!ğ
HTTP_R_OK
)

821 
	`_BUG
("unableo get scanner status \n");

823 
	`»ad_h‰p_·ylßd
(
ps
, 
buf
, (buf), 
EXCEPTION_TIMEOUT
, &
by‹s_»ad
);

825 
	`h‰p_şo£
(
pbb
->
h‰p_hªdË
);

826 
pbb
->
h‰p_hªdË
 = 0;

827 
	`_DBG
("bb_is_·³r_š_adà.job_id=%d…age_id=%d buf=% \n", 
ps
->
job_id
,…s->
·ge_id
, 
buf
 );

828 if(
	`¡r¡r
(
buf
, 
ADF_LOADED
))  1;

829 if(
	`¡r¡r
(
buf
, 
ADF_EMPTY
))

831 ià(
	`¡r¡r
(
buf
, 
SCANNER_BUSY_WITH_SCAN_JOB
))  1;

832 ià(
ps
->
cu¼’tIÅutSourû
 ==
IS_ADF_DUPLEX
 &&…s->
·ge_id
 % 2 == 1)

838 
	}
}

841 
SANE_Stus
 
	$bb_¡¬t_sÿn
(
Ëdm_£ssiÚ
 *
ps
)

843 
buf
[4096] = {0};

844 
buf1
[1024]={0};

845 
Ën
, 
by‹s_»ad
, 
·³r_¡©us
;

846 
i
, 
timeout
 = 10 ;

847 
szPage_ID
[5] = {0};

848 
szJob_ID
[5] = {0};

849 
SANE_Stus
 
¡©
 = 
SANE_STATUS_IO_ERROR
;

850 
bb_Ëdm_£ssiÚ
 *
pbb
 = 
ps
->
bb_£ssiÚ
;

852 
ps
->
u£r_ÿnûl
 = 0;

853 
	`_DBG
("bb_¡¬t_sÿn(è’‹ršg...job_id=%d\n", 
ps
->
job_id
);

854 ià(
ps
->
job_id
 == 0)

856 if(
	`h‰p_İ’
(
ps
->
dd
, 
HPMUD_S_LEDM_SCAN
, &
pbb
->
h‰p_hªdË
è!ğ
HTTP_R_OK
)

858 
	`_BUG
("unableo open channel HPMUD_S_LEDM_SCAN \n");

859 
bugout
;

862 ià(
	`h‰p_wr™e
(
pbb
->
h‰p_hªdË
, 
GET_SCANNER_STATUS
, (GET_SCANNER_STATUS)-1, 
timeout
è!ğ
HTTP_R_OK
)

864 
	`_BUG
("unableo GET_SCANNER_STATUS \n");

865 
bugout
;

868 
	`»ad_h‰p_·ylßd
(
ps
, 
buf
, (buf), 
timeout
, &
by‹s_»ad
);

870 if(!
	`¡r¡r
(
buf
, 
SCANNER_IDLE
))

872 
¡©
 = 
SANE_STATUS_DEVICE_BUSY
;

873 
bugout
;

876 
	`h‰p_şo£
(
pbb
->
h‰p_hªdË
);

877 
pbb
->
h‰p_hªdË
 = 0;

879 if(
	`h‰p_İ’
(
ps
->
dd
, 
HPMUD_S_LEDM_SCAN
, &
pbb
->
h‰p_hªdË
è!ğ
HTTP_R_OK
)

881 
	`_BUG
("unableo open channel HPMUD_S_LEDM_SCAN \n");

882 
bugout
;

885 
Ën
 = 
	`¢´štf
(
buf
, (buf), 
CREATE_SCAN_JOB_REQUEST
,

886 
ps
->
cu¼’tResŞutiÚ
,

887 
ps
->
cu¼’tResŞutiÚ
,

888 (è(
ps
->
cu¼’tTlx
 / 5548.7133),

889 (è((
ps
->
cu¼’tBrx
 / 5548.7133è- (ps->
cu¼’tTlx
 / 5548.7133)),

890 (è(
ps
->
cu¼’tTly
 / 5548.7133),

891 (è((
ps
->
cu¼’tBry
 / 5548.7133è- (ps->
cu¼’tTly
 / 5548.7133)),

893 (! 
	`¡rcmp
(
û_–em’t
[
ps
->
cu¼’tSÿnMode
], "Color8")) ? "Color" : (! strcmp(ce_element[ps->currentScanMode], "Gray8")) ? "Gray" : "Gray",

894 ((! 
	`¡rcmp
(
û_–em’t
[
ps
->
cu¼’tSÿnMode
], "Color8")) || (! strcmp(ce_element[ps->currentScanMode], "Gray8"))) ? 8: 8,

895 
ps
->
cu¼’tIÅutSourû
 =ğ
IS_PLATEN
 ? 
is_–em’t
[1] : is_element[2],

896 
ps
->
cu¼’tIÅutSourû
 =ğ
IS_PLATEN
 ? 
is_–em’t
[1] : is_element[2],

897 
ps
->
cu¼’tIÅutSourû
 !ğ
IS_ADF_DUPLEX
 ? "" : "<AdfOptions><AdfOption>Duplex</AdfOption></AdfOptions>",

898 ()
ps
->
cu¼’tBrighŠess
,

899 ()
ps
->
cu¼’tCÚŒa¡
);

901 
Ën
 =†’ + 
	`¡¾’
(
ZERO_FOOTER
);

903 
Ën
 = 
	`¢´štf
(
buf1
, (buf1), 
POST_HEADER
,†en);

904 ià(
	`h‰p_wr™e
(
pbb
->
h‰p_hªdË
, 
buf1
, 
	`¡¾’
(buf1), 
timeout
è!ğ
HTTP_R_OK
)

909 ià(
	`h‰p_wr™e
(
pbb
->
h‰p_hªdË
, 
buf
, 
	`¡¾’
(buf), 1è!ğ
HTTP_R_OK
)

915 ià(
	`h‰p_wr™e
(
pbb
->
h‰p_hªdË
, 
ZERO_FOOTER
, (ZERO_FOOTER)-1, 1è!ğ
HTTP_R_OK
)

919 
	`mem£t
(
buf
, 0, (buf));

921 ià(
	`»ad_h‰p_·ylßd
(
ps
, 
buf
, (buf), 
timeout
, &
by‹s_»ad
))

922 
bugout
;

924 
	`h‰p_şo£
(
pbb
->
h‰p_hªdË
);

925 
pbb
->
h‰p_hªdË
 = 0;

927 
jobli¡
[64];

928 * 
jl
=
	`¡r¡r
(
buf
, "Location:");

929 ià(!
jl
è
bugout
;

930 
jl
=jl+10;

932 
i
=0;

933 *
jl
 != '\r')

935 
jobli¡
[
i
]=*
jl
;

936 
jl
=jl+1; 
i
++;

938 
jobli¡
[
i
]='\0';

940 
	`¡rıy
(
ps
->
u¾
, 
jobli¡
);

941 *
c
=
ps
->
u¾
;

942 
c
=
	`¡r¡r
(c, "JobList");

943 ià(
c
)

945 
c
=c+8;

946 
job_id
=
	`¡¹Ş
(
c
, 
NULL
, 10);

947 
	`™ß
(
job_id
, 
szJob_ID
,10);

948 
	`™ß
(1, 
szPage_ID
,10);

949 
ps
->
·ge_id
 = 1;

950 
ps
->
job_id
 = job_id;

955 ià(
ps
->
cu¼’tIÅutSourû
 =ğ
IS_PLATEN
)

957 
¡©
 = 
SANE_STATUS_INVAL
;

958 
bugout
;

961 
ps
->
·ge_id
++;

962 
	`™ß
(
ps
->
job_id
,
szJob_ID
,10);

963 
	`™ß
(
ps
->
·ge_id
, 
szPage_ID
,10);

965 
	`_DBG
("bb_¡¬t_sÿn(èu¾=% ·ge_id=%d\n", 
ps
->
u¾
,…s->
·ge_id
);

967 
	`mem£t
(
buf
, 0, (buf)-1);

969 if(
	`h‰p_İ’
(
ps
->
dd
, 
HPMUD_S_LEDM_SCAN
, &
pbb
->
h‰p_hªdË
è!ğ
HTTP_R_OK
)

971 
	`_BUG
("unableo open channel HPMUD_S_LEDM_SCAN \n");

972 
bugout
;

974 
	`¡r¡r
(
buf
, 
READY_TO_UPLOAD
è=ğ
NULL
)

976 
	`_DBG
("bb_¡¬t_sÿn(èENTERING....buf=%s\n", 
buf
);

977 
Ën
 = 
	`¢´štf
(
buf
, (buf), 
GET_SCAN_JOB_URL
, 
ps
->
u¾
);

979 ià(
	`h‰p_wr™e
(
pbb
->
h‰p_hªdË
, 
buf
, 
	`¡¾’
(buf), 1è!ğ
HTTP_R_OK
)

984 ià(
	`»ad_h‰p_·ylßd
 (
ps
, 
buf
, (buf), 5, &
Ën
è!ğ
HTTP_R_OK
)

987 
	`_DBG
("bb_¡¬t_sÿn(è»ad_h‰p_·ylßd FAILED†’=%d buf=%s\n", 
Ën
, 
buf
);

991 ià(
NULL
 =ğ
	`¡r¡r
(
buf
,
PRESCANPAGE
))

993 
¡©
 = 
SANE_STATUS_NO_DOCS
;

994 
bugout
;

996 ià(
	`¡r¡r
(
buf
,
JOBSTATE_CANCELED
è|| sŒ¡r(buf, 
CANCELED_BY_DEVICE
è|| sŒ¡r(buf, 
CANCELED_BY_CLIENT
))

998 
	`_DBG
("bb_start_scan() SCAN CANCELLED\n");

999 
¡©
 = 
SANE_STATUS_GOOD
;

1000 
ps
->
u£r_ÿnûl
 = 1;

1001 
bugout
;

1003 ià(
	`¡r¡r
(
buf
, 
JOBSTATE_COMPLETED
))

1005 
¡©
 = 
SANE_STATUS_GOOD
;

1006 
bugout
;

1008 
	`u¦“p
(500000);

1011 *
c
 = 
	`¡r¡r
(
buf
, "<BinaryURL>");

1012 
	`_DBG
("bb_¡¬t_sÿn(èBš¬yURL=% \n", 
c
);

1014 ià(!
c
è
bugout
;

1015 
c
 +=11;

1016 
Bš¬yURL
[30];

1017 
i
 = 0;

1018 *
c
 != '<')

1020 
Bš¬yURL
[
i
++] = *
c
 ;

1021 
c
++;

1023 
Bš¬yURL
[
i
] = '\0';

1025 
Ën
 = 
	`¢´štf
(
buf
, (buf), 
GET_SCAN_JOB_URL
, 
Bš¬yURL
);

1027 ià(
	`h‰p_wr™e
(
pbb
->
h‰p_hªdË
, 
buf
, 
	`¡¾’
(buf), 
timeout
è!ğ
HTTP_R_OK
)

1032 ià(
	`h‰p_»ad_h—d”
(
pbb
->
h‰p_hªdË
, 
buf
, (buf), 
timeout
, &
Ën
è!ğ
HTTP_R_OK
)

1037 if(
	`¡r¡r
(
buf
, "HTTP/1.1 400 Bad Reque¡")è
	`h‰p_»ad_h—d”
(
pbb
->
h‰p_hªdË
, buf, (buf), 
timeout
, &
Ën
);

1039 
¡©
 = 
SANE_STATUS_GOOD
;

1040 
bugout
:

1041 ià(
¡©
 && 
pbb
->
h‰p_hªdË
)

1043 
	`h‰p_şo£
(
pbb
->
h‰p_hªdË
);

1044 
pbb
->
h‰p_hªdË
 = 0;

1046  
¡©
;

1047 
	}
}

1049 
	$g‘_size
(
Ëdm_£ssiÚ
* 
ps
)

1051 
bb_Ëdm_£ssiÚ
 *
pbb
 = 
ps
->
bb_£ssiÚ
;

1052 
bufãr
[7];

1053 
i
=0, 
tmo
=50, 
Ën
;

1055 if(
ps
->
cu¼’tResŞutiÚ
 >ğ1200è
tmo
 *= 5;

1059 if(
	`h‰p_»ad_size
(
pbb
->
h‰p_hªdË
, 
bufãr
+
i
, 1, 
tmo
, &
Ën
) == 2)  0;

1060 ifĞ
i
 && *(
bufãr
+i) == '\n' && *(buffer+i-1) == '\r') ;

1061 
i
++;

1063 *(
bufãr
+
i
+1)='\0';

1064  
	`¡¹Ş
(
bufãr
, 
NULL
, 16);

1065 
	}
}

1067 
	$bb_g‘_image_d©a
(
Ëdm_£ssiÚ
* 
ps
, 
maxL’gth
)

1069 
bb_Ëdm_£ssiÚ
 *
pbb
 = 
ps
->
bb_£ssiÚ
;

1070 
size
=0, 
¡©
=1;

1071 
buf_size
[2];

1072 
Ën
=0, 
tmo
=50;

1073 
	`_DBG
("bb_g‘_image_d©¨h‰p_hªdË=%°út=%d…bb=%p\n", 
pbb
->
h‰p_hªdË
, 
ps
->
út
,…bb);

1074 if(
ps
->
cu¼’tResŞutiÚ
 >ğ1200è
tmo
 *= 5;

1076 ià(
ps
->
út
 == 0)

1078 
size
 = 
	`g‘_size
(
ps
);

1079 if(
size
 == 0)

1081 
	`h‰p_»ad_size
(
pbb
->
h‰p_hªdË
, 
buf_size
, 2, 
tmo
, &
Ën
);

1082 
	`h‰p_»ad_size
(
pbb
->
h‰p_hªdË
, 
buf_size
, -1, 
tmo
, &
Ën
);

1085 
	`h‰p_»ad_size
(
pbb
->
h‰p_hªdË
, 
ps
->
buf
, 
size
, 
tmo
, &
Ën
);

1086 
ps
->
út
 +ğ
Ën
;

1087 
	`h‰p_»ad_size
(
pbb
->
h‰p_hªdË
, 
buf_size
, 2, 
tmo
, &
Ën
);

1090  
¡©
=0;

1091 
	}
}

1093 
	$bb_’d_·ge
(
Ëdm_£ssiÚ
 *
ps
, 
io_”rÜ
)

1095 
bb_Ëdm_£ssiÚ
 *
pbb
 = 
ps
->
bb_£ssiÚ
;

1097 
	`_DBG
("bb_’d_·geÓ¼Ü=%d)\n", 
io_”rÜ
);

1099 ià(
pbb
->
h‰p_hªdË
)

1101 
	`h‰p_şo£
(
pbb
->
h‰p_hªdË
);

1102 
pbb
->
h‰p_hªdË
 = 0;

1105 
	}
}

1107 
	$bb_’d_sÿn
(
Ëdm_£ssiÚ
* 
ps
, 
io_”rÜ
)

1109 
bb_Ëdm_£ssiÚ
 *
pbb
 = 
ps
->
bb_£ssiÚ
;

1111 
	`_DBG
("bb_’d_sÿnÓ¼Ü=%d)\n", 
io_”rÜ
);

1113 ià(
pbb
->
h‰p_hªdË
)

1115 
	`h‰p_şo£
(
pbb
->
h‰p_hªdË
);

1116 
pbb
->
h‰p_hªdË
 = 0;

1118 
	`ÿnûl_job
(
ps
);

1119 
	`mem£t
(
ps
->
u¾
, 0, (ps->url));

1120 
ps
->
job_id
 = 0;

1121 
ps
->
·ge_id
 = 0;

1123 
	}
}

	@scan/sane/common.c

29 
	~<¡dio.h
>

30 
	~<¡d¬g.h
>

31 
	~<sy¦og.h
>

32 
	~<¡ršg.h
>

33 
	~<ùy³.h
>

34 
	~"commÚ.h
"

36 
	#DEBUG_NOT_STATIC


	)

37 
	~"§Ãi_debug.h
"

39 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
	$bug
(cÚ¡ *
fmt
, ...)

41 
buf
[256];

42 
va_li¡
 
¬gs
;

43 
n
;

45 
	`va_¡¬t
(
¬gs
, 
fmt
);

46 ià((
n
 = 
	`v¢´štf
(
buf
, 256, 
fmt
, 
¬gs
)) == -1)

47 
buf
[255] = 0;

48 
	`sy¦og
(
LOG_WARNING
, "%s", 
buf
);

49 
	`DBG
(2, "%s", 
buf
);

50 
	`va_’d
(
¬gs
);

51  
n
;

52 
	}
}

54 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
	$sysdump
(cÚ¡ *
d©a
, 
size
)

60 *
p
 = (*)
d©a
;

61 
c
;

62 
n
;

63 
by‹¡r
[4] = {0};

64 
addr¡r
[10] = {0};

65 
hex¡r
[16*3 + 5] = {0};

66 
ch¬¡r
[16*1 + 5] = {0};

67 
n
=1;n<=
size
;n++) {

68 ià(
n
%16 == 1) {

70 
	`¢´štf
(
addr¡r
, ×ddr¡r), "%.4d", ()((
p
-(*)
d©a
) & 0xffff));

73 
c
 = *
p
;

74 ià(
	`i¥ršt
(
c
) == 0) {

75 
c
 = '.';

79 
	`¢´štf
(
by‹¡r
, (by‹¡r), "%02X ", *
p
);

80 
	`¡ºÿt
(
hex¡r
, 
by‹¡r
, (hex¡r)-
	`¡¾’
(hexstr)-1);

83 
	`¢´štf
(
by‹¡r
, (by‹¡r), "%c", 
c
);

84 
	`¡ºÿt
(
ch¬¡r
, 
by‹¡r
, (ch¬¡r)-
	`¡¾’
(charstr)-1);

86 if(
n
%16 == 0) {

88 
	`DBG_SZ
("[%4.4s] %-50.50  %s\n", 
addr¡r
, 
hex¡r
, 
ch¬¡r
);

89 
hex¡r
[0] = 0;

90 
ch¬¡r
[0] = 0;

92 
p
++;

95 ià(
	`¡¾’
(
hex¡r
) > 0) {

97 
	`DBG_SZ
("[%4.4s] %-50.50  %s\n", 
addr¡r
, 
hex¡r
, 
ch¬¡r
);

99 
	}
}

101 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
	$bugdump
(cÚ¡ *
d©a
, 
size
)

107 *
p
 = (*)
d©a
;

108 
c
;

109 
n
;

110 
by‹¡r
[4] = {0};

111 
addr¡r
[10] = {0};

112 
hex¡r
[16*3 + 5] = {0};

113 
ch¬¡r
[16*1 + 5] = {0};

114 
n
=1;n<=
size
;n++) {

115 ià(
n
%16 == 1) {

117 
	`¢´štf
(
addr¡r
, ×ddr¡r), "%.4d", ()((
p
-(*)
d©a
) & 0xffff));

120 
c
 = *
p
;

121 ià(
	`i¥ršt
(
c
) == 0) {

122 
c
 = '.';

126 
	`¢´štf
(
by‹¡r
, (by‹¡r), "%02X ", *
p
);

127 
	`¡ºÿt
(
hex¡r
, 
by‹¡r
, (hex¡r)-
	`¡¾’
(hexstr)-1);

130 
	`¢´štf
(
by‹¡r
, (by‹¡r), "%c", 
c
);

131 
	`¡ºÿt
(
ch¬¡r
, 
by‹¡r
, (ch¬¡r)-
	`¡¾’
(charstr)-1);

133 if(
n
%16 == 0) {

135 
	`BUG_SZ
("[%4.4s] %-50.50  %s\n", 
addr¡r
, 
hex¡r
, 
ch¬¡r
);

136 
hex¡r
[0] = 0;

137 
ch¬¡r
[0] = 0;

139 
p
++;

142 ià(
	`¡¾’
(
hex¡r
) > 0) {

144 
	`BUG_SZ
("[%4.4s] %-50.50  %s\n", 
addr¡r
, 
hex¡r
, 
ch¬¡r
);

146 
	}
}

148 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è*
	$p¢´štf
(*
buf
, 
bufSize
, cÚ¡ *
fmt
, ...)

150 
va_li¡
 
¬gs
;

151 
n
;

153 
buf
[0] = 0;

155 
	`va_¡¬t
(
¬gs
, 
fmt
);

156 ià((
n
 = 
	`v¢´štf
(
buf
, 
bufSize
, 
fmt
, 
¬gs
)) == -1)

157 
buf
[
bufSize
] = 0;

158 
	`va_’d
(
¬gs
);

160  
buf
;

161 
	}
}

163 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
	$DivideAndShiá
Ğ
lše
,

164 
num”©Ü1
,

165 
num”©Ü2
,

166 
d’omš©Ü
,

167 
shiá
 )

169 
»mašd”
, 
shiáLoss
 = 0;

170 
»suÉ
 = 
num”©Ü1
;

171 
»suÉ
 *ğ
num”©Ü2
;

172 ifĞ
shiá
 > 0 )

174 
»suÉ
 <<ğ
shiá
;

176 
»mašd”
 = 
»suÉ
 % 
d’omš©Ü
;

177 
»suÉ
 /ğ
d’omš©Ü
;

178 ifĞ
shiá
 < 0 )

180 
shiáLoss
 = 
»suÉ
 & ( ( 1 << ( -
shiá
 ) ) - 1 );

181 
»suÉ
 >>ğĞ-
shiá
 );

183  
»suÉ
;

184 
	}
}

186 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
	$NumLi¡CË¬
Ğ* 
li¡
 )

188 
	`mem£t
Ğ
li¡
, 0, Ğè* 
MAX_LIST_SIZE
 );

189 
	}
}

191 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
	$NumLi¡IsInLi¡
Ğ* 
li¡
, 
n
 )

193 
i
;

194  
i
 = 1; i < 
MAX_LIST_SIZE
; i++ )

196 ifĞ
li¡
[
i
] =ğ
n
 )

202 
	}
}

204 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
	$NumLi¡Add
Ğ* 
li¡
, 
n
 )

206 ifĞ
	`NumLi¡IsInLi¡
Ğ
li¡
, 
n
 ) )

210 ifĞ
li¡
[0] >ğĞ
MAX_LIST_SIZE
 - 1 ) )

214 
li¡
[0]++;

215 
li¡
[li¡[0]] = 
n
;

217 
	}
}

219 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
	$NumLi¡G‘CouÁ
Ğ* 
li¡
 )

221  
li¡
[0];

222 
	}
}

224 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
	$NumLi¡G‘Fœ¡
Ğ* 
li¡
 )

226 
n
 = 
li¡
[0];

227 ifĞ
n
 > 0 )

229 
n
 = 
li¡
[1];

231  
n
;

232 
	}
}

234 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
	$SŒLi¡CË¬
ĞcÚ¡ ** 
li¡
 )

236 
	`mem£t
Ğ
li¡
, 0, Ğ* ) * 
MAX_LIST_SIZE
 );

237 
	}
}

239 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
	$SŒLi¡IsInLi¡
ĞcÚ¡ ** 
li¡
, * 
s
 )

241  *
li¡
 )

243 ifĞ!
	`¡rÿ£cmp
Ğ*
li¡
, 
s
 ) )

247 
li¡
++;

250 
	}
}

252 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
	$SŒLi¡Add
ĞcÚ¡ ** 
li¡
, * 
s
 )

254 
i
;

255  
i
 = 0; i < 
MAX_LIST_SIZE
 - 1; i++ )

257 ifĞ!
li¡
[
i
] )

259 
li¡
[
i
] = 
s
;

262 ifĞ!
	`¡rÿ£cmp
Ğ
li¡
[
i
], 
s
 ) )

268 
	}
}

270 * 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
	$™ß
(
v®ue
, * 
¡r
, 
¿dix
)

272 
dig
[] = "0123456789""abcdefghijklmnopqrstuvwxyz";

273 
n
 = 0, 
Ãg
 = 0;

274 
v
;

275 * 
p
, *
q
;

276 
c
;

278 ià(
¿dix
 =ğ10 && 
v®ue
 < 0)

280 
v®ue
 = -value;

281 
Ãg
 = 1;

283 
v
 = 
v®ue
;

285 
¡r
[
n
++] = 
dig
[
v
%
¿dix
];

286 
v
 /ğ
¿dix
;

287 } 
v
);

288 ià(
Ãg
)

289 
¡r
[
n
++] = '-';

290 
¡r
[
n
] = '\0';

292 
p
 = 
¡r
, 
q
 =… + (
n
-1);… < q; ++p, --q)

293 
c
 = *
p
, *°ğ*
q
, *q = c;

294  
¡r
;

295 
	}
}

	@scan/sane/common.h

28 #iâdeà
_COMMON_H


29 
	#_COMMON_H


	)

31 
	~<sy¦og.h
>

36 
	#_STRINGIZE
(
x
è#x

	)

37 
	#STRINGIZE
(
x
è
	`_STRINGIZE
(x)

	)

39 
	#BUG
(
¬gs
...è{
	`sy¦og
(
LOG_ERR
, 
__FILE__
 " " 
	`STRINGIZE
(
__LINE__
è": "‡rgs); 
	`DBG
(2, __FILE__ " " STRINGIZE(__LINE__è": "‡rgs);}

	)

40 
	#BUG_DUMP
(
d©a
, 
size
è
	`bugdump
((d©a), (size))

	)

41 
	#BUG_SZ
(
¬gs
...è{
	`sy¦og
(
LOG_ERR
,‡rgs); 
	`DBG
(2,‡rgs);}

	)

43 
	#DBG_DUMP
(
d©a
, 
size
è
	`sysdump
((d©a), (size))

	)

45 
	#DBG6
(
¬gs
...è
	`DBG
(6, 
__FILE__
 " " 
	`STRINGIZE
(
__LINE__
è": "‡rgs)

	)

46 
	#DBG8
(
¬gs
...è
	`DBG
(8, 
__FILE__
 " " 
	`STRINGIZE
(
__LINE__
è": "‡rgs)

	)

47 
	#DBG_SZ
(
¬gs
...è
	`DBG
(6,‡rgs)

	)

49 
	#DBG6
(
¬gs
...è
	`sy¦og
(
LOG_INFO
, 
__FILE__
 " " 
	`STRINGIZE
(
__LINE__
è": "‡rgs)

	)

50 
	#DBG8
(
¬gs
...è
	`sy¦og
(
LOG_INFO
, 
__FILE__
 " " 
	`STRINGIZE
(
__LINE__
è": "‡rgs)

	)

51 
	#DBG_SZ
(
¬gs
...è
	`sy¦og
(
LOG_INFO
,‡rgs)

	)

54 
	#BACKEND_NAME
 
h·io


	)

56 
	#BREAKPOINT
 
	`__asm
Ğ"št3" )

	)

58 
	#OK
 1

	)

59 
	#ERROR
 0

	)

60 
	#MAX_LIST_SIZE
 32

	)

61 
	#EXCEPTION_TIMEOUT
 45

	)

63 
	#STR_COMPRESSION_NONE
 
	`SANE_I18N
("NÚe")

	)

64 
	#STR_COMPRESSION_MH
 
	`SANE_I18N
("MH")

	)

65 
	#STR_COMPRESSION_MR
 
	`SANE_I18N
("MR")

	)

66 
	#STR_COMPRESSION_MMR
 
	`SANE_I18N
("MMR")

	)

67 
	#STR_COMPRESSION_JPEG
 
	`SANE_I18N
("JPEG")

	)

69 
	#STR_ADF_MODE_AUTO
 
	`SANE_I18N
("Auto")

	)

70 
	#STR_ADF_MODE_FLATBED
 
	`SANE_I18N
("FÏtbed")

	)

71 
	#STR_ADF_MODE_ADF
 
	`SANE_I18N
("ADF")

	)

72 
	#STR_ADF_MODE_CAMERA
 
	`SANE_I18N
("Cam”a")

	)

74 
	#STR_TITLE_ADVANCED
 
	`SANE_I18N
("Advªûd")

	)

76 
	#STR_NAME_COMPRESSION
 "com´essiÚ"

	)

77 
	#STR_TITLE_COMPRESSION
 
	`SANE_I18N
("Com´essiÚ")

	)

78 
	#STR_DESC_COMPRESSION
 
	`SANE_I18N
("S–eù thsÿÂ” com´essiÚ m‘hod fÜ fa¡” sÿns,…ossibly‡ˆthex³n£ oàimagqu®™y.")

	)

80 
	#STR_NAME_JPEG_QUALITY
 "j³g-qu®™y"

	)

81 
	#STR_TITLE_JPEG_QUALITY
 
	`SANE_I18N
("JPEG com´essiÚ faùÜ")

	)

82 
	#STR_DESC_JPEG_QUALITY
 
	`SANE_I18N
("Setshe scanner JPEG compression factor. Larger‚umbers mean better compression, " \

83 "ªd sm®Ë¸numb” m—Àb‘‹¸imagqu®™y.")

	)

85 
	#STR_NAME_BATCH_SCAN
 "b©ch-sÿn"

	)

86 
	#STR_TITLE_BATCH_SCAN
 
	`SANE_I18N
("B©ch sÿn")

	)

87 
	#STR_DESC_BATCH_SCAN
 
	`SANE_I18N
("EÇbË cÚtšuou sÿÂšg w™h‡utom©iødocum’ˆãed” (ADF).")

	)

89 
	#STR_NAME_DUPLEX
 "du¶ex"

	)

90 
	#STR_TITLE_DUPLEX
 
	`SANE_I18N
("Du¶ex")

	)

91 
	#STR_DESC_DUPLEX
 
	`SANE_I18N
("EÇbË sÿÂšg oÀbÙh side oàth·ge.")

	)

93 
	#STR_TITLE_GEOMETRY
 
	`SANE_I18N
("Geom‘ry")

	)

95 
	#STR_NAME_LENGTH_MEASUREMENT
 "Ëngth-m—su»m’t"

	)

96 
	#STR_TITLE_LENGTH_MEASUREMENT
 
	`SANE_I18N
("L’gth m—su»m’t")

	)

97 
	#STR_DESC_LENGTH_MEASUREMENT
 
	`SANE_I18N
("Selects howhe scanned image†ength is measured‡nd " \

98 "»pÜ‹d, which i impossibËØknow iÀadvªû fÜ süŞlãd sÿns.")

	)

100 
	#STR_LENGTH_MEASUREMENT_UNKNOWN
 
	`SANE_I18N
("Unknown")

	)

101 
	#STR_LENGTH_MEASUREMENT_UNLIMITED
 
	`SANE_I18N
("UÆim™ed")

	)

102 
	#STR_LENGTH_MEASUREMENT_APPROXIMATE
 
	`SANE_I18N
("Aµroxim©e")

	)

103 
	#STR_LENGTH_MEASUREMENT_PADDED
 
	`SANE_I18N
("Padded")

	)

104 
	#STR_LENGTH_MEASUREMENT_EXACT
 
	`SANE_I18N
("Exaù")

	)

105 
	#STR_UNKNOWN
 
	`SANE_I18N
("???")

	)

107 
	#MIN_JPEG_COMPRESSION_FACTOR
 0

	)

108 
	#MAX_JPEG_COMPRESSION_FACTOR
 100

	)

110 
	#SAFER_JPEG_COMPRESSION_FACTOR
 10

	)

113 
	#MULTIPICK_DISABLE
 0

	)

114 
	#MULTIPICK_ENABLE
 1

	)

116 
	#BEND_GET_SHORT
(
s
è(((s)[0]<<8)|((s)[1]))

	)

117 
	#BEND_GET_LONG
(
s
è(((s)[0]<<24)|((s)[1]<<16)|((s)[2]<<8)|((s)[3]))

	)

118 
	#BEND_SET_SHORT
(
s
,
x
è((s)[0]=((x)>>8)&0xFF,(s)[1]=(x)&0xFF)

	)

119 
	#BEND_SET_LONG
(
s
,
x
è((s)[0]=((x)>>24)&0xFF,(s)[1]=((x)>>16)&0xFF,(s)[2]=((x)>>8)&0xFF,(s)[3]=(x)&0xFF)

	)

120 
	#LEND_GET_SHORT
(
s
è(((s)[1]<<8)|((s)[0]))

	)

121 
	#LEND_GET_LONG
(
s
è(((s)[3]<<24)|((s)[2]<<16)|((s)[1]<<8)|((s)[0]))

	)

122 
	#LEND_SET_SHORT
(
s
,
x
è((s)[1]=((x)>>8)&0xFF,(s)[0]=(x)&0xFF)

	)

123 
	#LEND_SET_LONG
(
s
,
x
è((s)[3]=((x)>>24)&0xFF,(s)[2]=((x)>>16)&0xFF,(s)[1]=((x)>>8)&0xFF,(s)[0]=(x)&0xFF)

	)

125 
	#GEOMETRY_OPTION_TYPE
 
SANE_TYPE_FIXED


	)

126 
	#MILLIMETER_SHIFT_FACTOR
 
SANE_FIXED_SCALE_SHIFT


	)

128 
	#DECIPOINTS_PER_INCH
 720

	)

129 
	#DEVPIXELS_PER_INCH
 300

	)

130 
	#MILLIMETERS_PER_10_INCHES
 254

	)

131 
	#INCHES_PER_254_MILLIMETERS
 10

	)

133 
	#BYTES_PER_LINE
(
pix–sP”Lše
,
b™sP”Pix–
) \

134 ((((
pix–sP”Lše
)*(
b™sP”Pix–
))+7)/8)

	)

136 
	#INCHES_TO_MILLIMETERS
(
šches
) \

137 
	`DivideAndShiá
(
__LINE__
, \

138 (
šches
), \

139 
MILLIMETERS_PER_10_INCHES
, \

140 
INCHES_PER_254_MILLIMETERS
, \

141 
MILLIMETER_SHIFT_FACTOR
)

	)

143 
	#DECIPIXELS_TO_MILLIMETERS
(
decix–s
) \

144 
	`DivideAndShiá
(
__LINE__
, \

145 (
decix–s
), \

146 
MILLIMETERS_PER_10_INCHES
, \

147 
INCHES_PER_254_MILLIMETERS
*
h·io
->
decix–sP”Inch
, \

148 
MILLIMETER_SHIFT_FACTOR
)

	)

150 
	#MILLIMETERS_TO_DECIPIXELS
(
mlim‘”s
) \

151 
	`DivideAndShiá
(
__LINE__
, \

152 (
mlim‘”s
), \

153 
INCHES_PER_254_MILLIMETERS
*
h·io
->
decix–sP”Inch
, \

154 
MILLIMETERS_PER_10_INCHES
, \

155 -
MILLIMETER_SHIFT_FACTOR
)

	)

157 
	#PIXELS_TO_MILLIMETERS
(
pix–s
,
pix–sP”Inch
) \

158 
	`DivideAndShiá
(
__LINE__
, \

159 (
pix–s
), \

160 
MILLIMETERS_PER_10_INCHES
, \

161 (
pix–sP”Inch
)*
INCHES_PER_254_MILLIMETERS
, \

162 
MILLIMETER_SHIFT_FACTOR
)

	)

164 
	#MILLIMETERS_TO_PIXELS
(
mlim‘”s
,
pix–sP”Inch
) \

165 
	`DivideAndShiá
(
__LINE__
, \

166 (
mlim‘”s
), \

167 
INCHES_PER_254_MILLIMETERS
*(
pix–sP”Inch
), \

168 
MILLIMETERS_PER_10_INCHES
, \

169 -
MILLIMETER_SHIFT_FACTOR
)

	)

171 
	#ADD_XFORM
(
x
) \

173 
pXfÜm
->
eXfÜm
=
x
; \

174 
pXfÜm
++; \

175 } 0)

	)

177 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
bug
(cÚ¡ *
fmt
, ...);

178 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
sysdump
(cÚ¡ *
d©a
, 
size
);

179 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
bugdump
(cÚ¡ *
d©a
, 
size
);

180 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è*
p¢´štf
(*
buf
, 
bufSize
, cÚ¡ *
fmt
, ...);

181 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
DivideAndShiá
(
lše
, 
num”©Ü1
, 
num”©Ü2
,

182 
d’omš©Ü
, 
shiá
);

183 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
NumLi¡CË¬
Ğ* 
li¡
 );

184 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
NumLi¡IsInLi¡
Ğ* 
li¡
, 
n
 );

185 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
NumLi¡Add
Ğ* 
li¡
, 
n
 );

186 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
NumLi¡G‘CouÁ
Ğ* 
li¡
 );

187 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
NumLi¡G‘Fœ¡
Ğ* 
li¡
 );

188 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
SŒLi¡CË¬
ĞcÚ¡ ** 
li¡
 );

189 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
SŒLi¡IsInLi¡
ĞcÚ¡ ** 
li¡
, * 
s
 );

190 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
SŒLi¡Add
ĞcÚ¡ ** 
li¡
, * 
s
 );

191 * 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
™ß
(
v®ue
, * 
¡r
, 
¿dix
);

	@scan/sane/escl.c

9 #iâdeà
_GNU_SOURCE


10 
	#_GNU_SOURCE


	)

13 
	~<¡d¬g.h
>

14 
	~<sy¦og.h
>

15 
	~<¡dio.h
>

16 
	~<¡ršg.h
>

17 
	~<dlfú.h
>

18 
	~<fú.h
>

19 
	~<uni¡d.h
>

20 
	~"§Ãİts.h
"

21 
	~"commÚ.h
"

22 
	~"hpmud.h
"

23 
	~"hp.h
"

24 
	~"esş.h
"

25 
	~"esşi.h
"

26 
	~"io.h
"

27 
	~"uts.h
"

29 
	#DEBUG_DECLARE_ONLY


	)

30 
	~"§Ãi_debug.h
"

32 
esş_£ssiÚ
 *
	g£ssiÚ
 = 
NULL
;

35 
	$bb_lßd
(
esş_£ssiÚ
 *
ps
, cÚ¡ *
so
)

37 
¡©
=1;

40 ià((
ps
->
hpmud_hªdË
 = 
	`lßd_lib¿ry
("libhpmud.so.0")è=ğ
NULL
)

42 ià((
ps
->
hpmud_hªdË
 = 
	`lßd_lib¿ry
("libhpmud.so.0")è=ğ
NULL
)

43 
bugout
;

47 ià((
ps
->
m©h_hªdË
 = 
	`lßd_lib¿ry
("libm.so")è=ğ
NULL
)

49 ià((
ps
->
m©h_hªdË
 = 
	`lßd_lib¿ry
("libm.so.6")è=ğ
NULL
)

50 
bugout
;

52 ià((
ps
->
bb_hªdË
 = 
	`lßd_¶ugš_lib¿ry
(
UTILS_SCAN_PLUGIN_LIBRARY
, 
so
)è=ğ
NULL
)

54 
	`S’dSÿnEv’t
(
ps
->
uri
, 
EVENT_PLUGIN_FAIL
);

55 
bugout
;

57 ià((
ps
->
bb_İ’
 = 
	`g‘_lib¿ry_symbŞ
Õs->
bb_hªdË
, "bb_İ’")è=ğ
NULL
)

58 
bugout
;

59 
	`_DBG
("Calling bb_open\n");

60 ià((
ps
->
bb_şo£
 = 
	`g‘_lib¿ry_symbŞ
Õs->
bb_hªdË
, "bb_şo£")è=ğ
NULL
)

61 
bugout
;

63 ià((
ps
->
bb_g‘_·¿m‘”s
 = 
	`g‘_lib¿ry_symbŞ
Õs->
bb_hªdË
, "bb_g‘_·¿m‘”s")è=ğ
NULL
)

64 
bugout
;

66 ià((
ps
->
bb_check_sÿÂ”_to_cÚtšue
 = 
	`g‘_lib¿ry_symbŞ
Õs->
bb_hªdË
, "bb_check_sÿÂ”_to_cÚtšue")è=ğ
NULL
)

67 
bugout
;

69 ià((
ps
->
bb_¡¬t_sÿn
 = 
	`g‘_lib¿ry_symbŞ
Õs->
bb_hªdË
, "bb_¡¬t_sÿn")è=ğ
NULL
)

70 
bugout
;

72 ià((
ps
->
bb_’d_sÿn
 = 
	`g‘_lib¿ry_symbŞ
Õs->
bb_hªdË
, "bb_’d_sÿn")è=ğ
NULL
)

73 
bugout
;

75 ià((
ps
->
bb_g‘_image_d©a
 = 
	`g‘_lib¿ry_symbŞ
Õs->
bb_hªdË
, "bb_g‘_image_d©a")è=ğ
NULL
)

76 
bugout
;

78 ià((
ps
->
bb_’d_·ge
 = 
	`g‘_lib¿ry_symbŞ
Õs->
bb_hªdË
, "bb_’d_·ge")è=ğ
NULL
)

79 
bugout
;

80 
	`_DBG
("Calling bb_load EXIT\n");

81 
¡©
=0;

83 
bugout
:

84  
¡©
;

85 
	}
}

87 
	$bb_uÆßd
(
esş_£ssiÚ
 *
ps
)

89 
	`_DBG
("Callingƒscl bb_unload: \n");

90 ià(
ps
->
bb_hªdË
)

92 
	`dlşo£
(
ps
->
bb_hªdË
);

93 
ps
->
bb_hªdË
 = 
NULL
;

95 ià(
ps
->
hpmud_hªdË
)

97 
	`dlşo£
(
ps
->
hpmud_hªdË
);

98 
ps
->
hpmud_hªdË
 = 
NULL
;

100 ià(
ps
->
m©h_hªdË
)

102 
	`dlşo£
(
ps
->
m©h_hªdË
);

103 
ps
->
m©h_hªdË
 = 
NULL
;

106 
	}
}

108 
	$esş_£t_ex‹Ás
(
esş_£ssiÚ
 *
ps
)

110 
¡©
 = 0;

111 
	`_DBG
("escl_set_extents minWidth=%d minHeight=%d Source Range[%d, %d, %d, %d] Current Range[%d, %d, %d, %d]\n",

112 
ps
->
mš_width
,…s->
mš_height
,

113 
ps
->
xRªge
.
max
,…s->
brxRªge
.max,…s->
yRªge
.max,…s->
bryRªge
.max,

114 
ps
->
cu¼’tTlx
,…s->
cu¼’tBrx
,…s->
cu¼’tTly
,…s->
cu¼’tBry
);

116 ià((
ps
->
cu¼’tBrx
 >…s->
cu¼’tTlx
è&& (ps->cu¼’tBrx -…s->cu¼’tTlx >ğps->
mš_width
è&& (ps->cu¼’tBrx -…s->cu¼’tTlx <ğps->
xRªge
.
max
))

118 
ps
->
efãùiveTlx
 =…s->
cu¼’tTlx
;

119 
ps
->
efãùiveBrx
 =…s->
cu¼’tBrx
;

123 
ps
->
efãùiveTlx
 =…s->
cu¼’tTlx
 = 0;

124 
ps
->
efãùiveBrx
 =…s->
cu¼’tBrx
 =…s->
brxRªge
.
max
;

127 ià((
ps
->
cu¼’tBry
 >…s->
cu¼’tTly
è&& (ps->cu¼’tBry -…s->cu¼’tTly >…s->
mš_height
è&& (ps->cu¼’tBry -…s->cu¼’tTly <ğps->
yRªge
.
max
))

129 
ps
->
efãùiveTly
 =…s->
cu¼’tTly
;

130 
ps
->
efãùiveBry
 =…s->
cu¼’tBry
;

134 
ps
->
efãùiveTly
 =…s->
cu¼’tTly
 = 0;

135 
ps
->
efãùiveBry
 =…s->
cu¼’tBry
 =…s->
bryRªge
.
max
;

137  
¡©
;

138 
	}
}

140 
esş_£ssiÚ
 *
	$ü—‹_£ssiÚ
()

142 
esş_£ssiÚ
 *
ps
;

144 ià((
ps
 = 
	`m®loc
((
esş_£ssiÚ
))è=ğ
NULL
)

146  
NULL
;

148 
	`mem£t
(
ps
, 0, (
esş_£ssiÚ
));

149 
ps
->
g
 = "ESCL";

150 
ps
->
dd
 = -1;

151 
ps
->
cd
 = -1;

152 
	`mem£t
(
ps
->
job_id
, 0, (ps->job_id));

153 
ps
->
·ge_id
 = 0;

154  
ps
;

155 
	}
}

158 
	$g‘__d©a
(
esş_£ssiÚ
 *
ps
, 
SANE_By‹
 *
d©a
, 
SANE_IÁ
 
maxL’gth
, SANE_IÁ *
Ëngth
)

160 
_»t
=
IP_INPUT_ERROR
;

161 
ouutAva
=
maxL’gth
, 
ouutU£d
=0, 
ouutThisPos
;

162 *
šput
, *
ouut
 = 
d©a
;

163 
šputAva
, 
šputU£d
=0, 
šputNextPos
;

164 
ESCL_RESULT
 
¡©
 = 
ESCL_R_IO_ERROR
;

166 
	`_DBG
("get_ip_data....\n");

167 ià(!
ps
->
_hªdË
è
bugout
;

169 
¡©
 = 
ps
->
	`bb_g‘_image_d©a
Õs, 
ouutAva
);

170 if(
¡©
 =ğ
ESCL_R_IO_ERROR
è
bugout
;

172 ià(
ps
->
út
 > 0)

174 
šputAva
 = 
ps
->
út
;

175 
šput
 = &
ps
->
buf
[ps->
šdex
];

179 
šput
 = 
NULL
;

180 
šputAva
 = 0;

184 
_»t
 = 
	`CÚv”t
(
ps
->
_hªdË
, 
šputAva
, 
šput
, &
šputU£d
, &
šputNextPos
, 
ouutAva
, 
ouut
, &
ouutU£d
, &
ouutThisPos
);

186 
	`_DBG
("_»t=%x cÁ=%d index=%d iÅut=%°šputAva=%d iÅutU£d=%d iÅutNextPos=%d ouut=%°ouutAva=%d ouutU£d=%d ouutThisPos=%d\n", 
_»t
, 
ps
->
út
,…s->
šdex
, 
šput
,

187 
šputAva
, 
šputU£d
, 
šputNextPos
, 
ouut
, 
ouutAva
, 
ouutU£d
, 
ouutThisPos
);

189 ià(
šput
 !ğ
NULL
)

191 ià(
šputAva
 =ğ
šputU£d
)

193 
ps
->
šdex
 =…s->
út
 = 0;

197 
ps
->
út
 -ğ
šputU£d
;

198 
ps
->
šdex
 +ğ
šputU£d
;

202 ià(
d©a
)

203 *
Ëngth
 = 
ouutU£d
;

206 ià(
_»t
 & 
IP_DONE
 && 
ouutU£d
)

207 
_»t
 &ğ~
IP_DONE
;

209 
bugout
:

210 
	`_DBG
("g‘__d©¨»tuºšg (%d).\n", 
_»t
);

211  
_»t
;

212 
	}
}

215 
	$£t_sÿn_mode_side_efãùs
(
esş_£ssiÚ
 *
ps
, 
COLOR_ENTRY
 
sÿnMode
)

217 
j
=0;

219 
	`_DBG
("set_scan_mode_side_effects....\n");

220 
	`mem£t
(
ps
->
com´essiÚLi¡
, 0, (ps->compressionList));

221 
	`mem£t
(
ps
->
com´essiÚM­
, 0, (ps->compressionMap));

223 
sÿnMode
)

225 
CE_K1
:

226 
CE_GRAY8
:

227 
CE_COLOR8
:

229 
ps
->
com´essiÚLi¡
[
j
] = 
STR_COMPRESSION_JPEG
;

230 
ps
->
com´essiÚM­
[
j
++] = 
SF_JPEG
;

231 
ps
->
cu¼’tCom´essiÚ
 = 
SF_JPEG
;

232 
ps
->
İtiÚ
[
ESCL_OPTION_JPEG_QUALITY
].
ÿp
 |ğ
SANE_CAP_SOFT_SELECT
;

236 
	}
}

238 
	$£t_šput_sourû_side_efãùs
(
esş_£ssiÚ
 *
ps
, 
INPUT_SOURCE
 
sourû
)

241 
	`_DBG
("set_input_source_side_effects....\n");

242 
sourû
)

244 
IS_CAMERA
:

245 
ps
->
mš_width
 =…s->
ÿm”a_mš_width
;

246 
ps
->
mš_height
 =…s->
ÿm”a_mš_height
;

247 
ps
->
xRªge
.
max
 =…s->
ÿm”a_xRªge
.max;

248 
ps
->
brxRªge
.
max
 =…s->
ÿm”a_brxRªge
.max;

249 
ps
->
yRªge
.
max
 =…s->
ÿm”a_yRªge
.max;

250 
ps
->
bryRªge
.
max
 =…s->
ÿm”a_bryRªge
.max;

252 
IS_ADF
:

253 
ps
->
mš_width
 =…s->
adf_mš_width
;

254 
ps
->
mš_height
 =…s->
adf_mš_height
;

255 
ps
->
xRªge
.
max
 =…s->
adf_xRªge
.max;

256 
ps
->
brxRªge
.
max
 =…s->
adf_brxRªge
.max;

257 
ps
->
yRªge
.
max
 =…s->
adf_yRªge
.max;

258 
ps
->
bryRªge
.
max
 =…s->
adf_bryRªge
.max;

260 
IS_ADF_DUPLEX
:

261 
ps
->
mš_width
 =…s->
du¶ex_mš_width
;

262 
ps
->
mš_height
 =…s->
du¶ex_mš_height
;

263 
ps
->
xRªge
.
max
 =…s->
du¶ex_xRªge
.max;

264 
ps
->
brxRªge
.
max
 =…s->
du¶ex_brxRªge
.max;

265 
ps
->
yRªge
.
max
 =…s->
du¶ex_yRªge
.max;

266 
ps
->
bryRªge
.
max
 =…s->
du¶ex_bryRªge
.max;

268 
IS_PLATEN
:

270 
ps
->
mš_width
 =…s->
¶©’_mš_width
;

271 
ps
->
mš_height
 =…s->
¶©’_mš_height
;

272 
ps
->
xRªge
.
max
 =…s->
¶©’_xRªge
.max;

273 
ps
->
brxRªge
.
max
 =…s->
¶©’_brxRªge
.max;

274 
ps
->
yRªge
.
max
 =…s->
¶©’_yRªge
.max;

275 
ps
->
bryRªge
.
max
 =…s->
¶©’_bryRªge
.max;

279 
	}
}

281 
	$š™_İtiÚs
(
esş_£ssiÚ
 *
ps
)

283 
	`_DBG
("init_options....\n");

284 
ps
->
İtiÚ
[
ESCL_OPTION_COUNT
].
Çme
 = "option-cnt";

285 
ps
->
İtiÚ
[
ESCL_OPTION_COUNT
].
t™Ë
 = 
SANE_TITLE_NUM_OPTIONS
;

286 
ps
->
İtiÚ
[
ESCL_OPTION_COUNT
].
desc
 = 
SANE_DESC_NUM_OPTIONS
;

287 
ps
->
İtiÚ
[
ESCL_OPTION_COUNT
].
ty³
 = 
SANE_TYPE_INT
;

288 
ps
->
İtiÚ
[
ESCL_OPTION_COUNT
].
un™
 = 
SANE_UNIT_NONE
;

289 
ps
->
İtiÚ
[
ESCL_OPTION_COUNT
].
size
 = (
SANE_IÁ
);

290 
ps
->
İtiÚ
[
ESCL_OPTION_COUNT
].
ÿp
 = 
SANE_CAP_SOFT_DETECT
;

291 
ps
->
İtiÚ
[
ESCL_OPTION_COUNT
].
cÚ¡¿št_ty³
 = 
SANE_CONSTRAINT_NONE
;

293 
ps
->
İtiÚ
[
ESCL_OPTION_GROUP_SCAN_MODE
].
Çme
 = "mode-group";

294 
ps
->
İtiÚ
[
ESCL_OPTION_GROUP_SCAN_MODE
].
t™Ë
 = 
SANE_TITLE_SCAN_MODE
;

295 
ps
->
İtiÚ
[
ESCL_OPTION_GROUP_SCAN_MODE
].
ty³
 = 
SANE_TYPE_GROUP
;

297 
ps
->
İtiÚ
[
ESCL_OPTION_SCAN_MODE
].
Çme
 = 
SANE_NAME_SCAN_MODE
;

298 
ps
->
İtiÚ
[
ESCL_OPTION_SCAN_MODE
].
t™Ë
 = 
SANE_TITLE_SCAN_MODE
;

299 
ps
->
İtiÚ
[
ESCL_OPTION_SCAN_MODE
].
desc
 = 
SANE_DESC_SCAN_MODE
;

300 
ps
->
İtiÚ
[
ESCL_OPTION_SCAN_MODE
].
ty³
 = 
SANE_TYPE_STRING
;

301 
ps
->
İtiÚ
[
ESCL_OPTION_SCAN_MODE
].
un™
 = 
SANE_UNIT_NONE
;

302 
ps
->
İtiÚ
[
ESCL_OPTION_SCAN_MODE
].
size
 = 
MAX_STRING_SIZE
;

303 
ps
->
İtiÚ
[
ESCL_OPTION_SCAN_MODE
].
ÿp
 = 
SANE_CAP_SOFT_SELECT
 | 
SANE_CAP_SOFT_DETECT
;

304 
ps
->
İtiÚ
[
ESCL_OPTION_SCAN_MODE
].
cÚ¡¿št_ty³
 = 
SANE_CONSTRAINT_STRING_LIST
;

305 
ps
->
İtiÚ
[
ESCL_OPTION_SCAN_MODE
].
cÚ¡¿št
.
¡ršg_li¡
 =…s->
sÿnModeLi¡
;

307 
ps
->
İtiÚ
[
ESCL_OPTION_INPUT_SOURCE
].
Çme
 = 
SANE_NAME_SCAN_SOURCE
;

308 
ps
->
İtiÚ
[
ESCL_OPTION_INPUT_SOURCE
].
t™Ë
 = 
SANE_TITLE_SCAN_SOURCE
;

309 
ps
->
İtiÚ
[
ESCL_OPTION_INPUT_SOURCE
].
desc
 = 
SANE_DESC_SCAN_SOURCE
;

310 
ps
->
İtiÚ
[
ESCL_OPTION_INPUT_SOURCE
].
ty³
 = 
SANE_TYPE_STRING
;

311 
ps
->
İtiÚ
[
ESCL_OPTION_INPUT_SOURCE
].
un™
 = 
SANE_UNIT_NONE
;

312 
ps
->
İtiÚ
[
ESCL_OPTION_INPUT_SOURCE
].
size
 = 
MAX_STRING_SIZE
;

313 
ps
->
İtiÚ
[
ESCL_OPTION_INPUT_SOURCE
].
ÿp
 = 
SANE_CAP_SOFT_SELECT
 | 
SANE_CAP_SOFT_DETECT
;

314 
ps
->
İtiÚ
[
ESCL_OPTION_INPUT_SOURCE
].
cÚ¡¿št_ty³
 = 
SANE_CONSTRAINT_STRING_LIST
;

315 
ps
->
İtiÚ
[
ESCL_OPTION_INPUT_SOURCE
].
cÚ¡¿št
.
¡ršg_li¡
 =…s->
šputSourûLi¡
;

317 
ps
->
İtiÚ
[
ESCL_OPTION_SCAN_RESOLUTION
].
Çme
 = 
SANE_NAME_SCAN_RESOLUTION
;

318 
ps
->
İtiÚ
[
ESCL_OPTION_SCAN_RESOLUTION
].
t™Ë
 = 
SANE_TITLE_SCAN_RESOLUTION
;

319 
ps
->
İtiÚ
[
ESCL_OPTION_SCAN_RESOLUTION
].
desc
 = 
SANE_DESC_SCAN_RESOLUTION
;

320 
ps
->
İtiÚ
[
ESCL_OPTION_SCAN_RESOLUTION
].
ty³
 = 
SANE_TYPE_INT
;

321 
ps
->
İtiÚ
[
ESCL_OPTION_SCAN_RESOLUTION
].
un™
 = 
SANE_UNIT_DPI
;

322 
ps
->
İtiÚ
[
ESCL_OPTION_SCAN_RESOLUTION
].
size
 = (
SANE_IÁ
);

323 
ps
->
İtiÚ
[
ESCL_OPTION_SCAN_RESOLUTION
].
ÿp
 = 
SANE_CAP_SOFT_SELECT
 | 
SANE_CAP_SOFT_DETECT
;

324 
ps
->
İtiÚ
[
ESCL_OPTION_SCAN_RESOLUTION
].
cÚ¡¿št_ty³
 = 
SANE_CONSTRAINT_WORD_LIST
;

325 
ps
->
İtiÚ
[
ESCL_OPTION_SCAN_RESOLUTION
].
cÚ¡¿št
.
wÜd_li¡
 =…s->
»sŞutiÚLi¡
;

327 
ps
->
İtiÚ
[
ESCL_OPTION_GROUP_ADVANCED
].
Çme
 = "advanced-group";

328 
ps
->
İtiÚ
[
ESCL_OPTION_GROUP_ADVANCED
].
t™Ë
 = 
STR_TITLE_ADVANCED
;

329 
ps
->
İtiÚ
[
ESCL_OPTION_GROUP_ADVANCED
].
ty³
 = 
SANE_TYPE_GROUP
;

330 
ps
->
İtiÚ
[
ESCL_OPTION_GROUP_ADVANCED
].
ÿp
 = 
SANE_CAP_ADVANCED
;

333 
ps
->
İtiÚ
[
ESCL_OPTION_MULTIPICK
].
Çme
 = "multi-pick";

334 
ps
->
İtiÚ
[
ESCL_OPTION_MULTIPICK
].
t™Ë
 = 
SANE_TITLE_MULTIPICK
;

335 
ps
->
İtiÚ
[
ESCL_OPTION_MULTIPICK
].
desc
 = 
SANE_DESC_MULTIPICK
;

336 
ps
->
İtiÚ
[
ESCL_OPTION_MULTIPICK
].
ty³
 = 
SANE_TYPE_INT
;

337 
ps
->
İtiÚ
[
ESCL_OPTION_MULTIPICK
].
un™
 = 
SANE_UNIT_NONE
;

338 
ps
->
İtiÚ
[
ESCL_OPTION_MULTIPICK
].
size
 = (
SANE_IÁ
);

339 
ps
->
İtiÚ
[
ESCL_OPTION_MULTIPICK
].
ÿp
 = 
SANE_CAP_SOFT_SELECT
 | 
SANE_CAP_SOFT_DETECT
 | 
SANE_CAP_ADVANCED
;

340 
ps
->
İtiÚ
[
ESCL_OPTION_MULTIPICK
].
cÚ¡¿št_ty³
 = 
SANE_CONSTRAINT_RANGE
;

341 
ps
->
İtiÚ
[
ESCL_OPTION_MULTIPICK
].
cÚ¡¿št
.
¿nge
 = &ps->
muÉickRªge
;

342 
ps
->
muÉickRªge
.
mš
 = 
MULTIPICK_DISABLE
;

343 
ps
->
muÉickRªge
.
max
 = 
MULTIPICK_ENABLE
;

344 
ps
->
muÉickRªge
.
quªt
 = 0;

348 
ps
->
İtiÚ
[
ESCL_OPTION_COMPRESSION
].
Çme
 = 
STR_NAME_COMPRESSION
;

349 
ps
->
İtiÚ
[
ESCL_OPTION_COMPRESSION
].
t™Ë
 = 
STR_TITLE_COMPRESSION
;

350 
ps
->
İtiÚ
[
ESCL_OPTION_COMPRESSION
].
desc
 = 
STR_DESC_COMPRESSION
;

351 
ps
->
İtiÚ
[
ESCL_OPTION_COMPRESSION
].
ty³
 = 
SANE_TYPE_STRING
;

352 
ps
->
İtiÚ
[
ESCL_OPTION_COMPRESSION
].
un™
 = 
SANE_UNIT_NONE
;

353 
ps
->
İtiÚ
[
ESCL_OPTION_COMPRESSION
].
size
 = 
MAX_STRING_SIZE
;

354 
ps
->
İtiÚ
[
ESCL_OPTION_COMPRESSION
].
ÿp
 = 
SANE_CAP_SOFT_SELECT
 | 
SANE_CAP_SOFT_DETECT
 | 
SANE_CAP_ADVANCED
;

355 
ps
->
İtiÚ
[
ESCL_OPTION_COMPRESSION
].
cÚ¡¿št_ty³
 = 
SANE_CONSTRAINT_STRING_LIST
;

356 
ps
->
İtiÚ
[
ESCL_OPTION_COMPRESSION
].
cÚ¡¿št
.
¡ršg_li¡
 =…s->
com´essiÚLi¡
;

358 
ps
->
İtiÚ
[
ESCL_OPTION_JPEG_QUALITY
].
Çme
 = 
STR_NAME_JPEG_QUALITY
;

359 
ps
->
İtiÚ
[
ESCL_OPTION_JPEG_QUALITY
].
t™Ë
 = 
STR_TITLE_JPEG_QUALITY
;

360 
ps
->
İtiÚ
[
ESCL_OPTION_JPEG_QUALITY
].
desc
 = 
STR_DESC_JPEG_QUALITY
;

361 
ps
->
İtiÚ
[
ESCL_OPTION_JPEG_QUALITY
].
ty³
 = 
SANE_TYPE_INT
;

362 
ps
->
İtiÚ
[
ESCL_OPTION_JPEG_QUALITY
].
un™
 = 
SANE_UNIT_NONE
;

363 
ps
->
İtiÚ
[
ESCL_OPTION_JPEG_QUALITY
].
size
 = (
SANE_IÁ
);

364 
ps
->
İtiÚ
[
ESCL_OPTION_JPEG_QUALITY
].
ÿp
 = 
SANE_CAP_SOFT_SELECT
 | 
SANE_CAP_SOFT_DETECT
 | 
SANE_CAP_ADVANCED
;

365 
ps
->
İtiÚ
[
ESCL_OPTION_JPEG_QUALITY
].
cÚ¡¿št_ty³
 = 
SANE_CONSTRAINT_RANGE
;

366 
ps
->
İtiÚ
[
ESCL_OPTION_JPEG_QUALITY
].
cÚ¡¿št
.
¿nge
 = &ps->
j³gQu®™yRªge
;

367 
ps
->
j³gQu®™yRªge
.
mš
 = 
MIN_JPEG_COMPRESSION_FACTOR
;

368 
ps
->
j³gQu®™yRªge
.
max
 = 
MAX_JPEG_COMPRESSION_FACTOR
;

369 
ps
->
j³gQu®™yRªge
.
quªt
 = 0;

371 
ps
->
İtiÚ
[
ESCL_OPTION_GROUP_GEOMETRY
].
Çme
 = "geometry-group";

372 
ps
->
İtiÚ
[
ESCL_OPTION_GROUP_GEOMETRY
].
t™Ë
 = 
STR_TITLE_GEOMETRY
;

373 
ps
->
İtiÚ
[
ESCL_OPTION_GROUP_GEOMETRY
].
ty³
 = 
SANE_TYPE_GROUP
;

374 
ps
->
İtiÚ
[
ESCL_OPTION_GROUP_GEOMETRY
].
ÿp
 = 
SANE_CAP_ADVANCED
;

376 
ps
->
İtiÚ
[
ESCL_OPTION_TL_X
].
Çme
 = 
SANE_NAME_SCAN_TL_X
;

377 
ps
->
İtiÚ
[
ESCL_OPTION_TL_X
].
t™Ë
 = 
SANE_TITLE_SCAN_TL_X
;

378 
ps
->
İtiÚ
[
ESCL_OPTION_TL_X
].
desc
 = 
SANE_DESC_SCAN_TL_X
;

379 
ps
->
İtiÚ
[
ESCL_OPTION_TL_X
].
ty³
 = 
SANE_TYPE_FIXED
;

380 
ps
->
İtiÚ
[
ESCL_OPTION_TL_X
].
un™
 = 
SANE_UNIT_MM
;

381 
ps
->
İtiÚ
[
ESCL_OPTION_TL_X
].
size
 = (
SANE_IÁ
);

382 
ps
->
İtiÚ
[
ESCL_OPTION_TL_X
].
ÿp
 = 
SANE_CAP_SOFT_SELECT
 | 
SANE_CAP_SOFT_DETECT
;

383 
ps
->
İtiÚ
[
ESCL_OPTION_TL_X
].
cÚ¡¿št_ty³
 = 
SANE_CONSTRAINT_RANGE
;

384 
ps
->
İtiÚ
[
ESCL_OPTION_TL_X
].
cÚ¡¿št
.
¿nge
 = &ps->
xRªge
;

385 
ps
->
xRªge
.
mš
 = 0;

386 
ps
->
xRªge
.
quªt
 = 0;

388 
ps
->
İtiÚ
[
ESCL_OPTION_TL_Y
].
Çme
 = 
SANE_NAME_SCAN_TL_Y
;

389 
ps
->
İtiÚ
[
ESCL_OPTION_TL_Y
].
t™Ë
 = 
SANE_TITLE_SCAN_TL_Y
;

390 
ps
->
İtiÚ
[
ESCL_OPTION_TL_Y
].
desc
 = 
SANE_DESC_SCAN_TL_Y
;

391 
ps
->
İtiÚ
[
ESCL_OPTION_TL_Y
].
ty³
 = 
SANE_TYPE_FIXED
;

392 
ps
->
İtiÚ
[
ESCL_OPTION_TL_Y
].
un™
 = 
SANE_UNIT_MM
;

393 
ps
->
İtiÚ
[
ESCL_OPTION_TL_Y
].
size
 = (
SANE_IÁ
);

394 
ps
->
İtiÚ
[
ESCL_OPTION_TL_Y
].
ÿp
 = 
SANE_CAP_SOFT_SELECT
 | 
SANE_CAP_SOFT_DETECT
;

395 
ps
->
İtiÚ
[
ESCL_OPTION_TL_Y
].
cÚ¡¿št_ty³
 = 
SANE_CONSTRAINT_RANGE
;

396 
ps
->
İtiÚ
[
ESCL_OPTION_TL_Y
].
cÚ¡¿št
.
¿nge
 = &ps->
yRªge
;

397 
ps
->
yRªge
.
mš
 = 0;

398 
ps
->
yRªge
.
quªt
 = 0;

400 
ps
->
İtiÚ
[
ESCL_OPTION_BR_X
].
Çme
 = 
SANE_NAME_SCAN_BR_X
;

401 
ps
->
İtiÚ
[
ESCL_OPTION_BR_X
].
t™Ë
 = 
SANE_TITLE_SCAN_BR_X
;

402 
ps
->
İtiÚ
[
ESCL_OPTION_BR_X
].
desc
 = 
SANE_DESC_SCAN_BR_X
;

403 
ps
->
İtiÚ
[
ESCL_OPTION_BR_X
].
ty³
 = 
SANE_TYPE_FIXED
;

404 
ps
->
İtiÚ
[
ESCL_OPTION_BR_X
].
un™
 = 
SANE_UNIT_MM
;

405 
ps
->
İtiÚ
[
ESCL_OPTION_BR_X
].
size
 = (
SANE_IÁ
);

406 
ps
->
İtiÚ
[
ESCL_OPTION_BR_X
].
ÿp
 = 
SANE_CAP_SOFT_SELECT
 | 
SANE_CAP_SOFT_DETECT
;

407 
ps
->
İtiÚ
[
ESCL_OPTION_BR_X
].
cÚ¡¿št_ty³
 = 
SANE_CONSTRAINT_RANGE
;

408 
ps
->
İtiÚ
[
ESCL_OPTION_BR_X
].
cÚ¡¿št
.
¿nge
 = &ps->
brxRªge
;

409 
ps
->
brxRªge
.
mš
 = 0;

410 
ps
->
brxRªge
.
quªt
 = 0;

412 
ps
->
İtiÚ
[
ESCL_OPTION_BR_Y
].
Çme
 = 
SANE_NAME_SCAN_BR_Y
;

413 
ps
->
İtiÚ
[
ESCL_OPTION_BR_Y
].
t™Ë
 = 
SANE_TITLE_SCAN_BR_Y
;

414 
ps
->
İtiÚ
[
ESCL_OPTION_BR_Y
].
desc
 = 
SANE_DESC_SCAN_BR_Y
;

415 
ps
->
İtiÚ
[
ESCL_OPTION_BR_Y
].
ty³
 = 
SANE_TYPE_FIXED
;

416 
ps
->
İtiÚ
[
ESCL_OPTION_BR_Y
].
un™
 = 
SANE_UNIT_MM
;

417 
ps
->
İtiÚ
[
ESCL_OPTION_BR_Y
].
size
 = (
SANE_IÁ
);

418 
ps
->
İtiÚ
[
ESCL_OPTION_BR_Y
].
ÿp
 = 
SANE_CAP_SOFT_SELECT
 | 
SANE_CAP_SOFT_DETECT
;

419 
ps
->
İtiÚ
[
ESCL_OPTION_BR_Y
].
cÚ¡¿št_ty³
 = 
SANE_CONSTRAINT_RANGE
;

420 
ps
->
İtiÚ
[
ESCL_OPTION_BR_Y
].
cÚ¡¿št
.
¿nge
 = &ps->
bryRªge
;

421 
ps
->
bryRªge
.
mš
 = 0;

422 
ps
->
bryRªge
.
quªt
 = 0;

425 
	}
}

429 
SANE_Stus
 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
	$esş_İ’
(
SANE_SŒšg_CÚ¡
 
deviû
, 
SANE_HªdË
 *
hªdË
)

431 
hpmud_mod–_©Œibu‹s
 
ma
;

432 
¡©
 = 
SANE_STATUS_IO_ERROR
;

434 
	`_DBG
("esş_İ’(è£ssiÚ=%p\n", 
£ssiÚ
);

435 if(
£ssiÚ
)

437  
SANE_STATUS_DEVICE_BUSY
;

439 if((
£ssiÚ
 = 
	`ü—‹_£ssiÚ
()è=ğ
NULL
)

440  
SANE_STATUS_NO_MEM
;

443 
	`¢´štf
(
£ssiÚ
->
uri
, (£ssiÚ->uri)-1, "hp:%s", 
deviû
);

446 
	`hpmud_qu”y_mod–
(
£ssiÚ
->
uri
, &
ma
);

447 
£ssiÚ
->
sÿn_ty³
 = 
ma
.
sÿÁy³
;

449 ià(
	`hpmud_İ’_deviû
(
£ssiÚ
->
uri
, 
ma
.
må_mode
, &£ssiÚ->
dd
è!ğ
HPMUD_R_OK
)

450 
bugout
;

452 ià(
	`bb_lßd
(
£ssiÚ
, 
SCAN_PLUGIN_ESCL
))

453 
bugout
;

454 
	`_DBG
("esş_İ’(èÿÎšg % PASSED\n", 
SCAN_PLUGIN_ESCL
);

455 
	`š™_İtiÚs
(
£ssiÚ
);

457 ià(
£ssiÚ
->
	`bb_İ’
 (session))

458 
bugout
;

461 
	`esş_cÚŒŞ_İtiÚ
(
£ssiÚ
, 
ESCL_OPTION_SCAN_MODE
, 
SANE_ACTION_SET_AUTO
, 
NULL
, NULL);

464 
	`esş_cÚŒŞ_İtiÚ
(
£ssiÚ
, 
ESCL_OPTION_INPUT_SOURCE
, 
SANE_ACTION_SET_AUTO
, 
NULL
, NULL);

467 
	`esş_cÚŒŞ_İtiÚ
(
£ssiÚ
, 
ESCL_OPTION_SCAN_RESOLUTION
, 
SANE_ACTION_SET_AUTO
, 
NULL
, NULL);

470 
	`esş_cÚŒŞ_İtiÚ
(
£ssiÚ
, 
ESCL_OPTION_COMPRESSION
, 
SANE_ACTION_SET_AUTO
, 
NULL
, NULL);

473 
	`esş_cÚŒŞ_İtiÚ
(
£ssiÚ
, 
ESCL_OPTION_JPEG_QUALITY
, 
SANE_ACTION_SET_AUTO
, 
NULL
, NULL);

476 
	`esş_cÚŒŞ_İtiÚ
(
£ssiÚ
, 
ESCL_OPTION_TL_X
, 
SANE_ACTION_SET_AUTO
, 
NULL
, NULL);

477 
	`esş_cÚŒŞ_İtiÚ
(
£ssiÚ
, 
ESCL_OPTION_TL_Y
, 
SANE_ACTION_SET_AUTO
, 
NULL
, NULL);

478 
	`esş_cÚŒŞ_İtiÚ
(
£ssiÚ
, 
ESCL_OPTION_BR_X
, 
SANE_ACTION_SET_AUTO
, 
NULL
, NULL);

479 
	`esş_cÚŒŞ_İtiÚ
(
£ssiÚ
, 
ESCL_OPTION_BR_Y
, 
SANE_ACTION_SET_AUTO
, 
NULL
, NULL);

482 
	`esş_cÚŒŞ_İtiÚ
(
£ssiÚ
, 
ESCL_OPTION_MULTIPICK
, 
SANE_ACTION_SET_AUTO
, 
NULL
, NULL);

485 *
hªdË
 = (
SANE_HªdË
 *)
£ssiÚ
;

487 
¡©
 = 
SANE_STATUS_GOOD
;

489 
bugout
:

490 if(
¡©
 !ğ
SANE_STATUS_GOOD
)

492 
	`bb_uÆßd
(
£ssiÚ
);

493 ià(
£ssiÚ
->
cd
 > 0)

494 
	`hpmud_şo£_chªÃl
(
£ssiÚ
->
dd
, sessiÚ->
cd
);

495 ià(
£ssiÚ
->
dd
 > 0)

496 
	`hpmud_şo£_deviû
(
£ssiÚ
->
dd
);

497 
	`ä“
(
£ssiÚ
);

498 
£ssiÚ
 = 
NULL
;

500  
¡©
;

501 
	}
}

503 cÚ¡ 
SANE_O±iÚ_DesütÜ
 *
	$esş_g‘_İtiÚ_desütÜ
(
SANE_HªdË
 
hªdË
, 
SANE_IÁ
 
İtiÚ
)

505 
esş_£ssiÚ
 *
ps
 = (esş_£ssiÚ *)
hªdË
;

509 ià(
İtiÚ
 < 0 || o±iÚ >ğ
ESCL_OPTION_MAX
)

510  
NULL
;

512  &
ps
->
İtiÚ
[option];

513 
	}
}

515 
SANE_Stus
 
	$esş_cÚŒŞ_İtiÚ
(
SANE_HªdË
 
hªdË
, 
SANE_IÁ
 
İtiÚ
, 
SANE_AùiÚ
 
aùiÚ
, *
v®ue
, SANE_IÁ *
£t_»suÉ
)

517 
esş_£ssiÚ
 *
ps
 = (esş_£ssiÚ *)
hªdË
;

518 
SANE_IÁ
 *
št_v®ue
 = 
v®ue
, 
m£t_»suÉ
=0;

519 
i
, 
¡©
=
SANE_STATUS_INVAL
;

520 
found
 = 0;

523 
İtiÚ
)

525 
ESCL_OPTION_COUNT
:

526 ià(
aùiÚ
 =ğ
SANE_ACTION_GET_VALUE
)

528 *
št_v®ue
 = 
ESCL_OPTION_MAX
;

529 
¡©
 = 
SANE_STATUS_GOOD
;

532 
ESCL_OPTION_SCAN_MODE
:

533 if(
aùiÚ
 =ğ
SANE_ACTION_GET_VALUE
)

535 
i
=0; 
ps
->
sÿnModeLi¡
[i]; i++)

537 if(
ps
->
cu¼’tSÿnMode
 =ğps->
sÿnModeM­
[
i
])

539 
	`¡rıy
(
v®ue
, 
ps
->
sÿnModeLi¡
[
i
]);

540 
¡©
 = 
SANE_STATUS_GOOD
;

545 ià(
aùiÚ
 =ğ
SANE_ACTION_SET_VALUE
)

547 
i
=0; 
ps
->
sÿnModeLi¡
[i]; i++)

549 ià(
	`¡rÿ£cmp
(
ps
->
sÿnModeLi¡
[
i
], 
v®ue
) == 0)

551 
ps
->
cu¼’tSÿnMode
 =…s->
sÿnModeM­
[
i
];

552 
	`£t_sÿn_mode_side_efãùs
(
ps
,…s->
cu¼’tSÿnMode
);

553 
m£t_»suÉ
 |ğ
SANE_INFO_RELOAD_PARAMS
 | 
SANE_INFO_RELOAD_OPTIONS
;

554 
¡©
 = 
SANE_STATUS_GOOD
;

561 
ps
->
cu¼’tSÿnMode
 = 
CE_COLOR8
;

562 
	`£t_sÿn_mode_side_efãùs
(
ps
,…s->
cu¼’tSÿnMode
);

563 
¡©
 = 
SANE_STATUS_GOOD
;

566 
ESCL_OPTION_INPUT_SOURCE
:

567 ià(
aùiÚ
 =ğ
SANE_ACTION_GET_VALUE
)

569 
i
=0; 
ps
->
šputSourûLi¡
[i]; i++)

571 ià(
ps
->
cu¼’tIÅutSourû
 =ğps->
šputSourûM­
[
i
])

573 
	`¡rıy
(
v®ue
, 
ps
->
šputSourûLi¡
[
i
]);

574 
¡©
 = 
SANE_STATUS_GOOD
;

579 ià(
aùiÚ
 =ğ
SANE_ACTION_SET_VALUE
)

581 
i
=0; 
ps
->
šputSourûLi¡
[i]; i++)

583 ià(
	`¡rÿ£cmp
(
ps
->
šputSourûLi¡
[
i
], 
v®ue
) == 0)

585 
ps
->
cu¼’tIÅutSourû
 =…s->
šputSourûM­
[
i
];

586 
	`£t_šput_sourû_side_efãùs
(
ps
,…s->
cu¼’tIÅutSourû
);

587 if(
ps
->
cu¼’tIÅutSourû
 =ğ
IS_PLATEN
)

589 
i
 = 
£ssiÚ
->
¶©’_»sŞutiÚLi¡
[0] + 1;

590 
i
--)

592 
£ssiÚ
->
»sŞutiÚLi¡
[
i
] = sessiÚ->
¶©’_»sŞutiÚLi¡
[i];

593 if(
£ssiÚ
->
»sŞutiÚLi¡
[
i
] =ğ
ps
->
cu¼’tResŞutiÚ
)

594 
found
 = 1;

597 if(
ps
->
cu¼’tIÅutSourû
 =ğ
IS_ADF
)

599 
i
 = 
£ssiÚ
->
adf_»sŞutiÚLi¡
[0] + 1;

600 
i
--)

602 
£ssiÚ
->
»sŞutiÚLi¡
[
i
] = sessiÚ->
adf_»sŞutiÚLi¡
[i];

603 if(
£ssiÚ
->
»sŞutiÚLi¡
[
i
] =ğ
ps
->
cu¼’tResŞutiÚ
)

604 
found
 = 1;

607 if(
ps
->
cu¼’tIÅutSourû
 =ğ
IS_ADF_DUPLEX
)

609 
i
 = 
£ssiÚ
->
du¶ex_»sŞutiÚLi¡
[0] + 1;

610 
i
--)

612 
£ssiÚ
->
»sŞutiÚLi¡
[
i
] = sessiÚ->
du¶ex_»sŞutiÚLi¡
[i];

613 if(
£ssiÚ
->
»sŞutiÚLi¡
[
i
] =ğ
ps
->
cu¼’tResŞutiÚ
)

614 
found
 = 1;

617 if(
ps
->
cu¼’tIÅutSourû
 =ğ
IS_CAMERA
)

619 
i
 = 
£ssiÚ
->
ÿm”a_»sŞutiÚLi¡
[0] + 1;

620 
i
--è
£ssiÚ
->
»sŞutiÚLi¡
[i] = sessiÚ->
ÿm”a_»sŞutiÚLi¡
[i];

623 if(
found
 == 0)

625 
	`_DBG
("ResŞutiÚ (%dèi nÙ suµÜ‹d iÀšpuˆsourû (%d).\n", 
ps
->
cu¼’tResŞutiÚ
,…s->
cu¼’tIÅutSourû
);

626 
ps
->
cu¼’tResŞutiÚ
 = 
£ssiÚ
->
»sŞutiÚLi¡
[1];

629 
m£t_»suÉ
 |ğ
SANE_INFO_RELOAD_PARAMS
 | 
SANE_INFO_RELOAD_OPTIONS
;

630 
¡©
 = 
SANE_STATUS_GOOD
;

637 
ps
->
cu¼’tIÅutSourû
 =…s->
šputSourûM­
[0];

638 
	`£t_šput_sourû_side_efãùs
(
ps
,…s->
cu¼’tIÅutSourû
);

639 
m£t_»suÉ
 |ğ
SANE_INFO_RELOAD_PARAMS
 | 
SANE_INFO_RELOAD_OPTIONS
;

640 
¡©
 = 
SANE_STATUS_GOOD
;

643 
ESCL_OPTION_SCAN_RESOLUTION
:

644 ià(
aùiÚ
 =ğ
SANE_ACTION_GET_VALUE
)

646 *
št_v®ue
 = 
ps
->
cu¼’tResŞutiÚ
;

647 
¡©
 = 
SANE_STATUS_GOOD
;

649 ià(
aùiÚ
 =ğ
SANE_ACTION_SET_VALUE
)

651 
i
=1; i <ğ
ps
->
»sŞutiÚLi¡
[0]; i++)

653 ià(
ps
->
»sŞutiÚLi¡
[
i
] =ğ*
št_v®ue
)

655 
ps
->
cu¼’tResŞutiÚ
 = *
št_v®ue
;

656 if(
ps
->
cu¼’tResŞutiÚ
 =ğ4800è
	`S’dSÿnEv’t
Õs->
uri
, 
EVENT_SIZE_WARNING
);

657 
m£t_»suÉ
 |ğ
SANE_INFO_RELOAD_PARAMS
;

658 
¡©
 = 
SANE_STATUS_GOOD
;

665 
ps
->
cu¼’tResŞutiÚ
 = 75;

666 
¡©
 = 
SANE_STATUS_GOOD
;

669 
ESCL_OPTION_COMPRESSION
:

670 ià(
aùiÚ
 =ğ
SANE_ACTION_GET_VALUE
)

672 
i
=0; 
ps
->
com´essiÚLi¡
[i]; i++)

674 ià(
ps
->
cu¼’tCom´essiÚ
 =ğps->
com´essiÚM­
[
i
])

676 
	`¡rıy
(
v®ue
, 
ps
->
com´essiÚLi¡
[
i
]);

677 
¡©
 = 
SANE_STATUS_GOOD
;

682 ià(
aùiÚ
 =ğ
SANE_ACTION_SET_VALUE
)

684 
i
=0; 
ps
->
com´essiÚLi¡
[i]; i++)

686 ià(
	`¡rÿ£cmp
(
ps
->
com´essiÚLi¡
[
i
], 
v®ue
) == 0)

688 
ps
->
cu¼’tCom´essiÚ
 =…s->
com´essiÚM­
[
i
];

689 
¡©
 = 
SANE_STATUS_GOOD
;

696 
ps
->
cu¼’tCom´essiÚ
 = 
SF_JPEG
;

697 
¡©
 = 
SANE_STATUS_GOOD
;

700 
ESCL_OPTION_JPEG_QUALITY
:

701 ià(
aùiÚ
 =ğ
SANE_ACTION_GET_VALUE
)

703 *
št_v®ue
 = 
ps
->
cu¼’tJ³gQu®™y
;

704 
¡©
 = 
SANE_STATUS_GOOD
;

706 ià(
aùiÚ
 =ğ
SANE_ACTION_SET_VALUE
)

708 ià(*
št_v®ue
 >ğ
MIN_JPEG_COMPRESSION_FACTOR
 && *št_v®u<ğ
MAX_JPEG_COMPRESSION_FACTOR
)

710 
ps
->
cu¼’tJ³gQu®™y
 = *
št_v®ue
;

711 
¡©
 = 
SANE_STATUS_GOOD
;

717 
ps
->
cu¼’tJ³gQu®™y
 = 
SAFER_JPEG_COMPRESSION_FACTOR
;

718 
¡©
 = 
SANE_STATUS_GOOD
;

721 
ESCL_OPTION_TL_X
:

722 ià(
aùiÚ
 =ğ
SANE_ACTION_GET_VALUE
)

724 *
št_v®ue
 = 
ps
->
cu¼’tTlx
;

725 
¡©
 = 
SANE_STATUS_GOOD
;

727 ià(
aùiÚ
 =ğ
SANE_ACTION_SET_VALUE
)

729 ià(*
št_v®ue
 >ğ
ps
->
xRªge
.
mš
 && *št_v®u<ğps->xRªge.
max
)

731 
ps
->
cu¼’tTlx
 = *
št_v®ue
;

732 
m£t_»suÉ
 |ğ
SANE_INFO_RELOAD_PARAMS
;

733 
¡©
 = 
SANE_STATUS_GOOD
;

739 
ps
->
cu¼’tTlx
 =…s->
xRªge
.
mš
;

740 
¡©
 = 
SANE_STATUS_GOOD
;

743 
ESCL_OPTION_TL_Y
:

744 ià(
aùiÚ
 =ğ
SANE_ACTION_GET_VALUE
)

746 *
št_v®ue
 = 
ps
->
cu¼’tTly
;

747 
¡©
 = 
SANE_STATUS_GOOD
;

749 ià(
aùiÚ
 =ğ
SANE_ACTION_SET_VALUE
)

751 ià(*
št_v®ue
 >ğ
ps
->
yRªge
.
mš
 && *št_v®u<ğps->yRªge.
max
)

754 
ps
->
cu¼’tTly
 = *
št_v®ue
;

755 
m£t_»suÉ
 |ğ
SANE_INFO_RELOAD_PARAMS
;

756 
¡©
 = 
SANE_STATUS_GOOD
;

762 
ps
->
cu¼’tTly
 =…s->
yRªge
.
mš
;

763 
¡©
 = 
SANE_STATUS_GOOD
;

766 
ESCL_OPTION_BR_X
:

767 ià(
aùiÚ
 =ğ
SANE_ACTION_GET_VALUE
)

769 *
št_v®ue
 = 
ps
->
cu¼’tBrx
;

770 
¡©
 = 
SANE_STATUS_GOOD
;

772 ià(
aùiÚ
 =ğ
SANE_ACTION_SET_VALUE
)

774 ià(*
št_v®ue
 >ğ
ps
->
brxRªge
.
mš
 && *št_v®u<ğps->brxRªge.
max
)

776 
ps
->
cu¼’tBrx
 = *
št_v®ue
;

777 
m£t_»suÉ
 |ğ
SANE_INFO_RELOAD_PARAMS
;

778 
¡©
 = 
SANE_STATUS_GOOD
;

784 
ps
->
cu¼’tBrx
 =…s->
brxRªge
.
max
;

785 
¡©
 = 
SANE_STATUS_GOOD
;

788 
ESCL_OPTION_BR_Y
:

789 ià(
aùiÚ
 =ğ
SANE_ACTION_GET_VALUE
)

791 *
št_v®ue
 = 
ps
->
cu¼’tBry
;

792 
¡©
 = 
SANE_STATUS_GOOD
;

794 ià(
aùiÚ
 =ğ
SANE_ACTION_SET_VALUE
)

796 ià(*
št_v®ue
 >ğ
ps
->
bryRªge
.
mš
 && *št_v®u<ğps->bryRªge.
max
)

798 
ps
->
cu¼’tBry
 = *
št_v®ue
;

799 
m£t_»suÉ
 |ğ
SANE_INFO_RELOAD_PARAMS
;

800 
¡©
 = 
SANE_STATUS_GOOD
;

806 
ps
->
cu¼’tBry
 =…s->
bryRªge
.
max
;

807 
¡©
 = 
SANE_STATUS_GOOD
;

811 
ESCL_OPTION_MULTIPICK
:

812 ià(
aùiÚ
 =ğ
SANE_ACTION_GET_VALUE
)

814 *
št_v®ue
 = 
ps
->
cu¼’tmuÉick
;

815 
¡©
 = 
SANE_STATUS_GOOD
;

817 ià(
aùiÚ
 =ğ
SANE_ACTION_SET_VALUE
)

819 ià(*
št_v®ue
 >ğ
MULTIPICK_DISABLE
 && *št_v®u<ğ
MULTIPICK_ENABLE
)

821 
ps
->
cu¼’tmuÉick
 = *
št_v®ue
;

822 
¡©
 = 
SANE_STATUS_GOOD
;

828 
ps
->
cu¼’tmuÉick
 = 
MULTIPICK_DISABLE
;

829 
¡©
 = 
SANE_STATUS_GOOD
;

836 ià(
£t_»suÉ
)

837 *
£t_»suÉ
 = 
m£t_»suÉ
;

839 ià(
¡©
 !ğ
SANE_STATUS_GOOD
)

841 
	`BUG
("cÚŒŞ_İtiÚ faed: o±iÚ=% aùiÚ=%s\n", 
ps
->
İtiÚ
[İtiÚ].
Çme
, 
aùiÚ
==
SANE_ACTION_GET_VALUE
 ? "g‘" :‡ùiÚ==
SANE_ACTION_SET_VALUE
 ? "set" : "auto");

844  
¡©
;

845 
	}
}

847 
SANE_Stus
 
	$esş_g‘_·¿m‘”s
(
SANE_HªdË
 
hªdË
, 
SANE_P¬am‘”s
 *
·¿ms
)

849 
esş_£ssiÚ
 *
ps
 = (esş_£ssiÚ *)
hªdË
;

851 
	`esş_£t_ex‹Ás
(
ps
);

854 
ps
->
	`bb_g‘_·¿m‘”s
Õs, 
·¿ms
,…s->
_hªdË
 ? 
SPO_STARTED
 : 
SPO_BEST_GUESS
);

859  
SANE_STATUS_GOOD
;

860 
	}
}

862 
	$esş_£nd_ev’t
(
esş_£ssiÚ
 *
ps
, 
SANE_Stus
 
¡©
)

864 
ev’t
 = 0;

865 
¡©
)

867 
SANE_STATUS_NO_DOCS
:

868 
ev’t
 = 
EVENT_SCAN_ADF_NO_DOCS
;

870 
SANE_STATUS_MULTIPICK
:

871 
ev’t
 = 
EVENT_SCAN_ADF_MISPICK
;

873 
SANE_STATUS_JAMMED
:

874 
ev’t
 = 
EVENT_SCAN_ADF_JAM
;

876 
SANE_STATUS_DEVICE_BUSY
:

877 
ev’t
 = 
EVENT_SCAN_BUSY
;

879 
SANE_STATUS_UNSUPPORTED
:

880 
ev’t
 = 
EVENT_SCAN_ADF_MISPICK
;

882 
SANE_STATUS_CANCELLED
:

883 
ev’t
 = 
EVENT_SCAN_CANCEL
;

885 
SANE_STATUS_ACCESS_DENIED
:

886 
SANE_STATUS_INVAL
:

887 
SANE_STATUS_NO_MEM
:

889 
SANE_STATUS_GOOD
:

894 
	`S’dSÿnEv’t
 (
ps
->
uri
, 
ev’t
);

895 
	`_DBG
("esş_£nd_ev’ˆev’t[%d] uri[%s]\n", 
ev’t
, 
ps
->
uri
);

896 
	}
}

898 
SANE_Stus
 
	$esş_¡¬t
(
SANE_HªdË
 
hªdË
)

900 
esş_£ssiÚ
 *
ps
 = (esş_£ssiÚ *)
hªdË
;

901 
SANE_P¬am‘”s
 
µ
;

902 
IP_IMAGE_TRAITS
 
Œa™s
;

903 
IP_XFORM_SPEC
 
xfÜms
[
IP_MAX_XFORMS
], *
pXfÜm
=xforms;

904 
SANE_Stus
 
¡©
 = 
SANE_STATUS_IO_ERROR
;

905 
»t
;

907 
	`_DBG
("esş_¡¬ˆ’Œy. uri=[%s] IÅutSourû=[%d]\n", 
ps
->
uri
,…s->
cu¼’tIÅutSourû
);

909 
ps
 -> 
u£r_ÿnûl
 = 0;

910 
ps
 -> 
út
 = 0;

911 
ps
 -> 
šdex
 = 0;

913 
	`£t_šput_sourû_side_efãùs
(
ps
,…s->
cu¼’tIÅutSourû
);

914 ià(
	`esş_£t_ex‹Ás
(
ps
))

916 
¡©
 = 
SANE_STATUS_INVAL
;

917 
bugout
;

920 
¡©
 = 
ps
->
	`bb_check_sÿÂ”_to_cÚtšue
(ps);

922 
	`esş_£nd_ev’t
(
ps
, 
¡©
);

923 if(
¡©
 !ğ
SANE_STATUS_GOOD
)  stat;

926 
¡©
 = 
ps
->
	`bb_¡¬t_sÿn
(ps);

928 ià(
¡©
 !ğ
SANE_STATUS_GOOD
)  stat;

930 if(
ps
->
u£r_ÿnûl
)

932 
¡©
 = 
SANE_STATUS_GOOD
 ;

933 
bugout
;

936 
	`S’dSÿnEv’t
(
ps
->
uri
, 
EVENT_START_SCAN_JOB
);

937 
	`_DBG
("esş_¡¬t(èEVENT_START_SCAN_JOB uri=[%s]\n", 
ps
->
uri
);

938 
	`mem£t
(
xfÜms
, 0, (xforms));

941 ià(
ps
->
cu¼’tSÿnMode
 =ğ
CE_COLOR8
 ||…s->cu¼’tSÿnMod=ğ
CE_GRAY8
)

943 
ps
->
cu¼’tCom´essiÚ
)

945 
SF_JPEG
:

946 
pXfÜm
->
aXfÜmInfo
[
IP_JPG_DECODE_FROM_DENALI
].
dwÜd
 = 0;

947 
	`ADD_XFORM
(
X_JPG_DECODE
);

948 
pXfÜm
->
aXfÜmInfo
[
IP_CNV_COLOR_SPACE_WHICH_CNV
].
dwÜd
 = 
IP_CNV_YCC_TO_SRGB
;

949 
pXfÜm
->
aXfÜmInfo
[
IP_CNV_COLOR_SPACE_GAMMA
].
dwÜd
 = 0x00010000;

950 
	`ADD_XFORM
(
X_CNV_COLOR_SPACE
);

952 
SF_RAW
:

959 
ps
->
cu¼’tCom´essiÚ
)

961 
SF_JPEG
:

962 
pXfÜm
->
aXfÜmInfo
[
IP_JPG_DECODE_FROM_DENALI
].
dwÜd
 = 0;

963 
	`ADD_XFORM
(
X_JPG_DECODE
);

964 
pXfÜm
->
aXfÜmInfo
[
IP_GRAY_2_BI_THRESHOLD
].
dwÜd
 = 127;

965 
	`ADD_XFORM
(
X_GRAY_2_BI
);

967 
SF_RAW
:

968 
pXfÜm
->
aXfÜmInfo
[
IP_GRAY_2_BI_THRESHOLD
].
dwÜd
 = 127;

969 
	`ADD_XFORM
(
X_GRAY_2_BI
);

976 
pXfÜm
->
aXfÜmInfo
[
IP_CROP_LEFT
].
dwÜd
 = 0;

977 
pXfÜm
->
aXfÜmInfo
[
IP_CROP_RIGHT
].
dwÜd
 = 0;

978 
pXfÜm
->
aXfÜmInfo
[
IP_CROP_TOP
].
dwÜd
 = 0;

979 
pXfÜm
->
aXfÜmInfo
[
IP_CROP_MAXOUTROWS
].
dwÜd
 = 0;

980 
	`ADD_XFORM
(
X_CROP
);

983 
pXfÜm
->
aXfÜmInfo
[
IP_PAD_LEFT
].
dwÜd
 = 0;

984 
pXfÜm
->
aXfÜmInfo
[
IP_PAD_RIGHT
].
dwÜd
 = 0;

985 
pXfÜm
->
aXfÜmInfo
[
IP_PAD_TOP
].
dwÜd
 = 0;

986 
pXfÜm
->
aXfÜmInfo
[
IP_PAD_BOTTOM
].
dwÜd
 = 0;

987 
pXfÜm
->
aXfÜmInfo
[
IP_PAD_VALUE
].
dwÜd
 = 
ps
->
cu¼’tSÿnMode
 =ğ
CE_K1
 ? 0 : -1;

988 
pXfÜm
->
aXfÜmInfo
[
IP_PAD_MIN_HEIGHT
].
dwÜd
 = 0;

989 
	`ADD_XFORM
(
X_PAD
);

992 ià((
»t
 = 
	`O³n
(
pXfÜm
-
xfÜms
, xfÜms, 0, &
ps
->
_hªdË
)è!ğ
IP_DONE
)

994 
¡©
 = 
SANE_STATUS_INVAL
;

995 
bugout
;

999 ià(
ps
->
cu¼’tCom´essiÚ
 =ğ
SF_RAW
)

1000 
ps
->
	`bb_g‘_·¿m‘”s
Õs, &
µ
, 
SPO_STARTED_JR
);

1002 
ps
->
	`bb_g‘_·¿m‘”s
Õs, &
µ
, 
SPO_BEST_GUESS
);

1003 
Œa™s
.
iPix–sP”Row
 = 
µ
.
pix–s_³r_lše
;

1004 
ps
->
cu¼’tSÿnMode
)

1006 
CE_K1
:

1007 
Œa™s
.
iB™sP”Pix–
 = 1;

1009 
CE_GRAY8
:

1010 
Œa™s
.
iB™sP”Pix–
 = 8;

1012 
CE_COLOR8
:

1014 
Œa™s
.
iB™sP”Pix–
 = 24;

1017 
Œa™s
.
lHÜizDPI
 = 
ps
->
cu¼’tResŞutiÚ
 << 16;

1018 
Œa™s
.
lV”tDPI
 = 
ps
->
cu¼’tResŞutiÚ
 << 16;

1019 
Œa™s
.
lNumRows
 = 
µ
.
lšes
;

1020 
Œa™s
.
iNumPages
 = 1;

1021 
Œa™s
.
iPageNum
 = 1;

1022 
Œa™s
.
iCompÚ’tsP”Pix–
 = (Ñ¿™s.
iB™sP”Pix–
 % 3) ? 1 : 3);

1023 
	`S‘DeçuÉIÅutT¿™s
(
ps
->
_hªdË
, &
Œa™s
);

1024 
	`_DBG
("esş_¡¬t(èS‘DeçuÉIÅutT¿™ lšes=%ld…ix–s_³r_lše=%d\n", 
Œa™s
.
lNumRows
,¿™s.
iPix–sP”Row
);

1027 ià(
ps
->
cu¼’tCom´essiÚ
 =ğ
SF_JPEG
)

1030 
	`ResuÉMask
(
ps
->
_hªdË
, 
IP_PARSED_HEADER
);

1031 
	`_DBG
("escl_start() before get_ip_data\n");

1035 
»t
 = 
	`g‘__d©a
(
ps
, 
NULL
, 0, NULL);

1036 ià(
»t
 & (
IP_INPUT_ERROR
 | 
IP_FATAL_ERROR
))

1038 
	`_DBG
("escl_start() Inside whileSANE_STATUS_IO_ERROR****\n");

1039 
¡©
 = 
SANE_STATUS_IO_ERROR
;

1040 
bugout
;

1042 ià(
»t
 & 
IP_DONE
)

1044 
	`_DBG
("escl_start() Inside while SANE_STATUS_EOF****\n");

1045 
¡©
 = 
SANE_STATUS_EOF
;

1046 
bugout
;

1049 ià(
»t
 & 
IP_PARSED_HEADER
)

1051 
	`_DBG
("escl_start() Inside while IP_PARSED_HEADER****\n");

1052 
	`G‘ImageT¿™s
(
ps
->
_hªdË
, 
NULL
, &ps->
image_Œa™s
);

1053 
	`_DBG
("esş_¡¬t(èG‘ImageT¿™ lšes=%ld…ix–s_³r_lše=%d\n", 
ps
->
image_Œa™s
.
lNumRows
,…s->image_Œa™s.
iPix–sP”Row
);

1054 
	`ResuÉMask
(
ps
->
_hªdË
, 0);

1061 
	`G‘ImageT¿™s
(
ps
->
_hªdË
, 
NULL
, &ps->
image_Œa™s
);

1062 
	`_DBG
("esş_¡¬t(èG‘ImageT¿™ lšes=%ld…ix–s_³r_lše=%d\n", 
ps
->
image_Œa™s
.
lNumRows
,…s->image_Œa™s.
iPix–sP”Row
);

1065 
¡©
 = 
SANE_STATUS_GOOD
;

1067 
bugout
:

1068 
	`_DBG
("esş_¡¬t(è»tuºšg st=%d****\n", 
¡©
);

1069 ià(
¡©
 !ğ
SANE_STATUS_GOOD
)

1071 ià(
ps
->
_hªdË
)

1073 
	`Clo£
(
ps
->
_hªdË
);

1074 
ps
->
_hªdË
 = 0;

1076 
ps
->
	`bb_’d_sÿn
Õs, 
¡©
 =ğ
SANE_STATUS_IO_ERROR
 ? 1: 0);

1078  
¡©
;

1079 
	}
}

1081 
SANE_Stus
 
	$esş_»ad
(
SANE_HªdË
 
hªdË
, 
SANE_By‹
 *
d©a
, 
SANE_IÁ
 
maxL’gth
, SANE_IÁ *
Ëngth
)

1083 
esş_£ssiÚ
 *
ps
 = (esş_£ssiÚ *)
hªdË
;

1084 
»t
, 
¡©
=
SANE_STATUS_IO_ERROR
;

1086 
	`_DBG
("esş_»adƒÁry (ps->u£r_ÿnûÈğ%d)....\n", 
ps
->
u£r_ÿnûl
);

1088 if(
ps
->
u£r_ÿnûl
)

1090 
	`_DBG
("esş_»ad(èEVENT_SCAN_CANCEL****uri=[%s]\n", 
ps
->
uri
);

1091 
	`S’dSÿnEv’t
(
ps
->
uri
, 
EVENT_SCAN_CANCEL
);

1092  
SANE_STATUS_CANCELLED
;

1095 
»t
 = 
	`g‘__d©a
(
ps
, 
d©a
, 
maxL’gth
, 
Ëngth
);

1097 if(
»t
 & (
IP_INPUT_ERROR
 | 
IP_FATAL_ERROR
))

1099 
bugout
;

1102 if(
»t
 =ğ
IP_DONE
)

1104 
¡©
 = 
SANE_STATUS_EOF
;

1105 
	`S’dSÿnEv’t
(
ps
->
uri
, 
EVENT_END_SCAN_JOB
);

1106 
	`_DBG
("esş_»ad(èEVENT_END_SCAN_JOB uri=%s\n", 
ps
->
uri
);

1108 
¡©
ğ
SANE_STATUS_GOOD
;

1110 
bugout
:

1111 
	`_DBG
("esş_»ad(è»tuºšg st=[%d]\n", 
¡©
);

1112 ià(
¡©
 !ğ
SANE_STATUS_GOOD
)

1114 ià(
ps
->
_hªdË
)

1117 
	`Clo£
(
ps
->
_hªdË
);

1118 
ps
->
_hªdË
 = 0;

1120 
ps
->
	`bb_’d_·ge
Õs, 
¡©
);

1123 
	`DBG8
("-§Ã_h·io_»ad(èouut=%°by‹s_»ad=%d maxL’gth=%d stus=%d\n", 
d©a
, *
Ëngth
, 
maxL’gth
, 
¡©
);

1125  
¡©
;

1126 
	}
}

1128 
	$esş_ÿnûl
(
SANE_HªdË
 
hªdË
)

1130 
esş_£ssiÚ
 *
ps
 = (esş_£ssiÚ *)
hªdË
;

1132 
	`_DBG
("escl_cancel...\n");

1134 
ps
->
u£r_ÿnûl
 = 1;

1137 ià(
ps
->
_hªdË
)

1139 
	`Clo£
(
ps
->
_hªdË
);

1140 
ps
->
_hªdË
 = 0;

1142 
ps
->
	`bb_’d_sÿn
(ps, 1);

1143 
	}
}

1145 
	$esş_şo£
(
SANE_HªdË
 
hªdË
)

1147 
esş_£ssiÚ
 *
ps
 = (esş_£ssiÚ *)
hªdË
;

1149 ià(
ps
 =ğ
NULL
 ||… !ğ
£ssiÚ
)

1151 
	`BUG
("invalid sane_close\n");

1155 
ps
->
	`bb_şo£
(ps);

1156 
	`bb_uÆßd
(
ps
);

1158 ià(
ps
->
dd
 > 0)

1159 
	`hpmud_şo£_deviû
(
ps
->
dd
);

1161 
	`ä“
(
ps
);

1162 
£ssiÚ
 = 
NULL
;

1163 
	}
}

	@scan/sane/escl.h

28 #iâdeà
_ESCL_H


29 
	#_ESCL_H


	)

31 
	~"§Ã.h
"

32 
	~"hp.h
"

33 
	~"hpmud.h
"

35 
SANE_Stus
 
esş_İ’
(
SANE_SŒšg_CÚ¡
 
deviû
, 
SANE_HªdË
 *
hªdË
);

36 
esş_şo£
(
SANE_HªdË
 
hªdË
);

37 cÚ¡ 
SANE_O±iÚ_DesütÜ
 * 
esş_g‘_İtiÚ_desütÜ
(
SANE_HªdË
 
hªdË
, 
SANE_IÁ
 
İtiÚ
);

38 
SANE_Stus
 
esş_cÚŒŞ_İtiÚ
(
SANE_HªdË
 
hªdË
, 
SANE_IÁ
 
İtiÚ
, 
SANE_AùiÚ
 
aùiÚ
, *
v®ue
, SANE_IÁ *
šfo
);

39 
SANE_Stus
 
esş_g‘_·¿m‘”s
(
SANE_HªdË
 
hªdË
, 
SANE_P¬am‘”s
 *
·¿ms
);

40 
SANE_Stus
 
esş_¡¬t
(
SANE_HªdË
 
hªdË
);

41 
SANE_Stus
 
esş_»ad
(
SANE_HªdË
 
hªdË
, 
SANE_By‹
 *
d©a
, 
SANE_IÁ
 
maxL’gth
, SANE_IÁ *
Ëngth
);

42 
esş_ÿnûl
(
SANE_HªdË
 
hªdË
);

	@scan/sane/escli.h

28 #iâdeà
_ESCLI_H


29 
	#_ESCLI_H


	)

31 
	~"§Ã.h
"

32 
	~"hp.h
"

33 
	~"hpmud.h
"

35 
	#ESCL_CONTRAST_MIN
 -127

	)

36 
	#ESCL_CONTRAST_MAX
 127

	)

37 
	#ESCL_CONTRAST_DEFAULT
 0

	)

38 
	#MM_PER_INCH
 25.4

	)

41 
	#_STRINGIZE
(
x
è#x

	)

42 
	#STRINGIZE
(
x
è
	`_STRINGIZE
(x)

	)

44 
	#ESCL_DEBUG


45 
	#_BUG
(
¬gs
...è
	`sy¦og
(
LOG_ERR
, 
__FILE__
 " " 
	`STRINGIZE
(
__LINE__
è": "‡rgs)

	)

46 #ifdeà
ESCL_DEBUG


47 
	#_DBG
(
¬gs
...è
	`sy¦og
(
LOG_INFO
, 
__FILE__
 " " 
	`STRINGIZE
(
__LINE__
è": "‡rgs)

	)

49 
	#_DBG
(
¬gs
...)

	)

52 
	eESCL_OPTION_NUMBER


54 
	mESCL_OPTION_COUNT
 = 0,

55 
	mESCL_OPTION_GROUP_SCAN_MODE
,

56 
	mESCL_OPTION_SCAN_MODE
,

57 
	mESCL_OPTION_SCAN_RESOLUTION
,

58 
	mESCL_OPTION_INPUT_SOURCE
,

59 
	mESCL_OPTION_GROUP_ADVANCED
,

60 
	mESCL_OPTION_CONTRAST
,

61 
	mESCL_OPTION_COMPRESSION
,

62 
	mESCL_OPTION_JPEG_QUALITY
,

63 
	mESCL_OPTION_GROUP_GEOMETRY
,

64 
	mESCL_OPTION_TL_X
,

65 
	mESCL_OPTION_TL_Y
,

66 
	mESCL_OPTION_BR_X
,

67 
	mESCL_OPTION_BR_Y
,

68 
	mESCL_OPTION_MULTIPICK
,

69 
	mESCL_OPTION_PAGES_TO_SCAN
,

70 
	mESCL_OPTION_MAX
,

73 
	#MAX_LIST_SIZE
 32

	)

74 
	#MAX_STRING_SIZE
 32

	)

76 
	eSCAN_FORMAT


78 
	mSF_RAW
 = 1,

79 
	mSF_JPEG
,

80 
	mSF_MAX


83 
	eINPUT_SOURCE


85 
	mIS_PLATEN
 = 1,

86 
	mIS_ADF
,

87 
	mIS_ADF_DUPLEX
,

88 
	mIS_CAMERA
,

89 
	mIS_MAX


92 
	eCOLOR_ENTRY


94 
	mCE_K1
 = 1,

95 
	mCE_GRAY8
,

96 
	mCE_COLOR8
,

97 
	mCE_MAX


100 
	eSCAN_PARAM_OPTION


102 
	mSPO_BEST_GUESS
 = 0,

103 
	mSPO_STARTED
 = 1,

104 
	mSPO_STARTED_JR
 = 2,

107 
	eESCL_RESULT


109 
	mESCL_R_OK
 = 0,

110 
	mESCL_R_IO_ERROR
,

111 
	mESCL_R_EOF
,

112 
	mESCL_R_IO_TIMEOUT
,

113 
	mESCL_R_MALLOC_ERROR
,

114 
	mESCL_R_INVALID_BUF_SIZE
,

117 
	sesş_£ssiÚ


119 *
	mg
;

120 
	muri
[
HPMUD_LINE_SIZE
];

121 
HPMUD_DEVICE
 
	mdd
;

122 
HPMUD_CHANNEL
 
	mcd
;

123 
	mmod–
[
HPMUD_LINE_SIZE
];

124 
	mu¾
[256];

125 
	m
[32];

126 
	msÿn_ty³
;

127 
	mu£r_ÿnûl
;

129 
IP_IMAGE_TRAITS
 
	mimage_Œa™s
;

131 
SANE_O±iÚ_DesütÜ
 
	mİtiÚ
[
ESCL_OPTION_MAX
];

133 
SANE_SŒšg_CÚ¡
 
	mšputSourûLi¡
[
IS_MAX
];

134 
INPUT_SOURCE
 
	mšputSourûM­
[
IS_MAX
];

135 
INPUT_SOURCE
 
	mcu¼’tIÅutSourû
;

137 
SANE_IÁ
 
	m»sŞutiÚLi¡
[
MAX_LIST_SIZE
];

138 
SANE_IÁ
 
	mcu¼’tResŞutiÚ
;

140 
SANE_SŒšg_CÚ¡
 
	msÿnModeLi¡
[
CE_MAX
];

141 
COLOR_ENTRY
 
	msÿnModeM­
[
CE_MAX
];

142 
COLOR_ENTRY
 
	mcu¼’tSÿnMode
;

144 
SANE_SŒšg_CÚ¡
 
	mcom´essiÚLi¡
[
SF_MAX
];

145 
SCAN_FORMAT
 
	mcom´essiÚM­
[
SF_MAX
];

146 
SCAN_FORMAT
 
	mcu¼’tCom´essiÚ
;

148 
SANE_Rªge
 
	mj³gQu®™yRªge
;

149 
SANE_IÁ
 
	mcu¼’tJ³gQu®™y
;

152 
SANE_Rªge
 
	mmuÉickRªge
;

153 
SANE_IÁ
 
	mcu¼’tmuÉick
;

155 
SANE_Rªge
 
	mxRªge
, 
	myRªge
, 
	mbrxRªge
, 
	mbryRªge
;

156 
SANE_Fixed
 
	mcu¼’tTlx
, 
	mcu¼’tTly
, 
	mcu¼’tBrx
, 
	mcu¼’tBry
;

157 
SANE_Fixed
 
	mefãùiveTlx
, 
	mefãùiveTly
, 
	mefãùiveBrx
, 
	mefãùiveBry
;

158 
SANE_Fixed
 
	mmš_width
, 
	mmš_height
;

160 
SANE_IÁ
 
	m¶©’_»sŞutiÚLi¡
[
MAX_LIST_SIZE
];

161 
SANE_Fixed
 
	m¶©’_mš_width
, 
	m¶©’_mš_height
;

162 
SANE_Rªge
 
	m¶©’_xRªge
, 
	m¶©’_yRªge
, 
	m¶©’_brxRªge
, 
	m¶©’_bryRªge
;

164 
SANE_IÁ
 
	madf_»sŞutiÚLi¡
[
MAX_LIST_SIZE
];

165 
SANE_Fixed
 
	madf_mš_width
, 
	madf_mš_height
;

166 
SANE_Rªge
 
	madf_xRªge
, 
	madf_yRªge
, 
	madf_brxRªge
, 
	madf_bryRªge
;

168 
SANE_IÁ
 
	mdu¶ex_»sŞutiÚLi¡
[
MAX_LIST_SIZE
];

169 
SANE_Fixed
 
	mdu¶ex_mš_width
, 
	mdu¶ex_mš_height
;

170 
SANE_Rªge
 
	mdu¶ex_xRªge
, 
	mdu¶ex_yRªge
, 
	mdu¶ex_brxRªge
, 
	mdu¶ex_bryRªge
;

172 
SANE_IÁ
 
	mÿm”a_»sŞutiÚLi¡
[
MAX_LIST_SIZE
];

173 
SANE_Fixed
 
	mÿm”a_mš_width
, 
	mÿm”a_mš_height
;

174 
SANE_Rªge
 
	mÿm”a_xRªge
, 
	mÿm”a_yRªge
, 
	mÿm”a_brxRªge
, 
	mÿm”a_bryRªge
;

176 
IP_HANDLE
 
	m_hªdË
;

178 
	mšdex
;

179 
	mút
;

181 
	mbuf
[4*1000*1000];

183 *
	mbb_£ssiÚ
;

185 
	mjob_id
[64];

186 
	m·ge_id
;

188 *
	mhpmud_hªdË
;

189 *
	mm©h_hªdË
;

190 *
	mbb_hªdË
;

192 (*
	mbb_İ’
)(
esş_£ssiÚ
 *
	mps
);

193 (*
	mbb_şo£
)(
esş_£ssiÚ
 *
	mps
);

194 (*
	mbb_g‘_·¿m‘”s
)(
esş_£ssiÚ
 *
	mps
, 
SANE_P¬am‘”s
 *
	mµ
, 
	msÿn_¡¬‹d
);

195 
SANE_Stus
 (*
bb_check_sÿÂ”_to_cÚtšue
)(
esş_£ssiÚ
 *
	mps
);

196 
SANE_Stus
 (*
bb_¡¬t_sÿn
)(
esş_£ssiÚ
 *
	mps
);

197 
ESCL_RESULT
 (*
bb_g‘_image_d©a
)(
esş_£ssiÚ
 *
	mps
, 
	mmax_Ëngth
);

198 (*
	mbb_’d_·ge
)(
esş_£ssiÚ
 *
	mps
, 
	mio_”rÜ
);

199 (*
	mbb_’d_sÿn
)(
esş_£ssiÚ
 *
	mps
, 
	mio_”rÜ
);

	@scan/sane/hpaio.c

30 #iâdeà
_GNU_SOURCE


31 
	#_GNU_SOURCE


	)

34 
	~<¡dio.h
>

35 
	~<¡dlib.h
>

36 
	~<¡ršg.h
>

37 
	~<cups/cups.h
>

38 
	~"hpmud.h
"

39 
	~"hp_p.h
"

40 
	~"sßp.h
"

41 
	~"sßpht.h
"

42 
	~"m¬v–l.h
"

43 
	~"h·io.h
"

44 
	~"Ëdm.h
"

45 
	~"sşpml.h
"

46 
	~"esş.h
"

47 
	~"io.h
"

48 
	~"Übl™ei.h
"

51 
	#DEBUG_DECLARE_ONLY


	)

52 
	~"§Ãi_debug.h
"

54 
SANE_Deviû
 **
	gDeviûLi¡
 = 
NULL
;

56 
	$AddDeviûLi¡
(*
uri
, *
mod–
, 
SANE_Deviû
 ***
pd
)

58 
i
 = 0, 
uri_Ëngth
 = 0;

60 ià(*
pd
 =ğ
NULL
)

63 *
pd
 = 
	`m®loc
((
SANE_Deviû
 *è* 
MAX_DEVICE
);

64 
	`mem£t
(*
pd
, 0, (
SANE_Deviû
 *è* 
MAX_DEVICE
);

67 
uri
 += 3;

68 
uri_Ëngth
 = 
	`¡¾’
(
uri
);

69 if(
	`¡r¡r
(
uri
, "&queue=false"))

70 
uri_Ëngth
 -= 12;

73 
i
=0; i < 
MAX_DEVICE
; i++)

75 ià((*
pd
)[
i
] =ğ
NULL
)

78 (*
pd
)[
i
] = 
	`m®loc
((
SANE_Deviû
));

79 (*
pd
)[
i
]->
Çme
 = 
	`m®loc
(
	`¡¾’
(
uri
)+1);

80 
	`¡rıy
((*)(*
pd
)[
i
]->
Çme
, 
uri
);

81 (*
pd
)[
i
]->
mod–
 = 
	`¡rdup
(model);

82 (*
pd
)[
i
]->
v’dÜ
 = "Hewlett-Packard";

83 (*
pd
)[
i
]->
ty³
 = "all-in-one";

88 ifĞ
	`¡ºÿ£cmp
((*
pd
)[
i
]->
Çme
, 
uri
, 
uri_Ëngth
) == 0 )

93 
	}
}

95 
	$Re£tDeviûLi¡
(
SANE_Deviû
 ***
pd
)

97 
i
;

99 ià(*
pd
)

101 
i
=0; (*
pd
)[i] && i<
MAX_DEVICE
; i++)

103 ià((*
pd
)[
i
]->
Çme
)

104 
	`ä“
((*)(*
pd
)[
i
]->
Çme
);

105 ià((*
pd
)[
i
]->
mod–
)

106 
	`ä“
((*)(*
pd
)[
i
]->
mod–
);

107 
	`ä“
((*
pd
)[
i
]);

109 
	`ä“
(*
pd
);

110 *
pd
 = 
NULL
;

114 
	}
}

117 
	$G‘UriLše
(*
buf
, *
uri
, **

)

119 
i
=0, 
j
;

120 
maxBuf
 = 
HPMUD_LINE_SIZE
*64;

122 
uri
[0] = 0;

124 ià(
	`¡ºÿ£cmp
(&
buf
[
i
], "direct ", 7) == 0)

126 
i
 = 7;

127 
j
 = 0;

128 ; 
buf
[
i
] =ğ' ' && i < 
maxBuf
; i++);

129 (
buf
[
i
] !ğ' 'è&& (˜< 
maxBuf
è&& (
j
 < 
HPMUD_LINE_SIZE
))

130 
uri
[
j
++] = 
buf
[
i
++];

131 
uri
[
j
] = 0;

133 ; 
buf
[
i
] !ğ'\n' && i < 
maxBuf
; i++);

137 ; 
buf
[
i
] !ğ'\n' && i < 
maxBuf
; i++);

140 
i
++;

142 ià(

 !ğ
NULL
)

143 *

 = 
buf
 + 
i
;

145  
i
;

146 
	}
}

148 
	$AddCupsLi¡
(*
uri
, ***
´š‹r
)

150 
i
, 
¡©
=1;

153 ià(
	`¡ºÿ£cmp
(
uri
, "hp:/net/", 8) !=0)

154 
bugout
;

156 ià(*
´š‹r
 =ğ
NULL
)

159 *
´š‹r
 = 
	`m®loc
((*è* 
MAX_DEVICE
);

160 
	`mem£t
(*
´š‹r
, 0, (*è* 
MAX_DEVICE
);

164 
i
=0; (*
´š‹r
)[i] !ğ
NULL
 && i<
MAX_DEVICE
; i++)

166 ià(
	`¡rcmp
((*
´š‹r
)[
i
], 
uri
) == 0)

167 
bugout
;

171 
i
=0; i<
MAX_DEVICE
; i++)

173 ià((*
´š‹r
)[
i
] =ğ
NULL
)

175 (*
´š‹r
)[
i
] = 
	`¡rdup
(
uri
);

180 
¡©
 = 0;

182 
bugout
:

184  
¡©
;

185 
	}
}

188 
	$G‘CupsPrš‹rs
(***
´š‹r
)

190 
h‰p_t
 *
h‰p
=
NULL
;

191 
p_t
 *
»que¡
=
NULL
;

192 
p_t
 *
»¥Ú£
=
NULL
;

193 
p_©Œibu‹_t
 *
©Œ
;

194 
út
=0;

197 ià((
h‰p
 = 
	`h‰pCÚÃùEnüy±
(
	`cupsS”v”
(), 
	`pPÜt
(), 
	`cupsEnüy±iÚ
())è=ğ
NULL
)

198 
bugout
;

201 
»que¡
 = 
	`pNew
();

203 
	`pS‘O³¿tiÚ
Ğ
»que¡
, 
CUPS_GET_PRINTERS
 );

204 
	`pS‘Reque¡Id
Ğ
»que¡
, 1 );

206 
	`pAddSŒšg
(
»que¡
, 
IPP_TAG_OPERATION
, 
IPP_TAG_CHARSET
, "©Œibu‹s-ch¬£t", 
NULL
, "utf-8");

207 
	`pAddSŒšg
(
»que¡
, 
IPP_TAG_OPERATION
, 
IPP_TAG_LANGUAGE
, "©Œibu‹s-Çtu¿l-Ïnguage", 
NULL
, "en");

208 
	`pAddSŒšg
(
»que¡
, 
IPP_TAG_OPERATION
, 
IPP_TAG_KEYWORD
, "»que¡ed-©Œibu‹s", 
NULL
, "device-uri");

211 ià((
»¥Ú£
 = 
	`cupsDoReque¡
(
h‰p
, 
»que¡
, "/")è=ğ
NULL
)

212 
bugout
;

214 
©Œ
 = 
	`pFœ¡A‰ribu‹
 ( 
»¥Ú£
 );‡‰¸!ğ
NULL
;‡‰¸ğ
	`pNextA‰ribu‹
(„esponse ))

217 
©Œ
 !ğ
NULL
 && 
	`pG‘GroupTag
Ğ©Œ ) !ğ
IPP_TAG_PRINTER
)

218 
©Œ
 = 
	`pNextA‰ribu‹
Ğ
»¥Ú£
 );

220 ià(
©Œ
 =ğ
NULL
)

223 
©Œ
 !ğ
NULL
 && 
	`pG‘GroupTag
Ğ©Œ ) =ğ
IPP_TAG_PRINTER
)

225 ià(
	`¡rcmp
(
	`pG‘Name
Ğ
©Œ
 ), "deviû-uri"è=ğ0 && 
	`pG‘V®ueTag
Ğ©Œ ) =ğ
IPP_TAG_URI
 && 
	`AddCupsLi¡
(
	`pG‘SŒšg
Ğ©Œ, 0, 
NULL
 ), 
´š‹r
) == 0)

226 
út
++;

227 
©Œ
 = 
	`pNextA‰ribu‹
Ğ
»¥Ú£
 );

230 ià(
©Œ
 =ğ
NULL
)

234 
	`pD–‘e
(
»¥Ú£
);

236 
bugout
:

237  
út
;

238 
	}
}

240 
	$AddDeviû
(*
uri
)

242 
hpmud_mod–_©Œibu‹s
 
ma
;

243 
mod–
[
HPMUD_LINE_SIZE
];

244 
Ãw_uri
[256];

245 
Ën
 = 0, 
i
 = 0, 
j
 = 0;

246 
sÿn_ty³
;

247 
deviû_added
 = 0;

249 
	`hpmud_qu”y_mod–
(
uri
, &
ma
);

250 ià(
ma
.
sÿÁy³
 > 0)

252 
	`hpmud_g‘_uri_mod–
(
uri
, 
mod–
, (model));

253 
	`AddDeviûLi¡
(
uri
, 
mod–
, &
DeviûLi¡
);

254 
deviû_added
 = 1;

260 
Ën
 = 
	`¡¾’
(
uri
);

261 
	`¡ºıy
(
Ãw_uri
, 
uri
, 9);

262 
Ãw_uri
[8] = 'h';

263 
Ãw_uri
[9] = 'p';

264 
Ãw_uri
[10] = '_';

265 
i
 = 11,
j
 = 8; j<=
Ën
; ++i, ++j)

266 
Ãw_uri
[
i
] = 
uri
[
j
];

268 
	`hpmud_qu”y_mod–
(
Ãw_uri
, &
ma
);

269 
	`DBG
(6,"sÿÁy³=%d %s\n", 
ma
.
sÿÁy³
, 
Ãw_uri
);

271 if(
ma
.
sÿÁy³
>0)

273 
	`hpmud_g‘_uri_mod–
(
Ãw_uri
, 
mod–
, (model));

274 
	`AddDeviûLi¡
(
Ãw_uri
, 
mod–
, &
DeviûLi¡
);

275 
deviû_added
 = 1;

279 
	`DBG
(6,"unsuµÜ‹d sÿÁy³=%d %s\n", 
ma
.
sÿÁy³
, 
Ãw_uri
);

283  
deviû_added
;

284 
	}
}

286 
	$DevDiscov”y
(
loÿlOÆy
)

288 
mes§ge
[
HPMUD_LINE_SIZE
*64];

289 
uri
[
HPMUD_LINE_SIZE
];

290 *

 = 
mes§ge
;

291 
i
, 
sÿn_ty³
, 
út
=0, 
tÙ®
=0, 
by‹s_»ad
;

292 **
cups_´š‹r
=
NULL
;

293 * 
tok’
 = 
NULL
;

294 
HPMUD_RESULT
 
¡©
;

296 
¡©
 = 
	`hpmud_´obe_deviûs
(
HPMUD_BUS_ALL
, 
mes§ge
, (mes§ge), &
út
, &
by‹s_»ad
);

297 ià(
¡©
 !ğ
HPMUD_R_OK
)

298 
bugout
;

301 
i
=0; i<
út
; i++)

303 
	`G‘UriLše
(

, 
uri
, &tail);

304 
tÙ®
 +ğ
	`AddDeviû
(
uri
);

306 
	`mem£t
(
mes§ge
, 0, (message));

308 ià(!
loÿlOÆy
)

311 
út
 = 
	`G‘CupsPrš‹rs
(&
cups_´š‹r
);

312 
i
=0; i<
út
; i++)

314 
tÙ®
 +ğ
	`AddDeviû
(
cups_´š‹r
[
i
]);

315 
	`ä“
(
cups_´š‹r
[
i
]);

317 ià(
cups_´š‹r
)

318 
	`ä“
(
cups_´š‹r
);

319 #ifdeà
HAVE_LIBNETSNMP


321 
by‹s_»ad
 = 
	`mdns_´obe_nw_sÿÂ”s
(
mes§ge
, (mes§ge), &
út
);

322 
tok’
 = 
	`¡¹ok
(
mes§ge
, ";");

323 
tok’
)

325 
tÙ®
 +ğ
	`AddDeviû
(
tok’
);

326 
tok’
 = 
	`¡¹ok
(
NULL
, ";");

329 if(!
tÙ®
)

331 
	`S’dSÿnEv’t
("h·io:/Ãt/HP_Sÿn_Deviûs?=1.1.1.1", 
EVENT_ERROR_NO_PROBED_DEVICES_FOUND
);

335 
bugout
:

336  
tÙ®
;

337 
	}
}

341 
SANE_Stus
 
	$§Ã_h·io_š™
(
SANE_IÁ
 * 
pV”siÚCode
, 
SANE_Auth_C®lback
 
authÜize
)

343 
¡©
;

345 
	`DBG_INIT
();

346 
	`In™Dbus
();

348 
	`DBG
(8, "§Ã_h·io_š™(): % %d\n", 
__FILE__
, 
__LINE__
);

350 ifĞ
pV”siÚCode
 )

352 *
pV”siÚCode
 = 
	`SANE_VERSION_CODE
( 1, 0, 0 );

356 
¡©
 = 
	`Übl™e_š™
(
pV”siÚCode
, 
authÜize
);

358  
¡©
;

359 
	}
}

361 
	$§Ã_h·io_ex™
()

363 
	`DBG
(8, "§Ã_h·io_ex™(): % %d\n", 
__FILE__
, 
__LINE__
);

364 
	`Re£tDeviûLi¡
(&
DeviûLi¡
);

365 
	}
}

367 
SANE_Stus
 
	$§Ã_h·io_g‘_deviûs
(cÚ¡ 
SANE_Deviû
 ***
deviûLi¡
, 
SANE_BoŞ
 
loÿlOÆy
)

369 
	`DBG
(8, "§Ã_h·io_g‘_deviûsÖoÿl=%d): % %d\n", 
loÿlOÆy
, 
__FILE__
, 
__LINE__
);

370 
	`Re£tDeviûLi¡
(&
DeviûLi¡
);

371 
	`DevDiscov”y
(
loÿlOÆy
);

372 *
deviûLi¡
 = (cÚ¡ 
SANE_Deviû
 **)
DeviûLi¡
;

373 
SANE_Deviû
*** 
devLi¡
;

374 
	`Übl™e_g‘_deviûs
(
devLi¡
, 
loÿlOÆy
);

376  
SANE_STATUS_GOOD
;

377 
	}
}

379 
SANE_Stus
 
	$§Ã_h·io_İ’
(
SANE_SŒšg_CÚ¡
 
deviûÇme
, 
SANE_HªdË
 * 
pHªdË
)

381 
hpmud_mod–_©Œibu‹s
 
ma
;

382 
devÇme
[256];

385 
	`¢´štf
(
devÇme
, (devÇme)-1, "hp:%s", 
deviûÇme
);

386 
	`hpmud_qu”y_mod–
(
devÇme
, &
ma
);

387 
	`DBG
(8, "§Ã_h·io_İ’(%s): % %d sÿn_ty³=%d sÿn¤c=%d\n", 
deviûÇme
, 
__FILE__
, 
__LINE__
, 
ma
.
sÿÁy³
, ma.
sÿn¤c
);

389 ià((
ma
.
sÿÁy³
 =ğ
HPMUD_SCANTYPE_MARVELL
è|| (ma.sÿÁy³ =ğ
HPMUD_SCANTYPE_MARVELL2
))

390  
	`m¬v–l_İ’
(
deviûÇme
, 
pHªdË
);

391 ià(
ma
.
sÿÁy³
 =ğ
HPMUD_SCANTYPE_SOAP
)

392  
	`sßp_İ’
(
deviûÇme
, 
pHªdË
);

393 ià(
ma
.
sÿÁy³
 =ğ
HPMUD_SCANTYPE_SOAPHT
)

394  
	`sßpht_İ’
(
deviûÇme
, 
pHªdË
);

395 ià(
ma
.
sÿÁy³
 =ğ
HPMUD_SCANTYPE_LEDM
)

396  
	`Ëdm_İ’
(
deviûÇme
, 
pHªdË
);

397 ià((
ma
.
sÿÁy³
 =ğ
HPMUD_SCANTYPE_SCL
è|| (ma.sÿÁy³ =ğ
HPMUD_SCANTYPE_SCL_DUPLEX
è||(ma.sÿÁy³ =ğ
HPMUD_SCANTYPE_PML
))

398  
	`sşpml_İ’
(
deviûÇme
, 
pHªdË
);

399 ià(
ma
.
sÿÁy³
 =ğ
HPMUD_SCANTYPE_ESCL
)

400  
	`esş_İ’
(
deviûÇme
, 
pHªdË
);

401 ià(
ma
.
sÿÁy³
 =ğ
HPMUD_SCANTYPE_ORBLITE
)

402  
	`Übl™e_İ’
(
deviûÇme
, 
pHªdË
);

404  
SANE_STATUS_UNSUPPORTED
;

405 
	}
}

407 
	$§Ã_h·io_şo£
(
SANE_HªdË
 
hªdË
)

409 ià(
	`¡rcmp
(*((**)
hªdË
), "MARVELL") == 0)

410  
	`m¬v–l_şo£
(
hªdË
);

411 ià(
	`¡rcmp
(*((**)
hªdË
), "SOAP") == 0)

412  
	`sßp_şo£
(
hªdË
);

413 ià(
	`¡rcmp
(*((**)
hªdË
), "SOAPHT") == 0)

414  
	`sßpht_şo£
(
hªdË
);

415 ià(
	`¡rcmp
(*((**)
hªdË
), "LEDM") == 0)

416  
	`Ëdm_şo£
(
hªdË
);

417 ià(
	`¡rcmp
(*((**)
hªdË
), "SCL-PML") == 0)

418  
	`sşpml_şo£
(
hªdË
);

419 ià(
	`¡rcmp
(*((**)
hªdË
), "ESCL") == 0)

420  
	`esş_şo£
(
hªdË
);

421 ià(
	`¡rcmp
(*((**)
hªdË
), "ORBLITE") == 0)

422  
	`Übl™e_şo£
(
hªdË
);

423 
	}
}

425 cÚ¡ 
SANE_O±iÚ_DesütÜ
 * 
	$§Ã_h·io_g‘_İtiÚ_desütÜ
(
SANE_HªdË
 
hªdË
, 
SANE_IÁ
 
İtiÚ
)

427 ià(
	`¡rcmp
(*((**)
hªdË
), "MARVELL") == 0)

428  
	`m¬v–l_g‘_İtiÚ_desütÜ
(
hªdË
, 
İtiÚ
);

429 ià(
	`¡rcmp
(*((**)
hªdË
), "SOAP") == 0)

430  
	`sßp_g‘_İtiÚ_desütÜ
(
hªdË
, 
İtiÚ
);

431 ià(
	`¡rcmp
(*((**)
hªdË
), "SOAPHT") == 0)

432  
	`sßpht_g‘_İtiÚ_desütÜ
(
hªdË
, 
İtiÚ
);

433 ià(
	`¡rcmp
(*((**)
hªdË
), "LEDM") == 0)

434  
	`Ëdm_g‘_İtiÚ_desütÜ
(
hªdË
, 
İtiÚ
);

435 ià(
	`¡rcmp
(*((**)
hªdË
), "SCL-PML") == 0)

436  
	`sşpml_g‘_İtiÚ_desütÜ
(
hªdË
, 
İtiÚ
);

437 ià(
	`¡rcmp
(*((**)
hªdË
), "ESCL") == 0)

438  
	`esş_g‘_İtiÚ_desütÜ
(
hªdË
, 
İtiÚ
);

439 ià(
	`¡rcmp
(*((**)
hªdË
), "ORBLITE") == 0)

441 
t_SANE
* 
h
 = (t_SANE*)
hªdË
;

442 ià(
İtiÚ
 < 
İtCouÁ
 || o±iÚ < 
İtLa¡
)

444 
	`DBG
(8, "1. sªe_h·io_g‘_İtiÚ_desütÜ o±CouÁ = %d, o±iÚ = %d, o±La¡ = %d \n",()
İtCouÁ
,
İtiÚ
,()
İtLa¡
 );

445  &
h
->
O±iÚs
[
İtiÚ
];

449 
	`DBG
(8, "2. sªe_h·io_g‘_İtiÚ_desütÜ o±CouÁ = %d, o±iÚ = %d, o±La¡ = %d \n",()
İtCouÁ
,
İtiÚ
,()
İtLa¡
 );

450  
NULL
;

454  
NULL
;

455 
	}
}

457 
SANE_Stus
 
	$§Ã_h·io_cÚŒŞ_İtiÚ
(
SANE_HªdË
 
hªdË
, 
SANE_IÁ
 
İtiÚ
, 
SANE_AùiÚ
 
aùiÚ
, * 
pV®ue
, SANE_IÁ * 
pInfo
 )

459 ià(
	`¡rcmp
(*((**)
hªdË
), "MARVELL") == 0)

460  
	`m¬v–l_cÚŒŞ_İtiÚ
(
hªdË
, 
İtiÚ
, 
aùiÚ
, 
pV®ue
, 
pInfo
);

461 ià(
	`¡rcmp
(*((**)
hªdË
), "SOAP") == 0)

462  
	`sßp_cÚŒŞ_İtiÚ
(
hªdË
, 
İtiÚ
, 
aùiÚ
, 
pV®ue
, 
pInfo
);

463 ià(
	`¡rcmp
(*((**)
hªdË
), "SOAPHT") == 0)

464  
	`sßpht_cÚŒŞ_İtiÚ
(
hªdË
, 
İtiÚ
, 
aùiÚ
, 
pV®ue
, 
pInfo
);

465 ià(
	`¡rcmp
(*((**)
hªdË
), "LEDM") == 0)

466  
	`Ëdm_cÚŒŞ_İtiÚ
(
hªdË
, 
İtiÚ
, 
aùiÚ
, 
pV®ue
, 
pInfo
);

467 ià(
	`¡rcmp
(*((**)
hªdË
), "SCL-PML") == 0)

468  
	`sşpml_cÚŒŞ_İtiÚ
(
hªdË
, 
İtiÚ
, 
aùiÚ
, 
pV®ue
, 
pInfo
);

469 ià(
	`¡rcmp
(*((**)
hªdË
), "ESCL") == 0)

470  
	`esş_cÚŒŞ_İtiÚ
(
hªdË
, 
İtiÚ
, 
aùiÚ
, 
pV®ue
, 
pInfo
);

471 ià(
	`¡rcmp
(*((**)
hªdË
), "ORBLITE") == 0)

472  
	`Übl™e_cÚŒŞ_İtiÚ
(
hªdË
, 
İtiÚ
, 
aùiÚ
, 
pV®ue
, 
pInfo
);

474  
SANE_STATUS_UNSUPPORTED
;

475 
	}
}

477 
SANE_Stus
 
	$§Ã_h·io_g‘_·¿m‘”s
(
SANE_HªdË
 
hªdË
, 
SANE_P¬am‘”s
 *
pP¬ams
)

479 ià(
	`¡rcmp
(*((**)
hªdË
), "MARVELL") == 0)

480  
	`m¬v–l_g‘_·¿m‘”s
(
hªdË
, 
pP¬ams
);

481 ià(
	`¡rcmp
(*((**)
hªdË
), "SOAP") == 0)

482  
	`sßp_g‘_·¿m‘”s
(
hªdË
, 
pP¬ams
);

483 ià(
	`¡rcmp
(*((**)
hªdË
), "SOAPHT") == 0)

484  
	`sßpht_g‘_·¿m‘”s
(
hªdË
, 
pP¬ams
);

485 ià(
	`¡rcmp
(*((**)
hªdË
), "LEDM") == 0)

486  
	`Ëdm_g‘_·¿m‘”s
(
hªdË
, 
pP¬ams
);

487 ià(
	`¡rcmp
(*((**)
hªdË
), "SCL-PML") == 0)

488  
	`sşpml_g‘_·¿m‘”s
(
hªdË
, 
pP¬ams
);

489 ià(
	`¡rcmp
(*((**)
hªdË
), "ESCL") == 0)

490  
	`esş_g‘_·¿m‘”s
(
hªdË
, 
pP¬ams
);

491 ià(
	`¡rcmp
(*((**)
hªdË
), "ORBLITE") == 0)

492  
	`Übl™e_g‘_·¿m‘”s
(
hªdË
, 
pP¬ams
);

494  
SANE_STATUS_UNSUPPORTED
;

495 
	}
}

497 
SANE_Stus
 
	$§Ã_h·io_¡¬t
(
SANE_HªdË
 
hªdË
)

499 ià(
	`¡rcmp
(*((**)
hªdË
), "MARVELL") == 0)

500  
	`m¬v–l_¡¬t
(
hªdË
);

501 ià(
	`¡rcmp
(*((**)
hªdË
), "SOAP") == 0)

502  
	`sßp_¡¬t
(
hªdË
);

503 ià(
	`¡rcmp
(*((**)
hªdË
), "SOAPHT") == 0)

504  
	`sßpht_¡¬t
(
hªdË
);

505 ià(
	`¡rcmp
(*((**)
hªdË
), "LEDM") == 0)

506  
	`Ëdm_¡¬t
(
hªdË
);

507 ià(
	`¡rcmp
(*((**)
hªdË
), "SCL-PML") == 0)

508  
	`sşpml_¡¬t
(
hªdË
);

509 ià(
	`¡rcmp
(*((**)
hªdË
), "ESCL") == 0)

510  
	`esş_¡¬t
(
hªdË
);

511 ià(
	`¡rcmp
(*((**)
hªdË
), "ORBLITE") == 0)

512  
	`Übl™e_¡¬t
(
hªdË
);

514  
SANE_STATUS_UNSUPPORTED
;

515 
	}
}

518 
SANE_Stus
 
	$§Ã_h·io_»ad
(
SANE_HªdË
 
hªdË
, 
SANE_By‹
 *
d©a
, 
SANE_IÁ
 
maxL’gth
, SANE_IÁ *
pL’gth
)

520 ià(
	`¡rcmp
(*((**)
hªdË
), "LEDM") == 0)

521  
	`Ëdm_»ad
(
hªdË
, 
d©a
, 
maxL’gth
, 
pL’gth
);

522 ià(
	`¡rcmp
(*((**)
hªdË
), "MARVELL") == 0)

523  
	`m¬v–l_»ad
(
hªdË
, 
d©a
, 
maxL’gth
, 
pL’gth
);

524 ià(
	`¡rcmp
(*((**)
hªdË
), "SOAP") == 0)

525  
	`sßp_»ad
(
hªdË
, 
d©a
, 
maxL’gth
, 
pL’gth
);

526 ià(
	`¡rcmp
(*((**)
hªdË
), "SOAPHT") == 0)

527  
	`sßpht_»ad
(
hªdË
, 
d©a
, 
maxL’gth
, 
pL’gth
);

528 ià(
	`¡rcmp
(*((**)
hªdË
), "SCL-PML") == 0)

529  
	`sşpml_»ad
(
hªdË
, 
d©a
, 
maxL’gth
, 
pL’gth
);

530 ià(
	`¡rcmp
(*((**)
hªdË
), "ESCL") == 0)

531  
	`esş_»ad
(
hªdË
, 
d©a
, 
maxL’gth
, 
pL’gth
);

532 ià(
	`¡rcmp
(*((**)
hªdË
), "ORBLITE") == 0)

533  
	`Übl™e_»ad
(
hªdË
, 
d©a
, 
maxL’gth
, 
pL’gth
);

535  
SANE_STATUS_UNSUPPORTED
;

537 
	}
}

540 
	$§Ã_h·io_ÿnûl
Ğ
SANE_HªdË
 
hªdË
 )

542 ià(
	`¡rcmp
(*((**)
hªdË
), "MARVELL") == 0)

543  
	`m¬v–l_ÿnûl
(
hªdË
);

544 ià(
	`¡rcmp
(*((**)
hªdË
), "SOAP") == 0)

545  
	`sßp_ÿnûl
(
hªdË
);

546 ià(
	`¡rcmp
(*((**)
hªdË
), "SOAPHT") == 0)

547  
	`sßpht_ÿnûl
(
hªdË
);

548 ià(
	`¡rcmp
(*((**)
hªdË
), "LEDM") == 0)

549  
	`Ëdm_ÿnûl
(
hªdË
);

550 ià(
	`¡rcmp
(*((**)
hªdË
), "SCL-PML") == 0)

551  
	`sşpml_ÿnûl
(
hªdË
);

552 ià(
	`¡rcmp
(*((**)
hªdË
), "ESCL") == 0)

553  
	`esş_ÿnûl
(
hªdË
);

554 ià(
	`¡rcmp
(*((**)
hªdË
), "ORBLITE") == 0)

555  
	`Übl™e_ÿnûl
(
hªdË
);

556 
	}
}

558 
SANE_Stus
 
	$§Ã_h·io_£t_io_mode
(
SANE_HªdË
 
hªdË
, 
SANE_BoŞ
 
nÚBlockšg
)

560  
SANE_STATUS_UNSUPPORTED
;

561 
	}
}

563 
SANE_Stus
 
	$§Ã_h·io_g‘_£Ëù_fd
(
SANE_HªdË
 
hªdË
, 
SANE_IÁ
 *
pFd
)

565  
SANE_STATUS_UNSUPPORTED
;

566 
	}
}

	@scan/sane/hpaio.h

28 #ià!
defšed
Ğ
__HPAIO_H__
 )

29 
	#__HPAIO_H__


	)

31 
	~"§Ã.h
"

32 
	~"commÚ.h
"

33 
	~"mådtf.h
"

34 
	~"sş.h
"

35 
	~"pml.h
"

36 
	~"Übl™ei.h
"

37 
	~"../..//hp.h
"

41 
	#MAX_DEVICE
 64

	)

43 
	#LEN_BUFFER
 17408

	)

44 
	#LEN_DEVICE_ID_STRING
 4096

	)

45 
	#LEN_STRING_OPTION_VALUE
 20

	)

46 
	#LEN_MODEL_RESPONSE
 20

	)

48 
	#PAD_VALUE_LINEART
 0

	)

49 
	#PAD_VALUE_GRAYSCALE_COLOR
 -1

	)

51 
	eh·ioO±iÚ_e
 {

53 
	mOPTION_FIRST
 = 0,

54 
	mOPTION_NUM_OPTIONS
 = 0,

56 
	mGROUP_SCAN_MODE
,

57 
	mOPTION_SCAN_MODE
,

58 
	mOPTION_SCAN_RESOLUTION
,

59 
	mGROUP_ADVANCED
,

60 
	mOPTION_CONTRAST
,

61 
	mOPTION_BRIGHTNESS
,

62 
	mOPTION_COMPRESSION
,

63 
	mOPTION_JPEG_COMPRESSION_FACTOR
,

64 
	mOPTION_BATCH_SCAN
,

65 
	mOPTION_ADF_MODE
,

66 
	mOPTION_DUPLEX
,

68 
	mGROUP_GEOMETRY
,

69 
	mOPTION_LENGTH_MEASUREMENT
,

70 
	mOPTION_TL_X
,

71 
	mOPTION_TL_Y
,

72 
	mOPTION_BR_X
,

73 
	mOPTION_BR_Y
,

75 
	mOPTION_LAST
 };

81 
	eh·ioSÿnMode_e
 { 
	mSCAN_MODE_FIRST
 = 0,

82 
	mSCAN_MODE_LINEART
 = 0,

83 
	mSCAN_MODE_GRAYSCALE
,

84 
	mSCAN_MODE_COLOR
,

85 
	mSCAN_MODE_LAST


88 
	#COMPRESSION_NONE
 0x01

	)

89 
	#COMPRESSION_MH
 0x02

	)

90 
	#COMPRESSION_MR
 0x04

	)

91 
	#COMPRESSION_MMR
 0x08

	)

92 
	#COMPRESSION_JPEG
 0x10

	)

94 
	#ADF_MODE_AUTO
 0x01

	)

95 
	#ADF_MODE_FLATBED
 0x02

	)

96 
	#ADF_MODE_ADF
 0x04

	)

98 
	#LENGTH_MEASUREMENT_UNKNOWN
 0

	)

99 
	#LENGTH_MEASUREMENT_UNLIMITED
 1

	)

100 
	#LENGTH_MEASUREMENT_APPROXIMATE
 2

	)

101 
	#LENGTH_MEASUREMENT_PADDED
 3

	)

102 
	#LENGTH_MEASUREMENT_EXACT
 4

	)

104 
	sh·ioSÿÂ”_s


106 *
	mg
;

107 
	mdeviûuri
[128];

108 
HPMUD_DEVICE
 
	mdeviûid
;

109 
HPMUD_CHANNEL
 
	msÿn_chªÃlid
;

110 
HPMUD_CHANNEL
 
	mcmd_chªÃlid
;

112 
h·ioSÿÂ”_s
 * 
	m´ev
;

113 
h·ioSÿÂ”_s
 * 
	mÃxt
;

115 
SANE_Deviû
 
	m§ÃDeviû
;

116 
SANE_P¬am‘”s
 
	m´esÿnP¬am‘”s
;

117 
SANE_P¬am‘”s
 
	msÿnP¬am‘”s
;

119 
PmlObjeù_s
 * 
	mfœ¡PmlObjeù
;

120 
PmlObjeù_s
 * 
	mÏ¡PmlObjeù
;

122 ’um { 
	mSCANNER_TYPE_SCL
, 
	mSCANNER_TYPE_PML
 } 
	msÿÂ”Ty³
;

123 
	mdecix–sP”Inch
;

126 
	msuµÜtsSÿnMode
[
SCAN_MODE_LAST
];

127 
SANE_SŒšg_CÚ¡
 
	msÿnModeLi¡
[
MAX_LIST_SIZE
];

128 
h·ioSÿnMode_e
 
	mcu¼’tSÿnMode
, 
	mefãùiveSÿnMode
;

130 
SANE_Rªge
 
	m»sŞutiÚRªge
;

131 
SANE_IÁ
 
	m»sŞutiÚLi¡
[
MAX_LIST_SIZE
];

132 
SANE_IÁ
 
	mlš—¹ResŞutiÚLi¡
[
MAX_LIST_SIZE
];

133 
SANE_IÁ
 
	mcu¼’tResŞutiÚ
, 
	mefãùiveResŞutiÚ
;

135 
SANE_Rªge
 
	mcÚŒa¡Rªge
;

136 
SANE_IÁ
 
	mdeçuÉCÚŒa¡
, 
	mcu¼’tCÚŒa¡
;

138 
SANE_Rªge
 
	mbrighŠessRªge
;

139 
SANE_IÁ
 
	mdeçuÉBrighŠess
, 
	mcu¼’tBrighŠess
;

141 
SANE_SŒšg_CÚ¡
 
	mcom´essiÚLi¡
[
MAX_LIST_SIZE
];

142 
	mdeçuÉCom´essiÚ
[
SCAN_MODE_LAST
];

143 
SANE_IÁ
 
	mcu¼’tCom´essiÚ
;

145 
SANE_Rªge
 
	mj³gCom´essiÚFaùÜRªge
;

146 
SANE_IÁ
 
	mdeçuÉJ³gCom´essiÚFaùÜ
;

147 
SANE_IÁ
 
	mcu¼’tJ³gCom´essiÚFaùÜ
;

149 
SANE_BoŞ
 
	mcu¼’tB©chSÿn
;

150 
	mbefÜeSÿn
;

151 
	m®»adyP»AdvªûdDocum’t
;

152 
	m®»adyPo¡AdvªûdDocum’t
;

153 
	mnoDocsCÚd™iÚP’dšg
;

155 
	msuµÜ‹dAdfModes
;

156 
SANE_SŒšg_CÚ¡
 
	madfModeLi¡
[
MAX_LIST_SIZE
];

157 
	mcu¼’tAdfMode
;

158 
	mcu¼’tPageNumb”
;

160 
	msuµÜtsDu¶ex
;

161 
SANE_BoŞ
 
	mcu¼’tDu¶ex
;

162 
	mcu¼’tSideNumb”
;

164 
SANE_IÁ
 
	mcu¼’tL’gthM—su»m’t
;

165 
SANE_SŒšg_CÚ¡
 
	mËngthM—su»m’tLi¡
[
MAX_LIST_SIZE
];

167 
SANE_Rªge
 
	mxRªge
, 
	myRªge
, 
	mbrxRªge
, 
	mbryRªge
;

168 
SANE_Fixed
 
	mcu¼’tTlx
, 
	mcu¼’tTly
, 
	mcu¼’tBrx
, 
	mcu¼’tBry
;

169 
SANE_Fixed
 
	mefãùiveTlx
,

170 
	mefãùiveTly
,

171 
	mefãùiveBrx
,

172 
	mefãùiveBry
;

174 
SANE_O±iÚ_DesütÜ
 
	mİtiÚ
[
OPTION_LAST
];

176 
Mådtf_t
 
	mmådtf
;

177 
IP_HANDLE
 
	mhJob
;

178 
	mäomD’®i
;

179 
	m´eD’®i
;

180 
	md’®i
;

181 
	mšBufãr
[
LEN_BUFFER
];

182 
	mbufãrOff£t
;

183 
	mbufãrBy‹sRemaššg
;

184 
	mtÙ®By‹sRemaššg
;

185 
	m’dOfD©a
;

186 
	mBlockSize
;

187 
	mBlockIndex
;

188 
	mRecÜdSize
;

189 
	mRecÜdIndex
;

190 
	mmådtf_dÚe
;

191 
	mmådtf_timeout_út
;

192 
	mpml_timeout_út
;

193 
	mpml_dÚe
;

194 
	m_dÚe
;

195 
	m·ge_dÚe
;

196 
	mu¶ßd_¡©e
;

197 
	mu£r_ÿnûl
;

201 
	mcom·t1150
[
LEN_MODEL_RESPONSE
 + 1];

202 
	mcom·tPo¡1150
[
LEN_MODEL_RESPONSE
 + 1];

203 
	mcom·t
;

204 
	mdecix–Ch¬
;

206 
	mmšRes
, 
	mmaxRes
;

207 
	mmaxXEx‹Á
, 
	mmaxYEx‹Á
;

208 
	muÆßdAá”Sÿn
;

209 
	mæ©bedC­ab™y
, 
	madfC­ab™y
;

210 
	mmšResAdf
, 
	mmaxResAdf
;

212 
PmlObjeù_t
 
	mobjSuµÜ‹dFunùiÚs
;

213 } 
	msş
;

217 
PmlObjeù_t
 
	mobjSÿÂ”Stus
,

218 
	mobjResŞutiÚRªge
,

219 
	mobjU¶ßdTimeout
,

220 
	mobjCÚŒa¡
,

221 
	mobjResŞutiÚ
,

222 
	mobjPix–D©aTy³
,

223 
	mobjCom´essiÚ
,

224 
	mobjCom´essiÚFaùÜ
,

225 
	mobjU¶ßdE¼Ü
,

226 
	mobjU¶ßdS‹
,

227 
	mobjAbcTh»shŞds
,

228 
	mobjSh¬³nšgCÛffic›Á
,

229 
	mobjNeuŒ®ClTh»shŞds
,

230 
	mobjTÚeM­
,

231 
	mobjCİ›rReduùiÚ
,

232 
	mobjSÿnTok’
,

233 
	mobjModuÏrH¬dw¬e
;

235 
	msÿnTok’
[ 
PML_MAX_VALUE_LEN
 ];

236 
	mz”oSÿnTok’
[ 
PML_MAX_VALUE_LEN
 ];

237 
	mËnSÿnTok’
;

238 
	msÿnTok’IsS‘
;

240 
	mİ’Fœ¡
;

241 
	mdÚtRe£tBefÜeNextNÚB©chPage
;

242 
	m¡¬tNextB©chPageE¬ly
;

243 
	mæ©bedC­ab™y
;

245 
	m®»adyRe¡¬‹d
;

246 
	msÿnDÚe
;

247 
	m´eviousU¶ßdS‹
;

248 } 
	mpml
;

251 
h·ioSÿÂ”_s
 * 
	th·ioSÿÂ”_t
;

252 
h·ioSÿÂ”_s
 
	tHPAIO_RECORD
;

254 
	#UNDEFINED_MODEL
(
h·io
è(!h·io->
§ÃDeviû
.
mod–
)

	)

256 
	#_SET_DEFAULT_MODEL
(
h·io
,
s
,
Ën
) \

258 ià(
	`UNDEFINED_MODEL
(
h·io
)) { \

259 
h·io
->
§ÃDeviû
.
mod–
=
	`m®loc
(
Ën
+1); \

260 
	`memıy
((*)
h·io
->
§ÃDeviû
.
mod–
,
s
,
Ën
); \

261 ((*)
h·io
->
§ÃDeviû
.
mod–
)[
Ën
]=0; \

263 } 0)

	)

264 
	#SET_DEFAULT_MODEL
(
h·io
,
s
è
	`_SET_DEFAULT_MODEL
(h·io,s,
	`¡¾’
(s))

	)

266 
	#FIX_GEOMETRY
(
low
,
high
,
mš
,
max
) \

268 ià(
high
<
low
) high=low; \

269 ià(
high
==
low
) { \

270 ià(
high
==
max
) { \

271 
low
--; \

273 
high
++; \

276 } 0)

	)

278 
SANE_Stus
 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
h·ioSÿÂ”ToSªeStus
Ğ
h·ioSÿÂ”_t
 
h·io
 );

279 
SANE_Stus
 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
h·ioSÿÂ”ToSªeE¼Ü
Ğ
h·ioSÿÂ”_t
 
h·io
 );

280 
§Ã_h·io_ÿnûl
(
SANE_HªdË
 
hªdË
);

	@scan/sane/http.c

30 #iâdeà
_GNU_SOURCE


31 
	#_GNU_SOURCE


	)

34 
	~<¡dio.h
>

35 
	~<¡dlib.h
>

36 
	~<¡ršg.h
>

37 
	~<sy¦og.h
>

38 
	~<ùy³.h
>

39 
	~"hpmud.h
"

40 
	~"h‰p.h
"

44 
	#_STRINGIZE
(
x
è#x

	)

45 
	#STRINGIZE
(
x
è
	`_STRINGIZE
(x)

	)

47 
	#BUG
(
¬gs
...è
	`sy¦og
(
LOG_ERR
, 
__FILE__
 " " 
	`STRINGIZE
(
__LINE__
è": "‡rgs)

	)

49 #ifdeà
HTTP_DEBUG


50 
	#DBG
(
¬gs
...è
	`sy¦og
(
LOG_INFO
, 
__FILE__
 " " 
	`STRINGIZE
(
__LINE__
è": "‡rgs)

	)

51 
	#DBG_DUMP
(
d©a
, 
size
è
	`sysdump
((d©a), (size))

	)

52 
	#DBG_SZ
(
¬gs
...è
	`sy¦og
(
LOG_INFO
,‡rgs)

	)

54 
	#DBG
(
¬gs
...)

	)

55 
	#DBG_DUMP
(
d©a
, 
size
)

	)

56 
	#DBG_SZ
(
¬gs
...)

	)

59 
	#EXCEPTION_TIMEOUT
 45

	)

61 
	eHTTP_STATE


63 
	mHS_ACTIVE
 = 1,

64 
	mHS_EOF
,

67 
	s¡»am_bufãr


69 
	mbuf
[4096];

70 
	mšdex
;

71 
	mút
;

74 
	sh‰p_£ssiÚ


76 
HTTP_STATE
 
	m¡©e
;

77 
	mh‰p_¡©us
;

78 
	mfoÙ”
;

79 
	mtÙ®
;

80 
HPMUD_DEVICE
 
	mdd
;

81 
HPMUD_CHANNEL
 
	mcd
;

82 
¡»am_bufãr
 
	ms
;

87 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
	$ş—r_¡»am
(
HTTP_HANDLE
 
hªdË
, *
d©a
, 
max_size
, *
by‹s_»ad
)

90 
	`DBG
("clear_streamƒntry...\n");

91 
h‰p_£ssiÚ
 *
ps
 = (h‰p_£ssiÚ *)
hªdË
;

92 
Ën
=0, 
¡©
=1;

94 ià(
ps
->
s
.
út
 > 0 &&…s->s.úˆ<ğ
max_size
 )

96 
Ën
 = 
ps
->
s
.
út
;

97 
	`DBG
("CË¬šg (%dèby‹ äomh¡»am\n", 
Ën
);

98 
	`memıy
(
d©a
, &
ps
->
s
.
buf
[ps->s.
šdex
], 
Ën
);

99 
ps
->
s
.
šdex
 =…s->s.
út
 = 0;

100 
¡©
 = 0;

103 *
by‹s_»ad
 = 
Ën
;

105 
	`DBG
("ş—r_¡»am„‘uºšg w™h (¡© = %d, by‹s_»ad = %d)...\n", 
¡©
, *
by‹s_»ad
);

106  
¡©
;

108 
	}
}

112 
	$»ad_¡»am
(
h‰p_£ssiÚ
 *
ps
, *
d©a
, 
size
, 
£c_timeout
, *
by‹s_»ad
)

114 
Ën
, 
¡©
=1;

115 
tmo
=
£c_timeout
;

116 
max
=(
ps
->
s
.
buf
);

117 
HPMUD_RESULT
 
»t
;

118 
»Œy
 = 3;

122 *
by‹s_»ad
 = 0;

125 ià(
ps
->
s
.
út
)

127 ià(
ps
->
s
.
út
 > 
size
)

130 
Ën
 = 
size
;

131 
	`memıy
(
d©a
, &
ps
->
s
.
buf
[ps->s.
šdex
], 
Ën
);

132 
ps
->
s
.
šdex
 +ğ
Ën
;

133 
ps
->
s
.
út
 -ğ
Ën
;

138 
Ën
 = 
ps
->
s
.
út
;

139 
	`memıy
(
d©a
, &
ps
->
s
.
buf
[ps->s.
šdex
], 
Ën
);

140 
ps
->
s
.
šdex
 =…s->s.
út
 = 0;

142 *
by‹s_»ad
 = 
Ën
;

148 
»t
 = 
	`hpmud_»ad_chªÃl
(
ps
->
dd
,…s->
cd
, &ps->
s
.
buf
[ps->s.
šdex
], 
max
-Õs->s.šdex +…s->s.
út
), 
tmo
, &
Ën
);

149  (
»t
 =ğ
HPMUD_R_IO_TIMEOUT
 ||„‘ =ğ
HPMUD_R_IO_ERROR
è&& 
»Œy
--)

151 
	`u¦“p
(100000);

152 
»t
 = 
	`hpmud_»ad_chªÃl
(
ps
->
dd
,…s->
cd
, &ps->
s
.
buf
[ps->s.
šdex
], 
max
-Õs->s.šdex +…s->s.
út
), 
tmo
, &
Ën
);

153 
	`DBG
("hpmud_»ad_chªÃÈçed„‘ryšg (%dèmÜtimes)\n", 
»Œy
);

155 ià(
»t
 !ğ
HPMUD_R_OK
)

157 
	`BUG
("»ad_¡»amƒ¼Ü st=%d\n", 
»t
);

158 
bugout
;

160 ià(
Ën
==0)

162 
	`BUG
("read_streamƒrror†en=0\n");

163 
bugout
;

166 
	`DBG
("»ad_chªÃÈËn=%d\n", 
Ën
);

167 
ps
->
s
.
út
 +ğ
Ën
;

169 ià(
ps
->
s
.
út
 > 
size
)

172 
Ën
 = 
size
;

173 
	`memıy
(
d©a
, &
ps
->
s
.
buf
[ps->s.
šdex
], 
Ën
);

174 
ps
->
s
.
šdex
 +ğ
Ën
;

175 
ps
->
s
.
út
 -ğ
Ën
;

180 
Ën
 = 
ps
->
s
.
út
;

181 
	`memıy
(
d©a
, &
ps
->
s
.
buf
[ps->s.
šdex
], 
Ën
);

182 
ps
->
s
.
šdex
 =…s->s.
út
 = 0;

185 *
by‹s_»ad
 = 
Ën
;

186 
¡©
 = 0;

188 
bugout
:

189 
	`DBG
("-»ad_¡»am(èby‹s_»ad=%d s.šdex=%d s.út=%d st=%d\n", 
Ën
, 
ps
->
s
.
šdex
,…s->s.
út
, 
¡©
);

190  
¡©
;

191 
	}
}

193 
	$»ad_ch¬
(
h‰p_£ssiÚ
 *
ps
, 
£c_timeout
)

195 
ch
;

196 
Ën
;

197 ià(
	`»ad_¡»am
(
ps
, (*)&
ch
, 1, 
£c_timeout
, &
Ën
))

200  
ch
;

201 
	}
}

204 
	$»ad_lše
(
h‰p_£ssiÚ
 *
ps
, *
lše
, 
lše_size
, 
£c_timeout
, *
by‹s_»ad
)

206 
tÙ®
=0, 
¡©
=1;

207 
ch
, 
ü
=0, 
lf
=0;

208 
tmo
=
£c_timeout
;

210 *
by‹s_»ad
 = 0;

212 
tÙ®
 < (
lše_size
-1))

214 
ch
 = 
	`»ad_ch¬
(
ps
, 
tmo
);

215 
lše
[
tÙ®
++]=
ch
;

217 ià(
ch
 == '\r')

218 
ü
=1;

219 ià(
ch
 =ğ'\n' && 
ü
)

221 ià(
ch
 =ğ'\n' && 
lf
)

223 ià(
ch
 == '\n')

224 
lf
=1;

225 ià(
ch
 == -1)

226 
bugout
;

229 
ü
=0;

230 
lf
=0;

232 
tmo
=3;

234 
¡©
 = 0;

236 
bugout
:

237 
lše
[
tÙ®
]=0;

238 *
by‹s_»ad
=
tÙ®
;

239 
	`DBG
("»ad_lšËn=%d index=%d cÁ=%d\n", 
tÙ®
, 
ps
->
s
.
šdex
,…s->s.
út
);

240  
¡©
;

241 
	}
}

244 
HTTP_RESULT
 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
	$h‰p_İ’
(
HPMUD_DEVICE
 
dd
, cÚ¡ *
chªÃl
, 
HTTP_HANDLE
 *
hªdË
)

246 
h‰p_£ssiÚ
 *
ps
;

247 
HTTP_RESULT
 
¡©
 = 
HTTP_R_IO_ERROR
;

249 
	`DBG
("h‰p_İ’(èdd=%d chªÃl=% hªdË=%p\n", 
dd
, 
chªÃl
, 
hªdË
);

251 *
hªdË
 = 
NULL
;

253 ià((
ps
 = 
	`m®loc
((
h‰p_£ssiÚ
))è=ğ
NULL
)

255 
	`BUG
("malloc failed: %m\n");

256  
HTTP_R_MALLOC_ERROR
;

258 
	`mem£t
(
ps
, 0, (
h‰p_£ssiÚ
));

260 
ps
->
dd
 = dd;

261 ià(
	`hpmud_İ’_chªÃl
(
ps
->
dd
, 
chªÃl
, &ps->
cd
è!ğ
HPMUD_R_OK
)

263 
	`BUG
("uÇbËØİ’ % chªÃl\n", 
chªÃl
);

264 
bugout
;

267 
ps
->
¡©e
 = 
HS_ACTIVE
;

268 *
hªdË
 = 
ps
;

269 
¡©
 = 
HTTP_R_OK
;

271 
bugout
:

272 ià(
¡©
 !ğ
HTTP_R_OK
)

273 
	`ä“
(
ps
);

274  
¡©
;

275 
	}
}

278 
HTTP_RESULT
 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
	$h‰p_şo£
(
HTTP_HANDLE
 
hªdË
)

280 
h‰p_£ssiÚ
 *
ps
 = (h‰p_£ssiÚ *)
hªdË
;

282 if(
ps
)

284 
	`DBG
("h‰p_şo£(èhªdË=%p\n", 
hªdË
);

285 ià(
ps
->
cd
 > 0)

286 
	`hpmud_şo£_chªÃl
(
ps
->
dd
,…s->
cd
);

287 
	`ä“
(
ps
);

289  
HTTP_R_OK
;

290 
	}
}

293 
HTTP_RESULT
 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
	$h‰p_»ad_h—d”
(
HTTP_HANDLE
 
hªdË
, *
d©a
, 
max_size
, 
£c_timeout
, *
by‹s_»ad
)

295 
h‰p_£ssiÚ
 *
ps
 = (h‰p_£ssiÚ *)
hªdË
;

296 
Ën
, 
tÙ®
;

297 
tmo
=
£c_timeout
;

298 
HTTP_RESULT
 
¡©
 = 
HTTP_R_IO_ERROR
;

300 
	`DBG
("h‰p_»ad_h—d”(èhªdË=%°d©a=%°size=%d seùime=%d\n", 
hªdË
, 
d©a
, 
max_size
, 
£c_timeout
);

302 *
by‹s_»ad
 = 0;

307 ià(
	`»ad_lše
(
ps
, 
d©a
, 
max_size
, 
tmo
, &
Ën
))

308 
bugout
;

309 ifĞ!
	`¡ºcmp
(
d©a
, "HTTP/1.1", 8))

313 
	`DBG
("HTTP H—d”‚Ù found. S—rchšg h—d” iÀÃxˆlš(%d)\n", 
Ën
);

316 
ps
->
h‰p_¡©us
 = 
	`¡¹Ş
(
d©a
+9, 
NULL
, 10);

317 *
by‹s_»ad
 = 
tÙ®
 = 
Ën
;

320 ià(!((
ps
->
h‰p_¡©us
 >= 200 &&…s->http_status < 300) ||…s->http_status == 400))

322 
	`BUG
("šv®id h‰p_¡©us=%d\n", 
ps
->
h‰p_¡©us
);

325 !
	`»ad_¡»am
(
ps
, 
d©a
 + 
tÙ®
, 
max_size
, 1, &
Ën
))

327 
tÙ®
 = (tÙ®+
Ën
è% 
max_size
;

328 
	`BUG
("dumpšg†’=%d\n", 
Ën
);

330 
bugout
;

334 *
by‹s_»ad
 = 
tÙ®
 = 
Ën
;

335 
Ën
 > 2)

337 ià(
	`»ad_lše
(
ps
, 
d©a
+
tÙ®
, 
max_size
-tÙ®, 
tmo
, &
Ën
))

338 
bugout
;

339 
tÙ®
 +ğ
Ën
;

340 *
by‹s_»ad
 +ğ
Ën
;

341 
	`DBG
("h‰p_»ad_h—d” d©a=% Ën=%dÙ®=%d\n", (*)
d©a
+
tÙ®
, 
Ën
,otal);

343 
¡©
 = 
HTTP_R_OK
;

345 
	`DBG
("-h‰p_»ad_h—d”(èhªdË=%°d©a=%°by‹s_»ad=%d size=%d stus=%d\n", 
hªdË
, 
d©a
, *
by‹s_»ad
, 
max_size
, 
¡©
);

347 
bugout
:

348  
¡©
;

349 
	}
};

352 
HTTP_RESULT
 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
	$h‰p_»ad_·ylßd
(
HTTP_HANDLE
 
hªdË
, *
d©a
, 
max_size
, 
£c_timeout
, *
by‹s_»ad
)

354 
h‰p_£ssiÚ
 *
ps
 = (h‰p_£ssiÚ *)
hªdË
;

355 
lše
[128];

356 
Ën
;

357 
tmo
=
£c_timeout
;

358 
HTTP_RESULT
 
¡©
 = 
HTTP_R_IO_ERROR
;

360 
	`DBG
("h‰p_»ad_·ylßd(èhªdË=%°d©a=%°size=%d seùime=%d\n", 
hªdË
, 
d©a
, 
max_size
, 
£c_timeout
);

362 *
by‹s_»ad
 = 0;

364 ià(
ps
->
¡©e
 =ğ
HS_EOF
)

366 
¡©
 = 
HTTP_R_EOF
;

370 ià(
ps
->
foÙ”
)

373 ià(
	`»ad_¡»am
(
ps
, 
d©a
,…s->
foÙ”
 < 
max_size
 ?…s->foÙ” : max_size, 
tmo
, &
Ën
))

374 
bugout
;

376 
ps
->
tÙ®
 +ğ
Ën
;

377 
ps
->
foÙ”
 -ğ
Ën
;

378 *
by‹s_»ad
 = 
Ën
;

380 ià(
ps
->
foÙ”
 == 0)

381 ià(
	`»ad_lše
(
ps
, 
lše
, Öše), 
tmo
, &
Ën
))

382 
bugout
;

384 
¡©
 = 
HTTP_R_OK
;

389 ià(
	`»ad_lše
(
ps
, 
lše
, Öše), 
tmo
, &
Ën
))

390 
bugout
;

391 
ps
->
foÙ”
 = 
	`¡¹Ş
(
lše
, 
NULL
, 16);

394 ià(
ps
->
foÙ”
 == 0)

397 
	`»ad_lše
(
ps
, 
lše
, Öše), 1, &
Ën
);

398 
ps
->
¡©e
 = 
HS_EOF
;

399 
¡©
 = 
HTTP_R_EOF
;

404 ià(
	`»ad_¡»am
(
ps
, 
d©a
,…s->
foÙ”
 < 
max_size
 ?…s->foÙ” : max_size, 
tmo
, &
Ën
))

405 
bugout
;

407 
ps
->
tÙ®
 +ğ
Ën
;

408 
ps
->
foÙ”
 -ğ
Ën
;

409 *
by‹s_»ad
 = 
Ën
;

411 ià(
ps
->
foÙ”
 == 0)

412 ià(
	`»ad_lše
(
ps
, 
lše
, Öše), 
tmo
, &
Ën
))

413 
bugout
;

415 
¡©
 = 
HTTP_R_OK
;

420 
	`DBG
("-h‰p_»ad_·ylßd(èhªdË=%°d©a=%°by‹s_»ad=%d size=%d stus=%d\n", 
hªdË
, 
d©a
, *
by‹s_»ad
, 
max_size
, 
¡©
);

422 
bugout
:

423  
¡©
;

424 
	}
};

426 
HTTP_RESULT
 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
	$h‰p_»ad2
(
HTTP_HANDLE
 
hªdË
, *
d©a
, 
max_size
, 
tmo
, *
by‹s_»ad
)

428 
h‰p_£ssiÚ
 *
ps
 = (h‰p_£ssiÚ *)
hªdË
;

429 
HTTP_RESULT
 
¡©
 = 
HTTP_R_IO_ERROR
;

430 
Ën
 = 0, 
»t
;

431 
»Œy
 = 5;

433 
»Œy
--)

435 
	`DBG
("http_read2ƒntry.\n" );

436 
»t
 = 
	`hpmud_»ad_chªÃl
(
ps
->
dd
,…s->
cd
, (*)
d©a
, 
max_size
, 
tmo
, 
by‹s_»ad
);

437 if(*
by‹s_»ad
 > 0)

439 
	`DBG
("h‰p_»ad2 sucûssful. (%d by‹ »ad). \n", *
by‹s_»ad
);

440 
¡©
 = 
HTTP_R_OK
;

443 
	`DBG
("h‰p_»ad2 faed. R‘ryšg (%dèmÜtime befÜex™šg.\n", 
»Œy
);

444 
	`u¦“p
(100000);

446 
	`DBG
("h‰p_»ad2 faedØ»ad (by‹s_»ad=%d)\n", *
by‹s_»ad
);

447  
¡©
;

448 
	}
}

450 
HTTP_RESULT
 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
	$h‰p_»ad
(
HTTP_HANDLE
 
hªdË
, *
d©a
, 
max_size
, 
£c_timeout
, *
by‹s_»ad
)

452 
h‰p_£ssiÚ
 *
ps
 = (h‰p_£ssiÚ *)
hªdË
;

453 
lše
[128] ={0,};

454 
Ën
 = 0, 
»t
;

455 
tmo
=
£c_timeout
;

456 
HTTP_RESULT
 
¡©
 = 
HTTP_R_IO_ERROR
;

457 
tÙ®_·ylßd_Ëngth
=*
by‹s_»ad
;

459 
	`DBG
("h‰p_»ad(èhªdË=%°d©a=%°size=%d seùime=%dÙ®_·ylßd_Ëngth=%d\n", 
hªdË
, 
d©a
, 
max_size
, 
£c_timeout
, 
tÙ®_·ylßd_Ëngth
);

461 
ps
->
foÙ”
=
tÙ®_·ylßd_Ëngth
;

463 *
by‹s_»ad
 = 0;

466 ià(
ps
->
foÙ”
)

468 
ps
->
foÙ”
)

470 ià(
	`»ad_lše
(
ps
, 
lše
, Öše), 
tmo
, &
Ën
))

472 *
by‹s_»ad
 = (
ps
->
foÙ”
) * (-1) + 12;

473 
bugout
;

475 
	`¡rıy
(
d©a
, 
lše
);

476 
d©a
=d©a+
Ën
;

477 
ps
->
foÙ”
 -ğ
Ën
;

478 *
by‹s_»ad
 +ğ
Ën
;

485 
»t
 = 
	`»ad_lše
 (
ps
, 
lše
, Öše), 
tmo
, &
Ën
);

486 *
by‹s_»ad
 +ğ
Ën
;

487 if(
»t
)

489 
ps
->
foÙ”
 = 0;

492 
	`¡rıy
(
d©a
, 
lše
);

493 
d©a
 = d©¨+ 
Ën
;

494 
	`DBG
("h‰p_»ad†’=%d d©®’=%d d©a=%s\n", 
Ën
, 
	`¡¾’
((*)
d©a
), (*)data);

496 ià(
	`¡ºcmp
(
d©a
-7, 
ZERO_FOOTER
, (ZERO_FOOTER)-1) == 0)

498 
ps
->
foÙ”
 = 0;

503 
¡©
 = 
HTTP_R_OK
;

504 if(
ps
->
foÙ”
 =ğ0è
¡©
=
HTTP_R_EOF
;

506 
	`DBG
("-h‰p_»ad(èhªdË=%°d©a=%°by‹s_»ad=%d size=%d stus=%d\n", 
hªdË
, 
d©a
, *
by‹s_»ad
, 
max_size
, 
¡©
);

508 
bugout
:

509  
¡©
;

510 
	}
};

512 
HTTP_RESULT
 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
	$h‰p_»ad_size
(
HTTP_HANDLE
 
hªdË
, *
d©a
, 
max_size
, 
£c_timeout
, *
by‹s_»ad
)

514 
h‰p_£ssiÚ
 *
ps
 = (h‰p_£ssiÚ *)
hªdË
;

515 
HTTP_RESULT
 
¡©
 = 
HTTP_R_IO_ERROR
;

516 
ch
;

518 if(
ps
 &&…s->
¡©e
 =ğ
HTTP_R_EOF
)  HTTP_R_EOF;

519 if(
max_size
 == -1)

521 
ps
->
¡©e
 = 
HTTP_R_EOF
;

522  
HTTP_R_EOF
;

525 
	`DBG
("h‰p_»ad_size(èhªdË=%°d©a=%°size=%d seùime=%d\n", 
hªdË
, 
d©a
, 
max_size
, 
£c_timeout
);

527 *
by‹s_»ad
=0;

528 *
by‹s_»ad
 < 
max_size
)

530 
ch
 = 
	`»ad_ch¬
(
ps
, 
£c_timeout
);

531 if(
ch
 == -1)

533 
	`DBG
("h‰p_»ad_size(): IOƒ¼Ü‡á” %d by‹s.\n",*
by‹s_»ad
);

534  
HTTP_R_IO_ERROR
;

537 *((*)
d©a
 + (*
by‹s_»ad
)èğ
ch
;

538 *
by‹s_»ad
 = *bytes_read+1;

541  
¡©
 = 
HTTP_R_OK
;

542 
	}
}

545 
HTTP_RESULT
 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
	$h‰p_wr™e
(
HTTP_HANDLE
 
hªdË
, *
d©a
, 
size
, 
£c_timeout
)

547 
h‰p_£ssiÚ
 *
ps
 = (h‰p_£ssiÚ *)
hªdË
;

548 
Ën
;

549 
tmo
=
£c_timeout
;

550 
HTTP_RESULT
 
¡©
 = 
HTTP_R_IO_ERROR
;

552 
	`DBG
("h‰p_wr™e(èhªdË=%°d©a=%°size=%d seùime=%d\n", 
hªdË
, 
d©a
, 
size
, 
£c_timeout
);

554 ià(
	`hpmud_wr™e_chªÃl
(
ps
->
dd
,…s->
cd
, 
d©a
, 
size
, 
tmo
, &
Ën
è!ğ
HPMUD_R_OK
)

556 
	`BUG
("unableo write channel data\n");

557 
bugout
;

560 
¡©
 = 
HTTP_R_OK
;

562 
bugout
:

563  
¡©
;

564 
	}
}

566 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
	$h‰p_unchunk_d©a
(*
bufãr
)

568 *
‹mp
=
bufãr
;

569 *
p
=
bufãr
;

570 
chunkËn
 = 0;

573 ià(*
p
 == '<')

575 *
p
)

577 ià(!(*
p
 == '\n' || *p == '\r' || *p =='\t'))

579 *
‹mp
 = *
p
;

580 
‹mp
++;

582 
p
++;

584 *
‹mp
 = '\0';

591 *
p
 != '\n' && *p != '\r')

593 
chunkËn
 = chunklen << 4 ;

594 ià('0' <ğ*
p
 && *p<='9')

595 
chunkËn
 +ğ*
p
 - '0';

596 ià('A' <ğ*
p
 && *p <= 'F')

597 
chunkËn
 +ğ10 - 'A' + *
p
;

598 ià('a' <ğ*
p
 && *p <= 'f')

599 
chunkËn
 +ğ10 + *
p
 - 'a';

602 
chunkËn
 = chunklen >> 4;

605 
p
++;

607 ià(
chunkËn
 == 0)

609 *
p
 == '\n' || *p == '\r' || *p =='\t')…++;

611 
chunkËn
 > 0)

613 ià(!(*
p
 == '\n' || *p == '\r' || *p =='\t'))

615 *
‹mp
 = *
p
 ;

616 
‹mp
++;

618 
p
++;

619 
chunkËn
--;

621 *
p
 == '\n' || *p == '\r' || *p =='\t')…++;

623 *
‹mp
 = '\0';

624 
	}
}

	@scan/sane/http.h

28 #iâdeà
_HTTP_H


29 
	#_HTTP_H


	)

31 
	eHTTP_RESULT


33 
	mHTTP_R_OK
 = 0,

34 
	mHTTP_R_IO_ERROR
,

35 
	mHTTP_R_EOF
,

36 
	mHTTP_R_IO_TIMEOUT
,

37 
	mHTTP_R_MALLOC_ERROR
,

38 
	mHTTP_R_INVALID_BUF_SIZE
,

41 
	#ZERO_FOOTER
 "\r\n0\r\n\r\n"

	)

43 * 
	tHTTP_HANDLE
;

45 
HTTP_RESULT
 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
h‰p_İ’
(
HPMUD_DEVICE
 
dd
, cÚ¡ *
hpmud_chªÃl
, 
HTTP_HANDLE
 *
hªdË
);

46 
HTTP_RESULT
 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
h‰p_şo£
(
HTTP_HANDLE
 
hªdË
);

47 
HTTP_RESULT
 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
h‰p_»ad_h—d”
(
HTTP_HANDLE
 
hªdË
, *
d©a
, 
max_size
, 
£c_timout
, *
by‹s_»ad
);

48 
HTTP_RESULT
 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
h‰p_»ad_·ylßd
(
HTTP_HANDLE
 
hªdË
, *
d©a
, 
max_size
, 
£c_timout
, *
by‹s_»ad
);

49 
HTTP_RESULT
 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
h‰p_»ad
(
HTTP_HANDLE
 
hªdË
, *
d©a
, 
max_size
, 
£c_timout
, *
by‹s_»ad
);

50 
HTTP_RESULT
 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
h‰p_»ad_size
(
HTTP_HANDLE
 
hªdË
, *
d©a
, 
max_size
, 
£c_timout
, *
by‹s_»ad
);

51 
HTTP_RESULT
 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
h‰p_wr™e
(
HTTP_HANDLE
 
hªdË
, *
d©a
, 
d©a_size
, 
£c_timout
);

52 
HTTP_RESULT
 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
h‰p_»ad2
(
HTTP_HANDLE
 
hªdË
, *
d©a
, 
max_size
, 
tmo
, *
by‹s_»ad
);

53 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
h‰p_unchunk_d©a
(*
bufãr
);

54 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
ş—r_¡»am
(
HTTP_HANDLE
 
hªdË
, *
d©a
, 
max_size
, *
by‹s_»ad
);

	@scan/sane/io.c

28 
	~<¡dio.h
>

29 
	~<sys/ty³s.h
>

30 
	~<uni¡d.h
>

31 
	~<pwd.h
>

32 
	~"hpmud.h
"

33 
	~"commÚ.h
"

34 
	~"pml.h
"

35 
	~"io.h
"

36 #ifdeà
HAVE_DBUS


37 
	~<dbus/dbus.h
>

39 
	#DEBUG_DECLARE_ONLY


	)

40 
	~"§Ãi_debug.h
"

42 #ifdeà
HAVE_DBUS


43 
DBusE¼Ü
 
	gdbus_”r
;

44 
DBusCÚÃùiÚ
 * 
	gdbus_cÚn
;

46 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
	$In™Dbus
()

48 
	`dbus_”rÜ_š™
(&
dbus_”r
);

49 
dbus_cÚn
 = 
	`dbus_bus_g‘
(
DBUS_BUS_SYSTEM
, &
dbus_”r
);

51 ià(
	`dbus_”rÜ_is_£t
(&
dbus_”r
))

53 
	`BUG
("dBu CÚÃùiÚ E¼Ü (%s)!\n", 
dbus_”r
.
mes§ge
);

54 
	`dbus_”rÜ_ä“
(&
dbus_”r
);

57 ià(
NULL
 =ğ
dbus_cÚn
)

63 
	}
}

65 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
	$S’dSÿnEv’t
(*
deviû_uri
, 
ev’t
)

67 
DBusMes§ge
 * 
msg
 = 
	`dbus_mes§ge_Ãw_sigÇl
(
DBUS_PATH
, 
DBUS_INTERFACE
, "Event");

68 * 
´š‹r
 = "";

69 * 
t™Ë
 = "";

70 
jobid
 = 0;

71 * 
u£ºame
 = "";

73 
uid_t
 
uid
 = 
	`g‘uid
();

74 
·sswd
 *
p
 = 
	`g‘pwuid
 (
uid
);

75 
u£ºame
 = 
p
->
pw_Çme
;

77 ià(
NULL
 =ğ
u£ºame
)

78 
u£ºame
 = "";

80 ià(
NULL
 =ğ
msg
)

82 
	`BUG
("dbus message is NULL!\n");

86 
	`dbus_mes§ge_­³nd_¬gs
(
msg
,

87 
DBUS_TYPE_STRING
, &
deviû_uri
,

88 
DBUS_TYPE_STRING
, &
´š‹r
,

89 
DBUS_TYPE_UINT32
, &
ev’t
,

90 
DBUS_TYPE_STRING
, &
u£ºame
,

91 
DBUS_TYPE_UINT32
, &
jobid
,

92 
DBUS_TYPE_STRING
, &
t™Ë
,

93 
DBUS_TYPE_INVALID
);

95 ià(!
	`dbus_cÚÃùiÚ_£nd
(
dbus_cÚn
, 
msg
, 
NULL
))

97 
	`BUG
("dbus message send failed!\n");

101 
	`dbus_cÚÃùiÚ_æush
(
dbus_cÚn
);

102 
	`dbus_mes§ge_uÄef
(
msg
);

105 
	}
}

107 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
	$In™Dbus
()

110 
	}
}

111 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
	$S’dSÿnEv’t
(*
deviû_uri
, 
ev’t
)

114 
	}
}

118 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
	$R—dChªÃlEx
(
deviûid
, 
chªÃlid
, * 
bufãr
, 
Ëngth
, 
timeout
)

120 
n
, 
Ën
, 
size
, 
tÙ®
=0;

121 
HPMUD_RESULT
 
¡©
;

123 
size
 = 
Ëngth
;

125 
size
 > 0)

127 
Ën
 = 
size
 > 
HPMUD_BUFFER_SIZE
 ? HPMUD_BUFFER_SIZE : size;

129 
¡©
 = 
	`hpmud_»ad_chªÃl
(
deviûid
, 
chªÃlid
, 
bufãr
+
tÙ®
, 
Ën
, 
timeout
, &
n
);

130 ià(
n
 <= 0)

134 
size
-=
n
;

135 
tÙ®
+=
n
;

138  
tÙ®
;

139 
	}
}

	@scan/sane/io.h

28 #ià!
defšed
(
_IO_H
)

29 
	#_IO_H


	)

31 
	~"§Ã.h
"

32 
	~"hpmud.h
"

34 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
In™Dbus
();

35 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
S’dSÿnEv’t
(* 
deviû_uri
, 
ev’t
);

36 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
R—dChªÃlEx
(
deviûid
, 
chªÃlid
, * 
bufãr
, 
Ëngth
, 
timeout
);

38 
	#EVENT_START_SCAN_JOB
 2000

	)

39 
	#EVENT_END_SCAN_JOB
 2001

	)

40 
	#EVENT_SCANNER_FAIL
 2002

	)

41 
	#EVENT_PLUGIN_FAIL
 2003

	)

42 
	#EVENT_SCAN_ADF_LOADED
 2004

	)

43 
	#EVENT_SCAN_TO_DESTINATION_NOTSET
 = 2005

	)

44 
	#EVENT_SCAN_WAITING_FOR_PC
 = 2006

	)

45 
	#EVENT_SCAN_ADF_JAM
 2007

	)

46 
	#EVENT_SCAN_ADF_DOOR_OPEN
 2008

	)

47 
	#EVENT_SCAN_CANCEL
 2009

	)

48 
	#EVENT_SIZE_WARNING
 2010

	)

49 
	#EVENT_SCAN_ADF_NO_DOCS
 2011

	)

50 
	#EVENT_SCAN_ADF_MISPICK
 2012

	)

51 
	#EVENT_SCAN_BUSY
 2013

	)

52 
	#EVENT_ERROR_NO_PROBED_DEVICES_FOUND
 5018

	)

54 
	#DBUS_INTERFACE
 "com.h¶.StusS”viû"

	)

55 
	#DBUS_PATH
 "/"

	)

	@scan/sane/ledm.c

28 #iâdeà
_GNU_SOURCE


29 
	#_GNU_SOURCE


	)

32 
	~<¡dio.h
>

33 
	~<sy¦og.h
>

34 
	~<¡ršg.h
>

35 
	~<uni¡d.h
>

36 
	~<fú.h
>

37 
	~<dlfú.h
>

38 
	~"commÚ.h
"

39 
	~"hpmud.h
"

40 
	~"hp.h
"

41 
	~"Ëdm.h
"

42 
	~"Ëdmi.h
"

43 
	~"§Ã.h
"

44 
	~"§Ãİts.h
"

45 
	~"io.h
"

47 
	#DEBUG_DECLARE_ONLY


	)

48 
	~"§Ãi_debug.h
"

50 
Ëdm_£ssiÚ
 *
	g£ssiÚ
 = 
NULL
;

53 
	$£t_ex‹Ás
(
Ëdm_£ssiÚ
 *
ps
)

55 
¡©
 = 0;

57 ià((
ps
->
cu¼’tBrx
 >…s->
cu¼’tTlx
è&& (ps->cu¼’tBrx -…s->cu¼’tTlx >ğps->
mš_width
è&& (ps->cu¼’tBrx -…s->cu¼’tTlx <ğps->
xRªge
.
max
))

59 
ps
->
efãùiveTlx
 =…s->
cu¼’tTlx
;

60 
ps
->
efãùiveBrx
 =…s->
cu¼’tBrx
;

64 
ps
->
efãùiveTlx
 = 0;

65 
ps
->
efãùiveBrx
 = 0;

66 
¡©
 = 1;

68 ià((
ps
->
cu¼’tBry
 >…s->
cu¼’tTly
è&& (ps->cu¼’tBry -…s->cu¼’tTly >…s->
mš_height
è&& (ps->cu¼’tBry -…s->cu¼’tTly <ğps->
yRªge
.
max
))

70 
ps
->
efãùiveTly
 =…s->
cu¼’tTly
;

71 
ps
->
efãùiveBry
 =…s->
cu¼’tBry
;

75 
ps
->
efãùiveTly
 = 0;

76 
ps
->
efãùiveBry
 = 0;

77 
¡©
 = 1;

79  
¡©
;

80 
	}
}

82 
Ëdm_£ssiÚ
 *
	$ü—‹_£ssiÚ
()

84 
Ëdm_£ssiÚ
 *
ps
;

86 ià((
ps
 = 
	`m®loc
((
Ëdm_£ssiÚ
))è=ğ
NULL
)

88  
NULL
;

90 
	`mem£t
(
ps
, 0, (
Ëdm_£ssiÚ
));

91 
ps
->
g
 = "LEDM";

92 
ps
->
dd
 = -1;

93 
ps
->
cd
 = -1;

94 
ps
->
job_id
 = 0;

95 
ps
->
·ge_id
 = 0;

96  
ps
;

97 
	}
}

100 
	$g‘__d©a
(
Ëdm_£ssiÚ
 *
ps
, 
SANE_By‹
 *
d©a
, 
SANE_IÁ
 
maxL’gth
, SANE_IÁ *
Ëngth
)

102 
_»t
=
IP_INPUT_ERROR
;

103 
ouutAva
=
maxL’gth
, 
ouutU£d
=0, 
ouutThisPos
;

104 *
šput
, *
ouut
 = 
d©a
;

105 
šputAva
, 
šputU£d
=0, 
šputNextPos
;

107 ià(!
ps
->
_hªdË
)

109 
bugout
;

112 
eof
;

114 
eof
=
	`bb_g‘_image_d©a
(
ps
, 
ouutAva
);

116 ià(
ps
->
út
 > 0)

118 
šputAva
 = 
ps
->
út
;

119 
šput
 = &
ps
->
buf
[ps->
šdex
];

123 
šput
 = 
NULL
;

124 
šputAva
 = 0;

129 
_»t
 = 
	`CÚv”t
(
ps
->
_hªdË
, 
šputAva
, 
šput
, &
šputU£d
, &
šputNextPos
, 
ouutAva
, 
ouut
, &
ouutU£d
, &
ouutThisPos
);

132 
	`DBG6
("út=%d index=%d iÅut=%°šputAva=%d iÅutU£d=%d iÅutNextPos=%d ouut=%°ouutAva=%d ouutU£d=%d ouutThisPos=%d\n", 
ps
->
út
,…s->
šdex
, 
šput
,

133 
šputAva
, 
šputU£d
, 
šputNextPos
, 
ouut
, 
ouutAva
, 
ouutU£d
, 
ouutThisPos
);

135 ià(
šput
 !ğ
NULL
)

137 ià(
šputAva
 =ğ
šputU£d
)

139 
ps
->
šdex
 =…s->
út
 = 0;

143 
ps
->
út
 -ğ
šputU£d
;

144 
ps
->
šdex
 +ğ
šputU£d
;

148 ià(
d©a
)

149 *
Ëngth
 = 
ouutU£d
;

152 ià(
_»t
 & 
IP_DONE
 && 
ouutU£d
)

153 
_»t
 &ğ~
IP_DONE
;

155 
bugout
:

156  
_»t
;

157 
	}
}

160 
	$£t_sÿn_mode_side_efãùs
(
Ëdm_£ssiÚ
 *
ps
, 
COLOR_ENTRY
 
sÿnMode
)

162 
j
=0;

164 
	`mem£t
(
ps
->
com´essiÚLi¡
, 0, (ps->compressionList));

165 
	`mem£t
(
ps
->
com´essiÚM­
, 0, (ps->compressionMap));

167 
sÿnMode
)

169 
CE_K1
:

170 
CE_GRAY8
:

171 
CE_COLOR8
:

175 
ps
->
com´essiÚLi¡
[
j
] = 
STR_COMPRESSION_JPEG
;

176 
ps
->
com´essiÚM­
[
j
++] = 
SF_JPEG
;

177 
ps
->
cu¼’tCom´essiÚ
 = 
SF_JPEG
;

178 
ps
->
İtiÚ
[
LEDM_OPTION_JPEG_QUALITY
].
ÿp
 |ğ
SANE_CAP_SOFT_SELECT
;

183 
	}
}

185 
	$£t_šput_sourû_side_efãùs
(
Ëdm_£ssiÚ
 *
ps
, 
INPUT_SOURCE
 
sourû
)

187 
sourû
)

189 
IS_PLATEN
:

190 
ps
->
mš_width
 =…s->
¶©’_mš_width
;

191 
ps
->
mš_height
 =…s->
¶©’_mš_height
;

192 
ps
->
xRªge
.
max
 =…s->
¶©’_xRªge
.max;

193 
ps
->
brxRªge
.
max
 =…s->
¶©’_brxRªge
.max;

194 
ps
->
yRªge
.
max
 =…s->
¶©’_yRªge
.max;

195 
ps
->
bryRªge
.
max
 =…s->
¶©’_bryRªge
.max;

197 
IS_ADF
:

198 
IS_ADF_DUPLEX
:

200 
ps
->
mš_width
 =…s->
adf_mš_width
;

201 
ps
->
mš_height
 =…s->
adf_mš_height
;

202 
ps
->
xRªge
.
max
 =…s->
adf_xRªge
.max;

203 
ps
->
brxRªge
.
max
 =…s->
adf_brxRªge
.max;

204 
ps
->
yRªge
.
max
 =…s->
adf_yRªge
.max;

205 
ps
->
bryRªge
.
max
 =…s->
adf_bryRªge
.max;

209 ià((
ps
->
adf_bryRªge
.
max
 !ğps->
¶©’_bryRªge
.maxè|| (ps->
adf_brxRªge
.max !ğps->
¶©’_brxRªge
.max))

211 
ps
->
cu¼’tTly
 =…s->
yRªge
.
mš
;

212 
ps
->
cu¼’tBrx
 =…s->
brxRªge
.
max
;

213 
ps
->
cu¼’tTlx
 =…s->
xRªge
.
mš
;

214 
ps
->
cu¼’tBry
 =…s->
bryRªge
.
max
;

218 
	}
}

220 
	$š™_İtiÚs
(
Ëdm_£ssiÚ
 *
ps
)

222 
ps
->
İtiÚ
[
LEDM_OPTION_COUNT
].
Çme
 = "option-cnt";

223 
ps
->
İtiÚ
[
LEDM_OPTION_COUNT
].
t™Ë
 = 
SANE_TITLE_NUM_OPTIONS
;

224 
ps
->
İtiÚ
[
LEDM_OPTION_COUNT
].
desc
 = 
SANE_DESC_NUM_OPTIONS
;

225 
ps
->
İtiÚ
[
LEDM_OPTION_COUNT
].
ty³
 = 
SANE_TYPE_INT
;

226 
ps
->
İtiÚ
[
LEDM_OPTION_COUNT
].
un™
 = 
SANE_UNIT_NONE
;

227 
ps
->
İtiÚ
[
LEDM_OPTION_COUNT
].
size
 = (
SANE_IÁ
);

228 
ps
->
İtiÚ
[
LEDM_OPTION_COUNT
].
ÿp
 = 
SANE_CAP_SOFT_DETECT
;

229 
ps
->
İtiÚ
[
LEDM_OPTION_COUNT
].
cÚ¡¿št_ty³
 = 
SANE_CONSTRAINT_NONE
;

231 
ps
->
İtiÚ
[
LEDM_OPTION_GROUP_SCAN_MODE
].
Çme
 = "mode-group";

232 
ps
->
İtiÚ
[
LEDM_OPTION_GROUP_SCAN_MODE
].
t™Ë
 = 
SANE_TITLE_SCAN_MODE
;

233 
ps
->
İtiÚ
[
LEDM_OPTION_GROUP_SCAN_MODE
].
ty³
 = 
SANE_TYPE_GROUP
;

235 
ps
->
İtiÚ
[
LEDM_OPTION_SCAN_MODE
].
Çme
 = 
SANE_NAME_SCAN_MODE
;

236 
ps
->
İtiÚ
[
LEDM_OPTION_SCAN_MODE
].
t™Ë
 = 
SANE_TITLE_SCAN_MODE
;

237 
ps
->
İtiÚ
[
LEDM_OPTION_SCAN_MODE
].
desc
 = 
SANE_DESC_SCAN_MODE
;

238 
ps
->
İtiÚ
[
LEDM_OPTION_SCAN_MODE
].
ty³
 = 
SANE_TYPE_STRING
;

239 
ps
->
İtiÚ
[
LEDM_OPTION_SCAN_MODE
].
un™
 = 
SANE_UNIT_NONE
;

240 
ps
->
İtiÚ
[
LEDM_OPTION_SCAN_MODE
].
size
 = 
MAX_STRING_SIZE
;

241 
ps
->
İtiÚ
[
LEDM_OPTION_SCAN_MODE
].
ÿp
 = 
SANE_CAP_SOFT_SELECT
 | 
SANE_CAP_SOFT_DETECT
;

242 
ps
->
İtiÚ
[
LEDM_OPTION_SCAN_MODE
].
cÚ¡¿št_ty³
 = 
SANE_CONSTRAINT_STRING_LIST
;

243 
ps
->
İtiÚ
[
LEDM_OPTION_SCAN_MODE
].
cÚ¡¿št
.
¡ršg_li¡
 =…s->
sÿnModeLi¡
;

245 
ps
->
İtiÚ
[
LEDM_OPTION_INPUT_SOURCE
].
Çme
 = 
SANE_NAME_SCAN_SOURCE
;

246 
ps
->
İtiÚ
[
LEDM_OPTION_INPUT_SOURCE
].
t™Ë
 = 
SANE_TITLE_SCAN_SOURCE
;

247 
ps
->
İtiÚ
[
LEDM_OPTION_INPUT_SOURCE
].
desc
 = 
SANE_DESC_SCAN_SOURCE
;

248 
ps
->
İtiÚ
[
LEDM_OPTION_INPUT_SOURCE
].
ty³
 = 
SANE_TYPE_STRING
;

249 
ps
->
İtiÚ
[
LEDM_OPTION_INPUT_SOURCE
].
un™
 = 
SANE_UNIT_NONE
;

250 
ps
->
İtiÚ
[
LEDM_OPTION_INPUT_SOURCE
].
size
 = 
MAX_STRING_SIZE
;

251 
ps
->
İtiÚ
[
LEDM_OPTION_INPUT_SOURCE
].
ÿp
 = 
SANE_CAP_SOFT_SELECT
 | 
SANE_CAP_SOFT_DETECT
;

252 
ps
->
İtiÚ
[
LEDM_OPTION_INPUT_SOURCE
].
cÚ¡¿št_ty³
 = 
SANE_CONSTRAINT_STRING_LIST
;

253 
ps
->
İtiÚ
[
LEDM_OPTION_INPUT_SOURCE
].
cÚ¡¿št
.
¡ršg_li¡
 =…s->
šputSourûLi¡
;

255 
ps
->
İtiÚ
[
LEDM_OPTION_SCAN_RESOLUTION
].
Çme
 = 
SANE_NAME_SCAN_RESOLUTION
;

256 
ps
->
İtiÚ
[
LEDM_OPTION_SCAN_RESOLUTION
].
t™Ë
 = 
SANE_TITLE_SCAN_RESOLUTION
;

257 
ps
->
İtiÚ
[
LEDM_OPTION_SCAN_RESOLUTION
].
desc
 = 
SANE_DESC_SCAN_RESOLUTION
;

258 
ps
->
İtiÚ
[
LEDM_OPTION_SCAN_RESOLUTION
].
ty³
 = 
SANE_TYPE_INT
;

259 
ps
->
İtiÚ
[
LEDM_OPTION_SCAN_RESOLUTION
].
un™
 = 
SANE_UNIT_DPI
;

260 
ps
->
İtiÚ
[
LEDM_OPTION_SCAN_RESOLUTION
].
size
 = (
SANE_IÁ
);

261 
ps
->
İtiÚ
[
LEDM_OPTION_SCAN_RESOLUTION
].
ÿp
 = 
SANE_CAP_SOFT_SELECT
 | 
SANE_CAP_SOFT_DETECT
;

262 
ps
->
İtiÚ
[
LEDM_OPTION_SCAN_RESOLUTION
].
cÚ¡¿št_ty³
 = 
SANE_CONSTRAINT_WORD_LIST
;

263 
ps
->
İtiÚ
[
LEDM_OPTION_SCAN_RESOLUTION
].
cÚ¡¿št
.
wÜd_li¡
 =…s->
»sŞutiÚLi¡
;

265 
ps
->
İtiÚ
[
LEDM_OPTION_GROUP_ADVANCED
].
Çme
 = "advanced-group";

266 
ps
->
İtiÚ
[
LEDM_OPTION_GROUP_ADVANCED
].
t™Ë
 = 
STR_TITLE_ADVANCED
;

267 
ps
->
İtiÚ
[
LEDM_OPTION_GROUP_ADVANCED
].
ty³
 = 
SANE_TYPE_GROUP
;

268 
ps
->
İtiÚ
[
LEDM_OPTION_GROUP_ADVANCED
].
ÿp
 = 
SANE_CAP_ADVANCED
;

270 
ps
->
İtiÚ
[
LEDM_OPTION_BRIGHTNESS
].
Çme
 = 
SANE_NAME_BRIGHTNESS
;

271 
ps
->
İtiÚ
[
LEDM_OPTION_BRIGHTNESS
].
t™Ë
 = 
SANE_TITLE_BRIGHTNESS
;

272 
ps
->
İtiÚ
[
LEDM_OPTION_BRIGHTNESS
].
desc
 = 
SANE_DESC_BRIGHTNESS
;

273 
ps
->
İtiÚ
[
LEDM_OPTION_BRIGHTNESS
].
ty³
 = 
SANE_TYPE_INT
;

274 
ps
->
İtiÚ
[
LEDM_OPTION_BRIGHTNESS
].
un™
 = 
SANE_UNIT_NONE
;

275 
ps
->
İtiÚ
[
LEDM_OPTION_BRIGHTNESS
].
size
 = (
SANE_IÁ
);

276 
ps
->
İtiÚ
[
LEDM_OPTION_BRIGHTNESS
].
ÿp
 = 
SANE_CAP_SOFT_SELECT
 | 
SANE_CAP_SOFT_DETECT
 | 
SANE_CAP_ADVANCED
;

277 
ps
->
İtiÚ
[
LEDM_OPTION_BRIGHTNESS
].
cÚ¡¿št_ty³
 = 
SANE_CONSTRAINT_RANGE
;

278 
ps
->
İtiÚ
[
LEDM_OPTION_BRIGHTNESS
].
cÚ¡¿št
.
¿nge
 = &ps->
brighŠessRªge
;

279 
ps
->
brighŠessRªge
.
mš
 = 
LEDM_BRIGHTNESS_MIN
;

280 
ps
->
brighŠessRªge
.
max
 = 
LEDM_BRIGHTNESS_MAX
;

281 
ps
->
brighŠessRªge
.
quªt
 = 0;

283 
ps
->
İtiÚ
[
LEDM_OPTION_CONTRAST
].
Çme
 = 
SANE_NAME_CONTRAST
;

284 
ps
->
İtiÚ
[
LEDM_OPTION_CONTRAST
].
t™Ë
 = 
SANE_TITLE_CONTRAST
;

285 
ps
->
İtiÚ
[
LEDM_OPTION_CONTRAST
].
desc
 = 
SANE_DESC_CONTRAST
;

286 
ps
->
İtiÚ
[
LEDM_OPTION_CONTRAST
].
ty³
 = 
SANE_TYPE_INT
;

287 
ps
->
İtiÚ
[
LEDM_OPTION_CONTRAST
].
un™
 = 
SANE_UNIT_NONE
;

288 
ps
->
İtiÚ
[
LEDM_OPTION_CONTRAST
].
size
 = (
SANE_IÁ
);

289 
ps
->
İtiÚ
[
LEDM_OPTION_CONTRAST
].
ÿp
 = 
SANE_CAP_SOFT_SELECT
 | 
SANE_CAP_SOFT_DETECT
 | 
SANE_CAP_ADVANCED
;

290 
ps
->
İtiÚ
[
LEDM_OPTION_CONTRAST
].
cÚ¡¿št_ty³
 = 
SANE_CONSTRAINT_RANGE
;

291 
ps
->
İtiÚ
[
LEDM_OPTION_CONTRAST
].
cÚ¡¿št
.
¿nge
 = &ps->
cÚŒa¡Rªge
;

292 
ps
->
cÚŒa¡Rªge
.
mš
 = 
LEDM_CONTRAST_MIN
;

293 
ps
->
cÚŒa¡Rªge
.
max
 = 
LEDM_CONTRAST_MAX
;

294 
ps
->
cÚŒa¡Rªge
.
quªt
 = 0;

296 
ps
->
İtiÚ
[
LEDM_OPTION_COMPRESSION
].
Çme
 = 
STR_NAME_COMPRESSION
;

297 
ps
->
İtiÚ
[
LEDM_OPTION_COMPRESSION
].
t™Ë
 = 
STR_TITLE_COMPRESSION
;

298 
ps
->
İtiÚ
[
LEDM_OPTION_COMPRESSION
].
desc
 = 
STR_DESC_COMPRESSION
;

299 
ps
->
İtiÚ
[
LEDM_OPTION_COMPRESSION
].
ty³
 = 
SANE_TYPE_STRING
;

300 
ps
->
İtiÚ
[
LEDM_OPTION_COMPRESSION
].
un™
 = 
SANE_UNIT_NONE
;

301 
ps
->
İtiÚ
[
LEDM_OPTION_COMPRESSION
].
size
 = 
MAX_STRING_SIZE
;

302 
ps
->
İtiÚ
[
LEDM_OPTION_COMPRESSION
].
ÿp
 = 
SANE_CAP_SOFT_SELECT
 | 
SANE_CAP_SOFT_DETECT
 | 
SANE_CAP_ADVANCED
;

303 
ps
->
İtiÚ
[
LEDM_OPTION_COMPRESSION
].
cÚ¡¿št_ty³
 = 
SANE_CONSTRAINT_STRING_LIST
;

304 
ps
->
İtiÚ
[
LEDM_OPTION_COMPRESSION
].
cÚ¡¿št
.
¡ršg_li¡
 =…s->
com´essiÚLi¡
;

306 
ps
->
İtiÚ
[
LEDM_OPTION_JPEG_QUALITY
].
Çme
 = 
STR_NAME_JPEG_QUALITY
;

307 
ps
->
İtiÚ
[
LEDM_OPTION_JPEG_QUALITY
].
t™Ë
 = 
STR_TITLE_JPEG_QUALITY
;

308 
ps
->
İtiÚ
[
LEDM_OPTION_JPEG_QUALITY
].
desc
 = 
STR_DESC_JPEG_QUALITY
;

309 
ps
->
İtiÚ
[
LEDM_OPTION_JPEG_QUALITY
].
ty³
 = 
SANE_TYPE_INT
;

310 
ps
->
İtiÚ
[
LEDM_OPTION_JPEG_QUALITY
].
un™
 = 
SANE_UNIT_NONE
;

311 
ps
->
İtiÚ
[
LEDM_OPTION_JPEG_QUALITY
].
size
 = (
SANE_IÁ
);

312 
ps
->
İtiÚ
[
LEDM_OPTION_JPEG_QUALITY
].
ÿp
 = 
SANE_CAP_SOFT_SELECT
 | 
SANE_CAP_SOFT_DETECT
 | 
SANE_CAP_ADVANCED
;

313 
ps
->
İtiÚ
[
LEDM_OPTION_JPEG_QUALITY
].
cÚ¡¿št_ty³
 = 
SANE_CONSTRAINT_RANGE
;

314 
ps
->
İtiÚ
[
LEDM_OPTION_JPEG_QUALITY
].
cÚ¡¿št
.
¿nge
 = &ps->
j³gQu®™yRªge
;

315 
ps
->
j³gQu®™yRªge
.
mš
 = 
MIN_JPEG_COMPRESSION_FACTOR
;

316 
ps
->
j³gQu®™yRªge
.
max
 = 
MAX_JPEG_COMPRESSION_FACTOR
;

317 
ps
->
j³gQu®™yRªge
.
quªt
 = 0;

319 
ps
->
İtiÚ
[
LEDM_OPTION_GROUP_GEOMETRY
].
Çme
 = "geometry-group";

320 
ps
->
İtiÚ
[
LEDM_OPTION_GROUP_GEOMETRY
].
t™Ë
 = 
STR_TITLE_GEOMETRY
;

321 
ps
->
İtiÚ
[
LEDM_OPTION_GROUP_GEOMETRY
].
ty³
 = 
SANE_TYPE_GROUP
;

322 
ps
->
İtiÚ
[
LEDM_OPTION_GROUP_GEOMETRY
].
ÿp
 = 
SANE_CAP_ADVANCED
;

324 
ps
->
İtiÚ
[
LEDM_OPTION_TL_X
].
Çme
 = 
SANE_NAME_SCAN_TL_X
;

325 
ps
->
İtiÚ
[
LEDM_OPTION_TL_X
].
t™Ë
 = 
SANE_TITLE_SCAN_TL_X
;

326 
ps
->
İtiÚ
[
LEDM_OPTION_TL_X
].
desc
 = 
SANE_DESC_SCAN_TL_X
;

327 
ps
->
İtiÚ
[
LEDM_OPTION_TL_X
].
ty³
 = 
SANE_TYPE_FIXED
;

328 
ps
->
İtiÚ
[
LEDM_OPTION_TL_X
].
un™
 = 
SANE_UNIT_MM
;

329 
ps
->
İtiÚ
[
LEDM_OPTION_TL_X
].
size
 = (
SANE_IÁ
);

330 
ps
->
İtiÚ
[
LEDM_OPTION_TL_X
].
ÿp
 = 
SANE_CAP_SOFT_SELECT
 | 
SANE_CAP_SOFT_DETECT
;

331 
ps
->
İtiÚ
[
LEDM_OPTION_TL_X
].
cÚ¡¿št_ty³
 = 
SANE_CONSTRAINT_RANGE
;

332 
ps
->
İtiÚ
[
LEDM_OPTION_TL_X
].
cÚ¡¿št
.
¿nge
 = &ps->
xRªge
;

333 
ps
->
xRªge
.
mš
 = 0;

334 
ps
->
xRªge
.
quªt
 = 0;

336 
ps
->
İtiÚ
[
LEDM_OPTION_TL_Y
].
Çme
 = 
SANE_NAME_SCAN_TL_Y
;

337 
ps
->
İtiÚ
[
LEDM_OPTION_TL_Y
].
t™Ë
 = 
SANE_TITLE_SCAN_TL_Y
;

338 
ps
->
İtiÚ
[
LEDM_OPTION_TL_Y
].
desc
 = 
SANE_DESC_SCAN_TL_Y
;

339 
ps
->
İtiÚ
[
LEDM_OPTION_TL_Y
].
ty³
 = 
SANE_TYPE_FIXED
;

340 
ps
->
İtiÚ
[
LEDM_OPTION_TL_Y
].
un™
 = 
SANE_UNIT_MM
;

341 
ps
->
İtiÚ
[
LEDM_OPTION_TL_Y
].
size
 = (
SANE_IÁ
);

342 
ps
->
İtiÚ
[
LEDM_OPTION_TL_Y
].
ÿp
 = 
SANE_CAP_SOFT_SELECT
 | 
SANE_CAP_SOFT_DETECT
;

343 
ps
->
İtiÚ
[
LEDM_OPTION_TL_Y
].
cÚ¡¿št_ty³
 = 
SANE_CONSTRAINT_RANGE
;

344 
ps
->
İtiÚ
[
LEDM_OPTION_TL_Y
].
cÚ¡¿št
.
¿nge
 = &ps->
yRªge
;

345 
ps
->
yRªge
.
mš
 = 0;

346 
ps
->
yRªge
.
quªt
 = 0;

348 
ps
->
İtiÚ
[
LEDM_OPTION_BR_X
].
Çme
 = 
SANE_NAME_SCAN_BR_X
;

349 
ps
->
İtiÚ
[
LEDM_OPTION_BR_X
].
t™Ë
 = 
SANE_TITLE_SCAN_BR_X
;

350 
ps
->
İtiÚ
[
LEDM_OPTION_BR_X
].
desc
 = 
SANE_DESC_SCAN_BR_X
;

351 
ps
->
İtiÚ
[
LEDM_OPTION_BR_X
].
ty³
 = 
SANE_TYPE_FIXED
;

352 
ps
->
İtiÚ
[
LEDM_OPTION_BR_X
].
un™
 = 
SANE_UNIT_MM
;

353 
ps
->
İtiÚ
[
LEDM_OPTION_BR_X
].
size
 = (
SANE_IÁ
);

354 
ps
->
İtiÚ
[
LEDM_OPTION_BR_X
].
ÿp
 = 
SANE_CAP_SOFT_SELECT
 | 
SANE_CAP_SOFT_DETECT
;

355 
ps
->
İtiÚ
[
LEDM_OPTION_BR_X
].
cÚ¡¿št_ty³
 = 
SANE_CONSTRAINT_RANGE
;

356 
ps
->
İtiÚ
[
LEDM_OPTION_BR_X
].
cÚ¡¿št
.
¿nge
 = &ps->
brxRªge
;

357 
ps
->
brxRªge
.
mš
 = 0;

358 
ps
->
brxRªge
.
quªt
 = 0;

360 
ps
->
İtiÚ
[
LEDM_OPTION_BR_Y
].
Çme
 = 
SANE_NAME_SCAN_BR_Y
;

361 
ps
->
İtiÚ
[
LEDM_OPTION_BR_Y
].
t™Ë
 = 
SANE_TITLE_SCAN_BR_Y
;

362 
ps
->
İtiÚ
[
LEDM_OPTION_BR_Y
].
desc
 = 
SANE_DESC_SCAN_BR_Y
;

363 
ps
->
İtiÚ
[
LEDM_OPTION_BR_Y
].
ty³
 = 
SANE_TYPE_FIXED
;

364 
ps
->
İtiÚ
[
LEDM_OPTION_BR_Y
].
un™
 = 
SANE_UNIT_MM
;

365 
ps
->
İtiÚ
[
LEDM_OPTION_BR_Y
].
size
 = (
SANE_IÁ
);

366 
ps
->
İtiÚ
[
LEDM_OPTION_BR_Y
].
ÿp
 = 
SANE_CAP_SOFT_SELECT
 | 
SANE_CAP_SOFT_DETECT
;

367 
ps
->
İtiÚ
[
LEDM_OPTION_BR_Y
].
cÚ¡¿št_ty³
 = 
SANE_CONSTRAINT_RANGE
;

368 
ps
->
İtiÚ
[
LEDM_OPTION_BR_Y
].
cÚ¡¿št
.
¿nge
 = &ps->
bryRªge
;

369 
ps
->
bryRªge
.
mš
 = 0;

370 
ps
->
bryRªge
.
quªt
 = 0;

373 
	}
}

377 
SANE_Stus
 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
	$Ëdm_İ’
(
SANE_SŒšg_CÚ¡
 
deviû
, 
SANE_HªdË
 *
hªdË
)

379 
hpmud_mod–_©Œibu‹s
 
ma
;

380 
¡©
 = 
SANE_STATUS_IO_ERROR
;

382 if(
£ssiÚ
)

384  
SANE_STATUS_DEVICE_BUSY
;

386 if((
£ssiÚ
 = 
	`ü—‹_£ssiÚ
()è=ğ
NULL
)

387  
SANE_STATUS_NO_MEM
;

390 
	`¢´štf
(
£ssiÚ
->
uri
, (£ssiÚ->uri)-1, "hp:%s", 
deviû
);

393 
	`hpmud_qu”y_mod–
(
£ssiÚ
->
uri
, &
ma
);

394 
£ssiÚ
->
sÿn_ty³
 = 
ma
.
sÿÁy³
;

396 ià(
	`hpmud_İ’_deviû
(
£ssiÚ
->
uri
, 
ma
.
må_mode
, &£ssiÚ->
dd
è!ğ
HPMUD_R_OK
)

398 
¡©
 = 
SANE_STATUS_IO_ERROR
;

399 
bugout
;

402 
	`š™_İtiÚs
(
£ssiÚ
);

404 ià(
	`bb_İ’
(
£ssiÚ
))

406 
¡©
 = 
SANE_STATUS_IO_ERROR
;

407 
bugout
;

411 
	`Ëdm_cÚŒŞ_İtiÚ
(
£ssiÚ
, 
LEDM_OPTION_SCAN_MODE
, 
SANE_ACTION_SET_AUTO
, 
NULL
, NULL);

414 
	`Ëdm_cÚŒŞ_İtiÚ
(
£ssiÚ
, 
LEDM_OPTION_INPUT_SOURCE
, 
SANE_ACTION_SET_AUTO
, 
NULL
, NULL);

417 
	`Ëdm_cÚŒŞ_İtiÚ
(
£ssiÚ
, 
LEDM_OPTION_SCAN_RESOLUTION
, 
SANE_ACTION_SET_AUTO
, 
NULL
, NULL);

420 
	`Ëdm_cÚŒŞ_İtiÚ
(
£ssiÚ
, 
LEDM_OPTION_CONTRAST
, 
SANE_ACTION_SET_AUTO
, 
NULL
, NULL);

423 
	`Ëdm_cÚŒŞ_İtiÚ
(
£ssiÚ
, 
LEDM_OPTION_BRIGHTNESS
, 
SANE_ACTION_SET_AUTO
, 
NULL
, NULL);

426 
	`Ëdm_cÚŒŞ_İtiÚ
(
£ssiÚ
, 
LEDM_OPTION_COMPRESSION
, 
SANE_ACTION_SET_AUTO
, 
NULL
, NULL);

429 
	`Ëdm_cÚŒŞ_İtiÚ
(
£ssiÚ
, 
LEDM_OPTION_JPEG_QUALITY
, 
SANE_ACTION_SET_AUTO
, 
NULL
, NULL);

432 
	`Ëdm_cÚŒŞ_İtiÚ
(
£ssiÚ
, 
LEDM_OPTION_TL_X
, 
SANE_ACTION_SET_AUTO
, 
NULL
, NULL);

433 
	`Ëdm_cÚŒŞ_İtiÚ
(
£ssiÚ
, 
LEDM_OPTION_TL_Y
, 
SANE_ACTION_SET_AUTO
, 
NULL
, NULL);

434 
	`Ëdm_cÚŒŞ_İtiÚ
(
£ssiÚ
, 
LEDM_OPTION_BR_X
, 
SANE_ACTION_SET_AUTO
, 
NULL
, NULL);

435 
	`Ëdm_cÚŒŞ_İtiÚ
(
£ssiÚ
, 
LEDM_OPTION_BR_Y
, 
SANE_ACTION_SET_AUTO
, 
NULL
, NULL);

437 *
hªdË
 = (
SANE_HªdË
 *)
£ssiÚ
;

439 
¡©
 = 
SANE_STATUS_GOOD
;

441 
bugout
:

443 ià(
¡©
 !ğ
SANE_STATUS_GOOD
)

445 ià(
£ssiÚ
)

447 
	`bb_şo£
(
£ssiÚ
);

448 ià(
£ssiÚ
->
cd
 > 0)

449 
	`hpmud_şo£_chªÃl
(
£ssiÚ
->
dd
, sessiÚ->
cd
);

450 ià(
£ssiÚ
->
dd
 > 0)

451 
	`hpmud_şo£_deviû
(
£ssiÚ
->
dd
);

452 
	`ä“
(
£ssiÚ
);

453 
£ssiÚ
 = 
NULL
;

457  
¡©
;

458 
	}
}

460 cÚ¡ 
SANE_O±iÚ_DesütÜ
 *
	$Ëdm_g‘_İtiÚ_desütÜ
(
SANE_HªdË
 
hªdË
, 
SANE_IÁ
 
İtiÚ
)

462 
Ëdm_£ssiÚ
 *
ps
 = (Ëdm_£ssiÚ *)
hªdË
;

464 
	`DBG8
("§Ã_h·io_g‘_İtiÚ_desütÜ(İtiÚ=%s)\n", 
ps
->
İtiÚ
[İtiÚ].
Çme
);

466 ià(
İtiÚ
 < 0 || o±iÚ >ğ
LEDM_OPTION_MAX
)

467  
NULL
;

469  &
ps
->
İtiÚ
[option];

470 
	}
}

472 
SANE_Stus
 
	$Ëdm_cÚŒŞ_İtiÚ
(
SANE_HªdË
 
hªdË
, 
SANE_IÁ
 
İtiÚ
, 
SANE_AùiÚ
 
aùiÚ
, *
v®ue
, SANE_IÁ *
£t_»suÉ
)

474 
Ëdm_£ssiÚ
 *
ps
 = (Ëdm_£ssiÚ *)
hªdË
;

475 
SANE_IÁ
 *
št_v®ue
 = 
v®ue
, 
m£t_»suÉ
=0;

476 
i
, 
¡©
=
SANE_STATUS_INVAL
;

478 
İtiÚ
)

480 
LEDM_OPTION_COUNT
:

481 ià(
aùiÚ
 =ğ
SANE_ACTION_GET_VALUE
)

483 *
št_v®ue
 = 
LEDM_OPTION_MAX
;

484 
¡©
 = 
SANE_STATUS_GOOD
;

487 
LEDM_OPTION_SCAN_MODE
:

488 if(
aùiÚ
 =ğ
SANE_ACTION_GET_VALUE
)

490 
i
=0; 
ps
->
sÿnModeLi¡
[i]; i++)

492 if(
ps
->
cu¼’tSÿnMode
 =ğps->
sÿnModeM­
[
i
])

494 
	`¡rıy
(
v®ue
, 
ps
->
sÿnModeLi¡
[
i
]);

495 
¡©
 = 
SANE_STATUS_GOOD
;

500 ià(
aùiÚ
 =ğ
SANE_ACTION_SET_VALUE
)

502 
i
=0; 
ps
->
sÿnModeLi¡
[i]; i++)

504 ià(
	`¡rÿ£cmp
(
ps
->
sÿnModeLi¡
[
i
], 
v®ue
) == 0)

506 
ps
->
cu¼’tSÿnMode
 =…s->
sÿnModeM­
[
i
];

507 
	`£t_sÿn_mode_side_efãùs
(
ps
,…s->
cu¼’tSÿnMode
);

508 
m£t_»suÉ
 |ğ
SANE_INFO_RELOAD_PARAMS
 | 
SANE_INFO_RELOAD_OPTIONS
;

509 
¡©
 = 
SANE_STATUS_GOOD
;

516 
ps
->
cu¼’tSÿnMode
 =…s->
sÿnModeM­
[0];

517 
	`£t_sÿn_mode_side_efãùs
(
ps
,…s->
cu¼’tSÿnMode
);

518 
¡©
 = 
SANE_STATUS_GOOD
;

521 
LEDM_OPTION_INPUT_SOURCE
:

522 ià(
aùiÚ
 =ğ
SANE_ACTION_GET_VALUE
)

524 
i
=0; 
ps
->
šputSourûLi¡
[i]; i++)

526 ià(
ps
->
cu¼’tIÅutSourû
 =ğps->
šputSourûM­
[
i
])

528 
	`¡rıy
(
v®ue
, 
ps
->
šputSourûLi¡
[
i
]);

529 
¡©
 = 
SANE_STATUS_GOOD
;

534 ià(
aùiÚ
 =ğ
SANE_ACTION_SET_VALUE
)

536 
i
=0; 
ps
->
šputSourûLi¡
[i]; i++)

538 ià(
	`¡rÿ£cmp
(
ps
->
šputSourûLi¡
[
i
], 
v®ue
) == 0)

540 
ps
->
cu¼’tIÅutSourû
 =…s->
šputSourûM­
[
i
];

541 
	`£t_šput_sourû_side_efãùs
(
ps
,…s->
cu¼’tIÅutSourû
);

542 if(
ps
->
cu¼’tIÅutSourû
 =ğ
IS_PLATEN
)

544 
i
 = 
£ssiÚ
->
¶©’_»sŞutiÚLi¡
[0] + 1;

545 
i
--è
£ssiÚ
->
»sŞutiÚLi¡
[i] = sessiÚ->
¶©’_»sŞutiÚLi¡
[i];

549 
i
 = 
£ssiÚ
->
adf_»sŞutiÚLi¡
[0] + 1;

550 
i
--è
£ssiÚ
->
»sŞutiÚLi¡
[i] = sessiÚ->
adf_»sŞutiÚLi¡
[i];

552 
ps
->
cu¼’tResŞutiÚ
 = 
£ssiÚ
->
»sŞutiÚLi¡
[1];

558 ià(
i
>1)

560 if(
£ssiÚ
->
¶©’_»sŞutiÚLi¡
[1] !ğ£ssiÚ->
adf_»sŞutiÚLi¡
[1])

561 
ps
->
cu¼’tResŞutiÚ
 = 
£ssiÚ
->
»sŞutiÚLi¡
[1];

563 
m£t_»suÉ
 |ğ
SANE_INFO_RELOAD_PARAMS
 | 
SANE_INFO_RELOAD_OPTIONS
;

564 
¡©
 = 
SANE_STATUS_GOOD
;

569 
ps
->
cu¼’tIÅutSourû
 =…s->
šputSourûM­
[0];

570 
	`£t_šput_sourû_side_efãùs
(
ps
,…s->
cu¼’tIÅutSourû
);

571 
m£t_»suÉ
 |ğ
SANE_INFO_RELOAD_PARAMS
 | 
SANE_INFO_RELOAD_OPTIONS
;

572 
¡©
 = 
SANE_STATUS_GOOD
;

575 
LEDM_OPTION_SCAN_RESOLUTION
:

576 ià(
aùiÚ
 =ğ
SANE_ACTION_GET_VALUE
)

578 *
št_v®ue
 = 
ps
->
cu¼’tResŞutiÚ
;

579 
¡©
 = 
SANE_STATUS_GOOD
;

581 ià(
aùiÚ
 =ğ
SANE_ACTION_SET_VALUE
)

583 
i
=1; i <ğ
ps
->
»sŞutiÚLi¡
[0]; i++)

585 ià(
ps
->
»sŞutiÚLi¡
[
i
] =ğ*
št_v®ue
)

587 
ps
->
cu¼’tResŞutiÚ
 = *
št_v®ue
;

588 if(
ps
->
cu¼’tResŞutiÚ
 =ğ4800è
	`S’dSÿnEv’t
Õs->
uri
, 
EVENT_SIZE_WARNING
);

589 
m£t_»suÉ
 |ğ
SANE_INFO_RELOAD_PARAMS
;

590 
¡©
 = 
SANE_STATUS_GOOD
;

594 ià(
¡©
 !ğ
SANE_STATUS_GOOD
)

596 
ps
->
cu¼’tResŞutiÚ
 =…s->
»sŞutiÚLi¡
[1];

597 
¡©
 = 
SANE_STATUS_GOOD
;

602 
ps
->
cu¼’tResŞutiÚ
 = 75;

603 
¡©
 = 
SANE_STATUS_GOOD
;

606 
LEDM_OPTION_CONTRAST
:

607 ià(
aùiÚ
 =ğ
SANE_ACTION_GET_VALUE
)

609 *
št_v®ue
 = 
ps
->
cu¼’tCÚŒa¡
;

610 
¡©
 = 
SANE_STATUS_GOOD
;

612 ià(
aùiÚ
 =ğ
SANE_ACTION_SET_VALUE
)

614 ià(*
št_v®ue
 >ğ
LEDM_CONTRAST_MIN
 && *št_v®u<ğ
LEDM_CONTRAST_MAX
)

616 
ps
->
cu¼’tCÚŒa¡
 = *
št_v®ue
;

620 
ps
->
cu¼’tCÚŒa¡
 = 
LEDM_CONTRAST_DEFAULT
;

622 
m£t_»suÉ
 |ğ
SANE_INFO_RELOAD_PARAMS
;

623 
¡©
 = 
SANE_STATUS_GOOD
;

627 
ps
->
cu¼’tCÚŒa¡
 = 
LEDM_CONTRAST_DEFAULT
;

628 
¡©
 = 
SANE_STATUS_GOOD
;

631 
LEDM_OPTION_BRIGHTNESS
:

632 ià(
aùiÚ
 =ğ
SANE_ACTION_GET_VALUE
)

634 *
št_v®ue
 = 
ps
->
cu¼’tBrighŠess
;

635 
¡©
 = 
SANE_STATUS_GOOD
;

637 ià(
aùiÚ
 =ğ
SANE_ACTION_SET_VALUE
)

639 ià(*
št_v®ue
 >ğ
LEDM_BRIGHTNESS_MIN
 && *št_v®u<ğ
LEDM_BRIGHTNESS_MAX
)

641 
ps
->
cu¼’tBrighŠess
 = *
št_v®ue
;

645 
ps
->
cu¼’tBrighŠess
 = 
LEDM_BRIGHTNESS_DEFAULT
;

647 
¡©
 = 
SANE_STATUS_GOOD
;

651 
ps
->
cu¼’tBrighŠess
 = 
LEDM_BRIGHTNESS_DEFAULT
;

652 
¡©
 = 
SANE_STATUS_GOOD
;

655 
LEDM_OPTION_COMPRESSION
:

656 ià(
aùiÚ
 =ğ
SANE_ACTION_GET_VALUE
)

658 
i
=0; 
ps
->
com´essiÚLi¡
[i]; i++)

660 ià(
ps
->
cu¼’tCom´essiÚ
 =ğps->
com´essiÚM­
[
i
])

662 
	`¡rıy
(
v®ue
, 
ps
->
com´essiÚLi¡
[
i
]);

663 
¡©
 = 
SANE_STATUS_GOOD
;

668 ià(
aùiÚ
 =ğ
SANE_ACTION_SET_VALUE
)

670 
i
=0; 
ps
->
com´essiÚLi¡
[i]; i++)

672 ià(
	`¡rÿ£cmp
(
ps
->
com´essiÚLi¡
[
i
], 
v®ue
) == 0)

674 
ps
->
cu¼’tCom´essiÚ
 =…s->
com´essiÚM­
[
i
];

675 
¡©
 = 
SANE_STATUS_GOOD
;

682 
ps
->
cu¼’tCom´essiÚ
 = 
SF_JPEG
;

683 
¡©
 = 
SANE_STATUS_GOOD
;

686 
LEDM_OPTION_JPEG_QUALITY
:

687 ià(
aùiÚ
 =ğ
SANE_ACTION_GET_VALUE
)

689 *
št_v®ue
 = 
ps
->
cu¼’tJ³gQu®™y
;

690 
¡©
 = 
SANE_STATUS_GOOD
;

692 ià(
aùiÚ
 =ğ
SANE_ACTION_SET_VALUE
)

694 ià(*
št_v®ue
 >ğ
MIN_JPEG_COMPRESSION_FACTOR
 && *št_v®u<ğ
MAX_JPEG_COMPRESSION_FACTOR
)

696 
ps
->
cu¼’tJ³gQu®™y
 = *
št_v®ue
;

697 
¡©
 = 
SANE_STATUS_GOOD
;

703 
ps
->
cu¼’tJ³gQu®™y
 = 
SAFER_JPEG_COMPRESSION_FACTOR
;

704 
¡©
 = 
SANE_STATUS_GOOD
;

707 
LEDM_OPTION_TL_X
:

708 ià(
aùiÚ
 =ğ
SANE_ACTION_GET_VALUE
)

710 *
št_v®ue
 = 
ps
->
cu¼’tTlx
;

711 
¡©
 = 
SANE_STATUS_GOOD
;

713 ià(
aùiÚ
 =ğ
SANE_ACTION_SET_VALUE
)

715 ià(*
št_v®ue
 >ğ
ps
->
xRªge
.
mš
 && *št_v®u<ğps->xRªge.
max
)

717 
ps
->
cu¼’tTlx
 = *
št_v®ue
;

718 
m£t_»suÉ
 |ğ
SANE_INFO_RELOAD_PARAMS
;

719 
¡©
 = 
SANE_STATUS_GOOD
;

725 
ps
->
cu¼’tTlx
 =…s->
xRªge
.
mš
;

726 
¡©
 = 
SANE_STATUS_GOOD
;

729 
LEDM_OPTION_TL_Y
:

730 ià(
aùiÚ
 =ğ
SANE_ACTION_GET_VALUE
)

732 *
št_v®ue
 = 
ps
->
cu¼’tTly
;

733 
¡©
 = 
SANE_STATUS_GOOD
;

735 ià(
aùiÚ
 =ğ
SANE_ACTION_SET_VALUE
)

737 ià(*
št_v®ue
 >ğ
ps
->
yRªge
.
mš
 && *št_v®u<ğps->yRªge.
max
)

740 
ps
->
cu¼’tTly
 = *
št_v®ue
;

741 
m£t_»suÉ
 |ğ
SANE_INFO_RELOAD_PARAMS
;

742 
¡©
 = 
SANE_STATUS_GOOD
;

748 
ps
->
cu¼’tTly
 =…s->
yRªge
.
mš
;

749 
¡©
 = 
SANE_STATUS_GOOD
;

752 
LEDM_OPTION_BR_X
:

753 ià(
aùiÚ
 =ğ
SANE_ACTION_GET_VALUE
)

755 *
št_v®ue
 = 
ps
->
cu¼’tBrx
;

756 
¡©
 = 
SANE_STATUS_GOOD
;

758 ià(
aùiÚ
 =ğ
SANE_ACTION_SET_VALUE
)

760 ià(*
št_v®ue
 >ğ
ps
->
brxRªge
.
mš
 && *št_v®u<ğps->brxRªge.
max
)

762 
ps
->
cu¼’tBrx
 = *
št_v®ue
;

763 
m£t_»suÉ
 |ğ
SANE_INFO_RELOAD_PARAMS
;

764 
¡©
 = 
SANE_STATUS_GOOD
;

770 
ps
->
cu¼’tBrx
 =…s->
brxRªge
.
max
;

771 
¡©
 = 
SANE_STATUS_GOOD
;

774 
LEDM_OPTION_BR_Y
:

775 ià(
aùiÚ
 =ğ
SANE_ACTION_GET_VALUE
)

777 *
št_v®ue
 = 
ps
->
cu¼’tBry
;

778 
¡©
 = 
SANE_STATUS_GOOD
;

780 ià(
aùiÚ
 =ğ
SANE_ACTION_SET_VALUE
)

782 ià(*
št_v®ue
 >ğ
ps
->
bryRªge
.
mš
 && *št_v®u<ğps->bryRªge.
max
)

784 
ps
->
cu¼’tBry
 = *
št_v®ue
;

785 
m£t_»suÉ
 |ğ
SANE_INFO_RELOAD_PARAMS
;

786 
¡©
 = 
SANE_STATUS_GOOD
;

792 
ps
->
cu¼’tBry
 =…s->
bryRªge
.
max
;

793 
¡©
 = 
SANE_STATUS_GOOD
;

800 ià(
£t_»suÉ
)

801 *
£t_»suÉ
 = 
m£t_»suÉ
;

803 ià(
¡©
 !ğ
SANE_STATUS_GOOD
)

805 
	`BUG
("cÚŒŞ_İtiÚ faed: o±iÚ=% aùiÚ=%s\n", 
ps
->
İtiÚ
[İtiÚ].
Çme
, 
aùiÚ
==
SANE_ACTION_GET_VALUE
 ? "g‘" :‡ùiÚ==
SANE_ACTION_SET_VALUE
 ? "set" : "auto");

808  
¡©
;

809 
	}
}

811 
SANE_Stus
 
	$Ëdm_g‘_·¿m‘”s
(
SANE_HªdË
 
hªdË
, 
SANE_P¬am‘”s
 *
·¿ms
)

813 
Ëdm_£ssiÚ
 *
ps
 = (Ëdm_£ssiÚ *)
hªdË
;

815 
	`£t_ex‹Ás
(
ps
);

818 
	`bb_g‘_·¿m‘”s
(
ps
, 
·¿ms
,…s->
_hªdË
 ? 
SPO_STARTED
 : 
SPO_BEST_GUESS
);

820 
	`DBG8
("sane_hpaio_get_parameters(): format=%d,†ast_frame=%d,†ines=%d, depth=%d,…ixels_per_line=%d, bytes_per_line=%d\n",

821 
·¿ms
->
fÜm©
,…¬ams->
Ï¡_äame
,…¬ams->
lšes
,…¬ams->
d•th
,…¬ams->
pix–s_³r_lše
,…¬ams->
by‹s_³r_lše
);

823  
SANE_STATUS_GOOD
;

824 
	}
}

826 
SANE_Stus
 
	$Ëdm_¡¬t
(
SANE_HªdË
 
hªdË
)

828 
Ëdm_£ssiÚ
 *
ps
 = (Ëdm_£ssiÚ *)
hªdË
;

829 
SANE_P¬am‘”s
 
µ
;

830 
IP_IMAGE_TRAITS
 
Œa™s
;

831 
IP_XFORM_SPEC
 
xfÜms
[
IP_MAX_XFORMS
], *
pXfÜm
=xforms;

832 
¡©
, 
»t
;

834 
	`DBG8
("sane_hpaio_start()\n");

836 
ps
 -> 
u£r_ÿnûl
 = 0;

837 
ps
 -> 
út
 = 0;

838 
ps
 -> 
šdex
 = 0;

840 ià(
	`£t_ex‹Ás
(
ps
))

842 
¡©
 = 
SANE_STATUS_INVAL
;

843 
bugout
;

847 ià(
ps
->
cu¼’tIÅutSourû
==
IS_ADF
 ||…s->cu¼’tIÅutSourû ==
IS_ADF_DUPLEX
)

849 
»t
 = 
	`bb_is_·³r_š_adf
(
ps
);

850 ià(
»t
 == 0)

852 
¡©
 = 
SANE_STATUS_NO_DOCS
;

853 
	`S’dSÿnEv’t
 (
ps
->
uri
, 
EVENT_SCAN_ADF_NO_DOCS
);

854 
bugout
;

856 ià(
»t
 < 0)

858 
¡©
 = 
SANE_STATUS_IO_ERROR
;

859 
bugout
;

864 
¡©
 = 
	`bb_¡¬t_sÿn
(
ps
);

865 ià(
¡©
 !ğ
SANE_STATUS_GOOD
)

866 
bugout
;

868 if(
ps
->
u£r_ÿnûl
)

870 
¡©
 = 
SANE_STATUS_GOOD
 ;

871 
bugout
;

874 
	`S’dSÿnEv’t
(
ps
->
uri
, 
EVENT_START_SCAN_JOB
);

876 
	`mem£t
(
xfÜms
, 0, (xforms));

879 ià(
ps
->
cu¼’tSÿnMode
 =ğ
CE_COLOR8
 ||…s->cu¼’tSÿnMod=ğ
CE_GRAY8
)

881 
ps
->
cu¼’tCom´essiÚ
)

883 
SF_JPEG
:

884 
pXfÜm
->
aXfÜmInfo
[
IP_JPG_DECODE_FROM_DENALI
].
dwÜd
 = 0;

885 
	`ADD_XFORM
(
X_JPG_DECODE
);

886 
pXfÜm
->
aXfÜmInfo
[
IP_CNV_COLOR_SPACE_WHICH_CNV
].
dwÜd
 = 
IP_CNV_YCC_TO_SRGB
;

887 
pXfÜm
->
aXfÜmInfo
[
IP_CNV_COLOR_SPACE_GAMMA
].
dwÜd
 = 0x00010000;

888 
	`ADD_XFORM
(
X_CNV_COLOR_SPACE
);

890 
SF_RAW
:

897 
ps
->
cu¼’tCom´essiÚ
)

899 
SF_JPEG
:

900 
pXfÜm
->
aXfÜmInfo
[
IP_JPG_DECODE_FROM_DENALI
].
dwÜd
 = 0;

901 
	`ADD_XFORM
(
X_JPG_DECODE
);

902 
pXfÜm
->
aXfÜmInfo
[
IP_GRAY_2_BI_THRESHOLD
].
dwÜd
 = 127;

903 
	`ADD_XFORM
(
X_GRAY_2_BI
);

905 
SF_RAW
:

906 
pXfÜm
->
aXfÜmInfo
[
IP_GRAY_2_BI_THRESHOLD
].
dwÜd
 = 127;

907 
	`ADD_XFORM
(
X_GRAY_2_BI
);

914 
pXfÜm
->
aXfÜmInfo
[
IP_CROP_LEFT
].
dwÜd
 = 0;

915 
pXfÜm
->
aXfÜmInfo
[
IP_CROP_RIGHT
].
dwÜd
 = 0;

916 
pXfÜm
->
aXfÜmInfo
[
IP_CROP_TOP
].
dwÜd
 = 0;

917 
pXfÜm
->
aXfÜmInfo
[
IP_CROP_MAXOUTROWS
].
dwÜd
 = 0;

918 
	`ADD_XFORM
(
X_CROP
);

921 
pXfÜm
->
aXfÜmInfo
[
IP_PAD_LEFT
].
dwÜd
 = 0;

922 
pXfÜm
->
aXfÜmInfo
[
IP_PAD_RIGHT
].
dwÜd
 = 0;

923 
pXfÜm
->
aXfÜmInfo
[
IP_PAD_TOP
].
dwÜd
 = 0;

924 
pXfÜm
->
aXfÜmInfo
[
IP_PAD_BOTTOM
].
dwÜd
 = 0;

925 
pXfÜm
->
aXfÜmInfo
[
IP_PAD_VALUE
].
dwÜd
 = 
ps
->
cu¼’tSÿnMode
 =ğ
CE_K1
 ? 0 : -1;

926 
pXfÜm
->
aXfÜmInfo
[
IP_PAD_MIN_HEIGHT
].
dwÜd
 = 0;

927 
	`ADD_XFORM
(
X_PAD
);

930 ià((
»t
 = 
	`O³n
(
pXfÜm
-
xfÜms
, xfÜms, 0, &
ps
->
_hªdË
)è!ğ
IP_DONE
)

932 
¡©
 = 
SANE_STATUS_INVAL
;

933 
bugout
;

937 ià(
ps
->
cu¼’tCom´essiÚ
 =ğ
SF_RAW
)

938 
	`bb_g‘_·¿m‘”s
(
ps
, &
µ
, 
SPO_STARTED_JR
);

940 
	`bb_g‘_·¿m‘”s
(
ps
, &
µ
, 
SPO_BEST_GUESS
);

941 
Œa™s
.
iPix–sP”Row
 = 
µ
.
pix–s_³r_lše
;

942 
ps
->
cu¼’tSÿnMode
)

944 
CE_K1
:

945 
CE_GRAY8
:

946 
Œa™s
.
iB™sP”Pix–
 = 8;

948 
CE_COLOR8
:

950 
Œa™s
.
iB™sP”Pix–
 = 24;

953 
Œa™s
.
lHÜizDPI
 = 
ps
->
cu¼’tResŞutiÚ
 << 16;

954 
Œa™s
.
lV”tDPI
 = 
ps
->
cu¼’tResŞutiÚ
 << 16;

955 
Œa™s
.
lNumRows
 = 
µ
.
lšes
;

956 
Œa™s
.
iNumPages
 = 1;

957 
Œa™s
.
iPageNum
 = 1;

958 
Œa™s
.
iCompÚ’tsP”Pix–
 = (Ñ¿™s.
iB™sP”Pix–
 % 3) ? 1 : 3);

959 
	`S‘DeçuÉIÅutT¿™s
(
ps
->
_hªdË
, &
Œa™s
);

962 ià(
ps
->
cu¼’tCom´essiÚ
 =ğ
SF_JPEG
)

965 
	`ResuÉMask
(
ps
->
_hªdË
, 
IP_PARSED_HEADER
);

970 
»t
 = 
	`g‘__d©a
(
ps
, 
NULL
, 0, NULL);

972 ià(
»t
 & (
IP_INPUT_ERROR
 | 
IP_FATAL_ERROR
 | 
IP_DONE
))

974 
¡©
 = 
SANE_STATUS_IO_ERROR
;

975 
bugout
;

978 ià(
»t
 & 
IP_PARSED_HEADER
)

980 
	`G‘ImageT¿™s
(
ps
->
_hªdË
, 
NULL
, &ps->
image_Œa™s
);

981 
	`ResuÉMask
(
ps
->
_hªdË
, 0);

987 
	`G‘ImageT¿™s
(
ps
->
_hªdË
, 
NULL
, &ps->
image_Œa™s
);

989 
¡©
 = 
SANE_STATUS_GOOD
;

991 
bugout
:

992 ià(
¡©
 !ğ
SANE_STATUS_GOOD
)

994 ià(
ps
->
_hªdË
)

996 
	`Clo£
(
ps
->
_hªdË
);

997 
ps
->
_hªdË
 = 0;

999 
	`bb_’d_sÿn
(
ps
, 
¡©
 =ğ
SANE_STATUS_IO_ERROR
 ? 1: 0);

1001  
¡©
;

1002 
	}
}

1004 
SANE_Stus
 
	$Ëdm_»ad
(
SANE_HªdË
 
hªdË
, 
SANE_By‹
 *
d©a
, 
SANE_IÁ
 
maxL’gth
, SANE_IÁ *
Ëngth
)

1006 
Ëdm_£ssiÚ
 *
ps
 = (Ëdm_£ssiÚ *)
hªdË
;

1007 
»t
, 
¡©
=
SANE_STATUS_IO_ERROR
;

1009 if(
ps
->
u£r_ÿnûl
)

1011 
	`S’dSÿnEv’t
(
ps
->
uri
, 
EVENT_SCAN_CANCEL
);

1012  
SANE_STATUS_CANCELLED
;

1015 
»t
 = 
	`g‘__d©a
(
ps
, 
d©a
, 
maxL’gth
, 
Ëngth
);

1017 if(
»t
 & (
IP_INPUT_ERROR
 | 
IP_FATAL_ERROR
))

1019 
bugout
;

1022 if(
»t
==
IP_DONE
)

1024 
¡©
 = 
SANE_STATUS_EOF
;

1025 
	`S’dSÿnEv’t
(
ps
->
uri
, 
EVENT_END_SCAN_JOB
);

1027 
¡©
ğ
SANE_STATUS_GOOD
;

1029 
bugout
:

1030 ià(
¡©
 !ğ
SANE_STATUS_GOOD
)

1032 ià(
ps
->
_hªdË
)

1035 
	`Clo£
(
ps
->
_hªdË
);

1036 
ps
->
_hªdË
 = 0;

1038 
	`bb_’d_·ge
(
ps
, 0);

1041 
	`DBG8
("-§Ã_h·io_»ad(èouut=%°by‹s_»ad=%d maxL’gth=%d stus=%d\n", 
d©a
, *
Ëngth
, 
maxL’gth
, 
¡©
);

1043  
¡©
;

1044 
	}
}

1046 
	$Ëdm_ÿnûl
(
SANE_HªdË
 
hªdË
)

1048 
Ëdm_£ssiÚ
 *
ps
 = (Ëdm_£ssiÚ *)
hªdË
;

1050 
	`DBG8
("sane_hpaio_cancel()\n");

1052 
ps
 -> 
u£r_ÿnûl
 = 1;

1056 ià(
ps
->
_hªdË
)

1058 
	`Clo£
(
ps
->
_hªdË
);

1059 
ps
->
_hªdË
 = 0;

1061 
	`bb_’d_sÿn
(
ps
, 0);

1062 
	}
}

1064 
	$Ëdm_şo£
(
SANE_HªdË
 
hªdË
)

1066 
Ëdm_£ssiÚ
 *
ps
 = (Ëdm_£ssiÚ *)
hªdË
;

1068 ià(
ps
 =ğ
NULL
 ||… !ğ
£ssiÚ
)

1070 
	`BUG
("invalid sane_close\n");

1074 
	`bb_şo£
(
ps
);

1076 ià(
ps
->
dd
 > 0)

1077 
	`hpmud_şo£_deviû
(
ps
->
dd
);

1079 
	`ä“
(
ps
);

1080 
£ssiÚ
 = 
NULL
;

1081 
	}
}

	@scan/sane/ledm.h

28 #iâdeà
_LEDM_H


29 
	#_LEDM_H


	)

31 
	~"§Ã.h
"

33 
SANE_Stus
 
Ëdm_İ’
(
SANE_SŒšg_CÚ¡
 
deviû
, 
SANE_HªdË
 *
hªdË
);

34 
Ëdm_şo£
(
SANE_HªdË
 
hªdË
);

35 cÚ¡ 
SANE_O±iÚ_DesütÜ
 * 
Ëdm_g‘_İtiÚ_desütÜ
(
SANE_HªdË
 
hªdË
, 
SANE_IÁ
 
İtiÚ
);

36 
SANE_Stus
 
Ëdm_cÚŒŞ_İtiÚ
(
SANE_HªdË
 
hªdË
, 
SANE_IÁ
 
İtiÚ
, 
SANE_AùiÚ
 
aùiÚ
, *
v®ue
, SANE_IÁ *
šfo
);

37 
SANE_Stus
 
Ëdm_g‘_·¿m‘”s
(
SANE_HªdË
 
hªdË
, 
SANE_P¬am‘”s
 *
·¿ms
);

38 
SANE_Stus
 
Ëdm_¡¬t
(
SANE_HªdË
 
hªdË
);

39 
SANE_Stus
 
Ëdm_»ad
(
SANE_HªdË
 
hªdË
, 
SANE_By‹
 *
d©a
, 
SANE_IÁ
 
maxL’gth
, SANE_IÁ *
Ëngth
);

40 
Ëdm_ÿnûl
(
SANE_HªdË
 
hªdË
);

	@scan/sane/ledmi.h

29 #iâdeà
_LEDMI_H


30 
	#_LEDMI_H


	)

32 
	~"§Ã.h
"

33 
	~"hp.h
"

34 
	~"hpmud.h
"

36 
	#LEDM_CONTRAST_MIN
 0

	)

37 
	#LEDM_CONTRAST_MAX
 2000

	)

38 
	#LEDM_CONTRAST_DEFAULT
 1000

	)

39 
	#LEDM_BRIGHTNESS_MIN
 0

	)

40 
	#LEDM_BRIGHTNESS_MAX
 2000

	)

41 
	#LEDM_BRIGHTNESS_DEFAULT
 1000

	)

43 
	#MM_PER_INCH
 25.4

	)

45 
	eLEDM_OPTION_NUMBER


47 
	mLEDM_OPTION_COUNT
 = 0,

48 
	mLEDM_OPTION_GROUP_SCAN_MODE
,

49 
	mLEDM_OPTION_SCAN_MODE
,

50 
	mLEDM_OPTION_SCAN_RESOLUTION
,

51 
	mLEDM_OPTION_INPUT_SOURCE
,

52 
	mLEDM_OPTION_GROUP_ADVANCED
,

53 
	mLEDM_OPTION_BRIGHTNESS
,

54 
	mLEDM_OPTION_CONTRAST
,

55 
	mLEDM_OPTION_COMPRESSION
,

56 
	mLEDM_OPTION_JPEG_QUALITY
,

57 
	mLEDM_OPTION_GROUP_GEOMETRY
,

58 
	mLEDM_OPTION_TL_X
,

59 
	mLEDM_OPTION_TL_Y
,

60 
	mLEDM_OPTION_BR_X
,

61 
	mLEDM_OPTION_BR_Y
,

62 
	mLEDM_OPTION_MAX


65 
	#MAX_LIST_SIZE
 32

	)

66 
	#MAX_STRING_SIZE
 32

	)

68 
	eSCAN_FORMAT


70 
	mSF_RAW
 = 1,

71 
	mSF_JPEG
,

72 
	mSF_MAX


75 
	eINPUT_SOURCE


77 
	mIS_PLATEN
 = 1,

78 
	mIS_ADF
,

79 
	mIS_ADF_DUPLEX
,

80 
	mIS_MAX


83 
	eCOLOR_ENTRY


85 
	mCE_K1
 = 1,

86 
	mCE_GRAY8
,

87 
	mCE_COLOR8
,

88 
	mCE_MAX


91 
	eSCAN_PARAM_OPTION


93 
	mSPO_BEST_GUESS
 = 0,

94 
	mSPO_STARTED
 = 1,

95 
	mSPO_STARTED_JR
 = 2,

98 
	sËdm_£ssiÚ


100 *
	mg
;

101 
HPMUD_DEVICE
 
	mdd
;

102 
HPMUD_CHANNEL
 
	mcd
;

103 
	muri
[
HPMUD_LINE_SIZE
];

104 
	mmod–
[
HPMUD_LINE_SIZE
];

105 
	mu¾
[256];

106 
	msÿn_ty³
;

107 
	mu£r_ÿnûl
;

109 
IP_IMAGE_TRAITS
 
	mimage_Œa™s
;

111 
SANE_O±iÚ_DesütÜ
 
	mİtiÚ
[
LEDM_OPTION_MAX
];

113 
SANE_SŒšg_CÚ¡
 
	mšputSourûLi¡
[
IS_MAX
];

114 
INPUT_SOURCE
 
	mšputSourûM­
[
IS_MAX
];

115 
INPUT_SOURCE
 
	mcu¼’tIÅutSourû
;

117 
SANE_IÁ
 
	m»sŞutiÚLi¡
[
MAX_LIST_SIZE
];

118 
SANE_IÁ
 
	mcu¼’tResŞutiÚ
;

120 
SANE_Rªge
 
	mcÚŒa¡Rªge
;

121 
SANE_IÁ
 
	mcu¼’tCÚŒa¡
;

123 
SANE_SŒšg_CÚ¡
 
	msÿnModeLi¡
[
CE_MAX
];

124 
COLOR_ENTRY
 
	msÿnModeM­
[
CE_MAX
];

125 
COLOR_ENTRY
 
	mcu¼’tSÿnMode
;

127 
SANE_SŒšg_CÚ¡
 
	mcom´essiÚLi¡
[
SF_MAX
];

128 
SCAN_FORMAT
 
	mcom´essiÚM­
[
SF_MAX
];

129 
SCAN_FORMAT
 
	mcu¼’tCom´essiÚ
;

131 
SANE_Rªge
 
	mj³gQu®™yRªge
;

132 
SANE_IÁ
 
	mcu¼’tJ³gQu®™y
;

134 
SANE_Rªge
 
	mxRªge
, 
	myRªge
, 
	mbrxRªge
, 
	mbryRªge
;

135 
SANE_Fixed
 
	mcu¼’tTlx
, 
	mcu¼’tTly
, 
	mcu¼’tBrx
, 
	mcu¼’tBry
;

136 
SANE_Fixed
 
	mefãùiveTlx
, 
	mefãùiveTly
, 
	mefãùiveBrx
, 
	mefãùiveBry
;

137 
SANE_Fixed
 
	mmš_width
, 
	mmš_height
;

138 
SANE_IÁ
 
	m¶©’_»sŞutiÚLi¡
[
MAX_LIST_SIZE
];

140 
SANE_Fixed
 
	m¶©’_mš_width
, 
	m¶©’_mš_height
;

141 
SANE_Rªge
 
	m¶©’_xRªge
, 
	m¶©’_yRªge
, 
	m¶©’_brxRªge
, 
	m¶©’_bryRªge
;

142 
SANE_Fixed
 
	madf_mš_width
, 
	madf_mš_height
;

143 
SANE_Rªge
 
	madf_xRªge
, 
	madf_yRªge
, 
	madf_brxRªge
, 
	madf_bryRªge
;

144 
SANE_IÁ
 
	madf_»sŞutiÚLi¡
[
MAX_LIST_SIZE
];

146 
SANE_Rªge
 
	mbrighŠessRªge
;

147 
SANE_IÁ
 
	mcu¼’tBrighŠess
;

149 
IP_HANDLE
 
	m_hªdË
;

151 
	mšdex
;

152 
	mút
;

153 
	mbuf
[32768];

155 *
	mbb_£ssiÚ
;

157 
	mjob_id
;

158 
	m·ge_id
;

161 
bb_İ’
(
Ëdm_£ssiÚ
*);

162 
bb_şo£
(
Ëdm_£ssiÚ
*);

163 
bb_g‘_·¿m‘”s
(
Ëdm_£ssiÚ
*, 
SANE_P¬am‘”s
*, );

164 
bb_is_·³r_š_adf
();

165 
SANE_Stus
 
bb_¡¬t_sÿn
(
Ëdm_£ssiÚ
*);

166 
bb_g‘_image_d©a
(
Ëdm_£ssiÚ
*, );

167 
bb_’d_·ge
(
Ëdm_£ssiÚ
*, );

168 
bb_’d_sÿn
(
Ëdm_£ssiÚ
* , );

	@scan/sane/marvell.c

28 #iâdeà
_GNU_SOURCE


29 
	#_GNU_SOURCE


	)

32 
	~<sys/sock‘.h
>

33 
	~<Ãtdb.h
>

34 
	~<¡d¬g.h
>

35 
	~<sy¦og.h
>

36 
	~<¡dio.h
>

37 
	~<¡ršg.h
>

38 
	~<sys/ty³s.h
>

39 
	~<fú.h
>

40 
	~<uni¡d.h
>

41 
	~<m©h.h
>

42 
	~<dlfú.h
>

43 
	~"§Ã.h
"

44 
	~"§Ãİts.h
"

45 
	~"hpmud.h
"

46 
	~"hp.h
"

47 
	~"commÚ.h
"

48 
	~"m¬v–l.h
"

49 
	~"m¬v–li.h
"

50 
	~"io.h
"

51 
	~"uts.h
"

53 
	#DEBUG_DECLARE_ONLY


	)

54 
	~"§Ãi_debug.h
"

56 
m¬v–l_£ssiÚ
 *
	g£ssiÚ
 = 
NULL
;

58 
	$bb_lßd
(
m¬v–l_£ssiÚ
 *
ps
, cÚ¡ *
so
)

60 
¡©
=1;

63 ià((
ps
->
hpmud_hªdË
 = 
	`lßd_lib¿ry
("libhpmud.so")è=ğ
NULL
)

65 ià((
ps
->
hpmud_hªdË
 = 
	`lßd_lib¿ry
("libhpmud.so.0")è=ğ
NULL
)

66 
bugout
;

70 ià((
ps
->
m©h_hªdË
 = 
	`lßd_lib¿ry
("libm.so")è=ğ
NULL
)

72 ià((
ps
->
m©h_hªdË
 = 
	`lßd_lib¿ry
("libm.so.6")è=ğ
NULL
)

73 
bugout
;

76 ià((
ps
->
bb_hªdË
 = 
	`lßd_¶ugš_lib¿ry
(
UTILS_SCAN_PLUGIN_LIBRARY
, 
so
)è=ğ
NULL
)

78 
	`S’dSÿnEv’t
(
ps
->
uri
, 
EVENT_PLUGIN_FAIL
);

79 
bugout
;

82 ià((
ps
->
bb_İ’
 = 
	`g‘_lib¿ry_symbŞ
Õs->
bb_hªdË
, "bb_İ’")è=ğ
NULL
)

83 
bugout
;

85 ià((
ps
->
bb_şo£
 = 
	`g‘_lib¿ry_symbŞ
Õs->
bb_hªdË
, "bb_şo£")è=ğ
NULL
)

86 
bugout
;

88 ià((
ps
->
bb_g‘_·¿m‘”s
 = 
	`g‘_lib¿ry_symbŞ
Õs->
bb_hªdË
, "bb_g‘_·¿m‘”s")è=ğ
NULL
)

89 
bugout
;

91 ià((
ps
->
bb_is_·³r_š_adf
 = 
	`g‘_lib¿ry_symbŞ
Õs->
bb_hªdË
, "bb_is_·³r_š_adf")è=ğ
NULL
)

92 
bugout
;

94 ià((
ps
->
bb_¡¬t_sÿn
 = 
	`g‘_lib¿ry_symbŞ
Õs->
bb_hªdË
, "bb_¡¬t_sÿn")è=ğ
NULL
)

95 
bugout
;

97 ià((
ps
->
bb_’d_sÿn
 = 
	`g‘_lib¿ry_symbŞ
Õs->
bb_hªdË
, "bb_’d_sÿn")è=ğ
NULL
)

98 
bugout
;

100 ià((
ps
->
bb_g‘_image_d©a
 = 
	`g‘_lib¿ry_symbŞ
Õs->
bb_hªdË
, "bb_g‘_image_d©a")è=ğ
NULL
)

101 
bugout
;

103 ià((
ps
->
bb_’d_·ge
 = 
	`g‘_lib¿ry_symbŞ
Õs->
bb_hªdË
, "bb_’d_·ge")è=ğ
NULL
)

104 
bugout
;

107 
¡©
=0;

109 
bugout
:

110  
¡©
;

111 
	}
}

113 
	$bb_uÆßd
(
m¬v–l_£ssiÚ
 *
ps
)

115 
	`uÆßd_lib¿ry
(
ps
->
bb_hªdË
);

116 
ps
->
bb_hªdË
 = 
NULL
;

118 
	`uÆßd_lib¿ry
(
ps
->
hpmud_hªdË
);

119 
ps
->
hpmud_hªdË
 = 
NULL
;

121 
	`uÆßd_lib¿ry
(
ps
->
m©h_hªdË
);

122 
ps
->
m©h_hªdË
 = 
NULL
;

125 
	}
}

128 
	$g‘__d©a
(
m¬v–l_£ssiÚ
 *
ps
, 
SANE_By‹
 *
d©a
, 
SANE_IÁ
 
maxL’gth
, SANE_IÁ *
Ëngth
)

130 
_»t
=
IP_INPUT_ERROR
;

131 
ouutAva
=
maxL’gth
, 
ouutU£d
=0, 
ouutThisPos
;

132 *
šput
, *
ouut
 = 
d©a
;

133 
šputAva
, 
šputU£d
=0, 
šputNextPos
;

135 ià(!
ps
->
_hªdË
)

137 
	`BUG
("invalid ipconvert state\n");

138 
bugout
;

141 ià(
ps
->
	`bb_g‘_image_d©a
Õs, 
ouutAva
))

142 
bugout
;

144 ià(
ps
->
út
 > 0)

146 
šputAva
 = 
ps
->
út
;

147 
šput
 = 
ps
->
buf
;

151 
šput
 = 
NULL
;

152 
šputAva
 = 0;

156 
_»t
 = 
	`CÚv”t
(
ps
->
_hªdË
, 
šputAva
, 
šput
, &
šputU£d
, &
šputNextPos
, 
ouutAva
, 
ouut
, &
ouutU£d
, &
ouutThisPos
);

158 
	`DBG6
("šput=%°šputAva=%d iÅutU£d=%d iÅutNextPos=%d ouut=%°ouutAva=%d ouutU£d=%d ouutThisPos=%d„‘=%x\n", 
šput
,

159 
šputAva
, 
šputU£d
, 
šputNextPos
, 
ouut
, 
ouutAva
, 
ouutU£d
, 
ouutThisPos
, 
_»t
);

161 ià(
d©a
)

162 *
Ëngth
 = 
ouutU£d
;

165 ià(
_»t
 & 
IP_DONE
 && 
ouutU£d
)

166 
_»t
 &ğ~
IP_DONE
;

168 
bugout
:

169  
_»t
;

170 
	}
}

172 
	$š™_İtiÚs
(
m¬v–l_£ssiÚ
 *
ps
)

174 
ps
->
İtiÚ
[
MARVELL_OPTION_COUNT
].
Çme
 = "option-cnt";

175 
ps
->
İtiÚ
[
MARVELL_OPTION_COUNT
].
t™Ë
 = 
SANE_TITLE_NUM_OPTIONS
;

176 
ps
->
İtiÚ
[
MARVELL_OPTION_COUNT
].
desc
 = 
SANE_DESC_NUM_OPTIONS
;

177 
ps
->
İtiÚ
[
MARVELL_OPTION_COUNT
].
ty³
 = 
SANE_TYPE_INT
;

178 
ps
->
İtiÚ
[
MARVELL_OPTION_COUNT
].
un™
 = 
SANE_UNIT_NONE
;

179 
ps
->
İtiÚ
[
MARVELL_OPTION_COUNT
].
size
 = (
SANE_IÁ
);

180 
ps
->
İtiÚ
[
MARVELL_OPTION_COUNT
].
ÿp
 = 
SANE_CAP_SOFT_DETECT
;

181 
ps
->
İtiÚ
[
MARVELL_OPTION_COUNT
].
cÚ¡¿št_ty³
 = 
SANE_CONSTRAINT_NONE
;

183 
ps
->
İtiÚ
[
MARVELL_OPTION_GROUP_SCAN_MODE
].
Çme
 = "mode-group";

184 
ps
->
İtiÚ
[
MARVELL_OPTION_GROUP_SCAN_MODE
].
t™Ë
 = 
SANE_TITLE_SCAN_MODE
;

185 
ps
->
İtiÚ
[
MARVELL_OPTION_GROUP_SCAN_MODE
].
ty³
 = 
SANE_TYPE_GROUP
;

187 
ps
->
İtiÚ
[
MARVELL_OPTION_SCAN_MODE
].
Çme
 = 
SANE_NAME_SCAN_MODE
;

188 
ps
->
İtiÚ
[
MARVELL_OPTION_SCAN_MODE
].
t™Ë
 = 
SANE_TITLE_SCAN_MODE
;

189 
ps
->
İtiÚ
[
MARVELL_OPTION_SCAN_MODE
].
desc
 = 
SANE_DESC_SCAN_MODE
;

190 
ps
->
İtiÚ
[
MARVELL_OPTION_SCAN_MODE
].
ty³
 = 
SANE_TYPE_STRING
;

191 
ps
->
İtiÚ
[
MARVELL_OPTION_SCAN_MODE
].
un™
 = 
SANE_UNIT_NONE
;

192 
ps
->
İtiÚ
[
MARVELL_OPTION_SCAN_MODE
].
size
 = 
MAX_STRING_SIZE
;

193 
ps
->
İtiÚ
[
MARVELL_OPTION_SCAN_MODE
].
ÿp
 = 
SANE_CAP_SOFT_SELECT
 | 
SANE_CAP_SOFT_DETECT
;

194 
ps
->
İtiÚ
[
MARVELL_OPTION_SCAN_MODE
].
cÚ¡¿št_ty³
 = 
SANE_CONSTRAINT_STRING_LIST
;

195 
ps
->
İtiÚ
[
MARVELL_OPTION_SCAN_MODE
].
cÚ¡¿št
.
¡ršg_li¡
 =…s->
sÿn_mode_li¡
;

197 
ps
->
İtiÚ
[
MARVELL_OPTION_INPUT_SOURCE
].
Çme
 = 
SANE_NAME_SCAN_SOURCE
;

198 
ps
->
İtiÚ
[
MARVELL_OPTION_INPUT_SOURCE
].
t™Ë
 = 
SANE_TITLE_SCAN_SOURCE
;

199 
ps
->
İtiÚ
[
MARVELL_OPTION_INPUT_SOURCE
].
desc
 = 
SANE_DESC_SCAN_SOURCE
;

200 
ps
->
İtiÚ
[
MARVELL_OPTION_INPUT_SOURCE
].
ty³
 = 
SANE_TYPE_STRING
;

201 
ps
->
İtiÚ
[
MARVELL_OPTION_INPUT_SOURCE
].
un™
 = 
SANE_UNIT_NONE
;

202 
ps
->
İtiÚ
[
MARVELL_OPTION_INPUT_SOURCE
].
size
 = 
MAX_STRING_SIZE
;

203 
ps
->
İtiÚ
[
MARVELL_OPTION_INPUT_SOURCE
].
ÿp
 = 
SANE_CAP_SOFT_SELECT
 | 
SANE_CAP_SOFT_DETECT
;

204 
ps
->
İtiÚ
[
MARVELL_OPTION_INPUT_SOURCE
].
cÚ¡¿št_ty³
 = 
SANE_CONSTRAINT_STRING_LIST
;

205 
ps
->
İtiÚ
[
MARVELL_OPTION_INPUT_SOURCE
].
cÚ¡¿št
.
¡ršg_li¡
 =…s->
šput_sourû_li¡
;

207 
ps
->
İtiÚ
[
MARVELL_OPTION_SCAN_RESOLUTION
].
Çme
 = 
SANE_NAME_SCAN_RESOLUTION
;

208 
ps
->
İtiÚ
[
MARVELL_OPTION_SCAN_RESOLUTION
].
t™Ë
 = 
SANE_TITLE_SCAN_RESOLUTION
;

209 
ps
->
İtiÚ
[
MARVELL_OPTION_SCAN_RESOLUTION
].
desc
 = 
SANE_DESC_SCAN_RESOLUTION
;

210 
ps
->
İtiÚ
[
MARVELL_OPTION_SCAN_RESOLUTION
].
ty³
 = 
SANE_TYPE_INT
;

211 
ps
->
İtiÚ
[
MARVELL_OPTION_SCAN_RESOLUTION
].
un™
 = 
SANE_UNIT_DPI
;

212 
ps
->
İtiÚ
[
MARVELL_OPTION_SCAN_RESOLUTION
].
size
 = (
SANE_IÁ
);

213 
ps
->
İtiÚ
[
MARVELL_OPTION_SCAN_RESOLUTION
].
ÿp
 = 
SANE_CAP_SOFT_SELECT
 | 
SANE_CAP_SOFT_DETECT
;

214 
ps
->
İtiÚ
[
MARVELL_OPTION_SCAN_RESOLUTION
].
cÚ¡¿št_ty³
 = 
SANE_CONSTRAINT_WORD_LIST
;

215 
ps
->
İtiÚ
[
MARVELL_OPTION_SCAN_RESOLUTION
].
cÚ¡¿št
.
wÜd_li¡
 =…s->
»sŞutiÚ_li¡
;

217 
ps
->
İtiÚ
[
MARVELL_OPTION_GROUP_ADVANCED
].
Çme
 = "advanced-group";

218 
ps
->
İtiÚ
[
MARVELL_OPTION_GROUP_ADVANCED
].
t™Ë
 = 
STR_TITLE_ADVANCED
;

219 
ps
->
İtiÚ
[
MARVELL_OPTION_GROUP_ADVANCED
].
ty³
 = 
SANE_TYPE_GROUP
;

220 
ps
->
İtiÚ
[
MARVELL_OPTION_GROUP_ADVANCED
].
ÿp
 = 
SANE_CAP_ADVANCED
;

222 
ps
->
İtiÚ
[
MARVELL_OPTION_BRIGHTNESS
].
Çme
 = 
SANE_NAME_BRIGHTNESS
;

223 
ps
->
İtiÚ
[
MARVELL_OPTION_BRIGHTNESS
].
t™Ë
 = 
SANE_TITLE_BRIGHTNESS
;

224 
ps
->
İtiÚ
[
MARVELL_OPTION_BRIGHTNESS
].
desc
 = 
SANE_DESC_BRIGHTNESS
;

225 
ps
->
İtiÚ
[
MARVELL_OPTION_BRIGHTNESS
].
ty³
 = 
SANE_TYPE_INT
;

226 
ps
->
İtiÚ
[
MARVELL_OPTION_BRIGHTNESS
].
un™
 = 
SANE_UNIT_NONE
;

227 
ps
->
İtiÚ
[
MARVELL_OPTION_BRIGHTNESS
].
size
 = (
SANE_IÁ
);

228 
ps
->
İtiÚ
[
MARVELL_OPTION_BRIGHTNESS
].
ÿp
 = 
SANE_CAP_SOFT_SELECT
 | 
SANE_CAP_SOFT_DETECT
 | 
SANE_CAP_ADVANCED
;

229 
ps
->
İtiÚ
[
MARVELL_OPTION_BRIGHTNESS
].
cÚ¡¿št_ty³
 = 
SANE_CONSTRAINT_RANGE
;

230 
ps
->
İtiÚ
[
MARVELL_OPTION_BRIGHTNESS
].
cÚ¡¿št
.
¿nge
 = &ps->
brighŠessRªge
;

231 
ps
->
brighŠessRªge
.
mš
 = 
MARVELL_BRIGHTNESS_MIN
;

232 
ps
->
brighŠessRªge
.
max
 = 
MARVELL_BRIGHTNESS_MAX
;

233 
ps
->
brighŠessRªge
.
quªt
 = 0;

235 
ps
->
İtiÚ
[
MARVELL_OPTION_CONTRAST
].
Çme
 = 
SANE_NAME_CONTRAST
;

236 
ps
->
İtiÚ
[
MARVELL_OPTION_CONTRAST
].
t™Ë
 = 
SANE_TITLE_CONTRAST
;

237 
ps
->
İtiÚ
[
MARVELL_OPTION_CONTRAST
].
desc
 = 
SANE_DESC_CONTRAST
;

238 
ps
->
İtiÚ
[
MARVELL_OPTION_CONTRAST
].
ty³
 = 
SANE_TYPE_INT
;

239 
ps
->
İtiÚ
[
MARVELL_OPTION_CONTRAST
].
un™
 = 
SANE_UNIT_NONE
;

240 
ps
->
İtiÚ
[
MARVELL_OPTION_CONTRAST
].
size
 = (
SANE_IÁ
);

241 
ps
->
İtiÚ
[
MARVELL_OPTION_CONTRAST
].
ÿp
 = 
SANE_CAP_SOFT_SELECT
 | 
SANE_CAP_SOFT_DETECT
 | 
SANE_CAP_ADVANCED
;

242 
ps
->
İtiÚ
[
MARVELL_OPTION_CONTRAST
].
cÚ¡¿št_ty³
 = 
SANE_CONSTRAINT_RANGE
;

243 
ps
->
İtiÚ
[
MARVELL_OPTION_CONTRAST
].
cÚ¡¿št
.
¿nge
 = &ps->
cÚŒa¡_¿nge
;

244 
ps
->
cÚŒa¡_¿nge
.
mš
 = 
MARVELL_CONTRAST_MIN
;

245 
ps
->
cÚŒa¡_¿nge
.
max
 = 
MARVELL_CONTRAST_MAX
;

246 
ps
->
cÚŒa¡_¿nge
.
quªt
 = 0;

248 
ps
->
İtiÚ
[
MARVELL_OPTION_GROUP_GEOMETRY
].
Çme
 = "geometry-group";

249 
ps
->
İtiÚ
[
MARVELL_OPTION_GROUP_GEOMETRY
].
t™Ë
 = 
STR_TITLE_GEOMETRY
;

250 
ps
->
İtiÚ
[
MARVELL_OPTION_GROUP_GEOMETRY
].
ty³
 = 
SANE_TYPE_GROUP
;

251 
ps
->
İtiÚ
[
MARVELL_OPTION_GROUP_GEOMETRY
].
ÿp
 = 
SANE_CAP_ADVANCED
;

253 
ps
->
İtiÚ
[
MARVELL_OPTION_TL_X
].
Çme
 = 
SANE_NAME_SCAN_TL_X
;

254 
ps
->
İtiÚ
[
MARVELL_OPTION_TL_X
].
t™Ë
 = 
SANE_TITLE_SCAN_TL_X
;

255 
ps
->
İtiÚ
[
MARVELL_OPTION_TL_X
].
desc
 = 
SANE_DESC_SCAN_TL_X
;

256 
ps
->
İtiÚ
[
MARVELL_OPTION_TL_X
].
ty³
 = 
SANE_TYPE_FIXED
;

257 
ps
->
İtiÚ
[
MARVELL_OPTION_TL_X
].
un™
 = 
SANE_UNIT_MM
;

258 
ps
->
İtiÚ
[
MARVELL_OPTION_TL_X
].
size
 = (
SANE_IÁ
);

259 
ps
->
İtiÚ
[
MARVELL_OPTION_TL_X
].
ÿp
 = 
SANE_CAP_SOFT_SELECT
 | 
SANE_CAP_SOFT_DETECT
;

260 
ps
->
İtiÚ
[
MARVELL_OPTION_TL_X
].
cÚ¡¿št_ty³
 = 
SANE_CONSTRAINT_RANGE
;

261 
ps
->
İtiÚ
[
MARVELL_OPTION_TL_X
].
cÚ¡¿št
.
¿nge
 = &ps->
xRªge
;

262 
ps
->
xRªge
.
mš
 = 0;

263 
ps
->
xRªge
.
quªt
 = 0;

265 
ps
->
İtiÚ
[
MARVELL_OPTION_TL_Y
].
Çme
 = 
SANE_NAME_SCAN_TL_Y
;

266 
ps
->
İtiÚ
[
MARVELL_OPTION_TL_Y
].
t™Ë
 = 
SANE_TITLE_SCAN_TL_Y
;

267 
ps
->
İtiÚ
[
MARVELL_OPTION_TL_Y
].
desc
 = 
SANE_DESC_SCAN_TL_Y
;

268 
ps
->
İtiÚ
[
MARVELL_OPTION_TL_Y
].
ty³
 = 
SANE_TYPE_FIXED
;

269 
ps
->
İtiÚ
[
MARVELL_OPTION_TL_Y
].
un™
 = 
SANE_UNIT_MM
;

270 
ps
->
İtiÚ
[
MARVELL_OPTION_TL_Y
].
size
 = (
SANE_IÁ
);

271 
ps
->
İtiÚ
[
MARVELL_OPTION_TL_Y
].
ÿp
 = 
SANE_CAP_SOFT_SELECT
 | 
SANE_CAP_SOFT_DETECT
;

272 
ps
->
İtiÚ
[
MARVELL_OPTION_TL_Y
].
cÚ¡¿št_ty³
 = 
SANE_CONSTRAINT_RANGE
;

273 
ps
->
İtiÚ
[
MARVELL_OPTION_TL_Y
].
cÚ¡¿št
.
¿nge
 = &ps->
yRªge
;

274 
ps
->
yRªge
.
mš
 = 0;

275 
ps
->
yRªge
.
quªt
 = 0;

277 
ps
->
İtiÚ
[
MARVELL_OPTION_BR_X
].
Çme
 = 
SANE_NAME_SCAN_BR_X
;

278 
ps
->
İtiÚ
[
MARVELL_OPTION_BR_X
].
t™Ë
 = 
SANE_TITLE_SCAN_BR_X
;

279 
ps
->
İtiÚ
[
MARVELL_OPTION_BR_X
].
desc
 = 
SANE_DESC_SCAN_BR_X
;

280 
ps
->
İtiÚ
[
MARVELL_OPTION_BR_X
].
ty³
 = 
SANE_TYPE_FIXED
;

281 
ps
->
İtiÚ
[
MARVELL_OPTION_BR_X
].
un™
 = 
SANE_UNIT_MM
;

282 
ps
->
İtiÚ
[
MARVELL_OPTION_BR_X
].
size
 = (
SANE_IÁ
);

283 
ps
->
İtiÚ
[
MARVELL_OPTION_BR_X
].
ÿp
 = 
SANE_CAP_SOFT_SELECT
 | 
SANE_CAP_SOFT_DETECT
;

284 
ps
->
İtiÚ
[
MARVELL_OPTION_BR_X
].
cÚ¡¿št_ty³
 = 
SANE_CONSTRAINT_RANGE
;

285 
ps
->
İtiÚ
[
MARVELL_OPTION_BR_X
].
cÚ¡¿št
.
¿nge
 = &ps->
brxRªge
;

286 
ps
->
brxRªge
.
mš
 = 0;

287 
ps
->
brxRªge
.
quªt
 = 0;

289 
ps
->
İtiÚ
[
MARVELL_OPTION_BR_Y
].
Çme
 = 
SANE_NAME_SCAN_BR_Y
;

290 
ps
->
İtiÚ
[
MARVELL_OPTION_BR_Y
].
t™Ë
 = 
SANE_TITLE_SCAN_BR_Y
;

291 
ps
->
İtiÚ
[
MARVELL_OPTION_BR_Y
].
desc
 = 
SANE_DESC_SCAN_BR_Y
;

292 
ps
->
İtiÚ
[
MARVELL_OPTION_BR_Y
].
ty³
 = 
SANE_TYPE_FIXED
;

293 
ps
->
İtiÚ
[
MARVELL_OPTION_BR_Y
].
un™
 = 
SANE_UNIT_MM
;

294 
ps
->
İtiÚ
[
MARVELL_OPTION_BR_Y
].
size
 = (
SANE_IÁ
);

295 
ps
->
İtiÚ
[
MARVELL_OPTION_BR_Y
].
ÿp
 = 
SANE_CAP_SOFT_SELECT
 | 
SANE_CAP_SOFT_DETECT
;

296 
ps
->
İtiÚ
[
MARVELL_OPTION_BR_Y
].
cÚ¡¿št_ty³
 = 
SANE_CONSTRAINT_RANGE
;

297 
ps
->
İtiÚ
[
MARVELL_OPTION_BR_Y
].
cÚ¡¿št
.
¿nge
 = &ps->
bryRªge
;

298 
ps
->
bryRªge
.
mš
 = 0;

299 
ps
->
bryRªge
.
quªt
 = 0;

302 
	}
}

305 
	$£t_ex‹Ás
(
m¬v–l_£ssiÚ
 *
ps
)

307 
¡©
 = 0;

309 ià((
ps
->
cu¼’tBrx
 >…s->
cu¼’tTlx
è&& (ps->cu¼’tBrx -…s->cu¼’tTlx >ğps->
mš_width
è&& (ps->cu¼’tBrx -…s->cu¼’tTlx <ğps->
xRªge
.
max
))

311 
ps
->
efãùiveTlx
 =…s->
cu¼’tTlx
;

312 
ps
->
efãùiveBrx
 =…s->
cu¼’tBrx
;

316 
ps
->
efãùiveTlx
 =…s->
cu¼’tTlx
 = 0;

317 
ps
->
efãùiveBrx
 =…s->
cu¼’tBrx
 =…s->
brxRªge
.
max
;

319 ià((
ps
->
cu¼’tBry
 >…s->
cu¼’tTly
è&& (ps->cu¼’tBry -…s->cu¼’tTly >…s->
mš_height
è&& (ps->cu¼’tBry -…s->cu¼’tTly <ğps->
yRªge
.
max
))

321 
ps
->
efãùiveTly
 =…s->
cu¼’tTly
;

322 
ps
->
efãùiveBry
 =…s->
cu¼’tBry
;

326 
ps
->
efãùiveTly
 =…s->
cu¼’tTly
 = 0;

327 
ps
->
efãùiveBry
 =…s->
cu¼’tBry
 =…s->
bryRªge
.
max
;

329  
¡©
;

330 
	}
}

332 
m¬v–l_£ssiÚ
 *
	$ü—‹_£ssiÚ
()

334 
m¬v–l_£ssiÚ
 *
ps
;

336 ià((
ps
 = 
	`m®loc
((
m¬v–l_£ssiÚ
))è=ğ
NULL
)

338 
	`BUG
("malloc failed: %m\n");

339  
NULL
;

341 
	`mem£t
(
ps
, 0, (
m¬v–l_£ssiÚ
));

342 
ps
->
g
 = "MARVELL";

343 
ps
->
dd
 = -1;

344 
ps
->
cd
 = -1;

346  
ps
;

347 
	}
}

349 
	$£t_suµÜ‹d_»sŞutiÚs
(
m¬v–l_£ssiÚ
 *
ps
)

351 
i
;

352 if(
ps
->
sÿn¤c
 & 
HPMUD_SCANSRC_ADF
)

354 
i
 = 0;

355 
ps
->
adf_»sŞutiÚ_li¡
[
i
++] = 1;

356 
ps
->
adf_»sŞutiÚ_li¡
[
i
++] = 300;

358 if(
ps
->
sÿn¤c
 & 
HPMUD_SCANSRC_FLATBED
)

360 
i
 = 0;

361 
ps
->
¶©’_»sŞutiÚ_li¡
[
i
++] = 7;

362 
ps
->
¶©’_»sŞutiÚ_li¡
[
i
++] = 75;

363 
ps
->
¶©’_»sŞutiÚ_li¡
[
i
++] = 100;

364 
ps
->
¶©’_»sŞutiÚ_li¡
[
i
++] = 150;

365 
ps
->
¶©’_»sŞutiÚ_li¡
[
i
++] = 200;

366 
ps
->
¶©’_»sŞutiÚ_li¡
[
i
++] = 300;

367 
ps
->
¶©’_»sŞutiÚ_li¡
[
i
++] = 600;

368 
ps
->
¶©’_»sŞutiÚ_li¡
[
i
++] = 1200;

371 if(
ps
->
sÿn¤c
 & 
HPMUD_SCANSRC_FLATBED
)

373 
ps
->
»sŞutiÚ_li¡
[0] =…s->
¶©’_»sŞutiÚ_li¡
[0];

374 
i
 = 
ps
->
¶©’_»sŞutiÚ_li¡
[0] + 1;

375 
i
--)

377 
ps
->
»sŞutiÚ_li¡
[
i
] =…s->
¶©’_»sŞutiÚ_li¡
[i];

382 
ps
->
»sŞutiÚ_li¡
[0] =…s->
adf_»sŞutiÚ_li¡
[0];

383 
i
 = 
ps
->
adf_»sŞutiÚ_li¡
[0] + 1;

384 
i
--)

386 
ps
->
»sŞutiÚ_li¡
[
i
] =…s->
adf_»sŞutiÚ_li¡
[i];

390 
	}
}

395 
SANE_Stus
 
	$m¬v–l_İ’
(
SANE_SŒšg_CÚ¡
 
deviû
, 
SANE_HªdË
 *
hªdË
)

397 
hpmud_mod–_©Œibu‹s
 
ma
;

398 
¡©
 = 
SANE_STATUS_IO_ERROR
;

399 
i
;

401 
	`DBG8
("§Ã_h·io_İ’(%s)\n", 
deviû
);

403 ià(
£ssiÚ
)

405 
	`BUG
("session in use\n");

406  
SANE_STATUS_DEVICE_BUSY
;

409 ià((
£ssiÚ
 = 
	`ü—‹_£ssiÚ
()è=ğ
NULL
)

410  
SANE_STATUS_NO_MEM
;

413 
	`¢´štf
(
£ssiÚ
->
uri
, (£ssiÚ->uri)-1, "hp:%s", 
deviû
);

416 
	`hpmud_qu”y_mod–
(
£ssiÚ
->
uri
, &
ma
);

417 
£ssiÚ
->
sÿn_ty³
 = 
ma
.
sÿÁy³
;

418 
£ssiÚ
->
sÿn¤c
 = 
ma
.scansrc;

420 
ma
.
sÿÁy³
)

422 
HPMUD_SCANTYPE_MARVELL
:

423 
£ssiÚ
->
v”siÚ
 = 
MARVELL_1
;

425 
HPMUD_SCANTYPE_MARVELL2
:

426 
£ssiÚ
->
v”siÚ
 = 
MARVELL_2
;

429 
£ssiÚ
->
v”siÚ
 = 
MARVELL_1
;

432 ià(
	`hpmud_İ’_deviû
(
£ssiÚ
->
uri
, 
ma
.
må_mode
, &£ssiÚ->
dd
è!ğ
HPMUD_R_OK
)

434 
	`BUG
("uÇbËØİ’ deviû %s\n", 
£ssiÚ
->
uri
);

435 
bugout
;

437 
	`ä“
(
£ssiÚ
);

438 
£ssiÚ
 = 
NULL
;

439  
SANE_STATUS_IO_ERROR
;

442 ià(
	`hpmud_İ’_chªÃl
(
£ssiÚ
->
dd
, 
HPMUD_S_MARVELL_SCAN_CHANNEL
, &£ssiÚ->
cd
è!ğ
HPMUD_R_OK
)

444 
	`BUG
("uÇbËØİ’ % chªÃÈ%s\n", 
HPMUD_S_MARVELL_SCAN_CHANNEL
, 
£ssiÚ
->
uri
);

445 
¡©
 = 
SANE_STATUS_DEVICE_BUSY
;

446 
bugout
;

449 ià(
	`bb_lßd
(
£ssiÚ
, 
SCAN_PLUGIN_MARVELL
))

451 
¡©
 = 
SANE_STATUS_IO_ERROR
;

452 
bugout
;

456 
	`š™_İtiÚs
(
£ssiÚ
);

458 ià(
£ssiÚ
->
	`bb_İ’
(session))

460 
¡©
 = 
SANE_STATUS_IO_ERROR
;

461 
bugout
;

465 
i
=0;

466 
£ssiÚ
->
sÿn_mode_li¡
[
i
] = 
SANE_VALUE_SCAN_MODE_LINEART
;

467 
£ssiÚ
->
sÿn_mode_m­
[
i
++] = 
CE_BLACK_AND_WHITE1
;

468 
£ssiÚ
->
sÿn_mode_li¡
[
i
] = 
SANE_VALUE_SCAN_MODE_GRAY
;

469 
£ssiÚ
->
sÿn_mode_m­
[
i
++] = 
CE_GRAY8
;

470 
£ssiÚ
->
sÿn_mode_li¡
[
i
] = 
SANE_VALUE_SCAN_MODE_COLOR
;

471 
£ssiÚ
->
sÿn_mode_m­
[
i
++] = 
CE_RGB24
;

472 
	`m¬v–l_cÚŒŞ_İtiÚ
(
£ssiÚ
, 
MARVELL_OPTION_SCAN_MODE
, 
SANE_ACTION_SET_AUTO
, 
NULL
, NULL);

476 
i
=0;

479 iàĞ
£ssiÚ
->
sÿn¤c
 & 
HPMUD_SCANSRC_ADF
)

481 
£ssiÚ
->
šput_sourû_li¡
[
i
] = 
STR_ADF_MODE_ADF
;

482 
£ssiÚ
->
šput_sourû_m­
[
i
++] = 
IS_ADF
;

483 
	`DBG8
("scan src HPMUD_SCANSRC_ADF \n");

485 iàĞ
£ssiÚ
->
sÿn¤c
 & 
HPMUD_SCANSRC_FLATBED
)

487 
£ssiÚ
->
šput_sourû_li¡
[
i
] = 
STR_ADF_MODE_FLATBED
;

488 
£ssiÚ
->
šput_sourû_m­
[
i
++] = 
IS_PLATEN
;

489 
	`DBG8
("scan src HPMUD_SCANSRC_FLATBED \n");

492 ià(
£ssiÚ
->
sÿn¤c
 =ğ
HPMUD_SCANSRC_NA
)

494 ià(
£ssiÚ
->
	`bb_is_·³r_š_adf
(session) == 2)

496 
£ssiÚ
->
šput_sourû_li¡
[
i
] = 
STR_ADF_MODE_FLATBED
;

497 
£ssiÚ
->
šput_sourû_m­
[
i
++] = 
IS_PLATEN
;

498 
	`DBG8
("scan src b_is_paper_in_adf value 2 \n");

502 
£ssiÚ
->
šput_sourû_li¡
[
i
] = 
STR_ADF_MODE_ADF
;

503 
£ssiÚ
->
šput_sourû_m­
[
i
++] = 
IS_ADF
;

504 
	`DBG8
("scan src b_is_paper_in_adf value‚ot 2 \n");

508 
	`m¬v–l_cÚŒŞ_İtiÚ
(
£ssiÚ
, 
MARVELL_OPTION_INPUT_SOURCE
, 
SANE_ACTION_SET_AUTO
, 
NULL
, NULL);

511 
	`£t_suµÜ‹d_»sŞutiÚs
(
£ssiÚ
);

512 
	`m¬v–l_cÚŒŞ_İtiÚ
(
£ssiÚ
, 
MARVELL_OPTION_SCAN_RESOLUTION
, 
SANE_ACTION_SET_AUTO
, 
NULL
, NULL);

515 
	`m¬v–l_cÚŒŞ_İtiÚ
(
£ssiÚ
, 
MARVELL_OPTION_CONTRAST
, 
SANE_ACTION_SET_AUTO
, 
NULL
, NULL);

518 
	`m¬v–l_cÚŒŞ_İtiÚ
(
£ssiÚ
, 
MARVELL_OPTION_BRIGHTNESS
, 
SANE_ACTION_SET_AUTO
, 
NULL
, NULL);

521 
	`m¬v–l_cÚŒŞ_İtiÚ
(
£ssiÚ
, 
MARVELL_OPTION_TL_X
, 
SANE_ACTION_SET_AUTO
, 
NULL
, NULL);

522 
	`m¬v–l_cÚŒŞ_İtiÚ
(
£ssiÚ
, 
MARVELL_OPTION_TL_Y
, 
SANE_ACTION_SET_AUTO
, 
NULL
, NULL);

523 
	`m¬v–l_cÚŒŞ_İtiÚ
(
£ssiÚ
, 
MARVELL_OPTION_BR_X
, 
SANE_ACTION_SET_AUTO
, 
NULL
, NULL);

524 
	`m¬v–l_cÚŒŞ_İtiÚ
(
£ssiÚ
, 
MARVELL_OPTION_BR_Y
, 
SANE_ACTION_SET_AUTO
, 
NULL
, NULL);

526 *
hªdË
 = (
SANE_HªdË
 *)
£ssiÚ
;

528 
¡©
 = 
SANE_STATUS_GOOD
;

530 
bugout
:

532 ià(
¡©
 !ğ
SANE_STATUS_GOOD
)

534 ià(
£ssiÚ
)

536 
	`bb_uÆßd
(
£ssiÚ
);

537 ià(
£ssiÚ
->
cd
 > 0)

538 
	`hpmud_şo£_chªÃl
(
£ssiÚ
->
dd
, sessiÚ->
cd
);

539 ià(
£ssiÚ
->
dd
 > 0)

540 
	`hpmud_şo£_deviû
(
£ssiÚ
->
dd
);

541 
	`ä“
(
£ssiÚ
);

542 
£ssiÚ
 = 
NULL
;

546  
¡©
;

547 
	}
}

549 
	$m¬v–l_şo£
(
SANE_HªdË
 
hªdË
)

551 
m¬v–l_£ssiÚ
 *
ps
 = (m¬v–l_£ssiÚ *)
hªdË
;

553 
	`DBG8
("sane_hpaio_close()\n");

555 ià(
ps
 =ğ
NULL
 ||… !ğ
£ssiÚ
)

557 
	`BUG
("invalid sane_close\n");

561 
ps
->
	`bb_şo£
(ps);

562 
	`bb_uÆßd
(
ps
);

564 ià(
ps
->
dd
 > 0)

566 ià(
ps
->
cd
 > 0)

567 
	`hpmud_şo£_chªÃl
(
ps
->
dd
,…s->
cd
);

568 
	`hpmud_şo£_deviû
(
ps
->
dd
);

571 
	`ä“
(
ps
);

572 
£ssiÚ
 = 
NULL
;

573 
	}
}

575 cÚ¡ 
SANE_O±iÚ_DesütÜ
 *
	$m¬v–l_g‘_İtiÚ_desütÜ
(
SANE_HªdË
 
hªdË
, 
SANE_IÁ
 
İtiÚ
)

577 
m¬v–l_£ssiÚ
 *
ps
 = (m¬v–l_£ssiÚ *)
hªdË
;

579 
	`DBG8
("§Ã_h·io_g‘_İtiÚ_desütÜ(İtiÚ=%s)\n", 
ps
->
İtiÚ
[İtiÚ].
Çme
);

581 ià(
İtiÚ
 < 0 || o±iÚ >ğ
MARVELL_OPTION_MAX
)

582  
NULL
;

584  &
ps
->
İtiÚ
[option];

585 
	}
}

587 
SANE_Stus
 
	$m¬v–l_cÚŒŞ_İtiÚ
(
SANE_HªdË
 
hªdË
, 
SANE_IÁ
 
İtiÚ
, 
SANE_AùiÚ
 
aùiÚ
, *
v®ue
, SANE_IÁ *
£t_»suÉ
)

589 
m¬v–l_£ssiÚ
 *
ps
 = (m¬v–l_£ssiÚ *)
hªdË
;

590 
SANE_IÁ
 *
št_v®ue
 = 
v®ue
, 
m£t_»suÉ
=0;

591 
i
, 
¡©
=
SANE_STATUS_INVAL
;

592 
sz
[64];

594 
İtiÚ
)

596 
MARVELL_OPTION_COUNT
:

597 ià(
aùiÚ
 =ğ
SANE_ACTION_GET_VALUE
)

599 *
št_v®ue
 = 
MARVELL_OPTION_MAX
;

600 
¡©
 = 
SANE_STATUS_GOOD
;

603 
MARVELL_OPTION_SCAN_MODE
:

604 ià(
aùiÚ
 =ğ
SANE_ACTION_GET_VALUE
)

606 
i
=0; 
ps
->
sÿn_mode_li¡
[i]; i++)

608 ià(
ps
->
cu¼’t_sÿn_mode
 =ğps->
sÿn_mode_m­
[
i
])

610 
	`¡rıy
(
v®ue
, 
ps
->
sÿn_mode_li¡
[
i
]);

611 
¡©
 = 
SANE_STATUS_GOOD
;

616 ià(
aùiÚ
 =ğ
SANE_ACTION_SET_VALUE
)

618 
i
=0; 
ps
->
sÿn_mode_li¡
[i]; i++)

620 ià(
	`¡rÿ£cmp
(
ps
->
sÿn_mode_li¡
[
i
], 
v®ue
) == 0)

622 
ps
->
cu¼’t_sÿn_mode
 =…s->
sÿn_mode_m­
[
i
];

623 
m£t_»suÉ
 |ğ
SANE_INFO_RELOAD_PARAMS
 | 
SANE_INFO_RELOAD_OPTIONS
;

624 
¡©
 = 
SANE_STATUS_GOOD
;

631 
ps
->
cu¼’t_sÿn_mode
 =…s->
sÿn_mode_m­
[0];

632 
¡©
 = 
SANE_STATUS_GOOD
;

635 
MARVELL_OPTION_INPUT_SOURCE
:

636 ià(
aùiÚ
 =ğ
SANE_ACTION_GET_VALUE
)

638 
i
=0; 
ps
->
šput_sourû_li¡
[i]; i++)

640 ià(
ps
->
cu¼’t_šput_sourû
 =ğps->
šput_sourû_m­
[
i
])

642 
	`¡rıy
(
v®ue
, 
ps
->
šput_sourû_li¡
[
i
]);

643 
¡©
 = 
SANE_STATUS_GOOD
;

648 ià(
aùiÚ
 =ğ
SANE_ACTION_SET_VALUE
)

650 
i
=0; 
ps
->
šput_sourû_li¡
[i]; i++)

652 ià(
	`¡rÿ£cmp
(
ps
->
šput_sourû_li¡
[
i
], 
v®ue
) == 0)

654 
ps
->
cu¼’t_šput_sourû
 =…s->
šput_sourû_m­
[
i
];

655 
¡©
 = 
SANE_STATUS_GOOD
;

656 if(
ps
->
cu¼’t_šput_sourû
 =ğ
IS_PLATEN
)

658 
i
 = 
ps
->
¶©’_»sŞutiÚ_li¡
[0] + 1;

659 
i
--è
ps
->
»sŞutiÚ_li¡
[i] =…s->
¶©’_»sŞutiÚ_li¡
[i];

663 
i
 = 
ps
->
adf_»sŞutiÚ_li¡
[0] + 1;

664 
i
--è
ps
->
»sŞutiÚ_li¡
[i] =…s->
adf_»sŞutiÚ_li¡
[i];

666 
ps
->
cu¼’t_»sŞutiÚ
 =…s->
»sŞutiÚ_li¡
[1];

667 
m£t_»suÉ
 |ğ
SANE_INFO_RELOAD_PARAMS
 | 
SANE_INFO_RELOAD_OPTIONS
;

668 
¡©
 = 
SANE_STATUS_GOOD
;

675 
ps
->
cu¼’t_šput_sourû
 =…s->
šput_sourû_m­
[0];

676 if(
ps
->
cu¼’t_šput_sourû
 =ğ
IS_PLATEN
)

678 
i
 = 
ps
->
¶©’_»sŞutiÚ_li¡
[0] + 1;

679 
i
--è
ps
->
»sŞutiÚ_li¡
[i] =…s->
¶©’_»sŞutiÚ_li¡
[i];

683 
i
 = 
ps
->
adf_»sŞutiÚ_li¡
[0] + 1;

684 
i
--è
ps
->
»sŞutiÚ_li¡
[i] =…s->
adf_»sŞutiÚ_li¡
[i];

686 
ps
->
cu¼’t_»sŞutiÚ
 =…s->
»sŞutiÚ_li¡
[1];

687 
m£t_»suÉ
 |ğ
SANE_INFO_RELOAD_PARAMS
 | 
SANE_INFO_RELOAD_OPTIONS
;

688 
¡©
 = 
SANE_STATUS_GOOD
;

691 
MARVELL_OPTION_SCAN_RESOLUTION
:

692 ià(
aùiÚ
 =ğ
SANE_ACTION_GET_VALUE
)

694 *
št_v®ue
 = 
ps
->
cu¼’t_»sŞutiÚ
;

695 
¡©
 = 
SANE_STATUS_GOOD
;

697 ià(
aùiÚ
 =ğ
SANE_ACTION_SET_VALUE
)

699 
i
=1; i <ğ
ps
->
»sŞutiÚ_li¡
[0]; i++)

701 ià(
ps
->
»sŞutiÚ_li¡
[
i
] =ğ*
št_v®ue
)

703 
ps
->
cu¼’t_»sŞutiÚ
 = *
št_v®ue
;

704 
m£t_»suÉ
 |ğ
SANE_INFO_RELOAD_PARAMS
;

705 
¡©
 = 
SANE_STATUS_GOOD
;

709 ià(
¡©
 !ğ
SANE_STATUS_GOOD
)

711 
ps
->
cu¼’t_»sŞutiÚ
 =…s->
»sŞutiÚ_li¡
[1];

712 
¡©
 = 
SANE_STATUS_GOOD
;

717 
ps
->
cu¼’t_»sŞutiÚ
 = 75;

718 
¡©
 = 
SANE_STATUS_GOOD
;

721 
MARVELL_OPTION_CONTRAST
:

722 ià(
aùiÚ
 =ğ
SANE_ACTION_GET_VALUE
)

724 *
št_v®ue
 = 
ps
->
cu¼’t_cÚŒa¡
;

725 
¡©
 = 
SANE_STATUS_GOOD
;

727 ià(
aùiÚ
 =ğ
SANE_ACTION_SET_VALUE
)

729 ià(*
št_v®ue
 >ğ
MARVELL_CONTRAST_MIN
 && *št_v®u<ğ
MARVELL_CONTRAST_MAX
)

731 
ps
->
cu¼’t_cÚŒa¡
 = *
št_v®ue
;

735 
ps
->
cu¼’t_cÚŒa¡
 = 
MARVELL_CONTRAST_DEFAULT
;

737 
m£t_»suÉ
 |ğ
SANE_INFO_RELOAD_PARAMS
;

738 
¡©
 = 
SANE_STATUS_GOOD
;

742 
ps
->
cu¼’t_cÚŒa¡
 = 
MARVELL_CONTRAST_DEFAULT
;

743 
¡©
 = 
SANE_STATUS_GOOD
;

746 
MARVELL_OPTION_BRIGHTNESS
:

747 ià(
aùiÚ
 =ğ
SANE_ACTION_GET_VALUE
)

749 *
št_v®ue
 = 
ps
->
cu¼’tBrighŠess
;

750 
¡©
 = 
SANE_STATUS_GOOD
;

752 ià(
aùiÚ
 =ğ
SANE_ACTION_SET_VALUE
)

754 ià(*
št_v®ue
 >ğ
MARVELL_BRIGHTNESS_MIN
 && *št_v®u<ğ
MARVELL_BRIGHTNESS_MAX
)

756 
ps
->
cu¼’tBrighŠess
 = *
št_v®ue
;

760 
ps
->
cu¼’tBrighŠess
 = 
MARVELL_BRIGHTNESS_DEFAULT
;

762 
¡©
 = 
SANE_STATUS_GOOD
;

766 
ps
->
cu¼’tBrighŠess
 = 
MARVELL_BRIGHTNESS_DEFAULT
;

767 
¡©
 = 
SANE_STATUS_GOOD
;

770 
MARVELL_OPTION_TL_X
:

771 ià(
aùiÚ
 =ğ
SANE_ACTION_GET_VALUE
)

773 *
št_v®ue
 = 
ps
->
cu¼’tTlx
;

774 
¡©
 = 
SANE_STATUS_GOOD
;

776 ià(
aùiÚ
 =ğ
SANE_ACTION_SET_VALUE
)

778 ià(*
št_v®ue
 >ğ
ps
->
xRªge
.
mš
 && *št_v®u<ğps->xRªge.
max
)

780 
ps
->
cu¼’tTlx
 = *
št_v®ue
;

781 
m£t_»suÉ
 |ğ
SANE_INFO_RELOAD_PARAMS
;

782 
¡©
 = 
SANE_STATUS_GOOD
;

788 
ps
->
cu¼’tTlx
 =…s->
xRªge
.
mš
;

789 
¡©
 = 
SANE_STATUS_GOOD
;

792 
MARVELL_OPTION_TL_Y
:

793 ià(
aùiÚ
 =ğ
SANE_ACTION_GET_VALUE
)

795 *
št_v®ue
 = 
ps
->
cu¼’tTly
;

796 
¡©
 = 
SANE_STATUS_GOOD
;

798 ià(
aùiÚ
 =ğ
SANE_ACTION_SET_VALUE
)

800 ià(*
št_v®ue
 >ğ
ps
->
yRªge
.
mš
 && *št_v®u<ğps->yRªge.
max
)

803 
ps
->
cu¼’tTly
 = *
št_v®ue
;

804 
m£t_»suÉ
 |ğ
SANE_INFO_RELOAD_PARAMS
;

805 
¡©
 = 
SANE_STATUS_GOOD
;

811 
ps
->
cu¼’tTly
 =…s->
yRªge
.
mš
;

812 
¡©
 = 
SANE_STATUS_GOOD
;

815 
MARVELL_OPTION_BR_X
:

816 ià(
aùiÚ
 =ğ
SANE_ACTION_GET_VALUE
)

818 *
št_v®ue
 = 
ps
->
cu¼’tBrx
;

819 
¡©
 = 
SANE_STATUS_GOOD
;

821 ià(
aùiÚ
 =ğ
SANE_ACTION_SET_VALUE
)

823 ià(*
št_v®ue
 >ğ
ps
->
brxRªge
.
mš
 && *št_v®u<ğps->brxRªge.
max
)

825 
ps
->
cu¼’tBrx
 = *
št_v®ue
;

826 
m£t_»suÉ
 |ğ
SANE_INFO_RELOAD_PARAMS
;

827 
¡©
 = 
SANE_STATUS_GOOD
;

833 
ps
->
cu¼’tBrx
 =…s->
brxRªge
.
max
;

834 
¡©
 = 
SANE_STATUS_GOOD
;

837 
MARVELL_OPTION_BR_Y
:

838 ià(
aùiÚ
 =ğ
SANE_ACTION_GET_VALUE
)

840 *
št_v®ue
 = 
ps
->
cu¼’tBry
;

841 
¡©
 = 
SANE_STATUS_GOOD
;

843 ià(
aùiÚ
 =ğ
SANE_ACTION_SET_VALUE
)

845 ià(*
št_v®ue
 >ğ
ps
->
bryRªge
.
mš
 && *št_v®u<ğps->bryRªge.
max
)

847 
ps
->
cu¼’tBry
 = *
št_v®ue
;

848 
m£t_»suÉ
 |ğ
SANE_INFO_RELOAD_PARAMS
;

849 
¡©
 = 
SANE_STATUS_GOOD
;

852 
	`BUG
("v®ue=%d brymš=%d brymax=%d\n", *
št_v®ue
, 
ps
->
bryRªge
.
mš
,…s->bryRªge.
max
);

856 
ps
->
cu¼’tBry
 =…s->
bryRªge
.
max
;

857 
¡©
 = 
SANE_STATUS_GOOD
;

864 ià(
£t_»suÉ
)

865 *
£t_»suÉ
 = 
m£t_»suÉ
;

867 ià(
¡©
 !ğ
SANE_STATUS_GOOD
)

869 
	`BUG
("cÚŒŞ_İtiÚ faed: o±iÚ=% aùiÚ=%s\n", 
ps
->
İtiÚ
[İtiÚ].
Çme
,

870 
aùiÚ
==
SANE_ACTION_GET_VALUE
 ? "g‘" :‡ùiÚ==
SANE_ACTION_SET_VALUE
 ? "set" : "auto");

873 
	`DBG8
("§Ã_h·io_cÚŒŞ_İtiÚ (İtiÚ=% aùiÚ=% v®ue=%s)\n", 
ps
->
İtiÚ
[İtiÚ].
Çme
,

874 
aùiÚ
==
SANE_ACTION_GET_VALUE
 ? "g‘" :‡ùiÚ==
SANE_ACTION_SET_VALUE
 ? "set" : "auto",

875 
v®ue
 ? 
ps
->
İtiÚ
[İtiÚ].
ty³
 =ğ
SANE_TYPE_STRING
 ? (*)v®u: 
	`p¢´štf
(
sz
, (sz), "%d", *(*)value) : "na");

877  
¡©
;

878 
	}
}

880 
SANE_Stus
 
	$m¬v–l_g‘_·¿m‘”s
(
SANE_HªdË
 
hªdË
, 
SANE_P¬am‘”s
 *
·¿ms
)

882 
m¬v–l_£ssiÚ
 *
ps
 = (m¬v–l_£ssiÚ *)
hªdË
;

884 
	`£t_ex‹Ás
(
ps
);

886 
ps
->
	`bb_g‘_·¿m‘”s
Õs, 
·¿ms
,…s->
_hªdË
 ? 1 : 0);

888 
	`DBG8
("sane_hpaio_get_parameters(): format=%d,†ast_frame=%d,†ines=%d, depth=%d,…ixels_per_line=%d, bytes_per_line=%d\n",

889 
·¿ms
->
fÜm©
,…¬ams->
Ï¡_äame
,…¬ams->
lšes
,…¬ams->
d•th
,…¬ams->
pix–s_³r_lše
,…¬ams->
by‹s_³r_lše
);

891  
SANE_STATUS_GOOD
;

892 
	}
}

894 
SANE_Stus
 
	$m¬v–l_¡¬t
(
SANE_HªdË
 
hªdË
)

896 
m¬v–l_£ssiÚ
 *
ps
 = (m¬v–l_£ssiÚ *)
hªdË
;

897 
SANE_P¬am‘”s
 
µ
;

898 
IP_IMAGE_TRAITS
 
Œa™s
;

899 
IP_XFORM_SPEC
 
xfÜms
[
IP_MAX_XFORMS
], *
pXfÜm
=xforms;

900 
¡©
, 
»t
;

903 
	`DBG8
("sane_hpaio_start()\n");

904 
ps
->
is_u£r_ÿnûl
 = 0;

906 ià(
	`£t_ex‹Ás
(
ps
))

908 
	`BUG
("invalidƒxtents:lx=%d brx=%dly=%d bry=%d minwidth=%d minheight%d maxwidth=%d maxheight=%d\n",

909 
ps
->
cu¼’tTlx
,…s->
cu¼’tTly
,…s->
cu¼’tBrx
,…s->
cu¼’tBry
,…s->
mš_width
,…s->
mš_height
,…s->
xRªge
.
max
,…s->
yRªge
.max);

910 
¡©
 = 
SANE_STATUS_INVAL
;

911 
bugout
;

915 ià(
ps
->
cu¼’t_šput_sourû
 =ğ
IS_ADF
)

917 
»t
 = 
ps
->
	`bb_is_·³r_š_adf
(ps);

918 ià(
»t
 == 0)

920 
¡©
 = 
SANE_STATUS_NO_DOCS
;

921 
	`S’dSÿnEv’t
(
ps
->
uri
, 
EVENT_SCAN_ADF_NO_DOCS
);

922 
bugout
;

924 ià(
»t
 < 0)

926 
¡©
 = 
SANE_STATUS_IO_ERROR
;

927 
bugout
;

931 ià(
ps
->
	`bb_¡¬t_sÿn
(ps))

933 
¡©
 = 
SANE_STATUS_IO_ERROR
;

934 
bugout
;

937 
	`S’dSÿnEv’t
(
ps
->
uri
, 
EVENT_START_SCAN_JOB
);

938 
	`mem£t
(
xfÜms
, 0, (xforms));

941 ià(
ps
->
cu¼’t_sÿn_mode
 =ğ
CE_BLACK_AND_WHITE1
)

943 
pXfÜm
->
aXfÜmInfo
[
IP_GRAY_2_BI_THRESHOLD
].
dwÜd
 = 127;

944 
	`ADD_XFORM
(
X_GRAY_2_BI
);

948 
pXfÜm
->
aXfÜmInfo
[
IP_CROP_LEFT
].
dwÜd
 = 0;

949 
pXfÜm
->
aXfÜmInfo
[
IP_CROP_RIGHT
].
dwÜd
 = 0;

950 
pXfÜm
->
aXfÜmInfo
[
IP_CROP_TOP
].
dwÜd
 = 0;

951 
pXfÜm
->
aXfÜmInfo
[
IP_CROP_MAXOUTROWS
].
dwÜd
 = 0;

952 
	`ADD_XFORM
(
X_CROP
);

955 
pXfÜm
->
aXfÜmInfo
[
IP_PAD_LEFT
].
dwÜd
 = 0;

956 
pXfÜm
->
aXfÜmInfo
[
IP_PAD_RIGHT
].
dwÜd
 = 0;

957 
pXfÜm
->
aXfÜmInfo
[
IP_PAD_TOP
].
dwÜd
 = 0;

958 
pXfÜm
->
aXfÜmInfo
[
IP_PAD_BOTTOM
].
dwÜd
 = 0;

959 
pXfÜm
->
aXfÜmInfo
[
IP_PAD_VALUE
].
dwÜd
 = 
ps
->
cu¼’t_sÿn_mode
 =ğ
CE_BLACK_AND_WHITE1
 ? 0 : -1;

960 
pXfÜm
->
aXfÜmInfo
[
IP_PAD_MIN_HEIGHT
].
dwÜd
 = 0;

961 
	`ADD_XFORM
(
X_PAD
);

964 ià((
»t
 = 
	`O³n
(
pXfÜm
-
xfÜms
, xfÜms, 0, &
ps
->
_hªdË
)è!ğ
IP_DONE
)

966 
	`BUG
("uÇbË o³Àimag´oûssÜ:ƒ¼=%d\n", 
»t
);

967 
¡©
 = 
SANE_STATUS_INVAL
;

968 
bugout
;

972 
ps
->
	`bb_g‘_·¿m‘”s
Õs, &
µ
, 1);

975 
Œa™s
.
iPix–sP”Row
 = 
µ
.
pix–s_³r_lše
;

976 
ps
->
cu¼’t_sÿn_mode
)

978 
CE_BLACK_AND_WHITE1
:

979 
CE_GRAY8
:

980 
Œa™s
.
iB™sP”Pix–
 = 8;

982 
CE_RGB24
:

984 
Œa™s
.
iB™sP”Pix–
 = 24;

987 
Œa™s
.
lHÜizDPI
 = 
ps
->
cu¼’t_»sŞutiÚ
 << 16;

988 
Œa™s
.
lV”tDPI
 = 
ps
->
cu¼’t_»sŞutiÚ
 << 16;

989 
Œa™s
.
lNumRows
 = 
µ
.
lšes
;

990 
Œa™s
.
iNumPages
 = 1;

991 
Œa™s
.
iPageNum
 = 1;

992 
Œa™s
.
iCompÚ’tsP”Pix–
 = (Ñ¿™s.
iB™sP”Pix–
 % 3) ? 1 : 3);

993 
	`S‘DeçuÉIÅutT¿™s
(
ps
->
_hªdË
, &
Œa™s
);

996 
	`G‘ImageT¿™s
(
ps
->
_hªdË
, 
NULL
, &ps->
image_Œa™s
);

998 
¡©
 = 
SANE_STATUS_GOOD
;

1000 
bugout
:

1001 ià(
¡©
 !ğ
SANE_STATUS_GOOD
)

1003 ià(
ps
->
_hªdË
)

1005 
	`Clo£
(
ps
->
_hªdË
);

1006 
ps
->
_hªdË
 = 0;

1008 
ps
->
	`bb_’d_sÿn
Õs, 
¡©
 =ğ
SANE_STATUS_IO_ERROR
 ? 1: 0);

1011  
¡©
;

1012 
	}
}

1014 
SANE_Stus
 
	$m¬v–l_»ad
(
SANE_HªdË
 
hªdË
, 
SANE_By‹
 *
d©a
, 
SANE_IÁ
 
maxL’gth
, SANE_IÁ *
Ëngth
)

1016 
m¬v–l_£ssiÚ
 *
ps
 = (m¬v–l_£ssiÚ *)
hªdË
;

1017 
»t
, 
¡©
=
SANE_STATUS_IO_ERROR
;

1020 
	`DBG8
("§Ã_h·io_»ad(èhªdË=%°d©a=%°maxL’gth=%d\n", (*)
hªdË
, 
d©a
, 
maxL’gth
);

1022 
»t
 = 
	`g‘__d©a
(
ps
, 
d©a
, 
maxL’gth
, 
Ëngth
);

1024 if(
»t
 & (
IP_INPUT_ERROR
 | 
IP_FATAL_ERROR
))

1026 
	`BUG
("CÚv”ˆ”rÜ=%x\n", 
»t
);

1027 
bugout
;

1030 ià(
»t
 & 
IP_DONE
)

1032 
¡©
 = 
SANE_STATUS_EOF
;

1033 
	`S’dSÿnEv’t
(
ps
->
uri
, 
EVENT_END_SCAN_JOB
);

1036 
¡©
 = 
SANE_STATUS_GOOD
;

1038 
bugout
:

1039 ià(
¡©
 !ğ
SANE_STATUS_GOOD
)

1041 ià(
ps
->
_hªdË
)

1044 
	`Clo£
(
ps
->
_hªdË
);

1045 
ps
->
_hªdË
 = 0;

1048 ià(
ps
->
is_u£r_ÿnûl
)

1051 
	`S’dSÿnEv’t
(
ps
->
uri
, 
EVENT_SCAN_CANCEL
);

1052  
SANE_STATUS_CANCELLED
;

1057 
ps
->
	`bb_’d_·ge
Õs, 
¡©
 =ğ
SANE_STATUS_IO_ERROR
 ? 1: 0);

1061 
	`DBG8
("-§Ã_h·io_»ad(èouut=%°by‹s_»ad=%d maxL’gth=%d stus=%d\n", 
d©a
, *
Ëngth
, 
maxL’gth
, 
¡©
);

1063  
¡©
;

1064 
	}
}

1066 
	$m¬v–l_ÿnûl
(
SANE_HªdË
 
hªdË
)

1068 
m¬v–l_£ssiÚ
 *
ps
 = (m¬v–l_£ssiÚ *)
hªdË
;

1070 
	`DBG8
("sane_hpaio_cancel()\n");

1076 
ps
->
is_u£r_ÿnûl
 = 1 ;

1078 ià(
ps
->
_hªdË
)

1080 
	`Clo£
(
ps
->
_hªdË
);

1081 
ps
->
_hªdË
 = 0;

1083 
ps
->
	`bb_’d_sÿn
(ps, 0);

1084 
	}
}

	@scan/sane/marvell.h

26 #iâdeà
_MARVELL_H


27 
	#_MARVELL_H


	)

29 
	~"§Ã.h
"

31 
SANE_Stus
 
m¬v–l_İ’
(
SANE_SŒšg_CÚ¡
 
deviû
, 
SANE_HªdË
 *
hªdË
);

32 
m¬v–l_şo£
(
SANE_HªdË
 
hªdË
);

33 cÚ¡ 
SANE_O±iÚ_DesütÜ
 * 
m¬v–l_g‘_İtiÚ_desütÜ
(
SANE_HªdË
 
hªdË
, 
SANE_IÁ
 
İtiÚ
);

34 
SANE_Stus
 
m¬v–l_cÚŒŞ_İtiÚ
(
SANE_HªdË
 
hªdË
, 
SANE_IÁ
 
İtiÚ
, 
SANE_AùiÚ
 
aùiÚ
, *
v®ue
, SANE_IÁ *
šfo
);

35 
SANE_Stus
 
m¬v–l_g‘_·¿m‘”s
(
SANE_HªdË
 
hªdË
, 
SANE_P¬am‘”s
 *
·¿ms
);

36 
SANE_Stus
 
m¬v–l_¡¬t
(
SANE_HªdË
 
hªdË
);

37 
SANE_Stus
 
m¬v–l_»ad
(
SANE_HªdË
 
hªdË
, 
SANE_By‹
 *
d©a
, 
SANE_IÁ
 
maxL’gth
, SANE_IÁ *
Ëngth
);

38 
m¬v–l_ÿnûl
(
SANE_HªdË
 
hªdË
);

	@scan/sane/marvelli.h

29 #iâdeà
_MARVELLI_H


30 
	#_MARVELLI_H


	)

32 
	#MARVELL_CONTRAST_MIN
 1

	)

33 
	#MARVELL_CONTRAST_MAX
 11

	)

34 
	#MARVELL_CONTRAST_DEFAULT
 6

	)

35 
	#MARVELL_BRIGHTNESS_MIN
 0

	)

36 
	#MARVELL_BRIGHTNESS_MAX
 200

	)

37 
	#MARVELL_BRIGHTNESS_DEFAULT
 6

	)

39 
	#MM_PER_INCH
 25.4

	)

41 
	eMARVELL_OPTION_NUMBER


43 
	mMARVELL_OPTION_COUNT
 = 0,

44 
	mMARVELL_OPTION_GROUP_SCAN_MODE
,

45 
	mMARVELL_OPTION_SCAN_MODE
,

46 
	mMARVELL_OPTION_SCAN_RESOLUTION
,

47 
	mMARVELL_OPTION_INPUT_SOURCE
,

48 
	mMARVELL_OPTION_GROUP_ADVANCED
,

49 
	mMARVELL_OPTION_CONTRAST
,

50 
	mMARVELL_OPTION_BRIGHTNESS
,

51 
	mMARVELL_OPTION_GROUP_GEOMETRY
,

52 
	mMARVELL_OPTION_TL_X
,

53 
	mMARVELL_OPTION_TL_Y
,

54 
	mMARVELL_OPTION_BR_X
,

55 
	mMARVELL_OPTION_BR_Y
,

56 
	mMARVELL_OPTION_MAX


59 
	#MAX_LIST_SIZE
 32

	)

60 
	#MAX_STRING_SIZE
 32

	)

62 
	eCOLOR_ENTRY


64 
	mCE_BLACK_AND_WHITE1
 = 1,

65 
	mCE_GRAY8
,

66 
	mCE_RGB24
,

67 
	mCE_MAX
,

70 
	eINPUT_SOURCE


72 
	mIS_PLATEN
 = 1,

73 
	mIS_ADF
,

74 
	mIS_MAX
,

77 
	eMARVELL_VERSION


79 
	mMARVELL_1
 = 1,

80 
	mMARVELL_2
,

83 
	sm¬v–l_£ssiÚ


85 *
	mg
;

86 
HPMUD_DEVICE
 
	mdd
;

87 
HPMUD_CHANNEL
 
	mcd
;

88 
	muri
[
HPMUD_LINE_SIZE
];

89 
	mmod–
[
HPMUD_LINE_SIZE
];

90 
	msÿn_ty³
;

91 
	mis_u£r_ÿnûl
;

92 
IP_IMAGE_TRAITS
 
	mimage_Œa™s
;

94 
SANE_O±iÚ_DesütÜ
 
	mİtiÚ
[
MARVELL_OPTION_MAX
];

96 
SANE_SŒšg_CÚ¡
 
	msÿn_mode_li¡
[
CE_MAX
];

97 
COLOR_ENTRY
 
	msÿn_mode_m­
[
CE_MAX
];

98 
COLOR_ENTRY
 
	mcu¼’t_sÿn_mode
;

100 
SANE_SŒšg_CÚ¡
 
	mšput_sourû_li¡
[
IS_MAX
];

101 
INPUT_SOURCE
 
	mšput_sourû_m­
[
IS_MAX
];

102 
INPUT_SOURCE
 
	mcu¼’t_šput_sourû
;

104 
SANE_IÁ
 
	m»sŞutiÚ_li¡
[
MAX_LIST_SIZE
];

105 
SANE_IÁ
 
	mcu¼’t_»sŞutiÚ
;

107 
SANE_Rªge
 
	mcÚŒa¡_¿nge
;

108 
SANE_IÁ
 
	mcu¼’t_cÚŒa¡
;

109 
SANE_Rªge
 
	mbrighŠessRªge
;

110 
SANE_IÁ
 
	mcu¼’tBrighŠess
;

112 
SANE_Rªge
 
	mxRªge
, 
	myRªge
, 
	mbrxRªge
, 
	mbryRªge
;

113 
SANE_Fixed
 
	mcu¼’tTlx
, 
	mcu¼’tTly
, 
	mcu¼’tBrx
, 
	mcu¼’tBry
;

114 
SANE_Fixed
 
	mefãùiveTlx
, 
	mefãùiveTly
, 
	mefãùiveBrx
, 
	mefãùiveBry
;

115 
SANE_Fixed
 
	mmš_width
, 
	mmš_height
;

117 
SANE_IÁ
 
	m¶©’_»sŞutiÚ_li¡
[
MAX_LIST_SIZE
];

118 
SANE_IÁ
 
	madf_»sŞutiÚ_li¡
[
MAX_LIST_SIZE
];

120 
IP_HANDLE
 
	m_hªdË
;

122 
	mút
;

123 
	mbuf
[32768];

125 *
	mhpmud_hªdË
;

126 *
	mbb_hªdË
;

127 *
	mbb_£ssiÚ
;

128 (*
	mbb_İ’
)(
m¬v–l_£ssiÚ
 *
	mps
);

129 (*
	mbb_şo£
)(
m¬v–l_£ssiÚ
 *
	mps
);

130 (*
	mbb_g‘_·¿m‘”s
)(
m¬v–l_£ssiÚ
 *
	mps
, 
SANE_P¬am‘”s
 *
	mµ
, 
	msÿn_¡¬‹d
);

131 (*
	mbb_is_·³r_š_adf
)(
m¬v–l_£ssiÚ
 *
	mps
);

132 (*
	mbb_¡¬t_sÿn
)(
m¬v–l_£ssiÚ
 *
	mps
);

133 (*
	mbb_g‘_image_d©a
)(
m¬v–l_£ssiÚ
 *
	mps
, 
	mmax_Ëngth
);

134 (*
	mbb_’d_·ge
)(
m¬v–l_£ssiÚ
 *
	mps
, 
	mio_”rÜ
);

135 (*
	mbb_’d_sÿn
)(
m¬v–l_£ssiÚ
 *
	mps
, 
	mio_”rÜ
);

137 *
	mm©h_hªdË
;

138 
HPMUD_SCANSRC
 
	msÿn¤c
;

139 
MARVELL_VERSION
 
	mv”siÚ
;

	@scan/sane/mfpdtf.c

28 
	~"commÚ.h
"

29 
	~"mådtf.h
"

30 
	~"io.h
"

32 
	#DEBUG_DECLARE_ONLY


	)

33 
	~"§Ãi_debug.h
"

35 
MådtfV¬ŸÁH—d”_u
 * 
	$MådtfR—dAÎoÿ‹V¬ŸÁH—d”
Ğ
Mådtf_t
 
mådtf
,

36 
d©®’
 )

38 ifĞ
mådtf
->
»ad
.
pV¬ŸÁH—d”
 )

40 
	`ä“
Ğ
mådtf
->
»ad
.
pV¬ŸÁH—d”
 );

41 
mådtf
->
»ad
.
pV¬ŸÁH—d”
 = 0;

43 
mådtf
->
»ad
.
ËnV¬ŸÁH—d”
 = 
d©®’
;

44 ifĞ
d©®’
 )

46 
mådtf
->
»ad
.
pV¬ŸÁH—d”
 = 
	`m®loc
Ğ
d©®’
 );

48  
mådtf
->
»ad
.
pV¬ŸÁH—d”
;

49 
	}
}

51 
	$MådtfR—dS‘Timeout
Ğ
Mådtf_t
 
mådtf
, 
£cÚds
 )

53 
mådtf
->
»ad
.
timeout
.
tv_£c
 = 
£cÚds
;

54 
mådtf
->
»ad
.
timeout
.
tv_u£c
 = 0;

56  
£cÚds
;

57 
	}
}

59 
Mådtf_t
 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
	$MådtfAÎoÿ‹
Ğ
deviûid
, 
chªÃlid
 )

61 
size
 = Ğ
Mådtf_s
 );

62 
Mådtf_t
 
mådtf
 = 
	`m®loc
Ğ
size
 );

64 ifĞ
mådtf
 )

66 
	`mem£t
Ğ
mådtf
, 0, 
size
 );

67 
mådtf
->
chªÃlid
 = channelid;

68 
mådtf
->
deviûid
 = deviceid;

69 
mådtf
->
fdLog
 = -1;

70 
	`MådtfR—dS‘Timeout
Ğ
mådtf
, 30 );

71 
	`MådtfR—dS¹
Ğ
mådtf
 );

74  
mådtf
;

75 
	}
}

77 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
	$MådtfD—Îoÿ‹
Ğ
Mådtf_t
 
mådtf
 )

79 ifĞ!
mådtf
 )

81  
ERROR
;

83 
	`MådtfLogToFe
Ğ
mådtf
, 0 );

84 
	`MådtfR—dAÎoÿ‹V¬ŸÁH—d”
Ğ
mådtf
, 0 );

85 
	`ä“
Ğ
mådtf
 );

86  
OK
;

87 
	}
}

89 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
	$MådtfS‘ChªÃl
Ğ
Mådtf_t
 
mådtf
, 
chªÃlid
 )

91 
mådtf
->
chªÃlid
 = channelid;

94  
OK
;

95 
	}
}

97 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
	$MådtfLogToFe
Ğ
Mådtf_t
 
mådtf
, * 
f’ame
 )

99 ifĞ
mådtf
->
fdLog
 != -1 )

101 
	`şo£
Ğ
mådtf
->
fdLog
 );

102 
mådtf
->
fdLog
 = -1;

104 
mådtf
->
logOff£t
 = 0;

105 ifĞ
f’ame
 )

107 
fd
 = 
	`ü—t
Ğ
f’ame
, 0600 );

108 ifĞ
fd
 < 0 )

110  
ERROR
;

112 
mådtf
->
fdLog
 = 
fd
;

114  
OK
;

115 
	}
}

117 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
	$MådtfR—dG‘SimuÏ‹ImageH—d”s
Ğ
Mådtf_t
 
mådtf
 )

119  
mådtf
->
»ad
.
simuÏ‹ImageH—d”s
;

120 
	}
}

122 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
	$MådtfR—dS‘SimuÏ‹ImageH—d”s
Ğ
Mådtf_t
 
mådtf
,

123 
simuÏ‹ImageH—d”s
 )

125 
mådtf
->
»ad
.
simuÏ‹ImageH—d”s
 = simulateImageHeaders;

126  
simuÏ‹ImageH—d”s
;

127 
	}
}

129 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
	$MådtfR—dS¹
Ğ
Mådtf_t
 
mådtf
 )

131 
mådtf
->
»ad
.
Ï¡S”viûResuÉ
 = 0;

132 
mådtf
->
»ad
.
d©aTy³
 = 
ERROR
;

133 
mådtf
->
»ad
.
¬¿yRecÜdCouÁ
 = mådtf->»ad.
¬¿yRecÜdSize
;

134 
mådtf
->
»ad
.
fixedBlockBy‹sRemaššg
 = 0;

135 
mådtf
->
»ad
.
šÃrBlockBy‹sRemaššg
 = 0;

136 
mådtf
->
»ad
.
dÚtDeüem’tIÂ”Block
 = 0;

137 
	`MådtfR—dAÎoÿ‹V¬ŸÁH—d”
Ğ
mådtf
, 0 );

139  
OK
;

140 
	}
}

142 
	$MådtfR—dIsImageD©a
Ğ
Mådtf_t
 
mådtf
 )

144  ( ( 
MFPDTF_DT_MASK_IMAGE
 & ( 1 << 
mådtf
->
»ad
.
d©aTy³
 ) ) !=

146 
	}
}

148 
	$MådtfR—dIsA¼ayD©a
Ğ
Mådtf_t
 
mådtf
 )

150  ( !
	`MådtfR—dIsImageD©a
Ğ
mådtf
 ) );

151 
	}
}

153 
	#READ
(
bufãr
,
d©®’
) \

155 
r
=
	`MådtfR—dG’”ic
(
mådtf
, \

156 (*)(
bufãr
),
d©®’
); \

157 ià(
r
!=
d©®’
) { \

158 ià(
r
<0è 
MFPDTF_RESULT_READ_ERROR
; \

159  
MFPDTF_RESULT_READ_TIMEOUT
; \

161 } 0)

	)

163 
	#RETURN
(
_»suÉ
) \

164  (
mådtf
->
»ad
.
Ï¡S”viûResuÉ
=(
_»suÉ
));

	)

166 
	$MådtfR—dG’”ic
Ğ
Mådtf_t
 
mådtf
, * 
bufãr
, 
d©®’
 )

168 
r
 = 0;

171 ifĞ
d©®’
 > 
mådtf
->
»ad
.
fixedBlockBy‹sRemaššg
 )

173 
d©®’
 = 
mådtf
->
»ad
.
fixedBlockBy‹sRemaššg
;

177 ifĞ
d©®’
 > 0 )

179 
r
 = 
	`R—dChªÃlEx
(
mådtf
->
deviûid
,

180 
mådtf
->
chªÃlid
,

181 
bufãr
,

182 
d©®’
,

183 
EXCEPTION_TIMEOUT
);

185 ifĞ
r
 > 0 )

188 
mådtf
->
»ad
.
fixedBlockBy‹sRemaššg
 -ğ
r
;

190 ifĞ!
mådtf
->
»ad
.
dÚtDeüem’tIÂ”Block
 )

192 
mådtf
->
»ad
.
šÃrBlockBy‹sRemaššg
 -ğ
r
;

195 
mådtf
->
»ad
.
dÚtDeüem’tIÂ”Block
 = 0;

198 ifĞ
r
 !ğ
d©®’
 )

200 
mådtf
->
»ad
.
Ï¡S”viûResuÉ
 = 
r
 < 0 ?

201 
MFPDTF_RESULT_READ_ERROR
 :

202 
MFPDTF_RESULT_READ_TIMEOUT
;

206  
r
;

207 
	}
}

209 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
	$MådtfR—dS”viû
Ğ
Mådtf_t
 
mådtf
 )

211 
»suÉ
 = 0;

212 
d©®’
, 
blockL’gth
, 
h—d”L’gth
;

214 ifĞ
mådtf
->
»ad
.
fixedBlockBy‹sRemaššg
 <= 0 )

217 
d©®’
 = Ğ
mådtf
->
»ad
.
fixedH—d”
 );

218 
mådtf
->
»ad
.
fixedBlockBy‹sRemaššg
 = 
d©®’
;

220 
mådtf
->
»ad
.
dÚtDeüem’tIÂ”Block
 = 1;

224 
r
 = 
	`MådtfR—dG’”ic
Ğ
mådtf
, (*)&mådtf->
»ad
.
fixedH—d”
, 
d©®’
 );

226 ifĞ
r
!ğ
d©®’
 )

228 ifĞ
r
 < 0 )

229  
MFPDTF_RESULT_READ_ERROR
;

231  
MFPDTF_RESULT_READ_TIMEOUT
;

235 
blockL’gth
 = 
	`LEND_GET_LONG
Ğ
mådtf
->
»ad
.
fixedH—d”
.blockLength );

236 
mådtf
->
»ad
.
fixedBlockBy‹sRemaššg
 = 
blockL’gth
 - 
d©®’
;

237 
h—d”L’gth
 = 
	`LEND_GET_SHORT
Ğ
mådtf
->
»ad
.
fixedH—d”
.headerLength );

240 if(
mådtf
->
»ad
.
fixedH—d”
.
d©aTy³
 !ğ
DT_SCAN
)

242 
	`bug
("šv®id mådtàfixed h—d” d©©y³=%d\n", 
mådtf
->
»ad
.
fixedH—d”
.
d©aTy³
);

243  
MFPDTF_RESULT_READ_ERROR
;

247 ifĞ
mådtf
->
»ad
.
d©aTy³
 !ğmådtf->»ad.
fixedH—d”
.dataType )

249 
mådtf
->
»ad
.
d©aTy³
 = mådtf->»ad.
fixedH—d”
.dataType;

250 
»suÉ
 |ğ
MFPDTF_RESULT_NEW_DATA_TYPE
;

253 
	`DBG
(6, "fixed h—d”…age_æags=%x: % %d\n", 
mådtf
->
»ad
.
fixedH—d”
.
·geFÏgs
, 
__FILE__
, 
__LINE__
);

256 
d©®’
 = 
h—d”L’gth
 - Ğ
mådtf
->
»ad
.
fixedH—d”
 );

258 ifĞ
d©®’
 > 0 )

260 
	`DBG
(6, "»adšg v¬ŸÁ h—d” size=%d: % %d\n", 
d©®’
, 
__FILE__
, 
__LINE__
);

262 ifĞ!
	`MådtfR—dAÎoÿ‹V¬ŸÁH—d”
Ğ
mådtf
, 
d©®’
 ) )

264 
	`RETURN
Ğ
MFPDTF_RESULT_OTHER_ERROR
 );

266 
mådtf
->
»ad
.
dÚtDeüem’tIÂ”Block
 = 1;

268 
r
 = 
	`MådtfR—dG’”ic
Ğ
mådtf
, (*)mådtf->
»ad
.
pV¬ŸÁH—d”
, 
d©®’
 );

270 ifĞ
r
!ğ
d©®’
 )

272 ifĞ
r
 < 0 )

273  
MFPDTF_RESULT_READ_ERROR
;

275  
MFPDTF_RESULT_READ_TIMEOUT
;

281 
»suÉ
 |ğ
MFPDTF_RESULT_NEW_VARIANT_HEADER
;

284 
mådtf
->
»ad
.
¬¿yRecÜdSize
 = 0;

285 
mådtf
->
»ad
.
¬¿yRecÜdCouÁ
 = 0;

286 
mådtf
->
»ad
.
šÃrBlockBy‹sRemaššg
 = 0;

288 ifĞ
	`MådtfR—dIsA¼ayD©a
Ğ
mådtf
 ) &&

289 
mådtf
->
»ad
.
ËnV¬ŸÁH—d”
 >=

290 Ğ
mådtf
->
»ad
.
pV¬ŸÁH—d”
->
¬¿y
 ) )

292 
mådtf
->
»ad
.
¬¿yRecÜdCouÁ
 = 
	`LEND_GET_SHORT
Ğmådtf->»ad.
pV¬ŸÁH—d”
->
¬¿y
.
»cÜdCouÁ
 );

293 
mådtf
->
»ad
.
¬¿yRecÜdSize
 = 
	`LEND_GET_SHORT
Ğmådtf->»ad.
pV¬ŸÁH—d”
->
¬¿y
.
»cÜdSize
 );

294 
mådtf
->
»ad
.
šÃrBlockBy‹sRemaššg
 = mådtf->»ad.
¬¿yRecÜdCouÁ
 * mådtf->»ad.
¬¿yRecÜdSize
;

298 ifĞ
	`MådtfR—dIsImageD©a
Ğ
mådtf
 ) )

300 ifĞ
mådtf
->
»ad
.
šÃrBlockBy‹sRemaššg
 > 0 )

302 
»suÉ
 |ğ
MFPDTF_RESULT_IMAGE_DATA_PENDING
;

304 ifĞ
mådtf
->
»ad
.
simuÏ‹ImageH—d”s
 )

306 
mådtf
->
»ad
.
šÃrBlockBy‹sRemaššg
 = mådtf->»ad.
fixedBlockBy‹sRemaššg
;

308 ifĞ
mådtf
->
»ad
.
šÃrBlockBy‹sRemaššg
 > 0 )

310 
»suÉ
 |ğ
MFPDTF_RESULT_IMAGE_DATA_PENDING
;

315 
id
;

316 
d©®’
 = 1;

320 
r
 = 
	`MådtfR—dG’”ic
Ğ
mådtf
, (*)&
id
, 
d©®’
 );

322 ifĞ
r
!ğ
d©®’
 )

324 ifĞ
r
 < 0 )

325  
MFPDTF_RESULT_READ_ERROR
;

327  
MFPDTF_RESULT_READ_TIMEOUT
;

331 ifĞ
id
 =ğ
MFPDTF_ID_RASTER_DATA
 )

333 
d©®’
 = Ğ
mådtf
->
»ad
.
imageRa¡”D©aH—d”
 );

337 
r
 = 
	`MådtfR—dG’”ic
Ğ
mådtf
, (*)&mådtf->
»ad
.
imageRa¡”D©aH—d”
, 
d©®’
 );

339 ifĞ
r
!ğ
d©®’
 )

341 ifĞ
r
 < 0 )

342  
MFPDTF_RESULT_READ_ERROR
;

344  
MFPDTF_RESULT_READ_TIMEOUT
;

349 
mådtf
->
»ad
.
šÃrBlockBy‹sRemaššg
 = 
	`LEND_GET_SHORT
Ğmådtf->»ad.
imageRa¡”D©aH—d”
.
by‹CouÁ
 );

350 
»suÉ
 |ğ
MFPDTF_RESULT_IMAGE_DATA_PENDING
;

352 ifĞ
id
 =ğ
MFPDTF_ID_START_PAGE
 )

354 
d©®’
 = Ğ
mådtf
->
»ad
.
imageS¹PageRecÜd
 );

357 
r
 = 
	`MådtfR—dG’”ic
Ğ
mådtf
, (*)&mådtf->
»ad
.
imageS¹PageRecÜd
, 
d©®’
 );

359 ifĞ
r
!ğ
d©®’
 )

361 ifĞ
r
 < 0 )

362  
MFPDTF_RESULT_READ_ERROR
;

364  
MFPDTF_RESULT_READ_TIMEOUT
;

368 
»suÉ
 |ğ
MFPDTF_RESULT_NEW_START_OF_PAGE_RECORD
;

370 ifĞ
id
 =ğ
MFPDTF_ID_END_PAGE
 )

372 
d©®’
 = Ğ
mådtf
->
»ad
.
imageEndPageRecÜd
 );

375 
r
 = 
	`MådtfR—dG’”ic
Ğ
mådtf
, (*)&mådtf->
»ad
.
imageEndPageRecÜd
, 
d©®’
 );

377 ifĞ
r
!ğ
d©®’
 )

379 ifĞ
r
 < 0 )

380  
MFPDTF_RESULT_READ_ERROR
;

382  
MFPDTF_RESULT_READ_TIMEOUT
;

387 
»suÉ
 |ğ
MFPDTF_RESULT_NEW_END_OF_PAGE_RECORD
;

391 
	`RETURN
Ğ
MFPDTF_RESULT_OTHER_ERROR
 );

395 ifĞ
	`MådtfR—dIsA¼ayD©a
Ğ
mådtf
 ) )

397 ifĞ
mådtf
->
»ad
.
šÃrBlockBy‹sRemaššg
 > 0 )

399 
»suÉ
 |ğ
MFPDTF_RESULT_ARRAY_DATA_PENDING
;

403 ifĞ
mådtf
->
»ad
.
fixedBlockBy‹sRemaššg
 > 0 )

405 
»suÉ
 |ğ
MFPDTF_RESULT_GENERIC_DATA_PENDING
;

408 
	`RETURN
ĞĞ
»suÉ
 | 
mådtf
->
»ad
.
fixedH—d”
.
·geFÏgs
 ) );

409 
	}
}

411 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
	$MådtfR—dG‘La¡S”viûResuÉ
Ğ
Mådtf_t
 
mådtf
 )

413  
mådtf
->
»ad
.
Ï¡S”viûResuÉ
;

414 
	}
}

416 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
	$MådtfR—dG‘V¬ŸÁH—d”
Ğ
Mådtf_t
 
mådtf
,

417 
MådtfV¬ŸÁH—d”_u
 * 
bufãr
,

418 
maxËn
 )

420 ifĞ!
mådtf
->
»ad
.
pV¬ŸÁH—d”
 )

424 ifĞ!
bufãr
 )

426  
mådtf
->
»ad
.
ËnV¬ŸÁH—d”
;

428 ifĞ
maxËn
 > 
mådtf
->
»ad
.
ËnV¬ŸÁH—d”
 )

430 
maxËn
 = 
mådtf
->
»ad
.
ËnV¬ŸÁH—d”
;

432 
	`memıy
Ğ
bufãr
, 
mådtf
->
»ad
.
pV¬ŸÁH—d”
, 
maxËn
 );

433  
maxËn
;

434 
	}
}

436 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
	$MådtfR—dG‘S¹PageRecÜd
Ğ
Mådtf_t
 
mådtf
,

437 
MådtfImageS¹PageRecÜd_s
 * 
bufãr
,

438 
maxËn
 )

440 
Ën
 = Ğ
MådtfImageS¹PageRecÜd_s
 );

441 ifĞ
maxËn
 > 
Ën
 )

443 
maxËn
 = 
Ën
;

445 
	`memıy
Ğ
bufãr
, &
mådtf
->
»ad
.
imageS¹PageRecÜd
, 
maxËn
 );

446  
maxËn
;

447 
	}
}

449 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
	$MådtfR—dIÂ”Block
Ğ
Mådtf_t
 
mådtf
,

450 * 
bufãr
,

451 
couÁdown
 )

453 
r
, 
couÁup
 = 0;

457 ifĞ
couÁdown
 > 
mådtf
->
»ad
.
šÃrBlockBy‹sRemaššg
 )

459 
couÁdown
 = 
mådtf
->
»ad
.
šÃrBlockBy‹sRemaššg
;

462 ifĞ
couÁdown
 <= 0 )

467 
r
 = 
	`MådtfR—dG’”ic
Ğ
mådtf
, 
bufãr
, 
couÁdown
 );

469 ifĞ
	`MådtfR—dG‘La¡S”viûResuÉ
Ğ
mådtf
 ) & 
MFPDTF_RESULT_ERROR_MASK
 )

474 ifĞ
mådtf
->
fdLog
 >= 0 )

476 
	`wr™e
Ğ
mådtf
->
fdLog
, 
bufãr
, 
r
 );

479 
bufãr
 +ğ
r
;

480 
couÁdown
 -ğ
r
;

481 
couÁup
 +ğ
r
;

483 ifĞ
couÁdown
 <= 0 )

488 
r
 = 
	`MådtfR—dS”viû
Ğ
mådtf
 );

490 ifĞ
r
 & ( 
MFPDTF_RESULT_ERROR_MASK
 |

491 
MFPDTF_RESULT_NEW_DATA_TYPE
 |

492 
MFPDTF_RESULT_NEW_VARIANT_HEADER
 ) )

498  
couÁup
;

499 
	}
}

505 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
	$»ad_mådtf_block
(
deviû
, 
chªÃl
, *
buf
, 
bufSize
, 
timeout
)

507 
MFPDTF_FIXED_HEADER
 *
phd
 = (MFPDTF_FIXED_HEADER *)
buf
;

508 
size
, 
bsize
=0, 
Ën
;

511 
size
 = (
MFPDTF_FIXED_HEADER
);

512 ià((
Ën
 = 
	`R—dChªÃlEx
(
deviû
, 
chªÃl
, (*)
buf
, 
size
, 
timeout
)) != size)

513 
bugout
;

515 
bsize
 = 
	`Ë32toh
(
phd
->
BlockL’gth
);

516 ià(
bsize
 > 
bufSize
)

518 
	`bug
("šv®id bufsize: size=%d max=%d R—dMådtfBlock % %d\n", 
bsize
, 
bufSize
, 
__FILE__
, 
__LINE__
);

519 
bsize
 = -1;

520 
bugout
;

523 
size
 = 
bsize
 - (
MFPDTF_FIXED_HEADER
);

525 ià((
Ën
 = 
	`R—dChªÃlEx
(
deviû
, 
chªÃl
, (*)
buf
+(
MFPDTF_FIXED_HEADER
), 
size
, 10)) != size)

527 
	`bug
("šv®id„—d:ƒxp=%d‡ù=%d R—dMådtfBlock % %d\n", 
size
, 
Ën
, 
__FILE__
, 
__LINE__
);

528 
bsize
 = -1;

529 
bugout
;

532 
bugout
:

533  
bsize
;

534 
	}
}

	@scan/sane/mfpdtf.h

28 #ià!
defšed
(
_MFPDTF_H
 )

29 
	#_MFPDTF_H


	)

31 
	~<¡dlib.h
>

32 
	~<sys/ty³s.h
>

33 
	~<sys/¡©.h
>

34 
	~<fú.h
>

35 
	~<uni¡d.h
>

36 
	~<¡ršg.h
>

37 
	~<¡dšt.h
>

40 
	eMådtfImageRecÜdID_e
 { 
	mMFPDTF_ID_START_PAGE
 = 0,

41 
	mMFPDTF_ID_RASTER_DATA
 = 1,

42 
	mMFPDTF_ID_END_PAGE
 = 2 };

44 
	sMådtfFixedH—d”_s


46 
	mblockL’gth
[4];

47 
	mh—d”L’gth
[2];

48 
	md©aTy³
;

49 
	m·geFÏgs
;

50 } 
__©Œibu‹__
(Ğ
·cked
) );

52 
	sMådtfImageRa¡”D©aH—d”_s


54 
	mŒa™s
;

55 
	mby‹CouÁ
[2];

56 } 
__©Œibu‹__
(Ğ
·cked
) );

58 
	sMådtfImageS¹PageRecÜd_s


60 
	m’codšg
;

61 
	m·geNumb”
[2];

64 
	mpix–sP”Row
[2];

65 
	mb™sP”Pix–
[2];

66 
	mrowsThisPage
[4];

67 
	mx»s
[4];

68 
	my»s
[4];

69 } 
	mbÏck
, 
	mcŞÜ
;

70 } 
__©Œibu‹__
(Ğ
·cked
) );

72 
	sMådtfImageEndPageRecÜd_s


74 
	munu£d
[3];

77 
	mnumb”OfRows
[4];

78 } 
	mbÏck
, 
	mcŞÜ
;

79 } 
__©Œibu‹__
(Ğ
·cked
) );

81 
	sMådtf_s


84 
	mdeviûid
;

85 
	mchªÃlid
;

86 
	mfdLog
;

87 
	mlogOff£t
;

91 
timev®
 
	mtimeout
;

92 
	msimuÏ‹ImageH—d”s
;

94 
	mÏ¡S”viûResuÉ
;

95 
	md©aTy³
;

96 
	m¬¿yRecÜdCouÁ
;

97 
	m¬¿yRecÜdSize
;

98 
	mfixedBlockBy‹sRemaššg
;

99 
	mšÃrBlockBy‹sRemaššg
;

100 
	mdÚtDeüem’tIÂ”Block
;

102 
MådtfFixedH—d”_s
 
	mfixedH—d”
;

103 
	mËnV¬ŸÁH—d”
;

104 
MådtfV¬ŸÁH—d”_u
 * 
	mpV¬ŸÁH—d”
;

105 
MådtfImageS¹PageRecÜd_s
 
	mimageS¹PageRecÜd
;

106 
MådtfImageRa¡”D©aH—d”_s
 
	mimageRa¡”D©aH—d”
;

107 
MådtfImageEndPageRecÜd_s
 
	mimageEndPageRecÜd
;

108 } 
	m»ad
;

111 
Mådtf_s
 * 
	tMådtf_t
;

113 
	#MFPDTF_RESULT_NEW_PAGE
 0x00000001

	)

114 
	#MFPDTF_RESULT_END_PAGE
 0x00000002

	)

115 
	#MFPDTF_RESULT_NEW_DOCUMENT
 0x00000004

	)

116 
	#MFPDTF_RESULT_END_DOCUMENT
 0x00000008

	)

118 
	#MFPDTF_RESULT_END_STREAM
 0x00000010

	)

119 
	#MFPDTF_RESULT_RESERVED_20
 0x00000020

	)

120 
	#MFPDTF_RESULT_RESERVED_40
 0x00000040

	)

121 
	#MFPDTF_RESULT_RESERVED_80
 0x00000080

	)

123 
	#MFPDTF_RESULT_00000100
 0x00000100

	)

124 
	#MFPDTF_RESULT_READ_TIMEOUT
 0x00000200

	)

125 
	#MFPDTF_RESULT_READ_ERROR
 0x00000400

	)

126 
	#MFPDTF_RESULT_OTHER_ERROR
 0x00000800

	)

128 
	#MFPDTF_RESULT_ERROR_MASK
 0x00000E00

	)

130 
	#MFPDTF_RESULT_NEW_DATA_TYPE
 0x00001000

	)

131 
	#MFPDTF_RESULT_NEW_VARIANT_HEADER
 0x00002000

	)

132 
	#MFPDTF_RESULT_GENERIC_DATA_PENDING
 0x00004000

	)

133 
	#MFPDTF_RESULT_ARRAY_DATA_PENDING
 0x00008000

	)

135 
	#MFPDTF_RESULT_NEW_START_OF_PAGE_RECORD
 0x00010000

	)

136 
	#MFPDTF_RESULT_IMAGE_DATA_PENDING
 0x00020000

	)

137 
	#MFPDTF_RESULT_NEW_END_OF_PAGE_RECORD
 0x00040000

	)

138 
	#MFPDTF_RESULT_00080000
 0x00080000

	)

140 
	#MFPDTF_RESULT_INNER_DATA_PENDING
 0x00028000

	)

142 
	eMådtfD©aTy³_e
 { 
	mMFPDTF_DT_UNKNOWN
 = 0,

143 
	mMFPDTF_DT_FAX_IMAGES
 = 1,

144 
	mMFPDTF_DT_SCANNED_IMAGES
 = 2,

145 
	mMFPDTF_DT_DIAL_STRINGS
 = 3,

146 
	mMFPDTF_DT_DEMO_PAGES
 = 4,

147 
	mMFPDTF_DT_SPEED_DIALS
 = 5,

148 
	mMFPDTF_DT_FAX_LOGS
 = 6,

149 
	mMFPDTF_DT_CFG_PARMS
 = 7,

150 
	mMFPDTF_DT_LANG_STRS
 = 8,

151 
	mMFPDTF_DT_JUNK_FAX_CSIDS
 = 9,

152 
	mMFPDTF_DT_REPORT_STRS
 = 10,

153 
	mMFPDTF_DT_FONTS
 = 11,

154 
	mMFPDTF_DT_TTI_BITMAP
 = 12,

155 
	mMFPDTF_DT_COUNTERS
 = 13,

156 
	mMFPDTF_DT_DEF_PARMS
 = 14,

157 
	mMFPDTF_DT_SCAN_OPTIONS
 = 15,

158 
	mMFPDTF_DT_FW_JOB_TABLE
 = 17 };

159 
	#MFPDTF_DT_MASK_IMAGE
 \

160 ((1<<
MFPDTF_DT_FAX_IMAGES
) | \

161 (1<<
MFPDTF_DT_SCANNED_IMAGES
) | \

162 (1<<
MFPDTF_DT_DEMO_PAGES
))

	)

164 
	eMådtfImageEncodšg_e
 { 
	mMFPDTF_RASTER_BITMAP
 = 0,

165 
	mMFPDTF_RASTER_GRAYMAP
 = 1,

166 
	mMFPDTF_RASTER_MH
 = 2,

167 
	mMFPDTF_RASTER_MR
 = 3,

168 
	mMFPDTF_RASTER_MMR
 = 4,

169 
	mMFPDTF_RASTER_RGB
 = 5,

170 
	mMFPDTF_RASTER_YCC411
 = 6,

171 
	mMFPDTF_RASTER_JPEG
 = 7,

172 
	mMFPDTF_RASTER_PCL
 = 8,

173 
	mMFPDTF_RASTER_NOT
 = 9 };

176 
	uMådtfV¬ŸÁH—d”_u


178 
	sMådtfV¬ŸÁH—d”FaxD©aA¹oo_s


180 
	mmajÜV”siÚ
;

181 
	mmšÜV”siÚ
;

182 
	md©aSourû
;

183 
	md©aFÜm©
;

184 
	md©aCom´essiÚ
;

185 
	m·geResŞutiÚ
;

186 
	m·geSize
;

187 
	mpix–sP”Row
[2];

188 
	my—r
;

189 
	mmÚth
;

190 
	mday
;

191 
	mhour
;

192 
	mmšu‹
;

193 
	m£cÚd
;

194 
	mT30_CSI
[20];

195 
	mT30_SUB
[20];

196 } 
__©Œibu‹__
(Ğ
·cked
èè
	mçxA¹oo
;

198 
	sMådtfV¬ŸÁH—d”FaxD©aSŞo_s


200 
	mmajÜV”siÚ
;

201 
	mmšÜV”siÚ
;

202 
	md©aSourû
;

203 
	md©aFÜm©
;

204 
	md©aCom´essiÚ
;

205 
	m·geResŞutiÚ
;

206 
	m·geSize
;

207 
	mpix–sP”Row
[2];

208 
	my—r
;

209 
	mmÚth
;

210 
	mday
;

211 
	mhour
;

212 
	mmšu‹
;

213 
	m£cÚd
;

214 
	msuµ»ssTTI
;

215 
	mT30_CSI
[20];

216 
	mT30_SUB
[20];

217 
	mT30_PWD
[20];

218 } 
__©Œibu‹__
(Ğ
·cked
èè
	mçxSŞo
;

220 
	sMådtfV¬ŸÁH—d”FaxD©a_s


222 
	mmajÜV”siÚ
;

223 
	mmšÜV”siÚ
;

225 } 
__©Œibu‹__
(Ğ
·cked
èè
	mçx
;

227 
	sMådtfV¬ŸÁH—d”ImageD©a_s


229 
	mmajÜV”siÚ
;

230 
	mmšÜV”siÚ
;

231 
	msourûPages
[2];

232 
	mcİ›sP”Page
[2];

233 
	mzoomFaùÜ
[2];

234 
	mj³gQu®™yFaùÜ
[2];

235 } 
__©Œibu‹__
(Ğ
·cked
èè
	mimage
;

237 
	sMådtfV¬ŸÁH—d”A¼ayD©a_s


239 
	mmajÜV”siÚ
;

240 
	mmšÜV”siÚ
;

241 
	m»cÜdCouÁ
[2];

242 
	m»cÜdSize
[2];

243 } 
__©Œibu‹__
(Ğ
·cked
èè
	m¬¿y
;

244 } 
__©Œibu‹__
(Ğ
·cked
) );

246 
Mådtf_t
 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
MådtfAÎoÿ‹
(
deviûid
, 
chªÃlid
);

247 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
MådtfD—Îoÿ‹
(
Mådtf_t
 
mådtf
);

248 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
MådtfS‘ChªÃl
(
Mådtf_t
 
mådtf
, 
chªÃlid
);

249 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
MådtfLogToFe
(
Mådtf_t
 
mådtf
, * 
f’ame
);

250 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
MådtfR—dG‘SimuÏ‹ImageH—d”s
(
Mådtf_t
 
mådtf
);

251 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
MådtfR—dS‘SimuÏ‹ImageH—d”s
(
Mådtf_t
 
mådtf
, 
simuÏ‹ImageH—d”s
);

252 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
MådtfR—dS¹
(
Mådtf_t
 
mådtf
);

253 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
MådtfR—dS”viû
(
Mådtf_t
 
mådtf
);

254 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
MådtfR—dG‘La¡S”viûResuÉ
(
Mådtf_t
 
mådtf
);

255 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
MådtfR—dG‘V¬ŸÁH—d”
(
Mådtf_t
 
mådtf
, 
MådtfV¬ŸÁH—d”_u
 * 
bufãr
, 
maxËn
);

256 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
MådtfR—dG‘S¹PageRecÜd
(
Mådtf_t
 
mådtf
, 
MådtfImageS¹PageRecÜd_s
 * 
bufãr
, 
maxËn
);

257 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
MådtfR—dIÂ”Block
(
Mådtf_t
 
mådtf
, * 
bufãr
, 
couÁdown
);

263 
	eMFPDTF_DATA_TYPE


265 
	mDT_FAX
 = 1,

266 
	mDT_SCAN
 = 2

270 
	#PF_NEW_PAGE
 1

	)

271 
	#PF_END_PAGE
 2

	)

272 
	#PF_NEW_DOC
 4

	)

273 
	#PF_END_DOC
 8

	)

275 
	eMFPDTF_RECORD_ID


277 
	mID_START_PAGE
 = 0,

278 
	mID_RASTER_DATA
 = 1,

279 
	mID_END_PAGE
 = 2

286 
ušt32_t
 
	mBlockL’gth
;

287 
ušt16_t
 
	mH—d”L’gth
;

288 
ušt8_t
 
	mD©aTy³
;

289 
ušt8_t
 
	mPageFÏg
;

290 } 
	t__©Œibu‹__
((
	t·cked
)è
	tMFPDTF_FIXED_HEADER
;

294 
ušt8_t
 
	mID
;

295 
ušt8_t
 
	mCode
;

296 
ušt16_t
 
	mPageNumb”
;

297 
ušt16_t
 
	mBÏckPix–sP”Row
;

298 
ušt16_t
 
	mBÏckB™sP”Pix–
;

299 
ušt32_t
 
	mBÏckRows
;

300 
ušt32_t
 
	mBÏckHÜzDPI
;

301 
ušt32_t
 
	mBÏckV”tDPI
;

302 
ušt16_t
 
	mCMYPix–sP”Row
;

303 
ušt16_t
 
	mCMYB™sP”Pix–
;

304 
ušt32_t
 
	mCMYRows
;

305 
ušt32_t
 
	mCMYHÜzDPI
;

306 
ušt32_t
 
	mCMYV”tDPI
;

307 } 
	t__©Œibu‹__
((
	t·cked
)è
	tMFPDTF_START_PAGE
;

311 
ušt8_t
 
	mID
;

312 
ušt8_t
 
	mdummy
;

313 
ušt16_t
 
	mSize
;

314 } 
	t__©Œibu‹__
((
	t·cked
)è
	tMFPDTF_RASTER
;

318 
ušt8_t
 
	mID
;

319 
	mdummy
[3];

320 
ušt32_t
 
	mBÏckRows
;

321 
ušt32_t
 
	mCMYRows
;

322 } 
	t__©Œibu‹__
((
	t·cked
)è
	tMFPDTF_END_PAGE
;

325 #ià!
defšed
(
htŞe16
)

326 #ià
defšed
(
WORDS_BIGENDIAN
)

327 
	#htŞe16
(
A
è((((
ušt16_t
)(Aè& 0xff00è>> 8è| (((ušt16_t)(Aè& 0x00ffè<< 8)è

	)

328 
	#Ë16toh
 
htŞe16


	)

329 
	#htŞe32
(
A
è((((
ušt32_t
)(A) & (uint32_t)0x000000ff) << 24) | (((uint32_t)(A) & (uint32_t)0x0000ff00) << 8) | \

330 (((
ušt32_t
)(
A
è& (ušt32_t)0x00ff0000è>> 8è| (((ušt32_t)(Aè& (ušt32_t)0xff000000è>> 24))

	)

331 
	#Ë32toh
 
htŞe32


	)

333 
	#htŞe16
(
A
è(A)

	)

334 
	#Ë16toh
(
A
è(A)

	)

335 
	#Ë32toh
(
A
è(A)

	)

336 
	#htŞe32
(
A
è(A)

	)

340 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
»ad_mådtf_block
(
deviû
, 
chªÃl
, *
buf
, 
bufSize
, 
timeout
);

	@scan/sane/orblite.c

13 #ifdeà
__ılu¥lus


17 
	~"§Ã.h
"

18 
	#DEBUG_NOT_STATIC


	)

19 #undeà
NDEBUG


20 
	~"Übl™ei.h
"

21 
	~"Übl™e.h
"

22 
	~<m©h.h
>

23 
	~"uts.h
"

24 
	~"io.h
"

26 #ifdeà
__ılu¥lus


29 
SANE_Rªge
 
SANE_¿ngeLeá
;

30 
SANE_Rªge
 
	gSANE_¿ngeRight
;

31 
SANE_Rªge
 
	gSANE_¿ngeTİ
;

32 
SANE_Rªge
 
	gSANE_¿ngeBÙtom
;

34 
	#MAX_MODES
 7

	)

35 
SANE_SŒšg
 
	gSANE_modes
[
MAX_MODES
+1];

37 
	#MAX_SOURCES
 15

	)

38 
SANE_SŒšg
 
	gSANE_sourûs
[
MAX_SOURCES
+1];

40 
	#MAX_RESOLUTIONS
 31

	)

41 
SANE_WÜd
 
	gSANE_»sŞutiÚs
[
MAX_RESOLUTIONS
+1];

43 
	#MAX_PAPER_SIZES
 63

	)

44 
SANE_SŒšg
 
	gSANE_·³r_sizes
[
MAX_PAPER_SIZES
+1];

46 
t_SANE
 *
	gg_hªdË
 = 
NULL
;

48 
SANE_O±iÚ_DesütÜ
 
	gDeçuÉOrbO±iÚs
[] = {

55 "", 
SANE_TITLE_NUM_OPTIONS
, 
SANE_DESC_NUM_OPTIONS
,

56 
SANE_TYPE_INT
, 
SANE_UNIT_NONE
, (
SANE_WÜd
),

57 
SANE_CAP_SOFT_DETECT
,

58 
SANE_CONSTRAINT_NONE
, 
NULL


63 
SANE_NAME_SCAN_TL_X
, 
SANE_TITLE_SCAN_TL_X
, 
SANE_DESC_SCAN_TL_X
,

64 
SANE_TYPE_FIXED
, 
SANE_UNIT_MM
, (
SANE_Fixed
),

65 
SANE_CAP_SOFT_SELECT
 | 
SANE_CAP_SOFT_DETECT
,

66 
SANE_CONSTRAINT_RANGE
, (
SANE_Ch¬
**)&
SANE_¿ngeLeá


70 
SANE_NAME_SCAN_TL_Y
, 
SANE_TITLE_SCAN_TL_Y
, 
SANE_DESC_SCAN_TL_Y
,

71 
SANE_TYPE_FIXED
, 
SANE_UNIT_MM
, (
SANE_Fixed
),

72 
SANE_CAP_SOFT_SELECT
 | 
SANE_CAP_SOFT_DETECT
,

73 
SANE_CONSTRAINT_RANGE
, (
SANE_Ch¬
**)&
SANE_¿ngeTİ


77 
SANE_NAME_SCAN_BR_X
, 
SANE_TITLE_SCAN_BR_X
, 
SANE_DESC_SCAN_BR_X
,

78 
SANE_TYPE_FIXED
, 
SANE_UNIT_MM
, (
SANE_Fixed
),

79 
SANE_CAP_SOFT_SELECT
 | 
SANE_CAP_SOFT_DETECT
,

80 
SANE_CONSTRAINT_RANGE
, (
SANE_Ch¬
**)&
SANE_¿ngeRight


84 
SANE_NAME_SCAN_BR_Y
, 
SANE_TITLE_SCAN_BR_Y
, 
SANE_DESC_SCAN_BR_Y
,

85 
SANE_TYPE_FIXED
, 
SANE_UNIT_MM
, (
SANE_Fixed
),

86 
SANE_CAP_SOFT_SELECT
 | 
SANE_CAP_SOFT_DETECT
,

87 
SANE_CONSTRAINT_RANGE
, (
SANE_Ch¬
**)&
SANE_¿ngeBÙtom


92 
SANE_NAME_SCAN_RESOLUTION
, 
SANE_TITLE_SCAN_RESOLUTION
, 
SANE_DESC_SCAN_RESOLUTION
,

93 
SANE_TYPE_INT
, 
SANE_UNIT_DPI
, (
SANE_WÜd
),

94 
SANE_CAP_SOFT_SELECT
 | 
SANE_CAP_SOFT_DETECT
,

95 
SANE_CONSTRAINT_WORD_LIST
, (
SANE_Ch¬
**)
SANE_»sŞutiÚs


100 
SANE_NAME_SCAN_MODE
, 
SANE_TITLE_SCAN_MODE
, 
SANE_DESC_SCAN_MODE
,

101 
SANE_TYPE_STRING
, 
SANE_UNIT_NONE
, 256,

102 
SANE_CAP_SOFT_SELECT
 | 
SANE_CAP_SOFT_DETECT
,

103 
SANE_CONSTRAINT_STRING_LIST
, (
SANE_Ch¬
**)
SANE_modes


108 
SANE_NAME_SCAN_SOURCE
, 
SANE_TITLE_SCAN_SOURCE
, 
SANE_DESC_SCAN_SOURCE
,

109 
SANE_TYPE_STRING
, 
SANE_UNIT_NONE
, 256,

110 
SANE_CAP_SOFT_SELECT
 | 
SANE_CAP_SOFT_DETECT
,

111 
SANE_CONSTRAINT_STRING_LIST
, (
SANE_Ch¬
**)
SANE_sourûs


116 
SANE_NAME_PAPER_SIZE
, 
SANE_TITLE_PAPER_SIZE
, 
SANE_DESC_PAPER_SIZE
,

117 
SANE_TYPE_STRING
, 
SANE_UNIT_NONE
, 256,

118 
SANE_CAP_SOFT_SELECT
 | 
SANE_CAP_SOFT_DETECT
,

119 
SANE_CONSTRAINT_STRING_LIST
, (
SANE_Ch¬
**)
SANE_·³r_sizes


124 
SANE_NAME_PAPER_SIZE
, 
SANE_TITLE_PAPER_SIZE
, 
SANE_DESC_PAPER_SIZE
,

125 
SANE_TYPE_INT
, 
SANE_UNIT_DPI
, (
SANE_WÜd
),

126 
SANE_CAP_SOFT_SELECT
 | 
SANE_CAP_SOFT_DETECT
,

127 
SANE_CONSTRAINT_WORD_LIST
, (
SANE_Ch¬
**)
SANE_»sŞutiÚs


129 #ifdeà
NOTDEF


133 
SANE_TYPE_INT
, 
SANE_UNIT_NONE
, (
SANE_WÜd
),

135 
SANE_CONSTRAINT_NONE
, 0

141 
	$bb_lßd
(
SANE_THªdË
 
ps
, cÚ¡ * 
so
)

143 
¡©
 = 1;

145 ià((
ps
->
hpmud_hªdË
 = 
	`lßd_lib¿ry
("libhpmud.so.0")è=ğ
NULL
)

147 ià((
ps
->
hpmud_hªdË
 = 
	`lßd_lib¿ry
("libhpmud.so.0")è=ğ
NULL
)

148 
bugout
;

151 ià((
ps
->
bb_hªdË
 = 
	`lßd_¶ugš_lib¿ry
(
UTILS_SCAN_PLUGIN_LIBRARY
, 
so
)è=ğ
NULL
)

153 
	`S’dSÿnEv’t
(
ps
->
uri
, 
EVENT_PLUGIN_FAIL
);

154 
bugout
;

156 ià((
ps
->
bb_Übl™e_š™
 = 
	`g‘_lib¿ry_symbŞ
Õs->
bb_hªdË
, "bb_Übl™e_š™")è=ğ
NULL
)

157 
bugout
;

159 ià((
ps
->
bb_Übl™e_g‘_deviûs
 = 
	`g‘_lib¿ry_symbŞ
Õs->
bb_hªdË
, "bb_Übl™e_g‘_deviûs")è=ğ
NULL
)

160 
bugout
;

162 ià((
ps
->
bb_Übl™e_ex™
 = 
	`g‘_lib¿ry_symbŞ
Õs->
bb_hªdË
, "bb_Übl™e_ex™")è=ğ
NULL
)

163 
bugout
;

166 ià((
ps
->
bb_Übl™e_İ’
 = 
	`g‘_lib¿ry_symbŞ
Õs->
bb_hªdË
, "bb_Übl™e_İ’")è=ğ
NULL
)

167 
bugout
;

168 ià((
ps
->
bb_Übl™e_şo£
 = 
	`g‘_lib¿ry_symbŞ
Õs->
bb_hªdË
, "bb_Übl™e_şo£")è=ğ
NULL
)

169 
bugout
;

170 ià((
ps
->
bb_Übl™e_g‘_İtiÚ_desütÜ
 = 
	`g‘_lib¿ry_symbŞ
Õs->
bb_hªdË
, "bb_Übl™e_g‘_İtiÚ_desütÜ")è=ğ
NULL
)

171 
bugout
;

172 ià((
ps
->
bb_Übl™e_cÚŒŞ_İtiÚ
 = 
	`g‘_lib¿ry_symbŞ
Õs->
bb_hªdË
, "bb_Übl™e_cÚŒŞ_İtiÚ")è=ğ
NULL
)

173 
bugout
;

175 ià((
ps
->
bb_Übl™e_¡¬t
 = 
	`g‘_lib¿ry_symbŞ
Õs->
bb_hªdË
, "bb_Übl™e_¡¬t")è=ğ
NULL
)

176 
bugout
;

177 ià((
ps
->
bb_Übl™e_g‘_·¿m‘”s
 = 
	`g‘_lib¿ry_symbŞ
Õs->
bb_hªdË
, "bb_Übl™e_g‘_·¿m‘”s")è=ğ
NULL
)

178 
bugout
;

179 ià((
ps
->
bb_Übl™e_»ad
 = 
	`g‘_lib¿ry_symbŞ
Õs->
bb_hªdË
, "bb_Übl™e_»ad")è=ğ
NULL
)

180 
bugout
;

182 ià((
ps
->
bb_Übl™e_ÿnûl
 = 
	`g‘_lib¿ry_symbŞ
Õs->
bb_hªdË
, "bb_Übl™e_ÿnûl")è=ğ
NULL
)

183 
bugout
;

185 ià((
ps
->
bb_Übl™e_£t_io_mode
 = 
	`g‘_lib¿ry_symbŞ
Õs->
bb_hªdË
, "bb_Übl™e_£t_io_mode")è=ğ
NULL
)

186 
bugout
;

188 ià((
ps
->
bb_Übl™e_g‘_£Ëù_fd
 = 
	`g‘_lib¿ry_symbŞ
Õs->
bb_hªdË
, "bb_Übl™e_g‘_£Ëù_fd")è=ğ
NULL
)

189 
bugout
;

190 
¡©
 = 0;

191 
bugout
:

192  
¡©
;

194 
	}
}

196 
	$bb_uÆßd
(
SANE_THªdË
 
ps
)

198 
	`_DBG
("Calling orblite bb_unload: \n");

199 ià(
ps
->
bb_hªdË
)

201 
	`dlşo£
(
ps
->
bb_hªdË
);

202 
ps
->
bb_hªdË
 = 
NULL
;

204 ià(
ps
->
hpmud_hªdË
)

206 
	`dlşo£
(
ps
->
hpmud_hªdË
);

207 
ps
->
hpmud_hªdË
 = 
NULL
;

215 
	}
}

217 
SANE_Stus


218 
	$Übl™e_š™
 (
SANE_IÁ
 * 
v”siÚ_code
, 
SANE_Auth_C®lback
 
authÜize
)

244  
SANE_STATUS_GOOD
;

245 
	}
}

249 
SANE_Stus


250 
	$Übl™e_g‘_deviûs
 (cÚ¡ 
SANE_Deviû
 *** 
deviû_li¡
, 
SANE_BoŞ
 
loÿl_Úly
)

253  
SANE_STATUS_GOOD
;

254 
	}
}

259 
	$Übl™e_ex™
 ()

261  
g_hªdË
->
	`bb_Übl™e_ex™
();

262 
	}
}

268 
SANE_Stus


269 
	$Übl™e_İ’
 (
SANE_SŒšg_CÚ¡
 
deviûÇme
, 
SANE_HªdË
 * 
hªdË
)

271 
SANE_Stus
 
¡©
;

272 
SANE_IÁ
 * 
v”siÚ_code
;

273 
SANE_Auth_C®lback
 
authÜize
;

274 cÚ¡ 
SANE_Deviû
 *** 
deviû_li¡
;

275 
SANE_BoŞ
 
loÿl_Úly
;

279 
g_hªdË
 = (
SANE_THªdË
è
	`ÿÎoc
Ğ1, (
t_SANE
) );

280 ià(!
g_hªdË
)

281  
SANE_STATUS_NO_MEM
;

284 
g_hªdË
->
O±iÚs
 = (
SANE_O±iÚ_DesütÜ
 *è
	`ÿÎoc
Ğ
İtLa¡
, (SANE_Option_Descriptor) );

285 ià(!
g_hªdË
->
O±iÚs
)

286  
SANE_STATUS_NO_MEM
;

288 
	`memıy
Ğ
g_hªdË
->
O±iÚs
, 
DeçuÉOrbO±iÚs
, 
İtLa¡
*(
SANE_O±iÚ_DesütÜ
) );

289 
g_hªdË
->
g
 = (*)
	`m®loc
(
	`¡¾’
("ORBLITE") + 1);

290 
	`¡rıy
(
g_hªdË
->
g
, "ORBLITE");

293 ià(
	`bb_lßd
(
g_hªdË
, 
SCAN_PLUGIN_ORBLITE
))

295 
	`´štf
("Übl™e_š™ faed: % %d\n", 
__FILE__
, 
__LINE__
);

296  
SANE_STATUS_IO_ERROR
;

299 
¡©
 = 
g_hªdË
->
	`bb_Übl™e_š™
(
v”siÚ_code
, 
authÜize
);

300 ià(
¡©
 !ğ
SANE_STATUS_GOOD
)

301  
¡©
;

303 
¡©
 = 
g_hªdË
->
	`bb_Übl™e_g‘_deviûs
(
deviû_li¡
, 
loÿl_Úly
);

304 ià(
¡©
 !ğ
SANE_STATUS_GOOD
)

305  
¡©
;

307 
¡©
 = 
g_hªdË
->
	`bb_Übl™e_İ’
(
deviûÇme
, &g_handle);

308 ià(
¡©
 =ğ
SANE_STATUS_GOOD
)

309 *
hªdË
 = 
g_hªdË
;

311  
¡©
;

312 
	}
}

316 
	$Übl™e_şo£
 (
SANE_HªdË
 
hªdË
)

318  
g_hªdË
->
	`bb_Übl™e_şo£
(g_handle);

319 
	}
}

326 cÚ¡ 
SANE_O±iÚ_DesütÜ
 *

327 
	$Übl™e_g‘_İtiÚ_desütÜ
 (
SANE_HªdË
 
hªdË
, 
SANE_IÁ
 
İtiÚ
)

329 ià(
İtiÚ
 >ğ
İtCouÁ
 && o±iÚ < 
İtLa¡
)

331  &
g_hªdË
->
O±iÚs
[
İtiÚ
];

334 
	}
}

337 
SANE_Stus


338 
	$Übl™e_cÚŒŞ_İtiÚ
 (
SANE_HªdË
 
hªdË
,

339 
SANE_IÁ
 
İtiÚ
,

340 
SANE_AùiÚ
 
aùiÚ
,

341 *
v®ue
,

342 
SANE_IÁ
 * 
šfo
)

344  
g_hªdË
->
	`bb_Übl™e_cÚŒŞ_İtiÚ
(
hªdË
,
İtiÚ
,
aùiÚ
, 
v®ue
, 
šfo
);

346 
	}
}

350 
SANE_Stus


351 
	$Übl™e_¡¬t
 (
SANE_HªdË
 
hªdË
)

353  
g_hªdË
->
	`bb_Übl™e_¡¬t
(g_handle);

354 
	}
}

357 
SANE_Stus


358 
	$Übl™e_g‘_·¿m‘”s
 (
SANE_HªdË
 
hªdË
, 
SANE_P¬am‘”s
 * 
·¿ms
)

360  
g_hªdË
->
	`bb_Übl™e_g‘_·¿m‘”s
(g_hªdË, 
·¿ms
);

361 
	}
}

365 
SANE_Stus


366 
	$Übl™e_»ad
 (
SANE_HªdË
 
hªdË
, 
SANE_By‹
 * 
d©a
, 
SANE_IÁ
 
max_Ëngth
, SANE_IÁ * 
Ëngth
)

368  
g_hªdË
->
	`bb_Übl™e_»ad
 (g_hªdË, 
d©a
, 
max_Ëngth
, 
Ëngth
);

369 
	}
}

373 
	$Übl™e_ÿnûl
 (
SANE_HªdË
 
hªdË
)

375  
g_hªdË
->
	`bb_Übl™e_ÿnûl
(g_handle);

376 
	}
}

381 
SANE_Stus


382 
	$Übl™e_£t_io_mode
 (
SANE_HªdË
 
h
, 
SANE_BoŞ
 
nÚ_blockšg
)

384  
g_hªdË
->
	`bb_Übl™e_£t_io_mode
(g_hªdË, 
nÚ_blockšg
);

385 
	}
}

388 
SANE_Stus


389 
	$Übl™e_g‘_£Ëù_fd
 (
SANE_HªdË
 
h
, 
SANE_IÁ
 * 
fd
)

391  
g_hªdË
->
	`bb_Übl™e_g‘_£Ëù_fd
(g_hªdË, 
fd
);

392 
	}
}

	@scan/sane/orblite.h

28 #iâdeà
_SANE_ORBLITE_H


29 
	#_SANE_ORBLITE_H


	)

31 
	~"§Ã.h
"

33 
SANE_Stus
 
Übl™e_š™
 (
SANE_IÁ
 * 
v”siÚ_code
, 
SANE_Auth_C®lback
 
authÜize
);

34 
SANE_Stus
 
Übl™e_g‘_deviûs
 (cÚ¡ 
SANE_Deviû
 *** 
deviû_li¡
, 
SANE_BoŞ
 
loÿl_Úly
);

35 
Übl™e_ex™
 ();

36 
SANE_Stus
 
Übl™e_İ’
 (
SANE_SŒšg_CÚ¡
 
deviûÇme
, 
SANE_HªdË
 * 
hªdË
);

37 
Übl™e_şo£
 (
SANE_HªdË
 
hªdË
);

38 cÚ¡ 
SANE_O±iÚ_DesütÜ
 * 
Übl™e_g‘_İtiÚ_desütÜ
 (
SANE_HªdË
 
hªdË
, 
SANE_IÁ
 
İtiÚ
 );

39 
SANE_Stus
 
Übl™e_cÚŒŞ_İtiÚ
 (
SANE_HªdË
 
hªdË
, 
SANE_IÁ
 
İtiÚ
, 
SANE_AùiÚ
 
aùiÚ
, *
v®ue
, SANE_IÁ * 
šfo
);

40 
SANE_Stus
 
Übl™e_g‘_·¿m‘”s
 (
SANE_HªdË
 
hªdË
, 
SANE_P¬am‘”s
 * 
·¿ms
);

41 
SANE_Stus
 
Übl™e_¡¬t
 (
SANE_HªdË
 
hªdË
);

42 
SANE_Stus
 
Übl™e_»ad
 (
SANE_HªdË
 
hªdË
, 
SANE_By‹
 * 
d©a
, 
SANE_IÁ
 
max_Ëngth
, SANE_IÁ * 
Ëngth
);

43 
Übl™e_ÿnûl
 (
SANE_HªdË
 
hªdË
);

	@scan/sane/orblitei.h

1 #iâdeà
_SANE_ORBLITE_INTERFACE_H


2 
	#_SANE_ORBLITE_INTERFACE_H


	)

4 
	~<¡dboŞ.h
>

5 
	~"§Ã.h
"

6 
	~"§Ãİts.h
"

7 
	~"../../io/hpmud/hpmud.h
"

8 
	~"../..//hp.h
"

9 
	~"Orbl™eSÿn/MacCommÚ.h
"

11 
	#max
(
x
,
y
è((x)>(y))?x:
	)
y

12 
	#mš
(
x
,
y
è((x)>(y))?y:
	)
x

14 
	#COLOR_STR
 
	`SANE_I18N
("cŞÜ")

	)

15 
	#GRAY_STR
 
	`SANE_I18N
("g¿y")

	)

16 
	#LINEART_STR
 
	`SANE_I18N
("lš—¹")

	)

18 
	#FLATBED_STR
 
	`SANE_I18N
("FÏtbed")

	)

19 
	#ADF_SINGLE_STR
 
	`SANE_I18N
("ADF-SšgËPage")

	)

20 
	#ADF_STR
 
	`SANE_I18N
("ADF")

	)

21 
	#ADF_MULTI_STR
 
	`SANE_I18N
("ADF-MuÉiPage")

	)

22 
	#ADF_MULTI_SIMPLEX_STR
 
	`SANE_I18N
("ADF-MuÉiPage-Sim¶ex")

	)

23 
	#ADF_MULTI_DUPLEX_STR
 
	`SANE_I18N
("ADF-MuÉiPage-Du¶ex")

	)

24 
	#NEGATIVE_STR
 
	`SANE_I18N
("Neg©ive")

	)

25 
	#SLIDE_STR
 
	`SANE_I18N
("Slide")

	)

27 
	#CUSTOM_STR
 
	`SANE_I18N
("Cu¡om")

	)

28 
	#DETECT_STR
 
	`SANE_I18N
("Auto-D‘eù")

	)

29 
	#LETTER_STR
 
	`SANE_I18N
("L‘‹r")

	)

30 
	#LEGAL_STR
 
	`SANE_I18N
("Leg®")

	)

31 
	#A4_STR
 
	`SANE_I18N
("A4")

	)

32 
	#A5_STR
 
	`SANE_I18N
("A5")

	)

33 
	#A6_STR
 
	`SANE_I18N
("A6")

	)

34 
	#A7_STR
 
	`SANE_I18N
("A7")

	)

35 
	#B5_STR
 
	`SANE_I18N
("B5")

	)

36 
	#B6_STR
 
	`SANE_I18N
("B6")

	)

37 
	#B7_STR
 
	`SANE_I18N
("B7")

	)

38 
	#C5_STR
 
	`SANE_I18N
("C5")

	)

39 
	#C6_STR
 
	`SANE_I18N
("C6")

	)

40 
	#C7_STR
 
	`SANE_I18N
("C7")

	)

41 
	#JIS_B5_STR
 
	`SANE_I18N
("JIS-B5")

	)

42 
	#JIS_B6_STR
 
	`SANE_I18N
("JIS-B6")

	)

43 
	#JIS_B7_STR
 
	`SANE_I18N
("JIS-B7")

	)

45 
	#SANE_NAME_PAPER_SIZE
 
	`SANE_I18N
("·³r-size")

	)

46 
	#SANE_TITLE_PAPER_SIZE
 
	`SANE_I18N
("P­” size")

	)

47 
	#SANE_DESC_PAPER_SIZE
 \

48 
	`SANE_I18N
("S‘ sÿÀ¬—Ø£Ëùed…­” size")

	)

50 
SANE_Rªge
 
	gSANE_¿ngeLeá
;

51 
SANE_Rªge
 
	gSANE_¿ngeRight
;

52 
SANE_Rªge
 
	gSANE_¿ngeTİ
;

53 
SANE_Rªge
 
	gSANE_¿ngeBÙtom
;

55 
	#MAX_MODES
 7

	)

56 
SANE_SŒšg
 
	gSANE_modes
[
MAX_MODES
+1];

58 
	#MAX_SOURCES
 15

	)

59 
SANE_SŒšg
 
	gSANE_sourûs
[
MAX_SOURCES
+1];

61 
	#MAX_RESOLUTIONS
 31

	)

62 
SANE_WÜd
 
	gSANE_»sŞutiÚs
[
MAX_RESOLUTIONS
+1];

64 
	#MAX_PAPER_SIZES
 63

	)

65 
SANE_SŒšg
 
	gSANE_·³r_sizes
[
MAX_PAPER_SIZES
+1];

71 
	mİtCouÁ
 = 0,

72 
	mİtTLX
, 
	mİtTLY
, 
	mİtBRX
, 
	mİtBRY
,

73 
	mİtResŞutiÚ
,

74 
	mİtMode
,

75 
	mİtSourû
,

76 
	mİtP­”Size
,

77 
	mİtMuÉick
,

78 
	mİtLa¡
,

82 
	mİtGammaTabËRed
,

83 
	mİtGammaTabËG»’
,

84 
	mİtGammaTabËBlue
,

86 
	tEO±iÚIndex
;

88 
SANE_O±iÚ_DesütÜ
 
DeçuÉOrbO±iÚs
[];

90 
	st_SANE
 {

91 *
	mg
;

92 
SANE_O±iÚ_DesütÜ
* 
	mO±iÚs
;

94 
SCANNER_PARAMETERS
 
	mm_sÿÂ”P¬am‘”s
;

95 
BUFFER_INFO
 
	mm_bufãrInfo
;

96 
SCAN_SOURCE
 
	mm_sÿnSourû
;

97 
DWORD
 
	mdwRemaššgSÿnLšes
;

98 
DWORD
 
	mdwBy‹sR—d
;

99 
DWORD
 
	mdwBy‹sWr™‹n
;

100 
DWORD
 
	mdwBufãrSize
;

101 
BYTE
* 
	mpBufãr
;

102 
BOOLEAN
 
	mbU£XPA
;

103 
BOOLEAN
 
	mbU£ADF
;

104 
boŞ
 
	mbD‘eùPageSize
;

105 
boŞ
 
	mbEndOfPage
;

106 
boŞ
 
	mbCªûÎed
;

107 
boŞ
 
	mšv”t
;

108 
SANE_Fixed
 
	mËá
;

109 
SANE_Fixed
 
	mright
;

110 
SANE_Fixed
 
	mtİ
;

111 
SANE_Fixed
 
	mbÙtom
;

112 
SANE_SŒšg
 
	mmode
;

113 
SANE_SŒšg
 
	msourû
;

114 
SANE_SŒšg
 
	m·³r_size
;

116 
	muri
[
HPMUD_LINE_SIZE
];

117 
HPMUD_DEVICE
 
	mdd
;

118 
HPMUD_CHANNEL
 
	mcd
;

119 
	mmod–
[
HPMUD_LINE_SIZE
];

121 *
	mhpmud_hªdË
;

122 *
	mm©h_hªdË
;

123 *
	mbb_hªdË
;

125 
SANE_Stus
 (*
bb_Übl™e_š™
è(
SANE_IÁ
 * 
	mv”siÚ_code
, 
SANE_Auth_C®lback
 
	mauthÜize
);

126 
SANE_Stus
 (*
bb_Übl™e_g‘_deviûs
è(cÚ¡ 
SANE_Deviû
 *** 
	mdeviû_li¡
, 
SANE_BoŞ
 
	mloÿl_Úly
);

127 (*
	mbb_Übl™e_ex™
)();

128 
SANE_Stus
 (*
bb_Übl™e_İ’
è(
SANE_SŒšg_CÚ¡
 
	mdeviûÇme
, 
SANE_HªdË
 * 
	mhªdË
);

129 (*
	mbb_Übl™e_şo£
è(
SANE_HªdË
 
	mhªdË
);

130 cÚ¡ 
	mSANE_O±iÚ_DesütÜ
 * (*
	mbb_Übl™e_g‘_İtiÚ_desütÜ
è(
SANE_HªdË
 
	mhªdË
, 
SANE_IÁ
 
	mİtiÚ
);

131 
SANE_Stus
 (*
bb_Übl™e_cÚŒŞ_İtiÚ
è(
SANE_HªdË
 
	mhªdË
, 
SANE_IÁ
 
	mİtiÚ
, 
SANE_AùiÚ
 
	maùiÚ
, *
	mv®ue
, SANE_IÁ * 
	mšfo
);

132 
SANE_Stus
 (*
bb_Übl™e_¡¬t
è(
SANE_HªdË
 
	mhªdË
);

133 
SANE_Stus
 (*
bb_Übl™e_g‘_·¿m‘”s
è(
SANE_HªdË
 
	mhªdË
, 
SANE_P¬am‘”s
 * 
	m·¿ms
);

134 
SANE_Stus
 (*
bb_Übl™e_»ad
è(
SANE_HªdË
 
	mhªdË
, 
SANE_By‹
 * 
	md©a
, 
SANE_IÁ
 
	mmax_Ëngth
, SANE_IÁ * 
	mËngth
);

135 (*
	mbb_Übl™e_ÿnûl
è(
SANE_HªdË
 
	mhªdË
);

136 
SANE_Stus
 (*
bb_Übl™e_£t_io_mode
è(
SANE_HªdË
 
	mh
, 
SANE_BoŞ
 
	mnÚ_blockšg
);

137 
SANE_Stus
 (*
bb_Übl™e_g‘_£Ëù_fd
è(
SANE_HªdË
 
	mh
, 
SANE_IÁ
 * 
	mfd
);

141 
t_SANE
 * 
	tSANE_THªdË
;

	@scan/sane/pml.c

28 
	~<¡ršg.h
>

29 
	~<¡dlib.h
>

30 
	~<uni¡d.h
>

31 
	~"hpmud.h
"

32 
	~"io.h
"

33 
	~"commÚ.h
"

34 
	~"pml.h
"

36 
	#DEBUG_DECLARE_ONLY


	)

37 
	~"§Ãi_debug.h
"

39 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
	$PmlS‘ID
Ğ
PmlObjeù_t
 
obj
, * 
oid
 )

41 
Ën
 = 0;

45 ifĞ!
Ën
 )

47 
Ën
 = 
	`¡¾’
Ğ
oid
 );

48 ifĞ!
Ën
 )

50 
Ën
++;

53 ifĞ
Ën
 > 
PML_MAX_OID_LEN
 )

55  
ERROR
;

60 
	`memıy
Ğ
obj
->
oid
, oid, 
Ën
 );

61 
obj
->
oid
[
Ën
] = 0;

63 
obj
->
numb”OfV®idV®ues
 = 0;

68  
OK
;

69 
	}
}

71 
PmlV®ue_t
 
	$PmlG‘La¡V®ue
Ğ
PmlObjeù_t
 
obj
 )

73 ifĞ
obj
->
numb”OfV®idV®ues
 <= 0 )

77  &
obj
->
v®ue
[obj->
šdexOfLa¡V®ue
];

78 
	}
}

80 
PmlV®ue_t
 
	$PmlP»·»NextV®ue
Ğ
PmlObjeù_t
 
obj
 )

82 
obj
->
šdexOfLa¡V®ue
 = ( obj->indexOfLastValue + 1 ) %

83 
PML_MAX_OID_VALUES
;

84 ifĞ
obj
->
numb”OfV®idV®ues
 < 
PML_MAX_OID_VALUES
 )

86 
obj
->
numb”OfV®idV®ues
++;

88  &
obj
->
v®ue
[obj->
šdexOfLa¡V®ue
];

89 
	}
}

91 
	$PmlS‘P»fixV®ue
Ğ
PmlObjeù_t
 
obj
,

92 
ty³
,

93 * 
´efix
,

94 
ËnP»fix
,

95 * 
v®ue
,

96 
ËnV®ue
 )

98 
PmlV®ue_t
 
v
 = 
	`PmlP»·»NextV®ue
Ğ
obj
 );

99 
r
 = 
ERROR
;

108 ifĞ
ËnP»fix
 < 0 ||

109 
ËnV®ue
<0 ||

110 Ğ
ËnP»fix
 + 
ËnV®ue
 )>
PML_MAX_VALUE_LEN
 )

117 
abÜt
;

120 
v
->
ty³
 =ype;

121 
v
->
Ën
 = 
ËnP»fix
 + 
ËnV®ue
;

122 ifĞ
ËnP»fix
 )

124 
	`memıy
Ğ
v
->
v®ue
, 
´efix
, 
ËnP»fix
 );

126 ifĞ
ËnV®ue
 )

128 
	`memıy
Ğ
v
->
v®ue
 + 
ËnP»fix
, v®ue, 
ËnV®ue
 );

130 
v
->
v®ue
[
ËnP»fix
 + 
ËnV®ue
] = 0;

132 
r
 = 
OK
;

133 
abÜt
:

137  
r
;

138 
	}
}

140 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
	$PmlS‘V®ue
Ğ
PmlObjeù_t
 
obj
, 
ty³
, * 
v®ue
, 
Ën
 )

142  
	`PmlS‘P»fixV®ue
Ğ
obj
, 
ty³
, 0, 0, 
v®ue
, 
Ën
 );

143 
	}
}

145 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
	$PmlS‘IÁeg”V®ue
Ğ
PmlObjeù_t
 
obj
, 
ty³
, 
v®ue
 )

147 
bufãr
[( )];

148 
Ën
 = Ğ), 
i
 =†en - 1;

152 
bufãr
[
i
] = 
v®ue
 & 0xFF;

153 
v®ue
 >>= 8;

154 ifĞ!
i
 )

158 
i
--;

160  ; !
bufãr
[
i
] && i < ( 
Ën
 ); i++ )

163  
	`PmlS‘P»fixV®ue
Ğ
obj
, 
ty³
, 
bufãr
 + 
i
, 
Ën
 - i, 0, 0 );

164 
	}
}

166 
	$PmlG‘P»fixV®ue
Ğ
PmlObjeù_t
 
obj
,

167 * 
pTy³
,

168 * 
´efix
,

169 
ËnP»fix
,

170 * 
bufãr
,

171 
maxËn
 )

173 
Ën
;

174 
PmlV®ue_t
 
v
 = 
	`PmlG‘La¡V®ue
Ğ
obj
 );

176 ifĞ!
v
 )

178  
ERROR
;

180 ifĞ
pTy³
 )

182 *
pTy³
 = 
v
->
ty³
;

184 ifĞ!
´efix
 && !
bufãr
 )

186  
OK
;

189 ifĞ
ËnP»fix
 < 0 || 
maxËn
 < 0 )

191  
ERROR
;

194 ifĞ
v
->
Ën
 > 
ËnP»fix
 + 
maxËn
 )

196  
ERROR
;

198 ifĞ
v
->
Ën
 < 
ËnP»fix
 )

200  
ERROR
;

203 ifĞ
ËnP»fix
 )

205 
	`memıy
Ğ
´efix
, 
v
->
v®ue
, 
ËnP»fix
 );

207 
Ën
 = 
v
->ËÀ- 
ËnP»fix
;

208 ifĞ
Ën
 )

210 
	`memıy
Ğ
bufãr
, 
v
->
v®ue
 + 
ËnP»fix
, 
Ën
 );

212 ifĞ
Ën
 < 
maxËn
 )

214 
bufãr
[
Ën
] = 0;

217  
Ën
;

218 
	}
}

220 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
	$PmlG‘V®ue
(
PmlObjeù_t
 
obj
, *
pTy³
, *
bufãr
, 
maxËn
)

222  
	`PmlG‘P»fixV®ue
Ğ
obj
, 
pTy³
, 0, 0, 
bufãr
, 
maxËn
 );

223 
	}
}

225 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
	$PmlG‘SŒšgV®ue
Ğ
PmlObjeù_t
 
obj
,

226 * 
pSymbŞS‘
,

227 * 
bufãr
,

228 
maxËn
 )

230 
ty³
, 
Ën
;

231 
´efix
[2];

233 ifĞ
	`PmlG‘P»fixV®ue
Ğ
obj
, &
ty³
, 0, 0, 0, 0 ) =ğ
ERROR
 )

235  
ERROR
;

238 
Ën
 = 
	`PmlG‘P»fixV®ue
Ğ
obj
, &
ty³
, (*)
´efix
, 2, 
bufãr
, 
maxËn
 );

239 ifĞ
Ën
 =ğ
ERROR
 )

241  
ERROR
;

243 ifĞ
pSymbŞS‘
 )

245 *
pSymbŞS‘
 = ( ( 
´efix
[0] << 8 ) |…refix[1] );

248  
Ën
;

249 
	}
}

251 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
	$PmlG‘IÁeg”V®ue
Ğ
PmlObjeù_t
 
obj
, * 
pTy³
, * 
pV®ue
 )

253 
ty³
;

254 
sv®ue
[( )];

255 
accum
 = 0, 
i
, 
Ën
;

257 ifĞ!
pTy³
 )

259 
pTy³
 = &
ty³
;

262 
Ën
 = 
	`PmlG‘P»fixV®ue
Ğ
obj
, 
pTy³
, 0, 0, (*)
sv®ue
, ( ) );

268  
i
 = 0; i < 
Ën
; i++ )

270 
accum
 = ( (‡ccum << 8 ) | ( 
sv®ue
[
i
] & 0xFF ) );

272 ifĞ
pV®ue
 )

274 *
pV®ue
 = 
accum
;

277  
OK
;

278 
	}
}

280 
	$PmlS‘Stus
Ğ
PmlObjeù_t
 
obj
, 
¡©us
 )

282 
obj
->
¡©us
 = status;

284  
¡©us
;

285 
	}
}

287 
	$PmlG‘Stus
Ğ
PmlObjeù_t
 
obj
 )

289  
obj
->
¡©us
;

290 
	}
}

292 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
	$PmlReque¡S‘
Ğ
deviûid
, 
chªÃlid
, 
PmlObjeù_t
 
obj
 )

294 
d©a
[
PML_MAX_DATALEN
];

295 
d©®’
=0, 
¡©us
=
ERROR
, 
ty³
, 
»suÉ
, 
pml_»suÉ
;

297 
	`PmlS‘Stus
(
obj
, 
PML_ERROR
);

299 
d©®’
 = 
	`PmlG‘V®ue
(
obj
, &
ty³
, (*)
d©a
, (data));

301 
»suÉ
 = 
	`hpmud_£t_pml
(
deviûid
, 
chªÃlid
, 
obj
->
oid
, 
ty³
, 
d©a
, 
d©®’
, &
pml_»suÉ
);

303 
	`PmlS‘Stus
(
obj
, 
pml_»suÉ
);

305 ià(
»suÉ
 =ğ
HPMUD_R_OK
)

306 
¡©us
 = 
OK
;

308  
¡©us
;

309 
	}
}

311 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
	$PmlReque¡S‘R‘ry
Ğ
deviûid
, 
chªÃlid
, 
PmlObjeù_t
 
obj
, 
couÁ
, 
d–ay
 )

313 
¡©
=
ERROR
, 
r
;

315 if(
couÁ
 <= 0)

317 
couÁ
 = 10;

319 if(
d–ay
 <= 0)

321 
d–ay
 = 1;

325 ià((
r
 = 
	`PmlReque¡S‘
(
deviûid
, 
chªÃlid
, 
obj
)è=ğ
ERROR
)

326 
bugout
;

327 ià(
	`PmlG‘Stus
(
obj
è=ğ
PML_ERROR_ACTION_CAN_NOT_BE_PERFORMED_NOW
 && 
couÁ
 > 0)

329 
	`¦“p
(
d–ay
);

330 
couÁ
--;

337 ià(
	`PmlG‘Stus
(
obj
è& 
PML_ERROR
)

339 
	`DBG
(6, "PML s‘ faed: oid=% couÁ=%d d–ay=%d % %d\n", 
obj
->
oid
, 
couÁ
, 
d–ay
, 
__FILE__
, 
__LINE__
);

340 
bugout
;

343 
¡©
 = 
OK
;

345 
bugout
:

346  
¡©
;

347 
	}
}

349 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
	$PmlReque¡G‘
Ğ
deviûid
, 
chªÃlid
, 
PmlObjeù_t
 
obj
 )

351 
d©a
[
PML_MAX_DATALEN
];

352 
d©®’
=0, 
¡©
=
ERROR
, 
ty³
, 
pml_»suÉ
;

353 
HPMUD_RESULT
 
»suÉ
;

355 
»suÉ
 = 
	`hpmud_g‘_pml
(
deviûid
, 
chªÃlid
, 
obj
->
oid
, 
d©a
, (d©a), &
d©®’
, &
ty³
, &
pml_»suÉ
);

357 
	`PmlS‘Stus
(
obj
, 
pml_»suÉ
);

359 ià(
»suÉ
 =ğ
HPMUD_R_OK
)

361 
	`PmlS‘V®ue
(
obj
, 
ty³
, (*)
d©a
, 
d©®’
);

362 
¡©
 = 
OK
;

365  
¡©
;

366 
	}
}

372 
	$is_z”o
(*
buf
, 
size
)

374 
i
;

376 
i
=0; i<
size
; i++)

378 ià(
buf
[
i
] != 0)

382 
	}
}

385 
	$şr_sÿn_tok’
(
HPAIO_RECORD
 *
h·io
)

387 
Ën
, 
i
, 
¡©
=
ERROR
;

388 
max
 = (
h·io
->
pml
.
sÿnTok’
);

390 ià(
	`PmlReque¡G‘
(
h·io
->
deviûid
, h·io->
cmd_chªÃlid
, h·io->
pml
.
objSÿnTok’
è=ğ
ERROR
)

391 
bugout
;

392 
Ën
 = 
	`PmlG‘V®ue
(
h·io
->
pml
.
objSÿnTok’
, 0, h·io->pml.
sÿnTok’
, 
max
);

394 ià(
Ën
 > 0 && !
	`is_z”o
(
h·io
->
pml
.
sÿnTok’
,†en))

397 
Ën
 = (ËÀ> 
max
) ? max :†en;

398 
i
=0; i<
Ën
; i++)

399 
h·io
->
pml
.
sÿnTok’
[
i
] = 0;

400 
h·io
->
pml
.
ËnSÿnTok’
 = 
Ën
;

401 ià(
	`PmlS‘V®ue
(
h·io
->
pml
.
objSÿnTok’
, 
PML_TYPE_BINARY
, h·io->pml.
sÿnTok’
, 
Ën
è=ğ
ERROR
)

402 
bugout
;

403 ià(
	`PmlReque¡S‘
(
h·io
->
deviûid
, h·io->
cmd_chªÃlid
, h·io->
pml
.
objSÿnTok’
è=ğ
ERROR
)

404 
bugout
;

407 
h·io
->
pml
.
ËnSÿnTok’
 = 
Ën
;

408 
¡©
 = 
OK
;

410 
bugout
:

411  
¡©
;

412 
	}
}

415 
	$£t_sÿn_tok’
(
HPAIO_RECORD
 *
h·io
)

417 
¡©
=
ERROR
;

420 ià(
	`şr_sÿn_tok’
(
h·io
è=ğ
ERROR
)

421 
bugout
;

423 ià(
h·io
->
pml
.
ËnSÿnTok’
 > 0)

425 
	`¡ºıy
(
h·io
->
pml
.
sÿnTok’
, "555", h·io->pml.
ËnSÿnTok’
);

426 ià(
	`PmlS‘V®ue
(
h·io
->
pml
.
objSÿnTok’
, 
PML_TYPE_BINARY
, h·io->pml.
sÿnTok’
, h·io->pml.
ËnSÿnTok’
è=ğ
ERROR
)

427 
bugout
;

428 ià(
	`PmlReque¡S‘
(
h·io
->
deviûid
, h·io->
cmd_chªÃlid
, h·io->
pml
.
objSÿnTok’
è=ğ
ERROR
)

429 
bugout
;

431 
¡©
 = 
OK
;

433 
bugout
:

434  
¡©
;

435 
	}
}

437 
	$£t_sÿn_·¿m‘”s
(
HPAIO_RECORD
 *
h·io
)

439 
pix–D©aTy³
, 
¡©
=
ERROR
;

440 
PmlResŞutiÚ
 
»sŞutiÚ
;

441 
cİ›rReduùiÚ
 = 100;

442 
com´essiÚ
;

444 
h·io
->
efãùiveSÿnMode
 = h·io->
cu¼’tSÿnMode
;

445 
h·io
->
efãùiveResŞutiÚ
 = h·io->
cu¼’tResŞutiÚ
;

448 
	`PmlS‘IÁeg”V®ue
(
h·io
->
pml
.
objU¶ßdTimeout
, 
PML_TYPE_SIGNED_INTEGER
, 
PML_UPLOAD_TIMEOUT
);

449 ià(
	`PmlReque¡S‘
(
h·io
->
deviûid
, h·io->
cmd_chªÃlid
, h·io->
pml
.
objU¶ßdTimeout
è=ğ
ERROR
)

450 
bugout
;

453 
h·io
->
cu¼’tSÿnMode
)

455 
SCAN_MODE_LINEART
:

456 
pix–D©aTy³
 = 
PML_DATA_TYPE_LINEART
;

458 
SCAN_MODE_GRAYSCALE
:

459 
pix–D©aTy³
 = 
PML_DATA_TYPE_GRAYSCALE
;

461 
SCAN_MODE_COLOR
:

463 
pix–D©aTy³
 = 
PML_DATA_TYPE_COLOR
;

466 
	`PmlS‘IÁeg”V®ue
(
h·io
->
pml
.
objPix–D©aTy³
, 
PML_TYPE_ENUMERATION
, 
pix–D©aTy³
);

467 ià(
	`PmlReque¡S‘
(
h·io
->
deviûid
, h·io->
cmd_chªÃlid
, h·io->
pml
.
objPix–D©aTy³
è=ğ
ERROR
)

468 
bugout
;

471 
	`BEND_SET_LONG
(
»sŞutiÚ
.
x
, 
h·io
->
cu¼’tResŞutiÚ
 << 16);

472 
	`BEND_SET_LONG
(
»sŞutiÚ
.
y
, 
h·io
->
cu¼’tResŞutiÚ
 << 16);

473 
	`PmlS‘V®ue
(
h·io
->
pml
.
objResŞutiÚ
, 
PML_TYPE_BINARY
, (*)&
»sŞutiÚ
, (resolution));

474 ià(
	`PmlReque¡S‘
(
h·io
->
deviûid
, h·io->
cmd_chªÃlid
, h·io->
pml
.
objResŞutiÚ
è=ğ
ERROR
)

475 
bugout
;

478 
h·io
->
cu¼’tCom´essiÚ
)

480 
COMPRESSION_NONE
:

481 
com´essiÚ
 = 
PML_COMPRESSION_NONE
;

483 
COMPRESSION_MH
:

484 
com´essiÚ
 = 
PML_COMPRESSION_MH
;

486 
COMPRESSION_MR
:

487 
com´essiÚ
 = 
PML_COMPRESSION_MR
;

489 
COMPRESSION_MMR
:

490 
com´essiÚ
 = 
PML_COMPRESSION_MMR
;

492 
COMPRESSION_JPEG
:

494 
com´essiÚ
 = 
PML_COMPRESSION_JPEG
;

498 
	`PmlS‘IÁeg”V®ue
(
h·io
->
pml
.
objCom´essiÚ
, 
PML_TYPE_ENUMERATION
, 
com´essiÚ
);

499 ià(
	`PmlReque¡S‘
(
h·io
->
deviûid
, h·io->
cmd_chªÃlid
, h·io->
pml
.
objCom´essiÚ
è=ğ
ERROR
)

500 
bugout
;

503 
	`PmlS‘IÁeg”V®ue
(
h·io
->
pml
.
objCom´essiÚFaùÜ
, 
PML_TYPE_SIGNED_INTEGER
, h·io->
cu¼’tJ³gCom´essiÚFaùÜ
);

504 ià(
	`PmlReque¡S‘
(
h·io
->
deviûid
, h·io->
cmd_chªÃlid
, h·io->
pml
.
objCom´essiÚFaùÜ
è=ğ
ERROR
)

505 
bugout
;

509 ià(
	`SANE_OPTION_IS_ACTIVE
(
h·io
->
İtiÚ
[
OPTION_CONTRAST
].
ÿp
))

512 
	`PmlS‘IÁeg”V®ue
(
h·io
->
pml
.
objCÚŒa¡
, 
PML_TYPE_SIGNED_INTEGER
, h·io->
cu¼’tCÚŒa¡
);

513 ià(
	`PmlReque¡S‘
(
h·io
->
deviûid
, h·io->
cmd_chªÃlid
, h·io->
pml
.
objCÚŒa¡
è=ğ
ERROR
)

514 
bugout
;

519 
	`PmlS‘IÁeg”V®ue
(
h·io
->
pml
.
objCİ›rReduùiÚ
, 
PML_TYPE_SIGNED_INTEGER
, 
cİ›rReduùiÚ
);

520 ià(
	`PmlReque¡S‘
(
h·io
->
deviûid
, h·io->
cmd_chªÃlid
, h·io->
pml
.
objCİ›rReduùiÚ
è=ğ
ERROR
)

521 
bugout
;

523 
¡©
 = 
OK
;

525 
bugout
:

526  
¡©
;

527 
	}
}

529 
	$pml_to_§Ã_¡©us
(
HPAIO_RECORD
 *
h·io
)

531 
¡©
=
SANE_STATUS_IO_ERROR
, 
¡©us
;

533 ià(
	`PmlReque¡G‘
(
h·io
->
deviûid
, h·io->
cmd_chªÃlid
, h·io->
pml
.
objSÿÂ”Stus
è=ğ
ERROR
)

534 
bugout
;

535 
	`PmlG‘IÁeg”V®ue
(
h·io
->
pml
.
objSÿÂ”Stus
, 0, &
¡©us
);

537 
	`DBG
(6, "PML sÿÂ”Stus=%x: % %d\n", 
¡©us
, 
__FILE__
, 
__LINE__
);

539 if(
¡©us
 & 
PML_SCANNER_STATUS_FEEDER_JAM
)

541 
¡©
 = 
SANE_STATUS_JAMMED
;

543 if(
¡©us
 & 
PML_SCANNER_STATUS_FEEDER_OPEN
)

545 
¡©
 = 
SANE_STATUS_COVER_OPEN
;

547 if(
¡©us
 & 
PML_SCANNER_STATUS_FEEDER_EMPTY
)

549 if(
h·io
->
cu¼’tAdfMode
 =ğ
ADF_MODE_FLATBED
 || (h·io->
cu¼’tB©chSÿn
 =ğ
SANE_FALSE
 && h·io->cu¼’tAdfMod=ğ
ADF_MODE_AUTO
))

551 
¡©
 = 
SANE_STATUS_GOOD
;

555 
¡©
 = 
SANE_STATUS_NO_DOCS
;

558 if(
¡©us
 & 
PML_SCANNER_STATUS_INVALID_MEDIA_SIZE
)

560 
¡©
 = 
SANE_STATUS_INVAL
;

562 if(
¡©us
)

564 
¡©
 = 
SANE_STATUS_IO_ERROR
;

568 
¡©
 = 
SANE_STATUS_GOOD
;

571 
bugout
:

572  
¡©
;

573 
	}
}

575 
	$check_pml_dÚe
(
HPAIO_RECORD
 *
h·io
)

577 
¡©
=
ERROR
, 
¡©e
;

580 ià(
	`PmlReque¡G‘
(
h·io
->
deviûid
, h·io->
cmd_chªÃlid
, h·io->
pml
.
objU¶ßdS‹
è=ğ
ERROR
)

581 
bugout
;

582 
	`PmlG‘IÁeg”V®ue
(
h·io
->
pml
.
objU¶ßdS‹
, 0, &
¡©e
);

583 
h·io
->
u¶ßd_¡©e
 = 
¡©e
;

585 ià(
¡©e
 =ğ
PML_UPLOAD_STATE_DONE
 || s‹ =ğ
PML_UPLOAD_STATE_NEWPAGE
)

586 
h·io
->
pml_dÚe
=1;

587 ià(
¡©e
 !ğ
PML_UPLOAD_STATE_ACTIVE
)

588 
bugout
;

589 ià(
h·io
->
_dÚe
 && h·io->
mådtf_dÚe
)

591 ià(
h·io
->
pml_timeout_út
++ > 15)

593 
	`bug
("check_pml_dÚtimeouˆút=%d: % %d\n", 
h·io
->
pml_timeout_út
, 
__FILE__
, 
__LINE__
);

594 
bugout
;

597 
	`¦“p
(1);

600 
¡©
 = 
OK
;

602 
bugout
:

603  
¡©
;

604 
	}
}

606 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
	$pml_¡¬t
(
HPAIO_RECORD
 *
h·io
)

608 
MFPDTF_FIXED_HEADER
 *
ph
;

609 
MFPDTF_START_PAGE
 *
ps
;

610 
IP_IMAGE_TRAITS
 
Œa™s
;

611 
IP_XFORM_SPEC
 
xfÜms
[
IP_MAX_XFORMS
], * 
pXfÜm
 = xforms;

612 
¡©
 = 
SANE_STATUS_DEVICE_BUSY
;

613 
i
, 
bsize
, 
¡©e
, 
wResuÉ
, 
šdex
, 
r
;

614 
ŞdStuff
 = (
h·io
->
´eD’®i
 || h·io->
äomD’®i
 || h·io->
d’®i
) ? 1 : 0;

616 ià(
h·io
->
cmd_chªÃlid
 < 0)

618 ià(
	`hpmud_İ’_chªÃl
(
h·io
->
deviûid
, "HP-MESSAGE", &h·io->
cmd_chªÃlid
è!ğ
HPMUD_R_OK
)

620 
	`bug
("çedØİ’…mÈchªÃl: % %d\n", 
__FILE__
, 
__LINE__
);

621 
bugout
;

623 
	`S’dSÿnEv’t
(
h·io
->
deviûuri
, 
EVENT_START_SCAN_JOB
);

625 ià(!
ŞdStuff
)

627 ià(
h·io
->
sÿn_chªÃlid
 < 0)

629 ià(
	`hpmud_İ’_chªÃl
(
h·io
->
deviûid
, "HP-SCAN", &h·io->
sÿn_chªÃlid
è!ğ
HPMUD_R_OK
)

631 
	`bug
("çedØİ’ sÿÀchªÃl: % %d\n", 
__FILE__
, 
__LINE__
);

632 
bugout
;

637 
r
 = 
	`pml_to_§Ã_¡©us
(
h·io
);

638 ià(
r
 !ğ
SANE_STATUS_GOOD
)

640 
¡©
 = 
r
;

641 
bugout
;

645 ià(
	`PmlReque¡G‘
(
h·io
->
deviûid
, h·io->
cmd_chªÃlid
, h·io->
pml
.
objU¶ßdS‹
è=ğ
ERROR
)

647 
¡©
=
SANE_STATUS_IO_ERROR
;

648 
bugout
;

650 
	`PmlG‘IÁeg”V®ue
(
h·io
->
pml
.
objU¶ßdS‹
, 0, &
¡©e
);

651 
	`DBG
(6, "PML u¶ßdS‹=%d befÜsÿn: % %d\n", 
¡©e
, 
__FILE__
, 
__LINE__
);

652 
¡©e
)

654 
PML_UPLOAD_STATE_IDLE
:

655 ià(
	`£t_sÿn_tok’
(
h·io
è=ğ
ERROR
)

656 
bugout
;

657 ià(
	`£t_sÿn_·¿m‘”s
(
h·io
è=ğ
ERROR
)

658 
bugout
;

660 
PML_UPLOAD_STATE_NEWPAGE
:

662 
PML_UPLOAD_STATE_DONE
:

663 
	`PmlS‘IÁeg”V®ue
(
h·io
->
pml
.
objU¶ßdS‹
, 
PML_TYPE_ENUMERATION
, 
PML_UPLOAD_STATE_IDLE
);

664 ià(
	`PmlReque¡S‘R‘ry
(
h·io
->
deviûid
, h·io->
cmd_chªÃlid
, h·io->
pml
.
objU¶ßdS‹
, 0, 0è=ğ
ERROR
)

665 
bugout
;

667 
PML_UPLOAD_STATE_START
:

668 
PML_UPLOAD_STATE_ACTIVE
:

669 
bugout
;

670 
PML_UPLOAD_STATE_ABORTED
:

672 
¡©
 = 
	`h·ioSÿÂ”ToSªeE¼Ü
(
h·io
);

673 
	`PmlS‘IÁeg”V®ue
(
h·io
->
pml
.
objU¶ßdS‹
, 
PML_TYPE_ENUMERATION
, 
PML_UPLOAD_STATE_IDLE
);

674 ià(
	`PmlReque¡S‘R‘ry
(
h·io
->
deviûid
, h·io->
cmd_chªÃlid
, h·io->
pml
.
objU¶ßdS‹
, 0, 0è=ğ
ERROR
)

675 
bugout
;

679 
h·io
->
sÿnP¬am‘”s
 = h·io->
´esÿnP¬am‘”s
;

680 
	`mem£t
(
xfÜms
, 0, (xforms));

681 
Œa™s
.
iPix–sP”Row
 = -1;

683 
h·io
->
efãùiveSÿnMode
)

685 
SCAN_MODE_LINEART
:

686 
h·io
->
sÿnP¬am‘”s
.
fÜm©
 = 
SANE_FRAME_GRAY
;

687 
h·io
->
sÿnP¬am‘”s
.
d•th
 = 1;

688 
Œa™s
.
iB™sP”Pix–
 = 1;

690 
SCAN_MODE_GRAYSCALE
:

691 
h·io
->
sÿnP¬am‘”s
.
fÜm©
 = 
SANE_FRAME_GRAY
;

692 
h·io
->
sÿnP¬am‘”s
.
d•th
 = 8;

693 
Œa™s
.
iB™sP”Pix–
 = 8;

695 
SCAN_MODE_COLOR
:

697 
h·io
->
sÿnP¬am‘”s
.
fÜm©
 = 
SANE_FRAME_RGB
;

698 
h·io
->
sÿnP¬am‘”s
.
d•th
 = 8;

699 
Œa™s
.
iB™sP”Pix–
 = 24;

702 
Œa™s
.
lHÜizDPI
 = 
h·io
->
efãùiveResŞutiÚ
 << 16;

703 
Œa™s
.
lV”tDPI
 = 
h·io
->
efãùiveResŞutiÚ
 << 16;

704 
Œa™s
.
lNumRows
 = -1;

705 
Œa™s
.
iNumPages
 = 1;

706 
Œa™s
.
iPageNum
 = 1;

709 
	`PmlS‘IÁeg”V®ue
(
h·io
->
pml
.
objU¶ßdS‹
, 
PML_TYPE_ENUMERATION
, 
PML_UPLOAD_STATE_START
);

710 ià(
	`PmlReque¡S‘R‘ry
(
h·io
->
deviûid
, h·io->
cmd_chªÃlid
, h·io->
pml
.
objU¶ßdS‹
, 0, 0è=ğ
ERROR
)

711 
bugout
;

714 
i
=0; i < 
PML_START_SCAN_WAIT_ACTIVE_MAX_RETRIES
; i++)

716 ià(
	`PmlReque¡G‘
(
h·io
->
deviûid
, h·io->
cmd_chªÃlid
, h·io->
pml
.
objU¶ßdS‹
è=ğ
ERROR
)

718 
¡©
=
SANE_STATUS_IO_ERROR
;

719 
bugout
;

721 
	`PmlG‘IÁeg”V®ue
(
h·io
->
pml
.
objU¶ßdS‹
, 0, &
¡©e
);

723 if(
¡©e
 =ğ
PML_UPLOAD_STATE_ACTIVE
)

726 if(
¡©e
 !ğ
PML_UPLOAD_STATE_START
)

729 
	`¦“p
(1);

732 ià(
¡©e
 !ğ
PML_UPLOAD_STATE_ACTIVE
)

735 
r
 = 
	`h·ioSÿÂ”ToSªeE¼Ü
(
h·io
);

736 ià(
r
 !ğ
SANE_STATUS_GOOD
)

737 
¡©
 = 
r
;

738 
bugout
;

742 ià(
ŞdStuff
)

744 ià(
h·io
->
sÿn_chªÃlid
 < 0)

746 ià(
	`hpmud_İ’_chªÃl
(
h·io
->
deviûid
, "HP-SCAN", &h·io->
sÿn_chªÃlid
è!ğ
HPMUD_R_OK
)

747 
bugout
;

754 ià((
bsize
 = 
	`»ad_mådtf_block
(
h·io
->
deviûid
, h·io->
sÿn_chªÃlid
, (*)h·io->
šBufãr
, (hpaio->inBuffer), 45)) <= 0)

755 
bugout
;

757 
ph
 = (
MFPDTF_FIXED_HEADER
 *)
h·io
->
šBufãr
;

758 ià((
ph
->
D©aTy³
 =ğ
DT_SCAN
è&& (ph->
PageFÏg
 & 
PF_NEW_PAGE
))

762 
šdex
 = (
MFPDTF_FIXED_HEADER
);

763 
ps
 = (
MFPDTF_START_PAGE
 *)(
h·io
->
šBufãr
 + 
šdex
);

764 ià(
ps
->
ID
 !ğ
ID_START_PAGE
)

765 
bugout
;

768 
Œa™s
.
iPix–sP”Row
 = 
	`Ë16toh
(
ps
->
BÏckPix–sP”Row
);

769 
Œa™s
.
iB™sP”Pix–
 = 
	`Ë16toh
(
ps
->
BÏckB™sP”Pix–
);

770 
Œa™s
.
lHÜizDPI
 = 
	`Ë16toh
(
ps
->
BÏckHÜzDPI
);

771 
Œa™s
.
lV”tDPI
 = 
	`Ë16toh
(
ps
->
BÏckV”tDPI
);

774 
ps
->
Code
)

776 
MFPDTF_RASTER_MH
:

777 
pXfÜm
->
aXfÜmInfo
[
IP_FAX_FORMAT
].
dwÜd
 = 
IP_FAX_MH
;

778 
	`ADD_XFORM
Ğ
X_FAX_DECODE
 );

780 
MFPDTF_RASTER_MR
:

781 
pXfÜm
->
aXfÜmInfo
[
IP_FAX_FORMAT
].
dwÜd
 = 
IP_FAX_MR
;

782 
	`ADD_XFORM
Ğ
X_FAX_DECODE
 );

784 
MFPDTF_RASTER_MMR
:

785 
pXfÜm
->
aXfÜmInfo
[
IP_FAX_FORMAT
].
dwÜd
 = 
IP_FAX_MMR
;

786 
	`ADD_XFORM
Ğ
X_FAX_DECODE
 );

788 
MFPDTF_RASTER_BITMAP
:

789 
MFPDTF_RASTER_GRAYMAP
:

790 
MFPDTF_RASTER_RGB
:

793 
MFPDTF_RASTER_JPEG
:

795 
pXfÜm
->
aXfÜmInfo
[
IP_JPG_DECODE_FROM_DENALI
].
dwÜd
 = 
h·io
->
äomD’®i
;

796 
	`ADD_XFORM
Ğ
X_JPG_DECODE
 );

797 
pXfÜm
->
aXfÜmInfo
[
IP_CNV_COLOR_SPACE_WHICH_CNV
].
dwÜd
 = 
IP_CNV_YCC_TO_SRGB
;

798 
pXfÜm
->
aXfÜmInfo
[
IP_CNV_COLOR_SPACE_GAMMA
].
dwÜd
 = 0x00010000;

799 
	`ADD_XFORM
Ğ
X_CNV_COLOR_SPACE
 );

803 
	`bug
("unknowÀimag’codšg sªe_¡¬t:‚ame=% sİ=%d % %d\n", 
h·io
->
§ÃDeviû
.
Çme
, 
ps
->
Code
, 
__FILE__
, 
__LINE__
);

806 
šdex
 +ğ(
MFPDTF_START_PAGE
);

807 
h·io
->
BlockSize
 = 
bsize
;

808 
h·io
->
BlockIndex
 = 
šdex
;

809 
h·io
->
RecÜdSize
 = 0;

810 
h·io
->
RecÜdIndex
 = 0;

811 
h·io
->
mådtf_dÚe
 = 0;

812 
h·io
->
pml_dÚe
 = 0;

813 
h·io
->
_dÚe
 = 0;

814 
h·io
->
·ge_dÚe
 = 0;

815 
h·io
->
mådtf_timeout_út
 = 0;

816 
h·io
->
pml_timeout_út
 = 0;

818 
h·io
->
sÿnP¬am‘”s
.
pix–s_³r_lše
 = 
Œa™s
.
iPix–sP”Row
;

819 
h·io
->
sÿnP¬am‘”s
.
lšes
 = 
Œa™s
.
lNumRows
;

821 if(
h·io
->
sÿnP¬am‘”s
.
lšes
 < 0)

823 
h·io
->
sÿnP¬am‘”s
.
lšes
 = 
	`MILLIMETERS_TO_PIXELS
(h·io->
bryRªge
.
max
, h·io->
efãùiveResŞutiÚ
);

826 
mmWidth
 = 
	`PIXELS_TO_MILLIMETERS
(
Œa™s
.
iPix–sP”Row
, 
h·io
->
efãùiveResŞutiÚ
);

829 
pXfÜm
->
aXfÜmInfo
[
IP_CROP_LEFT
].
dwÜd
 = 
	`MILLIMETERS_TO_PIXELS
Ğ
h·io
->
efãùiveTlx
, h·io->
efãùiveResŞutiÚ
 );

830 ifĞ
h·io
->
efãùiveBrx
 < h·io->
brxRªge
.
max
 && h·io->efãùiveBrx < 
mmWidth
 )

832 
pXfÜm
->
aXfÜmInfo
[
IP_CROP_RIGHT
].
dwÜd
 = 
	`MILLIMETERS_TO_PIXELS
Ğ
mmWidth
-
h·io
->
efãùiveBrx
, h·io->
efãùiveResŞutiÚ
 );

834 
pXfÜm
->
aXfÜmInfo
[
IP_CROP_TOP
].
dwÜd
 = 
	`MILLIMETERS_TO_PIXELS
Ğ
h·io
->
efãùiveTly
, h·io->
efãùiveResŞutiÚ
 );

835 ifĞ
h·io
->
cu¼’tL’gthM—su»m’t
 !ğ
LENGTH_MEASUREMENT_UNLIMITED
 )

837 
h·io
->
sÿnP¬am‘”s
.
lšes
 = 
pXfÜm
->
aXfÜmInfo
[
IP_CROP_MAXOUTROWS
].
dwÜd
 =

838 
	`MILLIMETERS_TO_PIXELS
(
h·io
->
efãùiveBry
 - h·io->
efãùiveTly
, h·io->
efãùiveResŞutiÚ
);

840 
h·io
->
sÿnP¬am‘”s
.
pix–s_³r_lše
 -ğ
pXfÜm
->
aXfÜmInfo
[
IP_CROP_LEFT
].
dwÜd
 +…XfÜm->aXfÜmInfo[
IP_CROP_RIGHT
].dword;

841 
	`ADD_XFORM
Ğ
X_CROP
 );

843 ifĞ
h·io
->
cu¼’tL’gthM—su»m’t
 =ğ
LENGTH_MEASUREMENT_PADDED
 )

845 
pXfÜm
->
aXfÜmInfo
[
IP_PAD_LEFT
].
dwÜd
 = 0;

846 
pXfÜm
->
aXfÜmInfo
[
IP_PAD_RIGHT
].
dwÜd
 = 0;

847 
pXfÜm
->
aXfÜmInfo
[
IP_PAD_TOP
].
dwÜd
 = 0;

848 
pXfÜm
->
aXfÜmInfo
[
IP_PAD_BOTTOM
].
dwÜd
 = 0;

849 
pXfÜm
->
aXfÜmInfo
[
IP_PAD_VALUE
].
dwÜd
 = ( 
h·io
->
efãùiveSÿnMode
 =ğ
SCAN_MODE_LINEART
 ) ? 
PAD_VALUE_LINEART
 : 
PAD_VALUE_GRAYSCALE_COLOR
;

850 
pXfÜm
->
aXfÜmInfo
[
IP_PAD_MIN_HEIGHT
].
dwÜd
 = 
h·io
->
sÿnP¬am‘”s
.
lšes
;

851 
	`ADD_XFORM
Ğ
X_PAD
 );

855 ifĞ
pXfÜm
 =ğ
xfÜms
 )

857 
	`ADD_XFORM
Ğ
X_SKEL
 );

860 
wResuÉ
 = 
	`O³n
Ğ
pXfÜm
 - 
xfÜms
, xfÜms, 0, &
h·io
->
hJob
 );

862 ifĞ
wResuÉ
 !ğ
IP_DONE
 || !
h·io
->
hJob
 )

864 
¡©
 = 
SANE_STATUS_INVAL
;

865 
bugout
;

868 
Œa™s
.
iCompÚ’tsP”Pix–
 = ( (¿™s.
iB™sP”Pix–
 % 3 ) ? 1 : 3 );

869 
wResuÉ
 = 
	`S‘DeçuÉIÅutT¿™s
Ğ
h·io
->
hJob
, &
Œa™s
 );

871 ifĞ
wResuÉ
 !ğ
IP_DONE
 )

873 
¡©
 = 
SANE_STATUS_INVAL
;

874 
bugout
;

877 
h·io
->
sÿnP¬am‘”s
.
by‹s_³r_lše
 =

878 
	`BYTES_PER_LINE
(
h·io
->
sÿnP¬am‘”s
.
pix–s_³r_lše
, h·io->sÿnP¬am‘”s.
d•th
 * (h·io->sÿnP¬am‘”s.
fÜm©
 =ğ
SANE_FRAME_RGB
 ? 3 : 1));

880 ifĞ
h·io
->
cu¼’tL’gthM—su»m’t
 =ğ
LENGTH_MEASUREMENT_UNKNOWN
 || h·io->cu¼’tL’gthM—su»m’ˆ=ğ
LENGTH_MEASUREMENT_UNLIMITED
 )

882 
h·io
->
sÿnP¬am‘”s
.
lšes
 = -1;

885 
¡©
 = 
SANE_STATUS_GOOD
;

887 
bugout
:

888  
¡©
;

889 
	}
}

891 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
	$pml_»ad
(
HPAIO_RECORD
 *
h·io
, 
SANE_By‹
 *
d©a
, 
SANE_IÁ
 
maxL’gth
, SANE_IÁ *
pL’gth
)

893 
MFPDTF_RASTER
 *
pd
;

894 
¡©
=
SANE_STATUS_IO_ERROR
;

895 
ouutAva
=
maxL’gth
, 
ouutU£d
=0, 
ouutThisPos
;

896 *
ouut
 = 
d©a
;

897 
šputAva
=0, 
šputU£d
=0, 
šputNextPos
;

898 *
šput
;

899 
bsize
, 
wResuÉ
;

901 
	`DBG
(8, "§Ã_h·io_»ad c®Ëd hªdË=%°d©a=%°maxL’gth=%d†’gth=%d: % %d\n", 
h·io
, 
d©a
, 
maxL’gth
, *
pL’gth
, 
__FILE__
, 
__LINE__
);

904 ià(
h·io
->
RecÜdIndex
 < h·io->
RecÜdSize
)

906 
šputAva
 = 
h·io
->
RecÜdSize
 - h·io->
RecÜdIndex
;

907 
šput
 = 
h·io
->
šBufãr
 + h·io->
BlockIndex
 + h·io->
RecÜdIndex
 + (
MFPDTF_RASTER
);

910 
wResuÉ
 = 
	`CÚv”t
(
h·io
->
hJob
, 
šputAva
, 
šput
, &
šputU£d
, &
šputNextPos
, 
ouutAva
, 
ouut
, &
ouutU£d
, &
ouutThisPos
);

911 if(
wResuÉ
 & (
IP_INPUT_ERROR
 | 
IP_FATAL_ERROR
))

913 
	`bug
("CÚv”ˆ”rÜ=%x: % %d\n", 
wResuÉ
, 
__FILE__
, 
__LINE__
);

914 
bugout
;

916 *
pL’gth
 = 
ouutU£d
;

917 
h·io
->
RecÜdIndex
 +ğ
šputU£d
;

918 ià(
h·io
->
RecÜdIndex
 >ğh·io->
RecÜdSize
)

919 
h·io
->
BlockIndex
 +ğ(
MFPDTF_RASTER
è+ h·io->
RecÜdSize
;

921 ià(
h·io
->
BlockIndex
 < h·io->
BlockSize
)

924 
pd
 = (
MFPDTF_RASTER
 *)(
h·io
->
šBufãr
 + h·io->
BlockIndex
);

925 ià(
pd
->
ID
 =ğ
ID_RASTER_DATA
)

928 
h·io
->
RecÜdSize
 = 
	`Ë16toh
(
pd
->
Size
);

929 
h·io
->
RecÜdIndex
 = 0;

931 ià(
pd
->
ID
 =ğ
ID_END_PAGE
)

934 
h·io
->
·ge_dÚe
 = 1;

935 
h·io
->
BlockIndex
 +ğ(
MFPDTF_END_PAGE
);

939 
	`bug
("unknowÀmådtà»cÜd id=%d:…ml_»ad % %d\n", 
pd
->
ID
, 
__FILE__
, 
__LINE__
);

940 
bugout
;

943 ià(!
h·io
->
mådtf_dÚe
)

946 ià((
bsize
 = 
	`»ad_mådtf_block
(
h·io
->
deviûid
, h·io->
sÿn_chªÃlid
, (*)h·io->
šBufãr
, (hpaio->inBuffer), 1)) < 0)

947 
bugout
;

949 
h·io
->
BlockSize
 = 0;

950 
h·io
->
BlockIndex
 = 0;

952 ià(
bsize
 == 0)

954 ià(
h·io
->
·ge_dÚe
 || h·io->
pml_dÚe
)

955 
h·io
->
mådtf_dÚe
 = 1;

956 ià(
h·io
->
mådtf_timeout_út
++ > 5)

958 
	`bug
("»ad_mådtf_blockimeouˆút=%d: % %d\n", 
h·io
->
mådtf_timeout_út
, 
__FILE__
, 
__LINE__
);

959 
bugout
;

963 ià(
	`check_pml_dÚe
(
h·io
è=ğ
ERROR
)

964 
bugout
;

969 
h·io
->
mådtf_timeout_út
 = 0;

971 ià(
bsize
 > (
MFPDTF_FIXED_HEADER
))

973 
h·io
->
BlockSize
 = 
bsize
;

974 
h·io
->
BlockIndex
 = (
MFPDTF_FIXED_HEADER
);

978 ià((
h·io
->
·ge_dÚe
 || h·io->
pml_dÚe
è&& !h·io->
_dÚe
)

981 
šput
 = 
NULL
;

982 
wResuÉ
 = 
	`CÚv”t
(
h·io
->
hJob
, 
šputAva
, 
šput
, &
šputU£d
, &
šputNextPos
, 
ouutAva
, 
ouut
, &
ouutU£d
, &
ouutThisPos
);

983 ià(
wResuÉ
 & (
IP_INPUT_ERROR
 | 
IP_FATAL_ERROR
))

985 
	`bug
("h·io: ipCÚv”ˆ”rÜ=%x\n", 
wResuÉ
);

986 
bugout
;

988 *
pL’gth
 = 
ouutU£d
;

989 ià(
ouutU£d
 == 0)

990 
h·io
->
_dÚe
 = 1;

992 ià(!
h·io
->
pml_dÚe
)

994 ià(
	`check_pml_dÚe
(
h·io
è=ğ
ERROR
)

995 
bugout
;

998 if(
h·io
->
_dÚe
 && h·io->
mådtf_dÚe
 && h·io->
pml_dÚe
)

999 
¡©
 = 
SANE_STATUS_EOF
;

1001 
¡©
 = 
SANE_STATUS_GOOD
;

1003 
bugout
:

1004 ià(
¡©
 !ğ
SANE_STATUS_GOOD
)

1006 ià(
h·io
->
hJob
)

1008 
	`Clo£
(
h·io
->
hJob
);

1009 
h·io
->
hJob
 = 0;

1016 
	`DBG
(8, "§Ã_h·io_»ad„‘uºed ouut=%°ouutU£d=%d†’gth=%d stus=%d: % %d\n", 
ouut
, 
ouutU£d
, *
pL’gth
, 
¡©
, 
__FILE__
, 
__LINE__
);

1018  
¡©
;

1019 
	}
}

1021 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
	$pml_ÿnûl
(
HPAIO_RECORD
 *
h·io
)

1023 
ŞdStuff
 = (
h·io
->
´eD’®i
 || h·io->
äomD’®i
 || h·io->
d’®i
) ? 1 : 0;

1025 if(
h·io
->
hJob
)

1027 
	`Clo£
(
h·io
->
hJob
);

1028 
h·io
->
hJob
 = 0;

1032 if(
h·io
->
cu¼’tB©chSÿn
 =ğ
SANE_TRUE
 && h·io->
u¶ßd_¡©e
 =ğ
PML_UPLOAD_STATE_NEWPAGE
)

1033  
OK
;

1036 if(!
ŞdStuff
 || (ŞdStufà&& 
h·io
->
u¶ßd_¡©e
 !ğ
PML_UPLOAD_STATE_NEWPAGE
))

1038 
	`PmlS‘IÁeg”V®ue
(
h·io
->
pml
.
objU¶ßdS‹
, 
PML_TYPE_ENUMERATION
, 
PML_UPLOAD_STATE_IDLE
);

1039 ià(
	`PmlReque¡S‘R‘ry
(
h·io
->
deviûid
, h·io->
cmd_chªÃlid
, h·io->
pml
.
objU¶ßdS‹
, 0, 0è!ğ
ERROR
)

1040 
	`şr_sÿn_tok’
(
h·io
);

1043 ià(
h·io
->
sÿn_chªÃlid
 >= 0)

1045 
	`hpmud_şo£_chªÃl
(
h·io
->
deviûid
, h·io->
sÿn_chªÃlid
);

1046 
h·io
->
sÿn_chªÃlid
 = -1;

1048 ià(
h·io
->
cmd_chªÃlid
 >= 0)

1050 
	`hpmud_şo£_chªÃl
(
h·io
->
deviûid
, h·io->
cmd_chªÃlid
);

1051 
h·io
->
cmd_chªÃlid
 = -1;

1052 
	`S’dSÿnEv’t
(
h·io
->
deviûuri
, 
EVENT_END_SCAN_JOB
);

1055  
OK
;

1056 
	}
}

	@scan/sane/pml.h

28 #ià!
defšed
(
_PML_H
)

29 
	#_PML_H


	)

31 
	~"§Ã.h
"

33 
	#PML_MAX_OID_VALUES
 2

	)

34 
	#PML_MAX_VALUE_LEN
 1023

	)

35 
	#PML_MAX_OID_LEN
 128

	)

36 
	#PML_MAX_DATALEN
 4096

	)

38 
	#PML_TYPE_MASK
 0xFC

	)

39 
	#PML_TYPE_OBJECT_IDENTIFIER
 0x00

	)

40 
	#PML_TYPE_ENUMERATION
 0x04

	)

41 
	#PML_TYPE_SIGNED_INTEGER
 0x08

	)

42 
	#PML_TYPE_REAL
 0x0C

	)

43 
	#PML_TYPE_STRING
 0x10

	)

44 
	#PML_TYPE_BINARY
 0x14

	)

45 
	#PML_TYPE_ERROR_CODE
 0x18

	)

46 
	#PML_TYPE_NULL_VALUE
 0x1C

	)

47 
	#PML_TYPE_COLLECTION
 0x20

	)

49 
	#PML_SYMSET_0E
 0x000E

	)

50 
	#PML_SYMSET_ISO_8859_2_LATIN_2
 0x004E

	)

51 
	#PML_SYMSET_ISO_8859_9_LATIN_5
 0x00AE

	)

52 
	#PML_SYMSET_KANA8
 0x010B

	)

53 
	#PML_SYMSET_ROMAN8
 0x0115

	)

54 
	#PML_SYMSET_ISO_8859_5_LATIN_CYRILLIC
 0x014E

	)

55 
	#PML_SYMSET_US_UNICODE
 0x024E

	)

56 
	#PML_SYMSET_UTF8_UNICODE
 0xFDE8

	)

58 
	#PML_OK
 0x00

	)

59 
	#PML_OK_END_OF_SUPPORTED_OBJECTS
 0x01

	)

60 
	#PML_OK_NEAREST_LEGAL_VALUE_SUBSTITUTED
 0x02

	)

61 
	#PML_ERROR
 0x80

	)

62 
	#PML_ERROR_UNKNOWN_REQUEST
 0x80

	)

63 
	#PML_ERROR_BUFFER_OVERFLOW
 0x81

	)

64 
	#PML_ERROR_COMMAND_EXECUTION_ERROR
 0x82

	)

65 
	#PML_ERROR_UNKNOWN_OBJECT_IDENTIFIER
 0x83

	)

66 
	#PML_ERROR_OBJECT_DOES_NOT_SUPPORT_REQUESTED_ACTION
 0x84

	)

67 
	#PML_ERROR_INVALID_OR_UNSUPPORTED_VALUE
 0x85

	)

68 
	#PML_ERROR_PAST_END_OF_SUPPORTED_OBJECTS
 0x86

	)

69 
	#PML_ERROR_ACTION_CAN_NOT_BE_PERFORMED_NOW
 0x87

	)

70 
	#PML_ERROR_SYNTAX_ERROR
 0x88

	)

72 
	sPmlV®ue_s


74 
	mty³
;

75 
	mËn
;

76 
	mv®ue
[ 
PML_MAX_VALUE_LEN
 + 1 ];

79 
PmlV®ue_s
 * 
	tPmlV®ue_t
;

84 
	sPmlObjeù_s


87 
PmlObjeù_s
 * 
	m´ev
;

88 
PmlObjeù_s
 * 
	mÃxt
;

89 
	moid
[ 
PML_MAX_OID_LEN
 + 1 ];

90 
	mšdexOfLa¡V®ue
;

91 
	mnumb”OfV®idV®ues
;

92 
PmlV®ue_s
 
	mv®ue
[ 
PML_MAX_OID_VALUES
 ];

93 
	m¡©us
;

96 
PmlObjeù_s
 * 
	tPmlObjeù_t
;

98 
	~"h·io.h
"

100 
	#PML_REQUEST_GET
 0x00

	)

101 
	#PML_REQUEST_GETNEXT
 0x01

	)

102 
	#PML_REQUEST_SET
 0x04

	)

103 
	#PML_REQUEST_TRAP_ENABLE
 0x05

	)

104 
	#PML_REQUEST_TRAP_DISABLE
 0x06

	)

105 
	#PML_REQUEST_TRAP
 0x07

	)

106 
	#PML_COMMAND_MASK
 0x7F

	)

107 
	#PML_COMMAND_REPLY
 0x80

	)

108 
	#PML_SELECT_POLL_TIMEOUT
 1

	)

109 
	#PML_UPLOAD_TIMEOUT
 45

	)

110 
	#PML_START_SCAN_WAIT_ACTIVE_MAX_RETRIES
 40

	)

111 
	#PML_START_SCAN_WAIT_ACTIVE_DELAY
 1

	)

112 
	#PML_MAX_WIDTH_INCHES
 9

	)

113 
	#PML_MAX_HEIGHT_INCHES
 15

	)

115 
	#PML_SCANNER_STATUS_UNKNOWN_ERROR
 0x01

	)

116 
	#PML_SCANNER_STATUS_INVALID_MEDIA_SIZE
 0x02

	)

117 
	#PML_SCANNER_STATUS_FEEDER_OPEN
 0x04

	)

118 
	#PML_SCANNER_STATUS_FEEDER_JAM
 0x08

	)

119 
	#PML_SCANNER_STATUS_FEEDER_EMPTY
 0x10

	)

121 
	#PML_DATA_TYPE_LINEART
 1

	)

122 
	#PML_DATA_TYPE_GRAYSCALE
 8

	)

123 
	#PML_DATA_TYPE_COLOR
 24

	)

125 
	#PML_CONTRAST_MIN
 -127

	)

126 
	#PML_CONTRAST_MAX
 127

	)

127 
	#PML_CONTRAST_DEFAULT
 0

	)

129 
	#PML_BRIGHTNESS_MIN
 -127

	)

130 
	#PML_BRIGHTNESS_MAX
 127

	)

131 
	#PML_BRIGHTNESS_DEFAULT
 0

	)

133 
	#PML_COMPRESSION_NONE
 1

	)

134 
	#PML_COMPRESSION_DEFAULT
 2

	)

135 
	#PML_COMPRESSION_MH
 3

	)

136 
	#PML_COMPRESSION_MR
 4

	)

137 
	#PML_COMPRESSION_MMR
 5

	)

138 
	#PML_COMPRESSION_JPEG
 6

	)

140 
	#PML_MODHW_ADF
 1

	)

142 
	#PML_UPLOAD_STATE_IDLE
 1

	)

143 
	#PML_UPLOAD_STATE_START
 2

	)

144 
	#PML_UPLOAD_STATE_ACTIVE
 3

	)

145 
	#PML_UPLOAD_STATE_ABORTED
 4

	)

146 
	#PML_UPLOAD_STATE_DONE
 5

	)

147 
	#PML_UPLOAD_STATE_NEWPAGE
 6

	)

149 
	#PML_UPLOAD_ERROR_SCANNER_JAM
 207

	)

150 
	#PML_UPLOAD_ERROR_MLC_CHANNEL_CLOSED
 208

	)

151 
	#PML_UPLOAD_ERROR_STOPPED_BY_HOST
 209

	)

152 
	#PML_UPLOAD_ERROR_STOP_KEY_PRESSED
 210

	)

153 
	#PML_UPLOAD_ERROR_NO_DOC_IN_ADF
 211

	)

154 
	#PML_UPLOAD_ERROR_COVER_OPEN
 213

	)

155 
	#PML_UPLOAD_ERROR_DOC_LOADED
 214

	)

156 
	#PML_UPLOAD_ERROR_DEVICE_BUSY
 216

	)

158 
	#PML_SUPPFUNC_DUPLEX
 0x00000008

	)

160 
	sPmlResŞutiÚ


162 
	mx
[4];

163 
	my
[4];

164 } 
__©Œibu‹__
(Ğ
·cked
));

166 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
PmlS‘ID
(
PmlObjeù_t
 
obj
, * 
oid
);

167 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
PmlS‘V®ue
(
PmlObjeù_t
 
obj
, 
ty³
, * 
v®ue
, 
Ën
);

168 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
PmlS‘IÁeg”V®ue
(
PmlObjeù_t
 
obj
, 
ty³
, 
v®ue
);

169 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
PmlG‘V®ue
(
PmlObjeù_t
 
obj
, * 
pTy³
, * 
bufãr
, 
maxËn
);

170 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
PmlG‘SŒšgV®ue
(
PmlObjeù_t
 
obj
, * 
pSymbŞS‘
, * 
bufãr
, 
maxËn
);

171 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
PmlG‘IÁeg”V®ue
(
PmlObjeù_t
 
obj
, * 
pTy³
, * 
pV®ue
);

172 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
PmlReque¡S‘
(
deviûid
, 
chªÃlid
, 
PmlObjeù_t
 
obj
);

173 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
PmlReque¡S‘R‘ry
(
deviûid
, 
chªÃlid
, 
PmlObjeù_t
 
obj
, 
couÁ
, 
d–ay
);

174 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
PmlReque¡G‘
(
deviûid
, 
chªÃlid
, 
PmlObjeù_t
 
obj
);

179 
	gh·ioSÿÂ”_s
;

181 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
pml_¡¬t
(
h·ioSÿÂ”_s
 *
h·io
);

182 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
pml_»ad
(
h·ioSÿÂ”_s
 *
h·io
, 
SANE_By‹
 *
d©a
, 
SANE_IÁ
 
maxL’gth
, SANE_IÁ *
pL’gth
);

183 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
pml_ÿnûl
(
h·ioSÿÂ”_s
 *
h·io
);

	@scan/sane/sane.h

16 #iâdeà
§Ã_h


17 
	#§Ã_h


	)

19 
	#SANE_CURRENT_MAJOR
 1

	)

21 
	#SANE_VERSION_CODE
(
majÜ
, 
mšÜ
, 
bud
) \

22 Ğ(((
SANE_WÜd
è(
majÜ
) & 0xff) << 24) \

23 | (((
SANE_WÜd
è(
mšÜ
) & 0xff) << 16) \

24 | (((
SANE_WÜd
è(
bud
è& 0xffffè<< 0))

	)

26 
	#SANE_VERSION_MAJOR
(
code
è((((
SANE_WÜd
)(code)è>> 24è& 0xff)

	)

27 
	#SANE_VERSION_MINOR
(
code
è((((
SANE_WÜd
)(code)è>> 16è& 0xff)

	)

28 
	#SANE_VERSION_BUILD
(
code
è((((
SANE_WÜd
)(code)è>> 0è& 0xffff)

	)

30 
	#SANE_FALSE
 0

	)

31 
	#SANE_TRUE
 1

	)

33 
	tSANE_By‹
;

34 
	tSANE_WÜd
;

35 
SANE_WÜd
 
	tSANE_BoŞ
;

36 
SANE_WÜd
 
	tSANE_IÁ
;

37 
	tSANE_Ch¬
;

38 
SANE_Ch¬
 *
	tSANE_SŒšg
;

39 cÚ¡ 
	tSANE_Ch¬
 *
	tSANE_SŒšg_CÚ¡
;

40 *
	tSANE_HªdË
;

41 
SANE_WÜd
 
	tSANE_Fixed
;

43 
	#SANE_FIXED_SCALE_SHIFT
 16

	)

44 
	#SANE_FIX
(
v
è((
SANE_WÜd
è((vè* (1 << 
SANE_FIXED_SCALE_SHIFT
)))

	)

45 
	#SANE_UNFIX
(
v
è(()(vè/ (1 << 
SANE_FIXED_SCALE_SHIFT
))

	)

49 
	mSANE_STATUS_GOOD
 = 0,

50 
	mSANE_STATUS_UNSUPPORTED
,

51 
	mSANE_STATUS_CANCELLED
,

52 
	mSANE_STATUS_DEVICE_BUSY
,

53 
	mSANE_STATUS_INVAL
,

54 
	mSANE_STATUS_EOF
,

55 
	mSANE_STATUS_JAMMED
,

56 
	mSANE_STATUS_NO_DOCS
,

57 
	mSANE_STATUS_COVER_OPEN
,

58 
	mSANE_STATUS_IO_ERROR
,

59 
	mSANE_STATUS_NO_MEM
,

60 
	mSANE_STATUS_ACCESS_DENIED
,

61 
	mSANE_STATUS_MULTIPICK


64 
	tSANE_Stus
;

68 
	mSANE_TYPE_BOOL
 = 0,

69 
	mSANE_TYPE_INT
,

70 
	mSANE_TYPE_FIXED
,

71 
	mSANE_TYPE_STRING
,

72 
	mSANE_TYPE_BUTTON
,

73 
	mSANE_TYPE_GROUP


75 
	tSANE_V®ue_Ty³
;

79 
	mSANE_UNIT_NONE
 = 0,

80 
	mSANE_UNIT_PIXEL
,

81 
	mSANE_UNIT_BIT
,

82 
	mSANE_UNIT_MM
,

83 
	mSANE_UNIT_DPI
,

84 
	mSANE_UNIT_PERCENT
,

85 
	mSANE_UNIT_MICROSECOND


87 
	tSANE_Un™
;

91 
SANE_SŒšg_CÚ¡
 
	mÇme
;

92 
SANE_SŒšg_CÚ¡
 
	mv’dÜ
;

93 
SANE_SŒšg_CÚ¡
 
	mmod–
;

94 
SANE_SŒšg_CÚ¡
 
	mty³
;

96 
	tSANE_Deviû
;

98 
	#SANE_CAP_SOFT_SELECT
 (1 << 0)

	)

99 
	#SANE_CAP_HARD_SELECT
 (1 << 1)

	)

100 
	#SANE_CAP_SOFT_DETECT
 (1 << 2)

	)

101 
	#SANE_CAP_EMULATED
 (1 << 3)

	)

102 
	#SANE_CAP_AUTOMATIC
 (1 << 4)

	)

103 
	#SANE_CAP_INACTIVE
 (1 << 5)

	)

104 
	#SANE_CAP_ADVANCED
 (1 << 6)

	)

105 
	#SANE_CAP_ALWAYS_SETTABLE
 (1 << 7)

	)

107 
	#SANE_OPTION_IS_ACTIVE
(
ÿp
è(((ÿpè& 
SANE_CAP_INACTIVE
è=ğ0)

	)

108 
	#SANE_OPTION_IS_SETTABLE
(
ÿp
è(((ÿpè& 
SANE_CAP_SOFT_SELECT
è!ğ0)

	)

110 
	#SANE_INFO_INEXACT
 (1 << 0)

	)

111 
	#SANE_INFO_RELOAD_OPTIONS
 (1 << 1)

	)

112 
	#SANE_INFO_RELOAD_PARAMS
 (1 << 2)

	)

116 
	mSANE_CONSTRAINT_NONE
 = 0,

117 
	mSANE_CONSTRAINT_RANGE
,

118 
	mSANE_CONSTRAINT_WORD_LIST
,

119 
	mSANE_CONSTRAINT_STRING_LIST


121 
	tSANE_CÚ¡¿št_Ty³
;

125 
SANE_WÜd
 
	mmš
;

126 
SANE_WÜd
 
	mmax
;

127 
SANE_WÜd
 
	mquªt
;

129 
	tSANE_Rªge
;

133 
SANE_SŒšg_CÚ¡
 
	mÇme
;

134 
SANE_SŒšg_CÚ¡
 
	mt™Ë
;

135 
SANE_SŒšg_CÚ¡
 
	mdesc
;

136 
SANE_V®ue_Ty³
 
	mty³
;

137 
SANE_Un™
 
	mun™
;

138 
SANE_IÁ
 
	msize
;

139 
SANE_IÁ
 
	mÿp
;

141 
SANE_CÚ¡¿št_Ty³
 
	mcÚ¡¿št_ty³
;

144 cÚ¡ 
SANE_SŒšg_CÚ¡
 *
	m¡ršg_li¡
;

145 cÚ¡ 
SANE_WÜd
 *
	mwÜd_li¡
;

146 cÚ¡ 
SANE_Rªge
 *
	m¿nge
;

148 
	mcÚ¡¿št
;

150 
	tSANE_O±iÚ_DesütÜ
;

154 
	mSANE_ACTION_GET_VALUE
 = 0,

155 
	mSANE_ACTION_SET_VALUE
,

156 
	mSANE_ACTION_SET_AUTO


158 
	tSANE_AùiÚ
;

162 
	mSANE_FRAME_GRAY
,

163 
	mSANE_FRAME_RGB
,

164 
	mSANE_FRAME_RED
,

165 
	mSANE_FRAME_GREEN
,

166 
	mSANE_FRAME_BLUE


168 
	tSANE_F¿me
;

172 
SANE_F¿me
 
	mfÜm©
;

173 
SANE_BoŞ
 
	mÏ¡_äame
;

174 
SANE_IÁ
 
	mby‹s_³r_lše
;

175 
SANE_IÁ
 
	mpix–s_³r_lše
;

176 
SANE_IÁ
 
	mlšes
;

177 
SANE_IÁ
 
	md•th
;

179 
	tSANE_P¬am‘”s
;

181 
	gSANE_Auth_D©a
;

183 
	#SANE_MAX_USERNAME_LEN
 128

	)

184 
	#SANE_MAX_PASSWORD_LEN
 128

	)

186 (*
	tSANE_Auth_C®lback
è(
	tSANE_SŒšg_CÚ¡
 
	t»sourû
,

187 
	tSANE_Ch¬
 
	tu£ºame
[
SANE_MAX_USERNAME_LEN
],

188 
	tSANE_Ch¬
 
	t·sswÜd
[
SANE_MAX_PASSWORD_LEN
]);

190 
SANE_Stus
 
	`§Ã_š™
 (
SANE_IÁ
 * 
v”siÚ_code
,

191 
SANE_Auth_C®lback
 
authÜize
);

192 
	`§Ã_ex™
 ();

193 
SANE_Stus
 
	`§Ã_g‘_deviûs
 (cÚ¡ 
SANE_Deviû
 *** 
deviû_li¡
,

194 
SANE_BoŞ
 
loÿl_Úly
);

195 
SANE_Stus
 
	`§Ã_İ’
 (
SANE_SŒšg_CÚ¡
 
deviûÇme
,

196 
SANE_HªdË
 * 
hªdË
);

197 
	`§Ã_şo£
 (
SANE_HªdË
 
hªdË
);

198 cÚ¡ 
SANE_O±iÚ_DesütÜ
 *

199 
	`§Ã_g‘_İtiÚ_desütÜ
 (
SANE_HªdË
 
hªdË
, 
SANE_IÁ
 
İtiÚ
);

200 
SANE_Stus
 
	`§Ã_cÚŒŞ_İtiÚ
 (
SANE_HªdË
 
hªdË
, 
SANE_IÁ
 
İtiÚ
,

201 
SANE_AùiÚ
 
aùiÚ
, *
v®ue
,

202 
SANE_IÁ
 * 
šfo
);

203 
SANE_Stus
 
	`§Ã_g‘_·¿m‘”s
 (
SANE_HªdË
 
hªdË
,

204 
SANE_P¬am‘”s
 * 
·¿ms
);

205 
SANE_Stus
 
	`§Ã_¡¬t
 (
SANE_HªdË
 
hªdË
);

206 
SANE_Stus
 
	`§Ã_»ad
 (
SANE_HªdË
 
hªdË
, 
SANE_By‹
 * 
d©a
,

207 
SANE_IÁ
 
max_Ëngth
, SANE_IÁ * 
Ëngth
);

208 
	`§Ã_ÿnûl
 (
SANE_HªdË
 
hªdË
);

209 
SANE_Stus
 
	`§Ã_£t_io_mode
 (
SANE_HªdË
 
hªdË
,

210 
SANE_BoŞ
 
nÚ_blockšg
);

211 
SANE_Stus
 
	`§Ã_g‘_£Ëù_fd
 (
SANE_HªdË
 
hªdË
,

212 
SANE_IÁ
 * 
fd
);

213 
SANE_SŒšg_CÚ¡
 
	`§Ã_¡r¡©us
 (
SANE_Stus
 
¡©us
);

	@scan/sane/sanei.h

86 #iâdeà
§Ãi_h


87 
	#§Ãi_h


	)

89 
	~"§Ã.h
"

151 
	#NELEMS
(
a
è(()( (aè/  (a[0])))

	)

154 
	#STRINGIFY1
(
x
è#x

	)

156 
	#STRINGIFY
(
x
è
	`STRINGIFY1
(x)

	)

159 
	#PASTE1
(
x
,
y
èx##
	)
y

161 
	#PASTE
(
x
,
y
è
	`PASTE1
(x,y)

	)

163 
SANE_Stus
 
§Ãi_check_v®ue
 (cÚ¡ 
SANE_O±iÚ_DesütÜ
 * 
İt
,

164 * 
v®ue
);

166 
SANE_Stus
 
§Ãi_cÚ¡¿š_v®ue
 (cÚ¡ 
SANE_O±iÚ_DesütÜ
 * 
İt
,

167 * 
v®ue
, 
SANE_WÜd
 * 
šfo
);

	@scan/sane/sanei_debug.h

7 #iâdeà
_SANEI_DEBUG_H


8 
	#_SANEI_DEBUG_H


	)

10 
	~"§Ãi.h
"

93 
	#ENTRY
(
Çme
è
	`PASTE
(PASTE(PASTE(
§Ã_
,
BACKEND_NAME
),
_
),Çme)

	)

95 #ifdeà
NDEBUG


97 
§Ãi_debug_ndebug
 (
Ëv–
, cÚ¡ *
msg
, ...);

99 
	#DBG_LEVEL
 (0)

	)

100 
	#DBG_INIT
()

	)

101 
	#DBG
 
§Ãi_debug_ndebug


	)

102 
	#IF_DBG
(
x
)

	)

107 
	#DBG_LEVEL
 
	`PASTE
(
§Ãi_debug_
,
BACKEND_NAME
)

	)

109 #ià
defšed
(
BACKEND_NAME
è&& !defšed(
STUBS
)

110 #ifdeà
DEBUG_DECLARE_ONLY


111 
DBG_LEVEL
;

113 
	gDBG_LEVEL
 = 0;

118 
	#DBG_INIT
() \

119 
	`§Ãi_š™_debug
 (
	`STRINGIFY
(
BACKEND_NAME
), &
DBG_LEVEL
)

	)

122 
	#DBG_LOCAL
 
	`PASTE
(
DBG_LEVEL
,
_ÿÎ
)

	)

125 #iâdeà
STUBS


127 #ifdeà
DEBUG_DECLARE_ONLY


129 
	$DBG_LOCAL
 (
Ëv–
, cÚ¡ *
msg
, ...)

130 #ifdeà
__GNUC__


131 
	`__©Œibu‹__
 ((
	$fÜm©
 (
´štf
, 2, 3)))

137 
	~<¡d¬g.h
>

139 
§Ãi_debug_msg


140 (
Ëv–
, 
max_Ëv–
, cÚ¡ *
be
, cÚ¡ *
fmt
, 
va_li¡
 
­
);

142 #ifdeà
__GNUC__


143 #iâdeà
DEBUG_NOT_STATIC


146 
	$DBG_LOCAL
 (
Ëv–
, cÚ¡ *
msg
, ...è
	`__©Œibu‹__
 ((
	`fÜm©
 (
´štf
, 2, 3)));

149 #iâdeà
DEBUG_NOT_STATIC


153 
	$DBG_LOCAL
 (
Ëv–
, cÚ¡ *
msg
, ...)

155 
va_li¡
 
­
;

157 
	`va_¡¬t
 (
­
, 
msg
);

158 
	`§Ãi_debug_msg
 (
Ëv–
, 
DBG_LEVEL
, 
	`STRINGIFY
(
BACKEND_NAME
), 
msg
, 
­
);

159 
	`va_’d
 (
­
);

160 
	}
}

167 
	#DBG
 
DBG_LOCAL


	)

169 
§Ãi_š™_debug
 (cÚ¡ * 
back’d
, * 
debug_Ëv–_v¬
);

172 
	#IF_DBG
(
x
è
	)
x

	@scan/sane/sanei_init_debug.c

43 
	~<ùy³.h
>

44 
	~<¡dio.h
>

45 
	~<¡dlib.h
>

46 #ifdeà
HAVE_UNISTD_H


47 
	~<uni¡d.h
>

49 
	~<¡ršg.h
>

50 
	~<¡d¬g.h
>

51 
	~<sy¦og.h
>

52 #ifdeà
HAVE_OS2_H


53 
	~<sys/ty³s.h
>

55 
	~<sys/¡©.h
>

57 #ifdeà
HAVE_OS2_H


58 
	#INCL_DOS


	)

59 
	~<os2.h
>

62 
	#BACKEND_NAME
 
§Ãi_debug


	)

63 
	~"§Ãi_debug.h
"

66 
	$§Ãi_š™_debug
 (cÚ¡ * 
back’d
, * 
v¬
)

68 
ch
, 
buf
[256] = "SANE_DEBUG_";

69 cÚ¡ * 
v®
;

70 
i
;

72 *
v¬
 = 0;

74 
i
 = 11; (
ch
 = 
back’d
[i - 11]) != 0; ++i)

76 ià(
i
 >ğ (
buf
) - 1)

78 
buf
[
i
] = 
	`touµ”
(
ch
);

80 
buf
[
i
] = '\0';

82 
v®
 = 
	`g‘’v
 (
buf
);

84 ià(!
v®
)

87 *
v¬
 = 
	`©oi
 (
v®
);

89 
	`DBG
 (0, "S‘tšg debug†ev– oà% tØ%d.\n", 
back’d
, *
v¬
);

90 
	}
}

93 
	g§Ãi_debug_msg


94 (
	gËv–
, 
	gmax_Ëv–
, cÚ¡ *
	gbe
, cÚ¡ *
	gfmt
, 
va_li¡
 
	g­
)

96 ià(
	gmax_Ëv–
 >ğ
Ëv–
)

98 
årštf
 (
¡d”r
, "[%s] ", 
be
);

99 
vårštf
 (
¡d”r
, 
fmt
, 
­
);

103 #ifdeà
NDEBUG


105 
	$§Ãi_debug_ndebug
 (
Ëv–
, cÚ¡ *
fmt
, ...)

108 
	}
}

	@scan/sane/saneopts.h

53 #iâdeà
§Ãİts_h


54 
	#§Ãİts_h


	)

56 #iâdeà
SANE_I18N


57 
	#SANE_I18N
(
‹xt
è
	)
text

61 
	#SANE_NAME_NUM_OPTIONS
 ""

	)

62 
	#SANE_NAME_PREVIEW
 "´ev›w"

	)

63 
	#SANE_NAME_GRAY_PREVIEW
 "´ev›w-š-g¿y"

	)

64 
	#SANE_NAME_BIT_DEPTH
 "d•th"

	)

65 
	#SANE_NAME_SCAN_MODE
 "mode"

	)

66 
	#SANE_NAME_SCAN_SPEED
 "¥“d"

	)

67 
	#SANE_NAME_SCAN_SOURCE
 "sourû"

	)

68 
	#SANE_NAME_BACKTRACK
 "backŒack"

	)

74 
	#SANE_NAME_SCAN_TL_X
 "-x"

	)

75 
	#SANE_NAME_SCAN_TL_Y
 "-y"

	)

76 
	#SANE_NAME_SCAN_BR_X
 "br-x"

	)

77 
	#SANE_NAME_SCAN_BR_Y
 "br-y"

	)

78 
	#SANE_NAME_SCAN_RESOLUTION
 "»sŞutiÚ"

	)

79 
	#SANE_NAME_SCAN_X_RESOLUTION
 "»sŞutiÚ"

	)

80 
	#SANE_NAME_SCAN_Y_RESOLUTION
 "y-»sŞutiÚ"

	)

81 
	#SANE_NAME_CUSTOM_GAMMA
 "cu¡om-gamma"

	)

82 
	#SANE_NAME_GAMMA_VECTOR
 "gamma-bË"

	)

83 
	#SANE_NAME_GAMMA_VECTOR_R
 "»d-gamma-bË"

	)

84 
	#SANE_NAME_GAMMA_VECTOR_G
 "g»’-gamma-bË"

	)

85 
	#SANE_NAME_GAMMA_VECTOR_B
 "blue-gamma-bË"

	)

86 
	#SANE_NAME_BRIGHTNESS
 "brighŠess"

	)

87 
	#SANE_NAME_CONTRAST
 "cÚŒa¡"

	)

88 
	#SANE_NAME_GRAIN_SIZE
 "g¿š"

	)

89 
	#SANE_NAME_HALFTONE
 "h®áÚšg"

	)

90 
	#SANE_NAME_BLACK_LEVEL
 "bÏck-Ëv–"

	)

91 
	#SANE_NAME_WHITE_LEVEL
 "wh™e-Ëv–"

	)

92 
	#SANE_NAME_WHITE_LEVEL_R
 "wh™e-Ëv–-r"

	)

93 
	#SANE_NAME_WHITE_LEVEL_G
 "wh™e-Ëv–-g"

	)

94 
	#SANE_NAME_WHITE_LEVEL_B
 "wh™e-Ëv–-b"

	)

95 
	#SANE_NAME_SHADOW
 "shadow"

	)

96 
	#SANE_NAME_SHADOW_R
 "shadow-r"

	)

97 
	#SANE_NAME_SHADOW_G
 "shadow-g"

	)

98 
	#SANE_NAME_SHADOW_B
 "shadow-b"

	)

99 
	#SANE_NAME_HIGHLIGHT
 "highlight"

	)

100 
	#SANE_NAME_HIGHLIGHT_R
 "highlight-r"

	)

101 
	#SANE_NAME_HIGHLIGHT_G
 "highlight-g"

	)

102 
	#SANE_NAME_HIGHLIGHT_B
 "highlight-b"

	)

103 
	#SANE_NAME_HUE
 "hue"

	)

104 
	#SANE_NAME_SATURATION
 "§tu¿tiÚ"

	)

105 
	#SANE_NAME_FILE
 "f’ame"

	)

106 
	#SANE_NAME_HALFTONE_DIMENSION
 "h®áÚe-size"

	)

107 
	#SANE_NAME_HALFTONE_PATTERN
 "h®áÚe-·‰”n"

	)

108 
	#SANE_NAME_RESOLUTION_BIND
 "»sŞutiÚ-bšd"

	)

109 
	#SANE_NAME_NEGATIVE
 "Ãg©ive"

	)

110 
	#SANE_NAME_QUALITY_CAL
 "qu®™y-ÿl"

	)

111 
	#SANE_NAME_DOR
 "doubË-»s"

	)

112 
	#SANE_NAME_RGB_BIND
 "rgb-bšd"

	)

113 
	#SANE_NAME_THRESHOLD
 "th»shŞd"

	)

114 
	#SANE_NAME_ANALOG_GAMMA
 "ª®og-gamma"

	)

115 
	#SANE_NAME_ANALOG_GAMMA_R
 "ª®og-gamma-r"

	)

116 
	#SANE_NAME_ANALOG_GAMMA_G
 "ª®og-gamma-g"

	)

117 
	#SANE_NAME_ANALOG_GAMMA_B
 "ª®og-gamma-b"

	)

118 
	#SANE_NAME_ANALOG_GAMMA_BIND
 "ª®og-gamma-bšd"

	)

119 
	#SANE_NAME_WARMUP
 "w¬mup"

	)

120 
	#SANE_NAME_CAL_EXPOS_TIME
 "ÿl-exposu»-time"

	)

121 
	#SANE_NAME_CAL_EXPOS_TIME_R
 "ÿl-exposu»-time-r"

	)

122 
	#SANE_NAME_CAL_EXPOS_TIME_G
 "ÿl-exposu»-time-g"

	)

123 
	#SANE_NAME_CAL_EXPOS_TIME_B
 "ÿl-exposu»-time-b"

	)

124 
	#SANE_NAME_SCAN_EXPOS_TIME
 "sÿn-exposu»-time"

	)

125 
	#SANE_NAME_SCAN_EXPOS_TIME_R
 "sÿn-exposu»-time-r"

	)

126 
	#SANE_NAME_SCAN_EXPOS_TIME_G
 "sÿn-exposu»-time-g"

	)

127 
	#SANE_NAME_SCAN_EXPOS_TIME_B
 "sÿn-exposu»-time-b"

	)

128 
	#SANE_NAME_SELECT_EXPOSURE_TIME
 "£Ëù-exposu»-time"

	)

129 
	#SANE_NAME_CAL_LAMP_DEN
 "ÿl-Ïmp-d’s™y"

	)

130 
	#SANE_NAME_SCAN_LAMP_DEN
 "sÿn-Ïmp-d’s™y"

	)

131 
	#SANE_NAME_SELECT_LAMP_DENSITY
 "£Ëù-Ïmp-d’s™y"

	)

132 
	#SANE_NAME_LAMP_OFF_AT_EXIT
 "Ïmp-off-©-ex™"

	)

134 
	#SANE_NAME_MULTIPICK
 "muÉi-pick"

	)

135 
	#SANE_TITLE_MULTIPICK
 
	`SANE_I18N
("MuÉ˜pick")

	)

136 
	#SANE_DESC_MULTIPICK
 
	`SANE_I18N
("S–eù muÉick o±iÚ fÜ ESCL…rÙoÿÈba£d deviûs")

	)

138 
	#SANE_TITLE_NUM_OPTIONS
 
	`SANE_I18N
("Numb” oàİtiÚs")

	)

139 
	#SANE_TITLE_PREVIEW
 
	`SANE_I18N
("P»v›w")

	)

140 
	#SANE_TITLE_GRAY_PREVIEW
 
	`SANE_I18N
("FÜû mÚochrom´ev›w")

	)

141 
	#SANE_TITLE_BIT_DEPTH
 
	`SANE_I18N
("B™ d•th")

	)

142 
	#SANE_TITLE_SCAN_MODE
 
	`SANE_I18N
("SÿÀmode")

	)

143 
	#SANE_TITLE_SCAN_SPEED
 
	`SANE_I18N
("SÿÀ¥“d")

	)

144 
	#SANE_TITLE_SCAN_SOURCE
 
	`SANE_I18N
("SÿÀsourû")

	)

145 
	#SANE_TITLE_BACKTRACK
 
	`SANE_I18N
("FÜû backŒackšg")

	)

146 
	#SANE_TITLE_SCAN_TL_X
 
	`SANE_I18N
("Tİ-Ëá x")

	)

147 
	#SANE_TITLE_SCAN_TL_Y
 
	`SANE_I18N
("Tİ-Ëá y")

	)

148 
	#SANE_TITLE_SCAN_BR_X
 
	`SANE_I18N
("BÙtom-righˆx")

	)

149 
	#SANE_TITLE_SCAN_BR_Y
 
	`SANE_I18N
("BÙtom-righˆy")

	)

150 
	#SANE_TITLE_SCAN_RESOLUTION
 
	`SANE_I18N
("SÿÀ»sŞutiÚ")

	)

151 
	#SANE_TITLE_SCAN_X_RESOLUTION
 
	`SANE_I18N
("X-»sŞutiÚ")

	)

152 
	#SANE_TITLE_SCAN_Y_RESOLUTION
 
	`SANE_I18N
("Y-»sŞutiÚ")

	)

153 
	#SANE_TITLE_CUSTOM_GAMMA
 
	`SANE_I18N
("U£ cu¡om gamm¨bË")

	)

154 
	#SANE_TITLE_GAMMA_VECTOR
 
	`SANE_I18N
("Imagš‹ns™y")

	)

155 
	#SANE_TITLE_GAMMA_VECTOR_R
 
	`SANE_I18N
("Red iÁ’s™y")

	)

156 
	#SANE_TITLE_GAMMA_VECTOR_G
 
	`SANE_I18N
("G»’ iÁ’s™y")

	)

157 
	#SANE_TITLE_GAMMA_VECTOR_B
 
	`SANE_I18N
("Bluš‹ns™y")

	)

158 
	#SANE_TITLE_BRIGHTNESS
 
	`SANE_I18N
("BrighŠess")

	)

159 
	#SANE_TITLE_CONTRAST
 
	`SANE_I18N
("CÚŒa¡")

	)

160 
	#SANE_TITLE_GRAIN_SIZE
 
	`SANE_I18N
("G¿š size")

	)

161 
	#SANE_TITLE_HALFTONE
 
	`SANE_I18N
("H®áÚšg")

	)

162 
	#SANE_TITLE_BLACK_LEVEL
 
	`SANE_I18N
("BÏck†ev–")

	)

163 
	#SANE_TITLE_WHITE_LEVEL
 
	`SANE_I18N
("Wh™Ëv–")

	)

164 
	#SANE_TITLE_WHITE_LEVEL_R
 
	`SANE_I18N
("Wh™Ëv– fÜ„ed")

	)

165 
	#SANE_TITLE_WHITE_LEVEL_G
 
	`SANE_I18N
("Wh™Ëv– fÜ g»’")

	)

166 
	#SANE_TITLE_WHITE_LEVEL_B
 
	`SANE_I18N
("Wh™Ëv– fÜ blue")

	)

167 
	#SANE_TITLE_SHADOW
 
	`SANE_I18N
("Shadow")

	)

168 
	#SANE_TITLE_SHADOW_R
 
	`SANE_I18N
("Shadow fÜ„ed")

	)

169 
	#SANE_TITLE_SHADOW_G
 
	`SANE_I18N
("Shadow fÜ g»’")

	)

170 
	#SANE_TITLE_SHADOW_B
 
	`SANE_I18N
("Shadow fÜ blue")

	)

171 
	#SANE_TITLE_HIGHLIGHT
 
	`SANE_I18N
("Highlight")

	)

172 
	#SANE_TITLE_HIGHLIGHT_R
 
	`SANE_I18N
("HighlighˆfÜ„ed")

	)

173 
	#SANE_TITLE_HIGHLIGHT_G
 
	`SANE_I18N
("HighlighˆfÜ g»’")

	)

174 
	#SANE_TITLE_HIGHLIGHT_B
 
	`SANE_I18N
("HighlighˆfÜ blue")

	)

175 
	#SANE_TITLE_HUE
 
	`SANE_I18N
("Hue")

	)

176 
	#SANE_TITLE_SATURATION
 
	`SANE_I18N
("S©u¿tiÚ")

	)

177 
	#SANE_TITLE_FILE
 
	`SANE_I18N
("F’ame")

	)

178 
	#SANE_TITLE_HALFTONE_DIMENSION
 
	`SANE_I18N
("H®áÚ·‰”Àsize")

	)

179 
	#SANE_TITLE_HALFTONE_PATTERN
 
	`SANE_I18N
("H®áÚ·‰”n")

	)

180 
	#SANE_TITLE_RESOLUTION_BIND
 
	`SANE_I18N
("Bšd X‡nd Y„esŞutiÚ")

	)

181 
	#SANE_TITLE_NEGATIVE
 
	`SANE_I18N
("Neg©ive")

	)

182 
	#SANE_TITLE_QUALITY_CAL
 
	`SANE_I18N
("Qu®™y c®ib¿tiÚ")

	)

183 
	#SANE_TITLE_DOR
 
	`SANE_I18N
("DoubË O±iÿÈResŞutiÚ")

	)

184 
	#SANE_TITLE_RGB_BIND
 
	`SANE_I18N
("Bšd RGB")

	)

185 
	#SANE_TITLE_THRESHOLD
 
	`SANE_I18N
("Th»shŞd")

	)

186 
	#SANE_TITLE_ANALOG_GAMMA
 
	`SANE_I18N
("AÇlog gamm¨cÜ»ùiÚ")

	)

187 
	#SANE_TITLE_ANALOG_GAMMA_R
 
	`SANE_I18N
("AÇlog gamm¨»d")

	)

188 
	#SANE_TITLE_ANALOG_GAMMA_G
 
	`SANE_I18N
("AÇlog gamm¨g»’")

	)

189 
	#SANE_TITLE_ANALOG_GAMMA_B
 
	`SANE_I18N
("AÇlog gamm¨blue")

	)

190 
	#SANE_TITLE_ANALOG_GAMMA_BIND
 
	`SANE_I18N
("Bšd‡Çlog gamma")

	)

191 
	#SANE_TITLE_WARMUP
 
	`SANE_I18N
("W¬mu°Ïmp")

	)

192 
	#SANE_TITLE_CAL_EXPOS_TIME
 
	`SANE_I18N
("C®.ƒxposu»-time")

	)

193 
	#SANE_TITLE_CAL_EXPOS_TIME_R
 
	`SANE_I18N
("C®.ƒxposu»-timfÜ„ed")

	)

194 
	#SANE_TITLE_CAL_EXPOS_TIME_G
 
	`SANE_I18N
("Cal.ƒxposure-time for " \

195 "g»’")

	)

196 
	#SANE_TITLE_CAL_EXPOS_TIME_B
 
	`SANE_I18N
("C®.ƒxposu»-timfÜ blue")

	)

197 
	#SANE_TITLE_SCAN_EXPOS_TIME
 
	`SANE_I18N
("SÿÀexposu»-time")

	)

198 
	#SANE_TITLE_SCAN_EXPOS_TIME_R
 
	`SANE_I18N
("SÿÀexposu»-timfÜ„ed")

	)

199 
	#SANE_TITLE_SCAN_EXPOS_TIME_G
 
	`SANE_I18N
("Scanƒxposure-time for " \

200 "g»’")

	)

201 
	#SANE_TITLE_SCAN_EXPOS_TIME_B
 
	`SANE_I18N
("SÿÀexposu»-timfÜ blue")

	)

202 
	#SANE_TITLE_SELECT_EXPOSURE_TIME
 
	`SANE_I18N
("S‘ƒxposu»-time")

	)

203 
	#SANE_TITLE_CAL_LAMP_DEN
 
	`SANE_I18N
("C®.†am°d’s™y")

	)

204 
	#SANE_TITLE_SCAN_LAMP_DEN
 
	`SANE_I18N
("SÿÀÏm°d’s™y")

	)

205 
	#SANE_TITLE_SELECT_LAMP_DENSITY
 
	`SANE_I18N
("S‘†am°d’s™y")

	)

206 
	#SANE_TITLE_LAMP_OFF_AT_EXIT
 
	`SANE_I18N
("Lam°ofà©ƒx™")

	)

209 
	#SANE_DESC_NUM_OPTIONS
 \

210 
	`SANE_I18N
("Read-only optionhat specifies how many options‡ specific " \

211 "deviû suµÜts.")

	)

213 
	#SANE_DESC_PREVIEW
 \

214 
	`SANE_I18N
("Reque¡‡…»v›w-qu®™y sÿn.")

	)

216 
	#SANE_DESC_GRAY_PREVIEW
 \

217 
	`SANE_I18N
("Requesthat‡ll…reviews‡re done in monochrome mode. On‡ " \

220 "´ev›w.")

	)

222 
	#SANE_DESC_BIT_DEPTH
 \

223 
	`SANE_I18N
("Number of bits…er sample,ypical values‡re 1 for \"line-art\" " \

224 "ªd 8 fÜ muÉib™ sÿns.")

	)

226 
	#SANE_DESC_SCAN_MODE
 \

227 
	`SANE_I18N
("S–eù thsÿÀmodÓ.g.,†š—¹, mÚochrome, o¸cŞÜ).")

	)

229 
	#SANE_DESC_SCAN_SPEED
 \

230 
	`SANE_I18N
("D‘”mše th¥“d‡ˆwhichhsÿÀ´oûeds.")

	)

232 
	#SANE_DESC_SCAN_SOURCE
 \

233 
	`SANE_I18N
("S–eù thsÿÀsourû (such‡ ¨docum’t-ãed”).")

	)

235 
	#SANE_DESC_BACKTRACK
 \

236 
	`SANE_I18N
("CÚŒŞ wh‘h” backŒackšg i fÜûd.")

	)

238 
	#SANE_DESC_SCAN_TL_X
 \

239 
	`SANE_I18N
("Tİ-Ëá x…os™iÚ oàsÿÀ¬—.")

	)

241 
	#SANE_DESC_SCAN_TL_Y
 \

242 
	`SANE_I18N
("Tİ-Ëá y…os™iÚ oàsÿÀ¬—.")

	)

244 
	#SANE_DESC_SCAN_BR_X
 \

245 
	`SANE_I18N
("BÙtom-righˆx…os™iÚ oàsÿÀ¬—.")

	)

247 
	#SANE_DESC_SCAN_BR_Y
 \

248 
	`SANE_I18N
("BÙtom-righˆy…os™iÚ oàsÿÀ¬—.")

	)

250 
	#SANE_DESC_SCAN_RESOLUTION
 \

251 
	`SANE_I18N
("S‘ th»sŞutiÚ oàthsÿÂed image.")

	)

253 
	#SANE_DESC_SCAN_X_RESOLUTION
 \

254 
	`SANE_I18N
("S‘ thhÜizÚÈ»sŞutiÚ oàthsÿÂed image.")

	)

256 
	#SANE_DESC_SCAN_Y_RESOLUTION
 \

257 
	`SANE_I18N
("S‘ thv”tiÿÈ»sŞutiÚ oàthsÿÂed image.")

	)

259 
	#SANE_DESC_CUSTOM_GAMMA
 \

260 
	`SANE_I18N
("Determines whether‡ builtin or‡ custom gamma-table should be " \

261 "u£d.")

	)

263 
	#SANE_DESC_GAMMA_VECTOR
 \

264 
	`SANE_I18N
("Gamma-correctionable. In color modehis optionƒqually " \

266 "š‹ns™y gamm¨bË).")

	)

268 
	#SANE_DESC_GAMMA_VECTOR_R
 \

269 
	`SANE_I18N
("Gamma-cÜ»ùiÚabË fÜh»d bªd.")

	)

271 
	#SANE_DESC_GAMMA_VECTOR_G
 \

272 
	`SANE_I18N
("Gamma-cÜ»ùiÚabË fÜhg»’ bªd.")

	)

274 
	#SANE_DESC_GAMMA_VECTOR_B
 \

275 
	`SANE_I18N
("Gamma-cÜ»ùiÚabË fÜhblubªd.")

	)

277 
	#SANE_DESC_BRIGHTNESS
 \

278 
	`SANE_I18N
("CÚŒŞ thbrighŠes oàthacquœed image.")

	)

280 
	#SANE_DESC_CONTRAST
 \

281 
	`SANE_I18N
("CÚŒŞ thcÚŒa¡ oàthacquœed image.")

	)

283 
	#SANE_DESC_GRAIN_SIZE
 \

284 
	`SANE_I18N
("Selectshe \"graininess\" ofhe‡cquired image. Smaller values " \

285 "»suÉ iÀsh¬³¸images.")

	)

287 
	#SANE_DESC_HALFTONE
 \

288 
	`SANE_I18N
("S–eù wh‘h”hacquœed imagshould bh®áÚed (d™h”ed).")

	)

290 
	#SANE_DESC_BLACK_LEVEL
 \

291 
	`SANE_I18N
("S–eù wh©„adŸnû†ev– should bcÚsid”ed \"bÏck\".")

	)

293 
	#SANE_DESC_WHITE_LEVEL
 \

294 
	`SANE_I18N
("S–eù wh©„adŸnû†ev– should bcÚsid”ed \"wh™e\".")

	)

296 
	#SANE_DESC_WHITE_LEVEL_R
 \

297 
	`SANE_I18N
("S–eù wh©„ed„adŸnû†ev– should bcÚsid”ed \"wh™e\".")

	)

299 
	#SANE_DESC_WHITE_LEVEL_G
 \

300 
	`SANE_I18N
("S–eù wh© g»’„adŸnû†ev– should bcÚsid”ed \"wh™e\".")

	)

302 
	#SANE_DESC_WHITE_LEVEL_B
 \

303 
	`SANE_I18N
("S–eù wh© blu¿dŸnû†ev– should bcÚsid”ed \"wh™e\".")

	)

305 
	#SANE_DESC_SHADOW
 \

306 
	`SANE_I18N
("S–eù wh©„adŸnû†ev– should bcÚsid”ed \"bÏck\".")

	)

307 
	#SANE_DESC_SHADOW_R
 \

308 
	`SANE_I18N
("S–eù wh©„ed„adŸnû†ev– should bcÚsid”ed \"bÏck\".")

	)

309 
	#SANE_DESC_SHADOW_G
 \

310 
	`SANE_I18N
("S–eù wh© g»’„adŸnû†ev– should bcÚsid”ed \"bÏck\".")

	)

311 
	#SANE_DESC_SHADOW_B
 \

312 
	`SANE_I18N
("S–eù wh© blu¿dŸnû†ev– should bcÚsid”ed \"bÏck\".")

	)

314 
	#SANE_DESC_HIGHLIGHT
 \

315 
	`SANE_I18N
("S–eù wh©„adŸnû†ev– should bcÚsid”ed \"wh™e\".")

	)

316 
	#SANE_DESC_HIGHLIGHT_R
 \

317 
	`SANE_I18N
("S–eù wh©„ed„adŸnû†ev– should bcÚsid”ed \"fuÎ„ed\".")

	)

318 
	#SANE_DESC_HIGHLIGHT_G
 \

319 
	`SANE_I18N
("Selects what green„adiance†evel should be considered \"full " \

320 "g»’\".")

	)

321 
	#SANE_DESC_HIGHLIGHT_B
 \

322 
	`SANE_I18N
("Selects what blue„adiance†evel should be considered \"full " \

323 "blue\".")

	)

325 
	#SANE_DESC_HUE
 \

326 
	`SANE_I18N
("CÚŒŞ th\"hue\" (blue-Ëv–èoàthacquœed image.")

	)

328 
	#SANE_DESC_SATURATION
 \

329 
	`SANE_I18N
("The saturation†evel controlshe‡mount of \"blooming\"hat " \

331 "bloomšg.")

	)

333 
	#SANE_DESC_FILE
 \

334 
	`SANE_I18N
("Thf’amoàthimagtØblßded.")

	)

336 
	#SANE_DESC_HALFTONE_DIMENSION
 \

337 
	`SANE_I18N
("Setshe size ofhe halftoning (dithering)…attern used when " \

338 "sÿÂšg h®áÚed images.")

	)

340 
	#SANE_DESC_HALFTONE_PATTERN
 \

341 
	`SANE_I18N
("Defineshe halftoning (dithering)…attern for scanning " \

342 "h®áÚed images.")

	)

344 
	#SANE_DESC_RESOLUTION_BIND
 \

345 
	`SANE_I18N
("U£ samv®ue fÜ X‡nd Y„esŞutiÚ")

	)

346 
	#SANE_DESC_NEGATIVE
 \

347 
	`SANE_I18N
("Sw­ bÏck‡nd wh™e")

	)

348 
	#SANE_DESC_QUALITY_CAL
 \

349 
	`SANE_I18N
("DØ¨qu®™y wh™e-ÿlib¿tiÚ")

	)

350 
	#SANE_DESC_DOR
 \

351 
	`SANE_I18N
("U£†’ th© doubË İtiÿÈ»sŞutiÚ")

	)

352 
	#SANE_DESC_RGB_BIND
 \

353 
	`SANE_I18N
("IÀRGB-modu£ samv®ue fÜƒach cŞÜ")

	)

354 
	#SANE_DESC_THRESHOLD
 \

355 
	`SANE_I18N
("S–eù mšimum-brighŠes tØg‘‡ wh™pošt")

	)

356 
	#SANE_DESC_ANALOG_GAMMA
 \

357 
	`SANE_I18N
("AÇlog gamma-cÜ»ùiÚ")

	)

358 
	#SANE_DESC_ANALOG_GAMMA_R
 \

359 
	`SANE_I18N
("AÇlog gamma-cÜ»ùiÚ fÜ„ed")

	)

360 
	#SANE_DESC_ANALOG_GAMMA_G
 \

361 
	`SANE_I18N
("AÇlog gamma-cÜ»ùiÚ fÜ g»’")

	)

362 
	#SANE_DESC_ANALOG_GAMMA_B
 \

363 
	`SANE_I18N
("AÇlog gamma-cÜ»ùiÚ fÜ blue")

	)

364 
	#SANE_DESC_ANALOG_GAMMA_BIND
 \

365 
	`SANE_I18N
("IÀRGB-modu£ samv®ue fÜƒach cŞÜ")

	)

366 
	#SANE_DESC_WARMUP
 \

367 
	`SANE_I18N
("W¬mu°Ïm°befÜsÿÂšg")

	)

368 
	#SANE_DESC_CAL_EXPOS_TIME
 \

369 
	`SANE_I18N
("Defšexposu»-timfÜ c®ib¿tiÚ")

	)

370 
	#SANE_DESC_CAL_EXPOS_TIME_R
 \

371 
	`SANE_I18N
("Defšexposu»-timfÜ„ed c®ib¿tiÚ")

	)

372 
	#SANE_DESC_CAL_EXPOS_TIME_G
 \

373 
	`SANE_I18N
("Defšexposu»-timfÜ g»’ c®ib¿tiÚ")

	)

374 
	#SANE_DESC_CAL_EXPOS_TIME_B
 \

375 
	`SANE_I18N
("Defšexposu»-timfÜ bluÿlib¿tiÚ")

	)

376 
	#SANE_DESC_SCAN_EXPOS_TIME
 \

377 
	`SANE_I18N
("Defšexposu»-timfÜ sÿn")

	)

378 
	#SANE_DESC_SCAN_EXPOS_TIME_R
 \

379 
	`SANE_I18N
("Defšexposu»-timfÜ„ed sÿn")

	)

380 
	#SANE_DESC_SCAN_EXPOS_TIME_G
 \

381 
	`SANE_I18N
("Defšexposu»-timfÜ g»’ sÿn")

	)

382 
	#SANE_DESC_SCAN_EXPOS_TIME_B
 \

383 
	`SANE_I18N
("Defšexposu»-timfÜ blusÿn")

	)

384 
	#SANE_DESC_SELECT_EXPOSURE_TIME
 \

385 
	`SANE_I18N
("EÇbË s–eùiÚ oàexposu»-time")

	)

386 
	#SANE_DESC_CAL_LAMP_DEN
 \

387 
	`SANE_I18N
("DefšÏm°d’s™y fÜ c®ib¿tiÚ")

	)

388 
	#SANE_DESC_SCAN_LAMP_DEN
 \

389 
	`SANE_I18N
("DefšÏm°d’s™y fÜ sÿn")

	)

390 
	#SANE_DESC_SELECT_LAMP_DENSITY
 \

391 
	`SANE_I18N
("EÇbË s–eùiÚ oàÏm°d’s™y")

	)

392 
	#SANE_DESC_LAMP_OFF_AT_EXIT
 \

393 
	`SANE_I18N
("Tuº ofàÏm°wh’…rog¿mƒx™s")

	)

397 
	#SANE_VALUE_SCAN_MODE_COLOR
 
	`SANE_I18N
("CŞÜ")

	)

398 
	#SANE_VALUE_SCAN_MODE_GRAY
 
	`SANE_I18N
("G¿y")

	)

399 
	#SANE_VALUE_SCAN_MODE_LINEART
 
	`SANE_I18N
("Lš—¹")

	)

	@scan/sane/scl.c

28 
	~<”ºo.h
>

29 
	~<¡dio.h
>

30 
	~<¡ršg.h
>

31 
	~"hpmud.h
"

32 
	~"io.h
"

33 
	~"commÚ.h
"

34 
	~"sş.h
"

35 
	~"h·io.h
"

37 
	#DEBUG_DECLARE_ONLY


	)

38 
	~"§Ãi_debug.h
"

40 
	$SşBufãrIsP¬tŸlR•ly
Ğ* 
d©a
, 
d©®’
 )

42 
i
 = 0, 
v®ue
 = 0;

43 
d
;

45 ifĞ
i
 >ğ
d©®’
 )

49 ifĞ
d©a
[
i
++] != 27 )

53 ifĞ
i
 >ğ
d©®’
 )

57 ifĞ
d©a
[
i
++] != '*' )

61 ifĞ
i
 >ğ
d©®’
 )

65 ifĞ
d©a
[
i
++] != 's' )

71 ifĞ
i
 >ğ
d©®’
 )

75 
d
 = 
d©a
[
i
] - '0';

76 ifĞ
d
 > 9 )

80 
i
++;

82 
d
 = 
d©a
[
i
++];

83 ifĞ
d
<'a' || d>'z' )

89 ifĞ
i
 >ğ
d©®’
 )

93 
d
 = 
d©a
[
i
] - '0';

94 ifĞ
d
 > 9 )

98 
i
++;

99 
v®ue
 = ( v®u* 10 ) + 
d
;

101 ifĞ
i
 >ğ
d©®’
 )

105 ifĞ
d©a
[
i
++] != 'W' )

109 
v®ue
 = 
i
 + v®u- 
d©®’
;

110 ifĞ
v®ue
 < 0 )

112 
v®ue
 = 0;

114  
v®ue
;

115 
	}
}

118 
	$SşChªÃlR—d
(
deviûid
, 
chªÃlid
, * 
bufãr
, 
couÁdown
, 
isSşRe¥Ú£
)

120 * 
bufãrS¹
 = 
bufãr
;

121 
bufãrL’
 = 
couÁdown
, 
couÁup
 = 0, 
Ën
;

122 
HPMUD_RESULT
 
¡©
;

124 if(!
isSşRe¥Ú£
)

126 
¡©
 = 
	`hpmud_»ad_chªÃl
(
deviûid
, 
chªÃlid
, 
bufãr
, 
bufãrL’
, 
EXCEPTION_TIMEOUT
, &
Ën
);

127  
Ën
;

132 
¡©
 = 
	`hpmud_»ad_chªÃl
(
deviûid
, 
chªÃlid
, 
bufãr
, 
couÁdown
, 
EXCEPTION_TIMEOUT
, &
Ën
);

134 if(
¡©
 !ğ
HPMUD_R_OK
)

138 
couÁup
 +ğ
Ën
;

140 
couÁdown
 = 
	`SşBufãrIsP¬tŸlR•ly
Ğ(*)
bufãrS¹
, 
couÁup
 );

142 ifĞ
couÁup
 + 
couÁdown
 > 
bufãrL’
 )

144 
couÁdown
 = 
bufãrL’
 - 
couÁup
;

146 ifĞ
couÁdown
 <= 0 )

151 
bufãr
 +ğ
Ën
;

155 if(!
couÁup
)

157  
Ën
;

159  
couÁup
;

161 
	}
}

163 
SANE_Stus
 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
	$SşS’dCommªd
(
deviûid
, 
chªÃlid
, 
cmd
, 
·¿m
)

165 
bufãr
[
LEN_SCL_BUFFER
];

166 
d©®’
, 
Ën
;

167 
punc
 = 
	`SCL_CMD_PUNC
Ğ
cmd
 );

168 
Ë‰”1
 = 
	`SCL_CMD_LETTER1
Ğ
cmd
),
Ë‰”2
 = 
	`SCL_CMD_LETTER2
( cmd );

170 ifĞ
cmd
 =ğ
SCL_CMD_RESET
 )

172 
d©®’
 = 
	`¢´štf
Ğ
bufãr
, 
LEN_SCL_BUFFER
, "\x1B%c", 
Ë‰”2
 );

176 ifĞ
cmd
 =ğ
SCL_CMD_CLEAR_ERROR_STACK
 )

178 
d©®’
 = 
	`¢´štf
Ğ
bufãr
,

179 
LEN_SCL_BUFFER
,

181 
punc
,

182 
Ë‰”1
,

183 
Ë‰”2
 );

187 
d©®’
 = 
	`¢´štf
Ğ
bufãr
,

188 
LEN_SCL_BUFFER
,

190 
punc
,

191 
Ë‰”1
,

192 
·¿m
,

193 
Ë‰”2
 );

197 
	`hpmud_wr™e_chªÃl
(
deviûid
, 
chªÃlid
, 
bufãr
, 
d©®’
, 
EXCEPTION_TIMEOUT
, &
Ën
);

199 
	`DBG
(6, "SşS’dCommªd: size=%d by‹s_wrÙe=%d: % %d\n", 
d©®’
, 
Ën
, 
__FILE__
, 
__LINE__
);

200 ià(
DBG_LEVEL
 >= 6)

201 
	`sysdump
(
bufãr
, 
d©®’
);

203 if(
Ën
 !ğ
d©®’
)

205  
SANE_STATUS_IO_ERROR
;

208  
SANE_STATUS_GOOD
;

209 
	}
}

211 
SANE_Stus
 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
	$SşInquœe
(
deviûid
, 
chªÃlid
, 
cmd
, 
·¿m
, * 
pV®ue
, * 
bufãr
, 
maxËn
)

213 
SANE_Stus
 
»tcode
;

214 
ËnRe¥Ú£
, 
Ën
, 
v®ue
;

215 
_»¥Ú£
[
LEN_SCL_BUFFER
 + 1], * 
»¥Ú£
 = _response;

216 
ex³ùed
[
LEN_SCL_BUFFER
], 
ex³ùedCh¬
;

218 ifĞ!
pV®ue
 )

220 
pV®ue
 = &
v®ue
;

222 ifĞ
bufãr
 && 
maxËn
 > 0 )

224 
	`mem£t
Ğ
bufãr
, 0, 
maxËn
 );

226 
	`mem£t
Ğ
_»¥Ú£
, 0, 
LEN_SCL_BUFFER
 + 1 );

229 ifĞĞ
»tcode
 = 
	`SşS’dCommªd
Ğ
deviûid
, 
chªÃlid
, 
cmd
, 
·¿m
 ) ) !ğ
SANE_STATUS_GOOD
 )

231  
»tcode
;

235 
ex³ùedCh¬
 = 
	`SCL_CMD_LETTER2
Ğ
cmd
 ) - 'A' + 'a' - 1;

236 ifĞ
ex³ùedCh¬
 == 'q' )

238 
ex³ùedCh¬
--;

240 
Ën
 = 
	`¢´štf
Ğ
ex³ùed
,

241 
LEN_SCL_BUFFER
,

243 
	`SCL_CMD_PUNC
Ğ
cmd
 ),

244 
	`SCL_CMD_LETTER1
Ğ
cmd
 ),

245 
·¿m
,

246 
ex³ùedCh¬
 );

249 
ËnRe¥Ú£
 = 
	`SşChªÃlR—d
Ğ
deviûid
, 
chªÃlid
, 
»¥Ú£
, 
LEN_SCL_BUFFER
, 1 );

251 
	`DBG
(6, "SşChªÃlR—d:†’=%d: % %d\n", 
ËnRe¥Ú£
, 
__FILE__
, 
__LINE__
);

252 ià(
DBG_LEVEL
 >= 6)

253 
	`sysdump
(
»¥Ú£
, 
ËnRe¥Ú£
);

256 ifĞ
ËnRe¥Ú£
 <ğ
Ën
 || 
	`memcmp
Ğ
»¥Ú£
, 
ex³ùed
,†en ) )

258 
	`bug
("šv®id SşInquœe(cmd=%x,·¿m=%dèexpÖ’=%d)/aùÖ’=%d): % %d\n", 
cmd
, 
·¿m
, 
Ën
, 
ËnRe¥Ú£
, 
__FILE__
, 
__LINE__
);

259 
	`bug
("exp:\n");

260 
	`bugdump
(
ex³ùed
, 
Ën
);

261 
	`bug
("act:\n");

262 
	`bugdump
(
»¥Ú£
, 
ËnRe¥Ú£
);

263  
SANE_STATUS_IO_ERROR
;

265 
»¥Ú£
 +ğ
Ën
;

266 
ËnRe¥Ú£
 -ğ
Ën
;

269 ifĞ
»¥Ú£
[0] == 'N' )

271 
	`DBG
(6, "SşInquœnuÎ„e¥Ú£. % %d\n", 
__FILE__
, 
__LINE__
);

272  
SANE_STATUS_UNSUPPORTED
;

278 ifĞ
	`ssÿnf
Ğ
»¥Ú£
, "%d%n", 
pV®ue
, &
Ën
 ) != 1 )

280 
	`bug
("šv®id SşInquœe(cmd=%x,·¿m=%dèš‹g”„e¥Ú£: % %d\n", 
cmd
, 
·¿m
, 
__FILE__
, 
__LINE__
);

281  
SANE_STATUS_IO_ERROR
;

285 ifĞ
»¥Ú£
[
Ën
] == 'V' )

287  
SANE_STATUS_GOOD
;

291 ifĞ
»¥Ú£
[
Ën
] != 'W' )

293 
	`bug
("šv®id SşInquœe(cmd=%x,·¿m=%dèuÃx³ùed ch¬aù” '%c': % %d\n", 
cmd
, 
·¿m
, 
»¥Ú£
[
Ën
], 
__FILE__
, 
__LINE__
);

294  
SANE_STATUS_IO_ERROR
;

296 
»¥Ú£
 +ğ
Ën
 + 1;

297 
ËnRe¥Ú£
 -ğ
Ën
 + 1;

300 ifĞ
ËnRe¥Ú£
<0 ||†’Re¥Ú£ !ğ*
pV®ue
 ||†’Re¥Ú£>
maxËn
 )

302 
	`bug
("invalid SclInquire(cmd=%x,param=%d) binary data†enResponse=%d *pValue=%d maxlen=%d: %s %d\n",

303 
cmd
, 
·¿m
, 
ËnRe¥Ú£
, *
pV®ue
, 
maxËn
, 
__FILE__
, 
__LINE__
);

304  
SANE_STATUS_IO_ERROR
;

308 ifĞ
bufãr
 )

310 
maxËn
 = *
pV®ue
;

311 
	`memıy
Ğ
bufãr
, 
»¥Ú£
, 
maxËn
 );

314  
SANE_STATUS_GOOD
;

315 
	}
}

321 
SANE_Stus
 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
	$sş_£nd_cmd
(
HPAIO_RECORD
 *
h·io
, cÚ¡ *
buf
, 
size
)

323 
Ën
;

325 
	`hpmud_wr™e_chªÃl
(
h·io
->
deviûid
, h·io->
sÿn_chªÃlid
, 
buf
, 
size
, 
EXCEPTION_TIMEOUT
, &
Ën
);

327 
	`DBG
(6, "sş cmd s’ˆsize=%d by‹s_wrÙe=%d: % %d\n", 
size
, 
Ën
, 
__FILE__
, 
__LINE__
);

328 ià(
DBG_LEVEL
 >= 6)

329 
	`sysdump
(
buf
, 
size
);

331 if(
Ën
 !ğ
size
)

333  
SANE_STATUS_IO_ERROR
;

336  
SANE_STATUS_GOOD
;

337 
	}
}

339 
SANE_Stus
 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
	$sş_qu”y_št
(
HPAIO_RECORD
 *
h·io
, cÚ¡ *
buf
, 
size
, *
»suÉ
)

341 
rbuf
[256];

342 
Ën
, 
¡©
;

343 *

;

345 *
»suÉ
=0;

347 ià((
¡©
 = 
	`sş_£nd_cmd
(
h·io
, 
buf
, 
size
)è!ğ
SANE_STATUS_GOOD
)

349  
¡©
;

352 ià((
¡©
 = 
	`hpmud_»ad_chªÃl
(
h·io
->
deviûid
, h·io->
sÿn_chªÃlid
, 
rbuf
, Ôbuf), 
EXCEPTION_TIMEOUT
, &
Ën
)è!ğ
HPMUD_R_OK
)

354  
SANE_STATUS_IO_ERROR
;

357 
	`DBG
(6, "sş„e¥Ú£ size=%d: % %d\n", 
Ën
, 
__FILE__
, 
__LINE__
);

358 ià(
DBG_LEVEL
 >= 6)

359 
	`sysdump
(
buf
, 
size
);

362 if(
rbuf
[
Ën
-1] == 'N')

364 
	`DBG
(6, "sş‚uÎ„e¥Ú£: % %d\n", 
__FILE__
, 
__LINE__
);

365  
SANE_STATUS_UNSUPPORTED
;

369 if(
rbuf
[
Ën
-1] != 'V' )

371 
	`bug
("šv®id sş iÁeg”„e¥Ú£: % %d\n", 
__FILE__
, 
__LINE__
);

372  
SANE_STATUS_IO_ERROR
;

375 *
»suÉ
 = 
	`¡¹Ş
(&
rbuf
[
size
], &

, 10);

377  
SANE_STATUS_GOOD
;

378 
	}
}

	@scan/sane/scl.h

28 #ià!
defšed
Ğ
__SCL_H__
 )

29 
	#__SCL_H__


	)

31 
	~"§Ã.h
"

33 
	#SCL_SEND_COMMAND_START_TIMEOUT
 0

	)

34 
	#SCL_SEND_COMMAND_CONTINUE_TIMEOUT
 2

	)

35 
	#SCL_INQUIRE_START_TIMEOUT
 30

	)

36 
	#SCL_INQUIRE_CONTINUE_TIMEOUT
 5

	)

37 
	#SCL_DEVICE_LOCK_TIMEOUT
 0

	)

38 
	#SCL_PREPARE_SCAN_DEVICE_LOCK_MAX_RETRIES
 4

	)

39 
	#SCL_PREPARE_SCAN_DEVICE_LOCK_DELAY
 1

	)

40 
	#SCL_CMD
(
a
,
b
èĞ(('*'-'!'+1)<<10è+ ((×)-'`'+1)<<5è+ ((b)-'@'+1è)

	)

41 
	#SCL_CMD_PUNC
(
x
è((((x)>>10)&0x1F)+'!'-1)

	)

42 
	#SCL_CMD_LETTER1
(
x
è((((x)>> 5)&0x1F)+'`'-1)

	)

43 
	#SCL_CMD_LETTER2
(
x
è(Ğ(xè&0x1F)+'@'-1)

	)

45 
	#SCL_af
 (
h·io
->
sş
.
decix–Ch¬
)

	)

46 
	#SCL_CHAR_DECIPOINTS
 'a'

	)

47 
	#SCL_CHAR_DEVPIXELS
 'f'

	)

49 
	#SCL_CMD_RESET
 
	`SCL_CMD
('z','E'è

	)

50 
	#SCL_CMD_CLEAR_ERROR_STACK
 
	`SCL_CMD
('o','E'è

	)

51 
	#SCL_CMD_INQUIRE_PRESENT_VALUE
 
	`SCL_CMD
('s','R')

	)

52 
	#SCL_CMD_INQUIRE_MINIMUM_VALUE
 
	`SCL_CMD
('s','L')

	)

53 
	#SCL_CMD_INQUIRE_MAXIMUM_VALUE
 
	`SCL_CMD
('s','H')

	)

54 
	#SCL_CMD_INQUIRE_DEVICE_PARAMETER
 
	`SCL_CMD
('s','E')

	)

56 
	#SCL_CMD_SET_OUTPUT_DATA_TYPE
 
	`SCL_CMD
('a','T')

	)

57 
	#SCL_CMD_SET_DATA_WIDTH
 
	`SCL_CMD
('a','G')

	)

58 
	#SCL_CMD_SET_MFPDTF
 
	`SCL_CMD
('m','S'è

	)

59 
	#SCL_CMD_SET_COMPRESSION
 
	`SCL_CMD
('a','C'è

	)

60 
	#SCL_CMD_SET_JPEG_COMPRESSION_FACTOR
 
	`SCL_CMD
('m','Q'è

	)

61 
	#SCL_CMD_SET_X_RESOLUTION
 
	`SCL_CMD
('a','R')

	)

62 
	#SCL_CMD_SET_Y_RESOLUTION
 
	`SCL_CMD
('a','S')

	)

63 
	#SCL_CMD_SET_X_POSITION
 
	`SCL_CMD
(
SCL_af
,'X')

	)

64 
	#SCL_CMD_SET_Y_POSITION
 
	`SCL_CMD
(
SCL_af
,'Y')

	)

65 
	#SCL_CMD_SET_X_EXTENT
 
	`SCL_CMD
(
SCL_af
,'P')

	)

66 
	#SCL_CMD_SET_Y_EXTENT
 
	`SCL_CMD
(
SCL_af
,'Q')

	)

67 
	#SCL_CMD_SET_DOWNLOAD_TYPE
 
	`SCL_CMD
('a','D')

	)

68 
	#SCL_CMD_DOWNLOAD_BINARY_DATA
 
	`SCL_CMD
('a','W')

	)

69 
	#SCL_CMD_SET_CCD_RESOLUTION
 
	`SCL_CMD
('m','R')

	)

70 
	#SCL_CMD_CHANGE_DOCUMENT
 
	`SCL_CMD
('u','X')

	)

71 
	#SCL_CMD_UNLOAD_DOCUMENT
 
	`SCL_CMD
('u','U')

	)

72 
	#SCL_CMD_CHANGE_DOCUMENT_BACKGROUND
 
	`SCL_CMD
('u','Y')

	)

73 
	#SCL_CMD_SCAN_WINDOW
 
	`SCL_CMD
('f','S')

	)

74 
	#SCL_CMD_SET_DEVICE_LOCK
 
	`SCL_CMD
('f','H')

	)

75 
	#SCL_CMD_SET_DEVICE_LOCK_TIMEOUT
 
	`SCL_CMD
('f','I')

	)

76 
	#SCL_CMD_SET_CONTRAST
 
	`SCL_CMD
('a', 'K')

	)

77 
	#SCL_CMD_SET_BRIGHTNESS
 
	`SCL_CMD
('a', 'L')

	)

80 
	#SCL_CMD_SET_PRESCAN
 
	`SCL_CMD
('m','B')

	)

81 
	#SCL_CMD_SET_NUMBER_OF_IMAGES_FOUND
 
	`SCL_CMD
('m','P')

	)

82 
	#SCL_CMD_SET_SHARPENING
 
	`SCL_CMD
('a','N')

	)

86 
	#SCL_PSEUDO_FLATBED_X_RESOLUTION
 (
SCL_CMD_SET_X_RESOLUTION
+1000)

	)

87 
	#SCL_PSEUDO_FLATBED_Y_RESOLUTION
 (
SCL_CMD_SET_Y_RESOLUTION
+1000)

	)

88 
	#SCL_PSEUDO_FLATBED_Y_EXTENT
 (
SCL_CMD_SET_Y_EXTENT
 +1000)

	)

89 
	#SCL_PSEUDO_ADF_X_RESOLUTION
 (
SCL_CMD_SET_X_RESOLUTION
+2000)

	)

90 
	#SCL_PSEUDO_ADF_Y_RESOLUTION
 (
SCL_CMD_SET_Y_RESOLUTION
+2000)

	)

91 
	#SCL_PSEUDO_ADF_Y_EXTENT
 (
SCL_CMD_SET_Y_EXTENT
 +2000)

	)

93 
	#SCL_DATA_TYPE_LINEART
 0

	)

94 
	#SCL_DATA_TYPE_GRAYSCALE
 4

	)

95 
	#SCL_DATA_TYPE_COLOR
 5

	)

97 
	#SCL_DATA_WIDTH_LINEART
 1

	)

98 
	#SCL_DATA_WIDTH_GRAYSCALE
 8

	)

99 
	#SCL_DATA_WIDTH_COLOR
 24

	)

101 
	#SCL_MFPDTF_OFF
 0

	)

102 
	#SCL_MFPDTF_ON
 2

	)

104 
	#SCL_COMPRESSION_NONE
 0

	)

105 
	#SCL_COMPRESSION_JPEG
 2

	)

107 
	#SCL_MIN_Y_RES_1150
 50

	)

108 
	#SCL_MAX_RES_1150_1170
 300

	)

110 
	#SCL_DOWNLOAD_TYPE_COLORMAP
 15

	)

112 
	#SCL_DEVICE_LOCK_RELEASED
 0

	)

113 
	#SCL_DEVICE_LOCK_SET
 1

	)

114 
	#SCL_DEVICE_LOCK_TIMEOUT
 0

	)

116 
	#SCL_CHANGE_DOC_SIMPLEX
 0

	)

117 
	#SCL_CHANGE_DOC_DUPLEX
 2

	)

118 
	#SCL_CHANGE_DOC_DUPLEX_SIDE
 12

	)

121 
	#SCL_INQ_HP_MODEL_11
 18

	)

122 
	#SCL_INQ_HP_MODEL_12
 19

	)

123 
	#SCL_INQ_ADF_FEED_STATUS
 23

	)

124 
	#SCL_INQ_ADF_CAPABILITY
 24

	)

125 
	#SCL_INQ_ADF_DOCUMENT_LOADED
 25

	)

126 
	#SCL_INQ_ADF_READY_TO_UNLOAD
 27

	)

127 
	#SCL_INQ_MAX_ERROR_STACK
 256

	)

128 
	#SCL_INQ_CURRENT_ERROR_STACK
 257

	)

129 
	#SCL_INQ_CURRENT_ERROR
 259

	)

130 
	#SCL_INQ_SESSION_ID
 505

	)

131 
	#SCL_INQ_BULB_WARM_UP_STATUS
 506

	)

132 
	#SCL_INQ_PIXELS_PER_SCAN_LINE
 1024

	)

133 
	#SCL_INQ_BYTES_PER_SCAN_LINE
 1025

	)

134 
	#SCL_INQ_NUMBER_OF_SCAN_LINES
 1026

	)

135 
	#SCL_INQ_ADF_READY_TO_LOAD
 1027

	)

136 
	#SCL_INQ_DEVICE_PIXELS_PER_INCH
 1028

	)

138 
	#SCL_INQ_NATIVE_OPTICAL_RESOLUTION
 1029

	)

141 
	#SCL_ADF_FEED_STATUS_OK
 0

	)

142 
	#SCL_ADF_FEED_STATUS_BUSY
 1000

	)

143 
	#SCL_ADF_FEED_STATUS_PAPER_JAM
 1024

	)

144 
	#SCL_ADF_FEED_STATUS_ORIGINAL_ON_GLASS
 1027

	)

145 
	#SCL_ADF_FEED_STATUS_PORTRAIT_FEED
 1028

	)

148 
	#SCL_ERROR_COMMAND_FORMAT_ERROR
 0

	)

149 
	#SCL_ERROR_UNRECOGNIZED_COMMAND
 1

	)

150 
	#SCL_ERROR_PARAMETER_ERROR
 2

	)

151 
	#SCL_ERROR_ILLEGAL_WINDOW
 3

	)

152 
	#SCL_ERROR_SCALING_ERROR
 4

	)

153 
	#SCL_ERROR_DITHER_ID_ERROR
 5

	)

154 
	#SCL_ERROR_TONE_MAP_ID_ERROR
 6

	)

155 
	#SCL_ERROR_LAMP_ERROR
 7

	)

156 
	#SCL_ERROR_MATRIX_ID_ERROR
 8

	)

157 
	#SCL_ERROR_CAL_STRIP_PARAM_ERROR
 9

	)

158 
	#SCL_ERROR_GROSS_CALIBRATION_ERROR
 10

	)

159 
	#SCL_ERROR_NO_MEMORY
 500

	)

160 
	#SCL_ERROR_SCANNER_HEAD_LOCKED
 501

	)

161 
	#SCL_ERROR_CANCELLED
 502

	)

162 
	#SCL_ERROR_PEN_DOOR_OPEN
 503

	)

163 
	#SCL_ERROR_ADF_PAPER_JAM
 1024

	)

164 
	#SCL_ERROR_HOME_POSITION_MISSING
 1025

	)

165 
	#SCL_ERROR_PAPER_NOT_LOADED
 1026

	)

166 
	#SCL_ERROR_ORIGINAL_ON_GLASS
 1027

	)

168 
	#SCL_COMPAT_1150
 0x0001

	)

169 
	#SCL_COMPAT_1170
 0x0002

	)

170 
	#SCL_COMPAT_R_SERIES
 0x0004

	)

171 
	#SCL_COMPAT_G_SERIES
 0x0008

	)

172 
	#SCL_COMPAT_K_SERIES
 0x0010

	)

173 
	#SCL_COMPAT_D_SERIES
 0x0020

	)

174 
	#SCL_COMPAT_6100_SERIES
 0x0040

	)

175 
	#SCL_COMPAT_OFFICEJET
 0x1000

	)

176 
	#SCL_COMPAT_POST_1150
 0x2000

	)

179 
	#LEN_SCL_BUFFER
 256

	)

181 
SANE_Stus
 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
SşS’dCommªd
(
deviûid
, 
chªÃlid
, 
cmd
, 
·¿m
);

182 
SANE_Stus
 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
SşInquœe
(
deviûid
, 
chªÃlid
, 
cmd
, 
·¿m
, *
pV®ue
, *
bufãr
, 
maxËn
);

189 
	#SCL_QUERY_DUPLEX_SUPPORTED
 "\e*s13500E"

	)

190 
	#SCL_QUERY_DUPLEX_VERT_FLIP_SUPPORTED
 "\e*s13501E"

	)

191 
	#SCL_QUERY_DUPLEX_HORZ_FLIP_SUPPORTED
 "\e*s13502E"

	)

193 
	#SCL_SET_DUPLEX
 "\e*d%dD13505R"

	)

194 
	#SCL_SET_DUPLEX_VERT_FLIP
 "\e*d%dV13506R"

	)

195 
	#SCL_SET_DUPLEX_HORZ_FLIP
 "\e*d%dH13507R"

	)

196 
	#SCL_SET_DUPLEX_ORIENTATION
 "\e*a%d13507R"

	)

198 
	gh·ioSÿÂ”_s
;

200 
SANE_Stus
 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
sş_£nd_cmd
(
h·ioSÿÂ”_s
 *
h·io
, cÚ¡ *
buf
, 
size
);

201 
SANE_Stus
 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
sş_qu”y_št
(
h·ioSÿÂ”_s
 *
h·io
, cÚ¡ *
buf
, 
size
, *
»suÉ
);

	@scan/sane/sclpml.c

28 
	~<¡dio.h
>

29 
	~<¡ršg.h
>

30 
	~<uni¡d.h
>

31 
	~<fú.h
>

32 
	~<¡ršg.h
>

33 
	~"§Ã.h
"

34 
	~"§Ãİts.h
"

35 
	~"commÚ.h
"

36 
	~"io.h
"

37 
	~"mådtf.h
"

38 
	~"bËs.h
"

39 
	~"hpmud.h
"

40 
	~"io.h
"

41 
	~"commÚ.h
"

42 
	~"sş.h
"

43 
	~"h·io.h
"

44 
	~"uts.h
"

46 
	#DEBUG_DECLARE_ONLY


	)

47 
	~"§Ãi_debug.h
"

50 #ifdeà
SCLPML_DEBUG


51 
	#_DBG
(
¬gs
...è
	`sy¦og
(
LOG_INFO
, 
__FILE__
 " " 
	`STRINGIZE
(
__LINE__
è": "‡rgs)

	)

53 
	#_DBG
(
¬gs
...)

	)

56 
h·ioSÿÂ”_s
 * 
	g£ssiÚ
;

58 
SANE_Stus
 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
	$h·ioSÿÂ”ToSªeE¼Ü
Ğ
h·ioSÿÂ”_t
 
h·io
 )

60 
SANE_Stus
 
»tcode
;

62 ifĞ
h·io
->
sÿÂ”Ty³
 =ğ
SCANNER_TYPE_SCL
 )

64 
sşE¼Ü
;

66 
»tcode
 = 
	`SşInquœe
Ğ
h·io
->
deviûid
, h·io->
sÿn_chªÃlid
,

67 
SCL_CMD_INQUIRE_DEVICE_PARAMETER
,

68 
SCL_INQ_CURRENT_ERROR
,

69 &
sşE¼Ü
,

73 ifĞ
»tcode
 =ğ
SANE_STATUS_UNSUPPORTED
 )

75 
»tcode
 = 
SANE_STATUS_GOOD
;

77 ifĞ
»tcode
 =ğ
SANE_STATUS_GOOD
 )

79 
	`bug
("h·io: h·ioSÿÂ”ToSªeE¼Ü: sşE¼Ü=%d.\n", 
sşE¼Ü
);

80  
sşE¼Ü
 )

82 
SCL_ERROR_UNRECOGNIZED_COMMAND
:

83 
SCL_ERROR_PARAMETER_ERROR
:

84 
»tcode
 = 
SANE_STATUS_UNSUPPORTED
;

87 
SCL_ERROR_NO_MEMORY
:

88 
»tcode
 = 
SANE_STATUS_NO_MEM
;

91 
SCL_ERROR_CANCELLED
:

92 
»tcode
 = 
SANE_STATUS_CANCELLED
;

95 
SCL_ERROR_PEN_DOOR_OPEN
:

96 
»tcode
 = 
SANE_STATUS_COVER_OPEN
;

99 
SCL_ERROR_SCANNER_HEAD_LOCKED
:

100 
SCL_ERROR_ADF_PAPER_JAM
:

101 
SCL_ERROR_HOME_POSITION_MISSING
:

102 
SCL_ERROR_ORIGINAL_ON_GLASS
:

103 
»tcode
 = 
SANE_STATUS_JAMMED
;

106 
SCL_ERROR_PAPER_NOT_LOADED
:

107 
»tcode
 = 
SANE_STATUS_NO_DOCS
;

111 
»tcode
 = 
SANE_STATUS_IO_ERROR
;

118 
pmlE¼Ü
, 
ty³
;

120 ifĞ
	`PmlReque¡G‘
Ğ
h·io
->
deviûid
, h·io->
cmd_chªÃlid
, h·io->
pml
.
objU¶ßdE¼Ü
 ) =ğ
ERROR
 )

122 
»tcode
 = 
SANE_STATUS_GOOD
;

124 ifĞ
	`PmlG‘IÁeg”V®ue
Ğ
h·io
->
pml
.
objU¶ßdE¼Ü
,

125 &
ty³
,

126 &
pmlE¼Ü
 ) =ğ
ERROR
 )

128 
	`bug
("h·io: h·ioSÿÂ”ToSªeE¼Ü: PmlG‘IÁeg”V®uçed,y³=%d!\n", 
ty³
);

129 
»tcode
 = 
SANE_STATUS_IO_ERROR
;

133 
	`bug
("h·io: h·ioSÿÂ”ToSªeE¼Ü:…mlE¼Ü=%d.\n", 
pmlE¼Ü
);

135  
pmlE¼Ü
 )

137 
PML_UPLOAD_ERROR_SCANNER_JAM
:

138 
»tcode
 = 
SANE_STATUS_JAMMED
;

141 
PML_UPLOAD_ERROR_MLC_CHANNEL_CLOSED
:

142 
PML_UPLOAD_ERROR_STOPPED_BY_HOST
:

143 
PML_UPLOAD_ERROR_STOP_KEY_PRESSED
:

144 
»tcode
 = 
SANE_STATUS_CANCELLED
;

147 
PML_UPLOAD_ERROR_NO_DOC_IN_ADF
:

148 
PML_UPLOAD_ERROR_DOC_LOADED
:

149 
»tcode
 = 
SANE_STATUS_NO_DOCS
;

152 
PML_UPLOAD_ERROR_COVER_OPEN
:

153 
»tcode
 = 
SANE_STATUS_COVER_OPEN
;

156 
PML_UPLOAD_ERROR_DEVICE_BUSY
:

157 
»tcode
 = 
SANE_STATUS_DEVICE_BUSY
;

161 
»tcode
 = 
SANE_STATUS_IO_ERROR
;

167  
»tcode
;

168 
	}
}

171 
SANE_Stus
 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
	$h·ioSÿÂ”ToSªeStus
Ğ
h·ioSÿÂ”_t
 
h·io
 )

173 
SANE_Stus
 
»tcode
;

175 
sşStus
;

177 
»tcode
 = 
	`SşInquœe
Ğ
h·io
->
deviûid
, h·io->
sÿn_chªÃlid
,

178 
SCL_CMD_INQUIRE_DEVICE_PARAMETER
,

179 
SCL_INQ_ADF_FEED_STATUS
,

180 &
sşStus
,

184 ifĞ
»tcode
 =ğ
SANE_STATUS_UNSUPPORTED
 )

186 
»tcode
 = 
SANE_STATUS_GOOD
;

188 ifĞ
»tcode
 =ğ
SANE_STATUS_GOOD
 )

190  
sşStus
 )

192 
SCL_ADF_FEED_STATUS_OK
:

193 
»tcode
 = 
SANE_STATUS_GOOD
;

196 
SCL_ADF_FEED_STATUS_BUSY
:

198 
»tcode
 = 
SANE_STATUS_GOOD
;

201 
SCL_ADF_FEED_STATUS_PAPER_JAM
:

202 
SCL_ADF_FEED_STATUS_ORIGINAL_ON_GLASS
:

203 
»tcode
 = 
SANE_STATUS_JAMMED
;

206 
SCL_ADF_FEED_STATUS_PORTRAIT_FEED
:

207 
»tcode
 = 
SANE_STATUS_UNSUPPORTED
;

211 
»tcode
 = 
SANE_STATUS_IO_ERROR
;

216  
»tcode
;

217 
	}
}

219 
	$h·ioSÿÂ”IsUnš‹¼u±ibË
Ğ
h·ioSÿÂ”_t
 
h·io
,

220 * 
pU¶ßdS‹
 )

222 
u¶ßdS‹
;

223 ifĞ!
pU¶ßdS‹
 )

225 
pU¶ßdS‹
 = &
u¶ßdS‹
;

228  ( 
h·io
->
sÿÂ”Ty³
 =ğ
SCANNER_TYPE_PML
 &&

229 
h·io
->
pml
.
sÿnDÚe
 &&

230 
	`PmlReque¡G‘
Ğ
h·io
->
deviûid
, h·io->
cmd_chªÃlid
,

231 
h·io
->
pml
.
objU¶ßdS‹
 ) !ğ
ERROR
 &&

232 
	`PmlG‘IÁeg”V®ue
Ğ
h·io
->
pml
.
objU¶ßdS‹
, 0, 
pU¶ßdS‹
 ) !ğ
ERROR
 &&

233 Ğ*
pU¶ßdS‹
 =ğ
PML_UPLOAD_STATE_START
 ||

234 *
pU¶ßdS‹
 =ğ
PML_UPLOAD_STATE_ACTIVE
 ||

235 *
pU¶ßdS‹
 =ğ
PML_UPLOAD_STATE_NEWPAGE
 ) );

236 
	}
}

238 
SANE_Stus
 
	$h·ioRe£tSÿÂ”
Ğ
h·ioSÿÂ”_t
 
h·io
 )

240 
SANE_Stus
 
»tcode
;

242 ifĞ
h·io
->
sÿÂ”Ty³
 =ğ
SCANNER_TYPE_SCL
 )

244 
»tcode
 = 
	`SşS’dCommªd
Ğ
h·io
->
deviûid
, h·io->
sÿn_chªÃlid
, 
SCL_CMD_RESET
, 0 );

245 ifĞ
»tcode
 !ğ
SANE_STATUS_GOOD
 )

247  
»tcode
;

249 
	`¦“p
(1);

253 ifĞ!
	`h·ioSÿÂ”IsUnš‹¼u±ibË
Ğ
h·io
, 0 ) )

255 
	`PmlS‘IÁeg”V®ue
Ğ
h·io
->
pml
.
objU¶ßdS‹
,

256 
PML_TYPE_ENUMERATION
,

257 
PML_UPLOAD_STATE_IDLE
 );

259 ifĞ
	`PmlReque¡S‘R‘ry
Ğ
h·io
->
deviûid
, h·io->
cmd_chªÃlid
,

260 
h·io
->
pml
.
objU¶ßdS‹
, 0, 0 ) =ğ
ERROR
 )

262  
SANE_STATUS_IO_ERROR
;

267 
	`PmlS‘IÁeg”V®ue
Ğ
h·io
->
pml
.
objU¶ßdE¼Ü
,

268 
PML_TYPE_SIGNED_INTEGER
,

271 
	`PmlReque¡S‘
Ğ
h·io
->
deviûid
, h·io->
cmd_chªÃlid
, h·io->
pml
.
objU¶ßdE¼Ü
 );

274  
SANE_STATUS_GOOD
;

275 
	}
}

277 
PmlObjeù_t
 
	$h·ioPmlAÎoÿ‹
Ğ
h·ioSÿÂ”_t
 
h·io
 )

279 
size
 = Ğ
PmlObjeù_s
 );

280 
PmlObjeù_t
 
obj
;

283 
obj
 = 
	`m®loc
Ğ
size
 );

285 
	`mem£t
Ğ
obj
, 0, 
size
 );

288 ifĞ!
h·io
->
fœ¡PmlObjeù
 )

290 
h·io
->
fœ¡PmlObjeù
 = 
obj
;

292 
obj
->
´ev
 = 
h·io
->
Ï¡PmlObjeù
;

293 
obj
->
Ãxt
 = 0;

294 ifĞ
h·io
->
Ï¡PmlObjeù
 )

296 
h·io
->
Ï¡PmlObjeù
->
Ãxt
 = 
obj
;

298 
h·io
->
Ï¡PmlObjeù
 = 
obj
;

300  
obj
;

301 
	}
}

303 
PmlObjeù_t
 
	$h·ioPmlAÎoÿ‹ID
Ğ
h·ioSÿÂ”_t
 
h·io
, * 
oid
 )

305 
PmlObjeù_t
 
obj
 = 
	`h·ioPmlAÎoÿ‹
Ğ
h·io
 );

307 ifĞ!
obj
 )

309 
	`bug
("hpaioPmlAllocateID: out of memory!\n");

312 
	`PmlS‘ID
Ğ
obj
, 
oid
 );

314  
obj
;

315 
	}
}

317 
	$h·ioPmlD—Îoÿ‹Objeùs
Ğ
h·ioSÿÂ”_t
 
h·io
 )

319 
PmlObjeù_t
 
cu¼’t
, 
Ãxt
;

321 
cu¼’t
 = 
h·io
->
fœ¡PmlObjeù
;

323  
cu¼’t
 )

325 
Ãxt
 = 
cu¼’t
->next;

327 
	`ä“
Ğ
cu¼’t
 );

329 
cu¼’t
 = 
Ãxt
;

331 
	}
}

333 
SANE_Stus
 
	$h·ioPmlAÎoÿ‹Objeùs
(
h·ioSÿÂ”_t
 
h·io
)

336 
h·io
->
pml
.
objSÿÂ”Stus
 = 
	`h·ioPmlAÎoÿ‹ID
( hpaio, "1.3.6.1.4.1.11.2.3.9.4.2.1.2.2.2.1.0" );

337 
h·io
->
pml
.
objResŞutiÚRªge
 = 
	`h·ioPmlAÎoÿ‹ID
( hpaio, "1.3.6.1.4.1.11.2.3.9.4.2.1.2.2.2.3.0" );

338 
h·io
->
pml
.
objU¶ßdTimeout
 = 
	`h·ioPmlAÎoÿ‹ID
( hpaio, "1.3.6.1.4.1.11.2.3.9.4.2.1.1.1.18.0" );

339 
h·io
->
pml
.
objCÚŒa¡
 = 
	`h·ioPmlAÎoÿ‹ID
( hpaio, "1.3.6.1.4.1.11.2.3.9.4.2.1.2.2.1.1.0" );

340 
h·io
->
pml
.
objResŞutiÚ
 = 
	`h·ioPmlAÎoÿ‹ID
( hpaio, "1.3.6.1.4.1.11.2.3.9.4.2.1.2.2.1.2.0" );

341 
h·io
->
pml
.
objPix–D©aTy³
 = 
	`h·ioPmlAÎoÿ‹ID
( hpaio, "1.3.6.1.4.1.11.2.3.9.4.2.1.2.2.1.3.0" );

342 
h·io
->
pml
.
objCom´essiÚ
 = 
	`h·ioPmlAÎoÿ‹ID
( hpaio, "1.3.6.1.4.1.11.2.3.9.4.2.1.2.2.1.4.0" );

343 
h·io
->
pml
.
objCom´essiÚFaùÜ
 = 
	`h·ioPmlAÎoÿ‹ID
( hpaio, "1.3.6.1.4.1.11.2.3.9.4.2.1.2.2.1.5.0" );

344 
h·io
->
pml
.
objU¶ßdE¼Ü
 = 
	`h·ioPmlAÎoÿ‹ID
( hpaio, "1.3.6.1.4.1.11.2.3.9.4.2.1.2.2.1.6.0" );

345 
h·io
->
pml
.
objU¶ßdS‹
 = 
	`h·ioPmlAÎoÿ‹ID
( hpaio, "1.3.6.1.4.1.11.2.3.9.4.2.1.2.2.1.12.0" );

346 
h·io
->
pml
.
objAbcTh»shŞds
 = 
	`h·ioPmlAÎoÿ‹ID
( hpaio, "1.3.6.1.4.1.11.2.3.9.4.2.1.2.2.1.14.0" );

347 
h·io
->
pml
.
objSh¬³nšgCÛffic›Á
 = 
	`h·ioPmlAÎoÿ‹ID
( hpaio, "1.3.6.1.4.1.11.2.3.9.4.2.1.2.2.1.15.0" );

348 
h·io
->
pml
.
objNeuŒ®ClTh»shŞds
 = 
	`h·ioPmlAÎoÿ‹ID
( hpaio, "1.3.6.1.4.1.11.2.3.9.4.2.1.2.2.1.31.0" );

349 
h·io
->
pml
.
objTÚeM­
 = 
	`h·ioPmlAÎoÿ‹ID
( hpaio, "1.3.6.1.4.1.11.2.3.9.4.2.1.2.2.1.32.0" );

350 
h·io
->
pml
.
objCİ›rReduùiÚ
 = 
	`h·ioPmlAÎoÿ‹ID
( hpaio, "1.3.6.1.4.1.11.2.3.9.4.2.1.5.1.4.0" );

351 
h·io
->
pml
.
objSÿnTok’
 = 
	`h·ioPmlAÎoÿ‹ID
( hpaio, "1.3.6.1.4.1.11.2.3.9.4.2.1.1.1.25.0" );

352 
h·io
->
pml
.
objModuÏrH¬dw¬e
 = 
	`h·ioPmlAÎoÿ‹ID
( hpaio, "1.3.6.1.4.1.11.2.3.9.4.2.1.2.2.1.75.0" );

355 
h·io
->
sş
.
objSuµÜ‹dFunùiÚs
 = 
	`h·ioPmlAÎoÿ‹ID
( hpaio, "1.3.6.1.4.1.11.2.3.9.4.2.1.1.2.67.0" );

357  
SANE_STATUS_GOOD
;

358 
	}
}

360 
	$h·ioCÚnClo£
Ğ
h·ioSÿÂ”_t
 
h·io
 )

362 ià(
h·io
->
cmd_chªÃlid
 > 0)

363 
	`hpmud_şo£_chªÃl
(
h·io
->
deviûid
, h·io->
cmd_chªÃlid
);

364 
h·io
->
cmd_chªÃlid
 = -1;

365 ià(
h·io
->
sÿn_chªÃlid
 > 0)

366 
	`hpmud_şo£_chªÃl
(
h·io
->
deviûid
, h·io->
sÿn_chªÃlid
);

367 
h·io
->
sÿn_chªÃlid
 = -1;

370 
	}
}

372 
SANE_Stus
 
	$h·ioCÚnO³n
Ğ
h·ioSÿÂ”_t
 
h·io
 )

374 
SANE_Stus
 
»tcode
;

375 
HPMUD_RESULT
 
¡©
;

377 ià(
h·io
->
sÿÂ”Ty³
==
SCANNER_TYPE_SCL
)

379 
¡©
 = 
	`hpmud_İ’_chªÃl
(
h·io
->
deviûid
, "HP-SCAN", &h·io->
sÿn_chªÃlid
);

380 if(
¡©
 !ğ
HPMUD_R_OK
)

382 
	`bug
("çedØİ’ sÿÀchªÃl: % %d\n", 
__FILE__
, 
__LINE__
);

383 
»tcode
 = 
SANE_STATUS_DEVICE_BUSY
;

384 
abÜt
;

388 
¡©
 = 
	`hpmud_İ’_chªÃl
(
h·io
->
deviûid
, "HP-MESSAGE", &h·io->
cmd_chªÃlid
);

389 if(
¡©
 !ğ
HPMUD_R_OK
)

391 
	`bug
("çedØİ’…mÈchªÃl: % %d\n", 
__FILE__
, 
__LINE__
);

392 
»tcode
 = 
SANE_STATUS_IO_ERROR
;

393 
abÜt
;

396 
»tcode
 = 
SANE_STATUS_GOOD
;

398 
abÜt
:

399 ifĞ
»tcode
 !ğ
SANE_STATUS_GOOD
 )

401 
	`S’dSÿnEv’t
Ğ
h·io
->
deviûuri
, 
EVENT_SCANNER_FAIL
);

403  
»tcode
;

404 
	}
}

406 
SANE_Stus
 
	$h·ioCÚnP»·»Sÿn
Ğ
h·ioSÿÂ”_t
 
h·io
 )

408 
SANE_Stus
 
»tcode
;

409 
i
;

412 ià(
h·io
->
cmd_chªÃlid
 < 0)

414 
»tcode
 = 
	`h·ioCÚnO³n
Ğ
h·io
 );

416 ifĞ
»tcode
 !ğ
SANE_STATUS_GOOD
 )

418  
»tcode
;

422 
»tcode
 = 
	`h·ioRe£tSÿÂ”
Ğ
h·io
 );

425 
	`SşS’dCommªd
Ğ
h·io
->
deviûid
, h·io->
sÿn_chªÃlid
, 
SCL_CMD_SET_DEVICE_LOCK
, 1 );

426 
	`SşS’dCommªd
Ğ
h·io
->
deviûid
, h·io->
sÿn_chªÃlid
,

427 
SCL_CMD_SET_DEVICE_LOCK_TIMEOUT
,

428 
SCL_DEVICE_LOCK_TIMEOUT
 );

430  
i
 = 0; ; i++ )

432 
bufãr
[
LEN_SCL_BUFFER
];

433 
Ën
, 
j
;

434 
timev®
 
tv1
, 
tv2
;

435 
	`g‘timeofday
Ğ&
tv1
, 0 );

437 ifĞ
	`SşInquœe
Ğ
h·io
->
deviûid
, h·io->
sÿn_chªÃlid
,

438 
SCL_CMD_INQUIRE_DEVICE_PARAMETER
,

439 
SCL_INQ_SESSION_ID
,

440 &
Ën
,

441 
bufãr
,

442 
LEN_SCL_BUFFER
 ) !ğ
SANE_STATUS_GOOD
 )

445  
SANE_STATUS_IO_ERROR
;

448 
	`g‘timeofday
Ğ&
tv2
, 0 );

450  
j
 = 0; j < 
Ën
 && 
bufãr
[j] == '0'; j++ ) ;

452 ifĞ
j
 < 
Ën
 )

457 ifĞ
i
 >ğ
SCL_PREPARE_SCAN_DEVICE_LOCK_MAX_RETRIES
 )

459  
SANE_STATUS_DEVICE_BUSY
;

462 
	`DBG
(8, "h·ioCÚnP»·»Sÿn: Wa™šg fÜ deviû†ock % %d\n", 
__FILE__
, 
__LINE__
);

464 ifĞĞĞèĞ
tv2
.
tv_£c
 - 
tv1
.tv_£øèè<ğ
SCL_PREPARE_SCAN_DEVICE_LOCK_DELAY
 )

466 
	`¦“p
Ğ
SCL_PREPARE_SCAN_DEVICE_LOCK_DELAY
 );

470 
	`S’dSÿnEv’t
Ğ
h·io
->
deviûuri
, 
EVENT_START_SCAN_JOB
);

472  
SANE_STATUS_GOOD
;

473 
	}
}

475 
	$h·ioCÚnEndSÿn
Ğ
h·ioSÿÂ”_t
 
h·io
 )

477 
	`h·ioRe£tSÿÂ”
Ğ
h·io
 );

478 
	`h·ioCÚnClo£
Ğ
h·io
 );

480 
	`S’dSÿnEv’t
Ğ
h·io
->
deviûuri
, 
EVENT_END_SCAN_JOB
);

481 
	}
}

483 
SANE_Stus
 
	$S‘ResŞutiÚLi¡SCL
(
h·ioSÿÂ”_t
 
h·io
)

485 
suµÜ‹d_»s
[] = {50, 75, 100, 150, 200, 300, 600, 1200, 2400, 4800, 9600};

486 
i
, 
Ën
 = (
suµÜ‹d_»s
)/();

488 ià(
h·io
->
cu¼’tAdfMode
 =ğ
ADF_MODE_ADF
 || h·io->cu¼’tAdfMod=ğ
ADF_MODE_AUTO
)

490 
h·io
->
»sŞutiÚRªge
.
mš
 = h·io->
sş
.
mšResAdf
;

491 
h·io
->
»sŞutiÚRªge
.
max
 = h·io->
sş
.
maxResAdf
;

495 
h·io
->
»sŞutiÚRªge
.
mš
 = h·io->
sş
.
mšRes
;

496 
h·io
->
»sŞutiÚRªge
.
max
 = h·io->
sş
.
maxRes
;

499 
	`_DBG
("currentAdfMode=%d„esolutionRange[%d, %d]\n",

500 
h·io
->
cu¼’tAdfMode
, h·io->
»sŞutiÚRªge
.
mš
, h·io->»sŞutiÚRªge.
max
);

502 
	`NumLi¡CË¬
Ğ
h·io
->
»sŞutiÚLi¡
 );

503 
	`NumLi¡CË¬
Ğ
h·io
->
lš—¹ResŞutiÚLi¡
 );

504 
i
 = 0; i < 
Ën
; i++)

506 ià(
suµÜ‹d_»s
[
i
] >ğ
h·io
->
»sŞutiÚRªge
.
mš
 &&

507 
suµÜ‹d_»s
[
i
] <ğ
h·io
->
»sŞutiÚRªge
.
max
)

509 
	`NumLi¡Add
 (
h·io
->
»sŞutiÚLi¡
, 
suµÜ‹d_»s
[
i
]);

510 
	`NumLi¡Add
 (
h·io
->
lš—¹ResŞutiÚLi¡
, 
suµÜ‹d_»s
[
i
]);

513 
h·io
->
İtiÚ
[
OPTION_SCAN_RESOLUTION
].
cÚ¡¿št_ty³
 = 
SANE_CONSTRAINT_WORD_LIST
;

515  
SANE_STATUS_GOOD
;

516 
	}
}

518 
SANE_Stus
 
	$h·ioS‘DeçuÉV®ue
Ğ
h·ioSÿÂ”_t
 
h·io
, 
İtiÚ
 )

520  
İtiÚ
 )

522 
OPTION_SCAN_MODE
:

523 ifĞ
h·io
->
suµÜtsSÿnMode
[
SCAN_MODE_COLOR
] )

525 
h·io
->
cu¼’tSÿnMode
 = 
SCAN_MODE_COLOR
;

527 ifĞ
h·io
->
suµÜtsSÿnMode
[
SCAN_MODE_GRAYSCALE
] )

529 
h·io
->
cu¼’tSÿnMode
 = 
SCAN_MODE_GRAYSCALE
;

533 
h·io
->
cu¼’tSÿnMode
 = 
SCAN_MODE_LINEART
;

537 
OPTION_SCAN_RESOLUTION
:

538 ifĞ
h·io
->
İtiÚ
[
OPTION_SCAN_RESOLUTION
].
cÚ¡¿št_ty³
 =ğ
SANE_CONSTRAINT_WORD_LIST
 )

540 
h·io
->
cu¼’tResŞutiÚ
 = 
	`NumLi¡G‘Fœ¡
ĞĞ
SANE_IÁ
 * )

541 
h·io
->
İtiÚ
[
OPTION_SCAN_RESOLUTION
].
cÚ¡¿št
.
wÜd_li¡
 );

545 
h·io
->
cu¼’tResŞutiÚ
 = h·io->
»sŞutiÚRªge
.
mš
;

549 
OPTION_CONTRAST
:

550 
h·io
->
cu¼’tCÚŒa¡
 = h·io->
deçuÉCÚŒa¡
;

552 
OPTION_BRIGHTNESS
:

553 
h·io
->
cu¼’tBrighŠess
 = h·io->
deçuÉBrighŠess
;

556 
OPTION_COMPRESSION
:

558 
suµÜ‹dCom´essiÚ
 = 
h·io
->
suµÜtsSÿnMode
[h·io->
cu¼’tSÿnMode
];

559 
deçuÉCom´essiÚ
 = 
h·io
->deçuÉCom´essiÚ[h·io->
cu¼’tSÿnMode
];

561 ifĞ
suµÜ‹dCom´essiÚ
 & 
deçuÉCom´essiÚ
 )

563 
h·io
->
cu¼’tCom´essiÚ
 = 
deçuÉCom´essiÚ
;

565 ifĞ
suµÜ‹dCom´essiÚ
 & 
COMPRESSION_JPEG
 )

567 
h·io
->
cu¼’tCom´essiÚ
 = 
COMPRESSION_JPEG
;

569 ifĞ
suµÜ‹dCom´essiÚ
 & 
COMPRESSION_MH
 )

571 
h·io
->
cu¼’tCom´essiÚ
 = 
COMPRESSION_MH
;

573 ifĞ
suµÜ‹dCom´essiÚ
 & 
COMPRESSION_MR
 )

575 
h·io
->
cu¼’tCom´essiÚ
 = 
COMPRESSION_MR
;

577 ifĞ
suµÜ‹dCom´essiÚ
 & 
COMPRESSION_MMR
 )

579 
h·io
->
cu¼’tCom´essiÚ
 = 
COMPRESSION_MMR
;

583 
h·io
->
cu¼’tCom´essiÚ
 = 
COMPRESSION_NONE
;

588 
OPTION_JPEG_COMPRESSION_FACTOR
:

589 
h·io
->
cu¼’tJ³gCom´essiÚFaùÜ
 = h·io->
deçuÉJ³gCom´essiÚFaùÜ
;

592 
OPTION_BATCH_SCAN
:

593 
h·io
->
cu¼’tB©chSÿn
 = 
SANE_FALSE
;

596 
OPTION_ADF_MODE
:

597 ifĞ
h·io
->
suµÜ‹dAdfModes
 & 
ADF_MODE_AUTO
 )

599 ifĞ
h·io
->
sÿÂ”Ty³
 =ğ
SCANNER_TYPE_PML
 &&

600 !
h·io
->
pml
.
æ©bedC­ab™y
 &&

601 
h·io
->
suµÜ‹dAdfModes
 & 
ADF_MODE_ADF
 )

603 
deçuÉToAdf
;

605 
h·io
->
cu¼’tAdfMode
 = 
ADF_MODE_AUTO
;

607 ifĞ
h·io
->
suµÜ‹dAdfModes
 & 
ADF_MODE_FLATBED
 )

609 
h·io
->
cu¼’tAdfMode
 = 
ADF_MODE_FLATBED
;

611 ifĞ
h·io
->
suµÜ‹dAdfModes
 & 
ADF_MODE_ADF
 )

613 
deçuÉToAdf
:

614 
h·io
->
cu¼’tAdfMode
 = 
ADF_MODE_ADF
;

618 
h·io
->
cu¼’tAdfMode
 = 
ADF_MODE_AUTO
;

622 
OPTION_DUPLEX
:

623 
h·io
->
cu¼’tDu¶ex
 = 
SANE_FALSE
;

626 
OPTION_LENGTH_MEASUREMENT
:

627 
h·io
->
cu¼’tL’gthM—su»m’t
 = 
LENGTH_MEASUREMENT_PADDED
;

630 
OPTION_TL_X
:

631 
h·io
->
cu¼’tTlx
 = h·io->
xRªge
.
mš
;

634 
OPTION_TL_Y
:

635 
h·io
->
cu¼’tTly
 = h·io->
yRªge
.
mš
;

638 
OPTION_BR_X
:

639 
h·io
->
cu¼’tBrx
 = h·io->
brxRªge
.
max
;

642 
OPTION_BR_Y
:

643 
h·io
->
cu¼’tBry
 = h·io->
bryRªge
.
max
;

647  
SANE_STATUS_INVAL
;

650  
SANE_STATUS_GOOD
;

651 
	}
}

653 
	$h·ioUpd©eDesütÜs
Ğ
h·ioSÿÂ”_t
 
h·io
, 
İtiÚ
 )

655 
š™V®ues
 = ( 
İtiÚ
 =ğ
OPTION_FIRST
 );

656 
»lßd
 = 0;

659 ifĞ
š™V®ues
 )

661 
	`SŒLi¡CË¬
Ğ
h·io
->
sÿnModeLi¡
 );

662 ifĞ
h·io
->
suµÜtsSÿnMode
[
SCAN_MODE_LINEART
] )

664 
	`SŒLi¡Add
Ğ
h·io
->
sÿnModeLi¡
, 
SANE_VALUE_SCAN_MODE_LINEART
 );

666 ifĞ
h·io
->
suµÜtsSÿnMode
[
SCAN_MODE_GRAYSCALE
] )

668 
	`SŒLi¡Add
Ğ
h·io
->
sÿnModeLi¡
, 
SANE_VALUE_SCAN_MODE_GRAY
 );

670 ifĞ
h·io
->
suµÜtsSÿnMode
[
SCAN_MODE_COLOR
] )

672 
	`SŒLi¡Add
Ğ
h·io
->
sÿnModeLi¡
, 
SANE_VALUE_SCAN_MODE_COLOR
 );

674 
	`h·ioS‘DeçuÉV®ue
Ğ
h·io
, 
OPTION_SCAN_MODE
 );

675 
»lßd
 |ğ
SANE_INFO_RELOAD_OPTIONS
;

676 
»lßd
 |ğ
SANE_INFO_RELOAD_PARAMS
;

678 ifĞ
İtiÚ
 =ğ
OPTION_SCAN_MODE
 )

680 
»lßd
 |ğ
SANE_INFO_RELOAD_PARAMS
;

683 ià(
h·io
->
sÿÂ”Ty³
 =ğ
SCANNER_TYPE_SCL
)

684 
	`S‘ResŞutiÚLi¡SCL
(
h·io
);

687 ifĞ
h·io
->
İtiÚ
[
OPTION_SCAN_RESOLUTION
].
cÚ¡¿št_ty³
 ==

688 
SANE_CONSTRAINT_WORD_LIST
 )

690 
SANE_IÁ
 ** 
pLi¡
 = ( SANE_IÁ ** ) &
h·io
->
İtiÚ
[
OPTION_SCAN_RESOLUTION
].
cÚ¡¿št
.
wÜd_li¡
;

692 ifĞ
h·io
->
cu¼’tSÿnMode
 =ğ
SCAN_MODE_LINEART
 )

694 ifĞ*
pLi¡
 !ğ
h·io
->
lš—¹ResŞutiÚLi¡
 )

696 *
pLi¡
 = 
h·io
->
lš—¹ResŞutiÚLi¡
;

697 
»lßd
 |ğ
SANE_INFO_RELOAD_OPTIONS
;

702 ifĞ*
pLi¡
 !ğ
h·io
->
»sŞutiÚLi¡
 )

704 *
pLi¡
 = 
h·io
->
»sŞutiÚLi¡
;

705 
»lßd
 |ğ
SANE_INFO_RELOAD_OPTIONS
;

708 ifĞ
š™V®ues
 || !
	`NumLi¡IsInLi¡
Ğ*
pLi¡
,

709 
h·io
->
cu¼’tResŞutiÚ
 ) )

711 
	`h·ioS‘DeçuÉV®ue
Ğ
h·io
, 
OPTION_SCAN_RESOLUTION
 );

712 
»lßd
 |ğ
SANE_INFO_RELOAD_OPTIONS
;

713 
»lßd
 |ğ
SANE_INFO_RELOAD_PARAMS
;

718 ifĞ
š™V®ues
 ||

719 
h·io
->
cu¼’tResŞutiÚ
<h·io->
»sŞutiÚRªge
.
mš
 ||

720 
h·io
->
cu¼’tResŞutiÚ
>h·io->
»sŞutiÚRªge
.
max
 )

722 
	`h·ioS‘DeçuÉV®ue
Ğ
h·io
, 
OPTION_SCAN_RESOLUTION
 );

723 
»lßd
 |ğ
SANE_INFO_RELOAD_OPTIONS
;

724 
»lßd
 |ğ
SANE_INFO_RELOAD_PARAMS
;

727 ifĞ
İtiÚ
 =ğ
OPTION_SCAN_RESOLUTION
 )

729 
»lßd
 |ğ
SANE_INFO_RELOAD_PARAMS
;

733 ifĞ
š™V®ues
 )

735 
	`h·ioS‘DeçuÉV®ue
Ğ
h·io
, 
OPTION_CONTRAST
 );

736 
	`h·ioS‘DeçuÉV®ue
 (
h·io
, 
OPTION_BRIGHTNESS
);

737 
»lßd
 |ğ
SANE_INFO_RELOAD_OPTIONS
;

742 
suµÜ‹dCom´essiÚ
 = 
h·io
->
suµÜtsSÿnMode
[h·io->
cu¼’tSÿnMode
];

743 ifĞ
š™V®ues
 ||

744 !Ğ
suµÜ‹dCom´essiÚ
 & 
h·io
->
cu¼’tCom´essiÚ
 ) ||

745 ĞĞĞ
suµÜ‹dCom´essiÚ
 & 
COMPRESSION_NONE
 ) != 0 ) !=

746 Ğ
	`SŒLi¡IsInLi¡
Ğ
h·io
->
com´essiÚLi¡
,

747 
STR_COMPRESSION_NONE
 ) != 0 ) ) ||

748 ĞĞĞ
suµÜ‹dCom´essiÚ
 & 
COMPRESSION_MH
 ) != 0 ) !=

749 Ğ
	`SŒLi¡IsInLi¡
Ğ
h·io
->
com´essiÚLi¡
,

750 
STR_COMPRESSION_MH
 ) != 0 ) ) ||

751 ĞĞĞ
suµÜ‹dCom´essiÚ
 & 
COMPRESSION_MR
 ) != 0 ) !=

752 Ğ
	`SŒLi¡IsInLi¡
Ğ
h·io
->
com´essiÚLi¡
,

753 
STR_COMPRESSION_MR
 ) != 0 ) ) ||

754 ĞĞĞ
suµÜ‹dCom´essiÚ
 & 
COMPRESSION_MMR
 ) != 0 ) !=

755 Ğ
	`SŒLi¡IsInLi¡
Ğ
h·io
->
com´essiÚLi¡
,

756 
STR_COMPRESSION_MMR
 ) != 0 ) ) ||

757 ĞĞĞ
suµÜ‹dCom´essiÚ
 & 
COMPRESSION_JPEG
 ) != 0 ) !=

758 Ğ
	`SŒLi¡IsInLi¡
Ğ
h·io
->
com´essiÚLi¡
,

759 
STR_COMPRESSION_JPEG
 ) != 0 ) ) )

761 
	`SŒLi¡CË¬
Ğ
h·io
->
com´essiÚLi¡
 );

762 ifĞ
suµÜ‹dCom´essiÚ
 & 
COMPRESSION_NONE
 )

764 
	`SŒLi¡Add
Ğ
h·io
->
com´essiÚLi¡
, 
STR_COMPRESSION_NONE
 );

766 ifĞ
suµÜ‹dCom´essiÚ
 & 
COMPRESSION_MH
 )

768 
	`SŒLi¡Add
Ğ
h·io
->
com´essiÚLi¡
, 
STR_COMPRESSION_MH
 );

770 ifĞ
suµÜ‹dCom´essiÚ
 & 
COMPRESSION_MR
 )

772 
	`SŒLi¡Add
Ğ
h·io
->
com´essiÚLi¡
, 
STR_COMPRESSION_MR
 );

774 ifĞ
suµÜ‹dCom´essiÚ
 & 
COMPRESSION_MMR
 )

776 
	`SŒLi¡Add
Ğ
h·io
->
com´essiÚLi¡
, 
STR_COMPRESSION_MMR
 );

778 ifĞ
suµÜ‹dCom´essiÚ
 & 
COMPRESSION_JPEG
 )

780 
	`SŒLi¡Add
Ğ
h·io
->
com´essiÚLi¡
, 
STR_COMPRESSION_JPEG
 );

782 
	`h·ioS‘DeçuÉV®ue
Ğ
h·io
, 
OPTION_COMPRESSION
 );

783 
»lßd
 |ğ
SANE_INFO_RELOAD_OPTIONS
;

788 ifĞ
š™V®ues
 ||

789 ĞĞ
h·io
->
cu¼’tCom´essiÚ
 =ğ
COMPRESSION_JPEG
 ) !=

790 ĞĞ
h·io
->
İtiÚ
[
OPTION_JPEG_COMPRESSION_FACTOR
].
ÿp
 & 
SANE_CAP_INACTIVE
 ) == 0 ) ) )

792 ifĞ
h·io
->
cu¼’tCom´essiÚ
 =ğ
COMPRESSION_JPEG
 )

794 
h·io
->
İtiÚ
[
OPTION_JPEG_COMPRESSION_FACTOR
].
ÿp
 &ğ~
SANE_CAP_INACTIVE
;

798 
h·io
->
İtiÚ
[
OPTION_JPEG_COMPRESSION_FACTOR
].
ÿp
 |ğ
SANE_CAP_INACTIVE
;

800 
	`h·ioS‘DeçuÉV®ue
Ğ
h·io
, 
OPTION_JPEG_COMPRESSION_FACTOR
 );

801 
»lßd
 |ğ
SANE_INFO_RELOAD_OPTIONS
;

805 ifĞ
š™V®ues
 )

807 
	`h·ioS‘DeçuÉV®ue
Ğ
h·io
, 
OPTION_BATCH_SCAN
 );

808 ifĞ
h·io
->
´eD’®i
 )

810 
h·io
->
İtiÚ
[
OPTION_BATCH_SCAN
].
ÿp
 |ğ
SANE_CAP_INACTIVE
;

812 
»lßd
 |ğ
SANE_INFO_RELOAD_OPTIONS
;

814 ifĞ!
h·io
->
cu¼’tB©chSÿn
 )

816 
h·io
->
noDocsCÚd™iÚP’dšg
 = 0;

820 ifĞ
š™V®ues
 )

822 
	`SŒLi¡CË¬
Ğ
h·io
->
adfModeLi¡
 );

823 ifĞ
h·io
->
suµÜ‹dAdfModes
 & 
ADF_MODE_AUTO
 )

825 
	`SŒLi¡Add
Ğ
h·io
->
adfModeLi¡
, 
STR_ADF_MODE_AUTO
 );

827 ifĞ
h·io
->
suµÜ‹dAdfModes
 & 
ADF_MODE_FLATBED
 )

829 
	`SŒLi¡Add
Ğ
h·io
->
adfModeLi¡
, 
STR_ADF_MODE_FLATBED
 );

831 ifĞ
h·io
->
suµÜ‹dAdfModes
 & 
ADF_MODE_ADF
 )

833 
	`SŒLi¡Add
Ğ
h·io
->
adfModeLi¡
, 
STR_ADF_MODE_ADF
 );

835 
	`h·ioS‘DeçuÉV®ue
Ğ
h·io
, 
OPTION_ADF_MODE
 );

836 
»lßd
 |ğ
SANE_INFO_RELOAD_OPTIONS
;

841 ifĞ
š™V®ues
 ||

842 ĞĞ
h·io
->
suµÜtsDu¶ex
 &&

843 
h·io
->
cu¼’tAdfMode
 !ğ
ADF_MODE_FLATBED
 ) !=

844 ĞĞ
h·io
->
İtiÚ
[
OPTION_DUPLEX
].
ÿp
 & 
SANE_CAP_INACTIVE
 ) == 0 ) ) )

846 ifĞ
h·io
->
suµÜtsDu¶ex
 &&

847 
h·io
->
cu¼’tAdfMode
 !ğ
ADF_MODE_FLATBED
 )

849 
h·io
->
İtiÚ
[
OPTION_DUPLEX
].
ÿp
 &ğ~
SANE_CAP_INACTIVE
;

853 
h·io
->
İtiÚ
[
OPTION_DUPLEX
].
ÿp
 |ğ
SANE_CAP_INACTIVE
;

855 
	`h·ioS‘DeçuÉV®ue
Ğ
h·io
, 
OPTION_DUPLEX
 );

856 
»lßd
 |ğ
SANE_INFO_RELOAD_OPTIONS
;

861 ifĞ
š™V®ues
 )

863 
	`h·ioS‘DeçuÉV®ue
Ğ
h·io
, 
OPTION_LENGTH_MEASUREMENT
 );

864 
	`SŒLi¡CË¬
Ğ
h·io
->
ËngthM—su»m’tLi¡
 );

865 
	`SŒLi¡Add
Ğ
h·io
->
ËngthM—su»m’tLi¡
,

866 
STR_LENGTH_MEASUREMENT_UNKNOWN
 );

867 ifĞ
h·io
->
sÿÂ”Ty³
 =ğ
SCANNER_TYPE_PML
 )

869 
	`SŒLi¡Add
Ğ
h·io
->
ËngthM—su»m’tLi¡
,

870 
STR_LENGTH_MEASUREMENT_UNLIMITED
 );

872 
	`SŒLi¡Add
Ğ
h·io
->
ËngthM—su»m’tLi¡
,

873 
STR_LENGTH_MEASUREMENT_APPROXIMATE
 );

874 
	`SŒLi¡Add
Ğ
h·io
->
ËngthM—su»m’tLi¡
,

875 
STR_LENGTH_MEASUREMENT_PADDED
 );

881 ifĞ
š™V®ues
 )

883 
	`h·ioS‘DeçuÉV®ue
Ğ
h·io
, 
OPTION_TL_X
 );

884 
	`h·ioS‘DeçuÉV®ue
Ğ
h·io
, 
OPTION_TL_Y
 );

885 
	`h·ioS‘DeçuÉV®ue
Ğ
h·io
, 
OPTION_BR_X
 );

886 
	`h·ioS‘DeçuÉV®ue
Ğ
h·io
, 
OPTION_BR_Y
 );

887 
»lßd
 |ğ
SANE_INFO_RELOAD_OPTIONS
;

888 
´oûssGeom‘ry
;

890 ifĞ
İtiÚ
 =ğ
OPTION_TL_X
 ||

891 
İtiÚ
 =ğ
OPTION_TL_Y
 ||

892 
İtiÚ
 =ğ
OPTION_BR_X
 ||

893 
İtiÚ
 =ğ
OPTION_BR_Y
 )

895 
´oûssGeom‘ry
 : 
h·io
->
efãùiveTlx
 = h·io->
cu¼’tTlx
;

896 
h·io
->
efãùiveBrx
 = h·io->
cu¼’tBrx
;

897 
	`FIX_GEOMETRY
Ğ
h·io
->
efãùiveTlx
,

898 
h·io
->
efãùiveBrx
,

899 
h·io
->
brxRªge
.
mš
,

900 
h·io
->
brxRªge
.
max
 );

901 
h·io
->
efãùiveTly
 = h·io->
cu¼’tTly
;

902 
h·io
->
efãùiveBry
 = h·io->
cu¼’tBry
;

903 
	`FIX_GEOMETRY
Ğ
h·io
->
efãùiveTly
,

904 
h·io
->
efãùiveBry
,

905 
h·io
->
bryRªge
.
mš
,

906 
h·io
->
bryRªge
.
max
 );

907 
»lßd
 |ğ
SANE_INFO_RELOAD_PARAMS
;

909 ifĞĞ
h·io
->
cu¼’tL’gthM—su»m’t
 !ğ
LENGTH_MEASUREMENT_UNLIMITED
 ) !=

910 ĞĞ
h·io
->
İtiÚ
[
OPTION_BR_Y
].
ÿp
 & 
SANE_CAP_INACTIVE
 ) == 0 ) )

912 ifĞ
h·io
->
cu¼’tL’gthM—su»m’t
 =ğ
LENGTH_MEASUREMENT_UNLIMITED
 )

914 
h·io
->
İtiÚ
[
OPTION_BR_Y
].
ÿp
 |ğ
SANE_CAP_INACTIVE
;

918 
h·io
->
İtiÚ
[
OPTION_BR_Y
].
ÿp
 &ğ~
SANE_CAP_INACTIVE
;

920 
»lßd
 |ğ
SANE_INFO_RELOAD_OPTIONS
;

924 ifĞ
»lßd
 & 
SANE_INFO_RELOAD_PARAMS
 )

926  
h·io
->
cu¼’tSÿnMode
 )

928 
SCAN_MODE_LINEART
:

929 
h·io
->
´esÿnP¬am‘”s
.
fÜm©
 = 
SANE_FRAME_GRAY
;

930 
h·io
->
´esÿnP¬am‘”s
.
d•th
 = 1;

933 
SCAN_MODE_GRAYSCALE
:

934 
h·io
->
´esÿnP¬am‘”s
.
fÜm©
 = 
SANE_FRAME_GRAY
;

935 
h·io
->
´esÿnP¬am‘”s
.
d•th
 = 8;

938 
SCAN_MODE_COLOR
:

940 
h·io
->
´esÿnP¬am‘”s
.
fÜm©
 = 
SANE_FRAME_RGB
;

941 
h·io
->
´esÿnP¬am‘”s
.
d•th
 = 8;

944 
h·io
->
´esÿnP¬am‘”s
.
Ï¡_äame
 = 
SANE_TRUE
;

947 
h·io
->
´esÿnP¬am‘”s
.
lšes
 = 
	`MILLIMETERS_TO_PIXELS
Ğh·io->
efãùiveBry
 - h·io->
efãùiveTly
,

948 
h·io
->
cu¼’tResŞutiÚ
 );

950 
h·io
->
´esÿnP¬am‘”s
.
pix–s_³r_lše
 = 
	`MILLIMETERS_TO_PIXELS
Ğh·io->
efãùiveBrx
 - h·io->
efãùiveTlx
,

951 
h·io
->
cu¼’tResŞutiÚ
 );

953 
h·io
->
´esÿnP¬am‘”s
.
by‹s_³r_lše
 = 
	`BYTES_PER_LINE
Ğh·io->´esÿnP¬am‘”s.
pix–s_³r_lše
,

954 
h·io
->
´esÿnP¬am‘”s
.
d•th
 * ( h·io->´esÿnP¬am‘”s.
fÜm©
 ==

955 
SANE_FRAME_RGB
 ?

960  
»lßd
;

961 
	}
}

963 
	$š™_İtiÚs
Ğ
h·ioSÿÂ”_t
 
h·io
 )

965 
h·io
->
İtiÚ
[
OPTION_NUM_OPTIONS
].
Çme
 = 
SANE_NAME_NUM_OPTIONS
;

966 
h·io
->
İtiÚ
[
OPTION_NUM_OPTIONS
].
t™Ë
 = 
SANE_TITLE_NUM_OPTIONS
;

967 
h·io
->
İtiÚ
[
OPTION_NUM_OPTIONS
].
desc
 = 
SANE_DESC_NUM_OPTIONS
;

968 
h·io
->
İtiÚ
[
OPTION_NUM_OPTIONS
].
ty³
 = 
SANE_TYPE_INT
;

969 
h·io
->
İtiÚ
[
OPTION_NUM_OPTIONS
].
un™
 = 
SANE_UNIT_NONE
;

970 
h·io
->
İtiÚ
[
OPTION_NUM_OPTIONS
].
size
 = Ğ
SANE_IÁ
 );

971 
h·io
->
İtiÚ
[
OPTION_NUM_OPTIONS
].
ÿp
 = 
SANE_CAP_SOFT_DETECT
;

972 
h·io
->
İtiÚ
[
OPTION_NUM_OPTIONS
].
cÚ¡¿št_ty³
 = 
SANE_CONSTRAINT_NONE
;

974 
h·io
->
İtiÚ
[
GROUP_SCAN_MODE
].
t™Ë
 = 
SANE_TITLE_SCAN_MODE
;

975 
h·io
->
İtiÚ
[
GROUP_SCAN_MODE
].
ty³
 = 
SANE_TYPE_GROUP
;

977 
h·io
->
İtiÚ
[
OPTION_SCAN_MODE
].
Çme
 = 
SANE_NAME_SCAN_MODE
;

978 
h·io
->
İtiÚ
[
OPTION_SCAN_MODE
].
t™Ë
 = 
SANE_TITLE_SCAN_MODE
;

979 
h·io
->
İtiÚ
[
OPTION_SCAN_MODE
].
desc
 = 
SANE_DESC_SCAN_MODE
;

980 
h·io
->
İtiÚ
[
OPTION_SCAN_MODE
].
ty³
 = 
SANE_TYPE_STRING
;

981 
h·io
->
İtiÚ
[
OPTION_SCAN_MODE
].
un™
 = 
SANE_UNIT_NONE
;

982 
h·io
->
İtiÚ
[
OPTION_SCAN_MODE
].
size
 = 
LEN_STRING_OPTION_VALUE
;

983 
h·io
->
İtiÚ
[
OPTION_SCAN_MODE
].
ÿp
 = 
SANE_CAP_SOFT_SELECT
 |

984 
SANE_CAP_SOFT_DETECT
;

985 
h·io
->
İtiÚ
[
OPTION_SCAN_MODE
].
cÚ¡¿št_ty³
 = 
SANE_CONSTRAINT_STRING_LIST
;

986 
h·io
->
İtiÚ
[
OPTION_SCAN_MODE
].
cÚ¡¿št
.
¡ršg_li¡
 = h·io->
sÿnModeLi¡
;

988 
h·io
->
İtiÚ
[
OPTION_SCAN_RESOLUTION
].
Çme
 = 
SANE_NAME_SCAN_RESOLUTION
;

989 
h·io
->
İtiÚ
[
OPTION_SCAN_RESOLUTION
].
t™Ë
 = 
SANE_TITLE_SCAN_RESOLUTION
;

990 
h·io
->
İtiÚ
[
OPTION_SCAN_RESOLUTION
].
desc
 = 
SANE_DESC_SCAN_RESOLUTION
;

991 
h·io
->
İtiÚ
[
OPTION_SCAN_RESOLUTION
].
ty³
 = 
SANE_TYPE_INT
;

992 
h·io
->
İtiÚ
[
OPTION_SCAN_RESOLUTION
].
un™
 = 
SANE_UNIT_DPI
;

993 
h·io
->
İtiÚ
[
OPTION_SCAN_RESOLUTION
].
size
 = Ğ
SANE_IÁ
 );

994 
h·io
->
İtiÚ
[
OPTION_SCAN_RESOLUTION
].
ÿp
 = 
SANE_CAP_SOFT_SELECT
 |

995 
SANE_CAP_SOFT_DETECT
;

996 
h·io
->
İtiÚ
[
OPTION_SCAN_RESOLUTION
].
cÚ¡¿št_ty³
 = 
SANE_CONSTRAINT_RANGE
;

997 
h·io
->
İtiÚ
[
OPTION_SCAN_RESOLUTION
].
cÚ¡¿št
.
¿nge
 = &h·io->
»sŞutiÚRªge
;

998 
h·io
->
»sŞutiÚRªge
.
quªt
 = 0;

1000 
h·io
->
İtiÚ
[
GROUP_ADVANCED
].
t™Ë
 = 
STR_TITLE_ADVANCED
;

1001 
h·io
->
İtiÚ
[
GROUP_ADVANCED
].
ty³
 = 
SANE_TYPE_GROUP
;

1002 
h·io
->
İtiÚ
[
GROUP_ADVANCED
].
ÿp
 = 
SANE_CAP_ADVANCED
;

1004 
h·io
->
İtiÚ
[
OPTION_CONTRAST
].
Çme
 = 
SANE_NAME_CONTRAST
;

1005 
h·io
->
İtiÚ
[
OPTION_CONTRAST
].
t™Ë
 = 
SANE_TITLE_CONTRAST
;

1006 
h·io
->
İtiÚ
[
OPTION_CONTRAST
].
desc
 = 
SANE_DESC_CONTRAST
;

1007 
h·io
->
İtiÚ
[
OPTION_CONTRAST
].
ty³
 = 
SANE_TYPE_INT
;

1008 
h·io
->
İtiÚ
[
OPTION_CONTRAST
].
un™
 = 
SANE_UNIT_NONE
;

1009 
h·io
->
İtiÚ
[
OPTION_CONTRAST
].
size
 = Ğ
SANE_IÁ
 );

1010 
h·io
->
İtiÚ
[
OPTION_CONTRAST
].
ÿp
 = 
SANE_CAP_SOFT_SELECT
 |

1011 
SANE_CAP_SOFT_DETECT
 |

1012 
SANE_CAP_ADVANCED
;

1013 
h·io
->
İtiÚ
[
OPTION_CONTRAST
].
cÚ¡¿št_ty³
 = 
SANE_CONSTRAINT_RANGE
;

1014 
h·io
->
İtiÚ
[
OPTION_CONTRAST
].
cÚ¡¿št
.
¿nge
 = &h·io->
cÚŒa¡Rªge
;

1015 
h·io
->
cÚŒa¡Rªge
.
mš
 = 
PML_CONTRAST_MIN
;

1016 
h·io
->
cÚŒa¡Rªge
.
max
 = 
PML_CONTRAST_MAX
;

1017 
h·io
->
cÚŒa¡Rªge
.
quªt
 = 0;

1018 
h·io
->
deçuÉCÚŒa¡
 = 
PML_CONTRAST_DEFAULT
;

1020 
h·io
->
İtiÚ
[
OPTION_BRIGHTNESS
].
Çme
 = 
SANE_NAME_BRIGHTNESS
;

1021 
h·io
->
İtiÚ
[
OPTION_BRIGHTNESS
].
t™Ë
 = 
SANE_TITLE_BRIGHTNESS
;

1022 
h·io
->
İtiÚ
[
OPTION_BRIGHTNESS
].
desc
 = 
SANE_DESC_BRIGHTNESS
;

1023 
h·io
->
İtiÚ
[
OPTION_BRIGHTNESS
].
ty³
 = 
SANE_TYPE_INT
;

1024 
h·io
->
İtiÚ
[
OPTION_BRIGHTNESS
].
un™
 = 
SANE_UNIT_NONE
;

1025 
h·io
->
İtiÚ
[
OPTION_BRIGHTNESS
].
size
 = Ğ
SANE_IÁ
 );

1026 
h·io
->
İtiÚ
[
OPTION_BRIGHTNESS
].
ÿp
 = 
SANE_CAP_SOFT_SELECT
 |

1027 
SANE_CAP_SOFT_DETECT
 |

1028 
SANE_CAP_ADVANCED
;

1029 
h·io
->
İtiÚ
[
OPTION_BRIGHTNESS
].
cÚ¡¿št_ty³
 = 
SANE_CONSTRAINT_RANGE
;

1030 
h·io
->
İtiÚ
[
OPTION_BRIGHTNESS
].
cÚ¡¿št
.
¿nge
 = &h·io->
brighŠessRªge
;

1031 
h·io
->
brighŠessRªge
.
mš
 = 
PML_BRIGHTNESS_MIN
;

1032 
h·io
->
brighŠessRªge
.
max
 = 
PML_BRIGHTNESS_MAX
;

1033 
h·io
->
brighŠessRªge
.
quªt
 = 0;

1034 
h·io
->
deçuÉBrighŠess
 = 
PML_BRIGHTNESS_DEFAULT
;

1036 
h·io
->
İtiÚ
[
OPTION_COMPRESSION
].
Çme
 = 
STR_NAME_COMPRESSION
;

1037 
h·io
->
İtiÚ
[
OPTION_COMPRESSION
].
t™Ë
 = 
STR_TITLE_COMPRESSION
;

1038 
h·io
->
İtiÚ
[
OPTION_COMPRESSION
].
desc
 = 
STR_DESC_COMPRESSION
;

1039 
h·io
->
İtiÚ
[
OPTION_COMPRESSION
].
ty³
 = 
SANE_TYPE_STRING
;

1040 
h·io
->
İtiÚ
[
OPTION_COMPRESSION
].
un™
 = 
SANE_UNIT_NONE
;

1041 
h·io
->
İtiÚ
[
OPTION_COMPRESSION
].
size
 = 
LEN_STRING_OPTION_VALUE
;

1042 
h·io
->
İtiÚ
[
OPTION_COMPRESSION
].
ÿp
 = 
SANE_CAP_SOFT_SELECT
 |

1043 
SANE_CAP_SOFT_DETECT
 |

1044 
SANE_CAP_ADVANCED
;

1045 
h·io
->
İtiÚ
[
OPTION_COMPRESSION
].
cÚ¡¿št_ty³
 = 
SANE_CONSTRAINT_STRING_LIST
;

1046 
h·io
->
İtiÚ
[
OPTION_COMPRESSION
].
cÚ¡¿št
.
¡ršg_li¡
 = h·io->
com´essiÚLi¡
;

1048 
h·io
->
İtiÚ
[
OPTION_JPEG_COMPRESSION_FACTOR
].
Çme
 = 
STR_NAME_JPEG_QUALITY
;

1049 
h·io
->
İtiÚ
[
OPTION_JPEG_COMPRESSION_FACTOR
].
t™Ë
 = 
STR_TITLE_JPEG_QUALITY
;

1050 
h·io
->
İtiÚ
[
OPTION_JPEG_COMPRESSION_FACTOR
].
desc
 = 
STR_DESC_JPEG_QUALITY
;

1051 
h·io
->
İtiÚ
[
OPTION_JPEG_COMPRESSION_FACTOR
].
ty³
 = 
SANE_TYPE_INT
;

1052 
h·io
->
İtiÚ
[
OPTION_JPEG_COMPRESSION_FACTOR
].
un™
 = 
SANE_UNIT_NONE
;

1053 
h·io
->
İtiÚ
[
OPTION_JPEG_COMPRESSION_FACTOR
].
size
 = Ğ
SANE_IÁ
 );

1054 
h·io
->
İtiÚ
[
OPTION_JPEG_COMPRESSION_FACTOR
].
ÿp
 = 
SANE_CAP_SOFT_SELECT
 |

1055 
SANE_CAP_SOFT_DETECT
 |

1056 
SANE_CAP_ADVANCED
;

1057 
h·io
->
İtiÚ
[
OPTION_JPEG_COMPRESSION_FACTOR
].
cÚ¡¿št_ty³
 = 
SANE_CONSTRAINT_RANGE
;

1058 
h·io
->
İtiÚ
[
OPTION_JPEG_COMPRESSION_FACTOR
].
cÚ¡¿št
.
¿nge
 = &h·io->
j³gCom´essiÚFaùÜRªge
;

1059 
h·io
->
j³gCom´essiÚFaùÜRªge
.
mš
 = 
MIN_JPEG_COMPRESSION_FACTOR
;

1060 
h·io
->
j³gCom´essiÚFaùÜRªge
.
max
 = 
MAX_JPEG_COMPRESSION_FACTOR
;

1061 
h·io
->
j³gCom´essiÚFaùÜRªge
.
quªt
 = 0;

1062 
h·io
->
deçuÉJ³gCom´essiÚFaùÜ
 = 
SAFER_JPEG_COMPRESSION_FACTOR
;

1064 
h·io
->
İtiÚ
[
OPTION_BATCH_SCAN
].
Çme
 = 
STR_NAME_BATCH_SCAN
;

1065 
h·io
->
İtiÚ
[
OPTION_BATCH_SCAN
].
t™Ë
 = 
STR_TITLE_BATCH_SCAN
;

1066 
h·io
->
İtiÚ
[
OPTION_BATCH_SCAN
].
desc
 = 
STR_DESC_BATCH_SCAN
;

1067 
h·io
->
İtiÚ
[
OPTION_BATCH_SCAN
].
ty³
 = 
SANE_TYPE_BOOL
;

1068 
h·io
->
İtiÚ
[
OPTION_BATCH_SCAN
].
un™
 = 
SANE_UNIT_NONE
;

1069 
h·io
->
İtiÚ
[
OPTION_BATCH_SCAN
].
size
 = Ğ
SANE_BoŞ
 );

1070 
h·io
->
İtiÚ
[
OPTION_BATCH_SCAN
].
ÿp
 = 
SANE_CAP_SOFT_SELECT
 |

1071 
SANE_CAP_SOFT_DETECT
 |

1072 
SANE_CAP_ADVANCED
;

1073 
h·io
->
İtiÚ
[
OPTION_BATCH_SCAN
].
cÚ¡¿št_ty³
 = 
SANE_CONSTRAINT_NONE
;

1075 
h·io
->
İtiÚ
[
OPTION_ADF_MODE
].
Çme
 = 
SANE_NAME_SCAN_SOURCE
;

1076 
h·io
->
İtiÚ
[
OPTION_ADF_MODE
].
t™Ë
 = 
SANE_TITLE_SCAN_SOURCE
;

1077 
h·io
->
İtiÚ
[
OPTION_ADF_MODE
].
desc
 = 
SANE_DESC_SCAN_SOURCE
;

1078 
h·io
->
İtiÚ
[
OPTION_ADF_MODE
].
ty³
 = 
SANE_TYPE_STRING
;

1079 
h·io
->
İtiÚ
[
OPTION_ADF_MODE
].
un™
 = 
SANE_UNIT_NONE
;

1080 
h·io
->
İtiÚ
[
OPTION_ADF_MODE
].
size
 = 
LEN_STRING_OPTION_VALUE
;

1081 
h·io
->
İtiÚ
[
OPTION_ADF_MODE
].
ÿp
 = 
SANE_CAP_SOFT_SELECT
 |

1082 
SANE_CAP_SOFT_DETECT
 |

1083 
SANE_CAP_ADVANCED
;

1084 
h·io
->
İtiÚ
[
OPTION_ADF_MODE
].
cÚ¡¿št_ty³
 = 
SANE_CONSTRAINT_STRING_LIST
;

1085 
h·io
->
İtiÚ
[
OPTION_ADF_MODE
].
cÚ¡¿št
.
¡ršg_li¡
 = h·io->
adfModeLi¡
;

1088 ià(
h·io
->
suµÜtsDu¶ex
 == 1)

1090 
h·io
->
İtiÚ
[
OPTION_DUPLEX
].
Çme
 = 
STR_NAME_DUPLEX
;

1091 
h·io
->
İtiÚ
[
OPTION_DUPLEX
].
t™Ë
 = 
STR_TITLE_DUPLEX
;

1092 
h·io
->
İtiÚ
[
OPTION_DUPLEX
].
desc
 = 
STR_DESC_DUPLEX
;

1093 
h·io
->
İtiÚ
[
OPTION_DUPLEX
].
ty³
 = 
SANE_TYPE_BOOL
;

1094 
h·io
->
İtiÚ
[
OPTION_DUPLEX
].
un™
 = 
SANE_UNIT_NONE
;

1095 
h·io
->
İtiÚ
[
OPTION_DUPLEX
].
size
 = Ğ
SANE_BoŞ
 );

1096 
h·io
->
İtiÚ
[
OPTION_DUPLEX
].
ÿp
 = 
SANE_CAP_SOFT_SELECT
 |

1097 
SANE_CAP_SOFT_DETECT
 |

1098 
SANE_CAP_ADVANCED
;

1099 
h·io
->
İtiÚ
[
OPTION_DUPLEX
].
cÚ¡¿št_ty³
 = 
SANE_CONSTRAINT_NONE
;

1101 
h·io
->
İtiÚ
[
GROUP_GEOMETRY
].
t™Ë
 = 
STR_TITLE_GEOMETRY
;

1102 
h·io
->
İtiÚ
[
GROUP_GEOMETRY
].
ty³
 = 
SANE_TYPE_GROUP
;

1103 
h·io
->
İtiÚ
[
GROUP_GEOMETRY
].
ÿp
 = 
SANE_CAP_ADVANCED
;

1105 
h·io
->
İtiÚ
[
OPTION_LENGTH_MEASUREMENT
].
Çme
 = 
STR_NAME_LENGTH_MEASUREMENT
;

1106 
h·io
->
İtiÚ
[
OPTION_LENGTH_MEASUREMENT
].
t™Ë
 = 
STR_TITLE_LENGTH_MEASUREMENT
;

1107 
h·io
->
İtiÚ
[
OPTION_LENGTH_MEASUREMENT
].
desc
 = 
STR_DESC_LENGTH_MEASUREMENT
;

1108 
h·io
->
İtiÚ
[
OPTION_LENGTH_MEASUREMENT
].
ty³
 = 
SANE_TYPE_STRING
;

1109 
h·io
->
İtiÚ
[
OPTION_LENGTH_MEASUREMENT
].
un™
 = 
SANE_UNIT_NONE
;

1110 
h·io
->
İtiÚ
[
OPTION_LENGTH_MEASUREMENT
].
size
 = 
LEN_STRING_OPTION_VALUE
;

1111 
h·io
->
İtiÚ
[
OPTION_LENGTH_MEASUREMENT
].
ÿp
 = 
SANE_CAP_SOFT_SELECT
 |

1112 
SANE_CAP_SOFT_DETECT
 |

1113 
SANE_CAP_ADVANCED
;

1114 
h·io
->
İtiÚ
[
OPTION_LENGTH_MEASUREMENT
].
cÚ¡¿št_ty³
 = 
SANE_CONSTRAINT_STRING_LIST
;

1115 
h·io
->
İtiÚ
[
OPTION_LENGTH_MEASUREMENT
].
cÚ¡¿št
.
¡ršg_li¡
 = h·io->
ËngthM—su»m’tLi¡
;

1117 
h·io
->
İtiÚ
[
OPTION_TL_X
].
Çme
 = 
SANE_NAME_SCAN_TL_X
;

1118 
h·io
->
İtiÚ
[
OPTION_TL_X
].
t™Ë
 = 
SANE_TITLE_SCAN_TL_X
;

1119 
h·io
->
İtiÚ
[
OPTION_TL_X
].
desc
 = 
SANE_DESC_SCAN_TL_X
;

1120 
h·io
->
İtiÚ
[
OPTION_TL_X
].
ty³
 = 
GEOMETRY_OPTION_TYPE
;

1121 
h·io
->
İtiÚ
[
OPTION_TL_X
].
un™
 = 
SANE_UNIT_MM
;

1122 
h·io
->
İtiÚ
[
OPTION_TL_X
].
size
 = Ğ
SANE_IÁ
 );

1123 
h·io
->
İtiÚ
[
OPTION_TL_X
].
ÿp
 = 
SANE_CAP_SOFT_SELECT
 |

1124 
SANE_CAP_SOFT_DETECT
;

1125 
h·io
->
İtiÚ
[
OPTION_TL_X
].
cÚ¡¿št_ty³
 = 
SANE_CONSTRAINT_RANGE
;

1126 
h·io
->
İtiÚ
[
OPTION_TL_X
].
cÚ¡¿št
.
¿nge
 = &h·io->
xRªge
;

1127 
h·io
->
xRªge
.
mš
 = 0;

1128 
h·io
->
xRªge
.
quªt
 = 0;

1130 
h·io
->
İtiÚ
[
OPTION_TL_Y
].
Çme
 = 
SANE_NAME_SCAN_TL_Y
;

1131 
h·io
->
İtiÚ
[
OPTION_TL_Y
].
t™Ë
 = 
SANE_TITLE_SCAN_TL_Y
;

1132 
h·io
->
İtiÚ
[
OPTION_TL_Y
].
desc
 = 
SANE_DESC_SCAN_TL_Y
;

1133 
h·io
->
İtiÚ
[
OPTION_TL_Y
].
ty³
 = 
GEOMETRY_OPTION_TYPE
;

1134 
h·io
->
İtiÚ
[
OPTION_TL_Y
].
un™
 = 
SANE_UNIT_MM
;

1135 
h·io
->
İtiÚ
[
OPTION_TL_Y
].
size
 = Ğ
SANE_IÁ
 );

1136 
h·io
->
İtiÚ
[
OPTION_TL_Y
].
ÿp
 = 
SANE_CAP_SOFT_SELECT
 |

1137 
SANE_CAP_SOFT_DETECT
;

1138 
h·io
->
İtiÚ
[
OPTION_TL_Y
].
cÚ¡¿št_ty³
 = 
SANE_CONSTRAINT_RANGE
;

1139 
h·io
->
İtiÚ
[
OPTION_TL_Y
].
cÚ¡¿št
.
¿nge
 = &h·io->
yRªge
;

1140 
h·io
->
yRªge
.
mš
 = 0;

1141 
h·io
->
yRªge
.
quªt
 = 0;

1143 
h·io
->
İtiÚ
[
OPTION_BR_X
].
Çme
 = 
SANE_NAME_SCAN_BR_X
;

1144 
h·io
->
İtiÚ
[
OPTION_BR_X
].
t™Ë
 = 
SANE_TITLE_SCAN_BR_X
;

1145 
h·io
->
İtiÚ
[
OPTION_BR_X
].
desc
 = 
SANE_DESC_SCAN_BR_X
;

1146 
h·io
->
İtiÚ
[
OPTION_BR_X
].
ty³
 = 
GEOMETRY_OPTION_TYPE
;

1147 
h·io
->
İtiÚ
[
OPTION_BR_X
].
un™
 = 
SANE_UNIT_MM
;

1148 
h·io
->
İtiÚ
[
OPTION_BR_X
].
size
 = Ğ
SANE_IÁ
 );

1149 
h·io
->
İtiÚ
[
OPTION_BR_X
].
ÿp
 = 
SANE_CAP_SOFT_SELECT
 |

1150 
SANE_CAP_SOFT_DETECT
;

1151 
h·io
->
İtiÚ
[
OPTION_BR_X
].
cÚ¡¿št_ty³
 = 
SANE_CONSTRAINT_RANGE
;

1152 
h·io
->
İtiÚ
[
OPTION_BR_X
].
cÚ¡¿št
.
¿nge
 = &h·io->
brxRªge
;

1153 
h·io
->
brxRªge
.
mš
 = 0;

1154 
h·io
->
brxRªge
.
quªt
 = 0;

1156 
h·io
->
İtiÚ
[
OPTION_BR_Y
].
Çme
 = 
SANE_NAME_SCAN_BR_Y
;

1157 
h·io
->
İtiÚ
[
OPTION_BR_Y
].
t™Ë
 = 
SANE_TITLE_SCAN_BR_Y
;

1158 
h·io
->
İtiÚ
[
OPTION_BR_Y
].
desc
 = 
SANE_DESC_SCAN_BR_Y
;

1159 
h·io
->
İtiÚ
[
OPTION_BR_Y
].
ty³
 = 
GEOMETRY_OPTION_TYPE
;

1160 
h·io
->
İtiÚ
[
OPTION_BR_Y
].
un™
 = 
SANE_UNIT_MM
;

1161 
h·io
->
İtiÚ
[
OPTION_BR_Y
].
size
 = Ğ
SANE_IÁ
 );

1162 
h·io
->
İtiÚ
[
OPTION_BR_Y
].
ÿp
 = 
SANE_CAP_SOFT_SELECT
 |

1163 
SANE_CAP_SOFT_DETECT
;

1164 
h·io
->
İtiÚ
[
OPTION_BR_Y
].
cÚ¡¿št_ty³
 = 
SANE_CONSTRAINT_RANGE
;

1165 
h·io
->
İtiÚ
[
OPTION_BR_Y
].
cÚ¡¿št
.
¿nge
 = &h·io->
bryRªge
;

1166 
h·io
->
bryRªge
.
mš
 = 0;

1167 
h·io
->
bryRªge
.
quªt
 = 0;

1168 
	}
}

1170 
	$h·ioSşS’dCommªdCheckE¼Ü
Ğ
h·ioSÿÂ”_t
 
h·io
, 
cmd
, 
·¿m
 )

1172 
SANE_Stus
 
»tcode
;

1174 
	`SşS’dCommªd
Ğ
h·io
->
deviûid
, h·io->
sÿn_chªÃlid
, 
SCL_CMD_CLEAR_ERROR_STACK
, 0 );

1176 
»tcode
 = 
	`SşS’dCommªd
Ğ
h·io
->
deviûid
, h·io->
sÿn_chªÃlid
, 
cmd
, 
·¿m
 );

1178 ifĞ
»tcode
 =ğ
SANE_STATUS_GOOD
 &&

1179 ĞĞ
cmd
 !ğ
SCL_CMD_CHANGE_DOCUMENT
 && cmd !ğ
SCL_CMD_UNLOAD_DOCUMENT
 ) ||

1180 
h·io
->
befÜeSÿn
 ) )

1182 
»tcode
 = 
	`h·ioSÿÂ”ToSªeE¼Ü
Ğ
h·io
 );

1185  
»tcode
;

1186 
	}
}

1188 
SANE_Stus
 
	$h·ioProg¿mO±iÚs
Ğ
h·ioSÿÂ”_t
 
h·io
 )

1190 
by‹s_wrÙe
;

1192 
h·io
->
efãùiveSÿnMode
 = h·io->
cu¼’tSÿnMode
;

1193 
h·io
->
efãùiveResŞutiÚ
 = h·io->
cu¼’tResŞutiÚ
;

1196  
h·io
->
cu¼’tSÿnMode
 )

1198 
SCAN_MODE_LINEART
:

1199 
	`SşS’dCommªd
Ğ
h·io
->
deviûid
, h·io->
sÿn_chªÃlid
,

1200 
SCL_CMD_SET_OUTPUT_DATA_TYPE
,

1201 
SCL_DATA_TYPE_LINEART
 );

1202 
	`SşS’dCommªd
Ğ
h·io
->
deviûid
, h·io->
sÿn_chªÃlid
,

1203 
SCL_CMD_SET_DATA_WIDTH
,

1204 
SCL_DATA_WIDTH_LINEART
 );

1207 
SCAN_MODE_GRAYSCALE
:

1208 
	`SşS’dCommªd
Ğ
h·io
->
deviûid
, h·io->
sÿn_chªÃlid
,

1209 
SCL_CMD_SET_OUTPUT_DATA_TYPE
,

1210 
SCL_DATA_TYPE_GRAYSCALE
 );

1211 
	`SşS’dCommªd
Ğ
h·io
->
deviûid
, h·io->
sÿn_chªÃlid
,

1212 
SCL_CMD_SET_DATA_WIDTH
,

1213 
SCL_DATA_WIDTH_GRAYSCALE
 );

1216 
SCAN_MODE_COLOR
:

1218 
	`SşS’dCommªd
Ğ
h·io
->
deviûid
, h·io->
sÿn_chªÃlid
,

1219 
SCL_CMD_SET_OUTPUT_DATA_TYPE
,

1220 
SCL_DATA_TYPE_COLOR
 );

1221 
	`SşS’dCommªd
Ğ
h·io
->
deviûid
, h·io->
sÿn_chªÃlid
,

1222 
SCL_CMD_SET_DATA_WIDTH
,

1223 
SCL_DATA_WIDTH_COLOR
 );

1228 
	`SşS’dCommªd
Ğ
h·io
->
deviûid
, h·io->
sÿn_chªÃlid
,

1229 
SCL_CMD_SET_MFPDTF
,

1230 
h·io
->
mådtf
 ? 
SCL_MFPDTF_ON
 : 
SCL_MFPDTF_OFF
 );

1233 
	`SşS’dCommªd
Ğ
h·io
->
deviûid
, h·io->
sÿn_chªÃlid
,

1234 
SCL_CMD_SET_COMPRESSION
,

1235 Ğ
h·io
->
cu¼’tCom´essiÚ
 ==

1236 
COMPRESSION_JPEG
 ? 
SCL_COMPRESSION_JPEG
 : 
SCL_COMPRESSION_NONE
 ) );

1239 
	`SşS’dCommªd
Ğ
h·io
->
deviûid
, h·io->
sÿn_chªÃlid
,

1240 
SCL_CMD_SET_JPEG_COMPRESSION_FACTOR
,

1241 
h·io
->
cu¼’tJ³gCom´essiÚFaùÜ
 );

1244 
	`SşS’dCommªd
Ğ
h·io
->
deviûid
, h·io->
sÿn_chªÃlid
,

1245 
SCL_CMD_SET_X_RESOLUTION
,

1246 
h·io
->
cu¼’tResŞutiÚ
 );

1248 
	`SşS’dCommªd
Ğ
h·io
->
deviûid
, h·io->
sÿn_chªÃlid
,

1249 
SCL_CMD_SET_Y_RESOLUTION
,

1250 
h·io
->
cu¼’tResŞutiÚ
 );

1253 
	`SşS’dCommªd
Ğ
h·io
->
deviûid
, h·io->
sÿn_chªÃlid
,

1254 
SCL_CMD_SET_X_POSITION
,

1255 
	`MILLIMETERS_TO_DECIPIXELS
Ğ
h·io
->
efãùiveTlx
 ) );

1257 
	`SşS’dCommªd
Ğ
h·io
->
deviûid
, h·io->
sÿn_chªÃlid
,

1258 
SCL_CMD_SET_Y_POSITION
,

1259 
	`MILLIMETERS_TO_DECIPIXELS
Ğ
h·io
->
efãùiveTly
 ) );

1261 
	`SşS’dCommªd
Ğ
h·io
->
deviûid
, h·io->
sÿn_chªÃlid
,

1262 
SCL_CMD_SET_X_EXTENT
,

1263 
	`MILLIMETERS_TO_DECIPIXELS
Ğ
h·io
->
efãùiveBrx
 -

1264 
h·io
->
efãùiveTlx
 ) );

1266 
	`SşS’dCommªd
Ğ
h·io
->
deviûid
, h·io->
sÿn_chªÃlid
,

1267 
SCL_CMD_SET_Y_EXTENT
,

1268 
	`MILLIMETERS_TO_DECIPIXELS
Ğ
h·io
->
efãùiveBry
 -

1269 
h·io
->
efãùiveTly
 ) );

1271 
	`SşS’dCommªd
Ğ
h·io
->
deviûid
, h·io->
sÿn_chªÃlid
,

1272 
SCL_CMD_SET_CONTRAST
,

1273 
h·io
->
cu¼’tCÚŒa¡
 );

1276 
	`SşS’dCommªd
Ğ
h·io
->
deviûid
, h·io->
sÿn_chªÃlid
,

1277 
SCL_CMD_SET_BRIGHTNESS
,

1278 
h·io
->
cu¼’tBrighŠess
 );

1282 ifĞ
h·io
->
sş
.
com·t
 & ( 
SCL_COMPAT_1150
 | 
SCL_COMPAT_1170
 ) )

1284 
	`SşS’dCommªd
Ğ
h·io
->
deviûid
, h·io->
sÿn_chªÃlid
,

1285 
SCL_CMD_SET_DOWNLOAD_TYPE
,

1286 
SCL_DOWNLOAD_TYPE_COLORMAP
 );

1288 
	`SşS’dCommªd
Ğ
h·io
->
deviûid
, h·io->
sÿn_chªÃlid
,

1289 
SCL_CMD_DOWNLOAD_BINARY_DATA
,

1290 Ğ
hp11xxS”›sCŞÜM­
 ) );

1292 
	`hpmud_wr™e_chªÃl
(
h·io
->
deviûid
, h·io->
sÿn_chªÃlid
, 
hp11xxS”›sCŞÜM­
, (hp11xxSeriesColorMap),

1293 
EXCEPTION_TIMEOUT
, &
by‹s_wrÙe
);

1298 ifĞ
h·io
->
sş
.
com·t
 & 
SCL_COMPAT_R_SERIES
 &&

1299 
h·io
->
cu¼’tSÿnMode
 =ğ
SCAN_MODE_LINEART
 )

1301 
	`SşS’dCommªd
Ğ
h·io
->
deviûid
, h·io->
sÿn_chªÃlid
,

1302 
SCL_CMD_SET_CCD_RESOLUTION
, 600 );

1305  
SANE_STATUS_GOOD
;

1306 
	}
}

1308 
SANE_Stus
 
	$h·ioAdvªûDocum’t
(
h·ioSÿÂ”_t
 
h·io
)

1310 
SANE_Stus
 
»tcode
 = 
SANE_STATUS_GOOD
;

1311 
docum’tLßded
 = 0;

1313 
	`DBG
(8, "hpaioAdvanceDocument:…apersource=%s batch=%d %s %d\n",

1314 
h·io
->
cu¼’tAdfMode
==
ADF_MODE_FLATBED
 ? "FLATBED" : h·io->cu¼’tAdfMode==
ADF_MODE_AUTO
 ? "AUTO" : "ADF",

1315 
h·io
->
cu¼’tB©chSÿn
, 
__FILE__
, 
__LINE__
);

1317 ià(
h·io
->
cu¼’tAdfMode
 =ğ
ADF_MODE_FLATBED
)

1318 
bugout
;

1321 ià(
h·io
->
suµÜ‹dAdfModes
 & 
ADF_MODE_ADF
)

1323 ià(
h·io
->
cu¼’tDu¶ex
 && h·io->
cu¼’tSideNumb”
 == 2)

1324 
docum’tLßded
 = 1;

1327 
»tcode
 = 
	`SşInquœe
(
h·io
->
deviûid
, h·io->
sÿn_chªÃlid
, 
SCL_CMD_INQUIRE_DEVICE_PARAMETER
,

1328 
SCL_INQ_ADF_DOCUMENT_LOADED
, &
docum’tLßded
, 0, 0);

1329 ià(
»tcode
 !ğ
SANE_STATUS_GOOD
)

1330 
bugout
;

1335 ià(
h·io
->
cu¼’tB©chSÿn
 && !
docum’tLßded
)

1337 
»tcode
 = 
SANE_STATUS_NO_DOCS
;

1338 
bugout
;

1342 ià(
h·io
->
cu¼’tAdfMode
 =ğ
ADF_MODE_AUTO
 && !
docum’tLßded
)

1343 
bugout
;

1346 ià(
docum’tLßded
 || (
h·io
->
cu¼’tSideNumb”
 == 2) )

1348 ià(
h·io
->
cu¼’tDu¶ex
)

1351 if(
h·io
->
cu¼’tSideNumb”
 == 2)

1352 
h·io
->
cu¼’tSideNumb”
 = 1;

1354 
h·io
->
cu¼’tSideNumb”
 = 2;

1356 
»tcode
=
	`h·ioSşS’dCommªdCheckE¼Ü
(
h·io
, 
SCL_CMD_CHANGE_DOCUMENT
, 
SCL_CHANGE_DOC_DUPLEX
);

1361 
»tcode
 = 
	`h·ioSşS’dCommªdCheckE¼Ü
(
h·io
, 
SCL_CMD_CHANGE_DOCUMENT
, 
SCL_CHANGE_DOC_SIMPLEX
);

1363 
h·io
->
cu¼’tPageNumb”
++;

1366 
»tcode
 = 
SANE_STATUS_NO_DOCS
;

1368 
bugout
:

1370 
	`DBG
(8, "h·ioAdvªûDocum’ˆ»tuº %d ADF-lßded=%d: % %d\n", 
»tcode
, 
docum’tLßded
, 
__FILE__
, 
__LINE__
);

1372  
»tcode
;

1373 
	}
}

1375 
h·ioSÿÂ”_s
 *
	$ü—‹_sşpml_£ssiÚ
()

1377 
h·ioSÿÂ”_s
 *
ps
;

1379 ià((
ps
 = 
	`m®loc
((
h·ioSÿÂ”_s
))è=ğ
NULL
)

1381  
NULL
;

1383 
	`mem£t
(
ps
, 0, (
h·ioSÿÂ”_s
));

1384 
ps
->
g
 = "SCL-PML";

1385 
ps
->
sÿn_chªÃlid
 = -1;

1386 
ps
->
cmd_chªÃlid
 = -1;

1388  
ps
;

1389 
	}
}

1391 
SANE_Stus
 
	$£tSCLP¬ams
(
h·ioSÿÂ”_t
 
h·io
, 
hpmud_mod–_©Œibu‹s
* 
ma
)

1393 
SANE_Stus
 
»tcode
 = 
SANE_STATUS_UNSUPPORTED
;

1394 
suµÜtsMådtf
 = 1;

1397 
	`SşS’dCommªd
Ğ
h·io
->
deviûid
, h·io->
sÿn_chªÃlid
, 
SCL_CMD_CLEAR_ERROR_STACK
, 0 );

1400 
»tcode
 = 
	`SşInquœe
Ğ
h·io
->
deviûid
, h·io->
sÿn_chªÃlid
,

1401 
SCL_CMD_INQUIRE_DEVICE_PARAMETER
,

1402 
SCL_INQ_HP_MODEL_11
, 0, 
h·io
->
sş
.
com·t1150
,

1403 
LEN_MODEL_RESPONSE
 );

1405 ifĞ
»tcode
 =ğ
SANE_STATUS_GOOD
 )

1407 
h·io
->
sş
.
com·t
 |ğ
SCL_COMPAT_OFFICEJET
;

1409 ifĞ
»tcode
 !ğ
SANE_STATUS_UNSUPPORTED
 )

1411 
abÜt
;

1413 
	`DBG
(6, "sş.com·t1150=<%s>: % %d\n", 
h·io
->
sş
.
com·t1150
, 
__FILE__
, 
__LINE__
);

1415 
»tcode
 = 
	`SşInquœe
Ğ
h·io
->
deviûid
, h·io->
sÿn_chªÃlid
,

1416 
SCL_CMD_INQUIRE_DEVICE_PARAMETER
,

1417 
SCL_INQ_HP_MODEL_12
, 0, 
h·io
->
sş
.
com·tPo¡1150
,

1418 
LEN_MODEL_RESPONSE
 );

1420 ifĞ
»tcode
 =ğ
SANE_STATUS_GOOD
 )

1422 
h·io
->
sş
.
com·t
 |ğ
SCL_COMPAT_POST_1150
;

1424 ifĞ
»tcode
 !ğ
SANE_STATUS_UNSUPPORTED
 )

1426 
abÜt
;

1428 
	`DBG
(6, "sş.com·tPo¡1150=<%s>: % %d\n", 
h·io
->
sş
.
com·tPo¡1150
, 
__FILE__
, 
__LINE__
);

1430 ifĞ!
h·io
->
sş
.
com·t
 )

1432 
	`SET_DEFAULT_MODEL
Ğ
h·io
, "(unknown scanner)" );

1434 ifĞ
h·io
->
sş
.
com·t
 =ğ
SCL_COMPAT_OFFICEJET
 )

1436 
h·io
->
sş
.
com·t
 |ğ
SCL_COMPAT_1150
;

1437 
	`SET_DEFAULT_MODEL
Ğ
h·io
, "(OfficeJet 1150)" );

1439 ifĞ!
	`¡rcmp
Ğ
h·io
->
sş
.
com·tPo¡1150
, "5400A" ) )

1441 
h·io
->
sş
.
com·t
 |ğ
SCL_COMPAT_1170
;

1442 
	`SET_DEFAULT_MODEL
Ğ
h·io
, "(OfficeJet 1170)" );

1444 ifĞ!
	`¡rcmp
Ğ
h·io
->
sş
.
com·tPo¡1150
, "5500A" ) )

1446 
h·io
->
sş
.
com·t
 |ğ
SCL_COMPAT_R_SERIES
;

1447 
	`SET_DEFAULT_MODEL
Ğ
h·io
, "(OfficeJet R Series)" );

1449 ifĞ!
	`¡rcmp
Ğ
h·io
->
sş
.
com·tPo¡1150
, "5600A" ) )

1451 
h·io
->
sş
.
com·t
 |ğ
SCL_COMPAT_G_SERIES
;

1452 
	`SET_DEFAULT_MODEL
Ğ
h·io
, "(OfficeJet G Series)" );

1454 ifĞ!
	`¡rcmp
Ğ
h·io
->
sş
.
com·tPo¡1150
, "5700A" ) )

1456 
h·io
->
sş
.
com·t
 |ğ
SCL_COMPAT_K_SERIES
;

1457 
	`SET_DEFAULT_MODEL
Ğ
h·io
, "(OfficeJet K Series)" );

1459 ifĞ!
	`¡rcmp
Ğ
h·io
->
sş
.
com·tPo¡1150
, "5800A" ) )

1461 
h·io
->
sş
.
com·t
 |ğ
SCL_COMPAT_D_SERIES
;

1462 
	`SET_DEFAULT_MODEL
Ğ
h·io
, "(OfficeJet D Series)" );

1464 ifĞ!
	`¡rcmp
Ğ
h·io
->
sş
.
com·tPo¡1150
, "5900A" ) )

1466 
h·io
->
sş
.
com·t
 |ğ
SCL_COMPAT_6100_SERIES
;

1467 
	`SET_DEFAULT_MODEL
Ğ
h·io
, "(OfficeJet 6100 Series)" );

1471 
	`SET_DEFAULT_MODEL
Ğ
h·io
, "(unknown OfficeJet)" );

1473 
	`DBG
(6, "sş.com·t=0x%4.4X: % %d\n", 
h·io
->
sş
.
com·t
, 
__FILE__
, 
__LINE__
);

1477 ifĞ
h·io
->
sş
.
com·t
 & ( 
SCL_COMPAT_1150
 ) )

1479 
h·io
->
sş
.
decix–Ch¬
 = 
SCL_CHAR_DECIPOINTS
;

1480 
h·io
->
decix–sP”Inch
 = 
DECIPOINTS_PER_INCH
;

1484 
h·io
->
sş
.
decix–Ch¬
 = 
SCL_CHAR_DEVPIXELS
;

1485 
h·io
->
decix–sP”Inch
 = 
DEVPIXELS_PER_INCH
;

1487 
	`SşInquœe
Ğ
h·io
->
deviûid
, h·io->
sÿn_chªÃlid
,

1488 
SCL_CMD_INQUIRE_DEVICE_PARAMETER
,

1489 
SCL_INQ_DEVICE_PIXELS_PER_INCH
,

1490 &
h·io
->
decix–sP”Inch
, 0, 0 );

1492 
	`DBG
(6, "decix–Ch¬='%c', decix–sP”Inch=%d: % %d\n", 
h·io
->
sş
.
decix–Ch¬
, h·io->
decix–sP”Inch
, 
__FILE__
, 
__LINE__
);

1495 ifĞ
	`h·ioSşS’dCommªdCheckE¼Ü
Ğ
h·io
,

1496 
SCL_CMD_SET_MFPDTF
,

1497 
SCL_MFPDTF_ON
 ) !ğ
SANE_STATUS_GOOD
 )

1499 
	`DBG
(6, "DÛ¢'ˆsuµÜˆMFPDTF: % %d\n", 
__FILE__
, 
__LINE__
);

1500 
suµÜtsMådtf
 = 0;

1504 
h·io
->
suµÜtsSÿnMode
[
SCAN_MODE_LINEART
] = 
COMPRESSION_NONE
;

1505 
h·io
->
suµÜtsSÿnMode
[
SCAN_MODE_GRAYSCALE
] = 
COMPRESSION_NONE
;

1506 
h·io
->
suµÜtsSÿnMode
[
SCAN_MODE_COLOR
] = 
COMPRESSION_NONE
;

1508 ifĞ
suµÜtsMådtf
 )

1510 ifĞ
	`h·ioSşS’dCommªdCheckE¼Ü
Ğ
h·io
,

1511 
SCL_CMD_SET_COMPRESSION
,

1512 
SCL_COMPRESSION_JPEG
 ) =ğ
SANE_STATUS_GOOD
 )

1514 
h·io
->
suµÜtsSÿnMode
[
SCAN_MODE_GRAYSCALE
] |ğ
COMPRESSION_JPEG
;

1515 
h·io
->
suµÜtsSÿnMode
[
SCAN_MODE_COLOR
] |ğ
COMPRESSION_JPEG
;

1522 
mšXRes
, 
mšYRes
, 
maxXRes
, 
maxYRes
;

1523 
»tcode
 = 
	`SşInquœe
Ğ
h·io
->
deviûid
, h·io->
sÿn_chªÃlid
,

1524 
SCL_CMD_INQUIRE_MINIMUM_VALUE
,

1525 
SCL_CMD_SET_X_RESOLUTION
,

1526 &
mšXRes
, 0, 0 );

1527 
»tcode
 = 
	`SşInquœe
Ğ
h·io
->
deviûid
, h·io->
sÿn_chªÃlid
,

1528 
SCL_CMD_INQUIRE_MINIMUM_VALUE
,

1529 
SCL_CMD_SET_Y_RESOLUTION
,

1530 &
mšYRes
, 0, 0 );

1531 
»tcode
 = 
	`SşInquœe
Ğ
h·io
->
deviûid
, h·io->
sÿn_chªÃlid
,

1532 
SCL_CMD_INQUIRE_MAXIMUM_VALUE
,

1533 
SCL_CMD_SET_X_RESOLUTION
,

1534 &
maxXRes
, 0, 0 );

1535 
»tcode
 = 
	`SşInquœe
Ğ
h·io
->
deviûid
, h·io->
sÿn_chªÃlid
,

1536 
SCL_CMD_INQUIRE_MAXIMUM_VALUE
,

1537 
SCL_CMD_SET_Y_RESOLUTION
,

1538 &
maxYRes
, 0, 0 );

1540 
	`_DBG
("Flatbed minXRes=%d minYRes=%d maxXRes=%d maxYRes=%d„etcode=%d\n",

1541 
mšXRes
, 
mšYRes
, 
maxXRes
, 
maxYRes
, 
»tcode
);

1543 ifĞ
h·io
->
sş
.
com·t
 & 
SCL_COMPAT_1150
 && 
mšYRes
 < 
SCL_MIN_Y_RES_1150
 )

1544 
mšYRes
 = 
SCL_MIN_Y_RES_1150
;

1546 
h·io
->
sş
.
mšRes
 = 
mšXRes
;

1547 ifĞ
h·io
->
sş
.
mšRes
 < 
mšYRes
 )

1548 
h·io
->
sş
.
mšRes
 = 
mšYRes
;

1550 
h·io
->
»sŞutiÚRªge
.
mš
 = h·io->
sş
.
mšRes
;

1552 
h·io
->
sş
.
maxRes
 = 
maxXRes
;

1553 ifĞ
h·io
->
sş
.
maxRes
 > 
maxYRes
 )

1554 
h·io
->
sş
.
maxRes
 = 
maxYRes
;

1556 ifĞ
h·io
->
sş
.
com·t
 & ( 
SCL_COMPAT_1150
 | 
SCL_COMPAT_1170
 )

1557 && 
h·io
->
sş
.
maxRes
 > 
SCL_MAX_RES_1150_1170
 )

1559 
h·io
->
sş
.
maxRes
 = 
SCL_MAX_RES_1150_1170
;

1561 
h·io
->
»sŞutiÚRªge
.
max
 = h·io->
sş
.
maxRes
;

1564 
»tcode
 = 
	`SşInquœe
Ğ
h·io
->
deviûid
, h·io->
sÿn_chªÃlid
,

1565 
SCL_CMD_INQUIRE_DEVICE_PARAMETER
,

1566 
SCL_INQ_ADF_CAPABILITY
,

1567 &
h·io
->
sş
.
adfC­ab™y
, 0, 0 );

1569 
	`DBG
(6, "ADF c­ab™y=%d„‘code=%d: % %d\n", 
h·io
->
sş
.
adfC­ab™y
, 
»tcode
,
__FILE__
, 
__LINE__
);

1572 ià(
h·io
->
sş
.
adfC­ab™y
)

1574 
»tcode
 = 
	`SşInquœe
Ğ
h·io
->
deviûid
, h·io->
sÿn_chªÃlid
,

1575 
SCL_CMD_INQUIRE_MINIMUM_VALUE
,

1576 
SCL_PSEUDO_ADF_X_RESOLUTION
,

1577 &
mšXRes
, 0, 0 );

1578 
»tcode
 = 
	`SşInquœe
Ğ
h·io
->
deviûid
, h·io->
sÿn_chªÃlid
,

1579 
SCL_CMD_INQUIRE_MINIMUM_VALUE
,

1580 
SCL_PSEUDO_ADF_Y_RESOLUTION
,

1581 &
mšYRes
, 0, 0 );

1582 
»tcode
 = 
	`SşInquœe
Ğ
h·io
->
deviûid
, h·io->
sÿn_chªÃlid
,

1583 
SCL_CMD_INQUIRE_MAXIMUM_VALUE
,

1584 
SCL_PSEUDO_ADF_X_RESOLUTION
,

1585 &
maxXRes
, 0, 0 );

1586 
»tcode
 = 
	`SşInquœe
Ğ
h·io
->
deviûid
, h·io->
sÿn_chªÃlid
,

1587 
SCL_CMD_INQUIRE_MAXIMUM_VALUE
,

1588 
SCL_PSEUDO_ADF_Y_RESOLUTION
,

1589 &
maxYRes
, 0, 0 );

1590 
	`_DBG
("minXResAdf=%d minYResAdf=%d maxXResAdf=%d maxYResAdf=%d„etcode=%d \n",

1591 
mšXRes
, 
mšYRes
,
maxXRes
, 
maxYRes
, 
»tcode
);

1593 ifĞ
h·io
->
sş
.
com·t
 & 
SCL_COMPAT_1150
 && 
mšYRes
 < 
SCL_MIN_Y_RES_1150
 )

1594 
mšYRes
 = 
SCL_MIN_Y_RES_1150
;

1596 
h·io
->
sş
.
mšResAdf
 = 
mšXRes
;

1597 ifĞ
h·io
->
sş
.
mšResAdf
 < 
mšYRes
 )

1598 
h·io
->
sş
.
mšResAdf
 = 
mšYRes
;

1600 
h·io
->
sş
.
maxResAdf
 = 
maxXRes
;

1601 ifĞ
h·io
->
sş
.
maxResAdf
 > 
maxYRes
 )

1602 
h·io
->
sş
.
maxResAdf
 = 
maxYRes
;

1604 ifĞ
h·io
->
sş
.
com·t
 & ( 
SCL_COMPAT_1150
 | 
SCL_COMPAT_1170
 )

1605 && 
h·io
->
sş
.
maxResAdf
 > 
SCL_MAX_RES_1150_1170
 )

1607 
h·io
->
sş
.
maxResAdf
 = 
SCL_MAX_RES_1150_1170
;

1611 if(
ma
->
sÿn¤c
 & 
HPMUD_SCANSRC_FLATBED
)

1613 
h·io
->
sş
.
æ©bedC­ab™y
 = 1;

1614 
h·io
->
suµÜ‹dAdfModes
 = 
ADF_MODE_FLATBED
;

1616 ià(
h·io
->
sş
.
adfC­ab™y
)

1618 ifĞ
h·io
->
sş
.
com·t
 & 
SCL_COMPAT_K_SERIES
)

1620 
h·io
->
suµÜ‹dAdfModes
 |ğ
ADF_MODE_ADF
;

1624 
suµÜ‹dFunùiÚs
;

1626 
h·io
->
suµÜ‹dAdfModes
 |ğ
ADF_MODE_ADF
;

1627 ià(
h·io
->
sş
.
æ©bedC­ab™y
)

1628 
h·io
->
suµÜ‹dAdfModes
 |ğ
ADF_MODE_AUTO
;

1630 ifĞ
h·io
->
sş
.
com·t
 & ( 
SCL_COMPAT_1170
 | 
SCL_COMPAT_R_SERIES
 |
SCL_COMPAT_G_SERIES
 ) )

1632 
h·io
->
sş
.
uÆßdAá”Sÿn
 = 1;

1634 ifĞ
	`PmlReque¡G‘
Ğ
h·io
->
deviûid
, h·io->
cmd_chªÃlid
, h·io->
sş
.
objSuµÜ‹dFunùiÚs
 ) !ğ
ERROR
 &&

1635 
	`PmlG‘IÁeg”V®ue
Ğ
h·io
->
sş
.
objSuµÜ‹dFunùiÚs
,

1637 &
suµÜ‹dFunùiÚs
 ) !ğ
ERROR
 &&

1638 
suµÜ‹dFunùiÚs
 & 
PML_SUPPFUNC_DUPLEX
 )

1640 
h·io
->
suµÜtsDu¶ex
 = 1;

1646 
	`SşInquœe
Ğ
h·io
->
deviûid
, h·io->
sÿn_chªÃlid
,

1647 
SCL_CMD_INQUIRE_MAXIMUM_VALUE
,

1648 
SCL_CMD_SET_X_EXTENT
,

1649 &
h·io
->
sş
.
maxXEx‹Á
, 0, 0 );

1651 
	`SşInquœe
Ğ
h·io
->
deviûid
, h·io->
sÿn_chªÃlid
,

1652 
SCL_CMD_INQUIRE_MAXIMUM_VALUE
,

1653 
SCL_CMD_SET_Y_EXTENT
,

1654 &
h·io
->
sş
.
maxYEx‹Á
, 0, 0 );

1656 
	`DBG
(8, "Maximumƒx‹Ás: x=%d, y=%d % %d\n", 
h·io
->
sş
.
maxXEx‹Á
, h·io->sş.
maxYEx‹Á
, 
__FILE__
, 
__LINE__
);

1658 
h·io
->
xRªge
.
max
 = h·io->
brxRªge
.max = 
	`DECIPIXELS_TO_MILLIMETERS
Ğh·io->
sş
.
maxXEx‹Á
 );

1659 
h·io
->
yRªge
.
max
 = h·io->
bryRªge
.max = 
	`DECIPIXELS_TO_MILLIMETERS
Ğh·io->
sş
.
maxYEx‹Á
 );

1662 ifĞ
suµÜtsMådtf
 )

1664 
h·io
->
mådtf
 = 
	`MådtfAÎoÿ‹
Ğh·io->
deviûid
, h·io->
sÿn_chªÃlid
 );

1665 
	`MådtfS‘ChªÃl
Ğ
h·io
->
mådtf
, h·io->
sÿn_chªÃlid
 );

1667 ifĞ
h·io
->
´eD’®i
 )

1669 
	`MådtfR—dS‘SimuÏ‹ImageH—d”s
Ğ
h·io
->
mådtf
, 1 );

1673 
»tcode
 = 
SANE_STATUS_GOOD
;

1675 
abÜt
:

1676  
»tcode
;

1677 
	}
}

1679 
SANE_Stus
 
	$£tPMLP¬ams
(
h·ioSÿÂ”_t
 
h·io
, 
fÜûJ³gFÜG¿yAndCŞÜ
,

1680 
fÜû300dpiFÜLš—¹
, 
fÜû300dpiFÜG¿ysÿË
)

1682 
SANE_Stus
 
»tcode
 = 
SANE_STATUS_INVAL
;

1683 
comps
 = 0;

1684 
moduÏrH¬dw¬e
 = 0;

1686 
h·io
->
decix–sP”Inch
 = 
DECIPOINTS_PER_INCH
;

1689 ifĞ
h·io
->
´eD’®i
 )

1691 
comps
 |ğ
COMPRESSION_MMR
;

1694 
	`PmlS‘IÁeg”V®ue
Ğ
h·io
->
pml
.
objCom´essiÚ
,

1695 
PML_TYPE_ENUMERATION
,

1696 
PML_COMPRESSION_NONE
 );

1698 ifĞ
	`PmlReque¡S‘R‘ry
Ğ
h·io
->
deviûid
, h·io->
cmd_chªÃlid
,

1699 
h·io
->
pml
.
objCom´essiÚ
, 0, 0 ) !ğ
ERROR
 )

1701 
comps
 |ğ
COMPRESSION_NONE
;

1704 
	`PmlS‘IÁeg”V®ue
Ğ
h·io
->
pml
.
objCom´essiÚ
,

1705 
PML_TYPE_ENUMERATION
,

1706 
PML_COMPRESSION_MH
 );

1708 ifĞ
	`PmlReque¡S‘R‘ry
Ğ
h·io
->
deviûid
, h·io->
cmd_chªÃlid
,

1709 
h·io
->
pml
.
objCom´essiÚ
, 0, 0 ) !ğ
ERROR
 )

1711 
comps
 |ğ
COMPRESSION_MH
;

1714 
	`PmlS‘IÁeg”V®ue
Ğ
h·io
->
pml
.
objCom´essiÚ
,

1715 
PML_TYPE_ENUMERATION
,

1716 
PML_COMPRESSION_MR
 );

1718 ifĞ
	`PmlReque¡S‘R‘ry
Ğ
h·io
->
deviûid
, h·io->
cmd_chªÃlid
,

1719 
h·io
->
pml
.
objCom´essiÚ
, 0, 0 ) !ğ
ERROR
 )

1721 
comps
 |ğ
COMPRESSION_MR
;

1724 
	`PmlS‘IÁeg”V®ue
Ğ
h·io
->
pml
.
objCom´essiÚ
,

1725 
PML_TYPE_ENUMERATION
,

1726 
PML_COMPRESSION_MMR
 );

1728 ifĞ
	`PmlReque¡S‘R‘ry
Ğ
h·io
->
deviûid
, h·io->
cmd_chªÃlid
,

1729 
h·io
->
pml
.
objCom´essiÚ
, 0, 0 ) !ğ
ERROR
 )

1731 
comps
 |ğ
COMPRESSION_MMR
;

1734 
	`PmlS‘IÁeg”V®ue
Ğ
h·io
->
pml
.
objPix–D©aTy³
,

1735 
PML_TYPE_ENUMERATION
,

1736 
PML_DATA_TYPE_LINEART
 );

1738 ifĞ
	`PmlReque¡S‘R‘ry
Ğ
h·io
->
deviûid
, h·io->
cmd_chªÃlid
,

1739 
h·io
->
pml
.
objPix–D©aTy³
, 0, 0 ) !ğ
ERROR
 )

1741 
h·io
->
suµÜtsSÿnMode
[
SCAN_MODE_LINEART
] = 
comps
;

1743 
comps
 &ğ
COMPRESSION_NONE
;

1745 ifĞ
fÜûJ³gFÜG¿yAndCŞÜ
 )

1747 
comps
 = 0;

1750 
	`PmlS‘IÁeg”V®ue
Ğ
h·io
->
pml
.
objCom´essiÚ
,

1751 
PML_TYPE_ENUMERATION
,

1752 
PML_COMPRESSION_JPEG
 );

1754 ifĞ
	`PmlReque¡S‘R‘ry
Ğ
h·io
->
deviûid
, h·io->
cmd_chªÃlid
,

1755 
h·io
->
pml
.
objCom´essiÚ
, 0, 0 ) !ğ
ERROR
 )

1757 
comps
 |ğ
COMPRESSION_JPEG
;

1760 
	`PmlS‘IÁeg”V®ue
Ğ
h·io
->
pml
.
objPix–D©aTy³
,

1761 
PML_TYPE_ENUMERATION
,

1762 
PML_DATA_TYPE_GRAYSCALE
 );

1764 ifĞ
	`PmlReque¡S‘R‘ry
Ğ
h·io
->
deviûid
, h·io->
cmd_chªÃlid
,

1765 
h·io
->
pml
.
objPix–D©aTy³
, 0, 0 ) !ğ
ERROR
 )

1767 
h·io
->
suµÜtsSÿnMode
[
SCAN_MODE_GRAYSCALE
] = 
comps
;

1770 
	`PmlS‘IÁeg”V®ue
Ğ
h·io
->
pml
.
objPix–D©aTy³
,

1771 
PML_TYPE_ENUMERATION
,

1772 
PML_DATA_TYPE_COLOR
 );

1774 ifĞ
	`PmlReque¡S‘R‘ry
Ğ
h·io
->
deviûid
, h·io->
cmd_chªÃlid
,

1775 
h·io
->
pml
.
objPix–D©aTy³
, 0, 0 ) !ğ
ERROR
 )

1777 
h·io
->
suµÜtsSÿnMode
[
SCAN_MODE_COLOR
] = 
comps
;

1781 
	`NumLi¡CË¬
Ğ
h·io
->
»sŞutiÚLi¡
 );

1782 
	`NumLi¡CË¬
Ğ
h·io
->
lš—¹ResŞutiÚLi¡
 );

1784 ifĞ
h·io
->
´eD’®i
 )

1786 
	`NumLi¡Add
Ğ
h·io
->
lš—¹ResŞutiÚLi¡
, 200 );

1787 ifĞ!
	`¡rcmp
Ğ
h·io
->
§ÃDeviû
.
mod–
, "OfficeJet_Series_300" ) )

1789 
	`NumLi¡Add
Ğ
h·io
->
lš—¹ResŞutiÚLi¡
, 300 );

1791 
h·io
->
İtiÚ
[
OPTION_SCAN_RESOLUTION
].
cÚ¡¿št_ty³
 = 
SANE_CONSTRAINT_WORD_LIST
;

1793 ifĞ
	`PmlReque¡G‘
Ğ
h·io
->
deviûid
, h·io->
cmd_chªÃlid
,

1794 
h·io
->
pml
.
objResŞutiÚRªge
 ) =ğ
ERROR
 )

1796 
pmlDeçuÉResRªge
:

1799 
h·io
->
»sŞutiÚRªge
.
mš
 = 75;

1800 
h·io
->
»sŞutiÚRªge
.
max
 = 600;

1804 
»sLi¡
[
PML_MAX_VALUE_LEN
 + 1];

1805 
i
, 
Ën
, 
»s
, 
cÚsumed
;

1807 
	`PmlG‘SŒšgV®ue
Ğ
h·io
->
pml
.
objResŞutiÚRªge
,

1808 0, 
»sLi¡
, 
PML_MAX_VALUE_LEN
 );

1810 
»sLi¡
[
PML_MAX_VALUE_LEN
] = 0;

1811 
Ën
 = 
	`¡¾’
Ğ
»sLi¡
 );

1815  
i
 = 0; i < 
Ën
; )

1817 ifĞ
»sLi¡
[
i
] < '0' ||„esList[i] > '9' )

1819 
i
++;

1822 ifĞ
	`ssÿnf
Ğ
»sLi¡
 + 
i
, "%d%n", &
»s
, &
cÚsumed
 ) != 1 )

1826 
i
 +ğ
cÚsumed
;

1827 ifĞ!
fÜû300dpiFÜG¿ysÿË
 || 
»s
 >= 300 )

1829 
	`NumLi¡Add
Ğ
h·io
->
»sŞutiÚLi¡
, 
»s
 );

1831 ifĞ!
fÜû300dpiFÜLš—¹
 || 
»s
 >= 300 )

1833 
	`NumLi¡Add
Ğ
h·io
->
lš—¹ResŞutiÚLi¡
, 
»s
 );

1837 ifĞ!
	`NumLi¡G‘CouÁ
Ğ
h·io
->
»sŞutiÚLi¡
 ) )

1839 
pmlDeçuÉResRªge
;

1841 
h·io
->
İtiÚ
[
OPTION_SCAN_RESOLUTION
].
cÚ¡¿št_ty³
 = 
SANE_CONSTRAINT_WORD_LIST
;

1846 if(
	`PmlReque¡G‘
(
h·io
->
deviûid
, h·io->
cmd_chªÃlid
, h·io->
pml
.
objModuÏrH¬dw¬e
è!ğ
ERROR
 &&

1847 
	`PmlG‘IÁeg”V®ue
(
h·io
->
pml
.
objModuÏrH¬dw¬e
, 0, &
moduÏrH¬dw¬e
è!ğ
ERROR
)

1849 
h·io
->
pml
.
æ©bedC­ab™y
 = 1;

1851 
	`DBG
(6, "V®id PML moduÏrH¬dw¬objeù v®ue=%x: % %d\n", 
moduÏrH¬dw¬e
, 
__FILE__
, 
__LINE__
);

1854 ià(
	`¡ºÿ£cmp
Ğ
h·io
->
§ÃDeviû
.
mod–
, "hp_laserjet_3200", 16) == 0)

1855 
moduÏrH¬dw¬e
 = 
PML_MODHW_ADF
;

1857 if(
moduÏrH¬dw¬e
 & 
PML_MODHW_ADF
)

1858 
h·io
->
suµÜ‹dAdfModes
 = 
ADF_MODE_AUTO
 | 
ADF_MODE_ADF
;

1860 
h·io
->
suµÜ‹dAdfModes
 = 
ADF_MODE_FLATBED
;

1864 
	`DBG
(6, "NØv®id PML moduÏrH¬dw¬objeù, deçuÉØADF‡nd AUTO suµÜt: % %d\n", 
__FILE__
, 
__LINE__
);

1865 
h·io
->
suµÜ‹dAdfModes
 = 
ADF_MODE_AUTO
 | 
ADF_MODE_ADF
;

1867 
h·io
->
suµÜtsDu¶ex
 = 0;

1869 
h·io
->
xRªge
.
max
 = h·io->
brxRªge
.max = 
	`INCHES_TO_MILLIMETERS
Ğ
PML_MAX_WIDTH_INCHES
 );

1870 
h·io
->
yRªge
.
max
 = h·io->
bryRªge
.max = 
	`INCHES_TO_MILLIMETERS
Ğ
PML_MAX_HEIGHT_INCHES
 );

1872  
»tcode
;

1873 
	}
}

1875 
SANE_Stus
 
	$fld©a
(
h·ioSÿÂ”_t
 
h·io
, 
hpmud_mod–_©Œibu‹s
* 
ma
)

1877 
SANE_Stus
 
»tcode
 = 
SANE_STATUS_INVAL
;

1878 
fÜûJ³gFÜG¿yAndCŞÜ
 = 0;

1879 
fÜû300dpiFÜLš—¹
 = 0;

1880 
fÜû300dpiFÜG¿ysÿË
 = 0;

1883 ifĞ
	`UNDEFINED_MODEL
Ğ
h·io
 ) )

1885 
h·io
->
sÿÂ”Ty³
 = 
SCANNER_TYPE_SCL
;

1887 ifĞ
	`¡rÿ£¡r
Ğ
h·io
->
§ÃDeviû
.
mod–
, "laserjet" ) )

1889 
h·io
->
sÿÂ”Ty³
 = 
SCANNER_TYPE_PML
;

1890 
h·io
->
pml
.
İ’Fœ¡
 = 1;

1892 ifĞ
	`¡rÿ£cmp
Ğ
h·io
->
§ÃDeviû
.
mod–
, "HP_LaserJet_1100" ) == 0 )

1894 
h·io
->
pml
.
dÚtRe£tBefÜeNextNÚB©chPage
 = 1;

1898 
h·io
->
pml
.
¡¬tNextB©chPageE¬ly
 = 1;

1901 ifĞ
	`¡rÿ£cmp
Ğ
h·io
->
§ÃDeviû
.
mod–
, "OfficeJet" ) == 0 ||

1902 
	`¡rÿ£cmp
Ğ
h·io
->
§ÃDeviû
.
mod–
, "OfficeJet_LX" ) == 0 ||

1903 
	`¡rÿ£cmp
Ğ
h·io
->
§ÃDeviû
.
mod–
, "OfficeJet_Series_300" ) == 0 )

1905 
h·io
->
sÿÂ”Ty³
 = 
SCANNER_TYPE_PML
;

1906 
h·io
->
´eD’®i
 = 1;

1908 ifĞ
	`¡rÿ£cmp
Ğ
h·io
->
§ÃDeviû
.
mod–
, "OfficeJet_Series_500" ) == 0 ||

1909 
	`¡rÿ£cmp
Ğ
h·io
->
§ÃDeviû
.
mod–
, "All-in-One_IJP-V100" ) == 0 )

1911 
h·io
->
sÿÂ”Ty³
 = 
SCANNER_TYPE_PML
;

1912 
h·io
->
äomD’®i
 = 1;

1913 
fÜû300dpiFÜLš—¹
 = 1;

1914 
fÜû300dpiFÜG¿ysÿË
 = 1;

1915 
h·io
->
deçuÉCom´essiÚ
[
SCAN_MODE_LINEART
] = 
COMPRESSION_MH
;

1916 
h·io
->
deçuÉCom´essiÚ
[
SCAN_MODE_GRAYSCALE
] = 
COMPRESSION_JPEG
;

1917 
h·io
->
deçuÉJ³gCom´essiÚFaùÜ
 = 
SAFER_JPEG_COMPRESSION_FACTOR
;

1919 ifĞ
	`¡rÿ£cmp
Ğ
h·io
->
§ÃDeviû
.
mod–
, "OfficeJet_Series_600" ) == 0 )

1921 
h·io
->
sÿÂ”Ty³
 = 
SCANNER_TYPE_PML
;

1922 
h·io
->
d’®i
 = 1;

1923 
fÜûJ³gFÜG¿yAndCŞÜ
 = 1;

1924 
fÜû300dpiFÜLš—¹
 = 1;

1925 
h·io
->
deçuÉCom´essiÚ
[
SCAN_MODE_LINEART
] = 
COMPRESSION_MH
;

1926 
h·io
->
deçuÉJ³gCom´essiÚFaùÜ
 = 
SAFER_JPEG_COMPRESSION_FACTOR
;

1928 ifĞ
	`¡rÿ£cmp
Ğ
h·io
->
§ÃDeviû
.
mod–
, "Printer/Scanner/Copier_300" ) == 0 )

1930 
h·io
->
sÿÂ”Ty³
 = 
SCANNER_TYPE_PML
;

1931 
fÜûJ³gFÜG¿yAndCŞÜ
 = 1;

1932 
fÜû300dpiFÜLš—¹
 = 1;

1933 
h·io
->
deçuÉCom´essiÚ
[
SCAN_MODE_LINEART
] = 
COMPRESSION_MH
;

1934 
h·io
->
deçuÉJ³gCom´essiÚFaùÜ
 = 
SAFER_JPEG_COMPRESSION_FACTOR
;

1936 ifĞ
	`¡rÿ£cmp
Ğ
h·io
->
§ÃDeviû
.
mod–
, "OfficeJet_Series_700" ) == 0 )

1938 
h·io
->
sÿÂ”Ty³
 = 
SCANNER_TYPE_PML
;

1939 
fÜûJ³gFÜG¿yAndCŞÜ
 = 1;

1940 
fÜû300dpiFÜLš—¹
 = 1;

1941 
h·io
->
deçuÉCom´essiÚ
[
SCAN_MODE_LINEART
] = 
COMPRESSION_MH
;

1942 
h·io
->
deçuÉJ³gCom´essiÚFaùÜ
 = 
SAFER_JPEG_COMPRESSION_FACTOR
;

1944 ifĞ
	`¡rÿ£cmp
Ğ
h·io
->
§ÃDeviû
.
mod–
, "OfficeJet_T_Series" ) == 0 )

1946 
h·io
->
sÿÂ”Ty³
 = 
SCANNER_TYPE_PML
;

1947 
fÜûJ³gFÜG¿yAndCŞÜ
 = 1;

1951 
h·io
->
sÿÂ”Ty³
 = 
SCANNER_TYPE_SCL
;

1954 
	`DBG
(6, "SÿÂ”y³=%s: % %d\n", 
h·io
->
sÿÂ”Ty³
==0 ? "SCL" : "PML", 
__FILE__
, 
__LINE__
);

1956 
	`h·ioPmlAÎoÿ‹Objeùs
(
h·io
);

1958 ià((
»tcode
 = 
	`h·ioCÚnO³n
(
h·io
)è!ğ
SANE_STATUS_GOOD
)

1960 
abÜt
;

1963 ià((
»tcode
 = 
	`h·ioRe£tSÿÂ”
(
h·io
)è!ğ
SANE_STATUS_GOOD
)

1965 
abÜt
;

1969 ifĞ
h·io
->
sÿÂ”Ty³
 =ğ
SCANNER_TYPE_SCL
 )

1971 
	`£tSCLP¬ams
(
h·io
, 
ma
);

1976 
	`£tPMLP¬ams
(
h·io
, 
fÜûJ³gFÜG¿yAndCŞÜ
, 
fÜû300dpiFÜLš—¹
, 
fÜû300dpiFÜG¿ysÿË
);

1980 
»tcode
 = 
SANE_STATUS_GOOD
;

1982 
abÜt
:

1983  
»tcode
;

1984 
	}
}

1986 
SANE_Stus
 
	$sşpml_İ’
(
SANE_SŒšg_CÚ¡
 
deviû
, 
SANE_HªdË
 *
pHªdË
)

1988 
hpmud_mod–_©Œibu‹s
 
ma
;

1989 
SANE_Stus
 
»tcode
 = 
SANE_STATUS_INVAL
;

1991 
by‹s_»ad
;

1992 
deviûIDSŒšg
[
LEN_DEVICE_ID_STRING
];

1993 
mod–
[256];

1994 
HPMUD_RESULT
 
¡©
;

1996 if(
£ssiÚ
)

1998  
SANE_STATUS_DEVICE_BUSY
;

2000 if((
£ssiÚ
 = 
	`ü—‹_sşpml_£ssiÚ
()è=ğ
NULL
)

2001  
SANE_STATUS_NO_MEM
;

2004 
	`¢´štf
(
£ssiÚ
->
deviûuri
, (£ssiÚ->deviûuri)-1, "hp:%s", 
deviû
);

2007 
	`hpmud_qu”y_mod–
(
£ssiÚ
->
deviûuri
, &
ma
);

2010 ià(
ma
.
sÿÁy³
 =ğ
HPMUD_SCANTYPE_SCL_DUPLEX
)

2011 
£ssiÚ
->
suµÜtsDu¶ex
 = 1;

2013 
£ssiÚ
->
suµÜtsDu¶ex
 = 0;

2016 ià(
	`hpmud_İ’_deviû
(
£ssiÚ
->
deviûuri
, 
ma
.
må_mode
, &£ssiÚ->
deviûid
è!ğ
HPMUD_R_OK
)

2018 
¡©
 = 
SANE_STATUS_IO_ERROR
;

2019 
abÜt
;

2023 
	`mem£t
(
deviûIDSŒšg
, 0, (deviceIDString));

2025 if(
	`hpmud_g‘_deviû_id
(
£ssiÚ
->
deviûid
, 
deviûIDSŒšg
, (deviûIDSŒšg), &
by‹s_»ad
è!ğ
HPMUD_R_OK
)

2027 
»tcode
 = 
SANE_STATUS_INVAL
;

2028 
abÜt
;

2031 
	`DBG
(6, "deviû ID sŒšg=<%s>: % %d\n", 
deviûIDSŒšg
, 
__FILE__
, 
__LINE__
);

2033 
£ssiÚ
->
§ÃDeviû
.
Çme
 = 
	`¡rdup
Ğ
deviû
 );

2034 
£ssiÚ
->
§ÃDeviû
.
v’dÜ
 = "Hewlett-Packard";

2035 
	`hpmud_g‘_mod–
(
deviûIDSŒšg
, 
mod–
, (model));

2036 
	`DBG
(6, "Mod– = %s: % %d\n", 
mod–
, 
__FILE__
, 
__LINE__
);

2037 
£ssiÚ
->
§ÃDeviû
.
mod–
 = 
	`¡rdup
(model);

2038 
£ssiÚ
->
§ÃDeviû
.
ty³
 = "multi-function…eripheral";

2041 
	`š™_İtiÚs
(
£ssiÚ
);

2042 
£ssiÚ
->
cu¼’tSideNumb”
 = 1;

2044 if(
	`fld©a
(
£ssiÚ
, &
ma
è!ğ
SANE_STATUS_GOOD
)

2046 
»tcode
 = 
SANE_STATUS_INVAL
;

2047 
abÜt
;

2050 
dÚe
:

2052 
	`h·ioUpd©eDesütÜs
Ğ
£ssiÚ
, 
OPTION_FIRST
 );

2054 *
pHªdË
 = (
SANE_HªdË
 *)
£ssiÚ
;

2056 
»tcode
 = 
SANE_STATUS_GOOD
;

2058 
abÜt
:

2059 ifĞ
£ssiÚ
 )

2061 
	`h·ioCÚnClo£
Ğ
£ssiÚ
 );

2063 ifĞ
»tcode
 !ğ
SANE_STATUS_GOOD
 )

2065 ifĞ
£ssiÚ
 )

2067 ifĞ
£ssiÚ
->
§ÃDeviû
.
Çme
 )

2069 
	`ä“
ĞĞ* ) 
£ssiÚ
->
§ÃDeviû
.
Çme
 );

2071 ifĞ
£ssiÚ
->
§ÃDeviû
.
mod–
 )

2073 
	`ä“
ĞĞ* ) 
£ssiÚ
->
§ÃDeviû
.
mod–
 );

2075 ià(
£ssiÚ
->
mådtf
)

2077 
	`MådtfD—Îoÿ‹
 (
£ssiÚ
->
mådtf
);

2079 
	`ä“
Ğ
£ssiÚ
 );

2080 
£ssiÚ
 = 
NULL
;

2083  
»tcode
;

2084 
	}
}

2086 
	$sşpml_şo£
(
SANE_HªdË
 
hªdË
)

2088 
h·ioSÿÂ”_t
 
h·io
 = (h·ioSÿÂ”_tè
hªdË
;

2090 
	`DBG
(8, "§Ã_h·io_şo£(): % %d\n", 
__FILE__
, 
__LINE__
);

2091 ià(
h·io
 =ğ
NULL
 || h·iØ!ğ
£ssiÚ
)

2093 
	`BUG
("invalid sane_close\n");

2097 
	`h·ioPmlD—Îoÿ‹Objeùs
(
h·io
);

2100 ià(
h·io
->
cmd_chªÃlid
 > 0)

2101 
	`h·ioCÚnEndSÿn
(
h·io
);

2103 ià(
h·io
->
deviûid
 > 0)

2105 
	`hpmud_şo£_deviû
(
h·io
->
deviûid
);

2106 
h·io
->
deviûid
 = -1;

2108 ifĞ
h·io
->
§ÃDeviû
.
Çme
 )

2110 
	`ä“
ĞĞ* ) 
h·io
->
§ÃDeviû
.
Çme
 );

2112 ifĞ
h·io
->
§ÃDeviû
.
mod–
 )

2114 
	`ä“
ĞĞ* ) 
h·io
->
§ÃDeviû
.
mod–
 );

2116 ià(
h·io
->
mådtf
)

2118 
	`MådtfD—Îoÿ‹
 (
h·io
->
mådtf
);

2120 
	`ä“
(
h·io
);

2121 
£ssiÚ
 = 
NULL
;

2122 
	}
}

2124 cÚ¡ 
SANE_O±iÚ_DesütÜ
 * 
	$sşpml_g‘_İtiÚ_desütÜ
(
SANE_HªdË
 
hªdË
, 
SANE_IÁ
 
İtiÚ
)

2126 
h·ioSÿÂ”_t
 
h·io
 = ( h·ioSÿÂ”_ˆè
hªdË
;

2128 
	`DBG
(8, "§Ã_h·io_g‘_İtiÚ_desütÜ(İtiÚ=%s): % %d\n", 
h·io
->
İtiÚ
[İtiÚ].
Çme
, 
__FILE__
, 
__LINE__
);

2130 ifĞ
İtiÚ
 < 0 || o±iÚ >ğ
OPTION_LAST
 )

2135  &
h·io
->
İtiÚ
[option];

2136 
	}
}

2138 
SANE_Stus
 
	$sşpml_cÚŒŞ_İtiÚ
(
SANE_HªdË
 
hªdË
, 
SANE_IÁ
 
İtiÚ
, 
SANE_AùiÚ
 
aùiÚ
, *
pV®ue
, SANE_IÁ *
pInfo
)

2140 
h·ioSÿÂ”_t
 
h·io
 = ( h·ioSÿÂ”_ˆè
hªdË
;

2141 
SANE_IÁ
 
_šfo
;

2142 
SANE_IÁ
 * 
pIÁV®ue
 = 
pV®ue
;

2143 
SANE_SŒšg
 
pSŒV®ue
 = 
pV®ue
;

2144 
SANE_Stus
 
»tcode
;

2145 
sz
[64];

2147 ifĞ!
pInfo
 )

2149 
pInfo
 = &
_šfo
;

2152  
aùiÚ
 )

2154 
SANE_ACTION_GET_VALUE
:

2155  
İtiÚ
 )

2157 
OPTION_NUM_OPTIONS
:

2158 *
pIÁV®ue
 = 
OPTION_LAST
;

2161 
OPTION_SCAN_MODE
:

2162  
h·io
->
cu¼’tSÿnMode
 )

2164 
SCAN_MODE_LINEART
:

2165 
	`¡rıy
Ğ
pSŒV®ue
, 
SANE_VALUE_SCAN_MODE_LINEART
 );

2167 
SCAN_MODE_GRAYSCALE
:

2168 
	`¡rıy
Ğ
pSŒV®ue
, 
SANE_VALUE_SCAN_MODE_GRAY
 );

2170 
SCAN_MODE_COLOR
:

2171 
	`¡rıy
Ğ
pSŒV®ue
, 
SANE_VALUE_SCAN_MODE_COLOR
 );

2174 
	`¡rıy
Ğ
pSŒV®ue
, 
STR_UNKNOWN
 );

2179 
OPTION_SCAN_RESOLUTION
:

2180 *
pIÁV®ue
 = 
h·io
->
cu¼’tResŞutiÚ
;

2183 
OPTION_CONTRAST
:

2184 *
pIÁV®ue
 = 
h·io
->
cu¼’tCÚŒa¡
;

2186 
OPTION_BRIGHTNESS
:

2187 *
pIÁV®ue
 = 
h·io
->
cu¼’tBrighŠess
;

2190 
OPTION_COMPRESSION
:

2191  
h·io
->
cu¼’tCom´essiÚ
 )

2193 
COMPRESSION_NONE
:

2194 
	`¡rıy
Ğ
pSŒV®ue
, 
STR_COMPRESSION_NONE
 );

2196 
COMPRESSION_MH
:

2197 
	`¡rıy
Ğ
pSŒV®ue
, 
STR_COMPRESSION_MH
 );

2199 
COMPRESSION_MR
:

2200 
	`¡rıy
Ğ
pSŒV®ue
, 
STR_COMPRESSION_MR
 );

2202 
COMPRESSION_MMR
:

2203 
	`¡rıy
Ğ
pSŒV®ue
, 
STR_COMPRESSION_MMR
 );

2205 
COMPRESSION_JPEG
:

2206 
	`¡rıy
Ğ
pSŒV®ue
, 
STR_COMPRESSION_JPEG
 );

2209 
	`¡rıy
Ğ
pSŒV®ue
, 
STR_UNKNOWN
 );

2214 
OPTION_JPEG_COMPRESSION_FACTOR
:

2215 *
pIÁV®ue
 = 
h·io
->
cu¼’tJ³gCom´essiÚFaùÜ
;

2218 
OPTION_BATCH_SCAN
:

2219 *
pIÁV®ue
 = 
h·io
->
cu¼’tB©chSÿn
;

2222 
OPTION_ADF_MODE
:

2223  
h·io
->
cu¼’tAdfMode
 )

2225 
ADF_MODE_AUTO
:

2226 
	`¡rıy
Ğ
pSŒV®ue
, 
STR_ADF_MODE_AUTO
 );

2228 
ADF_MODE_FLATBED
:

2229 
	`¡rıy
Ğ
pSŒV®ue
, 
STR_ADF_MODE_FLATBED
 );

2231 
ADF_MODE_ADF
:

2232 
	`¡rıy
Ğ
pSŒV®ue
, 
STR_ADF_MODE_ADF
 );

2235 
	`¡rıy
Ğ
pSŒV®ue
, 
STR_UNKNOWN
 );

2240 
OPTION_DUPLEX
:

2241 *
pIÁV®ue
 = 
h·io
->
cu¼’tDu¶ex
;

2244 
OPTION_LENGTH_MEASUREMENT
:

2245  
h·io
->
cu¼’tL’gthM—su»m’t
 )

2247 
LENGTH_MEASUREMENT_UNKNOWN
:

2248 
	`¡rıy
Ğ
pSŒV®ue
, 
STR_LENGTH_MEASUREMENT_UNKNOWN
 );

2250 
LENGTH_MEASUREMENT_UNLIMITED
:

2251 
	`¡rıy
Ğ
pSŒV®ue
,

2252 
STR_LENGTH_MEASUREMENT_UNLIMITED
 );

2254 
LENGTH_MEASUREMENT_APPROXIMATE
:

2255 
	`¡rıy
Ğ
pSŒV®ue
,

2256 
STR_LENGTH_MEASUREMENT_APPROXIMATE
 );

2258 
LENGTH_MEASUREMENT_PADDED
:

2259 
	`¡rıy
Ğ
pSŒV®ue
, 
STR_LENGTH_MEASUREMENT_PADDED
 );

2261 
LENGTH_MEASUREMENT_EXACT
:

2262 
	`¡rıy
Ğ
pSŒV®ue
, 
STR_LENGTH_MEASUREMENT_EXACT
 );

2265 
	`¡rıy
Ğ
pSŒV®ue
, 
STR_UNKNOWN
 );

2270 
OPTION_TL_X
:

2271 *
pIÁV®ue
 = 
h·io
->
cu¼’tTlx
;

2274 
OPTION_TL_Y
:

2275 *
pIÁV®ue
 = 
h·io
->
cu¼’tTly
;

2278 
OPTION_BR_X
:

2279 *
pIÁV®ue
 = 
h·io
->
cu¼’tBrx
;

2282 
OPTION_BR_Y
:

2283 *
pIÁV®ue
 = 
h·io
->
cu¼’tBry
;

2287  
SANE_STATUS_INVAL
;

2291 
SANE_ACTION_SET_VALUE
:

2292 ifĞ
h·io
->
İtiÚ
[İtiÚ].
ÿp
 & 
SANE_CAP_INACTIVE
 )

2294  
SANE_STATUS_INVAL
;

2296  
İtiÚ
 )

2298 
OPTION_SCAN_MODE
:

2299 ifĞ!
	`¡rÿ£cmp
Ğ
pSŒV®ue
, 
SANE_VALUE_SCAN_MODE_LINEART
 ) &&

2300 
h·io
->
suµÜtsSÿnMode
[
SCAN_MODE_LINEART
] )

2302 
h·io
->
cu¼’tSÿnMode
 = 
SCAN_MODE_LINEART
;

2305 ifĞ!
	`¡rÿ£cmp
Ğ
pSŒV®ue
, 
SANE_VALUE_SCAN_MODE_GRAY
 ) &&

2306 
h·io
->
suµÜtsSÿnMode
[
SCAN_MODE_GRAYSCALE
] )

2308 
h·io
->
cu¼’tSÿnMode
 = 
SCAN_MODE_GRAYSCALE
;

2311 ifĞ!
	`¡rÿ£cmp
Ğ
pSŒV®ue
, 
SANE_VALUE_SCAN_MODE_COLOR
 ) &&

2312 
h·io
->
suµÜtsSÿnMode
[
SCAN_MODE_COLOR
] )

2314 
h·io
->
cu¼’tSÿnMode
 = 
SCAN_MODE_COLOR
;

2317  
SANE_STATUS_INVAL
;

2319 
OPTION_SCAN_RESOLUTION
:

2320 ifĞĞ
h·io
->
İtiÚ
[İtiÚ].
cÚ¡¿št_ty³
 ==

2321 
SANE_CONSTRAINT_WORD_LIST
 &&

2322 !
	`NumLi¡IsInLi¡
ĞĞ
SANE_IÁ
 * )
h·io
->
İtiÚ
[İtiÚ].
cÚ¡¿št
.
wÜd_li¡
, *
pIÁV®ue
 ) ) ||

2323 Ğ
h·io
->
İtiÚ
[İtiÚ].
cÚ¡¿št_ty³
 =ğ
SANE_CONSTRAINT_RANGE
 &&

2324 Ğ*
pIÁV®ue
<
h·io
->
»sŞutiÚRªge
.
mš
 ||

2325 *
pIÁV®ue
>
h·io
->
»sŞutiÚRªge
.
max
 ) ) )

2327  
SANE_STATUS_INVAL
;

2329 
h·io
->
cu¼’tResŞutiÚ
 = *
pIÁV®ue
;

2332 
OPTION_CONTRAST
:

2333 ifĞ*
pIÁV®ue
<
h·io
->
cÚŒa¡Rªge
.
mš
 ||

2334 *
pIÁV®ue
>
h·io
->
cÚŒa¡Rªge
.
max
 )

2336  
SANE_STATUS_INVAL
;

2338 
h·io
->
cu¼’tCÚŒa¡
 = *
pIÁV®ue
;

2340 
OPTION_BRIGHTNESS
:

2341 ifĞ*
pIÁV®ue
<
h·io
->
brighŠessRªge
.
mš
 ||

2342 *
pIÁV®ue
>
h·io
->
brighŠessRªge
.
max
 )

2344  
SANE_STATUS_INVAL
;

2346 
h·io
->
cu¼’tBrighŠess
 = *
pIÁV®ue
;

2349 
OPTION_COMPRESSION
:

2351 
suµÜ‹dCom´essiÚ
 = 
h·io
->
suµÜtsSÿnMode
[h·io->
cu¼’tSÿnMode
];

2352 ifĞ!
	`¡rÿ£cmp
Ğ
pSŒV®ue
, 
STR_COMPRESSION_NONE
 ) &&

2353 
suµÜ‹dCom´essiÚ
 & 
COMPRESSION_NONE
 )

2355 
h·io
->
cu¼’tCom´essiÚ
 = 
COMPRESSION_NONE
;

2358 ifĞ!
	`¡rÿ£cmp
Ğ
pSŒV®ue
, 
STR_COMPRESSION_MH
 ) &&

2359 
suµÜ‹dCom´essiÚ
 & 
COMPRESSION_MH
 )

2361 
h·io
->
cu¼’tCom´essiÚ
 = 
COMPRESSION_MH
;

2364 ifĞ!
	`¡rÿ£cmp
Ğ
pSŒV®ue
, 
STR_COMPRESSION_MR
 ) &&

2365 
suµÜ‹dCom´essiÚ
 & 
COMPRESSION_MR
 )

2367 
h·io
->
cu¼’tCom´essiÚ
 = 
COMPRESSION_MR
;

2370 ifĞ!
	`¡rÿ£cmp
Ğ
pSŒV®ue
, 
STR_COMPRESSION_MMR
 ) &&

2371 
suµÜ‹dCom´essiÚ
 & 
COMPRESSION_MMR
 )

2373 
h·io
->
cu¼’tCom´essiÚ
 = 
COMPRESSION_MMR
;

2376 ifĞ!
	`¡rÿ£cmp
Ğ
pSŒV®ue
, 
STR_COMPRESSION_JPEG
 ) &&

2377 
suµÜ‹dCom´essiÚ
 & 
COMPRESSION_JPEG
 )

2379 
h·io
->
cu¼’tCom´essiÚ
 = 
COMPRESSION_JPEG
;

2382  
SANE_STATUS_INVAL
;

2385 
OPTION_JPEG_COMPRESSION_FACTOR
:

2386 ifĞ*
pIÁV®ue
<
MIN_JPEG_COMPRESSION_FACTOR
 ||

2387 *
pIÁV®ue
>
MAX_JPEG_COMPRESSION_FACTOR
 )

2389  
SANE_STATUS_INVAL
;

2391 
h·io
->
cu¼’tJ³gCom´essiÚFaùÜ
 = *
pIÁV®ue
;

2394 
OPTION_BATCH_SCAN
:

2395 ifĞ*
pIÁV®ue
 !ğ
SANE_FALSE
 && *pIÁV®u!ğ
SANE_TRUE
 )

2397  
SANE_STATUS_INVAL
;

2399 
h·io
->
cu¼’tB©chSÿn
 = *
pIÁV®ue
;

2402 
OPTION_ADF_MODE
:

2403 ifĞ!
	`¡rÿ£cmp
Ğ
pSŒV®ue
, 
STR_ADF_MODE_AUTO
 ) &&

2404 
h·io
->
suµÜ‹dAdfModes
 & 
ADF_MODE_AUTO
 )

2406 
h·io
->
cu¼’tAdfMode
 = 
ADF_MODE_AUTO
;

2409 ifĞ!
	`¡rÿ£cmp
Ğ
pSŒV®ue
, 
STR_ADF_MODE_FLATBED
 ) &&

2410 
h·io
->
suµÜ‹dAdfModes
 & 
ADF_MODE_FLATBED
 )

2412 
h·io
->
cu¼’tAdfMode
 = 
ADF_MODE_FLATBED
;

2415 ifĞ!
	`¡rÿ£cmp
Ğ
pSŒV®ue
, 
STR_ADF_MODE_ADF
 ) &&

2416 
h·io
->
suµÜ‹dAdfModes
 & 
ADF_MODE_ADF
 )

2418 
h·io
->
cu¼’tAdfMode
 = 
ADF_MODE_ADF
;

2421  
SANE_STATUS_INVAL
;

2423 
OPTION_DUPLEX
:

2424 ifĞ*
pIÁV®ue
 !ğ
SANE_FALSE
 && *pIÁV®u!ğ
SANE_TRUE
 )

2426  
SANE_STATUS_INVAL
;

2428 
h·io
->
cu¼’tDu¶ex
 = *
pIÁV®ue
;

2431 
OPTION_LENGTH_MEASUREMENT
:

2432 ifĞ!
	`¡rÿ£cmp
Ğ
pSŒV®ue
,

2433 
STR_LENGTH_MEASUREMENT_UNKNOWN
 ) )

2435 
h·io
->
cu¼’tL’gthM—su»m’t
 = 
LENGTH_MEASUREMENT_UNKNOWN
;

2438 ifĞ!
	`¡rÿ£cmp
Ğ
pSŒV®ue
,

2439 
STR_LENGTH_MEASUREMENT_UNLIMITED
 ) )

2441 ifĞ
h·io
->
sÿÂ”Ty³
 !ğ
SCANNER_TYPE_PML
 )

2443  
SANE_STATUS_INVAL
;

2445 
h·io
->
cu¼’tL’gthM—su»m’t
 = 
LENGTH_MEASUREMENT_UNLIMITED
;

2448 ifĞ!
	`¡rÿ£cmp
Ğ
pSŒV®ue
,

2449 
STR_LENGTH_MEASUREMENT_APPROXIMATE
 ) )

2451 
h·io
->
cu¼’tL’gthM—su»m’t
 = 
LENGTH_MEASUREMENT_APPROXIMATE
;

2454 ifĞ!
	`¡rÿ£cmp
Ğ
pSŒV®ue
, 
STR_LENGTH_MEASUREMENT_PADDED
 ) )

2456 
h·io
->
cu¼’tL’gthM—su»m’t
 = 
LENGTH_MEASUREMENT_PADDED
;

2459 ifĞ!
	`¡rÿ£cmp
Ğ
pSŒV®ue
, 
STR_LENGTH_MEASUREMENT_EXACT
 ) )

2461 
h·io
->
cu¼’tL’gthM—su»m’t
 = 
LENGTH_MEASUREMENT_EXACT
;

2464  
SANE_STATUS_INVAL
;

2466 
OPTION_TL_X
:

2467 ifĞ*
pIÁV®ue
<
h·io
->
xRªge
.
mš
 ||

2468 *
pIÁV®ue
>
h·io
->
xRªge
.
max
 )

2470  
SANE_STATUS_INVAL
;

2472 
h·io
->
cu¼’tTlx
 = *
pIÁV®ue
;

2475 
OPTION_TL_Y
:

2476 ifĞ*
pIÁV®ue
<
h·io
->
yRªge
.
mš
 ||

2477 *
pIÁV®ue
>
h·io
->
yRªge
.
max
 )

2479  
SANE_STATUS_INVAL
;

2481 
h·io
->
cu¼’tTly
 = *
pIÁV®ue
;

2484 
OPTION_BR_X
:

2485 ifĞ*
pIÁV®ue
<
h·io
->
brxRªge
.
mš
 ||

2486 *
pIÁV®ue
>
h·io
->
brxRªge
.
max
 )

2488  
SANE_STATUS_INVAL
;

2490 
h·io
->
cu¼’tBrx
 = *
pIÁV®ue
;

2493 
OPTION_BR_Y
:

2494 ifĞ*
pIÁV®ue
<
h·io
->
bryRªge
.
mš
 ||

2495 *
pIÁV®ue
>
h·io
->
bryRªge
.
max
 )

2497  
SANE_STATUS_INVAL
;

2499 
h·io
->
cu¼’tBry
 = *
pIÁV®ue
;

2503  
SANE_STATUS_INVAL
;

2505 
»lßd
;

2507 
SANE_ACTION_SET_AUTO
:

2508 
»tcode
 = 
	`h·ioS‘DeçuÉV®ue
Ğ
h·io
, 
İtiÚ
 );

2509 ifĞ
»tcode
 !ğ
SANE_STATUS_GOOD
 )

2511  
»tcode
;

2513 
»lßd
 : *
pInfo
 = 
	`h·ioUpd©eDesütÜs
Ğ
h·io
, 
İtiÚ
 );

2517  
SANE_STATUS_INVAL
;

2520 
	`DBG
(8, "§Ã_h·io_cÚŒŞ_İtiÚ (İtiÚ=% aùiÚ=% v®ue=%s): % %d\n", 
h·io
->
İtiÚ
[İtiÚ].
Çme
,

2521 
aùiÚ
==
SANE_ACTION_GET_VALUE
 ? "g‘" :‡ùiÚ==
SANE_ACTION_SET_VALUE
 ? "set" : "auto",

2522 
pV®ue
 ? 
h·io
->
İtiÚ
[İtiÚ].
ty³
 =ğ
SANE_TYPE_STRING
 ? (*íV®u: 
	`p¢´štf
(
sz
, (sz), "%d", *(*íV®ueè: "Ç", 
__FILE__
, 
__LINE__
);

2524  
SANE_STATUS_GOOD
;

2525 
	}
}

2527 
SANE_Stus
 
	$sşpml_g‘_·¿m‘”s
(
SANE_HªdË
 
hªdË
, 
SANE_P¬am‘”s
 *
pP¬ams
)

2529 
h·ioSÿÂ”_t
 
h·io
 = ( h·ioSÿÂ”_ˆè
hªdË
;

2530 *
s
 = "";

2532 ifĞ!
h·io
->
hJob
 )

2534 *
pP¬ams
 = 
h·io
->
´esÿnP¬am‘”s
;

2535 
s
 = "pre";

2539 *
pP¬ams
 = 
h·io
->
sÿnP¬am‘”s
;

2541 
	`DBG
(8, "sane_hpaio_get_parameters(%sscan): format=%d,†ast_frame=%d,†ines=%d, depth=%d,…ixels_per_line=%d, bytes_per_line=%d %s %d\n",

2542 
s
, 
pP¬ams
->
fÜm©
,…P¬ams->
Ï¡_äame
,…P¬ams->
lšes
,…P¬ams->
d•th
,…P¬ams->
pix–s_³r_lše
,…P¬ams->
by‹s_³r_lše
, 
__FILE__
, 
__LINE__
);

2544  
SANE_STATUS_GOOD
;

2545 
	}
}

2547 
SANE_Stus
 
	$sşpml_¡¬t
(
SANE_HªdË
 
hªdË
)

2549 
h·ioSÿÂ”_t
 
h·io
 = ( h·ioSÿÂ”_ˆè
hªdË
;

2550 
SANE_Stus
 
»tcode
;

2551 
IP_IMAGE_TRAITS
 
Œa™s
;

2552 
IP_XFORM_SPEC
 
xfÜms
[
IP_MAX_XFORMS
], * 
pXfÜm
 = xforms;

2553 
WORD
 
wResuÉ
;

2555 
	`DBG
(8, "§Ã_h·io_¡¬t(): % %d deviûuri=%s\n", 
__FILE__
, 
__LINE__
, 
h·io
->
deviûuri
);

2557 
h·io
->
u£r_ÿnûl
 = 
FALSE
;

2559 
h·io
->
’dOfD©a
 = 0;

2561 ià(
h·io
->
sÿÂ”Ty³
==
SCANNER_TYPE_PML
)

2562  
	`pml_¡¬t
(
h·io
);

2567 ifĞ
h·io
->
noDocsCÚd™iÚP’dšg
 )

2569 
h·io
->
noDocsCÚd™iÚP’dšg
 = 0;

2570 
»tcode
 = 
SANE_STATUS_NO_DOCS
;

2571 
abÜt
;

2574 
»tcode
 = 
	`h·ioCÚnP»·»Sÿn
Ğ
h·io
 );

2576 ifĞ
»tcode
 !ğ
SANE_STATUS_GOOD
 )

2578 
abÜt
;

2581 
h·io
->
befÜeSÿn
 = 1;

2582 
»tcode
 = 
	`h·ioAdvªûDocum’t
Ğ
h·io
 );

2583 
h·io
->
befÜeSÿn
 = 0;

2585 ifĞ
»tcode
 !ğ
SANE_STATUS_GOOD
 )

2587 
abÜt
;

2591 
»tcode
 = 
	`h·ioProg¿mO±iÚs
Ğ
h·io
 );

2593 ifĞ
»tcode
 !ğ
SANE_STATUS_GOOD
 )

2595 
abÜt
;

2598 
h·io
->
sÿnP¬am‘”s
 = h·io->
´esÿnP¬am‘”s
;

2599 
	`mem£t
Ğ
xfÜms
, 0, ( xforms ) );

2600 
Œa™s
.
iPix–sP”Row
 = -1;

2602  
h·io
->
efãùiveSÿnMode
 )

2604 
SCAN_MODE_LINEART
:

2605 
h·io
->
sÿnP¬am‘”s
.
fÜm©
 = 
SANE_FRAME_GRAY
;

2606 
h·io
->
sÿnP¬am‘”s
.
d•th
 = 1;

2607 
Œa™s
.
iB™sP”Pix–
 = 1;

2609 
SCAN_MODE_GRAYSCALE
:

2610 
h·io
->
sÿnP¬am‘”s
.
fÜm©
 = 
SANE_FRAME_GRAY
;

2611 
h·io
->
sÿnP¬am‘”s
.
d•th
 = 8;

2612 
Œa™s
.
iB™sP”Pix–
 = 8;

2614 
SCAN_MODE_COLOR
:

2616 
h·io
->
sÿnP¬am‘”s
.
fÜm©
 = 
SANE_FRAME_RGB
;

2617 
h·io
->
sÿnP¬am‘”s
.
d•th
 = 8;

2618 
Œa™s
.
iB™sP”Pix–
 = 24;

2621 
Œa™s
.
lHÜizDPI
 = 
h·io
->
efãùiveResŞutiÚ
 << 16;

2622 
Œa™s
.
lV”tDPI
 = 
h·io
->
efãùiveResŞutiÚ
 << 16;

2623 
Œa™s
.
lNumRows
 = -1;

2624 
Œa™s
.
iNumPages
 = 1;

2625 
Œa™s
.
iPageNum
 = 1;

2627 
lšes
, 
pix–sP”Lše
;

2630 ifĞ
	`SşInquœe
Ğ
h·io
->
deviûid
, h·io->
sÿn_chªÃlid
, 
SCL_CMD_INQUIRE_DEVICE_PARAMETER
, 
SCL_INQ_NUMBER_OF_SCAN_LINES
,

2631 &
lšes
, 0, 0 ) =ğ
SANE_STATUS_GOOD
 )

2633 
Œa™s
.
lNumRows
 = 
lšes
;

2635 
	`SşInquœe
Ğ
h·io
->
deviûid
, h·io->
sÿn_chªÃlid
, 
SCL_CMD_INQUIRE_DEVICE_PARAMETER
, 
SCL_INQ_PIXELS_PER_SCAN_LINE
,

2636 &
pix–sP”Lše
, 0, 0 );

2638 
Œa™s
.
iPix–sP”Row
 = 
pix–sP”Lše
;

2640 
	`SşS’dCommªd
Ğ
h·io
->
deviûid
, h·io->
sÿn_chªÃlid
, 
SCL_CMD_CLEAR_ERROR_STACK
, 0 );

2643 
	`SşS’dCommªd
Ğ
h·io
->
deviûid
, h·io->
sÿn_chªÃlid
, 
SCL_CMD_SCAN_WINDOW
, 0 );

2645 ifĞ
h·io
->
mådtf
 )

2647 
	`MådtfS‘ChªÃl
Ğ
h·io
->
mådtf
, h·io->
sÿn_chªÃlid
 );

2650 
	`MådtfR—dS¹
Ğ
h·io
->
mådtf
 );

2652 #ifdeà
HPAIO_DEBUG


2653 
log_ouut
=1;

2655 
log_ouut
=0;

2658 ifĞ
log_ouut
 )

2660 
f
[
MAX_FILE_PATH_LEN
];

2661 
út
=0;

2663 ià(
	`g‘’v
("HOME"))

2664 
	`¥rštf
(
f
, "%s/.h¶/mådtf_%d.out", 
	`g‘’v
("HOME"), 
út
++);

2666 
	`¥rštf
(
f
, "/tmp/mådtf_%d.out", 
út
++);

2668 
	`bug
("§všg„aw imagtØ% \n", 
f
);

2670 
	`MådtfLogToFe
Ğ
h·io
->
mådtf
, 
f
 );

2675 
rS”viû
, 
sİEncodšg
;

2677 
rS”viû
 = 
	`MådtfR—dS”viû
Ğ
h·io
->
mådtf
 );

2679 ifĞ
»tcode
 !ğ
SANE_STATUS_GOOD
 )

2681 
abÜt
;

2684 ifĞ
rS”viû
 & 
MFPDTF_RESULT_ERROR_MASK
 )

2686 
»tcode
 = 
SANE_STATUS_IO_ERROR
;

2687 
abÜt
;

2690 ifĞ
rS”viû
 & 
MFPDTF_RESULT_NEW_VARIANT_HEADER
 && 
h·io
->
´eD’®i
 )

2692 
MådtfV¬ŸÁH—d”_u
 
vh—d”
;

2693 
	`MådtfR—dG‘V¬ŸÁH—d”
Ğ
h·io
->
mådtf
, &
vh—d”
, ( vheader ) );

2695 
Œa™s
.
iPix–sP”Row
 = 
	`LEND_GET_SHORT
Ğ
vh—d”
.
çxA¹oo
.
pix–sP”Row
 );

2696 
Œa™s
.
iB™sP”Pix–
 = 1;

2698  
vh—d”
.
çxA¹oo
.
d©aCom´essiÚ
 )

2700 
MFPDTF_RASTER_MH
:

2701 
sİEncodšg
 = 
MFPDTF_RASTER_MH
;

2703 
MFPDTF_RASTER_MR
:

2704 
sİEncodšg
 = 
MFPDTF_RASTER_MR
;

2706 
MFPDTF_RASTER_MMR
:

2708 
sİEncodšg
 = 
MFPDTF_RASTER_MMR
;

2711 
£tupDecod”
;

2713 ifĞ
rS”viû
 & 
MFPDTF_RESULT_NEW_START_OF_PAGE_RECORD
 )

2715 ifĞ
h·io
->
cu¼’tCom´essiÚ
 =ğ
COMPRESSION_NONE
 )

2717 
¿wDecode
;

2721 
j³gDecode
;

2732 
£tupDecod”
:

2734  
sİEncodšg
 )

2736 
MFPDTF_RASTER_MH
:

2737 
pXfÜm
->
aXfÜmInfo
[
IP_FAX_FORMAT
].
dwÜd
 = 
IP_FAX_MH
;

2738 
	`ADD_XFORM
Ğ
X_FAX_DECODE
 );

2740 
MFPDTF_RASTER_MR
:

2741 
pXfÜm
->
aXfÜmInfo
[
IP_FAX_FORMAT
].
dwÜd
 = 
IP_FAX_MR
;

2742 
	`ADD_XFORM
Ğ
X_FAX_DECODE
 );

2744 
MFPDTF_RASTER_MMR
:

2745 
pXfÜm
->
aXfÜmInfo
[
IP_FAX_FORMAT
].
dwÜd
 = 
IP_FAX_MMR
;

2746 
	`ADD_XFORM
Ğ
X_FAX_DECODE
 );

2749 
MFPDTF_RASTER_BITMAP
:

2750 
MFPDTF_RASTER_GRAYMAP
:

2751 
MFPDTF_RASTER_RGB
:

2752 
¿wDecode
:

2755 
MFPDTF_RASTER_JPEG
:

2756 
j³gDecode
:

2757 
pXfÜm
->
aXfÜmInfo
[
IP_JPG_DECODE_FROM_DENALI
].
dwÜd
 = 
h·io
->
äomD’®i
;

2758 
	`ADD_XFORM
Ğ
X_JPG_DECODE
 );

2760 
pXfÜm
->
aXfÜmInfo
[
IP_CNV_COLOR_SPACE_WHICH_CNV
].
dwÜd
 = 
IP_CNV_YCC_TO_SRGB
;

2761 
pXfÜm
->
aXfÜmInfo
[
IP_CNV_COLOR_SPACE_GAMMA
].
dwÜd
 = 0x00010000;

2762 
	`ADD_XFORM
Ğ
X_CNV_COLOR_SPACE
 );

2765 
MFPDTF_RASTER_YCC411
:

2766 
MFPDTF_RASTER_PCL
:

2767 
MFPDTF_RASTER_NOT
:

2770 
	`bug
("unknowÀimag’codšg sªe_¡¬t:‚ame=% sİ=%d % %d\n", 
h·io
->
§ÃDeviû
.
Çme
,
sİEncodšg
, 
__FILE__
, 
__LINE__
);

2775 ifĞ
rS”viû
 & 
MFPDTF_RESULT_IMAGE_DATA_PENDING
 )

2782 
h·io
->
sÿnP¬am‘”s
.
pix–s_³r_lše
 = 
Œa™s
.
iPix–sP”Row
;

2783 
h·io
->
sÿnP¬am‘”s
.
lšes
 = 
Œa™s
.
lNumRows
;

2785 ifĞ
h·io
->
sÿnP¬am‘”s
.
lšes
 < 0 )

2787 
h·io
->
sÿnP¬am‘”s
.
lšes
 = 
	`MILLIMETERS_TO_PIXELS
Ğh·io->
bryRªge
.
max
,

2788 
h·io
->
efãùiveResŞutiÚ
 );

2792 ifĞ
h·io
->
efãùiveSÿnMode
 =ğ
SCAN_MODE_LINEART
 )

2794 
	`ADD_XFORM
Ğ
X_INVERT
 );

2799 ifĞ
h·io
->
sş
.
com·t
 & ( 
SCL_COMPAT_1150
 | 
SCL_COMPAT_1170
 ) )

2801 
pXfÜm
->
aXfÜmInfo
[
IP_TABLE_WHICH
].
dwÜd
 = 
IP_TABLE_USER
;

2802 
pXfÜm
->
aXfÜmInfo
[
IP_TABLE_OPTION
].
pvoid
 = ( * )
hp11xxS”›sGammaTabË
;

2803 
	`ADD_XFORM
Ğ
X_TABLE
 );

2807 ifĞ
h·io
->
cu¼’tL’gthM—su»m’t
 =ğ
LENGTH_MEASUREMENT_PADDED
 )

2809 
pXfÜm
->
aXfÜmInfo
[
IP_PAD_LEFT
].
dwÜd
 = 0;

2810 
pXfÜm
->
aXfÜmInfo
[
IP_PAD_RIGHT
].
dwÜd
 = 0;

2811 
pXfÜm
->
aXfÜmInfo
[
IP_PAD_TOP
].
dwÜd
 = 0;

2812 
pXfÜm
->
aXfÜmInfo
[
IP_PAD_BOTTOM
].
dwÜd
 = 0;

2813 
pXfÜm
->
aXfÜmInfo
[
IP_PAD_VALUE
].
dwÜd
 = ( 
h·io
->
efãùiveSÿnMode
 =ğ
SCAN_MODE_LINEART
 ) ? 
PAD_VALUE_LINEART
 : 
PAD_VALUE_GRAYSCALE_COLOR
;

2814 
pXfÜm
->
aXfÜmInfo
[
IP_PAD_MIN_HEIGHT
].
dwÜd
 = 
h·io
->
sÿnP¬am‘”s
.
lšes
;

2815 
	`ADD_XFORM
Ğ
X_PAD
 );

2819 ifĞ
pXfÜm
 =ğ
xfÜms
 )

2821 
	`ADD_XFORM
Ğ
X_SKEL
 );

2824 
wResuÉ
 = 
	`O³n
Ğ
pXfÜm
 - 
xfÜms
, xfÜms, 0, &
h·io
->
hJob
 );

2826 ifĞ
wResuÉ
 !ğ
IP_DONE
 || !
h·io
->
hJob
 )

2828 
»tcode
 = 
SANE_STATUS_INVAL
;

2829 
abÜt
;

2832 
Œa™s
.
iCompÚ’tsP”Pix–
 = ( (¿™s.
iB™sP”Pix–
 % 3 ) ? 1 : 3 );

2833 
wResuÉ
 = 
	`S‘DeçuÉIÅutT¿™s
Ğ
h·io
->
hJob
, &
Œa™s
 );

2835 ifĞ
wResuÉ
 !ğ
IP_DONE
 )

2837 
»tcode
 = 
SANE_STATUS_INVAL
;

2838 
abÜt
;

2841 
h·io
->
sÿnP¬am‘”s
.
by‹s_³r_lše
 = 
	`BYTES_PER_LINE
Ğh·io->sÿnP¬am‘”s.
pix–s_³r_lše
,

2842 
h·io
->
sÿnP¬am‘”s
.
d•th
 * ( h·io->sÿnP¬am‘”s.
fÜm©
 =ğ
SANE_FRAME_RGB
 ? 3 : 1 ) );

2844 
h·io
->
tÙ®By‹sRemaššg
 = h·io->
sÿnP¬am‘”s
.
by‹s_³r_lše
 * h·io->sÿnP¬am‘”s.
lšes
;

2845 
h·io
->
bufãrOff£t
 = 0;

2846 
h·io
->
bufãrBy‹sRemaššg
 = 0;

2848 ifĞ
h·io
->
cu¼’tL’gthM—su»m’t
 =ğ
LENGTH_MEASUREMENT_UNKNOWN
 || h·io->cu¼’tL’gthM—su»m’ˆ=ğ
LENGTH_MEASUREMENT_UNLIMITED
 )

2850 
h·io
->
sÿnP¬am‘”s
.
lšes
 = -1;

2852 ifĞ
h·io
->
cu¼’tL’gthM—su»m’t
 =ğ
LENGTH_MEASUREMENT_EXACT
 )

2859 
»tcode
 = 
SANE_STATUS_GOOD
;

2861 
abÜt
:

2863 ifĞ
»tcode
 !ğ
SANE_STATUS_GOOD
 )

2865 ià(
»tcode
 =ğ
SANE_STATUS_NO_DOCS
è
	`S’dSÿnEv’t
 (
h·io
->
deviûuri
, 
EVENT_SCAN_ADF_NO_DOCS
);

2866 
	`§Ã_h·io_ÿnûl
Ğ
hªdË
 );

2868  
»tcode
;

2869 
	}
}

2871 
SANE_Stus
 
	$sşpml_»ad
(
SANE_HªdË
 
hªdË
, 
SANE_By‹
 *
d©a
, 
SANE_IÁ
 
maxL’gth
, SANE_IÁ *
pL’gth
)

2873 
h·ioSÿÂ”_t
 
h·io
 = ( h·ioSÿÂ”_ˆè
hªdË
;

2874 
SANE_Stus
 
»tcode
;

2875 
DWORD
 
dwIÅutAva
;

2876 
LPBYTE
 
pbIÅutBuf
;

2877 
DWORD
 
dwIÅutU£d
, 
dwIÅutNextPos
;

2878 
DWORD
 
dwOuutAva
 = 
maxL’gth
;

2879 
LPBYTE
 
pbOuutBuf
 = 
d©a
;

2880 
DWORD
 
dwOuutU£d
, 
dwOuutThisPos
;

2881 
WORD
 
wResuÉ
;

2883 ià(
h·io
->
u£r_ÿnûl
) {

2884 
	`bug
("§Ã_h·io_»ad(maxL’gth=%d): U£¸ÿnûÎed!\n", 
maxL’gth
);

2885  
SANE_STATUS_CANCELLED
;

2888 *
pL’gth
 = 0;

2890 ifĞ!
h·io
->
hJob
 )

2892 
	`bug
("§Ã_h·io_»ad(maxL’gth=%d): NØsÿÀ³ndšg!\n", 
maxL’gth
);

2893 
»tcode
 = 
SANE_STATUS_EOF
;

2894 
abÜt
;

2897 ià(
h·io
->
sÿÂ”Ty³
==
SCANNER_TYPE_PML
)

2899 
»tcode
 = 
	`pml_»ad
(
h·io
, 
d©a
, 
maxL’gth
, 
pL’gth
);

2900  
»tcode
;

2903 
	`DBG
(8, "§Ã_h·io_»ad c®Ëd hªdË=%°d©a=%°maxL’gth=%d†’gth=%d: % %d\n", (*)
hªdË
, 
d©a
, 
maxL’gth
, *
pL’gth
, 
__FILE__
, 
__LINE__
);

2907 
ÃedMÜeD©a
:

2908 ifĞ
h·io
->
bufãrBy‹sRemaššg
 <ğ0 && !h·io->
’dOfD©a
 )

2910 ifĞ!
h·io
->
mådtf
 )

2912 
r
, 
Ën
 = 
h·io
->
tÙ®By‹sRemaššg
;

2913 ifĞ
Ën
 <= 0 )

2915 
h·io
->
’dOfD©a
 = 1;

2919 ifĞ
Ën
 > 
LEN_BUFFER
 )

2921 
Ën
 = 
LEN_BUFFER
;

2924 
r
 = 
	`R—dChªÃlEx
(
h·io
->
deviûid
,

2925 
h·io
->
sÿn_chªÃlid
,

2926 
h·io
->
šBufãr
,

2927 
Ën
,

2928 
EXCEPTION_TIMEOUT
);

2930 ifĞ
r
 < 0 )

2932 
»tcode
 = 
SANE_STATUS_IO_ERROR
;

2933 
abÜt
;

2935 
h·io
->
bufãrBy‹sRemaššg
 = 
r
;

2936 
h·io
->
tÙ®By‹sRemaššg
 -ğ
r
;

2942 
rS”viû
;

2944 
rS”viû
 = 
	`MådtfR—dS”viû
Ğ
h·io
->
mådtf
 );

2946 ifĞ
rS”viû
 & 
MFPDTF_RESULT_ERROR_MASK
 )

2950 
h·io
->
’dOfD©a
 = 1;

2953 ifĞ
rS”viû
 & 
MFPDTF_RESULT_IMAGE_DATA_PENDING
 )

2955 
h·io
->
bufãrBy‹sRemaššg
 = 
	`MådtfR—dIÂ”Block
Ğh·io->
mådtf
, h·io->
šBufãr
, 
LEN_BUFFER
 );

2957 
rS”viû
 = 
	`MådtfR—dG‘La¡S”viûResuÉ
Ğ
h·io
->
mådtf
 );

2959 ifĞ
rS”viû
 & 
MFPDTF_RESULT_ERROR_MASK
 )

2961 
»tcode
 = 
SANE_STATUS_IO_ERROR
;

2962 
abÜt
;

2965 ifĞ
rS”viû
 & 
MFPDTF_RESULT_NEW_END_OF_PAGE_RECORD
 || („S”viû & 
MFPDTF_RESULT_END_PAGE
 && 
h·io
->
´eD’®i
 ))

2967 
h·io
->
’dOfD©a
 = 1;

2972 
h·io
->
bufãrOff£t
 = 0;

2973 ifĞ
h·io
->
´eD’®i
 )

2975 
	`MœrÜBy‹s
Ğ
h·io
->
šBufãr
, h·io->
bufãrBy‹sRemaššg
 );

2980 
dwIÅutAva
 = 
h·io
->
bufãrBy‹sRemaššg
;

2982 ifĞ
h·io
->
bufãrBy‹sRemaššg
 <ğ0 && h·io->
’dOfD©a
 )

2984 
pbIÅutBuf
 = 0;

2988 
pbIÅutBuf
 = 
h·io
->
šBufãr
 + h·io->
bufãrOff£t
;

2991 
wResuÉ
 = 
	`CÚv”t
Ğ
h·io
->
hJob
,

2992 
dwIÅutAva
,

2993 
pbIÅutBuf
,

2994 &
dwIÅutU£d
,

2995 &
dwIÅutNextPos
,

2996 
dwOuutAva
,

2997 
pbOuutBuf
,

2998 &
dwOuutU£d
,

2999 &
dwOuutThisPos
 );

3001 
h·io
->
bufãrOff£t
 +ğ
dwIÅutU£d
;

3002 
h·io
->
bufãrBy‹sRemaššg
 -ğ
dwIÅutU£d
;

3003 *
pL’gth
 = 
dwOuutU£d
;

3005 ifĞ
wResuÉ
 & ( 
IP_INPUT_ERROR
 | 
IP_FATAL_ERROR
 ) )

3007 
	`bug
("CÚv”ˆ”rÜ=%x\n", 
wResuÉ
);

3008 
»tcode
 = 
SANE_STATUS_IO_ERROR
;

3009 
abÜt
;

3011 ifĞ!
dwOuutU£d
 )

3013 ifĞ
wResuÉ
 & 
IP_DONE
 )

3015 
»tcode
 = 
SANE_STATUS_EOF
;

3016 
	`Clo£
(
h·io
->
hJob
);

3017 
h·io
->
hJob
 = 0;

3018 
abÜt
;

3020 
ÃedMÜeD©a
;

3023 
»tcode
 = 
SANE_STATUS_GOOD
;

3025 
abÜt
:

3026 if(!(
»tcode
 =ğ
SANE_STATUS_GOOD
 ||„‘cod=ğ
SANE_STATUS_EOF
))

3028 
	`§Ã_h·io_ÿnûl
Ğ
hªdË
 );

3031 
	`DBG
(8, "§Ã_h·io_»ad„‘uºed ouut=%°ouutU£d=%d†’gth=%d stus=%d: % %d\n", 
pbOuutBuf
, 
dwOuutU£d
, *
pL’gth
, 
»tcode
, 
__FILE__
, 
__LINE__
);

3033  
»tcode
;

3034 
	}
}

3036 
	$sşpml_ÿnûl
(
SANE_HªdË
 
hªdË
)

3038 
h·ioSÿÂ”_t
 
h·io
 = ( h·ioSÿÂ”_ˆè
hªdË
;

3039 
	`DBG
(8, "§Ã_h·io_ÿnûl(): % %d\n", 
__FILE__
, 
__LINE__
);

3041 ià(
h·io
->
u£r_ÿnûl
) {

3042 
	`bug
("sane_hpaio_cancel:‡lready cancelled!\n");

3044 
h·io
->
u£r_ÿnûl
 = 
TRUE
;

3046 ià(
h·io
->
sÿÂ”Ty³
==
SCANNER_TYPE_PML
)

3048 
	`pml_ÿnûl
(
h·io
);

3054 ifĞ
h·io
->
mådtf
 )

3056 
	`MådtfLogToFe
Ğ
h·io
->
mådtf
, 0 );

3060 ifĞ
h·io
->
hJob
 )

3062 
	`Clo£
Ğ
h·io
->
hJob
 );

3063 
h·io
->
hJob
 = 0;

3067 ià(
h·io
->
cu¼’tB©chSÿn
 !ğ
SANE_TRUE
 && h·io->
cmd_chªÃlid
 > 0)

3068 
	`h·ioCÚnEndSÿn
(
h·io
);

3069 
	}
}

	@scan/sane/sclpml.h

28 #iâdeà
_SCLPML_H


29 
	#_SCLPML_H


	)

31 
	~"§Ã.h
"

33 
SANE_Stus
 
sşpml_İ’
(
SANE_SŒšg_CÚ¡
 
deviû
, 
SANE_HªdË
 *
hªdË
);

34 
sşpml_şo£
(
SANE_HªdË
 
hªdË
);

35 cÚ¡ 
SANE_O±iÚ_DesütÜ
 * 
sşpml_g‘_İtiÚ_desütÜ
(
SANE_HªdË
 
hªdË
, 
SANE_IÁ
 
İtiÚ
);

36 
SANE_Stus
 
sşpml_cÚŒŞ_İtiÚ
(
SANE_HªdË
 
hªdË
, 
SANE_IÁ
 
İtiÚ
, 
SANE_AùiÚ
 
aùiÚ
, *
v®ue
, SANE_IÁ *
šfo
);

37 
SANE_Stus
 
sşpml_g‘_·¿m‘”s
(
SANE_HªdË
 
hªdË
, 
SANE_P¬am‘”s
 *
·¿ms
);

38 
SANE_Stus
 
sşpml_¡¬t
(
SANE_HªdË
 
hªdË
);

39 
SANE_Stus
 
sşpml_»ad
(
SANE_HªdË
 
hªdË
, 
SANE_By‹
 *
d©a
, 
SANE_IÁ
 
maxL’gth
, SANE_IÁ *
Ëngth
);

40 
sşpml_ÿnûl
(
SANE_HªdË
 
hªdË
);

	@scan/sane/soap.c

39 #iâdeà
_GNU_SOURCE


40 
	#_GNU_SOURCE


	)

43 
	~<¡d¬g.h
>

44 
	~<sy¦og.h
>

45 
	~<¡dio.h
>

46 
	~<¡ršg.h
>

47 
	~<uni¡d.h
>

48 
	~<fú.h
>

49 
	~<m©h.h
>

50 
	~<dlfú.h
>

51 
	~"§Ã.h
"

52 
	~"§Ãİts.h
"

53 
	~"hpmud.h
"

54 
	~"hp.h
"

55 
	~"commÚ.h
"

56 
	~"sßp.h
"

57 
	~"sßpi.h
"

58 
	~"io.h
"

59 
	~"uts.h
"

61 
	#DEBUG_DECLARE_ONLY


	)

62 
	~"§Ãi_debug.h
"

64 
sßp_£ssiÚ
 *
	g£ssiÚ
 = 
NULL
;

66 
	$bb_lßd
(
sßp_£ssiÚ
 *
ps
, cÚ¡ *
so
)

68 
¡©
=1;

71 ià((
ps
->
hpmud_hªdË
 = 
	`lßd_lib¿ry
("libhpmud.so")è=ğ
NULL
)

73 ià((
ps
->
hpmud_hªdË
 = 
	`lßd_lib¿ry
("libhpmud.so.0")è=ğ
NULL
)

74 
bugout
;

78 ià((
ps
->
m©h_hªdË
 = 
	`lßd_lib¿ry
("libm.so")è=ğ
NULL
)

80 ià((
ps
->
m©h_hªdË
 = 
	`lßd_lib¿ry
("libm.so.6")è=ğ
NULL
)

81 
bugout
;

84 ià((
ps
->
bb_hªdË
 = 
	`lßd_¶ugš_lib¿ry
(
UTILS_SCAN_PLUGIN_LIBRARY
, 
so
)è=ğ
NULL
)

86 
	`S’dSÿnEv’t
(
ps
->
uri
, 
EVENT_PLUGIN_FAIL
);

87 
bugout
;

90 ià((
ps
->
bb_İ’
 = 
	`g‘_lib¿ry_symbŞ
Õs->
bb_hªdË
, "bb_İ’")è=ğ
NULL
)

91 
bugout
;

93 ià((
ps
->
bb_şo£
 = 
	`g‘_lib¿ry_symbŞ
Õs->
bb_hªdË
, "bb_şo£")è=ğ
NULL
)

94 
bugout
;

96 ià((
ps
->
bb_g‘_·¿m‘”s
 = 
	`g‘_lib¿ry_symbŞ
Õs->
bb_hªdË
, "bb_g‘_·¿m‘”s")è=ğ
NULL
)

97 
bugout
;

99 ià((
ps
->
bb_is_·³r_š_adf
 = 
	`g‘_lib¿ry_symbŞ
Õs->
bb_hªdË
, "bb_is_·³r_š_adf")è=ğ
NULL
)

100 
bugout
;

102 ià((
ps
->
bb_¡¬t_sÿn
 = 
	`g‘_lib¿ry_symbŞ
Õs->
bb_hªdË
, "bb_¡¬t_sÿn")è=ğ
NULL
)

103 
bugout
;

105 ià((
ps
->
bb_’d_sÿn
 = 
	`g‘_lib¿ry_symbŞ
Õs->
bb_hªdË
, "bb_’d_sÿn")è=ğ
NULL
)

106 
bugout
;

108 ià((
ps
->
bb_g‘_image_d©a
 = 
	`g‘_lib¿ry_symbŞ
Õs->
bb_hªdË
, "bb_g‘_image_d©a")è=ğ
NULL
)

109 
bugout
;

111 ià((
ps
->
bb_’d_·ge
 = 
	`g‘_lib¿ry_symbŞ
Õs->
bb_hªdË
, "bb_’d_·ge")è=ğ
NULL
)

112 
bugout
;

115 
¡©
=0;

117 
bugout
:

118  
¡©
;

119 
	}
}

121 
	$bb_uÆßd
(
sßp_£ssiÚ
 *
ps
)

123 
	`uÆßd_lib¿ry
(
ps
->
bb_hªdË
);

124 
ps
->
bb_hªdË
 = 
NULL
;

126 
	`uÆßd_lib¿ry
(
ps
->
hpmud_hªdË
);

127 
ps
->
hpmud_hªdË
 = 
NULL
;

129 
	`uÆßd_lib¿ry
(
ps
->
m©h_hªdË
);

130 
ps
->
m©h_hªdË
 = 
NULL
;

133 
	}
}

136 
	$g‘__d©a
(
sßp_£ssiÚ
 *
ps
, 
SANE_By‹
 *
d©a
, 
SANE_IÁ
 
maxL’gth
, SANE_IÁ *
Ëngth
)

138 
_»t
=
IP_INPUT_ERROR
;

139 
ouutAva
=
maxL’gth
, 
ouutU£d
=0, 
ouutThisPos
;

140 *
šput
, *
ouut
 = 
d©a
;

141 
šputAva
, 
šputU£d
=0, 
šputNextPos
;

143 ià(!
ps
->
_hªdË
)

145 
	`BUG
("invalid ipconvert state\n");

146 
bugout
;

149 ià(
ps
->
	`bb_g‘_image_d©a
Õs, 
ouutAva
))

150 
bugout
;

152 ià(
ps
->
út
 > 0)

154 
šputAva
 = 
ps
->
út
;

155 
šput
 = &
ps
->
buf
[ps->
šdex
];

159 
šput
 = 
NULL
;

160 
šputAva
 = 0;

164 
_»t
 = 
	`CÚv”t
(
ps
->
_hªdË
, 
šputAva
, 
šput
, &
šputU£d
, &
šputNextPos
, 
ouutAva
, 
ouut
, &
ouutU£d
, &
ouutThisPos
);

166 
	`DBG6
("út=%d index=%d iÅut=%°šputAva=%d iÅutU£d=%d iÅutNextPos=%d ouut=%°ouutAva=%d ouutThisPos=%d\n", 
ps
->
út
,…s->
šdex
, 
šput
,

167 
šputAva
, 
šputU£d
, 
šputNextPos
, 
ouut
, 
ouutAva
, 
ouutThisPos
);

169 ià(
šput
 !ğ
NULL
)

171 ià(
šputAva
 =ğ
šputU£d
)

173 
ps
->
šdex
 =…s->
út
 = 0;

177 
ps
->
út
 -ğ
šputU£d
;

178 
ps
->
šdex
 +ğ
šputU£d
;

182 ià(
d©a
)

183 *
Ëngth
 = 
ouutU£d
;

186 ià(
_»t
 & 
IP_DONE
 && 
ouutU£d
)

187 
_»t
 &ğ~
IP_DONE
;

189 
bugout
:

190  
_»t
;

191 
	}
}

193 
	$£t_sÿn_mode_side_efãùs
(
sßp_£ssiÚ
 *
ps
, 
COLOR_ENTRY
 
sÿnMode
)

195 
j
=0;

197 
	`mem£t
(
ps
->
com´essiÚLi¡
, 0, (ps->compressionList));

198 
	`mem£t
(
ps
->
com´essiÚM­
, 0, (ps->compressionMap));

200 
sÿnMode
)

202 
CE_BLACK_AND_WHITE1
:

203 
CE_GRAY8
:

204 
CE_RGB24
:

206 
ps
->
com´essiÚLi¡
[
j
] = 
STR_COMPRESSION_JPEG
;

207 
ps
->
com´essiÚM­
[
j
++] = 
SF_JFIF
;

208 
ps
->
cu¼’tCom´essiÚ
 = 
SF_JFIF
;

209 
ps
->
İtiÚ
[
SOAP_OPTION_JPEG_QUALITY
].
ÿp
 |ğ
SANE_CAP_SOFT_SELECT
;

214 
	}
}

216 
sßp_£ssiÚ
 *
	$ü—‹_£ssiÚ
()

218 
sßp_£ssiÚ
 *
ps
;

220 ià((
ps
 = 
	`m®loc
((
sßp_£ssiÚ
))è=ğ
NULL
)

222 
	`BUG
("malloc failed: %m\n");

223  
NULL
;

225 
	`mem£t
(
ps
, 0, (
sßp_£ssiÚ
));

226 
ps
->
g
 = "SOAP";

227 
ps
->
dd
 = -1;

228 
ps
->
cd
 = -1;

230  
ps
;

231 
	}
}

233 
	$š™_İtiÚs
(
sßp_£ssiÚ
 *
ps
)

235 
ps
->
İtiÚ
[
SOAP_OPTION_COUNT
].
Çme
 = "option-cnt";

236 
ps
->
İtiÚ
[
SOAP_OPTION_COUNT
].
t™Ë
 = 
SANE_TITLE_NUM_OPTIONS
;

237 
ps
->
İtiÚ
[
SOAP_OPTION_COUNT
].
desc
 = 
SANE_DESC_NUM_OPTIONS
;

238 
ps
->
İtiÚ
[
SOAP_OPTION_COUNT
].
ty³
 = 
SANE_TYPE_INT
;

239 
ps
->
İtiÚ
[
SOAP_OPTION_COUNT
].
un™
 = 
SANE_UNIT_NONE
;

240 
ps
->
İtiÚ
[
SOAP_OPTION_COUNT
].
size
 = (
SANE_IÁ
);

241 
ps
->
İtiÚ
[
SOAP_OPTION_COUNT
].
ÿp
 = 
SANE_CAP_SOFT_DETECT
;

242 
ps
->
İtiÚ
[
SOAP_OPTION_COUNT
].
cÚ¡¿št_ty³
 = 
SANE_CONSTRAINT_NONE
;

244 
ps
->
İtiÚ
[
SOAP_OPTION_GROUP_SCAN_MODE
].
Çme
 = "mode-group";

245 
ps
->
İtiÚ
[
SOAP_OPTION_GROUP_SCAN_MODE
].
t™Ë
 = 
SANE_TITLE_SCAN_MODE
;

246 
ps
->
İtiÚ
[
SOAP_OPTION_GROUP_SCAN_MODE
].
ty³
 = 
SANE_TYPE_GROUP
;

248 
ps
->
İtiÚ
[
SOAP_OPTION_SCAN_MODE
].
Çme
 = 
SANE_NAME_SCAN_MODE
;

249 
ps
->
İtiÚ
[
SOAP_OPTION_SCAN_MODE
].
t™Ë
 = 
SANE_TITLE_SCAN_MODE
;

250 
ps
->
İtiÚ
[
SOAP_OPTION_SCAN_MODE
].
desc
 = 
SANE_DESC_SCAN_MODE
;

251 
ps
->
İtiÚ
[
SOAP_OPTION_SCAN_MODE
].
ty³
 = 
SANE_TYPE_STRING
;

252 
ps
->
İtiÚ
[
SOAP_OPTION_SCAN_MODE
].
un™
 = 
SANE_UNIT_NONE
;

253 
ps
->
İtiÚ
[
SOAP_OPTION_SCAN_MODE
].
size
 = 
MAX_STRING_SIZE
;

254 
ps
->
İtiÚ
[
SOAP_OPTION_SCAN_MODE
].
ÿp
 = 
SANE_CAP_SOFT_SELECT
 | 
SANE_CAP_SOFT_DETECT
;

255 
ps
->
İtiÚ
[
SOAP_OPTION_SCAN_MODE
].
cÚ¡¿št_ty³
 = 
SANE_CONSTRAINT_STRING_LIST
;

256 
ps
->
İtiÚ
[
SOAP_OPTION_SCAN_MODE
].
cÚ¡¿št
.
¡ršg_li¡
 =…s->
sÿnModeLi¡
;

258 
ps
->
İtiÚ
[
SOAP_OPTION_SCAN_RESOLUTION
].
Çme
 = 
SANE_NAME_SCAN_RESOLUTION
;

259 
ps
->
İtiÚ
[
SOAP_OPTION_SCAN_RESOLUTION
].
t™Ë
 = 
SANE_TITLE_SCAN_RESOLUTION
;

260 
ps
->
İtiÚ
[
SOAP_OPTION_SCAN_RESOLUTION
].
desc
 = 
SANE_DESC_SCAN_RESOLUTION
;

261 
ps
->
İtiÚ
[
SOAP_OPTION_SCAN_RESOLUTION
].
ty³
 = 
SANE_TYPE_INT
;

262 
ps
->
İtiÚ
[
SOAP_OPTION_SCAN_RESOLUTION
].
un™
 = 
SANE_UNIT_DPI
;

263 
ps
->
İtiÚ
[
SOAP_OPTION_SCAN_RESOLUTION
].
size
 = (
SANE_IÁ
);

264 
ps
->
İtiÚ
[
SOAP_OPTION_SCAN_RESOLUTION
].
ÿp
 = 
SANE_CAP_SOFT_SELECT
 | 
SANE_CAP_SOFT_DETECT
;

265 
ps
->
İtiÚ
[
SOAP_OPTION_SCAN_RESOLUTION
].
cÚ¡¿št_ty³
 = 
SANE_CONSTRAINT_WORD_LIST
;

266 
ps
->
İtiÚ
[
SOAP_OPTION_SCAN_RESOLUTION
].
cÚ¡¿št
.
wÜd_li¡
 =…s->
»sŞutiÚLi¡
;

268 
ps
->
İtiÚ
[
SOAP_OPTION_GROUP_ADVANCED
].
Çme
 = "advanced-group";

269 
ps
->
İtiÚ
[
SOAP_OPTION_GROUP_ADVANCED
].
t™Ë
 = 
STR_TITLE_ADVANCED
;

270 
ps
->
İtiÚ
[
SOAP_OPTION_GROUP_ADVANCED
].
ty³
 = 
SANE_TYPE_GROUP
;

271 
ps
->
İtiÚ
[
SOAP_OPTION_GROUP_ADVANCED
].
ÿp
 = 
SANE_CAP_ADVANCED
;

273 
ps
->
İtiÚ
[
SOAP_OPTION_BRIGHTNESS
].
Çme
 = 
SANE_NAME_BRIGHTNESS
;

274 
ps
->
İtiÚ
[
SOAP_OPTION_BRIGHTNESS
].
t™Ë
 = 
SANE_TITLE_BRIGHTNESS
;

275 
ps
->
İtiÚ
[
SOAP_OPTION_BRIGHTNESS
].
desc
 = 
SANE_DESC_BRIGHTNESS
;

276 
ps
->
İtiÚ
[
SOAP_OPTION_BRIGHTNESS
].
ty³
 = 
SANE_TYPE_INT
;

277 
ps
->
İtiÚ
[
SOAP_OPTION_BRIGHTNESS
].
un™
 = 
SANE_UNIT_NONE
;

278 
ps
->
İtiÚ
[
SOAP_OPTION_BRIGHTNESS
].
size
 = (
SANE_IÁ
);

279 
ps
->
İtiÚ
[
SOAP_OPTION_BRIGHTNESS
].
ÿp
 = 
SANE_CAP_SOFT_SELECT
 | 
SANE_CAP_SOFT_DETECT
 | 
SANE_CAP_ADVANCED
;

280 
ps
->
İtiÚ
[
SOAP_OPTION_BRIGHTNESS
].
cÚ¡¿št_ty³
 = 
SANE_CONSTRAINT_RANGE
;

281 
ps
->
İtiÚ
[
SOAP_OPTION_BRIGHTNESS
].
cÚ¡¿št
.
¿nge
 = &ps->
brighŠessRªge
;

282 
ps
->
brighŠessRªge
.
mš
 = 
SOAP_BRIGHTNESS_MIN
;

283 
ps
->
brighŠessRªge
.
max
 = 
SOAP_BRIGHTNESS_MAX
;

284 
ps
->
brighŠessRªge
.
quªt
 = 0;

286 
ps
->
İtiÚ
[
SOAP_OPTION_CONTRAST
].
Çme
 = 
SANE_NAME_CONTRAST
;

287 
ps
->
İtiÚ
[
SOAP_OPTION_CONTRAST
].
t™Ë
 = 
SANE_TITLE_CONTRAST
;

288 
ps
->
İtiÚ
[
SOAP_OPTION_CONTRAST
].
desc
 = 
SANE_DESC_CONTRAST
;

289 
ps
->
İtiÚ
[
SOAP_OPTION_CONTRAST
].
ty³
 = 
SANE_TYPE_INT
;

290 
ps
->
İtiÚ
[
SOAP_OPTION_CONTRAST
].
un™
 = 
SANE_UNIT_NONE
;

291 
ps
->
İtiÚ
[
SOAP_OPTION_CONTRAST
].
size
 = (
SANE_IÁ
);

292 
ps
->
İtiÚ
[
SOAP_OPTION_CONTRAST
].
ÿp
 = 
SANE_CAP_SOFT_SELECT
 | 
SANE_CAP_SOFT_DETECT
 | 
SANE_CAP_ADVANCED
;

293 
ps
->
İtiÚ
[
SOAP_OPTION_CONTRAST
].
cÚ¡¿št_ty³
 = 
SANE_CONSTRAINT_RANGE
;

294 
ps
->
İtiÚ
[
SOAP_OPTION_CONTRAST
].
cÚ¡¿št
.
¿nge
 = &ps->
cÚŒa¡Rªge
;

295 
ps
->
cÚŒa¡Rªge
.
mš
 = 
SOAP_CONTRAST_MIN
;

296 
ps
->
cÚŒa¡Rªge
.
max
 = 
SOAP_CONTRAST_MAX
;

297 
ps
->
cÚŒa¡Rªge
.
quªt
 = 0;

299 
ps
->
İtiÚ
[
SOAP_OPTION_COMPRESSION
].
Çme
 = 
STR_NAME_COMPRESSION
;

300 
ps
->
İtiÚ
[
SOAP_OPTION_COMPRESSION
].
t™Ë
 = 
STR_TITLE_COMPRESSION
;

301 
ps
->
İtiÚ
[
SOAP_OPTION_COMPRESSION
].
desc
 = 
STR_DESC_COMPRESSION
;

302 
ps
->
İtiÚ
[
SOAP_OPTION_COMPRESSION
].
ty³
 = 
SANE_TYPE_STRING
;

303 
ps
->
İtiÚ
[
SOAP_OPTION_COMPRESSION
].
un™
 = 
SANE_UNIT_NONE
;

304 
ps
->
İtiÚ
[
SOAP_OPTION_COMPRESSION
].
size
 = 
MAX_STRING_SIZE
;

305 
ps
->
İtiÚ
[
SOAP_OPTION_COMPRESSION
].
ÿp
 = 
SANE_CAP_SOFT_SELECT
 | 
SANE_CAP_SOFT_DETECT
 | 
SANE_CAP_ADVANCED
;

306 
ps
->
İtiÚ
[
SOAP_OPTION_COMPRESSION
].
cÚ¡¿št_ty³
 = 
SANE_CONSTRAINT_STRING_LIST
;

307 
ps
->
İtiÚ
[
SOAP_OPTION_COMPRESSION
].
cÚ¡¿št
.
¡ršg_li¡
 =…s->
com´essiÚLi¡
;

309 
ps
->
İtiÚ
[
SOAP_OPTION_JPEG_QUALITY
].
Çme
 = 
STR_NAME_JPEG_QUALITY
;

310 
ps
->
İtiÚ
[
SOAP_OPTION_JPEG_QUALITY
].
t™Ë
 = 
STR_TITLE_JPEG_QUALITY
;

311 
ps
->
İtiÚ
[
SOAP_OPTION_JPEG_QUALITY
].
desc
 = 
STR_DESC_JPEG_QUALITY
;

312 
ps
->
İtiÚ
[
SOAP_OPTION_JPEG_QUALITY
].
ty³
 = 
SANE_TYPE_INT
;

313 
ps
->
İtiÚ
[
SOAP_OPTION_JPEG_QUALITY
].
un™
 = 
SANE_UNIT_NONE
;

314 
ps
->
İtiÚ
[
SOAP_OPTION_JPEG_QUALITY
].
size
 = (
SANE_IÁ
);

315 
ps
->
İtiÚ
[
SOAP_OPTION_JPEG_QUALITY
].
ÿp
 = 
SANE_CAP_SOFT_SELECT
 | 
SANE_CAP_SOFT_DETECT
 | 
SANE_CAP_ADVANCED
;

316 
ps
->
İtiÚ
[
SOAP_OPTION_JPEG_QUALITY
].
cÚ¡¿št_ty³
 = 
SANE_CONSTRAINT_RANGE
;

317 
ps
->
İtiÚ
[
SOAP_OPTION_JPEG_QUALITY
].
cÚ¡¿št
.
¿nge
 = &ps->
j³gQu®™yRªge
;

318 
ps
->
j³gQu®™yRªge
.
mš
 = 
MIN_JPEG_COMPRESSION_FACTOR
;

319 
ps
->
j³gQu®™yRªge
.
max
 = 
MAX_JPEG_COMPRESSION_FACTOR
;

320 
ps
->
j³gQu®™yRªge
.
quªt
 = 0;

322 
ps
->
İtiÚ
[
SOAP_OPTION_GROUP_GEOMETRY
].
Çme
 = "geometry-group";

323 
ps
->
İtiÚ
[
SOAP_OPTION_GROUP_GEOMETRY
].
t™Ë
 = 
STR_TITLE_GEOMETRY
;

324 
ps
->
İtiÚ
[
SOAP_OPTION_GROUP_GEOMETRY
].
ty³
 = 
SANE_TYPE_GROUP
;

325 
ps
->
İtiÚ
[
SOAP_OPTION_GROUP_GEOMETRY
].
ÿp
 = 
SANE_CAP_ADVANCED
;

327 
ps
->
İtiÚ
[
SOAP_OPTION_TL_X
].
Çme
 = 
SANE_NAME_SCAN_TL_X
;

328 
ps
->
İtiÚ
[
SOAP_OPTION_TL_X
].
t™Ë
 = 
SANE_TITLE_SCAN_TL_X
;

329 
ps
->
İtiÚ
[
SOAP_OPTION_TL_X
].
desc
 = 
SANE_DESC_SCAN_TL_X
;

330 
ps
->
İtiÚ
[
SOAP_OPTION_TL_X
].
ty³
 = 
SANE_TYPE_FIXED
;

331 
ps
->
İtiÚ
[
SOAP_OPTION_TL_X
].
un™
 = 
SANE_UNIT_MM
;

332 
ps
->
İtiÚ
[
SOAP_OPTION_TL_X
].
size
 = (
SANE_IÁ
);

333 
ps
->
İtiÚ
[
SOAP_OPTION_TL_X
].
ÿp
 = 
SANE_CAP_SOFT_SELECT
 | 
SANE_CAP_SOFT_DETECT
;

334 
ps
->
İtiÚ
[
SOAP_OPTION_TL_X
].
cÚ¡¿št_ty³
 = 
SANE_CONSTRAINT_RANGE
;

335 
ps
->
İtiÚ
[
SOAP_OPTION_TL_X
].
cÚ¡¿št
.
¿nge
 = &ps->
xRªge
;

336 
ps
->
xRªge
.
mš
 = 0;

337 
ps
->
xRªge
.
quªt
 = 0;

339 
ps
->
İtiÚ
[
SOAP_OPTION_TL_Y
].
Çme
 = 
SANE_NAME_SCAN_TL_Y
;

340 
ps
->
İtiÚ
[
SOAP_OPTION_TL_Y
].
t™Ë
 = 
SANE_TITLE_SCAN_TL_Y
;

341 
ps
->
İtiÚ
[
SOAP_OPTION_TL_Y
].
desc
 = 
SANE_DESC_SCAN_TL_Y
;

342 
ps
->
İtiÚ
[
SOAP_OPTION_TL_Y
].
ty³
 = 
SANE_TYPE_FIXED
;

343 
ps
->
İtiÚ
[
SOAP_OPTION_TL_Y
].
un™
 = 
SANE_UNIT_MM
;

344 
ps
->
İtiÚ
[
SOAP_OPTION_TL_Y
].
size
 = (
SANE_IÁ
);

345 
ps
->
İtiÚ
[
SOAP_OPTION_TL_Y
].
ÿp
 = 
SANE_CAP_SOFT_SELECT
 | 
SANE_CAP_SOFT_DETECT
;

346 
ps
->
İtiÚ
[
SOAP_OPTION_TL_Y
].
cÚ¡¿št_ty³
 = 
SANE_CONSTRAINT_RANGE
;

347 
ps
->
İtiÚ
[
SOAP_OPTION_TL_Y
].
cÚ¡¿št
.
¿nge
 = &ps->
yRªge
;

348 
ps
->
yRªge
.
mš
 = 0;

349 
ps
->
yRªge
.
quªt
 = 0;

351 
ps
->
İtiÚ
[
SOAP_OPTION_BR_X
].
Çme
 = 
SANE_NAME_SCAN_BR_X
;

352 
ps
->
İtiÚ
[
SOAP_OPTION_BR_X
].
t™Ë
 = 
SANE_TITLE_SCAN_BR_X
;

353 
ps
->
İtiÚ
[
SOAP_OPTION_BR_X
].
desc
 = 
SANE_DESC_SCAN_BR_X
;

354 
ps
->
İtiÚ
[
SOAP_OPTION_BR_X
].
ty³
 = 
SANE_TYPE_FIXED
;

355 
ps
->
İtiÚ
[
SOAP_OPTION_BR_X
].
un™
 = 
SANE_UNIT_MM
;

356 
ps
->
İtiÚ
[
SOAP_OPTION_BR_X
].
size
 = (
SANE_IÁ
);

357 
ps
->
İtiÚ
[
SOAP_OPTION_BR_X
].
ÿp
 = 
SANE_CAP_SOFT_SELECT
 | 
SANE_CAP_SOFT_DETECT
;

358 
ps
->
İtiÚ
[
SOAP_OPTION_BR_X
].
cÚ¡¿št_ty³
 = 
SANE_CONSTRAINT_RANGE
;

359 
ps
->
İtiÚ
[
SOAP_OPTION_BR_X
].
cÚ¡¿št
.
¿nge
 = &ps->
brxRªge
;

360 
ps
->
brxRªge
.
mš
 = 0;

361 
ps
->
brxRªge
.
quªt
 = 0;

363 
ps
->
İtiÚ
[
SOAP_OPTION_BR_Y
].
Çme
 = 
SANE_NAME_SCAN_BR_Y
;

364 
ps
->
İtiÚ
[
SOAP_OPTION_BR_Y
].
t™Ë
 = 
SANE_TITLE_SCAN_BR_Y
;

365 
ps
->
İtiÚ
[
SOAP_OPTION_BR_Y
].
desc
 = 
SANE_DESC_SCAN_BR_Y
;

366 
ps
->
İtiÚ
[
SOAP_OPTION_BR_Y
].
ty³
 = 
SANE_TYPE_FIXED
;

367 
ps
->
İtiÚ
[
SOAP_OPTION_BR_Y
].
un™
 = 
SANE_UNIT_MM
;

368 
ps
->
İtiÚ
[
SOAP_OPTION_BR_Y
].
size
 = (
SANE_IÁ
);

369 
ps
->
İtiÚ
[
SOAP_OPTION_BR_Y
].
ÿp
 = 
SANE_CAP_SOFT_SELECT
 | 
SANE_CAP_SOFT_DETECT
;

370 
ps
->
İtiÚ
[
SOAP_OPTION_BR_Y
].
cÚ¡¿št_ty³
 = 
SANE_CONSTRAINT_RANGE
;

371 
ps
->
İtiÚ
[
SOAP_OPTION_BR_Y
].
cÚ¡¿št
.
¿nge
 = &ps->
bryRªge
;

372 
ps
->
bryRªge
.
mš
 = 0;

373 
ps
->
bryRªge
.
quªt
 = 0;

376 
	}
}

379 
	$£t_ex‹Ás
(
sßp_£ssiÚ
 *
ps
)

381 
¡©
 = 0;

383 ià((
ps
->
cu¼’tBrx
 >…s->
cu¼’tTlx
è&& (ps->cu¼’tBrx -…s->cu¼’tTlx >ğps->
mš_width
è&& (ps->cu¼’tBrx -…s->cu¼’tTlx <ğps->
xRªge
.
max
))

385 
ps
->
efãùiveTlx
 =…s->
cu¼’tTlx
;

386 
ps
->
efãùiveBrx
 =…s->
cu¼’tBrx
;

390 
ps
->
efãùiveTlx
 = 0;

391 
ps
->
efãùiveBrx
 = 0;

392 
¡©
 = 1;

394 ià((
ps
->
cu¼’tBry
 >…s->
cu¼’tTly
è&& (ps->cu¼’tBry -…s->cu¼’tTly >…s->
mš_height
è&& (ps->cu¼’tBry -…s->cu¼’tTly <ğps->
yRªge
.
max
))

396 
ps
->
efãùiveTly
 =…s->
cu¼’tTly
;

397 
ps
->
efãùiveBry
 =…s->
cu¼’tBry
;

401 
ps
->
efãùiveTly
 = 0;

402 
ps
->
efãùiveBry
 = 0;

403 
¡©
 = 1;

405  
¡©
;

406 
	}
}

412 
SANE_Stus
 
	$sßp_İ’
(
SANE_SŒšg_CÚ¡
 
deviû
, 
SANE_HªdË
 *
hªdË
)

414 
hpmud_mod–_©Œibu‹s
 
ma
;

415 
¡©
 = 
SANE_STATUS_IO_ERROR
, 
i
;

417 
	`DBG8
("§Ã_h·io_İ’(%s)\n", 
deviû
);

419 ià(
£ssiÚ
)

421 
	`BUG
("session in use\n");

422  
SANE_STATUS_DEVICE_BUSY
;

425 ià((
£ssiÚ
 = 
	`ü—‹_£ssiÚ
()è=ğ
NULL
)

426  
SANE_STATUS_NO_MEM
;

429 
	`¢´štf
(
£ssiÚ
->
uri
, (£ssiÚ->uri)-1, "hp:%s", 
deviû
);

432 
	`hpmud_qu”y_mod–
(
£ssiÚ
->
uri
, &
ma
);

433 
£ssiÚ
->
sÿn_ty³
 = 
ma
.
sÿÁy³
;

435 ià(
	`hpmud_İ’_deviû
(
£ssiÚ
->
uri
, 
ma
.
må_mode
, &£ssiÚ->
dd
è!ğ
HPMUD_R_OK
)

437 
	`BUG
("uÇbËØİ’ deviû %s\n", 
£ssiÚ
->
uri
);

438 
bugout
;

440 
	`ä“
(
£ssiÚ
);

441 
£ssiÚ
 = 
NULL
;

442  
SANE_STATUS_IO_ERROR
;

445 ià(
	`bb_lßd
(
£ssiÚ
, 
SCAN_PLUGIN_SOAP
))

447 
¡©
 = 
SANE_STATUS_IO_ERROR
;

448 
bugout
;

452 
	`š™_İtiÚs
(
£ssiÚ
);

454 ià(
£ssiÚ
->
	`bb_İ’
(session))

456 
¡©
 = 
SANE_STATUS_IO_ERROR
;

457 
bugout
;

461 
	`sßp_cÚŒŞ_İtiÚ
(
£ssiÚ
, 
SOAP_OPTION_SCAN_MODE
, 
SANE_ACTION_SET_AUTO
, 
NULL
, NULL);

464 
i
=1;

465 
£ssiÚ
->
»sŞutiÚLi¡
[
i
++] = 75;

466 
£ssiÚ
->
»sŞutiÚLi¡
[
i
++] = 100;

467 
£ssiÚ
->
»sŞutiÚLi¡
[
i
++] = 150;

468 
£ssiÚ
->
»sŞutiÚLi¡
[
i
++] = 200;

469 
£ssiÚ
->
»sŞutiÚLi¡
[
i
++] = 300;

470 
£ssiÚ
->
»sŞutiÚLi¡
[
i
++] = 600;

471 
£ssiÚ
->
»sŞutiÚLi¡
[
i
++] = 1200;

472 
£ssiÚ
->
»sŞutiÚLi¡
[0] = 
i
-1;

473 
	`sßp_cÚŒŞ_İtiÚ
(
£ssiÚ
, 
SOAP_OPTION_SCAN_RESOLUTION
, 
SANE_ACTION_SET_AUTO
, 
NULL
, NULL);

476 
	`sßp_cÚŒŞ_İtiÚ
(
£ssiÚ
, 
SOAP_OPTION_BRIGHTNESS
, 
SANE_ACTION_SET_AUTO
, 
NULL
, NULL);

479 
	`sßp_cÚŒŞ_İtiÚ
(
£ssiÚ
, 
SOAP_OPTION_CONTRAST
, 
SANE_ACTION_SET_AUTO
, 
NULL
, NULL);

482 
	`sßp_cÚŒŞ_İtiÚ
(
£ssiÚ
, 
SOAP_OPTION_COMPRESSION
, 
SANE_ACTION_SET_AUTO
, 
NULL
, NULL);

485 
	`sßp_cÚŒŞ_İtiÚ
(
£ssiÚ
, 
SOAP_OPTION_JPEG_QUALITY
, 
SANE_ACTION_SET_AUTO
, 
NULL
, NULL);

488 
	`sßp_cÚŒŞ_İtiÚ
(
£ssiÚ
, 
SOAP_OPTION_TL_X
, 
SANE_ACTION_SET_AUTO
, 
NULL
, NULL);

489 
	`sßp_cÚŒŞ_İtiÚ
(
£ssiÚ
, 
SOAP_OPTION_TL_Y
, 
SANE_ACTION_SET_AUTO
, 
NULL
, NULL);

490 
	`sßp_cÚŒŞ_İtiÚ
(
£ssiÚ
, 
SOAP_OPTION_BR_X
, 
SANE_ACTION_SET_AUTO
, 
NULL
, NULL);

491 
	`sßp_cÚŒŞ_İtiÚ
(
£ssiÚ
, 
SOAP_OPTION_BR_Y
, 
SANE_ACTION_SET_AUTO
, 
NULL
, NULL);

493 *
hªdË
 = (
SANE_HªdË
 *)
£ssiÚ
;

495 
¡©
 = 
SANE_STATUS_GOOD
;

497 
bugout
:

499 ià(
¡©
 !ğ
SANE_STATUS_GOOD
)

501 ià(
£ssiÚ
)

503 
	`bb_uÆßd
(
£ssiÚ
);

504 ià(
£ssiÚ
->
dd
 > 0)

505 
	`hpmud_şo£_deviû
(
£ssiÚ
->
dd
);

506 
	`ä“
(
£ssiÚ
);

507 
£ssiÚ
 = 
NULL
;

511  
¡©
;

512 
	}
}

514 
	$sßp_şo£
(
SANE_HªdË
 
hªdË
)

516 
sßp_£ssiÚ
 *
ps
 = (sßp_£ssiÚ *)
hªdË
;

518 
	`DBG8
("sane_hpaio_close()\n");

520 ià(
ps
 =ğ
NULL
 ||… !ğ
£ssiÚ
)

522 
	`BUG
("invalid sane_close\n");

526 
ps
->
	`bb_şo£
(ps);

527 
	`bb_uÆßd
(
ps
);

529 ià(
ps
->
dd
 > 0)

530 
	`hpmud_şo£_deviû
(
ps
->
dd
);

532 
	`ä“
(
ps
);

533 
£ssiÚ
 = 
NULL
;

534 
	}
}

536 cÚ¡ 
SANE_O±iÚ_DesütÜ
 *
	$sßp_g‘_İtiÚ_desütÜ
(
SANE_HªdË
 
hªdË
, 
SANE_IÁ
 
İtiÚ
)

538 
sßp_£ssiÚ
 *
ps
 = (sßp_£ssiÚ *)
hªdË
;

540 
	`DBG8
("§Ã_h·io_g‘_İtiÚ_desütÜ(İtiÚ=%s)\n", 
ps
->
İtiÚ
[İtiÚ].
Çme
);

542 ià(
İtiÚ
 < 0 || o±iÚ >ğ
SOAP_OPTION_MAX
)

543  
NULL
;

545  &
ps
->
İtiÚ
[option];

546 
	}
}

548 
SANE_Stus
 
	$sßp_cÚŒŞ_İtiÚ
(
SANE_HªdË
 
hªdË
, 
SANE_IÁ
 
İtiÚ
, 
SANE_AùiÚ
 
aùiÚ
, *
v®ue
, SANE_IÁ *
£t_»suÉ
)

550 
sßp_£ssiÚ
 *
ps
 = (sßp_£ssiÚ *)
hªdË
;

551 
SANE_IÁ
 *
št_v®ue
 = 
v®ue
, 
m£t_»suÉ
=0;

552 
i
, 
¡©
=
SANE_STATUS_INVAL
;

553 
sz
[64];

555 
İtiÚ
)

557 
SOAP_OPTION_COUNT
:

558 ià(
aùiÚ
 =ğ
SANE_ACTION_GET_VALUE
)

560 *
št_v®ue
 = 
SOAP_OPTION_MAX
;

561 
¡©
 = 
SANE_STATUS_GOOD
;

564 
SOAP_OPTION_SCAN_MODE
:

565 ià(
aùiÚ
 =ğ
SANE_ACTION_GET_VALUE
)

567 
i
=0; 
ps
->
sÿnModeLi¡
[i]; i++)

569 ià(
ps
->
cu¼’tSÿnMode
 =ğps->
sÿnModeM­
[
i
])

571 
	`¡rıy
(
v®ue
, 
ps
->
sÿnModeLi¡
[
i
]);

572 
¡©
 = 
SANE_STATUS_GOOD
;

577 ià(
aùiÚ
 =ğ
SANE_ACTION_SET_VALUE
)

579 
i
=0; 
ps
->
sÿnModeLi¡
[i]; i++)

581 ià(
	`¡rÿ£cmp
(
ps
->
sÿnModeLi¡
[
i
], 
v®ue
) == 0)

583 
ps
->
cu¼’tSÿnMode
 =…s->
sÿnModeM­
[
i
];

584 
	`£t_sÿn_mode_side_efãùs
(
ps
,…s->
cu¼’tSÿnMode
);

585 
m£t_»suÉ
 |ğ
SANE_INFO_RELOAD_PARAMS
 | 
SANE_INFO_RELOAD_OPTIONS
;

586 
¡©
 = 
SANE_STATUS_GOOD
;

593 
ps
->
cu¼’tSÿnMode
 =…s->
sÿnModeM­
[0];

594 
	`£t_sÿn_mode_side_efãùs
(
ps
,…s->
cu¼’tSÿnMode
);

595 
¡©
 = 
SANE_STATUS_GOOD
;

598 
SOAP_OPTION_SCAN_RESOLUTION
:

599 ià(
aùiÚ
 =ğ
SANE_ACTION_GET_VALUE
)

601 *
št_v®ue
 = 
ps
->
cu¼’tResŞutiÚ
;

602 
¡©
 = 
SANE_STATUS_GOOD
;

604 ià(
aùiÚ
 =ğ
SANE_ACTION_SET_VALUE
)

606 
i
=1; i <ğ
ps
->
»sŞutiÚLi¡
[0]; i++)

608 ià(
ps
->
»sŞutiÚLi¡
[
i
] =ğ*
št_v®ue
)

610 
ps
->
cu¼’tResŞutiÚ
 = *
št_v®ue
;

611 
m£t_»suÉ
 |ğ
SANE_INFO_RELOAD_PARAMS
;

612 
¡©
 = 
SANE_STATUS_GOOD
;

616 ià(
¡©
 !ğ
SANE_STATUS_GOOD
)

618 
ps
->
cu¼’tResŞutiÚ
 =…s->
»sŞutiÚLi¡
[1];

619 
¡©
 = 
SANE_STATUS_GOOD
;

624 
ps
->
cu¼’tResŞutiÚ
 = 75;

625 
¡©
 = 
SANE_STATUS_GOOD
;

628 
SOAP_OPTION_CONTRAST
:

629 ià(
aùiÚ
 =ğ
SANE_ACTION_GET_VALUE
)

631 *
št_v®ue
 = 
ps
->
cu¼’tCÚŒa¡
;

632 
¡©
 = 
SANE_STATUS_GOOD
;

634 ià(
aùiÚ
 =ğ
SANE_ACTION_SET_VALUE
)

636 ià(*
št_v®ue
 >ğ
SOAP_CONTRAST_MIN
 && *št_v®u<ğ
SOAP_CONTRAST_MAX
)

638 
ps
->
cu¼’tCÚŒa¡
 = *
št_v®ue
;

642 
ps
->
cu¼’tCÚŒa¡
 = 
SOAP_CONTRAST_DEFAULT
;

644 
m£t_»suÉ
 |ğ
SANE_INFO_RELOAD_PARAMS
;

645 
¡©
 = 
SANE_STATUS_GOOD
;

649 
ps
->
cu¼’tCÚŒa¡
 = 
SOAP_CONTRAST_DEFAULT
;

650 
¡©
 = 
SANE_STATUS_GOOD
;

653 
SOAP_OPTION_BRIGHTNESS
:

654 ià(
aùiÚ
 =ğ
SANE_ACTION_GET_VALUE
)

656 *
št_v®ue
 = 
ps
->
cu¼’tBrighŠess
;

657 
¡©
 = 
SANE_STATUS_GOOD
;

659 ià(
aùiÚ
 =ğ
SANE_ACTION_SET_VALUE
)

661 ià(*
št_v®ue
 >ğ
SOAP_BRIGHTNESS_MIN
 && *št_v®u<ğ
SOAP_BRIGHTNESS_MAX
)

663 
ps
->
cu¼’tBrighŠess
 = *
št_v®ue
;

667 
ps
->
cu¼’tBrighŠess
 = 
SOAP_BRIGHTNESS_DEFAULT
;

669 
¡©
 = 
SANE_STATUS_GOOD
;

673 
ps
->
cu¼’tBrighŠess
 = 
SOAP_BRIGHTNESS_DEFAULT
;

674 
¡©
 = 
SANE_STATUS_GOOD
;

677 
SOAP_OPTION_COMPRESSION
:

678 ià(
aùiÚ
 =ğ
SANE_ACTION_GET_VALUE
)

680 
i
=0; 
ps
->
com´essiÚLi¡
[i]; i++)

682 ià(
ps
->
cu¼’tCom´essiÚ
 =ğps->
com´essiÚM­
[
i
])

684 
	`¡rıy
(
v®ue
, 
ps
->
com´essiÚLi¡
[
i
]);

685 
¡©
 = 
SANE_STATUS_GOOD
;

690 ià(
aùiÚ
 =ğ
SANE_ACTION_SET_VALUE
)

692 
i
=0; 
ps
->
com´essiÚLi¡
[i]; i++)

694 ià(
	`¡rÿ£cmp
(
ps
->
com´essiÚLi¡
[
i
], 
v®ue
) == 0)

696 
ps
->
cu¼’tCom´essiÚ
 =…s->
com´essiÚM­
[
i
];

697 
¡©
 = 
SANE_STATUS_GOOD
;

704 
ps
->
cu¼’tCom´essiÚ
 = 
SF_JFIF
;

705 
¡©
 = 
SANE_STATUS_GOOD
;

708 
SOAP_OPTION_JPEG_QUALITY
:

709 ià(
aùiÚ
 =ğ
SANE_ACTION_GET_VALUE
)

711 *
št_v®ue
 = 
ps
->
cu¼’tJ³gQu®™y
;

712 
¡©
 = 
SANE_STATUS_GOOD
;

714 ià(
aùiÚ
 =ğ
SANE_ACTION_SET_VALUE
)

716 ià(*
št_v®ue
 >ğ
MIN_JPEG_COMPRESSION_FACTOR
 && *št_v®u<ğ
MAX_JPEG_COMPRESSION_FACTOR
)

718 
ps
->
cu¼’tJ³gQu®™y
 = *
št_v®ue
;

719 
¡©
 = 
SANE_STATUS_GOOD
;

725 
ps
->
cu¼’tJ³gQu®™y
 = 
SAFER_JPEG_COMPRESSION_FACTOR
;

726 
¡©
 = 
SANE_STATUS_GOOD
;

729 
SOAP_OPTION_TL_X
:

730 ià(
aùiÚ
 =ğ
SANE_ACTION_GET_VALUE
)

732 *
št_v®ue
 = 
ps
->
cu¼’tTlx
;

733 
¡©
 = 
SANE_STATUS_GOOD
;

735 ià(
aùiÚ
 =ğ
SANE_ACTION_SET_VALUE
)

737 ià(*
št_v®ue
 >ğ
ps
->
xRªge
.
mš
 && *št_v®u<ğps->xRªge.
max
)

739 
ps
->
cu¼’tTlx
 = *
št_v®ue
;

740 
m£t_»suÉ
 |ğ
SANE_INFO_RELOAD_PARAMS
;

741 
¡©
 = 
SANE_STATUS_GOOD
;

747 
ps
->
cu¼’tTlx
 =…s->
xRªge
.
mš
;

748 
¡©
 = 
SANE_STATUS_GOOD
;

751 
SOAP_OPTION_TL_Y
:

752 ià(
aùiÚ
 =ğ
SANE_ACTION_GET_VALUE
)

754 *
št_v®ue
 = 
ps
->
cu¼’tTly
;

755 
¡©
 = 
SANE_STATUS_GOOD
;

757 ià(
aùiÚ
 =ğ
SANE_ACTION_SET_VALUE
)

759 ià(*
št_v®ue
 >ğ
ps
->
yRªge
.
mš
 && *št_v®u<ğps->yRªge.
max
)

762 
ps
->
cu¼’tTly
 = *
št_v®ue
;

763 
m£t_»suÉ
 |ğ
SANE_INFO_RELOAD_PARAMS
;

764 
¡©
 = 
SANE_STATUS_GOOD
;

770 
ps
->
cu¼’tTly
 =…s->
yRªge
.
mš
;

771 
¡©
 = 
SANE_STATUS_GOOD
;

774 
SOAP_OPTION_BR_X
:

775 ià(
aùiÚ
 =ğ
SANE_ACTION_GET_VALUE
)

777 *
št_v®ue
 = 
ps
->
cu¼’tBrx
;

778 
¡©
 = 
SANE_STATUS_GOOD
;

780 ià(
aùiÚ
 =ğ
SANE_ACTION_SET_VALUE
)

782 ià(*
št_v®ue
 >ğ
ps
->
brxRªge
.
mš
 && *št_v®u<ğps->brxRªge.
max
)

784 
ps
->
cu¼’tBrx
 = *
št_v®ue
;

785 
m£t_»suÉ
 |ğ
SANE_INFO_RELOAD_PARAMS
;

786 
¡©
 = 
SANE_STATUS_GOOD
;

792 
ps
->
cu¼’tBrx
 =…s->
brxRªge
.
max
;

793 
¡©
 = 
SANE_STATUS_GOOD
;

796 
SOAP_OPTION_BR_Y
:

797 ià(
aùiÚ
 =ğ
SANE_ACTION_GET_VALUE
)

799 *
št_v®ue
 = 
ps
->
cu¼’tBry
;

800 
¡©
 = 
SANE_STATUS_GOOD
;

802 ià(
aùiÚ
 =ğ
SANE_ACTION_SET_VALUE
)

804 ià(*
št_v®ue
 >ğ
ps
->
bryRªge
.
mš
 && *št_v®u<ğps->bryRªge.
max
)

806 
ps
->
cu¼’tBry
 = *
št_v®ue
;

807 
m£t_»suÉ
 |ğ
SANE_INFO_RELOAD_PARAMS
;

808 
¡©
 = 
SANE_STATUS_GOOD
;

814 
ps
->
cu¼’tBry
 =…s->
bryRªge
.
max
;

815 
¡©
 = 
SANE_STATUS_GOOD
;

822 ià(
£t_»suÉ
)

823 *
£t_»suÉ
 = 
m£t_»suÉ
;

825 ià(
¡©
 !ğ
SANE_STATUS_GOOD
)

827 
	`BUG
("cÚŒŞ_İtiÚ faed: o±iÚ=% aùiÚ=%s\n", 
ps
->
İtiÚ
[İtiÚ].
Çme
,

828 
aùiÚ
==
SANE_ACTION_GET_VALUE
 ? "g‘" :‡ùiÚ==
SANE_ACTION_SET_VALUE
 ? "set" : "auto");

831 
	`DBG8
("§Ã_h·io_cÚŒŞ_İtiÚ (İtiÚ=% aùiÚ=% v®ue=%s)\n", 
ps
->
İtiÚ
[İtiÚ].
Çme
,

832 
aùiÚ
==
SANE_ACTION_GET_VALUE
 ? "g‘" :‡ùiÚ==
SANE_ACTION_SET_VALUE
 ? "set" : "auto",

833 
v®ue
 ? 
ps
->
İtiÚ
[İtiÚ].
ty³
 =ğ
SANE_TYPE_STRING
 ? (*)v®u: 
	`p¢´štf
(
sz
, (sz), "%d", *(*)value) : "na");

835  
¡©
;

836 
	}
}

838 
SANE_Stus
 
	$sßp_g‘_·¿m‘”s
(
SANE_HªdË
 
hªdË
, 
SANE_P¬am‘”s
 *
·¿ms
)

840 
sßp_£ssiÚ
 *
ps
 = (sßp_£ssiÚ *)
hªdË
;

842 
	`£t_ex‹Ás
(
ps
);

845 
ps
->
	`bb_g‘_·¿m‘”s
Õs, 
·¿ms
,…s->
_hªdË
 ? 
SPO_STARTED
 : 
SPO_BEST_GUESS
);

847 
	`DBG8
("sane_hpaio_get_parameters(): format=%d,†ast_frame=%d,†ines=%d, depth=%d,…ixels_per_line=%d, bytes_per_line=%d\n",

848 
·¿ms
->
fÜm©
,…¬ams->
Ï¡_äame
,…¬ams->
lšes
,…¬ams->
d•th
,…¬ams->
pix–s_³r_lše
,…¬ams->
by‹s_³r_lše
);

850  
SANE_STATUS_GOOD
;

851 
	}
}

853 
SANE_Stus
 
	$sßp_¡¬t
(
SANE_HªdË
 
hªdË
)

855 
sßp_£ssiÚ
 *
ps
 = (sßp_£ssiÚ *)
hªdË
;

856 
SANE_P¬am‘”s
 
µ
;

857 
IP_IMAGE_TRAITS
 
Œa™s
;

858 
IP_XFORM_SPEC
 
xfÜms
[
IP_MAX_XFORMS
], *
pXfÜm
=xforms;

859 
¡©
, 
»t
;

861 
	`DBG8
("sane_hpaio_start()\n");

862 
ps
->
u£r_ÿnûl
 = 0;

863 ià(
	`£t_ex‹Ás
(
ps
))

865 
	`BUG
("invalidƒxtents:lx=%d brx=%dly=%d bry=%d minwidth=%d minheight%d maxwidth=%d maxheight=%d\n",

866 
ps
->
cu¼’tTlx
,…s->
cu¼’tTly
,…s->
cu¼’tBrx
,…s->
cu¼’tBry
,…s->
mš_width
,…s->
mš_height
,…s->
xRªge
.
max
,…s->
yRªge
.max);

867 
¡©
 = 
SANE_STATUS_INVAL
;

868 
bugout
;

872 ià(
ps
->
	`bb_¡¬t_sÿn
(ps))

874 
¡©
 = 
SANE_STATUS_IO_ERROR
;

875 
bugout
;

877 
	`S’dSÿnEv’t
(
ps
->
uri
, 
EVENT_START_SCAN_JOB
);

878 
	`mem£t
(
xfÜms
, 0, (xforms));

881 ià(
ps
->
cu¼’tSÿnMode
 =ğ
CE_RGB24
 ||…s->cu¼’tSÿnMod=ğ
CE_GRAY8
)

883 
pXfÜm
->
aXfÜmInfo
[
IP_JPG_DECODE_FROM_DENALI
].
dwÜd
 = 0;

884 
	`ADD_XFORM
(
X_JPG_DECODE
);

885 
pXfÜm
->
aXfÜmInfo
[
IP_CNV_COLOR_SPACE_WHICH_CNV
].
dwÜd
 = 
IP_CNV_YCC_TO_SRGB
;

886 
pXfÜm
->
aXfÜmInfo
[
IP_CNV_COLOR_SPACE_GAMMA
].
dwÜd
 = 0x00010000;

887 
	`ADD_XFORM
(
X_CNV_COLOR_SPACE
);

891 
pXfÜm
->
aXfÜmInfo
[
IP_JPG_DECODE_FROM_DENALI
].
dwÜd
 = 0;

892 
	`ADD_XFORM
(
X_JPG_DECODE
);

893 
pXfÜm
->
aXfÜmInfo
[
IP_GRAY_2_BI_THRESHOLD
].
dwÜd
 = 127;

894 
	`ADD_XFORM
(
X_GRAY_2_BI
);

898 
pXfÜm
->
aXfÜmInfo
[
IP_CROP_LEFT
].
dwÜd
 = 0;

899 
pXfÜm
->
aXfÜmInfo
[
IP_CROP_RIGHT
].
dwÜd
 = 0;

900 
pXfÜm
->
aXfÜmInfo
[
IP_CROP_TOP
].
dwÜd
 = 0;

901 
pXfÜm
->
aXfÜmInfo
[
IP_CROP_MAXOUTROWS
].
dwÜd
 = 0;

902 
	`ADD_XFORM
(
X_CROP
);

905 
pXfÜm
->
aXfÜmInfo
[
IP_PAD_LEFT
].
dwÜd
 = 0;

906 
pXfÜm
->
aXfÜmInfo
[
IP_PAD_RIGHT
].
dwÜd
 = 0;

907 
pXfÜm
->
aXfÜmInfo
[
IP_PAD_TOP
].
dwÜd
 = 0;

908 
pXfÜm
->
aXfÜmInfo
[
IP_PAD_BOTTOM
].
dwÜd
 = 0;

909 
pXfÜm
->
aXfÜmInfo
[
IP_PAD_VALUE
].
dwÜd
 = 
ps
->
cu¼’tSÿnMode
 =ğ
CE_BLACK_AND_WHITE1
 ? 0 : -1;

910 
pXfÜm
->
aXfÜmInfo
[
IP_PAD_MIN_HEIGHT
].
dwÜd
 = 0;

911 
	`ADD_XFORM
(
X_PAD
);

914 ià((
»t
 = 
	`O³n
(
pXfÜm
-
xfÜms
, xfÜms, 0, &
ps
->
_hªdË
)è!ğ
IP_DONE
)

916 
	`BUG
("uÇbË o³Àimag´oûssÜ:ƒ¼=%d\n", 
»t
);

917 
¡©
 = 
SANE_STATUS_INVAL
;

918 
bugout
;

922 
ps
->
	`bb_g‘_·¿m‘”s
Õs, &
µ
, 
SPO_BEST_GUESS
);

923 
Œa™s
.
iPix–sP”Row
 = 
µ
.
pix–s_³r_lše
;

924 
ps
->
cu¼’tSÿnMode
)

926 
CE_BLACK_AND_WHITE1
:

927 
CE_GRAY8
:

928 
Œa™s
.
iB™sP”Pix–
 = 8;

930 
CE_RGB24
:

932 
Œa™s
.
iB™sP”Pix–
 = 24;

935 
Œa™s
.
lHÜizDPI
 = 
ps
->
cu¼’tResŞutiÚ
 << 16;

936 
Œa™s
.
lV”tDPI
 = 
ps
->
cu¼’tResŞutiÚ
 << 16;

937 
Œa™s
.
lNumRows
 = 
µ
.
lšes
;

938 
Œa™s
.
iNumPages
 = 1;

939 
Œa™s
.
iPageNum
 = 1;

940 
Œa™s
.
iCompÚ’tsP”Pix–
 = (Ñ¿™s.
iB™sP”Pix–
 % 3) ? 1 : 3);

941 
	`DBG6
("£ˆŒa™ iPix–sP”Row=%d iB™sP”Pix–=%d†NumRows=%d iCompÚ’tsP”Pix–=%d\n", 
Œa™s
.
iPix–sP”Row
,

942 
Œa™s
.
iB™sP”Pix–
, (é¿™s.
lNumRows
,¿™s.
iCompÚ’tsP”Pix–
);

943 
	`S‘DeçuÉIÅutT¿™s
(
ps
->
_hªdË
, &
Œa™s
);

946 ià(
ps
->
cu¼’tCom´essiÚ
 =ğ
SF_JFIF
)

949 
	`ResuÉMask
(
ps
->
_hªdË
, 
IP_PARSED_HEADER
);

954 
»t
 = 
	`g‘__d©a
(
ps
, 
NULL
, 0, NULL);

956 ià(
»t
 & (
IP_INPUT_ERROR
 | 
IP_FATAL_ERROR
 | 
IP_DONE
))

958 
	`BUG
("CÚv”ˆ”rÜ=%x\n", 
»t
);

959 
¡©
 = 
SANE_STATUS_IO_ERROR
;

960 
bugout
;

963 ià(
»t
 & 
IP_PARSED_HEADER
)

965 
	`G‘ImageT¿™s
(
ps
->
_hªdË
, 
NULL
, &ps->
image_Œa™s
);

966 
	`ResuÉMask
(
ps
->
_hªdË
, 0);

972 
	`G‘ImageT¿™s
(
ps
->
_hªdË
, 
NULL
, &ps->
image_Œa™s
);

974 
	`DBG6
("aù¿™ iPix–sP”Row=%d iB™sP”Pix–=%d†NumRows=%d iCompÚ’tsP”Pix–=%d\n", 
ps
->
image_Œa™s
.
iPix–sP”Row
,

975 
ps
->
image_Œa™s
.
iB™sP”Pix–
, (ís->image_Œa™s.
lNumRows
,…s->image_Œa™s.
iCompÚ’tsP”Pix–
);

977 
¡©
 = 
SANE_STATUS_GOOD
;

979 
bugout
:

980 ià(
¡©
 !ğ
SANE_STATUS_GOOD
)

982 ià(
ps
->
_hªdË
)

984 
	`Clo£
(
ps
->
_hªdË
);

985 
ps
->
_hªdË
 = 0;

987 
ps
->
	`bb_’d_sÿn
Õs, 
¡©
 =ğ
SANE_STATUS_IO_ERROR
 ? 1: 0);

990  
¡©
;

991 
	}
}

993 
SANE_Stus
 
	$sßp_»ad
(
SANE_HªdË
 
hªdË
, 
SANE_By‹
 *
d©a
, 
SANE_IÁ
 
maxL’gth
, SANE_IÁ *
Ëngth
)

995 
sßp_£ssiÚ
 *
ps
 = (sßp_£ssiÚ *)
hªdË
;

996 
»t
, 
¡©
=
SANE_STATUS_IO_ERROR
;

998 
	`DBG8
("§Ã_h·io_»ad(èhªdË=%°d©a=%°maxL’gth=%d\n", (*)
hªdË
, 
d©a
, 
maxL’gth
);

999 if(
ps
->
u£r_ÿnûl
)

1001 
	`DBG8
("sßp_»ad(èEVENT_SCAN_CANCEL****uri=%s\n", 
ps
->
uri
);

1002 
	`S’dSÿnEv’t
(
ps
->
uri
, 
EVENT_SCAN_CANCEL
);

1003  
SANE_STATUS_CANCELLED
;

1006 
»t
 = 
	`g‘__d©a
(
ps
, 
d©a
, 
maxL’gth
, 
Ëngth
);

1008 if(
»t
 & (
IP_INPUT_ERROR
 | 
IP_FATAL_ERROR
))

1010 
	`BUG
("CÚv”ˆ”rÜ=%x\n", 
»t
);

1011 
bugout
;

1014 ià(
»t
 & 
IP_DONE
)

1016 
¡©
 = 
SANE_STATUS_EOF
;

1017 
	`S’dSÿnEv’t
 (
ps
->
uri
, 
EVENT_END_SCAN_JOB
);

1020 
¡©
 = 
SANE_STATUS_GOOD
;

1022 
bugout
:

1023 ià(
¡©
 !ğ
SANE_STATUS_GOOD
)

1025 ià(
ps
->
_hªdË
)

1028 
	`Clo£
(
ps
->
_hªdË
);

1029 
ps
->
_hªdË
 = 0;

1031 
ps
->
	`bb_’d_·ge
(ps, 0);

1034 
	`DBG8
("-§Ã_h·io_»ad(èouut=%°by‹s_»ad=%d maxL’gth=%d stus=%d\n", 
d©a
, *
Ëngth
, 
maxL’gth
, 
¡©
);

1036  
¡©
;

1037 
	}
}

1039 
	$sßp_ÿnûl
(
SANE_HªdË
 
hªdË
)

1041 
sßp_£ssiÚ
 *
ps
 = (sßp_£ssiÚ *)
hªdË
;

1043 
	`DBG8
("sane_hpaio_cancel()\n");

1049 
ps
->
u£r_ÿnûl
 = 1;

1050 ià(
ps
->
_hªdË
)

1052 
	`Clo£
(
ps
->
_hªdË
);

1053 
ps
->
_hªdË
 = 0;

1055 
ps
->
	`bb_’d_sÿn
(ps, 0);

1056 
	}
}

	@scan/sane/soap.h

26 #iâdeà
_SOAP_H


27 
	#_SOAP_H


	)

29 
	~"§Ã.h
"

31 
SANE_Stus
 
sßp_İ’
(
SANE_SŒšg_CÚ¡
 
deviû
, 
SANE_HªdË
 *
hªdË
);

32 
sßp_şo£
(
SANE_HªdË
 
hªdË
);

33 cÚ¡ 
SANE_O±iÚ_DesütÜ
 * 
sßp_g‘_İtiÚ_desütÜ
(
SANE_HªdË
 
hªdË
, 
SANE_IÁ
 
İtiÚ
);

34 
SANE_Stus
 
sßp_cÚŒŞ_İtiÚ
(
SANE_HªdË
 
hªdË
, 
SANE_IÁ
 
İtiÚ
, 
SANE_AùiÚ
 
aùiÚ
, *
v®ue
, SANE_IÁ *
šfo
);

35 
SANE_Stus
 
sßp_g‘_·¿m‘”s
(
SANE_HªdË
 
hªdË
, 
SANE_P¬am‘”s
 *
·¿ms
);

36 
SANE_Stus
 
sßp_¡¬t
(
SANE_HªdË
 
hªdË
);

37 
SANE_Stus
 
sßp_»ad
(
SANE_HªdË
 
hªdË
, 
SANE_By‹
 *
d©a
, 
SANE_IÁ
 
maxL’gth
, SANE_IÁ *
Ëngth
);

38 
sßp_ÿnûl
(
SANE_HªdË
 
hªdË
);

	@scan/sane/soapht.c

34 #iâdeà
_GNU_SOURCE


35 
	#_GNU_SOURCE


	)

38 
	~<¡d¬g.h
>

39 
	~<sy¦og.h
>

40 
	~<¡dio.h
>

41 
	~<¡ršg.h
>

42 
	~<fú.h
>

43 
	~<m©h.h
>

44 
	~<dlfú.h
>

45 
	~"§Ã.h
"

46 
	~"§Ãİts.h
"

47 
	~"hpmud.h
"

48 
	~"hp.h
"

49 
	~"commÚ.h
"

50 
	~"sßpht.h
"

51 
	~"sßphti.h
"

52 
	~"io.h
"

53 
	~"uts.h
"

55 
	#DEBUG_DECLARE_ONLY


	)

56 
	~"§Ãi_debug.h
"

58 
sßp_£ssiÚ
 *
	g£ssiÚ
 = 
NULL
;

60 
	$bb_lßd
(
sßp_£ssiÚ
 *
ps
, cÚ¡ *
so
)

62 
¡©
=1;

65 ià((
ps
->
hpmud_hªdË
 = 
	`lßd_lib¿ry
("libhpmud.so.0")è=ğ
NULL
)

67 ià((
ps
->
hpmud_hªdË
 = 
	`lßd_lib¿ry
("libhpmud.so.0")è=ğ
NULL
)

68 
bugout
;

72 ià((
ps
->
m©h_hªdË
 = 
	`lßd_lib¿ry
("libm.so")è=ğ
NULL
)

74 ià((
ps
->
m©h_hªdË
 = 
	`lßd_lib¿ry
("libm.so.6")è=ğ
NULL
)

75 
bugout
;

78 ià((
ps
->
bb_hªdË
 = 
	`lßd_¶ugš_lib¿ry
(
UTILS_SCAN_PLUGIN_LIBRARY
, 
so
)è=ğ
NULL
)

80 
	`S’dSÿnEv’t
(
ps
->
uri
, 
EVENT_PLUGIN_FAIL
);

81 
bugout
;

84 ià((
ps
->
bb_İ’
 = 
	`g‘_lib¿ry_symbŞ
Õs->
bb_hªdË
, "bb_İ’")è=ğ
NULL
)

85 
bugout
;

87 ià((
ps
->
bb_şo£
 = 
	`g‘_lib¿ry_symbŞ
Õs->
bb_hªdË
, "bb_şo£")è=ğ
NULL
)

88 
bugout
;

90 ià((
ps
->
bb_g‘_·¿m‘”s
 = 
	`g‘_lib¿ry_symbŞ
Õs->
bb_hªdË
, "bb_g‘_·¿m‘”s")è=ğ
NULL
)

91 
bugout
;

93 ià((
ps
->
bb_is_·³r_š_adf
 = 
	`g‘_lib¿ry_symbŞ
Õs->
bb_hªdË
, "bb_is_·³r_š_adf")è=ğ
NULL
)

94 
bugout
;

96 ià((
ps
->
bb_¡¬t_sÿn
 = 
	`g‘_lib¿ry_symbŞ
Õs->
bb_hªdË
, "bb_¡¬t_sÿn")è=ğ
NULL
)

97 
bugout
;

99 ià((
ps
->
bb_’d_sÿn
 = 
	`g‘_lib¿ry_symbŞ
Õs->
bb_hªdË
, "bb_’d_sÿn")è=ğ
NULL
)

100 
bugout
;

102 ià((
ps
->
bb_g‘_image_d©a
 = 
	`g‘_lib¿ry_symbŞ
Õs->
bb_hªdË
, "bb_g‘_image_d©a")è=ğ
NULL
)

103 
bugout
;

105 ià((
ps
->
bb_’d_·ge
 = 
	`g‘_lib¿ry_symbŞ
Õs->
bb_hªdË
, "bb_’d_·ge")è=ğ
NULL
)

106 
bugout
;

109 
¡©
=0;

111 
bugout
:

112  
¡©
;

113 
	}
}

115 
	$bb_uÆßd
(
sßp_£ssiÚ
 *
ps
)

117 
	`uÆßd_lib¿ry
(
ps
->
bb_hªdË
);

118 
ps
->
bb_hªdË
 = 
NULL
;

120 
	`uÆßd_lib¿ry
(
ps
->
hpmud_hªdË
);

121 
ps
->
hpmud_hªdË
 = 
NULL
;

123 
	`uÆßd_lib¿ry
(
ps
->
m©h_hªdË
);

124 
ps
->
m©h_hªdË
 = 
NULL
;

127 
	}
}

130 
	$g‘__d©a
(
sßp_£ssiÚ
 *
ps
, 
SANE_By‹
 *
d©a
, 
SANE_IÁ
 
maxL’gth
, SANE_IÁ *
Ëngth
)

132 
_»t
=
IP_INPUT_ERROR
;

133 
ouutAva
=
maxL’gth
, 
ouutU£d
=0, 
ouutThisPos
;

134 *
šput
, *
ouut
 = 
d©a
;

135 
šputAva
, 
šputU£d
=0, 
šputNextPos
;

137 ià(!
ps
->
_hªdË
)

139 
	`BUG
("invalid ipconvert state\n");

140 
bugout
;

143 ià(
ps
->
	`bb_g‘_image_d©a
Õs, 
ouutAva
))

144 
bugout
;

146 ià(
ps
->
út
 > 0)

148 
šputAva
 = 
ps
->
út
;

149 
šput
 = &
ps
->
buf
[ps->
šdex
];

153 
šput
 = 
NULL
;

154 
šputAva
 = 0;

158 
_»t
 = 
	`CÚv”t
(
ps
->
_hªdË
, 
šputAva
, 
šput
, &
šputU£d
, &
šputNextPos
, 
ouutAva
, 
ouut
, &
ouutU£d
, &
ouutThisPos
);

160 
	`DBG6
("út=%d index=%d iÅut=%°šputAva=%d iÅutU£d=%d iÅutNextPos=%d ouut=%°ouutAva=%d ouutU£d=%d ouutThisPos=%d\n", 
ps
->
út
,…s->
šdex
, 
šput
,

161 
šputAva
, 
šputU£d
, 
šputNextPos
, 
ouut
, 
ouutAva
, 
ouutU£d
, 
ouutThisPos
);

163 ià(
šput
 !ğ
NULL
)

165 ià(
šputAva
 =ğ
šputU£d
)

167 
ps
->
šdex
 =…s->
út
 = 0;

171 
ps
->
út
 -ğ
šputU£d
;

172 
ps
->
šdex
 +ğ
šputU£d
;

176 ià(
d©a
)

177 *
Ëngth
 = 
ouutU£d
;

180 ià(
_»t
 & 
IP_DONE
 && 
ouutU£d
)

181 
_»t
 &ğ~
IP_DONE
;

183 
bugout
:

184  
_»t
;

185 
	}
}

187 
	$£t_sÿn_mode_side_efãùs
(
sßp_£ssiÚ
 *
ps
, 
COLOR_ENTRY
 
sÿnMode
)

189 
j
=0;

191 
	`mem£t
(
ps
->
com´essiÚLi¡
, 0, (ps->compressionList));

192 
	`mem£t
(
ps
->
com´essiÚM­
, 0, (ps->compressionMap));

194 
sÿnMode
)

196 
CE_BLACK_AND_WHITE1
:

197 
CE_GRAY8
:

198 
CE_RGB24
:

200 
ps
->
com´essiÚLi¡
[
j
] = 
STR_COMPRESSION_NONE
;

201 
ps
->
com´essiÚM­
[
j
++] = 
SF_HPRAW
;

202 
ps
->
com´essiÚLi¡
[
j
] = 
STR_COMPRESSION_JPEG
;

203 
ps
->
com´essiÚM­
[
j
++] = 
SF_JFIF
;

204 
ps
->
cu¼’tCom´essiÚ
 = 
SF_JFIF
;

205 
ps
->
İtiÚ
[
SOAP_OPTION_JPEG_QUALITY
].
ÿp
 |ğ
SANE_CAP_SOFT_SELECT
;

210 
	}
}

212 
	$£t_šput_sourû_side_efãùs
(
sßp_£ssiÚ
 *
ps
, 
INPUT_SOURCE
 
sourû
)

214 
sourû
)

216 
IS_PLATEN
:

217 
ps
->
mš_width
 =…s->
¶©’_mš_width
;

218 
ps
->
mš_height
 =…s->
¶©’_mš_height
;

219 
ps
->
xRªge
.
max
 =…s->
¶©’_xRªge
.max;

220 
ps
->
brxRªge
.
max
 =…s->
¶©’_brxRªge
.max;

221 
ps
->
yRªge
.
max
 =…s->
¶©’_yRªge
.max;

222 
ps
->
bryRªge
.
max
 =…s->
¶©’_bryRªge
.max;

224 
IS_ADF
:

225 
IS_ADF_DUPLEX
:

227 
ps
->
mš_width
 =…s->
adf_mš_width
;

228 
ps
->
mš_height
 =…s->
adf_mš_height
;

229 
ps
->
xRªge
.
max
 =…s->
adf_xRªge
.max;

230 
ps
->
brxRªge
.
max
 =…s->
adf_brxRªge
.max;

231 
ps
->
yRªge
.
max
 =…s->
adf_yRªge
.max;

232 
ps
->
bryRªge
.
max
 =…s->
adf_bryRªge
.max;

236 ià((
ps
->
adf_bryRªge
.
max
 !ğps->
¶©’_bryRªge
.maxè|| (ps->
adf_brxRªge
.max !ğps->
¶©’_brxRªge
.max))

238 
ps
->
cu¼’tTly
 =…s->
yRªge
.
mš
;

239 
ps
->
cu¼’tBrx
 =…s->
brxRªge
.
max
;

240 
ps
->
cu¼’tTlx
 =…s->
xRªge
.
mš
;

241 
ps
->
cu¼’tBry
 =…s->
bryRªge
.
max
;

245 
	}
}

247 
	$š™_İtiÚs
(
sßp_£ssiÚ
 *
ps
)

249 
ps
->
İtiÚ
[
SOAP_OPTION_COUNT
].
Çme
 = "option-cnt";

250 
ps
->
İtiÚ
[
SOAP_OPTION_COUNT
].
t™Ë
 = 
SANE_TITLE_NUM_OPTIONS
;

251 
ps
->
İtiÚ
[
SOAP_OPTION_COUNT
].
desc
 = 
SANE_DESC_NUM_OPTIONS
;

252 
ps
->
İtiÚ
[
SOAP_OPTION_COUNT
].
ty³
 = 
SANE_TYPE_INT
;

253 
ps
->
İtiÚ
[
SOAP_OPTION_COUNT
].
un™
 = 
SANE_UNIT_NONE
;

254 
ps
->
İtiÚ
[
SOAP_OPTION_COUNT
].
size
 = (
SANE_IÁ
);

255 
ps
->
İtiÚ
[
SOAP_OPTION_COUNT
].
ÿp
 = 
SANE_CAP_SOFT_DETECT
;

256 
ps
->
İtiÚ
[
SOAP_OPTION_COUNT
].
cÚ¡¿št_ty³
 = 
SANE_CONSTRAINT_NONE
;

258 
ps
->
İtiÚ
[
SOAP_OPTION_GROUP_SCAN_MODE
].
Çme
 = "mode-group";

259 
ps
->
İtiÚ
[
SOAP_OPTION_GROUP_SCAN_MODE
].
t™Ë
 = 
SANE_TITLE_SCAN_MODE
;

260 
ps
->
İtiÚ
[
SOAP_OPTION_GROUP_SCAN_MODE
].
ty³
 = 
SANE_TYPE_GROUP
;

262 
ps
->
İtiÚ
[
SOAP_OPTION_SCAN_MODE
].
Çme
 = 
SANE_NAME_SCAN_MODE
;

263 
ps
->
İtiÚ
[
SOAP_OPTION_SCAN_MODE
].
t™Ë
 = 
SANE_TITLE_SCAN_MODE
;

264 
ps
->
İtiÚ
[
SOAP_OPTION_SCAN_MODE
].
desc
 = 
SANE_DESC_SCAN_MODE
;

265 
ps
->
İtiÚ
[
SOAP_OPTION_SCAN_MODE
].
ty³
 = 
SANE_TYPE_STRING
;

266 
ps
->
İtiÚ
[
SOAP_OPTION_SCAN_MODE
].
un™
 = 
SANE_UNIT_NONE
;

267 
ps
->
İtiÚ
[
SOAP_OPTION_SCAN_MODE
].
size
 = 
MAX_STRING_SIZE
;

268 
ps
->
İtiÚ
[
SOAP_OPTION_SCAN_MODE
].
ÿp
 = 
SANE_CAP_SOFT_SELECT
 | 
SANE_CAP_SOFT_DETECT
;

269 
ps
->
İtiÚ
[
SOAP_OPTION_SCAN_MODE
].
cÚ¡¿št_ty³
 = 
SANE_CONSTRAINT_STRING_LIST
;

270 
ps
->
İtiÚ
[
SOAP_OPTION_SCAN_MODE
].
cÚ¡¿št
.
¡ršg_li¡
 =…s->
sÿnModeLi¡
;

272 
ps
->
İtiÚ
[
SOAP_OPTION_INPUT_SOURCE
].
Çme
 = 
SANE_NAME_SCAN_SOURCE
;

273 
ps
->
İtiÚ
[
SOAP_OPTION_INPUT_SOURCE
].
t™Ë
 = 
SANE_TITLE_SCAN_SOURCE
;

274 
ps
->
İtiÚ
[
SOAP_OPTION_INPUT_SOURCE
].
desc
 = 
SANE_DESC_SCAN_SOURCE
;

275 
ps
->
İtiÚ
[
SOAP_OPTION_INPUT_SOURCE
].
ty³
 = 
SANE_TYPE_STRING
;

276 
ps
->
İtiÚ
[
SOAP_OPTION_INPUT_SOURCE
].
un™
 = 
SANE_UNIT_NONE
;

277 
ps
->
İtiÚ
[
SOAP_OPTION_INPUT_SOURCE
].
size
 = 
MAX_STRING_SIZE
;

278 
ps
->
İtiÚ
[
SOAP_OPTION_INPUT_SOURCE
].
ÿp
 = 
SANE_CAP_SOFT_SELECT
 | 
SANE_CAP_SOFT_DETECT
;

279 
ps
->
İtiÚ
[
SOAP_OPTION_INPUT_SOURCE
].
cÚ¡¿št_ty³
 = 
SANE_CONSTRAINT_STRING_LIST
;

280 
ps
->
İtiÚ
[
SOAP_OPTION_INPUT_SOURCE
].
cÚ¡¿št
.
¡ršg_li¡
 =…s->
šputSourûLi¡
;

282 
ps
->
İtiÚ
[
SOAP_OPTION_SCAN_RESOLUTION
].
Çme
 = 
SANE_NAME_SCAN_RESOLUTION
;

283 
ps
->
İtiÚ
[
SOAP_OPTION_SCAN_RESOLUTION
].
t™Ë
 = 
SANE_TITLE_SCAN_RESOLUTION
;

284 
ps
->
İtiÚ
[
SOAP_OPTION_SCAN_RESOLUTION
].
desc
 = 
SANE_DESC_SCAN_RESOLUTION
;

285 
ps
->
İtiÚ
[
SOAP_OPTION_SCAN_RESOLUTION
].
ty³
 = 
SANE_TYPE_INT
;

286 
ps
->
İtiÚ
[
SOAP_OPTION_SCAN_RESOLUTION
].
un™
 = 
SANE_UNIT_DPI
;

287 
ps
->
İtiÚ
[
SOAP_OPTION_SCAN_RESOLUTION
].
size
 = (
SANE_IÁ
);

288 
ps
->
İtiÚ
[
SOAP_OPTION_SCAN_RESOLUTION
].
ÿp
 = 
SANE_CAP_SOFT_SELECT
 | 
SANE_CAP_SOFT_DETECT
;

289 
ps
->
İtiÚ
[
SOAP_OPTION_SCAN_RESOLUTION
].
cÚ¡¿št_ty³
 = 
SANE_CONSTRAINT_WORD_LIST
;

290 
ps
->
İtiÚ
[
SOAP_OPTION_SCAN_RESOLUTION
].
cÚ¡¿št
.
wÜd_li¡
 =…s->
»sŞutiÚLi¡
;

292 
ps
->
İtiÚ
[
SOAP_OPTION_GROUP_ADVANCED
].
Çme
 = "advanced-group";

293 
ps
->
İtiÚ
[
SOAP_OPTION_GROUP_ADVANCED
].
t™Ë
 = 
STR_TITLE_ADVANCED
;

294 
ps
->
İtiÚ
[
SOAP_OPTION_GROUP_ADVANCED
].
ty³
 = 
SANE_TYPE_GROUP
;

295 
ps
->
İtiÚ
[
SOAP_OPTION_GROUP_ADVANCED
].
ÿp
 = 
SANE_CAP_ADVANCED
;

297 
ps
->
İtiÚ
[
SOAP_OPTION_BRIGHTNESS
].
Çme
 = 
SANE_NAME_BRIGHTNESS
;

298 
ps
->
İtiÚ
[
SOAP_OPTION_BRIGHTNESS
].
t™Ë
 = 
SANE_TITLE_BRIGHTNESS
;

299 
ps
->
İtiÚ
[
SOAP_OPTION_BRIGHTNESS
].
desc
 = 
SANE_DESC_BRIGHTNESS
;

300 
ps
->
İtiÚ
[
SOAP_OPTION_BRIGHTNESS
].
ty³
 = 
SANE_TYPE_INT
;

301 
ps
->
İtiÚ
[
SOAP_OPTION_BRIGHTNESS
].
un™
 = 
SANE_UNIT_NONE
;

302 
ps
->
İtiÚ
[
SOAP_OPTION_BRIGHTNESS
].
size
 = (
SANE_IÁ
);

303 
ps
->
İtiÚ
[
SOAP_OPTION_BRIGHTNESS
].
ÿp
 = 
SANE_CAP_SOFT_SELECT
 | 
SANE_CAP_SOFT_DETECT
 | 
SANE_CAP_ADVANCED
;

304 
ps
->
İtiÚ
[
SOAP_OPTION_BRIGHTNESS
].
cÚ¡¿št_ty³
 = 
SANE_CONSTRAINT_RANGE
;

305 
ps
->
İtiÚ
[
SOAP_OPTION_BRIGHTNESS
].
cÚ¡¿št
.
¿nge
 = &ps->
brighŠessRªge
;

306 
ps
->
brighŠessRªge
.
mš
 = 
SOAP_BRIGHTNESS_MIN
;

307 
ps
->
brighŠessRªge
.
max
 = 
SOAP_BRIGHTNESS_MAX
;

308 
ps
->
brighŠessRªge
.
quªt
 = 0;

310 
ps
->
İtiÚ
[
SOAP_OPTION_CONTRAST
].
Çme
 = 
SANE_NAME_CONTRAST
;

311 
ps
->
İtiÚ
[
SOAP_OPTION_CONTRAST
].
t™Ë
 = 
SANE_TITLE_CONTRAST
;

312 
ps
->
İtiÚ
[
SOAP_OPTION_CONTRAST
].
desc
 = 
SANE_DESC_CONTRAST
;

313 
ps
->
İtiÚ
[
SOAP_OPTION_CONTRAST
].
ty³
 = 
SANE_TYPE_INT
;

314 
ps
->
İtiÚ
[
SOAP_OPTION_CONTRAST
].
un™
 = 
SANE_UNIT_NONE
;

315 
ps
->
İtiÚ
[
SOAP_OPTION_CONTRAST
].
size
 = (
SANE_IÁ
);

316 
ps
->
İtiÚ
[
SOAP_OPTION_CONTRAST
].
ÿp
 = 
SANE_CAP_SOFT_SELECT
 | 
SANE_CAP_SOFT_DETECT
 | 
SANE_CAP_ADVANCED
;

317 
ps
->
İtiÚ
[
SOAP_OPTION_CONTRAST
].
cÚ¡¿št_ty³
 = 
SANE_CONSTRAINT_RANGE
;

318 
ps
->
İtiÚ
[
SOAP_OPTION_CONTRAST
].
cÚ¡¿št
.
¿nge
 = &ps->
cÚŒa¡Rªge
;

319 
ps
->
cÚŒa¡Rªge
.
mš
 = 
SOAP_CONTRAST_MIN
;

320 
ps
->
cÚŒa¡Rªge
.
max
 = 
SOAP_CONTRAST_MAX
;

321 
ps
->
cÚŒa¡Rªge
.
quªt
 = 0;

323 
ps
->
İtiÚ
[
SOAP_OPTION_COMPRESSION
].
Çme
 = 
STR_NAME_COMPRESSION
;

324 
ps
->
İtiÚ
[
SOAP_OPTION_COMPRESSION
].
t™Ë
 = 
STR_TITLE_COMPRESSION
;

325 
ps
->
İtiÚ
[
SOAP_OPTION_COMPRESSION
].
desc
 = 
STR_DESC_COMPRESSION
;

326 
ps
->
İtiÚ
[
SOAP_OPTION_COMPRESSION
].
ty³
 = 
SANE_TYPE_STRING
;

327 
ps
->
İtiÚ
[
SOAP_OPTION_COMPRESSION
].
un™
 = 
SANE_UNIT_NONE
;

328 
ps
->
İtiÚ
[
SOAP_OPTION_COMPRESSION
].
size
 = 
MAX_STRING_SIZE
;

329 
ps
->
İtiÚ
[
SOAP_OPTION_COMPRESSION
].
ÿp
 = 
SANE_CAP_SOFT_SELECT
 | 
SANE_CAP_SOFT_DETECT
 | 
SANE_CAP_ADVANCED
;

330 
ps
->
İtiÚ
[
SOAP_OPTION_COMPRESSION
].
cÚ¡¿št_ty³
 = 
SANE_CONSTRAINT_STRING_LIST
;

331 
ps
->
İtiÚ
[
SOAP_OPTION_COMPRESSION
].
cÚ¡¿št
.
¡ršg_li¡
 =…s->
com´essiÚLi¡
;

333 
ps
->
İtiÚ
[
SOAP_OPTION_JPEG_QUALITY
].
Çme
 = 
STR_NAME_JPEG_QUALITY
;

334 
ps
->
İtiÚ
[
SOAP_OPTION_JPEG_QUALITY
].
t™Ë
 = 
STR_TITLE_JPEG_QUALITY
;

335 
ps
->
İtiÚ
[
SOAP_OPTION_JPEG_QUALITY
].
desc
 = 
STR_DESC_JPEG_QUALITY
;

336 
ps
->
İtiÚ
[
SOAP_OPTION_JPEG_QUALITY
].
ty³
 = 
SANE_TYPE_INT
;

337 
ps
->
İtiÚ
[
SOAP_OPTION_JPEG_QUALITY
].
un™
 = 
SANE_UNIT_NONE
;

338 
ps
->
İtiÚ
[
SOAP_OPTION_JPEG_QUALITY
].
size
 = (
SANE_IÁ
);

339 
ps
->
İtiÚ
[
SOAP_OPTION_JPEG_QUALITY
].
ÿp
 = 
SANE_CAP_SOFT_SELECT
 | 
SANE_CAP_SOFT_DETECT
 | 
SANE_CAP_ADVANCED
;

340 
ps
->
İtiÚ
[
SOAP_OPTION_JPEG_QUALITY
].
cÚ¡¿št_ty³
 = 
SANE_CONSTRAINT_RANGE
;

341 
ps
->
İtiÚ
[
SOAP_OPTION_JPEG_QUALITY
].
cÚ¡¿št
.
¿nge
 = &ps->
j³gQu®™yRªge
;

342 
ps
->
j³gQu®™yRªge
.
mš
 = 
MIN_JPEG_COMPRESSION_FACTOR
;

343 
ps
->
j³gQu®™yRªge
.
max
 = 
MAX_JPEG_COMPRESSION_FACTOR
;

344 
ps
->
j³gQu®™yRªge
.
quªt
 = 0;

346 
ps
->
İtiÚ
[
SOAP_OPTION_GROUP_GEOMETRY
].
Çme
 = "geometry-group";

347 
ps
->
İtiÚ
[
SOAP_OPTION_GROUP_GEOMETRY
].
t™Ë
 = 
STR_TITLE_GEOMETRY
;

348 
ps
->
İtiÚ
[
SOAP_OPTION_GROUP_GEOMETRY
].
ty³
 = 
SANE_TYPE_GROUP
;

349 
ps
->
İtiÚ
[
SOAP_OPTION_GROUP_GEOMETRY
].
ÿp
 = 
SANE_CAP_ADVANCED
;

351 
ps
->
İtiÚ
[
SOAP_OPTION_TL_X
].
Çme
 = 
SANE_NAME_SCAN_TL_X
;

352 
ps
->
İtiÚ
[
SOAP_OPTION_TL_X
].
t™Ë
 = 
SANE_TITLE_SCAN_TL_X
;

353 
ps
->
İtiÚ
[
SOAP_OPTION_TL_X
].
desc
 = 
SANE_DESC_SCAN_TL_X
;

354 
ps
->
İtiÚ
[
SOAP_OPTION_TL_X
].
ty³
 = 
SANE_TYPE_FIXED
;

355 
ps
->
İtiÚ
[
SOAP_OPTION_TL_X
].
un™
 = 
SANE_UNIT_MM
;

356 
ps
->
İtiÚ
[
SOAP_OPTION_TL_X
].
size
 = (
SANE_IÁ
);

357 
ps
->
İtiÚ
[
SOAP_OPTION_TL_X
].
ÿp
 = 
SANE_CAP_SOFT_SELECT
 | 
SANE_CAP_SOFT_DETECT
;

358 
ps
->
İtiÚ
[
SOAP_OPTION_TL_X
].
cÚ¡¿št_ty³
 = 
SANE_CONSTRAINT_RANGE
;

359 
ps
->
İtiÚ
[
SOAP_OPTION_TL_X
].
cÚ¡¿št
.
¿nge
 = &ps->
xRªge
;

360 
ps
->
xRªge
.
mš
 = 0;

361 
ps
->
xRªge
.
quªt
 = 0;

363 
ps
->
İtiÚ
[
SOAP_OPTION_TL_Y
].
Çme
 = 
SANE_NAME_SCAN_TL_Y
;

364 
ps
->
İtiÚ
[
SOAP_OPTION_TL_Y
].
t™Ë
 = 
SANE_TITLE_SCAN_TL_Y
;

365 
ps
->
İtiÚ
[
SOAP_OPTION_TL_Y
].
desc
 = 
SANE_DESC_SCAN_TL_Y
;

366 
ps
->
İtiÚ
[
SOAP_OPTION_TL_Y
].
ty³
 = 
SANE_TYPE_FIXED
;

367 
ps
->
İtiÚ
[
SOAP_OPTION_TL_Y
].
un™
 = 
SANE_UNIT_MM
;

368 
ps
->
İtiÚ
[
SOAP_OPTION_TL_Y
].
size
 = (
SANE_IÁ
);

369 
ps
->
İtiÚ
[
SOAP_OPTION_TL_Y
].
ÿp
 = 
SANE_CAP_SOFT_SELECT
 | 
SANE_CAP_SOFT_DETECT
;

370 
ps
->
İtiÚ
[
SOAP_OPTION_TL_Y
].
cÚ¡¿št_ty³
 = 
SANE_CONSTRAINT_RANGE
;

371 
ps
->
İtiÚ
[
SOAP_OPTION_TL_Y
].
cÚ¡¿št
.
¿nge
 = &ps->
yRªge
;

372 
ps
->
yRªge
.
mš
 = 0;

373 
ps
->
yRªge
.
quªt
 = 0;

375 
ps
->
İtiÚ
[
SOAP_OPTION_BR_X
].
Çme
 = 
SANE_NAME_SCAN_BR_X
;

376 
ps
->
İtiÚ
[
SOAP_OPTION_BR_X
].
t™Ë
 = 
SANE_TITLE_SCAN_BR_X
;

377 
ps
->
İtiÚ
[
SOAP_OPTION_BR_X
].
desc
 = 
SANE_DESC_SCAN_BR_X
;

378 
ps
->
İtiÚ
[
SOAP_OPTION_BR_X
].
ty³
 = 
SANE_TYPE_FIXED
;

379 
ps
->
İtiÚ
[
SOAP_OPTION_BR_X
].
un™
 = 
SANE_UNIT_MM
;

380 
ps
->
İtiÚ
[
SOAP_OPTION_BR_X
].
size
 = (
SANE_IÁ
);

381 
ps
->
İtiÚ
[
SOAP_OPTION_BR_X
].
ÿp
 = 
SANE_CAP_SOFT_SELECT
 | 
SANE_CAP_SOFT_DETECT
;

382 
ps
->
İtiÚ
[
SOAP_OPTION_BR_X
].
cÚ¡¿št_ty³
 = 
SANE_CONSTRAINT_RANGE
;

383 
ps
->
İtiÚ
[
SOAP_OPTION_BR_X
].
cÚ¡¿št
.
¿nge
 = &ps->
brxRªge
;

384 
ps
->
brxRªge
.
mš
 = 0;

385 
ps
->
brxRªge
.
quªt
 = 0;

387 
ps
->
İtiÚ
[
SOAP_OPTION_BR_Y
].
Çme
 = 
SANE_NAME_SCAN_BR_Y
;

388 
ps
->
İtiÚ
[
SOAP_OPTION_BR_Y
].
t™Ë
 = 
SANE_TITLE_SCAN_BR_Y
;

389 
ps
->
İtiÚ
[
SOAP_OPTION_BR_Y
].
desc
 = 
SANE_DESC_SCAN_BR_Y
;

390 
ps
->
İtiÚ
[
SOAP_OPTION_BR_Y
].
ty³
 = 
SANE_TYPE_FIXED
;

391 
ps
->
İtiÚ
[
SOAP_OPTION_BR_Y
].
un™
 = 
SANE_UNIT_MM
;

392 
ps
->
İtiÚ
[
SOAP_OPTION_BR_Y
].
size
 = (
SANE_IÁ
);

393 
ps
->
İtiÚ
[
SOAP_OPTION_BR_Y
].
ÿp
 = 
SANE_CAP_SOFT_SELECT
 | 
SANE_CAP_SOFT_DETECT
;

394 
ps
->
İtiÚ
[
SOAP_OPTION_BR_Y
].
cÚ¡¿št_ty³
 = 
SANE_CONSTRAINT_RANGE
;

395 
ps
->
İtiÚ
[
SOAP_OPTION_BR_Y
].
cÚ¡¿št
.
¿nge
 = &ps->
bryRªge
;

396 
ps
->
bryRªge
.
mš
 = 0;

397 
ps
->
bryRªge
.
quªt
 = 0;

400 
	}
}

403 
	$£t_ex‹Ás
(
sßp_£ssiÚ
 *
ps
)

405 
¡©
 = 0;

407 ià((
ps
->
cu¼’tBrx
 >…s->
cu¼’tTlx
è&& (ps->cu¼’tBrx -…s->cu¼’tTlx >ğps->
mš_width
è&& (ps->cu¼’tBrx -…s->cu¼’tTlx <ğps->
xRªge
.
max
))

409 
ps
->
efãùiveTlx
 =…s->
cu¼’tTlx
;

410 
ps
->
efãùiveBrx
 =…s->
cu¼’tBrx
;

414 
ps
->
efãùiveTlx
 = 0;

415 
ps
->
efãùiveBrx
 = 0;

416 
¡©
 = 1;

418 ià((
ps
->
cu¼’tBry
 >…s->
cu¼’tTly
è&& (ps->cu¼’tBry -…s->cu¼’tTly >…s->
mš_height
è&& (ps->cu¼’tBry -…s->cu¼’tTly <ğps->
yRªge
.
max
))

420 
ps
->
efãùiveTly
 =…s->
cu¼’tTly
;

421 
ps
->
efãùiveBry
 =…s->
cu¼’tBry
;

425 
ps
->
efãùiveTly
 = 0;

426 
ps
->
efãùiveBry
 = 0;

427 
¡©
 = 1;

429  
¡©
;

430 
	}
}

432 
sßp_£ssiÚ
 *
	$ü—‹_£ssiÚ
()

434 
sßp_£ssiÚ
 *
ps
;

436 ià((
ps
 = 
	`m®loc
((
sßp_£ssiÚ
))è=ğ
NULL
)

438 
	`BUG
("malloc failed: %m\n");

439  
NULL
;

441 
	`mem£t
(
ps
, 0, (
sßp_£ssiÚ
));

442 
ps
->
g
 = "SOAPHT";

443 
ps
->
dd
 = -1;

444 
ps
->
cd
 = -1;

446  
ps
;

447 
	}
}

453 
SANE_Stus
 
	$sßpht_İ’
(
SANE_SŒšg_CÚ¡
 
deviû
, 
SANE_HªdË
 *
hªdË
)

455 
hpmud_mod–_©Œibu‹s
 
ma
;

456 
i
, 
¡©
 = 
SANE_STATUS_IO_ERROR
;

458 
	`DBG8
("§Ã_h·io_İ’(%s)\n", 
deviû
);

460 ià(
£ssiÚ
)

462 
	`BUG
("session in use\n");

463  
SANE_STATUS_DEVICE_BUSY
;

466 ià((
£ssiÚ
 = 
	`ü—‹_£ssiÚ
()è=ğ
NULL
)

467  
SANE_STATUS_NO_MEM
;

470 
	`¢´štf
(
£ssiÚ
->
uri
, (£ssiÚ->uri)-1, "hp:%s", 
deviû
);

473 
	`hpmud_qu”y_mod–
(
£ssiÚ
->
uri
, &
ma
);

474 
£ssiÚ
->
sÿn_ty³
 = 
ma
.
sÿÁy³
;

476 ià(
	`hpmud_İ’_deviû
(
£ssiÚ
->
uri
, 
ma
.
må_mode
, &£ssiÚ->
dd
è!ğ
HPMUD_R_OK
)

478 
	`BUG
("uÇbËØİ’ deviû %s\n", 
£ssiÚ
->
uri
);

479 
bugout
;

481 
	`ä“
(
£ssiÚ
);

482 
£ssiÚ
 = 
NULL
;

483  
SANE_STATUS_IO_ERROR
;

486 ià(
	`bb_lßd
(
£ssiÚ
, 
SCAN_PLUGIN_SOAPHT
))

488 
¡©
 = 
SANE_STATUS_IO_ERROR
;

489 
bugout
;

493 
	`š™_İtiÚs
(
£ssiÚ
);

495 ià(
£ssiÚ
->
	`bb_İ’
(session))

497 
¡©
 = 
SANE_STATUS_IO_ERROR
;

498 
bugout
;

502 
	`sßpht_cÚŒŞ_İtiÚ
(
£ssiÚ
, 
SOAP_OPTION_SCAN_MODE
, 
SANE_ACTION_SET_AUTO
, 
NULL
, NULL);

505 
	`sßpht_cÚŒŞ_İtiÚ
(
£ssiÚ
, 
SOAP_OPTION_INPUT_SOURCE
, 
SANE_ACTION_SET_AUTO
, 
NULL
, NULL);

508 
	`sßpht_cÚŒŞ_İtiÚ
(
£ssiÚ
, 
SOAP_OPTION_SCAN_RESOLUTION
, 
SANE_ACTION_SET_AUTO
, 
NULL
, NULL);

511 
	`sßpht_cÚŒŞ_İtiÚ
(
£ssiÚ
, 
SOAP_OPTION_BRIGHTNESS
, 
SANE_ACTION_SET_AUTO
, 
NULL
, NULL);

514 
	`sßpht_cÚŒŞ_İtiÚ
(
£ssiÚ
, 
SOAP_OPTION_CONTRAST
, 
SANE_ACTION_SET_AUTO
, 
NULL
, NULL);

517 
	`sßpht_cÚŒŞ_İtiÚ
(
£ssiÚ
, 
SOAP_OPTION_COMPRESSION
, 
SANE_ACTION_SET_AUTO
, 
NULL
, NULL);

520 
	`sßpht_cÚŒŞ_İtiÚ
(
£ssiÚ
, 
SOAP_OPTION_JPEG_QUALITY
, 
SANE_ACTION_SET_AUTO
, 
NULL
, NULL);

523 
	`sßpht_cÚŒŞ_İtiÚ
(
£ssiÚ
, 
SOAP_OPTION_TL_X
, 
SANE_ACTION_SET_AUTO
, 
NULL
, NULL);

524 
	`sßpht_cÚŒŞ_İtiÚ
(
£ssiÚ
, 
SOAP_OPTION_TL_Y
, 
SANE_ACTION_SET_AUTO
, 
NULL
, NULL);

525 
	`sßpht_cÚŒŞ_İtiÚ
(
£ssiÚ
, 
SOAP_OPTION_BR_X
, 
SANE_ACTION_SET_AUTO
, 
NULL
, NULL);

526 
	`sßpht_cÚŒŞ_İtiÚ
(
£ssiÚ
, 
SOAP_OPTION_BR_Y
, 
SANE_ACTION_SET_AUTO
, 
NULL
, NULL);

528 *
hªdË
 = (
SANE_HªdË
 *)
£ssiÚ
;

530 
¡©
 = 
SANE_STATUS_GOOD
;

532 
bugout
:

534 ià(
¡©
 !ğ
SANE_STATUS_GOOD
)

536 ià(
£ssiÚ
)

538 
	`bb_uÆßd
(
£ssiÚ
);

539 ià(
£ssiÚ
->
dd
 > 0)

540 
	`hpmud_şo£_deviû
(
£ssiÚ
->
dd
);

541 
	`ä“
(
£ssiÚ
);

542 
£ssiÚ
 = 
NULL
;

546  
¡©
;

547 
	}
}

549 
	$sßpht_şo£
(
SANE_HªdË
 
hªdË
)

551 
sßp_£ssiÚ
 *
ps
 = (sßp_£ssiÚ *)
hªdË
;

553 
	`DBG8
("sane_hpaio_close()\n");

555 ià(
ps
 =ğ
NULL
 ||… !ğ
£ssiÚ
)

557 
	`BUG
("invalid sane_close\n");

561 
ps
->
	`bb_şo£
(ps);

562 
	`bb_uÆßd
(
ps
);

564 ià(
ps
->
dd
 > 0)

565 
	`hpmud_şo£_deviû
(
ps
->
dd
);

567 
	`ä“
(
ps
);

568 
£ssiÚ
 = 
NULL
;

569 
	}
}

571 cÚ¡ 
SANE_O±iÚ_DesütÜ
 *
	$sßpht_g‘_İtiÚ_desütÜ
(
SANE_HªdË
 
hªdË
, 
SANE_IÁ
 
İtiÚ
)

573 
sßp_£ssiÚ
 *
ps
 = (sßp_£ssiÚ *)
hªdË
;

575 
	`DBG8
("§Ã_h·io_g‘_İtiÚ_desütÜ(İtiÚ=%s)\n", 
ps
->
İtiÚ
[İtiÚ].
Çme
);

577 ià(
İtiÚ
 < 0 || o±iÚ >ğ
SOAP_OPTION_MAX
)

578  
NULL
;

580  &
ps
->
İtiÚ
[option];

581 
	}
}

583 
SANE_Stus
 
	$sßpht_cÚŒŞ_İtiÚ
(
SANE_HªdË
 
hªdË
, 
SANE_IÁ
 
İtiÚ
, 
SANE_AùiÚ
 
aùiÚ
, *
v®ue
, SANE_IÁ *
£t_»suÉ
)

585 
sßp_£ssiÚ
 *
ps
 = (sßp_£ssiÚ *)
hªdË
;

586 
SANE_IÁ
 *
št_v®ue
 = 
v®ue
, 
m£t_»suÉ
=0;

587 
i
, 
¡©
=
SANE_STATUS_INVAL
;

588 
sz
[64];

590 
İtiÚ
)

592 
SOAP_OPTION_COUNT
:

593 ià(
aùiÚ
 =ğ
SANE_ACTION_GET_VALUE
)

595 *
št_v®ue
 = 
SOAP_OPTION_MAX
;

596 
¡©
 = 
SANE_STATUS_GOOD
;

599 
SOAP_OPTION_SCAN_MODE
:

600 ià(
aùiÚ
 =ğ
SANE_ACTION_GET_VALUE
)

602 
i
=0; 
ps
->
sÿnModeLi¡
[i]; i++)

604 ià(
ps
->
cu¼’tSÿnMode
 =ğps->
sÿnModeM­
[
i
])

606 
	`¡rıy
(
v®ue
, 
ps
->
sÿnModeLi¡
[
i
]);

607 
¡©
 = 
SANE_STATUS_GOOD
;

612 ià(
aùiÚ
 =ğ
SANE_ACTION_SET_VALUE
)

614 
i
=0; 
ps
->
sÿnModeLi¡
[i]; i++)

616 ià(
	`¡rÿ£cmp
(
ps
->
sÿnModeLi¡
[
i
], 
v®ue
) == 0)

618 
ps
->
cu¼’tSÿnMode
 =…s->
sÿnModeM­
[
i
];

619 
	`£t_sÿn_mode_side_efãùs
(
ps
,…s->
cu¼’tSÿnMode
);

620 
m£t_»suÉ
 |ğ
SANE_INFO_RELOAD_PARAMS
 | 
SANE_INFO_RELOAD_OPTIONS
;

621 
¡©
 = 
SANE_STATUS_GOOD
;

628 
ps
->
cu¼’tSÿnMode
 =…s->
sÿnModeM­
[0];

629 
	`£t_sÿn_mode_side_efãùs
(
ps
,…s->
cu¼’tSÿnMode
);

630 
¡©
 = 
SANE_STATUS_GOOD
;

633 
SOAP_OPTION_INPUT_SOURCE
:

634 ià(
aùiÚ
 =ğ
SANE_ACTION_GET_VALUE
)

636 
i
=0; 
ps
->
šputSourûLi¡
[i]; i++)

638 ià(
ps
->
cu¼’tIÅutSourû
 =ğps->
šputSourûM­
[
i
])

640 
	`¡rıy
(
v®ue
, 
ps
->
šputSourûLi¡
[
i
]);

641 
¡©
 = 
SANE_STATUS_GOOD
;

646 ià(
aùiÚ
 =ğ
SANE_ACTION_SET_VALUE
)

648 
i
=0; 
ps
->
šputSourûLi¡
[i]; i++)

650 ià(
	`¡rÿ£cmp
(
ps
->
šputSourûLi¡
[
i
], 
v®ue
) == 0)

652 
ps
->
cu¼’tIÅutSourû
 =…s->
šputSourûM­
[
i
];

653 
	`£t_šput_sourû_side_efãùs
(
ps
,…s->
cu¼’tIÅutSourû
);

654 if(
ps
->
cu¼’tIÅutSourû
 =ğ
IS_ADF
 ||…s->cu¼’tIÅutSourû =ğ
IS_ADF_DUPLEX
)

656 
i
 = 
ps
->
adf_»sŞutiÚLi¡
[0] + 1;

657 
i
--è
ps
->
»sŞutiÚLi¡
[i] =…s->
adf_»sŞutiÚLi¡
[i];

661 
i
 = 
ps
->
¶©’_»sŞutiÚLi¡
[0] + 1;

662 
i
--è
ps
->
»sŞutiÚLi¡
[i] =…s->
¶©’_»sŞutiÚLi¡
[i];

664 
m£t_»suÉ
 |ğ
SANE_INFO_RELOAD_PARAMS
 | 
SANE_INFO_RELOAD_OPTIONS
;

665 
¡©
 = 
SANE_STATUS_GOOD
;

672 
ps
->
cu¼’tIÅutSourû
 =…s->
šputSourûM­
[0];

673 
	`£t_šput_sourû_side_efãùs
(
ps
,…s->
cu¼’tIÅutSourû
);

674 
m£t_»suÉ
 |ğ
SANE_INFO_RELOAD_PARAMS
 | 
SANE_INFO_RELOAD_OPTIONS
;

675 
¡©
 = 
SANE_STATUS_GOOD
;

678 
SOAP_OPTION_SCAN_RESOLUTION
:

679 ià(
aùiÚ
 =ğ
SANE_ACTION_GET_VALUE
)

681 *
št_v®ue
 = 
ps
->
cu¼’tResŞutiÚ
;

682 
¡©
 = 
SANE_STATUS_GOOD
;

684 ià(
aùiÚ
 =ğ
SANE_ACTION_SET_VALUE
)

686 
i
=1; i <ğ
ps
->
»sŞutiÚLi¡
[0]; i++)

688 ià(
ps
->
»sŞutiÚLi¡
[
i
] =ğ*
št_v®ue
)

690 
ps
->
cu¼’tResŞutiÚ
 = *
št_v®ue
;

691 
m£t_»suÉ
 |ğ
SANE_INFO_RELOAD_PARAMS
;

692 
¡©
 = 
SANE_STATUS_GOOD
;

696 ià(
¡©
 !ğ
SANE_STATUS_GOOD
)

698 
ps
->
cu¼’tResŞutiÚ
 =…s->
»sŞutiÚLi¡
[1];

699 
¡©
 = 
SANE_STATUS_GOOD
;

704 
ps
->
cu¼’tResŞutiÚ
 = 75;

705 
¡©
 = 
SANE_STATUS_GOOD
;

708 
SOAP_OPTION_CONTRAST
:

709 ià(
aùiÚ
 =ğ
SANE_ACTION_GET_VALUE
)

711 *
št_v®ue
 = 
ps
->
cu¼’tCÚŒa¡
;

712 
¡©
 = 
SANE_STATUS_GOOD
;

714 ià(
aùiÚ
 =ğ
SANE_ACTION_SET_VALUE
)

716 ià(*
št_v®ue
 >ğ
SOAP_CONTRAST_MIN
 && *št_v®u<ğ
SOAP_CONTRAST_MAX
)

718 
ps
->
cu¼’tCÚŒa¡
 = *
št_v®ue
;

722 
ps
->
cu¼’tCÚŒa¡
 = 
SOAP_CONTRAST_DEFAULT
;

724 
m£t_»suÉ
 |ğ
SANE_INFO_RELOAD_PARAMS
;

725 
¡©
 = 
SANE_STATUS_GOOD
;

729 
ps
->
cu¼’tCÚŒa¡
 = 
SOAP_CONTRAST_DEFAULT
;

730 
¡©
 = 
SANE_STATUS_GOOD
;

733 
SOAP_OPTION_BRIGHTNESS
:

734 ià(
aùiÚ
 =ğ
SANE_ACTION_GET_VALUE
)

736 *
št_v®ue
 = 
ps
->
cu¼’tBrighŠess
;

737 
¡©
 = 
SANE_STATUS_GOOD
;

739 ià(
aùiÚ
 =ğ
SANE_ACTION_SET_VALUE
)

741 ià(*
št_v®ue
 >ğ
SOAP_BRIGHTNESS_MIN
 && *št_v®u<ğ
SOAP_BRIGHTNESS_MAX
)

743 
ps
->
cu¼’tBrighŠess
 = *
št_v®ue
;

747 
ps
->
cu¼’tBrighŠess
 = 
SOAP_BRIGHTNESS_DEFAULT
;

749 
¡©
 = 
SANE_STATUS_GOOD
;

753 
ps
->
cu¼’tBrighŠess
 = 
SOAP_BRIGHTNESS_DEFAULT
;

754 
¡©
 = 
SANE_STATUS_GOOD
;

757 
SOAP_OPTION_COMPRESSION
:

758 ià(
aùiÚ
 =ğ
SANE_ACTION_GET_VALUE
)

760 
i
=0; 
ps
->
com´essiÚLi¡
[i]; i++)

762 ià(
ps
->
cu¼’tCom´essiÚ
 =ğps->
com´essiÚM­
[
i
])

764 
	`¡rıy
(
v®ue
, 
ps
->
com´essiÚLi¡
[
i
]);

765 
¡©
 = 
SANE_STATUS_GOOD
;

770 ià(
aùiÚ
 =ğ
SANE_ACTION_SET_VALUE
)

772 
i
=0; 
ps
->
com´essiÚLi¡
[i]; i++)

774 ià(
	`¡rÿ£cmp
(
ps
->
com´essiÚLi¡
[
i
], 
v®ue
) == 0)

776 
ps
->
cu¼’tCom´essiÚ
 =…s->
com´essiÚM­
[
i
];

777 
¡©
 = 
SANE_STATUS_GOOD
;

784 
ps
->
cu¼’tCom´essiÚ
 = 
SF_JFIF
;

785 
¡©
 = 
SANE_STATUS_GOOD
;

788 
SOAP_OPTION_JPEG_QUALITY
:

789 ià(
aùiÚ
 =ğ
SANE_ACTION_GET_VALUE
)

791 *
št_v®ue
 = 
ps
->
cu¼’tJ³gQu®™y
;

792 
¡©
 = 
SANE_STATUS_GOOD
;

794 ià(
aùiÚ
 =ğ
SANE_ACTION_SET_VALUE
)

796 ià(*
št_v®ue
 >ğ
MIN_JPEG_COMPRESSION_FACTOR
 && *št_v®u<ğ
MAX_JPEG_COMPRESSION_FACTOR
)

798 
ps
->
cu¼’tJ³gQu®™y
 = *
št_v®ue
;

799 
¡©
 = 
SANE_STATUS_GOOD
;

805 
ps
->
cu¼’tJ³gQu®™y
 = 
SAFER_JPEG_COMPRESSION_FACTOR
;

806 
¡©
 = 
SANE_STATUS_GOOD
;

809 
SOAP_OPTION_TL_X
:

810 ià(
aùiÚ
 =ğ
SANE_ACTION_GET_VALUE
)

812 *
št_v®ue
 = 
ps
->
cu¼’tTlx
;

813 
¡©
 = 
SANE_STATUS_GOOD
;

815 ià(
aùiÚ
 =ğ
SANE_ACTION_SET_VALUE
)

817 ià(*
št_v®ue
 >ğ
ps
->
xRªge
.
mš
 && *št_v®u<ğps->xRªge.
max
)

819 
ps
->
cu¼’tTlx
 = *
št_v®ue
;

820 
m£t_»suÉ
 |ğ
SANE_INFO_RELOAD_PARAMS
;

821 
¡©
 = 
SANE_STATUS_GOOD
;

827 
ps
->
cu¼’tTlx
 =…s->
xRªge
.
mš
;

828 
¡©
 = 
SANE_STATUS_GOOD
;

831 
SOAP_OPTION_TL_Y
:

832 ià(
aùiÚ
 =ğ
SANE_ACTION_GET_VALUE
)

834 *
št_v®ue
 = 
ps
->
cu¼’tTly
;

835 
¡©
 = 
SANE_STATUS_GOOD
;

837 ià(
aùiÚ
 =ğ
SANE_ACTION_SET_VALUE
)

839 ià(*
št_v®ue
 >ğ
ps
->
yRªge
.
mš
 && *št_v®u<ğps->yRªge.
max
)

842 
ps
->
cu¼’tTly
 = *
št_v®ue
;

843 
m£t_»suÉ
 |ğ
SANE_INFO_RELOAD_PARAMS
;

844 
¡©
 = 
SANE_STATUS_GOOD
;

850 
ps
->
cu¼’tTly
 =…s->
yRªge
.
mš
;

851 
¡©
 = 
SANE_STATUS_GOOD
;

854 
SOAP_OPTION_BR_X
:

855 ià(
aùiÚ
 =ğ
SANE_ACTION_GET_VALUE
)

857 *
št_v®ue
 = 
ps
->
cu¼’tBrx
;

858 
¡©
 = 
SANE_STATUS_GOOD
;

860 ià(
aùiÚ
 =ğ
SANE_ACTION_SET_VALUE
)

862 ià(*
št_v®ue
 >ğ
ps
->
brxRªge
.
mš
 && *št_v®u<ğps->brxRªge.
max
)

864 
ps
->
cu¼’tBrx
 = *
št_v®ue
;

865 
m£t_»suÉ
 |ğ
SANE_INFO_RELOAD_PARAMS
;

866 
¡©
 = 
SANE_STATUS_GOOD
;

872 
ps
->
cu¼’tBrx
 =…s->
brxRªge
.
max
;

873 
¡©
 = 
SANE_STATUS_GOOD
;

876 
SOAP_OPTION_BR_Y
:

877 ià(
aùiÚ
 =ğ
SANE_ACTION_GET_VALUE
)

879 *
št_v®ue
 = 
ps
->
cu¼’tBry
;

880 
¡©
 = 
SANE_STATUS_GOOD
;

882 ià(
aùiÚ
 =ğ
SANE_ACTION_SET_VALUE
)

884 ià(*
št_v®ue
 >ğ
ps
->
bryRªge
.
mš
 && *št_v®u<ğps->bryRªge.
max
)

886 
ps
->
cu¼’tBry
 = *
št_v®ue
;

887 
m£t_»suÉ
 |ğ
SANE_INFO_RELOAD_PARAMS
;

888 
¡©
 = 
SANE_STATUS_GOOD
;

894 
ps
->
cu¼’tBry
 =…s->
bryRªge
.
max
;

895 
¡©
 = 
SANE_STATUS_GOOD
;

902 ià(
£t_»suÉ
)

903 *
£t_»suÉ
 = 
m£t_»suÉ
;

905 ià(
¡©
 !ğ
SANE_STATUS_GOOD
)

907 
	`BUG
("cÚŒŞ_İtiÚ faed: o±iÚ=% aùiÚ=%s\n", 
ps
->
İtiÚ
[İtiÚ].
Çme
,

908 
aùiÚ
==
SANE_ACTION_GET_VALUE
 ? "g‘" :‡ùiÚ==
SANE_ACTION_SET_VALUE
 ? "set" : "auto");

911 
	`DBG8
("§Ã_h·io_cÚŒŞ_İtiÚ (İtiÚ=% aùiÚ=% v®ue=%s)\n", 
ps
->
İtiÚ
[İtiÚ].
Çme
,

912 
aùiÚ
==
SANE_ACTION_GET_VALUE
 ? "g‘" :‡ùiÚ==
SANE_ACTION_SET_VALUE
 ? "set" : "auto",

913 
v®ue
 ? 
ps
->
İtiÚ
[İtiÚ].
ty³
 =ğ
SANE_TYPE_STRING
 ? (*)v®u: 
	`p¢´štf
(
sz
, (sz), "%d", *(*)value) : "na");

915  
¡©
;

916 
	}
}

918 
SANE_Stus
 
	$sßpht_g‘_·¿m‘”s
(
SANE_HªdË
 
hªdË
, 
SANE_P¬am‘”s
 *
·¿ms
)

920 
sßp_£ssiÚ
 *
ps
 = (sßp_£ssiÚ *)
hªdË
;

922 
	`£t_ex‹Ás
(
ps
);

925 
ps
->
	`bb_g‘_·¿m‘”s
Õs, 
·¿ms
,…s->
_hªdË
 ? 
SPO_STARTED
 : 
SPO_BEST_GUESS
);

927 
	`DBG8
("sane_hpaio_get_parameters(): format=%d,†ast_frame=%d,†ines=%d, depth=%d,…ixels_per_line=%d, bytes_per_line=%d\n",

928 
·¿ms
->
fÜm©
,…¬ams->
Ï¡_äame
,…¬ams->
lšes
,…¬ams->
d•th
,…¬ams->
pix–s_³r_lše
,…¬ams->
by‹s_³r_lše
);

930  
SANE_STATUS_GOOD
;

931 
	}
}

933 
SANE_Stus
 
	$sßpht_¡¬t
(
SANE_HªdË
 
hªdË
)

935 
sßp_£ssiÚ
 *
ps
 = (sßp_£ssiÚ *)
hªdË
;

936 
SANE_P¬am‘”s
 
µ
;

937 
IP_IMAGE_TRAITS
 
Œa™s
;

938 
IP_XFORM_SPEC
 
xfÜms
[
IP_MAX_XFORMS
], *
pXfÜm
=xforms;

939 
¡©
, 
»t
;

941 
	`DBG8
("sane_hpaio_start()\n");

943 
ps
 -> 
u£r_ÿnûl
 = 0;

944 
ps
 -> 
út
 = 0;

945 
ps
 -> 
šdex
 = 0;

947 ià(
	`£t_ex‹Ás
(
ps
))

949 
	`BUG
("invalidƒxtents:lx=%d brx=%dly=%d bry=%d minwidth=%d minheight%d maxwidth=%d maxheight=%d\n",

950 
ps
->
cu¼’tTlx
,…s->
cu¼’tTly
,…s->
cu¼’tBrx
,…s->
cu¼’tBry
,…s->
mš_width
,…s->
mš_height
,…s->
xRªge
.
max
,…s->
yRªge
.max);

951 
¡©
 = 
SANE_STATUS_INVAL
;

952 
bugout
;

956 ià(
ps
->
cu¼’tIÅutSourû
==
IS_ADF
 ||…s->cu¼’tIÅutSourû==
IS_ADF_DUPLEX
)

958 
»t
 = 
ps
->
	`bb_is_·³r_š_adf
(ps);

959 ià(
»t
 == 0)

961 
¡©
 = 
SANE_STATUS_NO_DOCS
;

962 
	`S’dSÿnEv’t
 (
ps
->
uri
, 
EVENT_SCAN_ADF_NO_DOCS
);

963 
bugout
;

965 ià(
»t
 < 0)

967 
¡©
 = 
SANE_STATUS_IO_ERROR
;

968 
bugout
;

973 ià(
ps
->
	`bb_¡¬t_sÿn
(ps))

975 
¡©
 = 
SANE_STATUS_IO_ERROR
;

976 
bugout
;

978 
	`S’dSÿnEv’t
(
ps
->
uri
, 
EVENT_START_SCAN_JOB
);

979 
	`mem£t
(
xfÜms
, 0, (xforms));

982 ià(
ps
->
cu¼’tSÿnMode
 =ğ
CE_RGB24
 ||…s->cu¼’tSÿnMod=ğ
CE_GRAY8
)

984 
ps
->
cu¼’tCom´essiÚ
)

986 
SF_JFIF
:

987 
pXfÜm
->
aXfÜmInfo
[
IP_JPG_DECODE_FROM_DENALI
].
dwÜd
 = 0;

988 
	`ADD_XFORM
(
X_JPG_DECODE
);

989 
pXfÜm
->
aXfÜmInfo
[
IP_CNV_COLOR_SPACE_WHICH_CNV
].
dwÜd
 = 
IP_CNV_YCC_TO_SRGB
;

990 
pXfÜm
->
aXfÜmInfo
[
IP_CNV_COLOR_SPACE_GAMMA
].
dwÜd
 = 0x00010000;

991 
	`ADD_XFORM
(
X_CNV_COLOR_SPACE
);

993 
SF_HPRAW
:

1000 
ps
->
cu¼’tCom´essiÚ
)

1002 
SF_JFIF
:

1003 
pXfÜm
->
aXfÜmInfo
[
IP_JPG_DECODE_FROM_DENALI
].
dwÜd
 = 0;

1004 
	`ADD_XFORM
(
X_JPG_DECODE
);

1005 
pXfÜm
->
aXfÜmInfo
[
IP_GRAY_2_BI_THRESHOLD
].
dwÜd
 = 127;

1006 
	`ADD_XFORM
(
X_GRAY_2_BI
);

1008 
SF_HPRAW
:

1009 
pXfÜm
->
aXfÜmInfo
[
IP_GRAY_2_BI_THRESHOLD
].
dwÜd
 = 127;

1010 
	`ADD_XFORM
(
X_GRAY_2_BI
);

1017 
pXfÜm
->
aXfÜmInfo
[
IP_CROP_LEFT
].
dwÜd
 = 0;

1018 
pXfÜm
->
aXfÜmInfo
[
IP_CROP_RIGHT
].
dwÜd
 = 0;

1019 
pXfÜm
->
aXfÜmInfo
[
IP_CROP_TOP
].
dwÜd
 = 0;

1020 
pXfÜm
->
aXfÜmInfo
[
IP_CROP_MAXOUTROWS
].
dwÜd
 = 0;

1021 
	`ADD_XFORM
(
X_CROP
);

1024 
pXfÜm
->
aXfÜmInfo
[
IP_PAD_LEFT
].
dwÜd
 = 0;

1025 
pXfÜm
->
aXfÜmInfo
[
IP_PAD_RIGHT
].
dwÜd
 = 0;

1026 
pXfÜm
->
aXfÜmInfo
[
IP_PAD_TOP
].
dwÜd
 = 0;

1027 
pXfÜm
->
aXfÜmInfo
[
IP_PAD_BOTTOM
].
dwÜd
 = 0;

1028 
pXfÜm
->
aXfÜmInfo
[
IP_PAD_VALUE
].
dwÜd
 = 
ps
->
cu¼’tSÿnMode
 =ğ
CE_BLACK_AND_WHITE1
 ? 0 : -1;

1029 
pXfÜm
->
aXfÜmInfo
[
IP_PAD_MIN_HEIGHT
].
dwÜd
 = 0;

1030 
	`ADD_XFORM
(
X_PAD
);

1033 ià((
»t
 = 
	`O³n
(
pXfÜm
-
xfÜms
, xfÜms, 0, &
ps
->
_hªdË
)è!ğ
IP_DONE
)

1035 
	`BUG
("uÇbË o³Àimag´oûssÜ:ƒ¼=%d\n", 
»t
);

1036 
¡©
 = 
SANE_STATUS_INVAL
;

1037 
bugout
;

1041 ià(
ps
->
cu¼’tCom´essiÚ
 =ğ
SF_HPRAW
)

1042 
ps
->
	`bb_g‘_·¿m‘”s
Õs, &
µ
, 
SPO_STARTED_JR
);

1044 
ps
->
	`bb_g‘_·¿m‘”s
Õs, &
µ
, 
SPO_BEST_GUESS
);

1045 
Œa™s
.
iPix–sP”Row
 = 
µ
.
pix–s_³r_lše
;

1046 
ps
->
cu¼’tSÿnMode
)

1048 
CE_BLACK_AND_WHITE1
:

1049 
CE_GRAY8
:

1050 
Œa™s
.
iB™sP”Pix–
 = 8;

1052 
CE_RGB24
:

1054 
Œa™s
.
iB™sP”Pix–
 = 24;

1057 
Œa™s
.
lHÜizDPI
 = 
ps
->
cu¼’tResŞutiÚ
 << 16;

1058 
Œa™s
.
lV”tDPI
 = 
ps
->
cu¼’tResŞutiÚ
 << 16;

1059 
Œa™s
.
lNumRows
 = 
µ
.
lšes
;

1060 
Œa™s
.
iNumPages
 = 1;

1061 
Œa™s
.
iPageNum
 = 1;

1062 
Œa™s
.
iCompÚ’tsP”Pix–
 = (Ñ¿™s.
iB™sP”Pix–
 % 3) ? 1 : 3);

1063 
	`S‘DeçuÉIÅutT¿™s
(
ps
->
_hªdË
, &
Œa™s
);

1066 ià(
ps
->
cu¼’tCom´essiÚ
 =ğ
SF_JFIF
)

1069 
	`ResuÉMask
(
ps
->
_hªdË
, 
IP_PARSED_HEADER
);

1074 
»t
 = 
	`g‘__d©a
(
ps
, 
NULL
, 0, NULL);

1076 ià(
»t
 & (
IP_INPUT_ERROR
 | 
IP_FATAL_ERROR
 | 
IP_DONE
))

1078 
	`BUG
("CÚv”ˆ”rÜ=%x\n", 
»t
);

1079 
¡©
 = 
SANE_STATUS_IO_ERROR
;

1080 
bugout
;

1083 ià(
»t
 & 
IP_PARSED_HEADER
)

1085 
	`G‘ImageT¿™s
(
ps
->
_hªdË
, 
NULL
, &ps->
image_Œa™s
);

1086 
	`ResuÉMask
(
ps
->
_hªdË
, 0);

1092 
	`G‘ImageT¿™s
(
ps
->
_hªdË
, 
NULL
, &ps->
image_Œa™s
);

1094 
¡©
 = 
SANE_STATUS_GOOD
;

1096 
bugout
:

1097 ià(
¡©
 !ğ
SANE_STATUS_GOOD
)

1099 ià(
ps
->
_hªdË
)

1101 
	`Clo£
(
ps
->
_hªdË
);

1102 
ps
->
_hªdË
 = 0;

1104 
ps
->
	`bb_’d_sÿn
Õs, 
¡©
 =ğ
SANE_STATUS_IO_ERROR
 ? 1: 0);

1107  
¡©
;

1108 
	}
}

1110 
SANE_Stus
 
	$sßpht_»ad
(
SANE_HªdË
 
hªdË
, 
SANE_By‹
 *
d©a
, 
SANE_IÁ
 
maxL’gth
, SANE_IÁ *
Ëngth
)

1112 
sßp_£ssiÚ
 *
ps
 = (sßp_£ssiÚ *)
hªdË
;

1113 
»t
, 
¡©
=
SANE_STATUS_IO_ERROR
;

1115 
	`DBG8
("§Ã_h·io_»ad(èhªdË=%°d©a=%°maxL’gth=%d\n", (*)
hªdË
, 
d©a
, 
maxL’gth
);

1116 if(
ps
->
u£r_ÿnûl
)

1118 
	`DBG8
("sßpht_»ad(èEVENT_SCAN_CANCEL****uri=%s\n", 
ps
->
uri
);

1119 
	`S’dSÿnEv’t
(
ps
->
uri
, 
EVENT_SCAN_CANCEL
);

1120  
SANE_STATUS_CANCELLED
;

1123 
»t
 = 
	`g‘__d©a
(
ps
, 
d©a
, 
maxL’gth
, 
Ëngth
);

1125 if(
»t
 & (
IP_INPUT_ERROR
 | 
IP_FATAL_ERROR
))

1127 
	`BUG
("CÚv”ˆ”rÜ=%x\n", 
»t
);

1128 
bugout
;

1131 ià(
»t
 & 
IP_DONE
)

1133 
¡©
 = 
SANE_STATUS_EOF
;

1134 
	`S’dSÿnEv’t
(
ps
->
uri
, 
EVENT_END_SCAN_JOB
);

1137 
¡©
 = 
SANE_STATUS_GOOD
;

1139 
bugout
:

1140 ià(
¡©
 !ğ
SANE_STATUS_GOOD
)

1142 ià(
ps
->
_hªdË
)

1145 
	`Clo£
(
ps
->
_hªdË
);

1146 
ps
->
_hªdË
 = 0;

1148 
ps
->
	`bb_’d_·ge
(ps, 0);

1151 
	`DBG8
("-§Ã_h·io_»ad(èouut=%°by‹s_»ad=%d maxL’gth=%d stus=%d\n", 
d©a
, *
Ëngth
, 
maxL’gth
, 
¡©
);

1153  
¡©
;

1154 
	}
}

1156 
	$sßpht_ÿnûl
(
SANE_HªdË
 
hªdË
)

1158 
sßp_£ssiÚ
 *
ps
 = (sßp_£ssiÚ *)
hªdË
;

1160 
	`DBG8
("sane_hpaio_cancel()\n");

1166 
ps
 -> 
u£r_ÿnûl
 = 1;

1167 ià(
ps
->
_hªdË
)

1169 
	`Clo£
(
ps
->
_hªdË
);

1170 
ps
->
_hªdË
 = 0;

1172 
ps
->
	`bb_’d_sÿn
(ps, 0);

1173 
	}
}

	@scan/sane/soapht.h

26 #iâdeà
_SOAPHT_H


27 
	#_SOAPHT_H


	)

29 
	~"§Ã.h
"

31 
SANE_Stus
 
sßpht_İ’
(
SANE_SŒšg_CÚ¡
 
deviû
, 
SANE_HªdË
 *
hªdË
);

32 
sßpht_şo£
(
SANE_HªdË
 
hªdË
);

33 cÚ¡ 
SANE_O±iÚ_DesütÜ
 * 
sßpht_g‘_İtiÚ_desütÜ
(
SANE_HªdË
 
hªdË
, 
SANE_IÁ
 
İtiÚ
);

34 
SANE_Stus
 
sßpht_cÚŒŞ_İtiÚ
(
SANE_HªdË
 
hªdË
, 
SANE_IÁ
 
İtiÚ
, 
SANE_AùiÚ
 
aùiÚ
, *
v®ue
, SANE_IÁ *
šfo
);

35 
SANE_Stus
 
sßpht_g‘_·¿m‘”s
(
SANE_HªdË
 
hªdË
, 
SANE_P¬am‘”s
 *
·¿ms
);

36 
SANE_Stus
 
sßpht_¡¬t
(
SANE_HªdË
 
hªdË
);

37 
SANE_Stus
 
sßpht_»ad
(
SANE_HªdË
 
hªdË
, 
SANE_By‹
 *
d©a
, 
SANE_IÁ
 
maxL’gth
, SANE_IÁ *
Ëngth
);

38 
sßpht_ÿnûl
(
SANE_HªdË
 
hªdË
);

	@scan/sane/soaphti.h

33 #iâdeà
_SOAPHTI_H


34 
	#_SOAPHTI_H


	)

36 
	#SOAP_CONTRAST_MIN
 -1000

	)

37 
	#SOAP_CONTRAST_MAX
 1000

	)

38 
	#SOAP_CONTRAST_DEFAULT
 0

	)

39 
	#SOAP_BRIGHTNESS_MIN
 -1000

	)

40 
	#SOAP_BRIGHTNESS_MAX
 1000

	)

41 
	#SOAP_BRIGHTNESS_DEFAULT
 0

	)

43 
	#MM_PER_INCH
 25.4

	)

45 
	eSOAP_OPTION_NUMBER


47 
	mSOAP_OPTION_COUNT
 = 0,

48 
	mSOAP_OPTION_GROUP_SCAN_MODE
,

49 
	mSOAP_OPTION_SCAN_MODE
,

50 
	mSOAP_OPTION_SCAN_RESOLUTION
,

51 
	mSOAP_OPTION_INPUT_SOURCE
,

52 
	mSOAP_OPTION_GROUP_ADVANCED
,

53 
	mSOAP_OPTION_BRIGHTNESS
,

54 
	mSOAP_OPTION_CONTRAST
,

55 
	mSOAP_OPTION_COMPRESSION
,

56 
	mSOAP_OPTION_JPEG_QUALITY
,

57 
	mSOAP_OPTION_GROUP_GEOMETRY
,

58 
	mSOAP_OPTION_TL_X
,

59 
	mSOAP_OPTION_TL_Y
,

60 
	mSOAP_OPTION_BR_X
,

61 
	mSOAP_OPTION_BR_Y
,

62 
	mSOAP_OPTION_MAX


65 
	#MAX_LIST_SIZE
 32

	)

66 
	#MAX_STRING_SIZE
 32

	)

68 
	eSCAN_FORMAT


70 
	mSF_HPRAW
 = 1,

71 
	mSF_JFIF
,

72 
	mSF_MAX


75 
	eINPUT_SOURCE


77 
	mIS_PLATEN
 = 1,

78 
	mIS_ADF
,

79 
	mIS_ADF_DUPLEX
,

80 
	mIS_MAX


83 
	eCOLOR_ENTRY


85 
	mCE_BLACK_AND_WHITE1
 = 1,

86 
	mCE_GRAY8
,

87 
	mCE_RGB24
,

88 
	mCE_RGB48
,

89 
	mCE_MAX


92 
	eSCAN_PARAM_OPTION


94 
	mSPO_BEST_GUESS
 = 0,

95 
	mSPO_STARTED
 = 1,

96 
	mSPO_STARTED_JR
 = 2,

99 
	ssßp_£ssiÚ


101 *
	mg
;

102 
HPMUD_DEVICE
 
	mdd
;

103 
HPMUD_CHANNEL
 
	mcd
;

104 
	muri
[
HPMUD_LINE_SIZE
];

105 
	mmod–
[
HPMUD_LINE_SIZE
];

106 
	msÿn_ty³
;

108 
IP_IMAGE_TRAITS
 
	mimage_Œa™s
;

110 
SANE_O±iÚ_DesütÜ
 
	mİtiÚ
[
SOAP_OPTION_MAX
];

112 
SANE_SŒšg_CÚ¡
 
	msÿnModeLi¡
[
CE_MAX
];

113 
COLOR_ENTRY
 
	msÿnModeM­
[
CE_MAX
];

114 
COLOR_ENTRY
 
	mcu¼’tSÿnMode
;

116 
SANE_SŒšg_CÚ¡
 
	mšputSourûLi¡
[
IS_MAX
];

117 
INPUT_SOURCE
 
	mšputSourûM­
[
IS_MAX
];

118 
INPUT_SOURCE
 
	mcu¼’tIÅutSourû
;

120 
SANE_IÁ
 
	m»sŞutiÚLi¡
[
MAX_LIST_SIZE
];

121 
SANE_IÁ
 
	mcu¼’tResŞutiÚ
;

123 
SANE_Rªge
 
	mcÚŒa¡Rªge
;

124 
SANE_IÁ
 
	mcu¼’tCÚŒa¡
;

126 
SANE_Rªge
 
	mbrighŠessRªge
;

127 
SANE_IÁ
 
	mcu¼’tBrighŠess
;

129 
SANE_SŒšg_CÚ¡
 
	mcom´essiÚLi¡
[
SF_MAX
];

130 
SCAN_FORMAT
 
	mcom´essiÚM­
[
SF_MAX
];

131 
SCAN_FORMAT
 
	mcu¼’tCom´essiÚ
;

133 
SANE_Rªge
 
	mj³gQu®™yRªge
;

134 
SANE_IÁ
 
	mcu¼’tJ³gQu®™y
;

136 
SANE_Rªge
 
	mxRªge
, 
	myRªge
, 
	mbrxRªge
, 
	mbryRªge
;

137 
SANE_Fixed
 
	mcu¼’tTlx
, 
	mcu¼’tTly
, 
	mcu¼’tBrx
, 
	mcu¼’tBry
;

138 
SANE_Fixed
 
	mefãùiveTlx
, 
	mefãùiveTly
, 
	mefãùiveBrx
, 
	mefãùiveBry
;

139 
SANE_Fixed
 
	mmš_width
, 
	mmš_height
;

141 
SANE_Fixed
 
	m¶©’_mš_width
, 
	m¶©’_mš_height
;

142 
SANE_Rªge
 
	m¶©’_xRªge
, 
	m¶©’_yRªge
, 
	m¶©’_brxRªge
, 
	m¶©’_bryRªge
;

143 
SANE_IÁ
 
	m¶©’_»sŞutiÚLi¡
[
MAX_LIST_SIZE
];

145 
SANE_Fixed
 
	madf_mš_width
, 
	madf_mš_height
;

146 
SANE_Rªge
 
	madf_xRªge
, 
	madf_yRªge
, 
	madf_brxRªge
, 
	madf_bryRªge
;

147 
SANE_IÁ
 
	madf_»sŞutiÚLi¡
[
MAX_LIST_SIZE
];

149 
IP_HANDLE
 
	m_hªdË
;

151 
	mšdex
;

152 
	mút
;

153 
	mbuf
[65536];

154 
	mu£r_ÿnûl
;

156 *
	mhpmud_hªdË
;

157 *
	mm©h_hªdË
;

158 *
	mbb_hªdË
;

159 *
	mbb_£ssiÚ
;

160 (*
	mbb_İ’
)(
sßp_£ssiÚ
 *
	mps
);

161 (*
	mbb_şo£
)(
sßp_£ssiÚ
 *
	mps
);

162 (*
	mbb_g‘_·¿m‘”s
)(
sßp_£ssiÚ
 *
	mps
, 
SANE_P¬am‘”s
 *
	mµ
, 
	msÿn_¡¬‹d
);

163 (*
	mbb_is_·³r_š_adf
)(
sßp_£ssiÚ
 *
	mps
);

164 (*
	mbb_¡¬t_sÿn
)(
sßp_£ssiÚ
 *
	mps
);

165 (*
	mbb_g‘_image_d©a
)(
sßp_£ssiÚ
 *
	mps
, 
	mmax_Ëngth
);

166 (*
	mbb_’d_·ge
)(
sßp_£ssiÚ
 *
	mps
, 
	mio_”rÜ
);

167 (*
	mbb_’d_sÿn
)(
sßp_£ssiÚ
 *
	mps
, 
	mio_”rÜ
);

	@scan/sane/soapi.h

28 #iâdeà
_SOAPI_H


29 
	#_SOAPI_H


	)

31 
	#SOAP_CONTRAST_MIN
 -1000

	)

32 
	#SOAP_CONTRAST_MAX
 1000

	)

33 
	#SOAP_CONTRAST_DEFAULT
 0

	)

34 
	#SOAP_BRIGHTNESS_MIN
 -1000

	)

35 
	#SOAP_BRIGHTNESS_MAX
 1000

	)

36 
	#SOAP_BRIGHTNESS_DEFAULT
 0

	)

38 
	#MM_PER_INCH
 25.4

	)

40 
	eSOAP_OPTION_NUMBER


42 
	mSOAP_OPTION_COUNT
 = 0,

43 
	mSOAP_OPTION_GROUP_SCAN_MODE
,

44 
	mSOAP_OPTION_SCAN_MODE
,

45 
	mSOAP_OPTION_SCAN_RESOLUTION
,

46 
	mSOAP_OPTION_GROUP_ADVANCED
,

47 
	mSOAP_OPTION_BRIGHTNESS
,

48 
	mSOAP_OPTION_CONTRAST
,

49 
	mSOAP_OPTION_COMPRESSION
,

50 
	mSOAP_OPTION_JPEG_QUALITY
,

51 
	mSOAP_OPTION_GROUP_GEOMETRY
,

52 
	mSOAP_OPTION_TL_X
,

53 
	mSOAP_OPTION_TL_Y
,

54 
	mSOAP_OPTION_BR_X
,

55 
	mSOAP_OPTION_BR_Y
,

56 
	mSOAP_OPTION_MAX


59 
	#MAX_LIST_SIZE
 32

	)

60 
	#MAX_STRING_SIZE
 32

	)

62 
	eSCAN_FORMAT


64 
	mSF_HPRAW
 = 1,

65 
	mSF_JFIF
,

66 
	mSF_MMR
,

67 
	mSF_MAX


70 
	eCOLOR_ENTRY


72 
	mCE_BLACK_AND_WHITE1
 = 1,

73 
	mCE_GRAY8
,

74 
	mCE_RGB24
,

75 
	mCE_RGB48
,

76 
	mCE_MAX


79 
	eSCAN_PARAM_OPTION


81 
	mSPO_BEST_GUESS
 = 0,

82 
	mSPO_STARTED
 = 1,

83 
	mSPO_STARTED_JR
 = 2,

86 
	ssßp_£ssiÚ


88 *
	mg
;

89 
HPMUD_DEVICE
 
	mdd
;

90 
HPMUD_CHANNEL
 
	mcd
;

91 
	muri
[
HPMUD_LINE_SIZE
];

92 
	mmod–
[
HPMUD_LINE_SIZE
];

93 
	msÿn_ty³
;

94 
	mu£r_ÿnûl
;

95 
IP_IMAGE_TRAITS
 
	mimage_Œa™s
;

97 
SANE_O±iÚ_DesütÜ
 
	mİtiÚ
[
SOAP_OPTION_MAX
];

99 
SANE_SŒšg_CÚ¡
 
	msÿnModeLi¡
[
CE_MAX
];

100 
COLOR_ENTRY
 
	msÿnModeM­
[
CE_MAX
];

101 
COLOR_ENTRY
 
	mcu¼’tSÿnMode
;

103 
SANE_IÁ
 
	m»sŞutiÚLi¡
[
MAX_LIST_SIZE
];

104 
SANE_IÁ
 
	mcu¼’tResŞutiÚ
;

106 
SANE_Rªge
 
	mcÚŒa¡Rªge
;

107 
SANE_IÁ
 
	mcu¼’tCÚŒa¡
;

109 
SANE_Rªge
 
	mbrighŠessRªge
;

110 
SANE_IÁ
 
	mcu¼’tBrighŠess
;

112 
SANE_SŒšg_CÚ¡
 
	mcom´essiÚLi¡
[
SF_MAX
];

113 
SCAN_FORMAT
 
	mcom´essiÚM­
[
SF_MAX
];

114 
SCAN_FORMAT
 
	mcu¼’tCom´essiÚ
;

116 
SANE_Rªge
 
	mj³gQu®™yRªge
;

117 
SANE_IÁ
 
	mcu¼’tJ³gQu®™y
;

119 
SANE_Rªge
 
	mxRªge
, 
	myRªge
, 
	mbrxRªge
, 
	mbryRªge
;

120 
SANE_Fixed
 
	mcu¼’tTlx
, 
	mcu¼’tTly
, 
	mcu¼’tBrx
, 
	mcu¼’tBry
;

121 
SANE_Fixed
 
	mefãùiveTlx
, 
	mefãùiveTly
, 
	mefãùiveBrx
, 
	mefãùiveBry
;

122 
SANE_Fixed
 
	mmš_width
, 
	mmš_height
;

124 
IP_HANDLE
 
	m_hªdË
;

126 
	mšdex
;

127 
	mút
;

128 
	mbuf
[65536];

130 *
	mhpmud_hªdË
;

131 *
	mm©h_hªdË
;

132 *
	mbb_hªdË
;

133 *
	mbb_£ssiÚ
;

134 (*
	mbb_İ’
)(
sßp_£ssiÚ
 *
	mps
);

135 (*
	mbb_şo£
)(
sßp_£ssiÚ
 *
	mps
);

136 (*
	mbb_g‘_·¿m‘”s
)(
sßp_£ssiÚ
 *
	mps
, 
SANE_P¬am‘”s
 *
	mµ
, 
	msÿn_¡¬‹d
);

137 (*
	mbb_is_·³r_š_adf
)(
sßp_£ssiÚ
 *
	mps
);

138 (*
	mbb_¡¬t_sÿn
)(
sßp_£ssiÚ
 *
	mps
);

139 (*
	mbb_g‘_image_d©a
)(
sßp_£ssiÚ
 *
	mps
, 
	mmax_Ëngth
);

140 (*
	mbb_’d_·ge
)(
sßp_£ssiÚ
 *
	mps
, 
	mio_”rÜ
);

141 (*
	mbb_’d_sÿn
)(
sßp_£ssiÚ
 *
	mps
, 
	mio_”rÜ
);

	@scan/sane/tables.h

31 #ià!
defšed
Ğ
__TABLES_H__
 )

32 
	#__TABLES_H__


	)

34 cÚ¡ 
	ghpTS”›sTÚeM­
[] =

806 cÚ¡ 
	ghp11xxS”›sGammaTabË
[256] =

1066 cÚ¡ 
	ghp11xxS”›sCŞÜM­
[] =

	@scan/sane/xml.c

28 #iâdeà
_GNU_SOURCE


29 
	#_GNU_SOURCE


	)

32 
	~<¡ršg.h
>

33 
	~<¡dlib.h
>

35 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
	$g‘_¬¿y_size
(cÚ¡ *
g
)

37 *
p
, *

;

39 ià((
p
 = 
	`¡r¡r
(
g
, "arraySize=\"")))

40  
	`¡¹Ş
(
p
+11, &

, 10);

43 
	}
}

46 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
	$g‘_–em’t
(cÚ¡ *
buf
, 
buf_size
, *
–em’t
, 
–em’t_size
, **

)

48 
i
, 
j
;

50 
–em’t
[0]=0;

52 
i
=0, 
j
=0; 
buf
[i] !ğ'<' && j < (
–em’t_size
-1è&& i < 
buf_size
; i++)

53 
–em’t
[
j
++] = 
buf
[
i
];

55 
–em’t
[
j
]=0;

57 ià(

 !ğ
NULL
)

58 *

 = (*)
buf
 + 
i
;

60  
j
;

61 
	}
}

64 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
	$g‘_g
(cÚ¡ *
buf
, 
buf_size
, *
g
, 
g_size
, **

)

66 
i
=0, 
j
=0, 
dd
=0, 
lf
=0;

68 
g
[0]=0;

72 ; 
buf
[
i
] !ğ'<' && i < 
buf_size
; i++);

74 ià(
buf
[
i
] != '<')

77 ià(
i
 < (
buf_size
-4è&& (
	`¡ºcmp
(&
buf
[i], "<!--", 4) == 0))

79 ; 
buf
[
i
] !ğ'>' && i < 
buf_size
; i++);

80 
i
++;

84 
i
++;

86 
j
=0; 
buf
[
i
] !ğ'>' && j < (
g_size
-1è&& i < 
buf_size
; i++)

88 ià(
buf
[
i
] == '\r')

90 
g
[
j
++] = '\n';

91 
lf
=1;

93 ià(
buf
[
i
] == '\n')

95 ià(!
lf
)

96 
g
[
j
++] = 
buf
[
i
];

98 ià(
buf
[
i
] == ' ')

100 ià(!
dd
)

102 
g
[
j
++] = 
buf
[
i
];

103 
dd
=1;

108 
g
[
j
++] = 
buf
[
i
];

109 
dd
=0;

110 
lf
=0;

116 ià(
i
 < 
buf_size
)

117 
i
++;

119 
g
[
j
]=0;

121 ià(

 !ğ
NULL
)

122 *

 = (*)
buf
 + 
i
;

124  
j
;

125 
	}
}

	@scan/sane/xml.h

27 #iâdeà
_MXML_H


28 
	#_MXML_H


	)

30 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
g‘_¬¿y_size
(cÚ¡ *
g
);

32 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
g‘_–em’t
(cÚ¡ *
buf
, 
buf_size
, *
–em’t
, 
–em’t_size
, **

);

34 
__©Œibu‹__
 ((
visib™y
 ("hidd’"))è
g‘_g
(cÚ¡ *
buf
, 
buf_size
, *
g
, 
g_size
, **

);

	@scan/scanext/scanext.c

50 
	~"PythÚ.h
"

51 
	~"§Ã.h
"

52 
	~<sys/time.h
>

54 #ià
PY_MAJOR_VERSION
 >= 3

55 
	#PyIÁ_AsLÚg
 
PyLÚg_AsLÚg


	)

56 
	#PyIÁ_FromLÚg
 
PyLÚg_FromLÚg


	)

57 
	#PyIÁ_Check
 
PyLÚg_Check


	)

58 
	#PyUNICODE_FromUNICODE
 
PyUnicode_FromSŒšg


	)

59 
	#PyUNICODE_CHECK
 
PyUnicode_Check


	)

60 
	#FORMAT_STRING
 "(iy#)"

	)

62 #ià(
PY_VERSION_HEX
 < 0x03030000)

63 
	#PyUNICODE_AsBYTES
(
x
è
	`PyBy‹s_AsSŒšg
(
	`PyUnicode_AsUTF8SŒšg
(x))

	)

65 
	#PyUNICODE_AsBYTES
 
PyUnicode_AsUTF8


	)

68 
	#MOD_ERROR_VAL
 
NULL


	)

69 
	#MOD_SUCCESS_VAL
(
v®
è
	)
val

70 
	#MOD_INIT
(
Çme
è
PyMODINIT_FUNC
 
PyIn™_
##
	`Çme
()

	)

71 
	#MOD_DEF
(
ob
, 
Çme
, 
doc
, 
m‘hods
) \

72 
PyModuËDef
 
moduËdef
 = { \

73 
PyModuËDef_HEAD_INIT
, 
Çme
, 
doc
, -1, 
m‘hods
, }; \

74 
ob
 = 
	`PyModuË_C»©e
(&
moduËdef
); \

75 

	)

77 
	#PyUNICODE_FromUNICODE
 
PySŒšg_FromSŒšg


	)

78 
	#PyUNICODE_CHECK
 
PySŒšg_Check


	)

79 
	#PyUNICODE_AsBYTES
 
PySŒšg_AsSŒšg


	)

80 
	#FORMAT_STRING
 "(is#)"

	)

82 
	#MOD_ERROR_VAL


	)

83 
	#MOD_SUCCESS_VAL
(
v®
)

	)

84 
	#MOD_INIT
(
Çme
è
š™
##
	`Çme
()

	)

85 
	#MOD_DEF
(
ob
, 
Çme
, 
doc
, 
m‘hods
) \

86 
ob
 = 
	`Py_In™ModuË3
(
Çme
, 
m‘hods
, 
doc
); \

87 

	)

89 
	gmuÉick
;

90 
	gsÿÃxt_docum’tiÚ
[] = "Pythonƒxtension for HP scan sane driver";

91 
PyObjeù
 *
	gE¼ÜObjeù
;

95 
PyObjeù_HEAD
 
SANE_HªdË
 
	mh
;

96 } 
	t_SÿnDeviû
;

98 #ifdeà
WITH_THREAD


99 
PyTh»adS‹
 *
	g_§ve
;

103 
PyObjeù
 *
	$¿i£SªeE¼Ü
 (
SANE_Stus
 
¡
)

105 cÚ¡ *
¡ršg
;

107 ià(
¡
 =ğ
SANE_STATUS_GOOD
)

109 
	`Py_INCREF
 (
Py_NÚe
);

110  (
Py_NÚe
);

113 
¡ršg
 = 
	`§Ã_¡r¡©us
 (
¡
);

115 
	`PyE¼_S‘Objeù
(
E¼ÜObjeù
, 
	`PyIÁ_FromLÚg
(
¡
));

116  
NULL
;

117 
	}
}

120 
PyObjeù
 * 
	$¿i£E¼Ü
(cÚ¡ * 
¡r
)

122 
	`PyE¼_S‘SŒšg
 (
E¼ÜObjeù
, 
¡r
);

123  
NULL
;

124 
	}
}

127 
PyObjeù
 * 
	$¿i£DeviûClo£dE¼Ü
()

129  
	`¿i£E¼Ü
 ("_ScanDevice object is closed");

130 
	}
}

132 
PyObjeù
 *
	$g‘E¼ÜMes§ge
(
PyObjeù
 * 
£lf
, PyObjeù * 
¬gs
)

134 
¡
;

136 ià(!
	`PyArg_P¬£Tu¶e
 (
¬gs
, "i", &
¡
))

137 
	`¿i£E¼Ü
("Invalid‡rguments.");

139  
	`Py_BudV®ue
("s", 
	`§Ã_¡r¡©us
 (
¡
));

140 
	}
}

142 
PyTy³Objeù
 
	gSÿnDeviû_ty³
;

144 
	#SªeDevObjeù_Check
(
v
è((v)->
ob_ty³
 =ğ&
SÿnDeviû_ty³
)

	)

146 
_SÿnDeviû
 *
	$ÃwSÿnDeviûObjeù
 ()

148 
_SÿnDeviû
 *
£lf
;

150 
£lf
 = 
	`PyObjeù_NEW
 (
_SÿnDeviû
, &
SÿnDeviû_ty³
);

152 ià(
£lf
 =ğ
NULL
)

153  
NULL
;

155 
£lf
->
h
 = 
NULL
;

156  
£lf
;

157 
	}
}

162 
	$deAÎoc
 (
_SÿnDeviû
 * 
£lf
)

164 ià(
£lf
->
h
)

165 
	`§Ã_şo£
 (
£lf
->
h
);

167 
£lf
->
h
 = 
NULL
;

168 
	`PyObjeù_DEL
 (
£lf
);

169 
	}
}

171 
PyObjeù
 *
	$şo£Sÿn
 (
_SÿnDeviû
 * 
£lf
, 
PyObjeù
 * 
¬gs
)

173 ià(!
	`PyArg_P¬£Tu¶e
 (
¬gs
, ""))

174  
NULL
;

176 ià(
£lf
->
h
)

177 
	`§Ã_şo£
 (
£lf
->
h
);

179 
£lf
->
h
 = 
NULL
;

180 
	`Py_INCREF
 (
Py_NÚe
);

181  (
Py_NÚe
);

182 
	}
}

184 
PyObjeù
 *
	$g‘P¬am‘”s
 (
_SÿnDeviû
 * 
£lf
, 
PyObjeù
 * 
¬gs
)

186 
SANE_Stus
 
¡
;

187 
SANE_P¬am‘”s
 
p
;

188 *
fÜm©_Çme
 = "unknown";

190 ià(!
	`PyArg_P¬£Tu¶e
 (
¬gs
, ""))

191 
	`¿i£E¼Ü
("Invalid‡rguments.");

193 ià(
£lf
->
h
 =ğ
NULL
)

194  
	`¿i£DeviûClo£dE¼Ü
();

196 
Py_BEGIN_ALLOW_THREADS


197 
¡
 = 
	`§Ã_g‘_·¿m‘”s
 (
£lf
->
h
, &
p
);

198 
Py_END_ALLOW_THREADS


200 ià(
¡
 !ğ
SANE_STATUS_GOOD
)

201  
	`¿i£SªeE¼Ü
 (
¡
);

203 
p
.
fÜm©
)

205 (
SANE_FRAME_GRAY
):

206 
fÜm©_Çme
 = "gray";

208 (
SANE_FRAME_RGB
):

209 
fÜm©_Çme
 = "color";

211 (
SANE_FRAME_RED
):

212 
fÜm©_Çme
 = "red";

214 (
SANE_FRAME_GREEN
):

215 
fÜm©_Çme
 = "green";

217 (
SANE_FRAME_BLUE
):

218 
fÜm©_Çme
 = "blue";

222  
	`Py_BudV®ue
 ("isiiiii", 
p
.
fÜm©
, 
fÜm©_Çme
,

223 
p
.
Ï¡_äame
,….
pix–s_³r_lše
,

224 
p
.
lšes
,….
d•th
,….
by‹s_³r_lše
);

225 
	}
}

227 
PyObjeù
 *
	$¡¬tSÿn
 (
_SÿnDeviû
 * 
£lf
, 
PyObjeù
 * 
¬gs
)

229 
SANE_Stus
 
¡
;

231 ià(!
	`PyArg_P¬£Tu¶e
 (
¬gs
, ""))

232 
	`¿i£E¼Ü
("Invalid‡rguments.");

234 ià(
£lf
->
h
 =ğ
NULL
)

235  
	`¿i£DeviûClo£dE¼Ü
();

242 
Py_BEGIN_ALLOW_THREADS


243 
¡
 = 
	`§Ã_¡¬t
 (
£lf
->
h
);

244 
Py_END_ALLOW_THREADS


246 ià(
¡
 !ğ
SANE_STATUS_GOOD
 &&

247 
¡
 !ğ
SANE_STATUS_JAMMED
 &&

248 
¡
 !ğ
SANE_STATUS_EOF
 &&

249 
¡
 !ğ
SANE_STATUS_NO_DOCS
 &&

250 
¡
 !ğ
SANE_STATUS_MULTIPICK
)

251  
	`¿i£SªeE¼Ü
(
¡
);

253  
	`Py_BudV®ue
("i", 
¡
);

254 
	}
}

256 
PyObjeù
 *
	$ÿnûlSÿn
 (
_SÿnDeviû
 * 
£lf
, 
PyObjeù
 * 
¬gs
)

258 ià(!
	`PyArg_P¬£Tu¶e
 (
¬gs
, ""))

259 
	`¿i£E¼Ü
("Invalid‡rguments.");

261 ià(
£lf
->
h
 =ğ
NULL
)

262  
	`¿i£DeviûClo£dE¼Ü
();

264 
	`§Ã_ÿnûl
 (
£lf
->
h
);

265 
	`Py_INCREF
 (
Py_NÚe
);

266  
Py_NÚe
;

267 
	}
}

269 
PyObjeù
 *
	$g‘O±iÚs
 (
_SÿnDeviû
 * 
£lf
, 
PyObjeù
 * 
¬gs
)

271 cÚ¡ 
SANE_O±iÚ_DesütÜ
 *
d
;

272 
PyObjeù
 *
li¡
, *
v®ue
;

273 
i
 = 1;

275 ià(!
	`PyArg_P¬£Tu¶e
 (
¬gs
, ""))

276 
	`¿i£E¼Ü
("Invalid‡rguments.");

278 ià(
£lf
->
h
 =ğ
NULL
)

279  
	`¿i£DeviûClo£dE¼Ü
();

281 ià(!(
li¡
 = 
	`PyLi¡_New
 (0)))

282 
	`¿i£E¼Ü
("Unableo‡llocate†ist.");

286 
d
 = 
	`§Ã_g‘_İtiÚ_desütÜ
 (
£lf
->
h
, 
i
);

287 ià(
d
 !ğ
NULL
)

289 
PyObjeù
 *
cÚ¡¿št
 = 
NULL
;

290 
j
;

292 
d
->
cÚ¡¿št_ty³
)

294 (
SANE_CONSTRAINT_NONE
):

295 
	`Py_INCREF
 (
Py_NÚe
);

296 
cÚ¡¿št
 = 
Py_NÚe
;

298 (
SANE_CONSTRAINT_RANGE
):

299 ià(
d
->
ty³
 =ğ
SANE_TYPE_INT
)

300 
cÚ¡¿št
 =

301 
	`Py_BudV®ue
 ("iii", 
d
->
cÚ¡¿št
.
¿nge
->
mš
,

302 
d
->
cÚ¡¿št
.
¿nge
->
max
,

303 
d
->
cÚ¡¿št
.
¿nge
->
quªt
);

305 
cÚ¡¿št
 = 
	`Py_BudV®ue
 ("ddd",

306 
	`SANE_UNFIX
 (
d
->

307 
cÚ¡¿št
.

308 
¿nge
->
mš
),

309 
	`SANE_UNFIX
 (
d
->

310 
cÚ¡¿št
.

311 
¿nge
->
max
),

312 
	`SANE_UNFIX
 (
d
->

313 
cÚ¡¿št
.

314 
¿nge
->
quªt
));

316 (
SANE_CONSTRAINT_WORD_LIST
):

317 
cÚ¡¿št
 = 
	`PyLi¡_New
 (
d
->cÚ¡¿št.
wÜd_li¡
[0]);

319 ià(
d
->
ty³
 =ğ
SANE_TYPE_INT
)

320 
j
 = 1; j <ğ
d
->
cÚ¡¿št
.
wÜd_li¡
[0]; j++)

321 
	`PyLi¡_S‘I‹m
 (
cÚ¡¿št
, 
j
 - 1,

322 
	`PyIÁ_FromLÚg
 (
d
->
cÚ¡¿št
.

323 
wÜd_li¡
[
j
]));

325 
j
 = 1; j <ğ
d
->
cÚ¡¿št
.
wÜd_li¡
[0]; j++)

326 
	`PyLi¡_S‘I‹m
 (
cÚ¡¿št
, 
j
 - 1,

327 
	`PyFlßt_FromDoubË
 (
SANE_UNFIX


328 (
d
->

329 
cÚ¡¿št
.

330 
wÜd_li¡
[
j
])));

332 (
SANE_CONSTRAINT_STRING_LIST
):

333 
cÚ¡¿št
 = 
	`PyLi¡_New
 (0);

335 
j
 = 0; 
d
->
cÚ¡¿št
.
¡ršg_li¡
[j] !ğ
NULL
; j++)

336 
	`PyLi¡_Aµ’d
 (
cÚ¡¿št
,

337 
	`PyUNICODE_FromUNICODE
 (
d
->
cÚ¡¿št
.

338 
¡ršg_li¡
[
j
]));

341 
v®ue
 = 
	`Py_BudV®ue
 ("isssiiiiO", 
i
, 
d
->
Çme
, d->
t™Ë
, d->
desc
,

342 
d
->
ty³
, d->
un™
, d->
size
, d->
ÿp
, 
cÚ¡¿št
);

344 
	`PyLi¡_Aµ’d
 (
li¡
, 
v®ue
);

346 
i
++;

349 
d
 !ğ
NULL
);

350  
li¡
;

351 
	}
}

353 
PyObjeù
 *
	$g‘O±iÚ
 (
_SÿnDeviû
 * 
£lf
, 
PyObjeù
 * 
¬gs
)

355 
SANE_Stus
 
¡
;

356 cÚ¡ 
SANE_O±iÚ_DesütÜ
 *
d
;

357 
PyObjeù
 *
v®ue
 = 
NULL
;

358 
n
;

359 *
v
;

361 ià(!
	`PyArg_P¬£Tu¶e
 (
¬gs
, "i", &
n
))

362 
	`¿i£E¼Ü
("Invalid‡rguments.");

364 ià(
£lf
->
h
 =ğ
NULL
)

365  
	`¿i£DeviûClo£dE¼Ü
();

367 
d
 = 
	`§Ã_g‘_İtiÚ_desütÜ
 (
£lf
->
h
, 
n
);

368 
v
 = 
	`m®loc
 (
d
->
size
 + 1);

369 
¡
 = 
	`§Ã_cÚŒŞ_İtiÚ
 (
£lf
->
h
, 
n
, 
SANE_ACTION_GET_VALUE
, 
v
, 
NULL
);

371 ià(
¡
 !ğ
SANE_STATUS_GOOD
)

373 
	`ä“
 (
v
);

374  
	`¿i£SªeE¼Ü
(
¡
);

377 
d
->
ty³
)

379 (
SANE_TYPE_BOOL
):

380 (
SANE_TYPE_INT
):

381 
v®ue
 = 
	`Py_BudV®ue
 ("i", *((
SANE_IÁ
 *è
v
));

384 (
SANE_TYPE_FIXED
):

385 
v®ue
 = 
	`Py_BudV®ue
 ("d", 
	`SANE_UNFIX
 ((*((
SANE_Fixed
 *è
v
))));

388 (
SANE_TYPE_STRING
):

389 
v®ue
 = 
	`Py_BudV®ue
 ("s", 
v
);

392 (
SANE_TYPE_BUTTON
):

393 (
SANE_TYPE_GROUP
):

394 
v®ue
 = 
	`Py_BudV®ue
 ("O", 
Py_NÚe
);

398 
	`ä“
 (
v
);

399  
v®ue
;

400 
	}
}

402 
PyObjeù
 *
	$£tO±iÚ
 (
_SÿnDeviû
 * 
£lf
, 
PyObjeù
 * 
¬gs
)

404 
SANE_Stus
 
¡
;

405 cÚ¡ 
SANE_O±iÚ_DesütÜ
 *
d
;

406 
SANE_IÁ
 
i
;

407 
PyObjeù
 *
v®ue
;

408 
n
;

409 
muÉick
 = 1;

413 
SANE_BoŞ
 
b
 = 
SANE_TRUE
;

414 
	`§Ã_cÚŒŞ_İtiÚ
 (
£lf
->
h
, 9, 
SANE_ACTION_SET_VALUE
, (*)&
b
, &
i
);

418 
SANE_BoŞ
 
b
 = 
SANE_FALSE
;

419 
	`§Ã_cÚŒŞ_İtiÚ
 (
£lf
->
h
, 9, 
SANE_ACTION_SET_VALUE
, (*)&
b
, &
i
);

421 ià(!
	`PyArg_P¬£Tu¶e
 (
¬gs
, "iO", &
n
, &
v®ue
))

422 
	`¿i£E¼Ü
("Invalid‡rguments.");

424 ià(
£lf
->
h
 =ğ
NULL
)

425  
	`¿i£DeviûClo£dE¼Ü
();

427 
d
 = 
	`§Ã_g‘_İtiÚ_desütÜ
 (
£lf
->
h
, 
n
);

428 
d
->
ty³
)

430 (
SANE_TYPE_BOOL
):

431 ià(!
	`PyIÁ_Check
 (
v®ue
))

432  
	`¿i£E¼Ü
("SANE_Bool„equires‡n integer.");

434 
SANE_BoŞ
 
b
 = 
	`PyIÁ_AsLÚg
(
v®ue
);

436 ià(
b
 !ğ
SANE_FALSE
 && b > 
SANE_TRUE
)

437 
b
 = 
SANE_TRUE
;

439 
¡
 = 
	`§Ã_cÚŒŞ_İtiÚ
 (
£lf
->
h
, 
n
, 
SANE_ACTION_SET_VALUE
, (*)&
b
, &
i
);

442 (
SANE_TYPE_INT
):

443 ià(!
	`PyIÁ_Check
 (
v®ue
))

444  
	`¿i£E¼Ü
("SANE_Int„equires‡n integer.");

446 
SANE_IÁ
 
j
 = 
	`PyIÁ_AsLÚg
 (
v®ue
);

447 
¡
 = 
	`§Ã_cÚŒŞ_İtiÚ
 (
£lf
->
h
, 
n
, 
SANE_ACTION_SET_VALUE
, (*)&
j
, &
i
);

450 (
SANE_TYPE_FIXED
):

451 ià(!
	`PyFlßt_Check
 (
v®ue
))

452  
	`¿i£E¼Ü
("SANE_Fixed„equires‡n float.");

454 
SANE_Fixed
 
f
 = 
	`SANE_FIX
 (
	`PyFlßt_AsDoubË
 (
v®ue
));

455 
¡
 = 
	`§Ã_cÚŒŞ_İtiÚ
 (
£lf
->
h
, 
n
, 
SANE_ACTION_SET_VALUE
, (*)&
f
, &
i
);

458 (
SANE_TYPE_STRING
):

459 ià(!
	`PyUNICODE_CHECK
 (
v®ue
))

460  
	`¿i£E¼Ü
("SANE_String„equires‡‡ string.");

462 
SANE_SŒšg
 
s
 = 
	`m®loc
 (
d
->
size
 + 1);

463 
	`¡ºıy
 (
s
, 
	`PyUNICODE_AsBYTES
 (
v®ue
), 
d
->
size
 - 1);

464 ((
SANE_SŒšg
è
s
)[
d
->
size
 - 1] = 0;

465 
¡
 = 
	`§Ã_cÚŒŞ_İtiÚ
 (
£lf
->
h
, 
n
, 
SANE_ACTION_SET_VALUE
, (*)
s
, &
i
);

466 
	`ä“
(
s
);

469 (
SANE_TYPE_BUTTON
):

470 (
SANE_TYPE_GROUP
):

474 ià(
¡
 !ğ
SANE_STATUS_GOOD
)

475  
	`¿i£SªeE¼Ü
(
¡
);

477  
	`Py_BudV®ue
 ("i", 
i
);

478 
	}
}

480 
PyObjeù
 *
	$£tAutoO±iÚ
 (
_SÿnDeviû
 * 
£lf
, 
PyObjeù
 * 
¬gs
)

482 
SANE_Stus
 
¡
;

483 cÚ¡ 
SANE_O±iÚ_DesütÜ
 *
d
;

484 
SANE_IÁ
 
i
;

485 
n
;

487 ià(!
	`PyArg_P¬£Tu¶e
 (
¬gs
, "i", &
n
))

488 
	`¿i£E¼Ü
("Invalid‡rguments.");

490 ià(
£lf
->
h
 =ğ
NULL
)

491  
	`¿i£DeviûClo£dE¼Ü
();

493 
d
 = 
	`§Ã_g‘_İtiÚ_desütÜ
 (
£lf
->
h
, 
n
);

494 
¡
 = 
	`§Ã_cÚŒŞ_İtiÚ
 (
£lf
->
h
, 
n
, 
SANE_ACTION_SET_AUTO
, 
NULL
, &
i
);

496 ià(
¡
 !ğ
SANE_STATUS_GOOD
)

497  
	`¿i£SªeE¼Ü
 (
¡
);

499  
	`Py_BudV®ue
 ("i", 
i
);

500 
	}
}

502 
	#MAX_READSIZE
 65536

	)

504 
PyObjeù
 *
	$»adSÿn
 (
_SÿnDeviû
 * 
£lf
, 
PyObjeù
 * 
¬gs
)

506 
SANE_Stus
 
¡
;

507 
SANE_IÁ
 
Ën
;

508 
SANE_By‹
 
bufãr
[
MAX_READSIZE
];

509 
by‹s_to_»ad
;

511 ià(!
	`PyArg_P¬£Tu¶e
 (
¬gs
, "i", &
by‹s_to_»ad
))

512 
	`¿i£E¼Ü
("Invalid‡rguments.");

514 ià(
by‹s_to_»ad
 > 
MAX_READSIZE
)

515  
	`¿i£E¼Ü
("bytes_to_read > MAX_READSIZE");

517 ià(
£lf
->
h
 =ğ
NULL
)

518  
	`¿i£DeviûClo£dE¼Ü
();

521 
Py_UNBLOCK_THREADS


522 
¡
 = 
	`§Ã_»ad
 (
£lf
->
h
, 
bufãr
, 
by‹s_to_»ad
, &
Ën
);

524 
Py_BLOCK_THREADS


526 ià(
¡
 !ğ
SANE_STATUS_GOOD
 &&

527 
¡
 !ğ
SANE_STATUS_EOF
 &&

528 
¡
 !ğ
SANE_STATUS_NO_DOCS
 &&

529 
¡
 !ğ
SANE_STATUS_MULTIPICK
)

531 
	`§Ã_ÿnûl
(
£lf
->
h
);

533  
	`¿i£SªeE¼Ü
(
¡
);

536  
	`Py_BudV®ue
 (
FORMAT_STRING
, 
¡
, 
bufãr
, 
Ën
);

537 
	}
}

540 
PyM‘hodDef
 
	gSÿnDeviû_m‘hods
[] = {

541 {"g‘P¬am‘”s", (
PyCFunùiÚ
è
g‘P¬am‘”s
, 
METH_VARARGS
},

543 {"g‘O±iÚs", (
PyCFunùiÚ
è
g‘O±iÚs
, 
METH_VARARGS
},

544 {"g‘O±iÚ", (
PyCFunùiÚ
è
g‘O±iÚ
, 
METH_VARARGS
},

545 {"£tO±iÚ", (
PyCFunùiÚ
è
£tO±iÚ
, 
METH_VARARGS
},

546 {"£tAutoO±iÚ", (
PyCFunùiÚ
è
£tAutoO±iÚ
, 
METH_VARARGS
},

548 {"¡¬tSÿn", (
PyCFunùiÚ
è
¡¬tSÿn
, 
METH_VARARGS
},

549 {"ÿnûlSÿn", (
PyCFunùiÚ
è
ÿnûlSÿn
, 
METH_VARARGS
},

550 {"»adSÿn", (
PyCFunùiÚ
è
»adSÿn
, 
METH_VARARGS
},

551 {"şo£Sÿn", (
PyCFunùiÚ
è
şo£Sÿn
, 
METH_VARARGS
},

552 {
NULL
, NULL}

556 
PyTy³Objeù
 
	gSÿnDeviû_ty³
 =

558 
PyV¬Objeù_HEAD_INIT
Ğ&
PyTy³_Ty³
, 0 )

560 (
_SÿnDeviû
 ),

562 Ğ
de¡ruùÜ
 ) 
deAÎoc
,

574 
PyObjeù_G’”icG‘A‰r
,

575 
PyObjeù_G’”icS‘A‰r
,

577 
Py_TPFLAGS_DEFAULT
 | 
Py_TPFLAGS_BASETYPE
,

585 
SÿnDeviû_m‘hods
,

601 
	$auth_ÿÎback
 (
SANE_SŒšg_CÚ¡
 
»sourû
,

602 
SANE_Ch¬
 * 
u£ºame
, SANE_Ch¬ * 
·sswÜd
)

604 
	`´štf
("auth_callback\n");

605 
	}
}

607 
PyObjeù
 *
	$š™
 (
PyObjeù
 * 
£lf
, PyObjeù * 
¬gs
)

609 
SANE_Stus
 
¡
;

610 
SANE_IÁ
 
v”siÚ
;

612 ià(!
	`PyArg_P¬£Tu¶e
 (
¬gs
, ""))

613 
	`¿i£E¼Ü
("Invalid‡rguments.");

616 
¡
 = 
	`§Ã_š™
 (&
v”siÚ
, 
auth_ÿÎback
);

618 ià(
¡
 !ğ
SANE_STATUS_GOOD
)

619  
	`¿i£SªeE¼Ü
 (
¡
);

621  
	`Py_BudV®ue
 ("iiii", 
v”siÚ
, 
	`SANE_VERSION_MAJOR
 (version),

622 
	`SANE_VERSION_MINOR
 (
v”siÚ
),

623 
	`SANE_VERSION_BUILD
 (
v”siÚ
));

625 
	}
}

629 
PyObjeù
 *
	$deIn™
 (
PyObjeù
 * 
£lf
, PyObjeù * 
¬gs
)

631 ià(!
	`PyArg_P¬£Tu¶e
 (
¬gs
, ""))

632 
	`¿i£E¼Ü
("Invalid‡rguments");

634 
	`§Ã_ex™
 ();

635 
	`Py_INCREF
 (
Py_NÚe
);

636  
Py_NÚe
;

637 
	}
}

639 
PyObjeù
 *
	$g‘Deviûs
 (
PyObjeù
 * 
£lf
, PyObjeù * 
¬gs
)

641 cÚ¡ 
SANE_Deviû
 **
deviû_li¡
;

642 
SANE_Stus
 
¡
;

643 
PyObjeù
 *
li¡
;

644 
loÿl_Úly
=
SANE_FALSE
, 
i
;

646 ià(!
	`PyArg_P¬£Tu¶e
 (
¬gs
, "|i", &
loÿl_Úly
))

647 
	`¿i£E¼Ü
("Invalid‡rguments");

649 
¡
 = 
	`§Ã_g‘_deviûs
 (&
deviû_li¡
, 
loÿl_Úly
);

651 ià(
¡
 !ğ
SANE_STATUS_GOOD
)

652  
	`¿i£SªeE¼Ü
 (
¡
);

654 ià(!(
li¡
 = 
	`PyLi¡_New
 (0)))

655  
	`¿i£E¼Ü
("Unableo‡llocate device†ist.");

657 
i
=0; 
deviû_li¡
[i]; i++)

659 
	`PyLi¡_Aµ’d
 (
li¡
, 
	`Py_BudV®ue
 ("ssss", 
deviû_li¡
[
i
]->
Çme
, deviû_li¡[i]->
v’dÜ
,

660 
deviû_li¡
[
i
]->
mod–
, deviû_li¡[i]->
ty³
));

663  
li¡
;

664 
	}
}

668 
PyObjeù
 *
	$İ’Deviû
 (
PyObjeù
 * 
£lf
, PyObjeù * 
¬gs
)

670 
_SÿnDeviû
 *
rv
;

671 
SANE_Stus
 
¡
;

672 *
Çme
;

674 ià(!
	`PyArg_P¬£Tu¶e
 (
¬gs
, "s", &
Çme
))

675 
	`¿i£E¼Ü
("Invalid‡rguments");

677 
rv
 = 
	`ÃwSÿnDeviûObjeù
 ();

679 ià(
rv
 =ğ
NULL
)

680  
	`¿i£E¼Ü
("Unableo create _ScanDevice object.");

682 
¡
 = 
	`§Ã_İ’
 (
Çme
, &(
rv
->
h
));

684 ià(
¡
 !ğ
SANE_STATUS_GOOD
)

686 
	`Py_DECREF
 (
rv
);

687  
	`¿i£SªeE¼Ü
 (
¡
);

689  (
PyObjeù
 *è
rv
;

690 
	}
}

692 
PyObjeù
 *
	$isO±iÚAùive
 (
PyObjeù
 * 
£lf
, PyObjeù * 
¬gs
)

694 
SANE_IÁ
 
ÿp
;

695 
lg
;

697 ià(!
	`PyArg_P¬£Tu¶e
 (
¬gs
, "l", &
lg
))

698 
	`¿i£E¼Ü
("Invalid‡rguments");

700 
ÿp
 = 
lg
;

701  
	`PyIÁ_FromLÚg
 (
	`SANE_OPTION_IS_ACTIVE
 (
ÿp
));

702 
	}
}

704 
PyObjeù
 *
	$£tMuÉick
 (
PyObjeù
 * 
£lf
, PyObjeù * 
¬gs
)

707 ià(!
	`PyArg_P¬£Tu¶e
 (
¬gs
, "i", &
muÉick
))

708 
	`¿i£E¼Ü
("Invalid‡rguments");

709 
	`Py_INCREF
 ( 
Py_NÚe
 );

710  
Py_NÚe
;

711 
	}
}

712 
PyObjeù
 *
	$isO±iÚS‘bË
 (
PyObjeù
 * 
£lf
, PyObjeù * 
¬gs
)

714 
SANE_IÁ
 
ÿp
;

715 
lg
;

717 ià(!
	`PyArg_P¬£Tu¶e
 (
¬gs
, "l", &
lg
))

718 
	`¿i£E¼Ü
("Invalid‡rguments");

720 
ÿp
 = 
lg
;

721  
	`PyIÁ_FromLÚg
 (
	`SANE_OPTION_IS_SETTABLE
 (
ÿp
));

722 
	}
}

727 
PyM‘hodDef
 
	gSÿnExt_m‘hods
[] = {

728 {"š™", 
š™
, 
METH_VARARGS
},

729 {"deIn™", 
deIn™
, 
METH_VARARGS
},

730 {"g‘Deviûs", 
g‘Deviûs
, 
METH_VARARGS
},

731 {"İ’Deviû", 
İ’Deviû
, 
METH_VARARGS
},

732 {"isO±iÚAùive", 
isO±iÚAùive
, 
METH_VARARGS
},

733 {"isO±iÚS‘bË", 
isO±iÚS‘bË
, 
METH_VARARGS
},

734 {"g‘E¼ÜMes§ge", 
g‘E¼ÜMes§ge
, 
METH_VARARGS
},

735 {"£tMuÉick", 
£tMuÉick
, 
METH_VARARGS
},

736 {
NULL
, NULL}

739 
	$šsšt
 (
PyObjeù
 * 
d
, *
Çme
, 
v®ue
)

741 
PyObjeù
 *
v
 = 
	`PyIÁ_FromLÚg
 ((è
v®ue
);

743 ià(!
v
 || 
	`PyDiù_S‘I‹mSŒšg
 (
d
, 
Çme
, v))

744 
	`Py_F©®E¼Ü
 ("can't initialize sane module");

746 
	`Py_DECREF
 (
v
);

747 
	}
}

749 #ià
PY_MAJOR_VERSION
 >= 3

750 
PyModuËDef
 
	gmoduËdef
 = {

751 
PyModuËDef_HEAD_INIT
,

753 
sÿÃxt_docum’tiÚ
,

755 
SÿnExt_m‘hods
,

756 
NULL
,

757 
NULL
,

758 
NULL
,

759 
NULL
,

765 
	$MOD_INIT
(
sÿÃxt
) {

766 
PyObjeù
* 
mod
 ;

767 
	`MOD_DEF
(
mod
, "sÿÃxt", 
sÿÃxt_docum’tiÚ
, 
SÿnExt_m‘hods
);

768 ià(
mod
 =ğ
NULL
)

769  
MOD_ERROR_VAL
;

772 
PyObjeù
* 
d
 = 
	`PyModuË_G‘Diù
(
mod
);

773 
E¼ÜObjeù
 = 
	`PyE¼_NewExû±iÚ
("sÿÃxt.”rÜ", 
NULL
, NULL);

774 ià(
E¼ÜObjeù
 =ğ
NULL
)

776 
	`Py_DECREF
(
mod
);

777  
MOD_ERROR_VAL
;

779 
	`PyDiù_S‘I‹mSŒšg
 (
d
, "”rÜ", 
E¼ÜObjeù
);

782 
	`šsšt
 (
d
, "INFO_INEXACT", 
SANE_INFO_INEXACT
);

783 
	`šsšt
 (
d
, "INFO_RELOAD_OPTIONS", 
SANE_INFO_RELOAD_OPTIONS
);

784 
	`šsšt
 (
d
, "RELOAD_PARAMS", 
SANE_INFO_RELOAD_PARAMS
);

786 
	`šsšt
 (
d
, "FRAME_GRAY", 
SANE_FRAME_GRAY
);

787 
	`šsšt
 (
d
, "FRAME_RGB", 
SANE_FRAME_RGB
);

788 
	`šsšt
 (
d
, "FRAME_RED", 
SANE_FRAME_RED
);

789 
	`šsšt
 (
d
, "FRAME_GREEN", 
SANE_FRAME_GREEN
);

790 
	`šsšt
 (
d
, "FRAME_BLUE", 
SANE_FRAME_BLUE
);

792 
	`šsšt
 (
d
, "CONSTRAINT_NONE", 
SANE_CONSTRAINT_NONE
);

793 
	`šsšt
 (
d
, "CONSTRAINT_RANGE", 
SANE_CONSTRAINT_RANGE
);

794 
	`šsšt
 (
d
, "CONSTRAINT_WORD_LIST", 
SANE_CONSTRAINT_WORD_LIST
);

795 
	`šsšt
 (
d
, "CONSTRAINT_STRING_LIST", 
SANE_CONSTRAINT_STRING_LIST
);

797 
	`šsšt
 (
d
, "TYPE_BOOL", 
SANE_TYPE_BOOL
);

798 
	`šsšt
 (
d
, "TYPE_INT", 
SANE_TYPE_INT
);

799 
	`šsšt
 (
d
, "TYPE_FIXED", 
SANE_TYPE_FIXED
);

800 
	`šsšt
 (
d
, "TYPE_STRING", 
SANE_TYPE_STRING
);

801 
	`šsšt
 (
d
, "TYPE_BUTTON", 
SANE_TYPE_BUTTON
);

802 
	`šsšt
 (
d
, "TYPE_GROUP", 
SANE_TYPE_GROUP
);

804 
	`šsšt
 (
d
, "UNIT_NONE", 
SANE_UNIT_NONE
);

805 
	`šsšt
 (
d
, "UNIT_PIXEL", 
SANE_UNIT_PIXEL
);

806 
	`šsšt
 (
d
, "UNIT_BIT", 
SANE_UNIT_BIT
);

807 
	`šsšt
 (
d
, "UNIT_MM", 
SANE_UNIT_MM
);

808 
	`šsšt
 (
d
, "UNIT_DPI", 
SANE_UNIT_DPI
);

809 
	`šsšt
 (
d
, "UNIT_PERCENT", 
SANE_UNIT_PERCENT
);

810 
	`šsšt
 (
d
, "UNIT_MICROSECOND", 
SANE_UNIT_MICROSECOND
);

812 
	`šsšt
 (
d
, "CAP_SOFT_SELECT", 
SANE_CAP_SOFT_SELECT
);

813 
	`šsšt
 (
d
, "CAP_HARD_SELECT", 
SANE_CAP_HARD_SELECT
);

814 
	`šsšt
 (
d
, "CAP_SOFT_DETECT", 
SANE_CAP_SOFT_DETECT
);

815 
	`šsšt
 (
d
, "CAP_EMULATED", 
SANE_CAP_EMULATED
);

816 
	`šsšt
 (
d
, "CAP_AUTOMATIC", 
SANE_CAP_AUTOMATIC
);

817 
	`šsšt
 (
d
, "CAP_INACTIVE", 
SANE_CAP_INACTIVE
);

818 
	`šsšt
 (
d
, "CAP_ADVANCED", 
SANE_CAP_ADVANCED
);

821 
	`šsšt
 (
d
, "SANE_WORD_SIZE",  (
SANE_WÜd
));

824 
	`šsšt
 (
d
, "INFO_INEXACT", 
SANE_INFO_INEXACT
);

825 
	`šsšt
 (
d
, "INFO_RELOAD_OPTIONS", 
SANE_INFO_RELOAD_OPTIONS
);

826 
	`šsšt
 (
d
, "INFO_RELOAD_PARAMS", 
SANE_INFO_RELOAD_PARAMS
);

829 
	`šsšt
 (
d
, "SANE_STATUS_GOOD", 
SANE_STATUS_GOOD
);

830 
	`šsšt
 (
d
, "SANE_STATUS_UNSUPPORTED", 
SANE_STATUS_UNSUPPORTED
);

831 
	`šsšt
 (
d
, "SANE_STATUS_CANCELLED", 
SANE_STATUS_CANCELLED
);

832 
	`šsšt
 (
d
, "SANE_STATUS_DEVICE_BUSY", 
SANE_STATUS_DEVICE_BUSY
);

833 
	`šsšt
 (
d
, "SANE_STATUS_INVAL", 
SANE_STATUS_INVAL
);

834 
	`šsšt
 (
d
, "SANE_STATUS_EOF", 
SANE_STATUS_EOF
);

835 
	`šsšt
 (
d
, "SANE_STATUS_JAMMED", 
SANE_STATUS_JAMMED
);

836 
	`šsšt
 (
d
, "SANE_STATUS_NO_DOCS", 
SANE_STATUS_NO_DOCS
);

837 
	`šsšt
 (
d
, "SANE_STATUS_COVER_OPEN", 
SANE_STATUS_COVER_OPEN
);

838 
	`šsšt
 (
d
, "SANE_STATUS_IO_ERROR", 
SANE_STATUS_IO_ERROR
);

839 
	`šsšt
 (
d
, "SANE_STATUS_NO_MEM", 
SANE_STATUS_NO_MEM
);

840 
	`šsšt
 (
d
, "SANE_STATUS_ACCESS_DENIED", 
SANE_STATUS_ACCESS_DENIED
);

841 
	`šsšt
 (
d
, "SANE_STATUS_MULTIPICK", 
SANE_STATUS_MULTIPICK
);

844 
	`šsšt
(
d
, "MAX_READSIZE", 
MAX_READSIZE
);

847 ià(
	`PyE¼_Occu¼ed
 ())

848 
	`Py_F©®E¼Ü
 ("can't initialize module scanext");

850  
	`MOD_SUCCESS_VAL
(
mod
);

851 
	}
}

	@/usr/include/arpa/inet.h

18 #iâdeà
_ARPA_INET_H


19 
	#_ARPA_INET_H
 1

	)

21 
	~<ã©u»s.h
>

22 
	~<Ãtš‘/š.h
>

25 #iâdeà
__sockËn_t_defšed


26 
__sockËn_t
 
	tsockËn_t
;

27 
	#__sockËn_t_defšed


	)

30 
__BEGIN_DECLS


34 
š_addr_t
 
	$š‘_addr
 (cÚ¡ *
__ı
è
__THROW
;

37 
š_addr_t
 
	$š‘_Êaof
 (
š_addr
 
__š
è
__THROW
;

41 
š_addr
 
	$š‘_mak—ddr
 (
š_addr_t
 
__Ãt
, in_addr_ˆ
__ho¡
)

42 
__THROW
;

45 
š_addr_t
 
	$š‘_Ãtof
 (
š_addr
 
__š
è
__THROW
;

49 
š_addr_t
 
	$š‘_ÃtwÜk
 (cÚ¡ *
__ı
è
__THROW
;

53 *
	$š‘_Áß
 (
š_addr
 
__š
è
__THROW
;

58 
	$š‘_±Ú
 (
__af
, cÚ¡ *
__»¡riù
 
__ı
,

59 *
__»¡riù
 
__buf
è
__THROW
;

64 cÚ¡ *
	$š‘_Áİ
 (
__af
, cÚ¡ *
__»¡riù
 
__ı
,

65 *
__»¡riù
 
__buf
, 
sockËn_t
 
__Ën
)

66 
__THROW
;

70 #ifdeà
__USE_MISC


73 
	$š‘_©Ú
 (cÚ¡ *
__ı
, 
š_addr
 *
__šp
è
__THROW
;

77 *
	$š‘_Ã
 (
š_addr_t
 
__Ãt
, *
__buf
, 
size_t
 
__Ën
è
__THROW
;

82 *
	$š‘_Ãt_Áİ
 (
__af
, cÚ¡ *
__ı
, 
__b™s
,

83 *
__buf
, 
size_t
 
__Ën
è
__THROW
;

88 
	$š‘_Ãt_±Ú
 (
__af
, cÚ¡ *
__ı
,

89 *
__buf
, 
size_t
 
__Ën
è
__THROW
;

94 
	$š‘_n§p_addr
 (cÚ¡ *
__ı
,

95 *
__buf
, 
__Ën
è
__THROW
;

99 *
	$š‘_n§p_Áß
 (
__Ën
, cÚ¡ *
__ı
,

100 *
__buf
è
__THROW
;

103 
__END_DECLS


	@/usr/include/assert.h

22 #ifdef 
_ASSERT_H


24 #undeà
_ASSERT_H


25 #undeà
as£¹


26 #undeà
__ASSERT_VOID_CAST


28 #ifdef 
__USE_GNU


29 #undeà
as£¹_³¼Ü


34 
	#_ASSERT_H
 1

	)

35 
	~<ã©u»s.h
>

37 #ià
defšed
 
__ılu¥lus
 && 
__GNUC_PREREQ
 (2,95)

38 
	#__ASSERT_VOID_CAST
 
¡©ic_ÿ¡
<>

	)

40 
	#__ASSERT_VOID_CAST
 ()

	)

48 #ifdef 
NDEBUG


50 
	#as£¹
(
ex´
è(
	`__ASSERT_VOID_CAST
 (0))

	)

58 #ifdef 
__USE_GNU


59 
	#as£¹_³¼Ü
(
”ºum
è(
	`__ASSERT_VOID_CAST
 (0))

	)

64 #iâdeà
_ASSERT_H_DECLS


65 
	#_ASSERT_H_DECLS


	)

66 
__BEGIN_DECLS


69 
	$__as£¹_ç
 (cÚ¡ *
__as£¹iÚ
, cÚ¡ *
__fe
,

70 
__lše
, cÚ¡ *
__funùiÚ
)

71 
__THROW
 
	`__©Œibu‹__
 ((
__nÜ‘uº__
));

74 
	$__as£¹_³¼Ü_ç
 (
__”ºum
, cÚ¡ *
__fe
,

75 
__lše
, cÚ¡ *
__funùiÚ
)

76 
__THROW
 
	`__©Œibu‹__
 ((
__nÜ‘uº__
));

81 
	$__as£¹
 (cÚ¡ *
__as£¹iÚ
, cÚ¡ *
__fe
, 
__lše
)

82 
__THROW
 
	`__©Œibu‹__
 ((
__nÜ‘uº__
));

85 
__END_DECLS


91 #ià
defšed
 
__ılu¥lus


92 
	#as£¹
(
ex´
) \

93 (
¡©ic_ÿ¡
 <
boŞ
> (
ex´
) \

95 : 
	`__as£¹_ç
 (#ex´, 
__FILE__
, 
__LINE__
, 
__ASSERT_FUNCTION
))

	)

96 #–ià!
defšed
 
__GNUC__
 || defšed 
__STRICT_ANSI__


97 
	#as£¹
(
ex´
) \

98 ((
ex´
) \

99 ? 
	`__ASSERT_VOID_CAST
 (0) \

100 : 
	`__as£¹_ç
 (#ex´, 
__FILE__
, 
__LINE__
, 
__ASSERT_FUNCTION
))

	)

107 
	#as£¹
(
ex´
) \

108 ((è ((
ex´
è? 1 : 0), 
	`__ex‹nsiÚ__
 ({ \

109 ià(
ex´
) \

112 
	`__as£¹_ç
 (#ex´, 
__FILE__
, 
__LINE__
, 
__ASSERT_FUNCTION
); \

113 
	}
}))

	)

116 #ifdef 
__USE_GNU


117 
	#as£¹_³¼Ü
(
”ºum
) \

118 (!(
”ºum
) \

119 ? 
	`__ASSERT_VOID_CAST
 (0) \

120 : 
	`__as£¹_³¼Ü_ç
 ((
”ºum
), 
__FILE__
, 
__LINE__
, 
__ASSERT_FUNCTION
))

	)

128 #ià
defšed
 
__ılu¥lus
 ? 
__GNUC_PREREQ
 (2, 6) : __GNUC_PREREQ (2, 4)

129 
	#__ASSERT_FUNCTION
 
__ex‹nsiÚ__
 
__PRETTY_FUNCTION__


	)

131 #ià
defšed
 
__STDC_VERSION__
 && __STDC_VERSION__ >= 199901L

132 
	#__ASSERT_FUNCTION
 
__func__


	)

134 
	#__ASSERT_FUNCTION
 ((cÚ¡ *è0)

	)

141 #ià
defšed
 
__USE_ISOC11
 && !defšed 
__ılu¥lus


142 #undeà
¡©ic_as£¹


143 
	#¡©ic_as£¹
 
_Stic_as£¹


	)

	@/usr/include/ctype.h

22 #iâdef 
_CTYPE_H


23 
	#_CTYPE_H
 1

	)

25 
	~<ã©u»s.h
>

26 
	~<b™s/ty³s.h
>

28 
	g__BEGIN_DECLS


30 #iâdeà
_ISb™


39 
	~<’dŸn.h
>

40 #ià
__BYTE_ORDER
 =ğ
__BIG_ENDIAN


41 
	#_ISb™
(
b™
è(1 << (b™))

	)

43 
	#_ISb™
(
b™
è((b™è< 8 ? ((1 << (b™)è<< 8è: ((1 << (b™)è>> 8))

	)

48 
	m_ISuµ”
 = 
_ISb™
 (0),

49 
	m_ISlow”
 = 
_ISb™
 (1),

50 
	m_IS®pha
 = 
_ISb™
 (2),

51 
	m_ISdig™
 = 
_ISb™
 (3),

52 
	m_ISxdig™
 = 
_ISb™
 (4),

53 
	m_IS¥aû
 = 
_ISb™
 (5),

54 
	m_IS´št
 = 
_ISb™
 (6),

55 
	m_ISg¿ph
 = 
_ISb™
 (7),

56 
	m_ISbÏnk
 = 
_ISb™
 (8),

57 
	m_ISúŒl
 = 
_ISb™
 (9),

58 
	m_ISpunù
 = 
_ISb™
 (10),

59 
	m_IS®num
 = 
_ISb™
 (11)

79 cÚ¡ **
	$__ùy³_b_loc
 ()

80 
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
));

81 cÚ¡ 
__št32_t
 **
	$__ùy³_tŞow”_loc
 ()

82 
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
));

83 cÚ¡ 
__št32_t
 **
	$__ùy³_touµ”_loc
 ()

84 
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
));

87 #iâdeà
__ılu¥lus


88 
	#__isùy³
(
c
, 
ty³
) \

89 ((*
	`__ùy³_b_loc
 ())[(è(
c
)] & (è
ty³
)

	)

90 #–ià
defšed
 
__USE_EXTERN_INLINES


91 
	#__isùy³_f
(
ty³
) \

92 
__ex‹º_šlše
 \

93 
is
##
	`ty³
 (
__c
è
__THROW
 \

95  (*
	`__ùy³_b_loc
 ())[(è(
__c
)] & (è
_IS
##
ty³
; \

96 
	}

	)
}

99 
	#__i§scii
(
c
è(((cè& ~0x7fè=ğ0è

	)

100 
	#__tßscii
(
c
è((cè& 0x7fè

	)

102 
	#__exùy³
(
Çme
è
	`Çme
 (è
__THROW


	)

108 
__exùy³
 (
i§Êum
);

109 
__exùy³
 (
i§Íha
);

110 
__exùy³
 (
isúŒl
);

111 
__exùy³
 (
isdig™
);

112 
__exùy³
 (
i¦ow”
);

113 
__exùy³
 (
isg¿ph
);

114 
__exùy³
 (
i¥ršt
);

115 
__exùy³
 (
i¥unù
);

116 
__exùy³
 (
is¥aû
);

117 
__exùy³
 (
isuµ”
);

118 
__exùy³
 (
isxdig™
);

122 
	$tŞow”
 (
__c
è
__THROW
;

125 
	$touµ”
 (
__c
è
__THROW
;

129 #ifdef 
__USE_ISOC99


130 
	`__exùy³
 (
isbÏnk
);

133 #ifdeà
__USE_GNU


135 
	$isùy³
 (
__c
, 
__mask
è
__THROW
;

138 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_XOPEN


142 
	$i§scii
 (
__c
è
__THROW
;

146 
	$tßscii
 (
__c
è
__THROW
;

150 
	`__exùy³
 (
_touµ”
);

151 
	`__exùy³
 (
_tŞow”
);

155 
	#__tobody
(
c
, 
f
, 
a
, 
¬gs
) \

156 (
__ex‹nsiÚ__
 \

157 ({ 
__»s
; \

158 ià( (
c
) > 1) \

160 ià(
	`__butš_cÚ¡ªt_p
 (
c
)) \

162 
__c
 = (
c
); \

163 
__»s
 = 
__c
 < -128 || __ø> 255 ? __ø: (
a
)[__c]; \

166 
__»s
 = 
f
 
¬gs
; \

169 
__»s
 = (
a
)[(è(
c
)]; \

170 
__»s
; 
	}
}))

	)

172 #ià!
defšed
 
__NO_CTYPE


173 #ifdeà
__isùy³_f


174 
	$__isùy³_f
 (
®num
)

175 
	$__isùy³_f
 (
®pha
)

176 
	$__isùy³_f
 (
úŒl
)

177 
	$__isùy³_f
 (
dig™
)

178 
	$__isùy³_f
 (
low”
)

179 
	$__isùy³_f
 (
g¿ph
)

180 
	$__isùy³_f
 (
´št
)

181 
	$__isùy³_f
 (
punù
)

182 
	$__isùy³_f
 (
¥aû
)

183 
	$__isùy³_f
 (
uµ”
)

184 
	$__isùy³_f
 (
xdig™
)

185 #ifdeà
__USE_ISOC99


186 
	$__isùy³_f
 (
bÏnk
)

188 #–ià
defšed
 
__isùy³


189 
	#i§Êum
(
c
è
	`__isùy³
((c), 
_IS®num
)

	)

190 
	#i§Íha
(
c
è
	`__isùy³
((c), 
_IS®pha
)

	)

191 
	#isúŒl
(
c
è
	`__isùy³
((c), 
_ISúŒl
)

	)

192 
	#isdig™
(
c
è
	`__isùy³
((c), 
_ISdig™
)

	)

193 
	#i¦ow”
(
c
è
	`__isùy³
((c), 
_ISlow”
)

	)

194 
	#isg¿ph
(
c
è
	`__isùy³
((c), 
_ISg¿ph
)

	)

195 
	#i¥ršt
(
c
è
	`__isùy³
((c), 
_IS´št
)

	)

196 
	#i¥unù
(
c
è
	`__isùy³
((c), 
_ISpunù
)

	)

197 
	#is¥aû
(
c
è
	`__isùy³
((c), 
_IS¥aû
)

	)

198 
	#isuµ”
(
c
è
	`__isùy³
((c), 
_ISuµ”
)

	)

199 
	#isxdig™
(
c
è
	`__isùy³
((c), 
_ISxdig™
)

	)

200 #ifdeà
__USE_ISOC99


201 
	#isbÏnk
(
c
è
	`__isùy³
((c), 
_ISbÏnk
)

	)

205 #ifdeà
__USE_EXTERN_INLINES


206 
__ex‹º_šlše
 

207 
	`__NTH
 (
	$tŞow”
 (
__c
))

209  
__c
 >ğ-128 && __ø< 256 ? (*
	`__ùy³_tŞow”_loc
 ())[__c] : __c;

210 
	}
}

212 
__ex‹º_šlše
 

213 
__NTH
 (
	$touµ”
 (
__c
))

215  
__c
 >ğ-128 && __ø< 256 ? (*
	`__ùy³_touµ”_loc
 ())[__c] : __c;

216 
	}
}

219 #ià
__GNUC__
 >ğ2 && 
defšed
 
__OPTIMIZE__
 && !defšed 
__ılu¥lus


220 
	#tŞow”
(
c
è
	`__tobody
 (c, 
tŞow”
, *
	`__ùy³_tŞow”_loc
 (), (c))

	)

221 
	#touµ”
(
c
è
	`__tobody
 (c, 
touµ”
, *
	`__ùy³_touµ”_loc
 (), (c))

	)

224 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_XOPEN


225 
	#i§scii
(
c
è
	`__i§scii
 (c)

	)

226 
	#tßscii
(
c
è
	`__tßscii
 (c)

	)

228 
	#_tŞow”
(
c
è((è(*
	`__ùy³_tŞow”_loc
 ())[(è(c)])

	)

229 
	#_touµ”
(
c
è((è(*
	`__ùy³_touµ”_loc
 ())[(è(c)])

	)

235 #ifdeà
__USE_XOPEN2K8


237 
	~<b™s/ty³s/loÿË_t.h
>

241 
	#__isùy³_l
(
c
, 
ty³
, 
loÿË
) \

242 ((
loÿË
)->
__ùy³_b
[(è(
c
)] & (è
ty³
)

	)

244 
	#__exùy³_l
(
Çme
) \

245 
	`Çme
 (, 
loÿË_t
è
__THROW


	)

251 
__exùy³_l
 (
i§Êum_l
);

252 
__exùy³_l
 (
i§Íha_l
);

253 
__exùy³_l
 (
isúŒl_l
);

254 
__exùy³_l
 (
isdig™_l
);

255 
__exùy³_l
 (
i¦ow”_l
);

256 
__exùy³_l
 (
isg¿ph_l
);

257 
__exùy³_l
 (
i¥ršt_l
);

258 
__exùy³_l
 (
i¥unù_l
);

259 
__exùy³_l
 (
is¥aû_l
);

260 
__exùy³_l
 (
isuµ”_l
);

261 
__exùy³_l
 (
isxdig™_l
);

263 
__exùy³_l
 (
isbÏnk_l
);

267 
	$__tŞow”_l
 (
__c
, 
loÿË_t
 
__l
è
__THROW
;

268 
	$tŞow”_l
 (
__c
, 
loÿË_t
 
__l
è
__THROW
;

271 
	$__touµ”_l
 (
__c
, 
loÿË_t
 
__l
è
__THROW
;

272 
	$touµ”_l
 (
__c
, 
loÿË_t
 
__l
è
__THROW
;

274 #ià
__GNUC__
 >ğ2 && 
defšed
 
__OPTIMIZE__
 && !defšed 
__ılu¥lus


275 
	#__tŞow”_l
(
c
, 
loÿË
) \

276 
	`__tobody
 (
c
, 
__tŞow”_l
, (
loÿË
)->
__ùy³_tŞow”
, (c,†oÿË))

	)

277 
	#__touµ”_l
(
c
, 
loÿË
) \

278 
	`__tobody
 (
c
, 
__touµ”_l
, (
loÿË
)->
__ùy³_touµ”
, (c,†oÿË))

	)

279 
	#tŞow”_l
(
c
, 
loÿË
è
	`__tŞow”_l
 ((c), (loÿË))

	)

280 
	#touµ”_l
(
c
, 
loÿË
è
	`__touµ”_l
 ((c), (loÿË))

	)

284 #iâdeà
__NO_CTYPE


285 
	#__i§Êum_l
(
c
,
l
è
	`__isùy³_l
((c), 
_IS®num
, (l))

	)

286 
	#__i§Íha_l
(
c
,
l
è
	`__isùy³_l
((c), 
_IS®pha
, (l))

	)

287 
	#__isúŒl_l
(
c
,
l
è
	`__isùy³_l
((c), 
_ISúŒl
, (l))

	)

288 
	#__isdig™_l
(
c
,
l
è
	`__isùy³_l
((c), 
_ISdig™
, (l))

	)

289 
	#__i¦ow”_l
(
c
,
l
è
	`__isùy³_l
((c), 
_ISlow”
, (l))

	)

290 
	#__isg¿ph_l
(
c
,
l
è
	`__isùy³_l
((c), 
_ISg¿ph
, (l))

	)

291 
	#__i¥ršt_l
(
c
,
l
è
	`__isùy³_l
((c), 
_IS´št
, (l))

	)

292 
	#__i¥unù_l
(
c
,
l
è
	`__isùy³_l
((c), 
_ISpunù
, (l))

	)

293 
	#__is¥aû_l
(
c
,
l
è
	`__isùy³_l
((c), 
_IS¥aû
, (l))

	)

294 
	#__isuµ”_l
(
c
,
l
è
	`__isùy³_l
((c), 
_ISuµ”
, (l))

	)

295 
	#__isxdig™_l
(
c
,
l
è
	`__isùy³_l
((c), 
_ISxdig™
, (l))

	)

297 
	#__isbÏnk_l
(
c
,
l
è
	`__isùy³_l
((c), 
_ISbÏnk
, (l))

	)

299 #ifdeà
__USE_MISC


300 
	#__i§scii_l
(
c
,
l
è(Ö), 
	`__i§scii
 (c))

	)

301 
	#__tßscii_l
(
c
,
l
è(Ö), 
	`__tßscii
 (c))

	)

304 
	#i§Êum_l
(
c
,
l
è
	`__i§Êum_l
 ((c), (l))

	)

305 
	#i§Íha_l
(
c
,
l
è
	`__i§Íha_l
 ((c), (l))

	)

306 
	#isúŒl_l
(
c
,
l
è
	`__isúŒl_l
 ((c), (l))

	)

307 
	#isdig™_l
(
c
,
l
è
	`__isdig™_l
 ((c), (l))

	)

308 
	#i¦ow”_l
(
c
,
l
è
	`__i¦ow”_l
 ((c), (l))

	)

309 
	#isg¿ph_l
(
c
,
l
è
	`__isg¿ph_l
 ((c), (l))

	)

310 
	#i¥ršt_l
(
c
,
l
è
	`__i¥ršt_l
 ((c), (l))

	)

311 
	#i¥unù_l
(
c
,
l
è
	`__i¥unù_l
 ((c), (l))

	)

312 
	#is¥aû_l
(
c
,
l
è
	`__is¥aû_l
 ((c), (l))

	)

313 
	#isuµ”_l
(
c
,
l
è
	`__isuµ”_l
 ((c), (l))

	)

314 
	#isxdig™_l
(
c
,
l
è
	`__isxdig™_l
 ((c), (l))

	)

316 
	#isbÏnk_l
(
c
,
l
è
	`__isbÏnk_l
 ((c), (l))

	)

318 #ifdeà
__USE_MISC


319 
	#i§scii_l
(
c
,
l
è
	`__i§scii_l
 ((c), (l))

	)

320 
	#tßscii_l
(
c
,
l
è
	`__tßscii_l
 ((c), (l))

	)

327 
__END_DECLS


	@/usr/include/dlfcn.h

19 #iâdef 
_DLFCN_H


20 
	#_DLFCN_H
 1

	)

22 
	~<ã©u»s.h
>

23 
	#__Ãed_size_t


	)

24 
	~<¡ddef.h
>

27 
	~<b™s/dlfú.h
>

30 #ifdeà
__USE_GNU


35 
	#RTLD_NEXT
 ((*è-1l)

	)

40 
	#RTLD_DEFAULT
 ((*è0)

	)

44 
	tLmid_t
;

47 
	#LM_ID_BASE
 0

	)

48 
	#LM_ID_NEWLM
 -1

	)

52 
__BEGIN_DECLS


56 *
	$dlİ’
 (cÚ¡ *
__fe
, 
__mode
è
__THROWNL
;

60 
	$dlşo£
 (*
__hªdË
è
__THROWNL
 
	`__nÚnuÎ
 ((1));

64 *
	$dlsym
 (*
__»¡riù
 
__hªdË
,

65 cÚ¡ *
__»¡riù
 
__Çme
è
__THROW
 
	`__nÚnuÎ
 ((2));

67 #ifdeà
__USE_GNU


69 *
	$dlmİ’
 (
Lmid_t
 
__nsid
, cÚ¡ *
__fe
, 
__mode
è
__THROWNL
;

73 *
	$dlvsym
 (*
__»¡riù
 
__hªdË
,

74 cÚ¡ *
__»¡riù
 
__Çme
,

75 cÚ¡ *
__»¡riù
 
__v”siÚ
)

76 
__THROW
 
	`__nÚnuÎ
 ((2, 3));

82 *
	$dË¼Ü
 (è
__THROW
;

85 #ifdeà
__USE_GNU


90 cÚ¡ *
dli_âame
;

91 *
dli_fba£
;

92 cÚ¡ *
dli_¢ame
;

93 *
dli_§ddr
;

94 } 
	tDl_šfo
;

98 
	$dÏddr
 (cÚ¡ *
__add»ss
, 
Dl_šfo
 *
__šfo
)

99 
__THROW
 
	`__nÚnuÎ
 ((2));

102 
	$dÏddr1
 (cÚ¡ *
__add»ss
, 
Dl_šfo
 *
__šfo
,

103 **
__exŒa_šfo
, 
__æags
è
__THROW
 
	`__nÚnuÎ
 ((2));

111 
RTLD_DL_SYMENT
 = 1,

114 
RTLD_DL_LINKMAP
 = 2

123 
	$dlšfo
 (*
__»¡riù
 
__hªdË
,

124 
__»que¡
, *
__»¡riù
 
__¬g
)

125 
__THROW
 
	`__nÚnuÎ
 ((1, 3));

131 
RTLD_DI_LMID
 = 1,

135 
RTLD_DI_LINKMAP
 = 2,

137 
RTLD_DI_CONFIGADDR
 = 3,

144 
RTLD_DI_SERINFO
 = 4,

145 
RTLD_DI_SERINFOSIZE
 = 5,

149 
RTLD_DI_ORIGIN
 = 6,

151 
RTLD_DI_PROFILENAME
 = 7,

152 
RTLD_DI_PROFILEOUT
 = 8,

157 
RTLD_DI_TLS_MODID
 = 9,

163 
RTLD_DI_TLS_DATA
 = 10,

165 
RTLD_DI_MAX
 = 10

173 *
dls_Çme
;

174 
dls_æags
;

175 } 
	tDl_£½©h
;

181 
size_t
 
dls_size
;

182 
dls_út
;

183 
Dl_£½©h
 
dls_£½©h
[1];

184 } 
	tDl_£ršfo
;

188 
__END_DECLS


	@/usr/include/errno.h

22 #iâdef 
_ERRNO_H


23 
	#_ERRNO_H
 1

	)

25 
	~<ã©u»s.h
>

28 
	~<b™s/”ºo.h
>

32 #iâdeà
__ASSEMBLER__


34 
__BEGIN_DECLS


37 *
	$__”ºo_loÿtiÚ
 (è
__THROW
 
__©Œibu‹_cÚ¡__
;

38 
	#”ºo
 (*
	`__”ºo_loÿtiÚ
 ())

	)

40 #ifdeà
__USE_GNU


45 *
´og¿m_švoÿtiÚ_Çme
;

46 *
´og¿m_švoÿtiÚ_shÜt_Çme
;

50 #iâdeà
__”rÜ_t_defšed


51 
	#__”rÜ_t_defšed
 1

	)

52 
	t”rÜ_t
;

57 
__END_DECLS


	@/usr/include/fcntl.h

22 #iâdef 
_FCNTL_H


23 
	#_FCNTL_H
 1

	)

25 
	~<ã©u»s.h
>

28 
	g__BEGIN_DECLS


31 
	~<b™s/ty³s.h
>

35 
	~<b™s/fú.h
>

39 #ifdeà
__O_TMPFILE


40 
	#__OPEN_NEEDS_MODE
(
oæag
) \

41 (((
oæag
è& 
O_CREAT
è!ğ0 || ((oæagè& 
__O_TMPFILE
è=ğ__O_TMPFILE)

	)

43 
	#__OPEN_NEEDS_MODE
(
oæag
è(((oæagè& 
O_CREAT
è!ğ0)

	)

49 #iâdeà
__mode_t_defšed


50 
__mode_t
 
	tmode_t
;

51 
	#__mode_t_defšed


	)

54 #iâdeà
__off_t_defšed


55 #iâdeà
__USE_FILE_OFFSET64


56 
__off_t
 
	toff_t
;

58 
__off64_t
 
	toff_t
;

60 
	#__off_t_defšed


	)

63 #ià
defšed
 
__USE_LARGEFILE64
 && !defšed 
__off64_t_defšed


64 
__off64_t
 
	toff64_t
;

65 
	#__off64_t_defšed


	)

68 #iâdeà
__pid_t_defšed


69 
__pid_t
 
	tpid_t
;

70 
	#__pid_t_defšed


	)

74 #ifdeà
__USE_XOPEN2K8


75 
	~<b™s/ty³s/¡ruù_time¥ec.h
>

77 #ià
defšed
 
__USE_XOPEN
 || defšed 
__USE_XOPEN2K8


78 
	~<b™s/¡©.h
>

80 
	#S_IFMT
 
__S_IFMT


	)

81 
	#S_IFDIR
 
__S_IFDIR


	)

82 
	#S_IFCHR
 
__S_IFCHR


	)

83 
	#S_IFBLK
 
__S_IFBLK


	)

84 
	#S_IFREG
 
__S_IFREG


	)

85 #ifdeà
__S_IFIFO


86 
	#S_IFIFO
 
__S_IFIFO


	)

88 #ifdeà
__S_IFLNK


89 
	#S_IFLNK
 
__S_IFLNK


	)

91 #ià(
defšed
 
__USE_UNIX98
 || defšed 
__USE_XOPEN2K8
è&& defšed 
__S_IFSOCK


92 
	#S_IFSOCK
 
__S_IFSOCK


	)

97 
	#S_ISUID
 
__S_ISUID


	)

98 
	#S_ISGID
 
__S_ISGID


	)

100 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_XOPEN


102 
	#S_ISVTX
 
__S_ISVTX


	)

105 
	#S_IRUSR
 
__S_IREAD


	)

106 
	#S_IWUSR
 
__S_IWRITE


	)

107 
	#S_IXUSR
 
__S_IEXEC


	)

109 
	#S_IRWXU
 (
__S_IREAD
|
__S_IWRITE
|
__S_IEXEC
)

	)

111 
	#S_IRGRP
 (
S_IRUSR
 >> 3è

	)

112 
	#S_IWGRP
 (
S_IWUSR
 >> 3è

	)

113 
	#S_IXGRP
 (
S_IXUSR
 >> 3è

	)

115 
	#S_IRWXG
 (
S_IRWXU
 >> 3)

	)

117 
	#S_IROTH
 (
S_IRGRP
 >> 3è

	)

118 
	#S_IWOTH
 (
S_IWGRP
 >> 3è

	)

119 
	#S_IXOTH
 (
S_IXGRP
 >> 3è

	)

121 
	#S_IRWXO
 (
S_IRWXG
 >> 3)

	)

124 #ifdef 
__USE_MISC


125 #iâdeà
R_OK


128 
	#R_OK
 4

	)

129 
	#W_OK
 2

	)

130 
	#X_OK
 1

	)

131 
	#F_OK
 0

	)

136 #ià
defšed
 
__USE_XOPEN
 || defšed 
__USE_XOPEN2K8


137 
	#SEEK_SET
 0

	)

138 
	#SEEK_CUR
 1

	)

139 
	#SEEK_END
 2

	)

147 
fú
 (
__fd
, 
__cmd
, ...);

156 #iâdeà
__USE_FILE_OFFSET64


157 
	$İ’
 (cÚ¡ *
__fe
, 
__oæag
, ...è
	`__nÚnuÎ
 ((1));

159 #ifdeà
__REDIRECT


160 
	`__REDIRECT
 (
İ’
, (cÚ¡ *
__fe
, 
__oæag
, ...), 
İ’64
)

161 
	`__nÚnuÎ
 ((1));

163 
	#İ’
 
İ’64


	)

166 #ifdeà
__USE_LARGEFILE64


167 
	$İ’64
 (cÚ¡ *
__fe
, 
__oæag
, ...è
	`__nÚnuÎ
 ((1));

170 #ifdeà
__USE_ATFILE


180 #iâdeà
__USE_FILE_OFFSET64


181 
	$İ’©
 (
__fd
, cÚ¡ *
__fe
, 
__oæag
, ...)

182 
	`__nÚnuÎ
 ((2));

184 #ifdeà
__REDIRECT


185 
	`__REDIRECT
 (
İ’©
, (
__fd
, cÚ¡ *
__fe
, 
__oæag
,

186 ...), 
İ’©64
è
	`__nÚnuÎ
 ((2));

188 
	#İ’©
 
İ’©64


	)

191 #ifdeà
__USE_LARGEFILE64


192 
	$İ’©64
 (
__fd
, cÚ¡ *
__fe
, 
__oæag
, ...)

193 
	`__nÚnuÎ
 ((2));

202 #iâdeà
__USE_FILE_OFFSET64


203 
	$ü—t
 (cÚ¡ *
__fe
, 
mode_t
 
__mode
è
	`__nÚnuÎ
 ((1));

205 #ifdeà
__REDIRECT


206 
	`__REDIRECT
 (
ü—t
, (cÚ¡ *
__fe
, 
mode_t
 
__mode
),

207 
ü—t64
è
	`__nÚnuÎ
 ((1));

209 
	#ü—t
 
ü—t64


	)

212 #ifdeà
__USE_LARGEFILE64


213 
	$ü—t64
 (cÚ¡ *
__fe
, 
mode_t
 
__mode
è
	`__nÚnuÎ
 ((1));

216 #ià!
defšed
 
F_LOCK
 && (defšed 
__USE_MISC
 || (defšed 
__USE_XOPEN_EXTENDED
 \

217 && !
defšed
 
__USE_POSIX
))

226 
	#F_ULOCK
 0

	)

227 
	#F_LOCK
 1

	)

228 
	#F_TLOCK
 2

	)

229 
	#F_TEST
 3

	)

231 #iâdeà
__USE_FILE_OFFSET64


232 
	`lockf
 (
__fd
, 
__cmd
, 
off_t
 
__Ën
);

234 #ifdeà
__REDIRECT


235 
	`__REDIRECT
 (
lockf
, (
__fd
, 
__cmd
, 
__off64_t
 
__Ën
), 
lockf64
);

237 
	#lockf
 
lockf64


	)

240 #ifdeà
__USE_LARGEFILE64


241 
	`lockf64
 (
__fd
, 
__cmd
, 
off64_t
 
__Ën
);

245 #ifdeà
__USE_XOPEN2K


248 #iâdeà
__USE_FILE_OFFSET64


249 
	$posix_çdvi£
 (
__fd
, 
off_t
 
__off£t
, off_ˆ
__Ën
,

250 
__advi£
è
__THROW
;

252 #ifdeà
__REDIRECT_NTH


253 
	`__REDIRECT_NTH
 (
posix_çdvi£
, (
__fd
, 
__off64_t
 
__off£t
,

254 
__off64_t
 
__Ën
, 
__advi£
),

255 
posix_çdvi£64
);

257 
	#posix_çdvi£
 
posix_çdvi£64


	)

260 #ifdeà
__USE_LARGEFILE64


261 
	$posix_çdvi£64
 (
__fd
, 
off64_t
 
__off£t
, off64_ˆ
__Ën
,

262 
__advi£
è
__THROW
;

270 #iâdeà
__USE_FILE_OFFSET64


271 
	`posix_çÎoÿ‹
 (
__fd
, 
off_t
 
__off£t
, off_ˆ
__Ën
);

273 #ifdeà
__REDIRECT


274 
	`__REDIRECT
 (
posix_çÎoÿ‹
, (
__fd
, 
__off64_t
 
__off£t
,

275 
__off64_t
 
__Ën
),

276 
posix_çÎoÿ‹64
);

278 
	#posix_çÎoÿ‹
 
posix_çÎoÿ‹64


	)

281 #ifdeà
__USE_LARGEFILE64


282 
	`posix_çÎoÿ‹64
 (
__fd
, 
off64_t
 
__off£t
, off64_ˆ
__Ën
);

288 #ià
__USE_FORTIFY_LEVEL
 > 0 && 
defšed
 
__fÜtify_funùiÚ
 \

289 && 
defšed
 
__va_¬g_·ck_Ën


290 
	~<b™s/fú2.h
>

293 
__END_DECLS


	@/usr/include/inttypes.h

22 #iâdeà
_INTTYPES_H


23 
	#_INTTYPES_H
 1

	)

25 
	~<ã©u»s.h
>

27 
	~<¡dšt.h
>

30 #iâdeà
____gwch¬_t_defšed


31 #ifdeà
__ılu¥lus


32 
	#__gwch¬_t
 
wch¬_t


	)

33 #–ià
defšed
 
__WCHAR_TYPE__


34 
__WCHAR_TYPE__
 
	t__gwch¬_t
;

36 
	#__Ãed_wch¬_t


	)

37 
	~<¡ddef.h
>

38 
wch¬_t
 
	t__gwch¬_t
;

40 
	#____gwch¬_t_defšed
 1

	)

43 #ià
__WORDSIZE
 == 64

44 
	#__PRI64_PREFIX
 "l"

	)

45 
	#__PRIPTR_PREFIX
 "l"

	)

47 
	#__PRI64_PREFIX
 "Î"

	)

48 
	#__PRIPTR_PREFIX


	)

54 
	#PRId8
 "d"

	)

55 
	#PRId16
 "d"

	)

56 
	#PRId32
 "d"

	)

57 
	#PRId64
 
__PRI64_PREFIX
 "d"

	)

59 
	#PRIdLEAST8
 "d"

	)

60 
	#PRIdLEAST16
 "d"

	)

61 
	#PRIdLEAST32
 "d"

	)

62 
	#PRIdLEAST64
 
__PRI64_PREFIX
 "d"

	)

64 
	#PRIdFAST8
 "d"

	)

65 
	#PRIdFAST16
 
__PRIPTR_PREFIX
 "d"

	)

66 
	#PRIdFAST32
 
__PRIPTR_PREFIX
 "d"

	)

67 
	#PRIdFAST64
 
__PRI64_PREFIX
 "d"

	)

70 
	#PRIi8
 "i"

	)

71 
	#PRIi16
 "i"

	)

72 
	#PRIi32
 "i"

	)

73 
	#PRIi64
 
__PRI64_PREFIX
 "i"

	)

75 
	#PRIiLEAST8
 "i"

	)

76 
	#PRIiLEAST16
 "i"

	)

77 
	#PRIiLEAST32
 "i"

	)

78 
	#PRIiLEAST64
 
__PRI64_PREFIX
 "i"

	)

80 
	#PRIiFAST8
 "i"

	)

81 
	#PRIiFAST16
 
__PRIPTR_PREFIX
 "i"

	)

82 
	#PRIiFAST32
 
__PRIPTR_PREFIX
 "i"

	)

83 
	#PRIiFAST64
 
__PRI64_PREFIX
 "i"

	)

86 
	#PRIo8
 "o"

	)

87 
	#PRIo16
 "o"

	)

88 
	#PRIo32
 "o"

	)

89 
	#PRIo64
 
__PRI64_PREFIX
 "o"

	)

91 
	#PRIoLEAST8
 "o"

	)

92 
	#PRIoLEAST16
 "o"

	)

93 
	#PRIoLEAST32
 "o"

	)

94 
	#PRIoLEAST64
 
__PRI64_PREFIX
 "o"

	)

96 
	#PRIoFAST8
 "o"

	)

97 
	#PRIoFAST16
 
__PRIPTR_PREFIX
 "o"

	)

98 
	#PRIoFAST32
 
__PRIPTR_PREFIX
 "o"

	)

99 
	#PRIoFAST64
 
__PRI64_PREFIX
 "o"

	)

102 
	#PRIu8
 "u"

	)

103 
	#PRIu16
 "u"

	)

104 
	#PRIu32
 "u"

	)

105 
	#PRIu64
 
__PRI64_PREFIX
 "u"

	)

107 
	#PRIuLEAST8
 "u"

	)

108 
	#PRIuLEAST16
 "u"

	)

109 
	#PRIuLEAST32
 "u"

	)

110 
	#PRIuLEAST64
 
__PRI64_PREFIX
 "u"

	)

112 
	#PRIuFAST8
 "u"

	)

113 
	#PRIuFAST16
 
__PRIPTR_PREFIX
 "u"

	)

114 
	#PRIuFAST32
 
__PRIPTR_PREFIX
 "u"

	)

115 
	#PRIuFAST64
 
__PRI64_PREFIX
 "u"

	)

118 
	#PRIx8
 "x"

	)

119 
	#PRIx16
 "x"

	)

120 
	#PRIx32
 "x"

	)

121 
	#PRIx64
 
__PRI64_PREFIX
 "x"

	)

123 
	#PRIxLEAST8
 "x"

	)

124 
	#PRIxLEAST16
 "x"

	)

125 
	#PRIxLEAST32
 "x"

	)

126 
	#PRIxLEAST64
 
__PRI64_PREFIX
 "x"

	)

128 
	#PRIxFAST8
 "x"

	)

129 
	#PRIxFAST16
 
__PRIPTR_PREFIX
 "x"

	)

130 
	#PRIxFAST32
 
__PRIPTR_PREFIX
 "x"

	)

131 
	#PRIxFAST64
 
__PRI64_PREFIX
 "x"

	)

134 
	#PRIX8
 "X"

	)

135 
	#PRIX16
 "X"

	)

136 
	#PRIX32
 "X"

	)

137 
	#PRIX64
 
__PRI64_PREFIX
 "X"

	)

139 
	#PRIXLEAST8
 "X"

	)

140 
	#PRIXLEAST16
 "X"

	)

141 
	#PRIXLEAST32
 "X"

	)

142 
	#PRIXLEAST64
 
__PRI64_PREFIX
 "X"

	)

144 
	#PRIXFAST8
 "X"

	)

145 
	#PRIXFAST16
 
__PRIPTR_PREFIX
 "X"

	)

146 
	#PRIXFAST32
 
__PRIPTR_PREFIX
 "X"

	)

147 
	#PRIXFAST64
 
__PRI64_PREFIX
 "X"

	)

151 
	#PRIdMAX
 
__PRI64_PREFIX
 "d"

	)

152 
	#PRIiMAX
 
__PRI64_PREFIX
 "i"

	)

153 
	#PRIoMAX
 
__PRI64_PREFIX
 "o"

	)

154 
	#PRIuMAX
 
__PRI64_PREFIX
 "u"

	)

155 
	#PRIxMAX
 
__PRI64_PREFIX
 "x"

	)

156 
	#PRIXMAX
 
__PRI64_PREFIX
 "X"

	)

160 
	#PRIdPTR
 
__PRIPTR_PREFIX
 "d"

	)

161 
	#PRIiPTR
 
__PRIPTR_PREFIX
 "i"

	)

162 
	#PRIoPTR
 
__PRIPTR_PREFIX
 "o"

	)

163 
	#PRIuPTR
 
__PRIPTR_PREFIX
 "u"

	)

164 
	#PRIxPTR
 
__PRIPTR_PREFIX
 "x"

	)

165 
	#PRIXPTR
 
__PRIPTR_PREFIX
 "X"

	)

171 
	#SCNd8
 "hhd"

	)

172 
	#SCNd16
 "hd"

	)

173 
	#SCNd32
 "d"

	)

174 
	#SCNd64
 
__PRI64_PREFIX
 "d"

	)

176 
	#SCNdLEAST8
 "hhd"

	)

177 
	#SCNdLEAST16
 "hd"

	)

178 
	#SCNdLEAST32
 "d"

	)

179 
	#SCNdLEAST64
 
__PRI64_PREFIX
 "d"

	)

181 
	#SCNdFAST8
 "hhd"

	)

182 
	#SCNdFAST16
 
__PRIPTR_PREFIX
 "d"

	)

183 
	#SCNdFAST32
 
__PRIPTR_PREFIX
 "d"

	)

184 
	#SCNdFAST64
 
__PRI64_PREFIX
 "d"

	)

187 
	#SCNi8
 "hhi"

	)

188 
	#SCNi16
 "hi"

	)

189 
	#SCNi32
 "i"

	)

190 
	#SCNi64
 
__PRI64_PREFIX
 "i"

	)

192 
	#SCNiLEAST8
 "hhi"

	)

193 
	#SCNiLEAST16
 "hi"

	)

194 
	#SCNiLEAST32
 "i"

	)

195 
	#SCNiLEAST64
 
__PRI64_PREFIX
 "i"

	)

197 
	#SCNiFAST8
 "hhi"

	)

198 
	#SCNiFAST16
 
__PRIPTR_PREFIX
 "i"

	)

199 
	#SCNiFAST32
 
__PRIPTR_PREFIX
 "i"

	)

200 
	#SCNiFAST64
 
__PRI64_PREFIX
 "i"

	)

203 
	#SCNu8
 "hhu"

	)

204 
	#SCNu16
 "hu"

	)

205 
	#SCNu32
 "u"

	)

206 
	#SCNu64
 
__PRI64_PREFIX
 "u"

	)

208 
	#SCNuLEAST8
 "hhu"

	)

209 
	#SCNuLEAST16
 "hu"

	)

210 
	#SCNuLEAST32
 "u"

	)

211 
	#SCNuLEAST64
 
__PRI64_PREFIX
 "u"

	)

213 
	#SCNuFAST8
 "hhu"

	)

214 
	#SCNuFAST16
 
__PRIPTR_PREFIX
 "u"

	)

215 
	#SCNuFAST32
 
__PRIPTR_PREFIX
 "u"

	)

216 
	#SCNuFAST64
 
__PRI64_PREFIX
 "u"

	)

219 
	#SCNo8
 "hho"

	)

220 
	#SCNo16
 "ho"

	)

221 
	#SCNo32
 "o"

	)

222 
	#SCNo64
 
__PRI64_PREFIX
 "o"

	)

224 
	#SCNoLEAST8
 "hho"

	)

225 
	#SCNoLEAST16
 "ho"

	)

226 
	#SCNoLEAST32
 "o"

	)

227 
	#SCNoLEAST64
 
__PRI64_PREFIX
 "o"

	)

229 
	#SCNoFAST8
 "hho"

	)

230 
	#SCNoFAST16
 
__PRIPTR_PREFIX
 "o"

	)

231 
	#SCNoFAST32
 
__PRIPTR_PREFIX
 "o"

	)

232 
	#SCNoFAST64
 
__PRI64_PREFIX
 "o"

	)

235 
	#SCNx8
 "hhx"

	)

236 
	#SCNx16
 "hx"

	)

237 
	#SCNx32
 "x"

	)

238 
	#SCNx64
 
__PRI64_PREFIX
 "x"

	)

240 
	#SCNxLEAST8
 "hhx"

	)

241 
	#SCNxLEAST16
 "hx"

	)

242 
	#SCNxLEAST32
 "x"

	)

243 
	#SCNxLEAST64
 
__PRI64_PREFIX
 "x"

	)

245 
	#SCNxFAST8
 "hhx"

	)

246 
	#SCNxFAST16
 
__PRIPTR_PREFIX
 "x"

	)

247 
	#SCNxFAST32
 
__PRIPTR_PREFIX
 "x"

	)

248 
	#SCNxFAST64
 
__PRI64_PREFIX
 "x"

	)

252 
	#SCNdMAX
 
__PRI64_PREFIX
 "d"

	)

253 
	#SCNiMAX
 
__PRI64_PREFIX
 "i"

	)

254 
	#SCNoMAX
 
__PRI64_PREFIX
 "o"

	)

255 
	#SCNuMAX
 
__PRI64_PREFIX
 "u"

	)

256 
	#SCNxMAX
 
__PRI64_PREFIX
 "x"

	)

259 
	#SCNdPTR
 
__PRIPTR_PREFIX
 "d"

	)

260 
	#SCNiPTR
 
__PRIPTR_PREFIX
 "i"

	)

261 
	#SCNoPTR
 
__PRIPTR_PREFIX
 "o"

	)

262 
	#SCNuPTR
 
__PRIPTR_PREFIX
 "u"

	)

263 
	#SCNxPTR
 
__PRIPTR_PREFIX
 "x"

	)

266 
	g__BEGIN_DECLS


268 #ià
__WORDSIZE
 == 64

273 
	mquÙ
;

274 
	m»m
;

275 } 
	timaxdiv_t
;

282 
__ex‹nsiÚ__
 
	mquÙ
;

283 
__ex‹nsiÚ__
 
	m»m
;

284 } 
	timaxdiv_t
;

290 
štmax_t
 
	$imaxabs
 (
štmax_t
 
__n
è
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
));

293 
imaxdiv_t
 
	$imaxdiv
 (
štmax_t
 
__num”
, iÁmax_ˆ
__d’om
)

294 
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
));

297 
štmax_t
 
	$¡¹oimax
 (cÚ¡ *
__»¡riù
 
__ÅŒ
,

298 **
__»¡riù
 
__’d±r
, 
__ba£
è
__THROW
;

301 
uštmax_t
 
	$¡¹oumax
 (cÚ¡ *
__»¡riù
 
__ÅŒ
,

302 ** 
__»¡riù
 
__’d±r
, 
__ba£
è
__THROW
;

305 
štmax_t
 
	$wc¡oimax
 (cÚ¡ 
__gwch¬_t
 *
__»¡riù
 
__ÅŒ
,

306 
__gwch¬_t
 **
__»¡riù
 
__’d±r
, 
__ba£
)

307 
__THROW
;

310 
uštmax_t
 
	$wc¡oumax
 (cÚ¡ 
__gwch¬_t
 *
__»¡riù
 
__ÅŒ
,

311 
__gwch¬_t
 ** 
__»¡riù
 
__’d±r
, 
__ba£
)

312 
__THROW
;

314 #ifdeà
__USE_EXTERN_INLINES


316 #ià
__WORDSIZE
 == 64

318 
	$__¡¹Ş_š‹º®
 (cÚ¡ *
__»¡riù
 
__ÅŒ
,

319 **
__»¡riù
 
__’d±r
,

320 
__ba£
, 
__group
)

321 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

323 
__ex‹º_šlše
 
štmax_t


324 
	`__NTH
 (
	$¡¹oimax
 (cÚ¡ *
__»¡riù
 
ÅŒ
, **__»¡riù 
’d±r
,

325 
ba£
))

327  
	`__¡¹Ş_š‹º®
 (
ÅŒ
, 
’d±r
, 
ba£
, 0);

328 
	}
}

330 
	$__¡¹oul_š‹º®
 (cÚ¡ *
__»¡riù
 
__ÅŒ
,

331 ** 
__»¡riù
 
__’d±r
,

332 
__ba£
, 
__group
)

333 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

335 
__ex‹º_šlše
 
uštmax_t


336 
	`__NTH
 (
	$¡¹oumax
 (cÚ¡ *
__»¡riù
 
ÅŒ
, **__»¡riù 
’d±r
,

337 
ba£
))

339  
	`__¡¹oul_š‹º®
 (
ÅŒ
, 
’d±r
, 
ba£
, 0);

340 
	}
}

342 
	$__wc¡Ş_š‹º®
 (cÚ¡ 
__gwch¬_t
 * 
__»¡riù
 
__ÅŒ
,

343 
__gwch¬_t
 **
__»¡riù
 
__’d±r
,

344 
__ba£
, 
__group
)

345 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

347 
__ex‹º_šlše
 
štmax_t


348 
	`__NTH
 (
	$wc¡oimax
 (cÚ¡ 
__gwch¬_t
 *
__»¡riù
 
ÅŒ
,

349 
__gwch¬_t
 **
__»¡riù
 
’d±r
, 
ba£
))

351  
	`__wc¡Ş_š‹º®
 (
ÅŒ
, 
’d±r
, 
ba£
, 0);

352 
	}
}

354 
	$__wc¡oul_š‹º®
 (cÚ¡ 
__gwch¬_t
 *

355 
__»¡riù
 
__ÅŒ
,

356 
__gwch¬_t
 **

357 
__»¡riù
 
__’d±r
,

358 
__ba£
, 
__group
)

359 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

361 
__ex‹º_šlše
 
uštmax_t


362 
	`__NTH
 (
	$wc¡oumax
 (cÚ¡ 
__gwch¬_t
 *
__»¡riù
 
ÅŒ
,

363 
__gwch¬_t
 **
__»¡riù
 
’d±r
, 
ba£
))

365  
	`__wc¡oul_š‹º®
 (
ÅŒ
, 
’d±r
, 
ba£
, 0);

366 
	}
}

370 
__ex‹nsiÚ__


371 
	$__¡¹Şl_š‹º®
 (cÚ¡ *
__»¡riù
 
__ÅŒ
,

372 **
__»¡riù
 
__’d±r
,

373 
__ba£
, 
__group
)

374 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

376 
__ex‹º_šlše
 
štmax_t


377 
	`__NTH
 (
	$¡¹oimax
 (cÚ¡ *
__»¡riù
 
ÅŒ
, **__»¡riù 
’d±r
,

378 
ba£
))

380  
	`__¡¹Şl_š‹º®
 (
ÅŒ
, 
’d±r
, 
ba£
, 0);

381 
	}
}

383 
__ex‹nsiÚ__


384 
	$__¡¹ouÎ_š‹º®
 (const *

385 
__»¡riù
 
__ÅŒ
,

387 
__»¡riù
 
__’d±r
,

388 
__ba£
,

389 
__group
)

390 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

392 
__ex‹º_šlše
 
uštmax_t


393 
	`__NTH
 (
	$¡¹oumax
 (cÚ¡ *
__»¡riù
 
ÅŒ
, **__»¡riù 
’d±r
,

394 
ba£
))

396  
	`__¡¹ouÎ_š‹º®
 (
ÅŒ
, 
’d±r
, 
ba£
, 0);

397 
	}
}

399 
__ex‹nsiÚ__


400 
	$__wc¡Şl_š‹º®
 (cÚ¡ 
__gwch¬_t
 *
__»¡riù
 
__ÅŒ
,

401 
__gwch¬_t
 **
__»¡riù
 
__’d±r
,

402 
__ba£
, 
__group
)

403 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

405 
__ex‹º_šlše
 
štmax_t


406 
	`__NTH
 (
	$wc¡oimax
 (cÚ¡ 
__gwch¬_t
 *
__»¡riù
 
ÅŒ
,

407 
__gwch¬_t
 **
__»¡riù
 
’d±r
, 
ba£
))

409  
	`__wc¡Şl_š‹º®
 (
ÅŒ
, 
’d±r
, 
ba£
, 0);

410 
	}
}

413 
__ex‹nsiÚ__


414 
	$__wc¡ouÎ_š‹º®
 (cÚ¡ 
__gwch¬_t
 *

415 
__»¡riù
 
__ÅŒ
,

416 
__gwch¬_t
 **

417 
__»¡riù
 
__’d±r
,

418 
__ba£
,

419 
__group
)

420 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

422 
__ex‹º_šlše
 
uštmax_t


423 
	`__NTH
 (
	$wc¡oumax
 (cÚ¡ 
__gwch¬_t
 *
__»¡riù
 
ÅŒ
,

424 
__gwch¬_t
 **
__»¡riù
 
’d±r
, 
ba£
))

426  
	`__wc¡ouÎ_š‹º®
 (
ÅŒ
, 
’d±r
, 
ba£
, 0);

427 
	}
}

432 
	g__END_DECLS


	@/usr/include/linux/parport.h

7 #iâdeà
_PARPORT_H_


8 
	#_PARPORT_H_


	)

13 
	#PARPORT_MAX
 16

	)

16 
	#PARPORT_IRQ_NONE
 -1

	)

17 
	#PARPORT_DMA_NONE
 -1

	)

18 
	#PARPORT_IRQ_AUTO
 -2

	)

19 
	#PARPORT_DMA_AUTO
 -2

	)

20 
	#PARPORT_DMA_NOFIFO
 -3

	)

21 
	#PARPORT_DISABLE
 -2

	)

22 
	#PARPORT_IRQ_PROBEONLY
 -3

	)

23 
	#PARPORT_IOHI_AUTO
 -1

	)

25 
	#PARPORT_CONTROL_STROBE
 0x1

	)

26 
	#PARPORT_CONTROL_AUTOFD
 0x2

	)

27 
	#PARPORT_CONTROL_INIT
 0x4

	)

28 
	#PARPORT_CONTROL_SELECT
 0x8

	)

30 
	#PARPORT_STATUS_ERROR
 0x8

	)

31 
	#PARPORT_STATUS_SELECT
 0x10

	)

32 
	#PARPORT_STATUS_PAPEROUT
 0x20

	)

33 
	#PARPORT_STATUS_ACK
 0x40

	)

34 
	#PARPORT_STATUS_BUSY
 0x80

	)

38 
	mPARPORT_CLASS_LEGACY
 = 0,

39 
	mPARPORT_CLASS_PRINTER
,

40 
	mPARPORT_CLASS_MODEM
,

41 
	mPARPORT_CLASS_NET
,

42 
	mPARPORT_CLASS_HDC
,

43 
	mPARPORT_CLASS_PCMCIA
,

44 
	mPARPORT_CLASS_MEDIA
,

45 
	mPARPORT_CLASS_FDC
,

46 
	mPARPORT_CLASS_PORTS
,

47 
	mPARPORT_CLASS_SCANNER
,

48 
	mPARPORT_CLASS_DIGCAM
,

49 
	mPARPORT_CLASS_OTHER
,

50 
	mPARPORT_CLASS_UNSPEC
,

51 
	mPARPORT_CLASS_SCSIADAPTER


52 } 
	t·½Üt_deviû_şass
;

56 
	#PARPORT_MODE_PCSPP
 (1<<0è

	)

57 
	#PARPORT_MODE_TRISTATE
 (1<<1è

	)

58 
	#PARPORT_MODE_EPP
 (1<<2è

	)

59 
	#PARPORT_MODE_ECP
 (1<<3è

	)

60 
	#PARPORT_MODE_COMPAT
 (1<<4è

	)

61 
	#PARPORT_MODE_DMA
 (1<<5è

	)

62 
	#PARPORT_MODE_SAFEININT
 (1<<6è

	)

68 
	#IEEE1284_MODE_NIBBLE
 0

	)

69 
	#IEEE1284_MODE_BYTE
 (1<<0)

	)

70 
	#IEEE1284_MODE_COMPAT
 (1<<8)

	)

71 
	#IEEE1284_MODE_BECP
 (1<<9è

	)

72 
	#IEEE1284_MODE_ECP
 (1<<4)

	)

73 
	#IEEE1284_MODE_ECPRLE
 (
IEEE1284_MODE_ECP
 | (1<<5))

	)

74 
	#IEEE1284_MODE_ECPSWE
 (1<<10è

	)

75 
	#IEEE1284_MODE_EPP
 (1<<6)

	)

76 
	#IEEE1284_MODE_EPPSL
 (1<<11è

	)

77 
	#IEEE1284_MODE_EPPSWE
 (1<<12è

	)

78 
	#IEEE1284_DEVICEID
 (1<<2è

	)

79 
	#IEEE1284_EXT_LINK
 (1<<14è

	)

87 
	#IEEE1284_ADDR
 (1<<13è

	)

88 
	#IEEE1284_DATA
 0

	)

91 
	#PARPORT_EPP_FAST
 (1<<0è

	)

92 
	#PARPORT_W91284PIC
 (1<<1è

	)

	@/usr/include/linux/ppdev.h

18 
	#PP_IOCTL
 'p'

	)

21 
	#PPSETMODE
 
	`_IOW
(
PP_IOCTL
, 0x80, )

	)

24 
	#PPRSTATUS
 
	`_IOR
(
PP_IOCTL
, 0x81, )

	)

25 
	#PPWSTATUS
 
	`OBSOLETE__IOW
(
PP_IOCTL
, 0x82, )

	)

28 
	#PPRCONTROL
 
	`_IOR
(
PP_IOCTL
, 0x83, )

	)

29 
	#PPWCONTROL
 
	`_IOW
(
PP_IOCTL
, 0x84, )

	)

31 
	sµdev_äob_¡ruù
 {

32 
	mmask
;

33 
	mv®
;

35 
	#PPFCONTROL
 
	`_IOW
(
PP_IOCTL
, 0x8e, 
µdev_äob_¡ruù
)

	)

38 
	#PPRDATA
 
	`_IOR
(
PP_IOCTL
, 0x85, )

	)

39 
	#PPWDATA
 
	`_IOW
(
PP_IOCTL
, 0x86, )

	)

42 
	#PPRECONTROL
 
	`OBSOLETE__IOR
(
PP_IOCTL
, 0x87, )

	)

43 
	#PPWECONTROL
 
	`OBSOLETE__IOW
(
PP_IOCTL
, 0x88, )

	)

46 
	#PPRFIFO
 
	`OBSOLETE__IOR
(
PP_IOCTL
, 0x89, )

	)

47 
	#PPWFIFO
 
	`OBSOLETE__IOW
(
PP_IOCTL
, 0x8a, )

	)

50 
	#PPCLAIM
 
	`_IO
(
PP_IOCTL
, 0x8b)

	)

53 
	#PPRELEASE
 
	`_IO
(
PP_IOCTL
, 0x8c)

	)

57 
	#PPYIELD
 
	`_IO
(
PP_IOCTL
, 0x8d)

	)

60 
	#PPEXCL
 
	`_IO
(
PP_IOCTL
, 0x8f)

	)

63 
	#PPDATADIR
 
	`_IOW
(
PP_IOCTL
, 0x90, )

	)

66 
	#PPNEGOT
 
	`_IOW
(
PP_IOCTL
, 0x91, )

	)

69 
	#PPWCTLONIRQ
 
	`_IOW
(
PP_IOCTL
, 0x92, )

	)

72 
	#PPCLRIRQ
 
	`_IOR
(
PP_IOCTL
, 0x93, )

	)

75 
	#PPSETPHASE
 
	`_IOW
(
PP_IOCTL
, 0x94, )

	)

78 
	#PPGETTIME
 
	`_IOR
(
PP_IOCTL
, 0x95, 
timev®
)

	)

79 
	#PPSETTIME
 
	`_IOW
(
PP_IOCTL
, 0x96, 
timev®
)

	)

82 
	#PPGETMODES
 
	`_IOR
(
PP_IOCTL
, 0x97, )

	)

85 
	#PPGETMODE
 
	`_IOR
(
PP_IOCTL
, 0x98, )

	)

86 
	#PPGETPHASE
 
	`_IOR
(
PP_IOCTL
, 0x99, )

	)

89 
	#PPGETFLAGS
 
	`_IOR
(
PP_IOCTL
, 0x9a, )

	)

90 
	#PPSETFLAGS
 
	`_IOW
(
PP_IOCTL
, 0x9b, )

	)

93 
	#PP_FASTWRITE
 (1<<2)

	)

94 
	#PP_FASTREAD
 (1<<3)

	)

95 
	#PP_W91284PIC
 (1<<4)

	)

98 
	#PP_FLAGMASK
 (
PP_FASTWRITE
 | 
PP_FASTREAD
 | 
PP_W91284PIC
)

	)

	@/usr/include/malloc.h

19 #iâdeà
_MALLOC_H


20 
	#_MALLOC_H
 1

	)

22 
	~<ã©u»s.h
>

23 
	~<¡ddef.h
>

24 
	~<¡dio.h
>

26 #ifdeà
_LIBC


27 
	#__MALLOC_HOOK_VOLATILE


	)

28 
	#__MALLOC_DEPRECATED


	)

30 
	#__MALLOC_HOOK_VOLATILE
 vŞ©e

	)

31 
	#__MALLOC_DEPRECATED
 
__©Œibu‹_d•»ÿ‹d__


	)

35 
__BEGIN_DECLS


38 *
	$m®loc
 (
size_t
 
__size
è
__THROW
 
__©Œibu‹_m®loc__
 
__wur
;

41 *
	$ÿÎoc
 (
size_t
 
__nmemb
, size_ˆ
__size
)

42 
__THROW
 
__©Œibu‹_m®loc__
 
__wur
;

49 *
	$»®loc
 (*
__±r
, 
size_t
 
__size
)

50 
__THROW
 
__©Œibu‹_w¬n_unu£d_»suÉ__
;

57 *
	$»®loÿ¼ay
 (*
__±r
, 
size_t
 
__nmemb
, size_ˆ
__size
)

58 
__THROW
 
__©Œibu‹_w¬n_unu£d_»suÉ__
;

61 
	$ä“
 (*
__±r
è
__THROW
;

64 *
	$mem®ign
 (
size_t
 
__®ignm’t
, size_ˆ
__size
)

65 
__THROW
 
__©Œibu‹_m®loc__
 
__wur
;

68 *
	$v®loc
 (
size_t
 
__size
è
__THROW
 
__©Œibu‹_m®loc__
 
__wur
;

72 *
	$pv®loc
 (
size_t
 
__size
è
__THROW
 
__©Œibu‹_m®loc__
 
__wur
;

76 *(*
__mÜecÜe
è(
±rdiff_t
 
__size
);

79 *
	$__deçuÉ_mÜecÜe
 (
±rdiff_t
 
__size
)

80 
__THROW
 
__©Œibu‹_m®loc__
;

84 
	sm®lšfo


86 
¬’a
;

87 
Üdblks
;

88 
smblks
;

89 
hblks
;

90 
hblkhd
;

91 
usmblks
;

92 
fsmblks
;

93 
uÜdblks
;

94 
fÜdblks
;

95 
k“pco¡
;

99 
m®lšfo
 
	$m®lšfo
 (è
__THROW
;

102 #iâdeà
M_MXFAST


103 
	#M_MXFAST
 1

	)

105 #iâdeà
M_NLBLKS


106 
	#M_NLBLKS
 2

	)

108 #iâdeà
M_GRAIN


109 
	#M_GRAIN
 3

	)

111 #iâdeà
M_KEEP


112 
	#M_KEEP
 4

	)

116 
	#M_TRIM_THRESHOLD
 -1

	)

117 
	#M_TOP_PAD
 -2

	)

118 
	#M_MMAP_THRESHOLD
 -3

	)

119 
	#M_MMAP_MAX
 -4

	)

120 
	#M_CHECK_ACTION
 -5

	)

121 
	#M_PERTURB
 -6

	)

122 
	#M_ARENA_TEST
 -7

	)

123 
	#M_ARENA_MAX
 -8

	)

126 
	$m®lİt
 (
__·¿m
, 
__v®
è
__THROW
;

130 
	$m®loc_Œim
 (
size_t
 
__·d
è
__THROW
;

134 
size_t
 
	$m®loc_u§bË_size
 (*
__±r
è
__THROW
;

137 
	$m®loc_¡©s
 (è
__THROW
;

140 
	$m®loc_šfo
 (
__İtiÚs
, 
FILE
 *
__å
è
__THROW
;

143 (*
__MALLOC_HOOK_VOLATILE
 
__ä“_hook
è(*
__±r
,

145 
__MALLOC_DEPRECATED
;

146 *(*
__MALLOC_HOOK_VOLATILE
 
__m®loc_hook
)(
size_t
 
__size
,

148 
__MALLOC_DEPRECATED
;

149 *(*
__MALLOC_HOOK_VOLATILE
 
__»®loc_hook
)(*
__±r
,

150 
size_t
 
__size
,

152 
__MALLOC_DEPRECATED
;

153 *(*
__MALLOC_HOOK_VOLATILE
 
__mem®ign_hook
)(
size_t
 
__®ignm’t
,

154 
size_t
 
__size
,

156 
__MALLOC_DEPRECATED
;

157 (*
__MALLOC_HOOK_VOLATILE
 
__aá”_mÜecÜe_hook
) ();

160 
	$__m®loc_check_š™
 (è
__THROW
 
__MALLOC_DEPRECATED
;

163 
__END_DECLS


	@/usr/include/math.h

23 #iâdef 
_MATH_H


24 
	#_MATH_H
 1

	)

26 
	#__GLIBC_INTERNAL_STARTING_HEADER_IMPLEMENTATION


	)

27 
	~<b™s/libc-h—d”-¡¬t.h
>

29 #ià
defšed
 
log
 && defšed 
__GNUC__


30 #w¬nšg 
A
 
maüo
 
ÿÎed
 
log
 
was
 
®»ady
 
defšed
 
wh’
 <
m©h
.
h
> wa 
šşuded
.

31 #w¬nšg 
This
 
wl
 
ÿu£
 
comp©iÚ
 
´obËms
.

34 
	g__BEGIN_DECLS


37 
	~<b™s/ty³s.h
>

40 
	~<b™s/m©h-veùÜ.h
>

43 
	~<b™s/æßŠ.h
>

47 #ià
__GNUC_PREREQ
 (3, 3)

48 
	#HUGE_VAL
 (
	`__butš_huge_v®
 ())

	)

55 
	#HUGE_VAL
 1e10000

	)

57 #ifdeà
__USE_ISOC99


58 #ià
__GNUC_PREREQ
 (3, 3)

59 
	#HUGE_VALF
 (
	`__butš_huge_v®f
 ())

	)

60 
	#HUGE_VALL
 (
	`__butš_huge_v®l
 ())

	)

62 
	#HUGE_VALF
 1e10000f

	)

63 
	#HUGE_VALL
 1e10000L

	)

66 #ià
__HAVE_FLOAT16
 && 
__GLIBC_USE
 (
IEC_60559_TYPES_EXT
)

67 
	#HUGE_VAL_F16
 (
	`__butš_huge_v®f16
 ())

	)

69 #ià
__HAVE_FLOAT32
 && 
__GLIBC_USE
 (
IEC_60559_TYPES_EXT
)

70 
	#HUGE_VAL_F32
 (
	`__butš_huge_v®f32
 ())

	)

72 #ià
__HAVE_FLOAT64
 && 
__GLIBC_USE
 (
IEC_60559_TYPES_EXT
)

73 
	#HUGE_VAL_F64
 (
	`__butš_huge_v®f64
 ())

	)

75 #ià
__HAVE_FLOAT128
 && 
__GLIBC_USE
 (
IEC_60559_TYPES_EXT
)

76 
	#HUGE_VAL_F128
 (
	`__butš_huge_v®f128
 ())

	)

78 #ià
__HAVE_FLOAT32X
 && 
__GLIBC_USE
 (
IEC_60559_TYPES_EXT
)

79 
	#HUGE_VAL_F32X
 (
	`__butš_huge_v®f32x
 ())

	)

81 #ià
__HAVE_FLOAT64X
 && 
__GLIBC_USE
 (
IEC_60559_TYPES_EXT
)

82 
	#HUGE_VAL_F64X
 (
	`__butš_huge_v®f64x
 ())

	)

84 #ià
__HAVE_FLOAT128X
 && 
__GLIBC_USE
 (
IEC_60559_TYPES_EXT
)

85 
	#HUGE_VAL_F128X
 (
	`__butš_huge_v®f128x
 ())

	)

88 #ifdeà
__USE_ISOC99


90 #ià
__GNUC_PREREQ
 (3, 3)

91 
	#INFINITY
 (
	`__butš_šff
 ())

	)

93 
	#INFINITY
 
HUGE_VALF


	)

97 #ià
__GNUC_PREREQ
 (3, 3)

98 
	#NAN
 (
	`__butš_Çnf
 (""))

	)

103 
	#NAN
 (0.0à/ 0.0f)

	)

107 #ià
__GLIBC_USE
 (
IEC_60559_BFP_EXT
)

109 #ià
__GNUC_PREREQ
 (3, 3)

110 
	#SNANF
 (
	`__butš_Çnsf
 (""))

	)

111 
	#SNAN
 (
	`__butš_Çns
 (""))

	)

112 
	#SNANL
 (
	`__butš_Çn¦
 (""))

	)

115 #ià
__HAVE_FLOAT16
 && 
__GLIBC_USE
 (
IEC_60559_TYPES_EXT
)

116 
	#SNANF16
 (
	`__butš_Çnsf16
 (""))

	)

118 #ià
__HAVE_FLOAT32
 && 
__GLIBC_USE
 (
IEC_60559_TYPES_EXT
)

119 
	#SNANF32
 (
	`__butš_Çnsf32
 (""))

	)

121 #ià
__HAVE_FLOAT64
 && 
__GLIBC_USE
 (
IEC_60559_TYPES_EXT
)

122 
	#SNANF64
 (
	`__butš_Çnsf64
 (""))

	)

124 #ià
__HAVE_FLOAT128
 && 
__GLIBC_USE
 (
IEC_60559_TYPES_EXT
)

125 
	#SNANF128
 (
	`__butš_Çnsf128
 (""))

	)

127 #ià
__HAVE_FLOAT32X
 && 
__GLIBC_USE
 (
IEC_60559_TYPES_EXT
)

128 
	#SNANF32X
 (
	`__butš_Çnsf32x
 (""))

	)

130 #ià
__HAVE_FLOAT64X
 && 
__GLIBC_USE
 (
IEC_60559_TYPES_EXT
)

131 
	#SNANF64X
 (
	`__butš_Çnsf64x
 (""))

	)

133 #ià
__HAVE_FLOAT128X
 && 
__GLIBC_USE
 (
IEC_60559_TYPES_EXT
)

134 
	#SNANF128X
 (
	`__butš_Çnsf128x
 (""))

	)

138 
	~<b™s/æt-ev®-m‘hod.h
>

140 #ifdeà
__USE_ISOC99


148 #ià
__GLIBC_FLT_EVAL_METHOD
 == 0 || __GLIBC_FLT_EVAL_METHOD == 16

149 
	tæßt_t
;

150 
	tdoubË_t
;

151 #–ià
__GLIBC_FLT_EVAL_METHOD
 == 1

152 
	tæßt_t
;

153 
	tdoubË_t
;

154 #–ià
__GLIBC_FLT_EVAL_METHOD
 == 2

155 
	tæßt_t
;

156 
	tdoubË_t
;

157 #–ià
__GLIBC_FLT_EVAL_METHOD
 == 32

158 
_Flßt32
 
	tæßt_t
;

159 
	tdoubË_t
;

160 #–ià
__GLIBC_FLT_EVAL_METHOD
 == 33

161 
_Flßt32x
 
	tæßt_t
;

162 
_Flßt32x
 
	tdoubË_t
;

163 #–ià
__GLIBC_FLT_EVAL_METHOD
 == 64

164 
_Flßt64
 
	tæßt_t
;

165 
_Flßt64
 
	tdoubË_t
;

166 #–ià
__GLIBC_FLT_EVAL_METHOD
 == 65

167 
_Flßt64x
 
	tæßt_t
;

168 
_Flßt64x
 
	tdoubË_t
;

169 #–ià
__GLIBC_FLT_EVAL_METHOD
 == 128

170 
_Flßt128
 
	tæßt_t
;

171 
_Flßt128
 
	tdoubË_t
;

172 #–ià
__GLIBC_FLT_EVAL_METHOD
 == 129

173 
_Flßt128x
 
	tæßt_t
;

174 
_Flßt128x
 
	tdoubË_t
;

190 
	~<b™s/å-logb.h
>

191 #ifdeà
__USE_ISOC99


192 #ià
__FP_LOGB0_IS_MIN


193 
	#FP_ILOGB0
 (-2147483647 - 1)

	)

195 
	#FP_ILOGB0
 (-2147483647)

	)

197 #ià
__FP_LOGBNAN_IS_MIN


198 
	#FP_ILOGBNAN
 (-2147483647 - 1)

	)

200 
	#FP_ILOGBNAN
 2147483647

	)

203 #ià
__GLIBC_USE
 (
IEC_60559_BFP_EXT
)

204 #ià
__WORDSIZE
 == 32

205 
	#__FP_LONG_MAX
 0x7fffffffL

	)

207 
	#__FP_LONG_MAX
 0x7fffffffffffffffL

	)

209 #ià
__FP_LOGB0_IS_MIN


210 
	#FP_LLOGB0
 (-
__FP_LONG_MAX
 - 1)

	)

212 
	#FP_LLOGB0
 (-
__FP_LONG_MAX
)

	)

214 #ià
__FP_LOGBNAN_IS_MIN


215 
	#FP_LLOGBNAN
 (-
__FP_LONG_MAX
 - 1)

	)

217 
	#FP_LLOGBNAN
 
__FP_LONG_MAX


	)

233 
	~<b™s/å-ç¡.h
>

235 #ià
__GLIBC_USE
 (
IEC_60559_BFP_EXT
)

239 
	mFP_INT_UPWARD
 =

240 
	#FP_INT_UPWARD
 0

	)

241 
FP_INT_UPWARD
,

242 
	mFP_INT_DOWNWARD
 =

243 
	#FP_INT_DOWNWARD
 1

	)

244 
FP_INT_DOWNWARD
,

245 
	mFP_INT_TOWARDZERO
 =

246 
	#FP_INT_TOWARDZERO
 2

	)

247 
FP_INT_TOWARDZERO
,

248 
	mFP_INT_TONEARESTFROMZERO
 =

249 
	#FP_INT_TONEARESTFROMZERO
 3

	)

250 
FP_INT_TONEARESTFROMZERO
,

251 
	mFP_INT_TONEAREST
 =

252 
	#FP_INT_TONEAREST
 4

	)

253 
FP_INT_TONEAREST
,

262 
	#__SIMD_DECL
(
funùiÚ
è
	`__CONCAT
 (
__DECL_SIMD_
, funùiÚ)

	)

264 
	#__MATHCALL_VEC
(
funùiÚ
, 
suffix
, 
¬gs
) \

265 
	`__SIMD_DECL
 (
	`__MATH_PRECNAME
 (
funùiÚ
, 
suffix
)) \

266 
	`__MATHCALL
 (
funùiÚ
, 
suffix
, 
¬gs
)

	)

268 
	#__MATHDECL_VEC
(
ty³
, 
funùiÚ
,
suffix
, 
¬gs
) \

269 
	`__SIMD_DECL
 (
	`__MATH_PRECNAME
 (
funùiÚ
, 
suffix
)) \

270 
	`__MATHDECL
(
ty³
, 
funùiÚ
,
suffix
, 
¬gs
)

	)

272 
	#__MATHCALL
(
funùiÚ
,
suffix
, 
¬gs
) \

273 
	`__MATHDECL
 (
_MdoubË_
,
funùiÚ
,
suffix
, 
¬gs
)

	)

274 
	#__MATHDECL
(
ty³
, 
funùiÚ
,
suffix
, 
¬gs
) \

275 
	`__MATHDECL_1
(
ty³
, 
funùiÚ
,
suffix
, 
¬gs
); \

276 
	`__MATHDECL_1
(
ty³
, 
	`__CONCAT
(
__
,
funùiÚ
),
suffix
, 
¬gs
)

	)

277 
	#__MATHCALLX
(
funùiÚ
,
suffix
, 
¬gs
, 
©Œib
) \

278 
	`__MATHDECLX
 (
_MdoubË_
,
funùiÚ
,
suffix
, 
¬gs
, 
©Œib
)

	)

279 
	#__MATHDECLX
(
ty³
, 
funùiÚ
,
suffix
, 
¬gs
, 
©Œib
) \

280 
	`__MATHDECL_1
(
ty³
, 
funùiÚ
,
suffix
, 
¬gs
è
	`__©Œibu‹__
 (
©Œib
); \

281 
	`__MATHDECL_1
(
ty³
, 
	`__CONCAT
(
__
,
funùiÚ
),
suffix
, 
¬gs
è
	`__©Œibu‹__
 (
©Œib
)

	)

282 
	#__MATHDECL_1
(
ty³
, 
funùiÚ
,
suffix
, 
¬gs
) \

283 
ty³
 
	`__MATH_PRECNAME
(
funùiÚ
,
suffix
è
¬gs
 
__THROW


	)

285 
	#_MdoubË_
 

	)

286 
	#__MATH_PRECNAME
(
Çme
,
r
è
	`__CONCAT
Òame,r)

	)

287 
	#__MATH_DECLARING_DOUBLE
 1

	)

288 
	#__MATH_DECLARING_FLOATN
 0

	)

289 
	~<b™s/m©hÿÎs-h–³r-funùiÚs.h
>

290 
	~<b™s/m©hÿÎs.h
>

291 #undeà
_MdoubË_


292 #undeà
__MATH_PRECNAME


293 #undeà
__MATH_DECLARING_DOUBLE


294 #undeà
__MATH_DECLARING_FLOATN


296 #ifdeà
__USE_ISOC99


302 
	#_MdoubË_
 

	)

303 
	#__MATH_PRECNAME
(
Çme
,
r
èÇme##
f
##
	)
r

304 
	#__MATH_DECLARING_DOUBLE
 0

	)

305 
	#__MATH_DECLARING_FLOATN
 0

	)

306 
	~<b™s/m©hÿÎs-h–³r-funùiÚs.h
>

307 
	~<b™s/m©hÿÎs.h
>

308 #undeà
_MdoubË_


309 #undeà
__MATH_PRECNAME


310 #undeà
__MATH_DECLARING_DOUBLE


311 #undeà
__MATH_DECLARING_FLOATN


313 #ià!(
defšed
 
__NO_LONG_DOUBLE_MATH
 && defšed 
_LIBC
) \

314 || 
defšed
 
__LDBL_COMPAT
 \

315 || 
defšed
 
_LIBC_TEST


316 #ifdeà
__LDBL_COMPAT


318 #ifdeà
__USE_ISOC99


319 
	$__Ædbl_Ãx‰ow¬df
 (
__x
, 
__y
)

320 
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
));

321 #ifdeà
__REDIRECT_NTH


322 
	`__REDIRECT_NTH
 (
Ãx‰ow¬df
, (
__x
, 
__y
),

323 
__Ædbl_Ãx‰ow¬df
)

324 
	`__©Œibu‹__
 ((
__cÚ¡__
));

325 
	`__REDIRECT_NTH
 (
Ãx‰ow¬d
, (
__x
, 
__y
),

326 
Ãxá”
è
	`__©Œibu‹__
 ((
__cÚ¡__
));

327 
	`__REDIRECT_NTH
 (
Ãx‰ow¬dl
,

328 (
__x
, 
__y
),

329 
Ãxá”
è
	`__©Œibu‹__
 ((
__cÚ¡__
));

333 #undeà
__MATHDECL_1


334 
	#__MATHDECL_2
(
ty³
, 
funùiÚ
,
suffix
, 
¬gs
, 
®Ÿs
) \

335 
ty³
 
	`__REDIRECT_NTH
(
	`__MATH_PRECNAME
(
funùiÚ
,
suffix
), \

336 
¬gs
, 
®Ÿs
)

	)

337 
	#__MATHDECL_1
(
ty³
, 
funùiÚ
,
suffix
, 
¬gs
) \

338 
	`__MATHDECL_2
(
ty³
, 
funùiÚ
,
suffix
, 
¬gs
, 
	`__CONCAT
(funùiÚ,suffix))

	)

344 
	#_MdoubË_
 

	)

345 
	#__MATH_PRECNAME
(
Çme
,
r
èÇme##
l
##
	)
r

346 
	#__MATH_DECLARING_DOUBLE
 0

	)

347 
	#__MATH_DECLARING_FLOATN
 0

	)

348 
	#__MATH_DECLARE_LDOUBLE
 1

	)

349 
	~<b™s/m©hÿÎs-h–³r-funùiÚs.h
>

350 
	~<b™s/m©hÿÎs.h
>

351 #undeà
_MdoubË_


352 #undeà
__MATH_PRECNAME


353 #undeà
__MATH_DECLARING_DOUBLE


354 #undeà
__MATH_DECLARING_FLOATN


363 #ià
__HAVE_DISTINCT_FLOAT16
 || (
__HAVE_FLOAT16
 && !
defšed
 
_LIBC
)

364 
	#_MdoubË_
 
_Flßt16


	)

365 
	#__MATH_PRECNAME
(
Çme
,
r
èÇme##
f16
##
	)
r

366 
	#__MATH_DECLARING_DOUBLE
 0

	)

367 
	#__MATH_DECLARING_FLOATN
 1

	)

368 #ià
__HAVE_DISTINCT_FLOAT16


369 
	~<b™s/m©hÿÎs-h–³r-funùiÚs.h
>

371 #ià
	`__GLIBC_USE
 (
IEC_60559_TYPES_EXT
)

372 
	~<b™s/m©hÿÎs.h
>

374 #undeà
_MdoubË_


375 #undeà
__MATH_PRECNAME


376 #undeà
__MATH_DECLARING_DOUBLE


377 #undeà
__MATH_DECLARING_FLOATN


380 #ià
__HAVE_DISTINCT_FLOAT32
 || (
__HAVE_FLOAT32
 && !
defšed
 
_LIBC
)

381 
	#_MdoubË_
 
_Flßt32


	)

382 
	#__MATH_PRECNAME
(
Çme
,
r
èÇme##
f32
##
	)
r

383 
	#__MATH_DECLARING_DOUBLE
 0

	)

384 
	#__MATH_DECLARING_FLOATN
 1

	)

385 #ià
__HAVE_DISTINCT_FLOAT32


386 
	~<b™s/m©hÿÎs-h–³r-funùiÚs.h
>

388 #ià
	`__GLIBC_USE
 (
IEC_60559_TYPES_EXT
)

389 
	~<b™s/m©hÿÎs.h
>

391 #undeà
_MdoubË_


392 #undeà
__MATH_PRECNAME


393 #undeà
__MATH_DECLARING_DOUBLE


394 #undeà
__MATH_DECLARING_FLOATN


397 #ià
__HAVE_DISTINCT_FLOAT64
 || (
__HAVE_FLOAT64
 && !
defšed
 
_LIBC
)

398 
	#_MdoubË_
 
_Flßt64


	)

399 
	#__MATH_PRECNAME
(
Çme
,
r
èÇme##
f64
##
	)
r

400 
	#__MATH_DECLARING_DOUBLE
 0

	)

401 
	#__MATH_DECLARING_FLOATN
 1

	)

402 #ià
__HAVE_DISTINCT_FLOAT64


403 
	~<b™s/m©hÿÎs-h–³r-funùiÚs.h
>

405 #ià
	`__GLIBC_USE
 (
IEC_60559_TYPES_EXT
)

406 
	~<b™s/m©hÿÎs.h
>

408 #undeà
_MdoubË_


409 #undeà
__MATH_PRECNAME


410 #undeà
__MATH_DECLARING_DOUBLE


411 #undeà
__MATH_DECLARING_FLOATN


414 #ià
__HAVE_DISTINCT_FLOAT128
 || (
__HAVE_FLOAT128
 && !
defšed
 
_LIBC
)

415 
	#_MdoubË_
 
_Flßt128


	)

416 
	#__MATH_PRECNAME
(
Çme
,
r
èÇme##
f128
##
	)
r

417 
	#__MATH_DECLARING_DOUBLE
 0

	)

418 
	#__MATH_DECLARING_FLOATN
 1

	)

419 #ià
__HAVE_DISTINCT_FLOAT128


420 
	~<b™s/m©hÿÎs-h–³r-funùiÚs.h
>

422 #ià
	`__GLIBC_USE
 (
IEC_60559_TYPES_EXT
)

423 
	~<b™s/m©hÿÎs.h
>

425 #undeà
_MdoubË_


426 #undeà
__MATH_PRECNAME


427 #undeà
__MATH_DECLARING_DOUBLE


428 #undeà
__MATH_DECLARING_FLOATN


431 #ià
__HAVE_DISTINCT_FLOAT32X
 || (
__HAVE_FLOAT32X
 && !
defšed
 
_LIBC
)

432 
	#_MdoubË_
 
_Flßt32x


	)

433 
	#__MATH_PRECNAME
(
Çme
,
r
èÇme##
f32x
##
	)
r

434 
	#__MATH_DECLARING_DOUBLE
 0

	)

435 
	#__MATH_DECLARING_FLOATN
 1

	)

436 #ià
__HAVE_DISTINCT_FLOAT32X


437 
	~<b™s/m©hÿÎs-h–³r-funùiÚs.h
>

439 #ià
	`__GLIBC_USE
 (
IEC_60559_TYPES_EXT
)

440 
	~<b™s/m©hÿÎs.h
>

442 #undeà
_MdoubË_


443 #undeà
__MATH_PRECNAME


444 #undeà
__MATH_DECLARING_DOUBLE


445 #undeà
__MATH_DECLARING_FLOATN


448 #ià
__HAVE_DISTINCT_FLOAT64X
 || (
__HAVE_FLOAT64X
 && !
defšed
 
_LIBC
)

449 
	#_MdoubË_
 
_Flßt64x


	)

450 
	#__MATH_PRECNAME
(
Çme
,
r
èÇme##
f64x
##
	)
r

451 
	#__MATH_DECLARING_DOUBLE
 0

	)

452 
	#__MATH_DECLARING_FLOATN
 1

	)

453 #ià
__HAVE_DISTINCT_FLOAT64X


454 
	~<b™s/m©hÿÎs-h–³r-funùiÚs.h
>

456 #ià
	`__GLIBC_USE
 (
IEC_60559_TYPES_EXT
)

457 
	~<b™s/m©hÿÎs.h
>

459 #undeà
_MdoubË_


460 #undeà
__MATH_PRECNAME


461 #undeà
__MATH_DECLARING_DOUBLE


462 #undeà
__MATH_DECLARING_FLOATN


465 #ià
__HAVE_DISTINCT_FLOAT128X
 || (
__HAVE_FLOAT128X
 && !
defšed
 
_LIBC
)

466 
	#_MdoubË_
 
_Flßt128x


	)

467 
	#__MATH_PRECNAME
(
Çme
,
r
èÇme##
f128x
##
	)
r

468 
	#__MATH_DECLARING_DOUBLE
 0

	)

469 
	#__MATH_DECLARING_FLOATN
 1

	)

470 #ià
__HAVE_DISTINCT_FLOAT128X


471 
	~<b™s/m©hÿÎs-h–³r-funùiÚs.h
>

473 #ià
	`__GLIBC_USE
 (
IEC_60559_TYPES_EXT
)

474 
	~<b™s/m©hÿÎs.h
>

476 #undeà
_MdoubË_


477 #undeà
__MATH_PRECNAME


478 #undeà
__MATH_DECLARING_DOUBLE


479 #undeà
__MATH_DECLARING_FLOATN


482 #undeà
__MATHDECL_1


483 #undeà
__MATHDECL


484 #undeà
__MATHCALL


487 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_XOPEN


489 
signgam
;

492 #ià(
__HAVE_DISTINCT_FLOAT16
 \

493 || 
__HAVE_DISTINCT_FLOAT32
 \

494 || 
__HAVE_DISTINCT_FLOAT64
 \

495 || 
__HAVE_DISTINCT_FLOAT32X
 \

496 || 
__HAVE_DISTINCT_FLOAT64X
 \

497 || 
__HAVE_DISTINCT_FLOAT128X
)

510 #ifdeà
__NO_LONG_DOUBLE_MATH


511 #ià
__HAVE_DISTINCT_FLOAT128


514 
	#__MATH_TG
(
TG_ARG
, 
FUNC
, 
ARGS
) \

515 ( (
TG_ARG
è=ğ (è? 
FUNC
 ## 
f
 
ARGS
 : FUNC ARGS)

	)

516 #–ià
__HAVE_DISTINCT_FLOAT128


517 #ià
__HAVE_GENERIC_SELECTION


518 #ià
__HAVE_FLOATN_NOT_TYPEDEF
 && 
__HAVE_FLOAT32


519 
	#__MATH_TG_F32
(
FUNC
, 
ARGS
è
_Flßt32
: FUNC ## 
f
 ARGS,

	)

521 
	#__MATH_TG_F32
(
FUNC
, 
ARGS
)

	)

523 #ià
__HAVE_FLOATN_NOT_TYPEDEF
 && 
__HAVE_FLOAT64X


524 #ià
__HAVE_FLOAT64X_LONG_DOUBLE


525 
	#__MATH_TG_F64X
(
FUNC
, 
ARGS
è
_Flßt64x
: FUNC ## 
l
 ARGS,

	)

527 
	#__MATH_TG_F64X
(
FUNC
, 
ARGS
è
_Flßt64x
: FUNC ## 
f128
 ARGS,

	)

530 
	#__MATH_TG_F64X
(
FUNC
, 
ARGS
)

	)

532 
	#__MATH_TG
(
TG_ARG
, 
FUNC
, 
ARGS
) \

533 
	`_G’”ic
 ((
TG_ARG
), \

534 : 
FUNC
 ## 
f
 
ARGS
, \

535 
	`__MATH_TG_F32
 (
FUNC
, 
ARGS
) \

536 : 
FUNC
 
ARGS
, \

537 : 
FUNC
 ## 
l
 
ARGS
, \

538 
	`__MATH_TG_F64X
 (
FUNC
, 
ARGS
) \

539 
_Flßt128
: 
FUNC
 ## 
f128
 
ARGS
)

	)

541 #ià
__HAVE_FLOATN_NOT_TYPEDEF


544 
	#__MATH_TG
(
TG_ARG
, 
FUNC
, 
ARGS
) \

545 
__butš_choo£_ex´
 \

546 (
	`__butš_ty³s_com·tibË_p
 (
	`__ty³of
 (
TG_ARG
), ), \

547 
FUNC
 ## 
f
 
ARGS
, \

548 
__butš_choo£_ex´
 \

549 (
	`__butš_ty³s_com·tibË_p
 (
	`__ty³of
 (
TG_ARG
), ), \

550 
FUNC
 
ARGS
, \

551 
__butš_choo£_ex´
 \

552 (
	`__butš_ty³s_com·tibË_p
 (
	`__ty³of
 (
TG_ARG
), ), \

553 
FUNC
 ## 
l
 
ARGS
, \

554 
FUNC
 ## 
f128
 
ARGS
)))

	)

557 
	#__MATH_TG
(
TG_ARG
, 
FUNC
, 
ARGS
) \

558 ( (
TG_ARG
) ==  () \

559 ? 
FUNC
 ## 
f
 
ARGS
 \

560 :  (
TG_ARG
) ==  () \

561 ? 
FUNC
 
ARGS
 \

562 : 
FUNC
 ## 
l
 
ARGS
)

	)

566 #ifdeà
__USE_ISOC99


571 
FP_NAN
 =

572 
	#FP_NAN
 0

	)

573 
FP_NAN
,

574 
FP_INFINITE
 =

575 
	#FP_INFINITE
 1

	)

576 
FP_INFINITE
,

577 
FP_ZERO
 =

578 
	#FP_ZERO
 2

	)

579 
FP_ZERO
,

580 
FP_SUBNORMAL
 =

581 
	#FP_SUBNORMAL
 3

	)

582 
FP_SUBNORMAL
,

583 
FP_NORMAL
 =

584 
	#FP_NORMAL
 4

	)

585 
FP_NORMAL


593 #ià
	`__GNUC_PREREQ
 (4,4è&& !
defšed
 
__SUPPORT_SNAN__
 \

594 && (!
defšed
 
__OPTIMIZE_SIZE__
 || defšed 
__ılu¥lus
)

601 
	#åşassify
(
x
è
	`__butš_åşassify
 (
FP_NAN
, 
FP_INFINITE
, \

602 
FP_NORMAL
, 
FP_SUBNORMAL
, 
FP_ZERO
, 
x
)

	)

604 
	#åşassify
(
x
è
	`__MATH_TG
 ((x), 
__åşassify
, (x))

	)

608 #ià
	`__GNUC_PREREQ
 (6,0)

609 
	#signb™
(
x
è
	`__butš_signb™
 (x)

	)

610 #–ià
defšed
 
__ılu¥lus


618 
	#signb™
(
x
è
	`__butš_signb™l
 (x)

	)

619 #–ià
	`__GNUC_PREREQ
 (4,0)

620 
	#signb™
(
x
è
	`__MATH_TG
 ((x), 
__butš_signb™
, (x))

	)

622 
	#signb™
(
x
è
	`__MATH_TG
 ((x), 
__signb™
, (x))

	)

626 #ià
	`__GNUC_PREREQ
 (4,4è&& !
defšed
 
__SUPPORT_SNAN__


627 
	#isfš™e
(
x
è
	`__butš_isfš™e
 (x)

	)

629 
	#isfš™e
(
x
è
	`__MATH_TG
 ((x), 
__fš™e
, (x))

	)

633 #ià
	`__GNUC_PREREQ
 (4,4è&& !
defšed
 
__SUPPORT_SNAN__


634 
	#i¢Üm®
(
x
è
	`__butš_i¢Üm®
 (x)

	)

636 
	#i¢Üm®
(
x
è(
	`åşassify
 (xè=ğ
FP_NORMAL
)

	)

641 #ià
	`__GNUC_PREREQ
 (4,4è&& !
defšed
 
__SUPPORT_SNAN__


642 
	#i¢ª
(
x
è
	`__butš_i¢ª
 (x)

	)

644 
	#i¢ª
(
x
è
	`__MATH_TG
 ((x), 
__i¢ª
, (x))

	)

648 #ià
__HAVE_DISTINCT_FLOAT128
 && !
	`__GNUC_PREREQ
 (7,0) \

649 && !
defšed
 
__SUPPORT_SNAN__
 && !defšed 
__ılu¥lus


655 
	#isšf
(
x
) \

656 (
	`__butš_ty³s_com·tibË_p
 (
	`__ty³of
 (
x
), 
_Flßt128
) \

657 ? 
	`__isšff128
 (
x
è: 
	`__butš_isšf_sign
 (x))

	)

658 #–ià
	`__GNUC_PREREQ
 (4,4è&& !
defšed
 
__SUPPORT_SNAN__


659 
	#isšf
(
x
è
	`__butš_isšf_sign
 (x)

	)

661 
	#isšf
(
x
è
	`__MATH_TG
 ((x), 
__isšf
, (x))

	)

665 
	#MATH_ERRNO
 1

	)

666 
	#MATH_ERREXCEPT
 2

	)

673 #ifdeà
__FAST_MATH__


674 
	#m©h_”rhªdlšg
 0

	)

675 #–ià
defšed
 
__NO_MATH_ERRNO__


676 
	#m©h_”rhªdlšg
 (
MATH_ERREXCEPT
)

	)

678 
	#m©h_”rhªdlšg
 (
MATH_ERRNO
 | 
MATH_ERREXCEPT
)

	)

683 #ià
	`__GLIBC_USE
 (
IEC_60559_BFP_EXT
)

684 
	~<b™s/isÿnÚiÿl.h
>

687 #iâdeà
__ılu¥lus


688 
	#issigÇlšg
(
x
è
	`__MATH_TG
 ((x), 
__issigÇlšg
, (x))

	)

697 
šlše
 
	`issigÇlšg
 (
__v®
è{  
	`__issigÇlšgf
 (__val); }

698 
šlše
 
	`issigÇlšg
 (
__v®
è{  
	`__issigÇlšg
 (__val); }

699 
šlše
 

700 
	`issigÇlšg
 (
__v®
)

702 #ifdeà
__NO_LONG_DOUBLE_MATH


703  
	`__issigÇlšg
 (
__v®
);

705  
	`__issigÇlšgl
 (
__v®
);

708 #ià
__HAVE_DISTINCT_FLOAT128


709 
šlše
 
	`issigÇlšg
 (
_Flßt128
 
__v®
è{  
	`__issigÇlšgf128
 (__val); }

711 
	}
}

715 
	#issubnÜm®
(
x
è(
	`åşassify
 (xè=ğ
FP_SUBNORMAL
)

	)

718 #iâdeà
__ılu¥lus


719 #ifdeà
__SUPPORT_SNAN__


720 
	#isz”o
(
x
è(
	`åşassify
 (xè=ğ
FP_ZERO
)

	)

722 
	#isz”o
(
x
è(((
	`__ty³of
 (x)è(x)è=ğ0)

	)

726 #ifdeà
__SUPPORT_SNAN__


727 
šlše
 

728 
isz”o
 (
__v®
)

730  
__åşassifyf
 (
__v®
è=ğ
FP_ZERO
;

732 
šlše
 

733 
isz”o
 (
__v®
)

735  
__åşassify
 (
__v®
è=ğ
FP_ZERO
;

737 
šlše
 

738 
isz”o
 (
__v®
)

740 #ifdeà
__NO_LONG_DOUBLE_MATH


741  
__åşassify
 (
__v®
è=ğ
FP_ZERO
;

743  
__åşassifyl
 (
__v®
è=ğ
FP_ZERO
;

746 #ià
__HAVE_DISTINCT_FLOAT128


747 
šlše
 

748 
isz”o
 (
_Flßt128
 
__v®
)

750  
__åşassifyf128
 (
__v®
è=ğ
FP_ZERO
;

754 
‹m¶©e
 <
şass
 
__T
> 
šlše
 
boŞ


755 
isz”o
 (
__T
 
__v®
)

757  
__v®
 == 0;

764 #ifdeà
__USE_XOPEN


766 
	#MAXFLOAT
 3.40282347e+38F

	)

771 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_XOPEN


772 
	#M_E
 2.7182818284590452354

	)

773 
	#M_LOG2E
 1.4426950408889634074

	)

774 
	#M_LOG10E
 0.43429448190325182765

	)

775 
	#M_LN2
 0.69314718055994530942

	)

776 
	#M_LN10
 2.30258509299404568402

	)

777 
	#M_PI
 3.14159265358979323846

	)

778 
	#M_PI_2
 1.57079632679489661923

	)

779 
	#M_PI_4
 0.78539816339744830962

	)

780 
	#M_1_PI
 0.31830988618379067154

	)

781 
	#M_2_PI
 0.63661977236758134308

	)

782 
	#M_2_SQRTPI
 1.12837916709551257390

	)

783 
	#M_SQRT2
 1.41421356237309504880

	)

784 
	#M_SQRT1_2
 0.70710678118654752440

	)

790 #ifdeà
__USE_GNU


791 
	#M_El
 2.718281828459045235360287471352662498L

	)

792 
	#M_LOG2El
 1.442695040888963407359924681001892137L

	)

793 
	#M_LOG10El
 0.434294481903251827651128918916605082L

	)

794 
	#M_LN2l
 0.693147180559945309417232121458176568L

	)

795 
	#M_LN10l
 2.302585092994045684017991454684364208L

	)

796 
	#M_PIl
 3.141592653589793238462643383279502884L

	)

797 
	#M_PI_2l
 1.570796326794896619231321691639751442L

	)

798 
	#M_PI_4l
 0.785398163397448309615660845819875721L

	)

799 
	#M_1_PIl
 0.318309886183790671537767526745028724L

	)

800 
	#M_2_PIl
 0.636619772367581343075535053490057448L

	)

801 
	#M_2_SQRTPIl
 1.128379167095512573896158903121545172L

	)

802 
	#M_SQRT2l
 1.414213562373095048801688724209698079L

	)

803 
	#M_SQRT1_2l
 0.707106781186547524400844362104849039L

	)

806 #ià
__HAVE_FLOAT16
 && 
defšed
 
__USE_GNU


807 
	#M_Ef16
 
	`__f16
 (2.718281828459045235360287471352662498è

	)

808 
	#M_LOG2Ef16
 
	`__f16
 (1.442695040888963407359924681001892137è

	)

809 
	#M_LOG10Ef16
 
	`__f16
 (0.434294481903251827651128918916605082è

	)

810 
	#M_LN2f16
 
	`__f16
 (0.693147180559945309417232121458176568è

	)

811 
	#M_LN10f16
 
	`__f16
 (2.302585092994045684017991454684364208è

	)

812 
	#M_PIf16
 
	`__f16
 (3.141592653589793238462643383279502884è

	)

813 
	#M_PI_2f16
 
	`__f16
 (1.570796326794896619231321691639751442è

	)

814 
	#M_PI_4f16
 
	`__f16
 (0.785398163397448309615660845819875721è

	)

815 
	#M_1_PIf16
 
	`__f16
 (0.318309886183790671537767526745028724è

	)

816 
	#M_2_PIf16
 
	`__f16
 (0.636619772367581343075535053490057448è

	)

817 
	#M_2_SQRTPIf16
 
	`__f16
 (1.128379167095512573896158903121545172è

	)

818 
	#M_SQRT2f16
 
	`__f16
 (1.414213562373095048801688724209698079è

	)

819 
	#M_SQRT1_2f16
 
	`__f16
 (0.707106781186547524400844362104849039è

	)

822 #ià
__HAVE_FLOAT32
 && 
defšed
 
__USE_GNU


823 
	#M_Ef32
 
	`__f32
 (2.718281828459045235360287471352662498è

	)

824 
	#M_LOG2Ef32
 
	`__f32
 (1.442695040888963407359924681001892137è

	)

825 
	#M_LOG10Ef32
 
	`__f32
 (0.434294481903251827651128918916605082è

	)

826 
	#M_LN2f32
 
	`__f32
 (0.693147180559945309417232121458176568è

	)

827 
	#M_LN10f32
 
	`__f32
 (2.302585092994045684017991454684364208è

	)

828 
	#M_PIf32
 
	`__f32
 (3.141592653589793238462643383279502884è

	)

829 
	#M_PI_2f32
 
	`__f32
 (1.570796326794896619231321691639751442è

	)

830 
	#M_PI_4f32
 
	`__f32
 (0.785398163397448309615660845819875721è

	)

831 
	#M_1_PIf32
 
	`__f32
 (0.318309886183790671537767526745028724è

	)

832 
	#M_2_PIf32
 
	`__f32
 (0.636619772367581343075535053490057448è

	)

833 
	#M_2_SQRTPIf32
 
	`__f32
 (1.128379167095512573896158903121545172è

	)

834 
	#M_SQRT2f32
 
	`__f32
 (1.414213562373095048801688724209698079è

	)

835 
	#M_SQRT1_2f32
 
	`__f32
 (0.707106781186547524400844362104849039è

	)

838 #ià
__HAVE_FLOAT64
 && 
defšed
 
__USE_GNU


839 
	#M_Ef64
 
	`__f64
 (2.718281828459045235360287471352662498è

	)

840 
	#M_LOG2Ef64
 
	`__f64
 (1.442695040888963407359924681001892137è

	)

841 
	#M_LOG10Ef64
 
	`__f64
 (0.434294481903251827651128918916605082è

	)

842 
	#M_LN2f64
 
	`__f64
 (0.693147180559945309417232121458176568è

	)

843 
	#M_LN10f64
 
	`__f64
 (2.302585092994045684017991454684364208è

	)

844 
	#M_PIf64
 
	`__f64
 (3.141592653589793238462643383279502884è

	)

845 
	#M_PI_2f64
 
	`__f64
 (1.570796326794896619231321691639751442è

	)

846 
	#M_PI_4f64
 
	`__f64
 (0.785398163397448309615660845819875721è

	)

847 
	#M_1_PIf64
 
	`__f64
 (0.318309886183790671537767526745028724è

	)

848 
	#M_2_PIf64
 
	`__f64
 (0.636619772367581343075535053490057448è

	)

849 
	#M_2_SQRTPIf64
 
	`__f64
 (1.128379167095512573896158903121545172è

	)

850 
	#M_SQRT2f64
 
	`__f64
 (1.414213562373095048801688724209698079è

	)

851 
	#M_SQRT1_2f64
 
	`__f64
 (0.707106781186547524400844362104849039è

	)

854 #ià
__HAVE_FLOAT128
 && 
defšed
 
__USE_GNU


855 
	#M_Ef128
 
	`__f128
 (2.718281828459045235360287471352662498è

	)

856 
	#M_LOG2Ef128
 
	`__f128
 (1.442695040888963407359924681001892137è

	)

857 
	#M_LOG10Ef128
 
	`__f128
 (0.434294481903251827651128918916605082è

	)

858 
	#M_LN2f128
 
	`__f128
 (0.693147180559945309417232121458176568è

	)

859 
	#M_LN10f128
 
	`__f128
 (2.302585092994045684017991454684364208è

	)

860 
	#M_PIf128
 
	`__f128
 (3.141592653589793238462643383279502884è

	)

861 
	#M_PI_2f128
 
	`__f128
 (1.570796326794896619231321691639751442è

	)

862 
	#M_PI_4f128
 
	`__f128
 (0.785398163397448309615660845819875721è

	)

863 
	#M_1_PIf128
 
	`__f128
 (0.318309886183790671537767526745028724è

	)

864 
	#M_2_PIf128
 
	`__f128
 (0.636619772367581343075535053490057448è

	)

865 
	#M_2_SQRTPIf128
 
	`__f128
 (1.128379167095512573896158903121545172è

	)

866 
	#M_SQRT2f128
 
	`__f128
 (1.414213562373095048801688724209698079è

	)

867 
	#M_SQRT1_2f128
 
	`__f128
 (0.707106781186547524400844362104849039è

	)

870 #ià
__HAVE_FLOAT32X
 && 
defšed
 
__USE_GNU


871 
	#M_Ef32x
 
	`__f32x
 (2.718281828459045235360287471352662498è

	)

872 
	#M_LOG2Ef32x
 
	`__f32x
 (1.442695040888963407359924681001892137è

	)

873 
	#M_LOG10Ef32x
 
	`__f32x
 (0.434294481903251827651128918916605082è

	)

874 
	#M_LN2f32x
 
	`__f32x
 (0.693147180559945309417232121458176568è

	)

875 
	#M_LN10f32x
 
	`__f32x
 (2.302585092994045684017991454684364208è

	)

876 
	#M_PIf32x
 
	`__f32x
 (3.141592653589793238462643383279502884è

	)

877 
	#M_PI_2f32x
 
	`__f32x
 (1.570796326794896619231321691639751442è

	)

878 
	#M_PI_4f32x
 
	`__f32x
 (0.785398163397448309615660845819875721è

	)

879 
	#M_1_PIf32x
 
	`__f32x
 (0.318309886183790671537767526745028724è

	)

880 
	#M_2_PIf32x
 
	`__f32x
 (0.636619772367581343075535053490057448è

	)

881 
	#M_2_SQRTPIf32x
 
	`__f32x
 (1.128379167095512573896158903121545172è

	)

882 
	#M_SQRT2f32x
 
	`__f32x
 (1.414213562373095048801688724209698079è

	)

883 
	#M_SQRT1_2f32x
 
	`__f32x
 (0.707106781186547524400844362104849039è

	)

886 #ià
__HAVE_FLOAT64X
 && 
defšed
 
__USE_GNU


887 
	#M_Ef64x
 
	`__f64x
 (2.718281828459045235360287471352662498è

	)

888 
	#M_LOG2Ef64x
 
	`__f64x
 (1.442695040888963407359924681001892137è

	)

889 
	#M_LOG10Ef64x
 
	`__f64x
 (0.434294481903251827651128918916605082è

	)

890 
	#M_LN2f64x
 
	`__f64x
 (0.693147180559945309417232121458176568è

	)

891 
	#M_LN10f64x
 
	`__f64x
 (2.302585092994045684017991454684364208è

	)

892 
	#M_PIf64x
 
	`__f64x
 (3.141592653589793238462643383279502884è

	)

893 
	#M_PI_2f64x
 
	`__f64x
 (1.570796326794896619231321691639751442è

	)

894 
	#M_PI_4f64x
 
	`__f64x
 (0.785398163397448309615660845819875721è

	)

895 
	#M_1_PIf64x
 
	`__f64x
 (0.318309886183790671537767526745028724è

	)

896 
	#M_2_PIf64x
 
	`__f64x
 (0.636619772367581343075535053490057448è

	)

897 
	#M_2_SQRTPIf64x
 
	`__f64x
 (1.128379167095512573896158903121545172è

	)

898 
	#M_SQRT2f64x
 
	`__f64x
 (1.414213562373095048801688724209698079è

	)

899 
	#M_SQRT1_2f64x
 
	`__f64x
 (0.707106781186547524400844362104849039è

	)

902 #ià
__HAVE_FLOAT128X
 && 
defšed
 
__USE_GNU


909 #ià
defšed
 
__STRICT_ANSI__
 && !defšed 
__NO_MATH_INLINES


910 
	#__NO_MATH_INLINES
 1

	)

913 #ifdeà
__USE_ISOC99


914 #ià
__GNUC_PREREQ
 (3, 1)

921 
	#isg»©”
(
x
, 
y
è
	`__butš_isg»©”
(x, y)

	)

922 
	#isg»©”equ®
(
x
, 
y
è
	`__butš_isg»©”equ®
(x, y)

	)

923 
	#i¦ess
(
x
, 
y
è
	`__butš_i¦ess
(x, y)

	)

924 
	#i¦es£qu®
(
x
, 
y
è
	`__butš_i¦es£qu®
(x, y)

	)

925 
	#i¦essg»©”
(
x
, 
y
è
	`__butš_i¦essg»©”
(x, y)

	)

926 
	#isunÜd”ed
(
x
, 
y
è
	`__butš_isunÜd”ed
(x, y)

	)

928 
	#isg»©”
(
x
, 
y
) \

929 (
	`__ex‹nsiÚ__
 ({ 
	`__ty³of__
 (
x
è
__x
 = (x); __ty³of__ (
y
è
__y
 = (y); \

930 !
	`isunÜd”ed
 (
__x
, 
__y
è&& __x > __y; }))

	)

931 
	#isg»©”equ®
(
x
, 
y
) \

932 (
	`__ex‹nsiÚ__
 ({ 
	`__ty³of__
 (
x
è
__x
 = (x); __ty³of__ (
y
è
__y
 = (y); \

933 !
	`isunÜd”ed
 (
__x
, 
__y
è&& __x >ğ__y; }))

	)

934 
	#i¦ess
(
x
, 
y
) \

935 (
	`__ex‹nsiÚ__
 ({ 
	`__ty³of__
 (
x
è
__x
 = (x); __ty³of__ (
y
è
__y
 = (y); \

936 !
	`isunÜd”ed
 (
__x
, 
__y
è&& __x < __y; }))

	)

937 
	#i¦es£qu®
(
x
, 
y
) \

938 (
	`__ex‹nsiÚ__
 ({ 
	`__ty³of__
 (
x
è
__x
 = (x); __ty³of__ (
y
è
__y
 = (y); \

939 !
	`isunÜd”ed
 (
__x
, 
__y
è&& __x <ğ__y; }))

	)

940 
	#i¦essg»©”
(
x
, 
y
) \

941 (
	`__ex‹nsiÚ__
 ({ 
	`__ty³of__
 (
x
è
__x
 = (x); __ty³of__ (
y
è
__y
 = (y); \

942 !
	`isunÜd”ed
 (
__x
, 
__y
è&& __x !ğ__y; }))

	)

944 
	#isunÜd”ed
(
x
, 
y
) \

945 (
	`__ex‹nsiÚ__
 ({ 
	`__ty³of__
 (
x
è
__u
 = (x); __ty³of__ (
y
è
__v
 = (y); \

946 
__u
 !ğ
__v
 && (__u !ğ__u || __v !ğ__v); }))

	)

951 #ifdeà
__USE_EXTERN_INLINES


952 
	~<b™s/m©hšlše.h
>

957 #ià
defšed
 
__FINITE_MATH_ONLY__
 && __FINITE_MATH_ONLY__ > 0

960 
	#_MdoubË_
 

	)

961 
	#__MATH_DECLARING_DOUBLE
 1

	)

962 
	#__MATH_DECLARING_FLOATN
 0

	)

963 
	#__REDIRFROM_X
(
funùiÚ
, 
»’Œªt
) \

964 
funùiÚ
 ## 
»’Œªt


	)

965 
	#__REDIRTO_X
(
funùiÚ
, 
»’Œªt
) \

966 
__
 ## 
funùiÚ
 ## 
»’Œªt
 ## 
_fš™e


	)

967 
	~<b™s/m©h-fš™e.h
>

968 #undeà
_MdoubË_


969 #undeà
__MATH_DECLARING_DOUBLE


970 #undeà
__MATH_DECLARING_FLOATN


971 #undeà
__REDIRFROM_X


972 #undeà
__REDIRTO_X


976 #ifdeà
__USE_ISOC99


979 
	#_MdoubË_
 

	)

980 
	#__MATH_DECLARING_DOUBLE
 0

	)

981 
	#__MATH_DECLARING_FLOATN
 0

	)

982 
	#__REDIRFROM_X
(
funùiÚ
, 
»’Œªt
) \

983 
funùiÚ
 ## 
f
 ## 
»’Œªt


	)

984 
	#__REDIRTO_X
(
funùiÚ
, 
»’Œªt
) \

985 
__
 ## 
funùiÚ
 ## 
f
 ## 
»’Œªt
 ## 
_fš™e


	)

986 
	~<b™s/m©h-fš™e.h
>

987 #undeà
_MdoubË_


988 #undeà
__MATH_DECLARING_DOUBLE


989 #undeà
__MATH_DECLARING_FLOATN


990 #undeà
__REDIRFROM_X


991 #undeà
__REDIRTO_X


994 #ifdeà
__MATH_DECLARE_LDOUBLE


995 
	#_MdoubË_
 

	)

996 
	#__MATH_DECLARING_DOUBLE
 0

	)

997 
	#__MATH_DECLARING_FLOATN
 0

	)

998 
	#__REDIRFROM_X
(
funùiÚ
, 
»’Œªt
) \

999 
funùiÚ
 ## 
l
 ## 
»’Œªt


	)

1000 #ifdeà
__NO_LONG_DOUBLE_MATH


1001 
	#__REDIRTO_X
(
funùiÚ
, 
»’Œªt
) \

1002 
__
 ## 
funùiÚ
 ## 
»’Œªt
 ## 
_fš™e


	)

1004 
	#__REDIRTO_X
(
funùiÚ
, 
»’Œªt
) \

1005 
__
 ## 
funùiÚ
 ## 
l
 ## 
»’Œªt
 ## 
_fš™e


	)

1007 
	~<b™s/m©h-fš™e.h
>

1008 #undeà
_MdoubË_


1009 #undeà
__MATH_DECLARING_DOUBLE


1010 #undeà
__MATH_DECLARING_FLOATN


1011 #undeà
__REDIRFROM_X


1012 #undeà
__REDIRTO_X


1019 #ià(
__HAVE_DISTINCT_FLOAT16
 || (
__HAVE_FLOAT16
 && !
defšed
 
_LIBC
)) \

1020 && 
	$__GLIBC_USE
 (
IEC_60559_TYPES_EXT
)

1021 
	#_MdoubË_
 
_Flßt16


	)

1022 
	#__MATH_DECLARING_DOUBLE
 0

	)

1023 
	#__MATH_DECLARING_FLOATN
 1

	)

1024 
	#__REDIRFROM_X
(
funùiÚ
, 
»’Œªt
) \

1025 
funùiÚ
 ## 
f16
 ## 
»’Œªt


	)

1026 #ià
__HAVE_DISTINCT_FLOAT16


1027 
	#__REDIRTO_X
(
funùiÚ
, 
»’Œªt
) \

1028 
__
 ## 
funùiÚ
 ## 
f16
 ## 
»’Œªt
 ## 
_fš™e


	)

1032 
	~<b™s/m©h-fš™e.h
>

1033 #undeà
_MdoubË_


1034 #undeà
__MATH_DECLARING_DOUBLE


1035 #undeà
__MATH_DECLARING_FLOATN


1036 #undeà
__REDIRFROM_X


1037 #undeà
__REDIRTO_X


1040 #ià(
__HAVE_DISTINCT_FLOAT32
 || (
__HAVE_FLOAT32
 && !
defšed
 
_LIBC
)) \

1041 && 
	$__GLIBC_USE
 (
IEC_60559_TYPES_EXT
)

1042 
	#_MdoubË_
 
_Flßt32


	)

1043 
	#__MATH_DECLARING_DOUBLE
 0

	)

1044 
	#__MATH_DECLARING_FLOATN
 1

	)

1045 
	#__REDIRFROM_X
(
funùiÚ
, 
»’Œªt
) \

1046 
funùiÚ
 ## 
f32
 ## 
»’Œªt


	)

1047 #ià
__HAVE_DISTINCT_FLOAT32


1048 
	#__REDIRTO_X
(
funùiÚ
, 
»’Œªt
) \

1049 
__
 ## 
funùiÚ
 ## 
f32
 ## 
»’Œªt
 ## 
_fš™e


	)

1051 
	#__REDIRTO_X
(
funùiÚ
, 
»’Œªt
) \

1052 
__
 ## 
funùiÚ
 ## 
f
 ## 
»’Œªt
 ## 
_fš™e


	)

1054 
	~<b™s/m©h-fš™e.h
>

1055 #undeà
_MdoubË_


1056 #undeà
__MATH_DECLARING_DOUBLE


1057 #undeà
__MATH_DECLARING_FLOATN


1058 #undeà
__REDIRFROM_X


1059 #undeà
__REDIRTO_X


1062 #ià(
__HAVE_DISTINCT_FLOAT64
 || (
__HAVE_FLOAT64
 && !
defšed
 
_LIBC
)) \

1063 && 
	$__GLIBC_USE
 (
IEC_60559_TYPES_EXT
)

1064 
	#_MdoubË_
 
_Flßt64


	)

1065 
	#__MATH_DECLARING_DOUBLE
 0

	)

1066 
	#__MATH_DECLARING_FLOATN
 1

	)

1067 
	#__REDIRFROM_X
(
funùiÚ
, 
»’Œªt
) \

1068 
funùiÚ
 ## 
f64
 ## 
»’Œªt


	)

1069 #ià
__HAVE_DISTINCT_FLOAT64


1070 
	#__REDIRTO_X
(
funùiÚ
, 
»’Œªt
) \

1071 
__
 ## 
funùiÚ
 ## 
f64
 ## 
»’Œªt
 ## 
_fš™e


	)

1073 
	#__REDIRTO_X
(
funùiÚ
, 
»’Œªt
) \

1074 
__
 ## 
funùiÚ
 ## 
»’Œªt
 ## 
_fš™e


	)

1076 
	~<b™s/m©h-fš™e.h
>

1077 #undeà
_MdoubË_


1078 #undeà
__MATH_DECLARING_DOUBLE


1079 #undeà
__MATH_DECLARING_FLOATN


1080 #undeà
__REDIRFROM_X


1081 #undeà
__REDIRTO_X


1084 #ià(
__HAVE_DISTINCT_FLOAT128
 || (
__HAVE_FLOAT128
 && !
defšed
 
_LIBC
)) \

1085 && 
	$__GLIBC_USE
 (
IEC_60559_TYPES_EXT
)

1086 
	#_MdoubË_
 
_Flßt128


	)

1087 
	#__MATH_DECLARING_DOUBLE
 0

	)

1088 
	#__MATH_DECLARING_FLOATN
 1

	)

1089 
	#__REDIRFROM_X
(
funùiÚ
, 
»’Œªt
) \

1090 
funùiÚ
 ## 
f128
 ## 
»’Œªt


	)

1091 #ià
__HAVE_DISTINCT_FLOAT128


1092 
	#__REDIRTO_X
(
funùiÚ
, 
»’Œªt
) \

1093 
__
 ## 
funùiÚ
 ## 
f128
 ## 
»’Œªt
 ## 
_fš™e


	)

1095 
	#__REDIRTO_X
(
funùiÚ
, 
»’Œªt
) \

1096 
__
 ## 
funùiÚ
 ## 
l
 ## 
»’Œªt
 ## 
_fš™e


	)

1098 
	~<b™s/m©h-fš™e.h
>

1099 #undeà
_MdoubË_


1100 #undeà
__MATH_DECLARING_DOUBLE


1101 #undeà
__MATH_DECLARING_FLOATN


1102 #undeà
__REDIRFROM_X


1103 #undeà
__REDIRTO_X


1106 #ià(
__HAVE_DISTINCT_FLOAT32X
 || (
__HAVE_FLOAT32X
 && !
defšed
 
_LIBC
)) \

1107 && 
	$__GLIBC_USE
 (
IEC_60559_TYPES_EXT
)

1108 
	#_MdoubË_
 
_Flßt32x


	)

1109 
	#__MATH_DECLARING_DOUBLE
 0

	)

1110 
	#__MATH_DECLARING_FLOATN
 1

	)

1111 
	#__REDIRFROM_X
(
funùiÚ
, 
»’Œªt
) \

1112 
funùiÚ
 ## 
f32x
 ## 
»’Œªt


	)

1113 #ià
__HAVE_DISTINCT_FLOAT32X


1114 
	#__REDIRTO_X
(
funùiÚ
, 
»’Œªt
) \

1115 
__
 ## 
funùiÚ
 ## 
f32x
 ## 
»’Œªt
 ## 
_fš™e


	)

1117 
	#__REDIRTO_X
(
funùiÚ
, 
»’Œªt
) \

1118 
__
 ## 
funùiÚ
 ## 
»’Œªt
 ## 
_fš™e


	)

1120 
	~<b™s/m©h-fš™e.h
>

1121 #undeà
_MdoubË_


1122 #undeà
__MATH_DECLARING_DOUBLE


1123 #undeà
__MATH_DECLARING_FLOATN


1124 #undeà
__REDIRFROM_X


1125 #undeà
__REDIRTO_X


1128 #ià(
__HAVE_DISTINCT_FLOAT64X
 || (
__HAVE_FLOAT64X
 && !
defšed
 
_LIBC
)) \

1129 && 
	$__GLIBC_USE
 (
IEC_60559_TYPES_EXT
)

1130 
	#_MdoubË_
 
_Flßt64x


	)

1131 
	#__MATH_DECLARING_DOUBLE
 0

	)

1132 
	#__MATH_DECLARING_FLOATN
 1

	)

1133 
	#__REDIRFROM_X
(
funùiÚ
, 
»’Œªt
) \

1134 
funùiÚ
 ## 
f64x
 ## 
»’Œªt


	)

1135 #ià
__HAVE_DISTINCT_FLOAT64X


1136 
	#__REDIRTO_X
(
funùiÚ
, 
»’Œªt
) \

1137 
__
 ## 
funùiÚ
 ## 
f64x
 ## 
»’Œªt
 ## 
_fš™e


	)

1138 #–ià
__HAVE_FLOAT64X_LONG_DOUBLE


1139 
	#__REDIRTO_X
(
funùiÚ
, 
»’Œªt
) \

1140 
__
 ## 
funùiÚ
 ## 
l
 ## 
»’Œªt
 ## 
_fš™e


	)

1142 
	#__REDIRTO_X
(
funùiÚ
, 
»’Œªt
) \

1143 
__
 ## 
funùiÚ
 ## 
f128
 ## 
»’Œªt
 ## 
_fš™e


	)

1145 
	~<b™s/m©h-fš™e.h
>

1146 #undeà
_MdoubË_


1147 #undeà
__MATH_DECLARING_DOUBLE


1148 #undeà
__MATH_DECLARING_FLOATN


1149 #undeà
__REDIRFROM_X


1150 #undeà
__REDIRTO_X


1153 #ià(
__HAVE_DISTINCT_FLOAT128X
 || (
__HAVE_FLOAT128X
 && !
defšed
 
_LIBC
)) \

1154 && 
	$__GLIBC_USE
 (
IEC_60559_TYPES_EXT
)

1155 
	#_MdoubË_
 
_Flßt128x


	)

1156 
	#__MATH_DECLARING_DOUBLE
 0

	)

1157 
	#__MATH_DECLARING_FLOATN
 1

	)

1158 
	#__REDIRFROM_X
(
funùiÚ
, 
»’Œªt
) \

1159 
funùiÚ
 ## 
f128x
 ## 
»’Œªt


	)

1160 #ià
__HAVE_DISTINCT_FLOAT128X


1161 
	#__REDIRTO_X
(
funùiÚ
, 
»’Œªt
) \

1162 
__
 ## 
funùiÚ
 ## 
f128x
 ## 
»’Œªt
 ## 
_fš™e


	)

1166 
	~<b™s/m©h-fš™e.h
>

1167 #undeà
_MdoubË_


1168 #undeà
__MATH_DECLARING_DOUBLE


1169 #undeà
__MATH_DECLARING_FLOATN


1170 #undeà
__REDIRFROM_X


1171 #undeà
__REDIRTO_X


1176 #ià
	`__GLIBC_USE
 (
IEC_60559_BFP_EXT
)

1179 #ià
__FLT_EVAL_METHOD__
 == 2 || __FLT_EVAL_METHOD__ > 64

1180 
	#__MATH_EVAL_FMT2
(
x
, 
y
è((xè+ (yè+ 0.0L)

	)

1181 #–ià
__FLT_EVAL_METHOD__
 == 1 || __FLT_EVAL_METHOD__ > 32

1182 
	#__MATH_EVAL_FMT2
(
x
, 
y
è((xè+ (yè+ 0.0)

	)

1183 #–ià
__FLT_EVAL_METHOD__
 == 0 || __FLT_EVAL_METHOD__ == 32

1184 
	#__MATH_EVAL_FMT2
(
x
, 
y
è((xè+ (yè+ 0.0f)

	)

1186 
	#__MATH_EVAL_FMT2
(
x
, 
y
è((xè+ (y))

	)

1191 #ià!
defšed
 
__ılu¥lus
 || (__ılu¥lu < 201103L && !defšed 
__GNUC__
)

1192 
	#i£qsig
(
x
, 
y
) \

1193 
	`__MATH_TG
 (
	`__MATH_EVAL_FMT2
 (
x
, 
y
), 
__i£qsig
, ((x), (y)))

	)

1206 
‹m¶©e
<
ty³Çme
> 
__i£qsig_ty³
;

1208 
‹m¶©e
<> 
__i£qsig_ty³
<>

1210 
	`__ÿÎ
 (
__x
, 
__y
è
	`throw
 ()

1212  
	`__i£qsigf
 (
__x
, 
__y
);

1216 
‹m¶©e
<> 
__i£qsig_ty³
<>

1218 
	`__ÿÎ
 (
__x
, 
__y
è
	`throw
 ()

1220  
	`__i£qsig
 (
__x
, 
__y
);

1224 
‹m¶©e
<> 
__i£qsig_ty³
<>

1226 
	`__ÿÎ
 (
__x
, 
__y
è
	`throw
 ()

1228 #iâdeà
__NO_LONG_DOUBLE_MATH


1229  
	`__i£qsigl
 (
__x
, 
__y
);

1231  
	`__i£qsig
 (
__x
, 
__y
);

1236 #ià
__HAVE_DISTINCT_FLOAT128


1237 
‹m¶©e
<> 
__i£qsig_ty³
<
_Flßt128
>

1239 
	`__ÿÎ
 (
_Flßt128
 
__x
, _Flßt128 
__y
è
	`throw
 ()

1241  
	`__i£qsigf128
 (
__x
, 
__y
);

1246 
‹m¶©e
<
ty³Çme
 
_T1
,y³Çm
_T2
>

1247 
šlše
 

1248 
	`i£qsig
 (
_T1
 
__x
, 
_T2
 
__y
è
	`throw
 ()

1250 #ià
__ılu¥lus
 >= 201103L

1251 
	`deşty³
 (
	t__MATH_EVAL_FMT2
 (
	t__x
, 
	t__y
)è
	t_T3
;

1253 
	`__ty³of
 (
	t__MATH_EVAL_FMT2
 (
	t__x
, 
	t__y
)è
	t_T3
;

1255  
__i£qsig_ty³
<
_T3
>::
	`__ÿÎ
 (
__x
, 
__y
);

1258 
	}
}

1263 
__END_DECLS


	@/usr/include/memory.h

22 #iâdef 
_MEMORY_H


23 
	#_MEMORY_H
 1

	)

25 
	~<ã©u»s.h
>

28 #iâdef 
_STRING_H


29 
	~<¡ršg.h
>

	@/usr/include/netdb.h

22 #iâdef 
_NETDB_H


23 
	#_NETDB_H
 1

	)

25 
	~<ã©u»s.h
>

27 
	~<Ãtš‘/š.h
>

28 
	~<b™s/¡dšt-ušŠ.h
>

29 #ifdeà
__USE_MISC


32 
	~<½c/Ãtdb.h
>

35 #ifdeà
__USE_GNU


36 
	~<b™s/ty³s/sigev’t_t.h
>

37 
	~<b™s/ty³s/¡ruù_time¥ec.h
>

40 
	~<b™s/Ãtdb.h
>

43 
	#_PATH_HEQUIV
 "/‘c/ho¡s.equiv"

	)

44 
	#_PATH_HOSTS
 "/‘c/ho¡s"

	)

45 
	#_PATH_NETWORKS
 "/‘c/ÃtwÜks"

	)

46 
	#_PATH_NSSWITCH_CONF
 "/‘c/nssw™ch.cÚf"

	)

47 
	#_PATH_PROTOCOLS
 "/‘c/´ÙocŞs"

	)

48 
	#_PATH_SERVICES
 "/‘c/£rviûs"

	)

51 
	g__BEGIN_DECLS


53 #ià
defšed
 
__USE_MISC
 || !defšed 
__USE_XOPEN2K8


56 
	#h_”ºo
 (*
	`__h_”ºo_loÿtiÚ
 ())

	)

59 *
	$__h_”ºo_loÿtiÚ
 (è
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
));

63 
	#HOST_NOT_FOUND
 1

	)

64 
	#TRY_AGAIN
 2

	)

66 
	#NO_RECOVERY
 3

	)

68 
	#NO_DATA
 4

	)

71 #ifdeà
__USE_MISC


72 
	#NETDB_INTERNAL
 -1

	)

73 
	#NETDB_SUCCESS
 0

	)

74 
	#NO_ADDRESS
 
NO_DATA


	)

77 #ià
defšed
 
__USE_XOPEN2K
 || defšed 
__USE_XOPEN_EXTENDED


79 
	#IPPORT_RESERVED
 1024

	)

82 #ifdeà
__USE_GNU


84 
	#SCOPE_DELIMITER
 '%'

	)

87 #ifdeà
__USE_MISC


90 
	$h”rÜ
 (cÚ¡ *
__¡r
è
__THROW
;

93 cÚ¡ *
	$h¡»¼Ü
 (
__”r_num
è
__THROW
;

98 
	sho¡’t


100 *
h_Çme
;

101 **
h_®Ÿ£s
;

102 
h_add¹y³
;

103 
h_Ëngth
;

104 **
h_addr_li¡
;

105 #ifdeà
__USE_MISC


106 
	#h_addr
 
h_addr_li¡
[0]

	)

115 
	`£tho¡’t
 (
__¡ay_İ’
);

121 
	`’dho¡’t
 ();

128 
ho¡’t
 *
	`g‘ho¡’t
 ();

135 
ho¡’t
 *
	`g‘ho¡byaddr
 (cÚ¡ *
__addr
, 
__sockËn_t
 
__Ën
,

136 
__ty³
);

142 
ho¡’t
 *
	`g‘ho¡byÇme
 (cÚ¡ *
__Çme
);

144 #ifdeà
__USE_MISC


153 
ho¡’t
 *
	`g‘ho¡byÇme2
 (cÚ¡ *
__Çme
, 
__af
);

165 
	`g‘ho¡’t_r
 (
ho¡’t
 *
__»¡riù
 
__»suÉ_buf
,

166 *
__»¡riù
 
__buf
, 
size_t
 
__buæ’
,

167 
ho¡’t
 **
__»¡riù
 
__»suÉ
,

168 *
__»¡riù
 
__h_”ºİ
);

170 
	`g‘ho¡byaddr_r
 (cÚ¡ *
__»¡riù
 
__addr
, 
__sockËn_t
 
__Ën
,

171 
__ty³
,

172 
ho¡’t
 *
__»¡riù
 
__»suÉ_buf
,

173 *
__»¡riù
 
__buf
, 
size_t
 
__buæ’
,

174 
ho¡’t
 **
__»¡riù
 
__»suÉ
,

175 *
__»¡riù
 
__h_”ºİ
);

177 
	`g‘ho¡byÇme_r
 (cÚ¡ *
__»¡riù
 
__Çme
,

178 
ho¡’t
 *
__»¡riù
 
__»suÉ_buf
,

179 *
__»¡riù
 
__buf
, 
size_t
 
__buæ’
,

180 
ho¡’t
 **
__»¡riù
 
__»suÉ
,

181 *
__»¡riù
 
__h_”ºİ
);

183 
	`g‘ho¡byÇme2_r
 (cÚ¡ *
__»¡riù
 
__Çme
, 
__af
,

184 
ho¡’t
 *
__»¡riù
 
__»suÉ_buf
,

185 *
__»¡riù
 
__buf
, 
size_t
 
__buæ’
,

186 
ho¡’t
 **
__»¡riù
 
__»suÉ
,

187 *
__»¡riù
 
__h_”ºİ
);

196 
	`£Š‘’t
 (
__¡ay_İ’
);

202 
	`’dÃ‹Á
 ();

209 
Ã‹Á
 *
	`g‘Ã‹Á
 ();

216 
Ã‹Á
 *
	`g‘Ãtbyaddr
 (
ušt32_t
 
__Ãt
, 
__ty³
);

222 
Ã‹Á
 *
	`g‘ÃtbyÇme
 (cÚ¡ *
__Çme
);

224 #ifdef 
__USE_MISC


235 
	`g‘Ã‹Á_r
 (
Ã‹Á
 *
__»¡riù
 
__»suÉ_buf
,

236 *
__»¡riù
 
__buf
, 
size_t
 
__buæ’
,

237 
Ã‹Á
 **
__»¡riù
 
__»suÉ
,

238 *
__»¡riù
 
__h_”ºİ
);

240 
	`g‘Ãtbyaddr_r
 (
ušt32_t
 
__Ãt
, 
__ty³
,

241 
Ã‹Á
 *
__»¡riù
 
__»suÉ_buf
,

242 *
__»¡riù
 
__buf
, 
size_t
 
__buæ’
,

243 
Ã‹Á
 **
__»¡riù
 
__»suÉ
,

244 *
__»¡riù
 
__h_”ºİ
);

246 
	`g‘ÃtbyÇme_r
 (cÚ¡ *
__»¡riù
 
__Çme
,

247 
Ã‹Á
 *
__»¡riù
 
__»suÉ_buf
,

248 *
__»¡riù
 
__buf
, 
size_t
 
__buæ’
,

249 
Ã‹Á
 **
__»¡riù
 
__»suÉ
,

250 *
__»¡riù
 
__h_”ºİ
);

255 
	s£rv’t


257 *
s_Çme
;

258 **
s_®Ÿ£s
;

259 
s_pÜt
;

260 *
s_´Ùo
;

268 
	`£t£rv’t
 (
__¡ay_İ’
);

274 
	`’d£rv’t
 ();

281 
£rv’t
 *
	`g‘£rv’t
 ();

288 
£rv’t
 *
	`g‘£rvbyÇme
 (cÚ¡ *
__Çme
, cÚ¡ *
__´Ùo
);

295 
£rv’t
 *
	`g‘£rvbypÜt
 (
__pÜt
, cÚ¡ *
__´Ùo
);

298 #ifdef 
__USE_MISC


306 
	`g‘£rv’t_r
 (
£rv’t
 *
__»¡riù
 
__»suÉ_buf
,

307 *
__»¡riù
 
__buf
, 
size_t
 
__buæ’
,

308 
£rv’t
 **
__»¡riù
 
__»suÉ
);

310 
	`g‘£rvbyÇme_r
 (cÚ¡ *
__»¡riù
 
__Çme
,

311 cÚ¡ *
__»¡riù
 
__´Ùo
,

312 
£rv’t
 *
__»¡riù
 
__»suÉ_buf
,

313 *
__»¡riù
 
__buf
, 
size_t
 
__buæ’
,

314 
£rv’t
 **
__»¡riù
 
__»suÉ
);

316 
	`g‘£rvbypÜt_r
 (
__pÜt
, cÚ¡ *
__»¡riù
 
__´Ùo
,

317 
£rv’t
 *
__»¡riù
 
__»suÉ_buf
,

318 *
__»¡riù
 
__buf
, 
size_t
 
__buæ’
,

319 
£rv’t
 **
__»¡riù
 
__»suÉ
);

324 
	s´ÙÛÁ


326 *
p_Çme
;

327 **
p_®Ÿ£s
;

328 
p_´Ùo
;

336 
	`£rÙÛÁ
 (
__¡ay_İ’
);

342 
	`’d´ÙÛÁ
 ();

349 
´ÙÛÁ
 *
	`g‘´ÙÛÁ
 ();

355 
´ÙÛÁ
 *
	`g‘´ÙobyÇme
 (cÚ¡ *
__Çme
);

361 
´ÙÛÁ
 *
	`g‘´Ùobynumb”
 (
__´Ùo
);

364 #ifdef 
__USE_MISC


372 
	`g‘´ÙÛÁ_r
 (
´ÙÛÁ
 *
__»¡riù
 
__»suÉ_buf
,

373 *
__»¡riù
 
__buf
, 
size_t
 
__buæ’
,

374 
´ÙÛÁ
 **
__»¡riù
 
__»suÉ
);

376 
	`g‘´ÙobyÇme_r
 (cÚ¡ *
__»¡riù
 
__Çme
,

377 
´ÙÛÁ
 *
__»¡riù
 
__»suÉ_buf
,

378 *
__»¡riù
 
__buf
, 
size_t
 
__buæ’
,

379 
´ÙÛÁ
 **
__»¡riù
 
__»suÉ
);

381 
	`g‘´Ùobynumb”_r
 (
__´Ùo
,

382 
´ÙÛÁ
 *
__»¡riù
 
__»suÉ_buf
,

383 *
__»¡riù
 
__buf
, 
size_t
 
__buæ’
,

384 
´ÙÛÁ
 **
__»¡riù
 
__»suÉ
);

393 
	`£Š‘g»Á
 (cÚ¡ *
__Ãtgroup
);

401 
	`’dÃtg»Á
 ();

410 
	`g‘Ãtg»Á
 (**
__»¡riù
 
__ho¡p
,

411 **
__»¡riù
 
__u£½
,

412 **
__»¡riù
 
__domašp
);

421 
	`šÃtgr
 (cÚ¡ *
__Ãtgroup
, cÚ¡ *
__ho¡
,

422 cÚ¡ *
__u£r
, cÚ¡ *
__domaš
);

430 
	`g‘Ãtg»Á_r
 (**
__»¡riù
 
__ho¡p
,

431 **
__»¡riù
 
__u£½
,

432 **
__»¡riù
 
__domašp
,

433 *
__»¡riù
 
__bufãr
, 
size_t
 
__buæ’
);

437 #ifdeà
__USE_MISC


449 
	`rcmd
 (**
__»¡riù
 
__aho¡
, 
__½Üt
,

450 cÚ¡ *
__»¡riù
 
__locu£r
,

451 cÚ¡ *
__»¡riù
 
__»mu£r
,

452 cÚ¡ *
__»¡riù
 
__cmd
, *__»¡riù 
__fd2p
);

461 
	`rcmd_af
 (**
__»¡riù
 
__aho¡
, 
__½Üt
,

462 cÚ¡ *
__»¡riù
 
__locu£r
,

463 cÚ¡ *
__»¡riù
 
__»mu£r
,

464 cÚ¡ *
__»¡riù
 
__cmd
, *__»¡riù 
__fd2p
,

465 
§_çmy_t
 
__af
);

477 
	`»xec
 (**
__»¡riù
 
__aho¡
, 
__½Üt
,

478 cÚ¡ *
__»¡riù
 
__Çme
,

479 cÚ¡ *
__»¡riù
 
__·ss
,

480 cÚ¡ *
__»¡riù
 
__cmd
, *__»¡riù 
__fd2p
);

489 
	`»xec_af
 (**
__»¡riù
 
__aho¡
, 
__½Üt
,

490 cÚ¡ *
__»¡riù
 
__Çme
,

491 cÚ¡ *
__»¡riù
 
__·ss
,

492 cÚ¡ *
__»¡riù
 
__cmd
, *__»¡riù 
__fd2p
,

493 
§_çmy_t
 
__af
);

503 
	`ru£rok
 (cÚ¡ *
__rho¡
, 
__su£r
,

504 cÚ¡ *
__»mu£r
, cÚ¡ *
__locu£r
);

513 
	`ru£rok_af
 (cÚ¡ *
__rho¡
, 
__su£r
,

514 cÚ¡ *
__»mu£r
, cÚ¡ *
__locu£r
,

515 
§_çmy_t
 
__af
);

526 
	`œu£rok
 (
ušt32_t
 
__¿ddr
, 
__su£r
,

527 cÚ¡ *
__»mu£r
, cÚ¡ *
__locu£r
);

537 
	`œu£rok_af
 (cÚ¡ *
__¿ddr
, 
__su£r
,

538 cÚ¡ *
__»mu£r
, cÚ¡ *
__locu£r
,

539 
§_çmy_t
 
__af
);

549 
	`¼esvpÜt
 (*
__®pÜt
);

558 
	`¼esvpÜt_af
 (*
__®pÜt
, 
§_çmy_t
 
__af
);

563 #ifdeà
__USE_XOPEN2K


565 
	saddršfo


567 
ai_æags
;

568 
ai_çmy
;

569 
ai_sockty³
;

570 
ai_´ÙocŞ
;

571 
sockËn_t
 
ai_add¾’
;

572 
sockaddr
 *
ai_addr
;

573 *
ai_ÿnÚÇme
;

574 
addršfo
 *
ai_Ãxt
;

577 #ifdeà
__USE_GNU


579 
	sgaicb


581 cÚ¡ *
¬_Çme
;

582 cÚ¡ *
¬_£rviû
;

583 cÚ¡ 
addršfo
 *
¬_»que¡
;

584 
addršfo
 *
¬_»suÉ
;

586 
__»tuº
;

587 
__glibc_»£rved
[5];

591 
	#GAI_WAIT
 0

	)

592 
	#GAI_NOWAIT
 1

	)

596 
	#AI_PASSIVE
 0x0001

	)

597 
	#AI_CANONNAME
 0x0002

	)

598 
	#AI_NUMERICHOST
 0x0004

	)

599 
	#AI_V4MAPPED
 0x0008

	)

600 
	#AI_ALL
 0x0010

	)

601 
	#AI_ADDRCONFIG
 0x0020

	)

603 #ifdeà
__USE_GNU


604 
	#AI_IDN
 0x0040

	)

607 
	#AI_CANONIDN
 0x0080

	)

608 
	#AI_IDN_ALLOW_UNASSIGNED
 0x0100

	)

610 
	#AI_IDN_USE_STD3_ASCII_RULES
 0x0200

	)

613 
	#AI_NUMERICSERV
 0x0400

	)

616 
	#EAI_BADFLAGS
 -1

	)

617 
	#EAI_NONAME
 -2

	)

618 
	#EAI_AGAIN
 -3

	)

619 
	#EAI_FAIL
 -4

	)

620 
	#EAI_FAMILY
 -6

	)

621 
	#EAI_SOCKTYPE
 -7

	)

622 
	#EAI_SERVICE
 -8

	)

623 
	#EAI_MEMORY
 -10

	)

624 
	#EAI_SYSTEM
 -11

	)

625 
	#EAI_OVERFLOW
 -12

	)

626 #ifdeà
__USE_GNU


627 
	#EAI_NODATA
 -5

	)

628 
	#EAI_ADDRFAMILY
 -9

	)

629 
	#EAI_INPROGRESS
 -100

	)

630 
	#EAI_CANCELED
 -101

	)

631 
	#EAI_NOTCANCELED
 -102

	)

632 
	#EAI_ALLDONE
 -103

	)

633 
	#EAI_INTR
 -104

	)

634 
	#EAI_IDN_ENCODE
 -105

	)

637 #ifdeà
__USE_MISC


638 
	#NI_MAXHOST
 1025

	)

639 
	#NI_MAXSERV
 32

	)

642 
	#NI_NUMERICHOST
 1

	)

643 
	#NI_NUMERICSERV
 2

	)

644 
	#NI_NOFQDN
 4

	)

645 
	#NI_NAMEREQD
 8

	)

646 
	#NI_DGRAM
 16

	)

647 #ifdeà
__USE_GNU


648 
	#NI_IDN
 32

	)

649 
	#NI_IDN_ALLOW_UNASSIGNED
 64

	)

651 
	#NI_IDN_USE_STD3_ASCII_RULES
 128

	)

660 
	`g‘addršfo
 (cÚ¡ *
__»¡riù
 
__Çme
,

661 cÚ¡ *
__»¡riù
 
__£rviû
,

662 cÚ¡ 
addršfo
 *
__»¡riù
 
__»q
,

663 
addršfo
 **
__»¡riù
 
__·i
);

666 
	$ä“addršfo
 (
addršfo
 *
__ai
è
__THROW
;

669 cÚ¡ *
	$gai_¡»¼Ü
 (
__ecode
è
__THROW
;

675 
	`g‘Çmešfo
 (cÚ¡ 
sockaddr
 *
__»¡riù
 
__§
,

676 
sockËn_t
 
__§Ën
, *
__»¡riù
 
__ho¡
,

677 
sockËn_t
 
__ho¡Ën
, *
__»¡riù
 
__£rv
,

678 
sockËn_t
 
__£rvËn
, 
__æags
);

681 #ifdeà
__USE_GNU


690 
	`g‘addršfo_a
 (
__mode
, 
gaicb
 *
__li¡
[
__»¡riù_¬r
],

691 
__’t
, 
sigev’t
 *
__»¡riù
 
__sig
);

701 
	`gai_su¥’d
 (cÚ¡ 
gaicb
 *cÚ¡ 
__li¡
[], 
__’t
,

702 cÚ¡ 
time¥ec
 *
__timeout
);

705 
	$gai_”rÜ
 (
gaicb
 *
__»q
è
__THROW
;

708 
	$gai_ÿnûl
 (
gaicb
 *
__gaicbp
è
__THROW
;

711 
__END_DECLS


	@/usr/include/netinet/in.h

18 #iâdef 
_NETINET_IN_H


19 
	#_NETINET_IN_H
 1

	)

21 
	~<ã©u»s.h
>

22 
	~<b™s/¡dšt-ušŠ.h
>

23 
	~<sys/sock‘.h
>

24 
	~<b™s/ty³s.h
>

27 
__BEGIN_DECLS


30 
ušt32_t
 
	tš_addr_t
;

31 
	sš_addr


33 
š_addr_t
 
	ms_addr
;

37 
	~<b™s/š.h
>

42 
	mIPPROTO_IP
 = 0,

43 
	#IPPROTO_IP
 
IPPROTO_IP


	)

44 
	mIPPROTO_ICMP
 = 1,

45 
	#IPPROTO_ICMP
 
IPPROTO_ICMP


	)

46 
	mIPPROTO_IGMP
 = 2,

47 
	#IPPROTO_IGMP
 
IPPROTO_IGMP


	)

48 
	mIPPROTO_IPIP
 = 4,

49 
	#IPPROTO_IPIP
 
IPPROTO_IPIP


	)

50 
	mIPPROTO_TCP
 = 6,

51 
	#IPPROTO_TCP
 
IPPROTO_TCP


	)

52 
	mIPPROTO_EGP
 = 8,

53 
	#IPPROTO_EGP
 
IPPROTO_EGP


	)

54 
	mIPPROTO_PUP
 = 12,

55 
	#IPPROTO_PUP
 
IPPROTO_PUP


	)

56 
	mIPPROTO_UDP
 = 17,

57 
	#IPPROTO_UDP
 
IPPROTO_UDP


	)

58 
	mIPPROTO_IDP
 = 22,

59 
	#IPPROTO_IDP
 
IPPROTO_IDP


	)

60 
	mIPPROTO_TP
 = 29,

61 
	#IPPROTO_TP
 
IPPROTO_TP


	)

62 
	mIPPROTO_DCCP
 = 33,

63 
	#IPPROTO_DCCP
 
IPPROTO_DCCP


	)

64 
	mIPPROTO_IPV6
 = 41,

65 
	#IPPROTO_IPV6
 
IPPROTO_IPV6


	)

66 
	mIPPROTO_RSVP
 = 46,

67 
	#IPPROTO_RSVP
 
IPPROTO_RSVP


	)

68 
	mIPPROTO_GRE
 = 47,

69 
	#IPPROTO_GRE
 
IPPROTO_GRE


	)

70 
	mIPPROTO_ESP
 = 50,

71 
	#IPPROTO_ESP
 
IPPROTO_ESP


	)

72 
	mIPPROTO_AH
 = 51,

73 
	#IPPROTO_AH
 
IPPROTO_AH


	)

74 
	mIPPROTO_MTP
 = 92,

75 
	#IPPROTO_MTP
 
IPPROTO_MTP


	)

76 
	mIPPROTO_BEETPH
 = 94,

77 
	#IPPROTO_BEETPH
 
IPPROTO_BEETPH


	)

78 
	mIPPROTO_ENCAP
 = 98,

79 
	#IPPROTO_ENCAP
 
IPPROTO_ENCAP


	)

80 
	mIPPROTO_PIM
 = 103,

81 
	#IPPROTO_PIM
 
IPPROTO_PIM


	)

82 
	mIPPROTO_COMP
 = 108,

83 
	#IPPROTO_COMP
 
IPPROTO_COMP


	)

84 
	mIPPROTO_SCTP
 = 132,

85 
	#IPPROTO_SCTP
 
IPPROTO_SCTP


	)

86 
	mIPPROTO_UDPLITE
 = 136,

87 
	#IPPROTO_UDPLITE
 
IPPROTO_UDPLITE


	)

88 
	mIPPROTO_MPLS
 = 137,

89 
	#IPPROTO_MPLS
 
IPPROTO_MPLS


	)

90 
	mIPPROTO_RAW
 = 255,

91 
	#IPPROTO_RAW
 
IPPROTO_RAW


	)

92 
	mIPPROTO_MAX


98 #ià!
__USE_KERNEL_IPV6_DEFS


101 
	mIPPROTO_HOPOPTS
 = 0,

102 
	#IPPROTO_HOPOPTS
 
IPPROTO_HOPOPTS


	)

103 
	mIPPROTO_ROUTING
 = 43,

104 
	#IPPROTO_ROUTING
 
IPPROTO_ROUTING


	)

105 
	mIPPROTO_FRAGMENT
 = 44,

106 
	#IPPROTO_FRAGMENT
 
IPPROTO_FRAGMENT


	)

107 
	mIPPROTO_ICMPV6
 = 58,

108 
	#IPPROTO_ICMPV6
 
IPPROTO_ICMPV6


	)

109 
	mIPPROTO_NONE
 = 59,

110 
	#IPPROTO_NONE
 
IPPROTO_NONE


	)

111 
	mIPPROTO_DSTOPTS
 = 60,

112 
	#IPPROTO_DSTOPTS
 
IPPROTO_DSTOPTS


	)

113 
	mIPPROTO_MH
 = 135

114 
	#IPPROTO_MH
 
IPPROTO_MH


	)

119 
ušt16_t
 
	tš_pÜt_t
;

124 
	mIPPORT_ECHO
 = 7,

125 
	mIPPORT_DISCARD
 = 9,

126 
	mIPPORT_SYSTAT
 = 11,

127 
	mIPPORT_DAYTIME
 = 13,

128 
	mIPPORT_NETSTAT
 = 15,

129 
	mIPPORT_FTP
 = 21,

130 
	mIPPORT_TELNET
 = 23,

131 
	mIPPORT_SMTP
 = 25,

132 
	mIPPORT_TIMESERVER
 = 37,

133 
	mIPPORT_NAMESERVER
 = 42,

134 
	mIPPORT_WHOIS
 = 43,

135 
	mIPPORT_MTP
 = 57,

137 
	mIPPORT_TFTP
 = 69,

138 
	mIPPORT_RJE
 = 77,

139 
	mIPPORT_FINGER
 = 79,

140 
	mIPPORT_TTYLINK
 = 87,

141 
	mIPPORT_SUPDUP
 = 95,

144 
	mIPPORT_EXECSERVER
 = 512,

145 
	mIPPORT_LOGINSERVER
 = 513,

146 
	mIPPORT_CMDSERVER
 = 514,

147 
	mIPPORT_EFSSERVER
 = 520,

150 
	mIPPORT_BIFFUDP
 = 512,

151 
	mIPPORT_WHOSERVER
 = 513,

152 
	mIPPORT_ROUTESERVER
 = 520,

155 
	mIPPORT_RESERVED
 = 1024,

158 
	mIPPORT_USERRESERVED
 = 5000

166 
	#IN_CLASSA
(
a
è((((
š_addr_t
)×)è& 0x80000000è=ğ0)

	)

167 
	#IN_CLASSA_NET
 0xff000000

	)

168 
	#IN_CLASSA_NSHIFT
 24

	)

169 
	#IN_CLASSA_HOST
 (0xfffffffà& ~
IN_CLASSA_NET
)

	)

170 
	#IN_CLASSA_MAX
 128

	)

172 
	#IN_CLASSB
(
a
è((((
š_addr_t
)×)è& 0xc0000000è=ğ0x80000000)

	)

173 
	#IN_CLASSB_NET
 0xffff0000

	)

174 
	#IN_CLASSB_NSHIFT
 16

	)

175 
	#IN_CLASSB_HOST
 (0xfffffffà& ~
IN_CLASSB_NET
)

	)

176 
	#IN_CLASSB_MAX
 65536

	)

178 
	#IN_CLASSC
(
a
è((((
š_addr_t
)×)è& 0xe0000000è=ğ0xc0000000)

	)

179 
	#IN_CLASSC_NET
 0xffffff00

	)

180 
	#IN_CLASSC_NSHIFT
 8

	)

181 
	#IN_CLASSC_HOST
 (0xfffffffà& ~
IN_CLASSC_NET
)

	)

183 
	#IN_CLASSD
(
a
è((((
š_addr_t
)×)è& 0xf0000000è=ğ0xe0000000)

	)

184 
	#IN_MULTICAST
(
a
è
	`IN_CLASSD
×)

	)

186 
	#IN_EXPERIMENTAL
(
a
è((((
š_addr_t
)×)è& 0xe0000000è=ğ0xe0000000)

	)

187 
	#IN_BADCLASS
(
a
è((((
š_addr_t
)×)è& 0xf0000000è=ğ0xf0000000)

	)

190 
	#INADDR_ANY
 ((
š_addr_t
è0x00000000)

	)

192 
	#INADDR_BROADCAST
 ((
š_addr_t
è0xffffffff)

	)

194 
	#INADDR_NONE
 ((
š_addr_t
è0xffffffff)

	)

197 
	#IN_LOOPBACKNET
 127

	)

199 #iâdeà
INADDR_LOOPBACK


200 
	#INADDR_LOOPBACK
 ((
š_addr_t
è0x7f000001è

	)

204 
	#INADDR_UNSPEC_GROUP
 ((
š_addr_t
è0xe0000000è

	)

205 
	#INADDR_ALLHOSTS_GROUP
 ((
š_addr_t
è0xe0000001è

	)

206 
	#INADDR_ALLRTRS_GROUP
 ((
š_addr_t
è0xe0000002è

	)

207 
	#INADDR_MAX_LOCAL_GROUP
 ((
š_addr_t
è0xe00000ffè

	)

209 #ià!
__USE_KERNEL_IPV6_DEFS


211 
	sš6_addr


215 
ušt8_t
 
	m__u6_addr8
[16];

216 
ušt16_t
 
	m__u6_addr16
[8];

217 
ušt32_t
 
	m__u6_addr32
[4];

218 } 
	m__š6_u
;

219 
	#s6_addr
 
__š6_u
.
__u6_addr8


	)

220 #ifdeà
__USE_MISC


221 
	#s6_addr16
 
__š6_u
.
__u6_addr16


	)

222 
	#s6_addr32
 
__š6_u
.
__u6_addr32


	)

227 cÚ¡ 
š6_addr
 
š6addr_ªy
;

228 cÚ¡ 
š6_addr
 
š6addr_loİback
;

229 
	#IN6ADDR_ANY_INIT
 { { { 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0 } } }

	)

230 
	#IN6ADDR_LOOPBACK_INIT
 { { { 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1 } } }

	)

232 
	#INET_ADDRSTRLEN
 16

	)

233 
	#INET6_ADDRSTRLEN
 46

	)

237 
	ssockaddr_š


239 
__SOCKADDR_COMMON
 (
sš_
);

240 
š_pÜt_t
 
	msš_pÜt
;

241 
š_addr
 
	msš_addr
;

244 
	msš_z”o
[ (
sockaddr
) -

245 
__SOCKADDR_COMMON_SIZE
 -

246  (
š_pÜt_t
) -

247  (
š_addr
)];

250 #ià!
__USE_KERNEL_IPV6_DEFS


252 
	ssockaddr_š6


254 
__SOCKADDR_COMMON
 (
sš6_
);

255 
š_pÜt_t
 
	msš6_pÜt
;

256 
ušt32_t
 
	msš6_æowšfo
;

257 
š6_addr
 
	msš6_addr
;

258 
ušt32_t
 
	msš6_scİe_id
;

262 #ifdeà
__USE_MISC


264 
	s_m»q


267 
š_addr
 
	mimr_muÉŸddr
;

270 
š_addr
 
	mimr_š‹rçû
;

273 
	s_m»q_sourû


276 
š_addr
 
	mimr_muÉŸddr
;

279 
š_addr
 
	mimr_š‹rçû
;

282 
š_addr
 
	mimr_sourûaddr
;

286 #ià!
__USE_KERNEL_IPV6_DEFS


288 
	sv6_m»q


291 
š6_addr
 
	mv6mr_muÉŸddr
;

294 
	mv6mr_š‹rçû
;

298 #ifdeà
__USE_MISC


300 
	sgroup_»q


303 
ušt32_t
 
	mgr_š‹rçû
;

306 
sockaddr_¡Üage
 
	mgr_group
;

309 
	sgroup_sourû_»q


312 
ušt32_t
 
	mg¤_š‹rçû
;

315 
sockaddr_¡Üage
 
	mg¤_group
;

318 
sockaddr_¡Üage
 
	mg¤_sourû
;

323 
	s_msf‹r


326 
š_addr
 
	mimsf_muÉŸddr
;

329 
š_addr
 
	mimsf_š‹rçû
;

332 
ušt32_t
 
	mimsf_fmode
;

335 
ušt32_t
 
	mimsf_num¤c
;

337 
š_addr
 
	mimsf_¦i¡
[1];

340 
	#IP_MSFILTER_SIZE
(
num¤c
è( (
_msf‹r
) \

341 -  (
š_addr
) \

342 + (
num¤c
è*  (
š_addr
))

	)

344 
	sgroup_f‹r


347 
ušt32_t
 
	mgf_š‹rçû
;

350 
sockaddr_¡Üage
 
	mgf_group
;

353 
ušt32_t
 
	mgf_fmode
;

356 
ušt32_t
 
	mgf_num¤c
;

358 
sockaddr_¡Üage
 
	mgf_¦i¡
[1];

361 
	#GROUP_FILTER_SIZE
(
num¤c
è( (
group_f‹r
) \

362 -  (
sockaddr_¡Üage
) \

363 + ((
num¤c
) \

364 *  (
sockaddr_¡Üage
)))

	)

374 
ušt32_t
 
	$Áohl
 (
ušt32_t
 
__ÃÚg
è
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
));

375 
ušt16_t
 
	$Áohs
 (
ušt16_t
 
__ÃtshÜt
)

376 
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
));

377 
ušt32_t
 
	$htÚl
 (
ušt32_t
 
__ho¡lÚg
)

378 
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
));

379 
ušt16_t
 
	$htÚs
 (
ušt16_t
 
__ho¡shÜt
)

380 
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
));

382 
	~<’dŸn.h
>

385 
	~<b™s/by‹sw­.h
>

386 
	~<b™s/ušŠ-id’t™y.h
>

388 #ifdeà
__OPTIMIZE__


392 #ià
__BYTE_ORDER
 =ğ
__BIG_ENDIAN


395 
	#Áohl
(
x
è
	`__ušt32_id’t™y
 (x)

	)

396 
	#Áohs
(
x
è
	`__ušt16_id’t™y
 (x)

	)

397 
	#htÚl
(
x
è
	`__ušt32_id’t™y
 (x)

	)

398 
	#htÚs
(
x
è
	`__ušt16_id’t™y
 (x)

	)

400 #ià
__BYTE_ORDER
 =ğ
__LITTLE_ENDIAN


401 
	#Áohl
(
x
è
	`__bsw­_32
 (x)

	)

402 
	#Áohs
(
x
è
	`__bsw­_16
 (x)

	)

403 
	#htÚl
(
x
è
	`__bsw­_32
 (x)

	)

404 
	#htÚs
(
x
è
	`__bsw­_16
 (x)

	)

409 #ifdeà
__GNUC__


410 
	#IN6_IS_ADDR_UNSPECIFIED
(
a
) \

411 (
__ex‹nsiÚ__
 \

412 ({ cÚ¡ 
š6_addr
 *
__a
 = (cÚ¡ š6_add¸*è(
a
); \

413 
__a
->
__š6_u
.
__u6_addr32
[0] == 0 \

414 && 
__a
->
__š6_u
.
__u6_addr32
[1] == 0 \

415 && 
__a
->
__š6_u
.
__u6_addr32
[2] == 0 \

416 && 
__a
->
__š6_u
.
__u6_addr32
[3] =ğ0; 
	}
}))

	)

418 
	#IN6_IS_ADDR_LOOPBACK
(
a
) \

419 (
__ex‹nsiÚ__
 \

420 ({ cÚ¡ 
š6_addr
 *
__a
 = (cÚ¡ š6_add¸*è(
a
); \

421 
__a
->
__š6_u
.
__u6_addr32
[0] == 0 \

422 && 
__a
->
__š6_u
.
__u6_addr32
[1] == 0 \

423 && 
__a
->
__š6_u
.
__u6_addr32
[2] == 0 \

424 && 
__a
->
__š6_u
.
__u6_addr32
[3] =ğ
	`htÚl
 (1); }))

	)

426 
	#IN6_IS_ADDR_LINKLOCAL
(
a
) \

427 (
__ex‹nsiÚ__
 \

428 ({ cÚ¡ 
š6_addr
 *
__a
 = (cÚ¡ š6_add¸*è(
a
); \

429 (
__a
->
__š6_u
.
__u6_addr32
[0] & 
	`htÚl
 (0xffc00000)è=ğhtÚÈ(0xã800000); }))

	)

431 
	#IN6_IS_ADDR_SITELOCAL
(
a
) \

432 (
__ex‹nsiÚ__
 \

433 ({ cÚ¡ 
š6_addr
 *
__a
 = (cÚ¡ š6_add¸*è(
a
); \

434 (
__a
->
__š6_u
.
__u6_addr32
[0] & 
	`htÚl
 (0xffc00000)è=ğhtÚÈ(0xãc00000); }))

	)

436 
	#IN6_IS_ADDR_V4MAPPED
(
a
) \

437 (
__ex‹nsiÚ__
 \

438 ({ cÚ¡ 
š6_addr
 *
__a
 = (cÚ¡ š6_add¸*è(
a
); \

439 
__a
->
__š6_u
.
__u6_addr32
[0] == 0 \

440 && 
__a
->
__š6_u
.
__u6_addr32
[1] == 0 \

441 && 
__a
->
__š6_u
.
__u6_addr32
[2] =ğ
	`htÚl
 (0xffff); }))

	)

443 
	#IN6_IS_ADDR_V4COMPAT
(
a
) \

444 (
__ex‹nsiÚ__
 \

445 ({ cÚ¡ 
š6_addr
 *
__a
 = (cÚ¡ š6_add¸*è(
a
); \

446 
__a
->
__š6_u
.
__u6_addr32
[0] == 0 \

447 && 
__a
->
__š6_u
.
__u6_addr32
[1] == 0 \

448 && 
__a
->
__š6_u
.
__u6_addr32
[2] == 0 \

449 && 
	`Áohl
 (
__a
->
__š6_u
.
__u6_addr32
[3]è> 1; }))

	)

451 
	#IN6_ARE_ADDR_EQUAL
(
a
,
b
) \

452 (
__ex‹nsiÚ__
 \

453 ({ cÚ¡ 
š6_addr
 *
__a
 = (cÚ¡ š6_add¸*è(
a
); \

454 cÚ¡ 
š6_addr
 *
__b
 = (cÚ¡ š6_add¸*è(
b
); \

455 
__a
->
__š6_u
.
__u6_addr32
[0] =ğ
__b
->__in6_u.__u6_addr32[0] \

456 && 
__a
->
__š6_u
.
__u6_addr32
[1] =ğ
__b
->__in6_u.__u6_addr32[1] \

457 && 
__a
->
__š6_u
.
__u6_addr32
[2] =ğ
__b
->__in6_u.__u6_addr32[2] \

458 && 
__a
->
__š6_u
.
__u6_addr32
[3] =ğ
__b
->__š6_u.__u6_addr32[3]; }))

	)

460 
	#IN6_IS_ADDR_UNSPECIFIED
(
a
) \

461 (((cÚ¡ 
ušt32_t
 *è(
a
))[0] == 0 \

462 && ((cÚ¡ 
ušt32_t
 *è(
a
))[1] == 0 \

463 && ((cÚ¡ 
ušt32_t
 *è(
a
))[2] == 0 \

464 && ((cÚ¡ 
ušt32_t
 *è(
a
))[3] =ğ0)

	)

466 
	#IN6_IS_ADDR_LOOPBACK
(
a
) \

467 (((cÚ¡ 
ušt32_t
 *è(
a
))[0] == 0 \

468 && ((cÚ¡ 
ušt32_t
 *è(
a
))[1] == 0 \

469 && ((cÚ¡ 
ušt32_t
 *è(
a
))[2] == 0 \

470 && ((cÚ¡ 
ušt32_t
 *è(
a
))[3] =ğ
	`htÚl
 (1))

	)

472 
	#IN6_IS_ADDR_LINKLOCAL
(
a
) \

473 ((((cÚ¡ 
ušt32_t
 *è(
a
))[0] & 
	`htÚl
 (0xffc00000)) \

474 =ğ
	`htÚl
 (0xã800000))

	)

476 
	#IN6_IS_ADDR_SITELOCAL
(
a
) \

477 ((((cÚ¡ 
ušt32_t
 *è(
a
))[0] & 
	`htÚl
 (0xffc00000)) \

478 =ğ
	`htÚl
 (0xãc00000))

	)

480 
	#IN6_IS_ADDR_V4MAPPED
(
a
) \

481 ((((cÚ¡ 
ušt32_t
 *è(
a
))[0] == 0) \

482 && (((cÚ¡ 
ušt32_t
 *è(
a
))[1] == 0) \

483 && (((cÚ¡ 
ušt32_t
 *è(
a
))[2] =ğ
	`htÚl
 (0xffff)))

	)

485 
	#IN6_IS_ADDR_V4COMPAT
(
a
) \

486 ((((cÚ¡ 
ušt32_t
 *è(
a
))[0] == 0) \

487 && (((cÚ¡ 
ušt32_t
 *è(
a
))[1] == 0) \

488 && (((cÚ¡ 
ušt32_t
 *è(
a
))[2] == 0) \

489 && (
	`Áohl
 (((cÚ¡ 
ušt32_t
 *è(
a
))[3]è> 1))

	)

491 
	#IN6_ARE_ADDR_EQUAL
(
a
,
b
) \

492 ((((cÚ¡ 
ušt32_t
 *è(
a
))[0] =ğ((cÚ¡ ušt32_ˆ*è(
b
))[0]) \

493 && (((cÚ¡ 
ušt32_t
 *è(
a
))[1] =ğ((cÚ¡ ušt32_ˆ*è(
b
))[1]) \

494 && (((cÚ¡ 
ušt32_t
 *è(
a
))[2] =ğ((cÚ¡ ušt32_ˆ*è(
b
))[2]) \

495 && (((cÚ¡ 
ušt32_t
 *è(
a
))[3] =ğ((cÚ¡ ušt32_ˆ*è(
b
))[3]))

	)

498 
	#IN6_IS_ADDR_MULTICAST
(
a
è(((cÚ¡ 
ušt8_t
 *è×))[0] =ğ0xff)

	)

500 #ifdeà
__USE_MISC


502 
	$bšd»svpÜt
 (
__sockfd
, 
sockaddr_š
 *
__sock_š
è
__THROW
;

505 
	$bšd»svpÜt6
 (
__sockfd
, 
sockaddr_š6
 *
__sock_š
)

506 
__THROW
;

510 
	#IN6_IS_ADDR_MC_NODELOCAL
(
a
) \

511 (
	`IN6_IS_ADDR_MULTICAST
(
a
) \

512 && ((((cÚ¡ 
ušt8_t
 *è(
a
))[1] & 0xfè=ğ0x1))

	)

514 
	#IN6_IS_ADDR_MC_LINKLOCAL
(
a
) \

515 (
	`IN6_IS_ADDR_MULTICAST
(
a
) \

516 && ((((cÚ¡ 
ušt8_t
 *è(
a
))[1] & 0xfè=ğ0x2))

	)

518 
	#IN6_IS_ADDR_MC_SITELOCAL
(
a
) \

519 (
	`IN6_IS_ADDR_MULTICAST
(
a
) \

520 && ((((cÚ¡ 
ušt8_t
 *è(
a
))[1] & 0xfè=ğ0x5))

	)

522 
	#IN6_IS_ADDR_MC_ORGLOCAL
(
a
) \

523 (
	`IN6_IS_ADDR_MULTICAST
(
a
) \

524 && ((((cÚ¡ 
ušt8_t
 *è(
a
))[1] & 0xfè=ğ0x8))

	)

526 
	#IN6_IS_ADDR_MC_GLOBAL
(
a
) \

527 (
	`IN6_IS_ADDR_MULTICAST
(
a
) \

528 && ((((cÚ¡ 
ušt8_t
 *è(
a
))[1] & 0xfè=ğ0xe))

	)

531 #ifdeà
__USE_GNU


532 
cmsghdr
;

534 #ià!
__USE_KERNEL_IPV6_DEFS


536 
	sš6_pktšfo


538 
š6_addr
 
i6_addr
;

539 
i6_ifšdex
;

543 
	s6_mtušfo


545 
sockaddr_š6
 
6m_addr
;

546 
ušt32_t
 
6m_mtu
;

551 
	$š‘6_İtiÚ_¥aû
 (
__nby‹s
)

552 
__THROW
 
__©Œibu‹_d•»ÿ‹d__
;

553 
	$š‘6_İtiÚ_š™
 (*
__bp
, 
cmsghdr
 **
__cmsgp
,

554 
__ty³
è
__THROW
 
__©Œibu‹_d•»ÿ‹d__
;

555 
	$š‘6_İtiÚ_­³nd
 (
cmsghdr
 *
__cmsg
,

556 cÚ¡ 
ušt8_t
 *
__ty³p
, 
__muÉx
,

557 
__¶usy
è
__THROW
 
__©Œibu‹_d•»ÿ‹d__
;

558 
ušt8_t
 *
	$š‘6_İtiÚ_®loc
 (
cmsghdr
 *
__cmsg
, 
__d©®’
,

559 
__muÉx
, 
__¶usy
)

560 
__THROW
 
__©Œibu‹_d•»ÿ‹d__
;

561 
	$š‘6_İtiÚ_Ãxt
 (cÚ¡ 
cmsghdr
 *
__cmsg
,

562 
ušt8_t
 **
__Œp
)

563 
__THROW
 
__©Œibu‹_d•»ÿ‹d__
;

564 
	$š‘6_İtiÚ_fšd
 (cÚ¡ 
cmsghdr
 *
__cmsg
,

565 
ušt8_t
 **
__Œp
, 
__ty³
)

566 
__THROW
 
__©Œibu‹_d•»ÿ‹d__
;

570 
	$š‘6_İt_š™
 (*
__extbuf
, 
sockËn_t
 
__ex’
è
__THROW
;

571 
	$š‘6_İt_­³nd
 (*
__extbuf
, 
sockËn_t
 
__ex’
, 
__off£t
,

572 
ušt8_t
 
__ty³
, 
sockËn_t
 
__Ën
, ušt8_ˆ
__®ign
,

573 **
__d©abuå
è
__THROW
;

574 
	$š‘6_İt_fšish
 (*
__extbuf
, 
sockËn_t
 
__ex’
, 
__off£t
)

575 
__THROW
;

576 
	$š‘6_İt_£t_v®
 (*
__d©abuf
, 
__off£t
, *
__v®
,

577 
sockËn_t
 
__v®Ën
è
__THROW
;

578 
	$š‘6_İt_Ãxt
 (*
__extbuf
, 
sockËn_t
 
__ex’
, 
__off£t
,

579 
ušt8_t
 *
__ty³p
, 
sockËn_t
 *
__ËÅ
,

580 **
__d©abuå
è
__THROW
;

581 
	$š‘6_İt_fšd
 (*
__extbuf
, 
sockËn_t
 
__ex’
, 
__off£t
,

582 
ušt8_t
 
__ty³
, 
sockËn_t
 *
__ËÅ
,

583 **
__d©abuå
è
__THROW
;

584 
	$š‘6_İt_g‘_v®
 (*
__d©abuf
, 
__off£t
, *
__v®
,

585 
sockËn_t
 
__v®Ën
è
__THROW
;

589 
sockËn_t
 
	$š‘6_¹h_¥aû
 (
__ty³
, 
__£gm’ts
è
__THROW
;

590 *
	$š‘6_¹h_š™
 (*
__bp
, 
sockËn_t
 
__bp_Ën
, 
__ty³
,

591 
__£gm’ts
è
__THROW
;

592 
	$š‘6_¹h_add
 (*
__bp
, cÚ¡ 
š6_addr
 *
__addr
è
__THROW
;

593 
	$š‘6_¹h_»v”£
 (cÚ¡ *
__š
, *
__out
è
__THROW
;

594 
	$š‘6_¹h_£gm’ts
 (cÚ¡ *
__bp
è
__THROW
;

595 
š6_addr
 *
	$š‘6_¹h_g‘addr
 (cÚ¡ *
__bp
, 
__šdex
)

596 
__THROW
;

602 
	$g‘v4sourûf‹r
 (
__s
, 
š_addr
 
__š‹rçû_addr
,

603 
š_addr
 
__group
, 
ušt32_t
 *
__fmode
,

604 
ušt32_t
 *
__num¤c
, 
š_addr
 *
__¦i¡
)

605 
__THROW
;

608 
	$£tv4sourûf‹r
 (
__s
, 
š_addr
 
__š‹rçû_addr
,

609 
š_addr
 
__group
, 
ušt32_t
 
__fmode
,

610 
ušt32_t
 
__num¤c
,

611 cÚ¡ 
š_addr
 *
__¦i¡
)

612 
__THROW
;

616 
	$g‘sourûf‹r
 (
__s
, 
ušt32_t
 
__š‹rçû_addr
,

617 cÚ¡ 
sockaddr
 *
__group
,

618 
sockËn_t
 
__grou¶’
, 
ušt32_t
 *
__fmode
,

619 
ušt32_t
 *
__num¤c
,

620 
sockaddr_¡Üage
 *
__¦i¡
è
__THROW
;

623 
	$£tsourûf‹r
 (
__s
, 
ušt32_t
 
__š‹rçû_addr
,

624 cÚ¡ 
sockaddr
 *
__group
,

625 
sockËn_t
 
__grou¶’
, 
ušt32_t
 
__fmode
,

626 
ušt32_t
 
__num¤c
,

627 cÚ¡ 
sockaddr_¡Üage
 *
__¦i¡
è
__THROW
;

630 
__END_DECLS


	@/usr/include/pthread.h

18 #iâdeà
_PTHREAD_H


19 
	#_PTHREAD_H
 1

	)

21 
	~<ã©u»s.h
>

22 
	~<’dŸn.h
>

23 
	~<sched.h
>

24 
	~<time.h
>

26 
	~<b™s/±h»adty³s.h
>

27 
	~<b™s/£tjmp.h
>

28 
	~<b™s/wÜdsize.h
>

29 
	~<b™s/ty³s/¡ruù_time¥ec.h
>

35 
	mPTHREAD_CREATE_JOINABLE
,

36 
	#PTHREAD_CREATE_JOINABLE
 
PTHREAD_CREATE_JOINABLE


	)

37 
	mPTHREAD_CREATE_DETACHED


38 
	#PTHREAD_CREATE_DETACHED
 
PTHREAD_CREATE_DETACHED


	)

45 
	mPTHREAD_MUTEX_TIMED_NP
,

46 
	mPTHREAD_MUTEX_RECURSIVE_NP
,

47 
	mPTHREAD_MUTEX_ERRORCHECK_NP
,

48 
	mPTHREAD_MUTEX_ADAPTIVE_NP


49 #ià
defšed
 
__USE_UNIX98
 || defšed 
__USE_XOPEN2K8


51 
	mPTHREAD_MUTEX_NORMAL
 = 
PTHREAD_MUTEX_TIMED_NP
,

52 
	mPTHREAD_MUTEX_RECURSIVE
 = 
PTHREAD_MUTEX_RECURSIVE_NP
,

53 
	mPTHREAD_MUTEX_ERRORCHECK
 = 
PTHREAD_MUTEX_ERRORCHECK_NP
,

54 
	mPTHREAD_MUTEX_DEFAULT
 = 
PTHREAD_MUTEX_NORMAL


56 #ifdeà
__USE_GNU


58 , 
	mPTHREAD_MUTEX_FAST_NP
 = 
PTHREAD_MUTEX_TIMED_NP


63 #ifdeà
__USE_XOPEN2K


67 
	mPTHREAD_MUTEX_STALLED
,

68 
	mPTHREAD_MUTEX_STALLED_NP
 = 
PTHREAD_MUTEX_STALLED
,

69 
	mPTHREAD_MUTEX_ROBUST
,

70 
	mPTHREAD_MUTEX_ROBUST_NP
 = 
PTHREAD_MUTEX_ROBUST


75 #ià
defšed
 
__USE_POSIX199506
 || defšed 
__USE_UNIX98


79 
	mPTHREAD_PRIO_NONE
,

80 
	mPTHREAD_PRIO_INHERIT
,

81 
	mPTHREAD_PRIO_PROTECT


86 #ià
__PTHREAD_MUTEX_HAVE_PREV


87 
	#PTHREAD_MUTEX_INITIALIZER
 \

88 { { 0, 0, 0, 0, 0, 
__PTHREAD_SPINS
, { 0, 0 } } }

	)

89 #ifdeà
__USE_GNU


90 
	#PTHREAD_RECURSIVE_MUTEX_INITIALIZER_NP
 \

91 { { 0, 0, 0, 0, 
PTHREAD_MUTEX_RECURSIVE_NP
, 
__PTHREAD_SPINS
, { 0, 0 } } }

	)

92 
	#PTHREAD_ERRORCHECK_MUTEX_INITIALIZER_NP
 \

93 { { 0, 0, 0, 0, 
PTHREAD_MUTEX_ERRORCHECK_NP
, 
__PTHREAD_SPINS
, { 0, 0 } } }

	)

94 
	#PTHREAD_ADAPTIVE_MUTEX_INITIALIZER_NP
 \

95 { { 0, 0, 0, 0, 
PTHREAD_MUTEX_ADAPTIVE_NP
, 
__PTHREAD_SPINS
, { 0, 0 } } }

	)

99 
	#PTHREAD_MUTEX_INITIALIZER
 \

100 { { 0, 0, 0, 0, 0, { 
__PTHREAD_SPINS
 } } }

	)

101 #ifdeà
__USE_GNU


102 
	#PTHREAD_RECURSIVE_MUTEX_INITIALIZER_NP
 \

103 { { 0, 0, 0, 
PTHREAD_MUTEX_RECURSIVE_NP
, 0, { 
__PTHREAD_SPINS
 } } }

	)

104 
	#PTHREAD_ERRORCHECK_MUTEX_INITIALIZER_NP
 \

105 { { 0, 0, 0, 
PTHREAD_MUTEX_ERRORCHECK_NP
, 0, { 
__PTHREAD_SPINS
 } } }

	)

106 
	#PTHREAD_ADAPTIVE_MUTEX_INITIALIZER_NP
 \

107 { { 0, 0, 0, 
PTHREAD_MUTEX_ADAPTIVE_NP
, 0, { 
__PTHREAD_SPINS
 } } }

	)

114 #ià
defšed
 
__USE_UNIX98
 || defšed 
__USE_XOPEN2K


117 
	mPTHREAD_RWLOCK_PREFER_READER_NP
,

118 
	mPTHREAD_RWLOCK_PREFER_WRITER_NP
,

119 
	mPTHREAD_RWLOCK_PREFER_WRITER_NONRECURSIVE_NP
,

120 
	mPTHREAD_RWLOCK_DEFAULT_NP
 = 
PTHREAD_RWLOCK_PREFER_READER_NP


126 #iâdeà
__PTHREAD_RWLOCK_INT_FLAGS_SHARED


127 #ià
__WORDSIZE
 == 64

128 
	#__PTHREAD_RWLOCK_INT_FLAGS_SHARED
 1

	)

133 
	#PTHREAD_RWLOCK_INITIALIZER
 \

134 { { 0, 0, 0, 0, 0, 0, 0, 0, 
__PTHREAD_RWLOCK_ELISION_EXTRA
, 0, 0 } }

	)

135 #ifdeà
__USE_GNU


136 #ifdeà
__PTHREAD_RWLOCK_INT_FLAGS_SHARED


137 
	#PTHREAD_RWLOCK_WRITER_NONRECURSIVE_INITIALIZER_NP
 \

138 { { 0, 0, 0, 0, 0, 0, 0, 0, 
__PTHREAD_RWLOCK_ELISION_EXTRA
, 0, \

139 
PTHREAD_RWLOCK_PREFER_WRITER_NONRECURSIVE_NP
 } }

	)

141 #ià
__BYTE_ORDER
 =ğ
__LITTLE_ENDIAN


142 
	#PTHREAD_RWLOCK_WRITER_NONRECURSIVE_INITIALIZER_NP
 \

143 { { 0, 0, 0, 0, 0, 0, 
PTHREAD_RWLOCK_PREFER_WRITER_NONRECURSIVE_NP
, \

144 0, 
__PTHREAD_RWLOCK_ELISION_EXTRA
, 0, 0 } }

	)

146 
	#PTHREAD_RWLOCK_WRITER_NONRECURSIVE_INITIALIZER_NP
 \

147 { { 0, 0, 0, 0, 0, 0, 0, 0, 0, 
PTHREAD_RWLOCK_PREFER_WRITER_NONRECURSIVE_NP
,\

148 0 } }

	)

158 
	mPTHREAD_INHERIT_SCHED
,

159 
	#PTHREAD_INHERIT_SCHED
 
PTHREAD_INHERIT_SCHED


	)

160 
	mPTHREAD_EXPLICIT_SCHED


161 
	#PTHREAD_EXPLICIT_SCHED
 
PTHREAD_EXPLICIT_SCHED


	)

168 
	mPTHREAD_SCOPE_SYSTEM
,

169 
	#PTHREAD_SCOPE_SYSTEM
 
PTHREAD_SCOPE_SYSTEM


	)

170 
	mPTHREAD_SCOPE_PROCESS


171 
	#PTHREAD_SCOPE_PROCESS
 
PTHREAD_SCOPE_PROCESS


	)

178 
	mPTHREAD_PROCESS_PRIVATE
,

179 
	#PTHREAD_PROCESS_PRIVATE
 
PTHREAD_PROCESS_PRIVATE


	)

180 
	mPTHREAD_PROCESS_SHARED


181 
	#PTHREAD_PROCESS_SHARED
 
PTHREAD_PROCESS_SHARED


	)

187 
	#PTHREAD_COND_INITIALIZER
 { { {0}, {0}, {0, 0}, {0, 0}, 0, 0, {0, 0} } }

	)

191 
	s_±h»ad_ş—nup_bufãr


193 (*
	m__routše
) (*);

194 *
	m__¬g
;

195 
	m__ÿnûÉy³
;

196 
_±h»ad_ş—nup_bufãr
 *
	m__´ev
;

202 
	mPTHREAD_CANCEL_ENABLE
,

203 
	#PTHREAD_CANCEL_ENABLE
 
PTHREAD_CANCEL_ENABLE


	)

204 
	mPTHREAD_CANCEL_DISABLE


205 
	#PTHREAD_CANCEL_DISABLE
 
PTHREAD_CANCEL_DISABLE


	)

209 
	mPTHREAD_CANCEL_DEFERRED
,

210 
	#PTHREAD_CANCEL_DEFERRED
 
PTHREAD_CANCEL_DEFERRED


	)

211 
	mPTHREAD_CANCEL_ASYNCHRONOUS


212 
	#PTHREAD_CANCEL_ASYNCHRONOUS
 
PTHREAD_CANCEL_ASYNCHRONOUS


	)

214 
	#PTHREAD_CANCELED
 ((*è-1)

	)

218 
	#PTHREAD_ONCE_INIT
 0

	)

221 #ifdeà
__USE_XOPEN2K


225 
	#PTHREAD_BARRIER_SERIAL_THREAD
 -1

	)

229 
__BEGIN_DECLS


234 
	$±h»ad_ü—‹
 (
±h»ad_t
 *
__»¡riù
 
__Ãwth»ad
,

235 cÚ¡ 
±h»ad_©Œ_t
 *
__»¡riù
 
__©Œ
,

236 *(*
__¡¬t_routše
) (*),

237 *
__»¡riù
 
__¬g
è
__THROWNL
 
	`__nÚnuÎ
 ((1, 3));

243 
	$±h»ad_ex™
 (*
__»tv®
è
	`__©Œibu‹__
 ((
__nÜ‘uº__
));

251 
	`±h»ad_još
 (
±h»ad_t
 
__th
, **
__th»ad_»tuº
);

253 #ifdeà
__USE_GNU


256 
	$±h»ad_Œyjoš_Å
 (
±h»ad_t
 
__th
, **
__th»ad_»tuº
è
__THROW
;

264 
	`±h»ad_timedjoš_Å
 (
±h»ad_t
 
__th
, **
__th»ad_»tuº
,

265 cÚ¡ 
time¥ec
 *
__ab¡ime
);

272 
	$±h»ad_d‘ach
 (
±h»ad_t
 
__th
è
__THROW
;

276 
±h»ad_t
 
	$±h»ad_£lf
 (è
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
));

279 
	$±h»ad_equ®
 (
±h»ad_t
 
__th»ad1
,…th»ad_ˆ
__th»ad2
)

280 
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
));

288 
	$±h»ad_©Œ_š™
 (
±h»ad_©Œ_t
 *
__©Œ
è
__THROW
 
	`__nÚnuÎ
 ((1));

291 
	$±h»ad_©Œ_de¡roy
 (
±h»ad_©Œ_t
 *
__©Œ
)

292 
__THROW
 
	`__nÚnuÎ
 ((1));

295 
	$±h»ad_©Œ_g‘d‘ach¡©e
 (cÚ¡ 
±h»ad_©Œ_t
 *
__©Œ
,

296 *
__d‘ach¡©e
)

297 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

300 
	$±h»ad_©Œ_£td‘ach¡©e
 (
±h»ad_©Œ_t
 *
__©Œ
,

301 
__d‘ach¡©e
)

302 
__THROW
 
	`__nÚnuÎ
 ((1));

306 
	$±h»ad_©Œ_g‘gu¬dsize
 (cÚ¡ 
±h»ad_©Œ_t
 *
__©Œ
,

307 
size_t
 *
__gu¬dsize
)

308 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

311 
	$±h»ad_©Œ_£tgu¬dsize
 (
±h»ad_©Œ_t
 *
__©Œ
,

312 
size_t
 
__gu¬dsize
)

313 
__THROW
 
	`__nÚnuÎ
 ((1));

317 
	$±h»ad_©Œ_g‘sched·¿m
 (cÚ¡ 
±h»ad_©Œ_t
 *
__»¡riù
 
__©Œ
,

318 
sched_·¿m
 *
__»¡riù
 
__·¿m
)

319 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

322 
	$±h»ad_©Œ_£tsched·¿m
 (
±h»ad_©Œ_t
 *
__»¡riù
 
__©Œ
,

323 cÚ¡ 
sched_·¿m
 *
__»¡riù


324 
__·¿m
è
__THROW
 
	`__nÚnuÎ
 ((1, 2));

327 
	$±h»ad_©Œ_g‘schedpŞicy
 (cÚ¡ 
±h»ad_©Œ_t
 *
__»¡riù


328 
__©Œ
, *
__»¡riù
 
__pŞicy
)

329 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

332 
	$±h»ad_©Œ_£tschedpŞicy
 (
±h»ad_©Œ_t
 *
__©Œ
, 
__pŞicy
)

333 
__THROW
 
	`__nÚnuÎ
 ((1));

336 
	$±h»ad_©Œ_g‘šh”™sched
 (cÚ¡ 
±h»ad_©Œ_t
 *
__»¡riù


337 
__©Œ
, *
__»¡riù
 
__šh”™
)

338 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

341 
	$±h»ad_©Œ_£tšh”™sched
 (
±h»ad_©Œ_t
 *
__©Œ
,

342 
__šh”™
)

343 
__THROW
 
	`__nÚnuÎ
 ((1));

347 
	$±h»ad_©Œ_g‘scİe
 (cÚ¡ 
±h»ad_©Œ_t
 *
__»¡riù
 
__©Œ
,

348 *
__»¡riù
 
__scİe
)

349 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

352 
	$±h»ad_©Œ_£tscİe
 (
±h»ad_©Œ_t
 *
__©Œ
, 
__scİe
)

353 
__THROW
 
	`__nÚnuÎ
 ((1));

356 
	$±h»ad_©Œ_g‘¡ackaddr
 (cÚ¡ 
±h»ad_©Œ_t
 *
__»¡riù


357 
__©Œ
, **
__»¡riù
 
__¡ackaddr
)

358 
__THROW
 
	`__nÚnuÎ
 ((1, 2)è
__©Œibu‹_d•»ÿ‹d__
;

364 
	$±h»ad_©Œ_£t¡ackaddr
 (
±h»ad_©Œ_t
 *
__©Œ
,

365 *
__¡ackaddr
)

366 
__THROW
 
	`__nÚnuÎ
 ((1)è
__©Œibu‹_d•»ÿ‹d__
;

369 
	$±h»ad_©Œ_g‘¡acksize
 (cÚ¡ 
±h»ad_©Œ_t
 *
__»¡riù


370 
__©Œ
, 
size_t
 *
__»¡riù
 
__¡acksize
)

371 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

376 
	$±h»ad_©Œ_£t¡acksize
 (
±h»ad_©Œ_t
 *
__©Œ
,

377 
size_t
 
__¡acksize
)

378 
__THROW
 
	`__nÚnuÎ
 ((1));

380 #ifdeà
__USE_XOPEN2K


382 
	$±h»ad_©Œ_g‘¡ack
 (cÚ¡ 
±h»ad_©Œ_t
 *
__»¡riù
 
__©Œ
,

383 **
__»¡riù
 
__¡ackaddr
,

384 
size_t
 *
__»¡riù
 
__¡acksize
)

385 
__THROW
 
	`__nÚnuÎ
 ((1, 2, 3));

390 
	$±h»ad_©Œ_£t¡ack
 (
±h»ad_©Œ_t
 *
__©Œ
, *
__¡ackaddr
,

391 
size_t
 
__¡acksize
è
__THROW
 
	`__nÚnuÎ
 ((1));

394 #ifdeà
__USE_GNU


397 
	$±h»ad_©Œ_£ffš™y_Å
 (
±h»ad_©Œ_t
 *
__©Œ
,

398 
size_t
 
__ıu£tsize
,

399 cÚ¡ 
ıu_£t_t
 *
__ıu£t
)

400 
__THROW
 
	`__nÚnuÎ
 ((1, 3));

404 
	$±h»ad_©Œ_g‘affš™y_Å
 (cÚ¡ 
±h»ad_©Œ_t
 *
__©Œ
,

405 
size_t
 
__ıu£tsize
,

406 
ıu_£t_t
 *
__ıu£t
)

407 
__THROW
 
	`__nÚnuÎ
 ((1, 3));

410 
	$±h»ad_g‘©Œ_deçuÉ_Å
 (
±h»ad_©Œ_t
 *
__©Œ
)

411 
__THROW
 
	`__nÚnuÎ
 ((1));

415 
	$±h»ad_£‰r_deçuÉ_Å
 (cÚ¡ 
±h»ad_©Œ_t
 *
__©Œ
)

416 
__THROW
 
	`__nÚnuÎ
 ((1));

421 
	$±h»ad_g‘©Œ_Å
 (
±h»ad_t
 
__th
, 
±h»ad_©Œ_t
 *
__©Œ
)

422 
__THROW
 
	`__nÚnuÎ
 ((2));

430 
	$±h»ad_£tsched·¿m
 (
±h»ad_t
 
__rg‘_th»ad
, 
__pŞicy
,

431 cÚ¡ 
sched_·¿m
 *
__·¿m
)

432 
__THROW
 
	`__nÚnuÎ
 ((3));

435 
	$±h»ad_g‘sched·¿m
 (
±h»ad_t
 
__rg‘_th»ad
,

436 *
__»¡riù
 
__pŞicy
,

437 
sched_·¿m
 *
__»¡riù
 
__·¿m
)

438 
__THROW
 
	`__nÚnuÎ
 ((2, 3));

441 
	$±h»ad_£tsched´io
 (
±h»ad_t
 
__rg‘_th»ad
, 
__´io
)

442 
__THROW
;

445 #ifdeà
__USE_GNU


447 
	$±h»ad_g‘Çme_Å
 (
±h»ad_t
 
__rg‘_th»ad
, *
__buf
,

448 
size_t
 
__buæ’
)

449 
__THROW
 
	`__nÚnuÎ
 ((2));

452 
	$±h»ad_£Šame_Å
 (
±h»ad_t
 
__rg‘_th»ad
, cÚ¡ *
__Çme
)

453 
__THROW
 
	`__nÚnuÎ
 ((2));

457 #ifdeà
__USE_UNIX98


459 
	$±h»ad_g‘cÚcu¼’cy
 (è
__THROW
;

462 
	$±h»ad_£tcÚcu¼’cy
 (
__Ëv–
è
__THROW
;

465 #ifdeà
__USE_GNU


470 
	$±h»ad_y›ld
 (è
__THROW
;

475 
	$±h»ad_£ffš™y_Å
 (
±h»ad_t
 
__th
, 
size_t
 
__ıu£tsize
,

476 cÚ¡ 
ıu_£t_t
 *
__ıu£t
)

477 
__THROW
 
	`__nÚnuÎ
 ((3));

480 
	$±h»ad_g‘affš™y_Å
 (
±h»ad_t
 
__th
, 
size_t
 
__ıu£tsize
,

481 
ıu_£t_t
 *
__ıu£t
)

482 
__THROW
 
	`__nÚnuÎ
 ((3));

495 
	$±h»ad_Úû
 (
±h»ad_Úû_t
 *
__Úû_cÚŒŞ
,

496 (*
__š™_routše
è()è
	`__nÚnuÎ
 ((1, 2));

507 
	`±h»ad_£tÿnûl¡©e
 (
__¡©e
, *
__Şd¡©e
);

511 
	`±h»ad_£tÿnûÉy³
 (
__ty³
, *
__Şdty³
);

514 
	`±h»ad_ÿnûl
 (
±h»ad_t
 
__th
);

519 
	`±h»ad_‹¡ÿnûl
 ();

528 
__jmp_buf
 
__ÿnûl_jmp_buf
;

529 
__mask_was_§ved
;

530 } 
__ÿnûl_jmp_buf
[1];

531 *
__·d
[4];

532 } 
	t__±h»ad_unwšd_buf_t
 
	t__©Œibu‹__
 ((
	t__®igÃd__
));

535 #iâdeà
__ş—nup_fù_©Œibu‹


536 
	#__ş—nup_fù_©Œibu‹


	)

541 
	s__±h»ad_ş—nup_äame


543 (*
__ÿnûl_routše
) (*);

544 *
__ÿnûl_¬g
;

545 
__do_™
;

546 
__ÿnûl_ty³
;

549 #ià
defšed
 
__GNUC__
 && defšed 
__EXCEPTIONS


550 #ifdeà
__ılu¥lus


552 şas 
	c__±h»ad_ş—nup_şass


554 (*
__ÿnûl_routše
) (*);

555 *
__ÿnûl_¬g
;

556 
__do_™
;

557 
__ÿnûl_ty³
;

559 
public
:

560 
	$__±h»ad_ş—nup_şass
 ((*
__fù
è(*), *
__¬g
)

561 : 
	`__ÿnûl_routše
 (
__fù
), 
	`__ÿnûl_¬g
 (
__¬g
), 
	$__do_™
 (1) { }

562 ~
	$__±h»ad_ş—nup_şass
 (è{ ià(
__do_™
è
	`__ÿnûl_routše
 (
__ÿnûl_¬g
); 
	}
}

563 
	$__£tdo™
 (
__Ãwv®
è{ 
__do_™
 = __Ãwv®; 
	}
}

564 
	$__deãr
 (è{ 
	`±h»ad_£tÿnûÉy³
 (
PTHREAD_CANCEL_DEFERRED
,

565 &
__ÿnûl_ty³
); 
	}
}

566 
	$__»¡Üe
 (ècÚ¡ { 
	`±h»ad_£tÿnûÉy³
 (
__ÿnûl_ty³
, 0); 
	}
}

576 
	#±h»ad_ş—nup_push
(
routše
, 
¬g
) \

578 
__±h»ad_ş—nup_şass
 
	`__şäame
 (
routše
, 
¬g
)

	)

582 
	#±h»ad_ş—nup_pİ
(
execu‹
) \

583 
__şäame
.
	`__£tdo™
 (
execu‹
); \

584 } 0)

	)

586 #ifdeà
__USE_GNU


590 
	#±h»ad_ş—nup_push_deãr_Å
(
routše
, 
¬g
) \

592 
__±h»ad_ş—nup_şass
 
	`__şäame
 (
routše
, 
¬g
); \

593 
__şäame
.
	`__deãr
 ()

	)

598 
	#±h»ad_ş—nup_pİ_»¡Üe_Å
(
execu‹
) \

599 
__şäame
.
	`__»¡Üe
 (); \

600 
__şäame
.
	`__£tdo™
 (
execu‹
); \

601 } 0)

	)

608 
__ex‹º_šlše
 

609 
	$__±h»ad_ş—nup_routše
 (
__±h»ad_ş—nup_äame
 *
__äame
)

611 ià(
__äame
->
__do_™
)

612 
__äame
->
	`__ÿnûl_routše
 (__äame->
__ÿnûl_¬g
);

613 
	}
}

622 
	#±h»ad_ş—nup_push
(
routše
, 
¬g
) \

624 
__±h»ad_ş—nup_äame
 
__şäame
 \

625 
	`__©Œibu‹__
 ((
	`__ş—nup__
 (
__±h»ad_ş—nup_routše
))) \

626 ğ{ .
__ÿnûl_routše
 = (
routše
), .
__ÿnûl_¬g
 = (
¬g
), \

627 .
__do_™
 = 1 };

	)

631 
	#±h»ad_ş—nup_pİ
(
execu‹
) \

632 
__şäame
.
__do_™
 = (
execu‹
); \

633 } 0)

	)

635 #ifdeà
__USE_GNU


639 
	#±h»ad_ş—nup_push_deãr_Å
(
routše
, 
¬g
) \

641 
__±h»ad_ş—nup_äame
 
__şäame
 \

642 
	`__©Œibu‹__
 ((
	`__ş—nup__
 (
__±h»ad_ş—nup_routše
))) \

643 ğ{ .
__ÿnûl_routše
 = (
routše
), .
__ÿnûl_¬g
 = (
¬g
), \

644 .
__do_™
 = 1 }; \

645 (è
	`±h»ad_£tÿnûÉy³
 (
PTHREAD_CANCEL_DEFERRED
, \

646 &
__şäame
.
__ÿnûl_ty³
)

	)

651 
	#±h»ad_ş—nup_pİ_»¡Üe_Å
(
execu‹
) \

652 (è
	`±h»ad_£tÿnûÉy³
 (
__şäame
.
__ÿnûl_ty³
, 
NULL
); \

653 
__şäame
.
__do_™
 = (
execu‹
); \

654 } 0)

	)

665 
	#±h»ad_ş—nup_push
(
routše
, 
¬g
) \

667 
__±h»ad_unwšd_buf_t
 
__ÿnûl_buf
; \

668 (*
__ÿnûl_routše
è(*èğ(
routše
); \

669 *
__ÿnûl_¬g
 = (
¬g
); \

670 
__nÙ_fœ¡_ÿÎ
 = 
	`__sig£tjmp
 ((
__jmp_buf_g
 *) (*) \

671 
__ÿnûl_buf
.
__ÿnûl_jmp_buf
, 0); \

672 ià(
	`__glibc_uÆik–y
 (
__nÙ_fœ¡_ÿÎ
)) \

674 
	`__ÿnûl_routše
 (
__ÿnûl_¬g
); \

675 
	`__±h»ad_unwšd_Ãxt
 (&
__ÿnûl_buf
); \

679 
	`__±h»ad_»gi¡”_ÿnûl
 (&
__ÿnûl_buf
); \

680 dØ{

	)

681 
__±h»ad_»gi¡”_ÿnûl
 (
__±h»ad_unwšd_buf_t
 *
__buf
)

682 
__ş—nup_fù_©Œibu‹
;

686 
	#±h»ad_ş—nup_pİ
(
execu‹
) \

689 
	`__±h»ad_uÄegi¡”_ÿnûl
 (&
__ÿnûl_buf
); \

690 ià(
execu‹
) \

691 
	`__ÿnûl_routše
 (
__ÿnûl_¬g
); \

692 } 0)

	)

693 
	$__±h»ad_uÄegi¡”_ÿnûl
 (
__±h»ad_unwšd_buf_t
 *
__buf
)

694 
__ş—nup_fù_©Œibu‹
;

696 #ifdeà
__USE_GNU


700 
	#±h»ad_ş—nup_push_deãr_Å
(
routše
, 
¬g
) \

702 
__±h»ad_unwšd_buf_t
 
__ÿnûl_buf
; \

703 (*
__ÿnûl_routše
è(*èğ(
routše
); \

704 *
__ÿnûl_¬g
 = (
¬g
); \

705 
__nÙ_fœ¡_ÿÎ
 = 
	`__sig£tjmp
 ((
__jmp_buf_g
 *) (*) \

706 
__ÿnûl_buf
.
__ÿnûl_jmp_buf
, 0); \

707 ià(
	`__glibc_uÆik–y
 (
__nÙ_fœ¡_ÿÎ
)) \

709 
	`__ÿnûl_routše
 (
__ÿnûl_¬g
); \

710 
	`__±h»ad_unwšd_Ãxt
 (&
__ÿnûl_buf
); \

714 
	`__±h»ad_»gi¡”_ÿnûl_deãr
 (&
__ÿnûl_buf
); \

715 dØ{

	)

716 
	`__±h»ad_»gi¡”_ÿnûl_deãr
 (
__±h»ad_unwšd_buf_t
 *
__buf
)

717 
__ş—nup_fù_©Œibu‹
;

722 
	#±h»ad_ş—nup_pİ_»¡Üe_Å
(
execu‹
) \

725 
	`__±h»ad_uÄegi¡”_ÿnûl_»¡Üe
 (&
__ÿnûl_buf
); \

726 ià(
execu‹
) \

727 
	`__ÿnûl_routše
 (
__ÿnûl_¬g
); \

728 
	}
} 0)

	)

729 
	$__±h»ad_uÄegi¡”_ÿnûl_»¡Üe
 (
__±h»ad_unwšd_buf_t
 *
__buf
)

730 
__ş—nup_fù_©Œibu‹
;

734 
	$__±h»ad_unwšd_Ãxt
 (
__±h»ad_unwšd_buf_t
 *
__buf
)

735 
__ş—nup_fù_©Œibu‹
 
	`__©Œibu‹__
 ((
__nÜ‘uº__
))

736 #iâdeà
SHARED


737 
	`__©Œibu‹__
 ((
__w—k__
))

743 
__jmp_buf_g
;

744 
	$__sig£tjmp
 (
__jmp_buf_g
 *
__’v
, 
__§vemask
è
__THROWNL
;

750 
	$±h»ad_mu‹x_š™
 (
±h»ad_mu‹x_t
 *
__mu‹x
,

751 cÚ¡ 
±h»ad_mu‹x©Œ_t
 *
__mu‹x©Œ
)

752 
__THROW
 
	`__nÚnuÎ
 ((1));

755 
	$±h»ad_mu‹x_de¡roy
 (
±h»ad_mu‹x_t
 *
__mu‹x
)

756 
__THROW
 
	`__nÚnuÎ
 ((1));

759 
	$±h»ad_mu‹x_Œylock
 (
±h»ad_mu‹x_t
 *
__mu‹x
)

760 
__THROWNL
 
	`__nÚnuÎ
 ((1));

763 
	$±h»ad_mu‹x_lock
 (
±h»ad_mu‹x_t
 *
__mu‹x
)

764 
__THROWNL
 
	`__nÚnuÎ
 ((1));

766 #ifdeà
__USE_XOPEN2K


768 
	$±h»ad_mu‹x_timedlock
 (
±h»ad_mu‹x_t
 *
__»¡riù
 
__mu‹x
,

769 cÚ¡ 
time¥ec
 *
__»¡riù


770 
__ab¡ime
è
__THROWNL
 
	`__nÚnuÎ
 ((1, 2));

774 
	$±h»ad_mu‹x_uÆock
 (
±h»ad_mu‹x_t
 *
__mu‹x
)

775 
__THROWNL
 
	`__nÚnuÎ
 ((1));

779 
	$±h»ad_mu‹x_g‘´ioûšg
 (cÚ¡ 
±h»ad_mu‹x_t
 *

780 
__»¡riù
 
__mu‹x
,

781 *
__»¡riù
 
__´ioûšg
)

782 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

786 
	$±h»ad_mu‹x_£rioûšg
 (
±h»ad_mu‹x_t
 *
__»¡riù
 
__mu‹x
,

787 
__´ioûšg
,

788 *
__»¡riù
 
__Şd_ûšg
)

789 
__THROW
 
	`__nÚnuÎ
 ((1, 3));

792 #ifdeà
__USE_XOPEN2K8


794 
	$±h»ad_mu‹x_cÚsi¡’t
 (
±h»ad_mu‹x_t
 *
__mu‹x
)

795 
__THROW
 
	`__nÚnuÎ
 ((1));

796 #ifdeà
__USE_GNU


797 
	$±h»ad_mu‹x_cÚsi¡’t_Å
 (
±h»ad_mu‹x_t
 *
__mu‹x
)

798 
__THROW
 
	`__nÚnuÎ
 ((1));

807 
	$±h»ad_mu‹x©Œ_š™
 (
±h»ad_mu‹x©Œ_t
 *
__©Œ
)

808 
__THROW
 
	`__nÚnuÎ
 ((1));

811 
	$±h»ad_mu‹x©Œ_de¡roy
 (
±h»ad_mu‹x©Œ_t
 *
__©Œ
)

812 
__THROW
 
	`__nÚnuÎ
 ((1));

815 
	$±h»ad_mu‹x©Œ_g‘psh¬ed
 (cÚ¡ 
±h»ad_mu‹x©Œ_t
 *

816 
__»¡riù
 
__©Œ
,

817 *
__»¡riù
 
__psh¬ed
)

818 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

821 
	$±h»ad_mu‹x©Œ_£sh¬ed
 (
±h»ad_mu‹x©Œ_t
 *
__©Œ
,

822 
__psh¬ed
)

823 
__THROW
 
	`__nÚnuÎ
 ((1));

825 #ià
defšed
 
__USE_UNIX98
 || defšed 
__USE_XOPEN2K8


827 
	$±h»ad_mu‹x©Œ_g‘ty³
 (cÚ¡ 
±h»ad_mu‹x©Œ_t
 *
__»¡riù


828 
__©Œ
, *
__»¡riù
 
__kšd
)

829 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

834 
	$±h»ad_mu‹x©Œ_£‰y³
 (
±h»ad_mu‹x©Œ_t
 *
__©Œ
, 
__kšd
)

835 
__THROW
 
	`__nÚnuÎ
 ((1));

839 
	$±h»ad_mu‹x©Œ_g‘´ÙocŞ
 (cÚ¡ 
±h»ad_mu‹x©Œ_t
 *

840 
__»¡riù
 
__©Œ
,

841 *
__»¡riù
 
__´ÙocŞ
)

842 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

846 
	$±h»ad_mu‹x©Œ_£rÙocŞ
 (
±h»ad_mu‹x©Œ_t
 *
__©Œ
,

847 
__´ÙocŞ
)

848 
__THROW
 
	`__nÚnuÎ
 ((1));

851 
	$±h»ad_mu‹x©Œ_g‘´ioûšg
 (cÚ¡ 
±h»ad_mu‹x©Œ_t
 *

852 
__»¡riù
 
__©Œ
,

853 *
__»¡riù
 
__´ioûšg
)

854 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

857 
	$±h»ad_mu‹x©Œ_£rioûšg
 (
±h»ad_mu‹x©Œ_t
 *
__©Œ
,

858 
__´ioûšg
)

859 
__THROW
 
	`__nÚnuÎ
 ((1));

861 #ifdeà
__USE_XOPEN2K


863 
	$±h»ad_mu‹x©Œ_g‘robu¡
 (cÚ¡ 
±h»ad_mu‹x©Œ_t
 *
__©Œ
,

864 *
__robu¡Ãss
)

865 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

866 #ifdeà
__USE_GNU


867 
	$±h»ad_mu‹x©Œ_g‘robu¡_Å
 (cÚ¡ 
±h»ad_mu‹x©Œ_t
 *
__©Œ
,

868 *
__robu¡Ãss
)

869 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

873 
	$±h»ad_mu‹x©Œ_£Œobu¡
 (
±h»ad_mu‹x©Œ_t
 *
__©Œ
,

874 
__robu¡Ãss
)

875 
__THROW
 
	`__nÚnuÎ
 ((1));

876 #ifdeà
__USE_GNU


877 
	$±h»ad_mu‹x©Œ_£Œobu¡_Å
 (
±h»ad_mu‹x©Œ_t
 *
__©Œ
,

878 
__robu¡Ãss
)

879 
__THROW
 
	`__nÚnuÎ
 ((1));

884 #ià
defšed
 
__USE_UNIX98
 || defšed 
__USE_XOPEN2K


889 
	$±h»ad_rwlock_š™
 (
±h»ad_rwlock_t
 *
__»¡riù
 
__rwlock
,

890 cÚ¡ 
±h»ad_rwlock©Œ_t
 *
__»¡riù


891 
__©Œ
è
__THROW
 
	`__nÚnuÎ
 ((1));

894 
	$±h»ad_rwlock_de¡roy
 (
±h»ad_rwlock_t
 *
__rwlock
)

895 
__THROW
 
	`__nÚnuÎ
 ((1));

898 
	$±h»ad_rwlock_rdlock
 (
±h»ad_rwlock_t
 *
__rwlock
)

899 
__THROWNL
 
	`__nÚnuÎ
 ((1));

902 
	$±h»ad_rwlock_Œyrdlock
 (
±h»ad_rwlock_t
 *
__rwlock
)

903 
__THROWNL
 
	`__nÚnuÎ
 ((1));

905 #ifdeà
__USE_XOPEN2K


907 
	$±h»ad_rwlock_timedrdlock
 (
±h»ad_rwlock_t
 *
__»¡riù
 
__rwlock
,

908 cÚ¡ 
time¥ec
 *
__»¡riù


909 
__ab¡ime
è
__THROWNL
 
	`__nÚnuÎ
 ((1, 2));

913 
	$±h»ad_rwlock_w¾ock
 (
±h»ad_rwlock_t
 *
__rwlock
)

914 
__THROWNL
 
	`__nÚnuÎ
 ((1));

917 
	$±h»ad_rwlock_Œyw¾ock
 (
±h»ad_rwlock_t
 *
__rwlock
)

918 
__THROWNL
 
	`__nÚnuÎ
 ((1));

920 #ifdeà
__USE_XOPEN2K


922 
	$±h»ad_rwlock_timedw¾ock
 (
±h»ad_rwlock_t
 *
__»¡riù
 
__rwlock
,

923 cÚ¡ 
time¥ec
 *
__»¡riù


924 
__ab¡ime
è
__THROWNL
 
	`__nÚnuÎ
 ((1, 2));

928 
	$±h»ad_rwlock_uÆock
 (
±h»ad_rwlock_t
 *
__rwlock
)

929 
__THROWNL
 
	`__nÚnuÎ
 ((1));

935 
	$±h»ad_rwlock©Œ_š™
 (
±h»ad_rwlock©Œ_t
 *
__©Œ
)

936 
__THROW
 
	`__nÚnuÎ
 ((1));

939 
	$±h»ad_rwlock©Œ_de¡roy
 (
±h»ad_rwlock©Œ_t
 *
__©Œ
)

940 
__THROW
 
	`__nÚnuÎ
 ((1));

943 
	$±h»ad_rwlock©Œ_g‘psh¬ed
 (cÚ¡ 
±h»ad_rwlock©Œ_t
 *

944 
__»¡riù
 
__©Œ
,

945 *
__»¡riù
 
__psh¬ed
)

946 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

949 
	$±h»ad_rwlock©Œ_£sh¬ed
 (
±h»ad_rwlock©Œ_t
 *
__©Œ
,

950 
__psh¬ed
)

951 
__THROW
 
	`__nÚnuÎ
 ((1));

954 
	$±h»ad_rwlock©Œ_g‘kšd_Å
 (cÚ¡ 
±h»ad_rwlock©Œ_t
 *

955 
__»¡riù
 
__©Œ
,

956 *
__»¡riù
 
__´ef
)

957 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

960 
	$±h»ad_rwlock©Œ_£tkšd_Å
 (
±h»ad_rwlock©Œ_t
 *
__©Œ
,

961 
__´ef
è
__THROW
 
	`__nÚnuÎ
 ((1));

969 
	$±h»ad_cÚd_š™
 (
±h»ad_cÚd_t
 *
__»¡riù
 
__cÚd
,

970 cÚ¡ 
±h»ad_cÚd©Œ_t
 *
__»¡riù
 
__cÚd_©Œ
)

971 
__THROW
 
	`__nÚnuÎ
 ((1));

974 
	$±h»ad_cÚd_de¡roy
 (
±h»ad_cÚd_t
 *
__cÚd
)

975 
__THROW
 
	`__nÚnuÎ
 ((1));

978 
	$±h»ad_cÚd_sigÇl
 (
±h»ad_cÚd_t
 *
__cÚd
)

979 
__THROWNL
 
	`__nÚnuÎ
 ((1));

982 
	$±h»ad_cÚd_brßdÿ¡
 (
±h»ad_cÚd_t
 *
__cÚd
)

983 
__THROWNL
 
	`__nÚnuÎ
 ((1));

990 
	$±h»ad_cÚd_wa™
 (
±h»ad_cÚd_t
 *
__»¡riù
 
__cÚd
,

991 
±h»ad_mu‹x_t
 *
__»¡riù
 
__mu‹x
)

992 
	`__nÚnuÎ
 ((1, 2));

1001 
	$±h»ad_cÚd_timedwa™
 (
±h»ad_cÚd_t
 *
__»¡riù
 
__cÚd
,

1002 
±h»ad_mu‹x_t
 *
__»¡riù
 
__mu‹x
,

1003 cÚ¡ 
time¥ec
 *
__»¡riù
 
__ab¡ime
)

1004 
	`__nÚnuÎ
 ((1, 2, 3));

1009 
	$±h»ad_cÚd©Œ_š™
 (
±h»ad_cÚd©Œ_t
 *
__©Œ
)

1010 
__THROW
 
	`__nÚnuÎ
 ((1));

1013 
	$±h»ad_cÚd©Œ_de¡roy
 (
±h»ad_cÚd©Œ_t
 *
__©Œ
)

1014 
__THROW
 
	`__nÚnuÎ
 ((1));

1017 
	$±h»ad_cÚd©Œ_g‘psh¬ed
 (cÚ¡ 
±h»ad_cÚd©Œ_t
 *

1018 
__»¡riù
 
__©Œ
,

1019 *
__»¡riù
 
__psh¬ed
)

1020 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

1023 
	$±h»ad_cÚd©Œ_£sh¬ed
 (
±h»ad_cÚd©Œ_t
 *
__©Œ
,

1024 
__psh¬ed
è
__THROW
 
	`__nÚnuÎ
 ((1));

1026 #ifdeà
__USE_XOPEN2K


1028 
	$±h»ad_cÚd©Œ_g‘şock
 (cÚ¡ 
±h»ad_cÚd©Œ_t
 *

1029 
__»¡riù
 
__©Œ
,

1030 
__şockid_t
 *
__»¡riù
 
__şock_id
)

1031 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

1034 
	$±h»ad_cÚd©Œ_£tşock
 (
±h»ad_cÚd©Œ_t
 *
__©Œ
,

1035 
__şockid_t
 
__şock_id
)

1036 
__THROW
 
	`__nÚnuÎ
 ((1));

1040 #ifdeà
__USE_XOPEN2K


1045 
	$±h»ad_¥š_š™
 (
±h»ad_¥šlock_t
 *
__lock
, 
__psh¬ed
)

1046 
__THROW
 
	`__nÚnuÎ
 ((1));

1049 
	$±h»ad_¥š_de¡roy
 (
±h»ad_¥šlock_t
 *
__lock
)

1050 
__THROW
 
	`__nÚnuÎ
 ((1));

1053 
	$±h»ad_¥š_lock
 (
±h»ad_¥šlock_t
 *
__lock
)

1054 
__THROWNL
 
	`__nÚnuÎ
 ((1));

1057 
	$±h»ad_¥š_Œylock
 (
±h»ad_¥šlock_t
 *
__lock
)

1058 
__THROWNL
 
	`__nÚnuÎ
 ((1));

1061 
	$±h»ad_¥š_uÆock
 (
±h»ad_¥šlock_t
 *
__lock
)

1062 
__THROWNL
 
	`__nÚnuÎ
 ((1));

1069 
	$±h»ad_b¬r›r_š™
 (
±h»ad_b¬r›r_t
 *
__»¡riù
 
__b¬r›r
,

1070 cÚ¡ 
±h»ad_b¬r›¿‰r_t
 *
__»¡riù


1071 
__©Œ
, 
__couÁ
)

1072 
__THROW
 
	`__nÚnuÎ
 ((1));

1075 
	$±h»ad_b¬r›r_de¡roy
 (
±h»ad_b¬r›r_t
 *
__b¬r›r
)

1076 
__THROW
 
	`__nÚnuÎ
 ((1));

1079 
	$±h»ad_b¬r›r_wa™
 (
±h»ad_b¬r›r_t
 *
__b¬r›r
)

1080 
__THROWNL
 
	`__nÚnuÎ
 ((1));

1084 
	$±h»ad_b¬r›¿‰r_š™
 (
±h»ad_b¬r›¿‰r_t
 *
__©Œ
)

1085 
__THROW
 
	`__nÚnuÎ
 ((1));

1088 
	$±h»ad_b¬r›¿‰r_de¡roy
 (
±h»ad_b¬r›¿‰r_t
 *
__©Œ
)

1089 
__THROW
 
	`__nÚnuÎ
 ((1));

1092 
	$±h»ad_b¬r›¿‰r_g‘psh¬ed
 (cÚ¡ 
±h»ad_b¬r›¿‰r_t
 *

1093 
__»¡riù
 
__©Œ
,

1094 *
__»¡riù
 
__psh¬ed
)

1095 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

1098 
	$±h»ad_b¬r›¿‰r_£sh¬ed
 (
±h»ad_b¬r›¿‰r_t
 *
__©Œ
,

1099 
__psh¬ed
)

1100 
__THROW
 
	`__nÚnuÎ
 ((1));

1112 
	$±h»ad_key_ü—‹
 (
±h»ad_key_t
 *
__key
,

1113 (*
__de¡r_funùiÚ
) (*))

1114 
__THROW
 
	`__nÚnuÎ
 ((1));

1117 
	$±h»ad_key_d–‘e
 (
±h»ad_key_t
 
__key
è
__THROW
;

1120 *
	$±h»ad_g‘¥ecific
 (
±h»ad_key_t
 
__key
è
__THROW
;

1123 
	$±h»ad_£t¥ecific
 (
±h»ad_key_t
 
__key
,

1124 cÚ¡ *
__poš‹r
è
__THROW
 ;

1127 #ifdeà
__USE_XOPEN2K


1129 
	$±h»ad_g‘ıuşockid
 (
±h»ad_t
 
__th»ad_id
,

1130 
__şockid_t
 *
__şock_id
)

1131 
__THROW
 
	`__nÚnuÎ
 ((2));

1146 
	$±h»ad_©fÜk
 ((*
__´•¬e
) (),

1147 (*
__·»Á
) (),

1148 (*
__chd
è()è
__THROW
;

1151 #ifdeà
__USE_EXTERN_INLINES


1153 
__ex‹º_šlše
 

1154 
	`__NTH
 (
	$±h»ad_equ®
 (
±h»ad_t
 
__th»ad1
,…th»ad_ˆ
__th»ad2
))

1156  
__th»ad1
 =ğ
__th»ad2
;

1157 
	}
}

1160 
	g__END_DECLS


	@/usr/include/pwd.h

22 #iâdef 
_PWD_H


23 
	#_PWD_H
 1

	)

25 
	~<ã©u»s.h
>

27 
	g__BEGIN_DECLS


29 
	~<b™s/ty³s.h
>

31 
	#__Ãed_size_t


	)

32 
	~<¡ddef.h
>

34 #ià
defšed
 
__USE_XOPEN
 || defšed 
__USE_XOPEN2K


37 #iâdeà
__gid_t_defšed


38 
__gid_t
 
	tgid_t
;

39 
	#__gid_t_defšed


	)

42 #iâdeà
__uid_t_defšed


43 
__uid_t
 
	tuid_t
;

44 
	#__uid_t_defšed


	)

49 
	s·sswd


51 *
	mpw_Çme
;

52 *
	mpw_·sswd
;

53 
__uid_t
 
	mpw_uid
;

54 
__gid_t
 
	mpw_gid
;

55 *
	mpw_gecos
;

56 *
	mpw_dœ
;

57 *
	mpw_sh–l
;

61 #ifdeà
__USE_MISC


62 
	~<b™s/ty³s/FILE.h
>

66 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_XOPEN_EXTENDED


71 
£w’t
 ();

77 
’dpw’t
 ();

83 
·sswd
 *
g‘pw’t
 ();

86 #ifdef 
__USE_MISC


93 
·sswd
 *
	$fg‘pw’t
 (
FILE
 *
__¡»am
è
	`__nÚnuÎ
 ((1));

101 
	`puw’t
 (cÚ¡ 
·sswd
 *
__»¡riù
 
__p
,

102 
FILE
 *
__»¡riù
 
__f
);

109 
·sswd
 *
	`g‘pwuid
 (
__uid_t
 
__uid
);

115 
·sswd
 *
	$g‘pwÇm
 (cÚ¡ *
__Çme
è
	`__nÚnuÎ
 ((1));

117 #ifdeà
__USE_POSIX


119 #ifdeà
__USE_MISC


122 
	#NSS_BUFLEN_PASSWD
 1024

	)

133 #ifdeà
__USE_MISC


138 
	$g‘pw’t_r
 (
·sswd
 *
__»¡riù
 
__»suÉbuf
,

139 *
__»¡riù
 
__bufãr
, 
size_t
 
__buæ’
,

140 
·sswd
 **
__»¡riù
 
__»suÉ
)

141 
	`__nÚnuÎ
 ((1, 2, 4));

144 
	$g‘pwuid_r
 (
__uid_t
 
__uid
,

145 
·sswd
 *
__»¡riù
 
__»suÉbuf
,

146 *
__»¡riù
 
__bufãr
, 
size_t
 
__buæ’
,

147 
·sswd
 **
__»¡riù
 
__»suÉ
)

148 
	`__nÚnuÎ
 ((2, 3, 5));

150 
	$g‘pwÇm_r
 (cÚ¡ *
__»¡riù
 
__Çme
,

151 
·sswd
 *
__»¡riù
 
__»suÉbuf
,

152 *
__»¡riù
 
__bufãr
, 
size_t
 
__buæ’
,

153 
·sswd
 **
__»¡riù
 
__»suÉ
)

154 
	`__nÚnuÎ
 ((1, 2, 3, 5));

157 #ifdef 
__USE_MISC


165 
	$fg‘pw’t_r
 (
FILE
 *
__»¡riù
 
__¡»am
,

166 
·sswd
 *
__»¡riù
 
__»suÉbuf
,

167 *
__»¡riù
 
__bufãr
, 
size_t
 
__buæ’
,

168 
·sswd
 **
__»¡riù
 
__»suÉ
)

169 
	`__nÚnuÎ
 ((1, 2, 3, 5));

174 #ifdeà
__USE_GNU


183 
	`g‘pw
 (
__uid_t
 
__uid
, *
__bufãr
);

186 
__END_DECLS


	@/usr/include/setjmp.h

22 #iâdef 
_SETJMP_H


23 
	#_SETJMP_H
 1

	)

25 
	~<ã©u»s.h
>

27 
	g__BEGIN_DECLS


29 
	~<b™s/£tjmp.h
>

30 
	~<b™s/ty³s/__sig£t_t.h
>

33 
	s__jmp_buf_g


39 
__jmp_buf
 
	m__jmpbuf
;

40 
	m__mask_was_§ved
;

41 
__sig£t_t
 
	m__§ved_mask
;

45 
__jmp_buf_g
 
	tjmp_buf
[1];

49 
	$£tjmp
 (
jmp_buf
 
__’v
è
__THROWNL
;

54 
	$__sig£tjmp
 (
__jmp_buf_g
 
__’v
[1], 
__§vemask
è
__THROWNL
;

58 
	$_£tjmp
 (
__jmp_buf_g
 
__’v
[1]è
__THROWNL
;

62 
	#£tjmp
(
’v
è
	`_£tjmp
 (’v)

	)

67 
	$lÚgjmp
 (
__jmp_buf_g
 
__’v
[1], 
__v®
)

68 
__THROWNL
 
	`__©Œibu‹__
 ((
__nÜ‘uº__
));

70 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_XOPEN


74 
	$_lÚgjmp
 (
__jmp_buf_g
 
__’v
[1], 
__v®
)

75 
__THROWNL
 
	`__©Œibu‹__
 ((
__nÜ‘uº__
));

79 #ifdef 
__USE_POSIX


83 
__jmp_buf_g
 
	tsigjmp_buf
[1];

87 
	#sig£tjmp
(
’v
, 
§vemask
è
	`__sig£tjmp
 (’v, savemask)

	)

93 
	$siglÚgjmp
 (
sigjmp_buf
 
__’v
, 
__v®
)

94 
__THROWNL
 
	`__©Œibu‹__
 ((
__nÜ‘uº__
));

99 #ià
__USE_FORTIFY_LEVEL
 > 0

100 
	~<b™s/£tjmp2.h
>

103 
__END_DECLS


	@/usr/include/signal.h

22 #iâdef 
_SIGNAL_H


23 
	#_SIGNAL_H


	)

25 
	~<ã©u»s.h
>

27 
	g__BEGIN_DECLS


29 
	~<b™s/ty³s.h
>

30 
	~<b™s/signum.h
>

32 
	~<b™s/ty³s/sig_©omic_t.h
>

34 #ià
defšed
 
__USE_POSIX


35 
	~<b™s/ty³s/sig£t_t.h
>

38 #ià
defšed
 
__USE_XOPEN
 || defšed 
__USE_XOPEN2K


39 #iâdeà
__pid_t_defšed


40 
__pid_t
 
	tpid_t
;

41 
	#__pid_t_defšed


	)

43 #ifdeà
__USE_XOPEN


45 #iâdeà
__uid_t_defšed


46 
__uid_t
 
	tuid_t
;

47 
	#__uid_t_defšed


	)

51 #ifdeà
__USE_POSIX199309


53 
	~<b™s/ty³s/¡ruù_time¥ec.h
>

56 #ià
defšed
 
__USE_POSIX199309
 || defšed 
__USE_XOPEN_EXTENDED


57 
	~<b™s/ty³s/sigšfo_t.h
>

58 
	~<b™s/sigšfo-cÚ¡s.h
>

61 #ifdeà
__USE_MISC


62 
	~<b™s/ty³s/sigv®_t.h
>

65 #ifdeà
__USE_POSIX199309


66 
	~<b™s/ty³s/sigev’t_t.h
>

67 
	~<b™s/sigev’t-cÚ¡s.h
>

72 (*
	t__sighªdËr_t
) ();

77 
__sighªdËr_t
 
	$__sysv_sigÇl
 (
__sig
, 
__sighªdËr_t
 
__hªdËr
)

78 
__THROW
;

79 #ifdeà
__USE_GNU


80 
__sighªdËr_t
 
	$sysv_sigÇl
 (
__sig
, 
__sighªdËr_t
 
__hªdËr
)

81 
__THROW
;

87 #ifdeà
__USE_MISC


88 
__sighªdËr_t
 
	$sigÇl
 (
__sig
, 
__sighªdËr_t
 
__hªdËr
)

89 
__THROW
;

92 #ifdeà
__REDIRECT_NTH


93 
__sighªdËr_t
 
	`__REDIRECT_NTH
 (
sigÇl
,

94 (
__sig
, 
__sighªdËr_t
 
__hªdËr
),

95 
__sysv_sigÇl
);

97 
	#sigÇl
 
__sysv_sigÇl


	)

101 #ià
defšed
 
__USE_XOPEN_EXTENDED
 && !defšed 
__USE_XOPEN2K8


104 
__sighªdËr_t
 
	$bsd_sigÇl
 (
__sig
, 
__sighªdËr_t
 
__hªdËr
)

105 
__THROW
;

111 #ifdeà
__USE_POSIX


112 
	$kl
 (
__pid_t
 
__pid
, 
__sig
è
__THROW
;

115 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_XOPEN_EXTENDED


119 
	$kÍg
 (
__pid_t
 
__pg½
, 
__sig
è
__THROW
;

123 
	$¿i£
 (
__sig
è
__THROW
;

125 #ifdeà
__USE_MISC


127 
__sighªdËr_t
 
	$ssigÇl
 (
__sig
, 
__sighªdËr_t
 
__hªdËr
)

128 
__THROW
;

129 
	$gsigÇl
 (
__sig
è
__THROW
;

132 #ifdeà
__USE_XOPEN2K8


134 
	`psigÇl
 (
__sig
, cÚ¡ *
__s
);

137 
	`psigšfo
 (cÚ¡ 
sigšfo_t
 *
__pšfo
, cÚ¡ *
__s
);

149 #ifdeà
__USE_XOPEN_EXTENDED


150 #ifdeà
__GNUC__


151 
	$sig·u£
 (
__sig
è
	`__asm__
 ("__xpg_sigpause");

153 
	`__sig·u£
 (
__sig_Ü_mask
, 
__is_sig
);

155 
	#sig·u£
(
sig
è
	`__sig·u£
 ((sig), 1)

	)

160 #ifdeà
__USE_MISC


167 
	#sigmask
(
sig
è(()(1u << ((sigè- 1)))

	)

170 
	$sigblock
 (
__mask
è
__THROW
 
__©Œibu‹_d•»ÿ‹d__
;

173 
	$sig£tmask
 (
__mask
è
__THROW
 
__©Œibu‹_d•»ÿ‹d__
;

176 
	$sigg‘mask
 (è
__THROW
 
__©Œibu‹_d•»ÿ‹d__
;

180 #ifdeà
__USE_MISC


181 
	#NSIG
 
_NSIG


	)

184 #ifdeà
__USE_GNU


185 
__sighªdËr_t
 
	tsighªdËr_t
;

189 #ifdeà
__USE_MISC


190 
__sighªdËr_t
 
	tsig_t
;

193 #ifdeà
__USE_POSIX


196 
	$sigem±y£t
 (
sig£t_t
 *
__£t
è
__THROW
 
	`__nÚnuÎ
 ((1));

199 
	$sigfl£t
 (
sig£t_t
 *
__£t
è
__THROW
 
	`__nÚnuÎ
 ((1));

202 
	$sigadd£t
 (
sig£t_t
 *
__£t
, 
__signo
è
__THROW
 
	`__nÚnuÎ
 ((1));

205 
	$sigd–£t
 (
sig£t_t
 *
__£t
, 
__signo
è
__THROW
 
	`__nÚnuÎ
 ((1));

208 
	$sigismemb”
 (cÚ¡ 
sig£t_t
 *
__£t
, 
__signo
)

209 
__THROW
 
	`__nÚnuÎ
 ((1));

211 #ifdeà
__USE_GNU


213 
	$sigi£m±y£t
 (cÚ¡ 
sig£t_t
 *
__£t
è
__THROW
 
	`__nÚnuÎ
 ((1));

216 
	$sigªd£t
 (
sig£t_t
 *
__£t
, cÚ¡ sig£t_ˆ*
__Ëá
,

217 cÚ¡ 
sig£t_t
 *
__right
è
__THROW
 
	`__nÚnuÎ
 ((1, 2, 3));

220 
	$sigÜ£t
 (
sig£t_t
 *
__£t
, cÚ¡ sig£t_ˆ*
__Ëá
,

221 cÚ¡ 
sig£t_t
 *
__right
è
__THROW
 
	`__nÚnuÎ
 ((1, 2, 3));

226 
	~<b™s/sigaùiÚ.h
>

229 
	$sig´ocmask
 (
__how
, cÚ¡ 
sig£t_t
 *
__»¡riù
 
__£t
,

230 
sig£t_t
 *
__»¡riù
 
__o£t
è
__THROW
;

237 
	$sigsu¥’d
 (cÚ¡ 
sig£t_t
 *
__£t
è
	`__nÚnuÎ
 ((1));

240 
	$sigaùiÚ
 (
__sig
, cÚ¡ 
sigaùiÚ
 *
__»¡riù
 
__aù
,

241 
sigaùiÚ
 *
__»¡riù
 
__ßù
è
__THROW
;

244 
	$sig³ndšg
 (
sig£t_t
 *
__£t
è
__THROW
 
	`__nÚnuÎ
 ((1));

247 #ifdeà
__USE_POSIX199506


252 
	$sigwa™
 (cÚ¡ 
sig£t_t
 *
__»¡riù
 
__£t
, *__»¡riù 
__sig
)

253 
	`__nÚnuÎ
 ((1, 2));

256 #ifdeà
__USE_POSIX199309


261 
	$sigwa™šfo
 (cÚ¡ 
sig£t_t
 *
__»¡riù
 
__£t
,

262 
sigšfo_t
 *
__»¡riù
 
__šfo
è
	`__nÚnuÎ
 ((1));

269 
	$sigtimedwa™
 (cÚ¡ 
sig£t_t
 *
__»¡riù
 
__£t
,

270 
sigšfo_t
 *
__»¡riù
 
__šfo
,

271 cÚ¡ 
time¥ec
 *
__»¡riù
 
__timeout
)

272 
	`__nÚnuÎ
 ((1));

276 
	$sigqueue
 (
__pid_t
 
__pid
, 
__sig
, cÚ¡ 
sigv®
 
__v®
)

277 
__THROW
;

282 #ifdeà
__USE_MISC


286 cÚ¡ *cÚ¡ 
_sys_sigli¡
[
_NSIG
];

287 cÚ¡ *cÚ¡ 
sys_sigli¡
[
_NSIG
];

291 
	~<b™s/sigcÚ‹xt.h
>

294 
	$sig»tuº
 (
sigcÚ‹xt
 *
__sı
è
__THROW
;

299 #ià
defšed
 
__USE_XOPEN_EXTENDED
 || defšed 
__USE_XOPEN2K8


300 
	#__Ãed_size_t


	)

301 
	~<¡ddef.h
>

303 
	~<b™s/ty³s/¡ack_t.h
>

304 #ià
defšed
 
__USE_XOPEN
 || defšed 
__USE_XOPEN2K8


306 
	~<sys/ucÚ‹xt.h
>

310 #ià
defšed
 
__USE_XOPEN_EXTENDED
 || defšed 
__USE_MISC


314 
	$sigš‹¼u±
 (
__sig
, 
__š‹¼u±
è
__THROW
;

316 
	~<b™s/sig¡ack.h
>

317 
	~<b™s/ss_æags.h
>

321 
	$sig®t¡ack
 (cÚ¡ 
¡ack_t
 *
__»¡riù
 
__ss
,

322 
¡ack_t
 *
__»¡riù
 
__oss
è
__THROW
;

325 #ià((
defšed
 
__USE_XOPEN_EXTENDED
 && !defšed 
__USE_XOPEN2K8
) \

326 || 
defšed
 
__USE_MISC
)

327 
	~<b™s/ty³s/¡ruù_sig¡ack.h
>

330 #ià((
defšed
 
__USE_XOPEN_EXTENDED
 && !defšed 
__USE_XOPEN2K
) \

331 || 
defšed
 
__USE_MISC
)

335 
	$sig¡ack
 (
sig¡ack
 *
__ss
, sig¡ack *
__oss
)

336 
__THROW
 
__©Œibu‹_d•»ÿ‹d__
;

339 #ifdeà
__USE_XOPEN_EXTENDED


343 
	$sighŞd
 (
__sig
è
__THROW
;

346 
	$sig»l£
 (
__sig
è
__THROW
;

349 
	$sigignÜe
 (
__sig
è
__THROW
;

352 
__sighªdËr_t
 
	$sig£t
 (
__sig
, 
__sighªdËr_t
 
__di¥
è
__THROW
;

355 #ià
defšed
 
__USE_POSIX199506
 || defšed 
__USE_UNIX98


358 
	~<b™s/±h»adty³s.h
>

359 
	~<b™s/sigth»ad.h
>

366 
	$__libc_cu¼’t_sig¹mš
 (è
__THROW
;

368 
	$__libc_cu¼’t_sig¹max
 (è
__THROW
;

370 
	#SIGRTMIN
 (
	`__libc_cu¼’t_sig¹mš
 ())

	)

371 
	#SIGRTMAX
 (
	`__libc_cu¼’t_sig¹max
 ())

	)

373 
__END_DECLS


	@/usr/include/stdint.h

22 #iâdeà
_STDINT_H


23 
	#_STDINT_H
 1

	)

25 
	#__GLIBC_INTERNAL_STARTING_HEADER_IMPLEMENTATION


	)

26 
	~<b™s/libc-h—d”-¡¬t.h
>

27 
	~<b™s/ty³s.h
>

28 
	~<b™s/wch¬.h
>

29 
	~<b™s/wÜdsize.h
>

34 
	~<b™s/¡dšt-šŠ.h
>

37 
	~<b™s/¡dšt-ušŠ.h
>

43 sigÃd 
	tšt_Ëa¡8_t
;

44 
	tšt_Ëa¡16_t
;

45 
	tšt_Ëa¡32_t
;

46 #ià
__WORDSIZE
 == 64

47 
	tšt_Ëa¡64_t
;

49 
__ex‹nsiÚ__


50 
	tšt_Ëa¡64_t
;

54 
	tušt_Ëa¡8_t
;

55 
	tušt_Ëa¡16_t
;

56 
	tušt_Ëa¡32_t
;

57 #ià
__WORDSIZE
 == 64

58 
	tušt_Ëa¡64_t
;

60 
__ex‹nsiÚ__


61 
	tušt_Ëa¡64_t
;

68 sigÃd 
	tšt_ç¡8_t
;

69 #ià
__WORDSIZE
 == 64

70 
	tšt_ç¡16_t
;

71 
	tšt_ç¡32_t
;

72 
	tšt_ç¡64_t
;

74 
	tšt_ç¡16_t
;

75 
	tšt_ç¡32_t
;

76 
__ex‹nsiÚ__


77 
	tšt_ç¡64_t
;

81 
	tušt_ç¡8_t
;

82 #ià
__WORDSIZE
 == 64

83 
	tušt_ç¡16_t
;

84 
	tušt_ç¡32_t
;

85 
	tušt_ç¡64_t
;

87 
	tušt_ç¡16_t
;

88 
	tušt_ç¡32_t
;

89 
__ex‹nsiÚ__


90 
	tušt_ç¡64_t
;

95 #ià
__WORDSIZE
 == 64

96 #iâdeà
__šŒ_t_defšed


97 
	tšŒ_t
;

98 
	#__šŒ_t_defšed


	)

100 
	tušŒ_t
;

102 #iâdeà
__šŒ_t_defšed


103 
	tšŒ_t
;

104 
	#__šŒ_t_defšed


	)

106 
	tušŒ_t
;

111 
__štmax_t
 
	tštmax_t
;

112 
__uštmax_t
 
	tuštmax_t
;

115 #ià
__WORDSIZE
 == 64

116 
	#__INT64_C
(
c
èø## 
L


	)

117 
	#__UINT64_C
(
c
èø## 
UL


	)

119 
	#__INT64_C
(
c
èø## 
LL


	)

120 
	#__UINT64_C
(
c
èø## 
ULL


	)

126 
	#INT8_MIN
 (-128)

	)

127 
	#INT16_MIN
 (-32767-1)

	)

128 
	#INT32_MIN
 (-2147483647-1)

	)

129 
	#INT64_MIN
 (-
	`__INT64_C
(9223372036854775807)-1)

	)

131 
	#INT8_MAX
 (127)

	)

132 
	#INT16_MAX
 (32767)

	)

133 
	#INT32_MAX
 (2147483647)

	)

134 
	#INT64_MAX
 (
	`__INT64_C
(9223372036854775807))

	)

137 
	#UINT8_MAX
 (255)

	)

138 
	#UINT16_MAX
 (65535)

	)

139 
	#UINT32_MAX
 (4294967295U)

	)

140 
	#UINT64_MAX
 (
	`__UINT64_C
(18446744073709551615))

	)

144 
	#INT_LEAST8_MIN
 (-128)

	)

145 
	#INT_LEAST16_MIN
 (-32767-1)

	)

146 
	#INT_LEAST32_MIN
 (-2147483647-1)

	)

147 
	#INT_LEAST64_MIN
 (-
	`__INT64_C
(9223372036854775807)-1)

	)

149 
	#INT_LEAST8_MAX
 (127)

	)

150 
	#INT_LEAST16_MAX
 (32767)

	)

151 
	#INT_LEAST32_MAX
 (2147483647)

	)

152 
	#INT_LEAST64_MAX
 (
	`__INT64_C
(9223372036854775807))

	)

155 
	#UINT_LEAST8_MAX
 (255)

	)

156 
	#UINT_LEAST16_MAX
 (65535)

	)

157 
	#UINT_LEAST32_MAX
 (4294967295U)

	)

158 
	#UINT_LEAST64_MAX
 (
	`__UINT64_C
(18446744073709551615))

	)

162 
	#INT_FAST8_MIN
 (-128)

	)

163 #ià
__WORDSIZE
 == 64

164 
	#INT_FAST16_MIN
 (-9223372036854775807L-1)

	)

165 
	#INT_FAST32_MIN
 (-9223372036854775807L-1)

	)

167 
	#INT_FAST16_MIN
 (-2147483647-1)

	)

168 
	#INT_FAST32_MIN
 (-2147483647-1)

	)

170 
	#INT_FAST64_MIN
 (-
	`__INT64_C
(9223372036854775807)-1)

	)

172 
	#INT_FAST8_MAX
 (127)

	)

173 #ià
__WORDSIZE
 == 64

174 
	#INT_FAST16_MAX
 (9223372036854775807L)

	)

175 
	#INT_FAST32_MAX
 (9223372036854775807L)

	)

177 
	#INT_FAST16_MAX
 (2147483647)

	)

178 
	#INT_FAST32_MAX
 (2147483647)

	)

180 
	#INT_FAST64_MAX
 (
	`__INT64_C
(9223372036854775807))

	)

183 
	#UINT_FAST8_MAX
 (255)

	)

184 #ià
__WORDSIZE
 == 64

185 
	#UINT_FAST16_MAX
 (18446744073709551615UL)

	)

186 
	#UINT_FAST32_MAX
 (18446744073709551615UL)

	)

188 
	#UINT_FAST16_MAX
 (4294967295U)

	)

189 
	#UINT_FAST32_MAX
 (4294967295U)

	)

191 
	#UINT_FAST64_MAX
 (
	`__UINT64_C
(18446744073709551615))

	)

195 #ià
__WORDSIZE
 == 64

196 
	#INTPTR_MIN
 (-9223372036854775807L-1)

	)

197 
	#INTPTR_MAX
 (9223372036854775807L)

	)

198 
	#UINTPTR_MAX
 (18446744073709551615UL)

	)

200 
	#INTPTR_MIN
 (-2147483647-1)

	)

201 
	#INTPTR_MAX
 (2147483647)

	)

202 
	#UINTPTR_MAX
 (4294967295U)

	)

207 
	#INTMAX_MIN
 (-
	`__INT64_C
(9223372036854775807)-1)

	)

209 
	#INTMAX_MAX
 (
	`__INT64_C
(9223372036854775807))

	)

212 
	#UINTMAX_MAX
 (
	`__UINT64_C
(18446744073709551615))

	)

218 #ià
__WORDSIZE
 == 64

219 
	#PTRDIFF_MIN
 (-9223372036854775807L-1)

	)

220 
	#PTRDIFF_MAX
 (9223372036854775807L)

	)

222 #ià
__WORDSIZE32_PTRDIFF_LONG


223 
	#PTRDIFF_MIN
 (-2147483647L-1)

	)

224 
	#PTRDIFF_MAX
 (2147483647L)

	)

226 
	#PTRDIFF_MIN
 (-2147483647-1)

	)

227 
	#PTRDIFF_MAX
 (2147483647)

	)

232 
	#SIG_ATOMIC_MIN
 (-2147483647-1)

	)

233 
	#SIG_ATOMIC_MAX
 (2147483647)

	)

236 #ià
__WORDSIZE
 == 64

237 
	#SIZE_MAX
 (18446744073709551615UL)

	)

239 #ià
__WORDSIZE32_SIZE_ULONG


240 
	#SIZE_MAX
 (4294967295UL)

	)

242 
	#SIZE_MAX
 (4294967295U)

	)

247 #iâdeà
WCHAR_MIN


249 
	#WCHAR_MIN
 
__WCHAR_MIN


	)

250 
	#WCHAR_MAX
 
__WCHAR_MAX


	)

254 
	#WINT_MIN
 (0u)

	)

255 
	#WINT_MAX
 (4294967295u)

	)

258 
	#INT8_C
(
c
è
	)
c

259 
	#INT16_C
(
c
è
	)
c

260 
	#INT32_C
(
c
è
	)
c

261 #ià
__WORDSIZE
 == 64

262 
	#INT64_C
(
c
èø## 
L


	)

264 
	#INT64_C
(
c
èø## 
LL


	)

268 
	#UINT8_C
(
c
è
	)
c

269 
	#UINT16_C
(
c
è
	)
c

270 
	#UINT32_C
(
c
èø## 
U


	)

271 #ià
__WORDSIZE
 == 64

272 
	#UINT64_C
(
c
èø## 
UL


	)

274 
	#UINT64_C
(
c
èø## 
ULL


	)

278 #ià
__WORDSIZE
 == 64

279 
	#INTMAX_C
(
c
èø## 
L


	)

280 
	#UINTMAX_C
(
c
èø## 
UL


	)

282 
	#INTMAX_C
(
c
èø## 
LL


	)

283 
	#UINTMAX_C
(
c
èø## 
ULL


	)

286 #ià
__GLIBC_USE
 (
IEC_60559_BFP_EXT
)

288 
	#INT8_WIDTH
 8

	)

289 
	#UINT8_WIDTH
 8

	)

290 
	#INT16_WIDTH
 16

	)

291 
	#UINT16_WIDTH
 16

	)

292 
	#INT32_WIDTH
 32

	)

293 
	#UINT32_WIDTH
 32

	)

294 
	#INT64_WIDTH
 64

	)

295 
	#UINT64_WIDTH
 64

	)

297 
	#INT_LEAST8_WIDTH
 8

	)

298 
	#UINT_LEAST8_WIDTH
 8

	)

299 
	#INT_LEAST16_WIDTH
 16

	)

300 
	#UINT_LEAST16_WIDTH
 16

	)

301 
	#INT_LEAST32_WIDTH
 32

	)

302 
	#UINT_LEAST32_WIDTH
 32

	)

303 
	#INT_LEAST64_WIDTH
 64

	)

304 
	#UINT_LEAST64_WIDTH
 64

	)

306 
	#INT_FAST8_WIDTH
 8

	)

307 
	#UINT_FAST8_WIDTH
 8

	)

308 
	#INT_FAST16_WIDTH
 
__WORDSIZE


	)

309 
	#UINT_FAST16_WIDTH
 
__WORDSIZE


	)

310 
	#INT_FAST32_WIDTH
 
__WORDSIZE


	)

311 
	#UINT_FAST32_WIDTH
 
__WORDSIZE


	)

312 
	#INT_FAST64_WIDTH
 64

	)

313 
	#UINT_FAST64_WIDTH
 64

	)

315 
	#INTPTR_WIDTH
 
__WORDSIZE


	)

316 
	#UINTPTR_WIDTH
 
__WORDSIZE


	)

318 
	#INTMAX_WIDTH
 64

	)

319 
	#UINTMAX_WIDTH
 64

	)

321 
	#PTRDIFF_WIDTH
 
__WORDSIZE


	)

322 
	#SIG_ATOMIC_WIDTH
 32

	)

323 
	#SIZE_WIDTH
 
__WORDSIZE


	)

324 
	#WCHAR_WIDTH
 32

	)

325 
	#WINT_WIDTH
 32

	)

	@/usr/include/stdio.h

23 #iâdeà
_STDIO_H


24 
	#_STDIO_H
 1

	)

26 
	#__GLIBC_INTERNAL_STARTING_HEADER_IMPLEMENTATION


	)

27 
	~<b™s/libc-h—d”-¡¬t.h
>

29 
	g__BEGIN_DECLS


31 
	#__Ãed_size_t


	)

32 
	#__Ãed_NULL


	)

33 
	~<¡ddef.h
>

35 
	~<b™s/ty³s.h
>

36 
	~<b™s/ty³s/__FILE.h
>

37 
	~<b™s/ty³s/FILE.h
>

39 
	#_STDIO_USES_IOSTREAM


	)

41 
	~<b™s/libio.h
>

43 #ià
defšed
 
__USE_XOPEN
 || defšed 
__USE_XOPEN2K8


44 #ifdeà
__GNUC__


45 #iâdeà
_VA_LIST_DEFINED


46 
_G_va_li¡
 
	tva_li¡
;

47 
	#_VA_LIST_DEFINED


	)

50 
	~<¡d¬g.h
>

54 #ià
defšed
 
__USE_UNIX98
 || defšed 
__USE_XOPEN2K


55 #iâdeà
__off_t_defšed


56 #iâdeà
__USE_FILE_OFFSET64


57 
__off_t
 
	toff_t
;

59 
__off64_t
 
	toff_t
;

61 
	#__off_t_defšed


	)

63 #ià
defšed
 
__USE_LARGEFILE64
 && !defšed 
__off64_t_defšed


64 
__off64_t
 
	toff64_t
;

65 
	#__off64_t_defšed


	)

69 #ifdeà
__USE_XOPEN2K8


70 #iâdeà
__ssize_t_defšed


71 
__ssize_t
 
	tssize_t
;

72 
	#__ssize_t_defšed


	)

77 #iâdeà
__USE_FILE_OFFSET64


78 
_G_åos_t
 
	tåos_t
;

80 
_G_åos64_t
 
	tåos_t
;

82 #ifdeà
__USE_LARGEFILE64


83 
_G_åos64_t
 
	tåos64_t
;

87 
	#_IOFBF
 0

	)

88 
	#_IOLBF
 1

	)

89 
	#_IONBF
 2

	)

93 #iâdeà
BUFSIZ


94 
	#BUFSIZ
 
_IO_BUFSIZ


	)

100 #iâdeà
EOF


101 
	#EOF
 (-1)

	)

107 
	#SEEK_SET
 0

	)

108 
	#SEEK_CUR
 1

	)

109 
	#SEEK_END
 2

	)

110 #ifdeà
__USE_GNU


111 
	#SEEK_DATA
 3

	)

112 
	#SEEK_HOLE
 4

	)

116 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_XOPEN


118 
	#P_tmpdœ
 "/tmp"

	)

131 
	~<b™s/¡dio_lim.h
>

135 
_IO_FILE
 *
¡dš
;

136 
_IO_FILE
 *
¡dout
;

137 
_IO_FILE
 *
¡d”r
;

139 
	#¡dš
 
¡dš


	)

140 
	#¡dout
 
¡dout


	)

141 
	#¡d”r
 
¡d”r


	)

144 
	$»move
 (cÚ¡ *
__f’ame
è
__THROW
;

146 
	$»Çme
 (cÚ¡ *
__Şd
, cÚ¡ *
__Ãw
è
__THROW
;

148 #ifdeà
__USE_ATFILE


150 
	$»Çm—t
 (
__Şdfd
, cÚ¡ *
__Şd
, 
__Ãwfd
,

151 cÚ¡ *
__Ãw
è
__THROW
;

158 #iâdeà
__USE_FILE_OFFSET64


159 
FILE
 *
	$tmpfe
 (è
__wur
;

161 #ifdeà
__REDIRECT


162 
FILE
 *
	`__REDIRECT
 (
tmpfe
, (), 
tmpfe64
è
__wur
;

164 
	#tmpfe
 
tmpfe64


	)

168 #ifdeà
__USE_LARGEFILE64


169 
FILE
 *
	$tmpfe64
 (è
__wur
;

173 *
	$tm²am
 (*
__s
è
__THROW
 
__wur
;

175 #ifdeà
__USE_MISC


178 *
	$tm²am_r
 (*
__s
è
__THROW
 
__wur
;

182 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_XOPEN


190 *
	$‹m²am
 (cÚ¡ *
__dœ
, cÚ¡ *
__pfx
)

191 
__THROW
 
__©Œibu‹_m®loc__
 
__wur
;

199 
	`fşo£
 (
FILE
 *
__¡»am
);

204 
	`fæush
 (
FILE
 *
__¡»am
);

206 #ifdeà
__USE_MISC


213 
	`fæush_uÆocked
 (
FILE
 *
__¡»am
);

216 #ifdeà
__USE_GNU


223 
	`fşo£®l
 ();

227 #iâdeà
__USE_FILE_OFFSET64


232 
FILE
 *
	$fİ’
 (cÚ¡ *
__»¡riù
 
__f’ame
,

233 cÚ¡ *
__»¡riù
 
__modes
è
__wur
;

238 
FILE
 *
	$äeİ’
 (cÚ¡ *
__»¡riù
 
__f’ame
,

239 cÚ¡ *
__»¡riù
 
__modes
,

240 
FILE
 *
__»¡riù
 
__¡»am
è
__wur
;

242 #ifdeà
__REDIRECT


243 
FILE
 *
	`__REDIRECT
 (
fİ’
, (cÚ¡ *
__»¡riù
 
__f’ame
,

244 cÚ¡ *
__»¡riù
 
__modes
), 
fİ’64
)

245 
__wur
;

246 
FILE
 *
	`__REDIRECT
 (
äeİ’
, (cÚ¡ *
__»¡riù
 
__f’ame
,

247 cÚ¡ *
__»¡riù
 
__modes
,

248 
FILE
 *
__»¡riù
 
__¡»am
), 
äeİ’64
)

249 
__wur
;

251 
	#fİ’
 
fİ’64


	)

252 
	#äeİ’
 
äeİ’64


	)

255 #ifdeà
__USE_LARGEFILE64


256 
FILE
 *
	$fİ’64
 (cÚ¡ *
__»¡riù
 
__f’ame
,

257 cÚ¡ *
__»¡riù
 
__modes
è
__wur
;

258 
FILE
 *
	$äeİ’64
 (cÚ¡ *
__»¡riù
 
__f’ame
,

259 cÚ¡ *
__»¡riù
 
__modes
,

260 
FILE
 *
__»¡riù
 
__¡»am
è
__wur
;

263 #ifdef 
__USE_POSIX


265 
FILE
 *
	$fdİ’
 (
__fd
, cÚ¡ *
__modes
è
__THROW
 
__wur
;

268 #ifdef 
__USE_GNU


271 
FILE
 *
	$fİ’cook›
 (*
__»¡riù
 
__magic_cook›
,

272 cÚ¡ *
__»¡riù
 
__modes
,

273 
_IO_cook›_io_funùiÚs_t
 
__io_funcs
è
__THROW
 
__wur
;

276 #ià
defšed
 
__USE_XOPEN2K8
 || 
	`__GLIBC_USE
 (
LIB_EXT2
)

278 
FILE
 *
	$fmemİ’
 (*
__s
, 
size_t
 
__Ën
, cÚ¡ *
__modes
)

279 
__THROW
 
__wur
;

284 
FILE
 *
	$İ’_mem¡»am
 (**
__buæoc
, 
size_t
 *
__siz–oc
è
__THROW
 
__wur
;

290 
	$£tbuf
 (
FILE
 *
__»¡riù
 
__¡»am
, *__»¡riù 
__buf
è
__THROW
;

294 
	$£tvbuf
 (
FILE
 *
__»¡riù
 
__¡»am
, *__»¡riù 
__buf
,

295 
__modes
, 
size_t
 
__n
è
__THROW
;

297 #ifdef 
__USE_MISC


300 
	$£tbufãr
 (
FILE
 *
__»¡riù
 
__¡»am
, *__»¡riù 
__buf
,

301 
size_t
 
__size
è
__THROW
;

304 
	$£šebuf
 (
FILE
 *
__¡»am
è
__THROW
;

312 
	`årštf
 (
FILE
 *
__»¡riù
 
__¡»am
,

313 cÚ¡ *
__»¡riù
 
__fÜm©
, ...);

318 
	`´štf
 (cÚ¡ *
__»¡riù
 
__fÜm©
, ...);

320 
	$¥rštf
 (*
__»¡riù
 
__s
,

321 cÚ¡ *
__»¡riù
 
__fÜm©
, ...è
__THROWNL
;

327 
	`vårštf
 (
FILE
 *
__»¡riù
 
__s
, cÚ¡ *__»¡riù 
__fÜm©
,

328 
_G_va_li¡
 
__¬g
);

333 
	`v´štf
 (cÚ¡ *
__»¡riù
 
__fÜm©
, 
_G_va_li¡
 
__¬g
);

335 
	$v¥rštf
 (*
__»¡riù
 
__s
, cÚ¡ *__»¡riù 
__fÜm©
,

336 
_G_va_li¡
 
__¬g
è
__THROWNL
;

338 #ià
defšed
 
__USE_ISOC99
 || defšed 
__USE_UNIX98


340 
	$¢´štf
 (*
__»¡riù
 
__s
, 
size_t
 
__maxËn
,

341 cÚ¡ *
__»¡riù
 
__fÜm©
, ...)

342 
__THROWNL
 
	`__©Œibu‹__
 ((
	`__fÜm©__
 (
__´štf__
, 3, 4)));

344 
	$v¢´štf
 (*
__»¡riù
 
__s
, 
size_t
 
__maxËn
,

345 cÚ¡ *
__»¡riù
 
__fÜm©
, 
_G_va_li¡
 
__¬g
)

346 
__THROWNL
 
	`__©Œibu‹__
 ((
	`__fÜm©__
 (
__´štf__
, 3, 0)));

349 #ià
	`__GLIBC_USE
 (
LIB_EXT2
)

352 
	$va¥rštf
 (**
__»¡riù
 
__±r
, cÚ¡ *__»¡riù 
__f
,

353 
_G_va_li¡
 
__¬g
)

354 
__THROWNL
 
	`__©Œibu‹__
 ((
	$__fÜm©__
 (
__´štf__
, 2, 0))è
__wur
;

355 
	$__a¥rštf
 (**
__»¡riù
 
__±r
,

356 cÚ¡ *
__»¡riù
 
__fmt
, ...)

357 
__THROWNL
 
	`__©Œibu‹__
 ((
	$__fÜm©__
 (
__´štf__
, 2, 3))è
__wur
;

358 
	$a¥rštf
 (**
__»¡riù
 
__±r
,

359 cÚ¡ *
__»¡riù
 
__fmt
, ...)

360 
__THROWNL
 
	`__©Œibu‹__
 ((
	$__fÜm©__
 (
__´štf__
, 2, 3))è
__wur
;

363 #ifdeà
__USE_XOPEN2K8


365 
	$vd´štf
 (
__fd
, cÚ¡ *
__»¡riù
 
__fmt
,

366 
_G_va_li¡
 
__¬g
)

367 
	`__©Œibu‹__
 ((
	`__fÜm©__
 (
__´štf__
, 2, 0)));

368 
	$d´štf
 (
__fd
, cÚ¡ *
__»¡riù
 
__fmt
, ...)

369 
	`__©Œibu‹__
 ((
	`__fÜm©__
 (
__´štf__
, 2, 3)));

377 
	$fsÿnf
 (
FILE
 *
__»¡riù
 
__¡»am
,

378 cÚ¡ *
__»¡riù
 
__fÜm©
, ...è
__wur
;

383 
	$sÿnf
 (cÚ¡ *
__»¡riù
 
__fÜm©
, ...è
__wur
;

385 
	$ssÿnf
 (cÚ¡ *
__»¡riù
 
__s
,

386 cÚ¡ *
__»¡riù
 
__fÜm©
, ...è
__THROW
;

388 #ià
defšed
 
__USE_ISOC99
 && !defšed 
__USE_GNU
 \

389 && (!
defšed
 
__LDBL_COMPAT
 || !defšed 
__REDIRECT
) \

390 && (
defšed
 
__STRICT_ANSI__
 || defšed 
__USE_XOPEN2K
)

391 #ifdeà
__REDIRECT


395 
	`__REDIRECT
 (
fsÿnf
, (
FILE
 *
__»¡riù
 
__¡»am
,

396 cÚ¡ *
__»¡riù
 
__fÜm©
, ...),

397 
__isoc99_fsÿnf
è
__wur
;

398 
	`__REDIRECT
 (
sÿnf
, (cÚ¡ *
__»¡riù
 
__fÜm©
, ...),

399 
__isoc99_sÿnf
è
__wur
;

400 
	`__REDIRECT_NTH
 (
ssÿnf
, (cÚ¡ *
__»¡riù
 
__s
,

401 cÚ¡ *
__»¡riù
 
__fÜm©
, ...),

402 
__isoc99_ssÿnf
);

404 
	$__isoc99_fsÿnf
 (
FILE
 *
__»¡riù
 
__¡»am
,

405 cÚ¡ *
__»¡riù
 
__fÜm©
, ...è
__wur
;

406 
	$__isoc99_sÿnf
 (cÚ¡ *
__»¡riù
 
__fÜm©
, ...è
__wur
;

407 
	$__isoc99_ssÿnf
 (cÚ¡ *
__»¡riù
 
__s
,

408 cÚ¡ *
__»¡riù
 
__fÜm©
, ...è
__THROW
;

409 
	#fsÿnf
 
__isoc99_fsÿnf


	)

410 
	#sÿnf
 
__isoc99_sÿnf


	)

411 
	#ssÿnf
 
__isoc99_ssÿnf


	)

415 #ifdef 
__USE_ISOC99


420 
	$vfsÿnf
 (
FILE
 *
__»¡riù
 
__s
, cÚ¡ *__»¡riù 
__fÜm©
,

421 
_G_va_li¡
 
__¬g
)

422 
	`__©Œibu‹__
 ((
	$__fÜm©__
 (
__sÿnf__
, 2, 0))è
__wur
;

428 
	$vsÿnf
 (cÚ¡ *
__»¡riù
 
__fÜm©
, 
_G_va_li¡
 
__¬g
)

429 
	`__©Œibu‹__
 ((
	$__fÜm©__
 (
__sÿnf__
, 1, 0))è
__wur
;

432 
	$vssÿnf
 (cÚ¡ *
__»¡riù
 
__s
,

433 cÚ¡ *
__»¡riù
 
__fÜm©
, 
_G_va_li¡
 
__¬g
)

434 
__THROW
 
	`__©Œibu‹__
 ((
	`__fÜm©__
 (
__sÿnf__
, 2, 0)));

436 #ià!
defšed
 
__USE_GNU
 \

437 && (!
defšed
 
__LDBL_COMPAT
 || !defšed 
__REDIRECT
) \

438 && (
defšed
 
__STRICT_ANSI__
 || defšed 
__USE_XOPEN2K
)

439 #ifdeà
__REDIRECT


443 
	`__REDIRECT
 (
vfsÿnf
,

444 (
FILE
 *
__»¡riù
 
__s
,

445 cÚ¡ *
__»¡riù
 
__fÜm©
, 
_G_va_li¡
 
__¬g
),

446 
__isoc99_vfsÿnf
)

447 
	`__©Œibu‹__
 ((
	$__fÜm©__
 (
__sÿnf__
, 2, 0))è
__wur
;

448 
	`__REDIRECT
 (
vsÿnf
, (cÚ¡ *
__»¡riù
 
__fÜm©
,

449 
_G_va_li¡
 
__¬g
), 
__isoc99_vsÿnf
)

450 
	`__©Œibu‹__
 ((
	$__fÜm©__
 (
__sÿnf__
, 1, 0))è
__wur
;

451 
	`__REDIRECT_NTH
 (
vssÿnf
,

452 (cÚ¡ *
__»¡riù
 
__s
,

453 cÚ¡ *
__»¡riù
 
__fÜm©
,

454 
_G_va_li¡
 
__¬g
), 
__isoc99_vssÿnf
)

455 
	`__©Œibu‹__
 ((
	`__fÜm©__
 (
__sÿnf__
, 2, 0)));

457 
	$__isoc99_vfsÿnf
 (
FILE
 *
__»¡riù
 
__s
,

458 cÚ¡ *
__»¡riù
 
__fÜm©
,

459 
_G_va_li¡
 
__¬g
è
__wur
;

460 
	$__isoc99_vsÿnf
 (cÚ¡ *
__»¡riù
 
__fÜm©
,

461 
_G_va_li¡
 
__¬g
è
__wur
;

462 
	$__isoc99_vssÿnf
 (cÚ¡ *
__»¡riù
 
__s
,

463 cÚ¡ *
__»¡riù
 
__fÜm©
,

464 
_G_va_li¡
 
__¬g
è
__THROW
;

465 
	#vfsÿnf
 
__isoc99_vfsÿnf


	)

466 
	#vsÿnf
 
__isoc99_vsÿnf


	)

467 
	#vssÿnf
 
__isoc99_vssÿnf


	)

477 
	`fg‘c
 (
FILE
 *
__¡»am
);

478 
	`g‘c
 (
FILE
 *
__¡»am
);

484 
	`g‘ch¬
 ();

488 
	#g‘c
(
_å
è
	`_IO_g‘c
 (_å)

	)

490 #ifdeà
__USE_POSIX199506


495 
	`g‘c_uÆocked
 (
FILE
 *
__¡»am
);

496 
	`g‘ch¬_uÆocked
 ();

499 #ifdeà
__USE_MISC


506 
	`fg‘c_uÆocked
 (
FILE
 *
__¡»am
);

517 
	`åutc
 (
__c
, 
FILE
 *
__¡»am
);

518 
	`putc
 (
__c
, 
FILE
 *
__¡»am
);

524 
	`putch¬
 (
__c
);

528 
	#putc
(
_ch
, 
_å
è
	`_IO_putc
 (_ch, _å)

	)

530 #ifdeà
__USE_MISC


537 
	`åutc_uÆocked
 (
__c
, 
FILE
 *
__¡»am
);

540 #ifdeà
__USE_POSIX199506


545 
	`putc_uÆocked
 (
__c
, 
FILE
 *
__¡»am
);

546 
	`putch¬_uÆocked
 (
__c
);

550 #ià
defšed
 
__USE_MISC
 \

551 || (
defšed
 
__USE_XOPEN
 && !defšed 
__USE_XOPEN2K
)

553 
	`g‘w
 (
FILE
 *
__¡»am
);

556 
	`putw
 (
__w
, 
FILE
 *
__¡»am
);

564 *
	$fg‘s
 (*
__»¡riù
 
__s
, 
__n
, 
FILE
 *__»¡riù 
__¡»am
)

565 
__wur
;

567 #ià
	`__GLIBC_USE
 (
DEPRECATED_GETS
)

577 *
	$g‘s
 (*
__s
è
__wur
 
__©Œibu‹_d•»ÿ‹d__
;

580 #ifdeà
__USE_GNU


587 *
	$fg‘s_uÆocked
 (*
__»¡riù
 
__s
, 
__n
,

588 
FILE
 *
__»¡riù
 
__¡»am
è
__wur
;

592 #ià
defšed
 
__USE_XOPEN2K8
 || 
	`__GLIBC_USE
 (
LIB_EXT2
)

603 
_IO_ssize_t
 
	$__g‘d–im
 (**
__»¡riù
 
__lš•Œ
,

604 
size_t
 *
__»¡riù
 
__n
, 
__d–im™”
,

605 
FILE
 *
__»¡riù
 
__¡»am
è
__wur
;

606 
_IO_ssize_t
 
	$g‘d–im
 (**
__»¡riù
 
__lš•Œ
,

607 
size_t
 *
__»¡riù
 
__n
, 
__d–im™”
,

608 
FILE
 *
__»¡riù
 
__¡»am
è
__wur
;

616 
_IO_ssize_t
 
	$g‘lše
 (**
__»¡riù
 
__lš•Œ
,

617 
size_t
 *
__»¡riù
 
__n
,

618 
FILE
 *
__»¡riù
 
__¡»am
è
__wur
;

626 
	`åuts
 (cÚ¡ *
__»¡riù
 
__s
, 
FILE
 *__»¡riù 
__¡»am
);

632 
	`puts
 (cÚ¡ *
__s
);

639 
	`ung‘c
 (
__c
, 
FILE
 *
__¡»am
);

646 
size_t
 
	$ä—d
 (*
__»¡riù
 
__±r
, 
size_t
 
__size
,

647 
size_t
 
__n
, 
FILE
 *
__»¡riù
 
__¡»am
è
__wur
;

652 
size_t
 
	`fwr™e
 (cÚ¡ *
__»¡riù
 
__±r
, size_ˆ
__size
,

653 
size_t
 
__n
, 
FILE
 *
__»¡riù
 
__s
);

655 #ifdeà
__USE_GNU


662 
	`åuts_uÆocked
 (cÚ¡ *
__»¡riù
 
__s
,

663 
FILE
 *
__»¡riù
 
__¡»am
);

666 #ifdeà
__USE_MISC


673 
size_t
 
	$ä—d_uÆocked
 (*
__»¡riù
 
__±r
, 
size_t
 
__size
,

674 
size_t
 
__n
, 
FILE
 *
__»¡riù
 
__¡»am
è
__wur
;

675 
size_t
 
	`fwr™e_uÆocked
 (cÚ¡ *
__»¡riù
 
__±r
, size_ˆ
__size
,

676 
size_t
 
__n
, 
FILE
 *
__»¡riù
 
__¡»am
);

684 
	`f£ek
 (
FILE
 *
__¡»am
, 
__off
, 
__wh’û
);

689 
	$á–l
 (
FILE
 *
__¡»am
è
__wur
;

694 
	`»wšd
 (
FILE
 *
__¡»am
);

701 #ià
defšed
 
__USE_LARGEFILE
 || defšed 
__USE_XOPEN2K


702 #iâdeà
__USE_FILE_OFFSET64


707 
	`f£eko
 (
FILE
 *
__¡»am
, 
__off_t
 
__off
, 
__wh’û
);

712 
__off_t
 
	$á–lo
 (
FILE
 *
__¡»am
è
__wur
;

714 #ifdeà
__REDIRECT


715 
	`__REDIRECT
 (
f£eko
,

716 (
FILE
 *
__¡»am
, 
__off64_t
 
__off
, 
__wh’û
),

717 
f£eko64
);

718 
__off64_t
 
	`__REDIRECT
 (
á–lo
, (
FILE
 *
__¡»am
), 
á–lo64
);

720 
	#f£eko
 
f£eko64


	)

721 
	#á–lo
 
á–lo64


	)

726 #iâdeà
__USE_FILE_OFFSET64


731 
	`fg‘pos
 (
FILE
 *
__»¡riù
 
__¡»am
, 
åos_t
 *__»¡riù 
__pos
);

736 
	`f£os
 (
FILE
 *
__¡»am
, cÚ¡ 
åos_t
 *
__pos
);

738 #ifdeà
__REDIRECT


739 
	`__REDIRECT
 (
fg‘pos
, (
FILE
 *
__»¡riù
 
__¡»am
,

740 
åos_t
 *
__»¡riù
 
__pos
), 
fg‘pos64
);

741 
	`__REDIRECT
 (
f£os
,

742 (
FILE
 *
__¡»am
, cÚ¡ 
åos_t
 *
__pos
), 
f£os64
);

744 
	#fg‘pos
 
fg‘pos64


	)

745 
	#f£os
 
f£os64


	)

749 #ifdeà
__USE_LARGEFILE64


750 
	`f£eko64
 (
FILE
 *
__¡»am
, 
__off64_t
 
__off
, 
__wh’û
);

751 
__off64_t
 
	$á–lo64
 (
FILE
 *
__¡»am
è
__wur
;

752 
	`fg‘pos64
 (
FILE
 *
__»¡riù
 
__¡»am
, 
åos64_t
 *__»¡riù 
__pos
);

753 
	`f£os64
 (
FILE
 *
__¡»am
, cÚ¡ 
åos64_t
 *
__pos
);

757 
	$ş—»¼
 (
FILE
 *
__¡»am
è
__THROW
;

759 
	$ãof
 (
FILE
 *
__¡»am
è
__THROW
 
__wur
;

761 
	$ã¼Ü
 (
FILE
 *
__¡»am
è
__THROW
 
__wur
;

763 #ifdeà
__USE_MISC


765 
	$ş—»¼_uÆocked
 (
FILE
 *
__¡»am
è
__THROW
;

766 
	$ãof_uÆocked
 (
FILE
 *
__¡»am
è
__THROW
 
__wur
;

767 
	$ã¼Ü_uÆocked
 (
FILE
 *
__¡»am
è
__THROW
 
__wur
;

775 
	`³¼Ü
 (cÚ¡ *
__s
);

781 
	~<b™s/sys_”¾i¡.h
>

784 #ifdef 
__USE_POSIX


786 
	$f’o
 (
FILE
 *
__¡»am
è
__THROW
 
__wur
;

789 #ifdeà
__USE_MISC


791 
	$f’o_uÆocked
 (
FILE
 *
__¡»am
è
__THROW
 
__wur
;

795 #ifdeà
__USE_POSIX2


800 
FILE
 *
	$pİ’
 (cÚ¡ *
__commªd
, cÚ¡ *
__modes
è
__wur
;

806 
	`pşo£
 (
FILE
 *
__¡»am
);

810 #ifdef 
__USE_POSIX


812 *
	$ù”mid
 (*
__s
è
__THROW
;

816 #ià(
defšed
 
__USE_XOPEN
 && !defšed 
__USE_XOPEN2K
è|| defšed 
__USE_GNU


818 *
	`cu£rid
 (*
__s
);

822 #ifdef 
__USE_GNU


823 
ob¡ack
;

826 
	$ob¡ack_´štf
 (
ob¡ack
 *
__»¡riù
 
__ob¡ack
,

827 cÚ¡ *
__»¡riù
 
__fÜm©
, ...)

828 
__THROWNL
 
	`__©Œibu‹__
 ((
	`__fÜm©__
 (
__´štf__
, 2, 3)));

829 
	$ob¡ack_v´štf
 (
ob¡ack
 *
__»¡riù
 
__ob¡ack
,

830 cÚ¡ *
__»¡riù
 
__fÜm©
,

831 
_G_va_li¡
 
__¬gs
)

832 
__THROWNL
 
	`__©Œibu‹__
 ((
	`__fÜm©__
 (
__´štf__
, 2, 0)));

836 #ifdeà
__USE_POSIX199506


840 
	$æockfe
 (
FILE
 *
__¡»am
è
__THROW
;

844 
	$árylockfe
 (
FILE
 *
__¡»am
è
__THROW
 
__wur
;

847 
	$fuÆockfe
 (
FILE
 *
__¡»am
è
__THROW
;

850 #ià
defšed
 
__USE_XOPEN
 && !defšed 
__USE_XOPEN2K
 && !defšed 
__USE_GNU


853 
	~<b™s/g‘İt_posix.h
>

858 #ifdeà
__USE_EXTERN_INLINES


859 
	~<b™s/¡dio.h
>

861 #ià
__USE_FORTIFY_LEVEL
 > 0 && 
defšed
 
__fÜtify_funùiÚ


862 
	~<b™s/¡dio2.h
>

864 #ifdeà
__LDBL_COMPAT


865 
	~<b™s/¡dio-ldbl.h
>

868 
__END_DECLS


	@/usr/include/stdlib.h

22 #iâdef 
_STDLIB_H


24 
	#__GLIBC_INTERNAL_STARTING_HEADER_IMPLEMENTATION


	)

25 
	~<b™s/libc-h—d”-¡¬t.h
>

28 
	#__Ãed_size_t


	)

29 
	#__Ãed_wch¬_t


	)

30 
	#__Ãed_NULL


	)

31 
	~<¡ddef.h
>

33 
	g__BEGIN_DECLS


35 
	#_STDLIB_H
 1

	)

37 #ià(
defšed
 
__USE_XOPEN
 || defšed 
__USE_XOPEN2K8
è&& !defšed 
_SYS_WAIT_H


39 
	~<b™s/wa™æags.h
>

40 
	~<b™s/wa™¡©us.h
>

43 
	#WEXITSTATUS
(
¡©us
è
	`__WEXITSTATUS
 (¡©us)

	)

44 
	#WTERMSIG
(
¡©us
è
	`__WTERMSIG
 (¡©us)

	)

45 
	#WSTOPSIG
(
¡©us
è
	`__WSTOPSIG
 (¡©us)

	)

46 
	#WIFEXITED
(
¡©us
è
	`__WIFEXITED
 (¡©us)

	)

47 
	#WIFSIGNALED
(
¡©us
è
	`__WIFSIGNALED
 (¡©us)

	)

48 
	#WIFSTOPPED
(
¡©us
è
	`__WIFSTOPPED
 (¡©us)

	)

49 #ifdeà
__WIFCONTINUED


50 
	#WIFCONTINUED
(
¡©us
è
	`__WIFCONTINUED
 (¡©us)

	)

55 
	~<b™s/æßŠ.h
>

60 
	mquÙ
;

61 
	m»m
;

62 } 
	tdiv_t
;

65 #iâdeà
__ldiv_t_defšed


68 
	mquÙ
;

69 
	m»m
;

70 } 
	tldiv_t
;

71 
	#__ldiv_t_defšed
 1

	)

74 #ià
defšed
 
__USE_ISOC99
 && !defšed 
__Îdiv_t_defšed


76 
__ex‹nsiÚ__
 struct

78 
	mquÙ
;

79 
	m»m
;

80 } 
	tÎdiv_t
;

81 
	#__Îdiv_t_defšed
 1

	)

86 
	#RAND_MAX
 2147483647

	)

91 
	#EXIT_FAILURE
 1

	)

92 
	#EXIT_SUCCESS
 0

	)

96 
	#MB_CUR_MAX
 (
	`__ùy³_g‘_mb_cur_max
 ())

	)

97 
size_t
 
	$__ùy³_g‘_mb_cur_max
 (è
__THROW
 
__wur
;

101 
	$©of
 (cÚ¡ *
__ÅŒ
)

102 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1)è
__wur
;

104 
	$©oi
 (cÚ¡ *
__ÅŒ
)

105 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1)è
__wur
;

107 
	$©Ş
 (cÚ¡ *
__ÅŒ
)

108 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1)è
__wur
;

110 #ifdeà
__USE_ISOC99


112 
__ex‹nsiÚ__
 
	$©Şl
 (cÚ¡ *
__ÅŒ
)

113 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1)è
__wur
;

117 
	$¡¹od
 (cÚ¡ *
__»¡riù
 
__ÅŒ
,

118 **
__»¡riù
 
__’d±r
)

119 
__THROW
 
	`__nÚnuÎ
 ((1));

121 #ifdef 
__USE_ISOC99


123 
	$¡¹of
 (cÚ¡ *
__»¡riù
 
__ÅŒ
,

124 **
__»¡riù
 
__’d±r
è
__THROW
 
	`__nÚnuÎ
 ((1));

126 
	$¡¹Şd
 (cÚ¡ *
__»¡riù
 
__ÅŒ
,

127 **
__»¡riù
 
__’d±r
)

128 
__THROW
 
	`__nÚnuÎ
 ((1));

133 #ià
__HAVE_FLOAT16
 && 
	`__GLIBC_USE
 (
IEC_60559_TYPES_EXT
)

134 
_Flßt16
 
	$¡¹of16
 (cÚ¡ *
__»¡riù
 
__ÅŒ
,

135 **
__»¡riù
 
__’d±r
)

136 
__THROW
 
	`__nÚnuÎ
 ((1));

139 #ià
__HAVE_FLOAT32
 && 
	`__GLIBC_USE
 (
IEC_60559_TYPES_EXT
)

140 
_Flßt32
 
	$¡¹of32
 (cÚ¡ *
__»¡riù
 
__ÅŒ
,

141 **
__»¡riù
 
__’d±r
)

142 
__THROW
 
	`__nÚnuÎ
 ((1));

145 #ià
__HAVE_FLOAT64
 && 
	`__GLIBC_USE
 (
IEC_60559_TYPES_EXT
)

146 
_Flßt64
 
	$¡¹of64
 (cÚ¡ *
__»¡riù
 
__ÅŒ
,

147 **
__»¡riù
 
__’d±r
)

148 
__THROW
 
	`__nÚnuÎ
 ((1));

151 #ià
__HAVE_FLOAT128
 && 
	`__GLIBC_USE
 (
IEC_60559_TYPES_EXT
)

152 
_Flßt128
 
	$¡¹of128
 (cÚ¡ *
__»¡riù
 
__ÅŒ
,

153 **
__»¡riù
 
__’d±r
)

154 
__THROW
 
	`__nÚnuÎ
 ((1));

157 #ià
__HAVE_FLOAT32X
 && 
	`__GLIBC_USE
 (
IEC_60559_TYPES_EXT
)

158 
_Flßt32x
 
	$¡¹of32x
 (cÚ¡ *
__»¡riù
 
__ÅŒ
,

159 **
__»¡riù
 
__’d±r
)

160 
__THROW
 
	`__nÚnuÎ
 ((1));

163 #ià
__HAVE_FLOAT64X
 && 
	`__GLIBC_USE
 (
IEC_60559_TYPES_EXT
)

164 
_Flßt64x
 
	$¡¹of64x
 (cÚ¡ *
__»¡riù
 
__ÅŒ
,

165 **
__»¡riù
 
__’d±r
)

166 
__THROW
 
	`__nÚnuÎ
 ((1));

169 #ià
__HAVE_FLOAT128X
 && 
	`__GLIBC_USE
 (
IEC_60559_TYPES_EXT
)

170 
_Flßt128x
 
	$¡¹of128x
 (cÚ¡ *
__»¡riù
 
__ÅŒ
,

171 **
__»¡riù
 
__’d±r
)

172 
__THROW
 
	`__nÚnuÎ
 ((1));

176 
	$¡¹Ş
 (cÚ¡ *
__»¡riù
 
__ÅŒ
,

177 **
__»¡riù
 
__’d±r
, 
__ba£
)

178 
__THROW
 
	`__nÚnuÎ
 ((1));

180 
	$¡¹oul
 (cÚ¡ *
__»¡riù
 
__ÅŒ
,

181 **
__»¡riù
 
__’d±r
, 
__ba£
)

182 
__THROW
 
	`__nÚnuÎ
 ((1));

184 #ifdeà
__USE_MISC


186 
__ex‹nsiÚ__


187 
	$¡¹oq
 (cÚ¡ *
__»¡riù
 
__ÅŒ
,

188 **
__»¡riù
 
__’d±r
, 
__ba£
)

189 
__THROW
 
	`__nÚnuÎ
 ((1));

191 
__ex‹nsiÚ__


192 
	$¡¹ouq
 (cÚ¡ *
__»¡riù
 
__ÅŒ
,

193 **
__»¡riù
 
__’d±r
, 
__ba£
)

194 
__THROW
 
	`__nÚnuÎ
 ((1));

197 #ifdeà
__USE_ISOC99


199 
__ex‹nsiÚ__


200 
	$¡¹Şl
 (cÚ¡ *
__»¡riù
 
__ÅŒ
,

201 **
__»¡riù
 
__’d±r
, 
__ba£
)

202 
__THROW
 
	`__nÚnuÎ
 ((1));

204 
__ex‹nsiÚ__


205 
	$¡¹ouÎ
 (cÚ¡ *
__»¡riù
 
__ÅŒ
,

206 **
__»¡riù
 
__’d±r
, 
__ba£
)

207 
__THROW
 
	`__nÚnuÎ
 ((1));

211 #ià
	`__GLIBC_USE
 (
IEC_60559_BFP_EXT
)

212 
	$¡räomd
 (*
__de¡
, 
size_t
 
__size
, cÚ¡ *
__fÜm©
,

213 
__f
)

214 
__THROW
 
	`__nÚnuÎ
 ((3));

216 
	$¡räomf
 (*
__de¡
, 
size_t
 
__size
, cÚ¡ *
__fÜm©
,

217 
__f
)

218 
__THROW
 
	`__nÚnuÎ
 ((3));

220 
	$¡räoml
 (*
__de¡
, 
size_t
 
__size
, cÚ¡ *
__fÜm©
,

221 
__f
)

222 
__THROW
 
	`__nÚnuÎ
 ((3));

225 #ià
__HAVE_FLOAT16
 && 
	`__GLIBC_USE
 (
IEC_60559_TYPES_EXT
)

226 
	$¡räomf16
 (*
__de¡
, 
size_t
 
__size
, cÚ¡ * 
__fÜm©
,

227 
_Flßt16
 
__f
)

228 
__THROW
 
	`__nÚnuÎ
 ((3));

231 #ià
__HAVE_FLOAT32
 && 
	`__GLIBC_USE
 (
IEC_60559_TYPES_EXT
)

232 
	$¡räomf32
 (*
__de¡
, 
size_t
 
__size
, cÚ¡ * 
__fÜm©
,

233 
_Flßt32
 
__f
)

234 
__THROW
 
	`__nÚnuÎ
 ((3));

237 #ià
__HAVE_FLOAT64
 && 
	`__GLIBC_USE
 (
IEC_60559_TYPES_EXT
)

238 
	$¡räomf64
 (*
__de¡
, 
size_t
 
__size
, cÚ¡ * 
__fÜm©
,

239 
_Flßt64
 
__f
)

240 
__THROW
 
	`__nÚnuÎ
 ((3));

243 #ià
__HAVE_FLOAT128
 && 
	`__GLIBC_USE
 (
IEC_60559_TYPES_EXT
)

244 
	$¡räomf128
 (*
__de¡
, 
size_t
 
__size
, cÚ¡ * 
__fÜm©
,

245 
_Flßt128
 
__f
)

246 
__THROW
 
	`__nÚnuÎ
 ((3));

249 #ià
__HAVE_FLOAT32X
 && 
	`__GLIBC_USE
 (
IEC_60559_TYPES_EXT
)

250 
	$¡räomf32x
 (*
__de¡
, 
size_t
 
__size
, cÚ¡ * 
__fÜm©
,

251 
_Flßt32x
 
__f
)

252 
__THROW
 
	`__nÚnuÎ
 ((3));

255 #ià
__HAVE_FLOAT64X
 && 
	`__GLIBC_USE
 (
IEC_60559_TYPES_EXT
)

256 
	$¡räomf64x
 (*
__de¡
, 
size_t
 
__size
, cÚ¡ * 
__fÜm©
,

257 
_Flßt64x
 
__f
)

258 
__THROW
 
	`__nÚnuÎ
 ((3));

261 #ià
__HAVE_FLOAT128X
 && 
	`__GLIBC_USE
 (
IEC_60559_TYPES_EXT
)

262 
	$¡räomf128x
 (*
__de¡
, 
size_t
 
__size
, cÚ¡ * 
__fÜm©
,

263 
_Flßt128x
 
__f
)

264 
__THROW
 
	`__nÚnuÎ
 ((3));

268 #ifdeà
__USE_GNU


272 
	~<b™s/ty³s/loÿË_t.h
>

274 
	$¡¹Ş_l
 (cÚ¡ *
__»¡riù
 
__ÅŒ
,

275 **
__»¡riù
 
__’d±r
, 
__ba£
,

276 
loÿË_t
 
__loc
è
__THROW
 
	`__nÚnuÎ
 ((1, 4));

278 
	$¡¹oul_l
 (cÚ¡ *
__»¡riù
 
__ÅŒ
,

279 **
__»¡riù
 
__’d±r
,

280 
__ba£
, 
loÿË_t
 
__loc
)

281 
__THROW
 
	`__nÚnuÎ
 ((1, 4));

283 
__ex‹nsiÚ__


284 
	$¡¹Şl_l
 (cÚ¡ *
__»¡riù
 
__ÅŒ
,

285 **
__»¡riù
 
__’d±r
, 
__ba£
,

286 
loÿË_t
 
__loc
)

287 
__THROW
 
	`__nÚnuÎ
 ((1, 4));

289 
__ex‹nsiÚ__


290 
	$¡¹ouÎ_l
 (cÚ¡ *
__»¡riù
 
__ÅŒ
,

291 **
__»¡riù
 
__’d±r
,

292 
__ba£
, 
loÿË_t
 
__loc
)

293 
__THROW
 
	`__nÚnuÎ
 ((1, 4));

295 
	$¡¹od_l
 (cÚ¡ *
__»¡riù
 
__ÅŒ
,

296 **
__»¡riù
 
__’d±r
, 
loÿË_t
 
__loc
)

297 
__THROW
 
	`__nÚnuÎ
 ((1, 3));

299 
	$¡¹of_l
 (cÚ¡ *
__»¡riù
 
__ÅŒ
,

300 **
__»¡riù
 
__’d±r
, 
loÿË_t
 
__loc
)

301 
__THROW
 
	`__nÚnuÎ
 ((1, 3));

303 
	$¡¹Şd_l
 (cÚ¡ *
__»¡riù
 
__ÅŒ
,

304 **
__»¡riù
 
__’d±r
,

305 
loÿË_t
 
__loc
)

306 
__THROW
 
	`__nÚnuÎ
 ((1, 3));

308 #ià
__HAVE_FLOAT16


309 
_Flßt16
 
	$¡¹of16_l
 (cÚ¡ *
__»¡riù
 
__ÅŒ
,

310 **
__»¡riù
 
__’d±r
,

311 
loÿË_t
 
__loc
)

312 
__THROW
 
	`__nÚnuÎ
 ((1, 3));

315 #ià
__HAVE_FLOAT32


316 
_Flßt32
 
	$¡¹of32_l
 (cÚ¡ *
__»¡riù
 
__ÅŒ
,

317 **
__»¡riù
 
__’d±r
,

318 
loÿË_t
 
__loc
)

319 
__THROW
 
	`__nÚnuÎ
 ((1, 3));

322 #ià
__HAVE_FLOAT64


323 
_Flßt64
 
	$¡¹of64_l
 (cÚ¡ *
__»¡riù
 
__ÅŒ
,

324 **
__»¡riù
 
__’d±r
,

325 
loÿË_t
 
__loc
)

326 
__THROW
 
	`__nÚnuÎ
 ((1, 3));

329 #ià
__HAVE_FLOAT128


330 
_Flßt128
 
	$¡¹of128_l
 (cÚ¡ *
__»¡riù
 
__ÅŒ
,

331 **
__»¡riù
 
__’d±r
,

332 
loÿË_t
 
__loc
)

333 
__THROW
 
	`__nÚnuÎ
 ((1, 3));

336 #ià
__HAVE_FLOAT32X


337 
_Flßt32x
 
	$¡¹of32x_l
 (cÚ¡ *
__»¡riù
 
__ÅŒ
,

338 **
__»¡riù
 
__’d±r
,

339 
loÿË_t
 
__loc
)

340 
__THROW
 
	`__nÚnuÎ
 ((1, 3));

343 #ià
__HAVE_FLOAT64X


344 
_Flßt64x
 
	$¡¹of64x_l
 (cÚ¡ *
__»¡riù
 
__ÅŒ
,

345 **
__»¡riù
 
__’d±r
,

346 
loÿË_t
 
__loc
)

347 
__THROW
 
	`__nÚnuÎ
 ((1, 3));

350 #ià
__HAVE_FLOAT128X


351 
_Flßt128x
 
	$¡¹of128x_l
 (cÚ¡ *
__»¡riù
 
__ÅŒ
,

352 **
__»¡riù
 
__’d±r
,

353 
loÿË_t
 
__loc
)

354 
__THROW
 
	`__nÚnuÎ
 ((1, 3));

359 #ifdeà
__USE_EXTERN_INLINES


360 
__ex‹º_šlše
 

361 
	`__NTH
 (
	$©oi
 (cÚ¡ *
__ÅŒ
))

363  (è
	`¡¹Ş
 (
__ÅŒ
, (**è
NULL
, 10);

364 
	}
}

365 
__ex‹º_šlše
 

366 
__NTH
 (
	$©Ş
 (cÚ¡ *
__ÅŒ
))

368  
	`¡¹Ş
 (
__ÅŒ
, (**è
NULL
, 10);

369 
	}
}

371 #ifdeà
__USE_ISOC99


372 
__ex‹nsiÚ__
 
__ex‹º_šlše
 

373 
__NTH
 (
	$©Şl
 (cÚ¡ *
__ÅŒ
))

375  
	`¡¹Şl
 (
__ÅŒ
, (**è
NULL
, 10);

376 
	}
}

381 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_XOPEN_EXTENDED


385 *
	$l64a
 (
__n
è
__THROW
 
__wur
;

388 
	$a64l
 (cÚ¡ *
__s
)

389 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1)è
__wur
;

393 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_XOPEN_EXTENDED


394 
	~<sys/ty³s.h
>

401 
	$¿ndom
 (è
__THROW
;

404 
	$¤ªdom
 (
__£ed
è
__THROW
;

410 *
	$š™¡©e
 (
__£ed
, *
__¡©ebuf
,

411 
size_t
 
__¡©–’
è
__THROW
 
	`__nÚnuÎ
 ((2));

415 *
	$£t¡©e
 (*
__¡©ebuf
è
__THROW
 
	`__nÚnuÎ
 ((1));

418 #ifdeà
__USE_MISC


423 
	s¿ndom_d©a


425 
št32_t
 *
åŒ
;

426 
št32_t
 *
½Œ
;

427 
št32_t
 *
¡©e
;

428 
¿nd_ty³
;

429 
¿nd_deg
;

430 
¿nd_£p
;

431 
št32_t
 *
’d_±r
;

434 
	$¿ndom_r
 (
¿ndom_d©a
 *
__»¡riù
 
__buf
,

435 
št32_t
 *
__»¡riù
 
__»suÉ
è
__THROW
 
	`__nÚnuÎ
 ((1, 2));

437 
	$¤ªdom_r
 (
__£ed
, 
¿ndom_d©a
 *
__buf
)

438 
__THROW
 
	`__nÚnuÎ
 ((2));

440 
	$š™¡©e_r
 (
__£ed
, *
__»¡riù
 
__¡©ebuf
,

441 
size_t
 
__¡©–’
,

442 
¿ndom_d©a
 *
__»¡riù
 
__buf
)

443 
__THROW
 
	`__nÚnuÎ
 ((2, 4));

445 
	$£t¡©e_r
 (*
__»¡riù
 
__¡©ebuf
,

446 
¿ndom_d©a
 *
__»¡riù
 
__buf
)

447 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

453 
	$¿nd
 (è
__THROW
;

455 
	$¤ªd
 (
__£ed
è
__THROW
;

457 #ifdeà
__USE_POSIX199506


459 
	$¿nd_r
 (*
__£ed
è
__THROW
;

463 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_XOPEN


467 
	$d¿nd48
 (è
__THROW
;

468 
	$”ªd48
 (
__xsubi
[3]è
__THROW
 
	`__nÚnuÎ
 ((1));

471 
	$Ìªd48
 (è
__THROW
;

472 
	$Äªd48
 (
__xsubi
[3])

473 
__THROW
 
	`__nÚnuÎ
 ((1));

476 
	$m¿nd48
 (è
__THROW
;

477 
	$j¿nd48
 (
__xsubi
[3])

478 
__THROW
 
	`__nÚnuÎ
 ((1));

481 
	$¤ªd48
 (
__£edv®
è
__THROW
;

482 *
	$£ed48
 (
__£ed16v
[3])

483 
__THROW
 
	`__nÚnuÎ
 ((1));

484 
	$lcÚg48
 (
__·¿m
[7]è
__THROW
 
	`__nÚnuÎ
 ((1));

486 #ifdeà
__USE_MISC


490 
	sd¿nd48_d©a


492 
__x
[3];

493 
__Şd_x
[3];

494 
__c
;

495 
__š™
;

496 
__ex‹nsiÚ__
 
__a
;

501 
	$d¿nd48_r
 (
d¿nd48_d©a
 *
__»¡riù
 
__bufãr
,

502 *
__»¡riù
 
__»suÉ
è
__THROW
 
	`__nÚnuÎ
 ((1, 2));

503 
	$”ªd48_r
 (
__xsubi
[3],

504 
d¿nd48_d©a
 *
__»¡riù
 
__bufãr
,

505 *
__»¡riù
 
__»suÉ
è
__THROW
 
	`__nÚnuÎ
 ((1, 2));

508 
	$Ìªd48_r
 (
d¿nd48_d©a
 *
__»¡riù
 
__bufãr
,

509 *
__»¡riù
 
__»suÉ
)

510 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

511 
	$Äªd48_r
 (
__xsubi
[3],

512 
d¿nd48_d©a
 *
__»¡riù
 
__bufãr
,

513 *
__»¡riù
 
__»suÉ
)

514 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

517 
	$m¿nd48_r
 (
d¿nd48_d©a
 *
__»¡riù
 
__bufãr
,

518 *
__»¡riù
 
__»suÉ
)

519 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

520 
	$j¿nd48_r
 (
__xsubi
[3],

521 
d¿nd48_d©a
 *
__»¡riù
 
__bufãr
,

522 *
__»¡riù
 
__»suÉ
)

523 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

526 
	$¤ªd48_r
 (
__£edv®
, 
d¿nd48_d©a
 *
__bufãr
)

527 
__THROW
 
	`__nÚnuÎ
 ((2));

529 
	$£ed48_r
 (
__£ed16v
[3],

530 
d¿nd48_d©a
 *
__bufãr
è
__THROW
 
	`__nÚnuÎ
 ((1, 2));

532 
	$lcÚg48_r
 (
__·¿m
[7],

533 
d¿nd48_d©a
 *
__bufãr
)

534 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

539 *
	$m®loc
 (
size_t
 
__size
è
__THROW
 
__©Œibu‹_m®loc__
 
__wur
;

541 *
	$ÿÎoc
 (
size_t
 
__nmemb
, size_ˆ
__size
)

542 
__THROW
 
__©Œibu‹_m®loc__
 
__wur
;

549 *
	$»®loc
 (*
__±r
, 
size_t
 
__size
)

550 
__THROW
 
__©Œibu‹_w¬n_unu£d_»suÉ__
;

552 #ifdeà
__USE_GNU


558 *
	$»®loÿ¼ay
 (*
__±r
, 
size_t
 
__nmemb
, size_ˆ
__size
)

559 
__THROW
 
__©Œibu‹_w¬n_unu£d_»suÉ__
;

563 
	$ä“
 (*
__±r
è
__THROW
;

565 #ifdeà
__USE_MISC


566 
	~<®loÿ.h
>

569 #ià(
defšed
 
__USE_XOPEN_EXTENDED
 && !defšed 
__USE_XOPEN2K
) \

570 || 
defšed
 
__USE_MISC


572 *
	$v®loc
 (
size_t
 
__size
è
__THROW
 
__©Œibu‹_m®loc__
 
__wur
;

575 #ifdeà
__USE_XOPEN2K


577 
	$posix_mem®ign
 (**
__mem±r
, 
size_t
 
__®ignm’t
, size_ˆ
__size
)

578 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

581 #ifdeà
__USE_ISOC11


583 *
	$®igÃd_®loc
 (
size_t
 
__®ignm’t
, size_ˆ
__size
)

584 
__THROW
 
__©Œibu‹_m®loc__
 
	`__©Œibu‹_®loc_size__
 ((2)è
__wur
;

588 
	$abÜt
 (è
__THROW
 
	`__©Œibu‹__
 ((
__nÜ‘uº__
));

592 
	$©ex™
 ((*
__func
è()è
__THROW
 
	`__nÚnuÎ
 ((1));

594 #ià
defšed
 
__USE_ISOC11
 || defšed 
__USE_ISOCXX11


596 #ifdeà
__ılu¥lus


597 "C++" 
	$©_quick_ex™
 ((*
__func
) ())

598 
__THROW
 
	`__asm
 ("©_quick_ex™"è
	`__nÚnuÎ
 ((1));

600 
	$©_quick_ex™
 ((*
__func
è()è
__THROW
 
	`__nÚnuÎ
 ((1));

604 #ifdef 
__USE_MISC


607 
	$Ú_ex™
 ((*
__func
è(
__¡©us
, *
__¬g
), *__arg)

608 
__THROW
 
	`__nÚnuÎ
 ((1));

614 
	$ex™
 (
__¡©us
è
__THROW
 
	`__©Œibu‹__
 ((
__nÜ‘uº__
));

616 #ià
defšed
 
__USE_ISOC11
 || defšed 
__USE_ISOCXX11


620 
	$quick_ex™
 (
__¡©us
è
__THROW
 
	`__©Œibu‹__
 ((
__nÜ‘uº__
));

623 #ifdeà
__USE_ISOC99


626 
	$_Ex™
 (
__¡©us
è
__THROW
 
	`__©Œibu‹__
 ((
__nÜ‘uº__
));

631 *
	$g‘’v
 (cÚ¡ *
__Çme
è
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

633 #ifdeà
__USE_GNU


636 *
	$£cu»_g‘’v
 (cÚ¡ *
__Çme
)

637 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

640 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_XOPEN


644 
	$pu‹nv
 (*
__¡ršg
è
__THROW
 
	`__nÚnuÎ
 ((1));

647 #ifdeà
__USE_XOPEN2K


650 
	$£‹nv
 (cÚ¡ *
__Çme
, cÚ¡ *
__v®ue
, 
__»¶aû
)

651 
__THROW
 
	`__nÚnuÎ
 ((2));

654 
	$un£‹nv
 (cÚ¡ *
__Çme
è
__THROW
 
	`__nÚnuÎ
 ((1));

657 #ifdef 
__USE_MISC


661 
	$ş—»nv
 (è
__THROW
;

665 #ià
defšed
 
__USE_MISC
 \

666 || (
defšed
 
__USE_XOPEN_EXTENDED
 && !defšed 
__USE_XOPEN2K8
)

672 *
	$mk‹mp
 (*
__‹m¶©e
è
__THROW
 
	`__nÚnuÎ
 ((1));

675 #ià
defšed
 
__USE_XOPEN_EXTENDED
 || defšed 
__USE_XOPEN2K8


684 #iâdeà
__USE_FILE_OFFSET64


685 
	$mk¡emp
 (*
__‹m¶©e
è
	`__nÚnuÎ
 ((1)è
__wur
;

687 #ifdeà
__REDIRECT


688 
	`__REDIRECT
 (
mk¡emp
, (*
__‹m¶©e
), 
mk¡emp64
)

689 
	`__nÚnuÎ
 ((1)è
__wur
;

691 
	#mk¡emp
 
mk¡emp64


	)

694 #ifdeà
__USE_LARGEFILE64


695 
	$mk¡emp64
 (*
__‹m¶©e
è
	`__nÚnuÎ
 ((1)è
__wur
;

699 #ifdeà
__USE_MISC


706 #iâdeà
__USE_FILE_OFFSET64


707 
	$mk¡emps
 (*
__‹m¶©e
, 
__suffixËn
è
	`__nÚnuÎ
 ((1)è
__wur
;

709 #ifdeà
__REDIRECT


710 
	`__REDIRECT
 (
mk¡emps
, (*
__‹m¶©e
, 
__suffixËn
),

711 
mk¡emps64
è
	`__nÚnuÎ
 ((1)è
__wur
;

713 
	#mk¡emps
 
mk¡emps64


	)

716 #ifdeà
__USE_LARGEFILE64


717 
	$mk¡emps64
 (*
__‹m¶©e
, 
__suffixËn
)

718 
	`__nÚnuÎ
 ((1)è
__wur
;

722 #ifdeà
__USE_XOPEN2K8


728 *
	$mkd‹mp
 (*
__‹m¶©e
è
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

731 #ifdeà
__USE_GNU


738 #iâdeà
__USE_FILE_OFFSET64


739 
	$mko¡emp
 (*
__‹m¶©e
, 
__æags
è
	`__nÚnuÎ
 ((1)è
__wur
;

741 #ifdeà
__REDIRECT


742 
	`__REDIRECT
 (
mko¡emp
, (*
__‹m¶©e
, 
__æags
), 
mko¡emp64
)

743 
	`__nÚnuÎ
 ((1)è
__wur
;

745 
	#mko¡emp
 
mko¡emp64


	)

748 #ifdeà
__USE_LARGEFILE64


749 
	$mko¡emp64
 (*
__‹m¶©e
, 
__æags
è
	`__nÚnuÎ
 ((1)è
__wur
;

758 #iâdeà
__USE_FILE_OFFSET64


759 
	$mko¡emps
 (*
__‹m¶©e
, 
__suffixËn
, 
__æags
)

760 
	`__nÚnuÎ
 ((1)è
__wur
;

762 #ifdeà
__REDIRECT


763 
	`__REDIRECT
 (
mko¡emps
, (*
__‹m¶©e
, 
__suffixËn
,

764 
__æags
), 
mko¡emps64
)

765 
	`__nÚnuÎ
 ((1)è
__wur
;

767 
	#mko¡emps
 
mko¡emps64


	)

770 #ifdeà
__USE_LARGEFILE64


771 
	$mko¡emps64
 (*
__‹m¶©e
, 
__suffixËn
, 
__æags
)

772 
	`__nÚnuÎ
 ((1)è
__wur
;

781 
	$sy¡em
 (cÚ¡ *
__commªd
è
__wur
;

784 #ifdef 
__USE_GNU


787 *
	$ÿnÚiÿlize_fe_Çme
 (cÚ¡ *
__Çme
)

788 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

791 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_XOPEN_EXTENDED


797 *
	$»®·th
 (cÚ¡ *
__»¡riù
 
__Çme
,

798 *
__»¡riù
 
__»sŞved
è
__THROW
 
__wur
;

803 #iâdeà
__COMPAR_FN_T


804 
	#__COMPAR_FN_T


	)

805 (*
	t__com·r_â_t
) (const *, const *);

807 #ifdef 
__USE_GNU


808 
__com·r_â_t
 
	tcom·risÚ_â_t
;

811 #ifdeà
__USE_GNU


812 (*
	t__com·r_d_â_t
) (const *, const *, *);

817 *
	$b£¬ch
 (cÚ¡ *
__key
, cÚ¡ *
__ba£
,

818 
size_t
 
__nmemb
, size_ˆ
__size
, 
__com·r_â_t
 
__com·r
)

819 
	`__nÚnuÎ
 ((1, 2, 5)è
__wur
;

821 #ifdeà
__USE_EXTERN_INLINES


822 
	~<b™s/¡dlib-b£¬ch.h
>

827 
	$qsÜt
 (*
__ba£
, 
size_t
 
__nmemb
, size_ˆ
__size
,

828 
__com·r_â_t
 
__com·r
è
	`__nÚnuÎ
 ((1, 4));

829 #ifdeà
__USE_GNU


830 
	$qsÜt_r
 (*
__ba£
, 
size_t
 
__nmemb
, size_ˆ
__size
,

831 
__com·r_d_â_t
 
__com·r
, *
__¬g
)

832 
	`__nÚnuÎ
 ((1, 4));

837 
	$abs
 (
__x
è
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
)è
__wur
;

838 
	$Ïbs
 (
__x
è
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
)è
__wur
;

840 #ifdeà
__USE_ISOC99


841 
__ex‹nsiÚ__
 
	$Îabs
 (
__x
)

842 
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
)è
__wur
;

849 
div_t
 
	$div
 (
__num”
, 
__d’om
)

850 
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
)è
__wur
;

851 
ldiv_t
 
	$ldiv
 (
__num”
, 
__d’om
)

852 
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
)è
__wur
;

854 #ifdeà
__USE_ISOC99


855 
__ex‹nsiÚ__
 
Îdiv_t
 
	$Îdiv
 (
__num”
,

856 
__d’om
)

857 
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
)è
__wur
;

861 #ià(
defšed
 
__USE_XOPEN_EXTENDED
 && !defšed 
__USE_XOPEN2K8
) \

862 || 
defšed
 
__USE_MISC


869 *
	$ecvt
 (
__v®ue
, 
__ndig™
, *
__»¡riù
 
__deıt
,

870 *
__»¡riù
 
__sign
è
__THROW
 
	`__nÚnuÎ
 ((3, 4)è
__wur
;

875 *
	$fcvt
 (
__v®ue
, 
__ndig™
, *
__»¡riù
 
__deıt
,

876 *
__»¡riù
 
__sign
è
__THROW
 
	`__nÚnuÎ
 ((3, 4)è
__wur
;

881 *
	$gcvt
 (
__v®ue
, 
__ndig™
, *
__buf
)

882 
__THROW
 
	`__nÚnuÎ
 ((3)è
__wur
;

885 #ifdeà
__USE_MISC


887 *
	$qecvt
 (
__v®ue
, 
__ndig™
,

888 *
__»¡riù
 
__deıt
, *__»¡riù 
__sign
)

889 
__THROW
 
	`__nÚnuÎ
 ((3, 4)è
__wur
;

890 *
	$qfcvt
 (
__v®ue
, 
__ndig™
,

891 *
__»¡riù
 
__deıt
, *__»¡riù 
__sign
)

892 
__THROW
 
	`__nÚnuÎ
 ((3, 4)è
__wur
;

893 *
	$qgcvt
 (
__v®ue
, 
__ndig™
, *
__buf
)

894 
__THROW
 
	`__nÚnuÎ
 ((3)è
__wur
;

899 
	$ecvt_r
 (
__v®ue
, 
__ndig™
, *
__»¡riù
 
__deıt
,

900 *
__»¡riù
 
__sign
, *__»¡riù 
__buf
,

901 
size_t
 
__Ën
è
__THROW
 
	`__nÚnuÎ
 ((3, 4, 5));

902 
	$fcvt_r
 (
__v®ue
, 
__ndig™
, *
__»¡riù
 
__deıt
,

903 *
__»¡riù
 
__sign
, *__»¡riù 
__buf
,

904 
size_t
 
__Ën
è
__THROW
 
	`__nÚnuÎ
 ((3, 4, 5));

906 
	$qecvt_r
 (
__v®ue
, 
__ndig™
,

907 *
__»¡riù
 
__deıt
, *__»¡riù 
__sign
,

908 *
__»¡riù
 
__buf
, 
size_t
 
__Ën
)

909 
__THROW
 
	`__nÚnuÎ
 ((3, 4, 5));

910 
	$qfcvt_r
 (
__v®ue
, 
__ndig™
,

911 *
__»¡riù
 
__deıt
, *__»¡riù 
__sign
,

912 *
__»¡riù
 
__buf
, 
size_t
 
__Ën
)

913 
__THROW
 
	`__nÚnuÎ
 ((3, 4, 5));

919 
	$mbËn
 (cÚ¡ *
__s
, 
size_t
 
__n
è
__THROW
;

922 
	$mbtowc
 (
wch¬_t
 *
__»¡riù
 
__pwc
,

923 cÚ¡ *
__»¡riù
 
__s
, 
size_t
 
__n
è
__THROW
;

926 
	$wùomb
 (*
__s
, 
wch¬_t
 
__wch¬
è
__THROW
;

930 
size_t
 
	$mb¡owcs
 (
wch¬_t
 *
__»¡riù
 
__pwcs
,

931 cÚ¡ *
__»¡riù
 
__s
, 
size_t
 
__n
è
__THROW
;

933 
size_t
 
	$wc¡ombs
 (*
__»¡riù
 
__s
,

934 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__pwcs
, 
size_t
 
__n
)

935 
__THROW
;

938 #ifdeà
__USE_MISC


943 
	$½m©ch
 (cÚ¡ *
__»¥Ú£
è
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

947 #ià
defšed
 
__USE_XOPEN_EXTENDED
 || defšed 
__USE_XOPEN2K8


954 
	$g‘subİt
 (**
__»¡riù
 
__İtiÚp
,

955 *cÚ¡ *
__»¡riù
 
__tok’s
,

956 **
__»¡riù
 
__v®u•
)

957 
__THROW
 
	`__nÚnuÎ
 ((1, 2, 3)è
__wur
;

961 #ifdeà
__USE_XOPEN


963 
	$£tkey
 (cÚ¡ *
__key
è
__THROW
 
	`__nÚnuÎ
 ((1));

969 #ifdeà
__USE_XOPEN2KXSI


971 
	$posix_İ’±
 (
__oæag
è
__wur
;

974 #ifdeà
__USE_XOPEN_EXTENDED


979 
	$g¿Á±
 (
__fd
è
__THROW
;

983 
	$uÆock±
 (
__fd
è
__THROW
;

988 *
	$±¢ame
 (
__fd
è
__THROW
 
__wur
;

991 #ifdeà
__USE_GNU


995 
	$±¢ame_r
 (
__fd
, *
__buf
, 
size_t
 
__buæ’
)

996 
__THROW
 
	`__nÚnuÎ
 ((2));

999 
	`g‘±
 ();

1002 #ifdeà
__USE_MISC


1006 
	$g‘lßdavg
 (
__lßdavg
[], 
__ÃËm
)

1007 
__THROW
 
	`__nÚnuÎ
 ((1));

1010 #ià
defšed
 
__USE_XOPEN_EXTENDED
 && !defšed 
__USE_XOPEN2K


1013 
	$‰y¦Ù
 (è
__THROW
;

1016 
	~<b™s/¡dlib-æßt.h
>

1019 #ià
__USE_FORTIFY_LEVEL
 > 0 && 
defšed
 
__fÜtify_funùiÚ


1020 
	~<b™s/¡dlib.h
>

1022 #ifdeà
__LDBL_COMPAT


1023 
	~<b™s/¡dlib-ldbl.h
>

1026 
__END_DECLS


	@/usr/include/string.h

22 #iâdef 
_STRING_H


23 
	#_STRING_H
 1

	)

25 
	#__GLIBC_INTERNAL_STARTING_HEADER_IMPLEMENTATION


	)

26 
	~<b™s/libc-h—d”-¡¬t.h
>

28 
	g__BEGIN_DECLS


31 
	#__Ãed_size_t


	)

32 
	#__Ãed_NULL


	)

33 
	~<¡ddef.h
>

36 #ià
defšed
 
__ılu¥lus
 && 
__GNUC_PREREQ
 (4, 4)

37 
	#__CORRECT_ISO_CPP_STRING_H_PROTO


	)

42 *
	$memıy
 (*
__»¡riù
 
__de¡
, cÚ¡ *__»¡riù 
__¤c
,

43 
size_t
 
__n
è
__THROW
 
	`__nÚnuÎ
 ((1, 2));

46 *
	$memmove
 (*
__de¡
, cÚ¡ *
__¤c
, 
size_t
 
__n
)

47 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

52 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_XOPEN


53 *
	$memcıy
 (*
__»¡riù
 
__de¡
, cÚ¡ *__»¡riù 
__¤c
,

54 
__c
, 
size_t
 
__n
)

55 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

60 *
	$mem£t
 (*
__s
, 
__c
, 
size_t
 
__n
è
__THROW
 
	`__nÚnuÎ
 ((1));

63 
	$memcmp
 (cÚ¡ *
__s1
, cÚ¡ *
__s2
, 
size_t
 
__n
)

64 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

67 #ifdeà
__CORRECT_ISO_CPP_STRING_H_PROTO


70 *
	`memchr
 (*
__s
, 
__c
, 
size_t
 
__n
)

71 
__THROW
 
	`__asm
 ("memchr"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

72 cÚ¡ *
	`memchr
 (cÚ¡ *
__s
, 
__c
, 
size_t
 
__n
)

73 
__THROW
 
	`__asm
 ("memchr"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

75 #ifdeà
__OPTIMIZE__


76 
__ex‹º_®ways_šlše
 *

77 
	`memchr
 (*
__s
, 
__c
, 
size_t
 
__n
è
__THROW


79  
	`__butš_memchr
 (
__s
, 
__c
, 
__n
);

82 
__ex‹º_®ways_šlše
 const *

83 
	`memchr
 (cÚ¡ *
__s
, 
__c
, 
size_t
 
__n
è
__THROW


85  
	`__butš_memchr
 (
__s
, 
__c
, 
__n
);

88 
	}
}

90 *
	$memchr
 (cÚ¡ *
__s
, 
__c
, 
size_t
 
__n
)

91 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

94 #ifdeà
__USE_GNU


97 #ifdeà
__CORRECT_ISO_CPP_STRING_H_PROTO


98 "C++" *
	$¿wmemchr
 (*
__s
, 
__c
)

99 
__THROW
 
	`__asm
 ("¿wmemchr"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

100 "C++" cÚ¡ *
	$¿wmemchr
 (cÚ¡ *
__s
, 
__c
)

101 
__THROW
 
	`__asm
 ("¿wmemchr"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

103 *
	$¿wmemchr
 (cÚ¡ *
__s
, 
__c
)

104 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

108 #ifdeà
__CORRECT_ISO_CPP_STRING_H_PROTO


109 "C++" *
	$memrchr
 (*
__s
, 
__c
, 
size_t
 
__n
)

110 
__THROW
 
	`__asm
 ("memrchr"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

111 "C++" cÚ¡ *
	$memrchr
 (cÚ¡ *
__s
, 
__c
, 
size_t
 
__n
)

112 
__THROW
 
	`__asm
 ("memrchr"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

114 *
	$memrchr
 (cÚ¡ *
__s
, 
__c
, 
size_t
 
__n
)

115 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

121 *
	$¡rıy
 (*
__»¡riù
 
__de¡
, cÚ¡ *__»¡riù 
__¤c
)

122 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

124 *
	$¡ºıy
 (*
__»¡riù
 
__de¡
,

125 cÚ¡ *
__»¡riù
 
__¤c
, 
size_t
 
__n
)

126 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

129 *
	$¡rÿt
 (*
__»¡riù
 
__de¡
, cÚ¡ *__»¡riù 
__¤c
)

130 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

132 *
	$¡ºÿt
 (*
__»¡riù
 
__de¡
, cÚ¡ *__»¡riù 
__¤c
,

133 
size_t
 
__n
è
__THROW
 
	`__nÚnuÎ
 ((1, 2));

136 
	$¡rcmp
 (cÚ¡ *
__s1
, cÚ¡ *
__s2
)

137 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

139 
	$¡ºcmp
 (cÚ¡ *
__s1
, cÚ¡ *
__s2
, 
size_t
 
__n
)

140 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

143 
	$¡rcŞl
 (cÚ¡ *
__s1
, cÚ¡ *
__s2
)

144 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

146 
size_t
 
	$¡rxäm
 (*
__»¡riù
 
__de¡
,

147 cÚ¡ *
__»¡riù
 
__¤c
, 
size_t
 
__n
)

148 
__THROW
 
	`__nÚnuÎ
 ((2));

150 #ifdeà
__USE_XOPEN2K8


152 
	~<b™s/ty³s/loÿË_t.h
>

155 
	$¡rcŞl_l
 (cÚ¡ *
__s1
, cÚ¡ *
__s2
, 
loÿË_t
 
__l
)

156 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2, 3));

159 
size_t
 
	$¡rxäm_l
 (*
__de¡
, cÚ¡ *
__¤c
, 
size_t
 
__n
,

160 
loÿË_t
 
__l
è
__THROW
 
	`__nÚnuÎ
 ((2, 4));

163 #ià(
defšed
 
__USE_XOPEN_EXTENDED
 || defšed 
__USE_XOPEN2K8
 \

164 || 
	$__GLIBC_USE
 (
LIB_EXT2
))

166 *
	$¡rdup
 (cÚ¡ *
__s
)

167 
__THROW
 
__©Œibu‹_m®loc__
 
	`__nÚnuÎ
 ((1));

173 #ià
defšed
 
__USE_XOPEN2K8
 || 
	`__GLIBC_USE
 (
LIB_EXT2
)

174 *
	$¡ºdup
 (cÚ¡ *
__¡ršg
, 
size_t
 
__n
)

175 
__THROW
 
__©Œibu‹_m®loc__
 
	`__nÚnuÎ
 ((1));

178 #ià
defšed
 
__USE_GNU
 && defšed 
__GNUC__


180 
	#¡rdu·
(
s
) \

181 (
__ex‹nsiÚ__
 \

183 cÚ¡ *
__Şd
 = (
s
); \

184 
size_t
 
__Ën
 = 
	`¡¾’
 (
__Şd
) + 1; \

185 *
__Ãw
 = (*è
	`__butš_®loÿ
 (
__Ën
); \

186 (*è
	`memıy
 (
__Ãw
, 
__Şd
, 
__Ën
); \

187 
	}
}))

	)

190 
	#¡ºdu·
(
s
, 
n
) \

191 (
__ex‹nsiÚ__
 \

193 cÚ¡ *
__Şd
 = (
s
); \

194 
size_t
 
__Ën
 = 
	`¡ºËn
 (
__Şd
, (
n
)); \

195 *
__Ãw
 = (*è
	`__butš_®loÿ
 (
__Ën
 + 1); \

196 
__Ãw
[
__Ën
] = '\0'; \

197 (*è
	`memıy
 (
__Ãw
, 
__Şd
, 
__Ën
); \

198 }))

	)

202 #ifdeà
__CORRECT_ISO_CPP_STRING_H_PROTO


205 *
¡rchr
 (*
__s
, 
__c
)

206 
__THROW
 
__asm
 ("¡rchr"è
__©Œibu‹_pu»__
 
__nÚnuÎ
 ((1));

207 cÚ¡ *
¡rchr
 (cÚ¡ *
__s
, 
__c
)

208 
__THROW
 
__asm
 ("¡rchr"è
__©Œibu‹_pu»__
 
__nÚnuÎ
 ((1));

210 #ifdeà
__OPTIMIZE__


211 
__ex‹º_®ways_šlše
 *

212 
¡rchr
 (*
__s
, 
__c
è
	g__THROW


214  
__butš_¡rchr
 (
__s
, 
__c
);

217 
__ex‹º_®ways_šlše
 const *

218 
¡rchr
 (cÚ¡ *
__s
, 
__c
è
	g__THROW


220  
__butš_¡rchr
 (
__s
, 
__c
);

225 *
	$¡rchr
 (cÚ¡ *
__s
, 
__c
)

226 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

229 #ifdeà
__CORRECT_ISO_CPP_STRING_H_PROTO


232 *
	`¡¼chr
 (*
__s
, 
__c
)

233 
__THROW
 
	`__asm
 ("¡¼chr"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

234 cÚ¡ *
	`¡¼chr
 (cÚ¡ *
__s
, 
__c
)

235 
__THROW
 
	`__asm
 ("¡¼chr"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

237 #ifdeà
__OPTIMIZE__


238 
__ex‹º_®ways_šlše
 *

239 
	`¡¼chr
 (*
__s
, 
__c
è
__THROW


241  
	`__butš_¡¼chr
 (
__s
, 
__c
);

244 
__ex‹º_®ways_šlše
 const *

245 
	`¡¼chr
 (cÚ¡ *
__s
, 
__c
è
__THROW


247  
	`__butš_¡¼chr
 (
__s
, 
__c
);

250 
	}
}

252 *
	$¡¼chr
 (cÚ¡ *
__s
, 
__c
)

253 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

256 #ifdeà
__USE_GNU


259 #ifdeà
__CORRECT_ISO_CPP_STRING_H_PROTO


260 "C++" *
	$¡rchºul
 (*
__s
, 
__c
)

261 
__THROW
 
	`__asm
 ("¡rchºul"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

262 "C++" cÚ¡ *
	$¡rchºul
 (cÚ¡ *
__s
, 
__c
)

263 
__THROW
 
	`__asm
 ("¡rchºul"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

265 *
	$¡rchºul
 (cÚ¡ *
__s
, 
__c
)

266 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

272 
size_t
 
	$¡rc¥n
 (cÚ¡ *
__s
, cÚ¡ *
__»jeù
)

273 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

276 
size_t
 
	$¡r¥n
 (cÚ¡ *
__s
, cÚ¡ *
__acû±
)

277 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

279 #ifdeà
__CORRECT_ISO_CPP_STRING_H_PROTO


282 *
	`¡½brk
 (*
__s
, cÚ¡ *
__acû±
)

283 
__THROW
 
	`__asm
 ("¡½brk"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

284 cÚ¡ *
	`¡½brk
 (cÚ¡ *
__s
, cÚ¡ *
__acû±
)

285 
__THROW
 
	`__asm
 ("¡½brk"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

287 #ifdeà
__OPTIMIZE__


288 
__ex‹º_®ways_šlše
 *

289 
	`¡½brk
 (*
__s
, cÚ¡ *
__acû±
è
__THROW


291  
	`__butš_¡½brk
 (
__s
, 
__acû±
);

294 
__ex‹º_®ways_šlše
 const *

295 
	`¡½brk
 (cÚ¡ *
__s
, cÚ¡ *
__acû±
è
__THROW


297  
	`__butš_¡½brk
 (
__s
, 
__acû±
);

300 
	}
}

302 *
	$¡½brk
 (cÚ¡ *
__s
, cÚ¡ *
__acû±
)

303 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

306 #ifdeà
__CORRECT_ISO_CPP_STRING_H_PROTO


309 *
	`¡r¡r
 (*
__hay¡ack
, cÚ¡ *
__ÃedË
)

310 
__THROW
 
	`__asm
 ("¡r¡r"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

311 cÚ¡ *
	`¡r¡r
 (cÚ¡ *
__hay¡ack
, cÚ¡ *
__ÃedË
)

312 
__THROW
 
	`__asm
 ("¡r¡r"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

314 #ifdeà
__OPTIMIZE__


315 
__ex‹º_®ways_šlše
 *

316 
	`¡r¡r
 (*
__hay¡ack
, cÚ¡ *
__ÃedË
è
__THROW


318  
	`__butš_¡r¡r
 (
__hay¡ack
, 
__ÃedË
);

321 
__ex‹º_®ways_šlše
 const *

322 
	`¡r¡r
 (cÚ¡ *
__hay¡ack
, cÚ¡ *
__ÃedË
è
__THROW


324  
	`__butš_¡r¡r
 (
__hay¡ack
, 
__ÃedË
);

327 
	}
}

329 *
	$¡r¡r
 (cÚ¡ *
__hay¡ack
, cÚ¡ *
__ÃedË
)

330 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

335 *
	$¡¹ok
 (*
__»¡riù
 
__s
, cÚ¡ *__»¡riù 
__d–im
)

336 
__THROW
 
	`__nÚnuÎ
 ((2));

340 *
	$__¡¹ok_r
 (*
__»¡riù
 
__s
,

341 cÚ¡ *
__»¡riù
 
__d–im
,

342 **
__»¡riù
 
__§ve_±r
)

343 
__THROW
 
	`__nÚnuÎ
 ((2, 3));

344 #ifdeà
__USE_POSIX


345 *
	$¡¹ok_r
 (*
__»¡riù
 
__s
, cÚ¡ *__»¡riù 
__d–im
,

346 **
__»¡riù
 
__§ve_±r
)

347 
__THROW
 
	`__nÚnuÎ
 ((2, 3));

350 #ifdeà
__USE_GNU


352 #ifdeà
__CORRECT_ISO_CPP_STRING_H_PROTO


353 "C++" *
	$¡rÿ£¡r
 (*
__hay¡ack
, cÚ¡ *
__ÃedË
)

354 
__THROW
 
	`__asm
 ("¡rÿ£¡r"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

355 "C++" cÚ¡ *
	$¡rÿ£¡r
 (cÚ¡ *
__hay¡ack
,

356 cÚ¡ *
__ÃedË
)

357 
__THROW
 
	`__asm
 ("¡rÿ£¡r"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

359 *
	$¡rÿ£¡r
 (cÚ¡ *
__hay¡ack
, cÚ¡ *
__ÃedË
)

360 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

364 #ifdeà
__USE_GNU


368 *
	$memmem
 (cÚ¡ *
__hay¡ack
, 
size_t
 
__hay¡ackËn
,

369 cÚ¡ *
__ÃedË
, 
size_t
 
__ÃedËËn
)

370 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 3));

374 *
	$__mempıy
 (*
__»¡riù
 
__de¡
,

375 cÚ¡ *
__»¡riù
 
__¤c
, 
size_t
 
__n
)

376 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

377 *
	$mempıy
 (*
__»¡riù
 
__de¡
,

378 cÚ¡ *
__»¡riù
 
__¤c
, 
size_t
 
__n
)

379 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

384 
size_t
 
	$¡¾’
 (cÚ¡ *
__s
)

385 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

387 #ifdef 
__USE_XOPEN2K8


390 
size_t
 
	$¡ºËn
 (cÚ¡ *
__¡ršg
, 
size_t
 
__maxËn
)

391 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

396 *
	$¡»¼Ü
 (
__”ºum
è
__THROW
;

397 #ifdeà
__USE_XOPEN2K


405 #ià
defšed
 
__USE_XOPEN2K
 && !defšed 
__USE_GNU


408 #ifdeà
__REDIRECT_NTH


409 
	`__REDIRECT_NTH
 (
¡»¼Ü_r
,

410 (
__”ºum
, *
__buf
, 
size_t
 
__buæ’
),

411 
__xpg_¡»¼Ü_r
è
	`__nÚnuÎ
 ((2));

413 
	$__xpg_¡»¼Ü_r
 (
__”ºum
, *
__buf
, 
size_t
 
__buæ’
)

414 
__THROW
 
	`__nÚnuÎ
 ((2));

415 
	#¡»¼Ü_r
 
__xpg_¡»¼Ü_r


	)

420 *
	$¡»¼Ü_r
 (
__”ºum
, *
__buf
, 
size_t
 
__buæ’
)

421 
__THROW
 
	`__nÚnuÎ
 ((2)è
__wur
;

425 #ifdeà
__USE_XOPEN2K8


427 *
	$¡»¼Ü_l
 (
__”ºum
, 
loÿË_t
 
__l
è
__THROW
;

430 #ifdeà
__USE_MISC


431 
	~<¡ršgs.h
>

435 
	$ex¶ic™_bz”o
 (*
__s
, 
size_t
 
__n
è
__THROW
 
	`__nÚnuÎ
 ((1));

439 *
	$¡r£p
 (**
__»¡riù
 
__¡ršgp
,

440 cÚ¡ *
__»¡riù
 
__d–im
)

441 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

444 #ifdef 
__USE_XOPEN2K8


446 *
	$¡rsigÇl
 (
__sig
è
__THROW
;

449 *
	$__¡pıy
 (*
__»¡riù
 
__de¡
, cÚ¡ *__»¡riù 
__¤c
)

450 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

451 *
	$¡pıy
 (*
__»¡riù
 
__de¡
, cÚ¡ *__»¡riù 
__¤c
)

452 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

456 *
	$__¡²ıy
 (*
__»¡riù
 
__de¡
,

457 cÚ¡ *
__»¡riù
 
__¤c
, 
size_t
 
__n
)

458 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

459 *
	$¡²ıy
 (*
__»¡riù
 
__de¡
,

460 cÚ¡ *
__»¡riù
 
__¤c
, 
size_t
 
__n
)

461 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

464 #ifdef 
__USE_GNU


466 
	$¡rv”scmp
 (cÚ¡ *
__s1
, cÚ¡ *
__s2
)

467 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

470 *
	$¡räy
 (*
__¡ršg
è
__THROW
 
	`__nÚnuÎ
 ((1));

473 *
	$memäob
 (*
__s
, 
size_t
 
__n
è
__THROW
 
	`__nÚnuÎ
 ((1));

475 #iâdeà
ba£Çme


480 #ifdeà
__CORRECT_ISO_CPP_STRING_H_PROTO


481 "C++" *
	$ba£Çme
 (*
__f’ame
)

482 
__THROW
 
	`__asm
 ("ba£Çme"è
	`__nÚnuÎ
 ((1));

483 "C++" cÚ¡ *
	$ba£Çme
 (cÚ¡ *
__f’ame
)

484 
__THROW
 
	`__asm
 ("ba£Çme"è
	`__nÚnuÎ
 ((1));

486 *
	$ba£Çme
 (cÚ¡ *
__f’ame
è
__THROW
 
	`__nÚnuÎ
 ((1));

491 #ià
	`__GNUC_PREREQ
 (3,4)

492 #ià
__USE_FORTIFY_LEVEL
 > 0 && 
defšed
 
__fÜtify_funùiÚ


494 
	~<b™s/¡ršg_fÜtif›d.h
>

498 
__END_DECLS


	@/usr/include/strings.h

18 #iâdef 
_STRINGS_H


19 
	#_STRINGS_H
 1

	)

21 
	~<ã©u»s.h
>

22 
	#__Ãed_size_t


	)

23 
	~<¡ddef.h
>

26 #ià
defšed
 
__ılu¥lus
 && 
__GNUC_PREREQ
 (4, 4)

27 
	#__CORRECT_ISO_CPP_STRINGS_H_PROTO


	)

30 
	g__BEGIN_DECLS


32 #ià
defšed
 
__USE_MISC
 || !defšed 
__USE_XOPEN2K8


34 
	$bcmp
 (cÚ¡ *
__s1
, cÚ¡ *
__s2
, 
size_t
 
__n
)

35 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

38 
	$bcİy
 (cÚ¡ *
__¤c
, *
__de¡
, 
size_t
 
__n
)

39 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

42 
	$bz”o
 (*
__s
, 
size_t
 
__n
è
__THROW
 
	`__nÚnuÎ
 ((1));

45 #ifdeà
__CORRECT_ISO_CPP_STRINGS_H_PROTO


48 *
	`šdex
 (*
__s
, 
__c
)

49 
__THROW
 
	`__asm
 ("šdex"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

50 cÚ¡ *
	`šdex
 (cÚ¡ *
__s
, 
__c
)

51 
__THROW
 
	`__asm
 ("šdex"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

53 #ià
defšed
 
__OPTIMIZE__


54 
__ex‹º_®ways_šlše
 *

55 
	`šdex
 (*
__s
, 
__c
è
__THROW


57  
	`__butš_šdex
 (
__s
, 
__c
);

60 
__ex‹º_®ways_šlše
 const *

61 
	`šdex
 (cÚ¡ *
__s
, 
__c
è
__THROW


63  
	`__butš_šdex
 (
__s
, 
__c
);

66 
	}
}

68 *
	$šdex
 (cÚ¡ *
__s
, 
__c
)

69 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

73 #ifdeà
__CORRECT_ISO_CPP_STRINGS_H_PROTO


76 *
	`ršdex
 (*
__s
, 
__c
)

77 
__THROW
 
	`__asm
 ("ršdex"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

78 cÚ¡ *
	`ršdex
 (cÚ¡ *
__s
, 
__c
)

79 
__THROW
 
	`__asm
 ("ršdex"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

81 #ià
defšed
 
__OPTIMIZE__


82 
__ex‹º_®ways_šlše
 *

83 
	`ršdex
 (*
__s
, 
__c
è
__THROW


85  
	`__butš_ršdex
 (
__s
, 
__c
);

88 
__ex‹º_®ways_šlše
 const *

89 
	`ršdex
 (cÚ¡ *
__s
, 
__c
è
__THROW


91  
	`__butš_ršdex
 (
__s
, 
__c
);

94 
	}
}

96 *
	$ršdex
 (cÚ¡ *
__s
, 
__c
)

97 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

101 #ià
defšed
 
__USE_MISC
 || !defšed 
__USE_XOPEN2K8
 || defšed 
__USE_XOPEN2K8XSI


104 
	$ffs
 (
__i
è
__THROW
 
__©Œibu‹_cÚ¡__
;

109 #ifdef 
__USE_MISC


110 
	$ff¦
 (
__l
è
__THROW
 
__©Œibu‹_cÚ¡__
;

111 
__ex‹nsiÚ__
 
	$ff¦l
 (
__Î
)

112 
__THROW
 
__©Œibu‹_cÚ¡__
;

116 
	$¡rÿ£cmp
 (cÚ¡ *
__s1
, cÚ¡ *
__s2
)

117 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

120 
	$¡ºÿ£cmp
 (cÚ¡ *
__s1
, cÚ¡ *
__s2
, 
size_t
 
__n
)

121 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

123 #ifdef 
__USE_XOPEN2K8


125 
	~<b™s/ty³s/loÿË_t.h
>

128 
	$¡rÿ£cmp_l
 (cÚ¡ *
__s1
, cÚ¡ *
__s2
, 
loÿË_t
 
__loc
)

129 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2, 3));

133 
	$¡ºÿ£cmp_l
 (cÚ¡ *
__s1
, cÚ¡ *
__s2
,

134 
size_t
 
__n
, 
loÿË_t
 
__loc
)

135 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2, 4));

138 
__END_DECLS


140 #ià
	`__GNUC_PREREQ
 (3,4è&& 
__USE_FORTIFY_LEVEL
 > 0 \

141 && 
defšed
 
__fÜtify_funùiÚ


143 #ià
defšed
 
__USE_MISC
 || !defšed 
__USE_XOPEN2K8


144 
	~<b™s/¡ršgs_fÜtif›d.h
>

	@/usr/include/syslog.h

1 
	~<sys/sy¦og.h
>

	@/usr/include/time.h

22 #iâdef 
_TIME_H


23 
	#_TIME_H
 1

	)

25 
	~<ã©u»s.h
>

27 
	#__Ãed_size_t


	)

28 
	#__Ãed_NULL


	)

29 
	~<¡ddef.h
>

33 
	~<b™s/time.h
>

37 
	~<b™s/ty³s/şock_t.h
>

38 
	~<b™s/ty³s/time_t.h
>

39 
	~<b™s/ty³s/¡ruù_tm.h
>

41 #ià
defšed
 
__USE_POSIX199309
 || defšed 
__USE_ISOC11


42 
	~<b™s/ty³s/¡ruù_time¥ec.h
>

45 #ifdeà
__USE_POSIX199309


46 
	~<b™s/ty³s/şockid_t.h
>

47 
	~<b™s/ty³s/tim”_t.h
>

48 
	~<b™s/ty³s/¡ruù_™im”¥ec.h
>

49 
	gsigev’t
;

52 #ifdeà
__USE_XOPEN2K


53 #iâdeà
__pid_t_defšed


54 
__pid_t
 
	tpid_t
;

55 
	#__pid_t_defšed


	)

59 #ifdeà
__USE_XOPEN2K8


60 
	~<b™s/ty³s/loÿË_t.h
>

63 #ifdeà
__USE_ISOC11


65 
	#TIME_UTC
 1

	)

68 
__BEGIN_DECLS


72 
şock_t
 
	$şock
 (è
__THROW
;

75 
time_t
 
	$time
 (
time_t
 *
__tim”
è
__THROW
;

78 
	$difáime
 (
time_t
 
__time1
,ime_ˆ
__time0
)

79 
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
));

82 
time_t
 
	$mktime
 (
tm
 *
__
è
__THROW
;

88 
size_t
 
	$¡ráime
 (*
__»¡riù
 
__s
, 
size_t
 
__maxsize
,

89 cÚ¡ *
__»¡riù
 
__fÜm©
,

90 cÚ¡ 
tm
 *
__»¡riù
 
__
è
__THROW
;

92 #ifdeà
__USE_XOPEN


95 *
	$¡½time
 (cÚ¡ *
__»¡riù
 
__s
,

96 cÚ¡ *
__»¡riù
 
__fmt
, 
tm
 *
__
)

97 
__THROW
;

100 #ifdeà
__USE_XOPEN2K8


104 
size_t
 
	$¡ráime_l
 (*
__»¡riù
 
__s
, 
size_t
 
__maxsize
,

105 cÚ¡ *
__»¡riù
 
__fÜm©
,

106 cÚ¡ 
tm
 *
__»¡riù
 
__
,

107 
loÿË_t
 
__loc
è
__THROW
;

110 #ifdeà
__USE_GNU


111 *
	$¡½time_l
 (cÚ¡ *
__»¡riù
 
__s
,

112 cÚ¡ *
__»¡riù
 
__fmt
, 
tm
 *
__
,

113 
loÿË_t
 
__loc
è
__THROW
;

119 
tm
 *
	$gmtime
 (cÚ¡ 
time_t
 *
__tim”
è
__THROW
;

123 
tm
 *
	$loÿÉime
 (cÚ¡ 
time_t
 *
__tim”
è
__THROW
;

125 #ifdeà
__USE_POSIX


128 
tm
 *
	$gmtime_r
 (cÚ¡ 
time_t
 *
__»¡riù
 
__tim”
,

129 
tm
 *
__»¡riù
 
__
è
__THROW
;

133 
tm
 *
	$loÿÉime_r
 (cÚ¡ 
time_t
 *
__»¡riù
 
__tim”
,

134 
tm
 *
__»¡riù
 
__
è
__THROW
;

139 *
	$asùime
 (cÚ¡ 
tm
 *
__
è
__THROW
;

142 *
	$ùime
 (cÚ¡ 
time_t
 *
__tim”
è
__THROW
;

144 #ifdeà
__USE_POSIX


149 *
	$asùime_r
 (cÚ¡ 
tm
 *
__»¡riù
 
__
,

150 *
__»¡riù
 
__buf
è
__THROW
;

153 *
	$ùime_r
 (cÚ¡ 
time_t
 *
__»¡riù
 
__tim”
,

154 *
__»¡riù
 
__buf
è
__THROW
;

159 *
__tzÇme
[2];

160 
__daylight
;

161 
__timezÚe
;

164 #ifdef 
__USE_POSIX


166 *
tzÇme
[2];

170 
	$tz£t
 (è
__THROW
;

173 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_XOPEN


174 
daylight
;

175 
timezÚe
;

178 #ifdeà
__USE_MISC


181 
	$¡ime
 (cÚ¡ 
time_t
 *
__wh’
è
__THROW
;

187 
	#__i¦—p
(
y—r
) \

188 ((
y—r
è% 4 =ğ0 && ((y—rè% 100 !ğ0 || (y—rè% 400 =ğ0))

	)

191 #ifdeà
__USE_MISC


196 
time_t
 
	$timegm
 (
tm
 *
__
è
__THROW
;

199 
time_t
 
	$tim–oÿl
 (
tm
 *
__
è
__THROW
;

202 
	$dysize
 (
__y—r
è
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
));

206 #ifdeà
__USE_POSIX199309


211 
	`Çno¦“p
 (cÚ¡ 
time¥ec
 *
__»que¡ed_time
,

212 
time¥ec
 *
__»maššg
);

216 
	$şock_g‘»s
 (
şockid_t
 
__şock_id
, 
time¥ec
 *
__»s
è
__THROW
;

219 
	$şock_g‘time
 (
şockid_t
 
__şock_id
, 
time¥ec
 *
__
è
__THROW
;

222 
	$şock_£‰ime
 (
şockid_t
 
__şock_id
, cÚ¡ 
time¥ec
 *
__
)

223 
__THROW
;

225 #ifdeà
__USE_XOPEN2K


230 
	`şock_Çno¦“p
 (
şockid_t
 
__şock_id
, 
__æags
,

231 cÚ¡ 
time¥ec
 *
__»q
,

232 
time¥ec
 *
__»m
);

235 
	$şock_g‘ıuşockid
 (
pid_t
 
__pid
, 
şockid_t
 *
__şock_id
è
__THROW
;

240 
	$tim”_ü—‹
 (
şockid_t
 
__şock_id
,

241 
sigev’t
 *
__»¡riù
 
__evp
,

242 
tim”_t
 *
__»¡riù
 
__tim”id
è
__THROW
;

245 
	$tim”_d–‘e
 (
tim”_t
 
__tim”id
è
__THROW
;

248 
	$tim”_£‰ime
 (
tim”_t
 
__tim”id
, 
__æags
,

249 cÚ¡ 
™im”¥ec
 *
__»¡riù
 
__v®ue
,

250 
™im”¥ec
 *
__»¡riù
 
__ov®ue
è
__THROW
;

253 
	$tim”_g‘time
 (
tim”_t
 
__tim”id
, 
™im”¥ec
 *
__v®ue
)

254 
__THROW
;

257 
	$tim”_g‘ov”run
 (
tim”_t
 
__tim”id
è
__THROW
;

261 #ifdeà
__USE_ISOC11


263 
	$time¥ec_g‘
 (
time¥ec
 *
__ts
, 
__ba£
)

264 
__THROW
 
	`__nÚnuÎ
 ((1));

268 #ifdeà
__USE_XOPEN_EXTENDED


280 
g‘d©e_”r
;

289 
tm
 *
	`g‘d©e
 (cÚ¡ *
__¡ršg
);

292 #ifdeà
__USE_GNU


303 
	`g‘d©e_r
 (cÚ¡ *
__»¡riù
 
__¡ršg
,

304 
tm
 *
__»¡riù
 
__»sbuå
);

307 
__END_DECLS


	@/usr/include/unistd.h

22 #iâdef 
_UNISTD_H


23 
	#_UNISTD_H
 1

	)

25 
	~<ã©u»s.h
>

27 
	g__BEGIN_DECLS


32 #ifdeà
__USE_XOPEN2K8


34 
	#_POSIX_VERSION
 200809L

	)

35 #–ià
defšed
 
__USE_XOPEN2K


37 
	#_POSIX_VERSION
 200112L

	)

38 #–ià
defšed
 
__USE_POSIX199506


40 
	#_POSIX_VERSION
 199506L

	)

41 #–ià
defšed
 
__USE_POSIX199309


43 
	#_POSIX_VERSION
 199309L

	)

46 
	#_POSIX_VERSION
 199009L

	)

52 #ifdeà
__USE_XOPEN2K8


53 
	#__POSIX2_THIS_VERSION
 200809L

	)

55 #–ià
defšed
 
__USE_XOPEN2K


57 
	#__POSIX2_THIS_VERSION
 200112L

	)

58 #–ià
defšed
 
__USE_POSIX199506


60 
	#__POSIX2_THIS_VERSION
 199506L

	)

63 
	#__POSIX2_THIS_VERSION
 199209L

	)

67 
	#_POSIX2_VERSION
 
__POSIX2_THIS_VERSION


	)

70 
	#_POSIX2_C_VERSION
 
__POSIX2_THIS_VERSION


	)

74 
	#_POSIX2_C_BIND
 
__POSIX2_THIS_VERSION


	)

78 
	#_POSIX2_C_DEV
 
__POSIX2_THIS_VERSION


	)

82 
	#_POSIX2_SW_DEV
 
__POSIX2_THIS_VERSION


	)

86 
	#_POSIX2_LOCALEDEF
 
__POSIX2_THIS_VERSION


	)

89 #ifdeà
__USE_XOPEN2K8


90 
	#_XOPEN_VERSION
 700

	)

91 #–ià
defšed
 
__USE_XOPEN2K


92 
	#_XOPEN_VERSION
 600

	)

93 #–ià
defšed
 
__USE_UNIX98


94 
	#_XOPEN_VERSION
 500

	)

96 
	#_XOPEN_VERSION
 4

	)

100 
	#_XOPEN_XCU_VERSION
 4

	)

103 
	#_XOPEN_XPG2
 1

	)

104 
	#_XOPEN_XPG3
 1

	)

105 
	#_XOPEN_XPG4
 1

	)

108 
	#_XOPEN_UNIX
 1

	)

111 
	#_XOPEN_CRYPT
 1

	)

115 
	#_XOPEN_ENH_I18N
 1

	)

118 
	#_XOPEN_LEGACY
 1

	)

205 
	~<b™s/posix_İt.h
>

208 #ià
defšed
 
__USE_UNIX98
 || defšed 
__USE_XOPEN2K


209 
	~<b™s/’vœÚm’ts.h
>

213 
	#STDIN_FILENO
 0

	)

214 
	#STDOUT_FILENO
 1

	)

215 
	#STDERR_FILENO
 2

	)

220 
	~<b™s/ty³s.h
>

222 #iâdef 
__ssize_t_defšed


223 
__ssize_t
 
	tssize_t
;

224 
	#__ssize_t_defšed


	)

227 
	#__Ãed_size_t


	)

228 
	#__Ãed_NULL


	)

229 
	~<¡ddef.h
>

231 #ià
defšed
 
__USE_XOPEN
 || defšed 
__USE_XOPEN2K


234 #iâdeà
__gid_t_defšed


235 
__gid_t
 
	tgid_t
;

236 
	#__gid_t_defšed


	)

239 #iâdeà
__uid_t_defšed


240 
__uid_t
 
	tuid_t
;

241 
	#__uid_t_defšed


	)

244 #iâdeà
__off_t_defšed


245 #iâdeà
__USE_FILE_OFFSET64


246 
__off_t
 
	toff_t
;

248 
__off64_t
 
	toff_t
;

250 
	#__off_t_defšed


	)

252 #ià
defšed
 
__USE_LARGEFILE64
 && !defšed 
__off64_t_defšed


253 
__off64_t
 
	toff64_t
;

254 
	#__off64_t_defšed


	)

257 #iâdeà
__u£cÚds_t_defšed


258 
__u£cÚds_t
 
	tu£cÚds_t
;

259 
	#__u£cÚds_t_defšed


	)

262 #iâdeà
__pid_t_defšed


263 
__pid_t
 
	tpid_t
;

264 
	#__pid_t_defšed


	)

268 #ià
defšed
 
__USE_XOPEN_EXTENDED
 || defšed 
__USE_XOPEN2K


269 #iâdeà
__šŒ_t_defšed


270 
__šŒ_t
 
	tšŒ_t
;

271 
	#__šŒ_t_defšed


	)

275 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_XOPEN


276 #iâdeà
__sockËn_t_defšed


277 
__sockËn_t
 
	tsockËn_t
;

278 
	#__sockËn_t_defšed


	)

284 
	#R_OK
 4

	)

285 
	#W_OK
 2

	)

286 
	#X_OK
 1

	)

287 
	#F_OK
 0

	)

290 
	$acûss
 (cÚ¡ *
__Çme
, 
__ty³
è
__THROW
 
	`__nÚnuÎ
 ((1));

292 #ifdeà
__USE_GNU


295 
	$euidacûss
 (cÚ¡ *
__Çme
, 
__ty³
)

296 
__THROW
 
	`__nÚnuÎ
 ((1));

299 
	$—cûss
 (cÚ¡ *
__Çme
, 
__ty³
)

300 
__THROW
 
	`__nÚnuÎ
 ((1));

303 #ifdeà
__USE_ATFILE


307 
	$çcûs§t
 (
__fd
, cÚ¡ *
__fe
, 
__ty³
, 
__æag
)

308 
__THROW
 
	`__nÚnuÎ
 ((2)è
__wur
;

313 #iâdef 
_STDIO_H


314 
	#SEEK_SET
 0

	)

315 
	#SEEK_CUR
 1

	)

316 
	#SEEK_END
 2

	)

317 #ifdeà
__USE_GNU


318 
	#SEEK_DATA
 3

	)

319 
	#SEEK_HOLE
 4

	)

323 #ià
defšed
 
__USE_MISC
 && !defšed 
L_SET


325 
	#L_SET
 
SEEK_SET


	)

326 
	#L_INCR
 
SEEK_CUR


	)

327 
	#L_XTND
 
SEEK_END


	)

336 #iâdeà
__USE_FILE_OFFSET64


337 
__off_t
 
	$l£ek
 (
__fd
, 
__off_t
 
__off£t
, 
__wh’û
è
__THROW
;

339 #ifdeà
__REDIRECT_NTH


340 
__off64_t
 
	`__REDIRECT_NTH
 (
l£ek
,

341 (
__fd
, 
__off64_t
 
__off£t
, 
__wh’û
),

342 
l£ek64
);

344 
	#l£ek
 
l£ek64


	)

347 #ifdeà
__USE_LARGEFILE64


348 
__off64_t
 
	$l£ek64
 (
__fd
, 
__off64_t
 
__off£t
, 
__wh’û
)

349 
__THROW
;

356 
	`şo£
 (
__fd
);

363 
ssize_t
 
	$»ad
 (
__fd
, *
__buf
, 
size_t
 
__nby‹s
è
__wur
;

369 
ssize_t
 
	$wr™e
 (
__fd
, cÚ¡ *
__buf
, 
size_t
 
__n
è
__wur
;

371 #ià
defšed
 
__USE_UNIX98
 || defšed 
__USE_XOPEN2K8


372 #iâdeà
__USE_FILE_OFFSET64


379 
ssize_t
 
	$´—d
 (
__fd
, *
__buf
, 
size_t
 
__nby‹s
,

380 
__off_t
 
__off£t
è
__wur
;

387 
ssize_t
 
	$pwr™e
 (
__fd
, cÚ¡ *
__buf
, 
size_t
 
__n
,

388 
__off_t
 
__off£t
è
__wur
;

390 #ifdeà
__REDIRECT


391 
ssize_t
 
	`__REDIRECT
 (
´—d
, (
__fd
, *
__buf
, 
size_t
 
__nby‹s
,

392 
__off64_t
 
__off£t
),

393 
´—d64
è
__wur
;

394 
ssize_t
 
	`__REDIRECT
 (
pwr™e
, (
__fd
, cÚ¡ *
__buf
,

395 
size_t
 
__nby‹s
, 
__off64_t
 
__off£t
),

396 
pwr™e64
è
__wur
;

398 
	#´—d
 
´—d64


	)

399 
	#pwr™e
 
pwr™e64


	)

403 #ifdeà
__USE_LARGEFILE64


407 
ssize_t
 
	$´—d64
 (
__fd
, *
__buf
, 
size_t
 
__nby‹s
,

408 
__off64_t
 
__off£t
è
__wur
;

411 
ssize_t
 
	$pwr™e64
 (
__fd
, cÚ¡ *
__buf
, 
size_t
 
__n
,

412 
__off64_t
 
__off£t
è
__wur
;

420 
	$pe
 (
__pedes
[2]è
__THROW
 
__wur
;

422 #ifdeà
__USE_GNU


425 
	$pe2
 (
__pedes
[2], 
__æags
è
__THROW
 
__wur
;

435 
	$®¬m
 (
__£cÚds
è
__THROW
;

447 
	`¦“p
 (
__£cÚds
);

449 #ià(
defšed
 
__USE_XOPEN_EXTENDED
 && !defšed 
__USE_XOPEN2K8
) \

450 || 
defšed
 
__USE_MISC


455 
__u£cÚds_t
 
	$u®¬m
 (
__u£cÚds_t
 
__v®ue
, __u£cÚds_ˆ
__š‹rv®
)

456 
__THROW
;

463 
	`u¦“p
 (
__u£cÚds_t
 
__u£cÚds
);

472 
	`·u£
 ();

476 
	$chown
 (cÚ¡ *
__fe
, 
__uid_t
 
__owÃr
, 
__gid_t
 
__group
)

477 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

479 #ià
defšed
 
__USE_XOPEN_EXTENDED
 || defšed 
__USE_XOPEN2K8


481 
	$fchown
 (
__fd
, 
__uid_t
 
__owÃr
, 
__gid_t
 
__group
è
__THROW
 
__wur
;

486 
	$lchown
 (cÚ¡ *
__fe
, 
__uid_t
 
__owÃr
, 
__gid_t
 
__group
)

487 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

491 #ifdeà
__USE_ATFILE


494 
	$fchowÇt
 (
__fd
, cÚ¡ *
__fe
, 
__uid_t
 
__owÃr
,

495 
__gid_t
 
__group
, 
__æag
)

496 
__THROW
 
	`__nÚnuÎ
 ((2)è
__wur
;

500 
	$chdœ
 (cÚ¡ *
__·th
è
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

502 #ià
defšed
 
__USE_XOPEN_EXTENDED
 || defšed 
__USE_XOPEN2K8


504 
	$fchdœ
 (
__fd
è
__THROW
 
__wur
;

514 *
	$g‘cwd
 (*
__buf
, 
size_t
 
__size
è
__THROW
 
__wur
;

516 #ifdef 
__USE_GNU


520 *
	$g‘_cu¼’t_dœ_Çme
 (è
__THROW
;

523 #ià(
defšed
 
__USE_XOPEN_EXTENDED
 && !defšed 
__USE_XOPEN2K8
) \

524 || 
defšed
 
__USE_MISC


528 *
	$g‘wd
 (*
__buf
)

529 
__THROW
 
	`__nÚnuÎ
 ((1)è
__©Œibu‹_d•»ÿ‹d__
 
__wur
;

534 
	$dup
 (
__fd
è
__THROW
 
__wur
;

537 
	$dup2
 (
__fd
, 
__fd2
è
__THROW
;

539 #ifdeà
__USE_GNU


542 
	$dup3
 (
__fd
, 
__fd2
, 
__æags
è
__THROW
;

546 **
__’vœÚ
;

547 #ifdeà
__USE_GNU


548 **
’vœÚ
;

554 
	$execve
 (cÚ¡ *
__·th
, *cÚ¡ 
__¬gv
[],

555 *cÚ¡ 
__’vp
[]è
__THROW
 
	`__nÚnuÎ
 ((1, 2));

557 #ifdeà
__USE_XOPEN2K8


560 
	$ãxecve
 (
__fd
, *cÚ¡ 
__¬gv
[], *cÚ¡ 
__’vp
[])

561 
__THROW
 
	`__nÚnuÎ
 ((2));

566 
	$execv
 (cÚ¡ *
__·th
, *cÚ¡ 
__¬gv
[])

567 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

571 
	$exeşe
 (cÚ¡ *
__·th
, cÚ¡ *
__¬g
, ...)

572 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

576 
	$exeş
 (cÚ¡ *
__·th
, cÚ¡ *
__¬g
, ...)

577 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

581 
	$execvp
 (cÚ¡ *
__fe
, *cÚ¡ 
__¬gv
[])

582 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

587 
	$exeşp
 (cÚ¡ *
__fe
, cÚ¡ *
__¬g
, ...)

588 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

590 #ifdeà
__USE_GNU


593 
	$execv³
 (cÚ¡ *
__fe
, *cÚ¡ 
__¬gv
[],

594 *cÚ¡ 
__’vp
[])

595 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

599 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_XOPEN


601 
	$niû
 (
__šc
è
__THROW
 
__wur
;

606 
	$_ex™
 (
__¡©us
è
	`__©Œibu‹__
 ((
__nÜ‘uº__
));

612 
	~<b™s/cÚâame.h
>

615 
	$·thcÚf
 (cÚ¡ *
__·th
, 
__Çme
)

616 
__THROW
 
	`__nÚnuÎ
 ((1));

619 
	$å©hcÚf
 (
__fd
, 
__Çme
è
__THROW
;

622 
	$syscÚf
 (
__Çme
è
__THROW
;

624 #ifdef 
__USE_POSIX2


626 
size_t
 
	$cÚf¡r
 (
__Çme
, *
__buf
, 
size_t
 
__Ën
è
__THROW
;

631 
__pid_t
 
	$g‘pid
 (è
__THROW
;

634 
__pid_t
 
	$g‘µid
 (è
__THROW
;

637 
__pid_t
 
	$g‘pg½
 (è
__THROW
;

640 
__pid_t
 
	$__g‘pgid
 (
__pid_t
 
__pid
è
__THROW
;

641 #ià
defšed
 
__USE_XOPEN_EXTENDED
 || defšed 
__USE_XOPEN2K8


642 
__pid_t
 
	$g‘pgid
 (
__pid_t
 
__pid
è
__THROW
;

649 
	$£gid
 (
__pid_t
 
__pid
, __pid_ˆ
__pgid
è
__THROW
;

651 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_XOPEN_EXTENDED


663 
	$£g½
 (è
__THROW
;

670 
__pid_t
 
	$£tsid
 (è
__THROW
;

672 #ià
defšed
 
__USE_XOPEN_EXTENDED
 || defšed 
__USE_XOPEN2K8


674 
__pid_t
 
	$g‘sid
 (
__pid_t
 
__pid
è
__THROW
;

678 
__uid_t
 
	$g‘uid
 (è
__THROW
;

681 
__uid_t
 
	$g‘euid
 (è
__THROW
;

684 
__gid_t
 
	$g‘gid
 (è
__THROW
;

687 
__gid_t
 
	$g‘egid
 (è
__THROW
;

692 
	$g‘groups
 (
__size
, 
__gid_t
 
__li¡
[]è
__THROW
 
__wur
;

694 #ifdef 
__USE_GNU


696 
	$group_memb”
 (
__gid_t
 
__gid
è
__THROW
;

703 
	$£tuid
 (
__uid_t
 
__uid
è
__THROW
 
__wur
;

705 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_XOPEN_EXTENDED


708 
	$£Œeuid
 (
__uid_t
 
__ruid
, __uid_ˆ
__euid
è
__THROW
 
__wur
;

711 #ifdeà
__USE_XOPEN2K


713 
	$£‹uid
 (
__uid_t
 
__uid
è
__THROW
 
__wur
;

720 
	$£tgid
 (
__gid_t
 
__gid
è
__THROW
 
__wur
;

722 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_XOPEN_EXTENDED


725 
	$£Œegid
 (
__gid_t
 
__rgid
, __gid_ˆ
__egid
è
__THROW
 
__wur
;

728 #ifdeà
__USE_XOPEN2K


730 
	$£‹gid
 (
__gid_t
 
__gid
è
__THROW
 
__wur
;

733 #ifdeà
__USE_GNU


736 
	$g‘»suid
 (
__uid_t
 *
__ruid
, __uid_ˆ*
__euid
, __uid_ˆ*
__suid
)

737 
__THROW
;

741 
	$g‘»sgid
 (
__gid_t
 *
__rgid
, __gid_ˆ*
__egid
, __gid_ˆ*
__sgid
)

742 
__THROW
;

746 
	$£Œesuid
 (
__uid_t
 
__ruid
, __uid_ˆ
__euid
, __uid_ˆ
__suid
)

747 
__THROW
 
__wur
;

751 
	$£Œesgid
 (
__gid_t
 
__rgid
, __gid_ˆ
__egid
, __gid_ˆ
__sgid
)

752 
__THROW
 
__wur
;

759 
__pid_t
 
	$fÜk
 (è
__THROWNL
;

761 #ià(
defšed
 
__USE_XOPEN_EXTENDED
 && !defšed 
__USE_XOPEN2K8
) \

762 || 
defšed
 
__USE_MISC


767 
__pid_t
 
	$vfÜk
 (è
__THROW
;

773 *
	$‰yÇme
 (
__fd
è
__THROW
;

777 
	$‰yÇme_r
 (
__fd
, *
__buf
, 
size_t
 
__buæ’
)

778 
__THROW
 
	`__nÚnuÎ
 ((2)è
__wur
;

782 
	$i§‰y
 (
__fd
è
__THROW
;

784 #ifdeà
__USE_MISC


787 
	$‰y¦Ù
 (è
__THROW
;

792 
	$lšk
 (cÚ¡ *
__äom
, cÚ¡ *
__to
)

793 
__THROW
 
	`__nÚnuÎ
 ((1, 2)è
__wur
;

795 #ifdeà
__USE_ATFILE


798 
	$lšk©
 (
__äomfd
, cÚ¡ *
__äom
, 
__tofd
,

799 cÚ¡ *
__to
, 
__æags
)

800 
__THROW
 
	`__nÚnuÎ
 ((2, 4)è
__wur
;

803 #ià
defšed
 
__USE_XOPEN_EXTENDED
 || defšed 
__USE_XOPEN2K


805 
	$symlšk
 (cÚ¡ *
__äom
, cÚ¡ *
__to
)

806 
__THROW
 
	`__nÚnuÎ
 ((1, 2)è
__wur
;

811 
ssize_t
 
	$»adlšk
 (cÚ¡ *
__»¡riù
 
__·th
,

812 *
__»¡riù
 
__buf
, 
size_t
 
__Ën
)

813 
__THROW
 
	`__nÚnuÎ
 ((1, 2)è
__wur
;

816 #ifdeà
__USE_ATFILE


818 
	$symlšk©
 (cÚ¡ *
__äom
, 
__tofd
,

819 cÚ¡ *
__to
è
__THROW
 
	`__nÚnuÎ
 ((1, 3)è
__wur
;

822 
ssize_t
 
	$»adlšk©
 (
__fd
, cÚ¡ *
__»¡riù
 
__·th
,

823 *
__»¡riù
 
__buf
, 
size_t
 
__Ën
)

824 
__THROW
 
	`__nÚnuÎ
 ((2, 3)è
__wur
;

828 
	$uÆšk
 (cÚ¡ *
__Çme
è
__THROW
 
	`__nÚnuÎ
 ((1));

830 #ifdeà
__USE_ATFILE


832 
	$uÆšk©
 (
__fd
, cÚ¡ *
__Çme
, 
__æag
)

833 
__THROW
 
	`__nÚnuÎ
 ((2));

837 
	$rmdœ
 (cÚ¡ *
__·th
è
__THROW
 
	`__nÚnuÎ
 ((1));

841 
__pid_t
 
	$tcg‘pg½
 (
__fd
è
__THROW
;

844 
	$tc£g½
 (
__fd
, 
__pid_t
 
__pg½_id
è
__THROW
;

851 *
	`g‘logš
 ();

852 #ifdeà
__USE_POSIX199506


859 
	$g‘logš_r
 (*
__Çme
, 
size_t
 
__Çme_Ën
è
	`__nÚnuÎ
 ((1));

862 #ifdef 
__USE_MISC


864 
	$£ogš
 (cÚ¡ *
__Çme
è
__THROW
 
	`__nÚnuÎ
 ((1));

868 #ifdef 
__USE_POSIX2


872 
	~<b™s/g‘İt_posix.h
>

876 #ià
defšed
 
__USE_XOPEN_EXTENDED
 || defšed 
__USE_XOPEN2K


880 
	$g‘ho¡Çme
 (*
__Çme
, 
size_t
 
__Ën
è
__THROW
 
	`__nÚnuÎ
 ((1));

884 #ià
defšed
 
__USE_MISC


887 
	$£tho¡Çme
 (cÚ¡ *
__Çme
, 
size_t
 
__Ën
)

888 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

892 
	$£tho¡id
 (
__id
è
__THROW
 
__wur
;

898 
	$g‘domašÇme
 (*
__Çme
, 
size_t
 
__Ën
)

899 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

900 
	$£tdomašÇme
 (cÚ¡ *
__Çme
, 
size_t
 
__Ën
)

901 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

907 
	$vhªgup
 (è
__THROW
;

910 
	$»voke
 (cÚ¡ *
__fe
è
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

918 
	$´of
 (*
__§m¶e_bufãr
, 
size_t
 
__size
,

919 
size_t
 
__off£t
, 
__sÿË
)

920 
__THROW
 
	`__nÚnuÎ
 ((1));

926 
	$acù
 (cÚ¡ *
__Çme
è
__THROW
;

930 *
	$g‘u£rsh–l
 (è
__THROW
;

931 
	$’du£rsh–l
 (è
__THROW
;

932 
	$£tu£rsh–l
 (è
__THROW
;

938 
	$d«mÚ
 (
__nochdœ
, 
__noşo£
è
__THROW
 
__wur
;

942 #ià
defšed
 
__USE_MISC
 || (defšed 
__USE_XOPEN
 && !defšed 
__USE_XOPEN2K
)

945 
	$chroÙ
 (cÚ¡ *
__·th
è
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

949 *
	$g‘·ss
 (cÚ¡ *
__´om±
è
	`__nÚnuÎ
 ((1));

957 
	`fsync
 (
__fd
);

960 #ifdeà
__USE_GNU


963 
	$syncfs
 (
__fd
è
__THROW
;

967 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_XOPEN_EXTENDED


970 
	`g‘ho¡id
 ();

973 
	$sync
 (è
__THROW
;

976 #ià
defšed
 
__USE_MISC
 || !defšed 
__USE_XOPEN2K


979 
	$g‘·gesize
 (è
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
));

984 
	$g‘dbËsize
 (è
__THROW
;

990 #ià
defšed
 
__USE_XOPEN_EXTENDED
 || defšed 
__USE_XOPEN2K8


993 #iâdeà
__USE_FILE_OFFSET64


994 
	$Œunÿ‹
 (cÚ¡ *
__fe
, 
__off_t
 
__Ëngth
)

995 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

997 #ifdeà
__REDIRECT_NTH


998 
	`__REDIRECT_NTH
 (
Œunÿ‹
,

999 (cÚ¡ *
__fe
, 
__off64_t
 
__Ëngth
),

1000 
Œunÿ‹64
è
	`__nÚnuÎ
 ((1)è
__wur
;

1002 
	#Œunÿ‹
 
Œunÿ‹64


	)

1005 #ifdeà
__USE_LARGEFILE64


1006 
	$Œunÿ‹64
 (cÚ¡ *
__fe
, 
__off64_t
 
__Ëngth
)

1007 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

1012 #ià
defšed
 
__USE_POSIX199309
 \

1013 || 
defšed
 
__USE_XOPEN_EXTENDED
 || defšed 
__USE_XOPEN2K


1016 #iâdeà
__USE_FILE_OFFSET64


1017 
	$árunÿ‹
 (
__fd
, 
__off_t
 
__Ëngth
è
__THROW
 
__wur
;

1019 #ifdeà
__REDIRECT_NTH


1020 
	`__REDIRECT_NTH
 (
árunÿ‹
, (
__fd
, 
__off64_t
 
__Ëngth
),

1021 
árunÿ‹64
è
__wur
;

1023 
	#árunÿ‹
 
árunÿ‹64


	)

1026 #ifdeà
__USE_LARGEFILE64


1027 
	$árunÿ‹64
 (
__fd
, 
__off64_t
 
__Ëngth
è
__THROW
 
__wur
;

1033 #ià(
defšed
 
__USE_XOPEN_EXTENDED
 && !defšed 
__USE_XOPEN2K
) \

1034 || 
defšed
 
__USE_MISC


1038 
	$brk
 (*
__addr
è
__THROW
 
__wur
;

1044 *
	$sbrk
 (
šŒ_t
 
__d–
è
__THROW
;

1048 #ifdeà
__USE_MISC


1059 
	$sysÿÎ
 (
__sy¢o
, ...è
__THROW
;

1064 #ià(
defšed
 
__USE_MISC
 || defšed 
__USE_XOPEN_EXTENDED
è&& !defšed 
F_LOCK


1076 
	#F_ULOCK
 0

	)

1077 
	#F_LOCK
 1

	)

1078 
	#F_TLOCK
 2

	)

1079 
	#F_TEST
 3

	)

1081 #iâdeà
__USE_FILE_OFFSET64


1082 
	$lockf
 (
__fd
, 
__cmd
, 
__off_t
 
__Ën
è
__wur
;

1084 #ifdeà
__REDIRECT


1085 
	`__REDIRECT
 (
lockf
, (
__fd
, 
__cmd
, 
__off64_t
 
__Ën
),

1086 
lockf64
è
__wur
;

1088 
	#lockf
 
lockf64


	)

1091 #ifdeà
__USE_LARGEFILE64


1092 
	$lockf64
 (
__fd
, 
__cmd
, 
__off64_t
 
__Ën
è
__wur
;

1097 #ifdeà
__USE_GNU


1102 
	#TEMP_FAILURE_RETRY
(
ex´essiÚ
) \

1103 (
__ex‹nsiÚ__
 \

1104 ({ 
__»suÉ
; \

1105 dØ
__»suÉ
 = (è(
ex´essiÚ
); \

1106 
__»suÉ
 =ğ-1L && 
”ºo
 =ğ
EINTR
); \

1107 
__»suÉ
; 
	}
}))

	)

1110 
ssize_t
 
cİy_fe_¿nge
 (
__šfd
, 
__off64_t
 *
__pšoff
,

1111 
__outfd
, 
__off64_t
 *
__poutoff
,

1112 
size_t
 
__Ëngth
, 
__æags
);

1115 #ià
defšed
 
__USE_POSIX199309
 || defšed 
__USE_UNIX98


1118 
fd©async
 (
__fdes
);

1124 #ifdef 
__USE_XOPEN


1126 *
	$üy±
 (cÚ¡ *
__key
, cÚ¡ *
__§É
)

1127 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

1131 
	$’üy±
 (*
__glibc_block
, 
__edæag
)

1132 
__THROW
 
	`__nÚnuÎ
 ((1));

1139 
	$swab
 (cÚ¡ *
__»¡riù
 
__äom
, *__»¡riù 
__to
,

1140 
ssize_t
 
__n
è
__THROW
 
	`__nÚnuÎ
 ((1, 2));

1147 #ià
defšed
 
__USE_XOPEN
 && !defšed 
__USE_XOPEN2K


1149 *
	$ù”mid
 (*
__s
è
__THROW
;

1152 *
	`cu£rid
 (*
__s
);

1158 #ià
defšed
 
__USE_UNIX98
 && !defšed 
__USE_XOPEN2K


1159 
	$±h»ad_©fÜk
 ((*
__´•¬e
) (),

1160 (*
__·»Á
) (),

1161 (*
__chd
è()è
__THROW
;

1164 #ifdeà
__USE_MISC


1167 
	$g‘’Œİy
 (*
__bufãr
, 
size_t
 
__Ëngth
è
__wur
;

1171 #ià
__USE_FORTIFY_LEVEL
 > 0 && 
defšed
 
__fÜtify_funùiÚ


1172 
	~<b™s/uni¡d.h
>

1175 
__END_DECLS


	@/usr/include/zlib.h

31 #iâdeà
ZLIB_H


32 
	#ZLIB_H


	)

34 
	~"zcÚf.h
"

36 #ifdeà
__ılu¥lus


40 
	#ZLIB_VERSION
 "1.2.11"

	)

41 
	#ZLIB_VERNUM
 0x12b0

	)

42 
	#ZLIB_VER_MAJOR
 1

	)

43 
	#ZLIB_VER_MINOR
 2

	)

44 
	#ZLIB_VER_REVISION
 11

	)

45 
	#ZLIB_VER_SUBREVISION
 0

	)

81 
voidpf
 (*
	t®loc_func
è
	tOF
((
	tvoidpf
 
	tİaque
, 
	tuIÁ
 
	t™ems
, uIÁ 
	tsize
));

82 (*
ä“_func
è
	tOF
((
	tvoidpf
 
	tİaque
, voidpà
	tadd»ss
));

84 
š‹º®_¡©e
;

86 
	sz_¡»am_s
 {

87 
z_cÚ¡
 
By‹f
 *
Ãxt_š
;

88 
uIÁ
 
ava_š
;

89 
uLÚg
 
tÙ®_š
;

91 
By‹f
 *
Ãxt_out
;

92 
uIÁ
 
ava_out
;

93 
uLÚg
 
tÙ®_out
;

95 
z_cÚ¡
 *
msg
;

96 
š‹º®_¡©e
 
FAR
 *
¡©e
;

98 
®loc_func
 
z®loc
;

99 
ä“_func
 
zä“
;

100 
voidpf
 
İaque
;

102 
d©a_ty³
;

104 
uLÚg
 
adËr
;

105 
uLÚg
 
»£rved
;

106 } 
	tz_¡»am
;

108 
z_¡»am
 
	tFAR
 *
	tz_¡»amp
;

114 
	sgz_h—d”_s
 {

115 
‹xt
;

116 
uLÚg
 
time
;

117 
xæags
;

118 
os
;

119 
By‹f
 *
exŒa
;

120 
uIÁ
 
exŒa_Ën
;

121 
uIÁ
 
exŒa_max
;

122 
By‹f
 *
Çme
;

123 
uIÁ
 
Çme_max
;

124 
By‹f
 *
comm’t
;

125 
uIÁ
 
comm_max
;

126 
hüc
;

127 
dÚe
;

129 } 
	tgz_h—d”
;

131 
gz_h—d”
 
	tFAR
 *
	tgz_h—d”p
;

168 
	#Z_NO_FLUSH
 0

	)

169 
	#Z_PARTIAL_FLUSH
 1

	)

170 
	#Z_SYNC_FLUSH
 2

	)

171 
	#Z_FULL_FLUSH
 3

	)

172 
	#Z_FINISH
 4

	)

173 
	#Z_BLOCK
 5

	)

174 
	#Z_TREES
 6

	)

177 
	#Z_OK
 0

	)

178 
	#Z_STREAM_END
 1

	)

179 
	#Z_NEED_DICT
 2

	)

180 
	#Z_ERRNO
 (-1)

	)

181 
	#Z_STREAM_ERROR
 (-2)

	)

182 
	#Z_DATA_ERROR
 (-3)

	)

183 
	#Z_MEM_ERROR
 (-4)

	)

184 
	#Z_BUF_ERROR
 (-5)

	)

185 
	#Z_VERSION_ERROR
 (-6)

	)

190 
	#Z_NO_COMPRESSION
 0

	)

191 
	#Z_BEST_SPEED
 1

	)

192 
	#Z_BEST_COMPRESSION
 9

	)

193 
	#Z_DEFAULT_COMPRESSION
 (-1)

	)

196 
	#Z_FILTERED
 1

	)

197 
	#Z_HUFFMAN_ONLY
 2

	)

198 
	#Z_RLE
 3

	)

199 
	#Z_FIXED
 4

	)

200 
	#Z_DEFAULT_STRATEGY
 0

	)

203 
	#Z_BINARY
 0

	)

204 
	#Z_TEXT
 1

	)

205 
	#Z_ASCII
 
Z_TEXT


	)

206 
	#Z_UNKNOWN
 2

	)

209 
	#Z_DEFLATED
 8

	)

212 
	#Z_NULL
 0

	)

214 
	#zlib_v”siÚ
 
	`zlibV”siÚ
()

	)

220 
ZEXTERN
 cÚ¡ * 
ZEXPORT
 
zlibV”siÚ
 
OF
(());

250 
ZEXTERN
 
ZEXPORT
 
deæ©e
 
OF
((
z_¡»amp
 
¡rm
, 
æush
));

363 
ZEXTERN
 
ZEXPORT
 
deæ©eEnd
 
OF
((
z_¡»amp
 
¡rm
));

400 
ZEXTERN
 
ZEXPORT
 
šæ©e
 
OF
((
z_¡»amp
 
¡rm
, 
æush
));

520 
ZEXTERN
 
ZEXPORT
 
šæ©eEnd
 
OF
((
z_¡»amp
 
¡rm
));

611 
ZEXTERN
 
ZEXPORT
 
deæ©eS‘DiùiÚ¬y
 
OF
((
z_¡»amp
 
¡rm
,

612 cÚ¡ 
By‹f
 *
diùiÚ¬y
,

613 
uIÁ
 
diùL’gth
));

655 
ZEXTERN
 
ZEXPORT
 
deæ©eG‘DiùiÚ¬y
 
OF
((
z_¡»amp
 
¡rm
,

656 
By‹f
 *
diùiÚ¬y
,

657 
uIÁ
 *
diùL’gth
));

677 
ZEXTERN
 
ZEXPORT
 
deæ©eCİy
 
OF
((
z_¡»amp
 
de¡
,

678 
z_¡»amp
 
sourû
));

695 
ZEXTERN
 
ZEXPORT
 
deæ©eRe£t
 
OF
((
z_¡»amp
 
¡rm
));

706 
ZEXTERN
 
ZEXPORT
 
deæ©eP¬ams
 
OF
((
z_¡»amp
 
¡rm
,

707 
Ëv–
,

708 
¡¿‹gy
));

744 
ZEXTERN
 
ZEXPORT
 
deæ©eTuÃ
 
OF
((
z_¡»amp
 
¡rm
,

745 
good_Ëngth
,

746 
max_Ïzy
,

747 
niû_Ëngth
,

748 
max_chaš
));

761 
ZEXTERN
 
uLÚg
 
ZEXPORT
 
deæ©eBound
 
OF
((
z_¡»amp
 
¡rm
,

762 
uLÚg
 
sourûL’
));

776 
ZEXTERN
 
ZEXPORT
 
deæ©eP’dšg
 
OF
((
z_¡»amp
 
¡rm
,

777 *
³ndšg
,

778 *
b™s
));

791 
ZEXTERN
 
ZEXPORT
 
deæ©ePrime
 
OF
((
z_¡»amp
 
¡rm
,

792 
b™s
,

793 
v®ue
));

808 
ZEXTERN
 
ZEXPORT
 
deæ©eS‘H—d”
 
OF
((
z_¡»amp
 
¡rm
,

809 
gz_h—d”p
 
h—d
));

885 
ZEXTERN
 
ZEXPORT
 
šæ©eS‘DiùiÚ¬y
 
OF
((
z_¡»amp
 
¡rm
,

886 cÚ¡ 
By‹f
 *
diùiÚ¬y
,

887 
uIÁ
 
diùL’gth
));

908 
ZEXTERN
 
ZEXPORT
 
šæ©eG‘DiùiÚ¬y
 
OF
((
z_¡»amp
 
¡rm
,

909 
By‹f
 *
diùiÚ¬y
,

910 
uIÁ
 *
diùL’gth
));

923 
ZEXTERN
 
ZEXPORT
 
šæ©eSync
 
OF
((
z_¡»amp
 
¡rm
));

942 
ZEXTERN
 
ZEXPORT
 
šæ©eCİy
 
OF
((
z_¡»amp
 
de¡
,

943 
z_¡»amp
 
sourû
));

958 
ZEXTERN
 
ZEXPORT
 
šæ©eRe£t
 
OF
((
z_¡»amp
 
¡rm
));

968 
ZEXTERN
 
ZEXPORT
 
šæ©eRe£t2
 
OF
((
z_¡»amp
 
¡rm
,

969 
wšdowB™s
));

982 
ZEXTERN
 
ZEXPORT
 
šæ©ePrime
 
OF
((
z_¡»amp
 
¡rm
,

983 
b™s
,

984 
v®ue
));

1003 
ZEXTERN
 
ZEXPORT
 
šæ©eM¬k
 
OF
((
z_¡»amp
 
¡rm
));

1031 
ZEXTERN
 
ZEXPORT
 
šæ©eG‘H—d”
 
OF
((
z_¡»amp
 
¡rm
,

1032 
gz_h—d”p
 
h—d
));

1093 (*
š_func
è
	tOF
((
	tFAR
 *,

1094 
	tz_cÚ¡
 
	tFAR
 * FAR *));

1095 (*
out_func
è
	tOF
((
	tFAR
 *, FAR *, ));

1097 
ZEXTERN
 
ZEXPORT
 
šæ©eBack
 
OF
((
z_¡»amp
 
¡rm
,

1098 
š_func
 
š
, 
FAR
 *
š_desc
,

1099 
out_func
 
out
, 
FAR
 *
out_desc
));

1167 
ZEXTERN
 
ZEXPORT
 
šæ©eBackEnd
 
OF
((
z_¡»amp
 
¡rm
));

1175 
ZEXTERN
 
uLÚg
 
ZEXPORT
 
zlibCompeFÏgs
 
OF
(());

1216 #iâdeà
Z_SOLO


1228 
ZEXTERN
 
ZEXPORT
 
com´ess
 
OF
((
By‹f
 *
de¡
, 
uLÚgf
 *
de¡L’
,

1229 cÚ¡ 
By‹f
 *
sourû
, 
uLÚg
 
sourûL’
));

1243 
ZEXTERN
 
ZEXPORT
 
com´ess2
 
OF
((
By‹f
 *
de¡
, 
uLÚgf
 *
de¡L’
,

1244 cÚ¡ 
By‹f
 *
sourû
, 
uLÚg
 
sourûL’
,

1245 
Ëv–
));

1259 
ZEXTERN
 
uLÚg
 
ZEXPORT
 
com´essBound
 
OF
((uLÚg 
sourûL’
));

1266 
ZEXTERN
 
ZEXPORT
 
uncom´ess
 
OF
((
By‹f
 *
de¡
, 
uLÚgf
 *
de¡L’
,

1267 cÚ¡ 
By‹f
 *
sourû
, 
uLÚg
 
sourûL’
));

1284 
ZEXTERN
 
ZEXPORT
 
uncom´ess2
 
OF
((
By‹f
 *
de¡
, 
uLÚgf
 *
de¡L’
,

1285 cÚ¡ 
By‹f
 *
sourû
, 
uLÚg
 *
sourûL’
));

1301 
gzFe_s
 *
	tgzFe
;

1341 
ZEXTERN
 
gzFe
 
ZEXPORT
 
gzdİ’
 
OF
((
fd
, cÚ¡ *
mode
));

1364 
ZEXTERN
 
ZEXPORT
 
gzbufãr
 
OF
((
gzFe
 
fe
, 
size
));

1380 
ZEXTERN
 
ZEXPORT
 
gz£¬ams
 
OF
((
gzFe
 
fe
, 
Ëv–
, 
¡¿‹gy
));

1391 
ZEXTERN
 
ZEXPORT
 
gz»ad
 
OF
((
gzFe
 
fe
, 
voidp
 
buf
, 
Ën
));

1421 
ZEXTERN
 
z_size_t
 
ZEXPORT
 
gzä—d
 
OF
((
voidp
 
buf
, z_size_ˆ
size
, z_size_ˆ
n™ems
,

1422 
gzFe
 
fe
));

1447 
ZEXTERN
 
ZEXPORT
 
gzwr™e
 
OF
((
gzFe
 
fe
,

1448 
voidpc
 
buf
, 
Ën
));

1455 
ZEXTERN
 
z_size_t
 
ZEXPORT
 
gzfwr™e
 
OF
((
voidpc
 
buf
, z_size_ˆ
size
,

1456 
z_size_t
 
n™ems
, 
gzFe
 
fe
));

1469 
ZEXTERN
 
ZEXPORTVA
 
gz´štf
 
Z_ARG
((
gzFe
 
fe
, cÚ¡ *
fÜm©
, ...));

1484 
ZEXTERN
 
ZEXPORT
 
gzputs
 
OF
((
gzFe
 
fe
, cÚ¡ *
s
));

1492 
ZEXTERN
 * 
ZEXPORT
 
gzg‘s
 
OF
((
gzFe
 
fe
, *
buf
, 
Ën
));

1505 
ZEXTERN
 
ZEXPORT
 
gzputc
 
OF
((
gzFe
 
fe
, 
c
));

1511 
ZEXTERN
 
ZEXPORT
 
gzg‘c
 
OF
((
gzFe
 
fe
));

1520 
ZEXTERN
 
ZEXPORT
 
gzung‘c
 
OF
((
c
, 
gzFe
 
fe
));

1532 
ZEXTERN
 
ZEXPORT
 
gzæush
 
OF
((
gzFe
 
fe
, 
æush
));

1567 
ZEXTERN
 
ZEXPORT
 
gz»wšd
 
OF
((
gzFe
 
fe
));

1595 
ZEXTERN
 
ZEXPORT
 
gzeof
 
OF
((
gzFe
 
fe
));

1610 
ZEXTERN
 
ZEXPORT
 
gzdœeù
 
OF
((
gzFe
 
fe
));

1631 
ZEXTERN
 
ZEXPORT
 
gzşo£
 
OF
((
gzFe
 
fe
));

1644 
ZEXTERN
 
ZEXPORT
 
gzşo£_r
 
OF
((
gzFe
 
fe
));

1645 
ZEXTERN
 
ZEXPORT
 
gzşo£_w
 
OF
((
gzFe
 
fe
));

1656 
ZEXTERN
 cÚ¡ * 
ZEXPORT
 
gz”rÜ
 
OF
((
gzFe
 
fe
, *
”ºum
));

1672 
ZEXTERN
 
ZEXPORT
 
gzş—»¼
 
OF
((
gzFe
 
fe
));

1689 
ZEXTERN
 
uLÚg
 
ZEXPORT
 
adËr32
 
OF
((uLÚg 
adËr
, cÚ¡ 
By‹f
 *
buf
, 
uIÁ
 
Ën
));

1708 
ZEXTERN
 
uLÚg
 
ZEXPORT
 
adËr32_z
 
OF
((uLÚg 
adËr
, cÚ¡ 
By‹f
 *
buf
,

1709 
z_size_t
 
Ën
));

1726 
ZEXTERN
 
uLÚg
 
ZEXPORT
 
üc32
 
OF
((uLÚg 
üc
, cÚ¡ 
By‹f
 *
buf
, 
uIÁ
 
Ën
));

1743 
ZEXTERN
 
uLÚg
 
ZEXPORT
 
üc32_z
 
OF
((uLÚg 
adËr
, cÚ¡ 
By‹f
 *
buf
,

1744 
z_size_t
 
Ën
));

1765 
ZEXTERN
 
ZEXPORT
 
deæ©eIn™_
 
OF
((
z_¡»amp
 
¡rm
, 
Ëv–
,

1766 cÚ¡ *
v”siÚ
, 
¡»am_size
));

1767 
ZEXTERN
 
ZEXPORT
 
šæ©eIn™_
 
OF
((
z_¡»amp
 
¡rm
,

1768 cÚ¡ *
v”siÚ
, 
¡»am_size
));

1769 
ZEXTERN
 
ZEXPORT
 
deæ©eIn™2_
 
OF
((
z_¡»amp
 
¡rm
, 
Ëv–
, 
m‘hod
,

1770 
wšdowB™s
, 
memLev–
,

1771 
¡¿‹gy
, cÚ¡ *
v”siÚ
,

1772 
¡»am_size
));

1773 
ZEXTERN
 
ZEXPORT
 
šæ©eIn™2_
 
OF
((
z_¡»amp
 
¡rm
, 
wšdowB™s
,

1774 cÚ¡ *
v”siÚ
, 
¡»am_size
));

1775 
ZEXTERN
 
ZEXPORT
 
šæ©eBackIn™_
 
OF
((
z_¡»amp
 
¡rm
, 
wšdowB™s
,

1776 
FAR
 *
wšdow
,

1777 cÚ¡ *
v”siÚ
,

1778 
¡»am_size
));

1779 #ifdeà
Z_PREFIX_SET


1780 
	#z_deæ©eIn™
(
¡rm
, 
Ëv–
) \

1781 
	`deæ©eIn™_
((
¡rm
), (
Ëv–
), 
ZLIB_VERSION
, ()(
z_¡»am
))

	)

1782 
	#z_šæ©eIn™
(
¡rm
) \

1783 
	`šæ©eIn™_
((
¡rm
), 
ZLIB_VERSION
, ()(
z_¡»am
))

	)

1784 
	#z_deæ©eIn™2
(
¡rm
, 
Ëv–
, 
m‘hod
, 
wšdowB™s
, 
memLev–
, 
¡¿‹gy
) \

1785 
	`deæ©eIn™2_
((
¡rm
),(
Ëv–
),(
m‘hod
),(
wšdowB™s
),(
memLev–
),\

1786 (
¡¿‹gy
), 
ZLIB_VERSION
, ()(
z_¡»am
))

	)

1787 
	#z_šæ©eIn™2
(
¡rm
, 
wšdowB™s
) \

1788 
	`šæ©eIn™2_
((
¡rm
), (
wšdowB™s
), 
ZLIB_VERSION
, \

1789 ()(
z_¡»am
))

	)

1790 
	#z_šæ©eBackIn™
(
¡rm
, 
wšdowB™s
, 
wšdow
) \

1791 
	`šæ©eBackIn™_
((
¡rm
), (
wšdowB™s
), (
wšdow
), \

1792 
ZLIB_VERSION
, ()(
z_¡»am
))

	)

1794 
	#deæ©eIn™
(
¡rm
, 
Ëv–
) \

1795 
	`deæ©eIn™_
((
¡rm
), (
Ëv–
), 
ZLIB_VERSION
, ()(
z_¡»am
))

	)

1796 
	#šæ©eIn™
(
¡rm
) \

1797 
	`šæ©eIn™_
((
¡rm
), 
ZLIB_VERSION
, ()(
z_¡»am
))

	)

1798 
	#deæ©eIn™2
(
¡rm
, 
Ëv–
, 
m‘hod
, 
wšdowB™s
, 
memLev–
, 
¡¿‹gy
) \

1799 
	`deæ©eIn™2_
((
¡rm
),(
Ëv–
),(
m‘hod
),(
wšdowB™s
),(
memLev–
),\

1800 (
¡¿‹gy
), 
ZLIB_VERSION
, ()(
z_¡»am
))

	)

1801 
	#šæ©eIn™2
(
¡rm
, 
wšdowB™s
) \

1802 
	`šæ©eIn™2_
((
¡rm
), (
wšdowB™s
), 
ZLIB_VERSION
, \

1803 ()(
z_¡»am
))

	)

1804 
	#šæ©eBackIn™
(
¡rm
, 
wšdowB™s
, 
wšdow
) \

1805 
	`šæ©eBackIn™_
((
¡rm
), (
wšdowB™s
), (
wšdow
), \

1806 
ZLIB_VERSION
, ()(
z_¡»am
))

	)

1809 #iâdeà
Z_SOLO


1818 
	sgzFe_s
 {

1819 
have
;

1820 *
Ãxt
;

1821 
z_off64_t
 
pos
;

1823 
ZEXTERN
 
ZEXPORT
 
gzg‘c_
 
OF
((
gzFe
 
fe
));

1824 #ifdeà
Z_PREFIX_SET


1825 #undeà
z_gzg‘c


1826 
	#z_gzg‘c
(
g
) \

1827 ((
g
)->
have
 ? ((g)->have--, (g)->
pos
++, *((g)->
Ãxt
)++è: (
gzg‘c
)(g))

	)

1829 
	#gzg‘c
(
g
) \

1830 ((
g
)->
have
 ? ((g)->have--, (g)->
pos
++, *((g)->
Ãxt
)++è: (
gzg‘c
)(g))

	)

1839 #ifdeà
Z_LARGE64


1840 
ZEXTERN
 
gzFe
 
ZEXPORT
 
gzİ’64
 
OF
((const *, const *));

1841 
ZEXTERN
 
z_off64_t
 
ZEXPORT
 
gz£ek64
 
OF
((
gzFe
, z_off64_t, ));

1842 
ZEXTERN
 
z_off64_t
 
ZEXPORT
 
gz‹Î64
 
OF
((
gzFe
));

1843 
ZEXTERN
 
z_off64_t
 
ZEXPORT
 
gzoff£t64
 
OF
((
gzFe
));

1844 
ZEXTERN
 
uLÚg
 
ZEXPORT
 
adËr32_combše64
 
OF
((uLÚg, uLÚg, 
z_off64_t
));

1845 
ZEXTERN
 
uLÚg
 
ZEXPORT
 
üc32_combše64
 
OF
((uLÚg, uLÚg, 
z_off64_t
));

1848 #ià!
defšed
(
ZLIB_INTERNAL
è&& defšed(
Z_WANT64
)

1849 #ifdeà
Z_PREFIX_SET


1850 
	#z_gzİ’
 
z_gzİ’64


	)

1851 
	#z_gz£ek
 
z_gz£ek64


	)

1852 
	#z_gz‹Î
 
z_gz‹Î64


	)

1853 
	#z_gzoff£t
 
z_gzoff£t64


	)

1854 
	#z_adËr32_combše
 
z_adËr32_combše64


	)

1855 
	#z_üc32_combše
 
z_üc32_combše64


	)

1857 
	#gzİ’
 
gzİ’64


	)

1858 
	#gz£ek
 
gz£ek64


	)

1859 
	#gz‹Î
 
gz‹Î64


	)

1860 
	#gzoff£t
 
gzoff£t64


	)

1861 
	#adËr32_combše
 
adËr32_combše64


	)

1862 
	#üc32_combše
 
üc32_combše64


	)

1864 #iâdeà
Z_LARGE64


1865 
ZEXTERN
 
gzFe
 
ZEXPORT
 
gzİ’64
 
OF
((const *, const *));

1866 
ZEXTERN
 
z_off_t
 
ZEXPORT
 
gz£ek64
 
OF
((
gzFe
, z_off_t, ));

1867 
ZEXTERN
 
z_off_t
 
ZEXPORT
 
gz‹Î64
 
OF
((
gzFe
));

1868 
ZEXTERN
 
z_off_t
 
ZEXPORT
 
gzoff£t64
 
OF
((
gzFe
));

1869 
ZEXTERN
 
uLÚg
 
ZEXPORT
 
adËr32_combše64
 
OF
((uLÚg, uLÚg, 
z_off_t
));

1870 
ZEXTERN
 
uLÚg
 
ZEXPORT
 
üc32_combše64
 
OF
((uLÚg, uLÚg, 
z_off_t
));

1873 
ZEXTERN
 
gzFe
 
ZEXPORT
 
gzİ’
 
OF
((const *, const *));

1874 
ZEXTERN
 
z_off_t
 
ZEXPORT
 
gz£ek
 
OF
((
gzFe
, z_off_t, ));

1875 
ZEXTERN
 
z_off_t
 
ZEXPORT
 
gz‹Î
 
OF
((
gzFe
));

1876 
ZEXTERN
 
z_off_t
 
ZEXPORT
 
gzoff£t
 
OF
((
gzFe
));

1877 
ZEXTERN
 
uLÚg
 
ZEXPORT
 
adËr32_combše
 
OF
((uLÚg, uLÚg, 
z_off_t
));

1878 
ZEXTERN
 
uLÚg
 
ZEXPORT
 
üc32_combše
 
OF
((uLÚg, uLÚg, 
z_off_t
));

1883 
ZEXTERN
 
uLÚg
 
ZEXPORT
 
adËr32_combše
 
OF
((uLÚg, uLÚg, 
z_off_t
));

1884 
ZEXTERN
 
uLÚg
 
ZEXPORT
 
üc32_combše
 
OF
((uLÚg, uLÚg, 
z_off_t
));

1889 
ZEXTERN
 cÚ¡ * 
ZEXPORT
 
zE¼Ü
 
OF
(());

1890 
ZEXTERN
 
ZEXPORT
 
šæ©eSyncPošt
 
OF
((
z_¡»amp
));

1891 
ZEXTERN
 cÚ¡ 
z_üc_t
 
FAR
 * 
ZEXPORT
 
g‘_üc_bË
 
OF
(());

1892 
ZEXTERN
 
ZEXPORT
 
šæ©eUnd”mše
 
OF
((
z_¡»amp
, ));

1893 
ZEXTERN
 
ZEXPORT
 
šæ©eV®id©e
 
OF
((
z_¡»amp
, ));

1894 
ZEXTERN
 
ZEXPORT
 
šæ©eCodesU£d
 
OF
 ((
z_¡»amp
));

1895 
ZEXTERN
 
ZEXPORT
 
šæ©eRe£tK“p
 
OF
((
z_¡»amp
));

1896 
ZEXTERN
 
ZEXPORT
 
deæ©eRe£tK“p
 
OF
((
z_¡»amp
));

1897 #ià(
defšed
(
_WIN32
è|| defšed(
__CYGWIN__
)è&& !defšed(
Z_SOLO
)

1898 
ZEXTERN
 
gzFe
 
ZEXPORT
 
gzİ’_w
 
OF
((cÚ¡ 
wch¬_t
 *
·th
,

1899 cÚ¡ *
mode
));

1901 #ià
defšed
(
STDC
è|| defšed(
Z_HAVE_STDARG_H
)

1902 #iâdeà
Z_SOLO


1903 
ZEXTERN
 
ZEXPORTVA
 
gzv´štf
 
Z_ARG
((
gzFe
 
fe
,

1904 cÚ¡ *
fÜm©
,

1905 
va_li¡
 
va
));

1909 #ifdeà
__ılu¥lus


	@/usr/include/alloca.h

18 #iâdef 
_ALLOCA_H


19 
	#_ALLOCA_H
 1

	)

21 
	~<ã©u»s.h
>

23 
	#__Ãed_size_t


	)

24 
	~<¡ddef.h
>

26 
	g__BEGIN_DECLS


29 #undeà
®loÿ


32 *
	$®loÿ
 (
size_t
 
__size
è
__THROW
;

34 #ifdef 
__GNUC__


35 
	#®loÿ
(
size
è
	`__butš_®loÿ
 (size)

	)

38 
__END_DECLS


	@/usr/include/endian.h

18 #iâdef 
_ENDIAN_H


19 
	#_ENDIAN_H
 1

	)

21 
	~<ã©u»s.h
>

31 
	#__LITTLE_ENDIAN
 1234

	)

32 
	#__BIG_ENDIAN
 4321

	)

33 
	#__PDP_ENDIAN
 3412

	)

36 
	~<b™s/’dŸn.h
>

40 #iâdeà
__FLOAT_WORD_ORDER


41 
	#__FLOAT_WORD_ORDER
 
__BYTE_ORDER


	)

44 #ifdef 
__USE_MISC


45 
	#LITTLE_ENDIAN
 
__LITTLE_ENDIAN


	)

46 
	#BIG_ENDIAN
 
__BIG_ENDIAN


	)

47 
	#PDP_ENDIAN
 
__PDP_ENDIAN


	)

48 
	#BYTE_ORDER
 
__BYTE_ORDER


	)

51 #ià
__BYTE_ORDER
 =ğ
__LITTLE_ENDIAN


52 
	#__LONG_LONG_PAIR
(
HI
, 
LO
èLO, 
	)
HI

53 #–ià
__BYTE_ORDER
 =ğ
__BIG_ENDIAN


54 
	#__LONG_LONG_PAIR
(
HI
, 
LO
èHI, 
	)
LO

58 #ià
defšed
 
__USE_MISC
 && !defšed 
__ASSEMBLER__


60 
	~<b™s/by‹sw­.h
>

61 
	~<b™s/ušŠ-id’t™y.h
>

63 #ià
__BYTE_ORDER
 =ğ
__LITTLE_ENDIAN


64 
	#htobe16
(
x
è
	`__bsw­_16
 (x)

	)

65 
	#htŞe16
(
x
è
	`__ušt16_id’t™y
 (x)

	)

66 
	#be16toh
(
x
è
	`__bsw­_16
 (x)

	)

67 
	#Ë16toh
(
x
è
	`__ušt16_id’t™y
 (x)

	)

69 
	#htobe32
(
x
è
	`__bsw­_32
 (x)

	)

70 
	#htŞe32
(
x
è
	`__ušt32_id’t™y
 (x)

	)

71 
	#be32toh
(
x
è
	`__bsw­_32
 (x)

	)

72 
	#Ë32toh
(
x
è
	`__ušt32_id’t™y
 (x)

	)

74 
	#htobe64
(
x
è
	`__bsw­_64
 (x)

	)

75 
	#htŞe64
(
x
è
	`__ušt64_id’t™y
 (x)

	)

76 
	#be64toh
(
x
è
	`__bsw­_64
 (x)

	)

77 
	#Ë64toh
(
x
è
	`__ušt64_id’t™y
 (x)

	)

80 
	#htobe16
(
x
è
	`__ušt16_id’t™y
 (x)

	)

81 
	#htŞe16
(
x
è
	`__bsw­_16
 (x)

	)

82 
	#be16toh
(
x
è
	`__ušt16_id’t™y
 (x)

	)

83 
	#Ë16toh
(
x
è
	`__bsw­_16
 (x)

	)

85 
	#htobe32
(
x
è
	`__ušt32_id’t™y
 (x)

	)

86 
	#htŞe32
(
x
è
	`__bsw­_32
 (x)

	)

87 
	#be32toh
(
x
è
	`__ušt32_id’t™y
 (x)

	)

88 
	#Ë32toh
(
x
è
	`__bsw­_32
 (x)

	)

90 
	#htobe64
(
x
è
	`__ušt64_id’t™y
 (x)

	)

91 
	#htŞe64
(
x
è
	`__bsw­_64
 (x)

	)

92 
	#be64toh
(
x
è
	`__ušt64_id’t™y
 (x)

	)

93 
	#Ë64toh
(
x
è
	`__bsw­_64
 (x)

	)

	@/usr/include/features.h

18 #iâdef 
_FEATURES_H


19 
	#_FEATURES_H
 1

	)

119 #undeà
__USE_ISOC11


120 #undeà
__USE_ISOC99


121 #undeà
__USE_ISOC95


122 #undeà
__USE_ISOCXX11


123 #undeà
__USE_POSIX


124 #undeà
__USE_POSIX2


125 #undeà
__USE_POSIX199309


126 #undeà
__USE_POSIX199506


127 #undeà
__USE_XOPEN


128 #undeà
__USE_XOPEN_EXTENDED


129 #undeà
__USE_UNIX98


130 #undeà
__USE_XOPEN2K


131 #undeà
__USE_XOPEN2KXSI


132 #undeà
__USE_XOPEN2K8


133 #undeà
__USE_XOPEN2K8XSI


134 #undeà
__USE_LARGEFILE


135 #undeà
__USE_LARGEFILE64


136 #undeà
__USE_FILE_OFFSET64


137 #undeà
__USE_MISC


138 #undeà
__USE_ATFILE


139 #undeà
__USE_GNU


140 #undeà
__USE_FORTIFY_LEVEL


141 #undeà
__KERNEL_STRICT_NAMES


142 #undeà
__GLIBC_USE_DEPRECATED_GETS


146 #iâdeà
_LOOSE_KERNEL_NAMES


147 
	#__KERNEL_STRICT_NAMES


	)

157 #ià
defšed
 
__GNUC__
 && defšed 
__GNUC_MINOR__


158 
	#__GNUC_PREREQ
(
maj
, 
mš
) \

159 ((
__GNUC__
 << 16è+ 
__GNUC_MINOR__
 >ğ((
maj
è<< 16è+ (
mš
))

	)

161 
	#__GNUC_PREREQ
(
maj
, 
mš
è0

	)

168 #ià
defšed
 
__şªg_majÜ__
 && defšed 
__şªg_mšÜ__


169 
	#__glibc_şªg_´”eq
(
maj
, 
mš
) \

170 ((
__şªg_majÜ__
 << 16è+ 
__şªg_mšÜ__
 >ğ((
maj
è<< 16è+ (
mš
))

	)

172 
	#__glibc_şªg_´”eq
(
maj
, 
mš
è0

	)

176 
	#__GLIBC_USE
(
F
è
__GLIBC_USE_
 ## 
	)
F

182 #ià(
defšed
 
_BSD_SOURCE
 || defšed 
_SVID_SOURCE
) \

183 && !
defšed
 
	g_DEFAULT_SOURCE


185 #undeà
_DEFAULT_SOURCE


186 
	#_DEFAULT_SOURCE
 1

	)

190 #ifdeà
_GNU_SOURCE


191 #undeà
_ISOC95_SOURCE


192 
	#_ISOC95_SOURCE
 1

	)

193 #undeà
_ISOC99_SOURCE


194 
	#_ISOC99_SOURCE
 1

	)

195 #undeà
_ISOC11_SOURCE


196 
	#_ISOC11_SOURCE
 1

	)

197 #undeà
_POSIX_SOURCE


198 
	#_POSIX_SOURCE
 1

	)

199 #undeà
_POSIX_C_SOURCE


200 
	#_POSIX_C_SOURCE
 200809L

	)

201 #undeà
_XOPEN_SOURCE


202 
	#_XOPEN_SOURCE
 700

	)

203 #undeà
_XOPEN_SOURCE_EXTENDED


204 
	#_XOPEN_SOURCE_EXTENDED
 1

	)

205 #undeà
_LARGEFILE64_SOURCE


206 
	#_LARGEFILE64_SOURCE
 1

	)

207 #undeà
_DEFAULT_SOURCE


208 
	#_DEFAULT_SOURCE
 1

	)

209 #undeà
_ATFILE_SOURCE


210 
	#_ATFILE_SOURCE
 1

	)

215 #ià(
defšed
 
_DEFAULT_SOURCE
 \

216 || (!
defšed
 
	g__STRICT_ANSI__
 \

217 && !
defšed
 
	g_ISOC99_SOURCE
 \

218 && !
defšed
 
	g_POSIX_SOURCE
 && !defšed 
	g_POSIX_C_SOURCE
 \

219 && !
defšed
 
	g_XOPEN_SOURCE
))

220 #undeà
_DEFAULT_SOURCE


221 
	#_DEFAULT_SOURCE
 1

	)

225 #ià(
defšed
 
_ISOC11_SOURCE
 \

226 || (
defšed
 
	g__STDC_VERSION__
 && __STDC_VERSION__ >= 201112L))

227 
	#__USE_ISOC11
 1

	)

231 #ià(
defšed
 
_ISOC99_SOURCE
 || defšed 
_ISOC11_SOURCE
 \

232 || (
defšed
 
__STDC_VERSION__
 && __STDC_VERSION__ >= 199901L))

233 
	#__USE_ISOC99
 1

	)

237 #ià(
defšed
 
_ISOC99_SOURCE
 || defšed 
_ISOC11_SOURCE
 \

238 || (
defšed
 
__STDC_VERSION__
 && __STDC_VERSION__ >= 199409L))

239 
	#__USE_ISOC95
 1

	)

242 #ifdeà
__ılu¥lus


244 #ià
__ılu¥lus
 >= 201703L

245 
	#__USE_ISOC11
 1

	)

249 #ià
__ılu¥lus
 >ğ201103L || 
defšed
 
__GXX_EXPERIMENTAL_CXX0X__


250 
	#__USE_ISOCXX11
 1

	)

251 
	#__USE_ISOC99
 1

	)

258 #ifdeà
_DEFAULT_SOURCE


259 #ià!
defšed
 
_POSIX_SOURCE
 && !defšed 
_POSIX_C_SOURCE


260 
	#__USE_POSIX_IMPLICITLY
 1

	)

262 #undeà
_POSIX_SOURCE


263 
	#_POSIX_SOURCE
 1

	)

264 #undeà
_POSIX_C_SOURCE


265 
	#_POSIX_C_SOURCE
 200809L

	)

268 #ià((!
defšed
 
__STRICT_ANSI__
 \

269 || (
defšed
 
_XOPEN_SOURCE
 && (_XOPEN_SOURCE - 0) >= 500)) \

270 && !
defšed
 
_POSIX_SOURCE
 && !defšed 
_POSIX_C_SOURCE
)

271 
	#_POSIX_SOURCE
 1

	)

272 #ià
defšed
 
_XOPEN_SOURCE
 && (_XOPEN_SOURCE - 0) < 500

273 
	#_POSIX_C_SOURCE
 2

	)

274 #–ià
defšed
 
_XOPEN_SOURCE
 && (_XOPEN_SOURCE - 0) < 600

275 
	#_POSIX_C_SOURCE
 199506L

	)

276 #–ià
defšed
 
_XOPEN_SOURCE
 && (_XOPEN_SOURCE - 0) < 700

277 
	#_POSIX_C_SOURCE
 200112L

	)

279 
	#_POSIX_C_SOURCE
 200809L

	)

281 
	#__USE_POSIX_IMPLICITLY
 1

	)

290 #ià((!
defšed
 
_POSIX_C_SOURCE
 || (_POSIX_C_SOURCE - 0) < 199506L) \

291 && (
defšed
 
_REENTRANT
 || defšed 
_THREAD_SAFE
))

292 
	#_POSIX_SOURCE
 1

	)

293 #undeà
_POSIX_C_SOURCE


294 
	#_POSIX_C_SOURCE
 199506L

	)

297 #ià(
defšed
 
_POSIX_SOURCE
 \

298 || (
defšed
 
_POSIX_C_SOURCE
 && _POSIX_C_SOURCE >= 1) \

299 || 
defšed
 
_XOPEN_SOURCE
)

300 
	#__USE_POSIX
 1

	)

303 #ià
defšed
 
_POSIX_C_SOURCE
 && _POSIX_C_SOURCE >ğ2 || defšed 
_XOPEN_SOURCE


304 
	#__USE_POSIX2
 1

	)

307 #ià
defšed
 
_POSIX_C_SOURCE
 && (_POSIX_C_SOURCE - 0) >= 199309L

308 
	#__USE_POSIX199309
 1

	)

311 #ià
defšed
 
_POSIX_C_SOURCE
 && (_POSIX_C_SOURCE - 0) >= 199506L

312 
	#__USE_POSIX199506
 1

	)

315 #ià
defšed
 
_POSIX_C_SOURCE
 && (_POSIX_C_SOURCE - 0) >= 200112L

316 
	#__USE_XOPEN2K
 1

	)

317 #undeà
__USE_ISOC95


318 
	#__USE_ISOC95
 1

	)

319 #undeà
__USE_ISOC99


320 
	#__USE_ISOC99
 1

	)

323 #ià
defšed
 
_POSIX_C_SOURCE
 && (_POSIX_C_SOURCE - 0) >= 200809L

324 
	#__USE_XOPEN2K8
 1

	)

325 #undeà
_ATFILE_SOURCE


326 
	#_ATFILE_SOURCE
 1

	)

329 #ifdef 
_XOPEN_SOURCE


330 
	#__USE_XOPEN
 1

	)

331 #ià(
_XOPEN_SOURCE
 - 0) >= 500

332 
	#__USE_XOPEN_EXTENDED
 1

	)

333 
	#__USE_UNIX98
 1

	)

334 #undeà
_LARGEFILE_SOURCE


335 
	#_LARGEFILE_SOURCE
 1

	)

336 #ià(
_XOPEN_SOURCE
 - 0) >= 600

337 #ià(
_XOPEN_SOURCE
 - 0) >= 700

338 
	#__USE_XOPEN2K8
 1

	)

339 
	#__USE_XOPEN2K8XSI
 1

	)

341 
	#__USE_XOPEN2K
 1

	)

342 
	#__USE_XOPEN2KXSI
 1

	)

343 #undeà
__USE_ISOC95


344 
	#__USE_ISOC95
 1

	)

345 #undeà
__USE_ISOC99


346 
	#__USE_ISOC99
 1

	)

349 #ifdeà
_XOPEN_SOURCE_EXTENDED


350 
	#__USE_XOPEN_EXTENDED
 1

	)

355 #ifdeà
_LARGEFILE_SOURCE


356 
	#__USE_LARGEFILE
 1

	)

359 #ifdeà
_LARGEFILE64_SOURCE


360 
	#__USE_LARGEFILE64
 1

	)

363 #ià
defšed
 
_FILE_OFFSET_BITS
 && _FILE_OFFSET_BITS == 64

364 
	#__USE_FILE_OFFSET64
 1

	)

367 #ià
defšed
 
_DEFAULT_SOURCE


368 
	#__USE_MISC
 1

	)

371 #ifdef 
_ATFILE_SOURCE


372 
	#__USE_ATFILE
 1

	)

375 #ifdef 
_GNU_SOURCE


376 
	#__USE_GNU
 1

	)

379 #ià
defšed
 
_FORTIFY_SOURCE
 && _FORTIFY_SOURCE > 0 \

380 && 
__GNUC_PREREQ
 (4, 1è&& 
defšed
 
	g__OPTIMIZE__
 && __OPTIMIZE__ > 0

381 #ià
_FORTIFY_SOURCE
 > 1

382 
	#__USE_FORTIFY_LEVEL
 2

	)

384 
	#__USE_FORTIFY_LEVEL
 1

	)

387 
	#__USE_FORTIFY_LEVEL
 0

	)

394 #ià
defšed
 
__ılu¥lus
 ? __ılu¥lu >ğ201402L : defšed 
__USE_ISOC11


395 
	#__GLIBC_USE_DEPRECATED_GETS
 0

	)

397 
	#__GLIBC_USE_DEPRECATED_GETS
 1

	)

402 
	~<¡dc-´edef.h
>

410 #undeà
__GNU_LIBRARY__


411 
	#__GNU_LIBRARY__
 6

	)

415 
	#__GLIBC__
 2

	)

416 
	#__GLIBC_MINOR__
 27

	)

418 
	#__GLIBC_PREREQ
(
maj
, 
mš
) \

419 ((
__GLIBC__
 << 16è+ 
__GLIBC_MINOR__
 >ğ((
maj
è<< 16è+ (
mš
))

	)

422 #iâdeà
__ASSEMBLER__


423 #iâdeà
_SYS_CDEFS_H


424 
	~<sys/cdefs.h
>

429 #ià
defšed
 
__USE_FILE_OFFSET64
 && !defšed 
__REDIRECT


430 
	#__USE_LARGEFILE
 1

	)

431 
	#__USE_LARGEFILE64
 1

	)

437 #ià
__GNUC_PREREQ
 (2, 7è&& 
defšed
 
__OPTIMIZE__
 \

438 && !
defšed
 
	g__OPTIMIZE_SIZE__
 && !defšed 
	g__NO_INLINE__
 \

439 && 
defšed
 
	g__ex‹º_šlše


440 
	#__USE_EXTERN_INLINES
 1

	)

448 
	~<gnu/¡ubs.h
>

	@/usr/include/rpc/netdb.h

36 #iâdeà
_RPC_NETDB_H


37 
	#_RPC_NETDB_H
 1

	)

39 
	~<ã©u»s.h
>

41 
	#__Ãed_size_t


	)

42 
	~<¡ddef.h
>

44 
__BEGIN_DECLS


46 
	s½ûÁ


48 *
	mr_Çme
;

49 **
	mr_®Ÿ£s
;

50 
	mr_numb”
;

53 
	$£ŒpûÁ
 (
__¡ayİ’
è
__THROW
;

54 
	$’d½ûÁ
 (è
__THROW
;

55 
½ûÁ
 *
	$g‘½cbyÇme
 (cÚ¡ *
__Çme
è
__THROW
;

56 
½ûÁ
 *
	$g‘½cbynumb”
 (
__numb”
è
__THROW
;

57 
½ûÁ
 *
	$g‘½ûÁ
 (è
__THROW
;

59 #ifdeà
__USE_MISC


60 
	$g‘½cbyÇme_r
 (cÚ¡ *
__Çme
, 
½ûÁ
 *
__»suÉ_buf
,

61 *
__bufãr
, 
size_t
 
__buæ’
,

62 
½ûÁ
 **
__»suÉ
è
__THROW
;

64 
	$g‘½cbynumb”_r
 (
__numb”
, 
½ûÁ
 *
__»suÉ_buf
,

65 *
__bufãr
, 
size_t
 
__buæ’
,

66 
½ûÁ
 **
__»suÉ
è
__THROW
;

68 
	$g‘½ûÁ_r
 (
½ûÁ
 *
__»suÉ_buf
, *
__bufãr
,

69 
size_t
 
__buæ’
, 
½ûÁ
 **
__»suÉ
è
__THROW
;

72 
__END_DECLS


	@/usr/include/sched.h

19 #iâdef 
_SCHED_H


20 
	#_SCHED_H
 1

	)

22 
	~<ã©u»s.h
>

25 
	~<b™s/ty³s.h
>

27 
	#__Ãed_size_t


	)

28 
	#__Ãed_NULL


	)

29 
	~<¡ddef.h
>

31 
	~<b™s/ty³s/time_t.h
>

32 
	~<b™s/ty³s/¡ruù_time¥ec.h
>

33 #iâdeà
__USE_XOPEN2K


34 
	~<time.h
>

37 #iâdeà
__pid_t_defšed


38 
__pid_t
 
	tpid_t
;

39 
	#__pid_t_defšed


	)

43 
	~<b™s/sched.h
>

44 
	~<b™s/ıu-£t.h
>

47 
	#sched_´iÜ™y
 
sched_´iÜ™y


	)

48 
	#__sched_´iÜ™y
 
sched_´iÜ™y


	)

51 
__BEGIN_DECLS


54 
	$sched_£¬am
 (
__pid_t
 
__pid
, cÚ¡ 
sched_·¿m
 *
__·¿m
)

55 
__THROW
;

58 
	$sched_g‘·¿m
 (
__pid_t
 
__pid
, 
sched_·¿m
 *
__·¿m
è
__THROW
;

61 
	$sched_£tscheduËr
 (
__pid_t
 
__pid
, 
__pŞicy
,

62 cÚ¡ 
sched_·¿m
 *
__·¿m
è
__THROW
;

65 
	$sched_g‘scheduËr
 (
__pid_t
 
__pid
è
__THROW
;

68 
	$sched_y›ld
 (è
__THROW
;

71 
	$sched_g‘_´iÜ™y_max
 (
__®gÜ™hm
è
__THROW
;

74 
	$sched_g‘_´iÜ™y_mš
 (
__®gÜ™hm
è
__THROW
;

77 
	$sched_¼_g‘_š‹rv®
 (
__pid_t
 
__pid
, 
time¥ec
 *
__t
è
__THROW
;

80 #ifdeà
__USE_GNU


82 
	#CPU_SETSIZE
 
__CPU_SETSIZE


	)

83 
	#CPU_SET
(
ıu
, 
ıu£
è
	`__CPU_SET_S
 (ıu,  (
ıu_£t_t
), cpu£)

	)

84 
	#CPU_CLR
(
ıu
, 
ıu£
è
	`__CPU_CLR_S
 (ıu,  (
ıu_£t_t
), cpu£)

	)

85 
	#CPU_ISSET
(
ıu
, 
ıu£
è
	`__CPU_ISSET_S
 (ıu,  (
ıu_£t_t
), \

86 
ıu£
)

	)

87 
	#CPU_ZERO
(
ıu£
è
	`__CPU_ZERO_S
 ( (
ıu_£t_t
), cpu£)

	)

88 
	#CPU_COUNT
(
ıu£
è
	`__CPU_COUNT_S
 ( (
ıu_£t_t
), cpu£)

	)

90 
	#CPU_SET_S
(
ıu
, 
£tsize
, 
ıu£
è
	`__CPU_SET_S
 (ıu, s‘size, cpu£)

	)

91 
	#CPU_CLR_S
(
ıu
, 
£tsize
, 
ıu£
è
	`__CPU_CLR_S
 (ıu, s‘size, cpu£)

	)

92 
	#CPU_ISSET_S
(
ıu
, 
£tsize
, 
ıu£
è
	`__CPU_ISSET_S
 (cpu, setsize, \

93 
ıu£
)

	)

94 
	#CPU_ZERO_S
(
£tsize
, 
ıu£
è
	`__CPU_ZERO_S
 (£tsize, cpu£)

	)

95 
	#CPU_COUNT_S
(
£tsize
, 
ıu£
è
	`__CPU_COUNT_S
 (£tsize, cpu£)

	)

97 
	#CPU_EQUAL
(
ıu£1
, 
ıu£2
) \

98 
	`__CPU_EQUAL_S
 ( (
ıu_£t_t
), 
ıu£1
, 
ıu£2
)

	)

99 
	#CPU_EQUAL_S
(
£tsize
, 
ıu£1
, 
ıu£2
) \

100 
	`__CPU_EQUAL_S
 (
£tsize
, 
ıu£1
, 
ıu£2
)

	)

102 
	#CPU_AND
(
de¡£t
, 
¤c£t1
, 
¤c£t2
) \

103 
	`__CPU_OP_S
 ( (
ıu_£t_t
), 
de¡£t
, 
¤c£t1
, 
¤c£t2
, &)

	)

104 
	#CPU_OR
(
de¡£t
, 
¤c£t1
, 
¤c£t2
) \

105 
	`__CPU_OP_S
 ( (
ıu_£t_t
), 
de¡£t
, 
¤c£t1
, 
¤c£t2
, |)

	)

106 
	#CPU_XOR
(
de¡£t
, 
¤c£t1
, 
¤c£t2
) \

107 
	`__CPU_OP_S
 ( (
ıu_£t_t
), 
de¡£t
, 
¤c£t1
, 
¤c£t2
, ^)

	)

108 
	#CPU_AND_S
(
£tsize
, 
de¡£t
, 
¤c£t1
, 
¤c£t2
) \

109 
	`__CPU_OP_S
 (
£tsize
, 
de¡£t
, 
¤c£t1
, 
¤c£t2
, &)

	)

110 
	#CPU_OR_S
(
£tsize
, 
de¡£t
, 
¤c£t1
, 
¤c£t2
) \

111 
	`__CPU_OP_S
 (
£tsize
, 
de¡£t
, 
¤c£t1
, 
¤c£t2
, |)

	)

112 
	#CPU_XOR_S
(
£tsize
, 
de¡£t
, 
¤c£t1
, 
¤c£t2
) \

113 
	`__CPU_OP_S
 (
£tsize
, 
de¡£t
, 
¤c£t1
, 
¤c£t2
, ^)

	)

115 
	#CPU_ALLOC_SIZE
(
couÁ
è
	`__CPU_ALLOC_SIZE
 (couÁ)

	)

116 
	#CPU_ALLOC
(
couÁ
è
	`__CPU_ALLOC
 (couÁ)

	)

117 
	#CPU_FREE
(
ıu£t
è
	`__CPU_FREE
 (ıu£t)

	)

121 
	$sched_£ffš™y
 (
__pid_t
 
__pid
, 
size_t
 
__ıu£tsize
,

122 cÚ¡ 
ıu_£t_t
 *
__ıu£t
è
__THROW
;

125 
	$sched_g‘affš™y
 (
__pid_t
 
__pid
, 
size_t
 
__ıu£tsize
,

126 
ıu_£t_t
 *
__ıu£t
è
__THROW
;

129 
__END_DECLS


	@/usr/include/zconf.h

8 #iâdeà
ZCONF_H


9 
	#ZCONF_H


	)

17 #ifdeà
Z_PREFIX


18 
	#Z_PREFIX_SET


	)

21 
	#_di¡_code
 
z__di¡_code


	)

22 
	#_Ëngth_code
 
z__Ëngth_code


	)

23 
	#_Œ_®ign
 
z__Œ_®ign


	)

24 
	#_Œ_æush_b™s
 
z__Œ_æush_b™s


	)

25 
	#_Œ_æush_block
 
z__Œ_æush_block


	)

26 
	#_Œ_š™
 
z__Œ_š™


	)

27 
	#_Œ_¡Üed_block
 
z__Œ_¡Üed_block


	)

28 
	#_Œ_Îy
 
z__Œ_Îy


	)

29 
	#adËr32
 
z_adËr32


	)

30 
	#adËr32_combše
 
z_adËr32_combše


	)

31 
	#adËr32_combše64
 
z_adËr32_combše64


	)

32 
	#adËr32_z
 
z_adËr32_z


	)

33 #iâdeà
Z_SOLO


34 
	#com´ess
 
z_com´ess


	)

35 
	#com´ess2
 
z_com´ess2


	)

36 
	#com´essBound
 
z_com´essBound


	)

38 
	#üc32
 
z_üc32


	)

39 
	#üc32_combše
 
z_üc32_combše


	)

40 
	#üc32_combše64
 
z_üc32_combše64


	)

41 
	#üc32_z
 
z_üc32_z


	)

42 
	#deæ©e
 
z_deæ©e


	)

43 
	#deæ©eBound
 
z_deæ©eBound


	)

44 
	#deæ©eCİy
 
z_deæ©eCİy


	)

45 
	#deæ©eEnd
 
z_deæ©eEnd


	)

46 
	#deæ©eG‘DiùiÚ¬y
 
z_deæ©eG‘DiùiÚ¬y


	)

47 
	#deæ©eIn™
 
z_deæ©eIn™


	)

48 
	#deæ©eIn™2
 
z_deæ©eIn™2


	)

49 
	#deæ©eIn™2_
 
z_deæ©eIn™2_


	)

50 
	#deæ©eIn™_
 
z_deæ©eIn™_


	)

51 
	#deæ©eP¬ams
 
z_deæ©eP¬ams


	)

52 
	#deæ©eP’dšg
 
z_deæ©eP’dšg


	)

53 
	#deæ©ePrime
 
z_deæ©ePrime


	)

54 
	#deæ©eRe£t
 
z_deæ©eRe£t


	)

55 
	#deæ©eRe£tK“p
 
z_deæ©eRe£tK“p


	)

56 
	#deæ©eS‘DiùiÚ¬y
 
z_deæ©eS‘DiùiÚ¬y


	)

57 
	#deæ©eS‘H—d”
 
z_deæ©eS‘H—d”


	)

58 
	#deæ©eTuÃ
 
z_deæ©eTuÃ


	)

59 
	#deæ©e_cİyright
 
z_deæ©e_cİyright


	)

60 
	#g‘_üc_bË
 
z_g‘_üc_bË


	)

61 #iâdeà
Z_SOLO


62 
	#gz_”rÜ
 
z_gz_”rÜ


	)

63 
	#gz_štmax
 
z_gz_štmax


	)

64 
	#gz_¡rwš”rÜ
 
z_gz_¡rwš”rÜ


	)

65 
	#gzbufãr
 
z_gzbufãr


	)

66 
	#gzş—»¼
 
z_gzş—»¼


	)

67 
	#gzşo£
 
z_gzşo£


	)

68 
	#gzşo£_r
 
z_gzşo£_r


	)

69 
	#gzşo£_w
 
z_gzşo£_w


	)

70 
	#gzdœeù
 
z_gzdœeù


	)

71 
	#gzdİ’
 
z_gzdİ’


	)

72 
	#gzeof
 
z_gzeof


	)

73 
	#gz”rÜ
 
z_gz”rÜ


	)

74 
	#gzæush
 
z_gzæush


	)

75 
	#gzä—d
 
z_gzä—d


	)

76 
	#gzfwr™e
 
z_gzfwr™e


	)

77 
	#gzg‘c
 
z_gzg‘c


	)

78 
	#gzg‘c_
 
z_gzg‘c_


	)

79 
	#gzg‘s
 
z_gzg‘s


	)

80 
	#gzoff£t
 
z_gzoff£t


	)

81 
	#gzoff£t64
 
z_gzoff£t64


	)

82 
	#gzİ’
 
z_gzİ’


	)

83 
	#gzİ’64
 
z_gzİ’64


	)

84 #ifdeà
_WIN32


85 
	#gzİ’_w
 
z_gzİ’_w


	)

87 
	#gz´štf
 
z_gz´štf


	)

88 
	#gzputc
 
z_gzputc


	)

89 
	#gzputs
 
z_gzputs


	)

90 
	#gz»ad
 
z_gz»ad


	)

91 
	#gz»wšd
 
z_gz»wšd


	)

92 
	#gz£ek
 
z_gz£ek


	)

93 
	#gz£ek64
 
z_gz£ek64


	)

94 
	#gz£¬ams
 
z_gz£¬ams


	)

95 
	#gz‹Î
 
z_gz‹Î


	)

96 
	#gz‹Î64
 
z_gz‹Î64


	)

97 
	#gzung‘c
 
z_gzung‘c


	)

98 
	#gzv´štf
 
z_gzv´štf


	)

99 
	#gzwr™e
 
z_gzwr™e


	)

101 
	#šæ©e
 
z_šæ©e


	)

102 
	#šæ©eBack
 
z_šæ©eBack


	)

103 
	#šæ©eBackEnd
 
z_šæ©eBackEnd


	)

104 
	#šæ©eBackIn™
 
z_šæ©eBackIn™


	)

105 
	#šæ©eBackIn™_
 
z_šæ©eBackIn™_


	)

106 
	#šæ©eCodesU£d
 
z_šæ©eCodesU£d


	)

107 
	#šæ©eCİy
 
z_šæ©eCİy


	)

108 
	#šæ©eEnd
 
z_šæ©eEnd


	)

109 
	#šæ©eG‘DiùiÚ¬y
 
z_šæ©eG‘DiùiÚ¬y


	)

110 
	#šæ©eG‘H—d”
 
z_šæ©eG‘H—d”


	)

111 
	#šæ©eIn™
 
z_šæ©eIn™


	)

112 
	#šæ©eIn™2
 
z_šæ©eIn™2


	)

113 
	#šæ©eIn™2_
 
z_šæ©eIn™2_


	)

114 
	#šæ©eIn™_
 
z_šæ©eIn™_


	)

115 
	#šæ©eM¬k
 
z_šæ©eM¬k


	)

116 
	#šæ©ePrime
 
z_šæ©ePrime


	)

117 
	#šæ©eRe£t
 
z_šæ©eRe£t


	)

118 
	#šæ©eRe£t2
 
z_šæ©eRe£t2


	)

119 
	#šæ©eRe£tK“p
 
z_šæ©eRe£tK“p


	)

120 
	#šæ©eS‘DiùiÚ¬y
 
z_šæ©eS‘DiùiÚ¬y


	)

121 
	#šæ©eSync
 
z_šæ©eSync


	)

122 
	#šæ©eSyncPošt
 
z_šæ©eSyncPošt


	)

123 
	#šæ©eUnd”mše
 
z_šæ©eUnd”mše


	)

124 
	#šæ©eV®id©e
 
z_šæ©eV®id©e


	)

125 
	#šæ©e_cİyright
 
z_šæ©e_cİyright


	)

126 
	#šæ©e_ç¡
 
z_šæ©e_ç¡


	)

127 
	#šæ©e_bË
 
z_šæ©e_bË


	)

128 #iâdeà
Z_SOLO


129 
	#uncom´ess
 
z_uncom´ess


	)

130 
	#uncom´ess2
 
z_uncom´ess2


	)

132 
	#zE¼Ü
 
z_zE¼Ü


	)

133 #iâdeà
Z_SOLO


134 
	#zÿÎoc
 
z_zÿÎoc


	)

135 
	#zcä“
 
z_zcä“


	)

137 
	#zlibCompeFÏgs
 
z_zlibCompeFÏgs


	)

138 
	#zlibV”siÚ
 
z_zlibV”siÚ


	)

141 
	#By‹
 
z_By‹


	)

142 
	#By‹f
 
z_By‹f


	)

143 
	#®loc_func
 
z_®loc_func


	)

144 
	#ch¬f
 
z_ch¬f


	)

145 
	#ä“_func
 
z_ä“_func


	)

146 #iâdeà
Z_SOLO


147 
	#gzFe
 
z_gzFe


	)

149 
	#gz_h—d”
 
z_gz_h—d”


	)

150 
	#gz_h—d”p
 
z_gz_h—d”p


	)

151 
	#š_func
 
z_š_func


	)

152 
	#štf
 
z_štf


	)

153 
	#out_func
 
z_out_func


	)

154 
	#uIÁ
 
z_uIÁ


	)

155 
	#uIÁf
 
z_uIÁf


	)

156 
	#uLÚg
 
z_uLÚg


	)

157 
	#uLÚgf
 
z_uLÚgf


	)

158 
	#voidp
 
z_voidp


	)

159 
	#voidpc
 
z_voidpc


	)

160 
	#voidpf
 
z_voidpf


	)

163 
	#gz_h—d”_s
 
z_gz_h—d”_s


	)

164 
	#š‹º®_¡©e
 
z_š‹º®_¡©e


	)

168 #ià
defšed
(
__MSDOS__
è&& !defšed(
MSDOS
)

169 
	#MSDOS


	)

171 #ià(
defšed
(
OS_2
è|| defšed(
__OS2__
)è&& !defšed(
OS2
)

172 
	#OS2


	)

174 #ià
defšed
(
_WINDOWS
è&& !defšed(
WINDOWS
)

175 
	#WINDOWS


	)

177 #ià
defšed
(
_WIN32
è|| defšed(
_WIN32_WCE
è|| defšed(
__WIN32__
)

178 #iâdeà
WIN32


179 
	#WIN32


	)

182 #ià(
defšed
(
MSDOS
è|| defšed(
OS2
è|| defšed(
WINDOWS
)è&& !defšed(
WIN32
)

183 #ià!
defšed
(
__GNUC__
è&& !defšed(
__FLAT__
è&& !defšed(
__386__
)

184 #iâdeà
SYS16BIT


185 
	#SYS16BIT


	)

194 #ifdeà
SYS16BIT


195 
	#MAXSEG_64K


	)

197 #ifdeà
MSDOS


198 
	#UNALIGNED_OK


	)

201 #ifdeà
__STDC_VERSION__


202 #iâdeà
STDC


203 
	#STDC


	)

205 #ià
__STDC_VERSION__
 >= 199901L

206 #iâdeà
STDC99


207 
	#STDC99


	)

211 #ià!
defšed
(
STDC
è&& (defšed(
__STDC__
è|| defšed(
__ılu¥lus
))

212 
	#STDC


	)

214 #ià!
defšed
(
STDC
è&& (defšed(
__GNUC__
è|| defšed(
__BORLANDC__
))

215 
	#STDC


	)

217 #ià!
defšed
(
STDC
è&& (defšed(
MSDOS
è|| defšed(
WINDOWS
è|| defšed(
WIN32
))

218 
	#STDC


	)

220 #ià!
defšed
(
STDC
è&& (defšed(
OS2
è|| defšed(
__HOS_AIX__
))

221 
	#STDC


	)

224 #ià
defšed
(
__OS400__
è&& !defšed(
STDC
)

225 
	#STDC


	)

228 #iâdeà
STDC


230 cÚ¡

	)

234 #ià
defšed
(
ZLIB_CONST
è&& !defšed(
z_cÚ¡
)

235 
	#z_cÚ¡
 cÚ¡

	)

237 
	#z_cÚ¡


	)

240 #ifdeà
Z_SOLO


241 
	tz_size_t
;

243 
	#z_lÚglÚg
 

	)

244 #ià
defšed
(
NO_SIZE_T
)

245 
	tNO_SIZE_T
 
	tz_size_t
;

246 #–ià
defšed
(
STDC
)

247 
	~<¡ddef.h
>

248 
size_t
 
	tz_size_t
;

250 
	tz_size_t
;

252 #undeà
z_lÚglÚg


256 #iâdeà
MAX_MEM_LEVEL


257 #ifdeà
MAXSEG_64K


258 
	#MAX_MEM_LEVEL
 8

	)

260 
	#MAX_MEM_LEVEL
 9

	)

269 #iâdeà
MAX_WBITS


270 
	#MAX_WBITS
 15

	)

288 #iâdeà
OF


289 #ifdeà
STDC


290 
	#OF
(
¬gs
è
	)
args

292 
	#OF
(
¬gs
è()

	)

296 #iâdeà
Z_ARG


297 #ià
defšed
(
STDC
è|| defšed(
Z_HAVE_STDARG_H
)

298 
	#Z_ARG
(
¬gs
è
	)
args

300 
	#Z_ARG
(
¬gs
è()

	)

310 #ifdeà
SYS16BIT


311 #ià
defšed
(
M_I86SM
è|| defšed(
M_I86MM
)

313 
	#SMALL_MEDIUM


	)

314 #ifdeà
_MSC_VER


315 
	#FAR
 
_çr


	)

317 
	#FAR
 
çr


	)

320 #ià(
defšed
(
__SMALL__
è|| defšed(
__MEDIUM__
))

322 
	#SMALL_MEDIUM


	)

323 #ifdeà
__BORLANDC__


324 
	#FAR
 
_çr


	)

326 
	#FAR
 
çr


	)

331 #ià
defšed
(
WINDOWS
è|| defšed(
WIN32
)

335 #ifdeà
ZLIB_DLL


336 #ià
defšed
(
WIN32
è&& (!defšed(
__BORLANDC__
) || (__BORLANDC__ >= 0x500))

337 #ifdeà
ZLIB_INTERNAL


338 
	#ZEXTERN
 
	`__deş¥ec
(
dÎexpÜt
)

	)

340 
	#ZEXTERN
 
	`__deş¥ec
(
dÎimpÜt
)

	)

348 #ifdeà
ZLIB_WINAPI


349 #ifdeà
FAR


350 #undeà
FAR


352 
	~<wšdows.h
>

355 
	#ZEXPORT
 
WINAPI


	)

356 #ifdeà
WIN32


357 
	#ZEXPORTVA
 
WINAPIV


	)

359 
	#ZEXPORTVA
 
FAR
 
CDECL


	)

364 #ià
defšed
 (
__BEOS__
)

365 #ifdeà
ZLIB_DLL


366 #ifdeà
ZLIB_INTERNAL


367 
	#ZEXPORT
 
	`__deş¥ec
(
dÎexpÜt
)

	)

368 
	#ZEXPORTVA
 
	`__deş¥ec
(
dÎexpÜt
)

	)

370 
	#ZEXPORT
 
	`__deş¥ec
(
dÎimpÜt
)

	)

371 
	#ZEXPORTVA
 
	`__deş¥ec
(
dÎimpÜt
)

	)

376 #iâdeà
ZEXTERN


377 
	#ZEXTERN
 

	)

379 #iâdeà
ZEXPORT


380 
	#ZEXPORT


	)

382 #iâdeà
ZEXPORTVA


383 
	#ZEXPORTVA


	)

386 #iâdeà
FAR


387 
	#FAR


	)

390 #ià!
defšed
(
__MACTYPES__
)

391 
	tBy‹
;

393 
	tuIÁ
;

394 
	tuLÚg
;

396 #ifdeà
SMALL_MEDIUM


398 
	#By‹f
 
By‹
 
FAR


	)

400 
By‹
 
	tFAR
 
	tBy‹f
;

402 
	tFAR
 
	tch¬f
;

403 
	tFAR
 
	tštf
;

404 
uIÁ
 
	tFAR
 
	tuIÁf
;

405 
uLÚg
 
	tFAR
 
	tuLÚgf
;

407 #ifdeà
STDC


408 cÚ¡ *
	tvoidpc
;

409 
	tFAR
 *
	tvoidpf
;

410 *
	tvoidp
;

412 
By‹
 cÚ¡ *
	tvoidpc
;

413 
By‹
 
	tFAR
 *
	tvoidpf
;

414 
By‹
 *
	tvoidp
;

417 #ià!
defšed
(
Z_U4
è&& !defšed(
Z_SOLO
è&& defšed(
STDC
)

418 
	~<lim™s.h
>

419 #ià(
UINT_MAX
 == 0xffffffffUL)

420 
	#Z_U4
 

	)

421 #–ià(
ULONG_MAX
 == 0xffffffffUL)

422 
	#Z_U4
 

	)

423 #–ià(
USHRT_MAX
 == 0xffffffffUL)

424 
	#Z_U4
 

	)

428 #ifdeà
Z_U4


429 
Z_U4
 
	tz_üc_t
;

431 
	tz_üc_t
;

435 
	#Z_HAVE_UNISTD_H


	)

439 
	#Z_HAVE_STDARG_H


	)

442 #ifdeà
STDC


443 #iâdeà
Z_SOLO


444 
	~<sys/ty³s.h
>

448 #ià
defšed
(
STDC
è|| defšed(
Z_HAVE_STDARG_H
)

449 #iâdeà
Z_SOLO


450 
	~<¡d¬g.h
>

454 #ifdeà
_WIN32


455 #iâdeà
Z_SOLO


456 
	~<¡ddef.h
>

466 #ià
defšed
(
_LARGEFILE64_SOURCE
) && -_LARGEFILE64_SOURCE - -1 == 1

467 #undeà
_LARGEFILE64_SOURCE


470 #ià
defšed
(
__WATCOMC__
è&& !defšed(
Z_HAVE_UNISTD_H
)

471 
	#Z_HAVE_UNISTD_H


	)

473 #iâdeà
Z_SOLO


474 #ià
defšed
(
Z_HAVE_UNISTD_H
è|| defšed(
_LARGEFILE64_SOURCE
)

475 
	~<uni¡d.h
>

476 #ifdeà
VMS


477 
	~<unixio.h
>

479 #iâdeà
z_off_t


480 
	#z_off_t
 
off_t


	)

485 #ià
defšed
(
_LFS64_LARGEFILE
) && _LFS64_LARGEFILE-0

486 
	#Z_LFS64


	)

489 #ià
defšed
(
_LARGEFILE64_SOURCE
è&& defšed(
Z_LFS64
)

490 
	#Z_LARGE64


	)

493 #ià
defšed
(
_FILE_OFFSET_BITS
è&& _FILE_OFFSET_BITS-0 =ğ64 && defšed(
Z_LFS64
)

494 
	#Z_WANT64


	)

497 #ià!
defšed
(
SEEK_SET
è&& !defšed(
Z_SOLO
)

498 
	#SEEK_SET
 0

	)

499 
	#SEEK_CUR
 1

	)

500 
	#SEEK_END
 2

	)

503 #iâdeà
z_off_t


504 
	#z_off_t
 

	)

507 #ià!
defšed
(
_WIN32
è&& defšed(
Z_LARGE64
)

508 
	#z_off64_t
 
off64_t


	)

510 #ià
defšed
(
_WIN32
è&& !defšed(
__GNUC__
è&& !defšed(
Z_SOLO
)

511 
	#z_off64_t
 
__št64


	)

513 
	#z_off64_t
 
z_off_t


	)

518 #ià
defšed
(
__MVS__
)

519 #´agm¨
m­
(
deæ©eIn™_
,"DEIN")

520 #´agm¨
m­
(
deæ©eIn™2_
,"DEIN2")

521 #´agm¨
m­
(
deæ©eEnd
,"DEEND")

522 #´agm¨
m­
(
deæ©eBound
,"DEBND")

523 #´agm¨
m­
(
šæ©eIn™_
,"ININ")

524 #´agm¨
m­
(
šæ©eIn™2_
,"ININ2")

525 #´agm¨
m­
(
šæ©eEnd
,"INEND")

526 #´agm¨
m­
(
šæ©eSync
,"INSY")

527 #´agm¨
m­
(
šæ©eS‘DiùiÚ¬y
,"INSEDI")

528 #´agm¨
m­
(
com´essBound
,"CMBND")

529 #´agm¨
m­
(
šæ©e_bË
,"INTABL")

530 #´agm¨
m­
(
šæ©e_ç¡
,"INFA")

531 #´agm¨
m­
(
šæ©e_cİyright
,"INCOPY")

	@/usr/include/limits.h

22 #iâdeà
_LIBC_LIMITS_H_


23 
	#_LIBC_LIMITS_H_
 1

	)

25 
	#__GLIBC_INTERNAL_STARTING_HEADER_IMPLEMENTATION


	)

26 
	~<b™s/libc-h—d”-¡¬t.h
>

32 
	#MB_LEN_MAX
 16

	)

37 #ià!
defšed
 
__GNUC__
 || __GNUC__ < 2

42 #iâdeà
_LIMITS_H


43 
	#_LIMITS_H
 1

	)

45 
	~<b™s/wÜdsize.h
>

54 
	#CHAR_BIT
 8

	)

57 
	#SCHAR_MIN
 (-128)

	)

58 
	#SCHAR_MAX
 127

	)

61 
	#UCHAR_MAX
 255

	)

64 #ifdeà
__CHAR_UNSIGNED__


65 
	#CHAR_MIN
 0

	)

66 
	#CHAR_MAX
 
UCHAR_MAX


	)

68 
	#CHAR_MIN
 
SCHAR_MIN


	)

69 
	#CHAR_MAX
 
SCHAR_MAX


	)

73 
	#SHRT_MIN
 (-32768)

	)

74 
	#SHRT_MAX
 32767

	)

77 
	#USHRT_MAX
 65535

	)

80 
	#INT_MIN
 (-
INT_MAX
 - 1)

	)

81 
	#INT_MAX
 2147483647

	)

84 
	#UINT_MAX
 4294967295U

	)

87 #ià
__WORDSIZE
 == 64

88 
	#LONG_MAX
 9223372036854775807L

	)

90 
	#LONG_MAX
 2147483647L

	)

92 
	#LONG_MIN
 (-
LONG_MAX
 - 1L)

	)

95 #ià
__WORDSIZE
 == 64

96 
	#ULONG_MAX
 18446744073709551615UL

	)

98 
	#ULONG_MAX
 4294967295UL

	)

101 #ifdeà
__USE_ISOC99


104 
	#LLONG_MAX
 9223372036854775807LL

	)

105 
	#LLONG_MIN
 (-
LLONG_MAX
 - 1LL)

	)

108 
	#ULLONG_MAX
 18446744073709551615ULL

	)

122 #ià
defšed
 
__GNUC__
 && !defšed 
_GCC_LIMITS_H_


124 #šşude_Ãxˆ<
lim™s
.
h
>

130 #ià
defšed
 
__USE_ISOC99
 && defšed 
__GNUC__


131 #iâdeà
LLONG_MIN


132 
	#LLONG_MIN
 (-
LLONG_MAX
-1)

	)

134 #iâdeà
LLONG_MAX


135 
	#LLONG_MAX
 
__LONG_LONG_MAX__


	)

137 #iâdeà
ULLONG_MAX


138 
	#ULLONG_MAX
 (
LLONG_MAX
 * 2ULL + 1)

	)

145 #ià
__GLIBC_USE
 (
IEC_60559_BFP_EXT
)

146 #iâdeà
CHAR_WIDTH


147 
	#CHAR_WIDTH
 8

	)

149 #iâdeà
SCHAR_WIDTH


150 
	#SCHAR_WIDTH
 8

	)

152 #iâdeà
UCHAR_WIDTH


153 
	#UCHAR_WIDTH
 8

	)

155 #iâdeà
SHRT_WIDTH


156 
	#SHRT_WIDTH
 16

	)

158 #iâdeà
USHRT_WIDTH


159 
	#USHRT_WIDTH
 16

	)

161 #iâdeà
INT_WIDTH


162 
	#INT_WIDTH
 32

	)

164 #iâdeà
UINT_WIDTH


165 
	#UINT_WIDTH
 32

	)

167 #iâdeà
LONG_WIDTH


168 
	#LONG_WIDTH
 
__WORDSIZE


	)

170 #iâdeà
ULONG_WIDTH


171 
	#ULONG_WIDTH
 
__WORDSIZE


	)

173 #iâdeà
LLONG_WIDTH


174 
	#LLONG_WIDTH
 64

	)

176 #iâdeà
ULLONG_WIDTH


177 
	#ULLONG_WIDTH
 64

	)

181 #ifdef 
__USE_POSIX


183 
	~<b™s/posix1_lim.h
>

186 #ifdef 
__USE_POSIX2


187 
	~<b™s/posix2_lim.h
>

190 #ifdef 
__USE_XOPEN


191 
	~<b™s/xİ’_lim.h
>

	@/usr/include/stdc-predef.h

18 #iâdef 
_STDC_PREDEF_H


19 
	#_STDC_PREDEF_H
 1

	)

36 #ifdeà
__GCC_IEC_559


37 #ià
__GCC_IEC_559
 > 0

38 
	#__STDC_IEC_559__
 1

	)

41 
	#__STDC_IEC_559__
 1

	)

44 #ifdeà
__GCC_IEC_559_COMPLEX


45 #ià
__GCC_IEC_559_COMPLEX
 > 0

46 
	#__STDC_IEC_559_COMPLEX__
 1

	)

49 
	#__STDC_IEC_559_COMPLEX__
 1

	)

58 
	#__STDC_ISO_10646__
 201706L

	)

61 
	#__STDC_NO_THREADS__
 1

	)

	@
1
.
1
/usr/include
446
9813
Common.h
Dat2drv.cpp
Dat2drv.h
FindPPD.cpp
FindPPD.h
Normalize.cpp
Normalize.h
common/utils.c
common/utils.h
io/hpmud/dot4.c
io/hpmud/dot4.h
io/hpmud/hpmud.c
io/hpmud/hpmud.h
io/hpmud/hpmudi.h
io/hpmud/jd.c
io/hpmud/jd.h
io/hpmud/list.h
io/hpmud/mlc.c
io/hpmud/mlc.h
io/hpmud/model.c
io/hpmud/musb.c
io/hpmud/musb.h
io/hpmud/musb_libusb01.c
io/hpmud/pml.c
io/hpmud/pml.h
io/hpmud/pp.c
io/hpmud/pp.h
io/mudext/hpmudext.c
ip/hpip.h
ip/ipdefs.h
ip/ipmain.c
ip/xbi2gray.c
ip/xchgbpp.c
ip/xcolrspc.c
ip/xconvolve.c
ip/xcrop.c
ip/xfakemono.c
ip/xfax.c
ip/xform.h
ip/xgamma.c
ip/xgray2bi.c
ip/xgrayout.c
ip/xinvert.c
ip/xjpg_dct.c
ip/xjpg_dct.h
ip/xjpg_dec.c
ip/xjpg_enc.c
ip/xjpg_fix.c
ip/xjpg_huf.c
ip/xjpg_huf.h
ip/xjpg_mrk.h
ip/xmatrix.c
ip/xpad.c
ip/xpcx.c
ip/xpnm.c
ip/xrotate.c
ip/xsaturation.c
ip/xscale.c
ip/xskel.c
ip/xtable.c
ip/xthumb.c
ip/xtiff.c
ip/xtonemap.c
ip/xyxtract.c
pcard/fat.c
pcard/fat.h
pcard/pcardext/pcardext.c
pcard/ptest.c
pcard/ptest.h
prnt/backend/hp.c
prnt/cupsext/cupsext.c
prnt/cupsext/cupsext.h
prnt/hpcups/BreakTables.cpp
prnt/hpcups/ColorMaps.h
prnt/hpcups/ColorMatcher.cpp
prnt/hpcups/ColorMatcher.h
prnt/hpcups/CommonDefinitions.h
prnt/hpcups/Compressor.cpp
prnt/hpcups/Compressor.h
prnt/hpcups/Encapsulator.cpp
prnt/hpcups/Encapsulator.h
prnt/hpcups/EncapsulatorFactory.cpp
prnt/hpcups/EncapsulatorFactory.h
prnt/hpcups/ErnieFilter.cpp
prnt/hpcups/ErnieFilter.h
prnt/hpcups/HPCupsFilter.cpp
prnt/hpcups/HPCupsFilter.h
prnt/hpcups/Halftoner.cpp
prnt/hpcups/Halftoner.h
prnt/hpcups/Hbpl1.cpp
prnt/hpcups/Hbpl1.h
prnt/hpcups/Hbpl1_Wrapper.cpp
prnt/hpcups/Hbpl1_Wrapper.h
prnt/hpcups/ImageProcessor.h
prnt/hpcups/Job.cpp
prnt/hpcups/Job.h
prnt/hpcups/LJColor.cpp
prnt/hpcups/LJColor.h
prnt/hpcups/LJFastRaster.cpp
prnt/hpcups/LJFastRaster.h
prnt/hpcups/LJJetReady.cpp
prnt/hpcups/LJJetReady.h
prnt/hpcups/LJMono.cpp
prnt/hpcups/LJMono.h
prnt/hpcups/LJZjStream.cpp
prnt/hpcups/LJZjStream.h
prnt/hpcups/LJZxStream.cpp
prnt/hpcups/LJZxStream.h
prnt/hpcups/Lidil.cpp
prnt/hpcups/Lidil.h
prnt/hpcups/LidilCompress.cpp
prnt/hpcups/LidilCompress.h
prnt/hpcups/LidilPrintModes.h
prnt/hpcups/Mode10.cpp
prnt/hpcups/Mode10.h
prnt/hpcups/Mode2.cpp
prnt/hpcups/Mode2.h
prnt/hpcups/Mode3.cpp
prnt/hpcups/Mode3.h
prnt/hpcups/Mode9.cpp
prnt/hpcups/Mode9.h
prnt/hpcups/ModeDeltaPlus.cpp
prnt/hpcups/ModeDeltaPlus.h
prnt/hpcups/ModeJbig.cpp
prnt/hpcups/ModeJbig.h
prnt/hpcups/ModeJpeg.cpp
prnt/hpcups/ModeJpeg.h
prnt/hpcups/PCLmGenerator.h
prnt/hpcups/Pcl3.cpp
prnt/hpcups/Pcl3.h
prnt/hpcups/Pcl3Gui.cpp
prnt/hpcups/Pcl3Gui.h
prnt/hpcups/Pcl3Gui2.cpp
prnt/hpcups/Pcl3Gui2.h
prnt/hpcups/Pcl3GuiPrintModes.h
prnt/hpcups/Pcl3PrintModes.h
prnt/hpcups/Pipeline.cpp
prnt/hpcups/Pipeline.h
prnt/hpcups/PrinterCommands.h
prnt/hpcups/Processor.cpp
prnt/hpcups/Processor.h
prnt/hpcups/QuickConnect.cpp
prnt/hpcups/QuickConnect.h
prnt/hpcups/RasterSender.cpp
prnt/hpcups/RasterSender.h
prnt/hpcups/RunLenEncoding.cpp
prnt/hpcups/RunLenEncoding.h
prnt/hpcups/Scaler.cpp
prnt/hpcups/Scaler.h
prnt/hpcups/SystemServices.cpp
prnt/hpcups/SystemServices.h
prnt/hpcups/Utils.cpp
prnt/hpcups/Utils.h
prnt/hpcups/apPrintModes.h
prnt/hpcups/common_defines.h
prnt/hpcups/dbuscomm.cpp
prnt/hpcups/dbuscomm.h
prnt/hpcups/dj3320ColorMaps.cpp
prnt/hpcups/dj3320PrintModes.h
prnt/hpcups/dj3600ColorMaps.cpp
prnt/hpcups/dj400ColorMaps.cpp
prnt/hpcups/dj400PrintModes.h
prnt/hpcups/dj4100ColorMaps.cpp
prnt/hpcups/dj4100PrintModes.h
prnt/hpcups/dj540PrintModes.h
prnt/hpcups/dj600ColorMaps.cpp
prnt/hpcups/dj600PrintModes.h
prnt/hpcups/dj630PrintModes.h
prnt/hpcups/dj690PrintModes.h
prnt/hpcups/dj850PrintModes.h
prnt/hpcups/dj890PrintModes.h
prnt/hpcups/dj895PrintModes.h
prnt/hpcups/dj8x5PrintModes.h
prnt/hpcups/dj8xxColorMaps.cpp
prnt/hpcups/dj970ColorMaps.cpp
prnt/hpcups/dj970PrintModes.h
prnt/hpcups/flate_colorspace.h
prnt/hpcups/genJPEGStrips.cpp
prnt/hpcups/genPCLm.cpp
prnt/hpcups/genPCLm.h
prnt/hpcups/hpjbig_wrapper.h
prnt/hpcups/jccolor.c
prnt/hpcups/jdatadbf.c
prnt/hpcups/jinclude.h
prnt/hpcups/resources.h
prnt/hpijs/PrinterProperties.cpp
prnt/hpijs/PrinterProperties.h
prnt/hpijs/apollo21xx.cpp
prnt/hpijs/apollo21xx.h
prnt/hpijs/apollo2560.cpp
prnt/hpijs/apollo2560.h
prnt/hpijs/apollo2xxx.cpp
prnt/hpijs/apollo2xxx.h
prnt/hpijs/breaks_open.cpp
prnt/hpijs/bug.h
prnt/hpijs/capture.cpp
prnt/hpijs/colormatch.cpp
prnt/hpijs/colormatch.h
prnt/hpijs/colormatcher_open.cpp
prnt/hpijs/colormatcher_open.h
prnt/hpijs/compression.cpp
prnt/hpijs/compression.h
prnt/hpijs/config.h
prnt/hpijs/context.h
prnt/hpijs/context2.cpp
prnt/hpijs/create_so.cpp
prnt/hpijs/creator.cpp
prnt/hpijs/debug.h
prnt/hpijs/dj3320.cpp
prnt/hpijs/dj3320.h
prnt/hpijs/dj3320_cmap.cpp
prnt/hpijs/dj350.cpp
prnt/hpijs/dj350.h
prnt/hpijs/dj3600.cpp
prnt/hpijs/dj3600.h
prnt/hpijs/dj3600_cmap.cpp
prnt/hpijs/dj400.h
prnt/hpijs/dj4100.h
prnt/hpijs/dj4100_cmap.cpp
prnt/hpijs/dj540.cpp
prnt/hpijs/dj540.h
prnt/hpijs/dj55xx.h
prnt/hpijs/dj600.cpp
prnt/hpijs/dj600.h
prnt/hpijs/dj600_maps.cpp
prnt/hpijs/dj630.cpp
prnt/hpijs/dj630.h
prnt/hpijs/dj660.cpp
prnt/hpijs/dj660.h
prnt/hpijs/dj660_maps.cpp
prnt/hpijs/dj690.cpp
prnt/hpijs/dj690.h
prnt/hpijs/dj690_maps.cpp
prnt/hpijs/dj6xx.cpp
prnt/hpijs/dj6xx.h
prnt/hpijs/dj850.cpp
prnt/hpijs/dj850.h
prnt/hpijs/dj850_maps.cpp
prnt/hpijs/dj890.cpp
prnt/hpijs/dj890.h
prnt/hpijs/dj895_maps.cpp
prnt/hpijs/dj895_maps2.cpp
prnt/hpijs/dj8x5.cpp
prnt/hpijs/dj8x5.h
prnt/hpijs/dj8xx.cpp
prnt/hpijs/dj8xx.h
prnt/hpijs/dj970_maps.cpp
prnt/hpijs/dj970_maps2.cpp
prnt/hpijs/dj970_maps3.cpp
prnt/hpijs/dj9xx.cpp
prnt/hpijs/dj9xx.h
prnt/hpijs/dj9xxvip.cpp
prnt/hpijs/dj9xxvip.h
prnt/hpijs/djd2600.h
prnt/hpijs/djgenericvip.cpp
prnt/hpijs/djgenericvip.h
prnt/hpijs/ernieplatform.h
prnt/hpijs/filterhpa.cpp
prnt/hpijs/filterhpa.h
prnt/hpijs/font.h
prnt/hpijs/global_types.h
prnt/hpijs/globals.cpp
prnt/hpijs/halftoner.cpp
prnt/hpijs/halftoner.h
prnt/hpijs/halftoner_open.cpp
prnt/hpijs/halftoner_open.h
prnt/hpijs/header.h
prnt/hpijs/header2.cpp
prnt/hpijs/hpcupsfax.cpp
prnt/hpijs/hpcupsfax.h
prnt/hpijs/hpijs.cpp
prnt/hpijs/hpijs.h
prnt/hpijs/hpijsfax.cpp
prnt/hpijs/hpijsfax.h
prnt/hpijs/hpiom.c
prnt/hpijs/hpiom.h
prnt/hpijs/hpjbig_wrapper.h
prnt/hpijs/hpprint_c_api.h
prnt/hpijs/hpprintapi.h
prnt/hpijs/hptypes.h
prnt/hpijs/htfed.h
prnt/hpijs/htmtxhi.cpp
prnt/hpijs/ijs.c
prnt/hpijs/ijs.h
prnt/hpijs/ijs_client.h
prnt/hpijs/ijs_server.c
prnt/hpijs/ijs_server.h
prnt/hpijs/internal.h
prnt/hpijs/interp.h
prnt/hpijs/interp_data_50.h
prnt/hpijs/io_defs.h
prnt/hpijs/jccolor.c
prnt/hpijs/jdatadbf.c
prnt/hpijs/jinclude.h
prnt/hpijs/job.cpp
prnt/hpijs/job.h
prnt/hpijs/jpegint.h
prnt/hpijs/ldlencap.h
prnt/hpijs/ljcolor.cpp
prnt/hpijs/ljcolor.h
prnt/hpijs/ljfastraster.cpp
prnt/hpijs/ljfastraster.h
prnt/hpijs/ljjetready.cpp
prnt/hpijs/ljjetready.h
prnt/hpijs/ljm1005.cpp
prnt/hpijs/ljm1005.h
prnt/hpijs/ljmono.cpp
prnt/hpijs/ljmono.h
prnt/hpijs/ljp1xxx.h
prnt/hpijs/ljzjs.cpp
prnt/hpijs/ljzjs.h
prnt/hpijs/ljzjscolor.cpp
prnt/hpijs/ljzjscolor.h
prnt/hpijs/ljzjsmono.cpp
prnt/hpijs/ljzjsmono.h
prnt/hpijs/models.cpp
prnt/hpijs/models.h
prnt/hpijs/modes.h
prnt/hpijs/ojprokx50.h
prnt/hpijs/phobos_cmaps.cpp
prnt/hpijs/pmselect.cpp
prnt/hpijs/pmselect.h
prnt/hpijs/printer.cpp
prnt/hpijs/printer.h
prnt/hpijs/printerfactory.cpp
prnt/hpijs/printerfactory.h
prnt/hpijs/printerproxy.cpp
prnt/hpijs/printerproxy.h
prnt/hpijs/pscript.h
prnt/hpijs/psp100.cpp
prnt/hpijs/psp100.h
prnt/hpijs/psp470.h
prnt/hpijs/quickconnect.cpp
prnt/hpijs/quickconnect.h
prnt/hpijs/registry.cpp
prnt/hpijs/resources.h
prnt/hpijs/scaler.cpp
prnt/hpijs/scaler_open.cpp
prnt/hpijs/scaler_open.h
prnt/hpijs/scaler_prop.h
prnt/hpijs/script.cpp
prnt/hpijs/script.h
prnt/hpijs/services.cpp
prnt/hpijs/services.h
prnt/hpijs/systemservices.cpp
prnt/hpijs/systemservices.h
prnt/hpijs/translator.cpp
prnt/hpijs/unistd_.h
prnt/hpijs/version.cpp
prnt/hpijs/versioncode.cpp
prnt/hpps/hppsfilter.c
prnt/hpps/hppsfilter.h
prnt/hpps/patchlev.h
prnt/hpps/psbooklet.c
prnt/hpps/pserror.c
prnt/hpps/pserror.h
prnt/hpps/psspec.c
prnt/hpps/psspec.h
prnt/hpps/psutil.c
prnt/hpps/psutil.h
protocol/discovery/mdns.c
protocol/discovery/mdns.h
protocol/hp_ipp.c
protocol/hp_ipp.h
protocol/hp_ipp_i.h
scan/sane/OrbliteScan/LinuxCommon.h
scan/sane/OrbliteScan/MacCommon.h
scan/sane/bb_ledm.c
scan/sane/common.c
scan/sane/common.h
scan/sane/escl.c
scan/sane/escl.h
scan/sane/escli.h
scan/sane/hpaio.c
scan/sane/hpaio.h
scan/sane/http.c
scan/sane/http.h
scan/sane/io.c
scan/sane/io.h
scan/sane/ledm.c
scan/sane/ledm.h
scan/sane/ledmi.h
scan/sane/marvell.c
scan/sane/marvell.h
scan/sane/marvelli.h
scan/sane/mfpdtf.c
scan/sane/mfpdtf.h
scan/sane/orblite.c
scan/sane/orblite.h
scan/sane/orblitei.h
scan/sane/pml.c
scan/sane/pml.h
scan/sane/sane.h
scan/sane/sanei.h
scan/sane/sanei_debug.h
scan/sane/sanei_init_debug.c
scan/sane/saneopts.h
scan/sane/scl.c
scan/sane/scl.h
scan/sane/sclpml.c
scan/sane/sclpml.h
scan/sane/soap.c
scan/sane/soap.h
scan/sane/soapht.c
scan/sane/soapht.h
scan/sane/soaphti.h
scan/sane/soapi.h
scan/sane/tables.h
scan/sane/xml.c
scan/sane/xml.h
scan/scanext/scanext.c
/usr/include/arpa/inet.h
/usr/include/assert.h
/usr/include/ctype.h
/usr/include/dlfcn.h
/usr/include/errno.h
/usr/include/fcntl.h
/usr/include/inttypes.h
/usr/include/linux/parport.h
/usr/include/linux/ppdev.h
/usr/include/malloc.h
/usr/include/math.h
/usr/include/memory.h
/usr/include/netdb.h
/usr/include/netinet/in.h
/usr/include/pthread.h
/usr/include/pwd.h
/usr/include/setjmp.h
/usr/include/signal.h
/usr/include/stdint.h
/usr/include/stdio.h
/usr/include/stdlib.h
/usr/include/string.h
/usr/include/strings.h
/usr/include/syslog.h
/usr/include/time.h
/usr/include/unistd.h
/usr/include/zlib.h
/usr/include/alloca.h
/usr/include/endian.h
/usr/include/features.h
/usr/include/rpc/netdb.h
/usr/include/sched.h
/usr/include/zconf.h
/usr/include/limits.h
/usr/include/stdc-predef.h
